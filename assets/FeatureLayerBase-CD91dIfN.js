import{e}from"./Evented-CXIxDjmW.js";import{f as E}from"./assets-C2mb-ea2.js";import{y as i,b as l,a as I,Z as ne,n as pe}from"./subclass-BR3PhgZG.js";import{ai as Q,aj as W}from"./Accessor-D6mNnsWy.js";import{s as _}from"./jsonMap-DCC6W5ex.js";import{o as d,r as $}from"./writer-3zufXUNV.js";import{c as le,p as ae}from"./inputs-CnJRqwLx.js";import{n as de,i as K}from"./Field-C8SaaeoI.js";import{b as ue}from"./PopupTemplate-ByHks6sq.js";import{p as ye,e as ce,t as he}from"./formUtils-Dni92j4V.js";import{C as me,z as Z,u as X,a4 as ve}from"./fieldUtils-CNduWQU9.js";import{V as H}from"./reactiveUtils-BFQ0BtrB.js";import{a as fe}from"./layerContainerType-C5CzMsLd.js";import{w as ge}from"./Extent-DHjqVB-p.js";import{v as xe}from"./HeightModelInfo-CSXZysDz.js";import{ap as be,aq as Ee,f as P}from"./Point-DB4Hp4hH.js";import{S as we,C as Fe}from"./arcgisLayerUrl-Cgl5IQFD.js";import{d as Ie,j as je,u as Se,p as $e}from"./commonProperties-C-F8Nu9F.js";import{i as O}from"./Clonable-cKbRam6-.js";import{c as B}from"./Promise-CZrWwByK.js";import{y as Oe,V as Te,Z as D,R as De,M as Ue,C as Me}from"./featureLayerUtils-CeNLEyq1.js";import{p as Be}from"./LayerFloorInfo-BN2blBAm.js";import{p as Ae}from"./Relationship-WMN17mIX.js";import{a as Re}from"./serviceCapabilitiesUtils-GL2GsHu0.js";let g=class extends E{constructor(r){super(r),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};e([i({type:String,json:{write:!0}})],g.prototype,"description",void 0),e([i({type:String,json:{write:!0}})],g.prototype,"label",void 0),e([i()],g.prototype,"type",void 0),e([i({type:String,json:{write:!0}})],g.prototype,"visibilityExpression",void 0),g=e([l("esri.form.elements.Element")],g);const b=g;var A;let S=A=class extends E{constructor(r){super(r),this.type=null}clone(){return new A({type:this.type})}};e([i({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],S.prototype,"type",void 0),S=A=e([l("esri.form.elements.inputs.AttachmentInput")],S);const Ce=S;var R;let x=R=class extends b{constructor(r){super(r),this.attachmentKeyword=null,this.editableExpression=null,this.input=null,this.type="attachment"}clone(){return new R({attachmentKeyword:this.attachmentKeyword,description:this.description,editableExpression:this.editableExpression,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};e([i({type:String,json:{write:!0}})],x.prototype,"attachmentKeyword",void 0),e([i({type:String,json:{write:!0}})],x.prototype,"editableExpression",void 0),e([i({type:Ce,json:{read:{source:"inputType"},write:{target:"inputType"}}})],x.prototype,"input",void 0),e([i({type:["attachment"],json:{read:!1,write:!0}})],x.prototype,"type",void 0),x=R=e([l("esri.form.elements.AttachmentElement")],x);const q=x;var C;let a=C=class extends b{constructor(r){super(r),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){return this._get("editable")??!0}set editable(r){this._set("editable",r)}clone(){return new C({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};e([i({types:de,json:{read:{reader:K},write:!0}})],a.prototype,"domain",void 0),e([i({type:Boolean,json:{write:!0}})],a.prototype,"editable",null),e([i({type:String,json:{write:!0}})],a.prototype,"editableExpression",void 0),e([i({type:String,json:{write:!0}})],a.prototype,"fieldName",void 0),e([i({type:String,json:{write:!0}})],a.prototype,"hint",void 0),e([i({types:le,json:{read:{source:"inputType"},write:{target:"inputType"}}})],a.prototype,"input",void 0),e([i({type:String,json:{write:!0}})],a.prototype,"requiredExpression",void 0),e([i({type:String,json:{read:!1,write:!0}})],a.prototype,"type",void 0),e([i({type:String,json:{write:!0}})],a.prototype,"valueExpression",void 0),a=C=e([l("esri.form.elements.FieldElement")],a);const z=a;var G;let h=G=class extends b{constructor(r){super(r),this.displayCount=null,this.displayType="list",this.editableExpression=null,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new G({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editableExpression:this.editableExpression,label:this.label,orderByFields:I(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};e([i({type:Number,json:{write:!0}})],h.prototype,"displayCount",void 0),e([i({type:["list"],json:{write:!0}})],h.prototype,"displayType",void 0),e([i({type:String,json:{write:!0}})],h.prototype,"editableExpression",void 0),e([i({type:[ue],json:{write:!0}})],h.prototype,"orderByFields",void 0),e([i({type:Number,json:{write:!0}})],h.prototype,"relationshipId",void 0),e([i({type:["relationship"],json:{read:!1,write:!0}})],h.prototype,"type",void 0),h=G=e([l("esri.form.elements.RelationshipElement")],h);const L=h;var V;let w=V=class extends b{constructor(r){super(r),this.text=null,this.textFormat="plain-text",this.type="text"}clone(){return new V({text:this.text,textFormat:this.textFormat,visibilityExpression:this.visibilityExpression})}};e([i({type:String,json:{write:!0}})],w.prototype,"text",void 0),e([i({type:String,json:{write:!0}})],w.prototype,"textFormat",void 0),e([i({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],w.prototype,"type",void 0),w=V=e([l("esri.form.elements.TextElement")],w);const J=w;function Y(r){return{typesWithGroup:{base:b,key:"type",typeMap:{attachment:q,field:z,group:r,relationship:L,text:J}},typesWithoutGroup:{base:b,key:"type",typeMap:{attachment:q,field:z,relationship:L,text:J}}}}function ee(r,t,o=!0){if(!r)return null;const s=o?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return r.filter(n=>s[n.type]).map(n=>s[n.type].fromJSON(n))}function te(r,t,o=!0){if(!r)return null;const s=o?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return r.filter(n=>s[n.type]).map(n=>n.toJSON())}function ie(r,t,o=!0){return r?r.map(s=>ne(o?t.typesWithGroup:t.typesWithoutGroup,s)):null}var N;let y=N=class extends b{constructor(r){super(r),this.elements=null,this.initialState="expanded",this.type="group"}castElements(r){return ie(r,U,!1)}readElements(r,t){return ee(t.formElements,U,!1)}writeElements(r,t){t.formElements=te(r,U,!1)}clone(){return new N({description:this.description,elements:I(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};e([i({json:{write:!0}})],y.prototype,"elements",void 0),e([_("elements")],y.prototype,"castElements",null),e([d("elements",["formElements"])],y.prototype,"readElements",null),e([$("elements")],y.prototype,"writeElements",null),e([i({type:["collapsed","expanded"],json:{write:!0}})],y.prototype,"initialState",void 0),e([i({type:String,json:{read:!1,write:!0}})],y.prototype,"type",void 0),y=N=e([l("esri.form.elements.GroupElement")],y);const U=Y(y),Ge=y;var k;const M=Y(Ge);let u=k=class extends E{constructor(r){super(r),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(r){return ie(r,M)}readElements(r,t){return ee(t.formElements,M)}writeElements(r,t){t.formElements=te(r,M)}clone(){return new k({description:this.description,expressionInfos:I(this.expressionInfos),elements:I(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}async getFieldsUsed(r,t){const o=new Set,{description:s,elements:n,expressionInfos:p,title:f}=this;if(j(o,r,s),j(o,r,f),!n)return[];const oe=Ve(n,p).map(T=>me(o,r,T));await Promise.all(oe);for(const T of n)re(o,{fieldsIndex:r,relationships:t},T);return Array.from(o).sort()}};function re(r,t,o){var n;const{fieldsIndex:s}=t;if(!s||s.fields.length!==r.size)switch(j(r,s,o.label),j(r,s,o.description),o.type){case"field":Z(r,s,o.fieldName);break;case"group":o.elements.forEach(p=>re(r,t,p));break;case"relationship":if(t.relationships){const p=t.relationships.find(f=>f.id===o.relationshipId);p&&Z(r,s,p.keyField)}X(r,s,(n=o.orderByFields)==null?void 0:n.map(p=>p.field));break;case"text":j(r,s,o.text)}}function Ve(r,t){if(!t||t.length===0)return[];const o=se(r),s=[];for(const n of t)o.has(n.name)&&s.push(n.expression);return s}function se(r){const t=new Set;for(const o of r)if(Q(t,o.visibilityExpression),!ye(o)){if(ce(o))W(t,se(o.elements));else if(Q(t,o.editableExpression),he(o)){const{requiredExpression:s,valueExpression:n}=o;W(t,[s,n])}}return t}function j(r,t,o){X(r,t,ve(o))}e([i({type:String,json:{write:!0}})],u.prototype,"description",void 0),e([i({json:{write:!0}})],u.prototype,"elements",void 0),e([_("elements")],u.prototype,"castElements",null),e([d("elements",["formElements"])],u.prototype,"readElements",null),e([$("elements")],u.prototype,"writeElements",null),e([i({type:[ae],json:{write:!0}})],u.prototype,"expressionInfos",void 0),e([i({type:Boolean,json:{default:!1,write:!0}})],u.prototype,"preserveFieldValuesWhenHidden",void 0),e([i({type:String,json:{write:!0}})],u.prototype,"title",void 0),u=k=e([l("esri.form.FormTemplate")],u);const yt=u;let m=class extends O(E){constructor(r){super(r),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.timeZone=null}};e([i()],m.prototype,"creatorField",void 0),e([i()],m.prototype,"creationDateField",void 0),e([i()],m.prototype,"editorField",void 0),e([i()],m.prototype,"editDateField",void 0),e([i()],m.prototype,"realm",void 0),e([i(B("dateFieldsTimeReference",!0))],m.prototype,"timeZone",void 0),m=e([l("esri.layers.support.EditFieldsInfo")],m);const Ne=m;let c=class extends O(E){constructor(r){super(r)}};e([i({constructOnly:!0,json:{write:!0}})],c.prototype,"name",void 0),e([i({constructOnly:!0,json:{write:!0}})],c.prototype,"fields",void 0),e([i({constructOnly:!0,json:{write:!0}})],c.prototype,"isAscending",void 0),e([i({constructOnly:!0,json:{write:!0}})],c.prototype,"indexType",void 0),e([i({constructOnly:!0,json:{write:!0}})],c.prototype,"isUnique",void 0),e([i({constructOnly:!0,json:{write:!0}})],c.prototype,"description",void 0),c=e([l("esri.layers.support.FeatureIndex")],c);let F=class extends O(E){constructor(r){super(r),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};e([i({type:String,json:{read:{source:"shapeAreaFieldName"}}})],F.prototype,"shapeAreaField",void 0),e([i({type:String,json:{read:{source:"shapeLengthFieldName"}}})],F.prototype,"shapeLengthField",void 0),e([i({type:String,json:{read:r=>be.read(r)||Ee.read(r)}})],F.prototype,"units",void 0),F=e([l("esri.layers.support.GeometryFieldsInfo")],F);const ke=F;let v=class extends O(E){constructor(r){super(r),this.code=null,this.defaultValues={},this.domains=null,this.name=null}readDomains(r){if(!r)return null;const t={};for(const o of Object.keys(r))t[o]=K(r[o]);return t}writeDomains(r,t){var s;if(!r)return;const o={};for(const n of Object.keys(r))r[n]&&(o[n]=(s=r[n])==null?void 0:s.toJSON());t.domains=o}};e([i({type:Number,json:{write:!0}})],v.prototype,"code",void 0),e([i({type:Object,json:{write:!0}})],v.prototype,"defaultValues",void 0),e([i({json:{write:!0}})],v.prototype,"domains",void 0),e([d("domains")],v.prototype,"readDomains",null),e([$("domains")],v.prototype,"writeDomains",null),e([i({type:String,json:{write:!0}})],v.prototype,"name",void 0),v=e([l("esri.layers.support.Subtype")],v);const Qe=v,ct=r=>{let t=class extends r{constructor(){super(...arguments),this.copyright=null,this.capabilities=null,this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.definitionExpression=null,this.displayField=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.globalIdField=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.indexes=new(H.ofType(c)),this.isTable=!1,this.layerId=void 0,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.preferredTimeZone=null,this.relationships=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.sourceJSON=null,this.spatialReference=P.WGS84,this.subtypeField=null,this.subtypes=null,this.trackIdField=null,this.version=void 0}get authenticationTriggerEvent(){if(!this.url)return null;const{capabilities:o}=this;if(o){const{query:n,operations:p,editing:f}=o;if(!n.supportsQueryByOthers||!n.supportsQueryByAnonymous||p.supportsEditing&&!(f.supportsUpdateByOthers&&f.supportsUpdateByAnonymous&&f.supportsDeleteByOthers&&f.supportsDeleteByAnonymous))return"load"}if(this.userHasUpdateItemPrivileges){if(Te(this))return"load";if(this.hasUpdateItemRestrictions)return o.operations.supportsQuery?"editing":"load"}if(this.userHasFullEditingPrivileges&&this.hasFullEditingRestrictions)return"editing";const s=this.editFieldsInfo;return(s!=null&&s.creatorField||s!=null&&s.editorField)&&(o!=null&&o.operations.supportsEditing)?"editing":null}readCapabilitiesFromService(o,s){return Re(s,this.url)}readEditingInfo(o,s){const{editingInfo:n}=s;return n?{lastEditDate:n.lastEditDate!=null?new Date(n.lastEditDate):null}:null}get effectiveCapabilities(){const o=this.capabilities;if(!o)return null;const s=I(o),{operations:n,editing:p}=s;return D(this)?(this.userHasUpdateItemPrivileges&&(n.supportsQuery=!0),s):this.userHasUpdateItemPrivileges?(n.supportsAdd=n.supportsDelete=n.supportsEditing=n.supportsQuery=n.supportsUpdate=p.supportsDeleteByOthers=p.supportsGeometryUpdate=p.supportsUpdateByOthers=!0,s):(this.userHasFullEditingPrivileges&&n.supportsEditing&&(n.supportsAdd=n.supportsDelete=n.supportsUpdate=p.supportsGeometryUpdate=!0),s)}readGlobalIdFieldFromService(o,s){return De(s)}get hasFullEditingRestrictions(){const o=this.capabilities;if(!o||D(this))return!1;const{operations:s,editing:n}=o;return s.supportsEditing&&!(s.supportsAdd&&s.supportsDelete&&s.supportsUpdate&&n.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){const o=this.capabilities;if(!o)return!1;const{operations:s,editing:n}=o;return D(this)?!s.supportsQuery:!(s.supportsAdd&&s.supportsDelete&&s.supportsEditing&&s.supportsQuery&&s.supportsUpdate&&n.supportsDeleteByOthers&&n.supportsGeometryUpdate&&n.supportsUpdateByOthers)}readIsTableFromService(o,s){return s.type==="Table"}readMaxScale(o,s){return s.effectiveMaxScale||o||0}readMinScale(o,s){return s.effectiveMinScale||o||0}readObjectIdFieldFromService(o,s){return Ue(s)}readServiceDefinitionExpression(o,s){return s.definitionQuery||s.definitionExpression}set url(o){if(o==null)return void this._set("url",o);const s=we({layer:this,url:o,nonStandardUrlAllowed:!0,logger:pe.getLogger(this)});this._set("url",s.url),s.layerId!=null&&this._set("layerId",s.layerId)}writeUrl(o,s,n,p){Fe(this,o,null,s,p)}readVersion(o,s){return Me(s)}};return e([i({readOnly:!0})],t.prototype,"authenticationTriggerEvent",null),e([i({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],t.prototype,"copyright",void 0),e([i({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],t.prototype,"capabilities",void 0),e([d("service","capabilities")],t.prototype,"readCapabilitiesFromService",null),e([i(B("dateFieldsTimeReference"))],t.prototype,"dateFieldsTimeZone",void 0),e([i({type:Boolean})],t.prototype,"datesInUnknownTimezone",void 0),e([i({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],t.prototype,"definitionExpression",void 0),e([i({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],t.prototype,"displayField",void 0),e([i({readOnly:!0,type:Ne})],t.prototype,"editFieldsInfo",void 0),e([i({readOnly:!0})],t.prototype,"editingInfo",void 0),e([d("editingInfo")],t.prototype,"readEditingInfo",null),e([i({readOnly:!0})],t.prototype,"effectiveCapabilities",null),e([i((()=>{const o=I(Ie),s=o.json.origins;return s["web-map"]={read:!1,write:!1},s["portal-item"]={read:!1,write:!1},o})())],t.prototype,"elevationInfo",void 0),e([i({type:Be,json:{name:"layerDefinition.floorInfo",write:!0,origins:{"web-scene":{name:"layerDefinition.floorInfo",write:{enabled:!0,layerContainerTypes:fe}}}}})],t.prototype,"floorInfo",void 0),e([i({type:ge,json:{origins:{service:{read:{source:"extent"}}}}})],t.prototype,"fullExtent",void 0),e([i()],t.prototype,"gdbVersion",void 0),e([i({readOnly:!0,type:ke,json:{read:{source:"geometryProperties"}}})],t.prototype,"geometryFieldsInfo",void 0),e([i({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:Oe.read}}}})],t.prototype,"geometryType",void 0),e([i({type:String})],t.prototype,"globalIdField",void 0),e([d("service","globalIdField",["globalIdField","fields"])],t.prototype,"readGlobalIdFieldFromService",null),e([i({readOnly:!0})],t.prototype,"hasFullEditingRestrictions",null),e([i({type:Boolean,json:{origins:{service:{read:!0}}}})],t.prototype,"hasM",void 0),e([i({readOnly:!0})],t.prototype,"hasUpdateItemRestrictions",null),e([i({type:Boolean,json:{origins:{service:{read:!0}}}})],t.prototype,"hasZ",void 0),e([i({readOnly:!0,type:xe})],t.prototype,"heightModelInfo",void 0),e([i({type:Date})],t.prototype,"historicMoment",void 0),e([i({type:H.ofType(c),readOnly:!0})],t.prototype,"indexes",void 0),e([i({readOnly:!0})],t.prototype,"isTable",void 0),e([d("service","isTable",["type"])],t.prototype,"readIsTableFromService",null),e([i({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],t.prototype,"layerId",void 0),e([i(je)],t.prototype,"maxScale",void 0),e([d("service","maxScale",["maxScale","effectiveMaxScale"])],t.prototype,"readMaxScale",null),e([i(Se)],t.prototype,"minScale",void 0),e([d("service","minScale",["minScale","effectiveMinScale"])],t.prototype,"readMinScale",null),e([i({type:String})],t.prototype,"objectIdField",void 0),e([d("service","objectIdField",["objectIdField","fields"])],t.prototype,"readObjectIdFieldFromService",null),e([i(B("preferredTimeReference"))],t.prototype,"preferredTimeZone",void 0),e([i({type:[Ae],readOnly:!0})],t.prototype,"relationships",void 0),e([i({type:Boolean})],t.prototype,"returnM",void 0),e([i({type:Boolean})],t.prototype,"returnZ",void 0),e([i({readOnly:!0,json:{write:!1}})],t.prototype,"serverGens",void 0),e([i({readOnly:!0})],t.prototype,"serviceDefinitionExpression",void 0),e([d("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],t.prototype,"readServiceDefinitionExpression",null),e([i({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],t.prototype,"serviceItemId",void 0),e([i()],t.prototype,"sourceJSON",void 0),e([i({type:P,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],t.prototype,"spatialReference",void 0),e([i({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],t.prototype,"subtypeField",void 0),e([i({type:[Qe],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],t.prototype,"subtypes",void 0),e([i({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],t.prototype,"trackIdField",void 0),e([i($e)],t.prototype,"url",null),e([$("url")],t.prototype,"writeUrl",null),e([i({json:{origins:{service:{read:!0}},read:!1}})],t.prototype,"version",void 0),e([d("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],t.prototype,"readVersion",null),t=e([l("esri.layers.mixins.FeatureLayerBase")],t),t};export{ct as R,yt as V,Qe as n};
