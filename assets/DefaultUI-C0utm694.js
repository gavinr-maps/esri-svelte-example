const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Popup-BD0iyx_j.js","./tslib.es6-B3Jf3DVX.js","./Accessor-BLX9ikPh.js","./subclass-BZA_h8Db.js","./reactiveUtils-C5zUhJQJ.js","./asyncUtils-CWX51uTe.js","./Collection-CEdjem1-.js","./Evented-BHRw9x22.js","./shared-B3wH2qpO.js","./SimpleObservable-KocWTzVy.js","./ActionToggle-iT4slXc7.js","./Identifiable-B1UbsKNt.js","./Features-DYw6xAtg.js","./index-Bh2oEzTI.js","./index-2kwcjS9-.css","./intl-CChhNOV8.js","./date-DlqISzcw.js","./jsonMap-0cxwUWs2.js","./locale-C9TlLpzi.js","./messages-OmQvZhAg.js","./assets-C43MgM-v.js","./throttle-jjSnxk80.js","./geometryUtils-KlTtXnEh.js","./geometry-D964gYQX.js","./Extent-Bf3YTe7m.js","./Point-Cg0-ChZE.js","./cast-Bjksrh93.js","./writer-DNAwXnhG.js","./Polyline-D9YkgmM_.js","./mathUtils-C4_ghTv4.js","./scaleUtils-D_Nw3nhM.js","./actionUtils-ClPpuZ4c.js","./Feature-JHcQ4xbg.js","./jsxFactory-CJa39Fro.js","./Promise-B2Hu02L7.js","./uuid-fwrPAdZb.js","./Attachments-PCr7j7mL.js","./unitFormatUtils-CZ2bRlFg.js","./ByteSizeUnit-BsxeN7wM.js","./Cyclical-oTUX3aX7.js","./quantityUtils-D0GB2dMc.js","./Graphic-DsxsIjhH.js","./PopupTemplate-BHMhS05j.js","./Clonable-D3rtuBWg.js","./fieldUtils-tmQlKvWo.js","./enumeration-Ba5njXdz.js","./Color-BCS62Hs5.js","./colorUtils-0bJDPow9.js","./symbols-CNimns--.js","./TextSymbol-D8QO_KUV.js","./screenUtils-_ZIvrt5o.js","./materialUtils-DarhapKC.js","./opacityUtils-C68Tlu6_.js","./vec3f64-BLpZdpfb.js","./aaBoundingBox-BE7cC1jD.js","./persistableUrlUtils-fa1mAujs.js","./collectionUtils-D_lHIu88.js","./Portal-C10FKnaA.js","./Loadable-BabW5Xcc.js","./jsonUtils-CEfjT-BK.js","./AttachmentInfo-DMzNK0rO.js","./AttachmentQuery-BUlkjzkx.js","./featureUtils-Do2jvOGL.js","./layerUtils-BrNoooE9.js","./utils-BwQ00KBJ.js","./Basemap-DVYOaWHz.js","./loadAll-B6mYSptb.js","./PortalItem-DzgXrpyc.js","./writeUtils-Dz7BsE1e.js","./mat4f32-DcsiF_Rp.js","./mat4-GpOFENPA.js","./common-DQOJ18NT.js","./attachmentUtils-CL0GU4LB.js","./globalCss-CZa70j6i.js","./legacyIcon-CEIp6Pa9.js","./Heading-C-odFCu-.js","./widget-DwhGPDuv.js","./uriUtils-DHHvHAs0.js","./a11yUtils-cyWndM8Q.js","./utils-D3iwntXt.js","./ColorStop-Dk3U5tCk.js","./utils-Ce7L3imC.js","./jsonUtils-CSnQD004.js","./parser-CTsgEym6.js","./utils-93yNk4Xc.js","./cimSymbolUtils-DXvZxabN.js","./utils-D2PLyMFF.js","./enums-CmIX1y88.js","./LRUCache-B_PHMSGm.js","./MemCache-Dx1v3xLC.js","./timeUtils-8fb_2oAt.js","./HeatmapColorStop-BJc5nbwr.js","./executeQueryJSON-Cis2sczl.js","./utils-6jMaHUrH.js","./query-Dw-gv3BA.js","./normalizeUtils-EVmAQ-ak.js","./normalizeUtilsCommon-dT81xWiM.js","./utils-Bema0iXE.js","./pbfQueryUtils-B0fU-MiS.js","./pbf-BtDZ1BpD.js","./OptimizedGeometry-BF8iz5FO.js","./OptimizedFeature-6cJ-QFG5.js","./OptimizedFeatureSet-Blu9Ckm7.js","./queryZScale-w66xFVGx.js","./projection-B971H0Re.js","./projectBuffer-Bs7GwaPY.js","./geodesicConstants-DWQLYX7F.js","./FeatureSet-BHEkYP03.js","./Field-ybkHhtnK.js","./fieldType-BuzM0UHS.js","./Query-5Xpquc1r.js","./DataLayerSource-BKkswDvG.js","./FullTextSearch-Csd1Hktu.js","./TimeExtent-DocT5yPf.js","./RelationshipQuery-DPPNeuLK.js","./themeUtils-C3zvZbsE.js","./shared-OyXfj1UM.js","./TimeOnly-DOn_Hy89.js","./UnknownTimeZone-BkowvBs8.js","./FeatureLayer-wa_7EIxE.js","./ClassBreaksRenderer-BuHwSyVK.js","./UniqueValueRenderer-BQtAHUSo.js","./diffUtils-BP7jmOAy.js","./colorRamps-pKd7I5WZ.js","./SizeVariable-936USOrb.js","./sizeVariableUtils-Cmcuvw-4.js","./visualVariableUtils-DX1kS9Se.js","./compilerUtils-Dw3R0f-Z.js","./lengthUtils-DL1-FDQQ.js","./jsonUtils-Ds2Sqto-.js","./defaults-DZ1kfMRx.js","./defaultsJSON-GKolV7NZ.js","./RendererLegendOptions-B-4se3aU.js","./styleUtils-BYTm14n3.js","./jsonUtils-DxpLMo6d.js","./Version-BSlAgupz.js","./FieldsIndex-DpwHKAMX.js","./OverrideHelper-ti072FkP.js","./colorUtils-aL8wj-8G.js","./vec42-YcqnINSP.js","./vec4f64-o2zAXfmz.js","./quantizationUtils-uj_P09aO.js","./heatmapUtils-Dwiv9IEa.js","./SimpleRenderer-BV2L9G_n.js","./MultiOriginJSONSupport-B5nfqtQh.js","./layerContainerType-C5CzMsLd.js","./FeatureLayerBase-Ck7-w8TE.js","./formUtils-ylzKAM7E.js","./HeightModelInfo-9nOoV6LU.js","./arcgisLayerUrl-BX1FE5Hm.js","./commonProperties-CPyIG_-u.js","./ElevationInfo-CA5m_tHv.js","./unitConversionUtils-BMfW9yAe.js","./AttributeTableTemplate-BZeVyq-j.js","./featureLayerUtils-DBsQMhTm.js","./featureQueryAll-DnVoEjkM.js","./LayerFloorInfo-CIQjg5Vk.js","./Relationship-COPq3qM4.js","./serviceCapabilitiesUtils-DAE5z8FP.js","./Layer-CVt7Hb5J.js","./workers-D4HfeYKj.js","./Queue-yu3bZ02p.js","./editsZScale-Bs7_pSzI.js","./APIKeyMixin-Di9kcRBS.js","./ArcGISService-B5qxetOY.js","./BlendLayer-CXM4n_Ge.js","./CustomParametersMixin-B4u7wiBT.js","./EditBusLayer-DoTks2sU.js","./FeatureEffectLayer-CpM66wLd.js","./FeatureEffect-BEzQmzeC.js","./FeatureFilter-BMHRQSxq.js","./FeatureReductionLayer-Ddbk727V.js","./FeatureReductionSelection-7vaL4DYT.js","./labelingInfo-DYPSPZCH.js","./labelUtils-B8petyBk.js","./MD5-C9MwAd2G.js","./OperationalLayer-CVyVfSPu.js","./OrderedLayer-C5VLMHgA.js","./OrderByInfo-IYmS1EXF.js","./PortalLayer-CKja4bdW.js","./portalItemUtils-BzVoFAku.js","./RefreshableLayer-D7lXUJRS.js","./ScaleRangeLayer-Bb8Ig1Hz.js","./TemporalLayer-Dpq2hKKV.js","./TimeInfo-LUiaSFyX.js","./TimeInterval-CNlkea1s.js","./FeatureTemplate-CssMa1yk.js","./FeatureType-C0q_coeM.js","./fieldProperties-Cgxj08ZE.js","./versionUtils-CQ_WhYSP.js","./styleUtils-KMFBtb6u.js","./popupUtils-BBuPGAHd.js","./AlphaCutoff-UcccL64p.js","./interfaces-CL2NbQte.js","./FeatureRelationshipViewModel-BPfZSJYn.js","./featureFormUtils-Cdlj8laq.js","./ReactiveMap-6CfRGOlR.js","./NetworkElement-CyYx535m.js","./Association-CIWSDxb_.js","./Spinner-CU_RHfq8.js","./AnchorElementViewModel-DhGwA7fN.js","./actions-nqvK7hqx.js","./ReactiveSet-BU2iaegS.js","./LayerConstants-B33OP6sh.js","./symbolUtils-_AKSLEsP.js","./mat2df32-orApM5a3.js","./mat2d-D9DBP-jx.js","./webStyleSymbolUtils-CwdsUGtV.js","./devEnvironmentUtils-CnNDiFMM.js","./layerViewUtils-DhFEu8Rd.js","./GoTo-Wtu9mgoE.js","./vmEvent-D4Ubqkbq.js","./geometryServiceUtils-C6Kg3Uew.js","./project-DlMfXva8.js","./Lyr3DWasmPerSceneView-2oqLS8fr.js","./ILyr3DWasmPerSceneView-KC8PJi3s.js","./WorkerHandle-T1sH-Myb.js","./Lyr3DModule-Ccn5rG84.js","./elevationInfoUtils-BC_66_Fg.js","./makeScheduleFunction-CggzEh3c.js","./calcite-button-D_Agetwz.js","./button-9P4PM9SO.js","./form-BZPQ5PUM.js","./dom-D_AJDzAj.js","./interactive-y84HQRWL.js","./label-DEe8AW1C.js","./component-6CIDVndn.js","./loadable-DM18hPdE.js","./locale-A4FuYD8q.js","./key-D63ExP77.js","./observers-D2xgmA06.js","./t9n-D0ry3MEw.js","./icon-BQO9J86c.js","./loader-C-zIPscB.js","./calcite-icon-Cu0W9dtm.js"])))=>i.map(i=>d[i]);
import{r as l}from"./tslib.es6-B3Jf3DVX.js";import{Q as ze,b as M,q,X as Mt,l as ae,h as pn,s as xe,aq as un,O as mn,L as et,x as gn,u as $i,c as Ci,m as at,ar as fn,K as yn,ab as tt,e as xt,i as _n,W as vn,I as wn,S as bn,M as se,_ as D,Z as Mn}from"./Accessor-BLX9ikPh.js";import{watch as b,initial as j,whenOnce as Si,on as it,syncAndInitial as kt,sync as Jt,when as Ei}from"./reactiveUtils-C5zUhJQJ.js";import{m as h,a as w,n as O,b as L,j as Pe,a4 as rt,af as xn,r as kn,X as Xt,O as Di,e as nt}from"./subclass-BZA_h8Db.js";import{q as Qt,t as Ii,x as ei,u as Tn,e as It,B as Lt,n as z,r as Li}from"./jsxFactory-CJa39Fro.js";import{V as x}from"./Collection-CEdjem1-.js";import{h as ot}from"./UpdatingHandles-GfwcIh5z.js";import{_ as ue}from"./index-Bh2oEzTI.js";import{d as Vt,_ as Pn}from"./asyncUtils-CWX51uTe.js";import{_ as Rt,a as $e}from"./InputManager-Ba9xzDpe.js";import{L as $n}from"./Map-iWpb5DpI.js";import{n as Cn}from"./CollectionFlattener-CQN6i8ZK.js";import{o as At}from"./Evented-BHRw9x22.js";import{m as ti}from"./Loadable-BabW5Xcc.js";import{n as Sn,m as En}from"./Promise-B2Hu02L7.js";import{n as Dn,c as Vi,l as ii}from"./GraphicsCollection-FfahqxsR.js";import{w as Ri,t as In}from"./Extent-Bf3YTe7m.js";import{v as Ln}from"./HeightModelInfo-9nOoV6LU.js";import{s as Vn,g as Tt,R as Rn,a2 as An}from"./Point-Cg0-ChZE.js";import{p as Fn}from"./TimeExtent-DocT5yPf.js";import{o as On,h as zn}from"./date-DlqISzcw.js";import{a as lt}from"./TablesMixin-5umgS75f.js";import{c as me}from"./screenUtils-_ZIvrt5o.js";import{n as Nn}from"./collectionUtils-D_lHIu88.js";import{s as Hn}from"./ReactiveMap-6CfRGOlR.js";import{c as Wn,l as le}from"./layerUtils-BrNoooE9.js";import{b as ni}from"./Query-5Xpquc1r.js";import{e as Ne}from"./selectionUtils-DYi6daQO.js";import{l as Te}from"./Color-BCS62Hs5.js";import{i as Zn}from"./Clonable-D3rtuBWg.js";import{M as qn,r as Xe,s as jn}from"./mathUtils-C4_ghTv4.js";import"./IViewEvents-Bci6PjlS.js";import{o as Pt}from"./interfaces-D6pIddIh.js";import{n as B,i as Un}from"./screenUtils-WcqhHU65.js";import{o as Bn}from"./a11yUtils-cyWndM8Q.js";import{l as Gn,g as Kn}from"./heightModelInfoUtils-C6gW75mB.js";import{l as oi}from"./ViewingMode-Dodu7ZZk.js";import{_ as Yn,J as Jn,K as Xn,W as Qn}from"./projection-B971H0Re.js";import{e as ht}from"./common-DQOJ18NT.js";import{g as eo}from"./vec32-Dvg_eL9J.js";import{e as to,r as io,l as no}from"./HighlightDefaults-D4ckYWWJ.js";import{s as oo}from"./imageUtils-CtmzXUTE.js";import{t as so}from"./capabilities-A2uoe7dc.js";import{s as Ai}from"./cast-Bjksrh93.js";import"./intl-CChhNOV8.js";import{n as ao}from"./themeUtils-C3zvZbsE.js";import{c as ro,g as lo}from"./locale-C9TlLpzi.js";import{e as pe}from"./globalCss-CZa70j6i.js";import{t as ho}from"./accessibleHandler-hWbBTR_7.js";import{h as Fi}from"./CompassViewModel-C7G3VWNL.js";import co from"./NavigationToggle-BIWeotJk.js";import Oi from"./ZoomViewModel-oUfjVFgI.js";const je={widthBreakpoint:{getValue(i){const e=i.viewSize[0],t=i.breakpoints,n=this.values;return e<=t.xsmall?n.xsmall:e<=t.small?n.small:e<=t.medium?n.medium:e<=t.large?n.large:n.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(i){const e=i.viewSize[1],t=i.breakpoints,n=this.values;return e<=t.xsmall?n.xsmall:e<=t.small?n.small:e<=t.medium?n.medium:e<=t.large?n.large:n.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(i){const e=i.viewSize,t=e[0],n=e[1],o=this.values;return n>=t?o.portrait:o.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},ct={xsmall:544,small:768,medium:992,large:1200};function po(i){const e=i;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function dt(i,e){return e?je[i].valueToClassName[e].split(" "):[]}const Fr=i=>{let e=class extends i{constructor(...t){super(...t),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=ct}initialize(){this.addHandles(b(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),j))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(t){if(t!==this._get("breakpoints")){if(!po(t)){const n=JSON.stringify(ct,null,2);console.warn("provided breakpoints are not valid, using defaults:"+n),t=ct}this._set("breakpoints",{...t})}}_updateClassNames(){if(!this.container)return;const t=ze.acquire(),n=ze.acquire();let o,s=!1;for(o in je){const a=this[o],r=je[o].getValue({viewSize:this.size,breakpoints:this.breakpoints});a!==r&&(s=!0,this[o]=r,dt(o,a).forEach(c=>n.push(c)),dt(o,r).forEach(c=>t.push(c)))}s&&(this._applyClassNameChanges(t,n),ze.release(t),ze.release(n))}_applyClassNameChanges(t,n){const o=this.container;o&&(n.forEach(s=>o.classList.remove(s)),t.forEach(s=>o.classList.add(s)))}_removeActiveClassNames(){const t=this.container;if(!t)return;let n;for(n in je)dt(n,this[n]).forEach(o=>t.classList.remove(o))}};return l([h()],e.prototype,"breakpoints",null),l([h()],e.prototype,"orientation",void 0),l([h()],e.prototype,"widthBreakpoint",void 0),l([h()],e.prototype,"heightBreakpoint",void 0),e=l([w("esri.views.BreakpointsOwner")],e),e};let te=class extends M{constructor(){super(...arguments),this.items=new x,this._watchUpdatingTracking=new ot,this._callbacks=new Map,this._projector=Qt(),this._hiddenProjector=Qt()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(const n of t.added){const o=()=>n.render();this._callbacks.set(n,o),this._projector.append(this.surface,o)}for(const n of t.removed){const o=this._projector.detach(this._callbacks.get(n));this.surface.removeChild(o.domNode),this._callbacks.delete(n)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,n=this._hiddenProjector;let o;const s=()=>(o=e.render(),o);n.append(t,s),n.renderNow();const a={left:0,top:0,right:0,bottom:0};if(o!=null&&o.domNode){const r=o.domNode.getBoundingClientRect();a.left=r.left,a.top=r.top,a.right=r.right,a.bottom=r.bottom}for(n.detach(s);t.firstChild;)t.removeChild(t.firstChild);return a}overlaps(e,t){const n=this.computeBoundingRect(e),o=this.computeBoundingRect(t);return Math.max(n.left,o.left)<=Math.min(n.right,o.right)&&Math.max(n.top,o.top)<=Math.min(n.bottom,o.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,t){const n=!!(t!=null&&t.disableDecorations);if(!this.items.some(s=>s.visible&&!(n&&s.isDecoration)))return;const o=e.getContext("2d");o.save(),o.font=this._fontString(),this.items.forEach(s=>{n&&s.isDecoration||(o.save(),s.renderCanvas(o),o.restore())}),o.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};l([h({readOnly:!0})],te.prototype,"surface",void 0),l([h({readOnly:!0})],te.prototype,"items",void 0),l([h({readOnly:!0})],te.prototype,"needsRender",null),l([h({readOnly:!0})],te.prototype,"_watchUpdatingTracking",void 0),l([h({readOnly:!0})],te.prototype,"updating",null),te=l([w("esri.views.overlay.ViewOverlay")],te);const si=te,pt=[0,0];function uo(i){const e=(i.ownerDocument||window.document).defaultView,t=i.getBoundingClientRect();return pt[0]=t.left+((e==null?void 0:e.pageXOffset)??0),pt[1]=t.top+((e==null?void 0:e.pageYOffset)??0),pt}function ai(i){i&&(i.textContent="",i.parentNode&&i.parentNode.removeChild(i))}function mo(i){const e=document.createElement("div");return i.appendChild(e),e}const Ce=16,He=750,go=512,fo=2,zr=i=>{let e=class extends i{constructor(...t){super(...t),this._freqInfo={freq:Ce,time:He},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([b(()=>this.cursor,n=>{const{surface:o}=this;o&&o.setAttribute("data-cursor",n)}),b(()=>this.navigating,n=>{const{surface:o}=this;o&&o.setAttribute("data-navigating",n.toString())})])}initialize(){this.addHandles([b(()=>this.ui,(t,n)=>this._handleUIChange(t,n),j),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=q(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(t){const n=this._get("container"),o=Ii(t);if(o||typeof t!="string"||O.getLogger(this).error("#container",`element with id '${t}' not found`),n===o)return;if(this._stopMeasuring(),n&&(n.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(ai(this.root),this._set("root",null)),this.userContent&&(ei(this.userContent,n),ai(this.userContent),this._set("userContent",null))),!o)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);o.classList.add("esri-view");const s=document.createElement("div");s.className="esri-view-user-storage",ei(o,s),o.appendChild(s),this._set("userContent",s);const a=document.createElement("div");a.className="esri-view-root",o.insertBefore(a,o.firstChild),this._set("root",a);const r=document.createElement("div");r.className="esri-view-surface",r.setAttribute("role","application"),r.tabIndex=0,a.appendChild(r),this._set("surface",r);const c=new si;a.appendChild(c.surface),this._set("overlay",c),this.addHandles(b(()=>c.needsRender,d=>{d&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=Mt({render:()=>{var p;return(p=this.overlay)==null?void 0:p.render()}}):this._overlayRenderTaskHandle=ae(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",o),this._startMeasuring()}get focused(){const t=document.activeElement===this.surface;return document.hasFocus()&&t}get size(){return[this.width,this.height]}blur(){var t;(t=this.surface)==null||t.blur()}focus(){var t;(t=this.surface)==null||t.focus()}pageToContainer(t,n,o){const s=this.position;return t-=s?s[0]:0,n-=s?s[1]:0,o?(o[0]=t,o[1]=n):o=[t,n],o}containerToPage(t,n,o){const s=this.position;return t+=s?s[0]:0,n+=s?s[1]:0,o?(o[0]=t,o[1]=n):o=[t,n],o}_handleUIChange(t,n){this.removeHandles("ui"),n&&n!==t&&n.destroy(),t&&(t.view=this,this.addHandles(b(()=>this.root,o=>{t.container=o?mo(o):null},j),"ui")),this._set("ui",t)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const t=this._freqInfo;t.freq=Ce,t.time=He,this.addHandles([pn(window,"resize",()=>{t.freq=Ce,t.time=He}),Mt({prepare:n=>{const o=this._measure(),s=this._freqInfo;if(s.time+=n.deltaTime,o&&(s.freq=Ce,this._get("resizing")||this._set("resizing",!0)),s.time<s.freq)return;s.time=0;const a=this._position();s.freq=a||o?Ce:Math.min(He,s.freq*fo),!o&&s.freq>=go&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const t=this.container,n=t?t.clientWidth:0,o=t?t.clientHeight:0;if(n===0||o===0)return this.suspended||this._set("suspended",!0),!1;const s=this.width,a=this.height;return n===s&&o===a?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",n),this._set("height",o),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:s,oldHeight:a,width:n,height:o}),!0)}_position(){const t=this.container,n=this.position,o=t&&uo(t);return!!o&&(!n||o[0]!==n[0]||o[1]!==n[1])&&(this._set("position",[o[0],o[1]]),!0)}forceDOMReadyCycle(){}};return l([h()],e.prototype,"container",null),l([h({readOnly:!0})],e.prototype,"focused",null),l([h({readOnly:!0})],e.prototype,"height",void 0),l([h()],e.prototype,"messagesCommon",void 0),l([h({type:si})],e.prototype,"overlay",void 0),l([h({readOnly:!0})],e.prototype,"position",void 0),l([h({readOnly:!0})],e.prototype,"resizing",void 0),l([h({readOnly:!0})],e.prototype,"root",void 0),l([h({value:null,readOnly:!0})],e.prototype,"size",null),l([h({readOnly:!0})],e.prototype,"surface",void 0),l([h({readOnly:!0})],e.prototype,"suspended",void 0),l([h()],e.prototype,"ui",void 0),l([h({readOnly:!0})],e.prototype,"userContent",void 0),l([h({readOnly:!0})],e.prototype,"width",void 0),l([h()],e.prototype,"widthBreakpoint",void 0),e=l([w("esri.views.DOMContainer")],e),e};function ee(i){return i!=null&&"open"in i&&"declaredClass"in i}function ri(i){return i!=null&&"declaredClass"in i&&"dockOptions"in i}const Nr=i=>{let e=class extends i{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([b(()=>[this.ui,this.popup],([t,n],o)=>{const s="popup",a="manual";if(o){const[r,c]=o;r&&ee(c)&&(c.view=null,ri(c)&&r.remove(c,s))}t&&ee(n)&&(n.view=this,ri(n)&&t.add(n,{key:s,position:a,internal:!0}))},j),this.on("click",t=>{this.popup&&this.popupEnabled&&(t.pointerType!=="mouse"||t.button===0)&&(ee(this.popup)?this.popup.viewModel.handleViewClick(t):t.async(async()=>{await this.setupPopup(),ee(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(t)}))},Rt.WIDGET)]),Si(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{ue(()=>import("./Popup-BD0iyx_j.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211]),import.meta.url)})}destroy(){this.destroyed||this.closePopup()}async openPopup(t){if(ee(this.popup))return this.popup.open(t);try{if(await this.setupPopup(),!this.popup)return void O.getLogger(this).error(new L("view:null-popup","Popup is null and can't be opened"));this.popup.open(t)}catch{}}closePopup(){var t;(t=this._popupSetupTask)==null||t.abort(),ee(this.popup)&&this.popup.close()}async fetchPopupFeatures(t,n){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(t,n),n)}async setupPopup(){var t;if((t=this._popupSetupTask)==null||t.abort(),this.popup&&!ee(this.popup))return this._popupSetupTask=Vt(async n=>{const{default:o}=await ue(()=>import("./Popup-BD0iyx_j.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211]),import.meta.url);if(xe(n),!this.popup||ee(this.popup))return;const s=this.popup;delete s.open,delete s.close,this.popup=new o(s)}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:t,hits:n},o){const s=[],a=[];let r=!1;const c=un(o,Pe("popup-view-fetch-timeout")??_o),d=u=>{const f=new yo(u);return a.push(f),s.push(f.promise),f},p=u=>{const f=a.at(-1);return f&&f.layerView===u&&!r?f:d(u)};for(const u of n)"graphic"in u?(p(u.layerView).graphics.push(u.graphic),r=!1):(s.push(u.layerView.fetchPopupFeaturesAtLocation(u.mapPoint,c)),r=!0);a.map(u=>u.resolve(c));const m=mn(s).then(u=>u.filter(f=>!!f).flat());return{pendingFeatures:s,allGraphicsPromise:m,location:t}}async _getPopupHits(t,n){const{hits:o,location:s}=await this.popupHitTest(t);xe(n);const a=[];for(const r of o)if("graphic"in r){if(this._isValidPopupGraphic(r.graphic,n)){const c=this._isValidPopupGraphicsLayerView(r.layerView)?r.layerView:void 0;a.push({graphic:r.graphic,layerView:c})}}else this._isValidPopupLocationLayerView(r.layerView)&&a.push({mapPoint:r.mapPoint,layerView:r.layerView});return{hits:a,location:s}}_isValidPopupGraphic(t,n){return t&&!!t.getEffectivePopupTemplate(n==null?void 0:n.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(t){return!t||(!("layer"in t)||!t.suspended)&&"fetchPopupFeaturesFromGraphics"in t}_isValidPopupLocationLayerView(t){return(!("layer"in t)||!t.suspended)&&"fetchPopupFeaturesAtLocation"in t}};return l([h()],e.prototype,"popup",void 0),l([h()],e.prototype,"popupEnabled",void 0),e=l([w("esri.views.PopupView")],e),e};let yo=class{constructor(e){this.layerView=e,this._resolver=et(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(e){const{layerView:t,graphics:n,_resolver:o}=this;if(!t)return o.resolve(n),o.promise;let s;return t.fetchPopupFeaturesFromGraphics(n,e).catch(a=>(s=a,null)).then(a=>{a?o.resolve(a):o.reject(s)}),o.promise}};const _o=5e3;let Qe=class extends Dn{constructor(e){super(e),this.addHandles(this.on("before-add",t=>{t.item!=null&&t.item.parent===this.owner&&(O.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};Qe=l([w("esri.support.AnalysesCollection")],Qe);let ie=class extends M{constructor(e){super(e),this.view=null,this.baseLayerViews=new x,this.referenceLayerViews=new x,this._loadingHandle=b(()=>{var t,n;return(n=(t=this.view)==null?void 0:t.map)==null?void 0:n.basemap},t=>{t&&t.load().catch(()=>{})},j)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){var t,n,o;if((t=this.view)!=null&&t.suspended)return!1;const e=(o=(n=this.view)==null?void 0:n.map)==null?void 0:o.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(s=>s.updating)||this.referenceLayerViews.some(s=>s.updating))}};l([h({constructOnly:!0})],ie.prototype,"view",void 0),l([h({readOnly:!0})],ie.prototype,"baseLayerViews",void 0),l([h({readOnly:!0})],ie.prototype,"referenceLayerViews",void 0),l([h({readOnly:!0})],ie.prototype,"suspended",null),l([h({type:Boolean,readOnly:!0})],ie.prototype,"updating",null),ie=l([w("esri.views.BasemapView")],ie);const vo=ie;function wo(i){return"tryRecycleWith"in i}function bo(i){return i!=null&&typeof i=="object"&&"layerViews"in i}let Mo=class{constructor(e,t,n){this.layer=e,this.view=t,this.layerViewImporter=n,this._controller=new AbortController,this._deferred=et(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,at(this._controller.signal,()=>{const o=new L("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(o)})}tryRecycle(e){if(!this.done||!this.layerView||!wo(this.layerView))return null;const t=this.layer.type,n=this._controller.signal;for(let o=0;o<e.length;o++){const s=e[o];if(s.type!==t)continue;const a=this.layerView.tryRecycleWith(s,{signal:n});if(a){e.splice(o,1),this.layer=s;const r=this.layerView,c=r.view;return this.promise=Promise.race([a.then(()=>(xe(this._controller.signal),s.emit("layerview-destroy",{view:c,layerView:r}),c.emit("layerview-destroy",{view:c,layerView:r}),s.emit("layerview-create",{view:c,layerView:r}),c.emit("layerview-create",{view:c,layerView:r}),r)),new Promise((d,p)=>at(this._controller.signal,()=>p($i())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:t,view:n}=this;t.emit("layerview-destroy",{view:n,layerView:e}),n.emit("layerview-destroy",{layer:t,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var o,s;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:t,view:n}=this;this._map=n.map;try{let a,r;if(await t.load({signal:e}),t.prefetchResources&&await t.prefetchResources({signal:e}),ko(t))a=await t.createLayerView(n,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(t))throw new L("layer:view-not-supported","No layerview implementation was found");const p=await this.layerViewImporter.importLayerView(t);xe(e),a="default"in p?new p.default({layer:t,view:n}):new p({layer:t,view:n})}const c=()=>{r=ae(r),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};r=at(e,c),xe(e);try{await a.when()}catch(p){throw c(),p}if(!((s=(o=this._map)==null?void 0:o.allLayers)==null?void 0:s.includes(t)))return c(),void this._deferred.reject(new L("view:no-layerview-for-layer","The layer has been removed from the map",{layer:t}));this.layerView=a,t.emit("layerview-create",{view:n,layerView:a}),n.emit("layerview-create",{layer:t,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(a){t.emit("layerview-create-error",{view:n,error:a}),n.emit("layerview-create-error",{layer:t,error:a}),this.done=!0,this._deferred.reject(new L("layerview:create-error","layerview creation failed",{layer:t,error:a}))}}},V=class extends M{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new ot,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var n;const t=(n=this.view.map)==null?void 0:n.allLayers;if(t)for(const o of t)this.layerViewImporter.hasLayerViewModule(o)&&this.layerViewImporter.importLayerView(o)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=et(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(gn(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var c,d,p;if(this.destroyed)return;const t=this.view.map;if(this._map!==t&&(this.clear(),this._map=t),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const n=new Set,o=[],s=this.view.ready,a=m=>{if(m!=null){for(const u of m)if(u){n.add(u);const f=this._layerLayerViewInfoMap.get(u);f&&s?f.start():f||this._recyclingInfoMap.has(u)||o.push(u),"layers"in u&&u.layers&&a(u.layers)}}};for(const m of this._rootCollectionNames)a(rt(this,m));for(const[m,u]of this._layerLayerViewInfoMap)if(!n.has(m)){this._layerLayerViewInfoMap.delete(u.layer);const f=u.tryRecycle(o);f?(this.notifyChange("updating"),this._recyclingInfoMap.set(u.layer,u),f.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(u.layer),this._layerLayerViewInfoMap.set(u.layer,u),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(u.layer),u.destroy(),this._reschedule()})):u.destroy()}for(const[m,u]of this._recyclingInfoMap)n.has(m)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(u.layer),u.destroy());for(const m of o)this._createLayerView(m);this._refreshCollections();const r=[(c=t==null?void 0:t.ground)==null?void 0:c.layers,(d=t==null?void 0:t.basemap)==null?void 0:d.baseLayers,(p=t==null?void 0:t.basemap)==null?void 0:p.referenceLayers,t==null?void 0:t.layers].filter(m=>!!m);n.forEach(m=>"layers"in m&&r.push(m.layers)),this.addHandles(r.map(m=>this._watchUpdatingTracking.addOnCollectionChange(()=>m,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([it(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),b(()=>{const e=this.view,t=e==null?void 0:e.map;return[t==null?void 0:t.basemap,t==null?void 0:t.ground,t==null?void 0:t.layers,e==null?void 0:e.ready]},()=>this._reschedule(),kt)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),lt(this._recyclingInfoMap),lt(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject($i()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||xn(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){this.destroyed||(lt(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new L("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}isCreatingLayerViewsForLayer(e,t){var s;this.commitProperty("updatingRemaining");const n=this._layerLayerViewInfoMap.get(e);if(!(n!=null&&n.done))return!0;const o=n.layerView;return!(!o||!t||o.parent===t)||!!(n.done&&o&&"layers"in e&&((s=e.layers)!=null&&s.length))&&e.layers.some(a=>this.isCreatingLayerViewsForLayer(a,o))}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(rt(this,e),rt(this,t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,n){if(!e||!t)return void(t&&t.removeAll());let o=0;for(const s of e){const a=this._layerLayerViewInfoMap.get(s);if(!(a!=null&&a.layerView))continue;const r=a.layerView;r.layer=s,r.parent=n,t.at(o)!==r&&t.splice(o,0,r),"layers"in s&&bo(r)&&this._populateLayerViewsOwners(s.layers,r.layerViews,r),o+=1}o<t.length&&t.splice(o,t.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new Mo(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),n=>{n&&(Ci(n)||n.name==="cancelled:layerview-create")||O.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:n}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};l([h()],V.prototype,"_workPromise",void 0),l([h({readOnly:!0})],V.prototype,"_watchUpdatingTracking",void 0),l([h({readOnly:!0})],V.prototype,"_layersToLayerViews",null),l([h({readOnly:!0})],V.prototype,"_rootCollectionNames",null),l([h()],V.prototype,"layerViewImporter",void 0),l([h()],V.prototype,"supportsGround",void 0),l([h({readOnly:!0})],V.prototype,"updating",null),l([h({readOnly:!0})],V.prototype,"updatingRemaining",null),l([h({constructOnly:!0})],V.prototype,"view",void 0),V=l([w("esri.views.LayerViewManager")],V);const xo=V;function ko(i){return"createLayerView"in i&&i.createLayerView!=null}let E=class extends M{constructor(e){super(e),this.factor=1.5,this.offset=me(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};l([h({type:Number})],E.prototype,"factor",void 0),l([h({nonNullable:!0})],E.prototype,"offset",void 0),l([h()],E.prototype,"position",void 0),l([h({type:Number,range:{min:0}})],E.prototype,"size",void 0),l([h()],E.prototype,"maskUrl",void 0),l([h()],E.prototype,"maskEnabled",void 0),l([h()],E.prototype,"overlayUrl",void 0),l([h()],E.prototype,"overlayEnabled",void 0),l([h({readOnly:!0})],E.prototype,"version",null),l([h({type:Boolean})],E.prototype,"visible",void 0),E=l([w("esri.views.Magnifier")],E);const zi=E;let Y=class extends At.EventedAccessor{constructor(e){super(e),this._selectionMap=new Hn,this._sources=new x,this._trashCan=[],this._layerEditHandles=new x,this._vizTaskId=0,this.showHighlight=!0}initialize(){this.addHandles([b(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),it(()=>this.sources,"change",t=>{const n=this._selectionMap;for(const o of t.removed)n.delete(o);this._refreshListeners(),this._refreshVisualization()},{onListenerAdd:()=>this._refreshListeners()})]);const e=new x;this.view.when().then(()=>{this.view.map&&(this.view.map.allLayers.flatten(t=>"sublayers"in t&&t.sublayers?t.sublayers:null).forEach(t=>{(Ne(t)&&!Wn(t)||le(t))&&e.add(t)}),this.sources=e)})}destroy(){this._layerEditHandles.drain(ae)}get selections(){return Array.from(this._selectionMap.entries()).map(e=>{const[t,n]=e;return{layer:t,selection:[...n.selection]}})}get count(){let e=0;for(const t of this._selectionMap.values())e+=t.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._sources}set sources(e){Nn(e,this._sources)}async getSelectedFeatures(e,t={},n="layerView"){const{view:o,selections:s}=this,a=(e!==void 0?s.filter(r=>e.includes(r.layer)):s).filter(r=>r.selection.length>0).map(async r=>{const{layer:c,selection:d}=r,p=le(c)?c.parent:c;if(p==null||!hi(p))return null;if(n==="layer")return ci(p,d,t);if(li(p))return null;const m=await o.whenLayerView(p).catch(()=>null);return m?ci(m,d,t):null});return(await Promise.all(a)).filter(r=>r!=null)}updateSelection(e){const t=new Map;for(const[s,a]of this._selectionMap)t.set(s,[...a.selection]);let n=!1;const o=e.current.concat(e.added);for(const s of o){const a=s.sourceLayer,r=s.getObjectId();if(this.sources.includes(a)&&(Ne(a)||le(a))&&r!==null){const c=kn(t,a,()=>[]);c.includes(r)||(c.push(r),n=!0)}}for(const s of e.removed){const a=s.sourceLayer,r=s.getObjectId();if(this.sources.includes(a)&&(Ne(a)||le(a))&&r!==null){const c=t.get(a),d=c==null?void 0:c.indexOf(r);d!==void 0&&d>=0&&(c==null||c.splice(d,1),n=!0)}}if(n){const{_selectionMap:s,_trashCan:a}=this,r=[];for(const[c,d]of t){const p=s.get(c);p!==void 0&&a.push(p),s.set(c,{selection:d}),r.push({layer:c,selection:d,...Xt(p!==void 0?p.selection:[],d)})}this._onSelectionChange(r)}}setSelection(e,t){this._setSelection(e,t)}getSelection(e){const t=this._selectionMap.get(e);return t==null?void 0:t.selection}appendToSelection(e,t){const n=this._selectionMap.get(e),o=n!==void 0?[...n.selection]:[];for(const s of t)o.includes(s)||o.push(s);this._setSelection(e,o)}removeFromSelection(e,t){const n=this._selectionMap.get(e);if(!n)return;const o=[];for(const s of n.selection)t.includes(s)||o.push(s);this._setSelection(e,o)}toggleInSelection(e,t){const n=this._selectionMap.get(e);if(!n||n.selection.length===0)return void this._setSelection(e,t);const o=new Set(n.selection),s=new Set(t),a=fn(o,s);this._setSelection(e,Array.from(a))}clear(){const e=this._selectionMap.values();this._trashCan.push(...e);const t=[];for(const[n,o]of this._selectionMap.entries())t.push({layer:n,added:[],removed:[...o.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(t)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){var a;if(this.view==null||this.sources==null)return;for(this._vizTaskId++;this._trashCan.length>0;){const r=this._trashCan.pop();(a=r==null?void 0:r.highlightHandle)==null||a.remove()}const{sources:e,view:t,_selectionMap:n,showHighlight:o}=this,s=this._vizTaskId;for(const r of e){const c=n.get(r),d=le(r)?r.parent:r;if(d!=null&&hi(d)){if(li(d))continue;t.whenLayerView(d).then(p=>{var m;(m=c==null?void 0:c.highlightHandle)==null||m.remove(),c!=null&&o&&s===this._vizTaskId&&"highlight"in p&&typeof p.highlight=="function"&&c.selection.length>0&&(c.highlightHandle=p.highlight(c.selection,"selection"))}).catch(()=>{var p;(p=c==null?void 0:c.highlightHandle)==null||p.remove()})}}}_refreshListeners(){this._layerEditHandles.drain(ae);for(const e of this.sources){const t=le(e)?e.parent:e;if(t!=null&&Ne(t)){const n=t.on("edits",o=>{this._handleEditChanges(o,e)});this._layerEditHandles.push(n)}}}_handleEditChanges(e,t){if(e.deletedFeatures!==void 0&&e.deletedFeatures.length>0&&this._selectionMap.has(t)){const n=e.deletedFeatures.filter(o=>o.error==null).map(o=>o.objectId).filter(Di);this.removeFromSelection(t,n)}}_setSelection(e,t){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);const n=this._selectionMap.get(e);if(n===void 0||!Po(n,{selection:t})){n!==void 0&&this._trashCan.push(n),this._selectionMap.set(e,{selection:[...t]});const o={layer:e,selection:[...t],...Xt(n!==void 0?n.selection:[],t)};this._onSelectionChange([o])}}};l([h({readOnly:!0,nonNullable:!0})],Y.prototype,"selections",null),l([h({readOnly:!0,nonNullable:!0})],Y.prototype,"count",null),l([h({constructOnly:!0,nonNullable:!0})],Y.prototype,"view",void 0),l([h({readOnly:!0,nonNullable:!0})],Y.prototype,"hasSelection",null),l([h()],Y.prototype,"showHighlight",void 0),l([h()],Y.prototype,"sources",null),Y=l([w("esri.views.SelectionManager")],Y);const li=i=>{var e;return le(i)?((e=i.parent)==null?void 0:e.isTable)===!0:i.isTable},To=i=>i.layer!==void 0,hi=i=>(i==null?void 0:i.when)!==void 0,Po=(i,e)=>{if(i==null&&e==null)return!0;if(i!=null&&e==null||i==null&&e!=null)return!1;if(i!=null&&e!=null&&i.selection!=null&&e.selection!=null){const t=[...i.selection],n=[...e.selection];if(t.length!==n.length)return!1;t.sort(),n.sort();for(let o=0;o<t.length;o++)if(t[o]!==n[o])return!1}return!0},ci=async(i,e,t={})=>{let n;if(To(i)){const o=i;n=o===void 0?null:await o.queryFeatures(new ni({...t,objectIds:e})).then(s=>({data:s,layer:i.layer}))}else{const o=i;n=o===void 0?null:await o.queryFeatures(new ni({...t,objectIds:e})).then(s=>({data:s,layer:o}))}return n},$o=Y;let De=class extends Zn(M){constructor(e){super(e),this.accentColor=new Te([255,127,0]),this.textColor=new Te([255,255,255])}};l([h({type:Te,nonNullable:!0})],De.prototype,"accentColor",void 0),l([h({type:Te,nonNullable:!0})],De.prototype,"textColor",void 0),De=l([w("esri.views.Theme")],De);const $t=De,Ni=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],Hi={};function Wi(i){return!!Hi[i]}function Co(i){for(const e of i)if(!Wi(e))return!1;return!0}Ni.forEach(i=>{Hi[i]=!0});let So=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:t,priority:n},o)=>{var s;return(s=this.inputManager)==null?void 0:s.installHandlers(o,[t],n)})}disconnect(){this.inputManager&&this._handlers.forEach((e,t)=>{var n;return(n=this.inputManager)==null?void 0:n.uninstallHandlers(t)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,t,n,o){const s=Array.isArray(e)?e:e.split(",");if(!Co(s))return s.some(Wi)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let a,r;Array.isArray(t)?r=t:(a=t,r=[]),typeof n=="function"?a=n:o=n,o=o??Rt.DEFAULT;const c=this._createUniqueGroupName(),d=new Eo(this.view,s,r,a);this._handlers.set(c,{handler:d,priority:o});for(const p of s){const m=this._handlerCounts.get(p)||0;this._handlerCounts.set(p,m+1)}return this.inputManager&&this.inputManager.installHandlers(c,[d],o),nt(()=>this._removeHandler(c,s))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,t){if(this._handlers.has(e)){this._handlers.delete(e);for(const n of t){const o=this._handlerCounts.get(n);o===void 0||(o===1?this._handlerCounts.delete(n):this._handlerCounts.set(n,o-1))}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},Eo=class extends $e{constructor(e,t,n,o){super(!0),this._latestDragStart=void 0,this.view=e;for(const s of t)switch(s){case"click":this.registerIncoming("click",n,a=>o(Lo(e,a)));break;case"double-click":this.registerIncoming("double-click",n,a=>o(Vo(e,a)));break;case"immediate-click":this.registerIncoming("immediate-click",n,a=>o(Ro(e,a)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",n,a=>o(Ao(e,a)));break;case"hold":this.registerIncoming("hold",n,a=>o(Fo(e,a)));break;case"drag":this.registerIncoming("drag",n,a=>{const r=this._wrapDrag(a);r&&o(r)});break;case"key-down":this.registerIncoming("key-down",n,a=>o(Oo(a)));break;case"key-up":this.registerIncoming("key-up",n,a=>o(zo(a)));break;case"pointer-down":this.registerIncoming("pointer-down",n,a=>o(Se(a,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",n,a=>o(Se(a,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",n,a=>o(Se(a,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",n,a=>o(No(a)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",n,a=>o(Ho(a)));break;case"pointer-enter":this.registerIncoming("pointer-enter",n,a=>o(Se(a,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",n,a=>o(Se(a,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",n,a=>{o(Wo(a))});break;case"focus":this.registerIncoming("focus",n,a=>{o(Do(a))});break;case"blur":this.registerIncoming("blur",n,a=>{o(Io(a))})}}_wrapDrag(e){const t=e.data,{x:n,y:o}=t.center,{action:s,pointerType:a,button:r}=t;if(s==="start"&&(this._latestDragStart=t),!this._latestDragStart)return;const c=t.pointer.native,d=t.buttons,{cancelable:p,timestamp:m}=e,u={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return s==="end"&&(this._latestDragStart=void 0),{type:"drag",action:s,x:n,y:o,origin:u,pointerType:a,button:r,buttons:d,radius:t.radius,angle:qn(t.angle),native:c,timestamp:m,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}};function Do(i){return{type:"focus",timestamp:i.timestamp,native:i.data.native,cancelable:i.cancelable,stopPropagation:()=>i.stopPropagation(),async:e=>i.async(e),preventDefault:()=>i.preventDefault()}}function Io(i){return{type:"blur",timestamp:i.timestamp,native:i.data.native,cancelable:i.cancelable,stopPropagation:()=>i.stopPropagation(),async:e=>i.async(e),preventDefault:()=>i.preventDefault()}}function Lo(i,e){const{pointerType:t,button:n,buttons:o,x:s,y:a,native:r,eventId:c}=e.data,{cancelable:d,timestamp:p}=e;return{type:"click",pointerType:t,button:n,buttons:o,x:s,y:a,native:r,timestamp:p,screenPoint:me(s,a),mapPoint:Ae(i,s,a),eventId:c,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}function Vo(i,e){const{pointerType:t,button:n,buttons:o,x:s,y:a,native:r,eventId:c}=e.data,{cancelable:d,timestamp:p}=e;return{type:"double-click",pointerType:t,button:n,buttons:o,x:s,y:a,native:r,timestamp:p,mapPoint:Ae(i,s,a),eventId:c,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}function Ro(i,e){const{pointerType:t,button:n,buttons:o,x:s,y:a,native:r,eventId:c}=e.data,d=r.pointerId,{cancelable:p,timestamp:m}=e;return{type:"immediate-click",pointerId:d,pointerType:t,button:n,buttons:o,x:s,y:a,native:r,timestamp:m,mapPoint:Ae(i,s,a),eventId:c,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}function Ao(i,e){const{pointerType:t,button:n,buttons:o,x:s,y:a,native:r,eventId:c}=e.data,d=r.pointerId,{cancelable:p,timestamp:m}=e;return{type:"immediate-double-click",pointerId:d,pointerType:t,button:n,buttons:o,x:s,y:a,native:r,timestamp:m,mapPoint:Ae(i,s,a),eventId:c,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}function Fo(i,e){const{pointerType:t,button:n,buttons:o,x:s,y:a,native:r}=e.data,{cancelable:c,timestamp:d}=e;return{type:"hold",pointerType:t,button:n,buttons:o,x:s,y:a,native:r,timestamp:d,mapPoint:Ae(i,s,a),cancelable:c,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}function Ae(i,e,t){return i.toMap(me(e,t),{exclude:[]})}function Oo(i){const{key:e,repeat:t,native:n}=i.data,{cancelable:o,timestamp:s}=i;return{type:"key-down",key:e,repeat:t,native:n,timestamp:s,cancelable:o,stopPropagation:()=>i.stopPropagation(),async:a=>i.async(a),preventDefault:()=>i.preventDefault()}}function zo(i){const{key:e,native:t}=i.data,{cancelable:n,timestamp:o}=i;return{type:"key-up",key:e,native:t,timestamp:o,cancelable:n,stopPropagation:()=>i.stopPropagation(),async:s=>i.async(s),preventDefault:()=>i.preventDefault()}}function Se(i,e){const{x:t,y:n,button:o,buttons:s,native:a,eventId:r}=i.data,c=a.pointerId,d=a.pointerType,{cancelable:p,timestamp:m}=i;return{type:e,x:t,y:n,pointerId:c,pointerType:d,button:o,buttons:s,native:a,timestamp:m,eventId:r,cancelable:p,stopPropagation:()=>i.stopPropagation(),async:u=>i.async(u),preventDefault:()=>i.preventDefault()}}function No(i){const{x:e,y:t,buttons:n,native:o,eventId:s}=i.data.currentEvent,{button:a}=i.data.startEvent,r=i.data.startEvent.native.pointerId,c=i.data.startEvent.native.pointerType,d=i.data.action,p={x:i.data.startEvent.x,y:i.data.startEvent.y},{cancelable:m,timestamp:u}=i;return{type:"pointer-drag",x:e,y:t,pointerId:r,pointerType:c,button:a,buttons:n,action:d,origin:p,native:o,timestamp:u,eventId:s,cancelable:m,stopPropagation:()=>i.stopPropagation(),async:f=>i.async(f),preventDefault:()=>i.preventDefault()}}function Ho(i){const{cancelable:e,data:t,timestamp:n}=i,{x:o,y:s,deltaY:a,native:r}=t;return{type:"mouse-wheel",x:o,y:s,deltaY:a,native:r,timestamp:n,cancelable:e,stopPropagation:()=>i.stopPropagation(),async:c=>i.async(c),preventDefault:()=>i.preventDefault()}}function Wo(i){const{action:e,state:t,device:n}=i.data,{cancelable:o,timestamp:s}=i,{buttons:a,axes:r}=t;return{type:"gamepad",device:n,timestamp:s,action:e,buttons:a,axes:r,cancelable:o,stopPropagation:()=>i.stopPropagation(),async:c=>i.async(c),preventDefault:()=>i.preventDefault()}}function Zo(i){return[i.on("before-add",e=>{const t=e.item;if(t==null||i.includes(t))return O.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();t.onAdd()}),i.on("after-remove",e=>{const t=e.item;t.active&&(t.view.activeTool=null),t.destroy()})]}function Ct(i){return i.visible&&i.getEditableFlag!=null&&i.getEditableFlag(Pt.USER)&&i.getEditableFlag(Pt.MANAGER)}let qo=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._externallyDragging=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,t){const n=()=>e.stopPropagation();switch(e.type){case"pointer-move":pi(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0?this._stopDrag=!0:e.action==="start"?this._externallyDragging=!0:e.action==="end"&&(this._externallyDragging=!1),this._stopDrag&&(n(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!ui(e))break;const o=B(e),s=ye(o,e.pointerType,t.forEachTool);if(s==null)break;const a=s.manipulator,r=s.tool;a==null||r==null||!a.interactive||a.grabbable&&a.grabbableForEvent(e)||!a.grabbing||a.dragging||this._releaseManipulatorBeforeDragging(a,e,t),a!=null&&r!=null&&a.interactive&&a.grabbable&&a.grabbableForEvent(e)&&!a.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:a,tool:r,start:o,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&t.activeTool==null&&(this._revertToNullActiveTool=!0,t.setActiveTool(s.tool)),a.grabbing=!0,a.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:o}),n());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,t);break;case"pointer-drag":{if(!ui(e))break;const o=this._grabbedManipulators.get(e.pointerId),s=o==null?void 0:o.manipulator,a=o==null?void 0:o.tool;if(s==null||a==null)break;const r=B(e);r.x=Xe(r.x,0,t.view.width),r.y=Xe(r.y,0,t.view.height);const c=o.start,d=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(s.dragging=!0,d?s.events.emit("drag",{action:"update",start:c,screenPoint:r}):s.events.emit("drag",{action:"start",start:c,screenPoint:r,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:a,manipulator:s,start:c}));break;case"end":s.dragging=!1,d&&s.events.emit("drag",{action:"end",start:c,screenPoint:r}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,t)}n();break}case"immediate-click":{const o=B(e),s=ye(o,e.pointerType,t.forEachTool);if(jo(e)||t.forEachTool(d=>{if((s==null||s.tool!==d||d.automaticManipulatorSelection)&&d.manipulators){let p=!1;d.manipulators.forEach(({manipulator:m})=>{m.selected&&(m.selected=!1,p=!0)}),p&&d.onManipulatorSelectionChanged&&d.onManipulatorSelectionChanged()}}),s==null)break;const{manipulator:a,tool:r}=s;if(!a.interactive)break;a.selectable&&r.automaticManipulatorSelection&&(a.selected=!a.selected,r.onManipulatorSelectionChanged&&r.onManipulatorSelectionChanged());const c=e.native.shiftKey;a.events.emit("immediate-click",{screenPoint:o,button:e.button,pointerType:e.pointerType,shiftKey:c,stopPropagation:n}),ut(a,n);break}case"click":{const o=B(e),s=ye(o,e.pointerType,t.forEachTool),a=s==null?void 0:s.manipulator;if(a==null||!a.interactive)break;const r=e.native.shiftKey;a.events.emit(e.type,{screenPoint:o,button:e.button,pointerType:e.pointerType,shiftKey:r}),n();break}case"double-click":{const o=B(e),s=ye(o,e.pointerType,t.forEachTool),a=s!=null?s.manipulator:null;if(a==null||!a.interactive)break;const r=e.native.shiftKey;a.events.emit("double-click",{screenPoint:o,button:e.button,pointerType:e.pointerType,shiftKey:r,stopPropagation:n}),ut(a,n);break}case"immediate-double-click":{const o=B(e),s=ye(o,e.pointerType,t.forEachTool),a=s!=null?s.manipulator:null;if(a==null||!a.interactive)break;const r=e.native.shiftKey;a.events.emit("immediate-double-click",{screenPoint:o,button:e.button,pointerType:e.pointerType,shiftKey:r,stopPropagation:n}),e.pointerType==="mouse"&&ut(a,n);break}}this._onFocusChange(t.forEachTool)}_releaseManipulatorBeforeDragging(e,t,n){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:B(t)}),this._grabbedManipulators.forEach(({manipulator:o},s)=>{o===e&&this._grabbedManipulators.delete(s)}),this._afterManipulatorRelease(n.setActiveTool)}_handlePointerEnd(e,t){var o;const n=(o=this._grabbedManipulators.get(e.pointerId))==null?void 0:o.manipulator;n!=null&&n.grabbing&&(n.grabbing=!1,n.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:B(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorRelease(t.setActiveTool))}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=di(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=di(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const t=new Set,n=new Set;this._grabbedManipulators.forEach(({tool:o})=>{t.add(o)}),this._hoveredManipulators.forEach(({tool:o})=>{n.add(o)}),e(o=>{o.hasGrabbedManipulators=t.has(o),o.hasHoveredManipulators=n.has(o);const s=this._grabbedManipulators.values(),a=yn(s,({tool:r})=>r===o);o.firstGrabbedManipulator=a!=null?a.manipulator:null})}clearPointers(e,{forEachTool:t,setActiveTool:n},o=!0,s){const a=(r,c)=>r===e&&(s==null||s===c);this._grabbedManipulators.forEach(({tool:r,manipulator:c,pointerType:d},p)=>{a(r,c)&&(this._grabbedManipulators.delete(p),c.grabbing=!1,c.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:d}))}),this._draggedManipulators.forEach(({tool:r,manipulator:c},d)=>{a(r,c)&&(this._draggedManipulators.delete(d),c.dragging=!1,c.events.emit("drag",{action:"cancel"}))}),o&&this._hoveredManipulators.forEach(({tool:r,manipulator:c},d)=>{a(r,c)&&(this._hoveredManipulators.delete(d),c.hovering=!1)}),this._afterManipulatorRelease(n),this._onFocusChange(t)}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((t,n)=>{this._updateHoveredStateForPointerAtScreenPosition(me(t.x,t.y),n,t.pointerType,e)})}handleHoverEvent(e,t){const n=e.type;n!=="pointer-up"&&n!=="immediate-click"&&n!=="pointer-move"||!pi(e.pointerType)||(n!=="pointer-up"&&this._externallyDragging?this._clearHoveredManipulatorStates(e.pointerId):this._updateHoveredStateForPointerAtScreenPosition(B(e),e.pointerId,e.pointerType,t))}_updateHoveredStateForPointerAtScreenPosition(e,t,n,o){var r;let s=ye(e,n,o);const a=(r=this._hoveredManipulators.get(t))==null?void 0:r.manipulator;s==null||s.manipulator.interactive||(s=null),s!=null&&a===s.manipulator||(a!=null&&(a.hovering=!1),s!=null?(s.manipulator.hovering=!0,this._hoveredManipulators.set(t,s)):this._hoveredManipulators.delete(t),this._onFocusChange(o))}_afterManipulatorRelease(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}_clearHoveredManipulatorStates(e){this._hoveredManipulators.forEach(({manipulator:t},n)=>{e===n&&(this._hoveredManipulators.delete(e),t.hovering=!1)})}};function di(i){for(const{manipulator:e}of i.values())if(e!=null&&e.interactive){if(e.grabbing&&e.grabCursor)return e.grabCursor;if(e.cursor)return e.cursor}return null}function ye(i,e,t){let n=null;return t(o=>{if(o.manipulators==null||!Ct(o))return!1;const s=o.manipulators.intersect(i,e);return s!=null&&(n={tool:o,manipulator:s},!0)}),n}function pi(i){return i==="mouse"}function ui(i){return i.pointerType!=="mouse"||i.button===0}function jo(i){return!!i.native.shiftKey}function ut(i,e){i!=null&&i.consumesClicks&&e()}const mi="attached",mt="tools",Uo=1e3;let W=class extends M{constructor(e){super(e),this._updatingHandles=new ot,this._clock=tt,this._manipulatorState=new qo,this.tools=new x,this.cursor=null,this._interacting=!1,this._interactingTimeout=Uo,this._interactingTimeoutHandle=null,this._forEachTool=t=>{for(const n of this.tools.items)if(t(n))return}}initialize(){this.addHandles([this.view.on(Ni,e=>{this._handleInputEvent(e)},Rt.TOOL),...Zo(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void O.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),t!=null&&t.deactivate(),e!=null&&e.activate(),this._removeIncompleteTools(e);for(const n of this.tools){this._updateToolEditableFlag(n);const o=Ct(n);this.activeTool!=null&&o||this._manipulatorState.clearPointers(n,this._manipulatorStateEventArgs,!o)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=ae(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){var e;this.view.type==="3d"?this.addHandles([b(()=>{const{state:t}=this.view;return"camera"in t&&t.camera},()=>this._forEachManipulator(t=>t.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",t=>this._forEachManipulator(n=>n.onElevationChange(t)))],mi):this.addHandles(b(()=>this.view.extent,()=>this._forEachManipulator(t=>t.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(mi),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:n})=>e(n,t))})}_handleInputEvent(e){let t=!1;const n={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(n):this._forEachTool(o=>{!t&&o.visible&&o.handleInputEvent(n)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(n,this._manipulatorStateEventArgs),t||this.activeTool==null||this.activeTool.handleInputEventAfter(n),this._manipulatorState.handleHoverEvent(n,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(mt),this._forEachTool(e=>{if(e instanceof M){const t=b(()=>[e.cursor,e.visible,e.editable],()=>{Ct(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(t,mt)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",t=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,t.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],mt)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var t;(t=e.setEditableFlag)==null||t.call(e,Pt.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(t=>!(t.cursor==null||!t.visible)&&(e=t.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(t=>(e==null||t!==e)&&!t.created&&t.removeIncompleteOnCancel).forEach(t=>{this.tools.remove(t)})}get test(){}};l([h({constructOnly:!0,nonNullable:!0})],W.prototype,"view",void 0),l([h({value:null})],W.prototype,"activeTool",null),l([h({readOnly:!0,type:x})],W.prototype,"tools",void 0),l([h({readOnly:!0})],W.prototype,"cursor",void 0),l([h({readOnly:!0})],W.prototype,"updating",null),l([h()],W.prototype,"_interacting",void 0),l([h({readOnly:!0})],W.prototype,"interacting",null),W=l([w("esri.views.ToolViewManager")],W);let be=class extends M{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":Bo.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Go[this.deviceType]}};l([h({nonNullable:!0,readOnly:!0})],be.prototype,"nativeIndex",void 0),l([h({type:String,readOnly:!0})],be.prototype,"deviceType",null),l([h({type:Number,readOnly:!0})],be.prototype,"axisThreshold",null),be=l([w("esri.views.input.gamepad.GamepadInputDevice")],be);const Ft=be,Bo=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Go={standard:.15,spacemouse:.025,unknown:0};let Ie=class extends M{constructor(...e){super(...e),this.devices=new x,this.enabledFocusMode="document"}};l([h({type:x.ofType(Ft),readOnly:!0})],Ie.prototype,"devices",void 0),l([h({type:["document","view","none"]})],Ie.prototype,"enabledFocusMode",void 0),Ie=l([w("esri.views.input.gamepad.GamepadSettings")],Ie);const Ko=Ie;let Ue=class extends M{constructor(){super(...arguments),this.gamepad=new Ko}};l([h({readOnly:!0})],Ue.prototype,"gamepad",void 0),Ue=l([w("esri.views.input.Input")],Ue);const Yo=Ue;let ne=class extends M{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};l([h({type:Boolean,nonNullable:!0})],ne.prototype,"enabled",void 0),l([h({type:Ft})],ne.prototype,"device",void 0),l([h({type:["pan","zoom"],nonNullable:!0})],ne.prototype,"mode",void 0),l([h({type:["forward-down","forward-up"],nonNullable:!0})],ne.prototype,"tiltDirection",void 0),l([h({type:Number,nonNullable:!0})],ne.prototype,"velocityFactor",void 0),ne=l([w("esri.views.navigation.gamepad.GamepadSettings")],ne);const Zi=ne;let he=class extends M{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new Zi,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}get effectiveMomentumEnabled(){return this.momentumEnabled&&!Bn()}};l([h({type:Boolean})],he.prototype,"browserTouchPanEnabled",void 0),l([h({type:Zi,nonNullable:!0})],he.prototype,"gamepad",void 0),l([h({type:Boolean})],he.prototype,"momentumEnabled",void 0),l([h({type:Boolean})],he.prototype,"mouseWheelZoomEnabled",void 0),he=l([w("esri.views.navigation.Navigation")],he);const qi=he;let St,gt=null;async function Jo(i){gt||(gt=ue(()=>import("./geometryServiceUtils-C6Kg3Uew.js"),__vite__mapDeps([212,3,57,13,14,1,20,2,58,34,27,24,25,26,17,18,213,59,28,29,93,97]),import.meta.url).then(e=>St=e)),await gt,xe(i)}async function ji(i,e,t,n){if(!i)return null;const o=i.spatialReference;return Yn()||Jn(o,e)?Xn(i,e):St?St.projectGeometry(i,e,t,n):(await Promise.race([Jo(n),Qn(n)]),ji(i,e,t,n))}let _=class extends M{constructor(e){super(e),this.required={extent:!1,heightModelInfo:!1,tileInfo:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=xt(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference??this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var n,o,s,a;const e=(n=this.map)==null?void 0:n.call(this),t=[];return this.priorityCollection!=null&&t.push(this.priorityCollection),t.push({parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(s=e==null?void 0:e.ground)==null?void 0:s.layers},{parent:e==null?void 0:e.basemap,layers:(a=e==null?void 0:e.basemap)==null?void 0:a.referenceLayers}),t}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};let e;if(this._collectLayers(this.mapCollections,n=>{const o=this._getSupportedSpatialReferences(n);if(o.length>0){const s=this._narrowDownSpatialReferenceCandidates(e,o);s!=null&&(e=s)}return(e==null?void 0:e.length)===1})&&(e==null?void 0:e.length)!==1)return{updating:!0};const t=this._pickSpatialReferenceCandidate(e);return{spatialReference:(t==null?void 0:t.spatialReference)??null,viewingMode:(t==null?void 0:t.viewingMode)??null,updating:!1}}get _tileInfoTask(){var s,a;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};const e=(s=this.map)==null?void 0:s.call(this),t=this.spatialReference;if(!t)return{updating:this._spatialReferenceTask.updating};let n;const o=this._collectLayers([{parent:e==null?void 0:e.basemap,layers:(a=e==null?void 0:e.basemap)==null?void 0:a.baseLayers},{layers:e==null?void 0:e.layers}],r=>{var c;return!(!("tileInfo"in r)||!((c=r.tileInfo)!=null&&c.spatialReference.equals(t)))&&(n=r,!0)},r=>"tileInfo"in r);return n?{tileInfo:n.tileInfo,updating:!1}:{updating:o}}get _heightModelInfoTask(){var n;if(!this.required.heightModelInfo||this.suspended&&((n=this._get("_heightModelInfoTask"))!=null&&n.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};let e={};const t=this._collectLayers(this.mapCollections,o=>{var a,r;const s=Gn(o);return!!s&&(e={heightModelInfo:s,vcsWkid:(a=o.spatialReference)==null?void 0:a.vcsWkid,latestVcsWkid:(r=o.spatialReference)==null?void 0:r.latestVcsWkid},!0)},o=>Kn(o));return{...e,updating:t}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=[],t=this._collectLayers(this.mapCollections,n=>{const o="fullExtents"in n&&n.fullExtents||(n.fullExtent!=null?[n.fullExtent]:[]),s=this.requiresExtentInSpatialReference?null:o[0],a=o.find(r=>r.spatialReference.equals(this.spatialReference))??s;if(a)return e.push({extent:a,layer:n}),!0;if(this._getSupportedSpatialReferences(n).length>0)for(const r of o)e.push({extent:r,layer:n});return!1});return{candidates:e,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const n=this._pickExtentCandidate(e),o=this.spatialReference;return n.extent.equals(this._projectExtentTask.input)&&o.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=xt(this._projectExtentTask.task)),this._projectExtentTask={input:n.extent.clone(),output:null,spatialReference:o.clone(),task:Vt(async s=>{try{const a=await ji(n.extent,o,"portalItem"in n.layer?n.layer.portalItem:void 0,s);this._projectExtentTask={...this._projectExtentTask,task:null,output:a}}catch{if(_n(s))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(e==null)return t;const n=new Array;for(const o of e)for(const s of t){if(!o.spatialReference.equals(s.spatialReference))continue;const a=Qo(o.viewingMode,s.viewingMode);if(a!==!1){n.push({spatialReference:o.spatialReference,viewingMode:a});break}}return n.length>0?n:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return e==null||e.length<1?t?{spatialReference:t,viewingMode:null}:null:(t!=null&&e.length>1&&e.some(({spatialReference:n})=>n.equals(t))&&(e=e.filter(({spatialReference:n})=>n.equals(t))),e.length>1&&e.some(({viewingMode:n})=>n!==oi.Local)&&(e=e.filter(({viewingMode:n})=>n!==oi.Local)),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];const n=[];for(const o of t){const s=this.getSpatialReferenceSupport(o,e);if(s!=null){const a=s.constraints??[{spatialReference:o,viewingMode:null}];for(const{spatialReference:r,viewingMode:c}of a)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!r.equals(this.userSpatialReference)||n.push({spatialReference:r,viewingMode:c})}}return n}_pickExtentCandidate(e){const t=this.spatialReference;return e.find(({extent:n})=>t.equals(n.spatialReference))||e[0]}_collectLayers(e,t,n=()=>!0){var s;if(this._loadMaybe((s=this.map)==null?void 0:s.call(this))!=="loaded")return!0;const o=new Xo(n,t);for(const a of e)if(this._collectCollection(a,o),o.done||o.preloading===this.sourcePreloadCount)break;return o.updating}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const n of e.layers)if(t.layerFilter(n)){switch(this._loadMaybe(n)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":if(t.updating||(t.done=t.pushLayer(n)),t.done||t.preloading===this.sourcePreloadCount)break;"layers"in n&&this._collectCollection({layers:n.layers},t)}if(t.done||t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(t=>{Ci(t)}),"loading"):e.loadStatus:"loaded"}};l([h()],_.prototype,"required",void 0),l([h({constructOnly:!0})],_.prototype,"map",void 0),l([h({constructOnly:!0})],_.prototype,"getSpatialReferenceSupport",void 0),l([h()],_.prototype,"defaultSpatialReference",void 0),l([h()],_.prototype,"userSpatialReference",void 0),l([h()],_.prototype,"sourcePreloadCount",void 0),l([h()],_.prototype,"priorityCollection",void 0),l([h()],_.prototype,"requiresExtentInSpatialReference",void 0),l([h()],_.prototype,"suspended",void 0),l([h({readOnly:!0})],_.prototype,"ready",null),l([h({readOnly:!0})],_.prototype,"heightModelInfoReady",null),l([h({readOnly:!0})],_.prototype,"spatialReference",null),l([h({readOnly:!0})],_.prototype,"extent",null),l([h({readOnly:!0})],_.prototype,"heightModelInfo",null),l([h({readOnly:!0})],_.prototype,"vcsWkid",null),l([h({readOnly:!0})],_.prototype,"latestVcsWkid",null),l([h({readOnly:!0})],_.prototype,"viewingMode",null),l([h({readOnly:!0})],_.prototype,"tileInfo",null),l([h({readOnly:!0})],_.prototype,"mapCollections",null),l([h({readOnly:!0})],_.prototype,"_spatialReferenceTask",null),l([h({readOnly:!0})],_.prototype,"_tileInfoTask",null),l([h({readOnly:!0})],_.prototype,"_heightModelInfoTask",null),l([h({readOnly:!0})],_.prototype,"_extentCandidatesTask",null),l([h()],_.prototype,"_extentTask",null),l([h()],_.prototype,"_projectExtentTask",void 0),_=l([w("esri.views.support.DefaultsFromMap")],_);let Xo=class{constructor(e,t){this.layerFilter=e,this.pushLayer=t,this.preloading=-1,this.updating=!1,this.done=!1}};function Qo(i,e){return i!=null?e!=null?i===e&&i:i:e}var Le;let g=Le=class extends At.EventedMixin(Sn(M)){constructor(i){super(i),this._userSpatialReference=null,this._cursor=null,this.handles=new vn,this.updatingHandles=new ot,this.allLayerViews=new Cn({getCollections:()=>{var e,t,n;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(t=this.groundView)==null?void 0:t.layerViews,this.layerViews,(n=this.basemapView)==null?void 0:n.referenceLayerViews]},getChildrenFunction:es}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new Vi,this.analyses=new Qe,this.typeSpecificPreconditionsReady=!0,this.layerViews=new x,this.magnifier=new zi,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Yo,this.navigation=new qi,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new So(this),this.persistableViewModels=new x,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this._userTimeExtent=null,this._lockedTimeExtent=null,this.theme=null,this.handles.add(b(()=>this.preconditionsReady,e=>{var n,o;const t=this.ready;if(e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,this._lockedTimeExtent=this.timeExtent,Le.views.add(this)):(this._lockedSpatialReference=null,Le.views.remove(this)),this.notifyChange("spatialReference"),!e&&t)(n=this.toolViewManager)==null||n.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),(o=this.layerViewManager)==null||o.clear(),this._teardown();else if(e&&!t){try{this._startup()}catch(s){return void queueMicrotask(()=>{this.fatalError=new L("startup-error",null,s)})}this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach()}},Jt))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,Si(()=>this.ready)))),this.basemapView=new vo({view:this}),this.layerViewManager=new xo({view:this,layerViewImporter:{importLayerView:i=>this.importLayerView(i),hasLayerViewModule:i=>this.hasLayerViewModule(i)},supportsGround:this.supportsGround}),this.toolViewManager=new W({view:this}),this._setupSpatialReferenceLogger(),this.selectionManager=new $o({view:this}),this.addHandles([b(()=>this.initialExtentRequired,i=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:i},kt),b(()=>this.ready,i=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=i,this.defaultsFromMap.userSpatialReference=i?this.spatialReference:this._userSpatialReference)},Jt),b(()=>this._userSpatialReference,i=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=i)},kt)])}_setupSpatialReferenceLogger(){let i=null;this.addHandles([b(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var n;const t=((n=this.map)==null?void 0:n.allLayers.length)>0;if(e&&!this.spatialReference&&t){if(i!=null)return;const o=nt(()=>i=xt(i));i=Vt(async s=>{try{await wn(this.spatialReferenceWarningDelay,null,s)}catch{return}finally{i=null}O.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.addHandles(o,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")},{sync:!0})])}destroy(){var i,e;this.destroyed||(Le.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=q(this.graphics),this.analyses=q(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),q(this.analysisViewManager),this.toolViewManager=q(this.toolViewManager),this.layerViewManager=q(this.layerViewManager),this.selectionManager=q(this.selectionManager),this.basemapView=q(this.basemapView),(i=this.groundView)==null||i.destroy(),(e=this.layerViews)==null||e.forEach(t=>t.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=q(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return O.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var i;return(i=this.toolViewManager)==null?void 0:i.activeTool}set activeTool(i){this.toolViewManager&&(this.toolViewManager.activeTool=i)}get animation(){return this._get("animation")}set animation(i){this._set("animation",i)}get center(){return null}get defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new _({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:(i,e)=>this.getSpatialReferenceSupport(i,e),...this.defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(i){this._set("extent",i)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var i;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||ti.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!((i=this.defaultsFromMap)!=null&&i.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(i){i!==this._get("map")&&(i!=null&&i.destroyed&&(O.getLogger(this).warn("#map","The provided map is already destroyed",{map:i}),i=null),ti.isLoadable(i)&&i.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",i))}get spatialReference(){var e,t;const i=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(i&&((t=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&t.heightModelInfo)){const n=i.clone();return n.vcsWkid=this.defaultsFromMap.vcsWkid,n.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,n}return i}set spatialReference(i){const e=!Vn(i,this._get("spatialReference"));this._set("_userSpatialReference",i),e&&(this._set("spatialReference",i),this._spatialReferenceChanged(i))}_spatialReferenceChanged(i){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeExtent(){return this._userTimeExtent??this._lockedTimeExtent??this.getDefaultTimeExtent()??null}set timeExtent(i){this._userTimeExtent=i}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??On}set timeZone(i){this._userTimeZone=i,zn(i)||O.getLogger(this).warn("#timeZone",`the parsed value '${i}' may not be a valid IANA time zone`)}get tools(){var i;return(i=this.toolViewManager)==null?void 0:i.tools}get initialExtent(){var i;return(i=this.defaultsFromMap)==null?void 0:i.extent}get cursor(){var i;return((i=this.toolViewManager)==null?void 0:i.cursor)??this._cursor??"default"}set cursor(i){this._cursor=i,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new $t}whenLayerView(i){var e;return((e=this.layerViewManager)==null?void 0:e.whenLayerView(i))??Promise.reject()}getDefaultSpatialReference(){var i;return(i=this.defaultsFromMap)==null?void 0:i.spatialReference}getDefaultHeightModelInfo(){var i;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((i=this.defaultsFromMap)==null?void 0:i.heightModelInfo)??null}getDefaultTimeZone(){return null}getDefaultTimeExtent(){return null}importLayerView(i){throw new L("importLayerView() not implemented")}hasLayerViewModule(i){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(i){return this.getSpatialReferenceSupport(i)!=null}when(i,e){return this.isResolved()&&!this.ready&&O.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(i,e)}forceReadyCycle(){this.ready&&(Ei(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(i){this.toolViewManager.tools.add(i),this.activeTool=i}tryFatalErrorRecovery(){this.fatalError=null}};g.views=new x,l([h()],g.prototype,"_userSpatialReference",void 0),l([h()],g.prototype,"activeTool",null),l([h({readOnly:!0})],g.prototype,"allLayerViews",void 0),l([h()],g.prototype,"groundView",void 0),l([h()],g.prototype,"animation",null),l([h()],g.prototype,"basemapView",void 0),l([h()],g.prototype,"center",null),l([h()],g.prototype,"defaultsFromMapSettings",null),l([h()],g.prototype,"defaultsFromMap",null),l([h()],g.prototype,"fatalError",void 0),l([h({type:Ri})],g.prototype,"extent",null),l([h(ii(Vi,"graphics"))],g.prototype,"graphics",void 0),l([h(ii(Qe,"analyses"))],g.prototype,"analyses",void 0),l([h({readOnly:!0,type:Ln})],g.prototype,"heightModelInfo",null),l([h({readOnly:!0})],g.prototype,"interacting",null),l([h({readOnly:!0})],g.prototype,"navigating",null),l([h({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],g.prototype,"preconditionsReady",null),l([h({readOnly:!0})],g.prototype,"typeSpecificPreconditionsReady",void 0),l([h({type:x,readOnly:!0})],g.prototype,"layerViews",void 0),l([h()],g.prototype,"resolution",null),l([h({type:zi})],g.prototype,"magnifier",void 0),l([h({value:null,type:$n})],g.prototype,"map",null),l([h()],g.prototype,"padding",void 0),l([h({readOnly:!0})],g.prototype,"ready",void 0),l([h({type:Tt})],g.prototype,"spatialReference",null),l([h()],g.prototype,"spatialReferenceWarningDelay",void 0),l([h()],g.prototype,"stationary",null),l([h({readOnly:!0})],g.prototype,"supportsGround",void 0),l([h({type:Fn})],g.prototype,"timeExtent",null),l([h({type:String,nonNullable:!0})],g.prototype,"timeZone",null),l([h()],g.prototype,"tools",null),l([h()],g.prototype,"toolViewManager",void 0),l([h({readOnly:!0})],g.prototype,"type",void 0),l([h({type:Number})],g.prototype,"scale",void 0),l([h({readOnly:!0})],g.prototype,"updating",void 0),l([h({readOnly:!0})],g.prototype,"initialExtentRequired",void 0),l([h({readOnly:!0})],g.prototype,"initialExtent",null),l([h()],g.prototype,"cursor",null),l([h({readOnly:!0})],g.prototype,"input",void 0),l([h({type:qi,nonNullable:!0})],g.prototype,"navigation",void 0),l([h()],g.prototype,"layerViewManager",void 0),l([h()],g.prototype,"analysisViewManager",void 0),l([h()],g.prototype,"selectionManager",void 0),l([h()],g.prototype,"width",void 0),l([h()],g.prototype,"height",void 0),l([h({readOnly:!0})],g.prototype,"resizing",void 0),l([h({value:null,readOnly:!0})],g.prototype,"size",null),l([h({readOnly:!0})],g.prototype,"suspended",void 0),l([h({readOnly:!0})],g.prototype,"viewEvents",void 0),l([h({readOnly:!0})],g.prototype,"persistableViewModels",void 0),l([h()],g.prototype,"_isValid",void 0),l([h()],g.prototype,"_readyCycleForced",void 0),l([h()],g.prototype,"_lockedSpatialReference",void 0),l([h()],g.prototype,"_userTimeZone",void 0),l([h()],g.prototype,"_lockedTimeZone",void 0),l([h()],g.prototype,"_userTimeExtent",void 0),l([h()],g.prototype,"_lockedTimeExtent",void 0),l([h({type:$t})],g.prototype,"theme",void 0),l([h({readOnly:!0,type:$t})],g.prototype,"effectiveTheme",null),g=Le=l([w("esri.views.View")],g);const ft=globalThis.$arcgis;ft&&!ft.views&&Object.defineProperty(ft,"views",{configurable:!1,enumerable:!0,writable:!1,value:g.views});const al=g;function es(i){return i.layerViews}let oe=class extends En{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=et(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._resolver)==null||e.reject(new L("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._resolver)==null||e.resolve())}update(e,t){t||(t=bn(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};l([h({readOnly:!0})],oe.prototype,"done",null),l([h({readOnly:!0,type:String})],oe.prototype,"state",void 0),l([h()],oe.prototype,"target",void 0),oe=l([w("esri.views.ViewAnimation")],oe),function(i){i.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(oe||(oe={}));const ll=oe;function ts(){const i=new Float32Array(9);return i[0]=1,i[4]=1,i[8]=1,i}function is(i){const e=new Float32Array(9);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e}function ns(i,e,t,n,o,s,a,r,c){const d=new Float32Array(9);return d[0]=i,d[1]=e,d[2]=t,d[3]=n,d[4]=o,d[5]=s,d[6]=a,d[7]=r,d[8]=c,d}function os(i,e){return new Float32Array(i,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:is,create:ts,createView:os,fromValues:ns},Symbol.toStringTag,{value:"Module"}));const ss=i=>i,st=i=>i*i,Ot=i=>1-st(1-i),as=i=>i<.5?st(2*i)/2:(Ot(2*(i-.5))+1)/2,zt=i=>i*i*i,Ui=i=>1-zt(1-i),rs=i=>i<.5?zt(2*i)/2:(Ui(2*(i-.5))+1)/2,Nt=i=>i*i*i*i,Bi=i=>1-Nt(1-i),ls=i=>i<.5?Nt(2*i)/2:(Bi(2*(i-.5))+1)/2,Ht=i=>i*i*i*i*i,Gi=i=>1-Ht(1-i),hs=i=>i<.5?Ht(2*i)/2:(Gi(2*(i-.5))+1)/2,Wt=i=>1-Math.cos(i*Math.PI/2),Ki=i=>1-Wt(1-i),cs=i=>i<.5?Wt(2*i)/2:(Ki(2*(i-.5))+1)/2,Zt=i=>2**(10*(i-1)),qt=i=>1-Zt(1-i),ds=i=>i<.5?Zt(2*i)/2:(qt(2*(i-.5))+1)/2,jt=i=>-(Math.sqrt(1-i*i)-1),Yi=i=>1-jt(1-i),ps=i=>i<.5?jt(2*i)/2:(Yi(2*(i-.5))+1)/2;function R(i){const e=2*(i-Math.sqrt((i-1)*i)),t=e/2/i;return n=>n<t?i*n*n:e*n-e+1}function A(i,e){return(t,n)=>t<e?e*i(t/e,n):1-i((1-t)/(1-e),n)*(1-e)}const us=A(R(1),1),ms=A(R(1),0),Et=A(R(1),.5),gs=A(R(2),1),fs=A(R(2),0),ys=A(R(2),.5),_s=A(R(3),1),vs=A(R(3),0),ws=A(R(3),.5),bs=A(R(4),1),Ms=A(R(4),0),xs=A(R(4),.5),hl={linear:ss,"in-quad":st,"out-quad":Ot,"in-out-quad":as,"in-coast-quad":us,"out-coast-quad":ms,"in-out-coast-quad":Et,"in-cubic":zt,"out-cubic":Ui,"in-out-cubic":rs,"in-coast-cubic":gs,"out-coast-cubic":fs,"in-out-coast-cubic":ys,"in-quart":Nt,"out-quart":Bi,"in-out-quart":ls,"in-coast-quart":_s,"out-coast-quart":vs,"in-out-coast-quart":ws,"in-quint":Ht,"out-quint":Gi,"in-out-quint":hs,"in-coast-quint":bs,"out-coast-quint":Ms,"in-out-coast-quint":xs,"in-sine":Wt,"out-sine":Ki,"in-out-sine":cs,"in-expo":Zt,"out-expo":qt,"in-out-expo":ds,"in-circ":jt,"out-circ":Yi,"in-out-circ":ps};let ks=class{constructor(){this.pan=0,this.rotate=0,this.fov=0,this.sourceZoom=0,this.targetZoom=0}};const Re={desiredScreenFlow:2,minDuration:se(500),maxDuration:se(8e3)},dl={...Re,maxDuration:se(4e3)};let Ts=class Ji{constructor(e){this._createCamera=e,this.compared=new ks,this.segmentStart=0,this.segmentEnd=1,this.settings={desiredScreenFlow:Re.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new Ji(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,t,n){this.source!==e&&this.source.copyFrom(e),this.target!==t&&this.target.copyFrom(t),this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=n.desiredScreenFlow??Re.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const t=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/t}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>ht()}get hasFov(){return Math.abs(this.compared.fov)>ht()}get hasRotate(){return this.compared.rotate>ht()}},Ps=class{constructor(){this.pan=0,this.rotate=0,this.zoom=0,this.fov=0,this.zoomOffset=0}},$s=class{constructor(){this.segments=new Array}get time(){return this.segments.reduce((e,t)=>D(e+t.time),D(0))}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1),e*=this.time;let n=0,o=0;const s=this.definition,a=this.segments.reduce((r,c)=>r||c.definition.hasZoom,!1);for(let r=0;r<this.segments.length;r++){const c=this.segments[r],d=c.definition;if(e<=c.time||r===this.segments.length-1){if(this.segmentInterpolateComponentsAt(c,c.time===0?0:e/c.time,t),s.hasPan&&!isNaN(t.pan)&&isFinite(s.compared.pan)?t.pan=(n+d.compared.pan*t.pan)/s.compared.pan:t.pan=1,s.hasRotate&&!isNaN(t.rotate)&&isFinite(s.compared.rotate)?t.rotate=(o+d.compared.rotate*t.rotate)/s.compared.rotate:t.rotate=1,a&&!isNaN(t.zoom)&&isFinite(d.compared.targetZoom)){const{sourceZoom:p,targetZoom:m}=d.compared,u=t.zoom*(m-p)+p,f=this.segments[0].definition.compared.sourceZoom,N=this.segments[this.segments.length-1].definition.compared.targetZoom,C=Math.abs(m-f)>Math.abs(p-f)?m:p;t.zoomOffset=C-N,t.zoom=(u-f)/(C-f)}else t.zoom=1;return t}e-=c.time,n+=d.compared.pan,o+=d.compared.rotate}}segmentInterpolateComponentsAt(e,t,n){e.interpolateComponentsAt(t,n)}},yt=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,t=e.compared,n=t.sourceZoom,o=t.targetZoom;this._zoomSign=n>o?1:-1,this._panPixelsAtSource=t.pan*e.source.pixelsPerPanAtZoom(n);const s=(e.source.pixelsPerRotate()+e.target.pixelsPerRotate())/2;this._rotatePixels=t.rotate*s}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,t=this.definition.compared.targetZoom,{hasZoom:n,hasPan:o,hasRotate:s}=this.definition;let a=0,r=0;n&&(o&&(a=(t/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),s&&(r=this._zoomSign*(Math.log(e/t)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const c=this.definition.desiredPixelFlow;if(n&&o&&s){const d=a+r+a*r;this._zoomPixelFlow=a*r/d*c,this._panPixelFlow=r/d*c,this._rotatePixelFlow=a/d*c}else if(n&&o){const d=1+a;this._zoomPixelFlow=a/d*c,this._panPixelFlow=1/d*c}else if(n&&s){const d=1+r;this._zoomPixelFlow=r/d*c,this._rotatePixelFlow=1/d*c}else if(o&&s){const d=this._panPixelsAtSource/this._rotatePixels,p=1+d;this._panPixelFlow=d/p*c,this._rotatePixelFlow=1/p*c}else o?this._panPixelFlow=c:n?this._zoomPixelFlow=c:s&&(this._rotatePixelFlow=c);if(this._time=D(Math.max(this.rotateTime,this.zoomTime,this.panTime)),this.fovTime>this._time){const d=this.fovTime/this._time;this._time=this.fovTime,this._zoomPixelFlow/=d,this._panPixelFlow/=d,this._rotatePixelFlow/=d}}get rotateTime(){return this.definition.hasRotate?D(this._rotatePixels/this._rotatePixelFlow):D(0)}get zoomTime(){return this.definition.hasZoom?D(this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow):D(0)}get fovTime(){return this.definition.hasFov?D(Math.abs(this.definition.compared.fov)/Cs):D(0)}get panTime(){if(!this.definition.hasPan)return D(0);if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,t=e*this._panPixelsAtSource;return D(Math.log(t*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow))}return D(this._panPixelsAtSource/this._panPixelFlow)}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const t=this.definition.compared.sourceZoom,n=this.definition.compared.targetZoom;return(t*(t/n)**-e-t)/(n-t)}return e}_interpolateComponentsFov(e){if(e===0)return this.definition.segmentStart;if(e===1)return this.definition.segmentEnd;if(this.definition.hasFov){const{segmentStart:t,segmentEnd:n}=this.definition;return t+e*(n-t)}return this.definition.segmentStart}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(t*e*this._time)-1))/(t*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1),t.zoom=this._interpolateComponentsZoom(e),t.pan=this._interpolateComponentsPan(e),t.rotate=this._interpolateComponentsRotate(e),t.zoomOffset=0,t.fov=this._interpolateComponentsFov(e)}};const Cs=jn(45);function Ss(i,e,t){const n=e-i.compared.sourceZoom,o=i.halfWindowPanAtZoom(n);return-i.halfWindowSize*(t.ascensionFactor*Math.LN2*i.compared.pan+o)*Math.log(i.compared.sourceZoom/e)/(i.desiredPixelFlow*Math.LN2*o)}function Es(i,e,t){const n=1/e,o=Math.log(i.compared.sourceZoom*n),s=1/i.desiredPixelFlow,a=1/Math.LN2,r=e-i.compared.sourceZoom,c=1/r,d=(t.ascensionFactor*Math.LN2*i.compared.pan+i.halfWindowPanAtZoom(r))/i.halfWindowPanAtZoom(1);return i.halfWindowSize*n*s*a*c*d-i.halfWindowSize*o*s*a*c+i.halfWindowSize*o*s*a*d/(r*r)}function Ds(i,e,t){const n=e-i.compared.sourceZoom,o=1/n,s=1/e,a=Math.log(i.compared.sourceZoom*s),r=(t.ascensionFactor*Math.LN2*i.compared.pan+i.halfWindowPanAtZoom(n))/i.halfWindowPanAtZoom(1);return i.halfWindowSize*o*(-2*o*s*r+2*o*a+2*s-2*a*r/(n*n)-r/(e*e))/(i.desiredPixelFlow*Math.LN2)}function Is(i,e){return-i.halfWindowSize*Math.log(i.compared.sourceZoom/e)/(i.desiredPixelFlow*Math.LN2)}function Ls(i,e){return i.halfWindowSize/(e*i.desiredPixelFlow*Math.LN2)}function Vs(i,e){return-i.halfWindowSize/(e*e*i.desiredPixelFlow*Math.LN2)}function Rs(i,e,t){return-i.compared.pan*i.halfWindowSize*(t.ascensionFactor+t.descensionFactor-1)/(i.desiredPixelFlow*i.halfWindowPanAtZoom(e))}function As(i,e,t){return i.compared.pan*i.halfWindowSize*(t.ascensionFactor+t.descensionFactor-1)/(i.desiredPixelFlow*i.halfWindowPanAtZoom(e*e))}function Fs(i,e,t){return-2*i.compared.pan*i.halfWindowSize*(t.ascensionFactor+t.descensionFactor-1)/(i.desiredPixelFlow*i.halfWindowPanAtZoom(e*e*e))}function Os(i,e,t){return i.halfWindowSize*(-i.halfWindowPanAtZoom(e)-t.descensionFactor*Math.LN2*i.compared.pan+i.halfWindowPanAtZoom(i.compared.targetZoom))*Math.log(e/i.compared.targetZoom)/(i.desiredPixelFlow*Math.LN2*i.halfWindowPanAtZoom(-e+i.compared.targetZoom))}function zs(i,e,t){const n=Math.log(e/i.compared.targetZoom),o=1/i.desiredPixelFlow,s=1/Math.LN2,a=-e+i.compared.targetZoom,r=1/a,c=(-i.halfWindowPanAtZoom(e)-t.descensionFactor*Math.LN2*i.compared.pan+i.halfWindowPanAtZoom(i.compared.targetZoom))/i.halfWindowPanAtZoom(1);return-i.halfWindowSize*n*o*s*r+i.halfWindowSize*n*o*s*c/(a*a)+i.halfWindowSize*o*s*r*c/e}function Ns(i,e,t){const n=e-i.compared.targetZoom,o=1/n,s=1/e,a=Math.log(e/i.compared.targetZoom),r=(i.halfWindowPanAtZoom(e)+t.descensionFactor*Math.LN2*i.compared.pan-i.halfWindowPanAtZoom(i.compared.targetZoom))/i.halfWindowPanAtZoom(1);return i.halfWindowSize*o*(-2*o*s*r-2*o*a+2*s+2*a*r/(n*n)-r/(e*e))/(i.desiredPixelFlow*Math.LN2)}function Hs(i,e){return i.halfWindowSize*Math.log(e/i.compared.targetZoom)/(i.desiredPixelFlow*Math.LN2)}function Ws(i,e){return i.halfWindowSize/(e*i.desiredPixelFlow*Math.LN2)}function Zs(i,e){return-i.halfWindowSize/(e*e*i.desiredPixelFlow*Math.LN2)}function qs(i){const e=i.compared.sourceZoom-i.compared.targetZoom;if(e===0)return i.compared.pan*i.halfWindowSize/(i.desiredPixelFlow*i.halfWindowPanAtZoom(i.compared.sourceZoom));const t=Math.LN2*i.compared.pan,n=e,o=i.halfWindowPanAtZoom(n),s=i.halfWindowSize*Math.log(i.compared.sourceZoom/i.compared.targetZoom)/(i.desiredPixelFlow*Math.LN2*o);return i.compared.sourceZoom<=i.compared.targetZoom?s*(t-o):s*(t+o)}function js(i,e){let t=Us(i,e);const n={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},o=n.ascensionFactor===0,s=n.descensionFactor===0,a=o?Is:Ss,r=o?Ls:Es,c=o?Vs:Ds,d=s?Hs:Os,p=s?Ws:zs,m=s?Zs:Ns,u=y=>a(i,y,n)+Rs(i,y,n)+d(i,y,n),f=y=>r(i,y,n)+As(i,y,n)+p(i,y,n),N=y=>c(i,y,n)+Fs(i,y,n)+m(i,y,n);let C=u(t);const re=qs(i);let k;const H=e.maximumIterations||20,v=e.maximumDistance!=null?e.maximumDistance:1/0;for(k=0;k<H;k++){const y=e.desiredSlope??1e-6;let T=f(t);Math.abs(T)>y&&(T+=y);const S=T/N(t);if(isNaN(S)||t>=v&&S<0){if(!isFinite(v))return null;t=v,C=u(t);break}if(t-=S,t<i.compared.sourceZoom||t<i.compared.targetZoom)return null;const U=u(t);if(Math.abs(U-C)/C<=.005)break;C=U}return C>re*(1-.3)||t<i.compared.sourceZoom||t<i.compared.targetZoom?null:t}function Us(i,e){const t=Math.max(i.compared.sourceZoom,i.compared.targetZoom),n=i.source.zoomAtPixelsPerPan(i.desiredPixelFlow/i.compared.pan)/2;return n<t?e.maximumDistance!=null?t+(e.maximumDistance-t)/2:1.5*t:e.maximumDistance?Math.min(e.maximumDistance,n):n}let Bs=class extends $s{constructor(e,t){super(),this._preallocSegments=[new yt,new yt,new yt],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,t)}update(e,t){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();const n=t!=null&&t.apex?js(e,t.apex):null;this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,n?this._updateWithApex(n,t==null?void 0:t.apex):this._updateWithoutApex()}segmentInterpolateComponentsAt(e,t,n){e.interpolateComponentsAt(t,n),e===this._ascensionSegment?n.zoom=Ot(n.zoom):e===this._descensionSegment&&(n.zoom=st(n.zoom))}_updateWithApex(e,t){const[n,o,s]=this._preallocSegments,a=(t==null?void 0:t.ascensionFactor)??.5,r=Math.min(1-a,(t==null?void 0:t.ascensionFactor)!=null&&t.descensionFactor!=null?t.descensionFactor:.5),c=1-a-r;n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.targetZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.definition.segmentEnd=a,n.update(),this._ascensionSegment=n,this.segments.push(n),c>0&&(o.definition?o.definition.copyFrom(this.definition):o.definition=this.definition.clone(),o.definition.copyFrom(this.definition),o.definition.compared.sourceZoom=e,o.definition.compared.targetZoom=e,o.definition.compared.pan=this.definition.compared.pan*c,o.definition.compared.rotate=this.definition.compared.rotate*c,o.definition.segmentStart=n.definition.segmentEnd,o.definition.segmentEnd=n.definition.segmentEnd+c,o.update(),this.segments.push(o)),s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.compared.sourceZoom=e,s.definition.compared.pan=this.definition.compared.pan*r,s.definition.compared.rotate=this.definition.compared.rotate*r,s.definition.segmentStart=a+c,s.update(),this._descensionSegment=s,this.segments.push(s)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const Gs=new Ps;let fl=class{get time(){return this._time}get isLinear(){return this.path.segments.length===1}constructor(e){this._time=se(0),this._easing=Et,this.definition=new Ts(e),this.path=new Bs}update(e,t,n){this.definition.update(e,t,n),this.path.update(this.definition,n),this._time=this._applyTimeSettings(Mn(isFinite(this.path.time)?this.path.time:D(0)),n),this._easing=n.easing??(this._time>=1e3?Et:qt)}cameraAt(e,t){e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const n=this.path.interpolateComponentsAt(e,Gs);t.interpolate(this.definition.source,this.definition.target,n)}_normalizedEasing(e){const t=this._easing(0,this._time),n=this._easing(1,this._time);return(this._easing(e,this._time)-t)/(n-t)}_applyTimeSettings(e,t){const n=t.speedFactor!=null?t.speedFactor:1,o=t.minDuration??Re.minDuration/n,s=t.maxDuration??Re.maxDuration/n;return e=t.duration!=null?t.duration:se(Math.min(Math.max(e/n,o),s))}};function _l(i,e){switch(e){case"primary":return i.pointerType==="touch"||i.button===0;case"secondary":return i.pointerType!=="touch"&&i.button===2;case"tertiary":return i.pointerType!=="touch"&&i.button===1}}function vl(i,e){if(i.pointerType==="touch")return!1;switch(e){case"primary":return i.button===0;case"secondary":return i.button===2;case"tertiary":return i.button===1}}let wl=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const t=e.data,n=t.pointers.size;switch(t.action){case"start":this._currentCount=n,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=n,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=n,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var t,n;this._startEvent=e,(n=(t=this._callbacks).condition)!=null&&n.call(t,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var t,n;(n=(t=this._callbacks).condition)!=null&&n.call(t,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var t,n;(n=(t=this._callbacks).condition)!=null&&n.call(t,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}};function F(i){let e=i*i;return i<0&&(e*=-1),e}function Ml(i){return i.translation[0]=0,i.translation[1]=0,i.translation[2]=0,i.heading=0,i.tilt=0,i}function xl(i,e,t){const n=t,o=i.state,s=i.device,a=e.tiltDirection==="forward-down"?1:-1,r=1;return s.deviceType==="standard"?(n.translation[0]=F(o.axes[0]),n.translation[1]=F(o.axes[1]),n.translation[2]=F(o.buttons[7])-F(o.buttons[6]),n.heading=F(o.axes[2]),n.tilt=F(o.axes[3])):s.deviceType==="spacemouse"&&(n.translation[0]=1.2*F(o.axes[0]),n.translation[1]=1.2*F(o.axes[1]),n.translation[2]=2*-F(o.axes[2]),n.heading=1.2*F(o.axes[5]),n.tilt=1.2*F(o.axes[3])),n.tilt*=a,eo(n.translation,n.translation,r),n}function kl(i,e){const t=e;return t.translation[0]=i[1]-i[0],t.translation[1]=i[3]-i[2],t.translation[2]=i[4]-i[5],t.heading=i[7]-i[6],t.tilt=i[8]-i[9],t.zoom=i[10]-i[11],t}function Tl(i){return i.translation[0]===0&&i.translation[1]===0&&i.translation[2]===0&&i.heading===0&&i.tilt===0&&i.zoom===0}function Pl(i){const e=()=>i(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),nt(()=>document.removeEventListener("visibilitychange",e))}function gi(i){const e=i.native;return e?{buttons:e.buttons.map(t=>t.pressed?t.value||1:0),axes:e.axes.map(t=>Js(t,i.axisThreshold))}:{buttons:[],axes:[]}}function Ks(i,e){if(i.axes.length!==e.axes.length||i.buttons.length!==e.buttons.length)return!1;for(let t=0;t<i.axes.length;t++)if(i.axes[t]!==e.axes[t])return!1;for(let t=0;t<i.buttons.length;t++)if(i.buttons[t]!==e.buttons[t])return!1;return!0}function Ys(i){for(let e=0;e<i.axes.length;e++)if(i.axes[e]!==0)return!1;for(let e=0;e<i.buttons.length;e++)if(i.buttons[e]!==0)return!1;return!0}function Js(i,e){const t=Math.abs(i);return t<e?0:Math.sign(i)*(t-e)/(1-e)}let Xs=class{constructor(e,t){this._element=e,this._input=t,this._hasEventListeners=!1,this._onConnectGamepad=s=>{this._connectGamepad(s.gamepad)},this._onDisconnectGamepad=s=>{const a=s.gamepad,r=a.index,c=this._inputDevices[r];c&&(this._emitGamepadEvent(a,gi(c),!1),this._inputDevices.splice(r,1),this._latestUpdate.splice(r,1),this._input.gamepad.devices.remove(c),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const n="getGamepads"in window.navigator,o=window.isSecureContext;this.supported=n&&o,this.supported&&(fi(s=>this._connectGamepad(s)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const t=new Ft(e);t.deviceType!=="unknown"&&(this._inputDevices[e.index]=t,this._input.gamepad.devices.add(t)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=Mt({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),t=this._element.contains(document.activeElement),n=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!t;fi(o=>{const s=this._inputDevices[o.index];if(!s)return;const a=this._latestUpdate[o.index],r=gi(s),c=n||Ys(r);a&&(a.timestamp===o.timestamp||!a.active&&c||Ks(a.state,r))||this._emitGamepadEvent(o,r,!c)})}_emitGamepadEvent(e,t,n){const o=this._latestUpdate[e.index],s=o&&o.active;if(!s&&!n)return;const a=!s&&n?"start":s&&n?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:t,active:n},this._callback&&this._callback({device:this._inputDevices[e.index],state:t,action:a})}};function Qs(i){if(!i||!i.connected)return!1;for(let e=0;e<i.axes.length;e++)if(isNaN(i.axes[e]))return!1;return!0}function fi(i){for(const e of navigator.getGamepads())Qs(e)&&i(e)}const yi=Pe("edge"),ea=Pe("chrome"),ta=Pe("ff"),ia=Pe("safari"),_i="esri-view-surface",_e={touchNone:`${_i}--touch-none`,touchPan:`${_i}--touch-pan`};let na=class Xi{constructor(e,t){this._input=t,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Xs(e,this._input),this._gamepadSource.onEvent=n=>this._callback("gamepad",n)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=q(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const t in this._active)if(!e||!e.has(t)){const n=this._active[t];this._element.removeEventListener(_t[t],n),delete this._active[t]}e&&e.forEach(t=>{if(!this._active[t]&&_t[t]){const n=(this._eventHandlers[t]||this._handleDefault).bind(this,t);this._element.addEventListener(_t[t],n),this._active[t]=n}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,t){t?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?_e.touchNone:_e.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?_e.touchPan:_e.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(_e.touchNone),this._element.classList.remove(_e.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,t){const n=Un(this._element,e);return Xi.test.disableSubpixelCoordinates&&(n.x=Math.round(n.x),n.y=Math.round(n.y)),t.x=n.x,t.y=n.y,t}_handleKey(e,t){const{key:n}=t;n&&e==="key-up"&&this._keyDownState.delete(n);const o={native:t,key:n,repeat:!!n&&this._keyDownState.has(n)};n&&e==="key-down"&&this._keyDownState.add(o.key),this._callback(e,o)}_handlePointer(e,t){const n=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});this._callback(e,n)}_handlePointerPreventDefault(e,t){const n=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});t.preventDefault(),this._callback(e,n)}_getDeltaFromTrackpadOrMouseWheel(e){return e.shiftKey&&Pe("mac")&&e.deltaY===0?e.deltaX:e.deltaY}_handleMouseWheel(e,t){let n=this._getDeltaFromTrackpadOrMouseWheel(t);switch(t.deltaMode){case 0:yi&&(n=n/document.documentElement.clientHeight*600);break;case 1:n*=30;break;case 2:n*=900}yi?n*=.7:ea||ia?n*=.6:ta&&(n*=1.375);const o=100,s=Math.abs(n);s>o&&(n=n/s*200/(1+Math.exp(-.02*(s-o))));const a=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,deltaY:n});this._callback(e,a)}_handlePointerCaptureLost(e,t){this._activePointerCaptures.delete(t.pointerId),this._handleDefault(e,t)}_handleDefault(e,t){const n={native:t};t.preventDefault(),this._callback(e,n)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};na.test={disableSubpixelCoordinates:!1};const _t={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let Cl=class extends $e{constructor(){super(!0),this.registerIncoming("context-menu",e=>e.data.native.preventDefault())}};const I={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function Dt(i,e){return Math.abs(e.x-i.x)+Math.abs(e.y-i.y)}function oa(i,e){const t=e.x-i.x,n=e.y-i.y;return Math.sqrt(t*t+n*n)}function sa(i,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:me()},i.length===0)return e;if(i.length===1)return e.center.x=i[0].x,e.center.y=i[0].y,e;if(i.length===2){const[v,y]=i,[T,S]=[y.x-v.x,y.y-v.y];return e.radius=Math.sqrt(T*T+S*S)/2,e.center.x=(v.x+y.x)/2,e.center.y=(v.y+y.y)/2,e}let t=0,n=0;for(let v=0;v<i.length;v++)t+=i[v].x,n+=i[v].y;t/=i.length,n/=i.length;const o=i.map(v=>v.x-t),s=i.map(v=>v.y-n);let a=0,r=0,c=0,d=0,p=0,m=0,u=0;for(let v=0;v<o.length;v++){const y=o[v],T=s[v],S=y*y,U=T*T;a+=S,r+=U,c+=y*T,d+=S*y,p+=U*T,m+=y*U,u+=T*S}const f=.5*(d+m),N=.5*(p+u),C=a*r-c*c,re=(f*r-N*c)/C,k=(a*N-c*f)/C,H=me(re+t,k+n);return{radius:Math.sqrt(re*re+k*k+(a+r)/i.length),center:H}}function Ve(i){const{native:e}=i,{pointerId:t,button:n,pointerType:o}=e;return o==="mouse"?`${t}:${n}`:`${o}`}let El=class extends $e{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,t,n,o){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:t.buttons,timestamp:o,pointers:aa(this._activePointerMap),pointer:t,angle:n.angle,radius:n.radius,center:n.center}}_addPointer(e){const t=e.native.pointerId,n=We(this._activePointerMap).angle,o={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(t,o);const s=Be(o,Qi(this._activePointerMap));o.initialAngle=s,o.lastAngle=s,this._updatePointerAngles(n)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const t=e.native.pointerId,n=this._activePointerMap.get(t);n?n.event=e:this._addPointer(e)}_removePointer(e){const t=We(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(t)}_updatePointerAngles(e){const t=We(this._activePointerMap);this._activePointerMap.forEach(n=>{n.initialAngle=Be(n,t)-e,n.lastAngle=Be(n,t)-e})}_emitEvent(e,t,n){const o=We(this._activePointerMap);this._drag.emit(this._createPayload(e,t,o,n),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const t=e.data.native.pointerId,n=se(e.timestamp);this._activePointerMap.get(t)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,n),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(t)):(this._removePointer(t),this._emitEvent("removed",e.data,se(e.timestamp))))}_handlePointerDrag(e){const t=e.data,n=t.currentEvent,o=se(e.timestamp);switch(t.action){case"start":case"update":this._isDragging?this._activePointerMap.has(n.native.pointerId)?(this._updatePointer(n),!this._isCurrentDragSuppressed&&this._emitEvent("update",n,o)):(this._addPointer(n),this._emitEvent("added",n,o),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(n),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",n,o))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function Qi(i){const e=[];return i.forEach(t=>{e.push(me(t.event.x,t.event.y))}),sa(e)}function We(i){const e=Qi(i);let t=0;return i.forEach(n=>{let o=Be(n,e),s=o-n.lastAngle;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;o=n.lastAngle+s,n.lastAngle=o;const a=o-n.initialAngle;t+=a}),t/=i.size||1,{angle:t,radius:e.radius,center:e.center}}function aa(i){const e=new Map;return i.forEach((t,n)=>e.set(n,t.event)),e}function Be(i,e){const t=i.event,n=t.x-e.center.x,o=t.y-e.center.y;return Math.atan2(o,n)}var vi;(function(i){i[i.Left=0]="Left",i[i.Middle=1]="Middle",i[i.Right=2]="Right",i[i.Back=3]="Back",i[i.Forward=4]="Forward",i[i.Undefined=-1]="Undefined"})(vi||(vi={}));let Il=class extends $e{constructor(e=I.maximumDoubleClickDelay,t=I.maximumDoubleClickDistance,n=I.maximumDoubleTouchDelay,o=I.maximumDoubleTouchDistance,s=tt){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=t,this._maximumDoubleTouchDelay=n,this._maximumDoubleTouchDistance=o,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const t=e.data,n=Ve(t);if(!this._pointerState.has(n)){const o={downButton:t.native.button,x:t.x,y:t.y,immediateDoubleClick:null};this._pointerState.set(n,o),this.startCapturingPointer(t.native)}}_handlePointerUp(e){const t=e.data,n=Ve(t),o=this._pointerState.get(n);if(o&&o.downButton===t.native.button){const s=o.immediateDoubleClick,a=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;s?(s.timeoutHandle.remove(),Dt(s,e.data)>a?this._startImmediateDoubleClick(e,o):(this._immediateDoubleClick.emit(e.data,void 0,s.modifiers),this._removeState(t))):Dt(o,e.data)>a?this._removeState(t):this._startImmediateDoubleClick(e,o)}}_startImmediateDoubleClick(e,t){const n=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;t.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),n)}}_removeState(e){const t=Ve(e);this._pointerState.delete(t),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},Vl=class extends $e{constructor(e=I.maximumClickDelay,t=I.movementUntilMouseDrag,n=I.movementUntilPenDrag,o=I.movementUntilTouchDrag,s=I.holdDelay,a=tt){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=t,this._movementUntilPenDrag=n,this._movementUntilTouchDrag=o,this._holdDelay=s,this._clock=a,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",r=>this._handlePointerDown(r)),this.registerIncoming("pointer-up",r=>this._handlePointerLoss(r,"pointer-up")),this.registerIncoming("pointer-capture-lost",r=>this._handlePointerLoss(r,"pointer-capture-lost")),this.registerIncoming("pointer-cancel",r=>this._handlePointerLoss(r,"pointer-cancel")),this._moveHandle=this.registerIncoming("pointer-move",r=>this._handlePointerMove(r)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=ae(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const t=e.data,n=t.native.pointerId;let o=null;this._pointerState.size===0&&(o=this._clock.setTimeout(()=>{const a=this._pointerState.get(n);if(a){if(!a.isDragging){const r=a.previousEvent;this._pointerHold.emit(r,void 0,e.modifiers),a.holdEmitted=!0}a.holdTimeout=null}},this._holdDelay));const s={startEvent:t,previousEvent:t,startTimestamp:e.timestamp,isDragging:!1,downButton:t.native.button,holdTimeout:o,modifiers:new Set};this._pointerState.set(n,s),this.startCapturingPointer(t.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_handlePointerMove(e){const t=e.data,n=t.native.pointerId,o=this._pointerState.get(n);o&&(o.isDragging?this._pointerDrag.emit(Ze("update",o,t),void 0,o.modifiers):oa(t,o.startEvent)>this._getDragThreshold(t.native.pointerType)&&this._startDragging(e),o.previousEvent=t)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const t=e.data,n=t.native.pointerId;this._pointerState.forEach(o=>{o.holdTimeout!=null&&(o.holdTimeout.remove(),o.holdTimeout=null),o.isDragging||(o.modifiers=e.modifiers,o.isDragging=!0,n===o.startEvent.native.pointerId?this._pointerDrag.emit(Ze("start",o,t)):this._pointerDrag.emit(Ze("start",o,o.previousEvent),e.timestamp))})}_handlePointerLoss(e,t){const n=e.data,o=n.native.pointerId,s=this._pointerState.get(o);s&&(s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(Ze("end",s,t==="pointer-up"?n:s.previousEvent),void 0,s.modifiers):t==="pointer-up"&&s.downButton===n.native.button&&e.timestamp-s.startTimestamp<=this._maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(n),this._pointerState.delete(o),this.stopCapturingPointer(n.native),this._pointerState.size===0&&this._moveHandle.pause())}};function Ze(i,e,t){return{action:i,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:t}}let Al=class extends $e{constructor(e=I.maximumDoubleClickDelay,t=I.maximumDoubleClickDistance,n=I.maximumDoubleTouchDelay,o=I.maximumDoubleTouchDistance,s=tt){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=t,this._maximumDoubleTouchDelay=n,this._maximumDoubleTouchDistance=o,this._clock=s,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",a=>this._handleImmediateClick(a)),this.registerIncoming("pointer-down",a=>this._handlePointerDown(a))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=ae(e.doubleClickTimer))}get hasPendingInputs(){for(const e of this._pointerState.values())if(e.doubleClickTimer!=null)return!0;return!1}_clearDoubleClickTimer(e,t){const n=this._pointerState.get(e);n&&(n.doubleClickTimer=ae(n.doubleClickTimer),t&&this._click.emit(n.event.data,void 0,n.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const t=this._pointerState.get(e);t.pointerDownCount===1&&this._click.emit(t.event.data,void 0,t.event.modifiers),t.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_handleImmediateClick(e){const t=e.data,{pointerType:n}=t.native,o=ra(t);if(!this._pointerState.has(o))return void this._startClick(e);const s=this._pointerState.get(o),{data:a,modifiers:r}=s.event,c=n==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;Dt(a,t)>c?(this._clearDoubleClickTimer(o,!0),this._startClick(e)):(this._clearDoubleClickTimer(o,!1),s.pointerDownCount===2&&this._doubleClick.emit(a,void 0,r))}_handlePointerDown(e){const t=Ve(e.data),n=this._pointerState.get(t);n&&(n.pointerDownCount+=1)}_startClick(e){const{data:t}=e,{native:{pointerType:n}}=t,o=Ve(t),s=n==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,a=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(o),s);this._pointerState.set(o,{event:e,doubleClickTimer:a,pointerDownCount:1}),this.refreshHasPendingInputs()}};function ra(i){const{pointerId:e,pointerType:t,button:n}=i.native;return t==="mouse"?`${e}:${n}`:`${t}`}let ce=class extends M{constructor(e){super(e),this.color=to.clone(),this.haloOpacity=io,this.fillOpacity=no}equals(e){return this.color.equals(e.color)&&(this.haloColor||this.color).equals(e.haloColor||e.color)&&this.haloOpacity===e.haloOpacity&&this.fillOpacity===e.fillOpacity}};l([h({type:Te})],ce.prototype,"color",void 0),l([h({type:Te})],ce.prototype,"haloColor",void 0),l([h()],ce.prototype,"haloOpacity",void 0),l([h()],ce.prototype,"fillOpacity",void 0),ce=l([w("esri.views.support.HighlightOptions")],ce);const zl=ce,wi=2048,la=1.5,ha=8;function en(i,e){const{format:t,quality:n,rotation:o,disableDecorations:s}=i||{},a=Ut(i,e.padding),r=va(i,{width:e.width-a.left-a.right,height:e.height-a.top-a.bottom}),{width:c,height:d}=_a(i,r),p=sn(t),m=an[p];return{format:p,quality:Xe(n??m,0,100),area:r,width:c,height:d,rotation:o,disableDecorations:!!s,ignoreBackground:!!(i!=null&&i.ignoreBackground),ignorePadding:!!(i!=null&&i.ignorePadding)}}function ca(i,e){const t=en(i,e),n=t.area,o=t.width/n.width,s=Ut(t,e.padding),a=s.left+s.right,r=s.top+s.bottom,c=e.width-a,d=e.height-r,p=Math.floor(c*o+a),m=Math.floor(d*o+r),u=(i==null?void 0:i.layers)??[],f=t.ignoreBackground,N=t.ignorePadding;return{framebufferWidth:p,framebufferHeight:m,region:{x:Math.floor(n.x*o)+s.left,y:Math.floor(n.y*o)+s.top,width:t.width,height:t.height},format:t.format,quality:t.quality,rotation:t.rotation,pixelRatio:o,layers:u,disableDecorations:t.disableDecorations,ignoreBackground:f,ignorePadding:N,objectAndLayerIdColor:!1}}function da(i,e,t){const{ctx:n,canvas:o}=tn(i,t),s=n.getImageData(0,0,i.width,i.height),a=on(o,e);return nn(o),{dataUrl:a,data:s}}function pa(i,e){const{ctx:t,canvas:n}=tn(i,e),o=t.getImageData(0,0,i.width,i.height);return nn(n),o}function tn(i,e){const t=ua();e.premultipliedAlpha&&xa(i),t.width=i.width,t.height=i.height;const n=t.getContext("2d",{willReadFrequently:!0});return n.putImageData(i,0,0),e.flipY&&Ma(n),{ctx:n,canvas:t}}function nn(i){i.width=0,i.height=0}function ua(){return vt==null&&(vt=document.createElement("canvas")),vt}let vt=null;function on(i,e){const t=ka[e.format],n=e.quality/100;return i.toDataURL(t,n)}function ma(i,e){const t=sn(i),n=an[t];return{format:t,quality:Xe(e??n,0,100)}}function ga(i,e){return e/Math.max(i[0],i[1])}function fa(i,e,t,n=0,o=0,s=i.width-n,a=i.height-o,r=!1){const{data:c}=i,{width:d,height:p,data:m}=e,u=s/d,f=a/p,N=Math.ceil(u/2),C=Math.ceil(f/2),re=i.width;for(let k=0;k<p;k++)for(let H=0;H<d;H++){const v=4*(H+(r?p-k-1:k)*d);let y=0,T=0,S=0,U=0,Bt=0,Gt=0;const hn=(k+.5)*f;for(let Fe=Math.floor(k*f);Fe<(k+1)*f;Fe++){const Kt=Math.abs(hn-(Fe+.5))/C,cn=(H+.5)*u,dn=Kt*Kt;for(let Oe=Math.floor(H*u);Oe<(H+1)*u;Oe++){const Yt=Math.abs(cn-(Oe+.5))/N,ge=Math.sqrt(dn+Yt*Yt);if(ge>=1)continue;let Q=2*ge*ge*ge-3*ge*ge+1;const fe=4*(n+Oe+(o+Fe)*re);Gt+=Q*c[fe+3],T+=Q,!t&&c[fe+3]<255&&(Q=Q*c[fe+3]/255),S+=Q*c[fe],U+=Q*c[fe+1],Bt+=Q*c[fe+2],y+=Q}}m[v]=S/y,m[v+1]=U/y,m[v+2]=Bt/y,m[v+3]=Gt/T}return e}function ya(i,e,t){if(!e)return i;const{framebufferWidth:n,framebufferHeight:o,pixelRatio:s,region:a}=i,r=Ut(i,t),c=r.left+r.right,d=r.top+r.bottom,p=n-c,m=o-d,u=Math.min(ha,Math.min((wi-c)/p,(wi-d)/m));return u<la?i:{...i,framebufferWidth:Math.round(p*u)+c,framebufferHeight:Math.round(m*u)+d,pixelRatio:s*u,resample:{region:{x:Math.round((a.x-r.left)*u)+r.left,y:Math.round((a.y-r.top)*u)+r.top,width:Math.round(a.width*u),height:Math.round(a.height*u)},width:n,height:o}}}function _a(i,e){if(!i)return e;const t=i.width,n=i.height;if(t!=null&&n!=null)return{width:Math.floor(t),height:Math.floor(n)};if(t==null&&n==null)return e;const o=e.width/e.height;return n==null?{width:Math.floor(t),height:Math.floor(t/o)}:{width:Math.floor(n*o),height:Math.floor(n)}}function va(i,e){const t={x:0,y:0,width:e.width,height:e.height};if(i!=null&&i.area){i.area.x!=null&&(t.x=Math.floor(i.area.x)),i.area.y!=null&&(t.y=Math.floor(i.area.y));const n=i.area.width!=null?Math.floor(i.area.width):null,o=i.area.height!=null?Math.floor(i.area.height):null;if(t.width=e.width-t.x,t.height=e.height-t.y,n!=null&&o!=null)t.width=Math.min(t.width,n),t.height=Math.min(t.height,o);else if(n==null&&o!=null){const s=Math.min(t.width,n);t.height=s/t.width*t.height,t.width=s}else if(n!=null&&o==null){const s=Math.min(t.height,o);t.width=s/t.height*t.width,t.height=s}}return wa(ba(t,i),e)}function wa(i,e){const t=Math.floor(Math.max(i.x,0)),n=Math.floor(Math.max(i.y,0)),o={x:t,y:n,width:Math.floor(Math.min(i.width,e.width-t)),height:Math.floor(Math.min(i.height,e.height-n))},s=o.width/o.height,a=i.width/i.height;if(a===s)return o;if(a>s){const d=Math.floor(o.width/a),p=o.height-d;return{x:o.x,y:Math.floor(o.y+p/2),width:o.width,height:d}}const r=Math.floor(o.height*a),c=o.width-r;return{x:Math.floor(o.x+c/2),y:o.y,width:r,height:o.height}}function ba(i,e){if((e==null?void 0:e.width)==null||e.height==null)return i;const t=e.width/e.height,n=i.width/i.height;if(n===t)return i;if(n<t){const s=Math.floor(i.height*t);return i.x-=(s-i.width)/2,i.width=s,i}const o=Math.floor(i.width/t);return i.y-=(o-i.height)/2,i.height=o,i}function Ut(i,e){return!e||i!=null&&i.ignorePadding?Pa:e}function sn(i){switch(i){case"png":case"jpg":case"jpeg":return i;default:return Ta}}function Ma(i){i.save(),i.globalCompositeOperation="copy",i.scale(1,-1),i.translate(0,-i.canvas.height),i.drawImage(i.canvas,0,0),i.restore()}function xa(i){const e=i.data,t=e.length;for(let n=0;n<t;n+=4){const o=e[n+3];if(o!==255&&o>0){const s=255/o;e[n]=e[n]*s,e[n+1]=e[n+1]*s,e[n+2]=e[n+2]*s}}}const ka={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},bi=98,Ta="png",an={png:100,jpg:bi,jpeg:bi},Pa={top:0,right:0,bottom:0,left:0},Nl=Object.freeze(Object.defineProperty({__proto__:null,completeUserSettings:en,createEmptyImageData:oo,encode:da,encodeData:pa,getFormatAndQuality:ma,getMaximumResolutionScale:ga,resampleHermite:fa,screenshotSuperSampleSettings:ya,toDataUrl:on,toRenderSettings:ca},Symbol.toStringTag,{value:"Module"}));function Hl(i){const e=so();return e.available?i==="3d"&&e.majorPerformanceCaveat?new L("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):e.supportsHighPrecisionFragment?e.supportsVertexShaderSamplers?null:new L("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new L("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new L("webgl:required","WebGL2 is required but not supported.",new Error().stack)}function $a(i){return i&&"nodeType"in i}function Ca(i){return i&&typeof i.render=="function"}const Mi={component:"esri-component"};let de=class extends M{constructor(){super(...arguments),this.widget=null}destroy(){var e;this.node=null,(e=this.widget)==null||e.destroy()}get id(){var e,t;return this._get("id")??((e=this.widget)==null?void 0:e.id)??((t=this.node)==null?void 0:t.id)}set id(e){this._set("id",e)}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(Mi.component),t&&t.classList.remove(Mi.component),this._set("node",e))}castNode(e){var t;return(t=this.widget)==null||t.destroy(),e?typeof e=="string"||$a(e)?(this._set("widget",null),Ii(e)):(Ca(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};l([h()],de.prototype,"id",null),l([h()],de.prototype,"node",null),l([Ai("node")],de.prototype,"castNode",null),l([h({readOnly:!0})],de.prototype,"widget",void 0),de=l([w("esri.views.ui.Component")],de);const Ge=de,Sa={left:0,top:0,bottom:0,right:0},rn={bottom:30,top:15,right:15,left:15},G="esri-ui",$={ui:G,corner:`${G}-corner`,innerContainer:`${G}-inner-container`,manualContainer:`${G}-manual-container`,cornerContainer:`${G}-corner-container`,topLeft:`${G}-top-left`,topRight:`${G}-top-right`,bottomLeft:`${G}-bottom-left`,bottomRight:`${G}-bottom-right`};function Ea(i){return i&&!i._started&&typeof i.postMixInProperties=="function"&&typeof i.buildRendering=="function"&&typeof i.postCreate=="function"&&typeof i.startup=="function"}function qe(i){return i===0?"0":`${i}px`}function wt(i){const e=typeof i=="object"&&i!==null&&Object.getPrototypeOf(i);return(e===null||e===Object.prototype)&&("component"in i||"index"in i||"position"in i)?i:null}function bt(i,{top:e,bottom:t,left:n,right:o}){i.style.top=e,i.style.bottom=t,i.style.left=n,i.style.right=o}let Z=class extends At.EventedAccessor{constructor(i){super(i),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=ro(),this.view=null,this._applyViewPadding=()=>{const e=this.container;e&&bt(e,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const e=this._innerContainer;e&&bt(e,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([b(()=>{var i;return[(i=this.view)==null?void 0:i.padding,this.container]},this._applyViewPadding,j),b(()=>this.padding,this._applyUIPadding,j),b(()=>[this.container,this._locale],([i,e])=>{i&&i.setAttribute("lang",e)},j),lo(i=>{this._locale=i})])}destroy(){this.container=null;for(const i of this._components)i.destroy();this._components.length=0,this._componentMap.clear()}set container(i){const e=this._get("container");i!==e&&(i&&(i.classList.add($.ui),ao(i),this._attachContainers(i)),e&&(e.classList.remove($.ui),bt(e,{top:"",bottom:"",left:"",right:""}),e.textContent=""),this._set("container",i))}get height(){var o;const i=((o=this.view)==null?void 0:o.height)??0;if(i===0)return i;const e=this._getViewPadding(),{top:t,bottom:n}=e;return Math.max(i-t-n,0)}get padding(){return this._get("padding")}set padding(i){this._overrideIfSome("padding",i)}castPadding(i){return typeof i=="number"?{bottom:i,top:i,right:i,left:i}:{...rn,...i}}get width(){var o;const i=((o=this.view)==null?void 0:o.width)??0;if(i===0)return i;const e=this._getViewPadding(),{left:t,right:n}=e;return Math.max(i-t-n,0)}add(i,e){let t,n,o;if(Array.isArray(i))return void i.forEach(a=>this.add(a,e));const s=wt(i);s&&({index:t,position:e,component:i,key:n}=s),e&&typeof e=="object"&&({index:t,key:n,position:e,internal:o}=e),!i||e&&!this._isValidPosition(e)||this._add(i,e,t,n,o)}remove(i,e){var n,o;if(!i)return;if(Array.isArray(i))return i.map(s=>this.remove(s,e));const t=this._find(i);if(t){if(this._componentMap.has(t)&&((n=this._componentMap.get(t))==null?void 0:n.key)!==e)return;const s=this._components.indexOf(t),a=t.node.parentNode;return a==null||a.removeChild(t.node),this._componentMap.delete(t),(o=t.widget)==null||o.removeHandlesReference(this._removeWidgetHandleKey),this._components.splice(s,1)[0]}}empty(i,e={removeInternal:!1}){if(Array.isArray(i)){for(const o of i)this.empty(o,e);return}const t=this._positionNameToContainerLookup[i??"manual"],n=Array.prototype.slice.call(t.children).map(o=>this._findByNode(o)).filter(o=>{var s;return o==null?!1:!(((s=this._componentMap.get(o))==null?void 0:s.internal)??!1)||e.removeInternal});for(const o of n)this.remove(o)}move(i,e){if(Array.isArray(i)&&i.forEach(s=>this.move(s,e)),!i)return;let t;const n=wt(i)||wt(e);if(n&&(t=n.index,e=n.position,i=n.component||i),e&&!this._isValidPosition(e))return;const o=this.remove(i);o&&this.add(o,{position:e,index:t})}find(i){if(!i)return null;const e=this._findById(i);return e&&(e.widget||e.node)}getComponents(i,e={includeInternal:!1}){return i?Array.isArray(i)?i.flatMap(t=>this._getComponentsAtPosition(t,e)):this._getComponentsAtPosition(i,e):this._components.filter(t=>{var n;return e.includeInternal||!((n=this._componentMap.get(t))!=null&&n.internal)}).map(({widget:t,node:n})=>t??n)}getPosition(i){for(const e in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[e].contains(i))return e;return null}_add(i,e,t,n,o){i instanceof Ge||(i=new Ge({node:i}));const{widget:s}=i;s!=null&&s instanceof M&&s.addHandles(nt(()=>{queueMicrotask(()=>this.remove(i))}),this._removeWidgetHandleKey),this._place({component:i,position:e,index:t}),this._components.push(i),this._componentMap.set(i,{key:n,internal:o})}_find(i){return i?i instanceof Ge?this._findByComponent(i):typeof i=="string"?this._findById(i):this._findByNode(i.domNode||i):null}_getViewPadding(){var i;return((i=this.view)==null?void 0:i.padding)??Sa}_attachContainers(i){i.appendChild(this._innerContainer),i.appendChild(this._manualContainer)}_initContainers(){const i=document.createElement("div");i.classList.add($.innerContainer,$.cornerContainer);const e=document.createElement("div");e.classList.add($.innerContainer,$.manualContainer);const t=document.createElement("div");t.classList.add($.topLeft,$.corner),i.appendChild(t);const n=document.createElement("div");n.classList.add($.topRight,$.corner),i.appendChild(n);const o=document.createElement("div");o.classList.add($.bottomLeft,$.corner),i.appendChild(o);const s=document.createElement("div");s.classList.add($.bottomRight,$.corner),i.appendChild(s),this._innerContainer=i,this._manualContainer=e;const a=Tn();this._cornerNameToContainerLookup={"top-left":t,"top-right":n,"bottom-left":o,"bottom-right":s,"top-leading":a?n:t,"top-trailing":a?t:n,"bottom-leading":a?s:o,"bottom-trailing":a?o:s},this._positionNameToContainerLookup={manual:e,...this._cornerNameToContainerLookup}}_isValidPosition(i){return!!this._positionNameToContainerLookup[i]}_place(i){var c,d;const e=i.position??"manual",{component:t,index:n}=i,o=this._positionNameToContainerLookup[e],s=n!=null&&n>-1;if(Ea(t.widget)&&t.widget.startup(),!s)return void o.appendChild(t.node);const a=Array.from(o.children);if(n===0){const{firstChild:p}=o;return void(p?(c=p.parentNode)==null?void 0:c.insertBefore(t.node,p):o.appendChild(t.node))}if(n>=a.length)return void o.appendChild(t.node);const r=a[n];(d=r.parentNode)==null||d.insertBefore(t.node,r)}_toPixelPosition(i){return{top:qe(i.top),left:qe(i.left),right:qe(i.right),bottom:qe(i.bottom)}}_findByComponent(i){return this._components.find(e=>e===i)??null}_findById(i){return this._components.find(({id:e})=>e===i)??null}_findByNode(i){return this._components.find(({node:e})=>e===i)??null}_getComponentsAtPosition(i,e){const t=this._positionNameToContainerLookup[i];return Array.prototype.slice.call(t.children).map(n=>this._findByNode(n)).filter(Di).filter(n=>{var o;return e.includeInternal||!((o=this._componentMap.get(n))!=null&&o.internal)}).map(({widget:n,node:o})=>n??o)}};l([h()],Z.prototype,"_locale",void 0),l([h()],Z.prototype,"container",null),l([h()],Z.prototype,"height",null),l([h({value:rn})],Z.prototype,"padding",null),l([Ai("padding")],Z.prototype,"castPadding",null),l([h()],Z.prototype,"view",void 0),l([h()],Z.prototype,"width",null),Z=l([w("esri.views.ui.UI")],Z);const Da=Z;let Ke,Ye=null;const ke=new Map;async function Zl(i){Ye==null&&(Ke==null&&(Ke=ue(()=>import("./Lyr3DWasmPerSceneView-2oqLS8fr.js"),__vite__mapDeps([214,1,20,3,13,14,2,4,5,6,7,8,9,215,216,160,161,15,16,17,18,19,217,218,25,26,27,152,128,219]),import.meta.url)),Ye=await Ke);const e=i.view;let t=ke.get(e);t||(t=new Ye.default({view:e}),ke.set(e,t));const n=!!e._stage.renderView.renderingContext.capabilities.compressedTextureS3TC;return await t.initializeWasm(n),t.add3DTilesLayerView(i)}function Ia(i){return ke.get(i)}function ql(i){const e=i.view,t=ke.get(e);t&&t.remove3DTilesLayerView(i)<1&&(ke.delete(e),ke.size===0&&(Ke=null,Ye=null))}function xi(i,e){return i&&"copyright"in i&&(!e||typeof i.originOf=="function"&&i.originOf("copyright")==="user")}function La(i,e){return i.length!==e.length||i.some((t,n)=>t.text!==e[n].text)}function Ee(i,e,t){!t||!e||i.find(n=>n.layerView===e&&n.text===t)||i.push({text:t,layerView:e})}function Va(i){return i.type==="bing-maps"}const K=[];let Me=class extends M{constructor(i){super(i),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new x,this.view=null,this._allLayerViewsChange=e=>{var n;this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const t=(n=this.view)==null?void 0:n.allLayerViews;t&&(this.addHandles(t.map(o=>b(()=>{var s;return[o.suspended,(s=o.layer)==null?void 0:s.attributionVisible]},()=>this._updateAttributionItems())).toArray(),"suspension"),t.forEach(o=>{o.declaredClass==="esri.views.3d.layers.Tiles3DLayerView3D"&&this.addHandles(o.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),e!=null&&e.removed&&e.removed.forEach(o=>{this._pendingAttributions.delete(o),this._fetchedAttributionData.delete(o)}),this._updateAttributionItems()},this.addHandles([it(()=>{var e;return(e=this.view)==null?void 0:e.allLayerViews},"change",e=>this._allLayerViewsChange(e),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Ei(()=>{var e;return((e=this.view)==null?void 0:e.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){var i;return(i=this.view)!=null&&i.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const i=this.view,e=i==null?void 0:i.allLayerViews;if(K.length=0,!i||!e)return void this._clear();e.forEach(n=>{var a,r;if(n.suspended||!((a=n.layer)!=null&&a.attributionVisible))return;const o=n.layer;if(xi(o,"user"))return void Ee(K,n,o.copyright);if(o.hasAttributionData){if(this._fetchedAttributionData.has(n)){const c=this._fetchedAttributionData.get(n);return void(c?Ee(K,n,this._getDynamicAttribution(c,i,o)):xi(o)&&Ee(K,n,o.copyright))}return void this._fetchAttributionData(n)}const s="portalItem"in o?(r=o.portalItem)==null?void 0:r.accessInformation:void 0;Ee(K,n,s||o.copyright)});const t=e.find(n=>{var o;return((o=n.layer)==null?void 0:o.type)==="integrated-mesh-3dtiles"});if(this.view&&t){const n=Ia(this.view);if(n){const o=n.getAttributionText();for(let s=0;s<o.length;++s)Ee(K,t,o[s])}}La(this.items,K)&&(this.items.removeAll(),this.items.addMany(K)),K.length=0,this.notifyChange("state")}async _fetchAttributionData(i){if(this._pendingAttributions.has(i))return;this._pendingAttributions.add(i);const e=await Pn(i.layer.fetchAttributionData());if(this._pendingAttributions.has(i)){const t=e.ok?this._createContributionIndex(e.value,Va(i.layer)):null;this._pendingAttributions.delete(i),this._fetchedAttributionData.set(i,t)}this._updateAttributionItems()}_createContributionIndex(i,e){const t=i.contributors,n={};if(!t)return n;for(let o=0;o<t.length;o++){const s=t[o],a=s.coverageAreas;if(!a)return;for(const r of a){const c=r.bbox,d=r.zoomMin-(e&&r.zoomMin?1:0),p=r.zoomMax-(e&&r.zoomMax?1:0),m=new Ri({xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:Tt.WGS84}),u={extent:Rn(m),attribution:s.attribution||"",score:r.score!=null?r.score:100,id:o};for(let f=d;f<=p;f++)n[f]??(n[f]=[]),n[f].push(u)}}return n.maxKey=Math.max.apply(null,Object.keys(n)),n}_getDynamicAttribution(i,e,t){var d;const{extent:n,scale:o}=e;let s=((d=t.tileInfo)==null?void 0:d.scaleToZoom(o))??0;if(s=Math.min(i.maxKey??0,Math.round(s)),!n||s==null||s<=-1)return"";const a=i[s],r=An(n.center.clone().normalize(),Tt.WebMercator),c=new Set;return a?a.filter(p=>{const m=p.id,u=!c.has(m)&&r&&p.extent&&In(p.extent,r);return u&&c.add(m),u}).sort((p,m)=>m.score-p.score||p.objectId-m.objectId).map(p=>p.attribution).join(", "):""}};l([h({readOnly:!0,type:x})],Me.prototype,"items",void 0),l([h({readOnly:!0})],Me.prototype,"state",null),l([h()],Me.prototype,"view",void 0),Me=l([w("esri.widgets.Attribution.AttributionViewModel")],Me);const ln=Me,ve="esri-attribution",we={base:ve,poweredBy:`${ve}__powered-by`,sources:`${ve}__sources`,open:`${ve}--open`,sourcesOpen:`${ve}__sources--open`,link:`${ve}__link`};let P=class extends Lt{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(n=>n.forEach(({target:o})=>this._checkSourceTextOverflow(o))),this.itemDelimiter=" | ",this.messages=null,this.viewModel=new ln}initialize(){this.addHandles(it(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.includes(t.text)||e.push(t.text),e),[]).join(this.itemDelimiter)}get icon(){return"description"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[we.open]:this._isOpen};return z("div",{bind:this,class:this.classes(we.base,pe.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return z("div",{class:we.poweredBy},"Powered by"," ",z("a",{class:we.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,n=t?0:void 0,{attributionText:o}=this,s={[we.sourcesOpen]:e,[pe.interactive]:t};return z("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(we.sources,s),innerHTML:o,tabIndex:n})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:n,clientWidth:o,scrollWidth:s}=e,a=s>o,r=this._attributionTextOverflowed!==a;if(this._attributionTextOverflowed=a,r&&(t=!0),this._isOpen){const c=n<this._prevSourceNodeHeight;this._prevSourceNodeHeight=n,c&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};l([h()],P.prototype,"_isOpen",void 0),l([h()],P.prototype,"_isInteractive",null),l([h()],P.prototype,"_attributionTextOverflowed",void 0),l([h()],P.prototype,"_prevSourceNodeHeight",void 0),l([h({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],P.prototype,"attributionText",null),l([h()],P.prototype,"icon",null),l([h()],P.prototype,"itemDelimiter",void 0),l([h()],P.prototype,"label",null),l([h(),It("esri/widgets/Attribution/t9n/Attribution")],P.prototype,"messages",void 0),l([h()],P.prototype,"view",null),l([h({type:ln})],P.prototype,"viewModel",void 0),l([ho()],P.prototype,"_toggleState",null),P=l([w("esri.widgets.Attribution")],P);const Ra=P,ki="esri-compass",Ti={base:ki,iconContainer:`${ki}__icon-container`};let J=class extends Lt{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new Fi,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=n=>({transform:`rotateZ(${n.z}deg)`})}loadDependencies(){return Li({button:()=>ue(()=>import("./calcite-button-D_Agetwz.js"),__vite__mapDeps([220,221,33,1,15,16,17,3,18,19,2,20,13,14,7,34,4,5,6,8,9,35,26,222,223,224,225,226,227,228,229,230,231,232,233]),import.meta.url),icon:()=>ue(()=>import("./calcite-icon-Cu0W9dtm.js"),__vite__mapDeps([234,232,33,1,15,16,17,3,18,19,2,20,13,14,7,34,4,5,6,8,9,35,26,223,230]),import.meta.url)})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return this.viewModel.state==="rotation"?"arrow-up":"compass-needle"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,{messages:n}=this;return z("div",{class:this.classes(Ti.base,pe.widget)},z("calcite-button",{class:pe.widgetButton,disabled:t==="disabled",kind:"neutral",label:n.reset,onclick:this._reset,round:!0,scale:"s",title:n.reset},z("div",{"aria-hidden":"true",class:Ti.iconContainer,title:n.reset},z("calcite-icon",{icon:this.icon,styles:this._toRotationTransform(e)}))))}};l([h()],J.prototype,"goToOverride",null),l([h()],J.prototype,"icon",null),l([h()],J.prototype,"label",null),l([h(),It("esri/widgets/Compass/t9n/Compass")],J.prototype,"messages",void 0),l([h()],J.prototype,"view",null),l([h({type:Fi})],J.prototype,"viewModel",void 0),J=l([w("esri.widgets.Compass")],J);const Aa=J,Pi={base:"esri-zoom",horizontalLayout:"esri-zoom--horizontal"};let X=class extends Lt{constructor(i,e){super(i,e),this.messages=null,this.viewModel=new Oi,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return Li({button:()=>ue(()=>import("./calcite-button-D_Agetwz.js"),__vite__mapDeps([220,221,33,1,15,16,17,3,18,19,2,20,13,14,7,34,4,5,6,8,9,35,26,222,223,224,225,226,227,228,229,230,231,232,233]),import.meta.url)})}get icon(){return"magnifying-glass-plus"}set icon(i){this._overrideIfSome("icon",i)}get label(){var i;return((i=this.messages)==null?void 0:i.widgetLabel)??""}set label(i){this._overrideIfSome("label",i)}set layout(i){i!=="horizontal"&&(i="vertical"),this._set("layout",i)}set view(i){this.viewModel.view=i}get view(){return this.viewModel.view}render(){const i={[Pi.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:e,canZoomOut:t}=this.viewModel,{zoomIn:n,zoomOut:o}=this.messages;return z("div",{class:this.classes(Pi.base,pe.widget,i)},z("calcite-button",{class:pe.widgetButton,disabled:!e,iconStart:"plus",kind:"neutral",label:n,onclick:this.zoomIn,title:n}),z("calcite-button",{class:pe.widgetButton,disabled:!t,iconStart:"minus",kind:"neutral",label:o,onclick:this.zoomOut,title:o}))}};l([h()],X.prototype,"icon",null),l([h()],X.prototype,"label",null),l([h({value:"vertical"})],X.prototype,"layout",null),l([h(),It("esri/widgets/Zoom/t9n/Zoom")],X.prototype,"messages",void 0),l([h()],X.prototype,"view",null),l([h({type:Oi})],X.prototype,"viewModel",void 0),X=l([w("esri.widgets.Zoom")],X);const Fa=X;function Oa(i){return(i==null?void 0:i.view)!==void 0}let Je=class extends Da{constructor(i){super(i),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=e=>{this.components.forEach(t=>{const n=this._find(t),o=n==null?void 0:n.widget;Oa(o)&&(o.view=e)})},this._componentsWatcher=(e,t)=>{this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}}initialize(){this.addHandles([b(()=>this.components,this._componentsWatcher,j),b(()=>this.view,this._updateViewAwareWidgets,j)])}_add(i,e,t,n,o){let s=i;if(typeof i=="string"&&this._defaultPositionLookup[i]){if(this._find(i))return;s=this._createComponent(i)}super._add(s,e,t,n,o)}_removeComponents(i){i.forEach(e=>{const t=this._find(e);t&&(this.remove(t),t.destroy())})}_adjustPadding(i){if(!i.includes("attribution")&&!this._isOverridden("padding")){const{top:e}=this.padding;this.padding=e}}_addComponents(i){this.constructed&&i.forEach(e=>this.add(this._createComponent(e),this._defaultPositionLookup[e]))}_createComponent(i){const e=this._createWidget(i);return new Ge({id:i,node:e})}_createWidget(i){const e=this.view;switch(i){case"attribution":return new Ra({view:e});case"compass":return new Aa({view:e});case"navigation-toggle":return new co({view:e});case"zoom":return new Fa({view:e})}}};l([h()],Je.prototype,"components",void 0),Je=l([w("esri.views.ui.DefaultUI")],Je);const Bl=Je;export{al as $,ma as A,da as B,pa as C,ga as D,Bl as E,Fr as F,Nr as G,zr as H,Hl as I,rs as J,hl as K,qt as L,vl as M,Ge as N,kl as O,fa as P,Qe as Q,Nl as R,is as a,dl as b,ll as c,fl as d,ts as e,_l as f,wl as g,Ml as h,Zl as i,xl as j,Pl as k,Ia as l,I as m,Dt as n,na as o,Fa as p,Il as q,ql as r,Tl as s,ns as t,Ve as u,Vl as v,Al as w,El as x,Cl as y,zl as z};
