const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./geometryEngineJSON-DeYwub9C.js","./geometryEngineBase-RmbNeFm7.js","./_commonjsHelpers-DCkdB7M8.js","./json-Wa8cmqdu.js"])))=>i.map(i=>d[i]);
import{_ as U}from"./index-CeCSsEgo.js";import{n as Y}from"./jsonMap-DCC6W5ex.js";import{af as k,al as H,G as M,ag as j,x as P,N as d,ah as X,y as Q,a5 as A}from"./Point-DB4Hp4hH.js";import{O as Z,N as ee,J as te}from"./projection-A9yUaaTs.js";import{A as ne}from"./Polyline-D97hl-6E.js";import{y as re,m as h,f as x,s as ie,p as se}from"./jsonUtils-Cma_7A64.js";import{R as oe}from"./normalizeUtils-Bi6Jza1f.js";import{O as ae,c as $}from"./subclass-BR3PhgZG.js";import{a as le,Z as ue,t as ce,r as me}from"./Extent-DHjqVB-p.js";import{I as fe,x as G,$ as pe,H as he,U as ye,a as v,h as Re,K as T}from"./featureConversionUtils-DdoZh_25.js";import{e as R}from"./OptimizedGeometry-vU5jWBvU.js";import{L as ge}from"./Accessor-D6mNnsWy.js";import{t as q}from"./json-Wa8cmqdu.js";const O=new R,Se=new R,I=new R,f={esriGeometryPoint:G,esriGeometryPolyline:pe,esriGeometryPolygon:he,esriGeometryMultipoint:ye};function Xe(e,t,n,r=e.hasZ,i=e.hasM){if(t==null)return null;const s=e.hasZ&&r,o=e.hasM&&i;if(n){const a=v(I,t,e.hasZ,e.hasM,"esriGeometryPoint",n,r,i);return G(a,s,o)}return G(t,s,o)}function S(e,t,n,r,i,s,o=t,a=n){var y,p,g;const l=t&&o,u=n&&a,c=r!=null?"coords"in r?r:r.geometry:null;if(c==null)return null;if(i){let m=Re(Se,c,t,n,e,i,o,a);return s&&(m=v(I,m,l,u,e,s)),((y=f[e])==null?void 0:y.call(f,m,l,u))??null}if(s){const m=v(I,c,t,n,e,s,o,a);return((p=f[e])==null?void 0:p.call(f,m,l,u))??null}return fe(O,c,t,n,o,a),((g=f[e])==null?void 0:g.call(f,O,l,u))??null}function Qe(e){return e&&z in e?JSON.parse(JSON.stringify(e,de)):e}const z="_geVersion",de=(e,t)=>e!==z?t:void 0,_=[0,0];function C(e,t){if(!t)return null;if("x"in t){const n={x:0,y:0};return[n.x,n.y]=e(t.x,t.y,_),t.z!=null&&(n.z=t.z),t.m!=null&&(n.m=t.m),n}if("xmin"in t){const n={xmin:0,ymin:0,xmax:0,ymax:0};return[n.xmin,n.ymin]=e(t.xmin,t.ymin,_),[n.xmax,n.ymax]=e(t.xmax,t.ymax,_),t.hasZ&&(n.zmin=t.zmin,n.zmax=t.zmax,n.hasZ=!0),t.hasM&&(n.mmin=t.mmin,n.mmax=t.mmax,n.hasM=!0),n}return"rings"in t?{rings:E(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:E(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:J(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:null}function E(e,t){const n=[];for(const r of e)n.push(J(r,t));return n}function J(e,t){const n=[];for(const r of e){const i=t(r[0],r[1],[0,0]);n.push(i),r.length>2&&i.push(r[2]),r.length>3&&i.push(r[3])}return n}async function b(e,t){if(!e||!t)return;const n=Array.isArray(e)?e.map(r=>r.geometry!=null?r.geometry.spatialReference:null).filter(ae):[e];await ee(n.map(r=>({source:r,dest:t})))}const V=C.bind(null,k),B=C.bind(null,H);function D(e,t,n,r){if(!e||(n||(n=t,t=e.spatialReference),!d(t)||!d(n)||M(t,n)))return e;if(j(t,n)){const i=P(n)?V(e):B(e);return i.spatialReference=n,i}return Z(q,[e],t,n,null,r)[0]}class xe{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(t,n,r,i){if(!(t!=null&&t.length)||!n||!r||M(n,r))return t;const s={geometries:t,inSpatialReference:n,outSpatialReference:r,geographicTransformation:i,resolve:ge()};return this._jobs.push(s),this._timer??(this._timer=setTimeout(this._process,10)),s.resolve.promise}_process(){this._timer=null;const t=this._jobs.shift();if(!t)return;const{geometries:n,inSpatialReference:r,outSpatialReference:i,resolve:s,geographicTransformation:o}=t;j(r,i)?P(i)?s(n.map(V)):s(n.map(B)):s(Z(q,n,r,i,o,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}}const $e=new xe;function et(e,t,n,r){return $e.push(e,t,n,r)}const _e=new Y({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),F=Object.freeze({});async function tt(e,t,n){const{outFields:r,orderByFields:i,groupByFieldsForStatistics:s,outStatistics:o}=e;if(r)for(let a=0;a<r.length;a++)r[a]=r[a].trim();if(i)for(let a=0;a<i.length;a++)i[a]=i[a].trim();if(s)for(let a=0;a<s.length;a++)s[a]=s[a].trim();if(o)for(let a=0;a<o.length;a++)o[a].onStatisticField&&(o[a].onStatisticField=o[a].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),we(e,t,n)}async function we(e,t,n){var s;if(!e)return null;let{where:r}=e;if(e.where=r=r==null?void 0:r.trim(),(!r||/^1 *= *1$/.test(r)||t&&t===r)&&(e.where=null),!e.geometry)return e;let i=await ve(e);if(e.distance=0,e.units=null,e.spatialRel==="esriSpatialRelEnvelopeIntersects"){const{spatialReference:o}=e.geometry;i=ne(i),i.spatialReference=o}if(i){await b(i.spatialReference,n),i=Ge(i,n);const o=(await oe(re(i)))[0];if(o==null)throw F;const a="quantizationParameters"in e&&((s=e.quantizationParameters)==null?void 0:s.tolerance)||"maxAllowableOffset"in e&&e.maxAllowableOffset||0,l=a&&L(i,n)?{densificationStep:8*a}:void 0,u=o.toJSON(),c=D(u,u.spatialReference,n,l);if(!c)throw F;c.spatialReference=n,e.geometry=c}return e}function L(e,t){if(!e)return!1;const n=e.spatialReference;return(h(e)||x(e)||ie(e))&&!M(n,t)&&!te(n,t)}function Ge(e,t){const n=e.spatialReference;return L(e,t)&&h(e)?{spatialReference:n,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}async function ve(e){const{distance:t,units:n}=e,r=e.geometry;if(t==null||"vertexAttributes"in r)return r;const i=r.spatialReference,s=n?_e.fromJSON(n):X(i),o=i&&(Q(i)||P(i))?r:await b(i,A).then(()=>D(r,A));return(await Ie())(o.spatialReference,o,t,s)}async function Ie(){return(await U(async()=>{const{geodesicBuffer:e}=await import("./geometryEngineJSON-DeYwub9C.js").then(t=>t.g);return{geodesicBuffer:e}},__vite__mapDeps([0,1,2,3]),import.meta.url)).geodesicBuffer}function Me(e){return e==="mesh"?le:ue(e)}function K(e,t){return e?t?4:3:t?3:2}function Pe(e,t,n,r){return W(e,t,n,r.coords[0],r.coords[1])}function be(e,t,n,r,i,s){const o=K(i,s),{coords:a,lengths:l}=r;if(!l)return!1;for(let u=0,c=0;u<l.length;u++,c+=o)if(!W(e,t,n,a[c],a[c+1]))return!1;return!0}function W(e,t,n,r,i){if(!e)return!1;const s=K(t,n),{coords:o,lengths:a}=e;let l=!1,u=0;for(const c of a)l=Ne(l,o,s,u,c,r,i),u+=c*s;return l}function Ne(e,t,n,r,i,s,o){let a=e,l=r;for(let u=r,c=r+i*n;u<c;u+=n){l=u+n,l===c&&(l=r);const y=t[u],p=t[u+1],g=t[l],m=t[l+1];(p<o&&m>=o||m<o&&p>=o)&&y+(o-p)/(m-p)*(g-y)<s&&(a=!a)}return a}const w="unsupported-query",Ae={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},N={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function Te(e){return e!=null&&N.spatialRelationship[e]===!0}function Oe(e){return e!=null&&N.queryGeometry[se(e)]===!0}function Ee(e){return e!=null&&N.layerGeometry[e]===!0}function Fe(){return U(()=>import("./geometryEngineJSON-DeYwub9C.js").then(e=>e.g),__vite__mapDeps([0,1,2,3]),import.meta.url)}function nt(e,t,n,r,i){if(x(t)&&n==="esriGeometryPoint"&&(e==="esriSpatialRelIntersects"||e==="esriSpatialRelContains")){const s=T(new R,t,!1,!1);return Promise.resolve(o=>Pe(s,!1,!1,o))}if(x(t)&&n==="esriGeometryMultipoint"){const s=T(new R,t,!1,!1);if(e==="esriSpatialRelContains")return Promise.resolve(o=>be(s,!1,!1,o,r,i))}if(h(t)&&n==="esriGeometryPoint"&&(e==="esriSpatialRelIntersects"||e==="esriSpatialRelContains"))return Promise.resolve(s=>ce(t,S(n,r,i,s)));if(h(t)&&n==="esriGeometryMultipoint"&&e==="esriSpatialRelContains")return Promise.resolve(s=>me(t,S(n,r,i,s)));if(h(t)&&e==="esriSpatialRelIntersects"){const s=Me(n);return Promise.resolve(o=>s(t,S(n,r,i,o)))}return Fe().then(s=>{const o=s[Ae[e]].bind(null,t.spatialReference,t);return a=>o(S(n,r,i,a))})}async function rt(e,t,n){var s;const{spatialRel:r,geometry:i}=e;if(i){if(!Te(r))throw new $(w,"Unsupported query spatial relationship",{query:e});if(d(i.spatialReference)&&d(n)){if(!Oe(i))throw new $(w,"Unsupported query geometry type",{query:e});if(!Ee(t))throw new $(w,"Unsupported layer geometry type",{query:e});if(e.outSR)return b((s=e.geometry)==null?void 0:s.spatialReference,e.outSR)}}}function it(e){if(h(e))return!0;if(x(e)){for(const t of e.rings)if(t.length!==5||t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1;return!0}return!1}async function st(e,t){if(!e)return null;const n=t.featureAdapter,{startTimeField:r,endTimeField:i}=e;let s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;if(r&&i)await t.forEach(a=>{const l=n.getAttribute(a,r),u=n.getAttribute(a,i);l==null||isNaN(l)||(s=Math.min(s,l)),u==null||isNaN(u)||(o=Math.max(o,u))});else{const a=r||i;await t.forEach(l=>{const u=n.getAttribute(l,a);u==null||isNaN(u)||(s=Math.min(s,u),o=Math.max(o,u))})}return{start:s,end:o}}function ot(e,t,n){var l;if(!t||!e)return null;const{startTimeField:r,endTimeField:i}=e;if(!r&&!i)return null;const{start:s,end:o}=t;if(s===null&&o===null)return null;if(s===void 0&&o===void 0)return Ze();const a=((l=n.getAttributeAsTimestamp)==null?void 0:l.bind(n))??n.getAttribute.bind(n);return r&&i?Ue(a,r,i,s,o):je(a,r||i,s,o)}function Ue(e,t,n,r,i){return r!=null&&i!=null?s=>{const o=e(s,t),a=e(s,n);return(o==null||o<=i)&&(a==null||a>=r)}:r!=null?s=>{const o=e(s,n);return o==null||o>=r}:i!=null?s=>{const o=e(s,t);return o==null||o<=i}:void 0}function je(e,t,n,r){return n!=null&&r!=null&&n===r?i=>e(i,t)===n:n!=null&&r!=null?i=>{const s=e(i,t);return s!=null&&s>=n&&s<=r}:n!=null?i=>{const s=e(i,t);return s!=null&&s>=n}:r!=null?i=>{const s=e(i,t);return s!=null&&s<=r}:void 0}function Ze(){return()=>!1}export{it as I,rt as P,tt as S,S as a,we as b,et as c,F as g,Qe as h,D as j,st as n,ot as t,nt as v,b as x,Xe as y};
