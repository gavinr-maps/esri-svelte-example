import{L as U,c as k,n as O,x as v,s as c,d as f,e as M,a as P}from"./index-tefRSezt.js";import{n as W}from"./ref-Ccn4I0kT.js";import{e as F}from"./getDefaultUnitForView-CuRQcAm0.js";import{d as G}from"./reactiveUtils-BR0C1Kq4.js";import{l as V}from"./intl-Do3GEEJ7.js";import{r as $,m as g,a as j,g as z}from"./Accessor-BHnuXKD2.js";import{c as y}from"./screenUtils-_ZIvrt5o.js";import{N as E,V as N,g as I,L as q,j as L,x as _,k as A}from"./Point-XGrwlf63.js";import{P as X}from"./Polyline-BmuD2-ZN.js";import{y as Y,R as H}from"./geodesicUtils-Bh_GX0Qj.js";import{M as J}from"./normalizeUtils-XRAPXbWa.js";import{e as K}from"./utils-BQBvadb7.js";import{s as Q}from"./useT9n-B0I3cNlQ.js";import{u as T}from"./useViewModel-BxErfUSG.js";import{e as B}from"./globalCss-CyPh17x2.js";import"./directive-helpers-C0aXnQdc.js";import"./Portal-CTRRujjZ.js";import"./cast-BA_-jlhc.js";import"./JSONSupport-CGdeqxpk.js";import"./Promise-CmQqe-ke.js";import"./writer-B2bQV2uU.js";import"./Extent-CBBGeHb-.js";import"./Evented-DCWccWGU.js";import"./SimpleObservable-7oieNGD8.js";import"./mathUtils-DV9iOXpW.js";import"./geodesicConstants-yASAK_zX.js";import"./normalizeUtilsCommon-D0zPTJCj.js";import"./jsonUtils-Cu7OBRmN.js";import"./utils-Cy8wFNQo.js";import"./utils-CkSELPnj.js";import"./index-BkKcLxWB.js";import"./component-utils-DWY0IMHC.js";function Z(e){return F(e)}function tt(e){return e>.5?{min:.5,max:1}:e>.2?{min:.2,max:.5}:{min:.1,max:.2}}function et(e,t){switch(t){case"metric":return e>1e3?{distance:_(e,"meters","kilometers"),unit:"kilometer"}:e>1?{distance:e,unit:"meter"}:e>.01?{distance:_(e,"meters","centimeters"),unit:"centimeter"}:{distance:_(e,"meters","millimeters"),unit:"millimeter"};case"imperial":return e>1609.344?{distance:_(e,"meters","miles"),unit:"mile"}:e>.3048?{distance:_(e,"meters","feet"),unit:"foot"}:{distance:_(e,"meters","inches"),unit:"inch"}}}function it(e){var s;const{isWebMercator:t,wkt:i,wkt2:a}=e;return t||(((s=a||i)==null?void 0:s.includes("WGS_1984_Web_Mercator"))??!1)}function x({state:{paddedViewState:e},spatialReference:t,width:i}){return t.isWrappable&&e.worldScreenWidth<i}function R(e,t){const{x:i,y:a}=e?A(t,!0):t;return[i,a]}let b=class extends z{constructor(e){super(e),this.scaleComputedFrom=y(),this.view=null}get state(){var e;return(e=this.view)!=null&&e.ready&&this.view.type==="2d"?K(this.view)&&!this.view.inGeographicLayout?"disabled":"ready":"disabled"}getScaleBarProperties(e,t){if(this.state==="disabled"||isNaN(e)||!t||!this.view)return null;const i=this._getDistanceInMeters();return i==null?null:this._getScaleBarProps(e,i,t)}_getDistanceInMeters(){const{state:e,spatialReference:t}=this.view;if(!E(t))return null;const{isGeographic:i}=t,a=it(t);if(!i&&!a)return e.extent.width*(N(t)??1);const[s,r]=this._getScaleMeasuringPoints(),u=a||i&&!Y(t)?I.WGS84:t,p=new X({paths:[[R(a,s),R(a,r)]],spatialReference:u}),l=J(p,10);let d;try{[d]=H([l],"meters")}catch{return null}return d}_getScaleMeasuringPoints(){const e=this.view,{width:t,height:i,position:a,spatialReference:s}=e;if(x(e)){const l=q(s),{valid:d}=l;return[new L(d[0],0,s),new L(d[1],0,s)]}let r=this.scaleComputedFrom.y-a[1];r>i?r=i:r<0&&(r=0);const u=y(0,r),p=y(t,r);return[e.toMap(u),e.toMap(p)]}_getScaleBarProps(e,t,i){const a=this.view,s=e*t/(x(a)?a.state.paddedViewState.worldScreenWidth:a.width);if(s<.001)return null;const r=et(s,i),{distance:u,unit:p}=r;let l=u,d=0;for(;l>=1;)l/=10,d++;const{min:h,max:m}=tt(l),S=m/l>=l/h?h:m;return{length:e*(S/l),value:10**d*S,unit:p}}};$([g()],b.prototype,"scaleComputedFrom",void 0),$([g({readOnly:!0})],b.prototype,"state",null),$([g()],b.prototype,"view",void 0),b=$([j("esri.widgets.ScaleBar.ScaleBarViewModel")],b);const rt=b;/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
v4.32.12 */function D(e=0,t=0){return{x:e,y:t}}const o="esri-scale-bar",n={base:o,labelContainer:`${o}__label-container`,rulerLabelContainer:`${o}__label-container--ruler`,lineLabelContainer:`${o}__label-container--line`,topLabelContainer:`${o}__label-container--top`,bottomLabelContainer:`${o}__label-container--bottom`,label:`${o}__label`,line:`${o}__line`,topLine:`${o}__line--top`,bottomLine:`${o}__line--bottom`,ruler:`${o}__ruler`,rulerBlock:`${o}__ruler-block`,barContainer:`${o}__bar-container`,rulerBarContainer:`${o}__bar-container--ruler`,lineBarContainer:`${o}__bar-container--line`},at=T(rt),w=class w extends U{constructor(){super(...arguments),this._defaultUnit="metric",this.messages=Q(),this._scaleComputedFrom=D(),this.viewModel=at(this),this.autoDestroyDisabled=!1,this.barStyle="line",this.icon="actual-size",this.position="top-left",this.arcgisReady=k()}get unit(){return this._unit??this._defaultUnit}set unit(t){this._unit=t}async destroy(){await this.manager.destroy()}updated(){this._handleRootCreateOrUpdate()}loaded(){this.manager.onLifecycle(()=>G(()=>{const t=this.viewModel.view;return{defaultUnit:t?Z(t):void 0,stationary:t==null?void 0:t.stationary,center:t==null?void 0:t.center,scale:t==null?void 0:t.scale,zoom:t==null?void 0:t.zoom}},({defaultUnit:t,stationary:i})=>{this._defaultUnit=t??"metric",i&&this.requestUpdate()}))}_handleContainerRef(t){t!==void 0&&this._handleRootCreateOrUpdate()}_handleRootCreateOrUpdate(){if(!this.viewModel)return;const t=this._scaleComputedFrom,i=this.el.getBoundingClientRect(),a=i.left+window.pageXOffset,s=i.top+window.pageYOffset,r=D(a,s);(r.x!==t.x||r.y!==t.y)&&(this._scaleComputedFrom=r)}_formatDistance(t,i){return V(t,{style:"unit",unit:i,unitDisplay:"short"})}render(){const t=this.viewModel.state==="disabled",i={[B.disabled]:t};let a,s;if(!t){const{unit:r,barStyle:u}=this,p=r==="imperial"||r==="dual",l=r==="metric"||r==="dual",d=100,h=r==="dual"?"line":u;if(p){const m=this.viewModel.getScaleBarProperties(d,"imperial");m&&(s=h==="ruler"?this._renderRuler(m):this._renderLine(m,"bottom"))}if(l){const m=this.viewModel.getScaleBarProperties(d,"metric");m&&(a=h==="ruler"?this._renderRuler(m):this._renderLine(m,"top"))}}return v`<div class=${c(f(n.base,B.widget,i))} ${W(this._handleContainerRef)}>${a}${s}</div>`}_renderRuler(t){const{length:i,unit:a,value:s}=t,r=Math.round(i),u=this._formatDistance(s,a);return v`<div class=${c(f(n.barContainer,n.rulerBarContainer))}><div class=${c(n.ruler)} style=${M({width:`${r}px`})}><div class=${c(n.rulerBlock)}></div><div class=${c(n.rulerBlock)}></div><div class=${c(n.rulerBlock)}></div><div class=${c(n.rulerBlock)}></div></div><div class=${c(f(n.labelContainer,n.rulerLabelContainer))}><div class=${c(n.label)}>0</div><div class=${c(n.label)}>${u}</div></div></div>`}_renderLine(t,i){const{length:a,unit:s,value:r}=t,u=Math.round(a),p=this._formatDistance(r,s),l={[n.topLabelContainer]:i==="top",[n.bottomLabelContainer]:i==="bottom"},d=v`<div class=${c(f(n.labelContainer,n.lineLabelContainer,l))}><div class=${c(n.label)}>${p}</div></div>`,h={[n.topLine]:i==="top",[n.bottomLine]:i==="bottom"},m=v`<div class=${c(f(n.line,h))} style=${M({width:`${u}px`})}></div>`;return v`<div class=${c(f(n.barContainer,n.lineBarContainer))}>${[m,d]}</div>`}};w.properties={autoDestroyDisabled:5,barStyle:1,icon:3,label:1,messageOverrides:0,position:3,referenceElement:1,unit:1},w.shadowRootOptions=O;let C=w;P("arcgis-scale-bar",C);export{C as ArcgisScaleBar};
