import{G as v,c as M}from"./Accessor-BmwT4B0c.js";import{r as S}from"./mathUtils-Cfq9PL9W.js";import{c as R}from"./screenUtils-_ZIvrt5o.js";import{O as m}from"./projection-CyCZAIaD.js";import{c as w}from"./meshVertexSpaceUtils-AgAbm20L.js";import{x as $,k as D}from"./hydratedFeatures-CNHxsqRS.js";import{p as x}from"./elevationInfoUtils-D26wVF2d.js";import{E as h}from"./EditGeometryOperations-CAMJU2Wn.js";function G(e,a){let n=null,t=null;return r=>{if(r.action==="cancel")return void(t!=null&&(t.execute({action:"cancel"}),n=null,t=null));const l={action:r.action,screenStart:r.start,screenEnd:r.screenPoint};r.action==="start"&&n==null&&(n=new f,t=new f,a(e,n,t,r.pointerType,l)),n!=null&&n.execute(l),r.action==="end"&&n!=null&&(n=null,t=null)}}function A(e,a){return e.events.on("drag",G(e,a))}function B(e,a){const n=[e.x,e.y,e.z??0],t=a,r=[Math.cos(t),Math.sin(t)],l=Math.sqrt(r[0]*r[0]+r[1]*r[1]);if(l===0)return null;r[0]/=l,r[1]/=l;const c=o=>{const u=(o.x-n[0])*r[0]+(o.y-n[1])*r[1];o.x=n[0]+u*r[0],o.y=n[1]+u*r[1]};return o=>(c(o.mapStart),c(o.mapEnd),{...o,axis:r})}function q(e){let a=null;return n=>{if(n.action==="start"&&(a=P(e,n.mapStart.spatialReference)),a==null)return null;const t=n.mapEnd.x-n.mapStart.x,r=n.mapEnd.y-n.mapStart.y,l=(n.mapEnd.z??0)-(n.mapStart.z??0);return a.move(t,r,l,n.action),{...n,translationX:t,translationY:r,translationZ:l}}}function z(e,a){return e==null?null:e.spatialReference.equals(a)?e.clone():m(e,a)}function P(e,a){const n=e.operations;if(!n)return null;const t=n.data.geometry,r=D(a);if(t.spatialReference.equals(r))return d(e,n,()=>{});if(t.type!=="mesh"){const l=z(t,r);if(l==null)return null;const c=t.spatialReference;return d(e,h.fromGeometry(l,n.viewingMode),()=>{const o=m(t,c);n.trySetGeometry(o)})}if(w(t)){const l=z(t.origin,r);if(!l)return null;const c=t.spatialReference,o=h.fromGeometry(l,n.viewingMode);return d(e,n,()=>{const u=m(o.data.geometry,c),s=u.x-t.origin.x,i=u.y-t.origin.y,p=(u.z??0)-(t.origin.z??0);n.move(s,i,p)})}return null}function d(e,a,n){let t=0,r=0,l=0;return{move:(c,o,u,s)=>{var y;s==="start"&&(t=0,r=0,l=0);const i=c-t,p=o-r,E=u-l;a.move(i,p,E),t+=i,r+=p,l+=E,n(),s==="end"&&((y=e.endInteraction)==null||y.call(e))}}}function C(e,a=null,n){var c;let t=null;const r=a==null||(c=e.spatialReference)!=null&&c.equals(a)?o=>o:o=>o!=null?m(o,a):o,l={exclude:[],...n};return o=>{if(o.action==="start"&&(t=r(e.toMap(o.screenStart,l))),t==null)return null;const u=r(e.toMap(o.screenEnd,l));return u!=null?{...o,mapStart:t,mapEnd:u}:null}}function F(e){const a=e.map(n=>q(n)).filter(v);return n=>{const t=n.mapEnd.x-n.mapStart.x,r=n.mapEnd.y-n.mapStart.y,l=n.mapEnd.z-n.mapStart.z;return a.forEach(c=>c(n)),{...n,translationX:t,translationY:r,translationZ:l}}}function H(e,a){const n=new Map;for(const t of a)n.set(t,M(e[t]));return t=>(n.forEach((r,l)=>{e[l]=r}),t)}function X(e){var n;const a=(n=e.operations)==null?void 0:n.createResetState();return t=>(a==null||a.remove(),t)}function J(e){const a=e.map(n=>X(n)).filter(n=>n!=null);return n=>(a.forEach(t=>t(n)),n)}function K(){let e=0,a=0,n=0;return t=>{t.action==="start"&&(e=t.mapStart.x,a=t.mapStart.y,n=t.mapStart.z);const r=t.mapEnd.x-e,l=t.mapEnd.y-a,c=t.mapEnd.z-n;return e=t.mapEnd.x,a=t.mapEnd.y,n=t.mapEnd.z,{...t,mapDeltaX:r,mapDeltaY:l,mapDeltaZ:c,mapDeltaSpatialReference:t.mapStart.spatialReference}}}function L(){let e=0,a=0;return n=>{n.action==="start"&&(e=n.screenStart.x,a=n.screenStart.y);const t=n.screenEnd.x-e,r=n.screenEnd.y-a;return e=n.screenEnd.x,a=n.screenEnd.y,{...n,screenDeltaX:t,screenDeltaY:r}}}function N(e,a){let n=null,t=0,r=0;return l=>{var s;if(l.action==="start"&&(n=(s=e.toScreen)==null?void 0:s.call(e,a),n!=null&&(n.x<0||n.x>e.width||n.y<0||n.y>e.height?n=null:(t=l.screenStart.x-n.x,r=l.screenStart.y-n.y))),n==null)return null;const c=S(l.screenEnd.x-t,0,e.width),o=S(l.screenEnd.y-r,0,e.height),u=R(c,o);return l.screenStart=n,l.screenEnd=u,l}}const Y=()=>{};class f{constructor(){this.execute=Y}next(a,n=new f){return a!=null&&(this.execute=t=>{const r=a(t);r!=null&&n.execute(r)}),n}}function Q(e,a,n=[]){if(e.type==="2d")return r=>r;let t=null;return r=>{r.action==="start"&&(t=e.toMap(r.screenStart,{exclude:n}),t!=null&&(t.z=x(t,e,a)));const l=e.toMap(r.screenEnd,{exclude:n});l!=null&&(l.z=x(l,e,a));const c=t!=null&&l!=null?{sceneStart:t,sceneEnd:l}:null;return{...r,scenePoints:c}}}function g(e,a,n){const t=a.elevationProvider.getElevation(e.x,e.y,e.z??0,e.spatialReference,"scene")??0,r=$(e);return r.z=t,r.hasZ=!0,r.z=x(r,a,n),r}function V(e,a){if(e.type==="2d")return t=>t;let n=null;return t=>{t.action==="start"&&(n=g(t.mapStart,e,a));const r=g(t.mapEnd,e,a),l=n!=null&&r!=null?{sceneStart:n,sceneEnd:r}:null;return{...t,scenePoints:l}}}export{Q as D,C as E,N as M,F as S,V as U,q as f,X as g,H as h,L as j,B as m,A as p,K as v,f as w,J as z};
