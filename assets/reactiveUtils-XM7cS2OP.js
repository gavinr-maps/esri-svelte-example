import{Z as j,g as G,i as K,a4 as N,l as O,V as Q,r as d,m as v,a as V,y as l,e as x,c as W,f as X,a8 as Y,b3 as $,L as ee,bb as te,H as k,a6 as R,t as se,bc as ie,bd as re,at as ne,j as S,aA as oe,T as ae}from"./Accessor-BmwT4B0c.js";import{i as he}from"./Evented-Dw4_VOGn.js";import{s as le}from"./SimpleObservable-CvOkykwM.js";function Ve(e,t,s){return j(e.map((i,r)=>t.apply(s,[i,r])))}async function xe(e,t,s){return(await j(e.map((i,r)=>t.apply(s,[i,r])))).map(i=>i.value)}function L(e){return{ok:!0,value:e}}function B(e){return{ok:!1,error:e}}function ce(e){return e!=null&&e.ok===!0?e.value:null}function ue(e){return e!=null&&e.ok===!1?e.error:null}async function Re(e){if(e==null)return{ok:!1,error:new Error("no promise provided")};try{return L(await e)}catch(t){return B(t)}}async function Le(e){try{return L(await e)}catch(t){return Q(t),B(t)}}function Be(e){if(e.ok===!0)return e.value;throw e.error}function fe(e,t){return new A(e,t)}let A=class extends G{get value(){return ce(this._result)}get error(){return ue(this._result)}get finished(){return this._result!=null}constructor(t,s){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=K(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:i}=this._abortController;this.promise=t(i),this.promise.then(r=>{this._result=L(r),this._cleanup()},r=>{this._result=B(r),this._cleanup()}),this._abortHandle=N(s,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=O(this._abortHandle),this._abortController=null}};d([v()],A.prototype,"value",null),d([v()],A.prototype,"error",null),d([v()],A.prototype,"finished",null),d([v()],A.prototype,"promise",void 0),d([v()],A.prototype,"_result",void 0),A=d([V("esri.core.asyncUtils.ReactiveTask")],A);var u;(function(e){e[e.ADD=1]="ADD",e[e.REMOVE=2]="REMOVE",e[e.MOVE=4]="MOVE"})(u||(u={}));function _e(e){return(t,s)=>{t[s]=e}}var b;class me{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(t){this.defaultPrevented=!1,this.item=t}}class de{constructor(t,s,i,r,o){this.target=t,this.added=s,this.removed=i,this.start=r,this.deleteCount=o}}const g=new Y(me,void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1});function q(e){e&&typeof e=="object"&&"destroy"in e&&typeof e.destroy=="function"&&e.destroy()}function M(e){return e?e instanceof p?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function w(e){if(e!=null&&e.length)return e[0]}function ge(e,t,s,i){const r=Math.min(e.length-s,t.length-i);let o=0;for(;o<r&&e[s+o]===t[i+o];)o++;return o}function T(e,t,s,i){t&&t.forEach((r,o,c)=>{e.push(r),T(e,s.call(i,r,o,c),s,i)})}const y=new Set,C=new Set,E=new Set,D=new Map;let pe=0,p=b=class extends he.EventedAccessor{static isCollection(e){return e!=null&&e instanceof b}constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new le,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:pe++})}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof b?{items:e}:e:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),this._emitter.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return l(this._observable),this._items}set items(e){this._emitBeforeChanges(u.ADD)||(this._splice(0,this.length,M(e)),this._emitAfterChanges(u.ADD))}hasEventListener(e){return!this.destroyed&&(e==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(e))}on(e,t){if(this.destroyed)return x();if(e==="change"){const s=this._chgListeners,i={removed:!1,callback:t};return s.push(i),this._notifications&&this._notifications.push({listeners:s.slice(),items:this._items.slice(),changes:[]}),x(()=>{i.removed=!0,s.splice(s.indexOf(i),1)})}return this._emitter.on(e,t)}once(e,t){const s="deref"in t?()=>t.deref():()=>t,i=this.on(e,r=>{var o;(o=s())==null||o.call(null,r),i.remove()});return i}add(e,t){if(l(this._observable),this._emitBeforeChanges(u.ADD))return this;const s=this.getNextIndex(t??null);return this._splice(s,0,[e]),this._emitAfterChanges(u.ADD),this}addMany(e,t=this._items.length){if(l(this._observable),!(e!=null&&e.length))return this;if(this._emitBeforeChanges(u.ADD))return this;const s=this.getNextIndex(t);return this._splice(s,0,M(e)),this._emitAfterChanges(u.ADD),this}at(e){if(l(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(l(this._observable),!this.length||this._emitBeforeChanges(u.REMOVE))return[];const e=this._removeAllRaw();return this._emitAfterChanges(u.REMOVE),e}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return l(this._observable),this._createNewInstance({items:this._items.map(W)})}concat(...e){l(this._observable);const t=e.map(M);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(l(this._observable),!this.length||this._emitBeforeChanges(u.REMOVE))return;const s=this._splice(0,this.length),i=s.length;for(let r=0;r<i;r++)e.call(t,s[r],r,s);this._emitAfterChanges(u.REMOVE)}destroyAll(){this.drain(q)}destroyMany(e){const t=this.removeMany(e);return t.forEach(q),t}every(e,t){return l(this._observable),this._items.every(e,t)}filter(e,t){l(this._observable);const s=arguments.length===2?this._items.filter(e,t):this._items.filter(e);return this._createNewInstance({items:s})}find(e,t){return l(this._observable),this._items.find(e,t)}findIndex(e,t){return l(this._observable),this._items.findIndex(e,t)}flatten(e,t){l(this._observable);const s=[];return T(s,this,e,t),new b(s)}forEach(e,t){return l(this._observable),this._items.forEach(e,t)}getItemAt(e){return l(this._observable),this._items[e]}getNextIndex(e){l(this._observable);const t=this.length;return(e=e??t)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return l(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return l(this._observable),this._items.indexOf(e,t)}join(e=","){return l(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return l(this._observable),this._items.lastIndexOf(e,t)}map(e,t){l(this._observable);const s=this._items.map(e,t);return new b({items:s})}reorder(e,t=this.length-1){l(this._observable);const s=this.indexOf(e);if(s!==-1){if(t<0?t=0:t>=this.length&&(t=this.length-1),s!==t){if(this._emitBeforeChanges(u.MOVE))return e;this._splice(s,1),this._splice(t,0,[e]),this._emitAfterChanges(u.MOVE)}return e}}pop(){if(l(this._observable),!this.length||this._emitBeforeChanges(u.REMOVE))return;const e=w(this._splice(this.length-1,1));return this._emitAfterChanges(u.REMOVE),e}push(...e){return l(this._observable),this._emitBeforeChanges(u.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(u.ADD)),this.length}reduce(e,t){l(this._observable);const s=this._items;return arguments.length===2?s.reduce(e,t):s.reduce(e)}reduceRight(e,t){l(this._observable);const s=this._items;return arguments.length===2?s.reduceRight(e,t):s.reduceRight(e)}remove(e){return l(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(l(this._observable),e<0||e>=this.length||this._emitBeforeChanges(u.REMOVE))return;const t=w(this._splice(e,1));return this._emitAfterChanges(u.REMOVE),t}removeMany(e){if(l(this._observable),!(e!=null&&e.length)||this._emitBeforeChanges(u.REMOVE))return[];const t=e instanceof b?e.toArray():e,s=this._items,i=[],r=t.length;for(let o=0;o<r;o++){const c=t[o],n=s.indexOf(c);if(n>-1){const a=1+ge(t,s,o+1,n+1),f=this._splice(n,a);f&&f.length>0&&i.push.apply(i,f),o+=a-1}}return this._emitAfterChanges(u.REMOVE),i}reverse(){if(l(this._observable),this._emitBeforeChanges(u.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(u.MOVE),this}shift(){if(l(this._observable),!this.length||this._emitBeforeChanges(u.REMOVE))return;const e=w(this._splice(0,1));return this._emitAfterChanges(u.REMOVE),e}slice(e=0,t=this.length){return l(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return l(this._observable),this._items.some(e,t)}sort(e){if(l(this._observable),!this.length||this._emitBeforeChanges(u.MOVE)||!this._requiresSort(e))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(u.MOVE),this}_requiresSort(e=(t,s)=>t===s?0:t<s?-1:1){const t=this.length-1;for(let s=0;s<t;s++)if(e(this.items[s],this.items[s+1])>0)return!0;return!1}splice(e,t,...s){l(this._observable);const i=(t?u.REMOVE:0)|(s.length?u.ADD:0);if(this._emitBeforeChanges(i))return[];const r=this._splice(e,t,s)||[];return this._emitAfterChanges(i),r}toArray(){return l(this._observable),this._items.slice()}toJSON(){return l(this._observable),this.toArray()}toLocaleString(){return l(this._observable),this._items.toLocaleString()}toString(){return l(this._observable),this._items.toString()}unshift(...e){return l(this._observable),!e.length||this._emitBeforeChanges(u.ADD)||(this._splice(0,0,e),this._emitAfterChanges(u.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,s){const i=this._items,r=this.itemType;let o,c;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=X(()=>this._dispatchChange())),e<0&&(e+=this.length),t){if(c=i.splice(e,t),this.hasEventListener("before-remove")){const n=g.acquire();n.target=this,n.cancellable=!0;for(let a=0,f=c.length;a<f;a++)o=c[a],n.reset(o),this.emit("before-remove",n),n.defaultPrevented&&(c.splice(a,1),i.splice(e,0,o),e+=1,a-=1,f-=1);g.release(n)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const n=g.acquire();n.target=this,n.cancellable=!1;const a=c.length;for(let f=0;f<a;f++)n.reset(c[f]),this.emit("after-remove",n);g.release(n)}}if(s!=null&&s.length){if(r){const h=[];for(const _ of s){const m=r.ensureType(_);m==null&&_!=null||h.push(m)}s=h}const n=this.hasEventListener("before-add"),a=this.hasEventListener("after-add"),f=e===this.length;if(n||a){const h=g.acquire();h.target=this,h.cancellable=!0;const _=g.acquire();_.target=this,_.cancellable=!1;for(const m of s)n?(h.reset(m),this.emit("before-add",h),h.defaultPrevented||(f?i.push(m):i.splice(e++,0,m),this._set("length",i.length),a&&(_.reset(m),this.emit("after-add",_)))):(f?i.push(m):i.splice(e++,0,m),this._set("length",i.length),_.reset(m),this.emit("after-add",_));g.release(_),g.release(h)}else{if(f)for(const h of s)i.push(h);else i.splice(e,0,...s);this._set("length",i.length)}}if((s!=null&&s.length||c!=null&&c.length)&&this._notifyChangeEvent(s,c),this.hasEventListener("after-splice")){const n=new de(this,s,c,e,t);this.emit("after-splice",n)}return c}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const s=g.acquire();s.target=this,s.cancellable=!0,s.type=e,this.emit("before-changes",s),t=s.defaultPrevented,g.release(s)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=g.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),g.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const s=t.changes;y.clear(),C.clear(),E.clear();for(const{added:a,removed:f}of s){if(a)if(E.size===0&&C.size===0)for(const h of a)y.add(h);else for(const h of a)C.has(h)?(E.add(h),C.delete(h)):E.has(h)||y.add(h);if(f)if(E.size===0&&y.size===0)for(const h of f)C.add(h);else for(const h of f)y.has(h)?y.delete(h):(E.delete(h),C.add(h))}const i=$.acquire();y.forEach(a=>{i.push(a)});const r=$.acquire();C.forEach(a=>{r.push(a)});const o=this._items,c=t.items,n=$.acquire();if(E.forEach(a=>{c.indexOf(a)!==o.indexOf(a)&&n.push(a)}),t.listeners&&(i.length||r.length||n.length)){const a={target:this,added:i,removed:r,moved:n},f=t.listeners.length;for(let h=0;h<f;h++){const _=t.listeners[h];_.removed||_.callback.call(this,a)}}$.release(i),$.release(r),$.release(n)}y.clear(),C.clear(),E.clear()}};p.ofType=e=>{if(!e)return b;if(D.has(e))return D.get(e);let t=null;if(typeof e=="function")t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const i in e.typeMap){const r=e.typeMap[i].prototype.declaredClass;t?t+=` | ${r}`:t=r}let s=class extends b{};return d([_e({Type:e,ensureType:typeof e=="function"?ee(e):te(e)})],s.prototype,"itemType",void 0),s=d([V(`esri.core.Collection<${t}>`)],s),D.set(e,s),s},d([v()],p.prototype,"_updating",void 0),d([v()],p.prototype,"length",void 0),d([v()],p.prototype,"items",null),d([v({readOnly:!0})],p.prototype,"updating",null),p=b=d([V("esri.core.Collection")],p);const z=p;function I(e,t,s={}){return P(e,t,s,J)}function be(e,t,s={}){return P(e,t,s,Z)}function P(e,t,s={},i){let r=null;const o=s.once?(c,n)=>{i(c)&&(O(r),t(c,n))}:(c,n)=>{i(c)&&t(c,n)};if(r=ie(e,o,s.sync,s.equals),s.initial){const c=e();o(c,c)}return r}function H(e,t,s,i={}){let r=null,o=null,c=null;function n(){var h;r&&o&&(o.remove(),(h=i.onListenerRemove)==null||h.call(i,r),r=null,o=null)}function a(h){i.once&&i.once&&O(c),s(h)}const f=I(e,(h,_)=>{var m;n(),re(h)&&(r=h,o=ne(h,t,a),(m=i.onListenerAdd)==null||m.call(i,h))},{sync:i.sync,initial:!0});return c=x(()=>{f.remove(),n()}),c}function ve(e,t){return U(e,null,t)}function ye(e,t){return U(e,Z,t)}function U(e,t,s){if(k(s))return Promise.reject(R());const i=e();if(t!=null&&t(i))return Promise.resolve(i);let r=null;function o(){r=O(r)}return new Promise((c,n)=>{r=se([N(s,()=>{o(),n(R())}),P(e,a=>{o(),c(a)},{sync:!1,once:!0},t??J)])})}function J(e){return!0}function Z(e){return!!e}function Ce(e,t,s={}){let i=!1;const r=I(e,(o,c)=>{i||t(o,c)},s);return{remove(){r.remove()},pause(){i=!0},resume(){i=!1}}}function F(e,t){const s=new z,i=H(e,"after-splice",({added:r,start:o,deleteCount:c})=>{const n=s.splice(o,c);for(const a of n)a.remove();if(r!=null&&r.length){const a=r.map(t);s.addMany(a,o)}},{sync:!0,onListenerRemove:()=>s.drain(r=>r.remove()),onListenerAdd:r=>s.addMany(r.items.map(t))});return s.addHandles(i),s}function Ee(e,t){const s=new z,i=F(e,n=>fe(async a=>{const f=await t(n,a);if(k(a))throw f.remove(),R();return f})),r=()=>null,o=async n=>{const a=await n.promise,f=i.indexOf(n);f<0||s.splice(f,1,a)};s.addMany(i.items.map(r));for(const n of i)S(o(n));const c=i.on("after-splice",({added:n,start:a,deleteCount:f})=>{const h=s.splice(a,f);for(const _ of h)_==null||_.remove();if(n!=null&&n.length){s.addMany(n.map(r),a);for(const _ of n)S(o(_))}});return s.addHandles([oe(i),c]),s}const Ae={sync:!0},$e={initial:!0},Oe={sync:!0,initial:!0},Pe=Object.freeze(Object.defineProperty({__proto__:null,autorun:ae,initial:$e,mapCollection:F,mapCollectionAsync:Ee,on:H,once:ve,pausable:Ce,sync:Ae,syncAndInitial:Oe,watch:I,when:be,whenOnce:ye},Symbol.toStringTag,{value:"Module"}));export{Oe as A,Ae as C,u as E,$e as P,Ce as U,z as V,Re as _,fe as a,xe as b,Le as c,I as d,Ve as e,F as g,ve as j,_e as n,be as p,Pe as r,H as v,ye as w,Ee as x,Be as y};
