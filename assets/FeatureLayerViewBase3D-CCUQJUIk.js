const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Feature3DPipeline-3vGpKR3t.js","./Accessor-BHnuXKD2.js","./Promise-CmQqe-ke.js","./cast-BA_-jlhc.js","./index-tefRSezt.js","./index-Cx51aysm.css","./JSONSupport-CGdeqxpk.js","./reactiveUtils-BR0C1Kq4.js","./Evented-DCWccWGU.js","./SimpleObservable-7oieNGD8.js","./WorkerHandle-B2QLNs3X.js","./workers-D8Q3pEzK.js","./Queue-BOnccek2.js","./intl-Do3GEEJ7.js","./Extent-CBBGeHb-.js","./Point-XGrwlf63.js","./writer-B2bQV2uU.js","./FeatureSet-DpCN730g.js","./Graphic-CFXUQZlS.js","./Clonable-DvJsj5LF.js","./opacityUtils-CSd4XoR2.js","./enumeration-Cr5WIZs4.js","./Color-gncXBiLc.js","./colorUtils-Rxh2V3ai.js","./mathUtils-DV9iOXpW.js","./ActionToggle-__-l4AdQ.js","./Identifiable-BrT7zvUW.js","./jsonUtils-Cu7OBRmN.js","./Polyline-BmuD2-ZN.js","./typeUtils-BSg8Y507.js","./TextSymbol-BQ_NW9Xo.js","./screenUtils-_ZIvrt5o.js","./collectionUtils-CbaToa73.js","./Portal-CTRRujjZ.js","./vec3f64-BLpZdpfb.js","./aaBoundingBox-CeBivBRq.js","./Field-Cyk7Ur5d.js","./fieldType-L-VlbZqy.js","./FeaturePipelineRenderManager-Sg5Liknk.js","./vec4f64-o2zAXfmz.js","./ViewingMode-Dodu7ZZk.js","./DepthRange-C25RnOB3.js","./vec2-maR1OrZI.js","./common-DQOJ18NT.js","./vec2f64-Dy6m9Nrb.js","./Material-Ba8x5bbY.js","./VertexAttribute-Cq4MnHjR.js","./boundedPlane-Dyz2ub5d.js","./sphere-DQxj5tsv.js","./mat4-Fi6iAz29.js","./vec32-Dvg_eL9J.js","./vec42-YcqnINSP.js","./mat3-CR8GKnhD.js","./mat3f64-BBpwCtoL.js","./plane-4dpuo6-e.js","./mat4f64-Dk4dwAN8.js","./quatf64-CCm9z-pX.js","./mathUtils-B9R7G-2c.js","./lineSegment-C-CDF7QX.js","./NoParameters-t-PuNrgq.js","./basicInterfaces-CZwQPxTp.js","./glUtil-D0YUa0ow.js","./enums-D9v74xTE.js","./VertexElementDescriptor-BOD-G50G.js","./Matrix3PassUniform-Bhi2fM3C.js","./BindType-BBwFZqyN.js","./RenderPlugin-B2sz29jJ.js","./FloatArray-BCfeX8wo.js","./Texture-D-SqNa4i.js","./signal-DSa0yokC.js","./getDataTypeBytes-BTGR5GyG.js","./renderState-e7QeQoUO.js","./Indices-Db9lERgy.js","./InterleavedLayout-Dvj-Snan.js","./BufferView-_QDXRCew.js","./types-D0PSWh4d.js","./triangle-D_E6eTS3.js","./ShaderTechniqueConfiguration-YrUOztAU.js","./glsl-BH37Aalp.js","./lengthUtils-DjJgJFRg.js","./requestImageUtils-Brn0e8z8.js","./TextureFormat-1mYWTFa-.js","./DrawParameters-C0gywgJQ.js","./DefaultMaterial-B5sYRDQR.js","./NormalAttribute.glsl-BPQl43kJ.js","./SceneLighting-fZH2UQ_L.js","./GLTextureMaterial-BXvkeRxQ.js","./DefaultBufferWriter-D4XUxbP-.js","./verticalOffsetUtils-CUH6QZ7-.js","./orientedBoundingBox-9z4w3ZAL.js","./quat-4pa1e6ds.js","./spatialReferenceEllipsoidUtils-DM073JUd.js","./computeTranslationToOriginAndRotation-BT43Xu5d.js","./projectBuffer-DOU0xvVi.js","./geodesicConstants-yASAK_zX.js","./Attribute-B-NAci_J.js","./VertexColor.glsl-C67vI27I.js","./Matrix3DrawUniform-B_gSHO7v.js","./Matrix4PassUniform-LFIUaE9i.js","./doublePrecisionUtils-B0owpBza.js","./VerticalOffset.glsl-0YVQE7vQ.js","./Matrix4sPassUniform--uPzDbTP.js","./Float2PassUniform-Blij1ug3.js","./BooleanBindUniform-xvVHJCDz.js","./ShaderBuilder-DV1s2efh.js","./CameraSpace.glsl-BZ4Eapt3.js","./LodRenderer-DrfQ8MMz.js","./RenderCamera-BovI3JTe.js","./Octree-B-jwmuW2.js","./intersectorUtils-l6zkk4nF.js","./BufferObject-CIl3vJtA.js","./memoryEstimations-5gFNwkKK.js","./VertexArrayObject-DcVjXzZo.js","./sdfPrimitives-B8Jbwvqs.js","./floatRGBA-CR2j2c7-.js","./HighlightDefaults-ESbuT2uR.js","./Scheduler-B_GuBefw.js","./debugFlags-ZrDyTcDc.js","./RealisticTree.glsl-BIYA2y1x.js","./Intersector-DqUGp7Vs.js","./Intersector-DPK4WnQE.js","./HUDMaterial-DRUv4rua.js","./HUDVisibility.glsl-DSeZY4v-.js","./HUDRenderStyle-BhGvVxgm.js","./RgbaFloatEncoding.glsl-_io2eW3M.js","./Float4DrawUniform-C_Hqa-pI.js","./highlightUtils-BEMEvC9z.js","./LineCallout.glsl-BFpkOc4i.js","./visualVariableUtils-Bp9QCb8E.js","./ElevationContext-jcnAn7VT.js","./dehydratedFeatureUtils-1rrRm6hF.js","./ElevationProvider-aS5xrHHy.js","./unitConversionUtils-C4AR5obr.js","./hydratedFeatures-BVVSs98j.js","./projectVectorToVector-dS8io47t.js","./projectPointToVector-BS0u8fq6.js","./projection-B2I9Bzj_.js","./graphicUtils-Daa6cjYT.js","./meshVertexSpaceUtils-SW0WEjNN.js","./MeshLocalVertexSpace-C0YDTRex.js","./RibbonLine.glsl-D3IEIaDR.js","./vec2f32-BbH2jxlN.js","./projectBoundingRect-BA_jRNoI.js","./dehydratedFeatures-Nwhn-hep.js","./quantizationUtils-2Az-xHPA.js","./featureConversionUtils-DpmsPUmt.js","./OptimizedFeature-DcMLlxvB.js","./OptimizedGeometry-7IxBWtHr.js","./OptimizedFeatureSet-Blu9Ckm7.js","./edgeUtils-52Urp6s4.js","./webStyleAcceptedFormats-CG7ZQ6BV.js","./GeometryUtil-vHI0hYMT.js","./vec3f32-nZdmKIgz.js","./HeatmapDensity.glsl-BlR7SZ8i.js","./timeSupport-WJxqhq3S.js","./timeUtils-D2X862bk.js","./TimeExtent-J5qnUFx_.js","./utils-D02V2_jH.js","./Version-9k2AOv05.js","./Query-DCBIeen2.js","./FullTextSearch-BWm_kPUE.js","./projectExtentUtils-Hyl2OfuX.js","./geometryServiceUtils-CxRopEHH.js","./project-BoEABhcm.js","./utils-Cy8wFNQo.js","./utils-CkSELPnj.js","./UpdatingHandles-ptqz1ck8.js","./featureLayerUtils-BzWCGee1.js","./uuid-Cl5lrJ4c.js","./featureQueryAll-xezK3WCp.js","./layerUtils-dJgsXxkC.js","./SimpleRenderer-gSw1WaJS.js","./commonProperties-bGHL1a5M.js","./colorRamps-Dkx8zIVn.js","./SizeVariable-IzD1bP2e.js","./ColorStop-CDpeFWOz.js","./jsonUtils-Dzgxk9pw.js","./defaults-Dwxdhopq.js","./defaultsJSON-GKolV7NZ.js","./UniqueValueRenderer-Cri3tgP5.js","./diffUtils-CMkuJvD2.js","./RendererLegendOptions-mgfHoilI.js","./styleUtils-BB-zx7mT.js","./AttachmentQuery-BceVlzuF.js","./NormalizationBinParametersMixin-D6iHLB7I.js","./RelationshipQuery-W-4bfgaH.js","./ShadowCastAccumulate.glsl-7ziGQBCy.js","./Camera-DJtV7zYb.js","./Cyclical-CPiNl4ru.js","./Viewpoint-Cv8Otrne.js","./jsxFactory-CLjKarlq.js","./GraphicsCollection-CkliHSk1.js","./HeightModelInfo-B3GZyQFz.js","./RenderCoordsHelper-BbefYyBA.js","./projectVectorToPoint-d6Mr4zvQ.js","./scaleUtils-CfLu-sg1.js","./DefaultUI-DqLHkAzt.js","./InputManager-Bs9UE-jw.js","./Basemap-BHdJ6wQH.js","./loadAll-Do8S8AWH.js","./PortalItem-CXk7DqVv.js","./basemapDefinitions-BmB40s1J.js","./writeUtils-C3ZSK02Z.js","./groundInstanceUtils-Ben03ZCf.js","./CollectionFlattener-B9CFCLSp.js","./editableLayers-BZGjz8nI.js","./catalogUtils-CK4eMvD1.js","./basemapEnsureType-BVU7UGJp.js","./basemapUtils-DQr5T1wn.js","./utils-DYurMneM.js","./mat4f32-DcsiF_Rp.js","./TablesMixin-BzMj7HDl.js","./Layer-C9uQlTBT.js","./timeZoneUtils-COos5xIr.js","./ReactiveMap-Dwhwbx9R.js","./selectionUtils-DYi6daQO.js","./ViewEvents-Hl5AOQnu.js","./IViewEvents-Bci6PjlS.js","./interfaces-D6pIddIh.js","./screenUtils-DyhV4TAA.js","./a11yUtils-CSYUX1kC.js","./heightModelInfoUtils-CMg1cdju.js","./unitBezier-B1N-tmtC.js","./imageUtils-brik-GLm.js","./capabilities-DwlKKScG.js","./themeUtils-C3zvZbsE.js","./globalCss-CZa70j6i.js","./accessibleHandler-rIBXQ52V.js","./CompassViewModel-BAJa4WdS.js","./GoTo-BsXOAO95.js","./ZoomViewModel-BZXEbLSs.js","./NormalUtils.glsl-CV524hT5.js","./earcut-Lltz9D9k.js","./vec3-Bn81gjoR.js","./SnappingCandidate-O5eRSE6e.js","./triangulationUtils-ChyeOnqC.js","./deduplicate-8uOXlcvp.js","./OverlayCompositing.glsl-BbJKjUZQ.js","./GridLocalOriginFactory-BvhZ_UoU.js","./axisAngleDegrees-8Sw4vC28.js","./weather-DtiKeY2t.js","./NestedMap-GuqgquCN.js","./Normals-OOhKYumi.js","./fontUtils-D0SfAiSy.js","./cameraUtils-D51h-KGF.js","./earthUtils-5Ip67eD0.js","./spatialReferenceSupport-CJqi4Nvp.js","./ElevationSamplerData-ejt2NMnl.js","./terrainUtils-NB9gChf5.js","./TileInfo-CRfZy5zq.js","./TileKey-DZd6gJy7.js","./FramebufferObject-DHwDHMWe.js","./ShadowCastVisualizeTechniqueConfiguration-WdqoNZsk.js","./SunCalc-uwgdo0BB.js","./VirtualLighting-CTSkZQzH.js","./ray-D3Okb4cY.js","./RenderFeature-3I21ZjJq.js","./unitFormatUtils-Dbksq3U5.js","./ByteSizeUnit-BsxeN7wM.js","./quantityUtils-1LswOhxZ.js","./ZoomMomentumEstimator-Igei2Npb.js","./labelFormatUtils-B--9rEVY.js","./labelUtils-Dq8OkaT-.js","./elevationInfoUtils-RSZ4Logn.js","./hitTest-CblPROa1.js","./LayerConstants-B33OP6sh.js","./intersectorUtilsConversions-CZnn6t-z.js","./ElevationRange-BrgM1moX.js","./hitTestSelectUtils-UXJPjatw.js","./MemCache-CDoaVBHf.js","./DefaultLoadingContext-b8vwa5ZD.js","./wosrLoader-F8PxTYxV.js","./TileStrategy-DlGVvP4C.js","./TileKey-BtGhNUzq.js","./ScheduledQueueProcessor-DfrR8pp0.js","./RenderableTile-Ewnw5ULl.js","./config-MDUrh2eL.js","./StyleDefinition-DxJzQnGW.js","./enums-BJSSbDkD.js","./enums-BRzLM11V.js","./GeometryUtils-B5FJlfZD.js","./DefaultVertexAttributeLayouts-DMsCtEEh.js","./DisplayObject-S19ALweP.js","./resources-CcZcI9oR.js","./colorUtils-BAowQmkN.js","./vec33-KumQEj7U.js","./ShaderTechniqueRepository-CuJwDr2t.js","./Blit-D5AxBSxC.js","./testSVGPremultipliedAlpha-CpxLiQJP.js","./RenderingContext-BkhmhK8E.js","./ProgramCache-D9MJNX7j.js","./Program-DD6La1z3.js","./layerViewUtils-tkZ5z_iY.js","./makeScheduleFunction-CggzEh3c.js","./dehydratedFeatureComparison-Bbl7iMhI.js","./utils-9nq77ifz.js","./jsonUtils-TjZmCq6l.js","./cimSymbolUtils-azhJhO4Y.js","./utils-B91u8350.js","./defaultCIMValues-DII_GG3u.js","./LRUCache-DS2O1kTf.js","./queryForSymbologySnapping-cAQ-PBYV.js","./Graphics3DFeatureProcessor-DNb8x8ij.js","./hash-CcEbRgUF.js","./Graphics3DScaleVisibility-CBgqCNfE.js","./rendererConversion-BVZEj5DN.js","./optimizedFeatureQueryEngineAdapter-Dffp2J7r.js","./PooledRBush-BHbZLwLz.js","./quickselect-QQC62dOK.js","./popupUtils-Bp0XPfzq.js","./Graphics3DObjectStates-BvuBUaFM.js","./attributeUtils-Dc8--CBJ.js","./FeatureFilter-DEE1jTWq.js","./floorFilterUtils-DZ5C6FQv.js","./QueryEngine-BJMZSAnZ.js","./WhereClauseCache-CrfkeLux.js","./WhereClause-diW5rNp6.js","./TimeOnly-yGYcAQQJ.js","./timeSupport-Cvj97qZO.js","./queryUtils-DBeaQ3x_.js","./normalizeUtils-XRAPXbWa.js","./normalizeUtilsCommon-D0zPTJCj.js","./json-Wa8cmqdu.js","./QueryEngineCapabilities-DZTubngj.js","./utils-D8exU0T6.js","./heatmapUtils-DA7NmY3d.js","./utils-DLmnG8WZ.js","./utils-B8VMZhYy.js","./ClassBreaksDefinition-DvZJqFCP.js","./FixedIntervalBinParameters-uigAmvtd.js","./FieldsIndex-DFdVonga.js","./FeatureStore-CozDnyvc.js","./BoundsStore-Cf415lwW.js","./heatmapTextureUtils-nYqDzBiV.js","./LayerView3D-dAX18iJt.js","./query-BS_L6I0Q.js","./pbfQueryUtils-AwPAOS5M.js","./pbf-CFI-xDDp.js","./queryZScale-DwN6mTru.js","./EventedSet-CQy86voe.js","./FeatureLayerView-BrvP5TDa.js","./constants-B4mRqufT.js","./displayFilterUtils-DV_nOx_h.js","./FeatureEffect-xxsfLT-y.js","./networkFieldUtils-iOtCEyIS.js","./LayerView-DF8EqCYi.js","./RefreshableLayerView-Digmhts2.js"])))=>i.map(i=>d[i]);
import{_ as S}from"./index-tefRSezt.js";import{aR as N,r as i,m as a,a as g,g as M,bs as $,D as T,a6 as D,N as w,M as E,s as Q}from"./Accessor-BHnuXKD2.js";import{d as x,P as v,A as R,p as Z}from"./reactiveUtils-BR0C1Kq4.js";import{j as V,R as A}from"./dehydratedFeatures-Nwhn-hep.js";import{O as I,L as H,h as j}from"./HeatmapDensity.glsl-BlR7SZ8i.js";import{l as G}from"./LayerView3D-dAX18iJt.js";import{u as L}from"./hydratedFeatures-BVVSs98j.js";import{t as z}from"./LineCallout.glsl-BFpkOc4i.js";import{E as k,c as B}from"./query-BS_L6I0Q.js";import{h as J}from"./WorkerHandle-B2QLNs3X.js";import{g as O}from"./Point-XGrwlf63.js";import{y as Y}from"./Field-Cyk7Ur5d.js";import{r as U}from"./EventedSet-CQy86voe.js";import{C as m}from"./RibbonLine.glsl-D3IEIaDR.js";import{t as K}from"./ShadowCastAccumulate.glsl-7ziGQBCy.js";import{U as W}from"./FeatureLayerView-BrvP5TDa.js";import{y as X}from"./LayerView-DF8EqCYi.js";import{i as ee}from"./RefreshableLayerView-Digmhts2.js";let te=class extends z{constructor(e,r,s,n,u,o){super(e.usedMemory,e.displayedFeatures,e.totalFeatures,e.maximumFeatures,e.nodes,e.core),this.storedFeatures=r,this.totalVertices=s,this.partial=n,this.mode=u,this.symbolComplexity=o}};class re{constructor(e){this._controller=e,this._handle=new ie(r=>e.schedule(r))}destroy(){this._handle.destroy()}invoke(e,r){return e.buffer&&e.buffer.byteLength!==0?(e.options.sourceSpatialReference&&e.options.sourceSpatialReference instanceof O&&(e.options={...e.options,sourceSpatialReference:e.options.sourceSpatialReference.toJSON()}),this._handle.invoke(e,r).then(s=>{let n=0,u=0;const o=O.fromJSON(s.spatialReference);s.spatialReference=o;const l=async p=>{const d=s.fields;if(d){for(;n<d.length;)if(d[n]=Y.fromJSON(d[n]),n++,p.madeProgress())return this._controller.reschedule(F=>l(F))}const P=s.features;for(;u<P.length;){const F=P[u];++u,F.uid=N();const b=F.geometry;if(b!=null&&(b.spatialReference=o,se(b),p.madeProgress()))return this._controller.reschedule(q=>l(q))}return s};return this._controller.schedule(p=>l(p))})):Promise.resolve(null)}}function se(t){switch(t.type){case"polyline":t.paths=t.hasZ&&t.hasM?t.paths.map(e=>e.map(r=>[r[0],r[1],r[2],r[3]])):t.hasZ||t.hasM?t.paths.map(e=>e.map(r=>[r[0],r[1],r[2]])):t.paths.map(e=>e.map(r=>[r[0],r[1]]));break;case"polygon":t.rings=t.hasZ&&t.hasM?t.rings.map(e=>e.map(r=>[r[0],r[1],r[2],r[3]])):t.hasZ||t.hasM?t.rings.map(e=>e.map(r=>[r[0],r[1],r[2]])):t.rings.map(e=>e.map(r=>[r[0],r[1]]))}}class ie extends J{constructor(e){super("PBFDecoderWorker","_parseFeatureQuery",{_parseFeatureQuery:r=>[r.buffer]},e)}}let y=class extends M{constructor(t){super(t)}get implicitFields(){var s;if(!((s=this.layer.outFields)==null?void 0:s.includes("*")))return new Set;const e=new Set(this.layerView.requiredFields),r=new Set(this.layerView.availableFields);return $(r,e)}get queryFeaturesDehydrated(){var u;const{layer:t}=this,e=t.capabilities,r=e&&e.query,s=r&&r.supportsFormatPBF,n=t.parsedUrl;if(s){this._decoder==null&&(this._decoder=new re(this.controller));const o={sourceSpatialReference:((u=t.spatialReference)==null?void 0:u.toJSON())??null,applyTransform:!0,maxStringAttributeFields:this.implicitFields,maxStringAttributeLength:C};return(l,p)=>k(n,l,"pbf",this._createRequestOptions(p)).then(d=>(T(p),this._decoder!=null?this._decoder.invoke({buffer:d.data,options:o},p.signal):Promise.reject(D())))}return(o,l)=>B(n,o,t.spatialReference,this._createRequestOptions(l)).then(p=>V(p.data,{maxStringAttributeFields:this.implicitFields,maxStringAttributeLength:C}))}queryFeatureCount(t,e){return this.layer.queryFeatureCount(t,e)}destroy(){this._decoder=w(this._decoder)}_createRequestOptions(t){return{...t,query:{...this.layer.customParameters,token:this.layer.apiKey,...t==null?void 0:t.query}}}};i([a({constructOnly:!0})],y.prototype,"layer",void 0),i([a({constructOnly:!0})],y.prototype,"layerView",void 0),i([a({constructOnly:!0})],y.prototype,"controller",void 0),i([a({readOnly:!0})],y.prototype,"implicitFields",null),i([a({readOnly:!0})],y.prototype,"queryFeaturesDehydrated",null),y=i([g("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],y);let _=class extends M{constructor(t){super(t)}queryFeaturesDehydrated(t,e){return this.layer.queryFeatures(t,e)}};i([a({constructOnly:!0})],_.prototype,"layer",void 0),_=i([g("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileOGCServiceQuery3D")],_);let f=class extends M{constructor(t){super(t)}queryFeaturesDehydrated(t,e){return this.source.queryFeaturesJSON(t,e).then(V,r=>{if(r&&r.name==="query-features-json:unsupported")return this.layer.queryFeatures(t,e);throw r})}queryFeatureCount(t,e){return this.layer.queryFeatureCount(t,e)}};function oe(t,e){const{layer:r}=t;return r.type==="feature"&&r.source.type==="feature-layer"||r.type==="catalog-footprint"?new y({layer:r,layerView:t,controller:e}):r.type==="feature"&&r.source.type==="memory"||r.type==="csv"||r.type==="geojson"||r.type==="oriented-imagery"||r.type==="wfs"?new f({layer:r,source:r.source}):r.type==="ogc-feature"?new _({layer:r}):null}i([a({constructOnly:!0})],f.prototype,"layer",void 0),i([a({constructOnly:!0})],f.prototype,"source",void 0),f=i([g("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],f);const C=1024;class ae{constructor(e){this._memoryCache=null;const r=e.layerView.layer;this._layerView=e.layerView,this.objectIdField=r.objectIdField,this.globalIdField="globalIdField"in r?r.globalIdField:null,this._returnZ=e.returnZ,this._returnM=e.returnM;const s=this._layerView.view.resourceController;this.query=oe(this._layerView,s.normal),s&&this._memoryCacheEnabled&&(this._memoryCache=s.memoryController.newCache(`fl-${r.uid}`))}get _memoryCacheEnabled(){switch(this._layerView.layer.source.type){case"feature-layer":case"ogc-feature":case"oriented-imagery":return!0;case"csv":case"parquet":case"geojson":case"memory":case"wfs":return!1}}destroy(){this._memoryCache=w(this._memoryCache),this.query.destroy()}createQuery(){const e=this._layerView.layer.createQuery();return e.outFields=this._layerView.availableFields,e.returnZ=this._returnZ,e.returnM=this._returnM,e.outSpatialReference=this.tilingScheme.spatialReference,e}get memoryCache(){return this._memoryCache}get viewingMode(){return this._layerView.view.state.viewingMode}get tilingScheme(){return this._layerView.view.featureTiles.tilingScheme}get scheduler(){var e;return(e=this._layerView.view.resourceController)==null?void 0:e.scheduler}get geometryType(){return this._layerView.layer.geometryType}get fullExtent(){return this._layerView.layer.fullExtent}get tileMaxRecordCount(){return this._layerView.layer.capabilities.query.tileMaxRecordCount}get maxRecordCount(){return this._layerView.layer.capabilities.query.maxRecordCount}get isDraped(){var e;return((e=this._layerView.layer.elevationInfo)==null?void 0:e.mode)==="on-the-ground"}get effectiveDisplayFilter(){return this._layerView.displayFilterEnabled?this._layerView.effectiveDisplayFilter:null}get capabilities(){return this._capabilities??(this._capabilities=ne(this._layerView.layer)),this._capabilities}logFetchError(e,r){e.error("#fetchTile()",this._layerView.layer,(r==null?void 0:r.message)??r)}}function ne(t){const e=t.capabilities.query;return{supportsMultipleResolutions:ue(t),supportsPagination:!(!e||!e.supportsPagination),supportsResultType:!(!e||!e.supportsResultType),supportsCacheHint:!(!e||!e.supportsCacheHint),supportsQuantization:!(!e||!e.supportsQuantization),supportsQuantizationEditMode:!(!e||!e.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!e||!e.supportsMaxRecordCountFactor),supportsFormatPBF:!(!e||!e.supportsFormatPBF)}}function ue(t){switch(t.geometryType){case"polyline":return!0;case"polygon":return t.capabilities&&t.capabilities.query&&t.capabilities.query.supportsQuantization;default:return!1}}let c=class extends I{constructor(e){super(e),this._controllerTotal=0,this._processorTotal=0,this._needsRefresh=!1,this.suspendResumeExtentMode="data"}initialize(){this.addHandles(x(()=>({controller:this.controller,suspended:this.suspended}),({controller:e,suspended:r})=>{e&&!r&&this._needsRefresh&&(e.refetch(),this._needsRefresh=!1)}))}destroy(){this._fetcherContext=w(this._fetcherContext)}get maximumNumberOfFeatures(){var e;return((e=this.controller)==null?void 0:e.maximumNumberOfFeatures)??this._get("maximumNumberOfFeatures")}set maximumNumberOfFeatures(e){this._set("maximumNumberOfFeatures",e),this.controller&&(this.controller.maximumNumberOfFeatures=e)}get maximumNumberOfFeaturesExceeded(){return!!this.controller&&!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded)}get updatingProgressValue(){var s,n;let e=0;if((s=this.controller)!=null&&s.updating){const u=this.controller.updatingRemaining,o=Math.max(this.controller.updatingTotal,this._controllerTotal);o>0&&(e=(o-u)/o,this._controllerTotal=o)}let r=0;if((n=this.processor)!=null&&n.updating){const u=this.processor.updatingRemaining,o=Math.max(u,this._processorTotal);o>0&&(r=(o-u)/o,this._processorTotal=o)}return .5*(e+r)}get updatePolicy(){if(!this.controller)return m.ASYNC;switch(this.controller.mode){case"snapshot":{const e=le.get(this.layer.geometryType);return e==null||this.controller.serviceDataCount>e?m.ASYNC:m.SYNC}case"tiles":return m.ASYNC}}get usedMemory(){var e,r;return(((e=this.processor)==null?void 0:e.usedMemory)??0)+(((r=this.controller)==null?void 0:r.memoryForUnusedFeatures)??0)}get unloadedMemory(){var u,o,l,p;const e=((u=this.processor)==null?void 0:u.unprocessedMemoryEstimate)??0,r=((o=this.controller)==null?void 0:o.expectedFeatureDiff)??0,s=((l=this.processor)==null?void 0:l.loadedFeatures)??0,n=s+r>0?s/(s+r):1;return e+r*(((p=this.processor)==null?void 0:p.usedMemoryPerFeature)??0)*n}get ignoresMemoryFactor(){var e;return(e=this.controller)==null?void 0:e.hasMaximumNumberOfFeaturesOverride}get performanceInfo(){var n,u,o,l,p,d;const e=(n=this.controller)==null?void 0:n.displayFeatureLimit,r=e!=null?e.averageSymbolComplexity:void 0,s=r!=null?`f:${r.verticesPerFeature},v:${r.verticesPerCoordinate}`:"n/a";return new te(super.performanceInfo,((o=(u=this.controller)==null?void 0:u.performanceInfo)==null?void 0:o.storedFeatures)??0,((p=(l=this.controller)==null?void 0:l.performanceInfo)==null?void 0:p.totalVertices)??0,this.maximumNumberOfFeaturesExceeded,((d=this.controller)==null?void 0:d.mode)??"n/a",s)}async doRefresh(e){const{controller:r,processor:s,suspended:n}=this;e&&r&&(n?this._needsRefresh=!0:(r.refetch(),this._needsRefresh=!1)),s.refreshFilter()}setVisibility(e,r){var s;(s=this.processor)==null||s.setObjectIdVisibility(e,r)}getMissingAttributesForFeature(e){return this.controller.getMissingAttributesForFeature(e)}getHydratedGeometry(e){const r=this.graphics3DProcessor;if(r==null)return null;const s=r.graphics3DGraphicsByObjectID;if(s==null)return null;const n=s.get(e);return n==null?null:L(n.graphic.geometry)}createController(){this._fetcherContext=new ae({layerView:this.layerView,returnZ:this.hasZ,returnM:this.hasM});const e=new H({layerView:this.layerView,context:this._fetcherContext,graphics:new U,extent:this.clippingExtent});return this.updatingHandles.add(()=>e.serviceDataExtent,r=>{this.processor&&(this.processor.dataExtent=r)},v),this.addHandles(x(()=>this.suspended&&this.layerView.updateSuspended,r=>{r?e.suspend():e.resume()},R)),this.updatingHandles.add(()=>{var r;return(r=this.processor)==null?void 0:r.displayFeatureLimit},r=>e.displayFeatureLimit=r,v),this.addHandles(Z(()=>!this.updating,()=>{this._controllerTotal=0,this._processorTotal=0})),e}beforeSetController(e){e.maximumNumberOfFeatures=this.maximumNumberOfFeatures}get test(){return{controller:this.controller,graphics3DProcessor:this.graphics3DProcessor,heatmapProcessor:this.heatmapProcessor,loadedGraphics:this.loadedGraphics}}};i([a()],c.prototype,"layerView",void 0),i([a()],c.prototype,"controller",void 0),i([a()],c.prototype,"_controllerTotal",void 0),i([a()],c.prototype,"_processorTotal",void 0),i([a()],c.prototype,"_needsRefresh",void 0),i([a()],c.prototype,"maximumNumberOfFeatures",null),i([a()],c.prototype,"maximumNumberOfFeaturesExceeded",null),i([a()],c.prototype,"updatingProgressValue",null),i([a()],c.prototype,"updatePolicy",null),i([a()],c.prototype,"suspendResumeExtentMode",void 0),c=i([g("esri.views.3d.layers.graphics.FeatureGraphics3DGraphicsPipeline")],c);const le=new Map([["point",5e3],["polygon",500],["polyline",1e3]]);let h=class extends ee(j(W(G(X)))){constructor(t){super(t)}initialize(){this.addHandles(x(()=>this._updatingRequiredPromise,t=>this._updatingHandles.addPromise(t),R))}destroy(){this._updatingHandles.removeAll(),this._fetcherContext=w(this._fetcherContext)}get maximumNumberOfFeatures(){return this.graphicsPipeline.maximumNumberOfFeatures}set maximumNumberOfFeatures(t){this.graphicsPipeline.maximumNumberOfFeatures=t}get maximumNumberOfFeaturesExceeded(){return this.graphicsPipeline!=null&&!this.suspended&&this.graphicsPipeline.maximumNumberOfFeaturesExceeded}get updatingProgressValue(){var t;return((t=this.graphicsPipeline)==null?void 0:t.updatingProgressValue)??0}get updatePolicy(){var t;return((t=this.graphicsPipeline)==null?void 0:t.updatePolicy)??m.ASYNC}get hasZ(){const t=this.layer,e=t.capabilities&&t.capabilities.data;return!(!e||!e.supportsZ)&&("returnZ"in t&&t.returnZ!=null?t.returnZ:e.supportsZ)}get hasM(){const t=this.layer,e=t.capabilities&&t.capabilities.data;return!(!e||!e.supportsM)&&"returnM"in t&&t.returnM!=null&&t.returnM}setVisibility(t,e){var r;(r=this.graphicsPipeline)==null||r.setVisibility(t,e)}createQuery(){return super.createQuery()}queryFeatures(t,e){const r=()=>super.queryFeatures(t,e);return this.layer.geometryType==="mesh"?this._queryFeaturesMesh(this._ensureQuery(t),r):r()}async createGraphicsPipeline(){if(E("feature-pipeline-3d-test")){const{Feature3DPipeline:t}=await S(()=>import("./Feature3DPipeline-3vGpKR3t.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346]),import.meta.url);return new t({layerView:this})}return new c({layerView:this})}async doRefresh(t){return await this.graphicsPipeline.doRefresh(t)}_popupFeatureHasRequiredFields(t,e){if(!super._popupFeatureHasRequiredFields(t,e))return!1;const r=A(t,this.layer.objectIdField);if(r==null)return!0;const s=this.graphicsPipeline.getMissingAttributesForFeature(r);if(s==null)return!0;for(const n of e)if(s.has(n))return!1;return!0}get usedMemory(){var t;return((t=this.graphicsPipeline)==null?void 0:t.usedMemory)??0}get unloadedMemory(){var t;return((t=this.graphicsPipeline)==null?void 0:t.unloadedMemory)??0}get ignoresMemoryFactor(){var t;return((t=this.graphicsPipeline)==null?void 0:t.ignoresMemoryFactor)??!1}async _queryFeaturesMesh(t,e){await this._validateQueryFeaturesMesh(t);const r=await e(),s=this.graphicsPipeline;if(t!=null&&t.outStatistics||s==null)return r;const n=this.layer.objectIdField,u=[];for(const o of r.features)if(o.geometry){const l=s.getHydratedGeometry(o.attributes[n]);l&&(o.geometry=l,u.push(o))}else u.push(o);return r.features=u,r}async _validateQueryFeaturesMesh(t){if(!t)return;const e=s=>{throw new Q("feature-layer-view:unsupported-query",`Queries on Mesh feature collection layers do not support '${s}'`)},r=["quantizationParameters","geometryPrecision","maxAllowableOffset"];for(const s of r)t[s]!=null&&e(s);"returnM"in t&&t.returnM&&e("returnM"),"returnCentroid"in t&&t.returnCentroid&&e("returnCentroid"),t.outSpatialReference==null||t.outSpatialReference.equals(this.view.spatialReference)||e("outSpatialReference")}get test(){}};i([a()],h.prototype,"layer",void 0),i([a()],h.prototype,"graphicsPipeline",void 0),i([a()],h.prototype,"maximumNumberOfFeatures",null),i([a()],h.prototype,"maximumNumberOfFeaturesExceeded",null),i([a(K)],h.prototype,"updatingProgress",void 0),i([a({readOnly:!0})],h.prototype,"updatingProgressValue",null),i([a({readOnly:!0})],h.prototype,"updatePolicy",null),i([a({readOnly:!0})],h.prototype,"hasZ",null),i([a({readOnly:!0})],h.prototype,"hasM",null),h=i([g("esri.views.3d.layers.FeatureLayerViewBase3D")],h);const qe=h;export{qe as g,te as t};
