const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./calcite-button-BbY9lAf2.js","./button-D5KuIed_.js","./jsxFactory-Be5PKa9i.js","./Evented-CXIxDjmW.js","./Accessor-D6mNnsWy.js","./subclass-BR3PhgZG.js","./intl-CArXn1et.js","./Promise-CZrWwByK.js","./jsonMap-DCC6W5ex.js","./assets-BNizZMOZ.js","./index-BVncS3aY.js","./index-CjOb8WjV.css","./reactiveUtils-BFQ0BtrB.js","./shared-B3wH2qpO.js","./uuid-fwrPAdZb.js","./form-BOCdnUd9.js","./dom-BkQ_hHOr.js","./interactive-QOqfpSSx.js","./label-1rGx7O4B.js","./component-ByvC-PUv.js","./loadable-Bgtgv1lm.js","./locale-BvYy6Wxh.js","./key-D5DPfjW0.js","./observers-DSkGD1TQ.js","./t9n-Atzq4sOi.js","./icon-D6t4qKDg.js","./loader-ew3V3w9x.js","./calcite-tooltip-5IY_tl60.js","./floating-ui-5U9KNmUg.js","./debounce-C5YDvsuO.js","./openCloseComponent-Bqj9CrBJ.js","./FloatingArrow-BN7WHE4B.js"])))=>i.map(i=>d[i]);
import{_ as g}from"./index-BVncS3aY.js";import{e as i}from"./Evented-CXIxDjmW.js";import{y as o,b as u}from"./subclass-BR3PhgZG.js";import{e as k,B as T,r as b,n as d}from"./jsxFactory-Be5PKa9i.js";import{e as m}from"./globalCss-CZa70j6i.js";import{e as E}from"./vmEvent-D4Ubqkbq.js";import{t as y,x as M,b as f}from"./Accessor-D6mNnsWy.js";import{b as I}from"./GeolocationPositioning-CUYAYlmX.js";import"./intl-CArXn1et.js";import"./Promise-CZrWwByK.js";import"./jsonMap-DCC6W5ex.js";import"./assets-BNizZMOZ.js";import"./reactiveUtils-BFQ0BtrB.js";import"./shared-B3wH2qpO.js";import"./uuid-fwrPAdZb.js";import"./Graphic-Bi5hWHps.js";import"./geometry-CnaxvJsv.js";import"./Extent-B4rrMrqp.js";import"./Point-TlcsOcXV.js";import"./writer-3zufXUNV.js";import"./Polyline-BQFeqYXi.js";import"./mathUtils-ClvKsMak.js";import"./PopupTemplate-D8mXPxzU.js";import"./Clonable-cKbRam6-.js";import"./fieldUtils-C5R42-PY.js";import"./enumeration--HlxOQ_N.js";import"./Color-DDUWtbqR.js";import"./colorUtils-CS9vdHXB.js";import"./ActionToggle-C0Z1k2jc.js";import"./Identifiable-BLvpQbOc.js";import"./symbols-CfvYGR4J.js";import"./TextSymbol-zZq0BA1M.js";import"./screenUtils-PfxkaaMN.js";import"./materialUtils-CQ3JLQ1x.js";import"./opacityUtils-BT7mQkwC.js";import"./aaBoundingBox-BGxkJAW0.js";import"./persistableUrlUtils-Dx61-x4K.js";import"./collectionUtils-Dm1icNvk.js";import"./Portal-DCqdz-K4.js";import"./jsonUtils-DtWlwXHP.js";import"./geolocationUtils-DT4W4xVw.js";import"./project-DXhIgRZA.js";import"./utils-Blh5cXWv.js";import"./utils-Bh7lx_TM.js";import"./GoTo-CyjNnle5.js";const P=15e3;let a=class extends I{constructor(t){super(t),this._watchId=void 0,this._trackStartingTimeoutId=void 0,this._settingPosition=null,this._trackController=null,this.error=void 0,this.positionFilterFunction=null}destroy(){this._stopTracking()}get state(){return this._geolocationUsable?this.view&&!this.view.ready?"disabled":this._settingPosition||this._trackStartingTimeoutId!==void 0?"waiting":this.tracking?"tracking":this.error!=null?"error":"ready":"feature-unsupported"}get tracking(){return this._watchId!==void 0}start(){this.state!=="disabled"&&this.state!=="feature-unsupported"&&this._startTracking()}stop(){this.state!=="disabled"&&this.state!=="feature-unsupported"&&this._stopTracking()}_stopWatchingPosition(){this._watchId!==void 0&&(navigator.geolocation.clearWatch(this._watchId),this._watchId=void 0)}_stopTracking(){this._abortTrack(),this._clearWaitingTimer(),this._stopWatchingPosition(),this._clearGraphic()}_startTracking(){this._stopTracking();const t=M(async r=>{this._abortTrack();const s=new AbortController;this._trackController=s;const{timestamp:n,coords:p}=r,c={timestamp:n,coords:{...p}};this.error=void 0;try{if(typeof this.positionFilterFunction=="function"&&!this.positionFilterFunction.call(null,{position:c})||(await this.updatePosition(r,s),this._trackController!==s))return;this._clearWaitingTimer(),this._addGraphic(),this.emit("track",{position:r}),this._trackController=null}catch(l){if(f(l))return;throw this._trackController=null,this._emitError(l),this._clearWaitingTimer(),l}},0);this._watchId=navigator.geolocation.watchPosition(r=>{this._settingPosition=t(r).catch(y)},this._handleWatchPositionError.bind(this),this.geolocationOptions??void 0),this._trackStartingTimeoutId=setTimeout(()=>{this._trackStartingTimeoutId=void 0},P)}_handleWatchPositionError(t){t.code===t.PERMISSION_DENIED&&this._stopTracking(),this._emitError(t)}_abortTrack(){var t;(t=this._trackController)==null||t.abort(),this._trackController=null}_clearWaitingTimer(){clearTimeout(this._trackStartingTimeoutId),this._trackStartingTimeoutId=void 0,this._settingPosition=null}_emitError(t){this.error=t,this.emit("track-error",{error:t})}};i([o()],a.prototype,"_watchId",void 0),i([o()],a.prototype,"_trackStartingTimeoutId",void 0),i([o()],a.prototype,"_settingPosition",void 0),i([o()],a.prototype,"error",void 0),i([o()],a.prototype,"positionFilterFunction",void 0),i([o({readOnly:!0})],a.prototype,"state",null),i([o({readOnly:!0})],a.prototype,"tracking",null),i([o()],a.prototype,"start",null),i([o()],a.prototype,"stop",null),a=i([u("esri.widgets.Track.TrackViewModel")],a);const _=a,O={base:"esri-track"};let e=class extends T{constructor(t,r){super(t,r),this.messages=null,this.viewModel=new _,this._toggleTracking=()=>{const s=this.viewModel;s&&s.state!=="feature-unsupported"&&s.state!=="disabled"&&(s.state!=="tracking"&&s.state!=="waiting"?this.viewModel.start():this.viewModel.stop())}}loadDependencies(){return b({button:()=>g(()=>import("./calcite-button-BbY9lAf2.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]),import.meta.url),tooltip:()=>g(()=>import("./calcite-tooltip-5IY_tl60.js"),__vite__mapDeps([27,2,3,4,5,6,7,8,9,10,11,12,13,14,16,28,29,30,31]),import.meta.url)})}get geolocationOptions(){return this.viewModel.geolocationOptions}set geolocationOptions(t){this.viewModel.geolocationOptions=t}get goToLocationEnabled(){return this.viewModel.goToLocationEnabled}set goToLocationEnabled(t){this.viewModel.goToLocationEnabled=t}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(t){this.viewModel.goToOverride=t}get graphic(){return this.viewModel.graphic}set graphic(t){this.viewModel.graphic=t}get icon(){return"compass-north-circle"}set icon(t){this._overrideIfSome("icon",t)}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get rotationEnabled(){return this.viewModel.rotationEnabled}set rotationEnabled(t){this.viewModel.rotationEnabled=t}get scale(){return this.viewModel.scale}set scale(t){this.viewModel.scale=t}get tracking(){return this.viewModel.tracking}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}start(){this.viewModel.start()}stop(){this.viewModel.stop()}render(){var h;const{viewModel:t,messages:r,icon:s}=this,n=t==null?void 0:t.state,p=n==="tracking",c=this._localizeError((h=this.viewModel)==null?void 0:h.error),l=(p?r==null?void 0:r.stopTracking:r==null?void 0:r.startTracking)??"",v=n==="feature-unsupported",w=(n==="tracking"?"pause":void 0)??s;return d("div",{class:this.classes(O.base,m.widget)},!v&&d("calcite-button",{class:m.widgetButton,disabled:n==="disabled",iconStart:w,kind:"neutral",label:l,loading:n==="waiting",onclick:this._toggleTracking,title:l}),c?d("calcite-tooltip",{open:!0,overlayPositioning:"fixed",referenceElement:this.container},c):null)}_localizeError(t){var r,s,n;return t instanceof GeolocationPositionError?t.code===GeolocationPositionError.PERMISSION_DENIED?(r=this.messages)==null?void 0:r.permissionError:t.code===GeolocationPositionError.TIMEOUT?(s=this.messages)==null?void 0:s.timeoutError:(n=this.messages)==null?void 0:n.positionUnavailable:t instanceof Error?t.message:void 0}};i([o()],e.prototype,"geolocationOptions",null),i([o()],e.prototype,"goToLocationEnabled",null),i([o()],e.prototype,"goToOverride",null),i([o()],e.prototype,"graphic",null),i([o()],e.prototype,"icon",null),i([o()],e.prototype,"label",null),i([o(),k("esri/widgets/Track/t9n/Track")],e.prototype,"messages",void 0),i([o()],e.prototype,"rotationEnabled",null),i([o()],e.prototype,"scale",null),i([o({readOnly:!0})],e.prototype,"tracking",null),i([o()],e.prototype,"view",null),i([o({type:_}),E(["track","track-error"])],e.prototype,"viewModel",void 0),e=i([u("esri.widgets.Track")],e);const Tt=e;export{Tt as default};
