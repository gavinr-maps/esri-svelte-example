import{r as m}from"./tslib.es6-B3Jf3DVX.js";import{a as P,b as l}from"./subclass-BZA_h8Db.js";import{t as g,R as b}from"./fieldUtils-tmQlKvWo.js";import{p as u,n as v}from"./popupUtils-BaLxn3kI.js";const O=d=>{let a=class extends d{_validateFetchPopupFeatures(t){const{layer:r}=this,{popupEnabled:p}=r;if(!p)throw new l("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:r});if(!u(r,t))throw new l("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:r})}async prepareFetchPopupFeatures(t){}async fetchPopupFeaturesFromGraphics(t,r){if(this._validateFetchPopupFeatures(r),t.length===0)return[];const p=this.layer.type==="scene"&&this.layer.associatedLayer!=null?this.layer.associatedLayer:this.layer;let i=[];"fieldsIndex"in this.layer&&(i=g(this.layer.fieldsIndex,await v(p,u(this.layer,r)))),await this.prepareFetchPopupFeatures(i);const c=new Set,o=[],s=[];for(const e of t)b(i,e,c)?s.push(e):o.push(e);if(s.length===0)return o;const n=new Map;for(let e=0;e<t.length;e++)n.set(t[e].getObjectId()??0,e);const h=await this.whenGraphicAttributes(s,[...c]).catch(()=>s).then(e=>o.concat(e));return h.sort((e,y)=>{const f=e.getObjectId()??0,w=n.get(f)??0,F=y.getObjectId()??0;return w-(n.get(F)??0)}),h}};return a=m([P("esri.views.3d.layers.support.PopupSceneLayerView")],a),a};export{O as i};
