var E=Math.PI,e=Math.sin,a=Math.cos,T=Math.tan,U=Math.asin,m=Math.atan2,w=Math.acos,o=E/180,F=864e5,b=2440588,j=2451545,Y={dec:0,ra:0};function Z(n){return n.valueOf()/F-.5+b}function p(n){return new Date((n+.5-b)*F)}function P(n){return Z(n)-j}var x=23.4397*o;function k(n,t){return m(e(n)*a(x)-T(t)*e(x),a(n))}function A(n,t){return U(e(t)*a(x)+a(t)*e(x)*e(n))}function q(n,t,r){return m(e(n),a(n)*e(t)-T(r)*a(t))}function y(n,t,r){return U(e(t)*e(r)+a(t)*a(r)*a(n))}function B(n,t){return o*(280.16+360.9856235*n)-t}function C(n){return o*(357.5291+.98560028*n)}function J(n){return o*(1.9148*e(n)+.02*e(2*n)+3e-4*e(3*n))}function K(n,t){return n+t+102.9372*o+E}function Q(n,t){var r=C(n),u=K(r,J(r));return t||(t={dec:0,ra:0}),t.dec=A(u,0),t.ra=k(u,0),t}var M={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(n,t,r,u){var i=o*-r,c=o*t,f=P(n),d=Q(f,Y),s=B(f,i)-d.ra;return u||(u={azimuth:0,altitude:0}),u.azimuth=q(s,c,d.dec),u.altitude=y(s,c,d.dec),u}},N=[[-.83,"sunrise","sunset"]];M.addTime=function(n,t,r){N.push([n,t,r])};var V=9e-4;function $(n,t){return Math.round(n-V-t/(2*E))}function _(n,t,r){return V+(n+t)/(2*E)+r}function D(n,t,r){return j+n+.0053*e(t)-.0069*e(2*r)}function nn(n,t,r){return w((e(n)-e(t)*e(r))/(a(t)*a(r)))}function S(n){var t=o*(134.963+13.064993*n),r=o*(93.272+13.22935*n),u=o*(218.316+13.176396*n)+6.289*o*e(t),i=5.128*o*e(r),c=385001-20905*a(t);return{ra:k(u,i),dec:A(u,i),dist:c}}M.getTimes=function(n,t,r){var u=o*-r,i=o*t,c=$(P(n),u),f=_(0,u,c),d=C(f),s=J(d),I=K(d,s),g=A(I,0),v=D(f,d,I);function W(O){return D(_(nn(O,i,g),u,c),d,I)}function X(O){var H=(e(O)-e(i)*e(g))/(a(i)*a(g));return H<-1?M.PolarException.MIDNIGHT_SUN:H>1?M.PolarException.POLAR_NIGHT:M.PolarException.NORMAL}var h,R,L,z,G,l={solarNoon:p(v),nadir:p(v-.5),polarException:M.PolarException.NORMAL};for(h=0,R=N.length;h<R;h+=1)G=v-((z=W((L=N[h])[0]*o))-v),l[L[1]]=p(G),l[L[2]]=p(z);return l.polarException=X(N[0][0]*o),l},M.getMoonPosition=function(n,t,r){var u=o*-r,i=o*t,c=P(n),f=S(c),d=B(c,u)-f.ra,s=y(d,i,f.dec);return s+=.017*o/T(s+10.26*o/(s+5.1*o)),{azimuth:q(d,i,f.dec),altitude:s,distance:f.dist}},M.getMoonFraction=function(n){var t=P(n),r=Q(t),u=S(t),i=149598e3,c=w(e(r.dec)*e(u.dec)+a(r.dec)*a(u.dec)*a(r.ra-u.ra)),f=m(i*e(c),u.dist-i*a(c));return(1+a(f))/2};export{M as m};
