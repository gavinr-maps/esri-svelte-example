import{s as b}from"./vec4f64-o2zAXfmz.js";import{H as S}from"./InterleavedLayout-e-di2fxs.js";import{n as u,l as f,C as m,w as I,e as E}from"./Matrix3DrawUniform-CiBFaSz6.js";import{o as D}from"./AlphaCutoff-UcccL64p.js";import{B as N,f as R,g as w,e as v}from"./renderState-DQLu6AJX.js";import{o as L,d as M,S as x,V as F,P as O,q,e as V,u as U,r as j,h as B,j as z,x as g,y as H,a9 as W,z as Q,B as k,aa as G,ab as J,ac as Y,ad as K,E as X,k as Z,F as ee,A as p,ae as te,m as re,aq as se}from"./Texture-Fac_8AOC.js";import{e as c}from"./VertexAttribute-Cq4MnHjR.js";import{a as oe,e as ie,r as ae}from"./VertexColor.glsl-_ARMpsAT.js";import{e as ne}from"./TriangleMaterial-BiHR3MKx.js";import{_ as le}from"./index-Bh2oEzTI.js";import"./Material-_xx7OZxD.js";import{f as pe}from"./enums-D9v74xTE.js";import{r as o}from"./tslib.es6-B3Jf3DVX.js";import{i}from"./ShaderTechniqueConfiguration-CBbn2DCi.js";import"./mat4-GpOFENPA.js";import"./mat4f64-Dk4dwAN8.js";import"./vec32-Dvg_eL9J.js";import"./vec3f64-BLpZdpfb.js";import"./BindType-BmZEZMMh.js";import{o as T}from"./interfaces-DDtDqZYj.js";import"./mat3f64-BBpwCtoL.js";import"./vec2-maR1OrZI.js";import"./vec2f64-miziP1SN.js";function A(r){const e=new L,{vertex:t,fragment:a,attributes:n,varyings:h}=e;M(t,r),e.include(oe,r),e.include(ie,r),e.include(x,r),e.include(F,r),e.include(O,r),e.include(q,r),n.add(c.POSITION,"vec3"),r.vvColor&&n.add(c.COLORFEATUREATTRIBUTE,"float"),h.add("vColor","vec4"),h.add("vpos","vec3");const l=r.terrainDepthTest&&r.output===u.Color;return l&&h.add("depth","float"),t.uniforms.add(new V("eColor",d=>d.color)),t.main.add(T`
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${r.hasVertexColors?"vColor *= eColor;":r.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${l?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = transformPosition(proj, view, vpos);`),e.include(O,r),l&&e.include(U,r),a.include(j),a.main.add(T`
    discardBySlice(vpos);
    ${l?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;
    outputColorHighlightOID(fColor, vpos);`),e}const ce=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}));class he extends B{constructor(e,t,a){super(e,t,new z(ce,()=>le(()=>Promise.resolve().then(()=>ve),void 0,import.meta.url)),a)}_createPipeline(e,t){const{oitPass:a,output:n,transparent:h,cullFace:l,draped:d,hasOccludees:_,polygonOffset:C,enableOffset:P}=e,$=a===g.NONE,y=a===g.FrontFace;return N({blending:n===u.Color&&h?H(a):null,culling:R(l),depthTest:d?null:{func:W(a)},depthWrite:Q(e),drawBuffers:n===u.Depth?{buffers:[pe.NONE]}:k(a,n),colorWrite:w,stencilWrite:_?G:null,stencilTest:_?t?J:Y:null,polygonOffset:$||y?C?ue:null:K(P)})}initializePipeline(e){return this._occludeePipelineState=this._createPipeline(e,!0),this._createPipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}const ue={factor:1,units:1};class s extends X{constructor(){super(...arguments),this.cullFace=v.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.discardInvisibleFragments=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1,this.textureCoordinateType=Z.None,this.emissionSource=ee.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.vvSize=!1,this.vvOpacity=!1}}o([i({count:v.COUNT})],s.prototype,"cullFace",void 0),o([i()],s.prototype,"hasSlicePlane",void 0),o([i()],s.prototype,"hasVertexColors",void 0),o([i()],s.prototype,"transparent",void 0),o([i()],s.prototype,"discardInvisibleFragments",void 0),o([i()],s.prototype,"polygonOffset",void 0),o([i()],s.prototype,"enableOffset",void 0),o([i()],s.prototype,"writeDepth",void 0),o([i()],s.prototype,"hasOccludees",void 0),o([i()],s.prototype,"terrainDepthTest",void 0),o([i()],s.prototype,"cullAboveTerrain",void 0),o([i()],s.prototype,"objectAndLayerIdColorInstanced",void 0),o([i()],s.prototype,"vvColor",void 0),o([i()],s.prototype,"draped",void 0);let Ve=class extends ne{constructor(e){super(e,fe),this._configuration=new s,this.supportsEdges=!0,this.produces=new Map([[p.OPAQUE_MATERIAL,t=>this._isOpaqueMaterialPass(t)],[p.OPAQUE_MATERIAL_WITHOUT_NORMALS,t=>this._isOpaqueNoSSAODepthPass(t)],[p.TRANSPARENT_MATERIAL,t=>f(t)&&this._transparent&&this.parameters.writeDepth],[p.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,t=>m(t)&&this._transparent&&this.parameters.writeDepth],[p.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,t=>f(t)&&this._transparent&&!this.parameters.writeDepth],[p.DRAPED_MATERIAL,t=>I(t)]])}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._transparent,this._configuration.discardInvisibleFragments=this._transparent&&!this._isOpaquePass(e)&&this.parameters.discardInvisibleFragments,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<te,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}get visible(){return this.parameters.color[3]>=D}get _transparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}_isOpaquePass(e){return this._isOpaqueMaterialPass(e)||this._isOpaqueNoSSAODepthPass(e)}_isOpaqueMaterialPass(e){return e===u.Highlight||f(e)&&!this._transparent}_isOpaqueNoSSAODepthPass(e){return m(e)&&this.parameters.writeDepth&&!this._transparent}createGLMaterial(e){return new de(e)}createBufferWriter(){const e=S().vec3f(c.POSITION);return E()&&e.vec4u8(c.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(c.COLORFEATUREATTRIBUTE):e.vec4u8(c.COLOR),new ae(e)}};class de extends re{beginSlot(e){return this.acquireTechnique(he,e)}}class fe extends se{constructor(){super(...arguments),this.color=b,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=v.None,this.draped=!1,this.discardInvisibleFragments=!1}}const ve=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}));export{Ve as O};
