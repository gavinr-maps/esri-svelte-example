import{b as h}from"./Graphic-CFXUQZlS.js";import{o as l,B as y}from"./Accessor-BHnuXKD2.js";import{w as S}from"./Extent-CBBGeHb-.js";import E from"./Mesh-CKlujWIs.js";import{g}from"./Point-XGrwlf63.js";import{i as N,a as D}from"./External-Dk8Y8WWd.js";import{s as M}from"./infoFor3D-CsJzgCF0.js";import{d as w}from"./FeatureSet-DpCN730g.js";import{n as F,i as T}from"./meshFeatureAttributes-CeSp-p_A.js";import"./Clonable-DvJsj5LF.js";import"./reactiveUtils-BR0C1Kq4.js";import"./Evented-DCWccWGU.js";import"./SimpleObservable-7oieNGD8.js";import"./JSONSupport-CGdeqxpk.js";import"./cast-BA_-jlhc.js";import"./index-tefRSezt.js";import"./writer-B2bQV2uU.js";import"./opacityUtils-CSd4XoR2.js";import"./Promise-CmQqe-ke.js";import"./enumeration-Cr5WIZs4.js";import"./Color-gncXBiLc.js";import"./colorUtils-Rxh2V3ai.js";import"./mathUtils-DV9iOXpW.js";import"./ActionToggle-__-l4AdQ.js";import"./Identifiable-BrT7zvUW.js";import"./jsonUtils-Cu7OBRmN.js";import"./Polyline-BmuD2-ZN.js";import"./typeUtils-BSg8Y507.js";import"./TextSymbol-BQ_NW9Xo.js";import"./screenUtils-_ZIvrt5o.js";import"./collectionUtils-CbaToa73.js";import"./Portal-CTRRujjZ.js";import"./vec3f64-BLpZdpfb.js";import"./aaBoundingBox-CeBivBRq.js";import"./axisAngleDegrees-8Sw4vC28.js";import"./mat4-Fi6iAz29.js";import"./common-DQOJ18NT.js";import"./quat-4pa1e6ds.js";import"./mat3f64-BBpwCtoL.js";import"./quatf64-CCm9z-pX.js";import"./vec32-Dvg_eL9J.js";import"./vec42-YcqnINSP.js";import"./MeshComponent-Csew-urT.js";import"./imageUtils-brik-GLm.js";import"./meshProperties-C4iW0Ukm.js";import"./MeshLocalVertexSpace-C0YDTRex.js";import"./MeshTransform-CIhaTwDv.js";import"./mat4f64-Dk4dwAN8.js";import"./MeshVertexAttributes-Dh8Pp9-Y.js";import"./meshVertexSpaceUtils-SW0WEjNN.js";import"./triangulationUtils-ChyeOnqC.js";import"./earcut-Lltz9D9k.js";import"./Indices-Db9lERgy.js";import"./plane-4dpuo6-e.js";import"./vec2f64-Dy6m9Nrb.js";import"./vec4f64-o2zAXfmz.js";import"./mathUtils-B9R7G-2c.js";import"./deduplicate-8uOXlcvp.js";import"./projectPointToVector-BS0u8fq6.js";import"./projection-B2I9Bzj_.js";import"./projectBuffer-DOU0xvVi.js";import"./geodesicConstants-yASAK_zX.js";import"./vertexSpaceConversion-Dbe11h0o.js";import"./mat3-CR8GKnhD.js";import"./spatialReferenceEllipsoidUtils-DM073JUd.js";import"./computeTranslationToOriginAndRotation-BT43Xu5d.js";import"./vec3-Bn81gjoR.js";import"./BufferView-_QDXRCew.js";import"./vec2-maR1OrZI.js";import"./vec4-DcW4fpPA.js";import"./Field-Cyk7Ur5d.js";import"./fieldType-L-VlbZqy.js";const b=()=>y.getLogger("esri.rest.support.meshFeatureSet");function Vt(t,e,r){const o=r.features;r.features=[],delete r.geometryType;const i=w.fromJSON(r);if(i.geometryType="mesh",!r.assetMaps)return i;const m=O(e,r.assetMaps),s=t.sourceSpatialReference??g.WGS84,u=r.globalIdFieldName,{outFields:p}=t,f=p!=null&&p.length>0?I(p.includes("*")?null:new Set(p)):()=>({});for(const n of o){const a=L(n,u,s,e,m);i.features.push(new h({geometry:a,attributes:f(n)}))}return i}function I(t){return({attributes:e})=>{if(!e)return{};if(!t)return e;for(const r in e)t.has(r)||delete e[r];return e}}function L(t,e,r,o,i){const m=t.attributes[e],s=i.get(m);if(s==null||!t.geometry)return null;const u=F(t.attributes,r,o.transformFieldRoles),p=S.fromJSON(t.geometry);p.spatialReference=r;const f=T(t.attributes,o.transformFieldRoles),n=r.isGeographic?"local":"georeferenced",a=P(s);return a?E.createWithExternalSource(u,a,{extent:p,transform:f,vertexSpace:n,unitConversionDisabled:!0}):E.createIncomplete(u,{extent:p,transform:f,vertexSpace:n})}var c;function O(t,e){const r=new Map;for(const o of e){const i=o.parentGlobalId;if(i==null)continue;const m=o.assetName,s=o.assetType,u=o.assetHash,p=o.assetURL,f=o.conversionStatus,n=o.seqNo,a=M(s,t.supportedFormats);if(!a){b().error("mesh-feature-set:unknown-format",`Service returned an asset of type ${s}, but it does not list it as a supported type`);continue}const d=l(r,i,()=>({files:new Map}));l(d.files,m,()=>({name:m,type:s,mimeType:a,status:$(f),parts:[]})).parts[n]={hash:u,url:p}}return r}function P(t){const e=Array.from(t.files.values()),r=new Array;for(const o of e){if(o.status!==c.COMPLETED)return null;const i=new Array;for(const m of o.parts){if(!m)return null;i.push(new N(m.url,m.hash))}r.push(new D(o.name,o.mimeType,i))}return r}function $(t){switch(t){case"COMPLETED":case"SUBMITTED":return c.COMPLETED;case"INPROGRESS":return c.PENDING;default:return c.FAILED}}(function(t){t[t.FAILED=0]="FAILED",t[t.PENDING=1]="PENDING",t[t.COMPLETED=2]="COMPLETED"})(c||(c={}));export{O as assetMapFromAssetMapsJSON,L as extractMesh,Vt as meshFeatureSetFromJSON};
