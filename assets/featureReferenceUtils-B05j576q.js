import{R as w,r as $,q as T}from"./vec32-Dvg_eL9J.js";import{n as f}from"./vec3f64-BLpZdpfb.js";import{b as q,S as h}from"./sphere-DQxj5tsv.js";import{e as A}from"./intersectorUtils-l6zkk4nF.js";import{m as L,w as O,V as P}from"./intersectorUtilsConversions-CZnn6t-z.js";function E(e,r){return I(e)===I(r)}function I(e){if(e==null)return null;const r=e.layer!=null?e.layer.id:"";let t=null;return t=e.objectId!=null?e.objectId:e.layer!=null&&"objectIdField"in e.layer&&e.layer.objectIdField!=null&&e.attributes!=null?e.attributes[e.layer.objectIdField]:e.uid,t==null?null:`o-${r}-${t}`}const G={json:{write:{writer:x,target:{"feature.layerId":{type:[Number,String],isRequired:!0},"feature.objectId":{type:[Number,String],isRequired:!0}}},origins:{"web-scene":{read:H}}}};function x(e,r){var t;((t=e==null?void 0:e.layer)==null?void 0:t.objectIdField)!=null&&e.attributes!=null&&(r.feature={layerId:e.layer.id,objectId:e.attributes[e.layer.objectIdField]})}function H(e){if(e.layerId!=null&&e.objectId!=null)return{uid:null,layer:{id:e.layerId,objectIdField:"ObjectId"},attributes:{ObjectId:e.objectId}}}function J(e,r,t,l){const{sceneIntersectionHelper:F}=e,{observer:m,observerFeatureId:d,targetFeatureId:s,target:j}=t;if(d==null&&s==null)return;l||(l=n=>n),w(a,m,j);const u=$(a),c=1;T(a,m,a,c/u);const N=h(a,j,V);r.options.store=A.ALL,F.intersectToolIntersectorRay(N,r);let y=null,g=null,i=null,o=null;for(const n of r.results.all){const p=L(n,e);if(p==null||n.distanceInRenderSpace==null)continue;const b=I(p);b!=null&&(d!=null&&b===d&&(y??(y=l(S(n,e,u))),n.distanceInRenderSpace-c<y&&(i=n)),s!=null&&b===s&&(g??(g=l(S(n,e,u))),o==null&&n.distanceInRenderSpace-c<u&&u-n.distanceInRenderSpace+c<g&&(o=n)))}const{observerAdjusted:R,targetAdjusted:v}=t;i!=null&&i.getIntersectionPoint(R)?t.observerSurfaceNormal=i.getTransformedNormal(f()):t.observerSurfaceNormal=null,o!=null&&o.getIntersectionPoint(v)?t.targetSurfaceNormal=o.getTransformedNormal(f()):t.targetSurfaceNormal=null}function S(e,r,t){if(O(e)){const l=P(e,r);if(l!=null)return Math.min(l*M,t)}return 1e-5*t}const M=.05,V=q(),a=f();export{G as b,E as c,I as d,J as m};
