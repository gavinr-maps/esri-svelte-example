const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./symbolLayerUtils-NZlhZ9vt.js","./index-Bh2oEzTI.js","./index-2kwcjS9-.css","./assets-C43MgM-v.js","./subclass-BZA_h8Db.js","./tslib.es6-B3Jf3DVX.js","./Accessor-BLX9ikPh.js","./LRUCache-B_PHMSGm.js","./MemCache-Dx1v3xLC.js","./vec3f64-BLpZdpfb.js","./aaBoundingBox-BE7cC1jD.js","./Extent-Bf3YTe7m.js","./Point-Cg0-ChZE.js","./cast-Bjksrh93.js","./writer-DNAwXnhG.js","./jsonMap-0cxwUWs2.js","./Polyline-D9YkgmM_.js","./mathUtils-C4_ghTv4.js","./symbols-CNimns--.js","./enumeration-Ba5njXdz.js","./fieldUtils-tmQlKvWo.js","./intl-CChhNOV8.js","./date-DlqISzcw.js","./locale-C9TlLpzi.js","./messages-OmQvZhAg.js","./geometry-D964gYQX.js","./TextSymbol-D8QO_KUV.js","./Color-BCS62Hs5.js","./colorUtils-0bJDPow9.js","./screenUtils-_ZIvrt5o.js","./materialUtils-DarhapKC.js","./opacityUtils-C68Tlu6_.js","./persistableUrlUtils-fa1mAujs.js","./Collection-CEdjem1-.js","./Evented-BHRw9x22.js","./shared-B3wH2qpO.js","./SimpleObservable-KocWTzVy.js","./collectionUtils-D_lHIu88.js","./Portal-C10FKnaA.js","./Loadable-BabW5Xcc.js","./Promise-B2Hu02L7.js","./Clonable-D3rtuBWg.js","./reactiveUtils-C5zUhJQJ.js","./asyncUtils-CWX51uTe.js","./Upload-Bw44XHih.js","./projection-B971H0Re.js","./projectBuffer-Bs7GwaPY.js","./geodesicConstants-DWQLYX7F.js","./progressUtils-DPI25tXa.js","./infoFor3D-C0hFfS1m.js","./helpMessageUtils3d-TaLw0ElD.js","./vec32-Dvg_eL9J.js","./common-DQOJ18NT.js","./elevationInfoUtils-BC_66_Fg.js","./unitConversionUtils-BMfW9yAe.js","./lengthUtils-DL1-FDQQ.js","./calcite-scrim-B8_2DHG_.js","./scrim-DPa2aeKh.js","./jsxFactory-CJa39Fro.js","./uuid-fwrPAdZb.js","./locale-A4FuYD8q.js","./dom-D_AJDzAj.js","./key-D63ExP77.js","./observers-D2xgmA06.js","./t9n-D0ry3MEw.js","./loader-C-zIPscB.js","./calcite-button-D_Agetwz.js","./button-9P4PM9SO.js","./form-BZPQ5PUM.js","./interactive-y84HQRWL.js","./label-DEe8AW1C.js","./component-6CIDVndn.js","./loadable-DM18hPdE.js","./icon-BQO9J86c.js","./calcite-notice-DSp0z_Oh.js","./conditionalSlot-R5D9krYS.js","./resources2-DjkgwdyM.js","./openCloseComponent-CmOrfBN-.js","./calcite-accordion-DaRc_LTx.js","./calcite-accordion-item-COQjIRwk.js","./calcite-icon-Cu0W9dtm.js","./calcite-loader-DP4PIFO8.js","./calcite-flow-item-B0xZ0mWX.js","./panel-BdAbXPwM.js","./action-menu-C6uYzPu-.js","./array-BMcQdnYi.js","./action-D0Er9Ef6.js","./popover-Q5ruM4hh.js","./floating-ui-Bma_zPVt.js","./debounce-BOqmhDXu.js","./focusTrapComponent-BSUg_DLj.js","./Heading-D7P0OjYI.js","./FloatingArrow-BBdsG5MP.js","./calcite-flow-BrE9BG4l.js","./calcite-list-C4jOVpC-.js","./resources4-DXHY1U7R.js","./utils3-BrU6GrkI.js","./filter-yN6-jZOU.js","./input2-BReyTnf4.js","./Validation-Bz9yoU6e.js","./input-j1u1wOBY.js","./input-message-CWvsvdFk.js","./progress-BXyickl_.js"])))=>i.map(i=>d[i]);
import{_ as T}from"./index-Bh2oEzTI.js";import{r as o}from"./tslib.es6-B3Jf3DVX.js";import{s as Pe}from"./intl-CChhNOV8.js";import{b as se,al as ai,s as be,C as xe,D as Le,j as ri,U as si,L as De,l as Ee,q as nt,i as oi,ao as vt,e as je,m as ni,u as li,Y as qe,z as di}from"./Accessor-BLX9ikPh.js";import{m as l,a as P,e as I,t as ee,g as ci,aQ as pi,a0 as lt,b as $,C as _t,n as j,O as Ze}from"./subclass-BZA_h8Db.js";import{watch as M,whenOnce as D,initial as re,syncAndInitial as ve,when as he,sync as Qe,on as J}from"./reactiveUtils-C5zUhJQJ.js";import{l as He,b as ui}from"./isSupportedObject-6I_Nw0mS.js";import{y as hi,I as mi}from"./Attachments-PCr7j7mL.js";import{Y as Vt,B as fi}from"./FeatureForm-CeOvUdRB.js";import{t as Ot,v as wi,o as gi,M as yi,m as vi}from"./FeatureTemplates-DPPfSCYd.js";import{p as _i,h as ki}from"./Spinner-CU_RHfq8.js";import{r as oe,n as m,l as Ke,s as dt,e as Ge,B as bi}from"./jsxFactory-CJa39Fro.js";import{d as Tt}from"./asyncUtils-CWX51uTe.js";import{V as Ae}from"./Collection-CEdjem1-.js";import{o as Pt}from"./Evented-BHRw9x22.js";import{h as Lt}from"./UpdatingHandles-GfwcIh5z.js";import ct from"./GraphicsLayer-i3FeUJ_n.js";import{e as Ye}from"./editableLayers-Cn9dHzhB.js";import{k as me,c as Fi,B as Mi,O as Ii,r as Ci,x as Ei}from"./layerUtils-BrNoooE9.js";import{a1 as Ai}from"./assets-C43MgM-v.js";import{u as $i,t as Ut,I as Wi}from"./SnappingManager-BJPyuu7J.js";import{d as Re}from"./Graphic-DsxsIjhH.js";import{r as kt}from"./uuid-fwrPAdZb.js";import{e as Si}from"./helpMessageUtils-M95XMmyR.js";import{_ as xt}from"./InputManager-Ba9xzDpe.js";import{s as Vi}from"./ReactiveMap-6CfRGOlR.js";import{e as ze}from"./screenUtils-_ZIvrt5o.js";import{d as Oi}from"./diffUtils-BP7jmOAy.js";import{j as Ti,I as Dt,_ as Ht}from"./fieldUtils-tmQlKvWo.js";import{o as Pi,r as Li}from"./drapedUtils-HWKOCxgF.js";import{m as Ui}from"./lengthUtils-DL1-FDQQ.js";import{a as xi,i as Di}from"./sizeVariableUtils-Cmcuvw-4.js";import{getRotationAngle as Hi,getSize as Ri}from"./visualVariableUtils-DX1kS9Se.js";import{u as Gi}from"./jsonUtils-Ds2Sqto-.js";import{L as Je}from"./symbolUtils-_AKSLEsP.js";import{e as Rt}from"./GraphicState-Ch3zkYKf.js";import{t as zi,s as Gt}from"./hitTestSelectUtils-UXJPjatw.js";import{c as pt}from"./SketchViewModel-BKa9ySXO.js";import{s as bt}from"./Queue-yu3bZ02p.js";import{h as zt}from"./HighlightHelper-BXjDLAgC.js";import{v as Ni}from"./elevationInfoUtils-BC_66_Fg.js";import{n as Bi}from"./layerViewUtils-DhFEu8Rd.js";import{W as ji,K as qi}from"./featureUtils-Do2jvOGL.js";import{s as Ne,P as Zi,O as Qi,Z as Ki}from"./Point-Cg0-ChZE.js";import{a as Yi}from"./infoFor3D-C0hFfS1m.js";import{l as Ji}from"./ViewingMode-Dodu7ZZk.js";import{Y as Xi}from"./featureFormUtils-Cdlj8laq.js";import{n as ut,k as ea,v as ta}from"./SnappingControls-ClZP8Zqn.js";import{n as ia,s as aa,r as ra}from"./FieldInput-fbsOoTKd.js";import{e as Xe,n as $e}from"./Heading-C-odFCu-.js";import{l as sa,m as oa,i as na}from"./uploadAssetErrors-CA2vkP4k.js";import{e as Ft}from"./globalCss-CZa70j6i.js";import{e as la}from"./vmEvent-D4Ubqkbq.js";import"./date-DlqISzcw.js";import"./jsonMap-0cxwUWs2.js";import"./locale-C9TlLpzi.js";import"./messages-OmQvZhAg.js";import"./shared-B3wH2qpO.js";import"./SimpleObservable-KocWTzVy.js";import"./SketchLabelOptions-DDQnGNSN.js";import"./angularMeasurementUtils-7e2vxqzG.js";import"./Cyclical-oTUX3aX7.js";import"./mathUtils-C4_ghTv4.js";import"./quantityUtils-D0GB2dMc.js";import"./vec2-maR1OrZI.js";import"./common-DQOJ18NT.js";import"./vec2f64-miziP1SN.js";import"./vec32-Dvg_eL9J.js";import"./vec3f64-BLpZdpfb.js";import"./projectVectorToVector-G2uWGoIb.js";import"./Extent-Bf3YTe7m.js";import"./Polyline-D9YkgmM_.js";import"./writer-DNAwXnhG.js";import"./projectBuffer-Bs7GwaPY.js";import"./geodesicConstants-DWQLYX7F.js";import"./projectPointToVector-GINIbYMz.js";import"./projection-B971H0Re.js";import"./geodesicUtils-FCYOaNwu.js";import"./geometry-D964gYQX.js";import"./unitFormatUtils-CZ2bRlFg.js";import"./ByteSizeUnit-BsxeN7wM.js";import"./cast-Bjksrh93.js";import"./AttachmentInfo-DMzNK0rO.js";import"./AttachmentQuery-BUlkjzkx.js";import"./attachmentUtils-CL0GU4LB.js";import"./legacyIcon-CEIp6Pa9.js";import"./compilerUtils-Dw3R0f-Z.js";import"./Promise-B2Hu02L7.js";import"./FeatureLayerBase-Ck7-w8TE.js";import"./Clonable-D3rtuBWg.js";import"./formUtils-ylzKAM7E.js";import"./Field-ybkHhtnK.js";import"./enumeration-Ba5njXdz.js";import"./fieldType-BuzM0UHS.js";import"./PopupTemplate-BHMhS05j.js";import"./Color-BCS62Hs5.js";import"./colorUtils-0bJDPow9.js";import"./ActionToggle-iT4slXc7.js";import"./Identifiable-B1UbsKNt.js";import"./layerContainerType-C5CzMsLd.js";import"./HeightModelInfo-9nOoV6LU.js";import"./arcgisLayerUrl-BX1FE5Hm.js";import"./persistableUrlUtils-fa1mAujs.js";import"./commonProperties-CPyIG_-u.js";import"./ElevationInfo-CA5m_tHv.js";import"./unitConversionUtils-BMfW9yAe.js";import"./AttributeTableTemplate-BZeVyq-j.js";import"./opacityUtils-C68Tlu6_.js";import"./featureLayerUtils-DBsQMhTm.js";import"./symbols-CNimns--.js";import"./TextSymbol-D8QO_KUV.js";import"./materialUtils-DarhapKC.js";import"./aaBoundingBox-BE7cC1jD.js";import"./collectionUtils-D_lHIu88.js";import"./Portal-C10FKnaA.js";import"./Loadable-BabW5Xcc.js";import"./featureQueryAll-DnVoEjkM.js";import"./Query-5Xpquc1r.js";import"./jsonUtils-CEfjT-BK.js";import"./DataLayerSource-BKkswDvG.js";import"./FullTextSearch-Csd1Hktu.js";import"./TimeExtent-DocT5yPf.js";import"./timeUtils-8fb_2oAt.js";import"./SimpleRenderer-BV2L9G_n.js";import"./UniqueValueRenderer-BQtAHUSo.js";import"./colorRamps-pKd7I5WZ.js";import"./SizeVariable-936USOrb.js";import"./ColorStop-Dk3U5tCk.js";import"./RendererLegendOptions-B-4se3aU.js";import"./styleUtils-BYTm14n3.js";import"./RelationshipQuery-DPPNeuLK.js";import"./LayerFloorInfo-CIQjg5Vk.js";import"./Relationship-COPq3qM4.js";import"./serviceCapabilitiesUtils-DAE5z8FP.js";import"./arcade-G0NwyxZJ.js";import"./TimeOnly-DOn_Hy89.js";import"./UnknownTimeZone-BkowvBs8.js";import"./ImmutableArray-BPVd6ESQ.js";import"./FeatureLayer-wa_7EIxE.js";import"./ClassBreaksRenderer-BuHwSyVK.js";import"./jsonUtils-DxpLMo6d.js";import"./LRUCache-B_PHMSGm.js";import"./MemCache-Dx1v3xLC.js";import"./Version-BSlAgupz.js";import"./FieldsIndex-DpwHKAMX.js";import"./OverrideHelper-ti072FkP.js";import"./colorUtils-aL8wj-8G.js";import"./vec42-YcqnINSP.js";import"./vec4f64-o2zAXfmz.js";import"./utils-D2PLyMFF.js";import"./enums-CmIX1y88.js";import"./quantizationUtils-uj_P09aO.js";import"./HeatmapColorStop-BJc5nbwr.js";import"./heatmapUtils-Dwiv9IEa.js";import"./MultiOriginJSONSupport-B5nfqtQh.js";import"./Layer-CVt7Hb5J.js";import"./workers-D4HfeYKj.js";import"./editsZScale-Bs7_pSzI.js";import"./queryZScale-w66xFVGx.js";import"./FeatureSet-BHEkYP03.js";import"./APIKeyMixin-Di9kcRBS.js";import"./ArcGISService-B5qxetOY.js";import"./BlendLayer-CXM4n_Ge.js";import"./jsonUtils-CSnQD004.js";import"./parser-CTsgEym6.js";import"./utils-93yNk4Xc.js";import"./mat4f32-DcsiF_Rp.js";import"./mat4-GpOFENPA.js";import"./CustomParametersMixin-B4u7wiBT.js";import"./EditBusLayer-DoTks2sU.js";import"./FeatureEffectLayer-CpM66wLd.js";import"./FeatureEffect-BEzQmzeC.js";import"./FeatureFilter-BMHRQSxq.js";import"./FeatureReductionLayer-Ddbk727V.js";import"./FeatureReductionSelection-7vaL4DYT.js";import"./labelingInfo-DYPSPZCH.js";import"./labelUtils-B8petyBk.js";import"./defaults-DZ1kfMRx.js";import"./defaultsJSON-GKolV7NZ.js";import"./MD5-C9MwAd2G.js";import"./OperationalLayer-CVyVfSPu.js";import"./OrderedLayer-C5VLMHgA.js";import"./OrderByInfo-IYmS1EXF.js";import"./PortalLayer-CKja4bdW.js";import"./PortalItem-DzgXrpyc.js";import"./portalItemUtils-BzVoFAku.js";import"./RefreshableLayer-D7lXUJRS.js";import"./ScaleRangeLayer-Bb8Ig1Hz.js";import"./TemporalLayer-Dpq2hKKV.js";import"./TimeInfo-LUiaSFyX.js";import"./TimeInterval-CNlkea1s.js";import"./FeatureTemplate-CssMa1yk.js";import"./FeatureType-C0q_coeM.js";import"./fieldProperties-Cgxj08ZE.js";import"./versionUtils-CQ_WhYSP.js";import"./styleUtils-KMFBtb6u.js";import"./popupUtils-BBuPGAHd.js";import"./AlphaCutoff-UcccL64p.js";import"./interfaces-CL2NbQte.js";import"./FeatureRelationshipViewModel-BPfZSJYn.js";import"./ReactiveSet-BU2iaegS.js";import"./AnchorElementViewModel-DhGwA7fN.js";import"./GraphicsCollection-FfahqxsR.js";import"./catalogUtils-DyGHPM81.js";import"./keybindings-DoOdil3D.js";import"./utils-BpB3MnW1.js";import"./plane-IENfwZlB.js";import"./mat3f64-BBpwCtoL.js";import"./mat4f64-Dk4dwAN8.js";import"./quatf64-CCm9z-pX.js";import"./mathUtils-BG-eq9fO.js";import"./sphere-C77djCO6.js";import"./mat3-BRl2i9Bz.js";import"./geometry2dUtils-DdyQE7AQ.js";import"./viewUtils-DrPohWV3.js";import"./signal-D4lghLjV.js";import"./utils-Ce7L3imC.js";import"./cimSymbolUtils-DXvZxabN.js";import"./mat2df32-orApM5a3.js";import"./mat2d-D9DBP-jx.js";import"./webStyleSymbolUtils-CwdsUGtV.js";import"./devEnvironmentUtils-CnNDiFMM.js";import"./layerUtils-BS1Di3Pm.js";import"./screenUtils-WcqhHU65.js";import"./utils-BwQ00KBJ.js";import"./Basemap-DVYOaWHz.js";import"./loadAll-B6mYSptb.js";import"./writeUtils-Dz7BsE1e.js";import"./directionModeIcons-Br5woIHu.js";import"./layerListUtils-Cb_jjipP.js";import"./LayerListViewModel-C5g5Lp46.js";import"./utils-BQBvadb7.js";import"./ListItem-D2lt9R2a.js";import"./widget-DwhGPDuv.js";const ne="esri-editor",le={base:ne,helpMessage:`${ne}__help-message`,updateActions:`${ne}__update-actions`,updateActionsList:`${ne}__update-actions-list`,featureTemplatesContainer:`${ne}__feature-templates-container`,templateItemContentEnd:`${ne}__template-item-content-end`};function da(e){return e==null?null:JSON.stringify(e)}let Q=class extends se{constructor(t){super(t),this._stagedForDelete=!1,this.feature=null,this.initialFeature=null}get attributesModified(){var t,i;return!ca((t=this.initialFeature)==null?void 0:t.attributes,(i=this.feature)==null?void 0:i.attributes)}get geometryModified(){return this._stringifyGeometry(this.feature)!==this._stringifyGeometry(this.initialFeature)}get stagedForDelete(){return this._stagedForDelete}get modified(){return this.attributesModified||this.geometryModified||this._stagedForDelete}stageDelete(){this._stagedForDelete=!0}unstageDelete(){this._stagedForDelete=!1}trackChanges(t=this.feature){this.initialFeature=t==null?void 0:t.clone()}updateAttributes(t){const{feature:i}=this;i&&(i.attributes=t,this.notifyChange("attributesModified"))}updateGeometry(t){const{feature:i}=this;i&&(i.geometry=t,this.notifyChange("geometryModified"))}_stringifyGeometry(t){const i=t==null?void 0:t.geometry;return da((i==null?void 0:i.type)==="mesh"?{transform:i.transform,vertexSpace:i.vertexSpace}:i)}};function ca(e,t){const i=e??{},a=t??{},r=new Set(Object.keys(i));ai(r,Object.keys(a));for(const s of r)if(!pa(i[s],a[s]))return!1;return!0}function pa(e,t){return!(!Mt(e)||!Mt(t))||e===t}function Mt(e){return e==null||e===""}o([l()],Q.prototype,"_stagedForDelete",void 0),o([l()],Q.prototype,"attributesModified",null),o([l()],Q.prototype,"feature",void 0),o([l()],Q.prototype,"geometryModified",null),o([l()],Q.prototype,"initialFeature",void 0),o([l()],Q.prototype,"modified",null),Q=o([P("esri.widgets.Editor.Edits")],Q);let B=class extends se{constructor(t){super(t),this.creationInfo=null,this.editorItem=null,this.parent=null,this.sketchOptions=null,this.snappingManager=null,this.viewModel=null,this.upload=null,this._pendingEdits=new Vi}get pendingFeatures(){return new Ae([...this._pendingEdits.keys()])}addPendingFeature(t,i=t){const{_pendingEdits:a}=this;if(a.has(t))return a.get(t);const r=new Q({feature:t});return r.trackChanges(i),a.set(t,r),r}getEditsForPendingFeature(t){return this._pendingEdits.get(t)}removePendingFeature(t){const{_pendingEdits:i}=this,a=i.get(t);a&&(a.destroy(),i.delete(t))}};o([l()],B.prototype,"creationInfo",void 0),o([l()],B.prototype,"editorItem",void 0),o([l()],B.prototype,"parent",void 0),o([l()],B.prototype,"pendingFeatures",null),o([l({constructOnly:!0})],B.prototype,"sketchOptions",void 0),o([l()],B.prototype,"snappingManager",void 0),o([l()],B.prototype,"viewModel",void 0),o([l()],B.prototype,"upload",void 0),B=o([P("esri.widgets.Editor.CreateFeaturesWorkflowData")],B);function ua(e){return e.type==="update"}function ht(e){const t=e.sourceLayer;if(!t||t.type!=="feature"||!ga(t.renderer))return{rotation:null,size:null};let i=null,a=null;const r=t.renderer.getVisualVariablesForType("rotation").filter(n=>(!n.axis||n.axis==="heading")&&n.field&&!n.valueExpression&&Hi(n,e)!=null);r.length===1&&(i=ha(r[0],t));const s=t.renderer.getVisualVariablesForType("size").filter(n=>n.field&&!n.useSymbolValue&&!n.valueExpression&&xi(n)===Di.RealWorldSize&&Ri(n,e)!=null);return s.length===1&&(a=wa(s[0],t)),{rotation:i,size:a}}function ha(e,t){const i=(e.axis||"heading")==="heading"&&e.rotationType==="arithmetic"?-1:1,a=e.field,r=t.fields&&t.fields.filter(d=>d.name===a),s=r&&r.length===1?r[0].type:"double",n={initial:0,current:0};return{field:a,fieldType:s,getDefault:()=>Promise.resolve(0),getValue:d=>(n.current=n.initial-i*d,et((n.current+360)%360,s)),setInitialValue:d=>{n.initial=d,n.current=0},isUpdatingInteractively:!1,rotationType:e.rotationType??"geographic"}}function ma(e,t){switch(t){case"width":return e[0];case"depth":return e[1];case"height":return e[2];default:return e[2]||e[1]||e[0]}}async function fa(e,t,i){if(t==null)return 0;const{symbol:a}=Gi(t);if(a==null||a.type==="web-style"||a.type==="cim")return 0;const r=a.symbolLayers.at(0);if(!r)return 0;switch(r.type){case"icon":{const{computeIconLayerResourceSize:s}=await T(()=>import("./symbolLayerUtils-NZlhZ9vt.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43]),import.meta.url);return r.size||Math.min(Y.icon,(await s(r,Y.icon))[0])||Y.icon}case"text":return r.size||Y.text;case"line":return r.size||Y.line;case"object":{const{computeObjectLayerResourceSize:s}=await T(()=>import("./symbolLayerUtils-NZlhZ9vt.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43]),import.meta.url);return ma(await s(r,e.scale/Y.viewScaleSizeFactor),i)}case"path":return(r.width!=null?r.width:r.height)||e.scale/Y.viewScaleSizeFactor;case"extrude":return r.size||e.scale/Y.viewScaleSizeFactor;default:return 0}}function wa(e,t){const i=e.field,a=e.axis,r=t.fields&&t.fields.filter(p=>p.name===i),s=r&&r.length===1?r[0].type:"double",n={initial:0,current:0},d=Ui[e.valueUnit]??1;let c;return c=e.valueRepresentation==="area"?p=>(p*d/2)**2*Math.PI:e.valueRepresentation==="radius"||e.valueRepresentation==="distance"?p=>p*d/2:p=>p*d,{field:i,fieldType:s,getDefault:async(p,h)=>et(c(await fa(h,p,a)),s),getValue:(p,h)=>(n.initial||(n.initial=h.pixelSizeAt(h.center)),n.current=n.initial*p,et(n.current,s)),setInitialValue:p=>{n.initial=p,n.current=0},isUpdatingInteractively:!1,displayUnit:Va(e.valueUnit),axis:e.axis}}function et(e,t){switch(t){case"small-integer":case"integer":case"long":return Math.round(e);case"double":case"single":return e;default:return 0}}function ga(e){switch(e==null?void 0:e.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":case"pie-chart":return!0;default:return!1}}async function K(e,t,i){const a=await Je(e,{useSourceLayer:!0,ignoreGraphicSymbol:!0,webStyleCache:t,scale:i});Oi(e.symbol,a)!=null&&(e.symbol=a)}function ya(e){if(!e)throw new Error("no geometry type");return e==="multipatch"?"mesh":e}async function va(e,t,i){const a=t.layer,r=Nt(t);let s=null;const{view:n}=e,d=(n==null?void 0:n.type)==="2d";if(await It(e,a,r,i,d?n.scale:null),d){const h=xe(u=>It(e,a,r,i,u));s=M(()=>n.scale,u=>h(u))}const{data:c,editing:p}=a.capabilities;return e.layer.elevationInfo=a.elevationInfo,t.geometryToPlace==null?await e.create(ya(a.geometryType),{graphicProperties:{attributes:r,sourceLayer:a},hasZ:c.supportsZ,defaultZ:(d?p.zDefault:null)??e.defaultCreateOptions.defaultZ}):await e.place(t.geometryToPlace,{graphicProperties:{attributes:r,sourceLayer:a}}),s??I()}function Nt(e){var t;return{...(t=e.template)==null?void 0:t.prototype.attributes,...e.attributeOverrides}}async function It(e,t,i,a,r){const s=new Re({sourceLayer:t,attributes:i}),{rotation:n,size:d}=ht(s);let c=await Je(s,{useSourceLayer:!0,webStyleCache:a,scale:r}),p=!1;for(const h of[d,n])h!=null&&i[h.field]==null&&(i[h.field]=await h.getDefault(c,e.view),p=!0);switch(p&&(c=await Je(s,{useSourceLayer:!0,webStyleCache:a,scale:r})),c==null?void 0:c.type){case"simple-fill":case"polygon-3d":e.polygonSymbol=c;break;case"simple-line":case"line-3d":e.polylineSymbol=c;break;case"simple-marker":case"picture-marker":case"point-3d":case"cim":e.pointSymbol=c;break;case"mesh-3d":e.meshSymbol=c}Bt(e.tooltipOptions,d,n)}function Bt(e,t,i){e.visualVariables=t!=null||i!=null?{size:t!=null?{unit:t.displayUnit,axis:t.axis,valueType:t.fieldType}:null,rotation:i!=null?{valueType:i.fieldType,rotationType:i.rotationType??"geographic"}:null}:null}function _a(e,t){return e==null?void 0:e.find(i=>i.layer===t)}async function ka(e,t,i,a){switch(t.type){case"3d":return ba(e,t,i,a);case"2d":return Fa(e,t,i,a)}}async function ba(e,t,i,a){if(e.length===0)return[];const{updatable:r,graphicsByLayer:s}=await i.async(async()=>{const{results:n}=await Le(zi(t,i),a),d=new Map,c=h=>{const u=h.layer,f=d.get(u);if(!f){const g=new Array;return d.set(u,g),g}return f};Gt(n).forEach(({graphic:h})=>c(h).push(h));const p=e.filter(({capabilities:h,layer:u})=>h.update.enabled&&d.has(u));return p.length!==0&&i.stopPropagation(),{updatable:p,graphicsByLayer:d}});return Le(Promise.allSettled(r.map(async({layer:n})=>{const d=s.get(n),c=jt(n);if(d.every(u=>Ti(c,u)))return d;const p=[];for(const u of d){p.push(u.getObjectId());const f=Object.keys(u.attributes);pi(c,f)}const h=n.createQuery();return h.returnGeometry=!1,h.objectIds=p,h.outFields=Dt(n.fieldsIndex,c),n.queryFeatures(h,{signal:a}).then(({features:u})=>u)})),a)}async function Fa(e,t,i,a){if(e.length===0)return[];const{mapPoint:r}=i;if(r==null)return[];let s=null;const n=await i.async(async()=>{const{results:d}=await Le(t.hitTest(i),a);if(d.length===0)return[];const c=new Set;s=Gt(d),s.forEach(({graphic:h})=>h&&c.add(h.layer));const p=e.filter(h=>c.has(h.layer)&&h.supportsUpdateWorkflow);return p.length>0&&i.stopPropagation(),p});return Le(Promise.allSettled(n.map(async({layer:d})=>{const c=d.createQuery();c.returnGeometry=!1,c.outFields=jt(d);const p="renderer"in d?Pi({renderer:d.renderer,pointerType:i.pointerType}):0;c.geometry=Li(r,p,t),c.outSpatialReference=t.spatialReference;const{features:h}=await d.queryFeatures(c,{signal:a});return s==null||s.forEach(({graphic:u})=>{u.layer!==d||h.some(f=>f.getObjectId()===u.getObjectId())||h.push(u)}),h})),a)}function jt(e){return Dt(e.fieldsIndex,[e.objectIdField,Ht({displayField:"displayField"in e?e.displayField:null,fields:e.fields})])}async function Ma(e,t,i){const{sourceLayer:a}=e,r=a.createQuery();r.objectIds=[e.getAttribute(a.objectIdField)],r.outFields=["*"],r.returnM=a.capabilities.data.supportsM,r.returnZ=a.capabilities.data.supportsZ,a.type==="scene"&&a.infoFor3D!=null||(r.outSpatialReference=t);const s=await a.queryFeatures(r,{signal:i});return be(i),s.features[0]}async function We(e){var h;const{graphic:t,sketchViewModel:i,sourceLayer:a,visualVariables:r,webStyleCache:s}=e;let n=!1;const{rotation:d,size:c}=r;if([d,c].forEach(async u=>{if(u==null)return;const f=t.getAttribute(u.field);if(f!=null)u.setInitialValue(f);else{const g=await u.getDefault(t.symbol,i.view);u.setInitialValue(g),t.setAttribute(u.field,g),n=!0}}),n){const u=((h=i.view)==null?void 0:h.type)==="2d"?i.view.scale:null;await K(t,s,u)}const p={multipleSelectionEnabled:!1};return a.geometryType==="point"&&(p.enableRotation=d!=null,p.enableScaling=c!=null),Bt(i.tooltipOptions,c,d),i.layer.elevationInfo=a.elevationInfo,i.update(t,p)}function Ia(e){return e==null||e.type!=="rotate-start"&&e.type!=="rotate"&&e.type!=="rotate-stop"?null:e}function Ca(e){return e==null||e.type!=="scale-start"&&e.type!=="scale"&&e.type!=="scale-stop"?null:e}async function qt(e,t,i,a,r){var p;if(t.geometry==null||((p=t.geometry)==null?void 0:p.type)!=="point")return;const s=a.rotation,n=Ia(i.toolEventInfo);if(s!=null&&n!=null){const{field:h,getValue:u}=s;n.type==="rotate-stop"?(s.isUpdatingInteractively=!1,s.setInitialValue(t.getAttribute(h))):(s.isUpdatingInteractively=!0,t.setAttribute(h,u(n.angle,e)))}const d=a.size,c=Ca(i.toolEventInfo);if(d!=null&&c!=null){const{field:h,getValue:u}=d;c.type==="scale-stop"?(d.isUpdatingInteractively=!1,d.setInitialValue(t.getAttribute(h))):(d.isUpdatingInteractively=!0,t.setAttribute(h,u(c.xScale,e)))}await K(t,r,e.type==="2d"?e.scale:null)}async function Ea({feature:e,featureClone:t,visualVariableAttributes:i,sketchViewModel:a,view:r,onUpdate:s,webStyleCache:n,addUpdatingPromise:d,addHandle:c}){var _;await K(t,n,r.type==="2d"?r.scale:null);let p=null;if(((_=a==null?void 0:a.view)==null?void 0:_.type)==="2d"){const F=xe(C=>K(t,n,C));p=M(()=>{var C;return(C=a==null?void 0:a.view)==null?void 0:C.scale},C=>F(C))}const h=t.sourceLayer,u=we(r,h);await We({graphic:t,sketchViewModel:a,sourceLayer:h,visualVariables:i,webStyleCache:n});let f=null;u.then(F=>f=F).catch(()=>{});const g=i.size,w=i.rotation,k=M(()=>e.attributes,async F=>{let C=!1;for(const V in F){const N=F[V];N!==t.getAttribute(V)&&(t.setAttribute(V,N),g==null||g.isUpdatingInteractively||g.field!==V||g.setInitialValue(N),w==null||w.isUpdatingInteractively||w.field!==V||w.setInitialValue(N),(f==null||f.requiredFields.includes(V))&&(C=!0))}C&&await K(t,n,r.type==="2d"?r.scale:null)}),v=a.on("update",async F=>{const C=F.graphics[0],V={graphic:C,sketchViewModel:a,sourceLayer:h,visualVariables:i,webStyleCache:n};if(F.state==="complete"){if(r.activeTool===null)return We(V);const N=new AbortController,Me=lt(N);return c(Me),d(D(()=>r.activeTool===null,N.signal).then(()=>(N.abort(),We(V))))}await qt(r,C,F,i,n),s(tt(C),F)}),E=a.on(["undo","redo"],async F=>{s(tt(F.graphics[0]),F)});return ee([E,v,I(()=>a.cancel()),k,p])}async function Aa(e,t,i){const a=e.view;e.layer.add(i);const r=t.sourceLayer,s=t.layer,n=t.getAttribute(s.objectIdField);let d=null;function c(p){d==null||d.abort(),d=Tt(async h=>{var f;const u=await we(a,r);be(h),(f=u.setVisibility)==null||f.call(u,n,p)})}return await Wa(a,i),c(!1),ee([$a(a,i,p=>c(!p)),I(async()=>{c(!0);try{const p=await we(a,r);await D(()=>!p.updating)}finally{e.layer.remove(i)}})])}function $a(e,t,i){if(e.type==="3d"){const a=new Rt({graphic:t});return ee([e.trackGraphicState(a),M(()=>a.displaying,i)])}return M(()=>t.visible,i)}async function Wa(e,t){if(e.type==="3d"){const i=new Rt({graphic:t}),a=e.trackGraphicState(i);await D(()=>i.displaying||i.error),a.remove()}else await D(()=>t.visible)}const Y={icon:ze(24),text:ze(12),line:ze(1),viewScaleSizeFactor:100};function Zt(e,t,i){let a=!1;return e.filter(r=>!!a||(a=r===t,a)).map(r=>i[r]())}function Sa(e,t){e.viewModel.syncFeatureTemplates();const i=e.creationInfo;if(t[0].id==="awaiting-feature-creation-info"&&i){const a=i.layer,r=Ot(a);r.length===1&&a.type!=="scene"&&(i.template=r[0],t.shift())}return t}function Va(e){return e==="unknown"?null:e}function Oa(e){e.filesEnabled=!0,e.mode="view",e.capabilities={editing:!0,operations:{add:!0,update:!0,delete:!0}}}const Qt=e=>/-stop/.test(e)||/vertex-/.test(e),we=(e,t)=>{const i=t.type==="subtype-sublayer"?t.parent:t;return e.whenLayerView(i)};function Ta(e){return"createInteractiveEditSession"in e}function tt(e){var i;const t=e.geometry;if((t==null?void 0:t.type)==="mesh"){const a=e.cloneShallow();return a.attributes=ci(e.attributes),a.geometry=t.cloneShallow(),a.geometry.transform=((i=t.transform)==null?void 0:i.clone())??null,a}return e.clone()}function it(e){const t=e.cursor;return e.cursor="progress",I(()=>e.cursor=t)}async function Pa({view:e,data:t,signal:i,next:a,cancel:r}){const{creationInfo:s}=t;if(!s)return I();if(!_e(s))return I();const{layer:n}=s,d=s.geometryToPlace!=null;if(s.geometryToPlace=null,d)return r(),I();const{Upload:c}=await T(()=>import("./Upload-Bw44XHih.js"),__vite__mapDeps([44,5,6,4,43,12,13,14,3,1,2,15,45,36,9,11,16,17,46,47,48,49]),import.meta.url);be(i);const p=new c;t.upload=p;let h=null;const u=()=>h==null?void 0:h.remove(),f=ee([M(()=>p.state,g=>{switch(g){case"default":case"error":u();break;case"pending":u(),h=it(e);break;case"success":{s.maxFeatures=1;const{result:w}=p;(w==null?void 0:w.type)==="georeferenced"||(w==null?void 0:w.type)==="georeferenced-reprojected"?(s.geometryToPlace=w.mesh,s.initialFeature=new Re({attributes:Nt(s),geometry:w.mesh,sourceLayer:n}),e.goTo(s.initialFeature,{animate:!1}).catch(ri)):s.geometryToPlace=w==null?void 0:w.mesh,u(),a();break}}}),I(()=>{p.cancel(),u()})]);return p.uploadTo(n),f}function _e(e){const t=e==null?void 0:e.layer;return(t==null?void 0:t.type)==="scene"}let A=class extends Pt.EventedAccessor{constructor(t){super(t),this._indexHistory=[],this._lastStepIndex=-1,this._stepIndex=-1,this._updatingHandles=new Lt,this._handleKeys={afterCommit:"after-commit",beforeCommit:"before-commit"},this.data=void 0,this.started=!1,this.steps=[],this.type=null,this._pendingOperation=null}destroy(){this._updatingHandles.destroy()}get hasNextStep(){const{steps:t}=this;return!!(t&&this._stepIndex<t.filter(i=>!i.parent).length-1)}get hasPreviousStep(){return this._stepIndex>0}get reliesOnOwnerAdminPrivileges(){return!1}get hasInvalidFormTemplate(){return!1}get shouldShowAttachments(){return!1}get shouldAllowAttachmentEditing(){return!1}get stepId(){const{steps:t}=this,i=t&&t[this._stepIndex];return i&&i.id}get helpMessage(){}get hasPendingEdits(){return!1}get keyboardCancellationEnabled(){return!0}get updating(){return this._updatingHandles.updating}async back(t=()=>Promise.resolve(!0)){this.hasPendingEdits&&!await t()||(this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0}))}async cancel(t={force:!0}){return t.force!==!1?this._cancel(t):new Promise((i,a)=>{this.emit("cancel-request",{controller:{allow:()=>{this._cancel({...t,force:!0}).then(i)},deny:()=>a(new $("workflow:cancel-denied","Request to cancel workflow was denied."))}})})}async commit(){this.removeHandles(this._handleKeys.beforeCommit),this.onCommit&&await this.onCommit(this.data),this.removeHandles(this._handleKeys.afterCommit),this.emit("commit")}async go(t){const{steps:i}=this,a=i.findIndex(r=>r.id===t);this._indexHistory.push(this._stepIndex),await this._go(a)}async next(){this._indexHistory.push(this._stepIndex),await this._go(this._stepIndex+1)}async previous(t={cancelCurrentStep:!1}){await this._go(this._indexHistory.pop(),t.cancelCurrentStep)}async reset(){await this._cancel({emitCancelEvent:!1}),await this.start()}async save(){await this.commit(),await this.reset()}async start(){this._set("started",!0);const t=this._stepIndex===-1?0:this._stepIndex;await this._go(t)}async _cancel({emitCancelEvent:t=!0,error:i}={}){this.started&&(this._set("started",!1),await this._transaction(()=>{var a;return(a=this.steps[this._stepIndex])==null?void 0:a.tearDown({canceled:!0})})),this.removeHandles([this._handleKeys.afterCommit,this._handleKeys.beforeCommit]),this._resetIndexing(t),t&&this.emit("cancel",{error:i})}_go(t=-1,i=!1){return this._transaction(async()=>{const{steps:a}=this;if(!(t<=-1||t>=a.length)){if(!this.started)return this._stepIndex=t,void this._notifyStepProps();this._lastStepIndex>-1&&await a[this._lastStepIndex].tearDown({canceled:i});try{await a[t].setUp()}catch(r){si(r)}this._lastStepIndex=t,this._stepIndex=t,this._notifyStepProps()}})}async _transaction(t){const i=this._pendingOperation,a=De(),r=(i??Promise.resolve()).then(()=>a.promise);this._pendingOperation=r,this._updatingHandles.addPromise(r);try{i&&await i,await t()}finally{a.resolve(),r===this._pendingOperation&&(this._pendingOperation=null)}}_resetIndexing(t=!0){this._stepIndex=-1,this._lastStepIndex=-1,this._indexHistory.length=0,t&&this._notifyStepProps()}_notifyStepProps(){this.notifyChange("stepId"),this.notifyChange("hasPreviousStep"),this.notifyChange("hasNextStep")}};o([l()],A.prototype,"data",void 0),o([l()],A.prototype,"hasNextStep",null),o([l()],A.prototype,"hasPreviousStep",null),o([l()],A.prototype,"onCommit",void 0),o([l()],A.prototype,"reliesOnOwnerAdminPrivileges",null),o([l()],A.prototype,"hasInvalidFormTemplate",null),o([l()],A.prototype,"shouldShowAttachments",null),o([l()],A.prototype,"shouldAllowAttachmentEditing",null),o([l()],A.prototype,"started",void 0),o([l({readOnly:!0})],A.prototype,"stepId",null),o([l()],A.prototype,"steps",void 0),o([l({readOnly:!0})],A.prototype,"type",void 0),o([l()],A.prototype,"helpMessage",null),o([l()],A.prototype,"hasPendingEdits",null),o([l()],A.prototype,"keyboardCancellationEnabled",null),o([l()],A.prototype,"updating",null),A=o([P("esri.widgets.Editor.Workflow")],A);const mt=A;var Se;const Be=Symbol(),de=Symbol(),Ie=Symbol(),Ct=Symbol();let W=Se=class extends mt{constructor(e){super(e),this.type="create-features",this.createFeatureState="create-new",this.data=void 0,this.isNested=!1,this._getDrawMeshHelpMessage=void 0,this._featureFormHandle=null,this._visualVariableAttributes={rotation:null,size:null},this._featureFormViewModel=new Vt,this._sketchViewModel=null,this._attachmentFileInfos=new Map,this._highlightHandles=new Map,this._preventDefaultActionOnCancel=!1,this._lastActiveGraphics=[],this._isActive=!0,this._updateGraphicDebounced=xe((t,i,a)=>K(t,i,a))}initialize(){this.isNested&&(this._isActive=!1),this._initializeSketchViewModel()}destroy(){this._sketchViewModel.destroy()}get featureFormViewModel(){return this._featureFormViewModel}get hasPendingEdits(){var s,n;if(this.pendingFeatures.some(d=>{var c;return!!((c=this.data.getEditsForPendingFeature(d))!=null&&c.modified)}))return!0;const{creationInfo:e,upload:t}=this.data,i=this._sketchViewModel,{activeComponent:a}=i,r=(n=(s=i.createGraphic)==null?void 0:s.geometry)==null?void 0:n.type;return!(r!=="polyline"&&r!=="polygon"&&r!=="multipoint"||(a==null?void 0:a.type)!=="draw-2d"&&(a==null?void 0:a.type)!=="draw-3d")&&a.drawOperation.committedVertices.length>0||!(!t||t.state!=="pending"&&t.state!=="success")||!!(e!=null&&e.geometryToPlace)}get helpMessage(){var r;const{creationInfo:e,viewModel:t}=this.data;if(this.stepId!=="creating-features"||!e)return;const i=e.layer.geometryType,a=this._sketchViewModel.createGraphic;if(i==="mesh"){this._getDrawMeshHelpMessage||T(()=>import("./helpMessageUtils3d-TaLw0ElD.js"),__vite__mapDeps([50,12,5,6,4,13,14,3,1,2,15,51,9,52,53,54,55]),import.meta.url).then(n=>{this._getDrawMeshHelpMessage=n.getDrawMeshHelpMessage});const{view:s}=t;return(s==null?void 0:s.type)==="3d"?(r=this._getDrawMeshHelpMessage)==null?void 0:r.call(this,a,s):void 0}return Si(i,a==null?void 0:a.geometry)}get layer(){var e;return(e=this.data.creationInfo)==null?void 0:e.layer}get numPendingFeatures(){return this.pendingFeatures.length}get parent(){return this.data.parent}get parentLayer(){var e;return(e=this.parent)==null?void 0:e.data.editorItem.layer}get pendingFeatures(){return this.data.pendingFeatures}get keyboardCancellationEnabled(){return this.numPendingFeatures===0}get reliesOnOwnerAdminPrivileges(){var e;return((e=this.data.editorItem)==null?void 0:e.capabilities.create.reliesOnOwnerAdminPrivileges)??!1}get shouldShowAttachments(){var e;return((e=this.data.editorItem)==null?void 0:e.capabilities.create.attachments.enabled)??!1}get shouldAllowAttachmentEditing(){return this.shouldShowAttachments}get sketchViewModel(){return this._sketchViewModel}get test(){}async enter(){this._isActive=!0,this.stepId!=="awaiting-feature-creation-info"&&this._setUpCreatingFeaturesStep()}exit(){this._isActive=!1,this.removeHandles([Ie])}async updatePendingFeature(e,t){return this._preventDefaultActionOnCancel=!0,this._sketchViewModel.cancel(),_t(this._lastActiveGraphics,e),this._startUpdating({feature:e,webStyleCache:t})}async start(){var e;return await super.start(),me((e=this.data.creationInfo)==null?void 0:e.layer)?null:{enter:async()=>{},exit:async()=>{},viewModel:this._sketchViewModel}}static create(e){const{addAttachmentsCallback:t,applyEditsCallback:i,isNested:a,creationInfo:r,parent:s,snappingManager:n,startAt:d,viewModel:c}=e,p=e.sketchOptions??new He,h=r==null?void 0:r.layer,u=h?c.findEditorItemForLayer(h):void 0,f=new Se({data:new B({creationInfo:r,editorItem:u,parent:s,sketchOptions:p,snappingManager:n,viewModel:c}),isNested:a,onCommit:async g=>{var C;const{creationInfo:w}=g;if(!w)return;const k=g.pendingFeatures.toArray(),{layer:v}=w,E=((C=v.capabilities)==null?void 0:C.editing.supportsGlobalId)&&"globalIdField"in v,_=f._attachmentFileInfos;if(E){const V=xa(k,v,_);return void await i(v,V,{globalIdUsed:!0})}const F=await i(v,{addFeatures:k});if(_.size>0){const V=(F==null?void 0:F.addFeatureResults)??[];await t(v,Ua(k,V,v,_))}}});return f._set("steps",this._createWorkflowSteps(f,d)),f}_fadeExistingFeatures(e){if("effect"in e){const i=e.effect;return e.effect="saturate(0.6) opacity(0.8)",I(()=>e.effect=i)}const t=e.opacity;return e.opacity=.7,I(()=>e.opacity=t)}_highlight(e){const t=this.data.viewModel.view;(t==null?void 0:t.type)==="3d"&&this._highlightHandles.set(e,t.highlight(e))}_removeHighlight(e){Ee(this._highlightHandles.get(e)),this._highlightHandles.delete(e)}async _startCreating(e){this.removeHandles(de);const{creationInfo:t}=this.data;if(!t)return;this.createFeatureState="create-new";const i=await va(this._sketchViewModel,t,e);this.addHandles(i,de)}async _startUpdating({feature:e,webStyleCache:t,initialFeature:i=e}){var E;const{data:a,pendingFeatures:r}=this;r.includes(e)||a.addPendingFeature(e,i);const{_featureFormViewModel:s,_sketchViewModel:n}=this,{creationInfo:d,viewModel:c}=a,{attachmentsViewModel:p,layerInfos:h,view:u}=c;if(!u||!d)return;const f=d.layer,g=_a(h,f),w=g==null?void 0:g.formTemplate,k=u.spatialReference;if(s.set({arcadeEditType:"INSERT",feature:e,formTemplate:w,spatialReference:k,map:u.map}),p.mode!=="add"&&p.mode!=="edit"||((E=c.activeWorkflow)==null||E.previous()),p.graphic=e,p.fileInfos.removeAll(),p.mode="view",(this._attachmentFileInfos.get(e)||[]).forEach(({file:_,form:F})=>p.addFile(_,F)),this._removeHighlight(e),await K(e,t,u.type==="2d"?u.scale:null),this.removeHandles(de),Ee(this._featureFormHandle),u.type==="2d"){const _=M(()=>u.scale,F=>this._updateGraphicDebounced(e,t,F));this.addHandles(_,de)}const v=a.getEditsForPendingFeature(e);return this._featureFormHandle=ee([s.on("value-change",async()=>{v==null||v.updateAttributes(s.getValues()),await K(e,t,u.type==="2d"?u.scale:null)}),n.on(["update","undo","redo"],_=>{(_.type==="undo"||_.type==="redo"||_.type==="update"&&_.toolEventInfo!=null&&Qt(_.toolEventInfo.type))&&s.notifyFeatureGeometryChanged()}),M(()=>{var _;return(_=s.feature)==null?void 0:_.sourceLayer},_=>e.sourceLayer=_)]),this.createFeatureState="update-pending",this._visualVariableAttributes=ht(e),me(f)?void 0:We({graphic:e,sketchViewModel:n,sourceLayer:f,visualVariables:this._visualVariableAttributes,webStyleCache:t})}static _createWorkflowSteps(e,t="awaiting-feature-creation-info"){const{data:i}=e,a=Zt(["awaiting-feature-creation-info","creating-features","adding-attachment","editing-attachment"],t,{"awaiting-feature-creation-info":()=>({id:"awaiting-feature-creation-info",async setUp(){const{creationInfo:r,viewModel:s}=i,{view:n}=s;n&&(_e(r)?e.addHandles(await Pa({view:n,data:i,next:()=>e.next(),cancel:()=>s.cancelWorkflow({warnIfNoWorkflow:!1})}),this.id):(i.parent&&r&&(e.addHandles(s.lockFeatureTemplatesViewModel(),this.id),s.featureTemplatesViewModel.layers=[r.layer]),e.addHandles(s.featureTemplatesViewModel.on("select",({item:d})=>{d&&(i.creationInfo={...i.creationInfo,layer:d.layer,template:d.template},e.next())}),this.id)))},async tearDown(){e.removeHandles([this.id,de])}}),"creating-features":()=>({id:"creating-features",async setUp(){e._isActive&&await e._setUpCreatingFeaturesStep()},async tearDown(r){const{viewModel:s}=i;r.canceled&&(e.removeHandles([Ie,Be,de,Ct]),s.attachmentsViewModel.fileInfos.removeAll(),e._attachmentFileInfos.clear())}}),"adding-attachment":()=>({id:"adding-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:r}=i.viewModel,{graphic:s,fileInfos:n}=r;e._attachmentFileInfos.set(s,n.toArray()),r.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:r}=i.viewModel,{graphic:s,fileInfos:n}=r;e._attachmentFileInfos.set(s,n.toArray()),r.mode="view"}})});return Sa(i,a)}static _configureSketchViewModel(e,t){const{data:i}=e,{creationInfo:a,viewModel:r}=i,{view:s}=r,n=e._sketchViewModel;let d=null;const c=[];if(!s)return I();s.type==="2d"&&a&&c.push(e._fadeExistingFeatures(a.layer));const p=async w=>{if(w.state==="cancel"){if(e._preventDefaultActionOnCancel)return void(e._preventDefaultActionOnCancel=!1);if(s.activeTool==null){if(e._lastActiveGraphics.length<1)return e._startCreating(t);const k=e._lastActiveGraphics.pop();return e._startUpdating({feature:k,webStyleCache:t})}return e._waitForActiveToolCleared().then(()=>e._startCreating(t))}if(w.state==="complete"&&w.graphic){const k=w.graphic.clone();return k.geometry=null,e._startUpdating({feature:w.graphic,webStyleCache:t,initialFeature:k})}},h=async w=>{var N,Me,gt;const{attachmentsViewModel:k}=r,{_featureFormViewModel:v}=e,E=w.graphics[0];if(w.state==="complete"){E!==d&&(e._lastActiveGraphics.push(E),e._highlight(E)),d=null;const{hasPendingSubtypeChoice:te,submittable:yt}=v;if(e.numPendingFeatures===(a==null?void 0:a.maxFeatures)||te||!yt){!yt&&v.submit();const ie=e._lastActiveGraphics.pop();return((N=r.view)==null?void 0:N.activeTool)===null?e._startUpdating({feature:ie,webStyleCache:t}):e._waitForActiveToolCleared().then(()=>e._startUpdating({feature:ie,webStyleCache:t}))}if(k.mode!=="add"&&k.mode!=="edit"||((Me=r.activeWorkflow)==null||Me.previous()),w.aborted&&e._preventDefaultActionOnCancel)return void(e._preventDefaultActionOnCancel=!1);if(e.addHandles([it(s),s.on("click",ie=>ie.preventDefault())],Be),await D(()=>!v.updating),e.removeHandles(Be),((gt=r.view)==null?void 0:gt.activeTool)!=null)return e._waitForActiveToolCleared().then(()=>{const ie=e._lastActiveGraphics.pop();if(ie)return e._startUpdating({feature:ie,webStyleCache:t})});e._startCreating(t)}w.state==="start"&&e._removeHighlight(E);const _=e._visualVariableAttributes;await qt(s,E,w,_,t);const F=E.attributes,{rotation:C,size:V}=_;if(C!=null){const{field:te}=C;v.setValue(te,F[te])}if(V!=null){const{field:te}=V;v.setValue(te,F[te])}},u=w=>{const k=w.graphics[0];i.removePendingFeature(k),_t(e._lastActiveGraphics,k),d=k},f=async w=>{if(_e(a))return;const{results:k}=await s.hitTest(w,{include:n.layer}),v=k.find(_=>_.type==="graphic"&&_.graphic.sourceLayer===(a==null?void 0:a.layer));if(!v)return;const E=v.graphic;if(n.activeTool==="transform"||n.activeTool==="reshape"){if(n.updateGraphics.at(0)===E)return;const{submittable:_,hasPendingSubtypeChoice:F}=e._featureFormViewModel;if(!_||F)return;await e.updatePendingFeature(E,t)}};c.push(n.on("create",w=>e._updatingHandles.addPromise(p(w))),n.on("update",w=>e._updatingHandles.addPromise(h(w))),n.on("delete",w=>u(w)),s.on("immediate-click",w=>e._updatingHandles.addPromise(f(w)),xt.TOOL),I(()=>{e._preventDefaultActionOnCancel=!0,n.cancel()}),La(n,i));const g=ee(c);return n.addHandles(g),g}_initializeSketchViewModel(){var r;const{data:e}=this,{view:t}=e.viewModel,i=new ct({elevationInfo:(r=e.creationInfo)==null?void 0:r.layer.elevationInfo,internal:!0,listMode:"hide"}),a=new pt({layer:i,sketchOptions:e.sketchOptions,snappingManager:e.snappingManager,updateOnGraphicClick:!1,view:t});this._sketchViewModel=a,t==null||t.map.add(i),this.addHandles(I(()=>{t!=null&&t.destroyed||(t==null||t.map.remove(i)),i.destroy()}))}async _setUpCreatingFeaturesStep(){var k;if(this.hasHandles(Ie))return;const{data:e}=this,{creationInfo:t,viewModel:i}=e,{attachmentsViewModel:a,view:r}=i;if(!r||!(t!=null&&t.layer))throw new $("missing-parameters","CreateFeaturesWorkflow requires a view and creationInfo.");this._preventDefaultActionOnCancel=!1;const{initialFeature:s,layer:n}=t,d=this._sketchViewModel,c=new Map,p=[];this._lastActiveGraphics=[],this._featureFormHandle=Ee(this._featureFormHandle),this._visualVariableAttributes={rotation:null,size:null},this.data.editorItem=i.findEditorItemForLayer(t.layer),Oa(a),p.push(M(()=>a.mode,v=>{switch(v){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}}));const h=it(r);p.push(h);const u=me(t.layer);try{if(u){const v=s??new Re({attributes:{...(k=t.template)==null?void 0:k.prototype.attributes,...t.attributeOverrides},sourceLayer:n});await this._startUpdating({feature:v,webStyleCache:c})}else p.push(Se._configureSketchViewModel(this,c)),s?(d.layer.add(s),await this._startUpdating({feature:s,webStyleCache:c})):await this._startCreating(c)}finally{h.remove()}const f=I(()=>{for(const v of e.pendingFeatures)d.layer.remove(v),e.removePendingFeature(v)}),g=M(()=>r==null?void 0:r.timeZone,v=>this._featureFormViewModel.timeZone=v,re),w=I(()=>{_e(t)&&i.cancelWorkflow({warnIfNoWorkflow:!1})});this._featureFormHandle&&p.push(this._featureFormHandle),this.addHandles(p,this._handleKeys.beforeCommit),this.addHandles([I(()=>a.fileInfos.removeAll()),ee(p),w,f,g],Ie)}async _waitForActiveToolCleared(){const e=this.data.viewModel.view;if((e==null?void 0:e.activeTool)==null)return;const t=new AbortController;this.addHandles(lt(t),Ct),await D(()=>(e==null?void 0:e.activeTool)==null,t.signal),t.abort()}};function La(e,t){let i=null;const a=()=>e.snappingOptions.featureSources,r=()=>(i=new $i({layer:e.layer}),a().add(i),i),s=()=>{i!=null&&(a().remove(i),i=nt(i))};return ee([M(()=>{var c;const n=(c=t.creationInfo)==null?void 0:c.layer,d=a().find(p=>p.layer===n);return{hasFeatureLayerSource:!!d,enabled:(d==null?void 0:d.enabled)??!1}},({hasFeatureLayerSource:n,enabled:d})=>{if(!n)return s();i??(i=r()),i.enabled=d},ve),I(s)])}function Ua(e,t,i,a){const r=[];return t.forEach((s,n)=>{if(!s.error){const d=e[n],c=a.get(d)||[];d.attributes[i.objectIdField]=s.objectId,c.forEach(({form:p})=>r.push({feature:d,attachment:p}))}}),r}function xa(e,t,i){const a=[],r=t.globalIdField;return e.forEach((s,n)=>{var d;(d=e[n].attributes)[r]??(d[r]=kt()),((i==null?void 0:i.get(s))||[]).forEach(({file:c})=>a.push({feature:s,attachment:{globalId:kt(),data:c}}))}),a.length?{addFeatures:e,addAttachments:a}:{addFeatures:e}}o([l()],W.prototype,"createFeatureState",void 0),o([l()],W.prototype,"data",void 0),o([l({constructOnly:!0})],W.prototype,"isNested",void 0),o([l()],W.prototype,"featureFormViewModel",null),o([l()],W.prototype,"hasPendingEdits",null),o([l()],W.prototype,"_getDrawMeshHelpMessage",void 0),o([l()],W.prototype,"helpMessage",null),o([l()],W.prototype,"layer",null),o([l()],W.prototype,"parent",null),o([l()],W.prototype,"parentLayer",null),o([l()],W.prototype,"keyboardCancellationEnabled",null),o([l()],W.prototype,"reliesOnOwnerAdminPrivileges",null),o([l()],W.prototype,"shouldShowAttachments",null),o([l()],W.prototype,"shouldAllowAttachmentEditing",null),o([l()],W.prototype,"sketchViewModel",null),W=Se=o([P("esri.widgets.Editor.CreateFeaturesWorkflow")],W);const Kt=W;var Ve;let q=Ve=class extends se{constructor(e){super(e),this.editorItem=null,this.edits=null,this.parent=null,this.relatedRecordCallbacks=null,this.viewModel=null}get attachmentsCapabilities(){const e=this.editorItem.capabilities.update.attachments.enabled;return{editing:!0,operations:{add:e,update:e,delete:e}}}get formTemplate(){return this.editorItem.formTemplate}static async create(e){const t=Ve._makeConstructorProps(e);return new Ve(t)}static _makeConstructorProps(e){const{feature:t,parent:i,relatedRecordCallbacks:a,viewModel:r}=e,s=r.editorItems.find(n=>n.layer===t.layer);if(!s)throw new $("no-editorItem-found","The EditorViewModel provided did not have an EditorItem associated with the specified Graphic's layer");return{editorItem:s,edits:new Q({feature:t}),parent:i,relatedRecordCallbacks:a,viewModel:r}}};o([l()],q.prototype,"attachmentsCapabilities",null),o([l({constructOnly:!0})],q.prototype,"editorItem",void 0),o([l()],q.prototype,"edits",void 0),o([l()],q.prototype,"formTemplate",null),o([l()],q.prototype,"parent",void 0),o([l()],q.prototype,"relatedRecordCallbacks",void 0),o([l()],q.prototype,"viewModel",void 0),q=Ve=o([P("esri.widgets.Editor.UpdateRecordWorkflowData")],q);const Yt=q;var Oe;let pe=Oe=class extends Yt{constructor(e){super(e),this.sketchOptions=null,this.snappingManager=null}static async create(e){const{feature:t,snappingManager:i,viewModel:a}=e,r=e.sketchOptions??new He,{view:s}=a;if(!s)throw new $("editor:cannot-create-workflow-data","The provided EditorViewModel does not have an associated view");const n=await we(s,t.layer);return new Oe({...Oe._makeConstructorProps(e),layerView:n,sketchOptions:r,snappingManager:i})}};o([l()],pe.prototype,"layerView",void 0),o([l({constructOnly:!0})],pe.prototype,"sketchOptions",void 0),o([l()],pe.prototype,"snappingManager",void 0),pe=Oe=o([P("esri.widgets.Editor.UpdateFeatureWorkflowData")],pe);const Da=pe;var at;const rt={exit:Symbol()};let L=at=class extends mt{constructor(e){super(e),this._highlightHelper=null,this.fullFeature=null,this.type="update-table-record"}initialize(){const{data:e}=this,{edits:t}=e,{view:i}=e.viewModel,a=t.feature,r=new AbortController;this.addHandles(lt(r)),this._updatingHandles.addPromise(Ma(a,e.viewModel.view.spatialReference,r.signal).then(s=>{oi(r)||(this._onFullFeatureLoaded(s),this._initializeFeatureFormViewModel())},s=>this.cancel({force:!0,error:new $("editor:failed-to-fetch-full-feature","Failed to retrieve all information for this feature. The update cannot proceed.",{detail:{error:s}})}))),i&&(this._highlightHelper=new zt({view:i}),this.addHandles(I(()=>{var s;return(s=this._highlightHelper)==null?void 0:s.removeAll()})))}get editorItem(){return this.data.editorItem}get featureFormViewModel(){return this._featureFormViewModel}get hasPendingEdits(){return this.data.edits.modified}get layer(){return this.data.editorItem.layer}get parent(){return this.data.parent}get parentLayer(){var e;return(e=this.parent)==null?void 0:e.data.editorItem.layer}get shouldShowAttachments(){return this.editorItem.capabilities.attachments.enabled}get shouldAllowAttachmentEditing(){return this.editorItem.capabilities.update.attachments.enabled}get reliesOnOwnerAdminPrivileges(){const e=this.editorItem.capabilities;return e.update.reliesOnOwnerAdminPrivileges||e.delete.reliesOnOwnerAdminPrivileges}async deleteAndCommit(){return this.data.edits.stageDelete(),this.commit()}async enter(){this._configureAttachmentsViewModel()}exit(e){this.removeHandles(rt.exit)}async start(){return await super.start(),null}_configureAttachmentsViewModel(){const{data:e,fullFeature:t}=this,{attachmentsCapabilities:i,viewModel:a}=e,{attachmentsViewModel:r}=a;r.set({capabilities:i,graphic:t,filesEnabled:!1,mode:"view"}),this.addHandles([I(()=>r.fileInfos.removeAll()),M(()=>r.mode,s=>{switch(s){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}})],rt.exit)}_initializeFeatureFormViewModel(){const{edits:e,formTemplate:t,viewModel:{view:i}}=this.data,a=this._featureFormViewModel=new Vt({arcadeEditType:"UPDATE",feature:this.fullFeature,formTemplate:t,highlightHelper:this._highlightHelper,map:i==null?void 0:i.map,spatialReference:i.spatialReference,timeZone:i==null?void 0:i.timeZone});a.relatedRecordCallbacks={...this.data.relatedRecordCallbacks,showAllRelatedRecords:s=>a.relationshipId=s.relationshipId};const{initialFeature:r}=e;r&&a.overrideInitialFeature(r),this.addHandles([a.on("value-change",()=>{e.updateAttributes(a.getValues()),this.fullFeature.attributes=e.feature.attributes}),M(()=>i==null?void 0:i.timeZone,s=>a.timeZone=s)])}_onFullFeatureLoaded(e){this.fullFeature=e;const{edits:t}=this.data;t.updateAttributes(e.attributes),t.trackChanges()}static async create(e){const t=new at({data:await Yt.create(e),onCommit:this._onCommitFactory(e.applyEdits)});return t._set("steps",this._createWorkflowSteps(t)),t}static _createWorkflowSteps(e){const{attachmentsViewModel:t}=e.data.viewModel;return[{id:"editing-attributes",async setUp(){},async tearDown(){}},{id:"adding-attachment",async setUp(){},async tearDown(){t.mode="view"}},{id:"editing-attachment",async setUp(){},async tearDown(){t.mode="view"}}]}};L._onCommitFactory=e=>async t=>{var d;const{edits:i}=t,{feature:a}=i;if(!a)return;const r=a.sourceLayer,s=a.clone();if(!i.attributesModified||i.stagedForDelete){const c=r.objectIdField;if(s.attributes={[c]:a.getAttribute(c)},r.type==="scene"&&r.infoFor3D!=null){const p=(d=r.associatedLayer)==null?void 0:d.globalIdField;p!=null&&s.setAttribute(p,a.getAttribute(p))}}i.geometryModified&&!i.stagedForDelete||(s.geometry=null);const n=i.stagedForDelete?"deleteFeatures":"updateFeatures";await e(r,{[n]:[s]})},o([l()],L.prototype,"editorItem",null),o([l()],L.prototype,"featureFormViewModel",null),o([l()],L.prototype,"fullFeature",void 0),o([l()],L.prototype,"hasPendingEdits",null),o([l()],L.prototype,"layer",null),o([l()],L.prototype,"parent",null),o([l()],L.prototype,"parentLayer",null),o([l()],L.prototype,"shouldShowAttachments",null),o([l()],L.prototype,"shouldAllowAttachmentEditing",null),o([l()],L.prototype,"reliesOnOwnerAdminPrivileges",null),L=at=o([P("esri.widgets.Editor.UpdateRecordWorkflow")],L);var st;const H={...rt,highlights:Symbol(),sketchGraphics:Symbol(),sketchViewModel:Symbol(),waitingForTool:Symbol()};let ue=st=class extends L{constructor(e){super(e),this.type="update-feature",this._layerViewEditSession=null,this._sketchGraphicClone=null,this._sketchViewModel=null,this._webStyleCache=new Map}destroy(){var e;(e=this._layerViewEditSession)==null||e.rollback()}async commit(){this.removeHandles(H.sketchGraphics);try{const e=this.data.edits.stagedForDelete;await super.commit();const t=this._layerViewEditSession;e?t==null||t.rollback():t==null||t.commit()}catch(e){throw await this._configureSketchViewModel(),new $("editor-workflow:failed-to-commit","An error occurred when sending the updates to the service",{error:e})}}async start(){return await super.start(),await this._initializeSketchViewModel()}_initializeFeatureFormViewModel(){super._initializeFeatureFormViewModel(),this.addHandles([this._featureFormViewModel.on("value-change",e=>{var t;(t=this._layerViewEditSession)==null||t.setAttribute(e.fieldName,e.value)}),M(()=>{var e;return(e=this._featureFormViewModel.feature)==null?void 0:e.sourceLayer},e=>this._sketchGraphicClone.sourceLayer=e)])}_configureHighlight(){const{edits:e,layerView:t}=this.data;Bi(t)&&this.addHandles(t.highlight(e.feature),H.highlights)}async _configureSketchViewModel(){const e=this._sketchViewModel;if(!e)return;const{data:t,_featureFormViewModel:i,_sketchGraphicClone:a}=this,{edits:r,viewModel:s}=t,n=r.feature,{view:d}=s,c=ht(n),p=await Ea({feature:n,featureClone:a,visualVariableAttributes:c,sketchViewModel:e,view:d,onUpdate:({geometry:h,attributes:u},f)=>{if(r.updateAttributes(u),r.updateGeometry(h),i.feature&&(i.feature.geometry=h),c.rotation!=null){const{field:g}=c.rotation;i.setValue(g,u[g])}if(c.size!=null){const{field:g}=c.size;i.setValue(g,u[g])}(f.type==="undo"||f.type==="redo"||f.type==="update"&&f.toolEventInfo!=null&&Qt(f.toolEventInfo.type))&&i.notifyFeatureGeometryChanged()},addUpdatingPromise:h=>{this._updatingHandles.addPromise(h)},addHandle:h=>{this.addHandles(h,H.waitingForTool)},webStyleCache:this._webStyleCache});this.addHandles(p,H.sketchGraphics),e.addHandles(p)}async _initializeSketchViewModel(){const{data:e,_sketchGraphicClone:t}=this,i=e.edits.feature,{capabilities:a,layer:r}=e.editorItem,{view:s}=e.viewModel;if(this.removeHandles([H.highlights,H.sketchGraphics,H.sketchViewModel,H.waitingForTool]),!a.update.geometry||(s==null?void 0:s.type)==="3d"&&Ni(r.elevationInfo))return{enter:async()=>{this.hasHandles(H.highlights)||this._configureHighlight()},exit:()=>this.removeHandles([H.highlights])};const n=new ct({elevationInfo:r.elevationInfo,internal:!0,listMode:"hide"}),d=new pt({allowDeleteKey:!1,layer:n,sketchOptions:e.sketchOptions,snappingManager:e.snappingManager,updateOnGraphicClick:!1,view:s});return this._sketchViewModel=d,s==null||s.map.add(n),this.addHandles(I(()=>{s!=null&&s.destroyed||(s==null||s.map.remove(n)),n.destroy(),this._sketchViewModel=nt(d)}),H.sketchViewModel),await K(t,this._webStyleCache,(s==null?void 0:s.type)==="2d"?s.scale:null),this.addHandles([await Aa(d,i,t)]),{enter:async()=>{this.hasHandles(H.sketchGraphics)||await this._configureSketchViewModel()},exit:()=>this.removeHandles([H.sketchGraphics]),viewModel:d}}_onFullFeatureLoaded(e){super._onFullFeatureLoaded(e);const t=this._sketchGraphicClone=tt(e),{edits:i,layerView:a}=this.data;i.updateGeometry(e.geometry),i.trackChanges(),Ta(a)&&(this._layerViewEditSession=a.createInteractiveEditSession(t))}static async create(e){const t=new st({data:await Da.create(e),onCommit:this._onCommitFactory(e.applyEdits)});return t._set("steps",this._createWorkflowSteps(t)),t}get test(){}};o([l()],ue.prototype,"_layerViewEditSession",void 0),o([l()],ue.prototype,"_sketchGraphicClone",void 0),o([l()],ue.prototype,"_sketchViewModel",void 0),ue=st=o([P("esri.widgets.Editor.UpdateFeatureWorkflow")],ue);let Z=class extends se{constructor(t){super(t),this.addAttachmentsCallback=null,this.applyEditsCallback=null,this.candidates=null,this.rootFeature=null,this.sketchOptions=null,this.snappingManager=null,this.viewModel=null}};o([l()],Z.prototype,"addAttachmentsCallback",void 0),o([l()],Z.prototype,"applyEditsCallback",void 0),o([l()],Z.prototype,"candidates",void 0),o([l()],Z.prototype,"rootFeature",void 0),o([l({constructOnly:!0})],Z.prototype,"sketchOptions",void 0),o([l()],Z.prototype,"snappingManager",void 0),o([l()],Z.prototype,"viewModel",void 0),Z=o([P("esri.widgets.Editor.UpdateWorkflowData")],Z);const Ha=Z;var ot;const Jt="esri.widgets.Editor.UpdateWorkflow",Ra=()=>j.getLogger(Jt);let S=ot=class extends mt{constructor(e){super(e),this._workflowStack=new bt(vt),this._sketchStack=new bt(vt),this.data=void 0,this.type="update"}get activeEditorItem(){var e;return((e=this.activeWorkflow)==null?void 0:e.data.editorItem)??void 0}get activeFeatureFormViewModel(){var e;return(e=this.activeWorkflow)==null?void 0:e.featureFormViewModel}get activeSketchViewModel(){var e;return(e=this._sketchStack.peek())==null?void 0:e.viewModel}get activeWorkflow(){return this._workflowStack.last()}get updating(){var e;return this._updatingHandles.updating||!!((e=this.activeWorkflow)!=null&&e.updating)}get hasPreviousStep(){var e;return this._stepIndex>0||this.nestedWorkflowCount>1||((e=this.activeWorkflow)==null?void 0:e.featureFormViewModel.relationshipId)!=null||this.data.viewModel.attachmentsViewModel.mode!=="view"}get hasUpdatableCandidates(){const{candidates:e,viewModel:t}=this.data;return e.some(({layer:i})=>{var a;return(a=t.findEditorItemForLayer(i))==null?void 0:a.supportsUpdateWorkflow})}get nestedWorkflowCount(){return this._workflowStack.length}get shouldShowAttachments(){var e;return!!((e=this.activeEditorItem)!=null&&e.capabilities.attachments.enabled)}get shouldAllowAttachmentEditing(){var e;return!!((e=this.activeEditorItem)!=null&&e.capabilities.update.attachments.enabled)}get hasPendingEdits(){return Array.from(this._workflowStack).some(e=>e.hasPendingEdits)}get helpMessage(){var e;return(e=this.activeWorkflow)!=null&&e.helpMessage?this.activeWorkflow.helpMessage:this.stepId==="awaiting-feature-to-update"?"select":void 0}get reliesOnOwnerAdminPrivileges(){var e;return((e=this.activeWorkflow)==null?void 0:e.reliesOnOwnerAdminPrivileges)??!1}get hasInvalidFormTemplate(){var e;return!!((e=this.activeEditorItem)!=null&&e.hasInvalidFormTemplate)}async back(e=()=>Promise.resolve(!0)){const{activeWorkflow:t}=this;if((t==null?void 0:t.featureFormViewModel.relationshipId)==null)if(t){if(t.hasPendingEdits&&!await e())return;t.hasPreviousStep?await t.previous({cancelCurrentStep:!0}):await this.cancelActiveWorkflow({force:!0})}else this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0});else t.featureFormViewModel.relationshipId=null}async cancelActiveWorkflow(e){var t;await((t=this.activeWorkflow)==null?void 0:t.cancel(e)),await this._popWorkflow()}async commit(){await this._drainWorkflowStack(e=>e.commit()),await super.commit()}static create(e){const{viewModel:t,snappingManager:i,startAt:a,addAttachmentsCallback:r,applyEditsCallback:s}=e,n=e.sketchOptions??new He,d=new ot({data:new Ha({addAttachmentsCallback:r,applyEditsCallback:s,sketchOptions:n,snappingManager:i,viewModel:t}),onCommit:async()=>{}});return d._set("steps",this._createWorkflowSteps(d,a)),d}async save(){var e;this.nestedWorkflowCount>1?(await((e=this.activeWorkflow)==null?void 0:e.commit()),await this._popWorkflow()):await this.commit()}async startCreatingRelatedRecord(e){try{const t=await this._createNestedCreateFeaturesWorkflow(e);await this._pushWorkflow(t)}catch(t){throw new $("editor:unable-to-start-creating","Could not begin updating the provided feature or table record.",{error:t})}}async startUpdating(e){try{const t=await this._createNestedUpdateWorkflow(e);await this._pushWorkflow(t)}catch(t){throw new $("editor:unable-to-start-updating","Could not begin updating the provided feature or table record.",{error:t})}}async deleteActiveFeature(){const{activeWorkflow:e}=this;if(!e)throw new $("editor:nothing-to-delete","There is no feature to delete");Ga(e)?await e.deleteAndCommit():await e.cancel(),this.nestedWorkflowCount===1?await this.reset():await this._popWorkflow()}async cancelAll(){await this._drainWorkflowStack(e=>e.cancel({force:!0}))}async _createNestedCreateFeaturesWorkflow(e){var h;const{relatedLayer:t}=e,{addAttachmentsCallback:i,applyEditsCallback:a,sketchOptions:r,snappingManager:s,viewModel:n}=this.data;if(!Ye(t))throw new $("editor:unsupported-layer","Editing is not supported on the provided layer");const d=this._getCreationInfoForNestedCreateFeaturesWorkflow(e),c=d.template||d.initialFeature?"creating-features":"awaiting-feature-creation-info",p=((h=this.activeWorkflow)==null?void 0:h.type)!=="create-features"?this.activeWorkflow:void 0;return Kt.create({addAttachmentsCallback:i,applyEditsCallback:a,creationInfo:d,isNested:!0,parent:p,sketchOptions:r,snappingManager:s,startAt:c,viewModel:n})}_getCreationInfoForNestedCreateFeaturesWorkflow(e){const{relatedLayer:t}=e;if(!Ye(t)||Fi(t))throw new $("editor:unsupported-layer","Editing is not supported on the provided layer");const i={layer:t,maxFeatures:1},a=this._makeRelatedRecordAttributes(e),r=Ot(t);return(r==null?void 0:r.length)>0?(i.attributeOverrides=a,r.length===1&&(i.template=r[0])):i.initialFeature=new Re({sourceLayer:t,attributes:a}),i}async _createNestedUpdateWorkflow(e){var c;const t=me(e.sourceLayer)?L:ue,{applyEditsCallback:i,sketchOptions:a,snappingManager:r,viewModel:s}=this.data,n=((c=this.activeWorkflow)==null?void 0:c.type)!=="create-features"?this.activeWorkflow:void 0,d=await t.create({feature:e,parent:n,sketchOptions:a,snappingManager:r,viewModel:s,applyEdits:i,relatedRecordCallbacks:{addRelatedRecord:async p=>await this.startCreatingRelatedRecord(p),editRelatedRecord:async({relatedFeature:p})=>await this.startUpdating(p)}});return await D(()=>!d.updating),d}async _drainWorkflowStack(e){const t=this._workflowStack,i=[];for(;t.length>0;){const a=t.pop();this._sketchStack.pop();const r=e(a).then(()=>a.destroy());this._updatingHandles.addPromise(r),i.push(r)}await Promise.all(i)}_makeRelatedRecordAttributes(e){var h,u;const{parentFeature:t,relatedLayer:i,relationshipId:a}=e;if(!ji(t))return;const r=(h=i.relationships)==null?void 0:h.find(f=>f.id===a);if(!r)return void ge("relationship-not-found","Could not begin creating a related record because the relationship specified could not be found on the destination layer.");if(r.role==="origin")return void ge("unsupported-role","Creating new related records in the 'origin' table of a relationship is not yet supported");const s=t.sourceLayer;r.relatedTableId!==s.layerId&&ge("invalid-argument-combination","The given parent feature does not belong to the relationship designated by the given relationship ID.");const n=(u=s.relationships)==null?void 0:u.find(f=>f.id===a);if(!n)return void ge("relationship-not-found","Could not begin creating a related record because the relationship specified could not be found on the origin layer.");const d=Et(s,n),c=t.getAttribute(d);return c||ge("no-key-on-origin-feature","The given parent feature does not have a value for the relationship's origin primary key field."),{[Et(i,r)]:c}}async _popWorkflow(){var t;(t=this._workflowStack.pop())==null||t.destroy(),this._sketchStack.pop();const e=await this._reconcileWorkflowStack();if(e.failureCount>0)throw new $("editor:next-workflow-failed","Popped the top workflow, but the next workflow in the stack failed to activate",e)}async _pushWorkflow(e){var n;const t=this._workflowRequiresSketchViewModel(e);(n=this.activeWorkflow)==null||n.exit({removeSketchHandles:t});const i=this._sketchStack,a=await(e==null?void 0:e.start()),r=i.peek();a?(r==null||r.exit(),i.push(a)):i.push(this._cloneSketchController(r)),this._workflowStack.push(e);const s=await this._reconcileWorkflowStack();if(s.failureCount>0)throw new $("editor:failed-to-start-updating-feature","Failed to enter the provided workflow.",s)}async _reconcileWorkflowStack(){var i;const e=this._workflowStack,t=this._sketchStack;try{const a=e.peek();return await(a==null?void 0:a.enter()),await((i=t.peek())==null?void 0:i.enter()),{activeWorkflow:a,failureCount:0}}catch{e.pop().destroy(),t.pop();const{activeWorkflow:r,failureCount:s}=await this._reconcileWorkflowStack();return{activeWorkflow:r,failureCount:s+1}}}_cloneSketchController(e){return{enter:(e==null?void 0:e.enter)??(async()=>{}),exit:(e==null?void 0:e.exit)??(async()=>{}),viewModel:e==null?void 0:e.viewModel}}_workflowRequiresSketchViewModel(e){var i;const{type:t}=e;return t==="update-feature"||t==="create-features"&&!me((i=e.data.creationInfo)==null?void 0:i.layer)}static _createWorkflowSteps(e,t="awaiting-feature-to-update"){const{data:i}=e;return Zt(["awaiting-feature-to-update","awaiting-update-feature-candidate","editing-existing-feature","adding-attachment","editing-attachment"],t,{"awaiting-feature-to-update":()=>({id:"awaiting-feature-to-update",async setUp(){const{spinnerViewModel:a}=i.viewModel,r=i.viewModel.view;r.activeTool=null;let s=null;e.addHandles(I(()=>{s=je(s)}),this.id),i.rootFeature=null,i.candidates=[];const n=r.on("immediate-click",async c=>{const p=De();e._updatingHandles.addPromise(p.promise);try{a.location=c.mapPoint,a.visible=!0,s==null||s.abort();const{editorItems:h}=i.viewModel;s=new AbortController;const u=await c.async(()=>new Promise((f,g)=>{ni(s==null?void 0:s.signal,()=>g(li())),f(ka(h,r,c,s==null?void 0:s.signal))}));if(be(s),i.candidates=u.filter(f=>f.status==="fulfilled").flatMap(f=>f.value).filter(f=>!f.isAggregate),a.visible=i.candidates.length===1,i.candidates.length===0)return;c.stopPropagation(),i.candidates.length===1?(i.rootFeature=i.candidates[0],e.go("editing-existing-feature").catch(()=>{}).then(()=>a.visible=!1)):e.next()}finally{p.resolve()}},xt.TOOL),d=he(()=>r.activeTool!=null,()=>e.cancel({force:!0}),{once:!0});r.focus(),e.addHandles([n,d],this.id)},async tearDown(){i.candidates.length===0&&(i.viewModel.spinnerViewModel.visible=!1),e.removeHandles(this.id)}}),"awaiting-update-feature-candidate":()=>({id:"awaiting-update-feature-candidate",async setUp(){i.rootFeature=null;const{view:a}=i.viewModel;if(!a)return;const r=new zt({view:a});e.addHandles([M(()=>i.rootFeature,(s,n)=>{r.remove(n),r.add(s)},Qe),I(()=>r.removeAll())],this.id)},async tearDown(){e.removeHandles(this.id)}}),"editing-existing-feature":()=>({id:"editing-existing-feature",async setUp(){const{rootFeature:a,viewModel:r}=e.data;if(!a)throw new $("editor:no-feature-specified","Cannot setup the 'updating-existing-feature' step until the root feature is defined");await e.startUpdating(a),r.spinnerViewModel.visible=!1;const s=xe(async()=>{await D(()=>!e.updating),e.previous()});e.addHandles([M(()=>e.nestedWorkflowCount,(n,d)=>{n===0&&d!==0&&s()},Qe)],this.id)},async tearDown(){await e.cancelAll(),e.removeHandles(this.id)}}),"adding-attachment":()=>({id:"adding-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){i.viewModel.attachmentsViewModel.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){i.viewModel.attachmentsViewModel.mode="view"}})})}};function Et(e,{keyField:t}){var i;return((i=e.getField(t))==null?void 0:i.name)??t}o([l()],S.prototype,"activeEditorItem",null),o([l()],S.prototype,"activeFeatureFormViewModel",null),o([l()],S.prototype,"activeSketchViewModel",null),o([l()],S.prototype,"activeWorkflow",null),o([l()],S.prototype,"updating",null),o([l()],S.prototype,"data",void 0),o([l()],S.prototype,"hasPreviousStep",null),o([l()],S.prototype,"hasUpdatableCandidates",null),o([l()],S.prototype,"nestedWorkflowCount",null),o([l()],S.prototype,"shouldShowAttachments",null),o([l()],S.prototype,"shouldAllowAttachmentEditing",null),o([l()],S.prototype,"hasPendingEdits",null),o([l()],S.prototype,"helpMessage",null),o([l()],S.prototype,"reliesOnOwnerAdminPrivileges",null),o([l()],S.prototype,"hasInvalidFormTemplate",null),S=ot=o([P(Jt)],S);const ge=(e,t)=>Ra().warn(`editor:${e}`,t,"The create operation will be allowed to proceed, but the resulting feature may not be related to the given parent feature."),Ga=e=>!!e&&/update-/.test(e.type),za=S;let x=class extends se{constructor(t){super(t),this.layer=null}get attachments(){var t;return{enabled:this._effectiveEnabled&&!!((t=this._effectiveCapabilities)!=null&&t.data.supportsAttachment)}}get create(){var d;const{_effectiveCapabilities:t,layer:i}=this,a=this._createEnabled,r=a,s=(d=i.capabilities)==null?void 0:d.operations.supportsAdd,n=!!(t!=null&&t.operations.supportsAdd);return{attachments:{enabled:a&&this.attachments.enabled},attributes:a,enabled:a,geometry:r,reliesOnOwnerAdminPrivileges:!s&&n}}get delete(){var s;const{_effectiveCapabilities:t,layer:i}=this,a=(s=i.capabilities)==null?void 0:s.operations.supportsDelete,r=!!(t!=null&&t.operations.supportsDelete);return{enabled:this._effectiveEnabled&&!!(t!=null&&t.operations.supportsDelete),reliesOnOwnerAdminPrivileges:!a&&r}}get reliesOnOwnerAdminPrivileges(){return this._effectiveEnabled&&!this.layer.editingEnabled||this.create.reliesOnOwnerAdminPrivileges||this.update.reliesOnOwnerAdminPrivileges||this.delete.reliesOnOwnerAdminPrivileges}get update(){var p;const{_effectiveCapabilities:t,layer:i}=this,a=this._updateEnabled,r=!(!a||!(t!=null&&t.editing.supportsGeometryUpdate)),s=(p=i.capabilities)==null?void 0:p.operations.supportsUpdate,n=!!(t!=null&&t.operations.supportsUpdate),d=this.attachments.enabled,c=d&&this._canCreateOrUpdate;return{attachments:{enabled:d,create:c,update:c},attributes:a,enabled:a,geometry:r,reliesOnOwnerAdminPrivileges:!s&&n}}get _createEnabled(){var t;return this._effectiveEnabled&&!!((t=this._effectiveCapabilities)!=null&&t.operations.supportsAdd)}get _updateEnabled(){var t;return this._effectiveEnabled&&!!((t=this._effectiveCapabilities)!=null&&t.operations.supportsUpdate)}get _canCreateOrUpdate(){return!(!this._createEnabled&&!this._updateEnabled)}get _effectiveEnabled(){return Mi(this.layer)}get _effectiveCapabilities(){return Ii(this.layer)}};o([l()],x.prototype,"attachments",null),o([l()],x.prototype,"create",null),o([l()],x.prototype,"delete",null),o([l()],x.prototype,"layer",void 0),o([l()],x.prototype,"reliesOnOwnerAdminPrivileges",null),o([l()],x.prototype,"update",null),o([l()],x.prototype,"_createEnabled",null),o([l()],x.prototype,"_updateEnabled",null),o([l()],x.prototype,"_canCreateOrUpdate",null),o([l()],x.prototype,"_effectiveEnabled",null),o([l()],x.prototype,"_effectiveCapabilities",null),x=o([P("esri.layers.support.EditingCapabilities")],x);const At=x,ce="esri.views.layers.support.editableLayerViews";function Na(e,t){const{associatedLayer:i}=e,a=i==null?void 0:i.infoFor3D;if(!a)return!1;const r=Yi(a);if(!(r!=null&&a.queryFormats.includes(r)))return j.getLogger(ce).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because it does not support GLB queries.`),!1;const s=e.spatialReference,n=i.spatialReference;if(!Ne(s,n))return j.getLogger(ce).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because its spatial reference (wkid:${s.wkid}) is different from its associated FeatureLayer's spatial reference (wkid:${n.wkid}).`),!1;const d=i.sourceJSON.sourceSpatialReference;if(!(d==null||Ne(d,n)))return j.getLogger(ce).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because the spatial reference of its associated FeatureLayer's service (wkid:${n.wkid}) is different from its source spatial reference (wkid:${d.wkid}).`),!1;const{view:c}=t;if(t.destroyed||c==null)return!1;const p=c.spatialReference,{viewingMode:h}=c.state,u=Zi(s),f=h===Ji.Global;return u&&!f?(j.getLogger(ce).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits in local viewing mode because its spatial reference (wkid:${s.wkid}) is geographic. Please consider changing the viewing mode to global.`),!1):!u&&f?(j.getLogger(ce).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits in global viewing mode because its spatial reference (wkid:${s.wkid}) is projected. Please consider changing the viewing mode to local.`),!1):!!(Ne(s,p)||f&&Qi(p)&&Ki(s))||(j.getLogger(ce).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because its spatial reference (wkid:${s.wkid}) does not match the view spatial reference (wkid:${p.wkid}).`),!1)}let R=class extends At{constructor(t){super(t),this.layerInfo=null,this.layerView=null}get attachments(){const t=this.defaults.attachments.enabled,i=this.layerInfo;return{enabled:t&&(i==null?void 0:i.enabled)!==!1}}get create(){const{attachments:t,defaults:i,layerInfo:a,layer:r,layerView:s}=this,n=i.create,d=(a==null?void 0:a.enabled)!==!1&&(a==null?void 0:a.addEnabled)!==!1,c=n.enabled&&d;return{attributes:c&&n.attributes,enabled:c,geometry:c&&n.geometry&&$t(r,s),attachments:{enabled:t.enabled&&c&&(a==null?void 0:a.attachmentsOnCreateEnabled)!==!1},reliesOnOwnerAdminPrivileges:n.reliesOnOwnerAdminPrivileges}}get defaults(){return new At({layer:this.layer})}get delete(){const{defaults:t,layerInfo:i}=this,a=t.delete,r=(i==null?void 0:i.enabled)!==!1&&(i==null?void 0:i.deleteEnabled)!==!1;return{enabled:a.enabled&&r,reliesOnOwnerAdminPrivileges:a.reliesOnOwnerAdminPrivileges}}get formTemplate(){const{layer:t,layerInfo:i}=this;return i!=null&&i.formTemplate?i.formTemplate:t&&"formTemplate"in t?t.formTemplate:null}get relationship(){var r,s,n;const{layer:t}=this,i=!(!qi(t)||!((r=t.relationships)!=null&&r.length)),a=!!((n=(s=this.formTemplate)==null?void 0:s.elements)!=null&&n.some(d=>d.type==="relationship"));return{enabled:i&&a}}get update(){const{attachments:t,defaults:i,layerInfo:a,layer:r,layerView:s}=this,n=i.update,d=(a==null?void 0:a.enabled)!==!1&&(a==null?void 0:a.updateEnabled)!==!1,c=n.enabled&&d,p=c&&n.attributes&&(a==null?void 0:a.attributeUpdatesEnabled)!==!1,h=c&&n.geometry&&(a==null?void 0:a.geometryUpdatesEnabled)!==!1&&$t(r,s),u=t.enabled&&(a==null?void 0:a.attachmentsOnUpdateEnabled)!==!1;return{attributes:p,enabled:c,geometry:h,attachments:{enabled:u,create:u&&n.attachments.create,update:u&&n.attachments.update},reliesOnOwnerAdminPrivileges:n.reliesOnOwnerAdminPrivileges}}};function $t(e,t){return e.type!=="scene"||t!=null&&"type"in t&&t.type==="scene-layer-3d"&&Na(e,t)}o([l()],R.prototype,"attachments",null),o([l()],R.prototype,"create",null),o([l()],R.prototype,"defaults",null),o([l()],R.prototype,"delete",null),o([l()],R.prototype,"formTemplate",null),o([l()],R.prototype,"layerInfo",void 0),o([l()],R.prototype,"layerView",void 0),o([l()],R.prototype,"relationship",null),o([l()],R.prototype,"update",null),R=o([P("esri.widgets.Editor.support.EditorEditingCapabilities")],R);const Ba=R;let O=class extends se{constructor(t){super(t),this.disabled=!1,this.layer=null,this.layerInfo=null,this.layerView=null}get _suspended(){var t;return!!((t=this.layerView)!=null&&t.suspended)}get capabilities(){return new Ba({layer:this.layer,layerInfo:this.layerInfo,layerView:this.layerView})}get editable(){const{create:t,relationship:i,update:a,delete:{enabled:r}}=this.capabilities,s=t.attachments.enabled||a.attachments.enabled;return!this.disabled&&(t.enabled||a.enabled||s||r||i.enabled)}get formTemplate(){return this.capabilities.formTemplate}get hasInvalidFormTemplate(){return Xi(this.layer,this.formTemplate)}get isTable(){return me(this.layer)}get supportsCreateFeaturesWorkflow(){if(this.disabled)return!1;const{enabled:t,geometry:i}=this.capabilities.create;return this.isTable?t:t&&i}get supportsUpdateWorkflow(){const{capabilities:t}=this;return!this.disabled&&(t.update.enabled||t.update.attachments.enabled||t.delete.enabled)}get visible(){const{layer:t}=this,i=t.parent;return!this._suspended&&t.visible&&(!i||!("visible"in i)||i.visible)}};o([l()],O.prototype,"_suspended",null),o([l()],O.prototype,"capabilities",null),o([l()],O.prototype,"disabled",void 0),o([l()],O.prototype,"editable",null),o([l()],O.prototype,"formTemplate",null),o([l()],O.prototype,"hasInvalidFormTemplate",null),o([l()],O.prototype,"isTable",null),o([l()],O.prototype,"layer",void 0),o([l()],O.prototype,"layerInfo",void 0),o([l()],O.prototype,"layerView",void 0),o([l()],O.prototype,"supportsCreateFeaturesWorkflow",null),o([l()],O.prototype,"supportsUpdateWorkflow",null),o([l()],O.prototype,"visible",null),O=o([P("esri.widgets.Editor.support.EditorItem")],O);const ja=O,Xt="esri.widgets.Editor.EditorViewModel",qa=()=>j.getLogger(Xt),ei=["create-features","update"];function ae(e,t,i){qa().error(new $(e,t,i))}function Za(e,t){return e==null?void 0:e.find(i=>i.layer===t)}let y=class extends Pt.EventedAccessor{constructor(e){super(e),this._sketchEventListenerHandle=null,this._sketchGraphicsLayer=new ct({listMode:"hide",internal:!0}),this._snappingManager=null,this._updateItemsTask=null,this._updatingHandles=new Lt,this._featureTemplatesViewModelLocked=!1,this.activeWorkflow=null,this._activityQueue=new Ae,this.editorItems=new Ae,this.failures=[],this.hideTemplatesForInactiveLayers=!1,this.attachmentsViewModel=new hi({capabilities:{editing:!0}}),this.featureTemplatesViewModel=new wi({disabledItemFunction:({layer:t})=>this._itemIsSuspended(t)}),this.layerInfos=null,this.ownSketchViewModel=new pt({layer:this._sketchGraphicsLayer}),this.sketchOptions=new He,this.snappingOptions=new Ut({attributeRulesEnabled:!0}),this.spinnerViewModel=new _i,this.pageStack=[],this.showDiscardEditsPrompt=()=>Promise.resolve(!0),this._candidateCommitted=!1,this.back=async()=>{var t;this.canGoBack&&((t=this.activeWorkflow)!=null&&t.hasPreviousStep?await this.activeWorkflow.back(this.showDiscardEditsPrompt):await this._cancelWorkflow({force:!this.hasPendingEdits}))},this.saveWorkflow=async()=>{var i;const{featureFormViewModel:t}=this;if(t){if(t.submit(),!t.submittable||t.hasPendingSubtypeChoice)return;const a=t.getValues();if(t.validateContingencyConstraints(a,{includeIncompleteViolations:!0}).length>0)return}await((i=this.activeWorkflow)==null?void 0:i.save())},this.selectFeature=(t,i=!1)=>{const a=this.activeWorkflow;this._candidateCommitted||(a==null?void 0:a.type)!=="update"||(a.data.rootFeature=t,i&&(a.next(),this._candidateCommitted=!0))}}initialize(){this.addHandles([M(()=>{var r;const e=this.view,t=(r=e==null?void 0:e.map)==null?void 0:r.editableLayers,i=e==null?void 0:e.allLayerViews,a=i==null?void 0:i.filter(s=>!!(t!=null&&t.includes(s.layer)));return[t,a,this.layerInfos,this.allowedWorkflows]},()=>this._updateEditorItems(),ve),M(()=>this.hideTemplatesForInactiveLayers,()=>this.syncFeatureTemplates()),J(()=>this.activeWorkflow,"cancel",()=>this.emit("workflow-cancel")),J(()=>this.activeWorkflow,"commit",()=>this.emit("workflow-commit")),J(()=>this.activeWorkflow,"complete",()=>{this.emit("workflow-commit"),this._set("activeWorkflow",null)}),he(()=>{var e;return(e=this.view)==null?void 0:e.map},e=>e.add(this._sketchGraphicsLayer),re),J(()=>this.editorItems,"change",()=>this._afterEditorItemsChange()),M(()=>[this.canCreate,this.canUpdateVisible],()=>this._afterEditorItemsChange()),M(()=>this.page,(e,t)=>{const i=[...this.pageStack];if(i.indexOf(e)===-1)i.push(e);else for(;i.length&&i.at(-1)!==e;)i.pop();this.pageStack=i},ve),he(()=>this.state==="awaiting-update-feature-candidate",()=>this._candidateCommitted=!1),J(()=>this.featureTemplatesViewModel,"select",async({item:e,oldItem:t})=>{var r;const{activeWorkflow:i}=this;if(i){if(i.type==="update"&&((r=i.activeWorkflow)==null?void 0:r.stepId)==="awaiting-feature-creation-info")return;try{await this.cancelWorkflow({force:!this.hasPendingEdits})}catch{return void this.featureTemplatesViewModel.select(t,{emit:!1})}}if(!e)return;const a={layer:e.layer,template:e.template};if(e.supportsUpload)return this.featureTemplatesViewModel.select(t,{emit:!1}),this.startCreateFeaturesWorkflow(a);this.startCreateFeaturesWorkflowAtFeatureCreation(a)}),J(()=>this.view,"key-down",e=>{var t;e.key==="Escape"&&((t=this.activeWorkflow)!=null&&t.keyboardCancellationEnabled)&&(e.stopPropagation(),this.back())}),J(()=>this.sketchViewModel,["create","delete","update"],e=>{var n,d;const{activeWorkflow:t}=this,i=(t==null?void 0:t.type)==="update",a=i?(n=t.activeWorkflow)==null?void 0:n.layer:t==null?void 0:t.layer,r=i?(d=t==null?void 0:t.activeWorkflow)==null?void 0:d.parentLayer:void 0,s=`sketch-${e.type}`;this.emit(s,{type:s,detail:e,layer:a,parentLayer:r})},Qe),M(()=>this.view,e=>{if(this._snappingManager=nt(this._snappingManager),!e)return;const t=this.snappingOptions;this._snappingManager=new Wi({view:e,options:t}),this.ownSketchViewModel.snappingManager=this._snappingManager},ve),M(()=>this.snappingOptions,e=>{this._snappingManager&&(this._snappingManager.options=e)},ve)])}destroy(){this._cancelWorkflow({warnIfNoWorkflow:!1}).then(()=>{var e,t;(t=(e=this.view)==null?void 0:e.map)==null||t.remove(this._sketchGraphicsLayer),this.view=null}),this._updateItemsTask=je(this._updateItemsTask),this._updatingHandles.destroy(),this._sketchEventListenerHandle=Ee(this._sketchEventListenerHandle)}get allowedWorkflows(){return this._get("allowedWorkflows")}set allowedWorkflows(e){qe(j.getLogger(this),"allowedWorkflows",{replacement:"Editor.visibleElements",version:"4.29",warnOnce:!0}),e&&e.length!==0||(e=[...ei]),this._set("allowedWorkflows",e)}get canCreate(){return this.editorItems.some(e=>e.supportsCreateFeaturesWorkflow)}get canCreateVisible(){return!!this.featureTemplatesLayers.length}get canUpdate(){return this.editorItems.some(e=>e.supportsUpdateWorkflow)}get canUpdateVisible(){return this.editorItems.some(e=>e.supportsUpdateWorkflow&&e.visible)}get featureTemplatesLayers(){const e=new Ae;for(const t of this.editorItems){const i=t.supportsCreateFeaturesWorkflow&&!t.isTable,a=this.hideTemplatesForInactiveLayers&&!t.visible;i&&!a&&e.push(t.layer)}return e}get editableItems(){return qe(j.getLogger(this),"editableItems",{replacement:"editorItems",version:"4.29",warnOnce:!0}),this.editorItems.map(e=>{const{capabilities:t,disabled:i,hasInvalidFormTemplate:a,layer:r}=e,s=[],n=t.create,d=t.update,c=t.delete;return n.enabled&&s.push("create"),d.enabled&&s.push("update"),c.enabled&&s.push("delete"),{layer:r,supports:s,suspended:i,attributeUpdatesEnabled:d.attributes,geometryUpdatesEnabled:d.geometry,attachmentsOnCreateEnabled:n.attachments.enabled,attachmentsOnUpdateEnabled:d.attachments.enabled,hasInvalidFormTemplate:a,hasAttachments:t.attachments.enabled}})}get featureFormViewModel(){const{activeWorkflow:e}=this;return(e==null?void 0:e.type)==="update"?e.activeFeatureFormViewModel:(e==null?void 0:e.type)==="create-features"?e.featureFormViewModel:null}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get sketchViewModel(){const{activeWorkflow:e}=this;return(e==null?void 0:e.type)==="update"?e.activeSketchViewModel:(e==null?void 0:e.type)==="create-features"?e.sketchViewModel:this.ownSketchViewModel}get state(){var i,a;if(!((i=this.view)!=null&&i.ready))return"disabled";const e=this.attachmentsViewModel.mode;if(e==="add")return"adding-attachment";if(e==="edit")return"editing-attachment";const{activeWorkflow:t}=this;return t!=null&&t.stepId?t.type==="update"&&((a=t.activeWorkflow)!=null&&a.stepId)?t.activeWorkflow.stepId:t.stepId:"ready"}get syncing(){return this._activityQueue.length>0}get updating(){var e;return this._updatingHandles.updating||((e=this.activeWorkflow)==null?void 0:e.updating)===!0}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}set view(e){this.ownSketchViewModel.view=e,this.spinnerViewModel.view=e,this._set("view",e)}get page(){const{activeWorkflow:e,state:t}=this;if((e==null?void 0:e.type)==="update"&&e.stepId==="awaiting-feature-to-update")return"ready";if((e==null?void 0:e.type)==="create-features"&&e.numPendingFeatures===0){const i=e.data.upload;if(i)return i.state==="default"?"ready":"creating-features-upload-details"}return t??"disabled"}get featureFormDisabled(){var t;const{activeWorkflow:e}=this;return(e==null?void 0:e.type)==="update"&&((t=e.activeEditorItem)==null?void 0:t.capabilities.update.attributes)===!1}get canGoBack(){return this.activeWorkflow!=null&&!this.syncing}get shouldShowDeleteButton(){var t;const{activeWorkflow:e}=this;return!!e&&e.type==="update"&&!!((t=e.activeEditorItem)!=null&&t.capabilities.delete.enabled)}get hasPendingEdits(){var e;return((e=this.activeWorkflow)==null?void 0:e.hasPendingEdits)??!1}get snappingManager(){return this._snappingManager}async startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.startCreateFeaturesWorkflow()}async startCreateFeaturesWorkflowAtFeatureCreation(e){return this.startCreateFeaturesWorkflow(e,"creating-features")}async startCreateFeaturesWorkflow(e,t="awaiting-feature-creation-info"){if(await D(()=>!this.updating),!this.canCreate)throw new $("editing:unsupported-workflow","Creating features is unsupported or disabled.");const i=this._createUpdatingResolver();try{await this._cancelWorkflow();const a=this._createCreateFeaturesWorkflow(e,t);this._set("activeWorkflow",a),await a.start()}catch(a){this._logErrorAndCancelWorkflow(a)}finally{i.resolve()}}async startCreateFeaturesWorkflowAtFeatureEdit(e){await D(()=>!this.updating);const t=this._createUpdatingResolver();try{const{initialFeature:i}=e,a=i.sourceLayer=i.layer,r=a?this.findEditorItemForLayer(a):void 0;if(!(r!=null&&r.supportsCreateFeaturesWorkflow))throw new $("editing:unsupported-workflow","Creating features is unsupported or disabled for this layer.");await this._cancelWorkflow();const s=this._createCreateFeaturesWorkflow({initialFeature:i,layer:r.layer,maxFeatures:1},"creating-features");this._set("activeWorkflow",s),await s.start()}catch(i){this._logErrorAndCancelWorkflow(i)}finally{t.resolve()}}async startUpdateWorkflowAtFeatureSelection(){if(await D(()=>!this.updating),!this.canUpdate)return void ae("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const e=this._createUpdatingResolver();try{await this._cancelWorkflow();const t=this._createUpdateWorkflow();this._set("activeWorkflow",t),await t.start()}catch(t){this._logErrorAndCancelWorkflow(t)}finally{e.resolve()}}async startUpdateWorkflowAtMultipleFeatureSelection(e){if(await D(()=>!this.updating),!this.canUpdate)return void ae("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const t=this._createUpdatingResolver();try{await this._cancelWorkflow();const i=this._createUpdateWorkflow("awaiting-update-feature-candidate");i.data.candidates=e,this._set("activeWorkflow",i),await i.start()}catch(i){this._logErrorAndCancelWorkflow(i)}finally{t.resolve()}}async startUpdateWorkflowAtFeatureEdit(e){if(await D(()=>!this.updating),!this.canUpdate)return void ae("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const t=this._createUpdatingResolver();try{await this._cancelWorkflow();const i=this._createUpdateWorkflow("editing-existing-feature");i.data.rootFeature=e,this._set("activeWorkflow",i),await i.start()}catch(i){this._logErrorAndCancelWorkflow(i)}finally{t.resolve()}}async deleteFeatureFromWorkflow(){const{activeWorkflow:e}=this;e&&e.type==="update"?await e.deleteActiveFeature():ae("editing:unsupported-workflow","Deleting requires an active update workflow.")}async cancelWorkflow(e){return this._cancelWorkflow({warnIfNoWorkflow:!0,...e})}findEditorItemForLayer(e){return this.editorItems.find(t=>t.layer===e)}itemHasInvalidFormTemplate(e){var t;return e!=null&&((t=this.findEditorItemForLayer(e.layer))==null?void 0:t.hasInvalidFormTemplate)===!0}syncFeatureTemplates(){this._featureTemplatesViewModelLocked||(this.featureTemplatesViewModel.layers=this.featureTemplatesLayers.toArray())}async toggleUpdateWorkflow(){this.canUpdate&&(this.hasPendingEdits&&!await this.showDiscardEditsPrompt()||(this.activeWorkflow&&this.state==="awaiting-feature-to-update"?await this.cancelWorkflow({force:!0}):await this.startUpdateWorkflowAtFeatureSelection()))}lockFeatureTemplatesViewModel(){return this._featureTemplatesViewModelLocked=!0,I(()=>{this._featureTemplatesViewModelLocked=!1,this.syncFeatureTemplates()})}async _getEditorItemCandidates(e){const{view:t}=this;if(!(t!=null&&t.map))return[];const{map:i}=t,a=i.editableLayers.toArray()??[],r=i.allTables.toArray().filter(Ci)??[];return await Promise.allSettled([...a.map(s=>s.type==="subtype-group"?s.loadAll():Promise.resolve()),...r.map(s=>s.load())]),be(e),[...a.reverse(),...r.reverse()].filter(s=>Ye(s)&&(s.geometryType!=="mesh"||t.type==="3d")).flatMap(s=>s.type==="subtype-group"?s.sublayers.toArray():s)}_drainEditorItems(){this.editorItems.drain(e=>e.destroy())}async _updateEditorItems(){je(this._updateItemsTask);const{view:e}=this,t=Tt(async i=>{if(!(e!=null&&e.map)||!(e!=null&&e.allLayerViews))return;const a=await this._getEditorItemCandidates(i);if(!a.length)return void this._drainEditorItems();const r=[],s=[],n=[],{layerInfos:d}=this;for(const p of a){const h=Za(d,p),u=await we(e,p).catch(()=>null);(h?r:u?s:n).push(new ja({layer:p,layerInfo:h,layerView:u}))}d!=null&&d.length&&r.sort((p,h)=>d.findIndex(({layer:u})=>u===p.layer)-d.findIndex(({layer:u})=>u===h.layer));const c=[...r,...s,...n];i.aborted||(this._drainEditorItems(),this.editorItems.addMany(c))});this._updatingHandles.addPromise(t.promise),this._updateItemsTask=t}_afterEditorItemsChange(){const{activeWorkflow:e}=this;if(this.syncFeatureTemplates(),!e)return;const{stepId:t}=e;e.type!=="create-features"?e.type==="update"&&(t==="awaiting-feature-to-update"&&!this.canUpdateVisible||t==="awaiting-update-feature-candidate"&&!e.hasUpdatableCandidates)&&this._cancelWorkflow():t!=="awaiting-feature-creation-info"||this.canCreate||this._cancelWorkflow()}async _cancelWorkflow(e){const t=this.activeWorkflow;if(!t)return void((e==null?void 0:e.warnIfNoWorkflow)&&ae("editing:no-active-workflow","There is no active workflow to cancel."));if(!e||e.force!==!1)return this.emit("workflow-cancel"),this._set("activeWorkflow",null),void await t.cancel(e);await t.cancel(e),this._set("activeWorkflow",null)}_createCreateFeaturesWorkflow(e,t){return Kt.create({viewModel:this,creationInfo:e,sketchOptions:this.sketchOptions,snappingManager:this._snappingManager,startAt:t,applyEditsCallback:(i,a,r)=>this._applyEdits(i,a,r),addAttachmentsCallback:(i,a)=>this._addAttachments(i,a)})}_createUpdateWorkflow(e){return za.create({viewModel:this,sketchOptions:this.sketchOptions,snappingManager:this._snappingManager,startAt:e,applyEditsCallback:(t,i,a)=>this._applyEdits(t,i,a),addAttachmentsCallback:(t,i)=>this._addAttachments(t,i)})}_addAttachments(e,t){const i=t.map(a=>this._addAttachment(e,a.feature,a.attachment))??[];return Promise.all(i)}async _addAttachment(e,t,i){var r;let a=null;if(!("addAttachment"in e)||((r=e.capabilities)==null?void 0:r.attachment)==null)throw new $("editor:attachments-not-supported","Adding attachments is not supported for this layer type");return await this._queueOperation(async()=>{var s;return a=await((s=e.addAttachment)==null?void 0:s.call(e,t,i).catch(n=>{throw(n==null?void 0:n.error)||n}))??null,a}),a}async _applyEdits(e,t,i){let a=null;const r=e.url?await Ei(e.url):null,s={returnServiceEditsOption:(!r||!Ai(r))&&!RegExp("/hosted/","i").test(e.url)?"original-and-current-features":void 0,...i};return await this._queueOperation(async()=>{const{view:n}=this;if(!n)return null;const d=await we(n,e).catch(()=>null);return a=await e.applyEdits(t,s),d&&await D(()=>!d.updating),a}),a}_queueOperation(e){this._activityQueue.push(e);const t=(i,a)=>{const r=a.indexOf(i);r>-1&&a.splice(r,1)};return e().then(i=>{if(i!=null&&"error"in i&&i.error!=null)throw i.error;if(i!=null&&"addFeatureResults"in i){const{addFeatureResults:a,deleteFeatureResults:r,updateFeatureResults:s}=i,n=a.find(d=>!!d.error)||s.find(d=>!!d.error)||r.find(d=>!!d.error);if(n)throw n.error}return i}).catch(i=>{ae("editing:operation-error","An error occurred.",{error:i});const a={error:i,retry:()=>(t(a,this.failures),this._queueOperation(e)),cancel:()=>{t(a,this.failures)}};this._set("failures",[...this.failures,a])}).then(()=>{t(e,this._activityQueue)})}_createUpdatingResolver(){const e=De();return this._updatingHandles.addPromise(e.promise),e}_logErrorAndCancelWorkflow(e){const{name:t,message:i,details:a}=e;ae(t??"editing:workflow-start-failed",i??void 0,a??e),this._cancelWorkflow({force:!0})}_itemIsSuspended(e){const t=this.findEditorItemForLayer(e);return t!=null&&(!t.visible||t.disabled)}};o([l()],y.prototype,"_snappingManager",void 0),o([l({readOnly:!0})],y.prototype,"activeWorkflow",void 0),o([l({readOnly:!0})],y.prototype,"_activityQueue",void 0),o([l({value:[...ei]})],y.prototype,"allowedWorkflows",null),o([l({readOnly:!0})],y.prototype,"canCreate",null),o([l()],y.prototype,"canCreateVisible",null),o([l({readOnly:!0})],y.prototype,"canUpdate",null),o([l()],y.prototype,"canUpdateVisible",null),o([l()],y.prototype,"featureTemplatesLayers",null),o([l()],y.prototype,"editableItems",null),o([l()],y.prototype,"editorItems",void 0),o([l({readOnly:!0})],y.prototype,"failures",void 0),o([l()],y.prototype,"hideTemplatesForInactiveLayers",void 0),o([l()],y.prototype,"attachmentsViewModel",void 0),o([l()],y.prototype,"featureFormViewModel",null),o([l()],y.prototype,"featureTemplatesViewModel",void 0),o([l()],y.prototype,"labelOptions",null),o([l()],y.prototype,"layerInfos",void 0),o([l()],y.prototype,"ownSketchViewModel",void 0),o([l()],y.prototype,"sketchOptions",void 0),o([l()],y.prototype,"sketchViewModel",null),o([l({type:Ut,nonNullable:!0})],y.prototype,"snappingOptions",void 0),o([l()],y.prototype,"spinnerViewModel",void 0),o([l()],y.prototype,"state",null),o([l({readOnly:!0})],y.prototype,"syncing",null),o([l()],y.prototype,"updating",null),o([l()],y.prototype,"tooltipOptions",null),o([l()],y.prototype,"valueOptions",null),o([l()],y.prototype,"view",null),o([l()],y.prototype,"pageStack",void 0),o([l()],y.prototype,"showDiscardEditsPrompt",void 0),o([l()],y.prototype,"_candidateCommitted",void 0),o([l()],y.prototype,"page",null),o([l()],y.prototype,"featureFormDisabled",null),o([l()],y.prototype,"canGoBack",null),o([l()],y.prototype,"shouldShowDeleteButton",null),o([l()],y.prototype,"hasPendingEdits",null),o([l()],y.prototype,"snappingManager",null),y=o([P(Xt)],y);const Qa=y;let G=class extends se{constructor(t){super(t),this.createFeaturesSection=!0,this.directionModePicker=!1,this.editFeaturesSection=!0,this.labelsToggle=!0,this.settingsMenu=!0,this.snappingControls=!0,this.snappingControlsElements=new ut,this.tooltipsToggle=!0,this.undoRedoButtons=!1}};o([l({type:Boolean,nonNullable:!0})],G.prototype,"createFeaturesSection",void 0),o([l({type:Boolean,nonNullable:!0})],G.prototype,"directionModePicker",void 0),o([l({type:Boolean,nonNullable:!0})],G.prototype,"editFeaturesSection",void 0),o([l({type:Boolean,nonNullable:!0})],G.prototype,"labelsToggle",void 0),o([l({type:Boolean,nonNullable:!0})],G.prototype,"settingsMenu",void 0),o([l({type:Boolean,nonNullable:!0})],G.prototype,"snappingControls",void 0),o([l({type:ut,nonNullable:!0})],G.prototype,"snappingControlsElements",void 0),o([l({type:Boolean,nonNullable:!0})],G.prototype,"tooltipsToggle",void 0),o([l({type:Boolean,nonNullable:!0})],G.prototype,"undoRedoButtons",void 0),G=o([P("esri.widgets.Editor.VisibleElements")],G);const ti=G,ye="esri-editor__panel-content",ke={base:ye,message:`${ye}__message`,section:`${ye}__section`,sectionGroup:`${ye}__section__group`,scrimContainer:`${ye}__scrim-container`},Fe=()=>oe({scrim:()=>T(()=>import("./calcite-scrim-B8_2DHG_.js"),__vite__mapDeps([56,57,58,5,21,22,15,4,23,24,6,3,1,2,34,40,42,43,33,35,36,59,13,60,61,62,63,64,65]),import.meta.url)});function X(e,...t){return m("div",{class:Ke(ke.base,e!=null&&e.showScrimOverlay?ke.scrimContainer:void 0),key:(e==null?void 0:e.key)??"panel-content"},...t,e!=null&&e.showScrimOverlay?m("calcite-scrim",null):void 0)}function ft(e,...t){return m("div",{class:ke.message,"data-testid":"panel-content-message",key:(e==null?void 0:e.key)??"panel-content-message"},...t)}function fe(e,...t){return m("div",{class:ke.section,key:(e==null?void 0:e.key)??"panel-content-section"},...t)}function Ka(e,...t){return m("div",{class:ke.sectionGroup,key:(e==null?void 0:e.key)??"panel-content-section-group"},...t)}const Ya=()=>Fe();function Ja({helpMessage:e}){return m(X,{key:"creating-features-panel-content"},m(ft,{key:"content-message"},e))}const Xa=()=>Fe();function er({editorItems:e,filterText:t,id:i,messagesTemplates:a,onFilterTextChange:r,onSelectFeature:s,workflow:n}){const d=new Map,c=n.data.candidates;let p=0;c.map(f=>({label:tr(f),id:f.attributes[f.layer.objectIdField],data:f})).filter(({label:f,data:g})=>{const w=t.toLowerCase(),{title:k}=g.layer,v=e.find(E=>E.layer===g.sourceLayer);return v?v.supportsUpdateWorkflow&&(!w||(f==null?void 0:f.toLowerCase().includes(w))||(k==null?void 0:k.toLowerCase().includes(w))):null}).filter(Ze).forEach(f=>{var w;p++;const g=f.data.layer;d.has(g)?(w=d.get(g))==null||w.items.push(f):d.set(g,{id:`${g.id}`,label:g.title??"",items:[f]})});const h=e.toArray().map(({layer:f})=>d.get(f)).filter(Ze),u=p>10||t.length>0;return m(X,{key:"feature-list"},m(fe,null,gi({enableListScroll:!1,filterEnabled:u,filterText:t,id:i,items:h,messages:{filterPlaceholder:a.filterPlaceholder,noItems:a.noItems,noMatches:a.noMatches},onFilterChange:f=>r(f),onItemMouseEnter:f=>s(f.data),onItemMouseLeave:()=>s(null),onItemSelect:f=>s(f.data,!0)})))}function tr(e){const t=e.layer;if(!t)return null;const i=t.fieldsIndex.get(t.objectIdField),a=i.alias||i.name,{attributes:r}=e,s=Ht(t);return s&&r[s]&&`${r[s]}`||`${a}: ${r[i.name]}`}const ir={base:"esri-editor__actions"},wt=()=>oe({button:()=>T(()=>import("./calcite-button-D_Agetwz.js"),__vite__mapDeps([66,67,58,5,21,22,15,4,23,24,6,3,1,2,34,40,42,43,33,35,36,59,13,68,61,69,70,71,72,60,62,63,64,73,65]),import.meta.url)});function Ue({buttons:e,key:t}){return m("div",{class:ir.base,key:t??"footer-actions",slot:"footer"},e.filter(Ze).map(({disabled:i,onClick:a,label:r,...s},n)=>m("calcite-button",{disabled:i??!1,key:`action-${n}`,onclick:()=>{i||a()},width:"full",...s},r)))}const ar={notice:"esri-editor__notice"},ii=()=>oe({notice:()=>T(()=>import("./calcite-notice-DSp0z_Oh.js"),__vite__mapDeps([74,58,5,21,22,15,4,23,24,6,3,1,2,34,40,42,43,33,35,36,59,13,75,63,61,72,60,62,64,76,77,71,73]),import.meta.url)});function rr({workflow:e,messages:t}){var r,s;const i=[],a="content-start";if(e!=null&&e.reliesOnOwnerAdminPrivileges){const n=t.ownerAdminNotice;i.push(m(Te,{key:"owner-admin-notice",message:n,slot:a}))}if(e!=null&&e.hasInvalidFormTemplate){const n=t.formFieldUpdateError;i.push(m(Te,{key:"form-field-error",kind:"warning",message:n,slot:a}))}if((e==null?void 0:e.type)==="create-features"&&((s=(r=e.data.upload)==null?void 0:r.result)==null?void 0:s.type)==="georeferenced-reprojected"){const n=t.helpMessages3d.meshReprojected;i.push(m(Te,{key:"mesh-reprojected",kind:"warning",message:n,slot:a}))}return m(dt,null,i)}function Te(e){const t=e.kind??"brand";return m("calcite-notice",{class:ar.notice,icon:ia[t],key:e.key,kind:t,open:!0,scale:"s"},e.title?m("div",{slot:"title"},e.title):null,m("div",{slot:"message"},e.message))}const sr={settingsContainer:"esri-editor__settings"},or=()=>oe({accordion:()=>T(()=>import("./calcite-accordion-DaRc_LTx.js"),__vite__mapDeps([78,58,5,21,22,15,4,23,24,6,3,1,2,34,40,42,43,33,35,36,59,13,63]),import.meta.url),"accordion-item":()=>T(()=>import("./calcite-accordion-item-COQjIRwk.js"),__vite__mapDeps([79,58,5,21,22,15,4,23,24,6,3,1,2,34,40,42,43,33,35,36,59,13,75,63,61,71,72,73]),import.meta.url)});function nr({editorViewModel:e,messagesCommon:t,visibleElements:i}){const{snappingOptions:a,sketchOptions:r,view:s,snappingManager:n}=e,d=[],c={directionModePicker:i.directionModePicker,labelsToggle:i.labelsToggle,tooltipsToggle:i.tooltipsToggle};return Object.values(c).includes(!0)&&d.push(m(ea,{sketchOptions:r,viewType:s==null?void 0:s.type,visibleElements:c})),i.snappingControls&&d.push(m(ta,{afterCreate:p=>p.layerListOpen=!1,snappingManager:n,snappingOptions:a,view:s,visibleElements:i.snappingControlsElements??new ut})),d.length===0?null:m("calcite-accordion",{appearance:"transparent",class:sr.settingsContainer,key:"settings"},m("calcite-accordion-item",{"data-testid":"settings",heading:t.settings,iconStart:"gear"},d))}const lr={base:"esri-editor__panel-toolbar"},dr=()=>Promise.all([oe({button:()=>T(()=>import("./calcite-button-D_Agetwz.js"),__vite__mapDeps([66,67,58,5,21,22,15,4,23,24,6,3,1,2,34,40,42,43,33,35,36,59,13,68,61,69,70,71,72,60,62,63,64,73,65]),import.meta.url)}),or()]);function cr({editorViewModel:e,messagesCommon:t,visibleElements:i}){const{sketchViewModel:a}=e;return m("div",{class:lr.base,key:"panel-toolbar"},m(nr,{editorViewModel:e,messagesCommon:t,visibleElements:i}),i.undoRedoButtons?[m("calcite-button",{alignment:"center",appearance:"transparent",disabled:!(a!=null&&a.canUndo()),iconStart:"undo",key:"undo-button",kind:"neutral",label:t.undo,onclick:()=>a==null?void 0:a.undo(),scale:"l"},t.undo),m("calcite-button",{alignment:"center",appearance:"transparent",disabled:!(a!=null&&a.canRedo()),iconStart:"redo",key:"redo-button",kind:"neutral",label:t.redo,onclick:()=>a==null?void 0:a.redo(),scale:"l"},t.redo)]:null)}const pr=()=>Promise.all([wt(),ii(),Fe()]);function Wt({editorViewModel:e,headingLevel:t,messages:i,messagesCommon:a,onDelete:r,onSave:s,renderAttachments:n,renderFeatureForm:d}){const{activeWorkflow:c,featureFormViewModel:p,syncing:h}=e;if(!c||!p)return null;const u=ua(c)?c.activeWorkflow??c:c,f=u.type.includes("update"),g=f&&!u.hasPendingEdits||h||p.updating,w=f?a.update:a.create,k=(u==null?void 0:u.type)==="create-features"&&u.createFeatureState==="create-new",v=(u==null?void 0:u.type)==="create-features"?u.numPendingFeatures:0,E=v>1?Pe(i.createFeaturesTemplate,{numFeatures:v}):w,_=c.shouldShowAttachments&&!p.activeRelationshipInput,F=p.inputs.every(C=>!C.visible)&&!_?m(ft,{key:"panel-content-message"},Pe(i.clickToFinishTemplate,{button:w})):m(fe,{key:"panel-content-section"},m(rr,{messages:i,workflow:c}),m(Ka,null,d(),_?m("div",{key:"attachments"},m(Xe,{level:$e(t)},i.attachments),n()):null));return m(dt,null,m(X,{key:"attribute-panel-content",showScrimOverlay:k},F),m(Ue,{buttons:[{onClick:s,disabled:g,label:E},e.shouldShowDeleteButton?{appearance:"outline",onClick:r,disabled:h,kind:"danger",label:a.delete}:void 0]}))}const U="esri-editor__upload-details",z={base:U,status:`${U}__status`,titleWrapper:`${U}__title-wrapper`,title:`${U}__title`,description:`${U}__description`,loader:`${U}__loader`,iconSuccess:`${U}__icon ${U}__icon--success`,iconError:`${U}__icon ${U}__icon--error`,fileList:`${U}__file-list`,file:`${U}__file`,fileIcon:`${U}__file-icon`,fileName:`${U}__file-name`},ur=()=>Promise.all([oe({icon:()=>T(()=>import("./calcite-icon-Cu0W9dtm.js"),__vite__mapDeps([80,73,58,5,21,22,15,4,23,24,6,3,1,2,34,40,42,43,33,35,36,59,13,61,63]),import.meta.url),loader:()=>T(()=>import("./calcite-loader-DP4PIFO8.js"),__vite__mapDeps([81,65,58,5,21,22,15,4,23,24,6,3,1,2,34,40,42,43,33,35,36,59,13,61,60,62,63]),import.meta.url)}),wt(),Fe()]);function hr(e){const{messages:t,key:i,upload:a}=e;return m(dt,null,m(X,{key:i??"upload-details"},m(fe,null,mr(e))),a.state==="error"?m(Ue,{buttons:[{onClick:()=>a.retry(),label:t.modelUploads.error.uploadNew,iconStart:"upload-to"}],key:"upload-details-footer-actions"}):null)}function mr(e){const t=fr(e);return t?m("div",{class:z.base,"data-testid":"upload-details",key:"upload-details-content"},m("div",{class:z.status,key:"status"},t.iconContent,m("div",{class:z.titleWrapper,key:"text"},m("div",{class:z.title,key:"title"},t.title),m("div",{class:z.description,key:"description"},t.description))),gr(e.upload)):null}function fr({helpMessage:e,messages:t,upload:i}){switch(i.state){case"pending":{const{title:a,description:r}=t.modelUploads.pending;return{title:a,description:r,iconContent:m("calcite-loader",{"aria-hidden":"true",class:z.loader,label:"",scale:"s",type:"determinate",value:Math.min(Math.round(100*i.progress),i.progress===1?100:99)})}}case"success":{const{title:a}=t.modelUploads.success;return{title:a,description:e||t.helpMessages3d.mesh,iconContent:m("calcite-icon",{class:Ke(z.iconSuccess),icon:"check",scale:"l"})}}case"error":{const{title:a}=t.modelUploads.error;return{title:a,description:wr(i.error,t),iconContent:m("calcite-icon",{class:Ke(z.iconError),icon:"exclamation-mark-circle",scale:"l"})}}default:return null}}function wr(e,t){if(!e)return null;const i=t.modelUploads.error.messages;switch(e.constructor){case na:return i.noModel;case oa:return i.multipleModels;case sa:return i.conversionFailed;case $:switch(e.name){case"glt-loader-error":case"gltf-loader-invalid-glb":return i.loadFailed;case"gltf-loader-unsupported-feature":return i.unsupportedFeature;case"glt-loader-request-error":return i.resourceRequestFailed;default:return i.default}default:return i.default}}function gr(e){return m("div",{class:z.fileList,key:"file-list"},e.files.map(t=>m("div",{class:z.file,key:`file-${t.name}`},m("calcite-icon",{class:z.fileIcon,icon:vr(t),scale:"s"}),m("span",{class:z.fileName},yr(t.name)))))}function yr(e){var t;return((t=e.split("/").pop())==null?void 0:t.split("\\").pop())??""}function vr(e){var i;const t=(i=e.name.split(".").pop())==null?void 0:i.toLowerCase();return(t?kr[t]:null)??_r}const _r="file",St="file-shape",Ce="file-image",kr={glb:St,gltf:St,jpeg:Ce,jpg:Ce,png:Ce,svg:Ce,zip:"file-zip"};let b=class extends bi{constructor(e,t){super(e,t),this._featureForm=new fi,this._attachments=new mi({visibleElements:{addSubmitButton:!1,cancelAddButton:!1,cancelUpdateButton:!1,deleteButton:!1,errorMessage:!1,progressBar:!1,updateButton:!1}}),this._featureTemplates=new yi({enableListScroll:!1,renderItemContentEnd:i=>i.supportsUpload?m("calcite-icon",{class:le.templateItemContentEnd,icon:"upload-to",key:"upload-icon"}):null,renderItemLabel:i=>i.label,renderCustomGroupContent:i=>this._renderCustomTemplateGroupContent(i)}),this._filterText="",this._prompt=null,this._spinner=new ki,this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.messagesTemplates=null,this.supportingWidgetDefaults=null,this.viewModel=new Qa,this.visibleElements=new ti,this._renderAttachments=()=>this._attachments.render(),this._renderFeatureForm=()=>this._featureForm.render(),this._renderFeatureTemplates=()=>this._featureTemplates.render(),this._renderSelectIcon=()=>m("calcite-icon",{icon:"cursor",slot:"content-start"}),this.EditorPanel=({heading:i,key:a},...r)=>{const{visibleElements:s}=this;return m("calcite-flow-item",{closable:!1,heading:i,headingLevel:this.headingLevel,key:a,loading:this._loading,onCalciteFlowItemBack:this._onBack},s.settingsMenu?m(cr,{editorViewModel:this.viewModel,messagesCommon:this.messagesCommon,visibleElements:s}):null,...r)},this._showDiscardEditsPrompt=()=>{var r;const{messages:i,activeWorkflow:a}=this;return(a==null?void 0:a.type)==="create-features"&&_e(a.data.creationInfo)?this._showPromptAndWait(((r=a.data.upload)==null?void 0:r.state)==="success"?i.modelUploads.cancelPlacementPrompt:i.modelUploads.cancelUploadPrompt):this._showPromptAndWait({title:i.cancelEditTitle,message:i.cancelEditWarningMessage,yesLabel:i.discardEdits,noLabel:i.continueEditing})},this._showGenericCancelPrompt=()=>{const{messages:i,messagesCommon:a}=this;return this._showPromptAndWait({title:i.cancelRequestTitle,message:i.cancelRequestWarningMessage,yesLabel:a.form.yes,noLabel:a.form.no})},this._showPrompt=i=>{var a,r;(r=(a=this._prompt)==null?void 0:a.cancel)==null||r.call(a),this._prompt=i},this._clearPrompt=()=>{this._prompt=null},this._onSave=()=>{this.viewModel.saveWorkflow()},this._onDelete=()=>{const{messages:i,messagesCommon:a}=this;this._showPrompt({title:i.deleteWarningTitle,message:i.deleteWarningMessage,context:"danger",actions:{primary:{label:a.delete,action:()=>{this.deleteFeatureFromWorkflow(),this._clearPrompt()}},secondary:{label:i.keepFeature,action:this._clearPrompt}}})},this._onToggleUpdateWorkflow=()=>this.viewModel.toggleUpdateWorkflow(),this._onBack=i=>(i==null||i.stopPropagation(),this.viewModel.back()),this._onAttachmentAdd=()=>{var a;const{activeWorkflow:i}=this.viewModel;i&&(i.type==="create-features"||i.type==="update"&&((a=i.activeWorkflow)==null?void 0:a.type)==="create-features"?(this._attachments.addFile(),i.back()):this._attachments.addAttachment().then(()=>i.back()))},this._onAttachmentUpdate=()=>{const{activeWorkflow:i}=this.viewModel;i&&(i.type==="create-features"?(this._attachments.updateFile(),i.back()):this._attachments.updateAttachment().then(()=>i.back()))},this._onAttachmentDelete=()=>{const{messages:i,messagesCommon:a}=this;this._showPrompt({title:i.deleteAttachmentWarningTitle,message:i.deleteAttachmentWarningMessage,context:"danger",actions:{primary:{label:a.delete,action:this._onAttachmentDeleteConfirm},secondary:{label:i.keepAttachment,action:this._clearPrompt}}})},this._onAttachmentDeleteConfirm=async()=>{const i=this._attachments,{activeWorkflow:a}=this.viewModel;a&&(a.type==="create-features"?i.deleteFile():(await i.deleteAttachment(i.viewModel.activeAttachmentInfo),this._clearPrompt()),await a.back(),this._clearPrompt())},this._onAttachmentsError=i=>{this._showPrompt({title:this.messages.errorWarningTitle,message:i.message,context:"warning",actions:{primary:{label:this.messagesCommon.form.ok,action:this._clearPrompt}}})}}initialize(){this._featureForm.showPrompt=this._showPrompt,this._featureForm.clearPrompt=this._clearPrompt,this.addHandles([M(()=>$e(this.headingLevel),e=>{this._featureForm.headingLevel=e,this._featureTemplates.headingLevel=e},re),J(()=>this.viewModel.activeWorkflow,"cancel-request",({controller:e})=>{(this.viewModel.hasPendingEdits?this._showDiscardEditsPrompt():this._showGenericCancelPrompt()).then(t=>t?e.allow():e.deny())}),he(()=>this.viewModel.featureFormViewModel,e=>{this._featureForm.viewModel=e},re),M(()=>this.viewModel,e=>{this._attachments.viewModel=(e==null?void 0:e.attachmentsViewModel)??null,this._featureTemplates.viewModel=(e==null?void 0:e.featureTemplatesViewModel)??null,this._spinner.viewModel=(e==null?void 0:e.spinnerViewModel)??null,e.showDiscardEditsPrompt=this._showDiscardEditsPrompt},re),M(()=>this.view,(e,t)=>{const i=`editor-${this.id}-spinner`;t==null||t.ui.remove(this._spinner,i),e==null||e.ui.add(this._spinner,{key:i,position:"manual"})},re),M(()=>[this.supportingWidgetDefaults,this.viewModel.sketchViewModel],([e])=>{var t;e&&(this._featureForm.set(e.featureForm),this._attachments.set(e.attachments),this._featureTemplates.set(e.featureTemplates),(t=this.viewModel.sketchViewModel)==null||t.set(e.sketch))},re),he(()=>{var e;return(e=this._attachments)==null?void 0:e.error},e=>this._onAttachmentsError(e)),he(()=>{var e;return(e=this.viewModel)==null?void 0:e.failures},e=>{const{messages:t}=this,[{error:i,retry:a,cancel:r}]=e;this._showPrompt({title:t.errorWarningTitle,message:Pe(t.errorWarningMessageTemplate,{errorMessage:i.message}),context:"warning",actions:{primary:{label:t.retry,action:()=>{a(),this._clearPrompt()}},secondary:{label:t.ignore,action:()=>{r(),this._clearPrompt()}}}})}),M(()=>{var e;return(e=this.viewModel)==null?void 0:e.state},e=>{switch(e){case"awaiting-feature-to-update":case"ready":case"disabled":this._filterText="",this._featureTemplates.filterText=""}}),M(()=>this.viewModel.featureFormDisabled,e=>this._featureForm.disabled=e)])}destroy(){this._attachments.destroy(),this._featureForm.destroy(),this._featureTemplates.destroy()}loadDependencies(){return Promise.all([oe({"flow-item":()=>T(()=>import("./calcite-flow-item-B0xZ0mWX.js"),__vite__mapDeps([82,58,5,21,22,15,4,23,24,6,3,1,2,34,40,42,43,33,35,36,59,13,61,69,72,60,62,63,64,83,84,85,86,71,73,65,87,88,89,90,77,91,92,57]),import.meta.url),flow:()=>T(()=>import("./calcite-flow-BrE9BG4l.js"),__vite__mapDeps([93,58,5,21,22,15,4,23,24,6,3,1,2,34,40,42,43,33,35,36,59,13,63,72]),import.meta.url),icon:()=>T(()=>import("./calcite-icon-Cu0W9dtm.js"),__vite__mapDeps([80,73,58,5,21,22,15,4,23,24,6,3,1,2,34,40,42,43,33,35,36,59,13,61,63]),import.meta.url),list:()=>T(()=>import("./calcite-list-C4jOVpC-.js"),__vite__mapDeps([94,58,5,21,22,15,4,23,24,6,3,1,2,34,40,42,43,33,35,36,59,13,61,69,63,95,96,72,64,60,62,97,89,73,98,68,70,71,99,100,101,102,65,57]),import.meta.url)}),Ya(),Xa(),wt(),ii(),Fe(),dr(),aa(),pr(),ur()])}get _deleteButtonCommonInfo(){return{appearance:"outline",kind:"danger"}}get _loading(){const{viewModel:e}=this;return e.syncing||e.updating||this._attachments.submitting}get activeWorkflow(){return this.viewModel.activeWorkflow}get allowedWorkflows(){return this.viewModel.allowedWorkflows}set allowedWorkflows(e){qe(j.getLogger(this),"allowedWorkflows",{replacement:"visibleElements",version:"4.29",warnOnce:!0}),this.viewModel.allowedWorkflows=e}get hideTemplatesForInactiveLayers(){return this.viewModel.hideTemplatesForInactiveLayers}set hideTemplatesForInactiveLayers(e){this.viewModel.hideTemplatesForInactiveLayers=e}get icon(){return"pencil"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(e){this.viewModel.labelOptions=e}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(e){this.viewModel.layerInfos=e}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(e){this.viewModel.tooltipOptions=e}get valueOptions(){return this.viewModel.valueOptions}set valueOptions(e){this.viewModel.valueOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.viewModel.startCreateFeaturesWorkflowAtFeatureTypeSelection()}startCreateFeaturesWorkflowAtFeatureCreation(e){return this.viewModel.startCreateFeaturesWorkflowAtFeatureCreation(e)}startCreateFeaturesWorkflowAtFeatureEdit(e){return this.viewModel.startCreateFeaturesWorkflowAtFeatureEdit(e)}startUpdateWorkflowAtFeatureSelection(){return this.viewModel.startUpdateWorkflowAtFeatureSelection()}startUpdateWorkflowAtMultipleFeatureSelection(e){return this.viewModel.startUpdateWorkflowAtMultipleFeatureSelection(e)}startUpdateWorkflowAtFeatureEdit(e){return this.viewModel.startUpdateWorkflowAtFeatureEdit(e)}deleteFeatureFromWorkflow(){return this.viewModel.deleteFeatureFromWorkflow()}cancelWorkflow(e){return this.viewModel.cancelWorkflow(e)}render(){const{viewModel:e}=this,t=this.classes(le.base,Ft.widget,Ft.panel);return e?m("div",{class:t,key:"base"},m("calcite-flow",{key:"flow"},e.pageStack.map(i=>this._renderPage(i))),this._prompt?m(ra,{...this._prompt,headingLevel:this.headingLevel}):void 0):m("div",{class:t,key:"empty"})}_renderPage(e){switch(e){case"disabled":break;case"ready":return this._renderReady();case"awaiting-feature-creation-info":return this._renderAwaitingFeatureCreationInfo();case"creating-features-upload-details":return this._renderUploadDetails();case"creating-features":return this._renderCreatingFeatures();case"editing-existing-feature":case"editing-attributes":return this._renderUpdateFeature();case"awaiting-update-feature-candidate":return this._renderFeatureList();case"adding-attachment":return this._renderAttachmentAdding();case"editing-attachment":return this._renderAttachmentEditing()}return m("div",{key:"empty-page"})}_renderAwaitingFeatureCreationInfo(){const{EditorPanel:e,messages:t}=this;return m(e,{heading:t.selectTemplate,key:"templates-panel"},m(X,{key:"feature-templates"},m(fe,null,this._renderFeatureTemplates())))}_renderUploadDetails(){const{EditorPanel:e,activeWorkflow:t,messages:i}=this;if((t==null?void 0:t.type)!=="create-features")return null;const a=t.data.upload;return a?m(e,{heading:i.createFeatures,key:"upload-details-panel"},m(hr,{helpMessage:this._helpMessage,messages:i,upload:a})):null}_renderCreatingFeatures(){var d,c;const{EditorPanel:e,activeWorkflow:t,messages:i,messagesCommon:a,headingLevel:r,viewModel:s}=this;if(!t)return null;const n=t.type==="create-features"&&t.numPendingFeatures>0||t.type==="update"&&((d=t==null?void 0:t.activeWorkflow)==null?void 0:d.type)==="create-features"&&((c=t.activeWorkflow)==null?void 0:c.numPendingFeatures)>0;return m(e,{heading:i.createFeatures,key:"create-features-panel"},n?m(Wt,{editorViewModel:s,headingLevel:r,messages:i,messagesCommon:a,renderAttachments:this._renderAttachments,renderFeatureForm:this._renderFeatureForm,onDelete:this._onDelete,onSave:this._onSave}):m(Ja,{helpMessage:this._helpMessage}))}_renderUpdateFeature(){const{EditorPanel:e,messages:t,messagesCommon:i,headingLevel:a,viewModel:r}=this;return m(e,{heading:t.editFeature,key:"update-feature-panel"},m(Wt,{editorViewModel:r,headingLevel:a,messages:t,messagesCommon:i,renderAttachments:this._renderAttachments,renderFeatureForm:this._renderFeatureForm,onDelete:this._onDelete,onSave:this._onSave}))}_renderCustomTemplateGroupContent(e){const{messages:t,viewModel:i}=this,a=di(e.group.items,r=>i.itemHasInvalidFormTemplate(r)?t.formFieldCreateError:void 0);return a?m(Te,{kind:"warning",message:a}):null}_renderAttachmentAdding(){const{EditorPanel:e,_attachments:t,messages:i,messagesCommon:a}=this;return m(e,{heading:i.addAttachment,key:"attachment-adding-panel"},m(X,{key:"attachments"},this._renderAttachments()),m(Ue,{buttons:[{label:t.submitting?a.cancel:a.add,disabled:t.submitting||!t.selectedFile,onClick:this._onAttachmentAdd}]}))}_renderAttachmentEditing(){const{EditorPanel:e,_attachments:t,activeWorkflow:i,messages:a,messagesCommon:r}=this;return i?m(e,{heading:a.editAttachment,key:"attachment-editing-panel"},m(X,{key:"attachments"},this._renderAttachments()),i.shouldAllowAttachmentEditing?m(Ue,{buttons:[{label:r.update,disabled:t.submitting||!t.selectedFile,onClick:this._onAttachmentUpdate},{...this._deleteButtonCommonInfo,onClick:this._onAttachmentDelete,disabled:t.submitting,label:r.delete}]}):void 0):null}_renderReady(){const{EditorPanel:e,messages:t,viewModel:i,visibleElements:a}=this,r=this._helpMessage;return m(e,{heading:t.widgetLabel,key:"landing-panel"},m(X,{key:"landing-content"},i.editorItems.length?[a.editFeaturesSection?m(fe,{key:"edit-actions"},this._renderUpdateActions()):null,a.createFeaturesSection&&i.canCreateVisible?m(fe,{key:"create-actions"},this._renderCreateActions()):null]:m(ft,{key:"no-content"},t.noEditableLayers)),r?m("div",{class:le.helpMessage,key:"footer-actions",slot:"footer"},r):void 0)}get _helpMessage(){var r;const{activeWorkflow:e,messages:t,view:i}=this,a=e==null?void 0:e.helpMessage;return a?(r=t[(i==null?void 0:i.type)==="3d"?"helpMessages3d":"helpMessages2d"])==null?void 0:r[a]:void 0}_renderUpdateActions(){var r;const{messages:e,messagesCommon:t,viewModel:i}=this,a={id:"select",label:t.select};return m("div",{class:le.updateActions,key:"update-actions"},m(Xe,{level:$e(this.headingLevel)},e.editFeatures),m("calcite-list",{class:le.updateActionsList,selectionAppearance:"border",selectionMode:"single"},vi({disabled:!i.canUpdateVisible,grouped:!1,item:a,selectedItem:((r=i.activeWorkflow)==null?void 0:r.stepId)==="awaiting-feature-to-update"?a:void 0,renderIcon:this._renderSelectIcon,onItemSelect:this._onToggleUpdateWorkflow})))}_renderCreateActions(){return m("div",{key:"create-actions"},m(Xe,{level:$e(this.headingLevel)},this.messages.createFeatures),m("div",{class:le.featureTemplatesContainer,key:"templates"},this._renderFeatureTemplates()))}_renderFeatureList(){const{EditorPanel:e,viewModel:t}=this,{activeWorkflow:i}=t;if((i==null?void 0:i.type)!=="update")return null;const a=i.data.candidates,r=Pe(this.messages.multipleFeaturesTemplate,{total:a.length});return m(e,{heading:r,key:"feature-list"},m(er,{editorItems:t.editorItems,filterText:this._filterText,id:this.id,messagesTemplates:this.messagesTemplates,workflow:i,onFilterTextChange:s=>this._filterText=s,onSelectFeature:(s,n)=>t.selectFeature(s,n)}))}_showPromptAndWait({title:e,message:t,yesLabel:i,noLabel:a}){const r=De(),{view:s}=this,n=s==null?void 0:s.focused;return this._showPrompt({title:e,message:t,context:"danger",actions:{primary:{label:i,action:()=>r.resolve(!0)},secondary:{label:a,action:()=>r.resolve(!1)}}}),r.promise.finally(()=>{this._clearPrompt(),n&&(s==null||s.focus())})}};o([l()],b.prototype,"_featureForm",void 0),o([l()],b.prototype,"_attachments",void 0),o([l()],b.prototype,"_featureTemplates",void 0),o([l()],b.prototype,"_filterText",void 0),o([l()],b.prototype,"_prompt",void 0),o([l()],b.prototype,"_spinner",void 0),o([l()],b.prototype,"_deleteButtonCommonInfo",null),o([l()],b.prototype,"_loading",null),o([l({readOnly:!0})],b.prototype,"activeWorkflow",null),o([l()],b.prototype,"allowedWorkflows",null),o([l()],b.prototype,"headingLevel",void 0),o([l()],b.prototype,"hideTemplatesForInactiveLayers",null),o([l()],b.prototype,"icon",null),o([l()],b.prototype,"label",null),o([l()],b.prototype,"labelOptions",null),o([l()],b.prototype,"layerInfos",null),o([l(),Ge("esri/widgets/Editor/t9n/Editor")],b.prototype,"messages",void 0),o([l(),Ge("esri/t9n/common")],b.prototype,"messagesCommon",void 0),o([l(),Ge("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],b.prototype,"messagesTemplates",void 0),o([l()],b.prototype,"snappingOptions",null),o([l()],b.prototype,"tooltipOptions",null),o([l()],b.prototype,"supportingWidgetDefaults",void 0),o([l({type:ui,nonNullable:!0})],b.prototype,"valueOptions",null),o([l()],b.prototype,"view",null),o([l(),la(["sketch-create","sketch-delete","sketch-update","workflow-cancel","workflow-commit"])],b.prototype,"viewModel",void 0),o([l({type:ti,nonNullable:!0})],b.prototype,"visibleElements",void 0),o([l()],b.prototype,"_helpMessage",null),b=o([P("esri.widgets.Editor")],b);const Kl=b;export{Kl as default};
