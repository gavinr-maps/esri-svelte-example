const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-B7tnQVNM.js","./jsxFactory-Cnml7uXM.js","./Accessor-BmwT4B0c.js","./intl-Duiy0OzY.js","./Promise-DfET-uns.js","./cast-CsZslgGN.js","./index-4eY77cms.js","./index-Cx51aysm.css","./JSONSupport-DcrLLGjL.js","./Evented-Dw4_VOGn.js","./reactiveUtils-XM7cS2OP.js","./SimpleObservable-CvOkykwM.js","./uuid-Cl5lrJ4c.js","./observers-Co4E8E8j.js","./index-BU6zLEew.js","./index-DwIhxbHs.js","./dom-DEluURzl.js","./guid-ejniuQmw.js","./keyed-CU1C-h1n.js","./directive-helpers-DaBykg1t.js","./ref-D9wHsL_T.js","./component-CBVlbUuE.js","./loadable-XBvaWFYY.js","./index-BPm91e5Z.js","./index-CMxz6F2k.js","./useT9n-C1Hrfc-A.js","./interactive-DTzfFku4.js","./index-CK-Mi3hP.js","./index-BciJpaKz.js","./form-BzoUrXC7.js","./key-CZcQa38B.js","./label-CHHpnzD0.js","./index-jjUP6Yam.js","./static-DLD4WjLv.js","./index-BYx-hdGk.js","./index-fFnlo_g2.js","./index-BtUFGore.js","./live-D7NQ-TrC.js","./core-zHisM37C.js","./filter-D4A4y0z5.js","./escapeRegExp-CdLjXKbf.js","./debounce-DbkufipY.js","./floating-ui-IixYHfbQ.js","./openCloseComponent-nqWrSaIH.js","./Validation-BYp9DS84.js","./utils3-Iojtwv7b.js","./index-CP8r2QEY.js","./text-C54aRk62.js","./index-DVGzfobf.js","./dynamicClasses-pKEMtFzB.js","./index-CMdCteX_.js","./index-Z5_W1-0F.js","./index-DMeQur4V.js","./FloatingArrow-BZRr6Zld.js","./useFocusTrap-COeL24Kx.js","./focusTrapComponent-D1wJZ4RD.js","./index-DK5B8inx.js","./array-BbE1dLa5.js","./index-DyXGQ9Xl.js","./index-C6rrpqn6.js","./index-pyEU_klK.js","./index-DWeq-ojO.js","./locale-CXx8I9ox.js","./input-DI9tZAPS.js","./index-Dwo8yu4W.js","./customElement-BxsvsANk.js","./index-Cl-EVQNh.js","./index-Brz2wqWq.js","./global-BYws3GYH.js","./index-Dc6NQLgc.js","./math-BpAtBkbz.js","./index--OBudxYA.js","./index-BCDLx0rN.js","./utils-Dtivty39.js","./index-B0pN5y8B.js","./index-C7Sgjfzm.js","./resources6-Cs2_VmEC.js","./index-XCNLEnDV.js","./customElement-_nG5icNK.js","./resources5-SciNIBSe.js","./index-CV25o1as.js","./resources4-Crg87oFz.js"])))=>i.map(i=>d[i]);
import{_ as w,L as ce,u as ue,c as de,n as he,i as me,a as pe}from"./index-4eY77cms.js";import{d as D,v as ee,A as V,p as ve,V as te,P as B}from"./reactiveUtils-XM7cS2OP.js";import{O as ie,d as _e,g as U}from"./RouteLayer-BP9dUWeB.js";import{r as n,m as c,a as P,k as re,B as ge,s as M,E as R,g as we,e as ye,G as fe,a1 as be}from"./Accessor-BmwT4B0c.js";import{C as Se}from"./Portal-CmmHxpLg.js";import{e as Te}from"./defaultUnit-CHqZKPQE.js";import{w as $,b as oe}from"./Stop-Cb4ynHVF.js";import{y as Ie}from"./TextSymbol-BLIQ6RKX.js";import{C as Me,x as De,v as ke}from"./Search-CPVd7OLn.js";import{O as Ee,c as $e,n as o,e as H}from"./jsxFactory-Cnml7uXM.js";import{i as se}from"./Evented-Dw4_VOGn.js";import{n as Ae}from"./InteractiveToolBase-rZBtMOMv.js";import{F as x,e as O,D as A,r as Le,u as ae,b as K,I as q,x as Fe,j}from"./Promise-DfET-uns.js";import{s as Ce,l as Re}from"./opacityUtils-Dim20wpZ.js";import{s as Pe}from"./timeZoneUtils-DxzjpEBb.js";import{a as xe,s as S}from"./quantityUtils-BsDK158M.js";import{g as Oe}from"./unitFormatUtils-Q7ZG7HcF.js";import{l as Ne}from"./intl-Duiy0OzY.js";import{I as J}from"./dateUtils-CkANlKbA.js";import{t as ze}from"./GoTo-zPv0y7kC.js";import{e as Z}from"./globalCss-vQlnDsEX.js";import{P as Ve}from"./useWidget-BajufX8l.js";import{x as Be}from"./component-utils-D0ciaaZ_.js";import"./SimpleObservable-CvOkykwM.js";import"./Graphic-Dt0LgVGU.js";import"./Clonable-Z-AWS-16.js";import"./JSONSupport-DcrLLGjL.js";import"./cast-CsZslgGN.js";import"./writer-DKgfqj4X.js";import"./enumeration-DpvDkLNI.js";import"./Color-VJEMvW-n.js";import"./colorUtils-Rxh2V3ai.js";import"./mathUtils-Cfq9PL9W.js";import"./ActionToggle-D7439N1A.js";import"./Identifiable-BHVfzH03.js";import"./jsonUtils-CwFG8yN4.js";import"./Extent-g5W9hy0j.js";import"./Point-Cz2JYYmX.js";import"./Polyline-s-JzsQqo.js";import"./typeUtils-B6WBEKDM.js";import"./collectionUtils-CTT-51g7.js";import"./screenUtils-_ZIvrt5o.js";import"./vec3f64-BLpZdpfb.js";import"./aaBoundingBox-Dw3yBk2f.js";import"./MultiOriginJSONSupport-DbmrbwMa.js";import"./originUtils-D69mHv66.js";import"./multiOriginJSONSupportUtils-C0wm8_Yw.js";import"./projection-CyCZAIaD.js";import"./projectBuffer-CQnuEMuP.js";import"./geodesicConstants-RQL9oKdk.js";import"./Layer-DH4_Pn8a.js";import"./TimeExtent-BO6BsF_x.js";import"./timeUtils-C1c_L2Fd.js";import"./ScaleRangeLayer-Cnzwr9PT.js";import"./layerContainerType-C5CzMsLd.js";import"./jsonUtils-DZz5FrgB.js";import"./utils-DYurMneM.js";import"./mat4f32-DcsiF_Rp.js";import"./mat4-Fi6iAz29.js";import"./common-DQOJ18NT.js";import"./OperationalLayer-B__lrMRq.js";import"./commonProperties-B0GHoNP5.js";import"./ElevationInfo-BPOqhCue.js";import"./unitConversionUtils-rg07EgOm.js";import"./lengthUtils-_77UiyVF.js";import"./AttributeTableTemplate-cR37sM72.js";import"./PortalLayer-Cqwv_mmr.js";import"./layerUtils-B__v9OBu.js";import"./PortalItem-CTx1kJsR.js";import"./portalItemUtils-ByOtbGao.js";import"./jsonUtils-BZp85R7u.js";import"./typeUtils-B3iPBwJ2.js";import"./ClassBreaksRenderer-C7fhua2J.js";import"./commonProperties-ZfGquLPI.js";import"./colorRamps-CRjjPL3r.js";import"./SizeVariable-B-ghFm6e.js";import"./visualVariableUtils-Xcorldoo.js";import"./ColorStop-BYiAUa8d.js";import"./jsonUtils-B-voMz-i.js";import"./defaults-FkBa0ybj.js";import"./defaultsJSON-GKolV7NZ.js";import"./RendererLegendOptions-CYAPr8D6.js";import"./LRUCache-CXiGQWMN.js";import"./MemCache-CmojB_Z1.js";import"./Version-Cd3TlGH0.js";import"./FieldsIndex-FW1AMU67.js";import"./utils-UPZJIDfz.js";import"./defaultCIMValues-Bb-CUowV.js";import"./enums-BTM-fOHQ.js";import"./HeatmapColorStop-CHbSyb1s.js";import"./heatmapUtils-Cyq-bAyG.js";import"./vec42-YcqnINSP.js";import"./vec4f64-o2zAXfmz.js";import"./SimpleRenderer-CEw_geZx.js";import"./UniqueValueRenderer-yoWHKJ_P.js";import"./diffUtils-BanfihCO.js";import"./styleUtils-ColFrJ-Z.js";import"./utils-YowqfOgk.js";import"./networkEnums-BgkT2jou.js";import"./normalizeUtils-BTGdXlpz.js";import"./normalizeUtilsCommon-lGDszWRI.js";import"./utils-B-dlKIhi.js";import"./FeatureSet-B5-Veyin.js";import"./Field-BDG0QV_T.js";import"./fieldType-CBeoJWlv.js";import"./GPMessage-Ba6qfxW_.js";import"./commonProperties-DHiB1uzW.js";import"./getDefaultUnitForView-BBSnYQvp.js";import"./geometryUtils-D1iOC1ST.js";import"./scaleUtils-DPfHG2g0.js";import"./layerViewUtils-Bevty3Jm.js";import"./FullTextSearch-CBnxSwz4.js";import"./substitute-CvdjmBYq.js";import"./geolocationUtils-BUZ2_doz.js";import"./project-CvBujuEW.js";import"./accessibleHandler-BaA3O97p.js";import"./vmEvent-D4Ubqkbq.js";import"./uuid-Cl5lrJ4c.js";import"./interfaces-D6pIddIh.js";import"./ByteSizeUnit-BsxeN7wM.js";import"./Cyclical-Dlbl-cQK.js";import"./index-C5b9dHRB.js";let L=class extends se.EventedMixin(Ae){constructor(t){super(t)}get cursor(){return"crosshair"}onInputEvent(t){t.type==="click"&&this._handleClick(t)}_handleClick(t){this.emit("click",t)}};n([c({readOnly:!0})],L.prototype,"cursor",null),n([c({constructOnly:!0})],L.prototype,"stop",void 0),L=n([P("esri.widgets.Directions.DirectionsSearchTool")],L);const G=new Map([["arrive","route-to"],["bear-left","bear-left"],["bear-right","bear-right"],["boundary-crossing","blank"],["central-fork","fork-middle"],["clockwise-roundabout","round-about-right"],["counter-clockwise-roundabout","round-about"],["depart","route-from"],["door","walk-through-door"],["down-elevator","elevator-down"],["down-escalator","escalator-down"],["down-stairs","stairs-down"],["elevator","elevator"],["escalator","escalator"],["general-event","information"],["header","blank"],["landmark","map-pin"],["lane","blank"],["left-fork","fork-left"],["left-handed-u-turn","u-turn"],["left-ramp","ramp-left"],["left-turn","left"],["left-turn-and-immediate-left-turn","left-left"],["left-turn-and-immediate-right-turn","left-right"],["off-ferry","disembark"],["on-ferry","embark"],["pedestrian-ramp","take-pedestrian-ramp"],["restriction-violation","exclamation-mark-triangle"],["right-fork","fork-right"],["right-handed-u-turn","u-turn-right"],["right-ramp","ramp-right"],["right-turn","right"],["right-turn-and-immediate-left-turn","right-left"],["right-turn-and-immediate-right-turn","right-right"],["roundabout","round-about"],["scaled-cost-barrier-event","blank"],["sharp-left","sharp-left"],["sharp-right","sharp-right"],["stairs","stairs"],["straight","straight"],["time-zone-change","clock"],["traffic-event","exclamation-mark-triangle"],["u-turn","u-turn"],["up-elevator","elevator-up"],["up-escalator","escalator-up"],["up-stairs","stairs-up"]]);var T;function k(e,t){return Ne(e,{style:"unit",unit:t,unitDisplay:"short"})}function W(e,t,i){if(t===0)return"";let r,s,l=0;const u=xe(t,"meters");switch(i){case"metric":u.value<.01?{value:r,unit:s}=S(u,"millimeters"):u.value<1?{value:r,unit:s}=S(u,"centimeters"):u.value<1e3?{value:r,unit:s}=S(u,"meters"):u.value<1e5?({value:r,unit:s}=S(u,"kilometers"),l=1):{value:r,unit:s}=S(u,"kilometers");break;case"imperial":u.value<.254?{value:r,unit:s}=S(u,"inches"):u.value<160.9344?{value:r,unit:s}=S(u,"feet"):u.value<160934.4?({value:r,unit:s}=S(u,"miles"),l=1):{value:r,unit:s}=S(u,"miles");break;default:({value:r,unit:s}=S(u,i)),l=2}return Oe(e,r,s,l)}function Q(e){if(e===0)return"";if(e<1)return k(Math.floor(60*e),"second");if(e<60)return k(Math.floor(e),"minute");const t=Math.floor(e/60);if(e<1440){const i=Math.floor(e%60);return i===0?`${k(t,"hour")}`:`${k(t,"hour")} ${k(i,"minute")}`}return k(t,"hour")}function Ue(e){return e!=null&&G.has(e)?G.get(e):"blank"}(function(e){e.NOW="now",e.DEPART_AT="depart-at",e.UNSPECIFIED="unspecified"})(T||(T={}));function He(e){return e.map(t=>({locale:t,parts:ae(t)})).filter(({parts:t})=>!!t)}function Ke(e,t){var i,r;return((i=e.find(({parts:s})=>Y(s.language,t.language)&&s.region===t.region))==null?void 0:i.locale)??((r=e.find(({parts:s})=>Y(s.language,t.language)))==null?void 0:r.locale)}function qe(e){return(e==null?void 0:e.declaredClass)==="esri.Graphic"}function X(e){return e==="no"||e==="nb"}function Y(e,t){return e===t||X(e)&&X(t)}function je(e){return(e==null?void 0:e.declaredClass)==="esri.rest.support.Stop"}var b;(function(e){e[e.Active=0]="Active",e[e.Complete=1]="Complete",e[e.Failed=2]="Failed",e[e.Idle=3]="Idle",e[e.Suspended=4]="Suspended"})(b||(b={}));let m=class extends ze(se.EventedAccessor){constructor(e){super(e),this._debouncedSolveHandler=re(async t=>{var i;switch(t.type){case"create":if(t.state!=="complete")return;break;case"delete":break;case"update":switch(t.state){case"start":return void(this._networkFeatureUpdated=!1);case"active":return void(this._networkFeatureUpdated=!0);case"complete":if(!this._networkFeatureUpdated)return}}if(!((((i=this.layer)==null?void 0:i.stops.filter(({geometry:r})=>!!r).length)??0)<2)&&this.autoSolve)try{await this.getDirections({zoomToSolvedRoute:!1})}catch(r){ge.getLogger(this).error(r)}}),this._highlight=null,this._loadController=null,this._loadPromise=null,this._networkFeatureUpdated=!1,this._layerView=null,this._routeController=null,this._serviceDescriptionStatus=b.Idle,this.apiKey=void 0,this.autoSolve=!0,this.defaultTravelMode=null,this.departureIsoDate=void 0,this.departureIsoTime=void 0,this.departureOption=T.NOW,this.departureTime="now",this.lastError=null,this.lastRoute=null,this.layer=null,this.maxStops=50,this.routeParameters=new ie({directionsLengthUnits:"kilometers",findBestSequence:!1,preserveFirstStop:!0,preserveLastStop:!0,returnZ:!0,useTimeWindows:!1}),this.serviceDescription=null,this.view=null}initialize(){var i;this.addHandles([D(()=>this.layer,r=>{if(r!=null){for(;r.stops.length<2;)r.stops.add(new $);this._set("defaultTravelMode",null),this.addHandles(ve(()=>{var s,l;return this.serviceDescription?(l=(s=r.routeInfo)==null?void 0:s.analysisSettings)==null?void 0:l.travelMode:null},s=>{this.defaultTravelMode=this._resolveDefaultTravelMode(s)},{once:!0}))}},V),D(()=>[this.layer,this.view],async()=>{this._layerView=await this._getRouteLayerView()},V),ee(()=>this._layerView,["create","delete","update"],r=>{this._debouncedSolveHandler(r).catch(s=>{if(!R(s))throw s})})]);const e=x(((i=this.view)==null?void 0:i.timeZone)??O),t=A.fromMillis(Date.now());this.departureIsoDate=t.toFormat(Ce,J(e)),this.departureIsoTime=t.toFormat(Re,J(e))}get _directionsLanguage(){var l;const e=(l=this.serviceDescription)==null?void 0:l.directionsSupportedLanguages;if(!e)return;const t=this.routeParameters.directionsLanguage??Le(),i=ae(t),r=i==null?void 0:i.language,s=i==null?void 0:i.region;if(r)return Ke(He(e),{language:r,region:s})}get formattedEta(){var v,y,g,f,I,z;const e=(y=(v=this.layer)==null?void 0:v.routeInfo)==null?void 0:y.endTime,t=(f=(g=this.layer)==null?void 0:g.routeInfo)==null?void 0:f.endTimeOffset;if(this.departureOption===T.UNSPECIFIED||!e||!t)return null;const i=A.fromJSDate(e,{zone:K.instance(t)}),r=A.fromJSDate(e,{zone:q.create(x(((I=this.view)==null?void 0:I.timeZone)??O))}),s=A.fromJSDate(new Date,{zone:q.create(x(((z=this.view)==null?void 0:z.timeZone)??O))}),l=s.year===r.year&&s.month===r.month&&s.day===r.day,u=r.offset===t?void 0:Pe,h=l?void 0:j("short-date"),p=j("short-time");return Fe(i.toISO(),{...h,...p,timeZoneName:u})}get impedanceAttribute(){var t,i;const e=((t=this.routeParameters.travelMode)==null?void 0:t.impedanceAttributeName)??this.routeParameters.impedanceAttribute??((i=this.serviceDescription)==null?void 0:i.impedance)??null;return this.getCostAttribute(e)}get selectedNetworkFeatures(){var e;return((e=this._layerView)==null?void 0:e.selectedNetworkFeatures)??null}get selectedTravelMode(){var e;return this.serviceDescription?this.defaultTravelMode??this.serviceDescription.defaultTravelMode??((e=this.serviceDescription.supportedTravelModes)==null?void 0:e[0])??null:null}set selectedTravelMode(e){this._override("selectedTravelMode",e)}get state(){if(this._routeController)return"routing";if(this.lastError)return"error";switch(this._serviceDescriptionStatus){case b.Suspended:return"unauthenticated";case b.Idle:return"disabled";case b.Active:return"initializing";case b.Failed:return"error";default:return"ready"}}get timeAttribute(){var t,i;const e=((t=this.routeParameters.travelMode)==null?void 0:t.timeAttributeName)??this.routeParameters.directionsTimeAttribute??((i=this.serviceDescription)==null?void 0:i.directionsTimeAttribute)??null;return this.getCostAttribute(e)}get travelModes(){var t,i;const e=((i=(t=this.serviceDescription)==null?void 0:t.supportedTravelModes)==null?void 0:i.slice())??[];return this.defaultTravelMode==null||e.includes(this.defaultTravelMode)||e.unshift(this.defaultTravelMode),e}async load(){if(this._loadPromise)return this._loadPromise;this._loadPromise=this._load(),await this._loadPromise,this._loadPromise=null}async highlight(e){if(this.clearHighlights(),!this.view||!this.layer)return;const t=await this.view.whenLayerView(this.layer);this._highlight=t.highlight(e)}clearHighlights(){this._highlight!=null&&(this._highlight.remove(),this._highlight=null)}centerAt(e){if(!this.view)return;const t=je(e)||qe(e)?e.geometry:e;t&&this.callGoTo({target:t})}clearResults(){var e;this._set("lastRoute",null),(e=this.layer)==null||e.removeResult()}async create(e){var t;await((t=this._layerView)==null?void 0:t.create(e))}async getDirections(e={zoomToSolvedRoute:!0}){var y;const{apiKey:t,layer:i,state:r}=this;if(!i)throw new M("directions-view-model:missing-route-layer","A route layer must be associated with the view model.");if(r==="unauthenticated"||r==="initializing"||r==="disabled"||this._serviceDescriptionStatus===b.Failed)throw new M("directions-view-model:not-loaded","Cannot get directions until view model loads.");this._routeController!=null&&(this._routeController.abort(),this._routeController=null);const{startTime:s,startTimeIsUTC:l}=this._getStartTimeParameters(),u=((y=this.view)==null?void 0:y.spatialReference)??null,h=this.routeParameters.clone();if(h.set({apiKey:t,directionsLanguage:this._directionsLanguage,outSpatialReference:u,startTime:s,startTimeIsUTC:l}),this.selectedTravelMode&&(h.travelMode=this.selectedTravelMode),i.stops.filter(({geometry:g})=>g!=null).length<2){const g=new M("directions-view-model:not-enough-stops","Not enough stops for routing");throw this._set("lastError",g),g}this._routeController=new AbortController;const{signal:p}=this._routeController;let v=null;try{v=await i.solve(h,{signal:p})}catch(g){if(!R(g)){const f=new M("directions-view-model:unable-to-route","Unable to route to these addresses",{error:g});throw this._set("lastError",f),this.clearResults(),f}}finally{this._routeController=null}this._set("lastError",null);for(const g of v.stops)g.geometry==null&&(g.name=null);return i.update(v),this._set("lastRoute",v),e.zoomToSolvedRoute&&this.zoomToRoute(),v}getCostAttribute(e){var t,i;return(((i=(t=this.serviceDescription)==null?void 0:t.networkDataset)==null?void 0:i.networkAttributes)??[]).find(({name:r,usageType:s})=>r===e&&s==="cost")??null}remove(e){var t;(t=this._layerView)==null||t.remove(e)}reset(){this.clearHighlights(),this.clearResults(),this.layer!=null&&(this.layer.removeAll(),this.layer.stops=new te([new $,new $]))}save(){if(!this.layer)throw new M("directions-view-model:missing-layer","save() requires a layer");return this.layer.save()}saveAs(e,t={}){if(!this.layer)throw new M("directions-view-model:missing-layer","saveAs() requires a layer");return this.layer.saveAs(e,t)}async startEditing(){this._layerView&&(this._layerView.interactive=!0)}async stopEditing(){this._layerView&&(this._layerView.interactive=!1)}updateDepartureTime(){if(this.departureIsoDate&&this.departureIsoTime)switch(this.departureOption){case T.NOW:this.departureTime="now";break;case T.DEPART_AT:{const e=A.fromISO(`${this.departureIsoDate}T${this.departureIsoTime}`,{zone:K.instance(0)});this.departureTime=e.toJSDate();break}case T.UNSPECIFIED:this.departureTime=null}}zoomToRoute(){var l,u;const{view:e,layer:t}=this,i=(u=(l=t==null?void 0:t.routeInfo)==null?void 0:l.geometry)==null?void 0:u.extent;if(!e||!i)return;const r=i.width>i.height,s=i.clone().expand(r?2:1);this.callGoTo({target:s})}async _getRouteLayerView(){return this.view&&this.layer?this.view.whenLayerView(this.layer):null}_getStartTimeParameters(){var e;return this.departureTime==="now"?{startTime:((e=this.serviceDescription)==null?void 0:e.capabilities.supportsNow)??!1?"now":new Date,startTimeIsUTC:!0}:this.departureTime==null?{startTime:void 0,startTimeIsUTC:void 0}:{startTime:this.departureTime,startTimeIsUTC:!1}}async _load(){if(this.layer==null)return;this._loadController!=null&&(this._loadController.abort(),this._loadController=null),this._loadController=new AbortController;const{signal:e}=this._loadController;try{this._serviceDescriptionStatus=b.Active;const t=await _e(this.layer.url,this.apiKey,{signal:e});this._set("serviceDescription",t),this._serviceDescriptionStatus=b.Complete}catch(t){if(R(t))return void(this._serviceDescriptionStatus=b.Idle);if(t.name==="identity-manager:user-aborted")return void(this._serviceDescriptionStatus=b.Suspended);const i=new M("directions-view-model:service-metadata-unavailable","Cannot load route service metadata",{error:t});throw this._serviceDescriptionStatus=b.Failed,this._set("lastError",i),i}finally{this._loadController=null}}_resolveDefaultTravelMode(e){var l,u;if(this.serviceDescription==null)return null;const{defaultTravelMode:t,supportedTravelModes:i}=this.serviceDescription,r=(u=(l=/^<(?<name>.*)>$/i.exec(e.name))==null?void 0:l.groups)==null?void 0:u.name;if(r){const h=i==null?void 0:i.find(({name:v})=>v.toLocaleLowerCase()===r.trim().toLocaleLowerCase()),p=h??t;return oe.fromJSON({...p==null?void 0:p.toJSON(),...e.toJSON()})}return(i==null?void 0:i.find(({name:h})=>h.toLocaleLowerCase()===e.name.toLocaleLowerCase()))??t}};n([c()],m.prototype,"_directionsLanguage",null),n([c()],m.prototype,"_layerView",void 0),n([c()],m.prototype,"_routeController",void 0),n([c()],m.prototype,"_serviceDescriptionStatus",void 0),n([c()],m.prototype,"apiKey",void 0),n([c()],m.prototype,"autoSolve",void 0),n([c()],m.prototype,"defaultTravelMode",void 0),n([c()],m.prototype,"departureTime",void 0),n([c()],m.prototype,"formattedEta",null),n([c({readOnly:!0})],m.prototype,"impedanceAttribute",null),n([c()],m.prototype,"lastError",void 0),n([c({readOnly:!0})],m.prototype,"lastRoute",void 0),n([c()],m.prototype,"layer",void 0),n([c({type:Number,range:{min:2,max:50},nonNullable:!0})],m.prototype,"maxStops",void 0),n([c({type:ie,nonNullable:!0})],m.prototype,"routeParameters",void 0),n([c({readOnly:!0})],m.prototype,"selectedNetworkFeatures",null),n([c({type:oe})],m.prototype,"selectedTravelMode",null),n([c({readOnly:!0})],m.prototype,"serviceDescription",void 0),n([c({readOnly:!0})],m.prototype,"state",null),n([c({readOnly:!0})],m.prototype,"timeAttribute",null),n([c()],m.prototype,"travelModes",null),n([c()],m.prototype,"view",void 0),n([c()],m.prototype,"zoomToRoute",null),m=n([P("esri.widgets.Directions.DirectionsViewModel")],m);const ne=m;let E=class extends we{constructor(){super(...arguments),this.layerDetails=!0,this.saveAsButton=!0,this.saveButton=!0}};n([c({type:Boolean,nonNullable:!0})],E.prototype,"layerDetails",void 0),n([c({type:Boolean,nonNullable:!0})],E.prototype,"saveAsButton",void 0),n([c({type:Boolean,nonNullable:!0})],E.prototype,"saveButton",void 0),E=n([P("esri.widgets.Directions.DirectionsVisibleElements")],E);const le=E;function Je(e){const{branchName:t,displayText:i,exitName:r,intersectingName:s,name:l,towardName:u}=e;if(i==null)return null;const h=[t,r,s,l,u].filter(fe).sort((f,I)=>I.length-f.length).map(f=>be(f));if(!h.length)return i;const p=new RegExp(h.join("|"),"g"),v=i.matchAll(p);let y=0;const g=[];for(const{0:f,index:I}of v)g.push(i.slice(y,I),o("span",{class:a.labelEmphasize,key:`maneuver-${I}`},f)),y=I+f.length;return g.push(i.slice(y)),o("span",null,g)}const d="esri-directions",a={base:d,accordion:`${d}__accordion`,actionContainer:`${d}__action-container`,addStopButton:`${d}__add-stop-button`,departureTime:`${d}__departure-time`,departureTimeOptions:`${d}__departure-time-options`,directionsHeader:`${d}__directions-header`,directionsHeaderStopName:`${d}__directions-header-stop-name`,editFooter:`${d}__edit-footer`,editToolbar:`${d}__edit-toolbar`,editToolbarContainer:`${d}__edit-toolbar-container`,flexColumn:`${d}__flex-column`,headerStops:`${d}__header-stops`,labelEmphasize:`${d}__label-emphasize`,labelNoBottomMargin:`${d}__label-no-bottom-margin`,marginInlineMedium:`${d}__margin-inline-medium`,optimizeSection:`${d}__optimize-section`,optimizeSwitches:`${d}__optimize-switches`,paddingMedium:`${d}__padding-medium`,primaryFlowItem:`${d}__primary-flow-item`,primaryFooter:`${d}__primary-footer`,primaryFooterCentered:`${d}__primary-footer-centered`,primaryFooterLoader:`${d}__primary-footer-loader`,routeItem:`${d}__route-item`,routeItemButton:`${d}__route-item-button`,routeItemButtonContent:`${d}__route-item-button-content`,routeItemLabel:`${d}__route-item-label`,routeItemDescription:`${d}__route-item-description`,saveError:`${d}__save-error`,saveErrorIcon:`${d}__save-error-icon`,saveErrorLabel:`${d}__save-error-label`,saveProcessLoader:`${d}__save-process-loader`,selectedFeatureContainer:`${d}__selected-feature-container`,separator:`${d}__separator`,solveRoute:`${d}__solve-route`,stopContainer:`${d}__stop-container`,stopList:`${d}__stop-list`,stopItem:`${d}__stop-item`};let _=class extends Ee{constructor(e,t){super(e,t),this._activeManeuver=null,this._placeholderStops=new te([new $,new $]),this._portalFolderCombobox=null,this._portalFolders=null,this._portalItemNameInput=null,this._portalUserName=null,this._sections=null,this._stopsToSearches=new Map,this._currentFlowItem="primary",this._parentFlowItem="primary",this._saveState="initialized",this._searchTool=null,this.headingLevel=2,this.messages=null,this.messagesUnits=null,this.searchProperties=null,this.viewModel=new ne,this.visibleElements=new le,this._solveRouteDebounced=re(()=>this._solveRoute())}initialize(){this.addHandles([D(()=>this.viewModel.layer,()=>{try{this.viewModel.load()}catch{}},B),D(()=>{var e;return(e=this.viewModel.layer)==null?void 0:e.routeInfo},()=>{this._sections=this._getStopSections()},B),D(()=>{var e;return(e=this.viewModel.layer)==null?void 0:e.stops.toArray()},e=>{var t;e&&((t=this.view)!=null&&t.activeTool)&&this._searchTool&&this.view.activeTool===this._searchTool&&!e.includes(this._searchTool.stop)&&(this.view.tools.remove(this._searchTool),this._searchTool=null)})])}loadDependencies(){return $e({accordion:()=>w(()=>import("./index-B7tnQVNM.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url),"accordion-item":()=>w(()=>import("./index-BU6zLEew.js"),__vite__mapDeps([14,15,1,2,3,4,5,6,7,8,9,10,11,12,16,17,13,18,19,20,21,22]),import.meta.url),action:()=>w(()=>import("./index-BPm91e5Z.js"),__vite__mapDeps([23,24,1,2,3,4,5,6,7,8,9,10,11,12,17,25,15,16,13,18,19,20,26,22,21]),import.meta.url),"block-section":()=>w(()=>import("./index-CK-Mi3hP.js"),__vite__mapDeps([27,15,1,2,3,4,5,6,7,8,9,10,11,12,16,17,13,28,20,19,29,26,30,31,22,18,25]),import.meta.url),button:()=>w(()=>import("./index-jjUP6Yam.js"),__vite__mapDeps([32,24,1,2,3,4,5,6,7,8,9,10,11,12,17,25,15,16,13,20,19,33,29,26,31,22,21]),import.meta.url),combobox:()=>w(()=>import("./index-BYx-hdGk.js"),__vite__mapDeps([34,15,1,2,3,4,5,6,7,8,9,10,11,12,16,17,13,35,36,20,19,22,26,30,21,25,18,37,38,39,40,41,42,29,31,43,44,45]),import.meta.url),"combobox-item":()=>w(()=>import("./index-CP8r2QEY.js"),__vite__mapDeps([46,15,1,2,3,4,5,6,7,8,9,10,11,12,16,17,13,18,19,26,45,21,47]),import.meta.url),dropdown:()=>w(()=>import("./index-DVGzfobf.js"),__vite__mapDeps([48,1,2,3,4,5,6,7,8,9,10,11,12,20,19,16,17,42,41,26,30,22,13,43,49]),import.meta.url),flow:()=>w(()=>import("./index-CMdCteX_.js"),__vite__mapDeps([50,1,2,3,4,5,6,7,8,9,10,11,12,20,19,13,22,16,17]),import.meta.url),"flow-item":()=>w(()=>import("./index-Z5_W1-0F.js"),__vite__mapDeps([51,24,1,2,3,4,5,6,7,8,9,10,11,12,17,25,15,16,13,23,18,19,20,26,22,21,52,42,41,43,33,53,54,55,30,56,57,58,59]),import.meta.url),icon:()=>w(()=>import("./index-DwIhxbHs.js").then(e=>e.i),__vite__mapDeps([15,1,2,3,4,5,6,7,8,9,10,11,12,16,17,13]),import.meta.url),input:()=>w(()=>import("./index-pyEU_klK.js"),__vite__mapDeps([60,15,1,2,3,4,5,6,7,8,9,10,11,12,16,17,13,35,61,37,19,18,20,33,29,26,30,31,22,62,21,44,25,63]),import.meta.url),"input-date-picker":()=>w(()=>import("./index-Dwo8yu4W.js"),__vite__mapDeps([64,15,1,2,3,4,5,6,7,8,9,10,11,12,16,17,13,35,61,65,37,19,20,29,26,31,22,21,44,63,25,62,30,66,67,24,23,18,68,42,41,43,55]),import.meta.url),"input-time-picker":()=>w(()=>import("./index-Dc6NQLgc.js").then(e=>e.i),__vite__mapDeps([69,15,1,2,3,4,5,6,7,8,9,10,11,12,16,17,13,35,61,65,37,19,20,29,26,31,22,21,44,63,25,24,23,18,52,42,41,43,33,53,54,55,30,62,70]),import.meta.url),label:()=>w(()=>import("./index--OBudxYA.js"),__vite__mapDeps([71,1,2,3,4,5,6,7,8,9,10,11,12,31,16,17]),import.meta.url),list:()=>w(()=>import("./index-BCDLx0rN.js"),__vite__mapDeps([72,24,1,2,3,4,5,6,7,8,9,10,11,12,17,25,58,20,19,13,16,18,15,35,61,60,37,33,29,26,30,31,22,62,21,44,63,39,40,41,73]),import.meta.url),"list-item":()=>w(()=>import("./index-B0pN5y8B.js"),__vite__mapDeps([74,15,1,2,3,4,5,6,7,8,9,10,11,12,16,17,13,48,20,19,42,41,26,30,22,43,49,24,25,23,18,21,75,76,77,78,73,79]),import.meta.url),loader:()=>w(()=>import("./index-CMxz6F2k.js"),__vite__mapDeps([24,1,2,3,4,5,6,7,8,9,10,11,12,17,25]),import.meta.url),notice:()=>w(()=>import("./index-CV25o1as.js"),__vite__mapDeps([80,15,1,2,3,4,5,6,7,8,9,10,11,12,16,17,13,20,19,22,81,43,21,25]),import.meta.url),panel:()=>w(()=>import("./index-C6rrpqn6.js").then(e=>e.i),__vite__mapDeps([59,24,1,2,3,4,5,6,7,8,9,10,11,12,17,25,15,16,13,23,18,19,20,26,22,21,52,42,41,43,33,53,54,55,30,56,57,58]),import.meta.url),switch:()=>w(()=>import("./index-BciJpaKz.js"),__vite__mapDeps([28,1,2,3,4,5,6,7,8,9,10,11,12,20,19,16,17,29,26,30,31,22]),import.meta.url)})}get apiKey(){return this.viewModel.apiKey}set apiKey(e){this.viewModel.apiKey=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return"right"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get lastRoute(){return this.viewModel.lastRoute}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get maxStops(){return this.viewModel.maxStops}set maxStops(e){this.viewModel.maxStops=e}get unit(){return this.defaultUnit}set unit(e){this._overrideIfSome("unit",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}acquireSearch(e){const{view:t}=this.viewModel;if(this._stopsToSearches.has(e)){const r=this._stopsToSearches.get(e);return r.view=t,this._overrideDefaultSources(r),r}const i=new Me({icon:!1,popupEnabled:!1,resultGraphicEnabled:!1,view:t,...this.searchProperties});return this._normalizeSearchSources(i),this.addHandles([ee(()=>i.allSources,"change",()=>this._normalizeSearchSources(i)),i.on("search-clear",()=>{var r;e.geometry=null,e.name=null,(r=this.viewModel.layer)==null||r.removeResult()}),i.on("select-result",()=>{const r=i.selectedResult;e.geometry=r==null?void 0:r.feature.geometry,e.name=r==null?void 0:r.name,this._solveRouteDebounced()}),D(()=>i.searchTerm,r=>{e.name=r})],i),this._stopsToSearches.set(e,i),i}getDirections(){return this.viewModel.getDirections()}render(){return o("div",{class:this.classes(a.base,Z.widget,Z.panel)},o("calcite-flow",null,this._renderPrimaryFlowItem(),this._renderDirectionsFlowItem(),this._renderEditFlowItem(),this._renderSaveFlowItem()))}save(){return this.viewModel.save()}saveAs(e,t={}){return this.viewModel.saveAs(e,t)}zoomToRoute(){return this.viewModel.zoomToRoute()}_applyLocatorSourceOverrides({allSources:e}){for(const t of e)"url"in t&&t.url&&(t.locationType??(t.locationType="street"),De(t.url)&&this.apiKey&&t.apiKey==null&&(t.apiKey=this.apiKey,t.url=ke))}_disposeSearch(e){if(!e||!this._stopsToSearches.has(e))return;const t=this._stopsToSearches.get(e);this.removeHandles(t),t.destroy(),this._stopsToSearches.delete(e)}_getEffectiveStops(){var e;return((e=this.viewModel.layer)==null?void 0:e.stops)??this._placeholderStops}_getErrorDescription(){var e;switch((e=this.viewModel.lastError)==null?void 0:e.name){case"directions-view-model:unable-to-route":return this.messages.errors.unableToRoute;case"directions-view-model:service-metadata-unavailable":return this.messages.errors.unableToLoadServiceMetadata;default:return this.messages.errors.unknownError}}_getNetworkFeatureName(e){switch(e.type){case"stop":switch(e.locationType){case"stop":default:return this.messages.networkFeatures.stops.stop;case"waypoint":return this.messages.networkFeatures.stops.waypoint;case"break":return this.messages.networkFeatures.stops.break}case"point-barrier":return this.messages.networkFeatures.pointBarrier;case"polyline-barrier":return this.messages.networkFeatures.polylineBarrier;case"polygon-barrier":return this.messages.networkFeatures.polygonBarrier}}_getRouteCostSummary(){var l;const e=(l=this.viewModel.layer)==null?void 0:l.routeInfo;if(!e)return null;const t=e.totalDistance??0,i=e.totalDuration??0,{messagesUnits:r,unit:s}=this;return{distance:W(r,t,s),duration:Q(i)}}_getStopSections(){if(!this.viewModel.layer)return null;const{directionPoints:e,directionLines:t,stops:i}=this.viewModel.layer;if(!e||!t)return null;const r=[];let s=null;for(const l of e){const{objectId:u,stopId:h}=l;if(h!=null){const v=i.find(({objectId:y})=>y===h);s&&s.stop===v||(s={stop:v,directions:[]},r.push(s));continue}if(s==null)continue;const p=t.find(({directionPointId:v})=>v===u);p!=null&&s.directions.push({directionPoint:l,directionLine:p})}return r}_handleLocateStopAction(e){const{view:t}=this;if(!t)return;const i="directions-search-tool";this.removeHandles(i),this._searchTool=new L({stop:e,view:t}),this.addHandles([this._searchTool.on("click",async r=>{var s,l;if(r.mapPoint&&this._stopsToSearches.has(e)){const u=this._stopsToSearches.get(e),h=await u.search(r.mapPoint),p=(l=(s=h==null?void 0:h.results)==null?void 0:s[0].results)==null?void 0:l[0];if(p){const{feature:v,name:y}=p;u.searchTerm=y,e.geometry=v.geometry}}this.removeHandles(i)}),ye(()=>{var r;this._searchTool&&((r=this.view)==null||r.tools.remove(this._searchTool),this._searchTool=null)})],i),t.addAndActivateTool(this._searchTool)}_handleEditingDoneClick(){this.viewModel.stopEditing(),this._currentFlowItem="primary"}async _handleSaveLayerAsAction(){var t,i;const e=Se.getDefault();try{await e.signIn()}catch(r){return R(r)||r.name==="identity-manager:user-aborted"?void 0:(this._parentFlowItem=this._currentFlowItem,this._currentFlowItem="save",void(this._saveState="connect-to-portal-error"))}this._saveState="fetch-portal-information",this._parentFlowItem=this._currentFlowItem,this._currentFlowItem="save",this._portalUserName=(t=e.user)==null?void 0:t.username;try{this._portalFolders=await((i=e.user)==null?void 0:i.fetchFolders())}catch{return void(this._saveState="fetch-portal-information-error")}this._saveState="save-layer"}_normalizeSearchSources(e){this._overrideDefaultSources(e),this._applyLocatorSourceOverrides(e)}_overrideDefaultSources(e){for(const t of e.viewModel.defaultSources)t.autoNavigate=!1}_renderClearRouteAction(e){return o("calcite-action",{icon:"trash",key:"clear-route",onclick:()=>{this._currentFlowItem="primary",this.viewModel.reset()},...e,text:this.messages.common.clear,textEnabled:!0})}_renderDeleteStopAction(e){const t=this._getEffectiveStops();return o("calcite-action",{icon:"trash",onclick:()=>{t.remove(e),this._disposeSearch(e),this._solveRouteDebounced()},scale:"s",slot:"actions-end",text:this.messages.deleteStop,title:this.messages.deleteStop})}_renderDepartureTime(){const{DEPART_AT:e,NOW:t,UNSPECIFIED:i}=T;return o("calcite-label",{class:a.departureTime,key:"departure-time"},this.messages.departureTime,o("calcite-combobox",{clearDisabled:!0,label:this.messages.departureTime,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:({currentTarget:r})=>{const{selectedItems:s}=r;s.length&&(this.viewModel.departureOption=s[0].value,this._solveRouteDebounced())}},o("calcite-combobox-item",{heading:this.messages.leaveNow,key:t,label:this.messages.leaveNow,selected:this.viewModel.departureOption===t,value:t}),o("calcite-combobox-item",{heading:this.messages.departAt,key:e,label:this.messages.departAt,selected:this.viewModel.departureOption===e,value:e}),o("calcite-combobox-item",{heading:this.messages.timeUnspecified,key:i,label:this.messages.timeUnspecified,selected:this.viewModel.departureOption===i,value:i})))}_renderDepartureTimeOptions(){return this.viewModel.departureOption!==T.DEPART_AT?null:o("div",{class:a.departureTimeOptions},o("calcite-input-date-picker",{scale:"s",value:this.viewModel.departureIsoDate,onCalciteInputDatePickerChange:({currentTarget:{value:e}})=>{Array.isArray(e)||(this.viewModel.departureIsoDate=e,this._solveRouteDebounced())}}),o("calcite-input-time-picker",{scale:"s",value:this.viewModel.departureIsoTime,onCalciteInputTimePickerClose:({currentTarget:{value:e}})=>{this.viewModel.departureIsoTime=e,this._solveRouteDebounced()}}))}_renderDirectionsFlowItem(){var u,h;if(this._currentFlowItem!=="directions")return null;const e=this._getRouteCostSummary();if(!this._sections||!e)return null;const{distance:t,duration:i}=e,{formattedEta:r}=this.viewModel,s=((u=this._sections.at(0))==null?void 0:u.stop.name)??"",l=((h=this._sections.at(-1))==null?void 0:h.stop.name)??"";return o("calcite-flow-item",{key:"directions-flow-item",overlayPositioning:"fixed",selected:this._currentFlowItem==="directions",onCalciteFlowItemBack:p=>{p.stopPropagation(),this._currentFlowItem="primary"}},o("div",{class:a.directionsHeader,slot:"header-content"},o("div",{class:a.headerStops},o("span",null,this.messages.from)," ",o("span",{class:a.directionsHeaderStopName},s),o("span",null,this.messages.to)," ",o("span",{class:a.directionsHeaderStopName},l)),o("div",{class:a.flexColumn},o("span",null,`${i} (${t})`),r?o("span",null,r):null)),this._renderRouteLayerActions({slot:"header-menu-actions"}),o("calcite-accordion",{class:a.accordion,iconPosition:"start",selectionMode:"single"},this._sections.map((p,v)=>{const{stop:y,directions:g}=p,{name:f}=y;return o("calcite-accordion-item",{expanded:v===0,heading:f??"",key:`stop-${v}`},o("calcite-action",{icon:"zoom-to-object",onclick:()=>{this.viewModel.centerAt(y)},slot:"actions-end",text:this.messages.panToStop}),this._renderDirectionTurns(g))})))}_renderDirectionTurns(e){return o("calcite-list",{label:this.messages.drivingDirections,selectionMode:"none"},e.map((t,i)=>{const{directionPoint:r,directionLine:s}=t,{distance:l,duration:u}=s,h=W(this.messagesUnits,l??0,this.unit),p=Q(u??0),v=h&&p?`${h} | ${p}`:`${h||p}`,y=Je(r),g=Ue(r.directionPointType);return o("calcite-list-item",{class:a.labelNoBottomMargin,key:`driving-direction-${i}`,onpointerenter:()=>{this.viewModel.highlight(s)},onpointerleave:()=>{this.viewModel.clearHighlights()},onCalciteListItemSelect:()=>{this._activeManeuver===s?this.zoomToRoute():(this._activeManeuver=s,this.viewModel.centerAt(s.geometry))}},o("calcite-icon",{icon:g,slot:"content-start"}),o("div",{slot:"content"},o("calcite-label",{layout:"inline",scale:"s"},y),o("calcite-label",{layout:"inline",scale:"s"},v)))}))}_renderEditFlowItem(){var e;return this._currentFlowItem!=="edit"?null:o("calcite-flow-item",{heading:this.messages.editRoute,headingLevel:this.headingLevel,key:"edit-flow-item",loading:this.viewModel.state==="routing",selected:this._currentFlowItem==="edit",onCalciteFlowItemBack:t=>{t.stopPropagation(),this.viewModel.stopEditing(),this._currentFlowItem="primary"}},o("div",{class:a.flexColumn,key:"edit-container"},o("div",{class:a.editToolbarContainer},o("calcite-label",{layout:"inline",scale:"s"},this.messages.automaticallySolve,o("calcite-switch",{checked:this.viewModel.autoSolve,scale:"s",onCalciteSwitchChange:t=>{this.viewModel.autoSolve=t.target.checked}})),o("div",{class:a.editToolbar},o("calcite-action",{icon:"flag",onclick:()=>{this.viewModel.create("stop")},scale:"s",text:this.messages.networkFeatures.stops.stop,textEnabled:!0}),o("calcite-action",{icon:"line",onclick:()=>{this.viewModel.create("polyline-barrier")},scale:"s",text:this.messages.barrier,textEnabled:!0}),o("calcite-action",{class:a.solveRoute,disabled:this.viewModel.autoSolve,icon:"refresh",onclick:()=>{this._solveRouteDebounced()},scale:"s",text:this.messages.solve,textEnabled:!0}))),o("div",{class:a.selectedFeatureContainer},o("calcite-list",{label:this.messages.selectedNetworkFeatures,scale:"s",selectionMode:"none"},(e=this.viewModel.selectedNetworkFeatures)==null?void 0:e.toArray().map((t,i)=>{var r;return o("calcite-list-item",{description:this._getNetworkFeatureName(t),key:`network-feature-${i}`,label:t.name??((r=t.objectId)==null?void 0:r.toString())??this.messages.unnamed},o("calcite-action",{icon:"trash",onclick:()=>{this.viewModel.remove(t)},scale:"s",slot:"actions-end",text:this.messages.common.delete}))}))),o("div",{class:a.editFooter},this._renderEditFooterContent())))}_renderEditFooterContent(){return this.viewModel.lastError?this._renderErrorNotice():o("calcite-button",{appearance:"outline-fill",bind:this,onclick:this._handleEditingDoneClick,width:"full"},this.messages.common.done)}_renderErrorNotice(){return o("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0},o("calcite-label",{class:a.labelNoBottomMargin,slot:"message"},this._getErrorDescription()))}_renderFooter(){var s,l;if(!this.viewModel.layer)return o("div",{class:a.primaryFooter,key:"footer-missing-layer"},o("calcite-notice",{icon:"information",open:!0},o("calcite-label",{class:a.labelNoBottomMargin,slot:"message"},this.messages.missingLayer)));if(this.viewModel.state==="unauthenticated")return o("div",{class:a.primaryFooterCentered,key:"footer-sign-in"},o("calcite-label",null,this.messages.signInRequired),o("calcite-button",{onclick:()=>{this.viewModel.load().catch(()=>{})}},this.messages.common.auth.signIn));if(this.viewModel.state==="routing")return o("div",{class:this.classes(a.primaryFooter,a.primaryFooterLoader),key:"footer-routing"},o("calcite-loader",{label:this.messages.solve,scale:"s"}));if(this.viewModel.state==="error")return o("div",{class:a.primaryFooter,key:"footer-service-error"},this._renderErrorNotice());if(!((s=this.viewModel.layer)!=null&&s.routeInfo))return o("div",{class:a.primaryFooter,key:"footer-unsolved-route"},o("calcite-notice",{icon:"information",open:!0},o("calcite-label",{class:a.labelNoBottomMargin,slot:"message"},this.messages.directionsPlaceholder)));const e=this._getRouteCostSummary();if(!e||!((l=this.viewModel.layer)!=null&&l.directionPoints))return o("div",{class:a.primaryFooter,key:"footer-invalid-route"},o("calcite-notice",{icon:"exclamation-mark-triangle",kind:"danger",open:!0},o("calcite-label",{class:a.labelNoBottomMargin,slot:"message"},this.messages.invalidRoute)));const{distance:t,duration:i}=e,{formattedEta:r}=this.viewModel;return o("div",{class:a.routeItem,key:"footer-directions-summary"},o("button",{"aria-busy":"false","aria-label":this.messages.viewDrivingDirections,"aria-live":"polite",class:a.routeItemButton,onclick:()=>{this._currentFlowItem="directions"},type:"button"},o("div",{class:a.routeItemButtonContent},o("span",{class:a.routeItemLabel},`${i} (${t})`),o("span",{class:a.routeItemDescription},r)),o("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s"})),o("calcite-dropdown",null,o("calcite-action",{icon:"ellipsis",slot:"trigger",text:"Route actions"}),this._renderRouteLayerActions()))}_renderInteractiveRouteActions(){var e;return o("div",{class:a.actionContainer,key:"interactive-route-action-container"},o("calcite-button",{appearance:"outline",class:a.addStopButton,disabled:this._getEffectiveStops().length>=this.maxStops,iconStart:"plus",kind:"neutral",label:this.messages.addStop,onclick:()=>{var i;const t=new Ie;(i=this.viewModel.layer)==null||i.stops.add(new $({symbol:t}))},width:"half"},this.messages.addStop),o("calcite-button",{appearance:"outline",disabled:((e=this.viewModel.view)==null?void 0:e.type)!=="2d",iconStart:"pencil",kind:"neutral",label:this.messages.editRoute,onclick:()=>{this._currentFlowItem="edit",this.viewModel.startEditing()},width:"half"},this.messages.editRoute))}_renderLocateStopAction(e){var r;if(e.name!=null||e.geometry!=null)return null;const t=this._getEffectiveStops().indexOf(e),i=!!((r=this.view)!=null&&r.activeTool)&&this.view.activeTool===this._searchTool&&this._searchTool.stop===e;return o("calcite-action",{active:i,icon:"crosshair",key:`stop-location-action-${t}`,onclick:()=>this._handleLocateStopAction(e),scale:"s",slot:"actions-end",text:this.messages.pickALocationOnTheMap,title:this.messages.pickALocationOnTheMap})}_renderOptimizeStopOrder(){const{routeParameters:e}=this.viewModel,{findBestSequence:t,preserveFirstStop:i,preserveLastStop:r}=e;return o("calcite-block-section",{class:a.optimizeSection,text:this.messages.optimizeOrder,toggleDisplay:"switch",onCalciteBlockSectionToggle:({target:s})=>{e.findBestSequence=s.open,s.open||this._resetStopSequence(),this._solveRouteDebounced()}},t?[o("calcite-label",{class:a.optimizeSwitches,key:"preserve-first-stop",layout:"inline-space-between"},this.messages.preserveFirstStop,o("calcite-switch",{checked:i,scale:"s",onCalciteSwitchChange:({target:{checked:s}})=>{e.preserveFirstStop=s,this._resetStopSequence(),this._solveRouteDebounced()}})),o("calcite-label",{class:a.optimizeSwitches,key:"preserve-last-stop",layout:"inline-space-between"},this.messages.preserveLastStop,o("calcite-switch",{checked:r,scale:"s",onCalciteSwitchChange:({target:{checked:s}})=>{e.preserveLastStop=s,this._resetStopSequence(),this._solveRouteDebounced()}}))]:null)}_renderPrimaryFlowItem(){return o("calcite-flow-item",{key:"primary-flow-item",loading:this.viewModel.state==="initializing",selected:this._currentFlowItem==="primary"},o("calcite-panel",{class:a.primaryFlowItem,disabled:!this.viewModel.layer||this.viewModel.state==="unauthenticated"||this.viewModel.state==="error"&&!this.viewModel.serviceDescription},this._renderStops(),this._renderInteractiveRouteActions(),this._renderSeparator(),this._renderRouteSolveOptions()),this._renderFooter())}_renderRouteLayerActions(e){return[this._renderClearRouteAction(e),this._renderSaveLayerAction(e),this._renderSaveLayerAsAction(e),this._renderViewItemDetailsAction(e)]}_renderRouteSolveOptions(){return o("div",{class:a.marginInlineMedium,key:"route-solve-options"},this._renderTravelModes(),this._renderDepartureTime(),this._renderDepartureTimeOptions(),this._renderOptimizeStopOrder())}_renderSaveContent(){switch(this._saveState){case"initialized":return this._renderSaveInitialized();case"connect-to-portal":return this._renderSaveProcessing(this.messages.identity.lblSigning);case"connect-to-portal-error":return this._renderSaveError(this.messages.errors.authenticating);case"fetch-portal-information":return this._renderSaveProcessing(this.messages.processing.fetching);case"fetch-portal-information-error":return this._renderSaveError(this.messages.errors.fetching);case"save-layer":return this._renderSaveLayerSettings();case"saving":return this._renderSaveProcessing(this.messages.processing.saving);case"saving-error":return this._renderSaveError(this.messages.errors.saving)}}_renderSaveError(e){return o("calcite-panel",{class:a.paddingMedium,key:"save-layer-error"},o("div",{class:a.saveError},o("calcite-icon",{class:a.saveErrorIcon,icon:"exclamation-mark-triangle",scale:"l",textLabel:this.messages.common.errorMessage}),o("calcite-label",{class:a.saveErrorLabel},e)),o("calcite-button",{appearance:"outline",onclick:()=>{this._currentFlowItem=this._parentFlowItem},slot:"footer-actions",width:"full"},this.messages.common.close))}_renderSaveInitialized(){return o("calcite-panel",{class:a.paddingMedium,key:"save-layer-initialized"})}_renderSaveFlowItem(){return this._currentFlowItem!=="save"?null:o("calcite-flow-item",{heading:this.messages.saveLayer,headingLevel:this.headingLevel,key:"save-layer-flow-item",selected:this._currentFlowItem==="save",onCalciteFlowItemBack:e=>{e.stopPropagation(),this._currentFlowItem=this._parentFlowItem}},this._renderSaveContent())}_renderSaveLayerAction(e){var s;if(!this.visibleElements.saveButton)return null;const t=this.viewModel.layer,i=t==null?void 0:t.routeInfo,r=(s=t==null?void 0:t.portalItem)==null?void 0:s.itemControl;return o("calcite-action",{disabled:!(i&&(r==="admin"||r==="update")),icon:"save",key:"save-route",onclick:()=>{var l;(l=this.viewModel.layer)==null||l.save()},...e,text:this.messages.common.save,textEnabled:!0})}_renderSaveLayerAsAction(e){var i;if(!this.visibleElements.saveAsButton)return null;const t=!((i=this.viewModel.layer)!=null&&i.routeInfo);return o("calcite-action",{disabled:t,icon:"save-as",key:"save-as-route",onclick:()=>{this._handleSaveLayerAsAction()},...e,text:this.messages.common.saveAs,textEnabled:!0})}_renderSaveLayerSettings(){if(this.layer==null||this._portalFolders==null||this._portalUserName==null)return this._renderSaveInitialized();const{stops:e}=this.layer,t=`${e.at(0).name} - ${e.at(-1).name}`,i=[o("calcite-combobox-item",{heading:`${this._portalUserName} (${this.messages.common.home})`,key:`${d}-folder-home`,selected:!0,value:`${d}-folder-home`}),...this._portalFolders.map(r=>o("calcite-combobox-item",{heading:r.title??"",key:`${d}-folder-${r.id}`,value:r.id}))];return o("calcite-panel",{key:"save-layer-panel"},o("div",{class:a.paddingMedium},o("calcite-label",null,this.messages.laverName,o("calcite-input",{afterCreate:r=>{this._portalItemNameInput=r},label:this.messages.laverName,value:t})),o("calcite-label",null,this.messages.saveInFolder,o("calcite-combobox",{afterCreate:r=>{this._portalFolderCombobox=r},clearDisabled:!0,label:this.messages.saveInFolder,overlayPositioning:"fixed",selectionMode:"single"},i))),o("calcite-button",{onclick:()=>{var u,h;if(this._saveState="saving",this.layer==null||this._portalFolders==null)return;const r=(u=this._portalItemNameInput)==null?void 0:u.value,s=(h=this._portalFolderCombobox)==null?void 0:h.value,l=this._portalFolders.find(({id:p})=>p===s);this.layer.saveAs({title:r},{folder:l}).then(()=>{this._currentFlowItem=this._parentFlowItem}).catch(()=>{this._saveState="saving-error"})},slot:"footer-actions",width:"full"},this.messages.common.save),o("calcite-button",{appearance:"outline",onclick:()=>{this._currentFlowItem=this._parentFlowItem},slot:"footer-actions",width:"full"},this.messages.common.cancel))}_renderSaveProcessing(e){return o("calcite-panel",{class:a.marginInlineMedium,key:"save-layer-processing"},o("calcite-loader",{class:a.saveProcessLoader,label:e,text:e}))}_renderSeparator(){return o("div",{class:a.separator})}_renderStop(e){const t=this.acquireSearch(e);e.name!=null&&(t.searchTerm=e.name);const i=this._getEffectiveStops(),r=this._renderLocateStopAction(e),s=i.length>2&&this._renderDeleteStopAction(e);return o("calcite-list-item",{key:e,value:e},r,s,o("div",{class:a.stopItem,slot:"content"},t.render()))}_renderStops(){const e=this._getEffectiveStops();for(const t of this._stopsToSearches.keys())e.includes(t)||this._disposeSearch(t);return o("div",{class:a.stopContainer,key:a.stopContainer},o("calcite-list",{class:a.stopList,dragEnabled:!0,label:this.messages.widgetLabel,scale:"s",onCalciteListOrderChange:({detail:t})=>{e.reorder(t.dragEl.value,t.newIndex),this._resetStopSequence(),this._solveRouteDebounced()}},e.toArray().map(t=>this._renderStop(t))),e.length===2&&o("calcite-action",{icon:"arrow-up-down",onclick:()=>{e.reverse(),this._resetStopSequence(),this._solveRouteDebounced()},scale:"s",text:this.messages.reverseStops}))}_renderTravelModes(){return this.viewModel.travelModes.length?o("calcite-label",{key:"travel-modes"},this.messages.mode,o("calcite-combobox",{clearDisabled:!0,label:this.messages.mode,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:({currentTarget:e})=>{const{selectedItems:t}=e;t.length&&(this.viewModel.selectedTravelMode=t[0].value,this._solveRouteDebounced())}},this.viewModel.travelModes.map(e=>{var t;return o("calcite-combobox-item",{heading:e.name,key:e.id,label:e.name,selected:((t=this.viewModel.selectedTravelMode)==null?void 0:t.id)===e.id,value:e})}))):null}_renderViewItemDetailsAction(e){var i;if(!this.visibleElements.layerDetails)return null;const t=(i=this.viewModel.layer)==null?void 0:i.portalItem;return o("calcite-action",{disabled:!t,icon:"launch",key:"open-route-details-link",onclick:()=>{t&&window.open(`${t.portal.url}/home/item.html?id=${t.id}`,"_blank")},...e,text:this.messages.viewLayerDetails,textEnabled:!0})}_resetStopSequence(){var e;(e=this.viewModel.layer)==null||e.stops.forEach(t=>{t.sequence=null})}async _solveRoute(){var e;if(this.viewModel.updateDepartureTime(),!((((e=this.viewModel.layer)==null?void 0:e.stops.filter(({geometry:t})=>!!t).length)??0)<2))try{await this.viewModel.getDirections()}catch{}}};n([c()],_.prototype,"_currentFlowItem",void 0),n([c()],_.prototype,"_saveState",void 0),n([c()],_.prototype,"_searchTool",void 0),n([c()],_.prototype,"apiKey",null),n([c(Te)],_.prototype,"defaultUnit",void 0),n([c()],_.prototype,"goToOverride",null),n([c()],_.prototype,"headingLevel",void 0),n([c()],_.prototype,"icon",null),n([c()],_.prototype,"label",null),n([c({readOnly:!0})],_.prototype,"lastRoute",null),n([c()],_.prototype,"layer",null),n([c()],_.prototype,"maxStops",null),n([c(),H("esri/widgets/Directions/t9n/Directions")],_.prototype,"messages",void 0),n([c(),H("esri/core/t9n/Units")],_.prototype,"messagesUnits",void 0),n([c()],_.prototype,"searchProperties",void 0),n([c()],_.prototype,"unit",null),n([c()],_.prototype,"view",null),n([c({type:ne})],_.prototype,"viewModel",void 0),n([c({type:le,nonNullable:!0})],_.prototype,"visibleElements",void 0),_=n([P("esri.widgets.Directions")],_);const Ze=_;/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
v4.32.12 */const Ge=me`@layer{arcgis-directions{display:block}}`,We=Ve(Ze),C="map-components:arcgis-directions",F=class F extends ce{constructor(){super(...arguments),this.widget=We(this),this.viewModel=this.widget.viewModel,this.apiKey=this.widget.apiKey,this.autoDestroyDisabled=!1,this.headingLevel=this.widget.headingLevel,this.hideLayerDetails=this.widget.visibleElements.layerDetails,this.hideSaveAsButton=this.widget.visibleElements.saveAsButton,this.hideSaveButton=this.widget.visibleElements.saveButton,this.icon=this.widget.icon,this.label=this.widget.label,this.lastRoute=this.widget.lastRoute,this.layer=this.widget.layer,this.maxStops=this.widget.maxStops,this.position="bottom-left",this.searchProperties=this.widget.searchProperties,this.state=this.viewModel.state,this.unit=this.widget.unit,this.useDefaultRouteLayer=!1,this.arcgisPropertyChange=ue()("lastRoute","state"),this.arcgisReady=de()}async destroy(){await this.manager.destroy()}async getDirections(){var t,i,r;if(((i=(t=this.widget)==null?void 0:t.viewModel)==null?void 0:i.state)!=="ready")throw new Error(`${C} - component not ready to get directions`);return await((r=this.widget)==null?void 0:r.getDirections())}async save(){var t,i,r;if(((i=(t=this.widget)==null?void 0:t.viewModel)==null?void 0:i.state)!=="ready")throw new Error(`${C} - component not ready to save directions`);return await((r=this.widget)==null?void 0:r.save())}async saveAs(t,i){var r,s,l;if(((s=(r=this.widget)==null?void 0:r.viewModel)==null?void 0:s.state)!=="ready")throw new Error(`${C} - component not ready to save directions as a Portal Item`);return await((l=this.widget)==null?void 0:l.saveAs(t,i))}async zoomToRoute(){var t,i,r;if(((i=(t=this.widget)==null?void 0:t.viewModel)==null?void 0:i.state)!=="ready")throw new Error(`${C} - component not ready to zoom to route`);(r=this.widget)==null||r.zoomToRoute()}willUpdate(t){var i,r;if(t.has("routeLayerItemId")){const s=this.routeLayerItemId;if(Be(s)&&!this.useDefaultRouteLayer){const{layer:l}=this;l&&((i=this.widget.view)==null||i.map.remove(l)),this._setDefaultLayer()}else s&&this.widget&&(this.layer=new U({portalItem:{id:s}}),(r=this.widget.view)==null||r.map.add(this.layer))}t.has("useDefaultRouteLayer")&&this._setDefaultLayer()}_setDefaultLayer(){this.useDefaultRouteLayer&&!this.routeLayerItemId&&(this.layer=new U,D(()=>this.widget.view,()=>{var t;return(t=this.widget.view)==null?void 0:t.map.add(this.layer)},{once:!0}))}};F.properties={apiKey:1,autoDestroyDisabled:5,headingLevel:9,hideLayerDetails:5,hideSaveAsButton:5,hideSaveButton:5,icon:1,label:1,lastRoute:0,layer:0,maxStops:9,position:1,referenceElement:1,routeLayerItemId:1,searchProperties:0,state:0,unit:1,useDefaultRouteLayer:5},F.shadowRootOptions=he,F.styles=Ge;let N=F;pe("arcgis-directions",N);export{N as ArcgisDirections};
