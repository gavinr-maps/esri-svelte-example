import{y as pe,O as we,N as de,P as Ee,o as ge,r as me,f as ye,S as Ne,p as ve,u as Ie,I as Te,m as Se,b as h,d as v,a as ie,e as be,s as Re}from"./arcadeUtils.4c94f0c3.js";import{hn as V,h9 as T,hv as A,aN as Oe,i1 as m,i2 as D,hr as u,i3 as S,i4 as _,hu as L,hI as j,hb as g,hm as C,hq as x,hQ as U,hX as se,ha as O,hh as p,cz as $,hj as b,hZ as Ae,hs as B,h_ as Ue,hF as Ce,hD as xe,h$ as ee,hk as Fe,a8 as Me,ar as Pe,ct as De,cs as Le,cv as ke,hY as _e}from"./index.ebaf2ed0.js";import{registerFunctions as je}from"./geomasync.086e6034.js";import"./geometryEngineAsync.bfdab23f.js";function re(r){return r&&typeof r.then=="function"}const Y=100;async function Q(r,e){const n=[];for(let t=0;t<e.arguments.length;t++)n.push(await c(r,e.arguments[t]));return n}async function N(r,e,n){return e.preparsed===!0?n(r,null,e.arguments):n(r,e,await Q(r,e))}async function M(r,e,n){if(e.preparsed===!0){const a=n(r,null,e.arguments);return re(a),a}const t=n(r,e,await Q(r,e));return re(t),t}async function c(r,e,n){if(e.breakpoint&&n!==!0)return await e.breakpoint(),c(r,e,!0);switch(e.type){case"VariableDeclarator":return er(r,e);case"VariableDeclaration":return le(r,e,0);case"BlockStatement":return Je(r,e);case"FunctionDeclaration":return $e(r,e);case"ReturnStatement":return Ke(r,e);case"IfStatement":return Xe(r,e);case"ExpressionStatement":return We(r,e);case"UpdateExpression":return Ze(r,e);case"AssignmentExpression":return Qe(r,e);case"ForStatement":return Ge(r,e);case"ForInStatement":return He(r,e);case"BreakStatement":return S;case"EmptyStatement":return u;case"ContinueStatement":return _;case"TemplateElement":return sr(r,e);case"TemplateLiteral":return cr(r,e);case"Identifier":return W(r,e);case"MemberExpression":return rr(r,e);case"Literal":return e.value;case"CallExpression":return ir(r,e);case"UnaryExpression":return nr(r,e);case"BinaryExpression":return ar(r,e);case"LogicalExpression":return or(r,e);case"ArrayExpression":return tr(r,e);case"ObjectExpression":return Ye(r,e);case"Property":return Ve(r,e);default:throw new Error(h(e,"RUNTIME","UNREOGNISED"))}}async function Ye(r,e){const n=[];for(let o=0;o<e.properties.length;o++)n[o]=await c(r,e.properties[o]);const t={};for(let o=0;o<n.length;o++){const i=n[o];if(j(i.value))throw new Error("Illegal Argument");if(g(i.key)===!1)throw new Error("Illegal Argument");i.value===u?t[i.key.toString()]=null:t[i.key.toString()]=i.value}const a=new v(t);return a.immutable=!1,a}async function Ve(r,e){const n=await c(r,e.value);return e.key.type==="Identifier"?{key:e.key.name,value:n}:{key:await c(r,e.key),value:n}}async function ne(r,e,n){const t=await c(r,e.body);return n.lastAction=t,n.lastAction===S||n.lastAction instanceof m?(n.testResult=!1,n):(e.update!==null&&await c(r,e.update),n)}async function Be(r,e,n){if(e.test!==null){const t=await c(r,e.test);if(r.abortSignal.aborted===!0)throw new Error("Cancelled");if(n.testResult=t,n.testResult===!1)return n;if(n.testResult!==!0)throw new Error(h(e,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"));return ne(r,e,n)}return ne(r,e,n)}function k(r,e,n,t,a,o){try{Be(r,e,n).then(()=>{try{n.testResult===!0?++o>Y?(o=0,setTimeout(()=>{k(r,e,n,t,a,o)},0)):k(r,e,n,t,a,o):n.lastAction instanceof m?t(n.lastAction):t(u)}catch(i){a(i)}},i=>{a(i)})}catch(i){a(i)}}function Ge(r,e){try{return e.init!==null?c(r,e.init).then(()=>new Promise((n,t)=>{k(r,e,{testResult:!0,lastAction:u},a=>{n(a)},a=>{t(a)},0)})):new Promise((n,t)=>{k(r,e,{testResult:!0,lastAction:u},a=>{n(a)},a=>{t(a)},0)})}catch(n){return Promise.reject(n)}}function G(r,e,n,t,a,o,i,s,l,f){try{if(t<=o)return void s(u);a.value=i==="k"?n[o]:o,c(r,e.body).then(w=>{try{w instanceof m?s(w):w===S?s(u):++f>Y?(f=0,setTimeout(()=>{G(r,e,n,t,a,o+1,i,s,l,f)},0)):G(r,e,n,t,a,o+1,i,s,l,f)}catch(d){l(d)}},w=>{l(w)})}catch(w){l(w)}}function z(r,e,n,t,a,o,i,s,l){try{if(n.length()<=a)return void i(u);t.value=o==="k"?n.get(a):a,c(r,e.body).then(f=>{f instanceof m?i(f):f===S?i(u):++l>Y?(l=0,setTimeout(()=>{z(r,e,n,t,a+1,o,i,s,l)},0)):z(r,e,n,t,a+1,o,i,s,l)},f=>{s(f)})}catch(f){s(f)}}function q(r,e,n,t,a,o){try{if(o===void 0&&(o="i"),n.length===0)return void t.resolve(u);G(r,e,n,n.length,a,0,o,i=>{t.resolve(i)},i=>{t.reject(i)},0)}catch(i){t.reject(i)}}function ze(r,e,n,t,a,o){try{if(o===void 0&&(o="i"),n.length===0)return void t.resolve(u);z(r,e,n,a,0,o,i=>{t.resolve(i)},i=>{t.reject(i)},0)}catch(i){t.reject(i)}}function qe(r,e,n,t,a){try{q(r,e,n.keys(),t,a,"k")}catch(o){t.reject(o)}}function H(r,e,n,t,a,o,i,s){try{r.next().then(l=>{try{if(l===null)o(u);else{const f=ie.createFromGraphicLikeObject(l.geometry,l.attributes,t);f._underlyingGraphic=l,a.value=f,c(e,n.body).then(w=>{try{w===S?o(u):w instanceof m?o(w):++s>Y?(s=0,setTimeout(()=>{H(r,e,n,t,a,o,i,s)},0)):H(r,e,n,t,a,o,i,s)}catch(d){i(d)}},w=>{i(w)})}}catch(f){i(f)}},l=>{i(l)})}catch(l){i(l)}}async function He(r,e){return new Promise((n,t)=>{c(r,e.right).then(a=>{try{let o=null;o=e.left.type==="VariableDeclaration"?c(r,e.left):Promise.resolve(),o.then(()=>{try{let i="";if(e.left.type==="VariableDeclaration"){const l=e.left.declarations[0].id;l.type==="Identifier"&&(i=l.name)}else e.left.type==="Identifier"&&(i=e.left.name);if(!i)throw new Error(h(e,"RUNTIME","INVALIDVARIABLE"));i=i.toLowerCase();let s=null;if(r.localScope!==null&&r.localScope[i]!==void 0&&(s=r.localScope[i]),s===null&&r.globalScope[i]!==void 0&&(s=r.globalScope[i]),s===null)return void t(new Error(h(e,"RUNTIME","VARIABLENOTDECLARED")));C(a)||g(a)?q(r,e,a,{reject:t,resolve:n},s):x(a)?ze(r,e,a,{reject:t,resolve:n},s):a instanceof v||U(a)?qe(r,e,a,{reject:t,resolve:n},s):se(a)?H(a.iterator(r.abortSignal),r,e,a,s,l=>{n(l)},l=>{t(l)},0):q(r,e,[],{reject:t,resolve:n},s)}catch(i){t(i)}},t)}catch(o){t(o)}},t)})}async function Ze(r,e){const n=e.argument;if(n.type==="MemberExpression"){const o={t:null},i=await c(r,n.object);let s=null;o.t=i,n.computed===!0?s=await c(r,n.property):n.property.type==="Identifier"&&(s=n.property.name);const l=o.t;let f;if(C(l)){if(!O(s))throw new Error("Invalid Parameter");if(s<0&&(s=l.length+s),s<0||s>=l.length)throw new Error("Assignment outside of array bounds");f=p(l[s]),l[s]=e.operator==="++"?f+1:f-1}else if(l instanceof v){if(g(s)===!1)throw new Error("Dictionary accessor must be a string");if(l.hasField(s)!==!0)throw new Error("Invalid Parameter");f=p(l.field(s)),l.setField(s,e.operator==="++"?f+1:f-1)}else{if(!U(l))throw x(l)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(g(s)===!1)throw new Error("Feature accessor must be a string");if(l.hasField(s)!==!0)throw new Error("Invalid Parameter");f=p(l.field(s)),l.setField(s,e.operator==="++"?f+1:f-1)}return e.prefix===!1?f:e.operator==="++"?f+1:f-1}const t=e.argument.type==="Identifier"?e.argument.name.toLowerCase():"";if(!t)throw new Error("Invalid identifier");let a;if(r.localScope!==null&&r.localScope[t]!==void 0)return a=p(r.localScope[t].value),r.localScope[t]={value:e.operator==="++"?a+1:a-1,valueset:!0,node:e},e.prefix===!1?a:e.operator==="++"?a+1:a-1;if(r.globalScope[t]!==void 0)return a=p(r.globalScope[t].value),r.globalScope[t]={value:e.operator==="++"?a+1:a-1,valueset:!0,node:e},e.prefix===!1?a:e.operator==="++"?a+1:a-1;throw new Error("Variable not recognised")}function I(r,e,n,t){switch(e){case"=":return r===u?null:r;case"/=":return p(n)/p(r);case"*=":return p(n)*p(r);case"-=":return p(n)-p(r);case"+=":return g(n)||g(r)?b(n)+b(r):p(n)+p(r);case"%=":return p(n)%p(r);default:throw new Error(h(t,"RUNTIME","OPERATORNOTRECOGNISED"))}}async function Qe(r,e){const n=e.left;if(n.type==="MemberExpression"){const a=await c(r,e.right),o=await c(r,n.object);let i=null;if(n.computed===!0)i=await c(r,n.property);else{if(n.property.type!=="Identifier")throw new Error("Expected computed or identifier for assignemnt target");i=n.property.name}if(C(o)){if(!O(i))throw new Error("Invalid Parameter");if(i<0&&(i=o.length+i),i<0||i>o.length)throw new Error("Assignment outside of array bounds");if(i===o.length){if(e.operator!=="=")throw new Error("Invalid Parameter");o[i]=I(a,e.operator,o[i],e)}else o[i]=I(a,e.operator,o[i],e)}else if(o instanceof v){if(g(i)===!1)throw new Error("Dictionary accessor must be a string");if(o.hasField(i)===!0)o.setField(i,I(a,e.operator,o.field(i),e));else{if(e.operator!=="=")throw new Error("Invalid Parameter");o.setField(i,I(a,e.operator,null,e))}}else{if(!U(o))throw x(o)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(g(i)===!1)throw new Error("Feature accessor must be a string");if(o.hasField(i)===!0)o.setField(i,I(a,e.operator,o.field(i),e));else{if(e.operator!=="=")throw new Error("Invalid Parameter");o.setField(i,I(a,e.operator,null,e))}}return u}const t=n.name.toLowerCase();if(r.localScope!==null&&r.localScope[t]!==void 0){const a=await c(r,e.right);return r.localScope[t]={value:I(a,e.operator,r.localScope[t].value,e),valueset:!0,node:e.right},u}if(r.globalScope[t]!==void 0){const a=await c(r,e.right);return r.globalScope[t]={value:I(a,e.operator,r.globalScope[t].value,e),valueset:!0,node:e.right},u}throw new Error("Cannot assign undeclared variable")}async function We(r,e){if(e.expression.type==="AssignmentExpression")return c(r,e.expression);if(e.expression.type==="CallExpression"){const t=await c(r,e.expression);return t===u?u:new D(t)}const n=await c(r,e.expression);return n===u?u:new D(n)}async function Xe(r,e){if(e.test.type==="AssignmentExpression"||e.test.type==="UpdateExpression")throw new Error(h(e.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));const n=await c(r,e.test);if(n===!0)return c(r,e.consequent);if(n===!1)return e.alternate!==null?c(r,e.alternate):u;throw new Error(h(e.test,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))}async function Je(r,e){return ce(r,e,0)}async function ce(r,e,n){if(n>=e.body.length)return u;const t=await c(r,e.body[n]);return t instanceof m||t===S||t===_||n===e.body.length-1?t:ce(r,e,n+1)}async function Ke(r,e){if(e.argument===null)return new m(u);const n=await c(r,e.argument);return new m(n)}async function $e(r,e){const n=e.id.name.toLowerCase();return r.globalScope[n]={valueset:!0,node:null,value:new L(e,r)},u}async function le(r,e,n){return n>=e.declarations.length?u:(await c(r,e.declarations[n]),n===e.declarations.length-1||await le(r,e,n+1),u)}async function er(r,e){let n=null;if(n=e.init===null?null:await c(r,e.init),r.localScope!==null){if(n===u&&(n=null),e.id.type!=="Identifier")throw new Error("Can only assign a regular variable");const a=e.id.name.toLowerCase();return r.localScope[a]={value:n,valueset:!0,node:e.init},u}if(e.id.type!=="Identifier")throw new Error("Can only assign a regular variable");const t=e.id.name.toLowerCase();return n===u&&(n=null),r.globalScope[t]={value:n,valueset:!0,node:e.init},u}let y=0;function te(r,e,n,t){let a;switch(e=e.toLowerCase()){case"hasz":{const o=r.hasZ;return o!==void 0&&o}case"hasm":{const o=r.hasM;return o!==void 0&&o}case"spatialreference":{let o=r.spatialReference._arcadeCacheId;if(o===void 0){let s=!0;Object.freeze&&Object.isFrozen(r.spatialReference)&&(s=!1),s&&(y++,r.spatialReference._arcadeCacheId=y,o=y)}const i=new v({wkt:r.spatialReference.wkt,wkid:r.spatialReference.wkid});return o!==void 0&&(i._arcadeCacheId="SPREF"+o.toString()),i}}switch(r.type){case"extent":switch(e){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":{const o=r[e];return o!==void 0?o:null}case"type":return"Extent"}break;case"polygon":switch(e){case"rings":return a=r.cache._arcadeCacheId,a===void 0&&(y++,a=y,r.cache._arcadeCacheId=a),new ee(r.rings,r.spatialReference,r.hasZ===!0,r.hasM===!0,a);case"type":return"Polygon"}break;case"point":switch(e){case"x":case"y":case"z":case"m":return r[e]!==void 0?r[e]:null;case"type":return"Point"}break;case"polyline":switch(e){case"paths":return a=r.cache._arcadeCacheId,a===void 0&&(y++,a=y,r.cache._arcadeCacheId=a),new ee(r.paths,r.spatialReference,r.hasZ===!0,r.hasM===!0,a);case"type":return"Polyline"}break;case"multipoint":switch(e){case"points":return a=r.cache._arcadeCacheId,a===void 0&&(y++,a=y,r.cache._arcadeCacheId=a),new xe(r.points,r.spatialReference,r.hasZ===!0,r.hasM===!0,a,1);case"type":return"Multipoint"}}throw new Error(h(t,"RUNTIME","PROPERTYNOTFOUND"))}async function rr(r,e){const n=await c(r,e.object);if(n===null)throw new Error(h(e,"RUNTIME","NOTFOUND"));if(e.computed===!1){if(e.property.type==="Identifier"){if(n instanceof v||U(n))return n.field(e.property.name);if(n instanceof $)return te(n,e.property.name,r,e);throw new Error(h(e,"RUNTIME","INVALIDTYPE"))}throw new Error(h(e,"RUNTIME","INVALIDTYPE"))}let t=await c(r,e.property);if(n instanceof v||U(n)){if(g(t))return n.field(t);throw new Error(h(e,"RUNTIME","INVALIDTYPE"))}if(n instanceof $){if(g(t))return te(n,t,r,e);throw new Error(h(e,"RUNTIME","INVALIDTYPE"))}if(C(n)){if(O(t)&&isFinite(t)&&Math.floor(t)===t){if(t<0&&(t=n.length+t),t>=n.length||t<0)throw new Error(h(e,"RUNTIME","OUTOFBOUNDS"));return n[t]}throw new Error(h(e,"RUNTIME","INVALIDTYPE"))}if(x(n)){if(O(t)&&isFinite(t)&&Math.floor(t)===t){if(t<0&&(t=n.length()+t),t>=n.length()||t<0)throw new Error(h(e,"RUNTIME","OUTOFBOUNDS"));return n.get(t)}throw new Error(h(e,"RUNTIME","INVALIDTYPE"))}if(g(n)){if(O(t)&&isFinite(t)&&Math.floor(t)===t){if(t<0&&(t=n.length+t),t>=n.length||t<0)throw new Error(h(e,"RUNTIME","OUTOFBOUNDS"));return n[t]}throw new Error(h(e,"RUNTIME","INVALIDTYPE"))}throw new Error(h(e,"RUNTIME","INVALIDTYPE"))}async function nr(r,e){const n=await c(r,e.argument);if(T(n)){if(e.operator==="!")return!n;if(e.operator==="-")return-1*p(n);if(e.operator==="+")return 1*p(n);if(e.operator==="~")return~p(n);throw new Error(h(e,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))}if(e.operator==="-")return-1*p(n);if(e.operator==="+")return 1*p(n);if(e.operator==="~")return~p(n);throw new Error(h(e,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))}async function tr(r,e){const n=[];for(let t=0;t<e.elements.length;t++)n.push(await c(r,e.elements[t]));for(let t=0;t<n.length;t++){if(j(n[t]))throw new Error(h(e,"RUNTIME","FUNCTIONCONTEXTILLEGAL"));n[t]===u&&(n[t]=null)}return n}async function ar(r,e){const n=[];n[0]=await c(r,e.left),n[1]=await c(r,e.right);const t=n[0],a=n[1];switch(e.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return Ue(p(t),p(a),e.operator);case"==":return B(t,a);case"!=":return!B(t,a);case"<":case">":case"<=":case">=":return Ae(t,a,e.operator);case"+":return g(t)||g(a)?b(t)+b(a):p(t)+p(a);case"-":return p(t)-p(a);case"*":return p(t)*p(a);case"/":return p(t)/p(a);case"%":return p(t)%p(a);default:throw new Error(h(e,"RUNTIME","OPERATORNOTRECOGNISED"))}}async function or(r,e){if(e.left.type==="AssignmentExpression"||e.left.type==="UpdateExpression")throw new Error(h(e.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if(e.right.type==="AssignmentExpression"||e.right.type==="UpdateExpression")throw new Error(h(e.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));const n=await c(r,e.left);let t=null;if(!T(n))throw new Error(h(e,"RUNTIME","ONLYBOOLEAN"));switch(e.operator){case"||":if(n===!0)return n;if(t=await c(r,e.right),T(t))return t;throw new Error(h(e,"RUNTIME","ONLYORORAND"));case"&&":if(n===!1)return n;if(t=await c(r,e.right),T(t))return t;throw new Error(h(e,"RUNTIME","ONLYORORAND"));default:throw new Error(h(e,"RUNTIME","ONLYORORAND"))}}async function W(r,e){const n=e.name.toLowerCase();if(r.localScope!==null&&r.localScope[n]!==void 0){const t=r.localScope[n];if(t.valueset===!0)return t.value;if(t.d!==null)return t.d;t.d=c(r,t.node);const a=await t.d;return t.value=a,t.valueset=!0,a}if(r.globalScope[n]!==void 0){const t=r.globalScope[n];if(t.valueset===!0)return t.value;if(t.d!==null)return t.d;t.d=c(r,t.node);const a=await t.d;return t.value=a,t.valueset=!0,a}throw new Error(h(e,"RUNTIME","VARIABLENOTFOUND"))}async function ir(r,e){if(e.callee.type!=="Identifier")throw new Error(h(e,"RUNTIME","ONLYNODESSUPPORTED"));if(r.localScope!==null&&r.localScope[e.callee.name.toLowerCase()]!==void 0){const n=r.localScope[e.callee.name.toLowerCase()];if(n.value instanceof A)return n.value.fn(r,e);if(n.value instanceof L)return oe(r,e,n.value.definition);throw new Error(h(e,"RUNTIME","NOTAFUNCTION"))}if(r.globalScope[e.callee.name.toLowerCase()]!==void 0){const n=r.globalScope[e.callee.name.toLowerCase()];if(n.value instanceof A)return n.value.fn(r,e);if(n.value instanceof L)return oe(r,e,n.value.definition);throw new Error(h(e,"RUNTIME","NOTAFUNCTION"))}throw new Error(h(e,"RUNTIME","NOTFOUND"))}async function sr(r,e){return e.value?e.value.cooked:""}async function cr(r,e){const n=[];for(let o=0;o<e.expressions.length;o++){const i=await c(r,e.expressions[o]);n[o]=b(i)}let t="",a=0;for(const o of e.quasis)t+=o.value?o.value.cooked:"",o.tail===!1&&(t+=n[a]?n[a]:"",a++);return t}const E={};function ae(r){return r===null?"":C(r)||x(r)?"Array":Fe(r)?"Date":g(r)?"String":T(r)?"Boolean":O(r)?"Number":r instanceof be?"Attachment":r instanceof Re?"Portal":r instanceof v?"Dictionary":U(r)?"Feature":r instanceof Me?"Point":r instanceof Pe?"Polygon":r instanceof De?"Polyline":r instanceof Le?"Multipoint":r instanceof ke?"Extent":j(r)?"Function":se(r)?"FeatureSet":_e(r)?"FeatureSetCollection":r===u?"":typeof r=="number"&&isNaN(r)?"Number":"Unrecognised Type"}async function ue(r,e,n,t){const a=await c(r,e.arguments[n]);if(B(a,t))return c(r,e.arguments[n+1]);const o=e.arguments.length-n;return o===1?c(r,e.arguments[n]):o===2?null:o===3?c(r,e.arguments[n+2]):ue(r,e,n+2,t)}async function fe(r,e,n,t){if(t===!0)return c(r,e.arguments[n+1]);if(e.arguments.length-n===3)return c(r,e.arguments[n+2]);const a=await c(r,e.arguments[n+2]);if(T(a)===!1)throw new Error("WHEN needs boolean test conditions");return fe(r,e,n+2,a)}async function Z(r,e){const n=r.length,t=Math.floor(n/2);if(n===0)return[];if(n===1)return[r[0]];const a=[Z(r.slice(0,t),e),Z(r.slice(t,n),e)],o=await Promise.all(a);return P(o[0],o[1],e,[])}async function P(r,e,n,t){const a=t;if(!(r.length>0||e.length>0))return t;if(r.length>0&&e.length>0){let o=await n(r[0],e[0]);return isNaN(o)&&(o=1),o<=0?(a.push(r[0]),r=r.slice(1)):(a.push(e[0]),e=e.slice(1)),P(r,e,n,t)}return r.length>0?(a.push(r[0]),P(r=r.slice(1),e,n,t)):e.length>0?(a.push(e[0]),P(r,e=e.slice(1),n,t)):void 0}function R(r,e){const n=r.length,t=Math.floor(n/2);return e||(e=function(a,o){return a<o?-1:a===o?0:1}),n===0?[]:n===1?[r[0]]:lr(R(r.slice(0,t),e),R(r.slice(t,n),e),e)}function lr(r,e,n){const t=[];for(;r.length>0||e.length>0;)if(r.length>0&&e.length>0){let a=n(r[0],e[0]);isNaN(a)&&(a=1),a<=0?(t.push(r[0]),r=r.slice(1)):(t.push(e[0]),e=e.slice(1))}else r.length>0?(t.push(r[0]),r=r.slice(1)):e.length>0&&(t.push(e[0]),e=e.slice(1));return t}async function he(r,e,n){const t=r.body;if(n.length!==r.params.length)throw new Error("Invalid Parameter calls to function.");for(let o=0;o<n.length;o++){const i=r.params[o];i.type==="Identifier"&&(e.localScope[i.name.toLowerCase()]={d:null,value:n[o],valueset:!0,node:null})}const a=await c(e,t);if(a instanceof m)return a.value;if(a===S)throw new Error("Cannot Break from a Function");if(a===_)throw new Error("Cannot Continue from a Function");return a instanceof D?a.value:a}function oe(r,e,n){return M(r,e,function(t,a,o){const i={spatialReference:r.spatialReference,services:r.services,console:r.console,lrucache:r.lrucache,interceptor:r.interceptor,localScope:{},abortSignal:r.abortSignal,globalScope:r.globalScope,depthCounter:r.depthCounter+1};if(i.depthCounter>64)throw new Error("Exceeded maximum function depth");return he(n,i,o)})}function X(r){return function(){const n={abortSignal:r.context.abortSignal,spatialReference:r.context.spatialReference,console:r.context.console,lrucache:r.context.lrucache,interceptor:r.context.interceptor,services:r.context.services,localScope:{},globalScope:r.context.globalScope,depthCounter:r.context.depthCounter+1};if(n.depthCounter>64)throw new Error("Exceeded maximum function depth");return he(r.definition,n,arguments)}}pe(E,N),we(E,N),de(E,N),Ee(E,N),ge(E,N),je({functions:E,compiled:!1,signatures:null,evaluateIdentifier:null,arcadeCustomFunctionHandler:null,mode:"async",standardFunction:N,standardFunctionAsync:M}),E.typeof=function(r,e){return N(r,e,function(n,t,a){V(a,1,1);const o=ae(a[0]);if(o==="Unrecognised Type")throw new Error("Unrecognised Type");return o})},E.iif=async function(r,e){V(e.arguments===null?[]:e.arguments,3,3);const n=await c(r,e.arguments[0]);if(T(n)===!1)throw new Error("IF Function must have a boolean test condition");const t=[];return t[0]=await c(r,e.arguments[1]),t[1]=await c(r,e.arguments[2]),n?t[0]:t[1]},E.decode=async function(r,e){if(e.arguments.length<2)throw new Error("Missing Parameters");if(e.arguments.length===2)return c(r,e.arguments[1]);if((e.arguments.length-1)%2==0)throw new Error("Must have a default value result.");return ue(r,e,1,await c(r,e.arguments[0]))},E.when=async function(r,e){if(e.arguments.length<3)throw new Error("Missing Parameters");if(e.arguments.length%2==0)throw new Error("Must have a default value result.");const n=await c(r,e.arguments[0]);if(T(n)===!1)throw new Error("WHEN needs boolean test conditions");return fe(r,e,0,n)},E.sort=function(r,e){return M(r,e,async function(n,t,a){V(a,1,2);let o=a[0];if(x(o)&&(o=o.toArray()),C(o)===!1)throw new Error("Illegal Argument");if(a.length>1){if(j(a[1])===!1)throw new Error("Illegal Argument");return Z(o,X(a[1]))}let i=o;if(i.length===0)return[];const s={};for(let w=0;w<i.length;w++){const d=ae(i[w]);d!==""&&(s[d]=!0)}if(s.Array===!0||s.Dictionary===!0||s.Feature===!0||s.Point===!0||s.Polygon===!0||s.Polyline===!0||s.Multipoint===!0||s.Extent===!0||s.Function===!0)return i.slice(0);let l=0,f="";for(const w in s)l++,f=w;return l>1||f==="String"?i=R(i,function(w,d){if(w==null||w===u)return d==null||d===u?0:1;if(d==null||d===u)return-1;const J=b(w),K=b(d);return J<K?-1:J===K?0:1}):f==="Number"?i=R(i,function(w,d){return w-d}):f==="Boolean"?i=R(i,function(w,d){return w===d?0:d?-1:1}):f==="Date"&&(i=R(i,function(w,d){return d-w})),i})};const ur={fixSpatialReference:Ce,parseArguments:Q,standardFunction:N,standardFunctionAsync:M,evaluateIdentifier:W,arcadeCustomFunction:X};for(const r in E)E[r]={value:new A(E[r]),valueset:!0,node:null};const F=function(){};function fr(r,e){const n=new F;r==null&&(r={}),e==null&&(e={});const t=new v({newline:`
`,tab:"	",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});t.immutable=!1,n.textformatting={value:t,valueset:!0,node:null};for(const a in e)n[a]={value:new A(e[a]),native:!0,valueset:!0,node:null};for(const a in r)r[a]&&r[a].declaredClass==="esri.Graphic"?n[a]={value:ie.createFromGraphic(r[a]),valueset:!0,node:null}:n[a]={value:r[a],valueset:!0,node:null};return n}function hr(r){console.log(r)}F.prototype=E,F.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},F.prototype.pi={value:Math.PI,valueset:!0,node:null};const mr=ur;function pr(r){const e={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:N,standardFunctionAsync:M,evaluateIdentifier:W,arcadeCustomFunctionHandler:X};for(let n=0;n<r.length;n++)r[n].registerFunctions(e);for(const n in e.functions)E[n]={value:new A(e.functions[n]),valueset:!0,node:null},F.prototype[n]=E[n];for(let n=0;n<e.signatures.length;n++)me(e.signatures[n],"async")}async function yr(r,e){let n=e.spatialReference;n==null&&(n=new Oe({wkid:102100}));const t=fr(e.vars,e.customfunctions),a={spatialReference:n,services:e.services,abortSignal:e.abortSignal===void 0||e.abortSignal===null?{aborted:!1}:e.abortSignal,globalScope:t,console:e.console?e.console:hr,lrucache:e.lrucache,interceptor:e.interceptor,localScope:null,depthCounter:1};let o=await c(a,r.body[0].body);if(o instanceof m&&(o=o.value),o instanceof D&&(o=o.value),o===u&&(o=null),o===S)throw new Error("Cannot return BREAK");if(o===_)throw new Error("Cannot return CONTINUE");if(o instanceof A)throw new Error("Cannot return FUNCTION");if(o instanceof L)throw new Error("Cannot return FUNCTION");return o}function Nr(r,e){return ye(r)}function vr(r,e){return Ne(r,e,"full")}function Ir(r,e){return ve(r,e)}function Tr(r,e){return Ie(r,e)}function Sr(r){return Te(r)}pr([Se]);export{yr as executeScript,pr as extend,Nr as extractFieldLiterals,Sr as findFunctionCalls,mr as functionHelper,Tr as referencesFunction,Ir as referencesMember,vr as validateScript};
