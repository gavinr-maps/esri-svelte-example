const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./editingTools-DCvBiyJu.js","./tslib.es6-B3Jf3DVX.js","./geometry-D964gYQX.js","./subclass-BZA_h8Db.js","./Extent-Bf3YTe7m.js","./Point-Cg0-ChZE.js","./Accessor-BLX9ikPh.js","./cast-Bjksrh93.js","./writer-DNAwXnhG.js","./assets-C43MgM-v.js","./index-Bh2oEzTI.js","./index-2kwcjS9-.css","./jsonMap-0cxwUWs2.js","./Polyline-D9YkgmM_.js","./mathUtils-C4_ghTv4.js","./Graphic-DsxsIjhH.js","./PopupTemplate-BHMhS05j.js","./Clonable-D3rtuBWg.js","./Collection-CEdjem1-.js","./Evented-BHRw9x22.js","./shared-B3wH2qpO.js","./SimpleObservable-KocWTzVy.js","./fieldUtils-tmQlKvWo.js","./intl-CChhNOV8.js","./date-DlqISzcw.js","./locale-C9TlLpzi.js","./messages-OmQvZhAg.js","./enumeration-Ba5njXdz.js","./Color-BCS62Hs5.js","./colorUtils-0bJDPow9.js","./ActionToggle-iT4slXc7.js","./Identifiable-B1UbsKNt.js","./symbols-CNimns--.js","./TextSymbol-D8QO_KUV.js","./screenUtils-_ZIvrt5o.js","./materialUtils-DarhapKC.js","./opacityUtils-C68Tlu6_.js","./vec3f64-BLpZdpfb.js","./aaBoundingBox-BE7cC1jD.js","./persistableUrlUtils-fa1mAujs.js","./collectionUtils-D_lHIu88.js","./Portal-C10FKnaA.js","./Loadable-BabW5Xcc.js","./Promise-B2Hu02L7.js","./reactiveUtils-C5zUhJQJ.js","./asyncUtils-CWX51uTe.js","./jsonUtils-CEfjT-BK.js","./SnappingVisualizer2D-Br8KvMdL.js","./vec2-maR1OrZI.js","./common-DQOJ18NT.js","./vec2f64-miziP1SN.js","./enums-CmIX1y88.js","./SnappingManager-BJPyuu7J.js","./projection-B971H0Re.js","./projectBuffer-Bs7GwaPY.js","./geodesicConstants-DWQLYX7F.js","./elevationInfoUtils-BC_66_Fg.js","./unitConversionUtils-BMfW9yAe.js","./lengthUtils-DL1-FDQQ.js","./projectVectorToVector-G2uWGoIb.js","./projectPointToVector-GINIbYMz.js","./timeUtils-8fb_2oAt.js","./vec32-Dvg_eL9J.js","./Query-5Xpquc1r.js","./DataLayerSource-BKkswDvG.js","./Field-ybkHhtnK.js","./fieldType-BuzM0UHS.js","./FullTextSearch-Csd1Hktu.js","./TimeExtent-DocT5yPf.js","./InputManager-Ba9xzDpe.js","./Queue-yu3bZ02p.js","./signal-D4lghLjV.js","./keybindings-DoOdil3D.js","./utils-BpB3MnW1.js","./Version-BSlAgupz.js","./vec42-YcqnINSP.js","./vec4f64-o2zAXfmz.js","./geodesicUtils-FCYOaNwu.js","./plane-IENfwZlB.js","./mat3f64-BBpwCtoL.js","./mat4f64-Dk4dwAN8.js","./quatf64-CCm9z-pX.js","./mathUtils-BG-eq9fO.js","./sphere-C77djCO6.js","./mat4-GpOFENPA.js","./mat3-BRl2i9Bz.js","./geometry2dUtils-DdyQE7AQ.js","./viewUtils-DrPohWV3.js","./SnappingVisualizer-BtjTdiTG.js","./PointSnappingHint-D7X20mlb.js","./editPlaneUtils-DJAUpVXQ.js","./UpdatingHandles-GfwcIh5z.js","./coordinateFormatter-Bqv90CKy.js","./GraphicsLayer-i3FeUJ_n.js","./GraphicsCollection-FfahqxsR.js","./Layer-CVt7Hb5J.js","./BlendLayer-CXM4n_Ge.js","./jsonUtils-CSnQD004.js","./parser-CTsgEym6.js","./utils-93yNk4Xc.js","./mat4f32-DcsiF_Rp.js","./ScaleRangeLayer-Bb8Ig1Hz.js","./ElevationInfo-CA5m_tHv.js","./dehydratedFeatureComparison-06VFTqH5.js","./createUtils-ibzYx0GK.js","./Circle-BInHZHdw.js","./geometryEngine-DGiYLHJy.js","./geometryEngineBase-yFIvKOkM.js","./_commonjsHelpers-DCkdB7M8.js","./hydrated-C9rxSL4a.js","./surfaceCoordinateSystems-DhFxihAh.js","./memoize-DsJmrG76.js","./ReactiveSet-BU2iaegS.js","./diffUtils-BP7jmOAy.js","./ViewingMode-Dodu7ZZk.js","./EditGeometryOperations-Cl8Sbfxr.js","./compilerUtils-Dw3R0f-Z.js","./InteractiveToolBase-vg6J8uyT.js","./meshVertexSpaceUtils-CXzOFlTI.js","./MeshLocalVertexSpace-LEHwMUnu.js","./hydratedFeatures-DBKLr8hT.js","./interfaces-D6pIddIh.js","./quantityUtils-D0GB2dMc.js","./angularMeasurementUtils-7e2vxqzG.js","./Cyclical-oTUX3aX7.js","./SketchLabelOptions-DDQnGNSN.js","./SnappingContext-lR2hMWGP.js","./SnappingDragPipelineStep-rzVcndp8.js","./Scheduler-CJu5awNf.js","./debugFlags-BF6Z0j0F.js","./SnappingOperation-CaI4DIP4.js","./mat2d-D9DBP-jx.js","./mat2df64-CBKYtunK.js","./quat-4pa1e6ds.js","./helpMessageUtils-M95XMmyR.js","./helpMessageUtils3d-TaLw0ElD.js","./SketchTooltipInfo-BA57LzDt.js","./MeshTransform-D2t3aEmK.js","./axisAngleDegrees-Ci2HA7Jo.js","./themeUtils-C3zvZbsE.js","./jsxFactory-CJa39Fro.js","./uuid-fwrPAdZb.js","./a11yUtils-cyWndM8Q.js","./unitFormatUtils-CZ2bRlFg.js","./ByteSizeUnit-BsxeN7wM.js","./getDefaultUnitForView-Ce2vZZap.js","./quantityFormatUtils-CX8UdSzC.js","./spatialReferenceEllipsoidUtils-DBE_OFra.js","./directionModeIcons-Br5woIHu.js","./automaticAreaMeasurementUtils-12dUsEmf.js","./geodesicMeasurementUtils-Bt9h4589.js","./euclideanAreaMeasurementUtils-CfO9bFtV.js","./earcut-Lltz9D9k.js","./triangle-PTGDC_xJ.js","./lineSegment-D7sKPPYf.js","./geodesicAreaMeasurementUtils-BILXFcc4.js","./automaticLengthMeasurementUtils-BXgXm1JY.js","./geodesicLengthMeasurementUtils-he3vjGJN.js","./isSupportedObject-6I_Nw0mS.js","./boundedPlane-EV1sS2Ke.js","./cimSymbolUtils-DXvZxabN.js","./utils-D2PLyMFF.js","./GraphicManipulator-Dc-QfW2U.js","./defaults-DZ1kfMRx.js","./defaultsJSON-GKolV7NZ.js","./drapedUtils-HWKOCxgF.js","./colorUtils-aL8wj-8G.js","./drawUtils-D0InE6Wy.js","./hitTestSelectUtils-UXJPjatw.js","./screenUtils-WcqhHU65.js"])))=>i.map(i=>d[i]);
import{_ as u}from"./index-Bh2oEzTI.js";import{r as n}from"./tslib.es6-B3Jf3DVX.js";import{b as v,C as y}from"./Accessor-BLX9ikPh.js";import{e as l,i as f,a0 as g,m as s,a as T}from"./subclass-BZA_h8Db.js";import{initial as d}from"./reactiveUtils-C5zUhJQJ.js";import{h as w}from"./UpdatingHandles-GfwcIh5z.js";import{_ as h}from"./InputManager-Ba9xzDpe.js";import"./asyncUtils-CWX51uTe.js";import"./Collection-CEdjem1-.js";import"./Evented-BHRw9x22.js";import"./shared-B3wH2qpO.js";import"./SimpleObservable-KocWTzVy.js";import"./Queue-yu3bZ02p.js";import"./signal-D4lghLjV.js";const c={redo:"r",undo:"z"},m=Symbol(),p=Symbol(),_=Symbol();let i=class extends v{constructor(t){super(t),this._tool=null,this._updatingHandles=new w,this.enabled=!1,this._onPointerMove=y(async e=>{const o=await this._updatingHandles.addPromise(this._findElementAtScreenPoint(e));this.destroyed||(this.removeHandles(p),o&&o!==this.selectedElement&&(this.view.cursor="pointer",this.addHandles(l(()=>this.view.cursor=null),p)))})}initialize(){this.addHandles(f(this._updatingHandles)),this._updatingHandles.add(()=>this.enabled,t=>this._setEnabled(t),d),this._updatingHandles.add(()=>this._preferredInteractionTool,()=>this._preferredInteractionToolChanged())}get _validatedSelectedElement(){const t=this.selectedElement;if(!t)return null;const{layer:{source:e}}=this;return e?"hasElement"in e?e.hasElement(t)?t:null:e===t?t:null:null}get _preferredInteractionTool(){var t;return((t=this.options)==null?void 0:t.tool)??"transform"}get updating(){return this._updatingHandles.updating}_setEnabled(t){if(this.removeHandles(m),!t)return;const{view:e}=this;this.addHandles([e.on("immediate-click",o=>this._onClick(o),h.TOOL),e.on("pointer-move",o=>this._onPointerMove(o).catch(()=>{}),h.TOOL),e.on("key-down",o=>{var a,r;o.key===c.undo&&((a=this._tool)!=null&&a.canUndo())&&(this._tool.undo(),o.stopPropagation()),o.key===c.redo&&((r=this._tool)!=null&&r.canRedo())&&(this._tool.redo(),o.stopPropagation())}),this._updatingHandles.add(()=>this._validatedSelectedElement,o=>this._selectedElementChanged(o),d),l(()=>{e.cursor=null,this._removeTool()})],m)}async _findElementAtScreenPoint(t){const e=(await this.view.hitTest(t,{include:[this.layer]})).results[0];return(e==null?void 0:e.type)==="media"?e.element:null}async _onClick(t){await this._updatingHandles.addPromise(t.async(async()=>{const e=await this._findElementAtScreenPoint(t);this.destroyed||(e&&t.stopPropagation(),this.selectedElement=e,this.selectedElement&&(this.view.cursor=null))}))}_preferredInteractionToolChanged(){const{_tool:t}=this;t&&(this._preferredInteractionTool===t.type||this._updatingHandles.addPromise(this._recreateTool()))}async _recreateTool(){this.removeHandles(_),this._removeTool();const t=this._validatedSelectedElement;if(!t)return;const e=new AbortController;this.addHandles(g(e),_);const{TransformTool:o,ControlPointsTransformTool:a}=await u(()=>import("./editingTools-DCvBiyJu.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169]),import.meta.url);if(e.signal.aborted)return;const{view:r}=this;switch(this._preferredInteractionTool){case"transform":this._tool=new o({target:t,view:r});break;case"reshape":this._tool=new a({mediaElement:t,view:r})}this.addHandles([l(()=>{this._tool&&(r.tools.remove(this._tool),this._tool=null)})],this._tool),r.addAndActivateTool(this._tool)}_removeTool(){this._tool&&this.removeHandles(this._tool)}async _selectedElementChanged(t){t!=null&&t.georeference?await this._updatingHandles.addPromise(this._recreateTool()):this._removeTool()}};n([s()],i.prototype,"_validatedSelectedElement",null),n([s()],i.prototype,"_preferredInteractionTool",null),n([s({constructOnly:!0})],i.prototype,"view",void 0),n([s({constructOnly:!0})],i.prototype,"layer",void 0),n([s()],i.prototype,"selectedElement",void 0),n([s()],i.prototype,"enabled",void 0),n([s()],i.prototype,"options",void 0),n([s()],i.prototype,"updating",null),i=n([T("esri.views.2d.layers.support.MediaLayerInteraction")],i);export{i as MediaLayerInteraction};
