import{e as h}from"./Evented-CXIxDjmW.js";import{S as d}from"./Accessor-D6mNnsWy.js";import{y as a,b as T,h as v,n as S,a as p}from"./subclass-BR3PhgZG.js";import{y as E}from"./parser-BN6zmHl-.js";import{t as $,e as w}from"./utils-D20M4_S8.js";const _=-1;let o=class extends d{constructor(t){super(t),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=v("mapview-transitions-duration"),this.effects=[]}set effect(t){if(this._get("effect")!==(t=t||"")){this._set("effect",t);try{this._transitionTo(g(t))}catch(e){this._transitionTo([]),S.getLogger(this).warn("Invalid Effect",{effect:t,error:e})}}}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(t){this._updateForScale(t)}get transitioning(){return this._to!==null}canTransitionTo(t){try{return this.scale>0&&m(this._current,g(t),this.scale)}catch{return!1}}transitionStep(t,e){this._applyTimeTransition(t),this._updateForScale(e)}endTransitions(){this._applyTimeTransition(this.duration)}_transitionTo(t){this.scale>0&&m(this._current,t,this.scale)?(this._final=t,this._to=p(t),F(this._current,this._to,this.scale),this._from=p(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=t),this._set("effects",this._current[0]?p(this._current[0].effects):[])}_applyTimeTransition(t){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=t;const e=Math.min(1,this._time/this.duration);for(let n=0;n<this._current.length;n++){const s=this._current[n],f=this._from[n],l=this._to[n];s.scale=O(f.scale,l.scale,e);for(let r=0;r<s.effects.length;r++){const i=s.effects[r],u=f.effects[r],y=l.effects[r];i.interpolate(u,y,e)}}e===1&&(this._current=this._final,this._set("effects",this._current[0]?p(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(t){if(this._set("scale",t),this._current.length===0)return;const e=this._current,n=this._current.length-1;let s,f,l=1;if(e.length===1||t>=e[0].scale)f=s=e[0].effects;else if(t<=e[n].scale)f=s=e[n].effects;else for(let r=0;r<n;r++){const i=e[r],u=e[r+1];if(i.scale>=t&&u.scale<=t){l=(t-i.scale)/(u.scale-i.scale),s=i.effects,f=u.effects;break}}for(let r=0;r<this.effects.length;r++)this.effects[r].interpolate(s[r],f[r],l)}};function g(c){const t=E(c)||[];return b(t)?[{scale:_,effects:t}]:t}function m(c,t,e){var n,s,f,l;return!((n=c[0])!=null&&n.effects)||!((s=t[0])!=null&&s.effects)?!0:!((((f=c[0])==null?void 0:f.scale)===_||((l=t[0])==null?void 0:l.scale)===_)&&(c.length>1||t.length>1)&&e<=0)&&$(c[0].effects,t[0].effects)}function F(c,t,e){const n=c.length>t.length?c:t,s=c.length>t.length?t:c,f=s[s.length-1],l=(f==null?void 0:f.scale)??e,r=(f==null?void 0:f.effects)??[];for(let i=s.length;i<n.length;i++)s.push({scale:l,effects:[...r]});for(let i=0;i<n.length;i++)s[i].scale=s[i].scale===_?e:s[i].scale,n[i].scale=n[i].scale===_?e:n[i].scale,w(s[i].effects,n[i].effects)}function O(c,t,e){return c+(t-c)*e}function b(c){const t=c[0];return!!t&&"type"in t}h([a()],o.prototype,"_to",void 0),h([a()],o.prototype,"duration",void 0),h([a({value:""})],o.prototype,"effect",null),h([a({readOnly:!0})],o.prototype,"effects",void 0),h([a({readOnly:!0})],o.prototype,"hasEffects",null),h([a({value:0})],o.prototype,"scale",null),h([a({readOnly:!0})],o.prototype,"transitioning",null),o=h([T("esri.layers.effects.EffectView")],o);export{o as h};
