const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./editingSupport-CA_XWXsU.js","./Graphic-DsxsIjhH.js","./tslib.es6-B3Jf3DVX.js","./geometry-D964gYQX.js","./subclass-BZA_h8Db.js","./Extent-Bf3YTe7m.js","./Point-Cg0-ChZE.js","./Accessor-BLX9ikPh.js","./cast-Bjksrh93.js","./writer-DNAwXnhG.js","./assets-C43MgM-v.js","./index-Bh2oEzTI.js","./index-2kwcjS9-.css","./jsonMap-0cxwUWs2.js","./Polyline-D9YkgmM_.js","./mathUtils-C4_ghTv4.js","./PopupTemplate-BHMhS05j.js","./Clonable-D3rtuBWg.js","./Collection-CEdjem1-.js","./Evented-BHRw9x22.js","./shared-B3wH2qpO.js","./SimpleObservable-KocWTzVy.js","./fieldUtils-tmQlKvWo.js","./intl-CChhNOV8.js","./date-DlqISzcw.js","./locale-C9TlLpzi.js","./messages-OmQvZhAg.js","./enumeration-Ba5njXdz.js","./Color-BCS62Hs5.js","./colorUtils-0bJDPow9.js","./ActionToggle-iT4slXc7.js","./Identifiable-B1UbsKNt.js","./symbols-CNimns--.js","./TextSymbol-D8QO_KUV.js","./screenUtils-_ZIvrt5o.js","./materialUtils-DarhapKC.js","./opacityUtils-C68Tlu6_.js","./vec3f64-BLpZdpfb.js","./aaBoundingBox-BE7cC1jD.js","./persistableUrlUtils-fa1mAujs.js","./collectionUtils-D_lHIu88.js","./Portal-C10FKnaA.js","./Loadable-BabW5Xcc.js","./Promise-B2Hu02L7.js","./reactiveUtils-C5zUhJQJ.js","./asyncUtils-CWX51uTe.js","./jsonUtils-CEfjT-BK.js","./uuid-fwrPAdZb.js","./normalizeUtils-EVmAQ-ak.js","./normalizeUtilsCommon-dT81xWiM.js","./utils-6jMaHUrH.js","./utils-Bema0iXE.js","./EditBusLayer-DoTks2sU.js","./infoFor3D-C0hFfS1m.js","./layerUtils-BrNoooE9.js"])))=>i.map(i=>d[i]);
import{_ as $}from"./index-Bh2oEzTI.js";import{r}from"./tslib.es6-B3Jf3DVX.js";import{o as F}from"./geometry-D964gYQX.js";import{q as w}from"./PopupTemplate-BHMhS05j.js";import"./ClassBreaksRenderer-BuHwSyVK.js";import{m as j,u as N}from"./jsonUtils-DxpLMo6d.js";import"./UniqueValueRenderer-BQtAHUSo.js";import"./SimpleRenderer-BV2L9G_n.js";import{S as J}from"./MultiOriginJSONSupport-B5nfqtQh.js";import{C as R,p as T}from"./Accessor-BLX9ikPh.js";import{I as y}from"./assets-C43MgM-v.js";import{m as o,a as O,b as f,j as q,n as g}from"./subclass-BZA_h8Db.js";import P from"./Layer-CVt7Hb5J.js";import{m as k}from"./Loadable-BabW5Xcc.js";import{p as D}from"./workers-D4HfeYKj.js";import{y as C}from"./clientSideDefaults-BCN5Jkqv.js";import{d as G}from"./FeatureSet-BHEkYP03.js";import{w as I}from"./Extent-Bf3YTe7m.js";import{v as Z}from"./Polyline-D9YkgmM_.js";import{l as Q}from"./BlendLayer-CXM4n_Ge.js";import{e as z}from"./CustomParametersMixin-B4u7wiBT.js";import{c as L}from"./FeatureEffectLayer-CpM66wLd.js";import{c as V}from"./FeatureReductionLayer-Ddbk727V.js";import{b as A}from"./OperationalLayer-CVyVfSPu.js";import{p as U}from"./OrderedLayer-C5VLMHgA.js";import{j as W}from"./PortalLayer-CKja4bdW.js";import{f as B}from"./RefreshableLayer-D7lXUJRS.js";import{t as M}from"./ScaleRangeLayer-Bb8Ig1Hz.js";import{l as H}from"./TemporalLayer-Dpq2hKKV.js";import{T as K,c as X,u as Y,p as tt,d as et,f as rt,l as ot,s as it,y as st}from"./commonProperties-CPyIG_-u.js";import{p as nt}from"./FeatureTemplate-CssMa1yk.js";import{y as pt}from"./Field-ybkHhtnK.js";import{s as at}from"./fieldProperties-Cgxj08ZE.js";import{N as v,g as lt}from"./fieldUtils-tmQlKvWo.js";import{C as ut,n as mt}from"./labelingInfo-DYPSPZCH.js";import{b as d}from"./Query-5Xpquc1r.js";import{p as dt}from"./popupUtils-BBuPGAHd.js";import{c as ht}from"./date-DlqISzcw.js";import{g as E}from"./Point-Cg0-ChZE.js";import"./jsonMap-0cxwUWs2.js";import"./Clonable-D3rtuBWg.js";import"./Collection-CEdjem1-.js";import"./Evented-BHRw9x22.js";import"./shared-B3wH2qpO.js";import"./SimpleObservable-KocWTzVy.js";import"./cast-Bjksrh93.js";import"./writer-DNAwXnhG.js";import"./enumeration-Ba5njXdz.js";import"./Color-BCS62Hs5.js";import"./colorUtils-0bJDPow9.js";import"./mathUtils-C4_ghTv4.js";import"./ActionToggle-iT4slXc7.js";import"./Identifiable-B1UbsKNt.js";import"./symbols-CNimns--.js";import"./TextSymbol-D8QO_KUV.js";import"./screenUtils-_ZIvrt5o.js";import"./materialUtils-DarhapKC.js";import"./opacityUtils-C68Tlu6_.js";import"./vec3f64-BLpZdpfb.js";import"./aaBoundingBox-BE7cC1jD.js";import"./persistableUrlUtils-fa1mAujs.js";import"./collectionUtils-D_lHIu88.js";import"./Portal-C10FKnaA.js";import"./locale-C9TlLpzi.js";import"./reactiveUtils-C5zUhJQJ.js";import"./asyncUtils-CWX51uTe.js";import"./RendererLegendOptions-B-4se3aU.js";import"./LRUCache-B_PHMSGm.js";import"./MemCache-Dx1v3xLC.js";import"./Version-BSlAgupz.js";import"./jsonUtils-CEfjT-BK.js";import"./FieldsIndex-DpwHKAMX.js";import"./UnknownTimeZone-BkowvBs8.js";import"./OverrideHelper-ti072FkP.js";import"./colorUtils-aL8wj-8G.js";import"./vec42-YcqnINSP.js";import"./common-DQOJ18NT.js";import"./vec4f64-o2zAXfmz.js";import"./utils-D2PLyMFF.js";import"./enums-CmIX1y88.js";import"./quantizationUtils-uj_P09aO.js";import"./HeatmapColorStop-BJc5nbwr.js";import"./heatmapUtils-Dwiv9IEa.js";import"./SizeVariable-936USOrb.js";import"./sizeVariableUtils-Cmcuvw-4.js";import"./visualVariableUtils-DX1kS9Se.js";import"./Graphic-DsxsIjhH.js";import"./compilerUtils-Dw3R0f-Z.js";import"./lengthUtils-DL1-FDQQ.js";import"./intl-CChhNOV8.js";import"./messages-OmQvZhAg.js";import"./Promise-B2Hu02L7.js";import"./diffUtils-BP7jmOAy.js";import"./colorRamps-pKd7I5WZ.js";import"./ColorStop-Dk3U5tCk.js";import"./jsonUtils-Ds2Sqto-.js";import"./layerUtils-BrNoooE9.js";import"./defaults-DZ1kfMRx.js";import"./defaultsJSON-GKolV7NZ.js";import"./styleUtils-BYTm14n3.js";import"./TimeExtent-DocT5yPf.js";import"./timeUtils-8fb_2oAt.js";import"./Queue-yu3bZ02p.js";import"./QueryEngineCapabilities-DjYb9CEb.js";import"./capabilities-Y9lFlGVh.js";import"./jsonUtils-CSnQD004.js";import"./parser-CTsgEym6.js";import"./utils-93yNk4Xc.js";import"./mat4f32-DcsiF_Rp.js";import"./mat4-GpOFENPA.js";import"./FeatureEffect-BEzQmzeC.js";import"./FeatureFilter-BMHRQSxq.js";import"./layerContainerType-C5CzMsLd.js";import"./FeatureReductionSelection-7vaL4DYT.js";import"./featureLayerUtils-DBsQMhTm.js";import"./featureQueryAll-DnVoEjkM.js";import"./AttachmentQuery-BUlkjzkx.js";import"./RelationshipQuery-DPPNeuLK.js";import"./DataLayerSource-BKkswDvG.js";import"./fieldType-BuzM0UHS.js";import"./MD5-C9MwAd2G.js";import"./OrderByInfo-IYmS1EXF.js";import"./PortalItem-DzgXrpyc.js";import"./portalItemUtils-BzVoFAku.js";import"./projection-B971H0Re.js";import"./projectBuffer-Bs7GwaPY.js";import"./geodesicConstants-DWQLYX7F.js";import"./TimeInfo-LUiaSFyX.js";import"./TimeInterval-CNlkea1s.js";import"./ElevationInfo-CA5m_tHv.js";import"./unitConversionUtils-BMfW9yAe.js";import"./AttributeTableTemplate-BZeVyq-j.js";import"./labelUtils-B8petyBk.js";import"./FullTextSearch-Csd1Hktu.js";let l=class extends k{constructor(){super(...arguments),this.type="geojson",this.refresh=R(async t=>{await this.load();const{extent:e,timeExtent:s}=await this._connection.invoke("refresh",t);return this.sourceJSON.extent=e,s&&(this.sourceJSON.timeInfo.timeExtent=[s.start,s.end]),{dataChanged:!0,updates:{extent:this.sourceJSON.extent,timeInfo:this.sourceJSON.timeInfo}}})}load(t){const e=t!=null?t.signal:null;return this.addResolvingPromise(this._startWorker(e)),Promise.resolve(this)}destroy(){var t;(t=this._connection)==null||t.close(),this._connection=null}applyEdits(t){return this.load().then(()=>this._applyEdits(t))}openPorts(){return this.load().then(()=>this._connection.openPorts())}queryFeatures(t,e={}){return this.load(e).then(()=>this._connection.invoke("queryFeatures",t?t.toJSON():null,e)).then(s=>G.fromJSON(s))}queryFeaturesJSON(t,e={}){return this.load(e).then(()=>this._connection.invoke("queryFeatures",t?t.toJSON():null,e))}queryFeatureCount(t,e={}){return this.load(e).then(()=>this._connection.invoke("queryFeatureCount",t?t.toJSON():null,e))}queryObjectIds(t,e={}){return this.load(e).then(()=>this._connection.invoke("queryObjectIds",t?t.toJSON():null,e))}queryExtent(t,e={}){return this.load(e).then(()=>this._connection.invoke("queryExtent",t?t.toJSON():null,e)).then(s=>({count:s.count,extent:I.fromJSON(s.extent)}))}querySnapping(t,e={}){return this.load(e).then(()=>this._connection.invoke("querySnapping",t,e))}_applyEdits(t){if(!this._connection)throw new f("geojson-layer-source:edit-failure","Memory source not loaded");const e=this.layer.objectIdField,s=[],n=[],a=[];if(t.addFeatures)for(const p of t.addFeatures)s.push(this._serializeFeature(p));if(t.deleteFeatures)for(const p of t.deleteFeatures)"objectId"in p&&p.objectId!=null?n.push(p.objectId):"attributes"in p&&p.attributes[e]!=null&&n.push(p.attributes[e]);if(t.updateFeatures)for(const p of t.updateFeatures)a.push(this._serializeFeature(p));return this._connection.invoke("applyEdits",{adds:s,updates:a,deletes:n}).then(({extent:p,timeExtent:u,featureEditResults:h})=>(this.sourceJSON.extent=p,u&&(this.sourceJSON.timeInfo.timeExtent=[u.start,u.end]),this._createEditsResult(h)))}_createEditsResult(t){return{addFeatureResults:t.addResults?t.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:t.updateResults?t.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:t.deleteResults?t.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(t){const e=t.success===!0?null:t.error||{code:void 0,description:void 0};return{objectId:t.objectId,globalId:t.globalId,error:e?new f("geojson-layer-source:edit-failure",e.description,{code:e.code}):null}}_serializeFeature(t){const{attributes:e}=t,s=this._geometryForSerialization(t);return s?{geometry:s.toJSON(),attributes:e}:{attributes:e}}_geometryForSerialization(t){const{geometry:e}=t;return e==null?null:e.type==="mesh"||e.type==="extent"?Z.fromExtent(e.extent):e}async _startWorker(t){this._connection=await D("GeoJSONSourceWorker",{strategy:q("feature-layers-workers")?"dedicated":"local",signal:t,registryTarget:this});const{fields:e,spatialReference:s,hasZ:n,geometryType:a,objectIdField:p,url:u,timeInfo:h,customParameters:S}=this.layer,x=this.layer.originOf("spatialReference")==="defaults",_={url:u,customParameters:S,fields:e&&e.map(c=>c.toJSON()),geometryType:F.toJSON(a),hasZ:n,objectIdField:p,timeInfo:h?h.toJSON():null,spatialReference:x?null:s&&s.toJSON()},m=await this._connection.invoke("load",_,{signal:t});for(const c of m.warnings)g.getLogger(this.layer).warn("#load()",`${c.message} (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{warning:c});m.featureErrors.length&&g.getLogger(this.layer).warn("#load()",`Encountered ${m.featureErrors.length} validation errors while loading features. (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{errors:m.featureErrors}),this.sourceJSON=m.layerDefinition,this.capabilities=C(this.sourceJSON.hasZ,!0)}};r([o()],l.prototype,"capabilities",void 0),r([o()],l.prototype,"type",void 0),r([o({constructOnly:!0})],l.prototype,"layer",void 0),r([o()],l.prototype,"sourceJSON",void 0),l=r([O("esri.layers.graphics.sources.GeoJSONSource")],l);const b=at();let i=class extends U(z(V(L(Q(H(M(B(A(W(J(P))))))))))){constructor(t){super(t),this.attributeTableTemplate=null,this.copyright=null,this.dateFieldsTimeZone=null,this.definitionExpression=null,this.displayField=null,this.editingEnabled=!1,this.elevationInfo=null,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.hasZ=void 0,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType="GeoJSON",this.outFields=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new l({layer:this}),this.spatialReference=E.WGS84,this.templates=null,this.title="GeoJSON",this.type="geojson"}destroy(){var t;(t=this.source)==null||t.destroy()}load(t){const e=this.loadFromPortal({supportedTypes:["GeoJson"],supportsData:!1},t).catch(T).then(()=>this.source.load(t)).then(()=>{this.read(this.source.sourceJSON,{origin:"service",url:this.parsedUrl}),this.revert(["objectIdField","fields","timeInfo"],"service"),v(this.renderer,this.fieldsIndex),lt(this.timeInfo,this.fieldsIndex)});return this.addResolvingPromise(e),Promise.resolve(this)}get capabilities(){return this.source?this.source.capabilities:null}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("capabilities"),(this._get("createQueryVersion")||0)+1}get defaultPopupTemplate(){return this.createPopupTemplate()}get isTable(){return this.loaded&&this.geometryType==null}get parsedUrl(){return this.url?y(this.url):null}set renderer(t){v(t,this.fieldsIndex),this._set("renderer",t)}set url(t){if(!t)return void this._set("url",t);const e=y(t);this._set("url",e.path),e.query&&(this.customParameters={...this.customParameters,...e.query})}async applyEdits(t,e){const{applyEdits:s}=await $(()=>import("./editingSupport-CA_XWXsU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54]),import.meta.url);await this.load();const n=await s(this,this.source,t,e);return this.read({extent:this.source.sourceJSON.extent,timeInfo:this.source.sourceJSON.timeInfo},{origin:"service",ignoreDefaults:!0}),n}on(t,e){return super.on(t,e)}createPopupTemplate(t){return dt(this,t)}createQuery(){var a;const t=new d,e=(a=this.capabilities)==null?void 0:a.data;t.returnGeometry=!0,e&&e.supportsZ&&(t.returnZ=!0),t.outFields=["*"],t.where=this.definitionExpression||"1=1";const{timeOffset:s,timeExtent:n}=this;return t.timeExtent=s!=null&&n!=null?n.offset(-s.value,s.unit):n||null,t}getFieldDomain(t,e){var s;return(s=this.getField(t))==null?void 0:s.domain}getField(t){return this.fieldsIndex.get(t)}queryFeatures(t,e){return this.load().then(()=>this.source.queryFeatures(d.from(t)||this.createQuery(),e)).then(s=>{if(s!=null&&s.features)for(const n of s.features)n.layer=n.sourceLayer=this;return s})}queryObjectIds(t,e){return this.load().then(()=>this.source.queryObjectIds(d.from(t)||this.createQuery(),e))}queryFeatureCount(t,e){return this.load().then(()=>this.source.queryFeatureCount(d.from(t)||this.createQuery(),e))}queryExtent(t,e){return this.load().then(()=>this.source.queryExtent(d.from(t)||this.createQuery(),e))}async hasDataChanged(){try{const{dataChanged:t,updates:e}=await this.source.refresh(this.customParameters);return e!=null&&this.read(e,{origin:"service",url:this.parsedUrl,ignoreDefaults:!0}),t}catch{}return!1}};r([o(K)],i.prototype,"attributeTableTemplate",void 0),r([o({readOnly:!0,json:{read:!1,write:!1}})],i.prototype,"capabilities",null),r([o({type:String})],i.prototype,"copyright",void 0),r([o({readOnly:!0})],i.prototype,"createQueryVersion",null),r([o(ht("dateFieldsTimeReference"))],i.prototype,"dateFieldsTimeZone",void 0),r([o({readOnly:!0})],i.prototype,"defaultPopupTemplate",null),r([o({type:String,json:{name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],i.prototype,"definitionExpression",void 0),r([o({type:String})],i.prototype,"displayField",void 0),r([o({type:Boolean})],i.prototype,"editingEnabled",void 0),r([o(X)],i.prototype,"elevationInfo",void 0),r([o({type:[pt],json:{name:"layerDefinition.fields",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"fields"}}}})],i.prototype,"fields",void 0),r([o(b.fieldsIndex)],i.prototype,"fieldsIndex",void 0),r([o({type:I,json:{name:"extent"}})],i.prototype,"fullExtent",void 0),r([o({type:["point","polygon","polyline","multipoint"],json:{read:{reader:F.read}}})],i.prototype,"geometryType",void 0),r([o({type:Boolean})],i.prototype,"hasZ",void 0),r([o(Y)],i.prototype,"id",void 0),r([o({type:Boolean,readOnly:!0})],i.prototype,"isTable",null),r([o(tt)],i.prototype,"labelsVisible",void 0),r([o({type:[ut],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:mt},write:!0}})],i.prototype,"labelingInfo",void 0),r([o(et)],i.prototype,"legendEnabled",void 0),r([o({type:["show","hide"]})],i.prototype,"listMode",void 0),r([o({type:String,json:{name:"layerDefinition.objectIdField",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"objectIdField"}}}})],i.prototype,"objectIdField",void 0),r([o(rt)],i.prototype,"opacity",void 0),r([o({type:["GeoJSON"]})],i.prototype,"operationalLayerType",void 0),r([o(b.outFields)],i.prototype,"outFields",void 0),r([o({readOnly:!0})],i.prototype,"parsedUrl",null),r([o(ot)],i.prototype,"popupEnabled",void 0),r([o({type:w,json:{name:"popupInfo",write:!0}})],i.prototype,"popupTemplate",void 0),r([o({types:j,json:{name:"layerDefinition.drawingInfo.renderer",write:!0,origins:{service:{name:"drawingInfo.renderer"},"web-scene":{types:N}}}})],i.prototype,"renderer",null),r([o(it)],i.prototype,"screenSizePerspectiveEnabled",void 0),r([o({readOnly:!0})],i.prototype,"source",void 0),r([o({type:E})],i.prototype,"spatialReference",void 0),r([o({type:[nt]})],i.prototype,"templates",void 0),r([o()],i.prototype,"title",void 0),r([o({json:{read:!1},readOnly:!0})],i.prototype,"type",void 0),r([o(st)],i.prototype,"url",null),i=r([O("esri.layers.GeoJSONLayer")],i);const Zr=i;export{Zr as default};
