const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./lclayout-C72fYnMo.js","./_commonjsHelpers-DCkdB7M8.js"])))=>i.map(i=>d[i]);
import{r as u}from"./tslib.es6-B3Jf3DVX.js";import{o as ne}from"./geometry-D964gYQX.js";import{b as et,d as tt}from"./Accessor-BLX9ikPh.js";import{b as X,r as Z,m,a as Ne,n as ye,g as q}from"./subclass-BZA_h8Db.js";import{e as Le,N as it,g as nt}from"./fieldUtils-tmQlKvWo.js";import{v as We,d as rt}from"./Polyline-D9YkgmM_.js";import{N as we,K as ce}from"./projection-B971H0Re.js";import{a1 as K,g as ot,j as at}from"./Point-Cg0-ChZE.js";import{o as st}from"./featureConversionUtils-D14h8iad.js";import{e as De}from"./OptimizedFeature-6cJ-QFG5.js";import{f as pt}from"./jsonUtils-CEfjT-BK.js";import"./Graphic-DsxsIjhH.js";import{c as lt,U as dt}from"./assets-C43MgM-v.js";import"./symbols-CNimns--.js";import"./GraphicsLayer-i3FeUJ_n.js";import"./aaBoundingBox-BE7cC1jD.js";import"./mathUtils-C4_ghTv4.js";import{w as me}from"./Extent-Bf3YTe7m.js";import{W as yt,M as re,r as ze}from"./knowledgeGraphService-9oFvDyoC.js";import{_ as ut}from"./index-Bh2oEzTI.js";import{s as te}from"./GraphQueryStreaming-BltM_QD2.js";import"./TextSymbol-D8QO_KUV.js";import{b as oe}from"./Query-5Xpquc1r.js";import{q as ct}from"./PopupTemplate-BHMhS05j.js";import"./ClassBreaksRenderer-BuHwSyVK.js";import{t as fe,m as mt}from"./jsonUtils-DxpLMo6d.js";import"./UniqueValueRenderer-BQtAHUSo.js";import"./SimpleRenderer-BV2L9G_n.js";import{S as ht}from"./MultiOriginJSONSupport-B5nfqtQh.js";import{E as ft}from"./workers-D4HfeYKj.js";import{r as gt}from"./writer-DNAwXnhG.js";import Tt from"./Layer-CVt7Hb5J.js";import{m as bt}from"./FeatureStore-Dr0GQdbp.js";import{V as wt}from"./QueryEngine-DrzbS-Dm.js";import{y as Et,u as ge}from"./clientSideDefaults-BCN5Jkqv.js";import{s as It}from"./fieldProperties-Cgxj08ZE.js";import{l as Nt,s as Lt,a as Dt}from"./BlendLayer-CXM4n_Ge.js";import{c as _t,p as vt}from"./FeatureEffectLayer-CpM66wLd.js";import{c as Mt,p as Rt}from"./FeatureReductionLayer-Ddbk727V.js";import{p as St,c as $t}from"./OrderedLayer-C5VLMHgA.js";import{f as Ct}from"./RefreshableLayer-D7lXUJRS.js";import{t as kt}from"./ScaleRangeLayer-Bb8Ig1Hz.js";import{l as At,f as Ot}from"./TemporalLayer-Dpq2hKKV.js";import{p as xt,d as jt,v as Ft,j as qt,f as Pt,l as Gt}from"./commonProperties-CPyIG_-u.js";import{y as ue}from"./Field-ybkHhtnK.js";import{C as Bt,n as Ut}from"./labelingInfo-DYPSPZCH.js";import{d as Ht}from"./TimeInfo-LUiaSFyX.js";import{d as Qt}from"./FeatureSet-BHEkYP03.js";import{p as Jt}from"./popupUtils-BBuPGAHd.js";const V="ESRI__ID",Ee="ESRI__OriginID",Ie="ESRI__DestID",Ze="ESRI__LayoutGeometry",_e="ESRI__AggregationCount",pe="LC.ESRI__IsSpatial",Vt={initializeLayersFromClientData:async(e,t)=>{if(t||(t=[...e.layers,...e.tables].map(a=>a.graphTypeName)),(t==null?void 0:t.length)===0)return;const n=new Map;for(const a of t)n.set(a,ve(e,a));const i=await yt(e.dataManager.knowledgeGraph,Array.from(n.values()));for(const a of[...e.layers,...e.tables]){const r=a.objectType.name;if(r===null)continue;const o=i.get(ve(e,r));if(o){const s=JSON.parse(o);s===null||typeof s!="object"||s.hasOwnProperty("showLabels")||(s.showLabels=!1),a.read(s,{origin:"service"})}}}},ve=(e,t)=>e.type==="knowledge-graph"?`${t}/Map`:`${t}/LinkChart/LinkChartSubLayer`;async function Ki(e,t){return Vt.initializeLayersFromClientData(e,t)}let Te=class ie{constructor(){this._featureLookup=new Map}static getInstance(){return ie.instance||(ie.instance=new ie),ie.instance}static resetInstance(){ie.instance&&(ie.instance=null)}deleteFromStore(t){t.forEach(n=>{this._featureLookup.delete(n)})}readFromStoreByList(t){const n=[];return t.forEach(i=>{const a=this.readFromStoreById(i);a&&n.push(a)}),n}readFromStoreById(t){return this._featureLookup.get(t)??null}writeToStore(t,n,i){const a=[];return t.forEach(r=>{if(!(r!=null&&r.id))return;r.properties||(r.properties=[]);let o,s=null;if(i&&r.properties[i]&&(s=st(r.properties[i])),"originId"in r&&"destinationId"in r&&(r.properties[Ee]=r.originId,r.properties[Ie]=r.destinationId),r.properties[n]=r.id,r.id&&this._featureLookup.has(r.id)&&this._featureLookup.get(r.id).attributes){const p=this._featureLookup.get(r.id),c=JSON.parse(JSON.stringify(Object.assign(p.attributes,r.properties)));i&&r.properties[i]&&(c[i]=pt(r.properties[i])),o=new De(s?JSON.parse(JSON.stringify(s)):p!=null&&p.geometry?JSON.parse(JSON.stringify(p.geometry)):null,c,null,r.properties[n])}else o=new De(s?JSON.parse(JSON.stringify(s)):null,r.properties,null,r.properties[n]);this._featureLookup.set(`${r.typeName?`${r.typeName}__${r.id}`:r.id}`,o),a.push(o)}),a}},be,w=null;function Xi(){return be||(be=ut(()=>import("./lclayout-C72fYnMo.js"),__vite__mapDeps([0,1]),import.meta.url).then(e=>e.l).then(({default:e})=>e({locateFile:t=>lt(`esri/libs/linkchartlayout/${t}`)})).then(e=>{Yt(e)}),be)}function Yt(e){w=e}var Me,Re,le,de;function Wt(e){const t=Object.keys(le).filter(i=>isNaN(parseInt(i,10))).indexOf(e.timeDirection),n=Object.keys(de).filter(i=>isNaN(parseInt(i,10))).indexOf(e.eventsTicksVisualization);return{timeDirection:{value:t>-1?t:le.right},timeBannerUTCOffsetInMinutes:e.timeBannerUTCOffsetInMinutes,eventsTicksVisualization:{value:n>-1?n:de.startAndEnd},showDurationLineForNonZeroDurationEntityEvents:e.showDurationLineForNonZeroDurationEntityEvents,durationLineWidth:e.durationLineWidth,entityPositionAtDurationRatio:e.entityPositionAtDurationRatio,showNonZeroDurationIntervalBounds:e.showNonZeroDurationIntervalBounds,separateTimeOverlaps:e.separateTimeOverlaps,separateTimelineOverlaps:e.separateTimelineOverlaps,moveFirstBends:e.moveFirstBends,secondBendRatio:e.secondBendRatio,lineSeparationMultiplier:e.lineSeparationMultiplier,spaceSeparatedLinesEvenly:e.spaceSeparatedLinesEvenly,useBezierCurves:e.useBezierCurves,separatedLineShapeRatio:e.separatedLineShapeRatio}}function ee(e,t,n,i,a,r){const o=n.length,s=a.length,p=Float64Array.BYTES_PER_ELEMENT,c=Uint32Array.BYTES_PER_ELEMENT,h=Uint8Array.BYTES_PER_ELEMENT,d=16,y=d+o*(h+2*p)+s*(2*c),b=w._malloc(y);try{const I=b+d-b%d,l=I+o*p,N=l+o*p,v=N+s*c,C=v+s*c,z=()=>[w.HEAPF64.subarray(I>>3,(I>>3)+o),w.HEAPF64.subarray(l>>3,(l>>3)+o),w.HEAPU32.subarray(N>>2,(N>>2)+s),w.HEAPU32.subarray(v>>2,(v>>2)+s),w.HEAPU8.subarray(C,C+o)],[G,O,R,A,B]=z();G.set(n),O.set(i),R.set(a),A.set(r),B.set(t);let x=e(o,C,I,l,s,N,v),j=null,F=null;if(x){const f=w.getLayoutLinksTypes(),k=w.getLayoutLinksVerticesEndIndices(),S=w.getLayoutLinksVertices(),$=w.countLayoutLinksVertices();!s||f&&k?$&&!S?x=!1:(j={types:new Uint8Array(w.HEAPU8.subarray(f,f+s)),vertexEndIndex:new Uint32Array(w.HEAPU32.subarray(k>>2,(k>>2)+s)),vertices:new Float64Array(w.HEAPF64.subarray(S>>3,(S>>3)+2*$))},F=w.getAuxiliaryGraphicElements()):x=!1}const[U,H,Q,W,L]=z();return n.set(U),i.set(H),a.set(Q),r.set(W),t.set(L),{success:x,links:j,graphics:F}}finally{w._free(b),w.cleanupLayout()}}(function(e){e[e.None=0]="None",e[e.IsMovable=1]="IsMovable",e[e.IsGeographic=2]="IsGeographic",e[e.IsRoot=4]="IsRoot",e[e.IsOld=8]="IsOld"})(Me||(Me={})),function(e){e[e.Regular=0]="Regular",e[e.Curved=1]="Curved",e[e.Recursive=2]="Recursive"}(Re||(Re={})),function(e){e[e.right=0]="right",e[e.left=1]="left",e[e.top=2]="top",e[e.bottom=3]="bottom"}(le||(le={})),function(e){e[e.none=0]="none",e[e.startOnly=1]="startOnly",e[e.startAndEnd=2]="startAndEnd"}(de||(de={}));const Se=2,$e=1,Ce=-1;var ke,Ae,Oe,xe,je,Fe,qe,Pe,Ge;(function(e){function t(){return w.getMinIdealEdgeLength()}function n(i,a,r,o,s,p=Se,c=$e,h=Ce){return ee((d,y,b,I,l,N,v)=>w.applyForceDirectedLayout(d,y,b,I,l,N,v,p,c,h),i,a,r,o,s)}e.getMinIdealEdgeLength=t,e.apply=n})(ke||(ke={})),function(e){function t(n,i,a,r,o,s=Se,p=$e,c=Ce){return ee((h,d,y,b,I,l,N)=>w.applyCommunityLayout(h,d,y,b,I,l,N,s,p,c),n,i,a,r,o)}e.apply=t}(Ae||(Ae={})),function(e){function t(n,i,a,r,o){return ee(w.applySimpleLayout,n,i,a,r,o)}e.apply=t}(Oe||(Oe={})),function(e){function t(n,i,a,r,o){return ee(w.applyHierarchicalLayout,n,i,a,r,o)}e.apply=t}(xe||(xe={})),function(e){function t(n,i,a,r,o){return ee(w.applyRadialTreeLayout,n,i,a,r,o)}e.apply=t}(je||(je={})),function(e){function t(n,i,a,r,o){return ee(w.applySmartTreeLayout,n,i,a,r,o)}e.apply=t}(Fe||(Fe={})),function(e){function t(n,i,a,r,o,s,p,c,h,d,y){const b={timeDirection:le.right,timeBannerUTCOffsetInMinutes:0,eventsTicksVisualization:de.startAndEnd,showDurationLineForNonZeroDurationEntityEvents:!0,durationLineWidth:5,entityPositionAtDurationRatio:1,showNonZeroDurationIntervalBounds:!1,separateTimeOverlaps:!0,separateTimelineOverlaps:!0,moveFirstBends:!0,secondBendRatio:.3,lineSeparationMultiplier:1,spaceSeparatedLinesEvenly:!1,useBezierCurves:!1,separatedLineShapeRatio:0};return ee((I,l,N,v,C,z,G)=>{if(r.length!==I||o.length!==I||c.length!==C||h.length!==C)return!1;const O=Float64Array.BYTES_PER_ELEMENT,R=16,A=w._malloc(R+I*O),B=w._malloc(R+I*O),x=w._malloc(R+C*O),j=w._malloc(R+C*O),F=A+R-A%R,U=B+R-B%R,H=x+R-x%R,Q=j+R-j%R;try{w.HEAPF64.subarray(F>>3,(F>>3)+I).set(r),w.HEAPF64.subarray(U>>3,(U>>3)+I).set(o),w.HEAPF64.subarray(H>>3,(H>>3)+C).set(c),w.HEAPF64.subarray(Q>>3,(Q>>3)+C).set(h);const W=Wt(Object.assign(b,y));return w.applyChronologicalLayout(I,l,N,v,F,U,C,z,G,H,Q,d,W)}finally{w._free(A),w._free(B),w._free(x),w._free(j)}},n,i,a,s,p)}e.apply=t}(qe||(qe={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(Pe||(Pe={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(Ge||(Ge={}));var he;(function(e){e.ELEMENTUID="ELEMENTUID",e.TYPENAME="TYPENAME"})(he||(he={}));he.ELEMENTUID,he.TYPENAME;var Be,Ue;(function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME"})(Be||(Be={})),function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME",e[e.FROMUID=2]="FROMUID",e[e.TOUID=3]="TOUID"}(Ue||(Ue={}));var He,Qe,Je,ae;(function(e){e[e.featureResult=0]="featureResult",e[e.countResult=1]="countResult",e[e.idsResult=2]="idsResult"})(He||(He={})),function(e){e[e.upperLeft=0]="upperLeft",e[e.lowerLeft=1]="lowerLeft"}(Qe||(Qe={})),function(e){e[e.sqlTypeBigInt=0]="sqlTypeBigInt",e[e.sqlTypeBinary=1]="sqlTypeBinary",e[e.sqlTypeBit=2]="sqlTypeBit",e[e.sqlTypeChar=3]="sqlTypeChar",e[e.sqlTypeDate=4]="sqlTypeDate",e[e.sqlTypeDecimal=5]="sqlTypeDecimal",e[e.sqlTypeDouble=6]="sqlTypeDouble",e[e.sqlTypeFloat=7]="sqlTypeFloat",e[e.sqlTypeGeometry=8]="sqlTypeGeometry",e[e.sqlTypeGUID=9]="sqlTypeGUID",e[e.sqlTypeInteger=10]="sqlTypeInteger",e[e.sqlTypeLongNVarchar=11]="sqlTypeLongNVarchar",e[e.sqlTypeLongVarbinary=12]="sqlTypeLongVarbinary",e[e.sqlTypeLongVarchar=13]="sqlTypeLongVarchar",e[e.sqlTypeNChar=14]="sqlTypeNChar",e[e.sqlTypeNVarChar=15]="sqlTypeNVarChar",e[e.sqlTypeOther=16]="sqlTypeOther",e[e.sqlTypeReal=17]="sqlTypeReal",e[e.sqlTypeSmallInt=18]="sqlTypeSmallInt",e[e.sqlTypeSqlXml=19]="sqlTypeSqlXml",e[e.sqlTypeTime=20]="sqlTypeTime",e[e.sqlTypeTimestamp=21]="sqlTypeTimestamp",e[e.sqlTypeTimestamp2=22]="sqlTypeTimestamp2",e[e.sqlTypeTinyInt=23]="sqlTypeTinyInt",e[e.sqlTypeVarbinary=24]="sqlTypeVarbinary",e[e.sqlTypeVarchar=25]="sqlTypeVarchar"}(Je||(Je={})),function(e){e[e.OID_ARRAY=0]="OID_ARRAY",e[e.GLOBALID_ARRAY=1]="GLOBALID_ARRAY",e[e.STRING_ARRAY=2]="STRING_ARRAY",e[e.IDENTIFIER_ARRAY=3]="IDENTIFIER_ARRAY"}(ae||(ae={}));function zt(e){if(!e.spatialReference.isWGS84)throw new X("knowledge-graph:layer-support-utils","The extentToInBoundsRings function only supports WGS84 spatial references.");return e.clone().normalize().map(t=>[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]])}async function en(e,t){var r,o;const n=[],i=new Map,a=[];if((r=t.dataModel)!=null&&r.relationshipTypes)for(const s of t.dataModel.relationshipTypes)s.name&&i.set(s.name,[]);for(const s of e)i.has(s.typeName)&&((o=i.get(s.typeName))==null||o.push(s.id));for(const[s,p]of i){if(p.length<1)continue;const c=new te({openCypherQuery:`MATCH (n)-[r:${s}]->(m) WHERE id(r) in $ids RETURN id(n), labels(n)[0], id(m), labels(m)[0]`,bindParameters:{ids:p}});a.push(re(t,c).then(async h=>{const d=h.resultRowsStream.getReader();for(;;){const{done:y,value:b}=await d.read();if(y)break;for(const I of b)n.push({id:I[0],typeName:I[1]}),n.push({id:I[2],typeName:I[3]})}}))}return await Promise.all(a),n}async function tn(e,t){t??(t=!1);const n={generateAllSublayers:t,namedTypeDefinitions:new Map};return await Kt(e).then(i=>{ei(i,n)}),n}async function nn(e){const t=await ze(),n=new t.MapOfObjectIdentifierSets;Zt(n,t,e);const i=new t.MapOfObjectIdentifierSetsEncoder;try{i.set_map_of_identifier_sets(n),i.encode();const a=i.get_encoding_result();if(a.error.error_code!==0)throw new X("knowledge-graph:layer-support-utils",a.error.error_message);const r=structuredClone(a.get_byte_buffer());return i.delete(),r}finally{n.delete()}}function Zt(e,t,n){for(const[i,a]of n.namedTypeDefinitions){if(!a.members||a.useAllData)continue;const r=a.members.keys();let o=!1,s=!0;const p=new t.ObjectIdArray,c=new t.StringArray,h=new t.GlobalIdArray,d=new t.IdentifierArray,y=new t.ObjectIdentifierSet;for(const b of r)s&&(o=!isNaN(Number(b)),s=!1),o?p.add_objectid(Number(b)):(c.add_string(b),h.add_globalid(b)),d.add_identifier(b);y.set_oid_array(p),y.set_string_array(c),y.set_globalid_array(h),y.set_identifier_array(d),p.delete(),c.delete(),h.delete(),d.delete(),e.put_identifier_set(i,y),y.delete()}return e}async function Kt(e){const t=await dt(e,{responseType:"array-buffer"}),n=await t.data;return Xt(new Uint8Array(n))}async function Xt(e){const t=new(await ze()).MapOfObjectIdentifierSetsDecoder,n=t.decode(new Uint8Array(e)),i=new Map;if(n.error_code!==0)throw new X("knowledge-graph:layer-support-utils",n.error_message);const a=t.get_map_of_identifier_sets(),r=a.keys,o=r.size();for(let s=0;s<o;s++){const p=r.get(s),c=a.query_identifier_set(p),h=[];if(c.id_array_type.value===ae.GLOBALID_ARRAY){const d=c.get_globalid_array(),y=d.count();for(let b=0;b<y;b++)h.push(d.get_globalid_at(b))}else if(c.id_array_type.value===ae.IDENTIFIER_ARRAY){const d=c.get_identifier_array(),y=d.count();for(let b=0;b<y;b++)h.push(d.get_identifier_at(b).toString())}else if(c.id_array_type.value===ae.STRING_ARRAY){const d=c.get_string_array(),y=d.count();for(let b=0;b<y;b++)h.push(d.get_string_at(b))}else{if(c.id_array_type.value!==ae.OID_ARRAY)throw new X("knowledge-graph:layer-support-utils","Tried to encode an unexpected ID Array type.");{const d=c.get_oid_array(),y=d.count();for(let b=0;b<y;b++)h.push(d.get_objectid_at(b).toString())}}i.set(p,h)}return t.delete(),i}function ei(e,t){for(const[n,i]of e){const a=Z(t.namedTypeDefinitions,n,()=>({useAllData:!1,members:new Map}));for(const r of i)a.members.has(r)||a.members.set(r,{id:r})}return t}let J=class extends et{constructor(e){var n,i,a;super(e),this._processingCacheUpdatesLookup=new Map,this.knowledgeGraph=null,this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.relationshipConnectionsLookup=new Map,this.memberIdTypeLookup=new Map;const t=new Map;(n=e.knowledgeGraph.dataModel.entityTypes)==null||n.forEach(r=>{var o,s;r.name&&(t.set(r.name,"entity"),this._processingCacheUpdatesLookup.set(r.name,[]),e.inclusionModeDefinition&&!((o=e.inclusionModeDefinition)!=null&&o.generateAllSublayers)||this.entityTypeNames.add(r.name),(s=r.properties)==null||s.forEach(p=>{p.geometryType&&p.geometryType!=="esriGeometryNull"&&this.geographicLookup.set(r.name,{name:p.name??"",geometryType:p.geometryType})}))}),(i=e.knowledgeGraph.dataModel.relationshipTypes)==null||i.forEach(r=>{var o,s;r.name&&(t.set(r.name,"relationship"),this._processingCacheUpdatesLookup.set(r.name,[]),e.inclusionModeDefinition&&!((o=e.inclusionModeDefinition)!=null&&o.generateAllSublayers)||this.relationshipTypeNames.add(r.name),(s=r.properties)==null||s.forEach(p=>{p.geometryType&&p.geometryType!=="esriGeometryNull"&&this.geographicLookup.set(r.name,{name:p.name??"",geometryType:p.geometryType})}))}),(a=e.inclusionModeDefinition)==null||a.namedTypeDefinitions.forEach((r,o)=>{var p,c;if(t.get(o)==="entity")this.entityTypeNames.add(o);else{if(t.get(o)!=="relationship")return ye.getLogger(this).warn(`A named type, ${o}, was in the inclusion list that wasn't in the data model and will be removed`),void((p=e.inclusionModeDefinition)==null?void 0:p.namedTypeDefinitions.delete(o));this.relationshipTypeNames.add(o)}const s=new Map;(c=r.members)==null||c.forEach(h=>{Z(this.memberIdTypeLookup,h.id,()=>new Set).add(o);const d=this.getById(h.id);d&&s.set(h.id,d)}),this.sublayerCaches.set(o,s)})}addToLayer(e){e.forEach(({typeName:t,id:n})=>{if(!this.inclusionModeDefinition)throw new X("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){const i=this.inclusionModeDefinition.namedTypeDefinitions.get(t);i.members||(i.members=new Map),i.members.set(n,{id:n}),Z(this.memberIdTypeLookup,n,()=>new Set).add(t)}}else{const i=new Map;i.set(n,{id:n}),this.inclusionModeDefinition.namedTypeDefinitions.set(t,{useAllData:!1,members:i}),Z(this.memberIdTypeLookup,n,()=>new Set).add(t)}})}getById(e){return Te.getInstance().readFromStoreById(e)}async getData(e,t,n){var a,r;if(t.objectType.name&&((a=this.inclusionModeDefinition)!=null&&a.namedTypeDefinitions)&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let i;if(i=e||new oe({where:"1=1",outFields:["*"]}),t.parentCompositeLayer.type==="link-chart"){const o=t.parentCompositeLayer,s=this._processingCacheUpdatesLookup.get(t.objectType.name??""),p=i.outFields;p&&p.length===1&&p[0]===V&&i.where==="1=1"||await Promise.all(s??[]);const c=this.sublayerCaches.has(t.objectType.name??"")?Array.from((r=this.sublayerCaches.get(t.objectType.name))==null?void 0:r.values()):[],h=[];return c.forEach(d=>{if(this.relationshipTypeNames.has(t.objectType.name)){d.geometry=o.relationshipLinkChartDiagramLookup.get(d.attributes[t.objectIdField]);const y=this.memberIdTypeLookup.get(d.attributes[Ee]),b=this.memberIdTypeLookup.get(d.attributes[Ie]),I=this._isEndEntitySpatial(y,d,Ee),l=this._isEndEntitySpatial(b,d,Ie);d.attributes[pe]=Number(I&&l)}else{d.geometry=o.entityLinkChartDiagramLookup.get(d.attributes[t.objectIdField]);const y=this.geographicLookup.get(t.objectType.name);y&&d.attributes[y.name]?d.attributes[pe]=1:d.attributes[pe]=0}d.attributes[Ze]=d.geometry,h.push(d)}),h}return this.retrieveDataFromService(i,t,n)}async getConnectedRecordIds(e,t){const n=[];let i="";const a=[],r=new Map;if(e.forEach(h=>{var d;if(this.memberIdTypeLookup.has(h))for(const y of this.memberIdTypeLookup.get(h)){if(!this.entityTypeNames.has(y))return;r.has(y)?(d=r.get(y))==null||d.push(h):r.set(y,[h])}}),t&&(t==null?void 0:t.length)!==0){for(const h of t)i=i+h+"|";i=i.slice(0,-1)}const o={};let s="",p=-1;for(const[h,d]of r){p++,p!==0&&(s+=" UNION ");const y=`${h}_ids`;o[y]=d,s+=t&&(t==null?void 0:t.length)!==0?`MATCH (n:${h}) WHERE id(n) IN $${y} WITH n MATCH (n)-[r:${i}]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`:`MATCH (n:${h}) WHERE id(n) IN $${y} WITH n MATCH (n)-[r]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`}if(!s)return n;const c=new Promise(h=>{(async()=>{const d=(await re(this.knowledgeGraph,new te({openCypherQuery:s,bindParameters:o}))).resultRowsStream.getReader();try{for(;;){const{done:y,value:b}=await d.read();if(y)break;for(let I=0;I<b.length;I++){const l=b[I];n.push({id:l[0],typeName:l[1]}),n.push({id:l[2],typeName:l[3]})}}}catch(y){if(y.name!=="AbortError")throw y;ye.getLogger(this).info("Request aborted as expected")}})().then(()=>{h()})});return a.push(c),this.refreshCacheContent(),await Promise.all(a),n}async getRelationshipsBetweenNodes(e,t){const n=[],i="MATCH (n)-[r]->(m) WHERE id(n) IN $nodeIds AND id(m) in $nodeIds AND NOT id(r) IN $relationshipExclusionIds return id(r), type(r)",a=(await re(this.knowledgeGraph,new te({openCypherQuery:i,bindParameters:{nodeIds:e,relationshipExclusionIds:t}}))).resultRowsStream.getReader();try{for(;;){const{done:r,value:o}=await a.read();if(r)break;for(let s=0;s<o.length;s++){const p=o[s];n.push({id:p[0],typeName:p[1]})}}}catch(r){if(r.name!=="AbortError")throw r;ye.getLogger(this).info("Request aborted as expected")}return n}async getRelationshipsFromNodes(e,t,n){const i=[],a="MATCH (n)-[r]-(m) WHERE id(n) IN $targetEntityIds AND id(m) in $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds return id(r), type(r)",r=(await re(this.knowledgeGraph,new te({openCypherQuery:a,bindParameters:{targetEntityIds:e,possibleConnectionEntityIds:t,relationshipExclusionIds:n}}))).resultRowsStream.getReader();try{for(;;){const{done:o,value:s}=await r.read();if(o)break;for(let p=0;p<s.length;p++){const c=s[p];i.push({id:c[0],typeName:c[1]})}}}catch(o){if(o.name!=="AbortError")throw o;ye.getLogger(this).info("Request aborted as expected")}return i}async refreshCacheContent(e,t,n,i=!0){var p,c,h,d,y,b,I;const a=Te.getInstance(),r=[],o=new Map,s=new Map;(p=this.knowledgeGraph.dataModel.entityTypes)==null||p.forEach(l=>{l.name&&s.set(l.name,l)}),(c=this.knowledgeGraph.dataModel.relationshipTypes)==null||c.forEach(l=>{l.name&&s.set(l.name,l)}),e||this.inclusionModeDefinition?e?e.forEach(l=>{var N;if(this.memberIdTypeLookup.has(l))for(const v of this.memberIdTypeLookup.get(l))o.has(v)?(N=o.get(v))==null||N.push(l):o.set(v,[l])}):(d=(h=this.inclusionModeDefinition)==null?void 0:h.namedTypeDefinitions)==null||d.forEach((l,N)=>{l.useAllData?o.set(N,null):l.members&&l.members.forEach(v=>{var C;o.has(N)&&o.get(N)!==null?(C=o.get(N))==null||C.push(v.id):o.set(N,[v.id])})}):((y=this.knowledgeGraph.dataModel.entityTypes)==null||y.forEach(l=>{l.name&&o.set(l.name,null)}),(b=this.knowledgeGraph.dataModel.entityTypes)==null||b.forEach(l=>{l.name&&o.set(l.name,null)}));for(const[l,N]of o){const v=new Promise(C=>{(async()=>{var j,F,U,H,Q,W,L;const G=new Set,O=[];let R,A="",B=!1;if(t||((F=(j=s.get(l))==null?void 0:j.properties)==null||F.forEach(f=>{f.name&&G.add(f.name)})),n&&this.geographicLookup.has(l)){const f=(U=this.geographicLookup.get(l))==null?void 0:U.name;f&&G.add(f)}if(this.entityTypeNames.has(l))A=`MATCH (n:${l}) ${N?"WHERE id(n) IN $ids ":""}return ID(n)`,G.forEach(f=>{A+=`, n.${f}`,O.push(f)});else{if(!this.relationshipTypeNames.has(l))throw new X("knowledge-graph:layer-data-manager",`The graph type of ${l} could not be determined. Was this type set in the KG data model and inclusion definition?`);B=!0,A=`MATCH ()-[n:${l}]->() ${N?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,G.forEach(f=>{A+=`, n.${f}`,O.push(f)})}R=new te(N?{openCypherQuery:A,bindParameters:{ids:N}}:{openCypherQuery:A});const x=(await re(this.knowledgeGraph,R)).resultRowsStream.getReader();for(;;){const{done:f,value:k}=await x.read();if(f)break;const S=[];for(let D=0;D<k.length;D++){const E=k[D];let g=0,Y=0;const M={properties:{}};for(M.id=E[g],g++,Y++,B&&(M.originId=E[g],g++,Y++,M.destinationId=E[g],g++,Y++,Z(this.nodeConnectionsLookup,M.originId,()=>new Set).add(M.id),Z(this.nodeConnectionsLookup,M.destinationId,()=>new Set).add(M.id),Z(this.relationshipConnectionsLookup,M.id,()=>[M.originId,M.destinationId]));g<E.length;g++)M.properties[O[g-Y]]=E[g];S.push(M)}const $=a.writeToStore(S,V,(H=this.geographicLookup.get(l))==null?void 0:H.name);this.sublayerCaches.has(l)||this.sublayerCaches.set(l,new Map),i&&!((Q=this.inclusionModeDefinition)!=null&&Q.namedTypeDefinitions.has(l))&&((W=this.inclusionModeDefinition)==null||W.namedTypeDefinitions.set(l,{useAllData:!1,members:new Map})),i&&!((L=this.inclusionModeDefinition)!=null&&L.namedTypeDefinitions.get(l).members)&&(this.inclusionModeDefinition.namedTypeDefinitions.get(l).members=new Map);const _=this.sublayerCaches.get(l);$.forEach(D=>{var E,g;_==null||_.set(D.attributes[V],D),i&&!((E=this.inclusionModeDefinition)!=null&&E.namedTypeDefinitions.get(l).members.has(D.attributes[V]))&&((g=this.inclusionModeDefinition)==null||g.namedTypeDefinitions.get(l).members.set(D.attributes[V],{id:D.attributes[V]}),Z(this.memberIdTypeLookup,D.attributes[V],()=>new Set).add(l))})}})().then(()=>{C(null)})});r.push(v),(I=this._processingCacheUpdatesLookup.get(l))==null||I.push(v)}await Promise.all(r)}removeFromLayer(e){var i,a,r;const t=new Set,n=new Set(e.map(o=>o.id));for(const o of e)t.add(o.typeName),((i=this.memberIdTypeLookup.get(o.id))==null?void 0:i.size)===1?this.memberIdTypeLookup.delete(o.id):(a=this.memberIdTypeLookup.get(o.id))==null||a.delete(o.typeName),(r=this.inclusionModeDefinition)==null||r.namedTypeDefinitions.forEach((s,p)=>{var c;p===o.typeName&&((c=s.members)!=null&&c.has(o.id))&&s.members.delete(o.id)});t.forEach(o=>{var s;(s=this.sublayerCaches.get(o))==null||s.forEach((p,c)=>{var h;n.has(c)&&((h=this.sublayerCaches.get(o))==null||h.delete(c))})})}async retrieveDataFromService(e,t,n){var I,l,N,v,C,z,G,O,R,A,B,x,j,F,U,H,Q,W;const i=Te.getInstance(),a=new Set,r=[];let o,s="",p=[];const c=t.graphType==="relationship",h=(N=(l=(I=this.inclusionModeDefinition)==null?void 0:I.namedTypeDefinitions)==null?void 0:l.get(t.objectType.name))==null?void 0:N.useAllData,d=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name);let y=!h&&d?Array.from(d).sort():null;if((z=(C=(v=this.inclusionModeDefinition)==null?void 0:v.namedTypeDefinitions)==null?void 0:C.get(t.objectType.name))!=null&&z.useAllData)(R=(O=(G=this.inclusionModeDefinition)==null?void 0:G.namedTypeDefinitions)==null?void 0:O.get(t.objectType.name))!=null&&R.useAllData&&e.objectIds!=null&&(y=e.objectIds);else if(e.objectIds!=null&&y&&y.length>0){const L=e.objectIds;e.objectIds=y.filter(f=>L.includes(f))}else if(e.objectIds!=null)y=e.objectIds;else{if((A=this.inclusionModeDefinition)!=null&&A.namedTypeDefinitions.has(t.objectType.name)&&(!((B=this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name))!=null&&B.members)||((j=(x=this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name))==null?void 0:x.members)==null?void 0:j.size)<1))return e.objectIds=[],[];e.objectIds=y}if(e.outFields!=null){const L=e.outFields;L.includes("*")?t.fields.forEach(f=>{a.add(f.name)}):L.forEach(f=>{f!==V&&f!==t.geometryFieldName&&a.add(f)})}if(e.geometry!=null){const L=e.geometry;let f;const k=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,S=k==null?void 0:k.spatialReference,$=(F=k==null?void 0:k.serviceCapabilities)==null?void 0:F.geometryCapabilities;let _=$==null?void 0:$.geometryMaxBoundingRectangleSizeX,D=$==null?void 0:$.geometryMaxBoundingRectangleSizeY;if(L.type==="point"){let E=L;(U=E.spatialReference)!=null&&U.isWGS84||(await we(E.spatialReference,K),E=ce(E,K)),f=new me({spatialReference:K,xmin:E.x-1e-4,ymin:E.y-1e-4,xmax:E.x+1e-4,ymax:E.y+1e-4})}else(H=L==null?void 0:L.extent)!=null&&H.spatialReference&&!((Q=L.spatialReference)!=null&&Q.isWGS84)?(await we(L.extent.spatialReference,K),f=ce(L.extent,K)):f=L.extent;if(_&&D&&S){if(S.wkid!==4326){const E=new me({spatialReference:S,xmax:_,ymax:D}),g=ce(E,K);_=g.xmax,D=g.ymax}if(f.xmax-f.xmin>_)throw new X("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${_}° latitude, limit exceeded`);if(f.ymax-f.ymin>D)throw new X("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${D}° longitude, limit exceeded`)}if(e.where!=null&&e.where!=="1=1"){const E=await Le(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach(g=>{E.fieldNames.includes(g.name)&&a.add(g.name)})}s=c?`Match ()-[n:${t.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${t.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n)`,t.geometryFieldName&&a.add(t.geometryFieldName),a.forEach(E=>{s+=`, n.${E}`,r.push(E)}),o=new te({openCypherQuery:s,bindParameters:{param_filter_geom:new We({rings:zt(f)})}})}else{let L="";if(e.where!=null&&e.where!=="1=1"){const S=await Le(e.where,t.fieldsIndex);t.fields.forEach(g=>{S.fieldNames.includes(g.name)&&a.add(g.name)});const $=new Set(["column-reference","string","number","binary-expression"]),_=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]);let D=!1;const E=g=>{if(g.type==="column-reference")return`n.${g.column}`;if(g.type==="string")return`'${g.value}'`;if(g.type==="number")return`${g.value}`;if(g.type==="binary-expression"&&$.has(g.left.type)&&$.has(g.right.type)&&_.has(g.operator))return`${E(g.left)} ${g.operator} ${E(g.right)}`;if(g.type==="binary-expression"&&g.operator==="LIKE"){let Y="";if(g.left.type==="function"&&g.left.args.value[0].type==="column-reference")Y+=`lower(n.${g.left.args.value[0].column})`;else{if(g.left.type!=="column-reference")return D=!0,"";Y+=`lower(n.${g.left.column})`}if(Y+=" CONTAINS (",g.right.type!=="string")return D=!0,"";{let M=g.right.value;M.charAt(0)==="%"&&(M=M.slice(1)),M.charAt(M.length-1)==="%"&&(M=M.slice(0,-1)),Y+=`'${M.toLowerCase()}')`}return Y}return D=!0,""};L=E(S.parseTree),D&&(L="")}let f="";f=c?`Match ()-[n:${t.objectType.name}]->()`:`Match (n:${t.objectType.name})`;let k=!1;y&&(k=!0,f+=" WHERE ID(n) IN $ids"),L&&(f+=k?" AND":" WHERE",f+=` ${L}`),f+=" return ID(n)",c&&(f+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&a.add(t.geometryFieldName),a.forEach(S=>{f+=`, n.${S}`,r.push(S)}),o=new te(y?{openCypherQuery:f,bindParameters:{ids:y}}:{openCypherQuery:f})}const b=(await re(t.parentCompositeLayer.dataManager.knowledgeGraph,o,n)).resultRowsStream.getReader();for(;;){const{done:L,value:f}=await b.read();if(L)break;const k=[];for(let S=0;S<f.length;S++){const $=f[S];let _=0,D=0;const E={properties:{}};for(E.id=$[_],_++,D++,c&&(E.originId=$[_],_++,D++,E.destinationId=$[_],_++,D++);_<$.length;_++)E.properties[r[_-D]]=$[_];k.push(E)}p=p.concat(i.writeToStore(k,V,(W=t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name))==null?void 0:W.name))}return p}_isEndEntitySpatial(e,t,n){var i;for(const a of e??[])if(this.entityTypeNames.has(a)){const r=this.geographicLookup.get(a),o=r&&((i=this.sublayerCaches.get(a))==null?void 0:i.get(t.attributes[n]));if(r&&(o!=null&&o.attributes[r.name]))return!0}return!1}};u([m()],J.prototype,"knowledgeGraph",void 0),u([m()],J.prototype,"inclusionModeDefinition",void 0),u([m()],J.prototype,"entityTypeNames",void 0),u([m()],J.prototype,"relationshipTypeNames",void 0),u([m()],J.prototype,"geographicLookup",void 0),u([m()],J.prototype,"sublayerCaches",void 0),u([m()],J.prototype,"nodeConnectionsLookup",void 0),u([m()],J.prototype,"relationshipConnectionsLookup",void 0),u([m()],J.prototype,"memberIdTypeLookup",void 0),J=u([Ne("esri.layers.knowledgeGraph.KnowledgeGraphLayerDataManager")],J);const Ve=It(),ti=e=>{let t=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return u([m(Ve.fields)],t.prototype,"fields",void 0),u([m(Ve.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=u([Ne("esri.layers.knowledgeGraph.KnowledgeGraphSublayerBase")],t),t};function P(e){if(!e.json)return e;e.json.write=Ye(e.json.write);const t=e.json.origins;if(!t)return e;let n;for(n in t){const i=t[n];i&&(i.write=Ye(i.write))}return e}function Ye(e){return typeof e=="object"&&e?(e.enabled!==!1&&(e.overridePolicy=ii(e)),e):e===!0?se():e}function ii(e){const{target:t,writer:n,overridePolicy:i,...a}=e;return function(r,o){const s=Ke.call(this,r,o);return s.enabled?{...a,...s}:s}}function se(){return{overridePolicy:Ke}}function Ke(e,t){const n=!!this.geometryType;let i={enabled:n};return n&&(i={...i,...Xe.call(this,e,t)}),i}function Xe(e,t){return{ignoreOrigin:this.originIdOf(t)>tt.DEFAULTS}}let T=class extends ti(Mt(_t(Nt(St(At(kt(Ct(ht(Tt))))))))){constructor(e){super(e),this.blendMode="normal",this.capabilities=Et(!1,!1),this.charts=null,this.definitionExpression=null,this.displayField="",this.effect=null,this.elevationInfo=null,this.featureEffect=null,this.graphType=null,this.labelsVisible=!0,this.labelingInfo=null,this.layerType=null,this.legendEnabled=!0,this.maxScale=0,this.minScale=0,this.objectIdField=V,this.objectType=null,this.opacity=1,this.orderBy=null,this.parent=null,this.parentCompositeLayer=null,this.persistenceEnabled=!0,this.popupEnabled=!0,this.popupTemplate=null,this.refreshInterval=0,this.source={openPorts:()=>this.load().then(()=>{const t=new MessageChannel;return new ft(t.port1,{channel:t,client:{queryFeatures:(n,i={})=>{const a=oe.fromJSON(n);return this.queryFeaturesJSON(a,i)}}}),[t.port2]})},this.type="knowledge-graph-sublayer",this.useViewTime=!0,this.visible=!0}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(e){const t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}get fields(){var t,n;const e=[];return(n=(t=this.objectType)==null?void 0:t.properties)==null||n.forEach(i=>{const a=i.fieldType==="esriFieldTypeOID"?"esriFieldTypeInteger":i.fieldType;e.push(ue.fromJSON({name:i.name,type:a,alias:i.alias,defaultValue:i.defaultValue,editable:i.editable,nullable:i.nullable}))}),e.push(ue.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1}),ue.fromJSON({name:_e,type:"esriFieldTypeInteger",alias:_e,editable:!1}),ue.fromJSON({name:pe,type:"esriFieldTypeInteger",alias:pe,editable:!1})),e}get geometryType(){var n,i,a;if(((n=this.parentCompositeLayer)==null?void 0:n.type)==="link-chart")return this.graphType==="relationship"?"polyline":"point";const e=(a=this.parentCompositeLayer)==null?void 0:a.dataManager.geographicLookup.get((i=this.objectType)==null?void 0:i.name),t=e==null?void 0:e.geometryType;return t&&t!=="esriGeometryNull"?ne.fromJSON(t):null}get geometryFieldName(){var t,n,i;if(((t=this.parentCompositeLayer)==null?void 0:t.type)==="link-chart")return Ze;const e=(i=this.parentCompositeLayer)==null?void 0:i.dataManager.geographicLookup.get((n=this.objectType)==null?void 0:n.name);return(e==null?void 0:e.name)??null}get graphTypeName(){var e;return(e=this.objectType)==null?void 0:e.name}get hasM(){var i,a,r,o;const e=(a=this.parentCompositeLayer)==null?void 0:a.dataManager.geographicLookup.get((i=this.objectType)==null?void 0:i.name),t=e==null?void 0:e.name,n=t?(o=(r=this.objectType)==null?void 0:r.properties)==null?void 0:o[t]:null;return(n==null?void 0:n.hasM)??!1}get hasZ(){var i,a,r,o;const e=(a=this.parentCompositeLayer)==null?void 0:a.dataManager.geographicLookup.get((i=this.objectType)==null?void 0:i.name),t=e==null?void 0:e.name,n=t?(o=(r=this.objectType)==null?void 0:r.properties)==null?void 0:o[t]:null;return(n==null?void 0:n.hasZ)??!1}set renderer(e){it(e,this.fieldsIndex),this._set("renderer",e)}get renderer(){var e;return this._isOverridden("renderer")?this._get("renderer"):((e=this.parentCompositeLayer)==null?void 0:e.type)==="link-chart"?this.graphType==="relationship"?fe(ge(ne.toJSON("polyline")).renderer):fe(ge(ne.toJSON("point")).renderer):fe(ge(ne.toJSON(this.geometryType)).renderer)}get spatialReference(){var e,t,n,i;return((i=(n=(t=(e=this.parentCompositeLayer)==null?void 0:e.dataManager)==null?void 0:t.knowledgeGraph)==null?void 0:n.dataModel)==null?void 0:i.spatialReference)??ot.WGS84}set timeInfo(e){this._set("timeInfo",e)}get title(){return this._isOverridden("title")?this._get("title"):this.graphTypeName}set title(e){this._set("title",e)}writeTitle(e,t){t.title=e??"Layer"}createPopupTemplate(e){return Jt(this,e)}createQuery(){return new oe({where:"1=1",outFields:["*"]})}getField(e){for(let t=0;t<this.fields.length;t++)if(this.fields[t].name===e)return this.fields[t];return null}getFieldDomain(e,t){return null}async queryFeatures(e,t){const{resolvedQuery:n,queryEngine:i}=await this._setupQueryObjects(e),a=Qt.fromJSON(await i.executeQuery(n.toJSON(),t==null?void 0:t.signal));return a.features.forEach(r=>{r.sourceLayer=this}),a}async queryFeaturesJSON(e,t){const{resolvedQuery:n,queryEngine:i}=await this._setupQueryObjects(e);return await i.executeQuery(n.toJSON(),t==null?void 0:t.signal)}async queryFeatureCount(e,t){const{resolvedQuery:n,queryEngine:i}=await this._setupQueryObjects(e);return i.executeQueryForCount(n.toJSON(),t==null?void 0:t.signal)}async queryExtent(e={},t){var s,p,c,h;const n={...e,returnGeometry:!0},{resolvedQuery:i,queryEngine:a}=await this._setupQueryObjects(n),r=await a.executeQueryForExtent(i.toJSON(),t==null?void 0:t.signal);let o;return o=((s=r.extent)==null?void 0:s.xmin)!=null&&((p=r.extent)==null?void 0:p.xmax)!=null&&((c=r.extent)==null?void 0:c.ymin)!=null&&((h=r.extent)==null?void 0:h.ymax)!=null?new me(r.extent):new me,{count:r.count,extent:o}}async queryObjectIds(e,t){const n=oe.from(e);let i;if(this.parentCompositeLayer.type==="link-chart"&&this._cachedQueryEngine)i=this._cachedQueryEngine;else{const a=await this.parentCompositeLayer.dataManager.getData(n,this,t);i=this.loadQueryEngine(a)}return i.executeQueryForIds(n.toJSON(),t==null?void 0:t.signal)}loadQueryEngine(e){var i;const t=new bt({geometryType:ne.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),n=new wt({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:ne.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:(i=this.timeInfo)==null?void 0:i.toJSON(),featureStore:t});return n.featureStore.addMany(e),n}async refreshCachedQueryEngine(){const e=await this.parentCompositeLayer.dataManager.getData(new oe({where:"1=1",outFields:[V]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)}load(e){return this.addResolvingPromise(this.parent.load(e).then(()=>{nt(this.timeInfo,this.fieldsIndex)})),Promise.resolve(this)}async _setupQueryObjects(e,t){var r;const n=oe.from(e),i=n.geometry;let a;if(i&&!((r=i.spatialReference)!=null&&r.isWGS84)&&(await we(i.spatialReference,K),n.geometry=ce(i instanceof We||i instanceof rt||i instanceof at?i:i.extent,K)),this.parentCompositeLayer.type==="link-chart"&&this._cachedQueryEngine)a=this._cachedQueryEngine;else{const o=await this.parentCompositeLayer.dataManager.getData(n,this,t);a=this.loadQueryEngine(o)}return{resolvedQuery:n,queryEngine:a}}};u([m(P(q(Lt)))],T.prototype,"blendMode",void 0),u([m()],T.prototype,"capabilities",void 0),u([m({json:{origins:{"web-scene":{write:!1}},write:se()}})],T.prototype,"charts",void 0),u([m({readOnly:!0})],T.prototype,"defaultPopupTemplate",null),u([m({type:String,json:{origins:{service:{read:!1}},name:"layerDefinition.definitionExpression",write:{ignoreOrigin:!0}}})],T.prototype,"definitionExpression",void 0),u([m()],T.prototype,"displayField",void 0),u([m(P(q(Dt)))],T.prototype,"effect",void 0),u([m()],T.prototype,"elevationInfo",void 0),u([m(P(q(vt)))],T.prototype,"featureEffect",void 0),u([m(P(q(Rt)))],T.prototype,"featureReduction",null),u([m()],T.prototype,"fields",null),u([m()],T.prototype,"geometryType",null),u([m()],T.prototype,"geometryFieldName",null),u([m({type:["entity","relationship"],nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],T.prototype,"graphType",void 0),u([m({type:String,nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],T.prototype,"graphTypeName",null),u([m()],T.prototype,"hasM",null),u([m()],T.prototype,"hasZ",null),u([m({type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],T.prototype,"id",void 0),u([m(P(q(xt)))],T.prototype,"labelsVisible",void 0),u([m({type:[Bt],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:Ut,write:se()}})],T.prototype,"labelingInfo",void 0),u([m({readOnly:!0,json:{read:!1,write:{writer(e,t){switch(this.parentCompositeLayer.type){case"link-chart":t.layerType="LinkChartSubLayer";break;case"knowledge-graph":t.layerType=this.geometryType?"KnowledgeGraphSubLayer":"KnowledgeGraphSubTable"}},isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],T.prototype,"layerType",void 0),u([m(P(q(jt)))],T.prototype,"legendEnabled",void 0),u([m(P(q(Ft)))],T.prototype,"maxScale",void 0),u([m(P(q(qt)))],T.prototype,"minScale",void 0),u([m()],T.prototype,"objectIdField",void 0),u([m()],T.prototype,"objectType",void 0),u([m(P(q(Pt)))],T.prototype,"opacity",void 0),u([m(P(q($t)))],T.prototype,"orderBy",void 0),u([m({clonable:!1})],T.prototype,"parent",void 0),u([m()],T.prototype,"parentCompositeLayer",void 0),u([m(P(q(Gt)))],T.prototype,"popupEnabled",void 0),u([m({type:ct,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],T.prototype,"popupTemplate",void 0),u([m({type:Number,json:{write:{overridePolicy:Xe}}})],T.prototype,"refreshInterval",void 0),u([m({types:mt,json:{name:"layerDefinition.drawingInfo.renderer",write:se()}})],T.prototype,"renderer",null),u([m()],T.prototype,"source",void 0),u([m()],T.prototype,"spatialReference",null),u([m({type:Ht,json:{name:"layerDefinition.timeInfo",write:!0,origins:{"web-document":{name:"layerDefinition.timeInfo",read:!0,write:!0},"portal-item":{name:"layerDefinition.timeInfo",read:!0,write:!0}}}})],T.prototype,"timeInfo",null),u([m({type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],T.prototype,"title",null),u([gt("title")],T.prototype,"writeTitle",null),u([m({json:{read:!1}})],T.prototype,"type",void 0),u([m(P(q(Ot)))],T.prototype,"useViewTime",void 0),u([m({type:Boolean,json:{name:"visibility",write:se()}})],T.prototype,"visible",void 0),T=u([Ne("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],T);const rn=T;export{en as A,J as E,tn as F,Fe as L,nn as R,Ae as a,qe as b,Ki as c,V as d,Xi as e,ke as f,_e as g,xe as h,Te as i,je as m,Ze as n,Re as o,Ie as r,Me as s,Ee as t,rn as u,Oe as v};
