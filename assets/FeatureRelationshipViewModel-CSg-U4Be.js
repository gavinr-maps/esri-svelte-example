const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-DwIhxbHs.js","./jsxFactory-Cnml7uXM.js","./Accessor-BmwT4B0c.js","./intl-Duiy0OzY.js","./Promise-DfET-uns.js","./cast-CsZslgGN.js","./index-4eY77cms.js","./index-Cx51aysm.css","./JSONSupport-DcrLLGjL.js","./Evented-Dw4_VOGn.js","./reactiveUtils-XM7cS2OP.js","./SimpleObservable-CvOkykwM.js","./uuid-Cl5lrJ4c.js","./dom-DEluURzl.js","./guid-ejniuQmw.js","./observers-Co4E8E8j.js","./index-BCDLx0rN.js","./index-CMxz6F2k.js","./useT9n-C1Hrfc-A.js","./index-DyXGQ9Xl.js","./ref-D9wHsL_T.js","./directive-helpers-DaBykg1t.js","./keyed-CU1C-h1n.js","./index-fFnlo_g2.js","./index-DWeq-ojO.js","./index-pyEU_klK.js","./live-D7NQ-TrC.js","./static-DLD4WjLv.js","./form-BzoUrXC7.js","./interactive-DTzfFku4.js","./key-CZcQa38B.js","./label-CHHpnzD0.js","./loadable-XBvaWFYY.js","./locale-CXx8I9ox.js","./component-CBVlbUuE.js","./Validation-BYp9DS84.js","./input-DI9tZAPS.js","./filter-D4A4y0z5.js","./escapeRegExp-CdLjXKbf.js","./debounce-DbkufipY.js","./utils-Dtivty39.js","./index-B0pN5y8B.js","./index-DVGzfobf.js","./floating-ui-IixYHfbQ.js","./openCloseComponent-nqWrSaIH.js","./dynamicClasses-pKEMtFzB.js","./index-BPm91e5Z.js","./index-C7Sgjfzm.js","./resources6-Cs2_VmEC.js","./index-XCNLEnDV.js","./customElement-_nG5icNK.js","./resources5-SciNIBSe.js","./index-CV25o1as.js","./resources4-Crg87oFz.js","./uniqueValues-CoR-F-X3.js","./utils-Co_tyUES.js","./screenUtils-_ZIvrt5o.js","./timeUtils-C1c_L2Fd.js","./Point-Cz2JYYmX.js","./writer-DKgfqj4X.js","./quantizationUtils-DgFbqZi7.js","./Extent-g5W9hy0j.js","./Polyline-s-JzsQqo.js","./mathUtils-Cfq9PL9W.js","./opacityUtils-Dim20wpZ.js","./heatmapUtils-Cyq-bAyG.js","./vec42-YcqnINSP.js","./common-DQOJ18NT.js","./vec4f64-o2zAXfmz.js","./utils-v4CMtYiY.js","./mat4f32-DcsiF_Rp.js","./mat4-Fi6iAz29.js","./vec3f64-BLpZdpfb.js","./timeZoneUtils-DxzjpEBb.js","./utils-Dyua10sr.js","./ClassBreaksDefinition-C7KVmBug.js","./enumeration-DpvDkLNI.js","./workers-Cds_sd9m.js","./Queue-BQesTh_6.js","./Graphic-Dt0LgVGU.js","./Clonable-Z-AWS-16.js","./Color-VJEMvW-n.js","./colorUtils-Rxh2V3ai.js","./ActionToggle-D7439N1A.js","./Identifiable-BHVfzH03.js","./jsonUtils-CwFG8yN4.js","./typeUtils-B6WBEKDM.js","./TextSymbol-BLIQ6RKX.js","./collectionUtils-CTT-51g7.js","./Portal-CmmHxpLg.js","./aaBoundingBox-Dw3yBk2f.js","./jsonUtils-BZp85R7u.js","./typeUtils-B3iPBwJ2.js","./ClassBreaksRenderer-C7fhua2J.js","./commonProperties-ZfGquLPI.js","./colorRamps-CRjjPL3r.js","./SizeVariable-B-ghFm6e.js","./visualVariableUtils-Xcorldoo.js","./lengthUtils-_77UiyVF.js","./ColorStop-BYiAUa8d.js","./jsonUtils-B-voMz-i.js","./layerUtils-B__v9OBu.js","./defaults-FkBa0ybj.js","./defaultsJSON-GKolV7NZ.js","./RendererLegendOptions-CYAPr8D6.js","./LRUCache-CXiGQWMN.js","./MemCache-CmojB_Z1.js","./Version-Cd3TlGH0.js","./FieldsIndex-FW1AMU67.js","./utils-UPZJIDfz.js","./defaultCIMValues-Bb-CUowV.js","./enums-BTM-fOHQ.js","./HeatmapColorStop-CHbSyb1s.js","./SimpleRenderer-CEw_geZx.js","./UniqueValueRenderer-yoWHKJ_P.js","./diffUtils-BanfihCO.js","./styleUtils-ColFrJ-Z.js","./utils-YowqfOgk.js","./Query-B_2mhyL4.js","./Field-BDG0QV_T.js","./fieldType-CBeoJWlv.js","./FullTextSearch-CBnxSwz4.js","./TimeExtent-BO6BsF_x.js","./executeQueryJSON-BvVQs3iA.js","./query-Bjn_Ozo1.js","./normalizeUtils-BTGdXlpz.js","./normalizeUtilsCommon-lGDszWRI.js","./utils-B-dlKIhi.js","./pbfQueryUtils-mqiWagfZ.js","./pbf-BsmI3A9L.js","./memoryEstimations-Bcyf-mHz.js","./OptimizedGeometry-BJqUA4Pi.js","./OptimizedFeature-P2towpqD.js","./OptimizedFeatureSet-Blu9Ckm7.js","./queryZScale-BdW_vUm_.js","./projection-CyCZAIaD.js","./projectBuffer-CQnuEMuP.js","./geodesicConstants-RQL9oKdk.js","./FeatureSet-B5-Veyin.js","./statsWorker-ou8rJvtX.js","./AttributeBinsQuery-bynNlZ_X.js","./queryUtils-DBEPdow2.js","./json-Wa8cmqdu.js","./FixedIntervalBinParameters-ZfcJap1f.js","./NormalizationBinParametersMixin-CZD0XfhN.js","./viewpointUtils-CtXMVquh.js","./Viewpoint-DvyUmqUt.js","./Camera-CdyTfTAk.js","./Cyclical-Dlbl-cQK.js","./mat2d-D9DBP-jx.js","./mat2df64-CBKYtunK.js","./vec2-ChnYg_BJ.js","./vec2f64-Dy6m9Nrb.js"])))=>i.map(i=>d[i]);
import{_ as P}from"./index-4eY77cms.js";import{g as G,r as o,m as i,a as j,j as $,k as N,N as de,av as J,G as X}from"./Accessor-BmwT4B0c.js";import{d as M,P as V,V as q}from"./reactiveUtils-XM7cS2OP.js";import{O as oe,n as v,c as ye,e as Y}from"./jsxFactory-Cnml7uXM.js";import{e as he}from"./Heading-BcR6CGTM.js";import{e as pe}from"./globalCss-vQlnDsEX.js";import{b as ie}from"./Graphic-Dt0LgVGU.js";import{a as se}from"./Clonable-Z-AWS-16.js";import{n as ae}from"./Identifiable-BHVfzH03.js";import{s as ge}from"./ReactiveMap-BHFEHYMj.js";import{l as Z}from"./layerUtils-B__v9OBu.js";import{p as _e}from"./NetworkElement-BEwoE6j2.js";import{b as me}from"./Query-B_2mhyL4.js";import{findUtilityNetwork as be,getFixedFieldName as Ce,isRelatableFeatureSupportedLayer as Fe,findRelatedLayer as fe}from"./featureUtils-BovNToiy.js";import ee from"./RelationshipQuery-B5a-mYy7.js";import{K as we}from"./featureFormUtils-Cjx4R4NB.js";let O=class extends G{constructor(e){super(e),this.title=!0,this.description=!0}};o([i({type:Boolean,nonNullable:!0})],O.prototype,"title",void 0),o([i({type:Boolean,nonNullable:!0})],O.prototype,"description",void 0),O=o([j("esri.widgets.Feature.FeatureUtilityNetworkAssociations.VisibleElements")],O);const ne=O,x="esri-feature-element-info",B={base:x,title:`${x}__title`,description:`${x}__description`};let T=class extends oe{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return v("div",{class:B.base},this._renderTitle(),this._renderDescription())}_renderTitle(){const{title:e}=this;return e?v(he,{class:B.title,innerHTML:e,level:this.headingLevel}):null}_renderDescription(){const{description:e}=this;return e?v("div",{class:B.description,innerHTML:e,key:"description"}):null}};o([i()],T.prototype,"description",void 0),o([i()],T.prototype,"headingLevel",void 0),o([i()],T.prototype,"title",void 0),T=o([j("esri.widgets.Feature.support.FeatureElementInfo")],T);const Ae=T,S={assetGroup:"assetgroup",assetType:"assettype"},te=100;let l=class extends se.ClonableMixin(ae.IdentifiableMixin(G)){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.networkSourceIdsInUse=new Set,this.source="popup",this.description=null,this.graphic=null,this.layer=null,this.map=null,this.featureCount=0,this.associationTypes=null,this.showAllEnabled=!1,this.title=null,this.attachmentsFeatureCount=0,this.structureFeatureCount=0,this.contentFeatureCount=0,this.containerFeatureCount=0,this.connectivityFeatureCount=0,this._queryOpenAssociationType=async()=>{this.activeAssociationType&&await this._queryDebounced(this.activeAssociationType)},this._cancelQuery=()=>{const{_queryAbortController:t}=this;t&&t.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:t}=this;t&&t.abort(),this._queryFeatureCountAbortController=null},this._queryController=async t=>{this._cancelQuery();const r=new AbortController;this._queryAbortController=r,await $(this._query(t)),this._queryAbortController===r&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._loaded=!1,this._cancelQueryFeatureCount();const t=new AbortController;this._queryFeatureCountAbortController=t,await $(this._queryFeatureCount()),this._queryFeatureCountAbortController===t&&(this._queryFeatureCountAbortController=null),this._loaded=!0},this._queryDebounced=N(this._queryController,te),this._queryFeatureCountDebounced=N(this._queryFeatureCountController,te)}initialize(){this.addHandles([M(()=>[this.graphic,this.layer,this.map,this.associationTypes,this.objectId,this.globalId,this.canQuery],()=>this.refresh(),V),M(()=>this.activeAssociationType,e=>this._queryDebounced(e),V)])}destroy(){this._cancelQuery(),this._cancelQueryFeatureCount(),this._destroyAssociatedFeatureViewModels()}get supportsCacheHint(){var e,t,r;return!!((r=(t=(e=this.layer)==null?void 0:e.capabilities)==null?void 0:t.query)!=null&&r.supportsCacheHint)}get canLoad(){return!!this.map&&!!this.associationTypes&&typeof this.globalId=="string"}get canQuery(){var t,r;const e=(r=(t=this.layer)==null?void 0:t.capabilities)==null?void 0:r.query;return!!this.associationTypes&&typeof this.globalId=="string"&&!!(e!=null&&e.supportsPagination)}set displayCount(e){this._set("displayCount",Math.max(e??3,0))}get displayCount(){return this._get("displayCount")}get objectId(){var e,t;return(this.objectIdField&&((t=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:t[this.objectIdField]))??null}get objectIdField(){var e;return((e=this.layer)==null?void 0:e.objectIdField)||null}get globalId(){var e,t;return(this.globalIdField&&((t=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:t[this.globalIdField]))??null}get globalIdField(){const{layer:e}=this;return e==null?void 0:e.globalIdField}get activeAssociationType(){return this._get("activeAssociationType")}set activeAssociationType(e){e&&!this.associationTypes.includes(e)||this._set("activeAssociationType",e)}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:r,canQuery:s,_loaded:a,canLoad:n,source:y}=this;return t||n&&!a?"loading":e||r?"querying":!s||y==="popup"&&this.featureCount===0?"disabled":"ready"}get utilityNetwork(){const{layer:e,map:t}=this;if(!(e!=null&&e.loaded)||!t)return null;const r=Z(e)?e.parent:e;return be(t,r)}get attachmentsAssociations(){return this._get("attachmentsAssociations")||new q}get structureAssociations(){return this._get("structureAssociations")||new q}get contentAssociations(){return this._get("contentAssociations")||new q}get containerAssociations(){return this._get("containerAssociations")||new q}get connectivityAssociations(){return this._get("connectivityAssociations")||new q}get associationFeatures(){return this._get("associationFeatures")||new ge}get associationViewModels(){return this._get("associationViewModels")||new Map}async refresh(){await this._queryFeatureCountDebounced(),await this._queryOpenAssociationType()}getFeatureCountForAssociationType(e){switch(e){case"attachment":return this.attachmentsFeatureCount;case"structure":return this.structureFeatureCount;case"content":return this.contentFeatureCount;case"container":return this.containerFeatureCount;case"connectivity":return this.connectivityFeatureCount}}_destroyAssociatedFeatureViewModels(){this.associationViewModels.forEach(e=>e.destroyAll())}async _loadUtiltyNetworks(){var r;const e=this.map;if(!e)return;await Promise.allSettled(((r=e.utilityNetworks)==null?void 0:r.map(async s=>{await s.load()}))??[]);const t=this.utilityNetwork;if(t){const s=a=>{if("layerId"in a&&t.isUtilityLayer(a)){const n=t.getSourceIdByLayerId(a.layerId);n!==null&&this.networkSourceIdsInUse.add(n)}};this._set("networkSourceIdsInUse",new Set),e.allLayers.forEach(s),e.allTables.forEach(s)}}async _findLayersBySourceId(e){const{utilityNetwork:t,map:r}=this,s=h=>{const C=h;return h.url&&C.layerId===a?h.url.replace(/\/\d+$/,"")===(t==null?void 0:t.featureServiceUrl):!1};await(t==null?void 0:t.load());const a=t.getLayerIdBySourceId(e),n=r.allLayers.filter(s),y=r.allTables.filter(s),u=n.concat(y).toArray();return await Promise.allSettled(u.map(h=>h.load())),u}_clearAssociations(){this.attachmentsAssociations.removeAll(),this.structureAssociations.removeAll(),this.contentAssociations.removeAll(),this.containerAssociations.removeAll(),this.connectivityAssociations.removeAll()}_clearFeatures(){this.associationFeatures.forEach(e=>e.removeAll()),this.associationFeatures.clear()}_getAssociationsByType(e){switch(e){case"attachment":return this.attachmentsAssociations;case"structure":return this.structureAssociations;case"connectivity":return this.connectivityAssociations;case"container":return this.containerAssociations;case"content":return this.contentAssociations}}async _queryLayer(e,t,r,s,a){const n=e.fieldsIndex.get(S.assetGroup),y=e.fieldsIndex.get(S.assetType),u=r!=null,h=s!=null,C="("+t.map(m=>`'${m}'`).join(", ")+")",_=u?` AND ${n==null?void 0:n.name} = ${r}`:"",p=u&&h?` AND ${y==null?void 0:y.name} = ${s}`:"",b=`${e.globalIdField} IN ${C}`+_+p,d=new me({outFields:["*"],cacheHint:this.supportsCacheHint,where:b});return await this._queryAll(d,e,{signal:a==null?void 0:a.signal})}async _createAssociationFeatureObjects(e,t,r,s,a,n){if(e.length===0)return[];const y=new Map;for(const[h,C]of t){const _=await this._findLayersBySourceId(h);for(const p of _)(await this._queryLayer(p,C,s,a,n)).forEach(b=>{if(this.source==="popup"?b.layer&&b.getEffectivePopupTemplate():b.layer){const d=y.get(b.attributes[p.globalIdField])??[];d.push(b),y.set(b.attributes[p.globalIdField],d)}})}const u=[];return await Promise.all(e.toArray().map(async h=>{const{fromNetworkElement:C,toNetworkElement:_}=h,p=C.globalId===r?_:C,b=y.get(p.globalId)??[];await Promise.all(b.map(async d=>{var g,A;const m=(A=(g=this.utilityNetwork)==null?void 0:g.getTerminalById(p==null?void 0:p.terminalId))==null?void 0:A.name;if(d.layer&&"getFeatureTitle"in d.layer){const f=await d.layer.getFeatureTitle(d);u.push({title:f,association:h,feature:d,terminalName:m})}else u.push({association:h,feature:d,terminalName:m})}))})),u}_parseFeatureObjects(e,t){e.forEach(r=>{const s=r==null?void 0:r.feature,a=s.layer,n=t.get(a)??new q;n.add(r),t.set(a,n)})}async _queryAll(e,t,r){var y;const s=[];let a=0,n=!1;e.num=((y=t.sourceJSON)==null?void 0:y.maxRecordCount)??2e3;do{e.start=a;const u=await t.queryFeatures(e,r);s.push(...u.features),n=u.exceededTransferLimit,n&&(a+=u.features.length)}while(n);return s}async _queryAssociations(e){const{layer:t,globalId:r,associationTypes:s,utilityNetwork:a,canQuery:n}=this;if(await Promise.allSettled([t==null?void 0:t.load(),a==null?void 0:a.load()]),this._clearAssociations(),!(n&&t&&s&&a&&r))return;const y=Z(t)?t.parent:t,u=new _e({globalId:r,networkSourceId:a.getSourceIdByLayerId(y.layerId)}),h=new Set;s.forEach(d=>{switch(d.type){case"attachment":case"structure":h.add("attachment");break;case"container":case"content":h.add("containment");break;case"connectivity":h.add("connectivity"),h.add("junction-junction-connectivity"),h.add("junction-edge-from-connectivity"),h.add("junction-edge-midspan-connectivity"),h.add("junction-edge-to-connectivity")}});const C=await(a==null?void 0:a.queryAssociations({elements:[u],types:Array.from(h)},{signal:e==null?void 0:e.signal})),_=new Map,p=new Map;s.forEach(d=>{p.set(d.type,d),_.set(d.type,[])}),C.forEach(d=>{var A,f,F,k,L,E;const{toNetworkElement:m,fromNetworkElement:g}=d;switch(d.associationType){case"connectivity":case"junction-junction-connectivity":case"junction-edge-from-connectivity":case"junction-edge-midspan-connectivity":case"junction-edge-to-connectivity":if((g==null?void 0:g.globalId)===r){if(this._shouldDiscardNetworkElement(m,"connectivity",p))break;(A=_.get("connectivity"))==null||A.push(m.globalId)}else{if(this._shouldDiscardNetworkElement(g,"connectivity",p))break;(f=_.get("connectivity"))==null||f.push(g.globalId)}this.connectivityAssociations.add(d);break;case"containment":if((g==null?void 0:g.globalId)===r){if(this._shouldDiscardNetworkElement(m,"content",p))break;(F=_.get("content"))==null||F.push(m.globalId),this.contentAssociations.add(d)}else{if(this._shouldDiscardNetworkElement(g,"container",p))break;(k=_.get("container"))==null||k.push(g.globalId),this.containerAssociations.add(d)}break;case"attachment":if((g==null?void 0:g.globalId)===r){if(this._shouldDiscardNetworkElement(m,"attachment",p))break;(L=_.get("attachment"))==null||L.push(m.globalId),this.attachmentsAssociations.add(d)}else{if(this._shouldDiscardNetworkElement(g,"structure",p))break;(E=_.get("structure"))==null||E.push(g.globalId),this.structureAssociations.add(d)}}});const b=s.map(async d=>{const{associatedNetworkSourceId:m,associatedAssetGroup:g,associatedAssetType:A}=d,f=_.get(d.type),F=g!=null?await this._countAssociatedFeatures(m,f,g,A,e):f.length;switch(d.type){case"attachment":this._set("attachmentsFeatureCount",F);break;case"structure":this._set("structureFeatureCount",F);break;case"content":this._set("contentFeatureCount",F);break;case"container":this._set("containerFeatureCount",F);break;case"connectivity":this._set("connectivityFeatureCount",F)}});await Promise.allSettled(b)}async _countAssociatedFeatureCount(e,t,r,s,a){const n=e.fieldsIndex.get(S.assetGroup),y=e.fieldsIndex.get(S.assetType),u=s!=null,h="("+t.map(b=>`'${b}'`).join(", ")+")",C=` AND ${n==null?void 0:n.name} = ${r}`,_=u?` AND ${y==null?void 0:y.name} = ${s}`:"",p=`${e.globalIdField} IN ${h}`+C+_;return e.queryFeatureCount({where:p,outFields:["*"],returnGeometry:!1},{signal:a==null?void 0:a.signal})}async _countAssociatedFeatures(e,t,r,s,a){if(t.length===0)return 0;const n=(await this._findLayersBySourceId(e)).map(async y=>this._countAssociatedFeatureCount(y,t,r,s,a));return(await Promise.all(n)).reduce((y,u)=>y+u,0)}async _queryAssociatedFeatures(e,t){const{layer:r,globalId:s,associationTypes:a,utilityNetwork:n,canQuery:y,associationFeatures:u}=this;if(await Promise.allSettled([r==null?void 0:r.load(),n==null?void 0:n.load()]),!(y&&r&&a&&n))return;const h=this._getAssociationsByType(e.type),{associatedAssetGroup:C,associatedAssetType:_}=e,p=new Map;h.forEach(d=>{const{fromNetworkElement:m,toNetworkElement:g}=d,{networkSourceId:A,elementGlobalId:f}=m.globalId===s?{networkSourceId:g.networkSourceId,elementGlobalId:g.globalId}:{networkSourceId:m.networkSourceId,elementGlobalId:m.globalId},F=p.get(A)||[];F.push(f),p.set(A,F)});const b=await this._createAssociationFeatureObjects(h,p,s,C,_,t);this._parseFeatureObjects(b,u)}async _queryFeatureCount(){await this._loadUtiltyNetworks();const{_queryFeatureCountAbortController:e,canQuery:t}=this;t?(await this._queryAssociations(e),this._set("featureCount",this.attachmentsFeatureCount+this.structureFeatureCount+this.contentFeatureCount+this.containerFeatureCount+this.connectivityFeatureCount)):this._set("featureCount",0)}async _query(e){if(!e)return;await this._loadUtiltyNetworks();const{_queryAbortController:t}=this;this._destroyAssociatedFeatureViewModels(),this._clearFeatures(),this.featureCount!==0&&(this.destroyed||await this._queryAssociatedFeatures(e,{signal:t==null?void 0:t.signal}))}_shouldDiscardNetworkElement(e,t,r){var u;if(!e)return!1;const{networkSourceIdsInUse:s}=this,{networkSourceId:a}=e,n=(u=r.get(t))==null?void 0:u.associatedNetworkSourceId,y=s.has(a);return n!=null&&n!==a||!y}};o([i()],l.prototype,"_loaded",void 0),o([i()],l.prototype,"_queryAbortController",void 0),o([i()],l.prototype,"_queryPageAbortController",void 0),o([i()],l.prototype,"_queryFeatureCountAbortController",void 0),o([i({readOnly:!0})],l.prototype,"supportsCacheHint",null),o([i({readOnly:!0})],l.prototype,"canLoad",null),o([i({readOnly:!0})],l.prototype,"canQuery",null),o([i()],l.prototype,"networkSourceIdsInUse",void 0),o([i({constructOnly:!0})],l.prototype,"source",void 0),o([i()],l.prototype,"description",void 0),o([i({value:3})],l.prototype,"displayCount",null),o([i({type:ie})],l.prototype,"graphic",void 0),o([i()],l.prototype,"layer",void 0),o([i()],l.prototype,"map",void 0),o([i({readOnly:!0})],l.prototype,"objectId",null),o([i({readOnly:!0})],l.prototype,"objectIdField",null),o([i({readOnly:!0})],l.prototype,"globalId",null),o([i({readOnly:!0})],l.prototype,"globalIdField",null),o([i()],l.prototype,"featureCount",void 0),o([i()],l.prototype,"associationTypes",void 0),o([i()],l.prototype,"activeAssociationType",null),o([i()],l.prototype,"showAllEnabled",void 0),o([i()],l.prototype,"state",null),o([i()],l.prototype,"title",void 0),o([i({readOnly:!0})],l.prototype,"utilityNetwork",null),o([i({readOnly:!0})],l.prototype,"attachmentsFeatureCount",void 0),o([i({readOnly:!0})],l.prototype,"structureFeatureCount",void 0),o([i({readOnly:!0})],l.prototype,"attachmentsAssociations",null),o([i({readOnly:!0})],l.prototype,"structureAssociations",null),o([i({readOnly:!0})],l.prototype,"contentFeatureCount",void 0),o([i({readOnly:!0})],l.prototype,"containerFeatureCount",void 0),o([i({readOnly:!0})],l.prototype,"contentAssociations",null),o([i({readOnly:!0})],l.prototype,"containerAssociations",null),o([i({readOnly:!0})],l.prototype,"connectivityFeatureCount",void 0),o([i({readOnly:!0})],l.prototype,"connectivityAssociations",null),o([i({readOnly:!0})],l.prototype,"associationFeatures",null),o([i({readOnly:!0})],l.prototype,"associationViewModels",null),l=o([j("esri.widgets.support.UtilityNetworkAssociations.FeatureUtilityNetworkAssociationsViewModel")],l);const le=l,U="esri-feature-utility-network-associations",re=`${U}__loading-container`,D={base:U,listContainer:`${U}__list`,loadingContainer:re,loadingContainerSticky:`${re}--sticky`};let w=class extends oe{constructor(t,r){super(t,r),this._featureElementInfo=null,this.onSelectAssociationType=()=>{},this.flowType="feature-utility-network-associations",this.flowItems=null,this.parentFeatureViewModel=null,this.headingLevel=5,this.viewModel=new le,this.messages=null,this.messagesCommon=null,this.visibleElements=new ne}initialize(){this._featureElementInfo=new Ae,this.addHandles([M(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),V)])}loadDependencies(){return ye({icon:()=>P(()=>import("./index-DwIhxbHs.js").then(t=>t.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]),import.meta.url),list:()=>P(()=>import("./index-BCDLx0rN.js"),__vite__mapDeps([16,17,1,2,3,4,5,6,7,8,9,10,11,12,14,18,19,20,21,15,13,22,0,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40]),import.meta.url),"list-item":()=>P(()=>import("./index-B0pN5y8B.js"),__vite__mapDeps([41,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,42,20,21,43,39,29,30,32,44,45,17,18,46,22,34,47,48,49,50,40,51]),import.meta.url),loader:()=>P(()=>import("./index-CMxz6F2k.js"),__vite__mapDeps([17,1,2,3,4,5,6,7,8,9,10,11,12,14,18]),import.meta.url),notice:()=>P(()=>import("./index-CV25o1as.js"),__vite__mapDeps([52,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,20,21,32,53,44,34,18]),import.meta.url)})}destroy(){this._featureElementInfo=de(this._featureElementInfo)}get description(){return this.viewModel.description}set description(t){this.viewModel.description=t}get title(){return this.viewModel.title}set title(t){this.viewModel.title=t}render(){var r;const{state:t}=this.viewModel;return v("div",{class:this.classes(D.base,pe.widget)},(r=this._featureElementInfo)==null?void 0:r.render(),t==="loading"?this._renderLoading():t==="disabled"?this._renderAssociationNotFound():this._renderContent())}_renderStickyLoading(){return this.viewModel.state==="querying"?v("div",{class:D.loadingContainerSticky,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return v("calcite-loader",{inline:!0,label:this.messagesCommon.loading})}_renderLoading(){return v("div",{class:D.loadingContainer,key:"loading-container"},this._renderLoadingIcon())}_renderAssociationNotFound(){var t;return v("calcite-notice",{icon:"exclamation-mark-triangle",key:"association-not-found",kind:"danger",open:!0,scale:"s",width:"full"},v("div",{slot:"message"},(t=this.messages)==null?void 0:t.noAssociations))}_renderAssociationType(t){const{viewModel:r}=this,s=this._getAssociationTypeTitle(t);return v("calcite-list-item",{description:J(t.description),key:`association-type-${t.type}`,label:J(s),value:t.type,onCalciteListItemSelect:()=>this.onSelectAssociationType({viewModel:r,listType:t,title:s})},v("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderAssociations(t){const{viewModel:r}=this;return r.source==="featureForm"||r.getFeatureCountForAssociationType(t.type)>0?this._renderAssociationType(t):void 0}_renderContent(){const{messages:t,viewModel:r}=this,{state:s,associationTypes:a}=r;return v("div",{class:D.listContainer,key:"list-container"},s==="ready"?v("div",null,v("calcite-list",{displayMode:"flat",label:t==null?void 0:t.associationsList},a.map(n=>this._renderAssociations(n)))):null,this._renderStickyLoading())}_getAssociationTypeTitle(t){const{messages:r}=this;if(t.title)return t.title;switch(t.type){case"attachment":return r.associationsAttachments;case"connectivity":return r.associationsConnectivity;case"structure":return r.associationsStructure;case"content":return r.associationsContents;case"container":return r.associationsContainer}}_setupFeatureElementInfo(){var n;const{headingLevel:t,visibleElements:r}=this,s=r.description&&this.description,a=r.title&&this.title;(n=this._featureElementInfo)==null||n.set({description:s,title:a,headingLevel:t})}};o([i({constructOnly:!0})],w.prototype,"onSelectAssociationType",void 0),o([i()],w.prototype,"flowType",void 0),o([i()],w.prototype,"flowItems",void 0),o([i()],w.prototype,"parentFeatureViewModel",void 0),o([i()],w.prototype,"featureVisibleElements",void 0),o([i()],w.prototype,"description",null),o([i()],w.prototype,"headingLevel",void 0),o([i()],w.prototype,"title",null),o([i({type:le})],w.prototype,"viewModel",void 0),o([i(),Y("esri/widgets/Feature/t9n/Feature")],w.prototype,"messages",void 0),o([i(),Y("esri/t9n/common")],w.prototype,"messagesCommon",void 0),o([i({type:ne,nonNullable:!0})],w.prototype,"visibleElements",void 0),w=o([j("esri.widgets.Feature.FeatureUtilityNetworkAssociations")],w);const xe=w,H=100;let c=class extends se.ClonableMixin(ae.IdentifiableMixin(G)){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.activeCategory=null,this.allCategories=null,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:t}=this;t&&t.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:t}=this;t&&t.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:t}=this;t&&t.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const t=new AbortController;this._queryAbortController=t,await $(this._query()),this._queryAbortController===t&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._loaded=!1,this._cancelQueryFeatureCount();const t=new AbortController;this._queryFeatureCountAbortController=t,await $(this._queryFeatureCount()),this._queryFeatureCountAbortController===t&&(this._queryFeatureCountAbortController=null),this._loaded=!0},this._queryPageController=async()=>{const t=new AbortController;this._queryPageAbortController=t,await $(this._queryPage()),this._queryPageAbortController===t&&(this._queryPageAbortController=null)},this._queryDebounced=N(this._queryController,H),this._queryFeatureCountDebounced=N(this._queryFeatureCountController,H),this._queryPageDebounced=N(this._queryPageController,H),this._query=async()=>{var s;const{_queryAbortController:t,relatedFeatures:r}=this;this.featureCount&&(((s=this.relatedLayer)==null?void 0:s.type)!=="subtype-group"||this.activeCategory)&&(this._destroyRelatedFeatureViewModels(),this.featurePage=1,r.destroyAll(),this.destroyed||r.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:t==null?void 0:t.signal}))))},this.addHandles([M(()=>{var t;return[this.displayCount,this.graphic,this.layer,(t=this.layer)==null?void 0:t.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount,this.activeCategory]},()=>this._queryDebounced(),V),M(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),M(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery,this.activeCategory],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.destroyAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){const{featuresPerPage:t,featureCount:r}=this,s=1,a=Math.ceil(r/t)||1;this._set("featurePage",Math.min(Math.max(e,s),a))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:e,relatedLayer:t}=this;return e&&(t!=null&&t.loaded)?e.map(r=>{const s=r.clone();return s.field=Ce(r.field,t),s}):e??[]}get supportsCacheHint(){var e,t,r;return!!((r=(t=(e=this.layer)==null?void 0:e.capabilities)==null?void 0:t.queryRelated)!=null&&r.supportsCacheHint)}get canLoad(){return!!this.map&&this.relationshipId!=null&&typeof this.objectId=="number"}get canQuery(){var t,r;const e=(r=(t=this.layer)==null?void 0:t.capabilities)==null?void 0:r.queryRelated;return!!(this.relatedLayer&&this.relationship&&this.relationshipId!=null&&this.objectId!=null&&(e!=null&&e.supportsCount)&&(e!=null&&e.supportsPagination))}get allCategoriesCount(){var e;return((e=this.allCategories)==null?void 0:e.length)??0}get categories(){const{allCategories:e}=this;return this.showAllEnabled?e:(e==null?void 0:e.slice(0,this.displayCount))??null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e??3,0),10))}get displayCount(){return this._get("displayCount")}get itemDescriptionFieldName(){var e;return((e=this.orderByFieldsFixedCasing[0])==null?void 0:e.field)||null}get objectId(){var e,t;return(this.objectIdField&&((t=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:t[this.objectIdField]))??null}get objectIdField(){var e;return((e=this.layer)==null?void 0:e.objectIdField)||null}get relatedFeatures(){return this._get("relatedFeatures")||new q}get relatedLayer(){const{layer:e,map:t,relationship:r}=this;if(!(e!=null&&e.loaded)||!t||!r)return null;const s=e.type==="subtype-sublayer"&&e.parent&&Fe(e.parent)?e.parent:e;return fe(t,s,r)??null}get relatedLayerKeyField(){var r,s;const{relatedLayer:e,relationshipId:t}=this;return e!=null&&e.loaded&&t!=null?(s=(r=e.relationships)==null?void 0:r.find(a=>a.id===t))==null?void 0:s.keyField:null}get relatedLayerKeyFields(){var t;const{relatedLayer:e}=this;return e!=null&&e.loaded?((t=e.relationships)==null?void 0:t.map(r=>r.keyField).filter(X))??[]:[]}get relationship(){var r;const{relationshipId:e,layer:t}=this;return e!=null&&(t!=null&&t.loaded)?((r=t.relationships)==null?void 0:r.find(({id:s})=>s===e))??null:null}get relationshipKey(){var t,r;const{relationshipKeyField:e}=this;return(e&&((r=(t=this.graphic)==null?void 0:t.attributes)==null?void 0:r[e]))??null}get relationshipKeyField(){var e;return((e=this.relationship)==null?void 0:e.keyField)||null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new q}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:r,canQuery:s,_loaded:a,canLoad:n}=this;return t||n&&!a?"loading":e||r?"querying":s?"ready":"disabled"}getRelatedFeatureByObjectId(e){return this.relatedFeatures.find(t=>t.getObjectId()===e)}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){var e;(e=this.relatedFeatureViewModels)==null||e.destroyAll()}async _queryFeatureCount(){const{layer:e,relatedLayer:t}=this;await(e==null?void 0:e.load()),await(t==null?void 0:t.load());const{_queryFeatureCountAbortController:r,activeCategory:s,canQuery:a,objectId:n,relatedLayerKeyField:y,relationshipId:u,relationshipKey:h,supportsCacheHint:C}=this;if(!a||!e||!t||n==null)return this._set("featureCount",0),void this._set("allCategories",null);if((t==null?void 0:t.type)==="subtype-group"&&!s){if(this._set("featureCount",0),this._destroyRelatedFeatureViewModels(),this.featurePage=1,this.relatedFeatures.destroyAll(),y&&h!=null){const{default:m}=await P(()=>import("./uniqueValues-CoR-F-X3.js"),__vite__mapDeps([54,2,55,56,57,4,5,6,7,8,58,59,60,61,62,63,64,65,66,67,68,69,10,9,11,70,71,72,3,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152]),import.meta.url),{uniqueValueInfos:g}=await m({layer:t,sqlWhere:`${y} = '${h}'`,field:t.subtypeField,signal:r==null?void 0:r.signal}),A=g.map(({count:f,value:F})=>{var L,E;const k=(E=(L=t.subtypes)==null?void 0:L.find(Q=>Q.code===F))==null?void 0:E.name;return F!=null&&k?{count:f,value:F,name:k}:void 0}).filter(X);this._set("allCategories",A)}return}const{historicMoment:_,gdbVersion:p}=e,b=new ee({cacheHint:C,gdbVersion:p,historicMoment:_,relationshipId:u,returnGeometry:!1,objectIds:[n],where:this._getRelationshipWhereClause(t)}),d=await e.queryRelatedFeaturesCount(b,{signal:r==null?void 0:r.signal});this._set("allCategories",null),this._set("featureCount",d[n]||0)}_getRelationshipWhereClause(e){const{activeCategory:t}=this,r=e.createQuery(),s="subtypeField"in e?e.subtypeField:void 0,a=t&&s?`${s} = ${t.value}`:void 0,n=r.where;return n&&a?`(${n}) AND (${a})`:n??a}_sliceFeatures(e){const{showAllEnabled:t,displayCount:r}=this;return t?e:r?e.slice(0,r):[]}async _queryPage(){var n;const{relatedFeatures:e,featurePage:t,showAllEnabled:r,_queryPageAbortController:s,featureCount:a}=this;!r||t<2||!a||((n=this.relatedLayer)==null?void 0:n.type)==="subtype-group"&&!this.activeCategory||e.addMany(await this._queryRelatedFeatures({signal:s==null?void 0:s.signal}))}async _queryRelatedFeatures(e){var K;const{displayCount:t,featureCount:r,featurePage:s,featuresPerPage:a,layer:n,orderByFieldsFixedCasing:y,relatedLayer:u,relatedLayerKeyFields:h,relationshipId:C,showAllEnabled:_,supportsCacheHint:p}=this,{canQuery:b,objectId:d}=this;if(!b||!n||!u||d==null)return[];const m=_?((s-1)*a+r)%r:0,g=_?a:t,A=u.objectIdField,f="subtypeField"in u?u.subtypeField:void 0,F=[...y.map(I=>I.field),...we(u),...h,A,f].filter(ve),k=y.map(I=>`${I.field} ${I.order}`),{historicMoment:L,gdbVersion:E}=n,Q=new ee({orderByFields:k,start:m,num:g,outFields:F,cacheHint:p,historicMoment:L,gdbVersion:E,relationshipId:C,returnGeometry:!1,objectIds:[d],where:this._getRelationshipWhereClause(u)}),ue=await n.queryRelatedFeatures(Q,{signal:e==null?void 0:e.signal}),R=((K=ue[d])==null?void 0:K.features)||[];return u.type==="subtype-group"&&f?R.forEach(I=>{var z;const ce=I.attributes[f],W=(z=u.findSublayerForSubtypeCode)==null?void 0:z.call(u,ce);I.sourceLayer=W,I.layer=W}):R.forEach(I=>{I.sourceLayer=u,I.layer=u}),R}};function ve(e){return e!=null&&e!==""}o([i()],c.prototype,"_loaded",void 0),o([i()],c.prototype,"_queryAbortController",void 0),o([i()],c.prototype,"_queryPageAbortController",void 0),o([i()],c.prototype,"_queryFeatureCountAbortController",void 0),o([i({value:1})],c.prototype,"featurePage",null),o([i()],c.prototype,"featuresPerPage",void 0),o([i({readOnly:!0})],c.prototype,"orderByFieldsFixedCasing",null),o([i({readOnly:!0})],c.prototype,"supportsCacheHint",null),o([i({readOnly:!0})],c.prototype,"canLoad",null),o([i({readOnly:!0})],c.prototype,"canQuery",null),o([i()],c.prototype,"activeCategory",void 0),o([i({readOnly:!0})],c.prototype,"allCategories",void 0),o([i({readOnly:!0})],c.prototype,"allCategoriesCount",null),o([i({readOnly:!0})],c.prototype,"categories",null),o([i()],c.prototype,"description",void 0),o([i({value:3})],c.prototype,"displayCount",null),o([i({type:ie})],c.prototype,"graphic",void 0),o([i({readOnly:!0})],c.prototype,"itemDescriptionFieldName",null),o([i()],c.prototype,"layer",void 0),o([i()],c.prototype,"map",void 0),o([i({readOnly:!0})],c.prototype,"objectId",null),o([i({readOnly:!0})],c.prototype,"objectIdField",null),o([i()],c.prototype,"orderByFields",void 0),o([i({readOnly:!0})],c.prototype,"relatedFeatures",null),o([i({readOnly:!0})],c.prototype,"relatedLayer",null),o([i({readOnly:!0})],c.prototype,"relatedLayerKeyField",null),o([i({readOnly:!0})],c.prototype,"relatedLayerKeyFields",null),o([i({readOnly:!0})],c.prototype,"relationship",null),o([i({readOnly:!0})],c.prototype,"relationshipKey",null),o([i({readOnly:!0})],c.prototype,"relationshipKeyField",null),o([i({readOnly:!0})],c.prototype,"featureCount",void 0),o([i({readOnly:!0})],c.prototype,"relatedFeatureViewModels",null),o([i()],c.prototype,"relationshipId",void 0),o([i()],c.prototype,"showAllEnabled",void 0),o([i()],c.prototype,"state",null),o([i()],c.prototype,"title",void 0),c=o([j("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],c);const Be=c;export{le as _,ne as i,Ae as l,Be as m,xe as w};
