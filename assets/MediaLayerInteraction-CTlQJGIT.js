const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./editingTools-JEBHcv68.js","./Accessor-BmwT4B0c.js","./Graphic-Dt0LgVGU.js","./Clonable-Z-AWS-16.js","./reactiveUtils-XM7cS2OP.js","./Evented-Dw4_VOGn.js","./SimpleObservable-CvOkykwM.js","./JSONSupport-DcrLLGjL.js","./cast-CsZslgGN.js","./index-4eY77cms.js","./index-Cx51aysm.css","./writer-DKgfqj4X.js","./opacityUtils-Dim20wpZ.js","./Promise-DfET-uns.js","./Point-Cz2JYYmX.js","./enumeration-DpvDkLNI.js","./Color-VJEMvW-n.js","./colorUtils-Rxh2V3ai.js","./mathUtils-Cfq9PL9W.js","./ActionToggle-D7439N1A.js","./Identifiable-BHVfzH03.js","./jsonUtils-CwFG8yN4.js","./Extent-g5W9hy0j.js","./Polyline-s-JzsQqo.js","./typeUtils-B6WBEKDM.js","./TextSymbol-BLIQ6RKX.js","./screenUtils-_ZIvrt5o.js","./collectionUtils-CTT-51g7.js","./Portal-CmmHxpLg.js","./vec3f64-BLpZdpfb.js","./aaBoundingBox-Dw3yBk2f.js","./SnappingVisualizer2D-xvUExsy2.js","./vec2-ChnYg_BJ.js","./common-DQOJ18NT.js","./vec2f64-Dy6m9Nrb.js","./enums-BTM-fOHQ.js","./RightAngleSnappingHint-BepRvd6S.js","./timeUtils-C1c_L2Fd.js","./vec32-Dvg_eL9J.js","./projectVectorToVector-CCOy_B5J.js","./projectBuffer-CQnuEMuP.js","./geodesicConstants-RQL9oKdk.js","./projectPointToVector-BoxjK-qy.js","./projection-CyCZAIaD.js","./Query-B_2mhyL4.js","./Field-BDG0QV_T.js","./fieldType-CBeoJWlv.js","./FullTextSearch-CBnxSwz4.js","./TimeExtent-BO6BsF_x.js","./InputManager-DZ3jJnlx.js","./Queue-BQesTh_6.js","./signal-CySMLEX9.js","./keybindings-CTmT1RTo.js","./utils-BjSXFjBJ.js","./Version-Cd3TlGH0.js","./vec42-YcqnINSP.js","./vec4f64-o2zAXfmz.js","./geodesicUtils-Cvz9v8ds.js","./plane-CpXmOyqq.js","./mat3f64-BBpwCtoL.js","./mat4f64-Dk4dwAN8.js","./quatf64-CCm9z-pX.js","./mathUtils-BgCEaV43.js","./sphere-Cin5efBj.js","./mat4-Fi6iAz29.js","./mat3-CR8GKnhD.js","./elevationInfoUtils-D26wVF2d.js","./unitConversionUtils-rg07EgOm.js","./lengthUtils-_77UiyVF.js","./geometry2dUtils-D9Oax6Qb.js","./SnappingVisualizer-bfo0JaXd.js","./PointSnappingHint-DWAfJfrj.js","./editPlaneUtils-Cjvg8foP.js","./UpdatingHandles-CzJ4c3KT.js","./coordinateFormatter-sQ_KRFCi.js","./intl-Duiy0OzY.js","./GraphicsLayer-D3KyXpUc.js","./GraphicsCollection-BJ5Nr2H8.js","./Layer-DH4_Pn8a.js","./ScaleRangeLayer-Cnzwr9PT.js","./layerContainerType-C5CzMsLd.js","./jsonUtils-DZz5FrgB.js","./utils-DYurMneM.js","./mat4f32-DcsiF_Rp.js","./ElevationInfo-BPOqhCue.js","./dehydratedFeatureComparison-j4L0peJx.js","./createUtils-BLSknDZf.js","./Circle-DhDdChqp.js","./geometryEngine-CLtm9OQA.js","./geometryEngineBase-B0ZyeKAX.js","./_commonjsHelpers-DCkdB7M8.js","./hydrated-DcIAHEVL.js","./surfaceCoordinateSystems-DVyjKZ7x.js","./memoize-DmxaQ-k8.js","./ReactiveSet-DgPcISC1.js","./diffUtils-BanfihCO.js","./ViewingMode-Dodu7ZZk.js","./DrawingMode-Cvvf0VVz.js","./EditGeometryOperations-CAMJU2Wn.js","./dragEventPipeline-Dj33NxJd.js","./meshVertexSpaceUtils-AgAbm20L.js","./MeshLocalVertexSpace-CnHk-qPr.js","./hydratedFeatures-CNHxsqRS.js","./quantityUtils-BsDK158M.js","./angularMeasurementUtils-hHgHLVYP.js","./Cyclical-Dlbl-cQK.js","./SketchLabelOptions-DnwnoaXO.js","./SnappingContext-lR2hMWGP.js","./SnappingDragPipelineStep-dx2sltqU.js","./Scheduler-i_u8qdlN.js","./debugFlags-B1LM_Apo.js","./SnappingOperation-D1hMlFdT.js","./mat2d-D9DBP-jx.js","./mat2df64-CBKYtunK.js","./quat-CP7JhygC.js","./helpMessageUtils-2XpUG8Xk.js","./helpMessageUtils3d-BpdsCwtg.js","./SketchTooltipInfo-BnqQiqHr.js","./MeshTransform-mu8wTSqx.js","./axisAngleDegrees-DdLZENJj.js","./themeUtils-C3zvZbsE.js","./jsxFactory-Cnml7uXM.js","./uuid-Cl5lrJ4c.js","./a11yUtils-ClKbIIe-.js","./unitFormatUtils-Q7ZG7HcF.js","./ByteSizeUnit-BsxeN7wM.js","./getDefaultUnitForView-BBSnYQvp.js","./quantityFormatUtils-Bo0-7oki.js","./directionModeIcons-Br5woIHu.js","./automaticAreaMeasurementUtils-BdEZtLRA.js","./geodesicMeasurementUtils-B-7dBAnY.js","./euclideanAreaMeasurementUtils-ButVfzxp.js","./earcut-D9gy186-.js","./triangle-B1tKFm7z.js","./lineSegment-v806maA5.js","./euclideanLengthMeasurementUtils-Bcu5HQVu.js","./spatialReferenceEllipsoidUtils-DBqQpPRa.js","./geodesicAreaMeasurementUtils-CfJYiWyy.js","./automaticLengthMeasurementUtils-4SpTQo4O.js","./geodesicLengthMeasurementUtils-B4BXDmbs.js","./InteractiveToolBase-rZBtMOMv.js","./interfaces-D6pIddIh.js","./SketchOptions-D7mgFOwQ.js","./boundedPlane-DuGhiiFM.js","./cimSymbolUtils-DzhKvmq_.js","./utils-UPZJIDfz.js","./defaultCIMValues-Bb-CUowV.js","./GraphicManipulator-D7rJmkQr.js","./defaults-FkBa0ybj.js","./defaultsJSON-GKolV7NZ.js","./drapedUtils--IsYcWNz.js","./colorUtils-DaPfwnk3.js","./drawUtils-BdkQO_cU.js","./hitTestSelectUtils-UXJPjatw.js","./screenUtils-BWEEmpSb.js"])))=>i.map(i=>d[i]);
import{_ as u}from"./index-4eY77cms.js";import{g as v,k as y,e as l,aA as g,aB as f,r as n,m as s,a as T}from"./Accessor-BmwT4B0c.js";import{P as d}from"./reactiveUtils-XM7cS2OP.js";import{h as w}from"./UpdatingHandles-CzJ4c3KT.js";import{_ as h}from"./InputManager-DZ3jJnlx.js";import"./Evented-Dw4_VOGn.js";import"./SimpleObservable-CvOkykwM.js";import"./Queue-BQesTh_6.js";import"./signal-CySMLEX9.js";const c={redo:"r",undo:"z"},p=Symbol(),_=Symbol(),m=Symbol();let i=class extends v{constructor(t){super(t),this._tool=null,this._updatingHandles=new w,this.enabled=!1,this._onPointerMove=y(async e=>{const o=await this._updatingHandles.addPromise(this._findElementAtScreenPoint(e));this.destroyed||(this.removeHandles(_),o&&o!==this.selectedElement&&(this.view.cursor="pointer",this.addHandles(l(()=>this.view.cursor=null),_)))})}initialize(){this.addHandles(g(this._updatingHandles)),this._updatingHandles.add(()=>this.enabled,t=>this._setEnabled(t),d),this._updatingHandles.add(()=>this._preferredInteractionTool,()=>this._preferredInteractionToolChanged())}get _validatedSelectedElement(){const t=this.selectedElement;if(!t)return null;const{layer:{source:e}}=this;return e?"hasElement"in e?e.hasElement(t)?t:null:e===t?t:null:null}get _preferredInteractionTool(){var t;return((t=this.options)==null?void 0:t.tool)??"transform"}get updating(){return this._updatingHandles.updating}_setEnabled(t){if(this.removeHandles(p),!t)return;const{view:e}=this;this.addHandles([e.on("immediate-click",o=>this._onClick(o),h.TOOL),e.on("pointer-move",o=>this._onPointerMove(o).catch(()=>{}),h.TOOL),e.on("key-down",o=>{var a,r;o.key===c.undo&&((a=this._tool)!=null&&a.canUndo())&&(this._tool.undo(),o.stopPropagation()),o.key===c.redo&&((r=this._tool)!=null&&r.canRedo())&&(this._tool.redo(),o.stopPropagation())}),this._updatingHandles.add(()=>this._validatedSelectedElement,o=>this._selectedElementChanged(o),d),l(()=>{e.cursor=null,this._removeTool()})],p)}async _findElementAtScreenPoint(t){const e=(await this.view.hitTest(t,{include:[this.layer]})).results[0];return(e==null?void 0:e.type)==="media"?e.element:null}async _onClick(t){await this._updatingHandles.addPromise(t.async(async()=>{const e=await this._findElementAtScreenPoint(t);this.destroyed||(e&&t.stopPropagation(),this.selectedElement=e,this.selectedElement&&(this.view.cursor=null))}))}_preferredInteractionToolChanged(){const{_tool:t}=this;t&&(this._preferredInteractionTool===t.type||this._updatingHandles.addPromise(this._recreateTool()))}async _recreateTool(){this.removeHandles(m),this._removeTool();const t=this._validatedSelectedElement;if(!t)return;const e=new AbortController;this.addHandles(f(e),m);const{TransformTool:o,ControlPointsTransformTool:a}=await u(()=>import("./editingTools-JEBHcv68.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154]),import.meta.url);if(e.signal.aborted)return;const{view:r}=this;switch(this._preferredInteractionTool){case"transform":this._tool=new o({target:t,view:r});break;case"reshape":this._tool=new a({mediaElement:t,view:r})}this.addHandles(l(()=>{this._tool&&(r.tools.remove(this._tool),this._tool=null)}),this._tool),r.addAndActivateTool(this._tool)}_removeTool(){this._tool&&this.removeHandles(this._tool)}async _selectedElementChanged(t){t!=null&&t.georeference?await this._updatingHandles.addPromise(this._recreateTool()):this._removeTool()}};n([s()],i.prototype,"_validatedSelectedElement",null),n([s()],i.prototype,"_preferredInteractionTool",null),n([s({constructOnly:!0})],i.prototype,"view",void 0),n([s({constructOnly:!0})],i.prototype,"layer",void 0),n([s()],i.prototype,"selectedElement",void 0),n([s()],i.prototype,"enabled",void 0),n([s()],i.prototype,"options",void 0),n([s()],i.prototype,"updating",null),i=n([T("esri.views.2d.layers.support.MediaLayerInteraction")],i);export{i as MediaLayerInteraction};
