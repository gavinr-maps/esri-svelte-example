const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./bufferLineToPolygon-usQh-YVJ.js","./builderUtils-Dksd-iQf.js","./Accessor-BHnuXKD2.js","./Point-XGrwlf63.js","./cast-BA_-jlhc.js","./index-tefRSezt.js","./index-Cx51aysm.css","./JSONSupport-CGdeqxpk.js","./writer-B2bQV2uU.js","./FeatureTemplates-C1EjsYST.js","./reactiveUtils-BR0C1Kq4.js","./Evented-DCWccWGU.js","./SimpleObservable-7oieNGD8.js","./layerUtils-dJgsXxkC.js","./jsxFactory-CLjKarlq.js","./intl-Do3GEEJ7.js","./Promise-CmQqe-ke.js","./uuid-Cl5lrJ4c.js","./UpdatingHandles-ptqz1ck8.js","./Portal-CTRRujjZ.js","./Extent-CBBGeHb-.js","./ReactiveMap-Dwhwbx9R.js","./utils-Cf-KB5Fk.js","./VersionManagementService-Cw_pm6KK.js","./Identifiable-BrT7zvUW.js","./applyEditsUtils-B-dfj_XI.js","./Graphic-CFXUQZlS.js","./Clonable-DvJsj5LF.js","./opacityUtils-CSd4XoR2.js","./enumeration-Cr5WIZs4.js","./Color-gncXBiLc.js","./colorUtils-Rxh2V3ai.js","./mathUtils-DV9iOXpW.js","./ActionToggle-__-l4AdQ.js","./jsonUtils-Cu7OBRmN.js","./Polyline-BmuD2-ZN.js","./typeUtils-BSg8Y507.js","./TextSymbol-BQ_NW9Xo.js","./screenUtils-_ZIvrt5o.js","./collectionUtils-CbaToa73.js","./vec3f64-BLpZdpfb.js","./aaBoundingBox-CeBivBRq.js","./projection-B2I9Bzj_.js","./projectBuffer-DOU0xvVi.js","./geodesicConstants-yASAK_zX.js","./MeshTransform-CIhaTwDv.js","./mat4-Fi6iAz29.js","./common-DQOJ18NT.js","./mat4f64-Dk4dwAN8.js","./quat-4pa1e6ds.js","./mat3f64-BBpwCtoL.js","./quatf64-CCm9z-pX.js","./vec32-Dvg_eL9J.js","./vec42-YcqnINSP.js","./axisAngleDegrees-8Sw4vC28.js","./editingSupport-Dr0ErgB3.js","./normalizeUtils-XRAPXbWa.js","./normalizeUtilsCommon-D0zPTJCj.js","./utils-Cy8wFNQo.js","./utils-CkSELPnj.js","./EditBusLayer-Cx9SJosU.js","./infoFor3D-CsJzgCF0.js","./featureLayerUtils-BzWCGee1.js","./Field-Cyk7Ur5d.js","./fieldType-L-VlbZqy.js","./featureQueryAll-xezK3WCp.js","./Query-DCBIeen2.js","./FullTextSearch-BWm_kPUE.js","./TimeExtent-J5qnUFx_.js","./timeUtils-D2X862bk.js","./SimpleRenderer-gSw1WaJS.js","./commonProperties-bGHL1a5M.js","./colorRamps-Dkx8zIVn.js","./SizeVariable-IzD1bP2e.js","./visualVariableUtils-Bp9QCb8E.js","./lengthUtils-DjJgJFRg.js","./ColorStop-CDpeFWOz.js","./jsonUtils-Dzgxk9pw.js","./defaults-Dwxdhopq.js","./defaultsJSON-GKolV7NZ.js","./UniqueValueRenderer-Cri3tgP5.js","./diffUtils-CMkuJvD2.js","./RendererLegendOptions-mgfHoilI.js","./styleUtils-BB-zx7mT.js","./AttachmentQuery-BceVlzuF.js","./NormalizationBinParametersMixin-D6iHLB7I.js","./RelationshipQuery-W-4bfgaH.js","./serviceCapabilitiesUtils-BuKg0yWx.js","./PortalItem-CXk7DqVv.js","./portalItemUtils-rm7sAgcm.js","./editsZScale-BKYnJc2O.js","./catalogUtils-CK4eMvD1.js","./globalCss-CZa70j6i.js","./Heading-DYbI16WN.js","./symbolUtils-C5ImIHMe.js","./utils-9nq77ifz.js","./jsonUtils-TjZmCq6l.js","./utils-DYurMneM.js","./mat4f32-DcsiF_Rp.js","./cimSymbolUtils-azhJhO4Y.js","./utils-B91u8350.js","./defaultCIMValues-DII_GG3u.js","./enums-BJSSbDkD.js","./LRUCache-DS2O1kTf.js","./MemCache-CDoaVBHf.js","./colorUtils-BAowQmkN.js","./vec4f64-o2zAXfmz.js","./mat2df32-orApM5a3.js","./mat2d-D9DBP-jx.js","./webStyleSymbolUtils-DEYm8EyF.js","./devEnvironmentUtils-CnNDiFMM.js","./webStyleAcceptedFormats-CG7ZQ6BV.js","./vmEvent-D4Ubqkbq.js","./createPresetServiceEdit-D3Rj5pNI.js","./affineTransformOperator-Dn3tCTal.js","./SimpleGeometryCursor-B92kdZ15.js","./Transformation2D-BSBl8u-h.js","./apiConverter-CBpLPeKU.js","./ProjectionTransformation-DzMxxvj3.js","./jsonConverter-BddGRRgO.js","./Transformation-BtUKefpQ.js","./SketchOptions-92Ul6Fzp.js","./SketchLabelOptions-CwtwEofC.js","./angularMeasurementUtils-lDJJxFDs.js","./Cyclical-CPiNl4ru.js","./quantityUtils-1LswOhxZ.js","./vec2-maR1OrZI.js","./vec2f64-Dy6m9Nrb.js","./projectVectorToVector-dS8io47t.js","./projectPointToVector-BS0u8fq6.js","./geodesicUtils-Bh_GX0Qj.js","./Attachments-DB43Iyjz.js","./unitFormatUtils-Dbksq3U5.js","./ByteSizeUnit-BsxeN7wM.js","./AttachmentInfo-mF-dnIj-.js","./featureUtils-x0Mr5AqG.js","./utils-DLmnG8WZ.js","./timeZoneUtils-COos5xIr.js","./attachmentUtils-CmLhj4mw.js","./legacyIcon-CEIp6Pa9.js","./FeatureForm-COyl7SU7.js","./FieldInput-BOCCTm7A.js","./featureFormUtils-BLdtQWdc.js","./formUtils-DXUHP5lI.js","./dateUtils-DDHuDOGz.js","./substitute-D1XJWgT5.js","./FeatureRelationshipViewModel-D-pAIuUr.js","./NetworkElement-Dpf4duUb.js","./FeatureLayerBase-DsahGowz.js","./layerContainerType-C5CzMsLd.js","./HeightModelInfo-B3GZyQFz.js","./commonProperties-C0eC30J9.js","./ElevationInfo-Di4W6v5U.js","./unitConversionUtils-C4AR5obr.js","./AttributeTableTemplate-B7rH2qLr.js","./LayerFloorInfo-BXAHB-yQ.js","./Relationship-BBBusoKs.js","./editableLayers-BZGjz8nI.js","./ReactiveSet-CoXPgSt3.js","./arcade-CPGGAx3L.js","./ImmutableArray-BPVd6ESQ.js","./TimeOnly-yGYcAQQJ.js","./FeatureLayer-9fyQxXYm.js","./MultiOriginJSONSupport-nGLpCFeg.js","./Layer-C9uQlTBT.js","./workers-D8Q3pEzK.js","./Queue-BOnccek2.js","./queryZScale-DwN6mTru.js","./FeatureSet-DpCN730g.js","./APIKeyMixin-Btq102Nx.js","./ArcGISService-BHkTabnw.js","./ScaleRangeLayer-C59zG_yk.js","./CustomParametersMixin-uo3x70vd.js","./DisplayFilteredLayer-BFGyM6i5.js","./scaleUtils-CfLu-sg1.js","./displayFilterUtils-DV_nOx_h.js","./FeatureEffectLayer-D3Dl2pXD.js","./FeatureEffect-xxsfLT-y.js","./FeatureFilter-DEE1jTWq.js","./FeatureReductionLayer-x8j38_gH.js","./FeatureReductionSelection-BpUGF9oj.js","./labelingInfo-BvMdv93l.js","./labelUtils-Dq8OkaT-.js","./jsonUtils-DD1NMzWj.js","./typeUtils-CfF4cYo5.js","./ClassBreaksRenderer-BBSNkSFx.js","./Version-9k2AOv05.js","./FieldsIndex-DFdVonga.js","./HeatmapColorStop-c4wClnpW.js","./heatmapUtils-DA7NmY3d.js","./MD5-C9MwAd2G.js","./OperationalLayer-Bts9W3HA.js","./OrderedLayer-BP2hvfL_.js","./OrderByInfo-E-O9nvtm.js","./PortalLayer-jhi5QQgB.js","./RefreshableLayer-Cn2UpWQD.js","./TemporalLayer-CYEvmdjr.js","./TimeInfo-LjqhhubF.js","./TimeInterval-BDTTJ9Uw.js","./TrackableLayer-D6paP6wl.js","./FeatureTemplate-DqbLvkbZ.js","./FeatureType-DjGGrg1i.js","./fieldProperties-B9JP3-ue.js","./TitleCreator-Zm6TQ_ec.js","./versionUtils-DSsYFI36.js","./styleUtils-BQ_uVsZf.js","./popupUtils-pQ0CVidQ.js","./interfaces-CL2NbQte.js","./isConnectivityMidspan-DZikspN3.js","./Spinner-BaW8zyoW.js","./AnchorElementViewModel-CqI4lmqA.js","./GraphicsLayer-Acqd2VFm.js","./GraphicsCollection-CkliHSk1.js","./SnappingManager-CF4NflXd.js","./elevationInfoUtils-RSZ4Logn.js","./RightAngleSnappingHint-CCcBBYgG.js","./InputManager-Bs9UE-jw.js","./signal-DSa0yokC.js","./keybindings-DrKrBFID.js","./utils-D02V2_jH.js","./plane-4dpuo6-e.js","./mathUtils-B9R7G-2c.js","./sphere-DQxj5tsv.js","./mat3-CR8GKnhD.js","./geometry2dUtils-vtViF5g_.js","./viewUtils-Ce2x26K8.js","./networkFieldUtils-iOtCEyIS.js","./typeUtils-CUNOqFiB.js","./helpMessageUtils-2XpUG8Xk.js","./HighlightHelper-CgZccPYQ.js","./layerUtils-BS1Di3Pm.js","./HighlightDefaults-ESbuT2uR.js","./layerViewUtils-tkZ5z_iY.js","./drapedUtils-DFAbG8en.js","./GraphicState-BClxgc_s.js","./DrawingMode-Cvvf0VVz.js","./hitTestSelectUtils-UXJPjatw.js","./SketchViewModel-BHWV3FYM.js","./screenUtils-DyhV4TAA.js","./utils-BuPEKwV4.js","./tableUtils-7y4ZQbZ4.js","./Association-OQzB-QIu.js","./ViewingMode-Dodu7ZZk.js","./VisibleElements-zVLz8fQT.js","./directionModeIcons-Br5woIHu.js","./LabeledSwitch-CbCItYC2.js","./layerListUtils-BIu86t6C.js","./LayerListViewModel-DeGRGHR_.js","./utils-BQBvadb7.js","./ListItem-CRqB-Xtr.js","./widget-AxfSz_k8.js","./uploadAssetErrors-B15urE_S.js","./useWidget-Dlf3SkC7.js","./index-BkKcLxWB.js","./component-utils-DWY0IMHC.js","./bufferOperator-B9bDeO2F.js","./operatorBuffer-DiRBZm0B.js","./GeometryCleaner-BEJM7I4l-TEj6JpSb.js","./OperatorGeneralize-CrRht8fJ.js","./bufferPointToPolygon-C09eoiI0.js","./bufferPolygonToPolygon-DlKg2cDl.js","./equallySpaced-LMuklWk6.js","./offsetUtils-rPMVLhjX.js","./shapeUtils-CBsrJolv.js","./offsetOperator-DQhzjFlA.js","./operatorOffset-Dykeaev0.js","./offsetLine-EPOFNAre.js","./offsetPrimaryLine-EPOFNAre.js","./pointAtAllVerticesOfLine-Nirk92ti.js","./pointAtBeginningOfLine-Bb-fO-Ro.js","./pointAtBeginningOfRadial-Bz4iMVRE.js","./pointAtEndOfLine-z4I4GfwQ.js","./pointAtInteriorVertices-ol_YY45-.js","./pointAtIntersectionVerticesOfLine-21G_Fwi2.js","./intersectsOperator-CIF47u7O.js","./OperatorIntersects-Pz32vAkK.js","./pointAtNotBeginningOfLine-CxJVUWTG.js","./pointAtNotEndOfLine-CY2uLV76.js","./pointAtPolygonCentroid-DV9LssTd.js","./pointAtPolygonNotStart-BLprSpIw.js","./pointAtPolygonStart-DneIeaq3.js","./pointIdentity-DLtH-msP.js","./pointPrimaryIdentity-DLtH-msP.js","./polygonBoundary-WqRitaYu.js","./polygonBoundaryTwoPoint-DkXeOMC_.js","./polygonIdentity-BtZrJOOi.js","./polygonPrimaryIdentity-BtZrJOOi.js","./polygonVertices-CW6xhqHQ.js","./twoPointLines-BOS67evd.js","./symbolLayerUtils-CinKExLh.js","./Upload-DHEByoeR.js","./progressUtils-BmRXf5wX.js","./helpMessageUtils3d-GWzBuIWZ.js","./index-cLdK6V3t.js","./index-CjrYEQXz.js","./guid-ejniuQmw.js","./useT9n-CJAswmP1.js","./ref-Ccn4I0kT.js","./directive-helpers-C0aXnQdc.js","./observers-BdozwIHb.js","./dom--xxYYVQF.js","./index-DVEy4f7w.js","./index-73bQemcW.js","./keyed-CdPY5MOf.js","./interactive-B8siLByk.js","./loadable-DOQnSSjG.js","./component-CFGnHAqh.js","./index-BtF7Kdcs.js","./static-g4FJ4v8I.js","./form-B15gmg4q.js","./label-BLne9qNB.js","./index-BIkUAggI.js","./index-Df8-0rWt.js","./floating-ui-BkLjHVN3.js","./debounce-DbkufipY.js","./key-CZcQa38B.js","./openCloseComponent-dw_x67D_.js","./dynamicClasses-pKEMtFzB.js","./index-BfAp5_ga.js","./resources6-Cs2_VmEC.js","./index-DIB7yhJF.js","./index-nrWOrFCt.js","./resources4-Crg87oFz.js","./index-BTWxftj5.js","./index-1KX2ROWA.js","./index-DbjTV4Hc.js","./index-Ch_sYKt7.js","./index-svtat3zr.js","./index-Wn4pOF_U.js","./live-BIBBLA6F.js","./locale-CXx8I9ox.js","./Validation-O1TFEQW-.js","./input-DI9tZAPS.js","./filter-Cs9GmjDF.js","./escapeRegExp-UP7ghjt8.js","./utils-CYuC4O71.js","./index-DxcTRSkS.js","./index-CQ1gJMW-.js","./index-CCqZjfSZ.js","./index-DIp-v4qk.js","./FloatingArrow-D9X-HbKW.js","./useFocusTrap-ENcZoC4L.js","./focusTrapComponent-Br_3Mz8_.js","./array-BbE1dLa5.js","./index-ujykA9Eq.js","./customElement-kBYuBfHB.js","./index-DrimfvRg.js","./index-d5Yy4krW.js","./resources5-SciNIBSe.js","./index-Bb6Bx1n-.js","./index-BnH8ZLT5.js","./core-zHisM37C.js","./utils3-CmcdYP7V.js","./index-GVt5zfuo.js","./text-CbTMlb2o.js","./index-BGRynF8w.js","./index-D130RxMY.js","./index-Bej-0mbI.js","./index-1VSl9HgO.js","./index-D1jScw4i.js","./index-DSiQ4rVy.js","./Sketch-Dgtm9JMQ.js","./mat2df64-CBKYtunK.js","./surfaceCoordinateSystems-DRgCZXAE.js","./memoize-DsJmrG76.js","./dehydratedFeatureComparison-Bbl7iMhI.js","./EditGeometryOperations-C5kkQVhH.js","./dragEventPipeline-D_Ldto1o.js","./meshVertexSpaceUtils-SW0WEjNN.js","./MeshLocalVertexSpace-C0YDTRex.js","./hydratedFeatures-BVVSs98j.js","./SnappingContext-lR2hMWGP.js","./SnappingDragPipelineStep-C7nIAEz_.js","./Scheduler-B_GuBefw.js","./debugFlags-ZrDyTcDc.js","./SnappingOperation-DhUO_0vk.js","./createUtils-CfrW4il_.js","./Circle-aC-JFV1q.js","./geometryEngine-CtEcpiHE.js","./geometryEngineBase-yFIvKOkM.js","./_commonjsHelpers-DCkdB7M8.js","./hydrated-Dw-Mfo_Y.js","./InteractiveToolBase-DNJTN0p5.js","./interfaces-D6pIddIh.js"])))=>i.map(i=>d[i]);
import{_,i as so,L as no,u as lo,c as co,n as uo,a as po}from"./index-tefRSezt.js";import{o as Ae,s as F,S as _i,B as ae,bB as ho,r as s,m as l,a as A,g as ne,k as Ne,j as qe,bs as mo,D as De,e as S,i as oe,a4 as si,a6 as pa,V as yo,a3 as bt,aO as fo,G as je,t as se,c as go,ad as wo,a7 as Dt,bX as vo,aB as Bt,b2 as _o,l as Ot,N as ft,H as ni,bY as $i,av as Oi,P as bo}from"./Accessor-BHnuXKD2.js";import"./intl-Do3GEEJ7.js";import{V as xe,d as k,w as j,v as ke,a as at,p as _e,P as H,A as Ke,C as Rt}from"./reactiveUtils-BR0C1Kq4.js";import{l as zt,a as ko}from"./SketchOptions-92Ul6Fzp.js";import{A as ha,I as Fo}from"./Attachments-DB43Iyjz.js";import{n as ma,t as Pi,e as Io}from"./FeatureForm-COyl7SU7.js";import{v as ya,g as bi,w as nt,A as kt,d as gt,T as fa,t as To,c as ga,y as li,H as wa,l as Ao,b as Co,s as va,a as Mo,F as Eo,m as So}from"./FeatureTemplates-C1EjsYST.js";import{p as Lo,h as $o}from"./Spinner-BaW8zyoW.js";import{c as le,n as m,v as di,i as rt,e as B,O as lt}from"./jsxFactory-CLjKarlq.js";import{i as _a}from"./Evented-DCWccWGU.js";import{h as ht}from"./UpdatingHandles-ptqz1ck8.js";import{h as Zt}from"./GraphicsLayer-Acqd2VFm.js";import{e as ci}from"./editableLayers-BZGjz8nI.js";import{c as Be,l as Se,r as ki,k as ot,s as Oo,B as Po,O as Vo,x as Wo}from"./layerUtils-dJgsXxkC.js";import{P as No,o as xo,ad as Do,a as ba}from"./cast-BA_-jlhc.js";import{p as Ro,d as ka,I as Uo}from"./SnappingManager-CF4NflXd.js";import{b as Le}from"./Graphic-CFXUQZlS.js";import{r as ze}from"./uuid-Cl5lrJ4c.js";import{w as Ho}from"./Extent-CBBGeHb-.js";import{P as Fa,u as Go,j as qo}from"./Polyline-BmuD2-ZN.js";import{j as Ia,g as jo,c as Kt,P as Bo,O as zo,F as Zo}from"./Point-XGrwlf63.js";import{l as Qo,f as Jo}from"./jsonUtils-Cu7OBRmN.js";import{e as Ko}from"./networkFieldUtils-iOtCEyIS.js";import{t as Ce}from"./typeUtils-CUNOqFiB.js";import{R as Ut}from"./symbolUtils-C5ImIHMe.js";import{e as Xo}from"./helpMessageUtils-2XpUG8Xk.js";import{p as wt}from"./HighlightHelper-CgZccPYQ.js";import{m as Qt}from"./HighlightDefaults-ESbuT2uR.js";import{s as Xe}from"./ReactiveMap-Dwhwbx9R.js";import{d as Yo,l as Ta,Q as er}from"./featureFormUtils-BLdtQWdc.js";import{h as tr}from"./Color-gncXBiLc.js";import{e as Xt}from"./screenUtils-_ZIvrt5o.js";import{y as ir}from"./diffUtils-CMkuJvD2.js";import{m as Fi}from"./Portal-CTRRujjZ.js";import{p as Ii}from"./Promise-CmQqe-ke.js";import{o as Aa}from"./writer-B2bQV2uU.js";import{c as ar,l as or}from"./VersionManagementService-Cw_pm6KK.js";import{S as Ca}from"./JSONSupport-CGdeqxpk.js";import{r as rr}from"./utils-D02V2_jH.js";import{r as sr}from"./enumeration-Cr5WIZs4.js";import{l as nr}from"./typeUtils-BSg8Y507.js";import{k as lr,a as Ma,v as Ea,A as Yt,F as Vi,g as Wi,T as Ni,h as xi,y as dr,x as cr,p as ur}from"./opacityUtils-CSd4XoR2.js";import{o as pr,r as hr}from"./drapedUtils-DFAbG8en.js";import{m as mr}from"./lengthUtils-DjJgJFRg.js";import{h as yr,a as fr,i as gr,y as wr}from"./visualVariableUtils-Bp9QCb8E.js";import{d as ei,S as vr,y as _r}from"./TextSymbol-BQ_NW9Xo.js";import{u as br}from"./jsonUtils-Dzgxk9pw.js";import{e as Sa}from"./GraphicState-BClxgc_s.js";import{e as kr}from"./DrawingMode-Cvvf0VVz.js";import{t as Fr,s as La}from"./hitTestSelectUtils-UXJPjatw.js";import{a as Ir,y as Ti}from"./SketchViewModel-BHWV3FYM.js";import{s as Di}from"./Queue-BOnccek2.js";import{p as $a}from"./utils-BuPEKwV4.js";import{_ as Tr}from"./InputManager-Bs9UE-jw.js";import{a as Ar}from"./catalogUtils-CK4eMvD1.js";import{isAssociatedFeatureSupportedLayer as Cr,findUtilityNetwork as Mr,isGraphicForRelatableFeatureSupportedLayer as Er,isRelatableFeatureSupportedLayer as Sr}from"./featureUtils-x0Mr5AqG.js";import{u as Lr}from"./tableUtils-7y4ZQbZ4.js";import{d as $r}from"./Association-OQzB-QIu.js";import{p as Or}from"./NetworkElement-Dpf4duUb.js";import{v as Oa}from"./elevationInfoUtils-RSZ4Logn.js";import{n as Pr}from"./layerViewUtils-tkZ5z_iY.js";import{a as Vr}from"./infoFor3D-CsJzgCF0.js";import{l as Wr}from"./ViewingMode-Dodu7ZZk.js";import{n as Ai,l as Nr,k as xr,f as Dr,p as Rr,s as Ur}from"./VisibleElements-zVLz8fQT.js";import{n as Hr,s as Gr,r as qr}from"./FieldInput-BOCCTm7A.js";import{s as Ht}from"./substitute-D1XJWgT5.js";import{e as vt,n as mt}from"./Heading-DYbI16WN.js";import{l as jr,m as Br,i as zr}from"./uploadAssetErrors-B15urE_S.js";import{e as Gt}from"./globalCss-CZa70j6i.js";import{e as Zr}from"./vmEvent-D4Ubqkbq.js";import{P as Qr}from"./useWidget-Dlf3SkC7.js";const $e="esri-editor",Ve={base:$e,helpMessage:`${$e}__help-message`,updateActions:`${$e}__update-actions`,updateActionsList:`${$e}__update-actions-list`,featureTemplatesContainer:`${$e}__feature-templates-container`,templateItemContentEnd:`${$e}__template-item-content-end`,sketchContainer:`${$e}__sketch-container`,pendingFeatureListIcon:`${$e}__pending-feature-list-icon`},Gd=100;function Jr(e){return e.type==="point"}function qd(e){return e.type==="polygon"}function jd(e){return e.type==="polyline"}function Kr(e){return!!e&&e.type==="radial"}function Ci(e){let t=null;for(const i of e)if(i.graphic.geometry){const a=i.graphic.geometry,o=Jr(a)?new Ho({spatialReference:a.spatialReference,xmin:a.x,xmax:a.x,ymax:a.y,ymin:a.y}):a.extent;t=t==null?o==null?void 0:o.clone():t.union(o.extent)}return t}function Mi(e){var i;const t=new Map;for(const a of e)(i=Ae(t,a.id,()=>({addFeatures:[],id:a.id,identifierFields:{globalIdField:a.layer.globalIdField,objectIdField:a.layer.objectIdField}})).addFeatures)==null||i.push(a.graphic);return[...t.values()]}function Pa({edits:e,geometry:t,relationships:i,tag:a="",template:o}){if(Kr(t)){const c=t.geometry.clone();for(const u of c.paths)Pa({geometry:new Fa({spatialReference:c.spatialReference,paths:[u],hasZ:c.hasZ,hasM:c.hasM}),template:o,edits:e,relationships:i,tag:a});return}const{definition:r,layer:n}=o;t=Xr(t,n);const d=new Le({attributes:r.defaultValues?{...r.defaultValues}:{},geometry:t,sourceLayer:n});if(Ui(d,n),n.globalIdField&&(d.attributes[n.globalIdField]=ze()),e.push({id:n.layerId,graphic:d,tag:a,layer:n}),r.relationships.length!==0)for(const c of r.relationships||[]){const u=c.template;if(c.relationshipMetadata==null||!ya(u))throw new F("shared-template:missing-relationship-metadata-or-definition","Relationship part must have metadata and a fully loaded template with definition");const{layer:p}=u,h=new Le({attributes:{...r.defaultValues},sourceLayer:p});Ui(h,p),p.globalIdField&&(h.attributes[p.globalIdField]=ze()),e.push({graphic:h,id:p.layerId,tag:"",layer:p}),i.push({...c.relationshipMetadata,sourceGraphic:d,destinationGraphic:h})}}function Xr(e,t){if(!e)return null;if(e.hasZ===t.hasZ&&e.hasM===t.hasM)return e;switch(e.type){case"point":return new Ia({spatialReference:e.spatialReference,x:e.x,y:e.y,...t.hasZ?e.hasZ?{z:e.z}:{z:At(t)}:{},...t.hasM?e.hasM?{m:e.m}:{m:Ct(t)??void 0}:{}});case"polygon":return new qo({spatialReference:e.spatialReference,rings:Ri(e.rings,t.hasZ,t.hasM,At(t),Ct(t),e.hasM?e.hasZ?3:2:-1,e.hasZ?2:-1),hasZ:t.hasZ,hasM:t.hasM});case"polyline":return new Fa({spatialReference:e.spatialReference,paths:Ri(e.paths,t.hasZ,t.hasM,At(t),Ct(t),e.hasM?e.hasZ?3:2:-1,e.hasZ?2:-1),hasZ:t.hasZ,hasM:t.hasM});case"multipoint":return new Go({spatialReference:e.spatialReference,hasZ:t.hasZ,hasM:t.hasM,points:Va(e.points,t.hasZ,t.hasM,At(t),Ct(t),e.hasM?e.hasZ?3:2:-1,e.hasZ?2:-1)});default:return e}}function Ri(e,t,i,a,o,r,n){const d=[];for(const c of e)d.push(Va(c,t,i,a,o,r,n));return d}function Va(e,t,i,a,o,r,n){const d=[];for(const c of e){const u=[c[0],c[1]];t&&(u[2]=n>-1?c[2]:a),i&&(u[t?3:2]=r>-1?c[r]:o),d.push(u)}return d}function At(e){var t;return((t=e.capabilities.editing)==null?void 0:t.zDefault)??0}function Ct(e){return e.capabilities.editing.supportsUpdateWithoutM?void 0:0}function Ui(e,t){Be(t)&&(e.sourceLayer=t.findSublayerForFeature(e))}const Yr={"buffer-line-to-polygon":()=>_(()=>import("./bufferLineToPolygon-usQh-YVJ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258]),import.meta.url),"buffer-point-to-polygon":()=>_(()=>import("./bufferPointToPolygon-C09eoiI0.js"),__vite__mapDeps([259,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258]),import.meta.url),"buffer-polygon-to-polygon":()=>_(()=>import("./bufferPolygonToPolygon-DlKg2cDl.js"),__vite__mapDeps([260,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258]),import.meta.url),"connection-point":()=>_(()=>import("./connectionPoint-zsfNqxJ9.js"),[],import.meta.url),"equally-spaced":()=>_(()=>import("./equallySpaced-LMuklWk6.js"),__vite__mapDeps([261,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,262,263,264,265]),import.meta.url),"offset-line":()=>_(()=>import("./offsetLine-EPOFNAre.js"),__vite__mapDeps([266,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,262,263,264,265]),import.meta.url),"offset-primary-line":()=>_(()=>import("./offsetPrimaryLine-EPOFNAre.js"),__vite__mapDeps([267,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,262,263,264,265]),import.meta.url),"point-at-all-vertices-of-line":()=>_(()=>import("./pointAtAllVerticesOfLine-Nirk92ti.js"),__vite__mapDeps([268,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,262,263,264,265]),import.meta.url),"point-at-beginning-of-line":()=>_(()=>import("./pointAtBeginningOfLine-Bb-fO-Ro.js"),__vite__mapDeps([269,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,262,263,264,265]),import.meta.url),"point-at-beginning-of-radial":()=>_(()=>import("./pointAtBeginningOfRadial-Bz4iMVRE.js"),__vite__mapDeps([270,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,262,263,264,265]),import.meta.url),"point-at-end-of-line":()=>_(()=>import("./pointAtEndOfLine-z4I4GfwQ.js"),__vite__mapDeps([271,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,262,263,264,265]),import.meta.url),"point-at-interior-vertices":()=>_(()=>import("./pointAtInteriorVertices-ol_YY45-.js"),__vite__mapDeps([272,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,262,263,264,265]),import.meta.url),"point-at-intersection-vertices-of-line":()=>_(()=>import("./pointAtIntersectionVerticesOfLine-21G_Fwi2.js"),__vite__mapDeps([273,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,262,263,264,265,274,275]),import.meta.url),"point-at-not-beginning-of-line":()=>_(()=>import("./pointAtNotBeginningOfLine-CxJVUWTG.js"),__vite__mapDeps([276,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,262,263,264,265]),import.meta.url),"point-at-not-end-of-line":()=>_(()=>import("./pointAtNotEndOfLine-CY2uLV76.js"),__vite__mapDeps([277,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,262,263,264,265]),import.meta.url),"point-at-polygon-centroid":()=>_(()=>import("./pointAtPolygonCentroid-DV9LssTd.js"),__vite__mapDeps([278,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254]),import.meta.url),"point-at-polygon-not-start":()=>_(()=>import("./pointAtPolygonNotStart-BLprSpIw.js"),__vite__mapDeps([279,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,263]),import.meta.url),"point-at-polygon-start":()=>_(()=>import("./pointAtPolygonStart-DneIeaq3.js"),__vite__mapDeps([280,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,263]),import.meta.url),"point-identity":()=>_(()=>import("./pointIdentity-DLtH-msP.js"),__vite__mapDeps([281,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254]),import.meta.url),"point-primary-identity":()=>_(()=>import("./pointPrimaryIdentity-DLtH-msP.js"),__vite__mapDeps([282,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254]),import.meta.url),"polygon-boundary":()=>_(()=>import("./polygonBoundary-WqRitaYu.js"),__vite__mapDeps([283,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,263]),import.meta.url),"polygon-boundary-two-point":()=>_(()=>import("./polygonBoundaryTwoPoint-DkXeOMC_.js"),__vite__mapDeps([284,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,263]),import.meta.url),"polygon-identity":()=>_(()=>import("./polygonIdentity-BtZrJOOi.js"),__vite__mapDeps([285,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254]),import.meta.url),"polygon-primary-identity":()=>_(()=>import("./polygonPrimaryIdentity-BtZrJOOi.js"),__vite__mapDeps([286,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254]),import.meta.url),"polygon-vertices":()=>_(()=>import("./polygonVertices-CW6xhqHQ.js"),__vite__mapDeps([287,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,263]),import.meta.url),"radial-lines":()=>_(()=>import("./radialLines-B3rDEnal.js"),[],import.meta.url),"two-point-lines":()=>_(()=>import("./twoPointLines-BOS67evd.js"),__vite__mapDeps([288,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,263]),import.meta.url)};function es(e){const t=Yr[e];if(!t)throw new Error(`Builder type ${e} is not supported.`);return t()}const Hi=()=>ae.getLogger("esri.editing.sharedTemplates.executor.createTemplateExecutor"),Qe="globalid";async function ts(e){if(!ya(e))throw new F("template-executor:template-not-loaded","The template must be loaded before it can be executed.");if(bi(e))return is(e);if(nt(e))return as(e);if(kt(e))return rs(e);throw new F("template-executor:unsupported-template-type","The template type is not supported.")}function is(e){return t=>{const i=[],a=[];Pa({geometry:t,template:e,edits:i,relationships:a});const o=Ci(i);return{edits:Mi(i),relationships:a,primary:i[0]??null,featureExtent:o,rotationPoint:(o==null?void 0:o.center)??null}}}async function as(e){const{definition:t}=e,i=await Promise.all(t.allParts.map(os));return(a,o)=>{const r=[],n=[],d=new Set,c=()=>{if(t.createUtilityNetworkAssociations&&o==="completion"){const{utilityNetwork:h,utilityNetworkAssociationsTable:y}=t;h&&y?ss({associationGraphics:d,associationsTable:y,edits:r,relationships:n,utilityNetworkHelper:h}):Hi().warn("Unable to create utility network associations between group template features. The utility network or its associations table is unavailable.")}const p=Ci(r);return{associationGraphics:d,edits:Mi(r),relationships:n,primary:r[0]??null,featureExtent:p,rotationPoint:(p==null?void 0:p.center)??null}};if(a==null)return Hi().warn("No geometry provided to group template executor. Result will be empty."),c();const u=i.map(p=>p({edits:r,mode:o,parentTemplate:e,relationships:n,shape:a})).filter(_i);return u.length===0?c():Promise.all(u).then(()=>c())}}async function os(e){const t=await es(e.builderType);return i=>t.execute({...i,templatePart:e})}async function rs(e){const{createPresetServiceEdit:t}=await _(()=>import("./createPresetServiceEdit-D3Rj5pNI.js"),__vite__mapDeps([113,2,9,5,6,10,11,12,13,4,7,14,15,16,17,18,19,8,20,3,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254]),import.meta.url);return(i,a,o=0)=>{if(!Qo(i))throw new F("template-executor:invalid-input-geometry","The input goemetry for a preset template must be a point.");const r=[],n=[],d=t({geometry:i,template:e,edits:r,relationships:n,rotation:o,mode:a});return{edits:Mi(r),relationships:n,primary:r[0]??null,featureExtent:Ci(r),rotationPoint:d}}}function ss(e){const{edits:t,utilityNetworkHelper:i}=e,a=new Map;for(const o of t)o.tag!==""&&i.layerIdToSourceIdLookup.has(o.id)&&Ae(a,o.tag,()=>[]).push(o);for(const o of a.values())if(!(o.length<2))for(let r=0;r<o.length;r++){const n=o[r];for(let d=r+1;d<o.length;d++)ns(n,o[d],e)}}function ns(e,t,i){const{associationGraphics:a,associationsTable:o,edits:r,utilityNetworkHelper:n,relationships:d}=i,c=n.findAgat(e.graphic,e.layer),u=n.findAgat(t.graphic,t.layer);if(!c||!u)return;const p=n.findRules(c).map(f=>{var g,v,w,T,b,C,L,O,V,te,ye;return((g=f.fromNetworkSource)==null?void 0:g.sourceId)!==c.networkSourceId||((v=f.fromAssetGroup)==null?void 0:v.assetGroupCode)!==c.assetGroup||((w=f.fromAssetType)==null?void 0:w.assetTypeCode)!==null&&((T=f.fromAssetType)==null?void 0:T.assetTypeCode)!==c.assetType||f.toNetworkSource.sourceId!==u.networkSourceId||((b=f.toAssetGroup)==null?void 0:b.assetGroupCode)!==u.assetGroup||f.toAssetType!==null&&((C=f.toAssetType)==null?void 0:C.assetTypeCode)!==u.assetType?f.toNetworkSource.sourceId!==c.networkSourceId||((L=f.toAssetGroup)==null?void 0:L.assetGroupCode)!==c.assetGroup||f.toAssetType!==null&&((O=f.toAssetType)==null?void 0:O.assetTypeCode)!==c.assetType||f.fromNetworkSource.sourceId!==u.networkSourceId||((V=f.fromAssetGroup)==null?void 0:V.assetGroupCode)!==u.assetGroup||((te=f.fromAssetType)==null?void 0:te.assetTypeCode)!==null&&((ye=f.fromAssetType)==null?void 0:ye.assetTypeCode)!==u.assetType?null:{rule:f,from:{agat:u,item:t},to:{agat:c,item:e}}:{rule:f,from:{agat:c,item:e},to:{agat:u,item:t}}}).filter(f=>(f==null?void 0:f.rule.ruleType)===Ce.RTJunctionEdgeConnectivity||(f==null?void 0:f.rule.ruleType)===Ce.RTEdgeJunctionEdgeConnectivity||(f==null?void 0:f.rule.ruleType)===Ce.RTContainment?null:f).filter(f=>f!==null);if(p.length===0)return;const h=Ko(o),y=new Set;for(const f of p){const g={};g[h.fromNetworkSourceId]=f.rule.fromNetworkSource.sourceId,g[h.fromGlobalId]=f.from.item.graphic.attributes[f.from.item.layer.globalIdField??Qe],g[h.fromTerminalId]=null,f.rule.fromTerminal&&(g[h.fromTerminalId]=f.rule.fromTerminal.terminalId),g[h.toNetworkSourceId]=f.rule.toNetworkSource.sourceId,g[h.toGlobalId]=f.to.item.graphic.attributes[f.to.item.layer.globalIdField??Qe],g[h.toTerminalId]=null,f.rule.toTerminal&&(g[h.toTerminalId]=f.rule.toTerminal.terminalId),g[h.associationType]=f.rule.ruleType,g[h.percentAlong]=null,g[h.isContentVisible]=f.rule.ruleType===Ce.RTContainment?1:0,g[h.status]=0,g[h.globalId]=ze();const v=`${g[h.fromNetworkSourceId]}-${g[h.fromGlobalId]}-${g[h.toNetworkSourceId]}-${g[h.toGlobalId]}-${g[h.associationType]}`;if(y.has(v))continue;y.add(v);const w=new Le({attributes:g,sourceLayer:o});a.add(w),r.push({id:o.layerId,graphic:w,tag:"",layer:o}),d.push({sourceGraphic:f.to.item.graphic,sourceLayerId:f.to.item.layer.layerId,destinationGraphic:w,destinationLayerId:o.layerId,sourceField:f.to.item.layer.globalIdField??Qe,destinationField:h.toGlobalId??Qe}),d.push({sourceGraphic:f.from.item.graphic,sourceLayerId:f.from.item.layer.layerId,destinationGraphic:w,destinationLayerId:o.layerId,sourceField:f.from.item.layer.globalIdField??Qe,destinationField:h.fromGlobalId??Qe})}}function ls(e,t){const i=e??{},a=t??{},o=new Set(Object.keys(i));ho(o,Object.keys(a));for(const r of o){const n=i[r],d=a[r];if(!Yo(n,d))return!1}return!0}function ds(e){return e==null?null:JSON.stringify(e)}let ee=class extends ne{constructor(t){super(t),this._stagedForDelete=!1,this.feature=null,this.initialFeature=null,this.submittable=!1,this.displayTitle=null,this.isAssociation=!1,this._debouncedRefreshDisplayTitle=Ne(this._refreshDisplayTitle.bind(this),100)}get attributesModified(){var t,i;return!ls((t=this.initialFeature)==null?void 0:t.attributes,(i=this.feature)==null?void 0:i.attributes)}get geometryModified(){return this._stringifyGeometry(this.feature)!==this._stringifyGeometry(this.initialFeature)}get stagedForDelete(){return this._stagedForDelete}get modified(){return this.attributesModified||this.geometryModified||this._stagedForDelete}set timeZone(t){this._set("timeZone",t),qe(this._debouncedRefreshDisplayTitle())}stageDelete(){this._stagedForDelete=!0}unstageDelete(){this._stagedForDelete=!1}trackChanges(t=this.feature){this.initialFeature=t==null?void 0:t.clone(),qe(this._debouncedRefreshDisplayTitle())}updateAttributes(t){const{feature:i}=this;i&&(i.attributes=t,this.notifyChange("attributesModified")),qe(this._debouncedRefreshDisplayTitle())}updateGeometry(t){const{feature:i}=this;i&&(i.geometry=t,this.notifyChange("geometryModified"))}_stringifyGeometry(t){const i=t==null?void 0:t.geometry;return ds((i==null?void 0:i.type)==="mesh"?{transform:i.transform,vertexSpace:i.vertexSpace}:i)}async _refreshDisplayTitle(t){const i=this.feature,a=i==null?void 0:i.sourceLayer;if(!a||!("getFeatureTitle"in a))return;const o=await a.getFeatureTitle(i,{fetchMissingFields:!1,timeZone:this.timeZone});t.aborted||(this.displayTitle=o===""?null:o)}};s([l()],ee.prototype,"_stagedForDelete",void 0),s([l()],ee.prototype,"attributesModified",null),s([l()],ee.prototype,"feature",void 0),s([l()],ee.prototype,"geometryModified",null),s([l()],ee.prototype,"initialFeature",void 0),s([l()],ee.prototype,"modified",null),s([l()],ee.prototype,"submittable",void 0),s([l()],ee.prototype,"displayTitle",void 0),s([l()],ee.prototype,"isAssociation",void 0),s([l()],ee.prototype,"timeZone",null),ee=s([A("esri.widgets.Editor.Edits")],ee);const Wa=ee,cs=()=>ae.getLogger("esri.widgets.Editor.CreateFeaturesWorkflowData");let U=class extends ne{constructor(t){super(t),this.creationInfo=null,this.editorItem=null,this.fullTemplate=null,this.parent=null,this.temporaryHighlightFeature=null,this.sketchOptions=null,this.snappingManager=null,this.templateExecutorInfo=null,this.viewModel=null,this.upload=null,this._pendingEdits=new Xe}get isSharedTemplateWorkflow(){return!!this.fullTemplate&&gt(this.fullTemplate)}get pendingFeatures(){return new xe([...this._pendingEdits.keys()])}set selectedPendingFeature(t){this._set("selectedPendingFeature",t),this.temporaryHighlightFeature=null}set timeZone(t){this._set("timeZone",t),this._pendingEdits.forEach(i=>{i.timeZone=t})}isSubmittable(t){const i=this._pendingEdits.get(t);return!!(i!=null&&i.submittable)||!!(i!=null&&i.isAssociation)}isDisplayable(t){var i;return!((i=this._pendingEdits.get(t))!=null&&i.isAssociation)}addPendingFeature(t,i=t,a={isAssociation:!1}){this.temporaryHighlightFeature=null;const{_pendingEdits:o}=this;if(o.has(t))return o.get(t);t.sourceLayer||cs().warn("source-layer-not-set","A feature added to `pendingFeatures` did not have `sourceLayer` set. This may cause problems throughout `CreateFeaturesWorkflow`.");const r=new Wa({feature:t,isAssociation:a.isAssociation});return r.trackChanges(i),o.set(t,r),r}getEditsForPendingFeature(t){return this._pendingEdits.get(t)}removePendingFeature(t){this.temporaryHighlightFeature=null;const{_pendingEdits:i}=this,a=i.get(t);a&&(a.destroy(),i.delete(t)),this.selectedPendingFeature===t&&(this.selectedPendingFeature=null)}getFeatureTitle(t){var i;return(i=this._pendingEdits.get(t))==null?void 0:i.displayTitle}};s([l()],U.prototype,"creationInfo",void 0),s([l()],U.prototype,"editorItem",void 0),s([l()],U.prototype,"fullTemplate",void 0),s([l()],U.prototype,"isSharedTemplateWorkflow",null),s([l()],U.prototype,"parent",void 0),s([l()],U.prototype,"pendingFeatures",null),s([l()],U.prototype,"selectedPendingFeature",null),s([l()],U.prototype,"temporaryHighlightFeature",void 0),s([l({constructOnly:!0})],U.prototype,"sketchOptions",void 0),s([l()],U.prototype,"snappingManager",void 0),s([l()],U.prototype,"templateExecutorInfo",void 0),s([l()],U.prototype,"viewModel",void 0),s([l()],U.prototype,"upload",void 0),s([l()],U.prototype,"timeZone",null),U=s([A("esri.widgets.Editor.CreateFeaturesWorkflowData")],U);const us=U;let ps=class extends F{constructor(t,i){super("shared-template-query-failed",`Request to fetch templates failed. templateIds: ${t.join(",")}`,{error:i}),this.templateIds=t}},hs=class extends F{constructor(t,i){const a=new Set(i.map(r=>r.templateId)),o=mo(new Set(t),a);super("shared-template-some-templates-missing",`The service failed to return templates for the following 'templateId's: ${Array.from(o).join(",")}`)}},ms=class extends F{constructor(){super("shared-template-required-properties-not-set","Values must be specified for the `definition`, `featureService`, `layer`, and `view` properties of a `SharedTemplate` in order to load it")}},ys=class extends F{constructor(){super("shared-template-definition-required-properties-not-set","The `featureService`, `makeSharedTemplateFromJSON`, and `view` properties must all be set in order to load a template definition")}},fs=class extends F{constructor(t){super("shared-template-unsupported-builder",`This template uses an unsupported builder type, '${t}'`),this.builderType=t}},gs=class extends F{constructor(t,i){super("shared-template-layer-resolver-error",`The 'layerResolver' function failed to provide any layers for template with 'templateId: ${t}'`,{error:i}),this.templateId=t}},ws=class extends F{constructor(t,i){super("shared-template-utility-network-resolver-error",`The 'utilityNetworkResolver' function threw an error while attempting to find a utility network for template with 'templateId: ${t}'`,{error:i}),this.templateId=t}},vs=class extends F{constructor(t){super("shared-template-layer-unavailable",`None of the layers with which the template is associated are present in the view. Layer IDs: [${t.join(",")}]`),this.layerIds=t}},_s=class extends F{constructor(t){super("shared-template-relationship-not-found",`Relationship class '${t}' could not be found.`),this.relationshipCatalogId=t}},Re=class extends Fi.LoadableMixin(Ii){constructor(t){super(t),this.layerIdToSourceIdLookup=new Xe,this.sourceIdToLayerIdLookup=new Xe,this.sourceIdToNetworkInfo=new Xe,this._rulesBySourceId=new Map,this._terminalConfigurationsBySourceId=new Map}async load(t){return this.addResolvingPromise(this._load(t)),this}agatFromRule(t,i){let a;switch(i){case"to":a={networkSource:t.toNetworkSource??null,assetGroup:t.toAssetGroup??null,assetType:t.toAssetType??null};break;case"from":a={networkSource:t.fromNetworkSource??null,assetGroup:t.fromAssetGroup??null,assetType:t.fromAssetType??null};break;case"via":a={networkSource:t.viaNetworkSource??null,assetGroup:t.viaAssetGroup??null,assetType:t.viaAssetType??null}}return a.networkSource===null?null:a}agatToFullDefinition({assetGroup:t,assetType:i,networkSourceId:a}){if(a===null||t===null||i===null)return null;const o={networkSource:null,assetGroup:null,assetType:null},r=this.sourceIdToNetworkInfo.get(a);if(!r)return null;o.networkSource=r;const n=r.assetGroupLookup.get(t);return n?(o.assetGroup=n,o.assetType=n.assetTypeLookup.get(i)??null,o.assetType===null?null:o):null}findAgat(t,i){var u,p;const a=Se(i)?i.parent:i;if(!a)throw new F("Unable to find asset group/asset type for layer. The given layer is a `SubtypeSublayer` with no parent.");if(this.utilityNetwork.featureServiceUrl!==a.url)return null;const o=this.getNetworkSourceIdForLayer(a);if(o===null)return null;const r=((u=a.fieldsIndex.get("assettype"))==null?void 0:u.name)??"";if(r==="")return null;const n=((p=a.fieldsIndex.get("assetgroup"))==null?void 0:p.name)??"";if(n==="")return null;const d=t.attributes[r],c=t.attributes[n];return d==null||c==null?null:{assetGroup:c,assetType:d,networkSourceId:o}}findAgatFullDefinition(t,i){const a=this.findAgat(t,i);return a?this.agatToFullDefinition(a):null}findRules({networkSourceId:t,assetGroup:i,assetType:a}){var n;const o=[];if(t===null||i===null)return o;const r=(n=this._rulesBySourceId.get(t))==null?void 0:n.get(i);if(!r)return o;for(const d of r.generalRules)o.push(d);if(a!=null){const d=r.typeSpecificRules.get(a);if(d)for(const c of d)o.push(c)}return o}getNetworkSourceIdForLayer(t){const i=Se(t)?t.parent:t;return i&&this.utilityNetwork.featureServiceUrl===i.url?this.layerIdToSourceIdLookup.get(i.layerId)??null:null}ruleMatchesAgat(t,i,a){var o,r,n;switch(a){case"to":return!(((o=t.toNetworkSource)==null?void 0:o.sourceId)!==i.networkSourceId||t.toAssetGroup&&t.toAssetGroup.assetGroupCode!==i.assetGroup||t.toAssetType&&t.toAssetType.assetTypeCode!==i.assetType);case"from":return!(((r=t.fromNetworkSource)==null?void 0:r.sourceId)!==i.networkSourceId||t.fromAssetGroup&&t.fromAssetGroup.assetGroupCode!==i.assetGroup||t.fromAssetType&&t.fromAssetType.assetTypeCode!==i.assetType);case"via":return!(((n=t.viaNetworkSource)==null?void 0:n.sourceId)!==i.networkSourceId||t.viaAssetGroup&&t.viaAssetGroup.assetGroupCode!==i.assetGroup||t.viaAssetType&&t.viaAssetType.assetTypeCode!==i.assetType)}}ruleMatchesFullDefinitionAgat(t,i,a){var o,r,n,d,c,u,p,h,y,f,g,v;switch(a){case"to":return!(((o=t.toNetworkSource)==null?void 0:o.sourceId)!==((r=i.networkSource)==null?void 0:r.sourceId)||t.toAssetGroup&&t.toAssetGroup.assetGroupCode!==((n=i.assetGroup)==null?void 0:n.assetGroupCode)||t.toAssetType&&t.toAssetType.assetTypeCode!==((d=i.assetType)==null?void 0:d.assetTypeCode));case"from":return!(((c=t.fromNetworkSource)==null?void 0:c.sourceId)!==((u=i.networkSource)==null?void 0:u.sourceId)||t.fromAssetGroup&&t.fromAssetGroup.assetGroupCode!==((p=i.assetGroup)==null?void 0:p.assetGroupCode)||t.fromAssetType&&t.fromAssetType.assetTypeCode!==((h=i.assetType)==null?void 0:h.assetTypeCode));case"via":return!(((y=t.viaNetworkSource)==null?void 0:y.sourceId)!==((f=i.networkSource)==null?void 0:f.sourceId)||t.viaAssetGroup&&t.viaAssetGroup.assetGroupCode!==((g=i.assetGroup)==null?void 0:g.assetGroupCode)||t.viaAssetType&&t.viaAssetType.assetTypeCode!==((v=i.assetType)==null?void 0:v.assetTypeCode))}}terminalConfiguration(t,i,a){const o=this._terminalConfigurationsBySourceId.get(t);if(!o)return null;const r=o.get(i);return r&&r.get(a)||null}async _load(t){await this.utilityNetwork.load(),De(t);const{dataElement:i}=this.utilityNetwork;if(!i)throw new F("no-data-element","No data element found on utility network");for(const o of i.domainNetworks)for(const r of[...o.edgeSources??[],...o.junctionSources??[]]){this.layerIdToSourceIdLookup.set(r.layerId,r.sourceId),this.sourceIdToLayerIdLookup.set(r.sourceId,r.layerId);const n=(r.assetGroups??[]).map(u=>{const p=new Xe;for(const h of u.assetTypes??[])p.set(h.assetTypeCode,h);return{...u,assetTypeLookup:p}}),d=new Xe;for(const u of n)d.set(u.assetGroupCode,u);const c={...r,assetGroupLookup:d,assetGroups:n};this.sourceIdToNetworkInfo.set(c.sourceId,c)}const a=await this.utilityNetwork.getRulesTable();De(t);for(const o of(a==null?void 0:a.rules)??[])switch(o.ruleType){case Ce.RTAttachment:case Ce.RTContainment:this._registerRule(o.fromNetworkSource.sourceId,o.fromAssetGroup.assetGroupCode,o.fromAssetType.assetTypeCode,o),this._registerRule(o.toNetworkSource.sourceId,o.toAssetGroup.assetGroupCode,o.toAssetType.assetTypeCode,o);break;case Ce.RTEdgeJunctionEdgeConnectivity:this._registerRule(o.fromNetworkSource.sourceId,o.fromAssetGroup.assetGroupCode,o.fromAssetType.assetTypeCode,o),this._registerRule(o.toNetworkSource.sourceId,o.toAssetGroup.assetGroupCode,o.toAssetType.assetTypeCode,o),this._registerRule(o.viaNetworkSource.sourceId,o.viaAssetGroup.assetGroupCode,o.viaAssetType.assetTypeCode,o);break;case Ce.RTJunctionEdgeConnectivity:case Ce.RTJunctionJunctionConnectivity:this._registerRule(o.fromNetworkSource.sourceId,o.fromAssetGroup.assetGroupCode,o.fromAssetType.assetTypeCode,o),this._registerRule(o.toNetworkSource.sourceId,o.toAssetGroup.assetGroupCode,o.toAssetType.assetTypeCode,o)}this._makeTerminalConfigurationLookups(i)}_makeTerminalConfigurationLookups(t){const i={};for(const a of t.terminalConfigurations??[])i[a.terminalConfigurationId]=a;for(const a of t.domainNetworks??[])for(const o of a.junctionSources)if(o.utilityNetworkFeatureClassUsageType==="esriUNFCUTJunctionObject"||o.utilityNetworkFeatureClassUsageType==="esriUNFCUTDevice"){for(const r of o.assetGroups??[])for(const n of r.assetTypes??[])if(n.terminalConfigurationId!=null&&n.terminalConfigurationId>=0){const d=i[n.terminalConfigurationId];if(d){const c=Ae(this._terminalConfigurationsBySourceId,o.sourceId,()=>new Map);Ae(c,r.assetGroupCode,()=>new Map).set(n.assetTypeCode,d)}}}}_registerRule(t,i,a,o){const r=Ae(this._rulesBySourceId,t,()=>new Map),n=Ae(r,i,()=>({generalRules:[],typeSpecificRules:new Map}));a===-1?n.generalRules.push(o):Ae(n.typeSpecificRules,a,()=>[]).push(o)}};s([l()],Re.prototype,"layerIdToSourceIdLookup",void 0),s([l()],Re.prototype,"sourceIdToLayerIdLookup",void 0),s([l()],Re.prototype,"sourceIdToNetworkInfo",void 0),s([l()],Re.prototype,"utilityNetwork",void 0),Re=s([A("esri.networks.support.UtilityNetworkLookupHelper")],Re);const Gi=new Map;function Na(e,t){return Ae(Gi,e,()=>{const i=new we({layerResolver:(t==null?void 0:t.layerResolver)??Is(e),makeSharedTemplateFromJSON:t.makeSharedTemplateFromJSON,utilityNetworkResolver:(t==null?void 0:t.utilityNetworkResolver)??Ts(e),view:e});return e.addHandles(S(()=>{Gi.delete(e),i.destroy()})),i})}let we=class extends ne{constructor(e){super(e),this._abortController=null,this._cache=new Map,this._pending=new Map,this._utilityNetworkLookupHelperCache=new Map,this.layerResolver=null,this.makeSharedTemplateFromJSON=null,this.utilityNetworkResolver=null,this.view=null}initialize(){this.addHandles(k(()=>this.view.spatialReference,()=>this._reset()))}destroy(){this._abortController=oe(this._abortController)}async getTemplates({templateIds:e,featureService:t,signal:i}){const a=this._cache,o=this._pending,r=[],n=new Set,d=new Set,c=Symbol();for(const h of new Set(e)){const y=Mt(t,h);if(a.has(y))r.push(a.get(y));else if(o.has(y)){const f=o.get(y);f.subscribers.add(c),d.add(f)}else n.add(h),o.set(y,ks())}if(r.length===e.length)return r;const u=()=>{for(const{subscribers:h}of d)h.delete(c)},p=si(i,u);try{const h=await this._loadTemplates({templateIds:Array.from(n),featureService:t,signal:i}),y=await Promise.all(Array.from(d).map(({resolver:f})=>f.promise));r.push(...h),r.push(...y)}catch(h){u();for(const y of n){const f=Mt(t,y),g=o.get(f);g==null||g.resolver.reject(h),o.delete(f)}throw h}finally{p==null||p.remove()}return De(i),r}async _loadTemplates({templateIds:e,featureService:t,signal:i}){if(e.length===0)return[];const a=this._cache,o=this._pending,r=this._abortController=new AbortController,n=si(i,()=>{for(const u of e)if(qi(o.get(Mt(t,u))))return;r.abort()}),d=await bs({featureService:t,templateIds:e,signal:r.signal,spatialReference:this.view.spatialReference});if(d.length<e.length)throw new hs(e,d);const c=await Promise.all(d.map(u=>this._makeTemplate({json:u,featureService:t})));for(const u of c){const p=Mt(t,u.templateId),h=o.get(p);!(i!=null&&i.aborted)||qi(h)?(a.set(p,u),h==null||h.resolver.resolve(u)):h==null||h.resolver.reject(pa()),o.delete(p)}return n==null||n.remove(),c}async _makeTemplate({json:e,featureService:t}){var n,d,c;const{view:i}=this,a=this.makeSharedTemplateFromJSON(e);a.featureService=t,a.view=i;const{layerIds:o,subtypeCode:r}=a;try{a.layer=await this.layerResolver({featureService:t,layerIds:o,subtypeCode:r})}catch(u){throw new gs(a.templateId,u)}if(nt(a)&&((n=a.definition)!=null&&n.createUtilityNetworkAssociations)){let u=null;try{u=await this.utilityNetworkResolver(t)}catch(p){throw new ws(a.templateId,p)}if(u){a.definition.utilityNetwork=await this._getOrCreateUtilityNetworkLookupHelper(u);const p=await u.loadAssociationsTable();a.definition.utilityNetworkAssociationsTable=p,fa(i).additionalLayers.add(p)}}if(kt(a)&&a.definition){a.definition.spatialReference=i.spatialReference;for(const u of a.definition.allParts)u.geometry&&(u.geometry.spatialReference=i.spatialReference)}if(bi(a)&&((d=a.definition)!=null&&d.defaultValues)){const u=a.definition.defaultValues,p={},{fieldsIndex:h}=a.layer;for(const y in a.definition.defaultValues)p[((c=h.get(y))==null?void 0:c.name)??y]=u[y];a.definition.defaultValues=p}return a}async _getOrCreateUtilityNetworkLookupHelper(e){const t=this._utilityNetworkLookupHelperCache.get(e);if(t)return t;const i=await new Re({utilityNetwork:e}).load();this._utilityNetworkLookupHelperCache.set(e,i);const a=S(()=>{i.destroy(),this._utilityNetworkLookupHelperCache.delete(e)});return e.addHandles(a),this.addHandles(a),i}_reset(){var e;(e=this._abortController)==null||e.abort(),this._cache.clear(),this._pending.clear()}};async function bs({templateIds:e,featureService:t,spatialReference:i,signal:a}){var n;const o=`${t.url}/sharedTemplates/templates`;return((n=(await No(o,{query:{f:"json",outSR:i,ids:e.join(",")},signal:a}).catch(d=>{throw yo(d),new ps(e,d)})).data)==null?void 0:n.templates)??[]}function qi(e){return e!=null&&e.subscribers.size>0}function ks(){return{resolver:bt(),subscribers:new Set}}function Mt(e,t){return`${e.url}/${t}`}function Fs(e){return ki(e)||Be(e)}function Is(e){return async({featureService:t,layerIds:i})=>{const a=new Set(i),{allLayers:o,allTables:r}=e.map,n=o.concat(r).find(d=>d.url===t.url&&Fs(d)&&a.has(d.layerId));if(n==null)throw new vs(i);return n}}function Ts(e){return async t=>{const{map:i}=e;if(!rr(i)||!i.utilityNetworks)return null;for(const a of i.utilityNetworks)if(a.featureServiceUrl===t.url)return a.load();return null}}s([l()],we.prototype,"_abortController",void 0),s([l()],we.prototype,"_cache",void 0),s([l()],we.prototype,"_pending",void 0),s([l({constructOnly:!0})],we.prototype,"layerResolver",void 0),s([l({constructOnly:!0})],we.prototype,"makeSharedTemplateFromJSON",void 0),s([l({constructOnly:!0})],we.prototype,"utilityNetworkResolver",void 0),s([l({constructOnly:!0})],we.prototype,"view",void 0),we=s([A("esri.editing.sharedTemplates.SharedTemplateProvider")],we);let me=class extends Fi.LoadableMixin(Ii.EsriPromiseMixin(Ca)){constructor(){super(...arguments),this.excludedTools=[],this.featureService=null,this.makeSharedTemplateFromJSON=null,this.view=null}readExcludedTools(t){return t.map(i=>ar.fromJSON(i))}load(t){return this.addResolvingPromise(this._load(t)),Promise.resolve(this)}async _load(t){const i=this.allParts,{featureService:a,makeSharedTemplateFromJSON:o,view:r}=this;if(a==null||o==null||r==null)throw new ys;for(const p of i)p.assertIsSupportedPart();const n=Na(r,{makeSharedTemplateFromJSON:o}),d=i.filter(p=>p.template==null),c=await n.getTemplates({templateIds:d.map(p=>p.templateId),featureService:a,signal:t==null?void 0:t.signal}),u=new Map(c.map(p=>[p.templateId,p]));for(const p of d){const h=u.get(p.templateId);if(h==null)throw new F(`Failed to retrieve template for template ID ${p.templateId}`);p.template=h}await Promise.all(i.map(p=>{var h;return(h=p.template)==null?void 0:h.load(t)}))}};s([l({readOnly:!0})],me.prototype,"type",void 0),s([l({constructOnly:!0})],me.prototype,"excludedTools",void 0),s([Aa("excludedTools")],me.prototype,"readExcludedTools",null),s([l()],me.prototype,"featureService",void 0),s([l()],me.prototype,"makeSharedTemplateFromJSON",void 0),s([l()],me.prototype,"view",void 0),me=s([A("esri.editing.sharedTemplates.templateDefinitions.TemplateDefinitionBase")],me);let Te=class extends Ca{constructor(t){super(t),this.template=null}};s([l()],Te.prototype,"template",void 0),s([l()],Te.prototype,"templateGlobalId",void 0),s([l()],Te.prototype,"templateId",void 0),s([l({readOnly:!0,json:{read:!1,write:!1}})],Te.prototype,"type",void 0),Te=s([A("esri.editing.sharedTemplates.templateDefinitions.parts.TemplatePartBase")],Te);let Ue=class extends Te{constructor(t){super(t),this.relationshipCatalogId="",this.relationshipMetadata=null,this.template=null,this.type="relationship"}assertIsSupportedPart(){}};s([l({json:{name:"relationshipClassID"}})],Ue.prototype,"relationshipCatalogId",void 0),s([l()],Ue.prototype,"relationshipMetadata",void 0),s([l()],Ue.prototype,"template",void 0),s([l()],Ue.prototype,"type",void 0),Ue=s([A("esri.editing.sharedTemplates.templateDefinitions.parts.FeatureTemplateRelationshipPart")],Ue);let He=class extends me{constructor(t){super(t),this.type="feature",this.defaultValues=null,this.relationships=[]}get allParts(){return this.relationships}initializeRelationshipMetadata(t){var i,a,o;for(const r of this.relationships){const{relationshipCatalogId:n}=r,d=(i=r.template)==null?void 0:i.layer,c=(a=t.relationships)==null?void 0:a.find(p=>p.catalogId===n),u=(o=d==null?void 0:d.relationships)==null?void 0:o.find(p=>p.catalogId===n);if(!c||!d||!u)throw new _s(n);r.relationshipMetadata={destinationField:u.keyField,destinationLayerId:d.layerId,sourceField:c.keyField,sourceLayerId:t.layerId}}}};s([l({readOnly:!0})],He.prototype,"type",void 0),s([l()],He.prototype,"allParts",null),s([l()],He.prototype,"defaultValues",void 0),s([l({constructOnly:!0,type:[Ue]})],He.prototype,"relationships",void 0),He=s([A("esri.editing.sharedTemplates.templateDefinitions.FeatureTemplateDefinition")],He);const xa=new xo({esri_editing_transformation_bufferLineToPolygon:"buffer-line-to-polygon",esri_editing_transformation_bufferPointToPolygon:"buffer-point-to-polygon",esri_editing_transformation_bufferPolygonToPolygon:"buffer-polygon-to-polygon",esri_editing_transformation_connectionPoint:"connection-point",esri_editing_transformation_equallySpaced:"equally-spaced",esri_editing_transformation_offsetLine:"offset-line",esri_editing_transformation_offsetPrimaryLine:"offset-primary-line",esri_editing_transformation_pointAtAllVerticesOfLine:"point-at-all-vertices-of-line",esri_editing_transformation_pointAtBeginningOfLine:"point-at-beginning-of-line",esri_editing_transformation_pointAtBeginningOfRadial:"point-at-beginning-of-radial",esri_editing_transformation_pointAtEndOfLine:"point-at-end-of-line",esri_editing_transformation_pointAtInteriorVertices:"point-at-interior-vertices",esri_editing_transformation_pointAtIntersectionVerticesOfLine:"point-at-intersection-vertices-of-line",esri_editing_transformation_pointAtNotBeginningOfLine:"point-at-not-beginning-of-line",esri_editing_transformation_pointAtNotEndOfLine:"point-at-not-end-of-line",esri_editing_transformation_pointAtPolygonCentroid:"point-at-polygon-centroid",esri_editing_transformation_pointAtPolygonNotStart:"point-at-polygon-not-start",esri_editing_transformation_pointAtPolygonStart:"point-at-polygon-start",esri_editing_transformation_pointIdentity:"point-identity",esri_editing_transformation_pointPrimaryIdentity:"point-primary-identity",esri_editing_transformation_polygonBoundary:"polygon-boundary",esri_editing_transformation_polygonBoundaryTwoPoint:"polygon-boundary-two-point",esri_editing_transformation_polygonIdentity:"polygon-identity",esri_editing_transformation_polygonPrimaryIdentity:"polygon-primary-identity",esri_editing_transformation_polygonVertices:"polygon-vertices",esri_editing_transformation_radialLines:"radial-lines",esri_editing_transformation_twoPointLines:"two-point-lines"}),As={"buffer-line-to-polygon":"polyline","buffer-point-to-polygon":"point","buffer-polygon-to-polygon":"polygon","connection-point":"polyline","equally-spaced":"polyline","offset-line":"polyline","offset-primary-line":"polyline","point-at-all-vertices-of-line":"polyline","point-at-beginning-of-line":"polyline","point-at-beginning-of-radial":"polyline","point-at-end-of-line":"polyline","point-at-interior-vertices":"polyline","point-at-intersection-vertices-of-line":"polyline","point-at-not-beginning-of-line":"polyline","point-at-not-end-of-line":"polyline","point-at-polygon-centroid":"polygon","point-at-polygon-not-start":"polygon","point-at-polygon-start":"polygon","point-identity":"point","point-primary-identity":"point","polygon-boundary":"polygon","polygon-boundary-two-point":"polygon","polygon-identity":"polygon","polygon-primary-identity":"polygon","polygon-vertices":"polygon","radial-lines":"polyline","two-point-lines":"polyline"};let Ge=class extends Te{constructor(t){super(t),this.builderConfig={},this.type="group"}assertIsSupportedPart(){const{builderType:t}=this;if(!xa.apiValues.includes(t))throw new fs(t)}};s([sr(xa,{ignoreUnknown:!1,name:"type"})],Ge.prototype,"builderType",void 0),s([l({json:{name:"options"}})],Ge.prototype,"builderConfig",void 0),s([l()],Ge.prototype,"type",void 0),Ge=s([A("esri.editing.sharedTemplates.templateDefinitions.parts.GroupTemplatePart")],Ge);let ce=class extends me{constructor(t){super(t),this.type="group",this.createUtilityNetworkAssociations=!1,this.parts=[],this.utilityNetwork=null,this.utilityNetworkAssociationsTable=null}get allParts(){return[this.basePart,...this.parts]}get inputGeometryType(){return As[this.basePart.builderType]}};s([l({readOnly:!0})],ce.prototype,"type",void 0),s([l()],ce.prototype,"allParts",null),s([l({constructOnly:!0,type:Ge})],ce.prototype,"basePart",void 0),s([l({constructOnly:!0})],ce.prototype,"createUtilityNetworkAssociations",void 0),s([l()],ce.prototype,"inputGeometryType",null),s([l({constructOnly:!0,type:[Ge]})],ce.prototype,"parts",void 0),s([l()],ce.prototype,"utilityNetwork",void 0),s([l()],ce.prototype,"utilityNetworkAssociationsTable",void 0),ce=s([A("esri.editing.sharedTemplates.templateDefinitions.GroupTemplateDefinition")],ce);let pt=class extends Te{constructor(t){super(t),this.geometry=null,this.type="preset"}assertIsSupportedPart(){}};s([l({types:nr,json:{read:Jo}})],pt.prototype,"geometry",void 0),s([l()],pt.prototype,"type",void 0),pt=s([A("esri.editing.sharedTemplates.templateDefinitions.parts.PresetTemplatePart")],pt);let We=class extends me{constructor(t){super(t),this.type="preset",this.parts=[]}get allParts(){return this.parts}};s([l({readOnly:!0})],We.prototype,"type",void 0),s([l()],We.prototype,"allParts",null),s([l({constructOnly:!0,type:Ia})],We.prototype,"origin",void 0),s([l({constructOnly:!0,type:[pt],json:{name:"features"}})],We.prototype,"parts",void 0),s([l({type:jo})],We.prototype,"spatialReference",void 0),We=s([A("esri.editing.sharedTemplates.templateDefinitions.PresetTemplateDefinition")],We);const Cs=e=>Fe.fromJSON(e);let Fe=class extends Fi.LoadableMixin(Ii.EsriPromiseMixin(or)){constructor(t){super(t),this.definition=null,this.layer=null,this.type="feature",this.view=null}readDefinition(t,i){switch(i.type){case"feature":return He.fromJSON(t);case"group":return ce.fromJSON(t);case"preset":return We.fromJSON(t);default:throw fo(i.type),new F("shared-template:no-definition","No value for 'definition' provided to 'SharedTemplate' constructor")}}load(t){return this.addResolvingPromise(this._load(t)),Promise.resolve(this)}async _load(t){var n;const{definition:i,featureService:a,layer:o,view:r}=this;if(!(i&&a&&o&&r))throw new ms;i.featureService=a,i.makeSharedTemplateFromJSON=Cs,i.view=r,await((n=this.definition)==null?void 0:n.load(t)),To(i)&&i.initializeRelationshipMetadata(o)}};s([l()],Fe.prototype,"definition",void 0),s([Aa("definition")],Fe.prototype,"readDefinition",null),s([l()],Fe.prototype,"layer",void 0),s([l()],Fe.prototype,"type",void 0),s([l()],Fe.prototype,"view",void 0),Fe=s([A("esri.editing.sharedTemplates.SharedTemplate")],Fe);const Ms=Fe;function Es(e,t){const i={};t=t||{continueOnCircularDependency:!1};const a=[],o={};e.forEach(n=>{const d=n[0];let c;(c=i[d])||(c=i[d]=new ji(d)),n.forEach(u=>{u!==d&&(i[u]||(i[u]=new ji(u)),c.afters.push(u))})});const r=Object.keys(i);return r.sort(Bi),r.forEach(function n(d,c){const u=i[d],p=u.id;if(o[d])return;const h=Array.isArray(c)?c:[];h.push(p),o[d]=!0,u.afters.sort(Bi),u.afters.forEach(y=>{if(h.includes(y)){if(t!=null&&t.continueOnCircularDependency)return;throw new Error("Circular chain found: "+p+" must be before "+y+" due to a direct order specification, but "+y+" must be before "+p+" based on other specifications.")}n(y,h.slice())}),a.push(p)}),a.reverse()}let ji=class{constructor(t){this.id=t,this.afters=[]}};function Bi(e,t){return e<t?1:e>t?-1:0}const Ss=()=>ae.getLogger("esri.widgets.Editor.workflowUtils");function Ls(e){return e.type==="update"}function Ei(e){const t=e.sourceLayer;if(!t||t.type!=="feature"||!Ws(t.renderer))return{rotation:null,size:null};let i=null,a=null;const o=t.renderer.getVisualVariablesForType("rotation").filter(n=>(!n.axis||n.axis==="heading")&&n.field&&!n.valueExpression&&yr(n,e)!=null);o.length===1&&(i=$s(o[0],t));const r=t.renderer.getVisualVariablesForType("size").filter(n=>n.field&&!n.useSymbolValue&&!n.valueExpression&&fr(n)===gr.RealWorldSize&&wr(n,e)!=null);return r.length===1&&(a=Vs(r[0],t)),{rotation:i,size:a}}function $s(e,t){const i=(e.axis||"heading")==="heading"&&e.rotationType==="arithmetic"?-1:1,a=e.field,o=t.fields&&t.fields.filter(d=>d.name===a),r=o&&o.length===1?o[0].type:"double",n={initial:0,current:0};return{field:a,fieldType:r,getDefault:()=>Promise.resolve(0),getValue:d=>(n.current=n.initial-i*d,ui((n.current+360)%360,r)),setInitialValue:d=>{n.initial=d,n.current=0},isUpdatingInteractively:!1,rotationType:e.rotationType??"geographic"}}function Os(e,t){switch(t){case"width":return e[0];case"depth":return e[1];case"height":return e[2];default:return e[2]||e[1]||e[0]}}async function Ps(e,t,i){if(t==null)return 0;const{symbol:a}=br(t);if(a==null||a.type==="web-style"||a.type==="cim")return 0;const o=a.symbolLayers.at(0);if(!o)return 0;switch(o.type){case"icon":{const{computeIconLayerResourceSize:r}=await _(()=>import("./symbolLayerUtils-CinKExLh.js"),__vite__mapDeps([289,5,6,4,2,7,103,104,40,41,20,3,8,35,32,26,27,10,11,12,28,16,29,30,31,33,24,34,36,37,38,39,19]),import.meta.url);return o.size||Math.min(Oe.icon,(await r(o,Oe.icon))[0])||Oe.icon}case"text":return o.size||Oe.text;case"line":return o.size||Oe.line;case"object":{const{computeObjectLayerResourceSize:r}=await _(()=>import("./symbolLayerUtils-CinKExLh.js"),__vite__mapDeps([289,5,6,4,2,7,103,104,40,41,20,3,8,35,32,26,27,10,11,12,28,16,29,30,31,33,24,34,36,37,38,39,19]),import.meta.url);return Os(await r(o,e.scale/Oe.viewScaleSizeFactor),i)}case"path":return(o.width!=null?o.width:o.height)||e.scale/Oe.viewScaleSizeFactor;case"extrude":return o.size||e.scale/Oe.viewScaleSizeFactor;default:return 0}}function Vs(e,t){const i=e.field,a=e.axis,o=t.fields&&t.fields.filter(u=>u.name===i),r=o&&o.length===1?o[0].type:"double",n={initial:0,current:0},d=mr[e.valueUnit]??1;let c;return c=e.valueRepresentation==="area"?u=>(u*d/2)**2*Math.PI:e.valueRepresentation==="radius"||e.valueRepresentation==="distance"?u=>u*d/2:u=>u*d,{field:i,fieldType:r,getDefault:async(u,p)=>ui(c(await Ps(p,u,a)),r),getValue:(u,p)=>(n.initial||(n.initial=p.pixelSizeAt(p.center)),n.current=n.initial*u,ui(n.current,r)),setInitialValue:u=>{n.initial=u,n.current=0},isUpdatingInteractively:!1,displayUnit:ln(e.valueUnit),axis:e.axis}}function ui(e,t){switch(t){case"small-integer":case"integer":case"long":return Math.round(e);case"double":case"single":return e;default:return 0}}function Ws(e){switch(e==null?void 0:e.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":case"pie-chart":return!0;default:return!1}}async function Ee(e,t,i){const a=await Ut(e,{useSourceLayer:!0,ignoreGraphicSymbol:!0,webStyleCache:t,scale:i});ir(e.symbol,a)!=null&&(e.symbol=a)}function Da(e,t){var o;if(!e||!t)throw new Error("no geometry type");if(e==="multipatch")return{tool:"mesh",createOptions:{mode:"hybrid"}};const i=new Map;i.set("circle",{mode:"freehand"}),i.set("rectangle",{mode:"freehand"});const a={mode:kr,optionsPerTool:i};if(gt(t)){const r=t.defaultTool,n=nt(t)?((o=t.definition)==null?void 0:o.inputGeometryType)??e:e;switch(r){case"freehand":case"stream-line":return{tool:n==="polyline"?"freehandPolyline":"freehandPolygon",createOptions:a};case"autocomplete-freehand-polygons":case"stream-polygon":return{tool:"freehandPolygon",createOptions:a};case"autocomplete-polygons":case"difference-polygon":case"create-structures":case"polygon":case"trace":return{tool:n==="polygon"?"polygon":"polyline",createOptions:a};case"circle":return i.get("circle").preserveAspectRatio=!0,{tool:"circle",createOptions:a};case"ellipse":return i.get("circle").preserveAspectRatio=!1,{tool:"circle",createOptions:a};case"create-points-along-line":case"multipoint":return{tool:"multipoint",createOptions:a};case"line":case"radial-line":case"right-angle-line":case"split":case"two-point-line":return{tool:"polyline",createOptions:a};case"rectangle":case"regular-polygon":case"right-angle-polygon":return{tool:"rectangle",createOptions:a};case"elevation-point-from-contour":case"elevation-point-from-dem":case"parcel-seed":case"point":case"point-and-rotation":case"point-at-end-of-line":return{tool:"point",createOptions:a}}}else{const r=t.drawingTool;if(r==="circle"||r==="ellipse")return i.get("circle").preserveAspectRatio=r==="circle",{tool:"circle",createOptions:a};if(r==="rectangle")return{tool:"rectangle",createOptions:a};if(r==="freehand")return{tool:e==="polygon"?"freehandPolygon":"freehandPolyline",createOptions:a}}return{tool:e,createOptions:a}}async function Ns(e,t,i){const{creationInfo:a,fullTemplate:o}=t;if(!a)throw new F("No creation info provided.");const r=a.layer,n=qt(o,a.attributeOverrides),{view:d}=e,c=(d==null?void 0:d.type)==="2d";nt(o)||kt(o)||await Ua(e,r,n,i,c?d.scale:null);const{capabilities:u}=r;e.layer.elevationInfo=r.elevationInfo;const p=Da(r.geometryType,o);e.defaultCreateOptions={graphicProperties:{attributes:n,sourceLayer:r},mode:p.createOptions.mode,optionsPerTool:p.createOptions.optionsPerTool,preserveAspectRatio:p.createOptions.preserveAspectRatio,hasZ:u.data.supportsZ,defaultZ:(c?u.editing.zDefault:null)??e.defaultCreateOptions.defaultZ},a.geometryToPlace==null?await e.create(p.tool):await e.place(a.geometryToPlace,{graphicProperties:{attributes:n,sourceLayer:r}})}async function xs(e){return se([await Ds(e),await Rs(e)])}async function Ds({creationAttributes:e,data:t,sketchViewModel:i,view:a,webStyleCache:o}){const{creationInfo:r}=t,{fullTemplate:n}=t;if(!r||(a==null?void 0:a.type)!=="2d"||nt(n)||kt(n))return null;const d=Ne(c=>Ua(i,r.layer,e,o,c));return k(()=>a.scale,c=>d(c))}async function Rs({data:e,sketchViewModel:t,view:i}){var u,p;const{templateExecutorInfo:a}=e;if(!a)return null;const o=t.activeComponent;if(!i||!Ir(o))return Ss().error(new F("Failed to set up template feedback.")),null;const r=new Zt({effect:"saturate(0.6) opacity(0.8)",listMode:"hide",title:"Shared Template Feedback Graphics"});(u=i.map)==null||u.add(r);const{executor:n,serviceLayersById:d}=a,c=((p=i.theme)==null?void 0:p.accentColor)??new tr([255,165,0,1]);return se([ke(()=>o,["cursor-update","vertex-add"],()=>{var f;r.removeAll();const h=(f=o.graphic)==null?void 0:f.geometry;if(!h||!Us(h))return;const y=n(h,"digitizing");if(!_i(y))for(const g of y.edits){const v=d.get(g.id);if(v&&g.addFeatures&&g.addFeatures.length!==0){for(const w of v)if(!w.isTable)for(const T of g.addFeatures){const b=Hs(T,c);b&&r.add(b)}}}}),S(()=>{i.map.remove(r),r.destroy()})])}function Us(e){switch(e.type){case"point":case"multipoint":return!0;case"polyline":return e.paths[0].length>1;case"polygon":{const t=e.rings[0];return wo(t.at(0),t.at(-1))?t.length>2:t.length>1}default:return!1}}function Hs(e,t){var a;let i=null;switch((a=e.geometry)==null?void 0:a.type){case"point":case"multipoint":i=new _r({angle:0,color:t,outline:new ei({cap:"round",color:t,join:"round",miterLimit:1,style:"solid",width:1}),path:"undefined",size:8,style:"circle",xoffset:0,yoffset:0});break;case"polygon":i=new vr({color:t,outline:new ei({cap:"round",color:t,join:"round",miterLimit:1,style:"solid",width:3}),style:"none"});break;case"polyline":i=new ei({cap:"round",color:t,join:"round",miterLimit:1,style:"solid",width:2});break;default:return null}return new Le({geometry:e.geometry,symbol:i,attributes:{...e.attributes}})}async function Ra(e,t){const i=await fa(t).load(),a=Se(e)?e.parent:e;return i.tablesAndLayersLookup.get(a)}async function Gs(e,t){const i=await Ra(e,t);if(!i)return new Map;const a=new Map;for(const o of i.layersAndTables)Ae(a,o.layerId,()=>[]).push(o);return a}function ti(e){const t=e.objectIdField,i=e.globalIdField??"";return{id:e.layerId,identifierFields:{objectIdField:t,globalIdField:i},addFeatures:[],deleteAttachments:[],addAttachments:[],deleteFeatures:[],updateFeatures:[]}}function qs(e){const{edits:t,serviceInfo:i,view:a,findOriginalFeature:o}=e,r=js(i.layersAndTables),n=i.layersAndTables.toArray(),{allEditData:d,editDataByLayerIdMap:c,editDataByIdMap:u}=zs(t,r,o),p=Zs(d,Bs(n,c),c);if(Js(d,p,a),p.length===0)return t;const h=Es(p,{continueOnCircularDependency:!0}).map(w=>u.get(w)).filter(je),y=new Map;for(const w of h)y.set(w.uniqueId,w);const f=[];for(const w of d)y.has(w.uniqueId)||f.push(w);const g=[];let v=null;for(const w of h){const{layer:T}=w;switch(v==null?v=ti(T):v.id!==T.layerId&&(g.push(v),v=ti(T)),w.operationType){case"add":case"modify":v.addFeatures.push(w.after);break;case"delete":v.deleteFeatures.push(w.before)}}v!==null&&g.push(v);for(const w of f){const T=w.layer.layerId,b=g.find(C=>C.id===T)??ti(w.layer);switch(g.includes(b)||g.push(b),w.operationType){case"add":b.addFeatures.push(w.after);break;case"modify":b.updateFeatures.push(w.after);break;case"delete":b.deleteFeatures.push(w.before);break;case"deleteAttachment":b.deleteAttachments.push(w.attachmentId);break;case"addAttachment":b.addAttachments.push(w.attachment)}}for(const w of g)w.deleteAttachments!==void 0&&w.deleteAttachments.length===0&&delete w.deleteAttachments,w.addAttachments!==void 0&&w.addAttachments.length===0&&delete w.addAttachments;return g}function js(e){const t=new Map;for(const i of e)t.set(i.layerId,i);return t}function Bs(e,t){const i=new Map;for(const a of e)for(const o of a.relationships??[])if(i.set(pi(a,o),""),t.has(o.relatedTableId)){const r=t.get(o.relatedTableId);if(r.length>0){for(const n of r[0].layer.relationships??[])if(n.id===o.id){i.set(pi(a,o),n.keyField);break}}}return i}function zs(e,t,i){const a=new Map,o=[],r=new Map;let n=1;for(const d of e){const c=[],u=t.get(d.id);if(!u)throw new F(`Failed to prepare applyEdits payload. Layer with id ${d.id} not found.`);for(const p of d.addFeatures??[])c.push({uniqueId:"T"+n++,operationType:"add",layer:u,after:p});for(const p of d.deleteFeatures??[])c.push({uniqueId:"T"+n++,operationType:"delete",before:p,layer:u});for(const p of d.deleteAttachments??[])c.push({uniqueId:"T"+n++,operationType:"deleteAttachment",attachmentId:p,layer:u});for(const p of d.addAttachments??[])c.push({uniqueId:"T"+n++,operationType:"addAttachment",attachment:p,layer:u});for(const p of d.updateFeatures??[])c.push({uniqueId:"T"+n++,operationType:"modify",before:i(p),after:p,layer:u});a.set(u.layerId,c);for(const p of c)o.push(p),r.set(p.uniqueId,p)}return{allEditData:o,editDataByIdMap:r,editDataByLayerIdMap:a}}function Zs(e,t,i){const a=[];for(const o of e){const r=o.layer.relationships??[],{uniqueId:n}=o;for(const d of r){const c=d.keyField;if(d.role==="origin"){const u=i.get(d.relatedTableId);if(!u||u.length===0)continue;const p=pi(o.layer,d),h=t.get(p);if(h===void 0||h==="")continue;switch(o.operationType){case"add":for(const y of u)y!==o&&(y.operationType!=="add"&&y.operationType!=="modify"||y.after.attributes[h]===o.after.attributes[c]&&a.push([n,y.uniqueId]));break;case"modify":if(o.before.attributes[c]!==o.after.attributes[c])for(const y of u){const f=y.uniqueId;y!==o&&(y.operationType==="delete"?y.before.attributes[h]===o.before.attributes[c]?a.push([f,n]):y.before.attributes[h]===o.after.attributes[c]&&a.push([n,f]):y.operationType==="add"?y.after.attributes[h]===o.after.attributes[c]?a.push([n,f]):y.after.attributes[h]===o.before.attributes[c]&&a.push([f,n]):y.operationType==="modify"&&(y.before.attributes[h]!==y.after.attributes[h]?y.after.attributes[h]===o.after.attributes[c]?a.push([n,f]):a.push([f,n]):a.push([n,f])))}break;case"delete":for(const y of u)y!==o&&(y.operationType!=="delete"&&y.operationType!=="modify"||y.before.attributes[h]===o.before.attributes[c]&&a.push([y.uniqueId,n]))}}}}return a}function pi(e,t){return`${e.layerId}:${t.id}`}function Qs(e,t){var i;return!!(t!=null&&t.map&&"utilityNetworks"in t.map&&((i=t.map.utilityNetworks)!=null&&i.length)&&t.map.utilityNetworks.some(a=>{var o;return!(!a.loaded||!((o=e.url)!=null&&o.startsWith(a.featureServiceUrl))||e.layerId!==a.networkSystemLayers.associationsTableId)}))}function Js(e,t,i){const a=[];for(const r of e)Qs(r.layer,i)&&a.push(r);if(a.length===0)return;let o=[];for(const r of a){const n=r.layer;switch(r.operationType){case"delete":o=[...Et(r.before.attributes[n.fieldsIndex.get("fromglobalid").name],e),...Et(r.before.attributes[n.fieldsIndex.get("toglobalid").name],e)];for(const d of o)t.push([r.uniqueId,d.uniqueId]);break;case"add":o=[...Et(r.after.attributes[n.fieldsIndex.get("fromglobalid").name],e),...Et(r.after.attributes[n.fieldsIndex.get("toglobalid").name],e)];for(const d of o)t.push([d.uniqueId,r.uniqueId])}}}function Et(e,t){var o,r;const i=[],a=t.filter(({layer:n})=>n.globalIdField!==""&&n.globalIdField!=null);for(const n of a){const d=n.layer.globalIdField;("before"in n&&((o=n.before)==null?void 0:o.attributes[d])===e||"after"in n&&((r=n.after)==null?void 0:r.attributes[d])===e)&&i.push(n)}return i}function qt(e,t={}){var i;return nt(e)||kt(e)?{}:ga(e)?{...e.prototype.attributes,...t}:bi(e)?{...(i=e.definition)==null?void 0:i.defaultValues,...t}:{...t}}async function Ua(e,t,i,a,o){const r=new Le({sourceLayer:t,attributes:i}),{rotation:n,size:d}=Ei(r);let c=await Ut(r,{useSourceLayer:!0,webStyleCache:a,scale:o}),u=!1;for(const p of[d,n])p!=null&&i[p.field]==null&&(i[p.field]=await p.getDefault(c,e.view),u=!0);switch(u&&(c=await Ut(r,{useSourceLayer:!0,webStyleCache:a,scale:o})),c==null?void 0:c.type){case"simple-fill":case"polygon-3d":e.polygonSymbol=c;break;case"simple-line":case"line-3d":e.polylineSymbol=c;break;case"simple-marker":case"picture-marker":case"point-3d":case"cim":e.pointSymbol=c;break;case"mesh-3d":e.meshSymbol=c}Ha(e.tooltipOptions,d,n)}function Ha(e,t,i){e.visualVariables=t!=null||i!=null?{size:t!=null?{unit:t.displayUnit,axis:t.axis,valueType:t.fieldType}:null,rotation:i!=null?{valueType:i.fieldType,rotationType:i.rotationType??"geographic"}:null}:null}function zi(e,t){return e==null?void 0:e.find(i=>i.layer===t)}async function Ks(e,t,i,a){switch(t.type){case"3d":return Xs(e,t,i,a);case"2d":return Ys(e,t,i,a)}}async function Xs(e,t,i,a){if(e.length===0)return[];const{updatable:o,graphicsByLayer:r}=await i.async(async()=>{const{results:n}=await Dt(Fr(t,i),a),d=new Map,c=p=>{const h=p.layer,y=d.get(h);if(!y){const f=new Array;return d.set(h,f),f}return y};La(n).forEach(({graphic:p})=>c(p).push(p));const u=e.filter(({capabilities:p,layer:h})=>p.update.enabled&&d.has(h));return u.length!==0&&i.stopPropagation(),{updatable:u,graphicsByLayer:d}});return Dt(Promise.allSettled(o.map(async({layer:n})=>{const d=r.get(n),c=Ga(n);if(d.every(h=>lr(c,h)))return d;const u=[];for(const h of d){u.push(h.getObjectId());const y=Object.keys(h.attributes);vo(c,y)}const p=n.createQuery();return p.returnGeometry=!1,p.objectIds=u,p.outFields=Ma(n.fieldsIndex,c),n.queryFeatures(p,{signal:a}).then(({features:h})=>h)})),a)}async function Ys(e,t,i,a){if(e.length===0)return[];const{mapPoint:o}=i;if(o==null)return[];let r=null;const n=await i.async(async()=>{const{results:d}=await Dt(t.hitTest(i),a);if(d.length===0)return[];const c=new Set;r=La(d),r.forEach(({graphic:p})=>p&&c.add(p.layer));const u=e.filter(p=>c.has(p.layer)&&p.supportsUpdateWorkflow);return u.length>0&&i.stopPropagation(),u});return Dt(Promise.allSettled(n.map(async({layer:d})=>{const c=d.createQuery();c.returnGeometry=!0,c.outFields=Ga(d);const u="renderer"in d?pr({renderer:d.renderer,pointerType:i.pointerType}):0;c.geometry=hr(o,u,t),c.outSpatialReference=t.spatialReference;const{features:p}=await d.queryFeatures(c,{signal:a});return r==null||r.forEach(({graphic:h})=>{h.layer!==d||p.some(y=>y.getObjectId()===h.getObjectId())||p.push(h)}),p})),a)}function Ga(e){return Ma(e.fieldsIndex,[e.objectIdField,Ea({displayField:"displayField"in e?e.displayField:null,fields:e.fields})])}async function qa(e,t,i){const{sourceLayer:a}=e,o=a.createQuery();o.objectIds=[e.getAttribute(a.objectIdField)],o.outFields=["*"],o.returnM=a.capabilities.data.supportsM,o.returnZ=a.capabilities.data.supportsZ,a.type==="scene"&&a.infoFor3D!=null||(o.outSpatialReference=t);const r=await a.queryFeatures(o,{signal:i});return De(i),r.features[0]}async function Pt(e){const{graphic:t,sketchViewModel:i,sourceLayer:a,visualVariables:o}=e;await ja(e);const r={multipleSelectionEnabled:!1};return a.geometryType==="point"&&(r.enableRotation=o.rotation!=null,r.enableScaling=o.size!=null),i.update(t,r)}async function ja(e){var u;const{graphic:t,sketchViewModel:i,sourceLayer:a,visualVariables:o,webStyleCache:r}=e;let n=!1;const{rotation:d,size:c}=o;if([d,c].forEach(async p=>{if(p==null)return;const h=t.getAttribute(p.field);if(h!=null)p.setInitialValue(h);else{const y=await p.getDefault(t.symbol,i.view);p.setInitialValue(y),t.setAttribute(p.field,y),n=!0}}),n){const p=((u=i.view)==null?void 0:u.type)==="2d"?i.view.scale:null;await Ee(t,r,p)}Ha(i.tooltipOptions,c,d),i.layer.elevationInfo=a.elevationInfo}function en(e){return e==null||e.type!=="rotate-start"&&e.type!=="rotate"&&e.type!=="rotate-stop"?null:e}function tn(e){return e==null||e.type!=="scale-start"&&e.type!=="scale"&&e.type!=="scale-stop"?null:e}async function Ba(e,t,i,a,o){var u;if(t.geometry==null||((u=t.geometry)==null?void 0:u.type)!=="point")return;const r=a.rotation,n=en(i.toolEventInfo);if(r!=null&&n!=null){const{field:p,getValue:h}=r;n.type==="rotate-stop"?(r.isUpdatingInteractively=!1,r.setInitialValue(t.getAttribute(p))):(r.isUpdatingInteractively=!0,t.setAttribute(p,h(n.angle,e)))}const d=a.size,c=tn(i.toolEventInfo);if(d!=null&&c!=null){const{field:p,getValue:h}=d;c.type==="scale-stop"?(d.isUpdatingInteractively=!1,d.setInitialValue(t.getAttribute(p))):(d.isUpdatingInteractively=!0,t.setAttribute(p,h(c.xScale,e)))}await Ee(t,o,e.type==="2d"?e.scale:null)}async function an({feature:e,featureClone:t,visualVariableAttributes:i,sketchViewModel:a,view:o,onUpdate:r,webStyleCache:n,addUpdatingPromise:d,addHandle:c}){var b;await Ee(t,n,o.type==="2d"?o.scale:null);let u=null;if(((b=a==null?void 0:a.view)==null?void 0:b.type)==="2d"){const C=Ne(L=>Ee(t,n,L));u=k(()=>{var L;return(L=a==null?void 0:a.view)==null?void 0:L.scale},L=>C(L))}const p=t.sourceLayer,h=st(o,p);await Pt({graphic:t,sketchViewModel:a,sourceLayer:p,visualVariables:i,webStyleCache:n});let y=null;h.then(C=>y=C).catch(()=>{});const f=i.size,g=i.rotation,v=k(()=>e.attributes,async C=>{let L=!1;for(const O in C){const V=C[O];V!==t.getAttribute(O)&&(t.setAttribute(O,V),f==null||f.isUpdatingInteractively||f.field!==O||f.setInitialValue(V),g==null||g.isUpdatingInteractively||g.field!==O||g.setInitialValue(V),(y==null||y.requiredFields.includes(O))&&(L=!0))}L&&await Ee(t,n,o.type==="2d"?o.scale:null)}),w=a.on("update",async C=>{const L=C.graphics[0],O={graphic:L,sketchViewModel:a,sourceLayer:p,visualVariables:i,webStyleCache:n};if(C.state==="complete"){if(o.activeTool===null)return Pt(O);const V=new AbortController,te=Bt(V);return c(te),d(j(()=>o.activeTool===null,V.signal).then(()=>(V.abort(),Pt(O))))}await Ba(o,L,C,i,n),r(hi(L),C)}),T=a.on(["undo","redo"],async C=>{r(hi(C.graphics[0]),C)});return se([T,w,S(()=>a.cancel()),v,u])}async function on(e,t,i){const a=e.view;e.layer.add(i);const o=t.sourceLayer,r=t.layer,n=t.getAttribute(r.objectIdField);let d=null;function c(u){d==null||d.abort(),d=at(async p=>{var y;const h=await st(a,o);De(p),(y=h.setVisibility)==null||y.call(h,n,u)})}return await sn(a,i),c(!1),se([rn(a,i,u=>c(!u)),S(async()=>{c(!0);try{const u=await st(a,o);await j(()=>!u.updating)}finally{e.layer.remove(i)}})])}function rn(e,t,i){if(e.type==="3d"){const a=new Sa({graphic:t});return se([e.trackGraphicState(a),k(()=>a.displaying,i)])}return k(()=>t.visible,i)}async function sn(e,t){if(e.type==="3d"){const i=new Sa({graphic:t}),a=e.trackGraphicState(i);await j(()=>i.displaying||i.error),a.remove()}else await j(()=>t.visible)}const Oe={icon:Xt(24),text:Xt(12),line:Xt(1),viewScaleSizeFactor:100};function za(e,t,i){let a=!1;return e.filter(o=>!!a||(a=o===t,a)).map(o=>i[o]())}function nn(e,t){e.viewModel.syncFeatureTemplates();const i=e.creationInfo;if(t[0].id==="awaiting-feature-creation-info"&&i){const a=i.layer,o=e.viewModel.getTemplatesForLayer(a);o.length===1&&a.type!=="scene"&&(i.template=o[0],t.shift())}return t}function ln(e){return e==="unknown"?null:e}function dn(e){e.filesEnabled=!0,e.mode="view",e.capabilities={editing:!0,operations:{add:!0,update:!0,delete:!0}}}const Za=e=>/-stop/.test(e)||/vertex-/.test(e),st=(e,t)=>{const i=t.type==="subtype-sublayer"?t.parent:t;return e.whenLayerView(i)};function cn(e){return"createInteractiveEditSession"in e}function hi(e){var i;const t=e.geometry;if((t==null?void 0:t.type)==="mesh"){const a=e.cloneShallow();return a.attributes=go(e.attributes),a.geometry=t.cloneShallow(),a.geometry.transform=((i=t.transform)==null?void 0:i.clone())??null,a}return e.clone()}function Qa(e){const t=e.cursor;return e.cursor="progress",S(()=>e.cursor=t)}async function un(e,t){const{template:i}=e;if(i==null)return null;if(li(i))return i.load();if(gt(i)){const a=Na(t,{makeSharedTemplateFromJSON:hn}),o=await a.getTemplates({templateIds:[i.templateId],featureService:i.featureService});if(o.length===0)throw new F("editor:failed-to-load-template","Unable to load the provided template");return o[0].load()}return i}function Ja(e){for(const t of e){const{destinationGraphic:i,destinationField:a,sourceGraphic:o,sourceField:r}=t;i.setAttribute(a,o.getAttribute(r))}}function pn(e){var i;const t=(i=e.templateExecutorInfo)==null?void 0:i.completionResults;return t!=null&&t.length?(t.forEach(a=>Ja(a.relationships)),t.flatMap(a=>a.edits)):null}const hn=e=>Ms.fromJSON(e);async function mn({view:e,data:t,signal:i,next:a,cancel:o}){const{creationInfo:r}=t;if(!r)return S();if(!Ie(r))return S();const{layer:n}=r,d=r.geometryToPlace!=null;if(r.geometryToPlace=null,d)return o(),S();const{Upload:c}=await _(()=>import("./Upload-DHEByoeR.js"),__vite__mapDeps([290,2,10,11,12,3,4,5,6,7,8,42,40,20,35,32,43,44,291,61]),import.meta.url);De(i);const u=new c;t.upload=u;let p=null;const h=()=>p==null?void 0:p.remove(),y=se([k(()=>u.state,f=>{switch(f){case"default":case"error":h();break;case"pending":h(),p=Qa(e);break;case"success":{r.maxFeatures=1;const{result:g}=u;(g==null?void 0:g.type)==="georeferenced"||(g==null?void 0:g.type)==="georeferenced-reprojected"?(r.geometryToPlace=g.mesh,r.initialFeature=new Le({attributes:qt(t.fullTemplate,r.attributeOverrides),geometry:g.mesh,sourceLayer:n}),e.goTo(r.initialFeature,{animate:!1}).catch(qe)):r.geometryToPlace=g==null?void 0:g.mesh,h(),a();break}}}),S(()=>{u.cancel(),h()})]);return u.uploadTo(n),y}function Ie(e){const t=e==null?void 0:e.layer;return(t==null?void 0:t.type)==="scene"}let x=class extends _a.EventedAccessor{constructor(t){super(t),this._indexHistory=[],this._lastStepIndex=-1,this._stepIndex=-1,this._updatingHandles=new ht,this._handleKeys={afterCommit:"after-commit",beforeCommit:"before-commit"},this.data=void 0,this.started=!1,this.steps=[],this.type=null,this._pendingOperation=null}destroy(){this._updatingHandles.destroy()}get hasNextStep(){const{steps:t}=this;return!!(t&&this._stepIndex<t.filter(i=>!i.parent).length-1)}get hasPreviousStep(){return this._stepIndex>0}get reliesOnOwnerAdminPrivileges(){return!1}get hasInvalidFormTemplate(){return!1}get shouldShowAttachments(){return!1}get shouldAllowAttachmentEditing(){return!1}get stepId(){const{steps:t}=this,i=t&&t[this._stepIndex];return i&&i.id}get helpMessage(){}get hasPendingEdits(){return!1}get keyboardCancellationEnabled(){return!0}get updating(){return this._updatingHandles.updating}async back(t=()=>Promise.resolve(!0)){this.hasPendingEdits&&!await t()||(this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0}))}async cancel(t={force:!0}){return t.force!==!1?this._cancel(t):new Promise((i,a)=>{this.emit("cancel-request",{controller:{allow:()=>{this._cancel({...t,force:!0}).then(i)},deny:()=>a(new F("workflow:cancel-denied","Request to cancel workflow was denied."))}})})}async commit(){this.removeHandles(this._handleKeys.beforeCommit),this.onCommit&&await this.onCommit(this.data),this.removeHandles(this._handleKeys.afterCommit),this.emit("commit")}async go(t){const{steps:i}=this,a=i.findIndex(o=>o.id===t);this._indexHistory.push(this._stepIndex),await this._go(a)}async next(){this._indexHistory.push(this._stepIndex),await this._go(this._stepIndex+1)}async previous(t={cancelCurrentStep:!1}){await this._go(this._indexHistory.pop(),t.cancelCurrentStep)}async reset(){await this._cancel({emitCancelEvent:!1}),await this.start()}async save(){await this.commit(),await this.reset()}async start(){this._set("started",!0);const t=this._stepIndex===-1?0:this._stepIndex;await this._go(t)}async _cancel({emitCancelEvent:t=!0,error:i}={}){this.started&&(this._set("started",!1),await this._transaction(()=>{var a;return(a=this.steps[this._stepIndex])==null?void 0:a.tearDown({canceled:!0})})),this.removeHandles([this._handleKeys.afterCommit,this._handleKeys.beforeCommit]),this._resetIndexing(t),t&&this.emit("cancel",{error:i})}_go(t=-1,i=!1){return this._transaction(async()=>{const{steps:a}=this;if(!(t<=-1||t>=a.length)){if(!this.started)return this._stepIndex=t,void this._notifyStepProps();this._lastStepIndex>-1&&await a[this._lastStepIndex].tearDown({canceled:i});try{await a[t].setUp()}catch(o){_o(o)}this._lastStepIndex=t,this._stepIndex=t,this._notifyStepProps()}})}async _transaction(t){const i=this._pendingOperation,a=bt(),o=(i??Promise.resolve()).then(()=>a.promise);this._pendingOperation=o,this._updatingHandles.addPromise(o);try{i&&await i,await t()}finally{a.resolve(),o===this._pendingOperation&&(this._pendingOperation=null)}}_resetIndexing(t=!0){this._stepIndex=-1,this._lastStepIndex=-1,this._indexHistory.length=0,t&&this._notifyStepProps()}_notifyStepProps(){this.notifyChange("stepId"),this.notifyChange("hasPreviousStep"),this.notifyChange("hasNextStep")}};s([l()],x.prototype,"data",void 0),s([l()],x.prototype,"hasNextStep",null),s([l()],x.prototype,"hasPreviousStep",null),s([l()],x.prototype,"onCommit",void 0),s([l()],x.prototype,"reliesOnOwnerAdminPrivileges",null),s([l()],x.prototype,"hasInvalidFormTemplate",null),s([l()],x.prototype,"shouldShowAttachments",null),s([l()],x.prototype,"shouldAllowAttachmentEditing",null),s([l()],x.prototype,"started",void 0),s([l({readOnly:!0})],x.prototype,"stepId",null),s([l()],x.prototype,"steps",void 0),s([l({readOnly:!0})],x.prototype,"type",void 0),s([l()],x.prototype,"helpMessage",null),s([l()],x.prototype,"hasPendingEdits",null),s([l()],x.prototype,"keyboardCancellationEnabled",null),s([l()],x.prototype,"updating",null),x=s([A("esri.widgets.Editor.Workflow")],x);const Jt=x;var Vt;const yn=Symbol(),dt=Symbol(),St=Symbol(),Zi=Symbol(),fn={point:["point"],multipoint:["multipoint"],polygon:["polygon","freehandPolygon","rectangle","circle"],polyline:["polyline","freehandPolyline"],mesh:[],multipatch:[]};let W=Vt=class extends Jt{constructor(e){super(e),this.type="create-features",this.createFeatureState="create-new",this.data=void 0,this.isNested=!1,this._getDrawMeshHelpMessage=void 0,this._webStyleCache=new Map,this._featureFormHandle=null,this._visualVariableAttributes={rotation:null,size:null},this._featureFormViewModel=new ma,this._sketchViewModel=null,this._attachmentFileInfos=new Map,this._isActive=!0}initialize(){this.isNested&&(this._isActive=!1),this._initializeSketchViewModel()}destroy(){this._sketchViewModel.destroy()}get featureFormViewModel(){return this._featureFormViewModel}get hasPendingEdits(){var r,n;if(this.pendingFeatures.some(d=>{var c;return!!((c=this.data.getEditsForPendingFeature(d))!=null&&c.modified)}))return!0;const{creationInfo:e,upload:t}=this.data,i=this._sketchViewModel,{activeComponent:a}=i,o=(n=(r=i.createGraphic)==null?void 0:r.geometry)==null?void 0:n.type;return!(o!=="polyline"&&o!=="polygon"&&o!=="multipoint"||(a==null?void 0:a.type)!=="draw-2d"&&(a==null?void 0:a.type)!=="draw-3d")&&a.drawOperation.committedVertices.length>0||!(!t||t.state!=="pending"&&t.state!=="success")||!!(e!=null&&e.geometryToPlace)}get hasPreviousStep(){return this._stepIndex>0||this.createFeatureState==="update-pending"&&!!this.data.selectedPendingFeature&&!this.parent&&!Ie(this.data.creationInfo)}get helpMessage(){var n;const{creationInfo:e,viewModel:t}=this.data;if(this.stepId!=="creating-features"||!e)return;const i=e.layer.geometryType,a=this._sketchViewModel.createGraphic;if(i==="mesh"){this._getDrawMeshHelpMessage||_(()=>import("./helpMessageUtils3d-GWzBuIWZ.js"),__vite__mapDeps([292,3,2,4,5,6,7,8,52,40,47,214,153,75]),import.meta.url).then(c=>{this._getDrawMeshHelpMessage=c.getDrawMeshHelpMessage});const{view:d}=t;return(d==null?void 0:d.type)==="3d"?(n=this._getDrawMeshHelpMessage)==null?void 0:n.call(this,a,d):void 0}const o=this._sketchViewModel.activeCreateToolDrawMode,r=this._sketchViewModel.activeTool;return Xo(r==="rectangle"?"rectangle":r==="circle"?"circle":i,a==null?void 0:a.geometry,o)}get layer(){var e;return(e=this.data.creationInfo)==null?void 0:e.layer}get numPendingFeatures(){return this.pendingFeatures.length}get numPendingFeaturesExcludingHidden(){return this.pendingFeatures.filter(e=>this.data.isDisplayable(e)).length}get parent(){return this.data.parent}get parentLayer(){var e;return(e=this.parent)==null?void 0:e.data.editorItem.layer}get pendingFeatures(){return this.data.pendingFeatures}get keyboardCancellationEnabled(){return this.numPendingFeatures===0}get reliesOnOwnerAdminPrivileges(){var e;return((e=this.data.editorItem)==null?void 0:e.capabilities.create.reliesOnOwnerAdminPrivileges)??!1}get shouldShowAttachments(){var e;return(this.data.selectedPendingFeature&&((e=this.data.editorItem)==null?void 0:e.capabilities.create.attachments.enabled))??!1}get shouldAllowAttachmentEditing(){return this.shouldShowAttachments}get sketchViewModel(){return this._sketchViewModel}get test(){}get availableCreateTools(){var i,a;const e=(i=this.data.creationInfo)==null?void 0:i.layer.geometryType,t=this.data.viewModel.view;if(!e)return[];if((a=this.data.creationInfo)!=null&&a.maxFeatures&&this.data.creationInfo.maxFeatures<=this.numPendingFeatures)return[];if(gt(this.data.fullTemplate)){const{tool:o}=Da(e,this.data.fullTemplate);return[o]}return(t==null?void 0:t.type)!=="2d"&&e==="multipoint"?[]:[...fn[e]]}get _attachmentsActive(){const e=this.data.viewModel.attachmentsViewModel.mode,t=this.stepId;return this.shouldShowAttachments&&(e==="add"||e==="edit"||t==="adding-attachment"||t==="editing-attachment")}async enter(){this._isActive=!0,this.stepId!=="awaiting-feature-creation-info"&&await this._updatingHandles.addPromise(this._setUpCreatingFeaturesStep())}exit(){this._isActive=!1,this.removeHandles([St])}async updatePendingFeature(e){if(e!==this.data.selectedPendingFeature)return this._sketchViewModel.cancel(),this._startUpdating({feature:e})}async start(){var e;return await super.start(),ot((e=this.data.creationInfo)==null?void 0:e.layer)?null:{enter:async()=>{},exit:async()=>{},viewModel:this._sketchViewModel}}async save(){const{featureFormViewModel:e}=this;if(e.pendingSubtypeChoice)return;e.submit(),this._stashValidationState();const t=this.data.selectedPendingFeature,i=this._hasValidationErrors(t)?t:this.data.pendingFeatures.find(a=>this._hasValidationErrors(a));return i?(await this._startUpdating({feature:i}),void(e==null?void 0:e.submit())):super.save()}back(e){return this.createFeatureState!=="update-pending"||!this.data.selectedPendingFeature||Ie(this.data.creationInfo)||this._attachmentsActive||this.parent?super.back(e):this._clearSelectedFeature()}previous(e){return this.createFeatureState!=="update-pending"||!this.data.selectedPendingFeature||Ie(this.data.creationInfo)||this._attachmentsActive?super.previous(e):this._clearSelectedFeature()}cancelFeature(e){this.data.isSharedTemplateWorkflow?ae.getLogger(this).warn("Cannot cancel individual features created by shared templates."):(this.data.removePendingFeature(e),this.sketchViewModel.layer.graphics.remove(e))}static create(e){const{addAttachmentsCallback:t,applyEditsCallback:i,applyEditsFeatureServiceCallback:a,isNested:o,creationInfo:r,parent:n,snappingManager:d,startAt:c,viewModel:u}=e,p=e.sketchOptions??new zt,h=r==null?void 0:r.layer,y=h?u.findEditorItemForLayer(h):void 0,f=new Vt({data:new us({creationInfo:r,editorItem:y,parent:n,sketchOptions:p,snappingManager:d,viewModel:u}),isNested:o,onCommit:async g=>{var ye;const{creationInfo:v}=g;if(!v)return;f._sketchViewModel.cancel();const w=g.pendingFeatures.toArray(),{layer:T}=v,b=((ye=T.capabilities)==null?void 0:ye.editing.supportsGlobalId)&&"globalIdField"in T,C=f._attachmentFileInfos,{fullTemplate:L}=g,O=pn(f.data),V=li(L)&&O;if(b){if(_n(w),V){let R=kn(O,C);const fe=await Ra(T,u.view);fe&&(R=qs({edits:R,serviceInfo:fe,view:u.view,findOriginalFeature:It=>{var Tt;return((Tt=g.getEditsForPendingFeature(It))==null?void 0:Tt.initialFeature)??It}})),await a(L.featureService,R,{globalIdUsed:!0,gdbVersion:L.layer.gdbVersion??void 0})}else{const R=bn(w,C);await i(T,R,{globalIdUsed:!0})}return}const te=V?await a(L.featureService,O,{gdbVersion:L.layer.gdbVersion??void 0}):[await i(T,{addFeatures:w})];te&&C.size>0&&await Promise.all(te.map(R=>{if(R!=null&&R.addFeatureResults)return t(T,vn(w,R.addFeatureResults,T,C))}))}});return f._set("steps",this._createWorkflowSteps(f,c)),f}_fadeExistingFeatures(e){if("effect"in e){const i=e.effect;return e.effect="saturate(0.6) opacity(0.8)",S(()=>e.effect=i)}const t=e.opacity;return e.opacity=.7,S(()=>e.opacity=t)}async _initializeFullTemplateAndExecutorInfo(e){const{creationInfo:t}=e,{view:i}=e.viewModel;if(!t||!i)return null;const a=await un(t,i);if(e.fullTemplate=a,a&&li(a)){const o={completionResults:[],executor:await ts(a),serviceLayersById:await Gs(t.layer,i)};e.templateExecutorInfo=o}return a}async _startCreating(){var i;this.removeHandles(dt);const{data:e}=this;if(!e.creationInfo)return;const t=(i=this.data.creationInfo)==null?void 0:i.maxFeatures;if(t&&this.numPendingFeatures>=t)return this.sketchViewModel.cancel(),void(this.numPendingFeatures&&await this._startUpdating({feature:this.pendingFeatures.at(-1)}));this.createFeatureState="create-new",await Ns(this._sketchViewModel,e,this._webStyleCache)}async _clearSelectedFeature(){var i;const e=this._featureFormViewModel.pendingSubtypeChoice;e&&(e.resolve("undo"),await e.promise),this._stashValidationState(),this.sketchViewModel.cancel(),this.data.selectedPendingFeature=null,this._featureFormHandle=Ot(this._featureFormHandle),this._featureFormViewModel.feature=null;const t=this.data.viewModel.attachmentsViewModel;t.mode!=="add"&&t.mode!=="edit"||((i=this.data.viewModel.activeWorkflow)==null||i.previous())}_stashValidationState(){const e=this._featureFormViewModel.feature,t=e&&this.data.getEditsForPendingFeature(e);t&&(t.submittable=this._featureFormViewModel.submittable)}async _selectFeatureForUpdate({feature:e,initialFeature:t=e}){var T;this._stashValidationState();const{data:i,pendingFeatures:a,_webStyleCache:o}=this;a.includes(e)||i.addPendingFeature(e,t),i.selectedPendingFeature=e;const{_featureFormViewModel:r,_sketchViewModel:n}=this,{creationInfo:d,viewModel:c}=i,{attachmentsViewModel:u,layerInfos:p,view:h}=c;if(!h||!d)return;Ot(this._featureFormHandle);const y=e.sourceLayer,f=zi(p,y),g=f==null?void 0:f.formTemplate,v=h.spatialReference;r.set({arcadeEditType:"INSERT",feature:e,formTemplate:g,spatialReference:v,map:h.map}),u.mode!=="add"&&u.mode!=="edit"||((T=c.activeWorkflow)==null||T.previous()),u.graphic=e,u.fileInfos.removeAll(),u.mode="view",(this._attachmentFileInfos.get(e)||[]).forEach(({file:b,form:C})=>u.addFile(b,C)),await Ee(e,o,h.type==="2d"?h.scale:null);const w=i.getEditsForPendingFeature(e);this._featureFormHandle=se([r.on("value-change",async()=>{w==null||w.updateAttributes(r.getValues()),await Ee(e,o,h.type==="2d"?h.scale:null)}),n.on(["update","undo","redo"],b=>{(b.type==="undo"||b.type==="redo"||b.type==="update"&&b.toolEventInfo!=null&&Za(b.toolEventInfo.type))&&r.notifyFeatureGeometryChanged()}),k(()=>{var b;return(b=r.feature)==null?void 0:b.sourceLayer},b=>e.sourceLayer=b),k(()=>[r.feature,r.submittable],()=>this._stashValidationState())]),this.createFeatureState="update-pending"}async _startUpdating({feature:e,initialFeature:t=e}){await this._selectFeatureForUpdate({feature:e,initialFeature:t});const{_sketchViewModel:i,data:a}=this,{creationInfo:o,viewModel:r}=a,{view:n}=r;if(!n||!o)return;const d=e.sourceLayer??o.layer;return ot(d)?void 0:(this._visualVariableAttributes=Ei(e),Pt({graphic:e,sketchViewModel:i,sourceLayer:d,visualVariables:this._visualVariableAttributes,webStyleCache:this._webStyleCache}))}static _createWorkflowSteps(e,t="awaiting-feature-creation-info"){const{data:i}=e,a=za(["awaiting-feature-creation-info","creating-features","adding-attachment","editing-attachment"],t,{"awaiting-feature-creation-info":()=>({id:"awaiting-feature-creation-info",async setUp(){const{creationInfo:o,viewModel:r}=i,{view:n}=r;n&&(Ie(o)?e.addHandles(await mn({view:n,data:i,next:()=>e.next(),cancel:()=>r.cancelWorkflow({warnIfNoWorkflow:!1})}),this.id):(i.parent&&o&&e.addHandles(r.restrictFeatureTemplatesViewModelToLayer(o.layer),this.id),e.addHandles(r.featureTemplatesViewModel.on("select",({item:d})=>{d&&(i.creationInfo={...i.creationInfo,layer:d.layer,template:d.template},e.next())}),this.id)))},async tearDown(){e.removeHandles(this.id)}}),"creating-features":()=>({id:"creating-features",async setUp(){e._isActive&&await e._setUpCreatingFeaturesStep()},async tearDown(o){const{viewModel:r}=i;o.canceled&&(e.removeHandles([St,yn,dt,Zi]),r.attachmentsViewModel.fileInfos.removeAll(),e._attachmentFileInfos.clear())}}),"adding-attachment":()=>({id:"adding-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:o}=i.viewModel,{graphic:r,fileInfos:n}=o;e._attachmentFileInfos.set(r,n.toArray()),o.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:o}=i.viewModel,{graphic:r,fileInfos:n}=o;e._attachmentFileInfos.set(r,n.toArray()),o.mode="view"}})});return nn(i,a)}static _configureSketchViewModel(e){const{data:t}=e,i=e._webStyleCache,{creationInfo:a,viewModel:o}=t,{view:r}=o,n=e._sketchViewModel,d=[];if(!r)return S();if(r.type==="2d"){a&&d.push(e._fadeExistingFeatures(a.layer));const v=Ne((w,T)=>Promise.all(w.map(b=>Ee(b,i,T))));d.push(k(()=>r.scale,w=>v(n.layer.graphics,w)))}const c=qt(t.fullTemplate,a==null?void 0:a.attributeOverrides),u=k(()=>n.createGraphic,v=>{v&&!e.hasHandles(dt)&&e._updatingHandles.addPromise(xs({creationAttributes:c,data:t,sketchViewModel:n,view:r,webStyleCache:i}).then(w=>e.addHandles(w,dt)))}),p=async v=>{if(v.state!=="cancel"&&v.state!=="complete"||e.removeHandles(dt),v.state==="cancel"&&r.activeTool!==null&&r.activeTool!==e.sketchViewModel.activeComponent&&(await e._waitForActiveToolCleared(),await e._startCreating()),v.state==="complete"&&v.graphic){const w=await e._processEdits(v.graphic,{scale:r.type==="2d"?r.scale:null,useSourceLayer:!0,webStyleCache:e._webStyleCache});w&&(await e._waitForActiveToolCleared(),await e._startUpdating({feature:w}))}},h=async v=>{var C,L,O;const{attachmentsViewModel:w}=o,{_featureFormViewModel:T}=e;if(v.graphics.length>1)return void await e._clearSelectedFeature();const b=v.graphics[0];if(v.state==="complete"){const{submittable:V}=T;if(e.numPendingFeatures!==(a==null?void 0:a.maxFeatures)&&V||T.submit(),await e._clearSelectedFeature(),w.mode!=="add"&&w.mode!=="edit"||((C=o.activeWorkflow)==null||C.previous()),!v.aborted&&r.activeTool===e.sketchViewModel.activeComponent&&(await e.sketchViewModel.wait(),e.sketchViewModel.state==="ready"&&((L=e.data.creationInfo)==null?void 0:L.layer.geometryType)!=="mesh"))return e._startCreating()}else{if(v.state==="start")return b.sourceLayer??(b.sourceLayer=(O=t.creationInfo)==null?void 0:O.layer),await ja({sketchViewModel:n,graphic:b,visualVariables:e._visualVariableAttributes,webStyleCache:e._webStyleCache,sourceLayer:b.sourceLayer}),e._selectFeatureForUpdate({feature:b});if(v.state==="active"){await e.updatePendingFeature(b);const V=e._visualVariableAttributes;await Ba(r,b,v,V,e._webStyleCache);const te=b.attributes,{rotation:ye,size:R}=V;if(ye!=null){const{field:fe}=ye;T.setValue(fe,te[fe])}if(R!=null){const{field:fe}=R;T.setValue(fe,te[fe])}}}},y=async v=>{if(v.graphics.forEach(w=>{t.removePendingFeature(w)}),!Ie(t.creationInfo))return e._startCreating()},f=async()=>{if(Ie(t.creationInfo))try{await e.data.viewModel.back()}catch{}return e._startCreating()};d.push(u,n.on("create",v=>e._updatingHandles.addPromise(p(v))),n.on("update",v=>e._updatingHandles.addPromise(h(v))),n.on("delete",v=>e._updatingHandles.addPromise(y(v))),_e(()=>!e.numPendingFeatures,()=>e._updatingHandles.addPromise(f())),S(()=>{n.cancel()}),gn(n,t),...wn(t));const g=se(d);return n.addHandles(g),g}_initializeSketchViewModel(){var o;const{data:e}=this,{view:t}=e.viewModel,i=new Zt({elevationInfo:(o=e.creationInfo)==null?void 0:o.layer.elevationInfo,internal:!0,listMode:"hide",title:"createFeaturesWorkflow-internal"}),a=new Ti({layer:i,creationMode:"single",sketchOptions:e.sketchOptions,snappingManager:e.snappingManager,updateOnGraphicClick:!1,defaultUpdateOptions:{multipleSelectionEnabled:!1},view:t});this._sketchViewModel=a,t==null||t.map.add(i),this.addHandles([S(()=>{t!=null&&t.destroyed||(t==null||t.map.remove(i)),i.destroy()}),k(()=>this.numPendingFeatures>0,r=>this._sketchViewModel.updateOnGraphicClick=r,H)])}_hasValidationErrors(e){var t;return!!e&&(!this.data.isSubmittable(e)||!!((t=this._featureFormViewModel.validateContingencyConstraints(e.attributes,{includeIncompleteViolations:!0}))!=null&&t.length))}async _processEdits(e,t){var h,y,f;const{data:i}=this,{layerInfos:a,view:o}=i.viewModel,r=this._featureFormViewModel,{templateExecutorInfo:n}=i;if(!n){const g=e.clone();return g.geometry=null,i.addPendingFeature(e,g),e}const d=this.sketchViewModel.layer;d.remove(e);const{executor:c}=n,u=c(e.geometry,"completion"),p=_i(u)?await u:u;n.completionResults.push(p),Ja(p.relationships),r.arcadeEditType="INSERT",r.map=o==null?void 0:o.map,r.spatialReference=o==null?void 0:o.spatialReference,p.primary&&((h=i.creationInfo)!=null&&h.attributeOverrides)&&(p.primary.graphic.attributes={...p.primary.graphic.attributes,...i.creationInfo.attributeOverrides});for(const g of p.edits){let v=null;if(g.addFeatures)for(const w of g.addFeatures){const T=w.clone();T.geometry=null,w.geometry!=null&&(w.symbol=await Ut(w,t),d.add(w));const b=i.addPendingFeature(w,T,{isAssociation:!!((y=p.associationGraphics)!=null&&y.has(w))});w.sourceLayer!==(v==null?void 0:v.layer)&&(v=zi(a,w.sourceLayer)),r.feature=w,r.formTemplate=v==null?void 0:v.formTemplate,await j(()=>!r.updating),b.submittable=r.submittable}}return r.feature=null,await j(()=>!r.updating),p.edits.reduce((g,v)=>{var w;return g+(((w=v.addFeatures)==null?void 0:w.length)??0)},0)>1?null:(f=p.primary)==null?void 0:f.graphic}async _setUpCreatingFeaturesStep(){if(this.hasHandles(St))return;const{data:e,sketchViewModel:t}=this,{creationInfo:i,viewModel:a}=e,{attachmentsViewModel:o,view:r}=a;if(!r||!(i!=null&&i.layer))throw new F("missing-parameters","CreateFeaturesWorkflow requires a view and creationInfo.");const{initialFeature:n,layer:d}=i,c=[],u=[];this._featureFormHandle=Ot(this._featureFormHandle),this._visualVariableAttributes={rotation:null,size:null},e.editorItem=a.findEditorItemForLayer(i.layer),i.template&&(e.fullTemplate==null&&await this._initializeFullTemplateAndExecutorInfo(e),u.push(S(()=>{e.templateExecutorInfo&&(e.templateExecutorInfo.completionResults=[])}))),t.allowDeleteKey=!e.isSharedTemplateWorkflow,dn(o),c.push(k(()=>o.mode,b=>{switch(b){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}}));const p=Qa(r);c.push(p);const h=ot(i.layer),{template:y}=i,f=!y||ga(y)||gt(y)&&y.type==="feature",g=h&&f;try{if(g){const b=n??new Le({attributes:qt(e.fullTemplate,i.attributeOverrides),sourceLayer:d}),C=await this._processEdits(b);C&&await this._startUpdating({feature:C})}else c.push(Vt._configureSketchViewModel(this)),n?(t.layer.add(n),await this._startUpdating({feature:n})):await this._startCreating()}finally{p.remove()}const v=S(()=>{for(const b of e.pendingFeatures)t.layer.remove(b),e.removePendingFeature(b)}),w=k(()=>r==null?void 0:r.timeZone,b=>{this._featureFormViewModel.timeZone=b,this.data.timeZone=b},H),T=S(()=>{Ie(i)&&a.cancelWorkflow({warnIfNoWorkflow:!1})});this._featureFormHandle&&c.push(this._featureFormHandle),this.addHandles(c,this._handleKeys.beforeCommit),this.addHandles(u,this._handleKeys.afterCommit),this.addHandles([S(()=>o.fileInfos.removeAll()),se(c),se(u),T,v,w],St)}async _waitForActiveToolCleared(){const e=this.data.viewModel.view;if((e==null?void 0:e.activeTool)==null)return;const t=new AbortController;this.addHandles(Bt(t),Zi),await j(()=>(e==null?void 0:e.activeTool)==null,t.signal),t.abort()}};function gn(e,t){let i=null;const a=()=>e.snappingOptions.featureSources,o=()=>(i=new Ro({layer:e.layer}),a().add(i),i),r=()=>{i!=null&&(a().remove(i),i=ft(i))};return se([k(()=>{var c;const n=(c=t.creationInfo)==null?void 0:c.layer,d=a().find(u=>u.layer===n);return{hasFeatureLayerSource:!!d,enabled:(d==null?void 0:d.enabled)??!1}},({hasFeatureLayerSource:n,enabled:d})=>{if(!n)return r();i??(i=o()),i.enabled=d},Ke),S(r)])}function wn(e){const t=e.viewModel.view;if(!t)return[];const i=[];if(t.type==="3d"){const o=new wt({view:t});i.push(k(()=>e.selectedPendingFeature,(r,n)=>{o.remove(r),o.add(n)}),S(()=>o.destroy()))}const a=new wt({view:t,highlightName:Qt});return i.push(k(()=>e.temporaryHighlightFeature,o=>{a.removeAll(),a.add(o)}),S(()=>a.destroy())),i}function vn(e,t,i,a){const o=[];return t.forEach((r,n)=>{if(!r.error){const d=e[n],c=a.get(d)||[];d.attributes[i.objectIdField]=r.objectId,c.forEach(({form:u})=>o.push({feature:d,attachment:u}))}}),o}function _n(e){var t,i;for(const a of e){const{sourceLayer:o}=a;o&&"globalIdField"in o&&o.globalIdField!=null&&((t=a.attributes)[i=o.globalIdField]??(t[i]=ze()))}}function bn(e,t){const i=[];if(!t||t.size===0)return{addFeatures:e};for(const[a,o]of t)for(const{file:r}of o)i.push({feature:a,attachment:{globalId:ze(),data:r}});return i.length?{addFeatures:e,addAttachments:i}:{addFeatures:e}}function kn(e,t){return e.map(i=>{const{addFeatures:a}=i;if(!a||a.length===0)return i;const o=[];for(const r of a){const n=t.get(r);if(n)for(const{file:d}of n)o.push({feature:r,attachment:{globalId:ze(),data:d}})}return o.length?{...i,addAttachments:o}:i})}s([l()],W.prototype,"createFeatureState",void 0),s([l()],W.prototype,"data",void 0),s([l({constructOnly:!0})],W.prototype,"isNested",void 0),s([l()],W.prototype,"featureFormViewModel",null),s([l()],W.prototype,"hasPendingEdits",null),s([l()],W.prototype,"hasPreviousStep",null),s([l()],W.prototype,"_getDrawMeshHelpMessage",void 0),s([l()],W.prototype,"helpMessage",null),s([l()],W.prototype,"layer",null),s([l()],W.prototype,"parent",null),s([l()],W.prototype,"parentLayer",null),s([l()],W.prototype,"keyboardCancellationEnabled",null),s([l()],W.prototype,"reliesOnOwnerAdminPrivileges",null),s([l()],W.prototype,"shouldShowAttachments",null),s([l()],W.prototype,"shouldAllowAttachmentEditing",null),s([l()],W.prototype,"sketchViewModel",null),s([l()],W.prototype,"availableCreateTools",null),s([l()],W.prototype,"_attachmentsActive",null),W=Vt=s([A("esri.widgets.Editor.CreateFeaturesWorkflow")],W);const Ka=W;var mi;let ve=mi=class extends ne{constructor(e){super(e),this.editorItem=null,this.feature=null,this.utilityNetwork=null,this.associationType=null,this.parent=null,this.associationInput=null,this.viewModel=null}static async create(e){const{feature:t,parent:i,viewModel:a,utilityNetwork:o,associationType:r,associationInput:n}=e,d=a.editorItems.find(c=>c.layer===t.layer);if(!d)throw new F("no-editorItem-found","The EditorViewModel provided did not have an EditorItem associated with the specified Graphic's layer");return new mi({editorItem:d,feature:t,parent:i,viewModel:a,utilityNetwork:o,associationType:r,associationInput:n})}};s([l({constructOnly:!0})],ve.prototype,"editorItem",void 0),s([l()],ve.prototype,"feature",void 0),s([l({constructOnly:!0})],ve.prototype,"utilityNetwork",void 0),s([l({constructOnly:!0})],ve.prototype,"associationType",void 0),s([l()],ve.prototype,"parent",void 0),s([l()],ve.prototype,"associationInput",void 0),s([l()],ve.prototype,"viewModel",void 0),ve=mi=s([A("esri.widgets.Editor.AddAssociationWorkflowData")],ve);const Fn=ve;function Qi(e){return new $r({fromNetworkElement:Ji(e.fromFeature,e.utilityNetwork),toNetworkElement:Ji(e.toFeature,e.utilityNetwork),associationType:e.associationType,globalId:ze()})}function Ji(e,t){var a;const i=Se(e.sourceLayer)?e.sourceLayer.parent:e.sourceLayer;if(i&&"globalIdField"in i&&"layerId"in i&&i.globalIdField){const o=t.getSourceIdByLayerId(i.layerId),r=t.getSourceTypeById(o)==="junction"?t.getTerminalConfiguration(e):void 0,n=(a=r==null?void 0:r.terminals.at(0))==null?void 0:a.id,d=i.fieldsIndex.get("assetGroup").name,c=i.fieldsIndex.get("assetType").name,u=e.attributes[d],p=e.attributes[c],h=e.attributes[i.globalIdField];if(h&&o!=null)return new Or({globalId:h,networkSourceId:o,assetGroupCode:u,assetTypeCode:p,terminalId:n})}}const ii=100,Ki="association-key";let M=class extends ne{constructor(t){super(t),this.graphic=null,this.layer=null,this.map=null,this.utilityNetwork=null,this.associationType=null,this.featureCount=0,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=30,this.selectedFeature=null,this.association=null,this.filterOptionsVisible=!1,this.filterWhereClause=null,this._rulesTable=null,this._canAssociate=!1,this._whereClause=null,this._setUpItemsTask=null,this._updatingHandlesSetUp=new ht,this._queryFeaturesTask=null,this._updatingHandlesQueryFeatures=new ht,this._validateAssociationTask=null,this._updatingHandlesAssociation=new ht,this._cancelQuery=()=>{const{_queryAbortController:i}=this;i&&i.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:i}=this;i&&i.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:i}=this;i&&i.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const i=new AbortController;this._queryAbortController=i,await qe(this._query()).catch(()=>this._cancelQuery()),this._queryAbortController===i&&(this._queryAbortController=null)},this._queryFeatureCountController=async i=>{this._cancelQueryFeatureCount();const a=new AbortController;this._queryFeatureCountAbortController=a,await qe(this._queryFeatureCount(i)).catch(()=>this._cancelQueryFeatureCount()),this._queryFeatureCountAbortController===a&&(this._queryFeatureCountAbortController=null)},this._queryPageController=async()=>{const i=new AbortController;this._queryPageAbortController=i,await qe(this._queryPage()).catch(()=>this._cancelQueryPage()),this._queryPageAbortController===i&&(this._queryPageAbortController=null)},this._queryDebounced=Ne(this._queryController,ii),this._queryFeatureCountDebounced=Ne(this._queryFeatureCountController,ii),this._queryPageDebounced=Ne(this._queryPageController,ii)}initialize(){this.addHandles([k(()=>[this.graphic,this.layer,this.map,this.utilityNetwork,this.globalId,this.associationType],()=>this._syncLayerItems(),H),k(()=>[this.selectedLayer,this.filterWhereClause,this.featuresPerPage],()=>{this.selectedLayer&&this._setUpFeatures()}),k(()=>this.selectedFeature,()=>{this._setUpAssociation()}),k(()=>this.featurePage,()=>this._queryPageDebounced())])}destroy(){this._setUpItemsTask=oe(this._setUpItemsTask),this._updatingHandlesSetUp.destroy(),this._queryFeaturesTask=oe(this._queryFeaturesTask),this._updatingHandlesQueryFeatures.destroy(),this._validateAssociationTask=oe(this._validateAssociationTask),this._updatingHandlesAssociation.destroy(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}get mapLayers(){const{map:t}=this;if(!t)return null;const i=new Set,a=r=>{!Cr(r)||Be(r)||i.has(r)||i.add(r)},o=r=>{var n,d,c,u,p;Ar(r)||r.type==="catalog-footprint"||(Oo(r)?((n=r.layers)==null||n.forEach(a),(d=r.tables)==null||d.forEach(a)):Lr(r)?((c=r.sublayers)==null||c.forEach(a),(u=r.subtables)==null||u.forEach(a)):Be(r)?(p=r.sublayers)==null||p.forEach(a):a(r))};return t.allLayers.forEach(o),t.allTables.forEach(o),new xe([...i])}get state(){const{_queryAbortController:t,_queryPageAbortController:i,canQuery:a}=this;return t||i||this._updatingHandlesQueryFeatures.updating?"querying":this.canLoad&&this._updatingHandlesSetUp.updating?"loading":this._updatingHandlesAssociation.updating?"validating":a?"ready":"disabled"}get canAddAssociation(){return!(this.updating||!this.association)&&this._canAssociate}get globalId(){var t,i;return(this.globalIdField&&((i=(t=this.graphic)==null?void 0:t.attributes)==null?void 0:i[this.globalIdField]))??null}get globalIdField(){const{layer:t}=this;return(t==null?void 0:t.globalIdField)??null}get layerItems(){return this._get("layerItems")||new xe}get featureItems(){return this._get("featureItems")||new xe}set featurePage(t){const{featuresPerPage:i,featureCount:a}=this,o=1,r=Math.ceil(a/i)||1;this._set("featurePage",Math.min(Math.max(t,o),r))}get featurePage(){return this._get("featurePage")}get canLoad(){const{map:t,utilityNetwork:i,graphic:a,associationType:o}=this;return!!(t&&i&&a&&o)}get canQuery(){const{utilityNetwork:t,graphic:i,associationType:a,selectedLayer:o}=this;return!!(t&&i&&a&&o)}get updating(){return this._updatingHandlesSetUp.updating||this._updatingHandlesAssociation.updating}get selectedLayer(){return this._get("selectedLayer")}set selectedLayer(t){t!==this.selectedLayer&&(this.filterWhereClause=null),this._set("selectedLayer",t)}get queryWhereClause(){const{_whereClause:t,filterWhereClause:i}=this;return Yt(t,i)}async _queryFeatureCount(t){const{selectedLayer:i,_queryFeatureCountAbortController:a}=this;if(this._set("featureCount",0),!i)return;await i.load();const o=i.createQuery();o.returnGeometry=!1,o.where=Yt(o.where,t);const r=await i.queryFeatureCount(o,{signal:a==null?void 0:a.signal});r>0&&this._set("featureCount",r)}async _query(){const{canQuery:t,queryWhereClause:i,_queryAbortController:a,featureItems:o}=this;t&&(this.featurePage=1,o.destroyAll(),this.featureCount&&!this.destroyed&&o.addMany(await this._queryAssociatedFeatures(i,{signal:a==null?void 0:a.signal})))}async _queryPage(){const{canQuery:t,queryWhereClause:i,featurePage:a,_queryPageAbortController:o,featureCount:r,featureItems:n}=this;t&&(a<2||!r||n.addMany(await this._queryAssociatedFeatures(i,{signal:o==null?void 0:o.signal})))}_convertTypeToDirection(t){switch(t){case"attachment":return[{type:"attachment",direction:"from"}];case"connectivity":return[{type:"junction-junction-connectivity"},{type:"junction-edge-from-connectivity"},{type:"junction-edge-midspan-connectivity"},{type:"junction-edge-to-connectivity"}];case"container":return[{type:"containment",direction:"to"}];case"content":return[{type:"containment",direction:"from"}];case"structure":return[{type:"attachment",direction:"to"}]}}async getRulesTable(){const{utilityNetwork:t}=this;if(!t)return null;if(this._rulesTable)return this._rulesTable;const i=await t.getRulesTable();return await(i==null?void 0:i.load()),this._rulesTable=i,i}async _syncLayerItems(){oe(this._setUpItemsTask);const{graphic:t,associationType:i,layerItems:a,canLoad:o}=this,r=at(async n=>{var h;if(this.selectedLayer=null,a.destroyAll(),!o)return;const d=(h=this.mapLayers)==null?void 0:h.toArray();if(!d||n.aborted)return;const c=await this.getRulesTable(),u=this._convertTypeToDirection(i.type),p=c==null?void 0:c.getLayersCanAssociateWith(t,d,u);n.aborted||a.addMany(p||[])});this._updatingHandlesSetUp.addPromise(r.promise),this._setUpItemsTask=r}async _setUpFeatures(){oe(this._queryFeaturesTask);const{graphic:t,associationType:i,selectedLayer:a,canQuery:o}=this;if(!o)return;const r=at(async n=>{const d=await this.getRulesTable(),c=this._convertTypeToDirection(i.type),u=d==null?void 0:d.getFeaturesCanAssociateWithClause(t,a,c);this._whereClause=u,n.aborted||(await this._queryFeatureCountDebounced(this.queryWhereClause),await this._queryDebounced())});this._updatingHandlesQueryFeatures.addPromise(r.promise),this._queryFeaturesTask=r}_determineFromAndTo(t,i,a){return a==="from"?{fromFeature:t,toFeature:i}:{fromFeature:i,toFeature:t}}_determineJunctionEdgeConnectivity(t,i){const{utilityNetwork:a}=this,o=Se(t.sourceLayer)?t.sourceLayer.parent:t.sourceLayer,r=Se(i.sourceLayer)?i.sourceLayer.parent:i.sourceLayer;if(!(a&&o&&"layerId"in o&&r&&"layerId"in r))return{fromFeature:t,toFeature:i,type:"junction-junction-connectivity"};const n=a.getSourceIdByLayerId(o.layerId),d=a.getSourceIdByLayerId(r.layerId);if(!n||!d)return{fromFeature:t,toFeature:i,type:"junction-junction-connectivity"};const c=a.getSourceTypeById(n)==="junction",u=a.getSourceTypeById(d)==="junction";return c&&u?{fromFeature:t,toFeature:i,type:"junction-junction-connectivity"}:u?{fromFeature:i,toFeature:t,type:"junction-edge-midspan-connectivity"}:{fromFeature:t,toFeature:i,type:"junction-edge-midspan-connectivity"}}_setUpAssociationHandles(){this.removeHandles(Ki),this.association&&this.addHandles(k(()=>{var t,i,a,o,r,n,d;return[(t=this.association)==null?void 0:t.associationType,(i=this.association)==null?void 0:i.fromNetworkElement,(o=(a=this.association)==null?void 0:a.fromNetworkElement)==null?void 0:o.terminalId,(r=this.association)==null?void 0:r.toNetworkElement,(d=(n=this.association)==null?void 0:n.toNetworkElement)==null?void 0:d.terminalId]},()=>this.validateAssociation(),H),Ki)}_setUpAssociation(){const{utilityNetwork:t,graphic:i,selectedFeature:a,associationType:o}=this;if(!(t&&i&&a&&o))return void(this.association=null);const r=this._convertTypeToDirection(o.type);if(r.length>1){const{fromFeature:c,toFeature:u,type:p}=this._determineJunctionEdgeConnectivity(i,a.feature);return this.association=Qi({fromFeature:c,toFeature:u,utilityNetwork:t,associationType:p}),void this._setUpAssociationHandles()}const{fromFeature:n,toFeature:d}=this._determineFromAndTo(i,a.feature,r[0].direction);this.association=Qi({fromFeature:n,toFeature:d,utilityNetwork:t,associationType:r[0].type}),this._setUpAssociationHandles()}async _processFeatures(t){return Promise.all(t.map(async i=>{const{sourceLayer:a}=i;return a&&"getFeatureTitle"in a?{label:await a.getFeatureTitle(i),feature:i}:{label:Ta(i),feature:i}}))}async _queryAssociatedFeatures(t,i){const{featuresPerPage:a,layer:o,featurePage:r,featureCount:n,selectedLayer:d}=this,{canQuery:c,globalId:u}=this;if(!c||!o||!d||u==null)return[];const p=((r-1)*a+n)%n,h=a,{historicMoment:y,gdbVersion:f}=d,g=d.createQuery();g.where=Yt(g.where,t),g.start=p,g.num=h,g.returnGeometry=!1,g.historicMoment=y,g.gdbVersion=f,g.outFields=["*"];const v=await d.queryFeatures(g,{signal:i==null?void 0:i.signal});return await this._processFeatures(v.features)}validateAssociation(){oe(this._validateAssociationTask);const{utilityNetwork:t,association:i}=this,a=at(async()=>{t&&i&&(this._canAssociate=await t.canAddAssociation(i))});this._updatingHandlesAssociation.addPromise(a.promise),this._validateAssociationTask=a}};s([l({type:Le})],M.prototype,"graphic",void 0),s([l()],M.prototype,"layer",void 0),s([l()],M.prototype,"map",void 0),s([l({readOnly:!0})],M.prototype,"mapLayers",null),s([l()],M.prototype,"utilityNetwork",void 0),s([l()],M.prototype,"associationType",void 0),s([l()],M.prototype,"state",null),s([l({readOnly:!0})],M.prototype,"canAddAssociation",null),s([l({readOnly:!0})],M.prototype,"globalId",null),s([l({readOnly:!0})],M.prototype,"globalIdField",null),s([l()],M.prototype,"featureCount",void 0),s([l({readOnly:!0})],M.prototype,"layerItems",null),s([l({readOnly:!0})],M.prototype,"featureItems",null),s([l()],M.prototype,"_queryAbortController",void 0),s([l()],M.prototype,"_queryPageAbortController",void 0),s([l()],M.prototype,"_queryFeatureCountAbortController",void 0),s([l({value:1})],M.prototype,"featurePage",null),s([l()],M.prototype,"featuresPerPage",void 0),s([l({readOnly:!0})],M.prototype,"canLoad",null),s([l({readOnly:!0})],M.prototype,"canQuery",null),s([l({readOnly:!0})],M.prototype,"updating",null),s([l()],M.prototype,"selectedLayer",null),s([l()],M.prototype,"selectedFeature",void 0),s([l()],M.prototype,"association",void 0),s([l()],M.prototype,"filterOptionsVisible",void 0),s([l()],M.prototype,"filterWhereClause",void 0),s([l()],M.prototype,"queryWhereClause",null),s([l()],M.prototype,"_rulesTable",void 0),s([l()],M.prototype,"_canAssociate",void 0),s([l()],M.prototype,"_whereClause",void 0),M=s([A("esri.widgets.FeatureForm.UtilityNetworkAssociationAddAssociationViewModel")],M);const Si=M;var yi;const Xi={exit:Symbol()};let z=yi=class extends Jt{constructor(e){super(e),this._utilityNetworkAssociationAddAssociationViewModel=new Si,this._highlightHelper=null,this.sourceFeatureItem=null,this.type="add-association"}initialize(){const{data:e}=this,{view:t}=e.viewModel;t&&(this._highlightHelper=new wt({view:t,highlightName:Qt}),this.addHandles(S(()=>{var a;return(a=this._highlightHelper)==null?void 0:a.removeAll()})));const i=new AbortController;this.addHandles(Bt(i)),this._updatingHandles.addPromise(this._setup(i))}get editorItem(){return this.data.editorItem}get featureFormViewModel(){return this._featureFormViewModel}get utilityNetworkAssociationAddAssociationViewModel(){return this._utilityNetworkAssociationAddAssociationViewModel}get hasPendingEdits(){return!!this._utilityNetworkAssociationAddAssociationViewModel.selectedFeature}get layer(){return this.data.editorItem.layer}get parent(){return this.data.parent}get parentLayer(){var e;return(e=this.parent)==null?void 0:e.data.editorItem.layer}get reliesOnOwnerAdminPrivileges(){return this.editorItem.capabilities.create.reliesOnOwnerAdminPrivileges}async enter(){this._initializeUtilityNetworkAssociationAddAssociationViewModel()}exit(){this.removeHandles(Xi.exit)}async start(){return await super.start(),null}async _setup(e){const{data:t}=this,{feature:i}=t;try{const a=await qa(i,t.viewModel.view.spatialReference,e.signal);if(ni(e))return;const o=a.sourceLayer&&"getFeatureTitle"in a.sourceLayer?await a.sourceLayer.getFeatureTitle(a):Ta(a);if(ni(e))return;this.sourceFeatureItem={feature:i,label:o},this._initializeUtilityNetworkAssociationAddAssociationViewModel()}catch(a){this.cancel({force:!0,error:new F("editor:failed-to-fetch-full-feature","Failed to retrieve all information for this feature. The update cannot proceed.",{detail:{error:a}})})}}_initializeUtilityNetworkAssociationAddAssociationViewModel(){const{viewModel:{view:e},utilityNetwork:t,associationType:i}=this.data,a=this._utilityNetworkAssociationAddAssociationViewModel;a.graphic=this.sourceFeatureItem.feature,a.map=e==null?void 0:e.map,a.utilityNetwork=t,a.layer=this.layer,a.associationType=i,t.networkSystemLayers.loadAssociationsTable(),this.addHandles([k(()=>a.selectedLayer,o=>{o&&this.go("add-association-select-feature")}),k(()=>a.selectedFeature,o=>{o&&this.go("add-association-create-association")})],Xi.exit)}static async create(e){const t=new yi({data:await Fn.create(e),onCommit:this._onCommitFactory(e.applyEditsFeatureService)});return t._set("steps",this._createWorkflowSteps(t)),t}static _createWorkflowSteps(e){return[{id:"add-association-select-layer",async setUp(){const{utilityNetworkAssociationAddAssociationViewModel:t}=e.data.viewModel;t&&(t.selectedLayer=null,t.selectedFeature=null,t.association=null)},async tearDown(){}},{id:"add-association-select-feature",async setUp(){const{utilityNetworkAssociationAddAssociationViewModel:t}=e.data.viewModel;t&&(t.selectedFeature=null,t.association=null)},async tearDown(){}},{id:"add-association-create-association",async setUp(){},async tearDown(){}}]}};z._onCommitFactory=e=>async t=>{var f;const{feature:i,utilityNetwork:a,associationInput:o}=t,{utilityNetworkAssociationAddAssociationViewModel:r}=t.viewModel,{association:n}=r;await a.networkSystemLayers.loadAssociationsTable();const d=a==null?void 0:a.generateAddAssociations([n]);if(!d)throw new F("editor:failed-to-add-association","Could not create payload needed to add association");const c=i.sourceLayer,u=Se(c)&&c.parent?c.parent:c,p=$a([u]),h=(f=p.values().next().value)==null?void 0:f.featureService;if(!h)throw new F("editor:failed-to-delete-association","Could not retrieve feature service needed to delete association");await(h==null?void 0:h.load());const y=(a==null?void 0:a.gdbVersion)??void 0;await e(h,[d],{gdbVersion:y}),await o.refresh()},s([l()],z.prototype,"_utilityNetworkAssociationAddAssociationViewModel",void 0),s([l()],z.prototype,"_featureFormViewModel",void 0),s([l()],z.prototype,"editorItem",null),s([l()],z.prototype,"featureFormViewModel",null),s([l()],z.prototype,"utilityNetworkAssociationAddAssociationViewModel",null),s([l()],z.prototype,"sourceFeatureItem",void 0),s([l()],z.prototype,"hasPendingEdits",null),s([l()],z.prototype,"layer",null),s([l()],z.prototype,"parent",null),s([l()],z.prototype,"parentLayer",null),s([l()],z.prototype,"reliesOnOwnerAdminPrivileges",null),z=yi=s([A("esri.widgets.Editor.AddAssociationWorkflow")],z);var Wt;let ue=Wt=class extends ne{constructor(e){super(e),this.association=null,this.editorItem=null,this.edits=null,this.parent=null,this.featureFormCallbacks=null,this.viewModel=null}get attachmentsCapabilities(){const e=this.editorItem.capabilities.update.attachments.enabled;return{editing:!0,operations:{add:e,update:e,delete:e}}}get formTemplate(){return this.editorItem.formTemplate}static async create(e){const t=Wt._makeConstructorProps(e);return new Wt(t)}static _makeConstructorProps(e){const{association:t,feature:i,parent:a,featureFormCallbacks:o,viewModel:r}=e,n=r.editorItems.find(d=>d.layer===i.layer);if(!n)throw new F("no-editorItem-found","The EditorViewModel provided did not have an EditorItem associated with the specified Graphic's layer");return{association:t,editorItem:n,edits:new Wa({feature:i}),parent:a,featureFormCallbacks:o,viewModel:r}}};s([l()],ue.prototype,"association",void 0),s([l()],ue.prototype,"attachmentsCapabilities",null),s([l({constructOnly:!0})],ue.prototype,"editorItem",void 0),s([l()],ue.prototype,"edits",void 0),s([l()],ue.prototype,"formTemplate",null),s([l()],ue.prototype,"parent",void 0),s([l()],ue.prototype,"featureFormCallbacks",void 0),s([l()],ue.prototype,"viewModel",void 0),ue=Wt=s([A("esri.widgets.Editor.UpdateRecordWorkflowData")],ue);const Xa=ue;var Nt;let Ye=Nt=class extends Xa{constructor(e){super(e),this.sketchOptions=null,this.snappingManager=null}static async create(e){const{feature:t,snappingManager:i,viewModel:a}=e,o=e.sketchOptions??new zt,{view:r}=a;if(!r)throw new F("editor:cannot-create-workflow-data","The provided EditorViewModel does not have an associated view");const n=await st(r,t.layer);return new Nt({...Nt._makeConstructorProps(e),layerView:n,sketchOptions:o,snappingManager:i})}};s([l()],Ye.prototype,"layerView",void 0),s([l({constructOnly:!0})],Ye.prototype,"sketchOptions",void 0),s([l()],Ye.prototype,"snappingManager",void 0),Ye=Nt=s([A("esri.widgets.Editor.UpdateFeatureWorkflowData")],Ye);const In=Ye;var fi;const gi={exit:Symbol()};let q=fi=class extends Jt{constructor(e){super(e),this._highlightHelper=null,this.fullFeature=null,this.type="update-table-record"}initialize(){const{data:e}=this,{edits:t}=e,{view:i}=e.viewModel,a=t.feature;i&&(this._highlightHelper=new wt({view:i,highlightName:Qt}),this.addHandles(S(()=>{var r;return(r=this._highlightHelper)==null?void 0:r.removeAll()})));const o=new AbortController;this.addHandles(Bt(o)),this._updatingHandles.addPromise(qa(a,e.viewModel.view.spatialReference,o.signal).then(r=>{ni(o)||(this._onFullFeatureLoaded(r),this._initializeFeatureFormViewModel())},r=>this.cancel({force:!0,error:new F("editor:failed-to-fetch-full-feature","Failed to retrieve all information for this feature. The update cannot proceed.",{detail:{error:r}})})))}get editorItem(){return this.data.editorItem}get featureFormViewModel(){return this._featureFormViewModel}get hasPendingEdits(){return this.data.edits.modified}get layer(){return this.data.editorItem.layer}get parent(){return this.data.parent}get parentLayer(){var e;return(e=this.parent)==null?void 0:e.data.editorItem.layer}get shouldShowAttachments(){return this.editorItem.capabilities.attachments.enabled}get shouldAllowAttachmentEditing(){return this.editorItem.capabilities.update.attachments.enabled}get reliesOnOwnerAdminPrivileges(){const e=this.editorItem.capabilities;return e.update.reliesOnOwnerAdminPrivileges||e.delete.reliesOnOwnerAdminPrivileges}async deleteAndCommit(){return this.data.edits.stageDelete(),this.commit()}async enter(){this._configureAttachmentsViewModel()}exit(e){this.removeHandles(gi.exit)}async start(){return await super.start(),null}_configureAttachmentsViewModel(){const{data:e,fullFeature:t}=this,{attachmentsCapabilities:i,viewModel:a}=e,{attachmentsViewModel:o}=a;o.set({capabilities:i,graphic:t,filesEnabled:!1,mode:"view"}),this.addHandles([S(()=>o.fileInfos.removeAll()),k(()=>o.mode,r=>{switch(r){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}})],gi.exit)}_initializeFeatureFormViewModel(){const{association:e,edits:t,formTemplate:i,viewModel:{view:a}}=this.data,o=this._featureFormViewModel=new ma({activeAssociation:e,arcadeEditType:"UPDATE",feature:this.fullFeature,formTemplate:i,highlightHelper:this._highlightHelper,map:a==null?void 0:a.map,spatialReference:a.spatialReference,timeZone:a==null?void 0:a.timeZone});o.callbacks={...this.data.featureFormCallbacks,showAllRelatedRecords:n=>o.relationshipId=n.relationshipId,viewAssociatedLayers:n=>o.associationId=n.associationId,viewAssociatedFeatures:n=>o.associatedLayer=n.associatedLayer};const{initialFeature:r}=t;r&&o.overrideInitialFeature(r),this.addHandles([o.on("value-change",()=>{t.updateAttributes(o.getValues()),this.fullFeature.attributes=t.feature.attributes}),k(()=>a==null?void 0:a.timeZone,n=>o.timeZone=n)])}_onFullFeatureLoaded(e){this.fullFeature=e;const{edits:t}=this.data;t.updateAttributes(e.attributes),t.trackChanges()}static async create(e){const t=new fi({data:await Xa.create(e),onCommit:this._onCommitFactory(e.applyEdits)});return t._set("steps",this._createWorkflowSteps(t)),t}static _createWorkflowSteps(e){const{attachmentsViewModel:t}=e.data.viewModel;return[{id:"editing-attributes",async setUp(){},async tearDown(){}},{id:"adding-attachment",async setUp(){},async tearDown(){t.mode="view"}},{id:"editing-attachment",async setUp(){},async tearDown(){t.mode="view"}}]}};q._onCommitFactory=e=>async t=>{var d;const{edits:i}=t,{feature:a}=i;if(!a)return;const o=a.sourceLayer,r=a.clone();if(!i.attributesModified||i.stagedForDelete){const c=o.objectIdField;if(r.attributes={[c]:a.getAttribute(c)},o.type==="scene"&&o.infoFor3D!=null){const u=(d=o.associatedLayer)==null?void 0:d.globalIdField;u!=null&&r.setAttribute(u,a.getAttribute(u))}}i.geometryModified&&!i.stagedForDelete||(r.geometry=null);const n=i.stagedForDelete?"deleteFeatures":"updateFeatures";await e(o,{[n]:[r]})},s([l()],q.prototype,"_featureFormViewModel",void 0),s([l()],q.prototype,"editorItem",null),s([l()],q.prototype,"featureFormViewModel",null),s([l()],q.prototype,"fullFeature",void 0),s([l()],q.prototype,"hasPendingEdits",null),s([l()],q.prototype,"layer",null),s([l()],q.prototype,"parent",null),s([l()],q.prototype,"parentLayer",null),s([l()],q.prototype,"shouldShowAttachments",null),s([l()],q.prototype,"shouldAllowAttachmentEditing",null),s([l()],q.prototype,"reliesOnOwnerAdminPrivileges",null),q=fi=s([A("esri.widgets.Editor.UpdateRecordWorkflow")],q);var wi;const Y={...gi,highlights:Symbol(),sketchGraphics:Symbol(),sketchViewModel:Symbol(),waitingForTool:Symbol()};let et=wi=class extends q{constructor(e){super(e),this.type="update-feature",this._layerViewEditSession=null,this._sketchGraphicClone=null,this._sketchViewModel=null,this._webStyleCache=new Map}destroy(){var e;(e=this._layerViewEditSession)==null||e.rollback()}async commit(){this.removeHandles(Y.sketchGraphics);try{const e=this.data.edits.stagedForDelete;await super.commit();const t=this._layerViewEditSession;e?t==null||t.rollback():t==null||t.commit()}catch(e){throw await this._configureSketchViewModel(),new F("editor-workflow:failed-to-commit","An error occurred when sending the updates to the service",{error:e})}}async start(){return await super.start(),await this._initializeSketchViewModel()}_initializeFeatureFormViewModel(){super._initializeFeatureFormViewModel(),this.addHandles([this._featureFormViewModel.on("value-change",e=>{var t;(t=this._layerViewEditSession)==null||t.setAttribute(e.fieldName,e.value)}),k(()=>{var e;return(e=this._featureFormViewModel.feature)==null?void 0:e.sourceLayer},e=>this._sketchGraphicClone.sourceLayer=e)])}_configureHighlight(){const{edits:e,layerView:t}=this.data;Pr(t)&&this.addHandles(t.highlight(e.feature),Y.highlights)}async _configureSketchViewModel(){const e=this._sketchViewModel;if(!e)return;const{data:t,_featureFormViewModel:i,_sketchGraphicClone:a}=this,{edits:o,viewModel:r}=t,n=o.feature,{view:d}=r,c=Ei(n),u=await an({feature:n,featureClone:a,visualVariableAttributes:c,sketchViewModel:e,view:d,onUpdate:({geometry:p,attributes:h},y)=>{if(o.updateAttributes(h),o.updateGeometry(p),i.feature&&(i.feature.geometry=p),c.rotation!=null){const{field:f}=c.rotation;i.setValue(f,h[f])}if(c.size!=null){const{field:f}=c.size;i.setValue(f,h[f])}(y.type==="undo"||y.type==="redo"||y.type==="update"&&y.toolEventInfo!=null&&Za(y.toolEventInfo.type))&&i.notifyFeatureGeometryChanged()},addUpdatingPromise:p=>{this._updatingHandles.addPromise(p)},addHandle:p=>{this.addHandles(p,Y.waitingForTool)},webStyleCache:this._webStyleCache});this.addHandles(u,Y.sketchGraphics),e.addHandles(u)}async _initializeSketchViewModel(){const{data:e,_sketchGraphicClone:t}=this,i=e.edits.feature,{capabilities:a,layer:o}=e.editorItem,{view:r}=e.viewModel;if(this.removeHandles([Y.highlights,Y.sketchGraphics,Y.sketchViewModel,Y.waitingForTool]),!a.update.geometry||(r==null?void 0:r.type)==="3d"&&Oa(o.elevationInfo))return{enter:async()=>{this.hasHandles(Y.highlights)||this._configureHighlight()},exit:()=>this.removeHandles([Y.highlights])};const n=new Zt({elevationInfo:o.elevationInfo,internal:!0,listMode:"hide"}),d=new Ti({allowDeleteKey:!1,layer:n,sketchOptions:e.sketchOptions,snappingManager:e.snappingManager,updateOnGraphicClick:!1,view:r});return this._sketchViewModel=d,r==null||r.map.add(n),this.addHandles(S(()=>{r!=null&&r.destroyed||(r==null||r.map.remove(n)),n.destroy(),this._sketchViewModel=ft(d)}),Y.sketchViewModel),await Ee(t,this._webStyleCache,(r==null?void 0:r.type)==="2d"?r.scale:null),this.addHandles([await on(d,i,t)]),{enter:async()=>{this.hasHandles(Y.sketchGraphics)||await this._configureSketchViewModel()},exit:()=>this.removeHandles([Y.sketchGraphics]),viewModel:d}}_onFullFeatureLoaded(e){super._onFullFeatureLoaded(e);const t=this._sketchGraphicClone=hi(e),{edits:i,layerView:a}=this.data;i.updateGeometry(e.geometry),i.trackChanges(),cn(a)&&(this._layerViewEditSession=a.createInteractiveEditSession(t))}static async create(e){const t=new wi({data:await In.create(e),onCommit:this._onCommitFactory(e.applyEdits)});return t._set("steps",this._createWorkflowSteps(t)),t}get test(){}};s([l()],et.prototype,"_layerViewEditSession",void 0),s([l()],et.prototype,"_sketchGraphicClone",void 0),s([l()],et.prototype,"_sketchViewModel",void 0),et=wi=s([A("esri.widgets.Editor.UpdateFeatureWorkflow")],et);let pe=class extends ne{constructor(t){super(t),this.addAttachmentsCallback=null,this.applyEditsCallback=null,this.applyEditsFeatureServiceCallback=null,this.candidates=null,this.rootFeature=null,this.sketchOptions=null,this.snappingManager=null,this.viewModel=null}};s([l()],pe.prototype,"addAttachmentsCallback",void 0),s([l()],pe.prototype,"applyEditsCallback",void 0),s([l()],pe.prototype,"applyEditsFeatureServiceCallback",void 0),s([l()],pe.prototype,"candidates",void 0),s([l()],pe.prototype,"rootFeature",void 0),s([l({constructOnly:!0})],pe.prototype,"sketchOptions",void 0),s([l()],pe.prototype,"snappingManager",void 0),s([l()],pe.prototype,"viewModel",void 0),pe=s([A("esri.widgets.Editor.UpdateWorkflowData")],pe);const Tn=pe;var vi;const Ya="esri.widgets.Editor.UpdateWorkflow",An=()=>ae.getLogger(Ya);let N=vi=class extends Jt{constructor(e){super(e),this._workflowStack=new Di($i),this._sketchStack=new Di($i),this.data=void 0,this.type="update"}destroy(){this._drainWorkflowStack(e=>e.cancel({force:!0}))}get activeEditorItem(){var e;return((e=this.activeWorkflow)==null?void 0:e.data.editorItem)??void 0}get activeFeatureFormViewModel(){var e;return(e=this.activeWorkflow)==null?void 0:e.featureFormViewModel}get activeUtilityNetworkAssociationAddAssociationViewModel(){var e;return((e=this.activeWorkflow)==null?void 0:e.type)==="add-association"?this.activeWorkflow.utilityNetworkAssociationAddAssociationViewModel:null}get activeSketchViewModel(){var e;return(e=this._sketchStack.peek())==null?void 0:e.viewModel}get canDeleteAssociation(){var a;const{activeFeatureFormViewModel:e}=this;if(!this.activeWorkflow||!((a=this.data.viewModel.view)!=null&&a.map)||!e)return!1;const{activeAssociation:t,feature:i}=e;return!(!t||!(i!=null&&i.sourceLayer)||!ki(i==null?void 0:i.sourceLayer)&&!Se(i==null?void 0:i.sourceLayer))}get activeWorkflow(){return this._workflowStack.last()}get updating(){var e;return this._updatingHandles.updating||!!((e=this.activeWorkflow)!=null&&e.updating)}get hasPreviousStep(){var t;const e=(t=this.activeWorkflow)==null?void 0:t.featureFormViewModel;return this._stepIndex>0||this.nestedWorkflowCount>1||(e==null?void 0:e.relationshipId)!=null||this.data.viewModel.attachmentsViewModel.mode!=="view"||(e==null?void 0:e.associationId)!=null||(e==null?void 0:e.associatedLayer)!=null}get hasUpdatableCandidates(){const{candidates:e,viewModel:t}=this.data;return e.some(({layer:i})=>{var a;return(a=t.findEditorItemForLayer(i))==null?void 0:a.supportsUpdateWorkflow})}get nestedWorkflowCount(){return this._workflowStack.length}get shouldShowAttachments(){var e;return!!((e=this.activeEditorItem)!=null&&e.capabilities.attachments.enabled)}get shouldAllowAttachmentEditing(){var e;return!!((e=this.activeEditorItem)!=null&&e.capabilities.update.attachments.enabled)}get hasPendingEdits(){return Array.from(this._workflowStack).some(e=>e.hasPendingEdits)}get helpMessage(){var e;return(e=this.activeWorkflow)!=null&&e.helpMessage?this.activeWorkflow.helpMessage:this.stepId==="awaiting-feature-to-update"?"select":void 0}get reliesOnOwnerAdminPrivileges(){var e;return((e=this.activeWorkflow)==null?void 0:e.reliesOnOwnerAdminPrivileges)??!1}get hasInvalidFormTemplate(){var e;return!!((e=this.activeEditorItem)!=null&&e.hasInvalidFormTemplate)}async back(e=()=>Promise.resolve(!0)){const{activeWorkflow:t}=this,i=t==null?void 0:t.featureFormViewModel;if(i!=null&&i.activeRelationshipInput){const a=i.activeRelationshipInput;if(a.activeCategory)return void(a.activeCategory=null);if(i.relationshipId!=null)return void(i.relationshipId=null);if(a.showAllEnabled)return void(a.showAllEnabled=!1)}if((t==null?void 0:t.type)==="add-association"){const{activeUtilityNetworkAssociationAddAssociationViewModel:a}=this;if(a!=null&&a.filterOptionsVisible)return void(a.filterOptionsVisible=!1)}if((i==null?void 0:i.associatedLayer)==null)if((i==null?void 0:i.associationId)==null)if((t==null?void 0:t.type)==="create-features"&&t.hasPreviousStep)await t.previous({cancelCurrentStep:!0});else if(t){if(t.hasPendingEdits&&!await e())return;t.hasPreviousStep?await t.previous({cancelCurrentStep:!0}):await this.cancelActiveWorkflow({force:!0})}else this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0});else i.associationId=null;else i.associatedLayer=null}async cancelActiveWorkflow(e){var t;await((t=this.activeWorkflow)==null?void 0:t.cancel(e)),await this._popWorkflow()}async commit(){await this._drainWorkflowStack(e=>e.commit()),await super.commit()}static create(e){const{viewModel:t,snappingManager:i,startAt:a,addAttachmentsCallback:o,applyEditsCallback:r,applyEditsFeatureServiceCallback:n}=e,d=e.sketchOptions??new zt,c=new vi({data:new Tn({addAttachmentsCallback:o,applyEditsCallback:r,applyEditsFeatureServiceCallback:n,sketchOptions:d,snappingManager:i,viewModel:t}),onCommit:async()=>{}});return c._set("steps",this._createWorkflowSteps(c,a)),c}async save(){var e;this.nestedWorkflowCount>1?(await((e=this.activeWorkflow)==null?void 0:e.commit()),await this._popWorkflow()):await this.commit()}async startCreatingRelatedRecord(e){try{const t=await this._createNestedCreateFeaturesWorkflow(e);await this._pushWorkflow(t)}catch(t){throw new F("editor:unable-to-start-creating","Could not begin updating the provided feature or table record.",{error:t})}}async startUpdating(e,t){try{const i=await this._createNestedUpdateWorkflow(e,t);await this._pushWorkflow(i)}catch(i){throw new F("editor:unable-to-start-updating","Could not begin updating the provided feature or table record.",{error:i})}}async startAddAssociation(e,t,i){try{const a=await this._createNestedAddAssociationWorkflow(e,t,i);await this._pushWorkflow(a)}catch(a){throw new F("editor:unable-to-start-updating","Could not begin updating the provided feature or table record.",{error:a})}}async deleteActiveFeature(){const{activeWorkflow:e}=this;if(!e)throw new F("editor:nothing-to-delete","There is no feature to delete");Cn(e)?await e.deleteAndCommit():await e.cancel(),this.nestedWorkflowCount===1?await this.reset():(await this._popWorkflow(),await this._returnToPageWithContent())}async deleteActiveAssociation(){if(!this.canDeleteAssociation)throw new F("editor:nothing-to-delete","There is no association to delete");await this._deleteActiveAssociation(),await this._popWorkflow(),await this._returnToPageWithContent()}async cancelAll(){await this._drainWorkflowStack(e=>e.cancel({force:!0}))}async _deleteActiveAssociation(){var g;const{activeFeatureFormViewModel:e,data:t}=this,{activeAssociation:i,feature:a}=e,{applyEditsFeatureServiceCallback:o,viewModel:r}=t,{sourceLayer:n}=a,d=Se(n)&&n.parent?n.parent:n,c=$a([d]),u=(g=c.values().next().value)==null?void 0:g.featureService;if(!u)throw new F("editor:failed-to-delete-association","Could not retrieve feature service needed to delete association");await(u==null?void 0:u.load());const p=r.view.map,h=Mr(p,d);await(h==null?void 0:h.networkSystemLayers.loadAssociationsTable());const y=h==null?void 0:h.generateDeleteAssociations([i]);if(!y)throw new F("editor:failed-to-delete-association","Could not create payload needed to delete association");const f=(h==null?void 0:h.gdbVersion)??void 0;await o(u,[y],{gdbVersion:f,globalIdUsed:!0})}async _returnToPageWithContent(){var a;const{activeFeatureFormViewModel:e}=this;if(!(e!=null&&e.activeAssociationInput))return;const{activeAssociationInput:t,associationId:i}=e;await t.refresh(),t.associatedLayer&&!((a=t.associatedFeatures)!=null&&a.length)&&(e.associatedLayer=null),i==null||t.associatedFeatureInfos.size||(e.associationId=null)}async _createNestedCreateFeaturesWorkflow(e){var h,y;const{relatedLayer:t}=e,{addAttachmentsCallback:i,applyEditsCallback:a,applyEditsFeatureServiceCallback:o,sketchOptions:r,snappingManager:n,viewModel:d}=this.data;if(!ci(t))throw new F("editor:unsupported-layer","Editing is not supported on the provided layer");const c=this._getCreationInfoForNestedCreateFeaturesWorkflow(e),u=c.template||c.initialFeature?"creating-features":"awaiting-feature-creation-info",p=((h=this.activeWorkflow)==null?void 0:h.type)!=="create-features"&&((y=this.activeWorkflow)==null?void 0:y.type)!=="add-association"?this.activeWorkflow:void 0;return Ka.create({addAttachmentsCallback:i,applyEditsCallback:a,applyEditsFeatureServiceCallback:o,creationInfo:c,isNested:!0,parent:p,sketchOptions:r,snappingManager:n,startAt:u,viewModel:d})}_getCreationInfoForNestedCreateFeaturesWorkflow(e){const{relatedLayer:t}=e;if(!ci(t)||Be(t))throw new F("editor:unsupported-layer","Editing is not supported on the provided layer");const{viewModel:i}=this.data,a={layer:t,maxFeatures:1},o=this._makeRelatedRecordAttributes(e),r=i.getTemplatesForLayer(t);return(r==null?void 0:r.length)>0?(a.attributeOverrides=o,r.length===1&&(a.template=r[0])):a.initialFeature=new Le({sourceLayer:t,attributes:o}),a}async _createNestedUpdateWorkflow(e,t){var p,h;const i=ot(e.sourceLayer)?q:et,{applyEditsCallback:a,applyEditsFeatureServiceCallback:o,sketchOptions:r,snappingManager:n,viewModel:d}=this.data,c=((p=this.activeWorkflow)==null?void 0:p.type)!=="create-features"&&((h=this.activeWorkflow)==null?void 0:h.type)!=="add-association"?this.activeWorkflow:void 0,u=await i.create({association:t,feature:e,parent:c,sketchOptions:r,snappingManager:n,viewModel:d,applyEdits:a,applyEditsFeatureService:o,featureFormCallbacks:{addRelatedRecord:async y=>await this.startCreatingRelatedRecord(y),editRelatedRecord:async({relatedFeature:y})=>await this.startUpdating(y),selectAssociatedFeature:async({feature:y,association:f})=>await this.startUpdating(y,f),addAssociation:async y=>await this.startAddAssociation(y.feature,y.utilityNetwork,y.associationType)}});return await j(()=>!u.updating),u}async _createNestedAddAssociationWorkflow(e,t,i){var p,h,y;const a=z,{applyEditsCallback:o,applyEditsFeatureServiceCallback:r,viewModel:n}=this.data,d=((p=this.activeWorkflow)==null?void 0:p.type)!=="create-features"&&((h=this.activeWorkflow)==null?void 0:h.type)!=="add-association"?this.activeWorkflow:void 0,c=(y=this.activeFeatureFormViewModel)==null?void 0:y.activeAssociationInput,u=await a.create({utilityNetwork:t,associationType:i,feature:e,parent:d,viewModel:n,associationInput:c,applyEdits:o,applyEditsFeatureService:r});return await j(()=>!u.updating),u}async _drainWorkflowStack(e){const t=this._workflowStack,i=[];for(;t.length>0;){const a=t.pop();this._sketchStack.pop();const o=e(a).then(()=>a.destroy());this._updatingHandles.addPromise(o),i.push(o)}await Promise.all(i)}_makeRelatedRecordAttributes(e){var p,h;const{parentFeature:t,relatedLayer:i,relationshipId:a}=e;if(!Er(t))return;const o=(p=i.relationships)==null?void 0:p.find(y=>y.id===a);if(!o)return void ct("relationship-not-found","Could not begin creating a related record because the relationship specified could not be found on the destination layer.");if(o.role==="origin")return void ct("unsupported-role","Creating new related records in the 'origin' table of a relationship is not yet supported");const r=t.sourceLayer;o.relatedTableId!==r.layerId&&ct("invalid-argument-combination","The given parent feature does not belong to the relationship designated by the given relationship ID.");const n=(h=r.relationships)==null?void 0:h.find(y=>y.id===a);if(!n)return void ct("relationship-not-found","Could not begin creating a related record because the relationship specified could not be found on the origin layer.");const d=Yi(r,n),c=t.getAttribute(d);return c||ct("no-key-on-origin-feature","The given parent feature does not have a value for the relationship's origin primary key field."),{[Yi(i,o)]:c}}async _popWorkflow(){var t;(t=this._workflowStack.pop())==null||t.destroy(),this._sketchStack.pop();const e=await this._reconcileWorkflowStack();if(e.failureCount>0)throw new F("editor:next-workflow-failed","Popped the top workflow, but the next workflow in the stack failed to activate",e)}async _pushWorkflow(e){var n;const t=this._workflowRequiresSketchViewModel(e);(n=this.activeWorkflow)==null||n.exit({removeSketchHandles:t});const i=this._sketchStack,a=await(e==null?void 0:e.start()),o=i.peek();a?(o==null||o.exit(),i.push(a)):i.push(this._cloneSketchController(o)),this._workflowStack.push(e);const r=await this._reconcileWorkflowStack();if(r.failureCount>0)throw new F("editor:failed-to-start-updating-feature","Failed to enter the provided workflow.",r)}async _reconcileWorkflowStack(){var i;const e=this._workflowStack,t=this._sketchStack;try{const a=e.peek();return await(a==null?void 0:a.enter()),await((i=t.peek())==null?void 0:i.enter()),{activeWorkflow:a,failureCount:0}}catch{e.pop().destroy(),t.pop();const{activeWorkflow:o,failureCount:r}=await this._reconcileWorkflowStack();return{activeWorkflow:o,failureCount:r+1}}}_cloneSketchController(e){return{enter:(e==null?void 0:e.enter)??(async()=>{}),exit:(e==null?void 0:e.exit)??(async()=>{}),viewModel:e==null?void 0:e.viewModel}}_workflowRequiresSketchViewModel(e){var i;const{type:t}=e;return t==="update-feature"||t==="create-features"&&!ot((i=e.data.creationInfo)==null?void 0:i.layer)}static _createWorkflowSteps(e,t="awaiting-feature-to-update"){const{data:i}=e;return za(["awaiting-feature-to-update","awaiting-update-feature-candidate","editing-existing-feature","adding-attachment","editing-attachment"],t,{"awaiting-feature-to-update":()=>({id:"awaiting-feature-to-update",async setUp(){const{spinnerViewModel:a}=i.viewModel,o=i.viewModel.view;o.activeTool=null;let r=null;e.addHandles(S(()=>{r=oe(r)}),this.id),i.rootFeature=null,i.candidates=[];const n=o.on("immediate-click",async c=>{const u=bt();e._updatingHandles.addPromise(u.promise);try{a.location=c.mapPoint,a.visible=!0,r==null||r.abort();const{editorItems:p}=i.viewModel;r=new AbortController;const h=await c.async(()=>new Promise((y,f)=>{si(r==null?void 0:r.signal,()=>f(pa())),y(Ks(p,o,c,r==null?void 0:r.signal))}));if(De(r),i.candidates=h.filter(y=>y.status==="fulfilled").flatMap(y=>y.value).filter(y=>!y.isAggregate),a.visible=i.candidates.length===1,i.candidates.length===0)return;c.stopPropagation(),i.candidates.length===1?(i.rootFeature=i.candidates[0],e.go("editing-existing-feature").catch(()=>{}).then(()=>a.visible=!1)):e.next()}finally{u.resolve()}},Tr.TOOL),d=_e(()=>o.activeTool!=null,()=>e.cancel({force:!0}),{once:!0});o.focus(),e.addHandles([n,d],this.id)},async tearDown(){i.candidates.length===0&&(i.viewModel.spinnerViewModel.visible=!1),e.removeHandles(this.id)}}),"awaiting-update-feature-candidate":()=>({id:"awaiting-update-feature-candidate",async setUp(){i.rootFeature=null;const{view:a}=i.viewModel;if(!a)return;const o=new wt({view:a,highlightName:Qt});e.addHandles([k(()=>i.rootFeature,(r,n)=>{o.remove(n),o.add(r)},Rt),S(()=>o.removeAll())],this.id)},async tearDown(){e.removeHandles(this.id)}}),"editing-existing-feature":()=>({id:"editing-existing-feature",async setUp(){const{rootFeature:a,viewModel:o}=e.data;if(!a)throw new F("editor:no-feature-specified","Cannot setup the 'updating-existing-feature' step until the root feature is defined");await e.startUpdating(a),o.spinnerViewModel.visible=!1;const r=Ne(async()=>{await j(()=>!e.updating),e.previous()});e.addHandles([k(()=>e.nestedWorkflowCount,(n,d)=>{n===0&&d!==0&&r()},Rt)],this.id)},async tearDown(){await e.cancelAll(),e.removeHandles(this.id)}}),"adding-attachment":()=>({id:"adding-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){i.viewModel.attachmentsViewModel.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){i.viewModel.attachmentsViewModel.mode="view"}})})}};function Yi(e,{keyField:t}){var i;return((i=e.getField(t))==null?void 0:i.name)??t}s([l()],N.prototype,"activeEditorItem",null),s([l()],N.prototype,"activeFeatureFormViewModel",null),s([l()],N.prototype,"activeUtilityNetworkAssociationAddAssociationViewModel",null),s([l()],N.prototype,"activeSketchViewModel",null),s([l()],N.prototype,"canDeleteAssociation",null),s([l()],N.prototype,"activeWorkflow",null),s([l()],N.prototype,"updating",null),s([l()],N.prototype,"data",void 0),s([l()],N.prototype,"hasPreviousStep",null),s([l()],N.prototype,"hasUpdatableCandidates",null),s([l()],N.prototype,"nestedWorkflowCount",null),s([l()],N.prototype,"shouldShowAttachments",null),s([l()],N.prototype,"shouldAllowAttachmentEditing",null),s([l()],N.prototype,"hasPendingEdits",null),s([l()],N.prototype,"helpMessage",null),s([l()],N.prototype,"reliesOnOwnerAdminPrivileges",null),s([l()],N.prototype,"hasInvalidFormTemplate",null),N=vi=s([A(Ya)],N);const ct=(e,t)=>An().warn(`editor:${e}`,t,"The create operation will be allowed to proceed, but the resulting feature may not be related to the given parent feature."),Cn=e=>!!e&&/update-/.test(e.type),Mn=N;let K=class extends ne{constructor(t){super(t),this.layer=null}get attachments(){var t;return{enabled:this._effectiveEnabled&&!!((t=this._effectiveCapabilities)!=null&&t.data.supportsAttachment)}}get create(){var d;const{_effectiveCapabilities:t,layer:i}=this,a=this._createEnabled,o=a,r=(d=i.capabilities)==null?void 0:d.operations.supportsAdd,n=!!(t!=null&&t.operations.supportsAdd);return{attachments:{enabled:a&&this.attachments.enabled},attributes:a,enabled:a,geometry:o,reliesOnOwnerAdminPrivileges:!r&&n}}get delete(){var r;const{_effectiveCapabilities:t,layer:i}=this,a=(r=i.capabilities)==null?void 0:r.operations.supportsDelete,o=!!(t!=null&&t.operations.supportsDelete);return{enabled:this._effectiveEnabled&&!!(t!=null&&t.operations.supportsDelete),reliesOnOwnerAdminPrivileges:!a&&o}}get reliesOnOwnerAdminPrivileges(){return this._effectiveEnabled&&!this.layer.editingEnabled||this.create.reliesOnOwnerAdminPrivileges||this.update.reliesOnOwnerAdminPrivileges||this.delete.reliesOnOwnerAdminPrivileges}get update(){var u;const{_effectiveCapabilities:t,layer:i}=this,a=this._updateEnabled,o=!(!a||!(t!=null&&t.editing.supportsGeometryUpdate)),r=(u=i.capabilities)==null?void 0:u.operations.supportsUpdate,n=!!(t!=null&&t.operations.supportsUpdate),d=this.attachments.enabled,c=d&&this._canCreateOrUpdate;return{attachments:{enabled:d,create:c,update:c},attributes:a,enabled:a,geometry:o,reliesOnOwnerAdminPrivileges:!r&&n}}get _createEnabled(){var t;return this._effectiveEnabled&&!!((t=this._effectiveCapabilities)!=null&&t.operations.supportsAdd)}get _updateEnabled(){var t;return this._effectiveEnabled&&!!((t=this._effectiveCapabilities)!=null&&t.operations.supportsUpdate)}get _canCreateOrUpdate(){return!(!this._createEnabled&&!this._updateEnabled)}get _effectiveEnabled(){return Po(this.layer)}get _effectiveCapabilities(){return Vo(this.layer)}};s([l()],K.prototype,"attachments",null),s([l()],K.prototype,"create",null),s([l()],K.prototype,"delete",null),s([l()],K.prototype,"layer",void 0),s([l()],K.prototype,"reliesOnOwnerAdminPrivileges",null),s([l()],K.prototype,"update",null),s([l()],K.prototype,"_createEnabled",null),s([l()],K.prototype,"_updateEnabled",null),s([l()],K.prototype,"_canCreateOrUpdate",null),s([l()],K.prototype,"_effectiveEnabled",null),s([l()],K.prototype,"_effectiveCapabilities",null),K=s([A("esri.layers.support.EditingCapabilities")],K);const ea=K,Je="esri.views.layers.support.editableLayerViews";function En(e,t){const{associatedLayer:i}=e,a=i==null?void 0:i.infoFor3D;if(!a)return!1;const o=Vr(a);if(!(o!=null&&a.queryFormats.includes(o)))return ae.getLogger(Je).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because it does not support GLB queries.`),!1;const r=e.spatialReference,n=i.spatialReference;if(!Kt(r,n))return ae.getLogger(Je).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because its spatial reference (wkid:${r.wkid}) is different from its associated FeatureLayer's spatial reference (wkid:${n.wkid}).`),!1;const d=i.sourceJSON.sourceSpatialReference;if(!(d==null||Kt(d,n)))return ae.getLogger(Je).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because the spatial reference of its associated FeatureLayer's service (wkid:${n.wkid}) is different from its source spatial reference (wkid:${d.wkid}).`),!1;const{view:c}=t;if(t.destroyed||c==null)return!1;const u=c.spatialReference,{viewingMode:p}=c.state,h=Bo(r),y=p===Wr.Global;return h&&!y?(ae.getLogger(Je).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits in local viewing mode because its spatial reference (wkid:${r.wkid}) is geographic. Please consider changing the viewing mode to global.`),!1):!h&&y?(ae.getLogger(Je).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits in global viewing mode because its spatial reference (wkid:${r.wkid}) is projected. Please consider changing the viewing mode to local.`),!1):!!(Kt(r,u)||y&&zo(u)&&Zo(r))||(ae.getLogger(Je).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because its spatial reference (wkid:${r.wkid}) does not match the view spatial reference (wkid:${u.wkid}).`),!1)}let ie=class extends ea{constructor(t){super(t),this.layerInfo=null,this.layerView=null}get attachments(){const t=this.defaults.attachments.enabled,i=this.layerInfo;return{enabled:t&&(i==null?void 0:i.enabled)!==!1}}get create(){const{attachments:t,defaults:i,layerInfo:a,layer:o,layerView:r}=this,n=i.create,d=(a==null?void 0:a.enabled)!==!1&&(a==null?void 0:a.addEnabled)!==!1,c=n.enabled&&d;return{attributes:c&&n.attributes,enabled:c,geometry:c&&n.geometry&&ta(o,r),attachments:{enabled:t.enabled&&c&&(a==null?void 0:a.attachmentsOnCreateEnabled)!==!1},reliesOnOwnerAdminPrivileges:n.reliesOnOwnerAdminPrivileges}}get defaults(){return new ea({layer:this.layer})}get delete(){const{defaults:t,layerInfo:i}=this,a=t.delete,o=(i==null?void 0:i.enabled)!==!1&&(i==null?void 0:i.deleteEnabled)!==!1;return{enabled:a.enabled&&o,reliesOnOwnerAdminPrivileges:a.reliesOnOwnerAdminPrivileges}}get formTemplate(){const{layer:t,layerInfo:i}=this;return i!=null&&i.formTemplate?i.formTemplate:t&&"formTemplate"in t?t.formTemplate:null}get relationship(){var o,r,n;const{layer:t}=this,i=!(!Sr(t)||!((o=t.relationships)!=null&&o.length)),a=!!((n=(r=this.formTemplate)==null?void 0:r.elements)!=null&&n.some(d=>d.type==="relationship"));return{enabled:i&&a}}get update(){const{attachments:t,defaults:i,layerInfo:a,layer:o,layerView:r}=this,n=i.update,d=(a==null?void 0:a.enabled)!==!1&&(a==null?void 0:a.updateEnabled)!==!1,c=n.enabled&&d,u=c&&n.attributes&&(a==null?void 0:a.attributeUpdatesEnabled)!==!1,p=c&&n.geometry&&(a==null?void 0:a.geometryUpdatesEnabled)!==!1&&ta(o,r),h=t.enabled&&(a==null?void 0:a.attachmentsOnUpdateEnabled)!==!1;return{attributes:u,enabled:c,geometry:p,attachments:{enabled:h,create:h&&n.attachments.create,update:h&&n.attachments.update},reliesOnOwnerAdminPrivileges:n.reliesOnOwnerAdminPrivileges}}};function ta(e,t){return e.type!=="scene"||t!=null&&"type"in t&&t.type==="scene-layer-3d"&&En(e,t)}s([l()],ie.prototype,"attachments",null),s([l()],ie.prototype,"create",null),s([l()],ie.prototype,"defaults",null),s([l()],ie.prototype,"delete",null),s([l()],ie.prototype,"formTemplate",null),s([l()],ie.prototype,"layerInfo",void 0),s([l()],ie.prototype,"layerView",void 0),s([l()],ie.prototype,"relationship",null),s([l()],ie.prototype,"update",null),ie=s([A("esri.widgets.Editor.support.EditorEditingCapabilities")],ie);const Sn=ie;let G=class extends ne{constructor(t){super(t),this.disabled=!1,this.layer=null,this.layerInfo=null,this.layerView=null}get _suspended(){var t;return!!((t=this.layerView)!=null&&t.suspended)}get capabilities(){return new Sn({layer:this.layer,layerInfo:this.layerInfo,layerView:this.layerView})}get editable(){const{create:t,relationship:i,update:a,delete:{enabled:o}}=this.capabilities,r=t.attachments.enabled||a.attachments.enabled;return!this.disabled&&(t.enabled||a.enabled||r||o||i.enabled)}get formTemplate(){return this.capabilities.formTemplate}get hasInvalidFormTemplate(){return er(this.layer,this.formTemplate)}get isTable(){return ot(this.layer)}get supportsCreateFeaturesWorkflow(){var a,o;if(this.disabled||((o=(a=this.layerView)==null?void 0:a.view)==null?void 0:o.type)==="3d"&&Oa(this.layer.elevationInfo))return!1;const{enabled:t,geometry:i}=this.capabilities.create;return this.isTable?t:t&&i}get supportsUpdateWorkflow(){const{capabilities:t}=this;return!this.disabled&&(t.update.enabled||t.update.attachments.enabled||t.delete.enabled)}get visible(){const{layer:t}=this,i=t.parent;return!this._suspended&&t.visible&&(!i||!("visible"in i)||i.visible)}};s([l()],G.prototype,"_suspended",null),s([l()],G.prototype,"capabilities",null),s([l()],G.prototype,"disabled",void 0),s([l()],G.prototype,"editable",null),s([l()],G.prototype,"formTemplate",null),s([l()],G.prototype,"hasInvalidFormTemplate",null),s([l()],G.prototype,"isTable",null),s([l()],G.prototype,"layer",void 0),s([l()],G.prototype,"layerInfo",void 0),s([l()],G.prototype,"layerView",void 0),s([l()],G.prototype,"supportsCreateFeaturesWorkflow",null),s([l()],G.prototype,"supportsUpdateWorkflow",null),s([l()],G.prototype,"visible",null),G=s([A("esri.widgets.Editor.support.EditorItem")],G);const Ln=G,eo="esri.widgets.Editor.EditorViewModel",$n=()=>ae.getLogger(eo);function Pe(e,t,i){$n().error(new F(e,t,i))}function On(e,t){return e==null?void 0:e.find(i=>i.layer===t)}let I=class extends _a.EventedAccessor{constructor(e){super(e),this._templatesByLayer=new Map,this._sketchEventListenerHandle=null,this._sketchGraphicsLayer=new Zt({listMode:"hide",internal:!0}),this._snappingManager=null,this._updateItemsTask=null,this._updateTemplatesTask=null,this._updatingHandles=new ht,this._featureTemplatesViewModelIsRestricted=!1,this.activeWorkflow=null,this._activityQueue=new xe,this.editorItems=new xe,this.failures=[],this.hideTemplatesForInactiveLayers=!1,this.attachmentsViewModel=new ha({capabilities:{editing:!0}}),this.featureTemplatesViewModel=new wa({disabledItemFunction:({layer:t})=>this._itemIsSuspended(t)}),this.layerInfos=null,this.ownSketchViewModel=new Ti({layer:this._sketchGraphicsLayer}),this.sketchOptions=new zt,this.snappingOptions=new ka({attributeRulesEnabled:!0}),this.spinnerViewModel=new Lo,this.pageStack=[],this.showDiscardEditsPrompt=()=>Promise.resolve(!0),this._candidateCommitted=!1,this.back=async()=>{var t;this.canGoBack&&((t=this.activeWorkflow)!=null&&t.hasPreviousStep?await this.activeWorkflow.back(this.showDiscardEditsPrompt):await this._cancelWorkflow({force:!this.hasPendingEdits}))},this.saveWorkflow=async()=>{var i,a;const{featureFormViewModel:t}=this;if(t&&((i=this.activeWorkflow)==null?void 0:i.type)!=="create-features"){if(t.submit(),!t.submittable||t.pendingSubtypeChoice)return;const o=t.getValues();if(t.validateContingencyConstraints(o,{includeIncompleteViolations:!0}).length>0)return}await((a=this.activeWorkflow)==null?void 0:a.save())},this.selectFeature=(t,i=!1)=>{const a=this.activeWorkflow;this._candidateCommitted||(a==null?void 0:a.type)!=="update"||(a.data.rootFeature=t,i&&(a.next(),this._candidateCommitted=!0))}}initialize(){this.addHandles([k(()=>{var o;const e=this.view,t=(o=e==null?void 0:e.map)==null?void 0:o.editableLayers.toArray(),i=e==null?void 0:e.allLayerViews,a=i==null?void 0:i.filter(r=>!!(t!=null&&t.includes(r.layer)));return[t,a,this.layerInfos]},()=>this._updateEditorItems(),Ke),k(()=>this.hideTemplatesForInactiveLayers,()=>this.syncFeatureTemplates()),ke(()=>this.activeWorkflow,"cancel",()=>this.emit("workflow-cancel")),ke(()=>this.activeWorkflow,"commit",()=>this.emit("workflow-commit")),ke(()=>this.activeWorkflow,"complete",()=>{this.emit("workflow-commit"),this._set("activeWorkflow",null)}),_e(()=>{var e;return(e=this.view)==null?void 0:e.map},e=>e.add(this._sketchGraphicsLayer),H),ke(()=>this.editorItems,"change",()=>this._afterEditorItemsChange()),k(()=>[this.canCreate,this.canUpdateVisible],()=>this._afterEditorItemsChange()),k(()=>this.page,(e,t)=>{const i=[...this.pageStack];if(i.indexOf(e)===-1)i.push(e);else for(;i.length&&i.at(-1)!==e;)i.pop();this.pageStack=i},Ke),_e(()=>this.state==="awaiting-update-feature-candidate",()=>this._candidateCommitted=!1),ke(()=>this.featureTemplatesViewModel,"select",async({item:e,oldItem:t})=>{var o;const{activeWorkflow:i}=this;if(i){if(i.type==="update"&&((o=i.activeWorkflow)==null?void 0:o.stepId)==="awaiting-feature-creation-info")return;try{await this.cancelWorkflow({force:!this.hasPendingEdits})}catch{return void this.featureTemplatesViewModel.select(t,{emit:!1})}}if(!e)return;const a={layer:e.layer,template:e.template};if(e.supportsUpload)return this.featureTemplatesViewModel.select(t,{emit:!1}),this.startCreateFeaturesWorkflow(a);this.startCreateFeaturesWorkflowAtFeatureCreation(a)}),k(()=>[this.view,this.featureTemplatesViewModel],([e,t])=>{t.view=e},Ke),ke(()=>this.view,"key-down",e=>{var t;e.key==="Escape"&&((t=this.activeWorkflow)!=null&&t.keyboardCancellationEnabled)&&(e.stopPropagation(),this.back())}),ke(()=>this.sketchViewModel,["create","delete","update"],e=>{var n,d;const{activeWorkflow:t}=this,i=(t==null?void 0:t.type)==="update",a=i?(n=t.activeWorkflow)==null?void 0:n.layer:t==null?void 0:t.layer,o=i?(d=t==null?void 0:t.activeWorkflow)==null?void 0:d.parentLayer:void 0,r=`sketch-${e.type}`;this.emit(r,{type:r,detail:e,layer:a,parentLayer:o})},Rt),k(()=>this.view,e=>{if(this._snappingManager=ft(this._snappingManager),!e)return;const t=this.snappingOptions;this._snappingManager=new Uo({view:e,options:t}),this.ownSketchViewModel.snappingManager=this._snappingManager},Ke),k(()=>this.snappingOptions,e=>{this._snappingManager&&(this._snappingManager.options=e)},Ke)])}destroy(){this._cancelWorkflow({warnIfNoWorkflow:!1}).then(()=>{var e,t;(t=(e=this.view)==null?void 0:e.map)==null||t.remove(this._sketchGraphicsLayer),this.view=null}),this._updateItemsTask=oe(this._updateItemsTask),this._updatingHandles.destroy(),this._sketchEventListenerHandle=Ot(this._sketchEventListenerHandle)}get _featureTemplatesLayersAndTables(){const e=new xe;for(const t of this.editorItems){const i=this.hideTemplatesForInactiveLayers&&!t.visible;t.supportsCreateFeaturesWorkflow&&!i&&e.push(t.layer)}return e}get activeLeafWorkflow(){const e=this.activeWorkflow;return e&&Ls(e)?e.activeWorkflow??e:e}get canCreate(){return this.editorItems.some(e=>e.supportsCreateFeaturesWorkflow)}get canCreateVisible(){return!!this.featureTemplatesLayers.length}get canUpdate(){return this.editorItems.some(e=>e.supportsUpdateWorkflow)}get canUpdateVisible(){return this.editorItems.some(e=>e.supportsUpdateWorkflow&&e.visible)}get featureTemplatesLayers(){return this._featureTemplatesLayersAndTables.filter(e=>e.type==="scene"||!e.isTable)}get featureFormViewModel(){const{activeWorkflow:e}=this;return(e==null?void 0:e.type)==="update"?e.activeFeatureFormViewModel:(e==null?void 0:e.type)==="create-features"?e.featureFormViewModel:null}get utilityNetworkAssociationAddAssociationViewModel(){const{activeWorkflow:e}=this;return(e==null?void 0:e.type)==="update"?e.activeUtilityNetworkAssociationAddAssociationViewModel:null}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get sketchViewModel(){const{activeWorkflow:e}=this;return(e==null?void 0:e.type)==="update"?e.activeSketchViewModel:(e==null?void 0:e.type)==="create-features"?e.sketchViewModel:this.ownSketchViewModel}get state(){var i,a;if(!((i=this.view)!=null&&i.ready))return"disabled";const e=this.attachmentsViewModel.mode;if(e==="add")return"adding-attachment";if(e==="edit")return"editing-attachment";const{activeWorkflow:t}=this;return t!=null&&t.stepId?t.type==="update"&&((a=t.activeWorkflow)!=null&&a.stepId)?t.activeWorkflow.stepId:t.stepId:"ready"}get syncing(){return this._activityQueue.length>0}get updating(){var e;return this._updatingHandles.updating||((e=this.activeWorkflow)==null?void 0:e.updating)===!0}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}set view(e){this.ownSketchViewModel.view=e,this.spinnerViewModel.view=e,this._set("view",e)}get canZoomTo(){var i,a,o;const e=this.sketchViewModel,t=(a=(i=e==null?void 0:e.createGraphic)==null?void 0:i.geometry)==null?void 0:a.type;return!(!((o=e==null?void 0:e.updateGraphics)!=null&&o.length)&&t!=="multipoint")}get page(){var i,a,o,r;const{activeWorkflow:e,state:t}=this;if((e==null?void 0:e.type)==="update"&&((a=(i=e==null?void 0:e.activeWorkflow)==null?void 0:i.featureFormViewModel)==null?void 0:a.associatedLayer)!=null)return"viewing-associated-features";if((e==null?void 0:e.type)==="update"&&((r=(o=e==null?void 0:e.activeWorkflow)==null?void 0:o.featureFormViewModel)==null?void 0:r.associationId)!=null)return"viewing-associated-layers";if((e==null?void 0:e.type)==="update"&&e.stepId==="awaiting-feature-to-update")return"ready";if((e==null?void 0:e.type)==="create-features"&&e.numPendingFeatures===0){const n=e.data.upload;if(n)return n.state==="default"?"ready":"creating-features-upload-details"}return t??"disabled"}get featureFormDisabled(){var t;const{activeWorkflow:e}=this;return(e==null?void 0:e.type)==="update"&&((t=e.activeEditorItem)==null?void 0:t.capabilities.update.attributes)===!1}get featureFormHasAssociation(){var e;return!!((e=this.featureFormViewModel)!=null&&e.activeAssociation)}get canGoBack(){return this.activeWorkflow!=null&&!this.syncing}get shouldShowDeleteButton(){var t;const{activeWorkflow:e}=this;return!!e&&e.type==="update"&&!!((t=e.activeEditorItem)!=null&&t.capabilities.delete.enabled)}get hasPendingEdits(){var e;return((e=this.activeWorkflow)==null?void 0:e.hasPendingEdits)??!1}get snappingManager(){return this._snappingManager}getTemplatesForLayer(e){return this._templatesByLayer.get(e)??[]}async startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.startCreateFeaturesWorkflow()}async startCreateFeaturesWorkflowAtFeatureCreation(e){return this.startCreateFeaturesWorkflow(e,"creating-features")}async startCreateFeaturesWorkflow(e,t="awaiting-feature-creation-info"){if(await j(()=>!this.updating),!this.canCreate)throw new F("editing:unsupported-workflow","Creating features is unsupported or disabled.");const i=this._createUpdatingResolver();try{await this._cancelWorkflow();const a=this._createCreateFeaturesWorkflow(e,t);this._set("activeWorkflow",a),await a.start()}catch(a){this._logErrorAndCancelWorkflow(a)}finally{i.resolve()}}async startCreateFeaturesWorkflowAtFeatureEdit(e){await j(()=>!this.updating);const t=this._createUpdatingResolver();try{const{initialFeature:i}=e,a=i.sourceLayer=i.layer,o=a?this.findEditorItemForLayer(a):void 0;if(!(o!=null&&o.supportsCreateFeaturesWorkflow))throw new F("editing:unsupported-workflow","Creating features is unsupported or disabled for this layer.");await this._cancelWorkflow();const r=this._createCreateFeaturesWorkflow({initialFeature:i,layer:o.layer,maxFeatures:1},"creating-features");this._set("activeWorkflow",r),await r.start()}catch(i){this._logErrorAndCancelWorkflow(i)}finally{t.resolve()}}async startUpdateWorkflowAtFeatureSelection(){if(await j(()=>!this.updating),!this.canUpdate)return void Pe("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const e=this._createUpdatingResolver();try{await this._cancelWorkflow();const t=this._createUpdateWorkflow();this._set("activeWorkflow",t),await t.start()}catch(t){this._logErrorAndCancelWorkflow(t)}finally{e.resolve()}}async startUpdateWorkflowAtMultipleFeatureSelection(e){if(await j(()=>!this.updating),!this.canUpdate)return void Pe("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const t=this._createUpdatingResolver();try{await this._cancelWorkflow();const i=this._createUpdateWorkflow("awaiting-update-feature-candidate");i.data.candidates=e,this._set("activeWorkflow",i),await i.start()}catch(i){this._logErrorAndCancelWorkflow(i)}finally{t.resolve()}}async startUpdateWorkflowAtFeatureEdit(e){if(await j(()=>!this.updating),!this.canUpdate)return void Pe("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const t=this._createUpdatingResolver();try{await this._cancelWorkflow();const i=this._createUpdateWorkflow("editing-existing-feature");i.data.rootFeature=e,this._set("activeWorkflow",i),await i.start()}catch(i){this._logErrorAndCancelWorkflow(i)}finally{t.resolve()}}async deleteFeatureFromWorkflow(){const{activeWorkflow:e}=this;e&&e.type==="update"?await e.deleteActiveFeature():Pe("editing:unsupported-workflow","Deleting a feature requires an active update workflow.")}async deleteAssociationFromWorkflow(){const{activeWorkflow:e}=this;e&&e.type==="update"?await e.deleteActiveAssociation():Pe("editing:unsupported-workflow","Deleting an association requires an active update workflow.")}async cancelWorkflow(e){return this._cancelWorkflow({warnIfNoWorkflow:!0,...e})}findEditorItemForLayer(e){return this.editorItems.find(t=>t.layer===e)}itemHasInvalidFormTemplate(e){var t;return e!=null&&((t=this.findEditorItemForLayer(e.layer))==null?void 0:t.hasInvalidFormTemplate)===!0}syncFeatureTemplates(){this._featureTemplatesViewModelIsRestricted||this._updateTemplates()}zoomTo(e){var a,o;const t=this.sketchViewModel,i=e?e.geometry:t!=null&&t.updateGraphics.length?t==null?void 0:t.updateGraphics.toArray().map(r=>r.geometry).filter(je):(a=t==null?void 0:t.createGraphic)==null?void 0:a.geometry;i&&((o=this.view)==null||o.goTo(i))}async toggleUpdateWorkflow(){this.canUpdate&&(this.hasPendingEdits&&!await this.showDiscardEditsPrompt()||(this.activeWorkflow&&this.state==="awaiting-feature-to-update"?await this.cancelWorkflow({force:!0}):await this.startUpdateWorkflowAtFeatureSelection()))}restrictFeatureTemplatesViewModelToLayer(e){return this._featureTemplatesViewModelIsRestricted=!0,this._setFeatureTemplatesViewModelLayers([e]),S(()=>{this._featureTemplatesViewModelIsRestricted=!1,this._setFeatureTemplatesViewModelLayers(this.featureTemplatesLayers)})}async _getEditorItemCandidates(e){const{view:t}=this;if(!(t!=null&&t.map))return[];const{map:i}=t,a=i.editableLayers.toArray(),o=i.allTables.toArray().filter(r=>ki(r)||Be(r));return await Promise.allSettled([...a.flatMap(r=>this._getLayerLoadPromise(r)),...o.flatMap(r=>this._getLayerLoadPromise(r))]),De(e),[...a.reverse(),...o.reverse()].filter(r=>ci(r)&&(r.geometryType!=="mesh"||t.type==="3d")).flatMap(r=>r.type==="subtype-group"?r.sublayers.toArray():r)}_getLayerLoadPromise(e){return Be(e)?e.loadAll():e.load()}_drainEditorItems(){this.editorItems.drain(e=>e.destroy())}_updateEditorItems(){oe(this._updateItemsTask);const{view:e}=this,t=at(async i=>{if(!(e!=null&&e.map)||!(e!=null&&e.allLayerViews))return;const a=await this._getEditorItemCandidates(i);if(!a.length)return void this._drainEditorItems();const o=[],r=[],n=[],{layerInfos:d}=this;for(const u of a){const p=On(d,u),h=await st(e,u).catch(()=>null);(p?o:h?r:n).push(new Ln({layer:u,layerInfo:p,layerView:h}))}d!=null&&d.length&&o.sort((u,p)=>d.findIndex(({layer:h})=>h===u.layer)-d.findIndex(({layer:h})=>h===p.layer));const c=[...o,...r,...n];i.aborted||(this._drainEditorItems(),this.editorItems.addMany(c))});this._updatingHandles.addPromise(t.promise),this._updateItemsTask=t}_updateTemplates(){oe(this._updateTemplatesTask);const e=at(async t=>{const i=this._templatesByLayer,a=this._featureTemplatesLayersAndTables.filter(o=>!i.has(o));if(a.length>0){const o=await Co(a.toArray(),this.view,t);for(const{layer:r,templates:n}of o)i.set(r,n)}this._setFeatureTemplatesViewModelLayers(this.featureTemplatesLayers)});this._updatingHandles.addPromise(e.promise),this._updateTemplatesTask=e}_setFeatureTemplatesViewModelLayers(e){const t=this._templatesByLayer,i=[];for(const a of e){const o=t.get(a);o&&o.length>0&&i.push(Ao(a,o))}this.featureTemplatesViewModel.templateInfos=i}_afterEditorItemsChange(){const{activeWorkflow:e}=this;if(this.syncFeatureTemplates(),!e)return;const{stepId:t}=e;e.type!=="create-features"?e.type==="update"&&(t==="awaiting-feature-to-update"&&!this.canUpdateVisible||t==="awaiting-update-feature-candidate"&&!e.hasUpdatableCandidates)&&this._cancelWorkflow():t!=="awaiting-feature-creation-info"||this.canCreate||this._cancelWorkflow()}async _cancelWorkflow(e){const t=this.activeWorkflow;if(!t)return void((e==null?void 0:e.warnIfNoWorkflow)&&Pe("editing:no-active-workflow","There is no active workflow to cancel."));if(!e||e.force!==!1){this.emit("workflow-cancel"),this._set("activeWorkflow",null);try{await t.cancel(e)}finally{t.destroy()}}else try{await t.cancel(e),this._set("activeWorkflow",null),t.destroy()}catch{}}_createCreateFeaturesWorkflow(e,t){return Ka.create({viewModel:this,creationInfo:e,sketchOptions:this.sketchOptions,snappingManager:this._snappingManager,startAt:t,applyEditsCallback:(i,a,o)=>this._applyEdits(i,a,o),applyEditsFeatureServiceCallback:(i,a,o)=>this._applyEditsFeatureService(i,a,o),addAttachmentsCallback:(i,a)=>this._addAttachments(i,a)})}_createUpdateWorkflow(e){return Mn.create({viewModel:this,sketchOptions:this.sketchOptions,snappingManager:this._snappingManager,startAt:e,applyEditsCallback:(t,i,a)=>this._applyEdits(t,i,a),applyEditsFeatureServiceCallback:(t,i,a)=>this._applyEditsFeatureService(t,i,a),addAttachmentsCallback:(t,i)=>this._addAttachments(t,i)})}_addAttachments(e,t){const i=t.map(a=>this._addAttachment(e,a.feature,a.attachment))??[];return Promise.all(i)}async _addAttachment(e,t,i){var o;let a=null;if(!("addAttachment"in e)||((o=e.capabilities)==null?void 0:o.attachment)==null)throw new F("editor:attachments-not-supported","Adding attachments is not supported for this layer type");return await this._queueOperation(async()=>{var r;return a=await((r=e.addAttachment)==null?void 0:r.call(e,t,i).catch(n=>{throw(n==null?void 0:n.error)||n}))??null,a}),a}async _applyEdits(e,t,i){let a=null;const o=e.url?await Wo(e.url):null,r={returnServiceEditsOption:(!o||!Do(o))&&!RegExp("/hosted/","i").test(e.url)?"original-and-current-features":void 0,...i};return await this._queueOperation(async()=>{const{view:n}=this;if(!n)return null;const d=await st(n,e).catch(()=>null);return a=await e.applyEdits(t,r),d&&await j(()=>!d.updating),a}),a}async _applyEditsFeatureService(e,t,i){let a=null;return await this._queueOperation(async()=>a=await e.applyEdits(t,i)),a}_queueOperation(e){this._activityQueue.push(e);const t=(i,a)=>{const o=a.indexOf(i);o>-1&&a.splice(o,1)};return e().then(i=>(Array.isArray(i)?i.forEach(a=>this._handleEditsResultError(a)):this._handleEditsResultError(i),i)).catch(i=>{Pe("editing:operation-error","An error occurred.",{error:i});const a={error:i,retry:()=>(t(a,this.failures),this._queueOperation(e)),cancel:()=>{t(a,this.failures)}};this._set("failures",[...this.failures,a])}).then(()=>{t(e,this._activityQueue)})}_handleEditsResultError(e){if(e!=null&&"error"in e&&e.error!=null)throw e.error;if(e!=null&&"addFeatureResults"in e){const{addFeatureResults:t,deleteFeatureResults:i,updateFeatureResults:a}=e,o=t.find(r=>!!r.error)||a.find(r=>!!r.error)||i.find(r=>!!r.error);if(o)throw o.error}}_createUpdatingResolver(){const e=bt();return this._updatingHandles.addPromise(e.promise),e}_logErrorAndCancelWorkflow(e){const{name:t,message:i,details:a}=e;Pe(t??"editing:workflow-start-failed",i??void 0,a??e),this._cancelWorkflow({force:!0})}_itemIsSuspended(e){const t=this.findEditorItemForLayer(e);return t!=null&&(!t.visible||t.disabled)}};s([l()],I.prototype,"_featureTemplatesLayersAndTables",null),s([l()],I.prototype,"_snappingManager",void 0),s([l({readOnly:!0})],I.prototype,"activeWorkflow",void 0),s([l()],I.prototype,"activeLeafWorkflow",null),s([l({readOnly:!0})],I.prototype,"_activityQueue",void 0),s([l({readOnly:!0})],I.prototype,"canCreate",null),s([l()],I.prototype,"canCreateVisible",null),s([l({readOnly:!0})],I.prototype,"canUpdate",null),s([l()],I.prototype,"canUpdateVisible",null),s([l()],I.prototype,"featureTemplatesLayers",null),s([l()],I.prototype,"editorItems",void 0),s([l({readOnly:!0})],I.prototype,"failures",void 0),s([l()],I.prototype,"hideTemplatesForInactiveLayers",void 0),s([l({type:ha})],I.prototype,"attachmentsViewModel",void 0),s([l()],I.prototype,"featureFormViewModel",null),s([l()],I.prototype,"utilityNetworkAssociationAddAssociationViewModel",null),s([l({type:wa})],I.prototype,"featureTemplatesViewModel",void 0),s([l()],I.prototype,"labelOptions",null),s([l()],I.prototype,"layerInfos",void 0),s([l()],I.prototype,"ownSketchViewModel",void 0),s([l()],I.prototype,"sketchOptions",void 0),s([l()],I.prototype,"sketchViewModel",null),s([l({type:ka,nonNullable:!0})],I.prototype,"snappingOptions",void 0),s([l()],I.prototype,"spinnerViewModel",void 0),s([l()],I.prototype,"state",null),s([l({readOnly:!0})],I.prototype,"syncing",null),s([l()],I.prototype,"updating",null),s([l()],I.prototype,"tooltipOptions",null),s([l()],I.prototype,"valueOptions",null),s([l()],I.prototype,"view",null),s([l()],I.prototype,"canZoomTo",null),s([l()],I.prototype,"pageStack",void 0),s([l()],I.prototype,"showDiscardEditsPrompt",void 0),s([l()],I.prototype,"_candidateCommitted",void 0),s([l()],I.prototype,"page",null),s([l()],I.prototype,"featureFormDisabled",null),s([l()],I.prototype,"featureFormHasAssociation",null),s([l()],I.prototype,"canGoBack",null),s([l()],I.prototype,"shouldShowDeleteButton",null),s([l()],I.prototype,"hasPendingEdits",null),s([l()],I.prototype,"snappingManager",null),I=s([A(eo)],I);const Pn=I;let Z=class extends ne{constructor(t){super(t),this.createFeaturesSection=!0,this.directionModePicker=!1,this.editFeaturesSection=!0,this.flow=!0,this.labelsToggle=!0,this.settingsMenu=!0,this.snappingControls=!0,this.snappingControlsElements=new Ai,this.tooltipsToggle=!0,this.undoRedoButtons=!0,this.sketch=!0,this.zoomToButton=!0}};s([l({type:Boolean,nonNullable:!0})],Z.prototype,"createFeaturesSection",void 0),s([l({type:Boolean,nonNullable:!0})],Z.prototype,"directionModePicker",void 0),s([l({type:Boolean,nonNullable:!0})],Z.prototype,"editFeaturesSection",void 0),s([l({type:Boolean,nonNullable:!0})],Z.prototype,"flow",void 0),s([l({type:Boolean,nonNullable:!0})],Z.prototype,"labelsToggle",void 0),s([l({type:Boolean,nonNullable:!0})],Z.prototype,"settingsMenu",void 0),s([l({type:Boolean,nonNullable:!0})],Z.prototype,"snappingControls",void 0),s([l({type:Ai,nonNullable:!0})],Z.prototype,"snappingControlsElements",void 0),s([l({type:Boolean,nonNullable:!0})],Z.prototype,"tooltipsToggle",void 0),s([l({type:Boolean,nonNullable:!0})],Z.prototype,"undoRedoButtons",void 0),s([l({type:Boolean,nonNullable:!0})],Z.prototype,"sketch",void 0),s([l({type:Boolean,nonNullable:!0})],Z.prototype,"zoomToButton",void 0),Z=s([A("esri.widgets.Editor.VisibleElements")],Z);const to=Z,ut="esri-editor__panel-content",_t={base:ut,message:`${ut}__message`,section:`${ut}__section`,sectionGroup:`${ut}__section__group`,scrimContainer:`${ut}__scrim-container`},Ft=()=>le({scrim:()=>_(()=>import("./index-cLdK6V3t.js"),__vite__mapDeps([293,294,14,2,15,16,4,5,6,7,11,10,12,17,295,296,297,298,299,300]),import.meta.url)});function be(e,...t){return m("div",{class:di(_t.base,e!=null&&e.showScrimOverlay?_t.scrimContainer:void 0),key:(e==null?void 0:e.key)??"panel-content"},...t,e!=null&&e.showScrimOverlay?m("calcite-scrim",null):void 0)}function io(e,...t){return m("div",{class:_t.message,"data-testid":"panel-content-message",key:(e==null?void 0:e.key)??"panel-content-message"},...t)}function Me(e,...t){return m("div",{class:_t.section,key:(e==null?void 0:e.key)??"panel-content-section"},...t)}function Vn(e,...t){return m("div",{class:_t.sectionGroup,key:(e==null?void 0:e.key)??"panel-content-section-group"},...t)}const Wn=()=>Ft();function Nn({helpMessage:e,renderSketchToolbar:t}){return m(rt,null,t(),m(be,{key:"creating-features-panel-content"},m(io,{key:"content-message"},e)))}const xn=()=>Promise.all([Ft(),le({action:()=>_(()=>import("./index-DVEy4f7w.js"),__vite__mapDeps([301,294,14,2,15,16,4,5,6,7,11,10,12,17,295,296,302,300,299,303,298,297,304,305,306]),import.meta.url)})]);function Dn({editorItems:e,filterText:t,id:i,messagesTemplates:a,onFilterTextChange:o,onSelectFeature:r,onZoomTo:n,workflow:d,editorMessages:c}){const u=new Map,p=d.data.candidates;let h=0;p.map(g=>({label:Rn(g),id:g.attributes[g.layer.objectIdField],data:g})).filter(({label:g,data:v})=>{const w=t.toLowerCase(),{title:T}=v.layer,b=e.find(C=>C.layer===v.sourceLayer);return b?b.supportsUpdateWorkflow&&(!w||(g==null?void 0:g.toLowerCase().includes(w))||(T==null?void 0:T.toLowerCase().includes(w))):null}).filter(je).forEach(g=>{var w;h++;const v=g.data.layer;u.has(v)?(w=u.get(v))==null||w.items.push(g):u.set(v,{id:`${v.id}`,label:v.title??"",items:[g]})});const y=e.toArray().map(({layer:g})=>u.get(g)).filter(je),f=h>10||t.length>0;return m(be,{key:"feature-list"},m(Me,null,va({enableListScroll:!1,filterEnabled:f,filterText:t,id:i,items:y,messages:{filterPlaceholder:a.filterPlaceholder,noItems:a.noItems,noMatches:a.noMatches},onFilterChange:g=>o(g),onItemMouseEnter:g=>r(g.data),onItemMouseLeave:()=>r(null),onItemSelect:g=>r(g.data,!0),renderItemActionEnd:g=>Un(g.data,n,c.zoomTo)})))}function Rn(e){const t=e.layer;if(!t)return null;const i=t.fieldsIndex.get(t.objectIdField),a=i.alias||i.name,{attributes:o}=e,r=Ea(t);return r&&o[r]&&`${o[r]}`||`${a}: ${o[i.name]}`}function Un(e,t,i){return m("calcite-action",{appearance:"transparent",icon:"zoom-to-object",onclick:()=>t(e),scale:"s",slot:"actions-end",text:i,title:i})}const Hn={base:"esri-editor__actions"},Li=()=>le({button:()=>_(()=>import("./index-BtF7Kdcs.js"),__vite__mapDeps([307,294,14,2,15,16,4,5,6,7,11,10,12,17,295,296,302,300,299,297,298,308,309,304,310,305,306]),import.meta.url),"split-button":()=>_(()=>import("./index-BIkUAggI.js"),__vite__mapDeps([311,294,14,2,15,16,4,5,6,7,11,10,12,17,295,296,302,300,299,307,297,298,308,309,304,310,305,306,312,313,314,315,316,317]),import.meta.url),"dropdown-group":()=>_(()=>import("./index-BfAp5_ga.js"),__vite__mapDeps([318,14,2,15,16,4,5,6,7,11,10,12,17,299,319]),import.meta.url),"dropdown-item":()=>_(()=>import("./index-DIB7yhJF.js"),__vite__mapDeps([320,302,14,2,15,16,4,5,6,7,11,10,12,17,300,295,299,297,298,305,306,304,319]),import.meta.url)});function it({buttons:e,key:t}){return m("div",{class:Hn.base,key:t??"footer-actions",slot:"footer"},e.filter(je).map((i,a)=>i.type==="split-button"?qn(i,a):Gn(i,a)))}const Gn=({disabled:e,onClick:t,label:i,key:a,...o},r)=>m("calcite-button",{disabled:e??!1,key:a??`action-${r}`,onclick:t,width:"full",...o},i),qn=({disabled:e,onClick:t,key:i,dropdownItems:a,...o},r)=>m("calcite-split-button",{disabled:e??!1,key:i??`split-action-${r}`,width:"full",onCalciteSplitButtonPrimaryClick:t,...o},m("calcite-dropdown-group",{selectionMode:"none"},a.filter(je).map(jn))),jn=({disabled:e,onClick:t,label:i,key:a,...o},r)=>m("calcite-dropdown-item",{disabled:e??!1,key:a??`dropdown-item-${r}`,onCalciteDropdownItemSelect:t,...o},i),Bn={notice:"esri-editor__notice"},ao=()=>le({notice:()=>_(()=>import("./index-nrWOrFCt.js"),__vite__mapDeps([321,302,14,2,15,16,4,5,6,7,11,10,12,17,300,295,299,297,298,305,322,316,306,296]),import.meta.url)});function zn({workflow:e,messages:t}){var o,r;const i=[],a="content-start";if(e!=null&&e.reliesOnOwnerAdminPrivileges){const n=t.ownerAdminNotice;i.push(m(xt,{key:"owner-admin-notice",message:n,slot:a}))}if(e!=null&&e.hasInvalidFormTemplate){const n=t.formFieldUpdateError;i.push(m(xt,{key:"form-field-error",kind:"warning",message:n,slot:a}))}if((e==null?void 0:e.type)==="create-features"&&((r=(o=e.data.upload)==null?void 0:o.result)==null?void 0:r.type)==="georeferenced-reprojected"){const n=t.helpMessages3d.meshReprojected;i.push(m(xt,{key:"mesh-reprojected",kind:"warning",message:n,slot:a}))}return m(rt,null,i)}function xt(e){const t=e.kind??"brand";return m("calcite-notice",{class:Bn.notice,icon:Hr[t],key:e.key,kind:t,open:!0,scale:"s"},e.title?m("div",{slot:"title"},e.title):null,m("div",{slot:"message"},e.message))}const Zn={settingsContainer:"esri-editor__settings"},Qn=()=>le({accordion:()=>_(()=>import("./index-BTWxftj5.js"),__vite__mapDeps([323,14,2,15,16,4,5,6,7,11,10,12,17,299]),import.meta.url),"accordion-item":()=>_(()=>import("./index-1KX2ROWA.js"),__vite__mapDeps([324,302,14,2,15,16,4,5,6,7,11,10,12,17,300,295,299,303,298,297,306,305]),import.meta.url)});function Jn({editorViewModel:e,messagesCommon:t,visibleElements:i}){const{snappingOptions:a,sketchOptions:o,view:r,snappingManager:n}=e,d=[],c={directionModePicker:i.directionModePicker,labelsToggle:i.labelsToggle,tooltipsToggle:i.tooltipsToggle};return Object.values(c).includes(!0)&&d.push(m(xr,{sketchOptions:o,viewType:r==null?void 0:r.type,visibleElements:new Nr(c)})),i.snappingControls&&d.push(m(Dr,{afterCreate:u=>u.layerListOpen=!1,snappingManager:n,snappingOptions:a,view:r,visibleElements:i.snappingControlsElements??new Ai})),d.length===0?null:m("calcite-accordion",{appearance:"transparent",class:Zn.settingsContainer,key:"settings"},m("calcite-accordion-item",{"data-testid":"settings",heading:t.settings,iconStart:"gear"},d))}const Kn={base:"esri-editor__panel-toolbar"},Xn=()=>Qn();function Yn({editorViewModel:e,messagesCommon:t,visibleElements:i}){return m("div",{class:Kn.base,key:"panel-toolbar"},m(Jn,{editorViewModel:e,messagesCommon:t,visibleElements:i}))}let tt=class extends lt{constructor(){super(...arguments),this.workflow=null,this.headingLevel=4,this._iconIntersectionObserver=new IntersectionObserver((t,i)=>{t.forEach(async a=>{var o,r;if(a.isIntersecting){const n=a.target;if(tl(n))return void i.unobserve(n);const d=el(n),{graphic:c}=d,u=c.sourceLayer??((r=(o=this.workflow)==null?void 0:o.data.creationInfo)==null?void 0:r.layer);if(!u||!c)return;ia(n,!0);const p=await Mo(c,u).catch(()=>(ia(n,!1),null));if(p==null)return;n.appendChild(p)}})}),this.messages=null,this._renderActionEnd=({graphic:t})=>{const{workflow:i,messages:a}=this;if(!i)return;const o=t.geometry?m("calcite-action",{appearance:"transparent",icon:"zoom-to-object",onblur:()=>{i.data.temporaryHighlightFeature=null},onclick:()=>i.data.viewModel.zoomTo(t),onfocus:()=>{i.data.temporaryHighlightFeature=t},scale:"s",slot:"actions-end",text:this.messages.zoomTo,title:this.messages.zoomTo}):void 0,r=i.data.isSharedTemplateWorkflow?void 0:m("calcite-action",{appearance:"transparent",icon:"trash",onblur:()=>{i.data.temporaryHighlightFeature=null},onclick:()=>i.cancelFeature(t),onfocus:()=>{i.data.temporaryHighlightFeature=t},scale:"s",slot:"actions-end",text:a.createFeaturesSelectionList.discard,title:a.createFeaturesSelectionList.discard});return m(rt,null,o,r)},this._renderItemContentEnd=({graphic:t})=>{const{workflow:i}=this;return[(i==null?void 0:i.data.isSubmittable(t))?void 0:m("calcite-icon",{class:Ve.pendingFeatureListIcon,icon:"exclamation-mark-triangle",scale:"s",slot:"content-end"})]},this._renderItemIcon=t=>{var i;if(((i=t==null?void 0:t.graphic)==null?void 0:i.geometry)!=null)return m("span",{afterCreate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,afterUpdate:this._afterItemCreateOrUpdate,"data-has-icon":!1,"data-item":t,key:"icon"})},this._afterItemCreateOrUpdate=t=>{var i;(i=this._iconIntersectionObserver)==null||i.observe(t)},this._afterItemRemoved=t=>{var i;(i=this._iconIntersectionObserver)==null||i.unobserve(t)}}loadDependencies(){return le({action:()=>_(()=>import("./index-DVEy4f7w.js"),__vite__mapDeps([301,294,14,2,15,16,4,5,6,7,11,10,12,17,295,296,302,300,299,303,298,297,304,305,306]),import.meta.url),icon:()=>_(()=>import("./index-73bQemcW.js").then(t=>t.i),__vite__mapDeps([302,14,2,15,16,4,5,6,7,11,10,12,17,300,295,299]),import.meta.url),list:()=>_(()=>import("./index-DbjTV4Hc.js"),__vite__mapDeps([325,294,14,2,15,16,4,5,6,7,11,10,12,17,295,296,293,297,298,299,300,303,302,326,327,328,329,308,309,304,315,310,305,330,306,331,332,333,334,314,335]),import.meta.url)})}destroy(){var t;(t=this._iconIntersectionObserver)==null||t.disconnect(),this._iconIntersectionObserver=null}render(){const t=this.workflow;if(!t)return m(rt,null,void 0);const i=this.messages,a=t.pendingFeatures.filter(o=>t.data.isDisplayable(o)).map((o,r)=>{const n=t.data.isSubmittable(o),d=n?i.createFeaturesSelectionList.featureReadyToSubmit:i.createFeaturesSelectionList.featureNotReadyToSubmit;return{disabled:!1,id:`${t.data.getFeatureTitle(o)??r}`,graphic:o,label:d,submittable:n}}).toArray();return m("div",null,m(vt,{level:mt(this.headingLevel)},i.createFeaturesSelectionList.heading),m("calcite-list",{label:i.createFeaturesSelectionList.heading},va({enableListScroll:!1,filterEnabled:!1,filterText:"",id:"update-features-pick-list",items:a,messages:{filterPlaceholder:"",noItems:"",noMatches:""},renderIcon:this._renderItemIcon,renderItemTitle:o=>o.label,renderItemLabel:o=>o.id,onItemMouseEnter:o=>t.data.temporaryHighlightFeature=o.graphic,onItemMouseLeave:()=>t.data.temporaryHighlightFeature=null,onItemSelect:o=>t.updatePendingFeature(o.graphic),renderItemContentEnd:this._renderItemContentEnd,renderItemActionEnd:this._renderActionEnd})))}};function el(e){return e==null?void 0:e["data-item"]}function tl(e){return!!(e!=null&&e["data-has-icon"])}function ia(e,t){e&&(e["data-has-icon"]=t)}s([l()],tt.prototype,"workflow",void 0),s([l()],tt.prototype,"headingLevel",void 0),s([l(),B("esri/widgets/Editor/t9n/Editor")],tt.prototype,"messages",void 0),tt=s([A("esri.widgets.Editor.components.PendingFeatureList")],tt);const aa=tt,il=()=>Promise.all([Li(),ao(),Ft()]);function ai({editorViewModel:e,headingLevel:t,messages:i,messagesCommon:a,onDelete:o,onDeleteAssociation:r,onSave:n,renderAttachments:d,renderFeatureForm:c,renderSketchToolbar:u}){const{activeLeafWorkflow:p,activeWorkflow:h,featureFormViewModel:y,syncing:f}=e;if(!p||!h||!y)return null;const g=p.type.includes("update"),v=g&&!p.hasPendingEdits||f||y.updating,w=g?a.update:a.create,T=(p==null?void 0:p.type)==="create-features"?p.numPendingFeaturesExcludingHidden:0,b=(p==null?void 0:p.type)!=="create-features"||!!p.data.selectedPendingFeature,C=T>1?Ht(i.createFeaturesTemplate,{numFeatures:T}):w,L="shouldShowAttachments"in p&&p.shouldShowAttachments&&!y.activeRelationshipInput,O=y.inputs.every(Ze=>!Ze.visible)&&!L,V=O?m(Me,null,p.type==="create-features"?m(aa,{headingLevel:t,key:"pending-feature-list",workflow:p}):void 0):m(Me,{key:"panel-content-section"},m(zn,{messages:i,workflow:h}),m(Vn,null,b||p.type!=="create-features"?c():m(aa,{headingLevel:t,key:"pending-feature-list",workflow:p}),L?m("div",{key:"attachments"},m(vt,{level:mt(t)},i.attachments),d()):null)),te=()=>{const{featureFormViewModel:Ze}=e;(Ze==null?void 0:Ze.associationId)!=null&&(Ze.associationId=null)},ye={appearance:"solid",onClick:n,disabled:v,label:C,type:"button"},R={appearance:"outline",onClick:o,disabled:f,kind:"danger",label:a.delete,type:"button"},fe={...R,onClick:r,label:i.deleteAssociationTitle,type:"button"},It={...R,primaryLabel:a.delete,primaryText:a.delete,dropdownItems:[{onClick:r,label:i.deleteAssociationTitle}],type:"split-button"},Tt={appearance:"outline",onClick:te,disabled:f,label:a.cancel,type:"button"},ro=e.page==="viewing-associated-features"||e.page==="viewing-associated-layers"?[Tt]:[ye,e.shouldShowDeleteButton&&!e.featureFormHasAssociation?R:void 0,e.shouldShowDeleteButton&&e.featureFormHasAssociation?It:void 0,!e.shouldShowDeleteButton&&e.featureFormHasAssociation?fe:void 0];return m(rt,null,O?u():void 0,m(be,{key:"attribute-panel-content"},V),m(it,{buttons:ro}))}const J="esri-editor__upload-details",re={base:J,status:`${J}__status`,titleWrapper:`${J}__title-wrapper`,title:`${J}__title`,description:`${J}__description`,loader:`${J}__loader`,iconSuccess:`${J}__icon ${J}__icon--success`,iconError:`${J}__icon ${J}__icon--error`,fileList:`${J}__file-list`,file:`${J}__file`,fileIcon:`${J}__file-icon`,fileName:`${J}__file-name`},al=()=>Promise.all([le({icon:()=>_(()=>import("./index-73bQemcW.js").then(e=>e.i),__vite__mapDeps([302,14,2,15,16,4,5,6,7,11,10,12,17,300,295,299]),import.meta.url),loader:()=>_(()=>import("./index-CjrYEQXz.js"),__vite__mapDeps([294,14,2,15,16,4,5,6,7,11,10,12,17,295,296]),import.meta.url)}),Li(),Ft()]);function ol(e){const{messages:t,key:i,upload:a}=e;return m(rt,null,m(be,{key:i??"upload-details"},m(Me,null,rl(e))),a.state==="error"?m(it,{buttons:[{onClick:()=>a.retry(),label:t.modelUploads.error.uploadNew,iconStart:"upload-to",type:"button"}],key:"upload-details-footer-actions"}):null)}function rl(e){const t=sl(e);return t?m("div",{class:re.base,"data-testid":"upload-details",key:"upload-details-content"},m("div",{class:re.status,key:"status"},t.iconContent,m("div",{class:re.titleWrapper,key:"text"},m("div",{class:re.title,key:"title"},t.title),m("div",{class:re.description,key:"description"},t.description))),ll(e.upload)):null}function sl({helpMessage:e,messages:t,upload:i}){switch(i.state){case"pending":{const{title:a,description:o}=t.modelUploads.pending;return{title:a,description:o,iconContent:m("calcite-loader",{"aria-hidden":"true",class:re.loader,label:"",scale:"s",type:"determinate",value:Math.min(Math.round(100*i.progress),i.progress===1?100:99)})}}case"success":{const{title:a}=t.modelUploads.success;return{title:a,description:e||t.helpMessages3d.mesh,iconContent:m("calcite-icon",{class:di(re.iconSuccess),icon:"check",scale:"l"})}}case"error":{const{title:a}=t.modelUploads.error;return{title:a,description:nl(i.error,t),iconContent:m("calcite-icon",{class:di(re.iconError),icon:"exclamation-mark-circle",scale:"l"})}}default:return null}}function nl(e,t){if(!e)return null;const i=t.modelUploads.error.messages;switch(e.constructor){case zr:return i.noModel;case Br:return i.multipleModels;case jr:return i.conversionFailed;case F:switch(e.name){case"glt-loader-error":case"gltf-loader-invalid-glb":return i.loadFailed;case"gltf-loader-unsupported-feature":return i.unsupportedFeature;case"glt-loader-request-error":return i.resourceRequestFailed;default:return i.default}default:return i.default}}function ll(e){return m("div",{class:re.fileList,key:"file-list"},e.files.map(t=>m("div",{class:re.file,key:`file-${t.name}`},m("calcite-icon",{class:re.fileIcon,icon:cl(t),scale:"s"}),m("span",{class:re.fileName},dl(t.name)))))}function dl(e){var t;return((t=e.split("/").pop())==null?void 0:t.split("\\").pop())??""}function cl(e){var i;const t=(i=e.name.split(".").pop())==null?void 0:i.toLowerCase();return(t?pl[t]:null)??ul}const ul="file",oa="file-shape",Lt="file-image",pl={glb:oa,gltf:oa,jpeg:Lt,jpg:Lt,png:Lt,svg:Lt,zip:"file-zip"},oo={date:[],dateOnly:[],id:["is","isNot","startsWith","endsWith","contains","doesNotContain"],number:["is","isNot","startsWith","endsWith","contains","doesNotContain","isBlank","isNotBlank"],timeOnly:[],timestampOffset:[],string:["is","isNot","startsWith","endsWith","contains","doesNotContain","isBlank","isNotBlank","isEmpty","isNotEmpty"]};let P=class extends ne{constructor(e){super(e),this.fieldName=null,this.layer=null,this.operator="is",this.operators=oo,this.value=null}initialize(){this.addHandles(k(()=>this.layer,async e=>{e&&!e.loaded&&await e.load()},H))}get domain(){const{fieldName:e,layer:t}=this;if(e&&t)return t.getFieldDomain(e)}get field(){const{fieldName:e,layer:t}=this;if(e&&t)return t.fieldsIndex.get(e)}get fields(){var e;return(((e=this.layer)==null?void 0:e.fields)??[]).filter(t=>!!(Vi(t)||Wi(t)||Ni(t)||xi(t)))}get fieldLabel(){const{field:e}=this;return e&&(e.alias||e.name)||""}get isObjectIDField(){const{field:e}=this;return!!e&&Ni(e)}get isGlobalIDField(){const{field:e}=this;return!!e&&xi(e)}get isIntegerField(){return dr(this.field)}get isNumericField(){return Wi(this.field)}get isStringField(){return Vi(this.field)}get isTimeOnlyField(){return cr(this.field)}get normalizedFieldName(){var e;return ur((e=this.field)==null?void 0:e.name)}get state(){const{layer:e}=this;return e?e.loaded?"ready":"loading":"disabled"}get valueAsString(){const{value:e}=this;return e==null||e===""?"":`${e}`}get normalizedValue(){const{value:e,isNumericField:t,isObjectIDField:i}=this;return e==null||e===""?"":t||i?`${e}`:`'${e}'`}get whereClause(){const{normalizedFieldName:e,operator:t,normalizedValue:i}=this;return e&&t?t==="isBlank"?`${e} IS NULL`:t==="isNotBlank"?`${e} IS NOT NULL`:t==="isEmpty"?`${e} = ''`:t==="isNotEmpty"?`${e} <> ''`:i===""?null:t==="is"?`${e} = ${i}`:t==="isNot"?`${e} <> ${i}`:t==="startsWith"?`${e} LIKE ${i}%`:t==="endsWith"?`${e} LIKE %${i}`:t==="contains"?`${e} LIKE %${i}%`:t==="doesNotContain"?`${e} NOT LIKE %${i}%`:null:null}};s([l()],P.prototype,"domain",null),s([l()],P.prototype,"field",null),s([l()],P.prototype,"fields",null),s([l()],P.prototype,"fieldLabel",null),s([l()],P.prototype,"fieldName",void 0),s([l()],P.prototype,"isObjectIDField",null),s([l()],P.prototype,"isIntegerField",null),s([l()],P.prototype,"isNumericField",null),s([l()],P.prototype,"isStringField",null),s([l()],P.prototype,"isTimeOnlyField",null),s([l()],P.prototype,"layer",void 0),s([l()],P.prototype,"normalizedFieldName",null),s([l()],P.prototype,"operator",void 0),s([l()],P.prototype,"operators",void 0),s([l()],P.prototype,"state",null),s([l()],P.prototype,"value",void 0),s([l()],P.prototype,"valueAsString",null),s([l()],P.prototype,"normalizedValue",null),s([l()],P.prototype,"whereClause",null),P=s([A("esri.widgets.support.FilterCondition.FilterConditionViewModel")],P);const hl=P,ra={},oi="esri-filter-condition",sa={base:oi,container:`${oi}__container`,valueInputContainer:`${oi}__value-input-container`};let $=class extends lt{constructor(t,i){super(t,i),this.messages=null,this.messagesCommon=null,this.viewModel=new hl,this.visibleElements={...ra}}loadDependencies(){return le({input:()=>_(()=>import("./index-Wn4pOF_U.js"),__vite__mapDeps([328,302,14,2,15,16,4,5,6,7,11,10,12,17,300,295,299,326,327,329,298,303,297,308,309,304,315,310,305,330,306,331,296,332]),import.meta.url),option:()=>_(()=>import("./index-DxcTRSkS.js"),__vite__mapDeps([336,14,2,15,16,4,5,6,7,11,10,12,17,299]),import.meta.url),select:()=>_(()=>import("./index-CQ1gJMW-.js"),__vite__mapDeps([337,302,14,2,15,16,4,5,6,7,11,10,12,17,300,295,299,326,297,298,309,304,310,305,306,331]),import.meta.url)})}get _defaultFieldName(){const{fields:t,fieldName:i}=this;return i||(t!=null&&t.length?t[0].name:void 0)}get _valueInputType(){const{viewModel:t}=this;return t.isNumericField||t.isObjectIDField?"number":"text"}get _visibleOperators(){const{field:t,operators:i,viewModel:a}=this;return t?a.isStringField||a.isGlobalIDField?i.string:a.isNumericField?i.number:a.isObjectIDField?i.id:[]:[]}get _isValueInputHidden(){const{operator:t}=this;return!!t&&["isBlank","isNotBlank","isEmpty","isNotEmpty"].includes(t)}get domain(){return this.viewModel.domain}get field(){return this.viewModel.field}get fields(){return this.viewModel.fields}get fieldLabel(){return this.viewModel.fieldLabel}get fieldName(){return this.viewModel.fieldName}set fieldName(t){this.viewModel.fieldName=t}get layer(){return this.viewModel.layer}set layer(t){this.viewModel.layer=t}get normalizedFieldName(){return this.viewModel.normalizedFieldName}get operator(){return this.viewModel.operator}set operator(t){this.viewModel.operator=t}get operators(){return this.viewModel.operators}set operators(t){this.viewModel.operators=t}get state(){return this.viewModel.state}get value(){return this.viewModel.value}set value(t){this.viewModel.value=t}get valueAsString(){return this.viewModel.valueAsString}castVisibleElements(t){return{...ra,...t}}get whereClause(){return this.viewModel.whereClause}render(){return m("div",{class:sa.base},this._renderFieldSelection(),this._renderOperatorSelection(),this._renderValueInput())}_renderFieldSelection(){const t=this.normalizedFieldName;return m("div",null,m("calcite-select",{afterCreate:()=>{this.fieldName||(this.fieldName=this._defaultFieldName)},bind:this,label:this.messages.chooseField,width:"full",onCalciteSelectChange:({currentTarget:i})=>{this.value=null,this.fieldName=i.value}},this.fields.map(i=>this._renderOption(i.name,i.alias,t))))}_renderOperatorSelection(){const{_visibleOperators:t,messages:i,operator:a}=this;if(t.length)return m("div",null,m("calcite-select",{afterUpdate:o=>{const r=o.value;this._visibleOperators.includes(r)||(this.operator=this._visibleOperators[0])},bind:this,label:i.operator,required:!0,width:"full",onCalciteSelectChange:o=>{this.operator=o.currentTarget.value}},t.map(o=>this._renderOption(o,i.operators[o],a))))}_renderOption(t,i,a){return m("calcite-option",{key:t,label:i??t,selected:t===a,value:t})}_renderValueInput(){const{valueAsString:t,domain:i,messages:a,operator:o}=this;if(!this._isValueInputHidden){if((i==null?void 0:i.type)==="coded-value"&&i.codedValues.length&&(o==="is"||o==="isNot")){const r=i.codedValues[0].code;return m("div",{key:"value-select"},m("calcite-select",{afterCreate:()=>this._afterSelectCreateOrUpdate(r),afterUpdate:()=>this._afterSelectCreateOrUpdate(r),bind:this,label:a.value,required:!0,width:"full",onCalciteSelectChange:({currentTarget:n})=>{this._onValueChange(n.value)}},i.codedValues.map(({code:n,name:d})=>this._renderOption(`${n}`,d,t))))}return m("div",{class:sa.valueInputContainer,key:"value-input"},m("calcite-input",{label:a.value,type:this._valueInputType,value:t,onCalciteInputInput:({currentTarget:r})=>{this._onValueChange(r.value)}}))}}_afterSelectCreateOrUpdate(t){this.value==null&&(this.value=t)}_onValueChange(t){const{viewModel:i}=this;t&&t!==""?i.isStringField||i.isGlobalIDField?this.value=t.toString():(i.isNumericField||i.isObjectIDField)&&(this.value=parseFloat(t)):this.value=null}};s([l()],$.prototype,"_defaultFieldName",null),s([l()],$.prototype,"_valueInputType",null),s([l()],$.prototype,"_visibleOperators",null),s([l()],$.prototype,"_isValueInputHidden",null),s([l()],$.prototype,"domain",null),s([l()],$.prototype,"field",null),s([l()],$.prototype,"fields",null),s([l()],$.prototype,"fieldLabel",null),s([l()],$.prototype,"fieldName",null),s([l()],$.prototype,"layer",null),s([l(),B("esri/widgets/support/FilterCondition/t9n/FilterCondition")],$.prototype,"messages",void 0),s([l(),B("esri/t9n/common")],$.prototype,"messagesCommon",void 0),s([l()],$.prototype,"normalizedFieldName",null),s([l()],$.prototype,"operator",null),s([l()],$.prototype,"operators",null),s([l()],$.prototype,"state",null),s([l()],$.prototype,"value",null),s([l()],$.prototype,"valueAsString",null),s([l()],$.prototype,"viewModel",void 0),s([l()],$.prototype,"visibleElements",void 0),s([ba("visibleElements")],$.prototype,"castVisibleElements",null),s([l()],$.prototype,"whereClause",null),$=s([A("esri.widgets.support.FilterCondition")],$);const ml=$;let he=class extends ne{constructor(t){super(t),this.conditionOperator="AND",this.conditionWidgets=new xe,this.layer=null,this.operators=oo}initialize(){this.addHandles([k(()=>this.layer,async t=>{t&&!t.loaded&&await t.load()},H)])}get count(){return this.conditionWidgets.length}get state(){const{layer:t}=this;return t?t.loaded?"ready":"loading":"disabled"}get whereClause(){const{conditionOperator:t,whereClauses:i}=this;let a="";return i.forEach((o,r)=>{a+=r>0?` ${t} (${o})`:`(${o})`}),a}get whereClauses(){return this.conditionWidgets.toArray().map(t=>t.whereClause).filter(je)}addCondition(t,i){const{layer:a,operators:o}=this;a&&this.conditionWidgets.add(new ml({...t,layer:a,operators:o}),i)}duplicateCondition(t){const i=this.conditionWidgets.at(t);if(!i)return;const{fieldName:a,operator:o,value:r}=i;this.addCondition({fieldName:a,operator:o,value:r})}reset(){this.conditionWidgets.removeAll()}removeCondition(t){t==null?this.conditionWidgets.pop():this.conditionWidgets.splice(t,1)}};s([l()],he.prototype,"conditionOperator",void 0),s([l()],he.prototype,"conditionWidgets",void 0),s([l()],he.prototype,"count",null),s([l()],he.prototype,"layer",void 0),s([l()],he.prototype,"operators",void 0),s([l()],he.prototype,"state",null),s([l()],he.prototype,"whereClause",null),s([l()],he.prototype,"whereClauses",null),he=s([A("esri.widgets.support.FilterBuilder.FilterBuilderViewModel")],he);const yl=he,na={fab:!0,menu:!0},$t="esri-filter-builder",ri={base:$t,container:`${$t}__container`,conditionContainer:`${$t}__condition-container`,operatorSelect:`${$t}__operator-select`};let Q=class extends lt{constructor(t,i){super(t,i),this.messages=null,this.messagesCommon=null,this.viewModel=new yl,this.visibleElements={...na}}loadDependencies(){return le({action:()=>_(()=>import("./index-DVEy4f7w.js"),__vite__mapDeps([301,294,14,2,15,16,4,5,6,7,11,10,12,17,295,296,302,300,299,303,298,297,304,305,306]),import.meta.url),"action-menu":()=>_(()=>import("./index-CCqZjfSZ.js").then(t=>t.i),__vite__mapDeps([338,294,14,2,15,16,4,5,6,7,11,10,12,17,295,296,302,300,299,301,303,298,297,304,305,306,339,313,314,316,308,340,341,342,315,343]),import.meta.url),block:()=>_(()=>import("./index-ujykA9Eq.js"),__vite__mapDeps([344,294,14,2,15,16,4,5,6,7,11,10,12,17,295,296,293,297,298,299,300,302,312,313,314,304,315,305,316,317,301,303,306,320,319,318,345,339,308,340,341,342,338,343]),import.meta.url),fab:()=>_(()=>import("./index-DrimfvRg.js"),__vite__mapDeps([346,294,14,2,15,16,4,5,6,7,11,10,12,17,295,296,302,300,299,307,297,298,308,309,304,310,305,306]),import.meta.url),option:()=>_(()=>import("./index-DxcTRSkS.js"),__vite__mapDeps([336,14,2,15,16,4,5,6,7,11,10,12,17,299]),import.meta.url),select:()=>_(()=>import("./index-CQ1gJMW-.js"),__vite__mapDeps([337,302,14,2,15,16,4,5,6,7,11,10,12,17,300,295,299,326,297,298,309,304,310,305,306,331]),import.meta.url)})}get conditionOperator(){return this.viewModel.conditionOperator}set conditionOperator(t){this.viewModel.conditionOperator=t}get count(){return this.viewModel.count}get layer(){return this.viewModel.layer}set layer(t){this.viewModel.layer=t}get operators(){return this.viewModel.operators}set operators(t){this.viewModel.operators=t}get state(){return this.viewModel.state}castVisibleElements(t){return{...na,...t}}get whereClause(){return this.viewModel.whereClause}get whereClauses(){return this.viewModel.whereClauses}render(){return m("div",{class:ri.base},this._renderOperatorSelect(),this._renderConditions(),this._renderFAB())}reset(){this.viewModel.reset()}_renderOperatorSelect(){if(this.count<2)return;const{conditionOperator:t,messages:i}=this,a=t==="AND";return m("div",{class:ri.operatorSelect},m("calcite-select",{label:i.condition,width:"full",onCalciteSelectChange:({currentTarget:o})=>{this.conditionOperator=o.value}},m("calcite-option",{label:i.allAreTrue,selected:a,value:"AND"}),m("calcite-option",{label:i.anyAreTrue,selected:!a,value:"OR"})))}_renderConditions(){return this.viewModel.conditionWidgets.toArray().map((t,i)=>this._renderConditionContainer(t,i))}_renderConditionContainer(t,i){return m("calcite-block",{class:ri.conditionContainer,heading:this.messages.condition,open:!0},t.render(),this._renderConditionrMenu(i))}_renderFAB(){if(!this.visibleElements.fab)return;const t=this.state==="loading";return m("calcite-fab",{appearance:"outline-fill",disabled:t,icon:"plus",kind:"neutral",loading:t,onclick:()=>this.viewModel.addCondition(),text:this.messages.addNew,textEnabled:!0})}_renderConditionrMenu(t){if(!this.visibleElements.menu)return;const{messages:i}=this;return m("calcite-action-menu",{label:i.moreOptions,overlayPositioning:"fixed",placement:"bottom-end",slot:"control"},m("calcite-action",{onclick:()=>this.viewModel.removeCondition(t),text:i.delete,textEnabled:!0}),m("calcite-action",{onclick:()=>this.viewModel.duplicateCondition(t),text:i.duplicate,textEnabled:!0}))}};s([l()],Q.prototype,"conditionOperator",null),s([l()],Q.prototype,"count",null),s([l()],Q.prototype,"layer",null),s([l(),B("esri/widgets/support/FilterBuilder/t9n/FilterBuilder")],Q.prototype,"messages",void 0),s([l(),B("esri/t9n/common")],Q.prototype,"messagesCommon",void 0),s([l()],Q.prototype,"operators",null),s([l()],Q.prototype,"state",null),s([l()],Q.prototype,"viewModel",void 0),s([l()],Q.prototype,"visibleElements",void 0),s([ba("visibleElements")],Q.prototype,"castVisibleElements",null),s([l()],Q.prototype,"whereClause",null),s([l()],Q.prototype,"whereClauses",null),Q=s([A("esri.widgets.support.FilterBuilder")],Q);const fl=Q,ge="esri-feature-form-utility-network-association-layers",de={base:ge,header:`${ge}__header`,headingContent:`${ge}__heading-content`,featureObserver:`${ge}__feature-observer`,filterContainer:`${ge}__filter-container`,filterOptionsContainer:`${ge}__filter-options-container`,filterOptionsHeader:`${ge}__filter-options-header`,listContainer:`${ge}__list-container`,stickySpinnerContainer:`${ge}__sticky-loading-container`,loadingContainer:`${ge}__loading-container`};let D=class extends lt{constructor(e,t){super(e,t),this.headingLevel=5,this.messagesCommon=null,this.messagesFeature=null,this.messagesFeatureForm=null,this.messagesFilterBuilder=null,this.viewModel=new Si,this._filterBuilder=new fl,this._featureFilterText="",this._layerFilterText="",this._observer=new IntersectionObserver(([i])=>{i!=null&&i.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this._observerNode=null}initialize(){this.addHandles([k(()=>this.viewModel,()=>this.reset()),k(()=>[this.viewModel.state,this._observerNode],()=>this._onObserverChange()),k(()=>this.selectedLayer,e=>{this._filterBuilder.layer=e,e||(this.filterOptionsVisible=!1,this._featureFilterText="")})])}loadDependencies(){return le({action:()=>_(()=>import("./index-DVEy4f7w.js"),__vite__mapDeps([301,294,14,2,15,16,4,5,6,7,11,10,12,17,295,296,302,300,299,303,298,297,304,305,306]),import.meta.url),button:()=>_(()=>import("./index-BtF7Kdcs.js"),__vite__mapDeps([307,294,14,2,15,16,4,5,6,7,11,10,12,17,295,296,302,300,299,297,298,308,309,304,310,305,306]),import.meta.url),icon:()=>_(()=>import("./index-73bQemcW.js").then(e=>e.i),__vite__mapDeps([302,14,2,15,16,4,5,6,7,11,10,12,17,300,295,299]),import.meta.url),input:()=>_(()=>import("./index-Wn4pOF_U.js"),__vite__mapDeps([328,302,14,2,15,16,4,5,6,7,11,10,12,17,300,295,299,326,327,329,298,303,297,308,309,304,315,310,305,330,306,331,296,332]),import.meta.url),list:()=>_(()=>import("./index-DbjTV4Hc.js"),__vite__mapDeps([325,294,14,2,15,16,4,5,6,7,11,10,12,17,295,296,293,297,298,299,300,303,302,326,327,328,329,308,309,304,315,310,305,330,306,331,332,333,334,314,335]),import.meta.url),"list-item":()=>_(()=>import("./index-d5Yy4krW.js"),__vite__mapDeps([347,302,14,2,15,16,4,5,6,7,11,10,12,17,300,295,299,312,297,298,313,314,304,315,305,316,317,294,296,301,303,306,320,319,318,345,335,348]),import.meta.url),loader:()=>_(()=>import("./index-CjrYEQXz.js"),__vite__mapDeps([294,14,2,15,16,4,5,6,7,11,10,12,17,295,296]),import.meta.url)})}get filterOptionsVisible(){return this.viewModel.filterOptionsVisible}set filterOptionsVisible(e){this.viewModel.filterOptionsVisible=e}get selectedLayer(){return this.viewModel.selectedLayer}set selectedLayer(e){this.viewModel.selectedLayer=e}get selectedFeature(){return this.viewModel.selectedFeature}set selectedFeature(e){this.viewModel.selectedFeature=e}get filterWhereClause(){return this.viewModel.filterWhereClause}set filterWhereClause(e){this.viewModel.filterWhereClause=e,e||this._filterBuilder.reset()}get _filteredFeatureItems(){const{_featureFilterText:e}=this;return this.viewModel.featureItems.map(t=>({label:t.label,graphic:t.feature,layer:t.feature.sourceLayer})).filter(t=>{var i;return((i=t.label)==null?void 0:i.toLowerCase().includes(e))??!1})}render(){const{state:e,filterOptionsVisible:t}=this.viewModel;return m("div",{class:this.classes(de.base,Gt.widget)},e==="loading"?this._renderLoading():t?this._renderFilterOptions():this.selectedLayer?this._renderFeatures():this._renderLayers())}applyFilterOptions(){const{selectedLayer:e}=this;this.filterOptionsVisible=!1,e&&(this.filterWhereClause=this._filterBuilder.whereClause)}reset(){this.filterWhereClause=null,this._featureFilterText="",this._layerFilterText="",this.filterOptionsVisible=!1,this._filterBuilder.reset()}async _onObserverChange(){this._observerNode&&this._observer.unobserve(this._observerNode);const{state:e}=this.viewModel;this._observerNode&&e==="ready"&&this._observer.observe(this._observerNode)}_increaseFeaturePage(){const{featureCount:e,featurePage:t,state:i}=this.viewModel;e||t===1?i==="ready"&&this.viewModel.featurePage++:this.viewModel.featurePage=1}_renderStickyLoading(){return this.viewModel.state==="querying"?m("div",{class:de.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoading(){return m("div",{class:de.loadingContainer,key:"loading-container"},this._renderLoadingIcon())}_renderLoadingIcon(){return m("calcite-loader",{inline:!0,label:this.messagesCommon.loading})}_renderFilterOptions(){return m("div",{class:de.filterOptionsContainer},m("div",{class:de.filterOptionsHeader},m("span",null,this.messagesFilterBuilder.widgetLabel),m("calcite-button",{appearance:"transparent",onclick:()=>this._filterBuilder.reset()},this.messagesCommon.clear)),this._filterBuilder.render())}_renderLayers(){const e=this.messagesFeatureForm.associations,t=e.availableLayers,i=e.filterLayers;return m("div",null,this._renderHeader({heading:t,placeholder:i,renderFilterOptions:!1,renderTotal:!1}),m("div",{class:de.listContainer},m("calcite-list",{label:e.associatedFeatures},this._renderLayerItems(),this._renderStickyLoading())))}_renderLayerItems(){const{_layerFilterText:e,viewModel:t,messagesCommon:i}=this,{layerItems:a}=t;return a.map(o=>({label:o.title??i.untitled,layer:o})).filter(o=>{var r;return((r=o.label)==null?void 0:r.toLowerCase().includes(e))??!1}).toArray().map(o=>this._renderLayerItem(o))}_renderLayerItem(e){const{label:t,layer:i}=e;return m("calcite-list-item",{key:`layer-item-${i.id}`,label:Oi(t),onCalciteListItemSelect:()=>{this.selectedLayer=i,this._filterBuilder.reset()}},m("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderFeatures(){const{selectedLayer:e}=this;if(!e)return;const t=this.messagesFeatureForm.associations,i=e.title??this.messagesCommon.untitled,a=t.filterFeatures;return m("div",null,this._renderHeader({heading:i,placeholder:a,renderFilterOptions:!0,renderTotal:!0}),m("div",{class:de.listContainer},m("calcite-list",{label:t.associatedFeatures},this._renderFeatureItems(),this._renderStickyLoading(),this._renderFeatureObserver())))}_renderFeatureItems(){return this._filteredFeatureItems.toArray().map(e=>this._renderFeatureItem(e))}_renderFeatureItem(e){const{label:t,graphic:i}=e;return m("calcite-list-item",{key:`feature-item-${i.uid}`,label:Oi(t),onCalciteListItemSelect:()=>{this.selectedFeature={feature:i,label:t}}},m("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}_onObserverCreate(e){this._observerNode=e}_renderFeatureObserver(){return m("div",{afterCreate:this._onObserverCreate,bind:this,class:de.featureObserver,key:"feature-observer"})}_renderHeader(e){return m("div",{class:de.header,key:"filter"},this._renderHeading(e.heading),this._renderFilter(e.placeholder,e.renderFilterOptions),e.renderTotal?this._renderTotal():null)}_renderHeading(e){return e?m(vt,{key:"title",level:this.headingLevel},m("div",{class:de.headingContent},m("calcite-icon",{icon:"layer"}),e)):null}_renderFilter(e,t){const i=!this.selectedLayer,a=i?this._layerFilterText:this._featureFilterText;return m("div",{class:de.filterContainer,key:"filter"},m("calcite-input",{icon:"search",placeholder:e,type:"search",value:a,onCalciteInputInput:o=>{i?this._layerFilterText=o.currentTarget.value.trim().toLowerCase():this._featureFilterText=o.currentTarget.value.trim().toLowerCase()}},t?this._renderFilterOptionsAction():null))}_renderFilterOptionsAction(){const e=this.messagesFeatureForm.associations.filterOptions;return m("calcite-action",{appearance:"transparent",icon:"sliders",indicator:!!this._filterBuilder.whereClause,onclick:()=>{this.viewModel.filterOptionsVisible=!this.viewModel.filterOptionsVisible},scale:"s",slot:"action",text:e,title:e})}_renderTotal(){const{messagesFeature:e,viewModel:t}=this,i=Ht(e.numberRecords,{number:t.featureCount});return m("div",{key:"total"},i)}};s([l()],D.prototype,"filterOptionsVisible",null),s([l()],D.prototype,"headingLevel",void 0),s([l(),B("esri/t9n/common")],D.prototype,"messagesCommon",void 0),s([l(),B("esri/widgets/Feature/t9n/Feature")],D.prototype,"messagesFeature",void 0),s([l(),B("esri/widgets/FeatureForm/t9n/FeatureForm")],D.prototype,"messagesFeatureForm",void 0),s([l(),B("esri/widgets/support/FilterBuilder/t9n/FilterBuilder")],D.prototype,"messagesFilterBuilder",void 0),s([l()],D.prototype,"selectedLayer",null),s([l({type:Si})],D.prototype,"viewModel",void 0),s([l()],D.prototype,"selectedFeature",null),s([l()],D.prototype,"filterWhereClause",null),s([l()],D.prototype,"_filterBuilder",void 0),s([l()],D.prototype,"_featureFilterText",void 0),s([l()],D.prototype,"_layerFilterText",void 0),s([l()],D.prototype,"_observer",void 0),s([l()],D.prototype,"_filteredFeatureItems",null),s([l()],D.prototype,"_observerNode",void 0),D=s([A("esri.widgets.FeatureForm.FeatureFormUtilityNetworkAssociations.UtilityNetworkAssociationItemList")],D);const gl=D;function la(e,t){return!!(e.layer&&"globalIdField"in e.layer&&e.layer.globalIdField&&t.fromNetworkElement)&&e.attributes[e.layer.globalIdField]===t.fromNetworkElement.globalId}const da="esri-feature-form-utility-network-association-settings",ca={base:da,infoContainer:`${da}__info-container`};let X=class extends lt{constructor(e,t){super(e,t),this.percentAlong=50,this.headingLevel=5,this.messagesFeature=null,this.messagesCommon=null,this.messagesFeatureForm=null,this.readOnly=!1,this.sourceFeature=null,this.targetFeature=null,this.utilityNetwork=null}loadDependencies(){return le({block:()=>_(()=>import("./index-ujykA9Eq.js"),__vite__mapDeps([344,294,14,2,15,16,4,5,6,7,11,10,12,17,295,296,293,297,298,299,300,302,312,313,314,304,315,305,316,317,301,303,306,320,319,318,345,339,308,340,341,342,338,343]),import.meta.url),combobox:()=>_(()=>import("./index-Bb6Bx1n-.js"),__vite__mapDeps([349,302,14,2,15,16,4,5,6,7,11,10,12,17,300,295,299,326,350,297,298,305,304,315,306,296,303,329,351,333,334,314,313,309,310,316,331,352]),import.meta.url),"combobox-item":()=>_(()=>import("./index-GVt5zfuo.js"),__vite__mapDeps([353,302,14,2,15,16,4,5,6,7,11,10,12,17,300,295,299,303,298,304,352,306,354]),import.meta.url),"input-number":()=>_(()=>import("./index-BGRynF8w.js"),__vite__mapDeps([355,302,14,2,15,16,4,5,6,7,11,10,12,17,300,295,299,326,327,329,298,303,297,309,304,315,310,305,330,306,331,332,296]),import.meta.url),label:()=>_(()=>import("./index-D130RxMY.js"),__vite__mapDeps([356,14,2,15,16,4,5,6,7,11,10,12,17,310,300,295]),import.meta.url),switch:()=>_(()=>import("./index-Bej-0mbI.js"),__vite__mapDeps([357,14,2,15,16,4,5,6,7,11,10,12,17,297,298,300,295,309,304,315,310,305]),import.meta.url)})}get association(){return this._get("association")}set association(e){this.percentAlong=e.percentAlong?100*e.percentAlong:50,this._set("association",e)}get associationType(){return this.association.associationType}set associationType(e){this.association.associationType=e,e!=="junction-edge-to-connectivity"&&e!=="junction-edge-from-connectivity"||(this.association.percentAlong=void 0)}render(){return m("div",{class:this.classes(ca.base,Gt.widget)},this._renderFromAssociationEndpoint(),this._renderToAssociationEndpoint(),this._renderAdditionalContent())}_renderFromAssociationEndpoint(){const{associationType:e,association:t,sourceFeature:i,targetFeature:a,messagesFeatureForm:o}=this,r=la(i.feature,t)?i:a,n=r.label,d=Pi(t,"from",o.associations);switch(e){case"connectivity":case"junction-junction-connectivity":case"junction-edge-midspan-connectivity":case"junction-edge-from-connectivity":case"junction-edge-to-connectivity":return this._renderAssociationEndpoint(n,d,this._renderConnectivityContent(r.feature,t.fromNetworkElement))}return this._renderAssociationEndpoint(n,d)}_renderToAssociationEndpoint(){const{associationType:e,association:t,sourceFeature:i,targetFeature:a,messagesFeatureForm:o}=this,r=la(i.feature,t)?a:i,n=r.label,d=Pi(t,"to",o.associations);switch(e){case"connectivity":case"junction-junction-connectivity":return this._renderAssociationEndpoint(n,d,this._renderConnectivityContent(r.feature,t.toNetworkElement));case"containment":return this._renderAssociationEndpoint(n,d,this._renderContainmentContent())}return this._renderAssociationEndpoint(n,d)}_renderAssociationEndpoint(e,t,i){return m("calcite-block",{description:t,heading:e,open:!0},i)}_renderContainmentContent(){const{messagesFeatureForm:e,association:t}=this,i=t.isContentVisible??!1;return m("calcite-label",{layout:"inline"},e.associations.visible,m("calcite-switch",{checked:i,onCalciteSwitchChange:({currentTarget:a})=>{t.isContentVisible=a.checked}}))}_renderConnectivityContent(e,t){const{messagesFeatureForm:i,utilityNetwork:a}=this,o=a.getTerminalConfiguration(e),r=(o==null?void 0:o.terminals.map(n=>this._renderComboboxListItemNumber(n.id,t.terminalId,n.name)))||[];return m("calcite-label",null,i.associations.terminal,m("calcite-combobox",{allowCustomValues:!1,clearDisabled:!0,label:i.associations.terminalComboboxLabel,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:({currentTarget:n})=>{t.terminalId=parseInt(n.value,10)}},...r))}_renderAdditionalContent(){const{associationType:e}=this;switch(e){case"connectivity":case"junction-junction-connectivity":case"attachment":case"containment":return}const t=e==="junction-edge-midspan-connectivity"?e:"junction-edge-from-connectivity",{messagesFeatureForm:i}=this,a=[this._renderComboboxListItemString("junction-edge-midspan-connectivity",t,i.associations.midspanEdge),this._renderComboboxListItemString("junction-edge-from-connectivity",t,i.associations.endpointEdge)];return m("div",{class:ca.infoContainer},m("calcite-label",{key:"additional-content"},i.associations.connectTo,m("calcite-combobox",{allowCustomValues:!1,clearDisabled:!0,label:i.associations.edgeConnectionComboboxLabel,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:({currentTarget:o})=>{this.associationType=o.value}},...a)),t==="junction-edge-midspan-connectivity"?this._renderMidspanEdgeContent():this._renderEndpointEdgeContent())}_renderMidspanEdgeContent(){const{messagesFeatureForm:e,percentAlong:t,association:i}=this;return i.percentAlong=t/100,m("calcite-label",{key:"midspan-edge"},e.associations.midspanLocation,m("calcite-input-number",{max:100,min:0,numberButtonType:"vertical",suffixText:"%",value:`${t}`,onCalciteInputNumberInput:({currentTarget:a})=>{this.percentAlong=parseFloat(a.value)}}))}_renderEndpointEdgeContent(){const{associationType:e,messagesFeatureForm:t}=this,i=e==="junction-edge-to-connectivity";return m("calcite-label",{key:"endpoint-edge"},t.associations.edgeSide,m("calcite-label",{layout:"inline"},t.associations.fromSide,m("calcite-switch",{checked:i,onCalciteSwitchChange:({currentTarget:a})=>{const o=a.checked?"junction-edge-to-connectivity":"junction-edge-from-connectivity";this.associationType=o}}),t.associations.toSide))}_renderComboboxListItemNumber(e,t,i){return m("calcite-combobox-item",{heading:i,key:`#${e}`,selected:t===e,value:`${e}`})}_renderComboboxListItemString(e,t,i){return m("calcite-combobox-item",{heading:i,key:`#${e}`,selected:t===e,value:`${e}`})}};s([l()],X.prototype,"association",null),s([l()],X.prototype,"percentAlong",void 0),s([l()],X.prototype,"associationType",null),s([l()],X.prototype,"headingLevel",void 0),s([l(),B("esri/widgets/Feature/t9n/Feature")],X.prototype,"messagesFeature",void 0),s([l(),B("esri/t9n/common")],X.prototype,"messagesCommon",void 0),s([l(),B("esri/widgets/FeatureForm/t9n/FeatureForm")],X.prototype,"messagesFeatureForm",void 0),s([l()],X.prototype,"readOnly",void 0),s([l()],X.prototype,"sourceFeature",void 0),s([l()],X.prototype,"targetFeature",void 0),s([l()],X.prototype,"utilityNetwork",void 0),X=s([A("esri.widgets.FeatureForm.FeatureFormUtilityNetworkAssociations.UtilityNetworkAssociationSettings")],X);const wl=X,vl=500,_l=1e3;function bl({getLoading:e,setEffectiveLoading:t}){let i,a;function o(){clearTimeout(a),a=void 0}function r(d){i=d?Date.now():void 0,t(d)}function n(d,c){if(d<=0)return r(c);a=setTimeout(()=>{o(),r(c)},d)}return r(e()),se([k(e,d=>{o(),d?n(vl,!0):n(i!=null?_l-(Date.now()-i):0,!1)},Rt),S(o)])}const ua=Symbol("sketch-setup-handles");let E=class extends lt{constructor(e,t){super(e,t),this._featureForm=new Io,this._sketchToolbar=null,this._attachments=new Fo({visibleElements:{addSubmitButton:!1,cancelAddButton:!1,cancelUpdateButton:!1,deleteButton:!1,errorMessage:!1,progressBar:!1,updateButton:!1}}),this._associationItemList=new gl,this._associationSettings=new wl,this._featureTemplates=new Eo({enableListScroll:!1,renderItemContentEnd:i=>i.supportsUpload?m("calcite-icon",{class:Ve.templateItemContentEnd,icon:"upload-to",key:"upload-icon"}):null,renderItemLabel:i=>i.label,renderCustomGroupContent:i=>this._renderCustomTemplateGroupContent(i)}),this._filterText="",this._prompt=null,this._spinner=new $o,this._loading=!1,this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.messagesTemplates=null,this.messagesFeature=null,this.supportingWidgetDefaults=null,this.viewModel=new Pn,this.visibleElements=new to,this._renderAttachments=()=>this._attachments.render(),this._renderFeatureForm=()=>this._featureForm.render(),this._renderAssociationItemList=()=>this._associationItemList.render(),this._renderAssociationSettings=()=>this._associationSettings.render(),this._renderFeatureTemplates=()=>this._featureTemplates.render(),this._renderSketch=()=>{var i;return this._sketchToolbar?m("div",{class:Ve.sketchContainer,key:"editor-sketch-container"},(i=this._sketchToolbar)==null?void 0:i.render()):void 0},this._renderSelectIcon=()=>m("calcite-icon",{icon:"cursor",slot:"content-start"}),this.EditorPanel=({heading:i,key:a,selected:o},...r)=>{const{visibleElements:n}=this;return m("calcite-flow-item",{closable:!1,heading:i,headingLevel:this.headingLevel,key:a,loading:this._loading,selected:o,onCalciteFlowItemBack:this._onBack},n.zoomToButton&&this.viewModel.canZoomTo?m("calcite-action",{alignment:"center",appearance:"transparent",icon:"zoom-to-object",key:"zoom-to-button",onclick:()=>this.viewModel.zoomTo(),slot:"header-actions-end",text:this.messages.zoomTo,title:this.messages.zoomTo}):null,n.settingsMenu?m(Yn,{editorViewModel:this.viewModel,messagesCommon:this.messagesCommon,visibleElements:n}):null,...r)},this._showDiscardEditsPrompt=()=>{var r,n;const{messages:i,activeWorkflow:a}=this,o={title:i.cancelEditTitle,message:i.cancelEditWarningMessage,yesLabel:i.discardEdits,noLabel:i.continueEditing};return(a==null?void 0:a.type)==="create-features"&&Ie(a.data.creationInfo)?this._showPromptAndWait(((r=a.data.upload)==null?void 0:r.state)==="success"?i.modelUploads.cancelPlacementPrompt:i.modelUploads.cancelUploadPrompt):(a==null?void 0:a.type)==="update"&&((n=a.activeFeatureFormViewModel)!=null&&n.activeAssociation)?this._showPromptAndWait({...o,message:i.cancelAssociationEditWarning}):this._showPromptAndWait(o)},this._showGenericCancelPrompt=()=>{const{messages:i,messagesCommon:a}=this;return this._showPromptAndWait({title:i.cancelRequestTitle,message:i.cancelRequestWarningMessage,yesLabel:a.form.yes,noLabel:a.form.no})},this._showPrompt=i=>{var a,o;(o=(a=this._prompt)==null?void 0:a.cancel)==null||o.call(a),this._prompt=i},this._clearPrompt=()=>{this._prompt=null},this._onSave=()=>{this.viewModel.saveWorkflow()},this._onDelete=()=>{const{messages:i,messagesCommon:a}=this;this._showPrompt({title:i.deleteWarningTitle,message:i.deleteWarningMessage,context:"danger",actions:{primary:{label:a.delete,action:()=>{this.deleteFeatureFromWorkflow(),this._clearPrompt()}},secondary:{label:i.keepFeature,action:this._clearPrompt}}})},this._onDeleteAssociation=()=>{const{messages:i,messagesCommon:a}=this;this._showPrompt({title:i.deleteAssociationTitle,message:i.deleteAssociationMessage,context:"danger",actions:{primary:{label:a.delete,action:()=>{this.deleteAssociationFromWorkflow(),this._clearPrompt()}},secondary:{label:i.keepAssociation,action:this._clearPrompt}}})},this._onToggleUpdateWorkflow=()=>this.viewModel.toggleUpdateWorkflow(),this._onBack=i=>(i==null||i.stopPropagation(),this.viewModel.back()),this._onAttachmentAdd=()=>{var a;const{activeWorkflow:i}=this.viewModel;i&&(i.type==="create-features"||i.type==="update"&&((a=i.activeWorkflow)==null?void 0:a.type)==="create-features"?(this._attachments.addFile(),i.back()):this._attachments.addAttachment().then(()=>i.back()))},this._onAttachmentUpdate=()=>{const{activeWorkflow:i}=this.viewModel;i&&(i.type==="create-features"?(this._attachments.updateFile(),i.back()):this._attachments.updateAttachment().then(()=>i.back()))},this._onAttachmentDelete=()=>{const{messages:i,messagesCommon:a}=this;this._showPrompt({title:i.deleteAttachmentWarningTitle,message:i.deleteAttachmentWarningMessage,context:"danger",actions:{primary:{label:a.delete,action:this._onAttachmentDeleteConfirm},secondary:{label:i.keepAttachment,action:this._clearPrompt}}})},this._onAttachmentDeleteConfirm=async()=>{const i=this._attachments,{activeWorkflow:a}=this.viewModel;a&&(a.type==="create-features"?i.deleteFile():(await i.deleteAttachment(i.viewModel.activeAttachmentInfo),this._clearPrompt()),await a.back(),this._clearPrompt())},this._onAttachmentsError=i=>{this._showPrompt({title:this.messages.errorWarningTitle,message:i.message,context:"warning",actions:{primary:{label:this.messagesCommon.form.ok,action:this._clearPrompt}}})}}initialize(){this._featureForm.showPrompt=this._showPrompt,this._featureForm.clearPrompt=this._clearPrompt,this.addHandles([k(()=>mt(this.headingLevel),e=>{this._featureForm.headingLevel=e,this._featureTemplates.headingLevel=e},H),ke(()=>this.viewModel.activeWorkflow,"cancel-request",({controller:e})=>{(this.viewModel.hasPendingEdits?this._showDiscardEditsPrompt():this._showGenericCancelPrompt()).then(t=>t?e.allow():e.deny())}),_e(()=>this.viewModel.featureFormViewModel,e=>{this._featureForm.viewModel=e},H),_e(()=>this.viewModel.utilityNetworkAssociationAddAssociationViewModel,e=>{this._associationItemList.viewModel=e},H),_e(()=>{var e;return(e=this.viewModel.utilityNetworkAssociationAddAssociationViewModel)==null?void 0:e.association},()=>{this._setUpAssociationSettings()}),k(()=>this.viewModel,e=>{this._attachments.viewModel=(e==null?void 0:e.attachmentsViewModel)??null,this._featureTemplates.viewModel=(e==null?void 0:e.featureTemplatesViewModel)??null,this._spinner.viewModel=(e==null?void 0:e.spinnerViewModel)??null,e.showDiscardEditsPrompt=this._showDiscardEditsPrompt},H),k(()=>this.view,(e,t)=>{const i=`editor-${this.id}-spinner`;t==null||t.ui.remove(this._spinner,i),e==null||e.ui.add(this._spinner,{key:i,position:"manual"})},H),k(()=>[this.supportingWidgetDefaults,this.viewModel.sketchViewModel],([e])=>{var t;e&&(this._featureForm.set(e.featureForm),this._attachments.set(e.attachments),this._featureTemplates.set(e.featureTemplates),(t=this.viewModel.sketchViewModel)==null||t.set(e.sketch))},H),_e(()=>{var e;return(e=this._attachments)==null?void 0:e.error},e=>this._onAttachmentsError(e)),_e(()=>{var e;return(e=this.viewModel)==null?void 0:e.failures},e=>{const{messages:t}=this,[{error:i,retry:a,cancel:o}]=e;this._showPrompt({title:t.errorWarningTitle,message:Ht(t.errorWarningMessageTemplate,{errorMessage:i.message}),context:"warning",actions:{primary:{label:t.retry,action:()=>{a(),this._clearPrompt()}},secondary:{label:t.ignore,action:()=>{o(),this._clearPrompt()}}}})}),k(()=>{var e;return(e=this.viewModel)==null?void 0:e.state},e=>{switch(e){case"awaiting-feature-to-update":case"ready":case"disabled":this._filterText="",this._featureTemplates.filterText=""}}),k(()=>this.viewModel.featureFormDisabled,e=>this._featureForm.disabled=e),k(()=>this.visibleElements.sketch,()=>this._setupSketch(),H),bl({getLoading:()=>{const{viewModel:e}=this;return e.syncing||e.updating||this._attachments.submitting},setEffectiveLoading:e=>{this._loading=e}})])}destroy(){this._associationItemList.destroy(),this._associationSettings.destroy(),this._attachments.destroy(),this._featureForm.destroy(),this._featureTemplates.destroy(),this._sketchToolbar=ft(this._sketchToolbar)}loadDependencies(){return Promise.all([le({action:()=>_(()=>import("./index-DVEy4f7w.js"),__vite__mapDeps([301,294,14,2,15,16,4,5,6,7,11,10,12,17,295,296,302,300,299,303,298,297,304,305,306]),import.meta.url),flow:()=>_(()=>import("./index-1VSl9HgO.js"),__vite__mapDeps([358,14,2,15,16,4,5,6,7,11,10,12,17,297,298,299,305,300,295]),import.meta.url),"flow-item":()=>_(()=>import("./index-D1jScw4i.js"),__vite__mapDeps([359,294,14,2,15,16,4,5,6,7,11,10,12,17,295,296,302,300,299,301,303,298,297,304,305,306,339,313,314,316,308,340,341,342,315,338,343,293,360]),import.meta.url),icon:()=>_(()=>import("./index-73bQemcW.js").then(e=>e.i),__vite__mapDeps([302,14,2,15,16,4,5,6,7,11,10,12,17,300,295,299]),import.meta.url),list:()=>_(()=>import("./index-DbjTV4Hc.js"),__vite__mapDeps([325,294,14,2,15,16,4,5,6,7,11,10,12,17,295,296,293,297,298,299,300,303,302,326,327,328,329,308,309,304,315,310,305,330,306,331,332,333,334,314,335]),import.meta.url)}),Wn(),xn(),Li(),ao(),Ft(),Xn(),Gr(),il(),al()])}get _deleteButtonCommonInfo(){return{appearance:"outline",kind:"danger"}}get activeWorkflow(){return this.viewModel.activeWorkflow}get hideTemplatesForInactiveLayers(){return this.viewModel.hideTemplatesForInactiveLayers}set hideTemplatesForInactiveLayers(e){this.viewModel.hideTemplatesForInactiveLayers=e}get icon(){return"pencil"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(e){this.viewModel.labelOptions=e}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(e){this.viewModel.layerInfos=e}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(e){this.viewModel.tooltipOptions=e}get valueOptions(){return this.viewModel.valueOptions}set valueOptions(e){this.viewModel.valueOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.viewModel.startCreateFeaturesWorkflowAtFeatureTypeSelection()}startCreateFeaturesWorkflowAtFeatureCreation(e){return this.viewModel.startCreateFeaturesWorkflowAtFeatureCreation(e)}startCreateFeaturesWorkflowAtFeatureEdit(e){return this.viewModel.startCreateFeaturesWorkflowAtFeatureEdit(e)}startUpdateWorkflowAtFeatureSelection(){return this.viewModel.startUpdateWorkflowAtFeatureSelection()}startUpdateWorkflowAtMultipleFeatureSelection(e){return this.viewModel.startUpdateWorkflowAtMultipleFeatureSelection(e)}startUpdateWorkflowAtFeatureEdit(e){return this.viewModel.startUpdateWorkflowAtFeatureEdit(e)}deleteFeatureFromWorkflow(){return this.viewModel.deleteFeatureFromWorkflow()}deleteAssociationFromWorkflow(){return this.viewModel.deleteAssociationFromWorkflow()}cancelWorkflow(e){return this.viewModel.cancelWorkflow(e)}render(){const{visibleElements:e,viewModel:t}=this,i=this.classes(Ve.base,Gt.widget,Gt.panel);if(!t)return m("div",{class:i,key:"empty"});const{pageStack:a}=t,o=a.length-1,r=a.map((n,d)=>this._renderPage(n,d===o));return m("div",{class:i,key:"base"},e.flow?m("calcite-flow",{key:"flow"},r):r,this._prompt?m(qr,{...this._prompt,headingLevel:this.headingLevel}):void 0)}_renderPage(e,t){const i={selected:t};switch(e){case"disabled":break;case"ready":return this._renderReady(i);case"awaiting-feature-creation-info":return this._renderAwaitingFeatureCreationInfo(i);case"creating-features-upload-details":return this._renderUploadDetails(i);case"creating-features":return this._renderCreatingFeatures(i);case"editing-existing-feature":case"editing-attributes":return this._renderUpdateFeature(i);case"awaiting-update-feature-candidate":return this._renderFeatureList(i);case"adding-attachment":return this._renderAttachmentAdding(i);case"editing-attachment":return this._renderAttachmentEditing(i);case"viewing-associated-layers":case"viewing-associated-features":return this._renderViewAssociatedLayers(i);case"add-association-select-layer":case"add-association-select-feature":return this._renderSelectFeature(i);case"add-association-create-association":return this._renderAddAssociation(i)}return m("div",{key:"empty-page"})}_renderAwaitingFeatureCreationInfo(e){const{EditorPanel:t,messages:i}=this;return m(t,{heading:i.selectTemplate,key:"templates-panel",...e},m(be,{key:"feature-templates"},m(Me,null,this._renderFeatureTemplates())))}_renderUploadDetails(e){const{EditorPanel:t,activeWorkflow:i,messages:a}=this;if((i==null?void 0:i.type)!=="create-features")return null;const o=i.data.upload;return o?m(t,{heading:a.createFeatures,key:"upload-details-panel",...e},m(ol,{helpMessage:this._helpMessage,messages:a,upload:o})):null}_renderCreatingFeatures(e){var c,u;const{EditorPanel:t,activeWorkflow:i,messages:a,messagesCommon:o,headingLevel:r,viewModel:n}=this;if(!i)return null;const d=i.type==="create-features"&&i.numPendingFeatures>0||i.type==="update"&&((c=i==null?void 0:i.activeWorkflow)==null?void 0:c.type)==="create-features"&&((u=i.activeWorkflow)==null?void 0:u.numPendingFeatures)>0;return m(t,{heading:a.createFeatures,key:"create-features-panel",...e},d?m(ai,{editorViewModel:n,headingLevel:r,messages:a,messagesCommon:o,renderAttachments:this._renderAttachments,renderFeatureForm:this._renderFeatureForm,renderSketchToolbar:this._renderSketch,onDelete:this._onDelete,onDeleteAssociation:this._onDeleteAssociation,onSave:this._onSave}):m(Nn,{helpMessage:this._helpMessage,renderSketchToolbar:this._renderSketch}))}_renderUpdateFeature(e){const{EditorPanel:t,messages:i,messagesCommon:a,headingLevel:o,viewModel:r}=this;return m(t,{heading:i.editFeature,key:"update-feature-panel",...e},m(ai,{editorViewModel:r,headingLevel:o,messages:i,messagesCommon:a,renderAttachments:this._renderAttachments,renderFeatureForm:this._renderFeatureForm,renderSketchToolbar:this._renderSketch,onDelete:this._onDelete,onDeleteAssociation:this._onDeleteAssociation,onSave:this._onSave}))}_getAssociationTypeTitle(e){const{messages:t}=this;if(!e)return t.editFeature;if(e.title)return e.title;const{messagesFeature:i}=this;switch(e.type){case"attachment":return i.associationsAttachments;case"connectivity":return i.associationsConnectivity;case"structure":return i.associationsStructure;case"content":return i.associationsContents;case"container":return i.associationsContainer}}_getAddAssociationTypeTitle(e){const{messages:t}=this;if(!e)return t.editFeature;const i=t.associations;switch(e.type){case"attachment":return i.addAttachment;case"connectivity":return i.addConnectivity;case"structure":return i.addStructure;case"content":return i.addContent;case"container":return i.addContainer}}_renderViewAssociatedLayers(e){var c,u;const{EditorPanel:t,messages:i,messagesCommon:a,headingLevel:o,viewModel:r}=this,n=(u=(c=r.featureFormViewModel)==null?void 0:c.activeAssociationInput)==null?void 0:u.activeAssociationType,d=this._getAssociationTypeTitle(n);return m(t,{heading:d,key:"viewing-associated-layers-panel",...e},m(ai,{editorViewModel:r,headingLevel:o,messages:i,messagesCommon:a,renderAttachments:this._renderAttachments,renderFeatureForm:this._renderFeatureForm,renderSketchToolbar:this._renderSketch,onDelete:this._onDelete,onDeleteAssociation:this._onDeleteAssociation,onSave:this._onSave}))}_renderSelectFeature(e){const{_associationItemList:t,EditorPanel:i,viewModel:a,messagesCommon:o}=this,r=a.utilityNetworkAssociationAddAssociationViewModel,n=this._getAddAssociationTypeTitle(r==null?void 0:r.associationType),d=(r==null?void 0:r.state)!=="ready";return m(i,{heading:n,key:"add-association-select-feature",...e},m(be,{key:"select-feature"},m(Me,null,this._renderAssociationItemList())),m(it,{buttons:[t.filterOptionsVisible?{appearance:"solid",label:o.apply,disabled:d,onClick:()=>t.applyFilterOptions(),type:"button"}:void 0,{appearance:"outline",label:o.cancel,disabled:d,onClick:()=>{var c;((c=a.activeWorkflow)==null?void 0:c.type)==="update"&&a.activeWorkflow.cancelActiveWorkflow()},type:"button"}]}))}_setUpAssociationSettings(){var u;const{viewModel:e,_associationSettings:t}=this,i=e.utilityNetworkAssociationAddAssociationViewModel,a=((u=e.activeWorkflow)==null?void 0:u.type)==="update"?e.activeWorkflow:null,o=a?a.activeWorkflow:null,r=(o==null?void 0:o.type)==="add-association"?o.sourceFeatureItem:null,n=i==null?void 0:i.selectedFeature,d=i==null?void 0:i.association,c=i==null?void 0:i.utilityNetwork;r&&n&&d&&c&&(t.sourceFeature=r,t.targetFeature=n,t.association=d,t.utilityNetwork=c)}_renderAddAssociation(e){const{EditorPanel:t,viewModel:i,messagesCommon:a}=this,o=i.utilityNetworkAssociationAddAssociationViewModel,r=this._getAddAssociationTypeTitle(o==null?void 0:o.associationType),n=(o==null?void 0:o.state)!=="ready";return m(t,{heading:r,key:"add-association",...e},m(be,{key:"add-association-content"},m(Me,null,this._renderAssociationSettings())),m(it,{buttons:[{label:a.add,disabled:n||!o.canAddAssociation,onClick:()=>this._onSave(),type:"button"},{appearance:"outline",label:a.cancel,disabled:n,onClick:()=>{var d;((d=i.activeWorkflow)==null?void 0:d.type)==="update"&&i.activeWorkflow.cancelActiveWorkflow()},type:"button"}]}))}_renderCustomTemplateGroupContent(e){const{messages:t,viewModel:i}=this,a=bo(e.group.items,o=>i.itemHasInvalidFormTemplate(o)?t.formFieldCreateError:void 0);return a?m(xt,{kind:"warning",message:a}):null}_renderAttachmentAdding(e){const{EditorPanel:t,_attachments:i,messages:a,messagesCommon:o}=this;return m(t,{heading:a.addAttachment,key:"attachment-adding-panel",...e},m(be,{key:"attachments"},this._renderAttachments()),m(it,{buttons:[{label:i.submitting?o.cancel:o.add,disabled:i.submitting||!i.selectedFile,onClick:this._onAttachmentAdd,type:"button"}]}))}_renderAttachmentEditing(e){const{EditorPanel:t,_attachments:i,activeWorkflow:a,messages:o,messagesCommon:r}=this;return a?m(t,{heading:o.editAttachment,key:"attachment-editing-panel",...e},m(be,{key:"attachments"},this._renderAttachments()),a.shouldAllowAttachmentEditing?m(it,{buttons:[{label:r.update,disabled:i.submitting||!i.selectedFile,onClick:this._onAttachmentUpdate,type:"button"},{...this._deleteButtonCommonInfo,onClick:this._onAttachmentDelete,disabled:i.submitting,label:r.delete,type:"button"}]}):void 0):null}_renderReady(e){const{EditorPanel:t,messages:i,viewModel:a,visibleElements:o}=this,r=this._helpMessage;return m(t,{heading:i.widgetLabel,key:"landing-panel",...e},m(be,{key:"landing-content"},a.editorItems.length?[o.editFeaturesSection?m(Me,{key:"edit-actions"},this._renderUpdateActions()):null,o.createFeaturesSection&&a.canCreateVisible?m(Me,{key:"create-actions"},this._renderCreateActions()):null]:m(io,{key:"no-content"},i.noEditableLayers)),r?m("div",{class:Ve.helpMessage,key:"footer-actions",slot:"footer"},r):void 0)}get _helpMessage(){var o;const{activeWorkflow:e,messages:t,view:i}=this,a=e==null?void 0:e.helpMessage;return a?(o=t[(i==null?void 0:i.type)==="3d"?"helpMessages3d":"helpMessages2d"])==null?void 0:o[a]:void 0}_renderUpdateActions(){var o;const{messages:e,messagesCommon:t,viewModel:i}=this,a={id:"select",label:t.select};return m("div",{class:Ve.updateActions,key:"update-actions"},m(vt,{level:mt(this.headingLevel)},e.editFeatures),m("calcite-list",{class:Ve.updateActionsList,label:e.editFeaturesList,selectionAppearance:"border",selectionMode:"single"},So({disabled:!i.canUpdateVisible,grouped:!1,item:a,selectedItem:((o=i.activeWorkflow)==null?void 0:o.stepId)==="awaiting-feature-to-update"?a:void 0,renderIcon:this._renderSelectIcon,onItemSelect:this._onToggleUpdateWorkflow})))}_renderCreateActions(){return m("div",{key:"create-actions"},m(vt,{level:mt(this.headingLevel)},this.messages.createFeatures),m("div",{class:Ve.featureTemplatesContainer,key:"templates"},this._renderFeatureTemplates()))}_renderFeatureList(e){const{EditorPanel:t,viewModel:i}=this,{activeWorkflow:a}=i;if((a==null?void 0:a.type)!=="update")return null;const o=a.data.candidates,r=Ht(this.messages.multipleFeaturesTemplate,{total:o.length});return m(t,{heading:r,key:"feature-list",...e},m(Dn,{editorItems:i.editorItems,editorMessages:this.messages,filterText:this._filterText,id:this.id,messagesTemplates:this.messagesTemplates,workflow:a,onFilterTextChange:n=>this._filterText=n,onSelectFeature:(n,d)=>i.selectFeature(n,d),onZoomTo:n=>i.zoomTo(n)}))}_showPromptAndWait({title:e,message:t,yesLabel:i,noLabel:a}){const o=bt(),{view:r}=this,n=r==null?void 0:r.focused;return this._showPrompt({title:e,message:t,context:"danger",actions:{primary:{label:i,action:()=>o.resolve(!0)},secondary:{label:a,action:()=>o.resolve(!1)}}}),o.promise.finally(()=>{this._clearPrompt(),n&&(r==null||r.focus())})}async _setupSketch(){if(!this.visibleElements.sketch)return this._sketchImportAbortController=oe(this._sketchImportAbortController),this._sketchToolbar=ft(this._sketchToolbar),void this.removeHandles(ua);if(this._sketchImportAbortController)return;const e=new AbortController;this._sketchImportAbortController=e;const t=await _(()=>import("./Sketch-Dgtm9JMQ.js"),__vite__mapDeps([361,5,6,2,15,16,4,7,10,11,12,121,122,123,124,32,125,3,8,126,47,127,52,40,128,20,35,43,44,129,42,130,14,17,237,18,211,212,26,27,28,29,30,31,33,24,34,36,37,38,39,19,41,164,68,69,171,149,96,97,98,46,152,153,75,13,214,230,216,166,217,218,213,215,66,63,64,67,219,186,53,106,220,50,48,51,221,222,223,224,225,236,238,243,244,92,245,246,247,248,249,250,232,362,363,364,158,81,365,242,235,366,367,368,369,370,371,372,373,374,375,108,49,376,377,378,379,380,381,382,383,233,112,145]),import.meta.url);if(!e.signal.aborted)try{this._sketchToolbar=new t.default({toolbarKind:"docked",contextualToolLocation:"inline-end",scale:"s",visibleElements:new Rr({deleteButton:!1,settingsMenu:!1,directionModePicker:!1,selectionCountLabel:!1,duplicateButton:!1,createTools:new Ur({freehandPolygon:!0,freehandPolyline:!0})})}),this.addHandles([k(()=>{var i;return(i=this.viewModel.activeLeafWorkflow)==null?void 0:i.availableCreateTools},i=>{this._sketchToolbar&&(this._sketchToolbar.availableCreateTools=i)},H),k(()=>this.visibleElements.undoRedoButtons,i=>{this._sketchToolbar&&(this._sketchToolbar.visibleElements.undoRedoMenu=i)},H),_e(()=>{var i;return(i=this.viewModel)==null?void 0:i.sketchViewModel},i=>{this._sketchToolbar&&(this._sketchToolbar.viewModel=i)},H)],ua)}finally{this._sketchImportAbortController=null}}get test(){return{sketch:this._sketchToolbar,showPrompt:this._showPromptAndWait.bind(this)}}};s([l()],E.prototype,"_featureForm",void 0),s([l()],E.prototype,"_sketchToolbar",void 0),s([l()],E.prototype,"_attachments",void 0),s([l()],E.prototype,"_associationItemList",void 0),s([l()],E.prototype,"_associationSettings",void 0),s([l()],E.prototype,"_featureTemplates",void 0),s([l()],E.prototype,"_filterText",void 0),s([l()],E.prototype,"_prompt",void 0),s([l()],E.prototype,"_spinner",void 0),s([l()],E.prototype,"_deleteButtonCommonInfo",null),s([l()],E.prototype,"_loading",void 0),s([l({readOnly:!0})],E.prototype,"activeWorkflow",null),s([l()],E.prototype,"headingLevel",void 0),s([l()],E.prototype,"hideTemplatesForInactiveLayers",null),s([l()],E.prototype,"icon",null),s([l()],E.prototype,"label",null),s([l()],E.prototype,"labelOptions",null),s([l()],E.prototype,"layerInfos",null),s([l(),B("esri/widgets/Editor/t9n/Editor")],E.prototype,"messages",void 0),s([l(),B("esri/t9n/common")],E.prototype,"messagesCommon",void 0),s([l(),B("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],E.prototype,"messagesTemplates",void 0),s([l(),B("esri/widgets/Feature/t9n/Feature")],E.prototype,"messagesFeature",void 0),s([l()],E.prototype,"snappingOptions",null),s([l()],E.prototype,"tooltipOptions",null),s([l()],E.prototype,"supportingWidgetDefaults",void 0),s([l({type:ko,nonNullable:!0})],E.prototype,"valueOptions",null),s([l()],E.prototype,"view",null),s([l(),Zr(["sketch-create","sketch-delete","sketch-update","workflow-cancel","workflow-commit"])],E.prototype,"viewModel",void 0),s([l({type:to,nonNullable:!0})],E.prototype,"visibleElements",void 0),s([l()],E.prototype,"_helpMessage",null),E=s([A("esri.widgets.Editor")],E);const kl=E;/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
v4.32.12 */const Fl=so`@layer{arcgis-editor{display:block}}`,Il=Qr(kl),yt=class yt extends no{constructor(){super(...arguments),this.widget=Il(this),this.viewModel=this.widget.viewModel,this.activeWorkflow=this.widget.activeWorkflow,this.autoDestroyDisabled=!1,this.headingLevel=this.widget.headingLevel,this.hideCreateFeaturesSection=this.widget.visibleElements.createFeaturesSection,this.hideEditFeaturesSection=this.widget.visibleElements.editFeaturesSection,this.hideLabelsToggle=this.widget.visibleElements.labelsToggle,this.hideSnappingControlsElementsEnabledToggle=this.widget.visibleElements.snappingControlsElements.enabledToggle,this.hideSnappingControlsElementsFeatureEnabledToggle=this.widget.visibleElements.snappingControlsElements.featureEnabledToggle,this.hideSnappingControlsElementsLayerList=this.widget.visibleElements.snappingControlsElements.layerList,this.hideSnappingControlsElementsSelfEnabledToggle=this.widget.visibleElements.snappingControlsElements.selfEnabledToggle,this.hideTooltipsToggle=this.widget.visibleElements.tooltipsToggle,this.icon=this.widget.icon,this.label=this.widget.label,this.labelOptions=this.widget.labelOptions,this.layerInfos=this.widget.layerInfos,this.position="bottom-left",this.showSnappingControlsElementsHeader=this.widget.visibleElements.snappingControlsElements.header,this.snappingOptions=this.widget.snappingOptions,this.state=this.viewModel.state,this.supportingWidgetDefaults=this.widget.supportingWidgetDefaults,this.tooltipOptions=this.widget.tooltipOptions,this.arcgisPropertyChange=lo()("activeWorkflow","state"),this.arcgisReady=co()}async cancelWorkflow(){var t;await((t=this.widget)==null?void 0:t.cancelWorkflow())}async deleteFeatureFromWorkflow(){var t;await((t=this.widget)==null?void 0:t.deleteFeatureFromWorkflow())}async destroy(){await this.manager.destroy()}async startCreateFeaturesWorkflowAtFeatureCreation(t){var i;await((i=this.widget)==null?void 0:i.startCreateFeaturesWorkflowAtFeatureCreation(t))}async startCreateFeaturesWorkflowAtFeatureTypeSelection(){var t;await((t=this.widget)==null?void 0:t.startCreateFeaturesWorkflowAtFeatureTypeSelection())}async startUpdateWorkflowAtFeatureEdit(t){var i;await((i=this.widget)==null?void 0:i.startUpdateWorkflowAtFeatureEdit(t))}async startUpdateWorkflowAtFeatureSelection(){var t;await((t=this.widget)==null?void 0:t.startUpdateWorkflowAtFeatureSelection())}async startUpdateWorkflowAtMultipleFeatureSelection(t){var i;await((i=this.widget)==null?void 0:i.startUpdateWorkflowAtMultipleFeatureSelection(t))}};yt.properties={activeWorkflow:0,autoDestroyDisabled:5,headingLevel:9,hideCreateFeaturesSection:5,hideEditFeaturesSection:5,hideLabelsToggle:5,hideSnappingControlsElementsEnabledToggle:5,hideSnappingControlsElementsFeatureEnabledToggle:5,hideSnappingControlsElementsLayerList:5,hideSnappingControlsElementsSelfEnabledToggle:5,hideTooltipsToggle:5,icon:1,label:1,labelOptions:0,layerInfos:0,position:1,referenceElement:1,showSnappingControlsElementsHeader:5,snappingOptions:0,state:3,supportingWidgetDefaults:0,tooltipOptions:0},yt.shadowRootOptions=uo,yt.styles=Fl;let jt=yt;po("arcgis-editor",jt);const Tc=Object.freeze(Object.defineProperty({__proto__:null,ArcgisEditor:jt},Symbol.toStringTag,{value:"Module"}));export{Tc as c,jd as i,Kr as l,Gd as n,Jr as o,Pa as p,qd as r};
