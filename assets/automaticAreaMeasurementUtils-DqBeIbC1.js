import{c as C}from"./reactiveUtils-BFQ0BtrB.js";import{E as W,k as Q,y as s,b}from"./subclass-BR3PhgZG.js";import{D as tt,t as et,U as it,g as nt,n as X,a2 as P,y as Y,H as I}from"./mathUtils-ClvKsMak.js";import{o as V,i as v,f as at,h as H,s as $,a as G,U as L,d as ot,l as lt}from"./quantityUtils-Cz8e0KG8.js";import{x as st,af as A,h as rt,am as ut}from"./Point-TlcsOcXV.js";import{_ as ct,w as z}from"./coordinateFormatter-C-9IjIvQ.js";import{N as pt}from"./MeshTransform-CtzYVl06.js";import{a as N}from"./meshVertexSpaceUtils-BfF6O78E.js";import{f as ft}from"./keybindings-DYR2fa8r.js";import{G as mt,M as ht,B as m,H as dt,L as gt,J as vt,A as yt,K as B}from"./Tooltip-nX_yRTht.js";import{U as kt,A as T,J as j,K as E,B as g}from"./SnappingManager-DFm0py-D.js";import{e as l}from"./Evented-CXIxDjmW.js";import{S as xt}from"./Accessor-D6mNnsWy.js";import{n as bt}from"./uuid-fwrPAdZb.js";import{U as $t}from"./quantityFormatUtils-Del4ZVDh.js";import{r as It}from"./geodesicLengthMeasurementUtils-YCCCQWpE.js";import{U as Z,j as At}from"./euclideanAreaMeasurementUtils-xuftUuQL.js";import{o as wt}from"./geodesicAreaMeasurementUtils-CSr4mjZE.js";function ne(e,i){const t=N(i.vertexSpace),{scale:n,orientation:a}=e,{transform:u}=i,r=Lt(u);t&&r!=null?(a.actual=V(r,"degrees","arithmetic"),a.visible=!0):(a.actual=null,a.visible=!1),t?(n.actual=v(K(u)),n.visible=!0):(n.actual=null,n.visible=!1)}function ae(e,i,t){var M,_,F,R,S,D,O;if(!i||!N(i.vertexSpace))return;const n=i.transform??(i.transform=new pt),{rotationAngle:a,rotationAxis:u}=n,r=kt(e.orientation.actual),c=J(u);if(r!=null&&c!=null&&r!==a){(M=t==null?void 0:t.onRotateStart)==null||M.call(t,a);const f=r*c;n.rotationAngle=f,(_=t==null?void 0:t.onRotate)==null||_.call(t,f),(F=t==null?void 0:t.onRotateStop)==null||F.call(t,f)}const h=(R=e.scale.actual)==null?void 0:R.value,d=K(n);if(h!=null&&h!==d){const{scale:f}=n;let p;if((S=t==null?void 0:t.onScaleStart)==null||S.call(t,f[0],f[1],f[2]),d===0)p=et(it);else{const q=h/d;p=nt(X(),f,q)}n.scale=p,(D=t==null?void 0:t.onScale)==null||D.call(t,p[0],p[1],p[2]),(O=t==null?void 0:t.onScaleStop)==null||O.call(t,p[0],p[1],p[2])}}function oe(e,i){const{x:t,y:n,z:a}=i,{x:u,y:r,z:c}=Vt(e,i.spatialReference);return{dx:u==null||I(u,t)?0:u-t,dy:r==null||I(r,n)?0:r-n,dz:c==null||a==null||I(c,a)?0:c-a}}function Vt(e,i){var u,r,c;let t,n,a;if(e.geographic){t=T(e.longitude.actual),n=T(e.latitude.actual),st(i)&&(t!=null&&n!=null?[t,n]=A(t,n,w):t!=null?t=A(t,0,w)[0]:n!=null&&(n=A(0,n,w)[1]));const h=e.elevation.actual,d=rt(i);a=d!=null&&h!=null?at(h,d):void 0}else t=(u=e.x.actual)==null?void 0:u.value,n=(r=e.y.actual)==null?void 0:r.value,a=(c=e.elevation.actual)==null?void 0:c.value;return{x:t,y:n,z:a}}const w=[0,0];function Lt(e){if(!e)return 0;const i=J(e.rotationAxis);return i!=null?i*e.rotationAngle:null}function J(e){return P(e,Y)?1:P(e,Ut)?-1:null}const Ut=tt(X(),Y);function K(e){return e?Math.max(...e.scale):1}function le(e,i){return!(e.type!=="key-down"||e.key!==ft.enterInputMode||!i||!Mt(i.info))&&(i.enterInputMode(),e.stopPropagation(),!0)}function Mt(e){const i=e==null?void 0:e.sketchOptions;if(!i)return!1;const{inputEnabled:t,visibleElements:n}=i.tooltips;return t&&e.editableFields.some(({name:a})=>a==="x"||a==="y"?n.coordinates:n[a])===!0}function se(e){let i=null;return W([e.on("paste",async t=>{i==null||i.abort(),i=C(async()=>{ct()||await z(),_t(t,e.info)})}),C(()=>z()),Q(()=>i==null?void 0:i.abort())])}function _t(e,i){var n;if(!i||!("geographic"in i))return;const t=(n=e.clipboardData)==null?void 0:n.getData("text");if(t)if(i.geographic){const a=mt(t);a&&(i.longitude.applyValue(a.longitude),i.latitude.applyValue(a.latitude),e.stopPropagation(),e.preventDefault())}else{const a=ht(t);a&&(i.x.applyValue(a.x),i.y.applyValue(a.y),e.stopPropagation(),e.preventDefault())}}let o=class extends xt{constructor(e){super(e),this.actual=null,this.lockable=!0,this.id=bt(),this.inputValue=null,this.readOnly=!1,this.suffix=null,this.visible=!0,this.invalid=!1,this.unlockOnVertexPlacement=!0}get committed(){return this.lockable?this._get("committed"):null}set committed(e){this.lockable&&this._set("committed",e)}get dirty(){return this.inputValue!=null}get locked(){return this.lockable&&this.committed!=null}onInput(e){this.inputValue=e}onCommit(e,i,t){this.lockable?this._onCommitLockable(e,t):this._onCommitNonLockable(t),this.invalid&&e==="commit-and-exit"||t.onCommit(i,e)}_onCommitLockable(e,i){const{inputValue:t,locked:n}=this;n&&y(t)?this.unlock():(e==="commit-and-exit"&&!n||t!=null)&&this._parseInputAndLock(i)}_onCommitNonLockable(e){const{inputValue:i}=this;y(i)?this.setActual(null):i!=null&&this._parseInputAndSetActual(e)}applyValue(e){this.lockable?this.lock(e):this.setActual(e)}clearInputValue(){this.inputValue=null,this.invalid=!1}setActual(e){this.actual=e,this.clearInputValue()}lock(e){this.lockable&&(this.committed=e??this.actual,this.clearInputValue())}unlock(){this.lockable&&(this.committed=null,this.clearInputValue())}toggleLock(e){this.lockable&&(this.locked?this.unlock():this._parseInputAndLock(e))}getSuffix(e){const{suffix:i}=this;return typeof i=="function"?i(e):i}getFormattedValue(e){const{actual:i,committed:t,format:n}=this;return t!=null?n(t,e):i!=null?n(i,e):null}getRawDisplayValue(e){const{actual:i,committed:t,inputValue:n}=this;return n??(this.lockable&&t!=null?this.formatForInputMode(t,e):i!=null?this.formatForInputMode(i,e):null)}_parseInputAndSetActual(e){const{inputValue:i}=this;if(i==null||y(i))return this.setActual(null);const t=this.parse(i,e);t!=null?this.setActual(t):this.invalid=!0}_parseInputAndLock(e){const{inputValue:i,actual:t}=this;if(y(i))return this.unlock();if(i==null)return this.lock(t);const n=this.parse(i,e);n!=null?this.lock(n):this.invalid=!0}};function y(e){return e!=null&&e.trim()===""}l([s()],o.prototype,"actual",void 0),l([s()],o.prototype,"committed",null),l([s()],o.prototype,"dirty",null),l([s()],o.prototype,"format",void 0),l([s()],o.prototype,"formatForInputMode",void 0),l([s()],o.prototype,"lockable",void 0),l([s()],o.prototype,"locked",null),l([s()],o.prototype,"id",void 0),l([s()],o.prototype,"inputValue",void 0),l([s()],o.prototype,"name",void 0),l([s()],o.prototype,"parse",void 0),l([s()],o.prototype,"readOnly",void 0),l([s()],o.prototype,"suffix",void 0),l([s()],o.prototype,"title",void 0),l([s()],o.prototype,"visible",void 0),l([s()],o.prototype,"invalid",void 0),l([s()],o.prototype,"unlockOnVertexPlacement",void 0),o=l([b("esri.views.interactive.tooltip.fields.TooltipField")],o);let k=class extends o{constructor(e){super(e),this.showAsZ=!1}normalizeCtorArgs(e){const i=t=>t.inputUnitInfos.verticalLength.unit;return{name:"elevation",actual:H,parse:m((t,n)=>G(t,i(n))),format:(t,n)=>n.formatters.verticalLength(t),formatForInputMode:(t,n)=>n.formatters.scalar($(t,i(n))),suffix:t=>t.inputUnitInfos.verticalLength.abbreviation,title:t=>t.messages.sketch[this.showAsZ?"z":"elevation"],unlockOnVertexPlacement:!1,...e}}};l([s()],k.prototype,"showAsZ",void 0),k=l([b("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],k);let x=class extends o{constructor(e){super(e),this.precision=1}normalizeCtorArgs(e){const i=t=>t.inputUnitInfos.orientation.unit;return{name:"orientation",actual:null,parse:m((t,n)=>V(t,i(n),"geographic")),format:t=>{const n=j(t);return $t(n,"geographic",this.precision)},formatForInputMode:(t,n)=>{const a=j(t);return n.formatters.scalar(a)},suffix:t=>t.inputUnitInfos.orientation.abbreviation,title:t=>t.messages.sketch.orientation,...e}}};l([s()],x.prototype,"precision",void 0),x=l([b("esri.views.interactive.tooltip.fields.TooltipFieldOrientation")],x);function re(e){const i=n=>n.inputUnitInfos.direction.unit,t=n=>n.sketchOptions.values.effectiveDirectionMode;return new o({name:"direction",actual:L,parse:m((n,a)=>V(n,i(a),"geographic")),format:(n,a)=>{const u=t(a),r=E(n,u);switch(u){case g.Absolute:return a.formatters.direction(r);case g.Relative:return a.formatters.directionRelative(r);case g.RelativeBilateral:return a.formatters.directionRelativeBilateral(r)}},formatForInputMode:(n,a)=>{const u=E(n,t(a));return a.formatters.scalar($(u,i(a)))},suffix:n=>n.inputUnitInfos.direction.abbreviation,title:n=>{const a=t(n),{absolute:u,relative:r}=n.messages.sketch.direction;switch(a){case g.Absolute:return u;case g.Relative:case g.RelativeBilateral:return r}},...e})}function Ft(e){const i=t=>t.inputUnitInfos.length.unit;return new o({name:"distance",actual:H,parse:m((t,n)=>G(Math.max(t,0),i(n))),format:(t,n)=>n.formatters.length(t),formatForInputMode:(t,n)=>n.formatters.scalar($(t,i(n))),suffix:t=>t.inputUnitInfos.length.abbreviation,title:t=>t.messages.sketch.distance,...e})}function ue(){return Ft({format:(e,i)=>i.formatters.totalLength(e),title:e=>e.messages.sketch.totalLength,readOnly:!0})}function Rt(e){return new k(e)}function ce(e){return new x(e)}function pe(e){return U("scale",{name:"scale",actual:null,parse:m(i=>v(Math.abs(i))),...e})}function fe(e){const i=t=>t.inputUnitInfos.area.unit;return new o({name:"area",actual:ot,parse:m((t,n)=>lt(t,i(n))),format:(t,n)=>n.formatters.area(t),formatForInputMode:(t,n)=>n.formatters.scalar($(t,i(n))),suffix:t=>t.inputUnitInfos.area.abbreviation,title:t=>t.messages.sketch.area,readOnly:!0,...e})}function St(e){return new o({name:"x",actual:L,parse:dt,format:(i,t)=>t.formatters.longitudeDecimalDegrees(i),formatForInputMode:i=>gt(i),suffix:i=>i.inputUnitInfos.longitudeLatitude.abbreviation,title:i=>i.messages.sketch.longitude,...e})}function Dt(e){return new o({name:"y",actual:L,parse:vt,format:(i,t)=>t.formatters.latitudeDecimalDegrees(i),formatForInputMode:i=>yt(i),suffix:i=>i.inputUnitInfos.longitudeLatitude.abbreviation,title:i=>i.messages.sketch.latitude,...e})}function Ot(e){return U("x",{name:"x",...e})}function Ct(e){return U("y",{name:"y",...e})}function U(e,i){return new o({actual:v(0),parse:m(t=>v(t)),format:(t,n)=>n.formatters.scalar(t),formatForInputMode:(t,n)=>n.formatters.scalar(t),title:t=>t.messages.sketch[e],...i})}const me=e=>{let i=class extends e{constructor(){super(...arguments),this.longitude=St(),this.latitude=Dt(),this.x=Ot(),this.y=Ct(),this.elevation=Rt(),this.geographic=!1}get effectiveX(){return this.geographic?this.longitude:this.x}get effectiveY(){return this.geographic?this.latitude:this.y}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic}}setLocationFromPoint(t,n=t==null?void 0:t.spatialReference){if(this.geographic=!!n&&It(n),t==null)return this._setActualLonLat(null,null),void this._setActualXY(null,null);if(this.geographic){const a=ut(t,Pt);this._setActualLonLat(B(a==null?void 0:a[0]),B(a==null?void 0:a[1]))}else this._setActualXY(v(t.x),v(t.y))}_setActualLonLat(t,n){this.longitude.actual=t,this.latitude.actual=n}_setActualXY(t,n){this.x.actual=t,this.y.actual=n}};return l([s()],i.prototype,"geographic",void 0),l([s()],i.prototype,"effectiveX",null),l([s()],i.prototype,"effectiveY",null),l([s()],i.prototype,"key",null),i=l([b("esri.views.interactive.tooltip.infos.TooltipInfoWithCoordinates")],i),i},Pt=[0,0];function zt(e,i,t=Z()){{const n=wt(e);return n??At(e,t)}}function he(e,i=Z()){return zt(e,"on-the-ground",i)}export{_t as B,pe as F,le as G,Ft as I,fe as M,ne as R,se as T,ue as U,oe as V,re as b,me as h,ae as k,he as u,ce as x};
