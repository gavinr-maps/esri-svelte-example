import{c as U,u as Z,g as J}from"./LineSeries-mg8Ni5g7.js";import{b as ht,x as gt,f as dt,n as mt,l as ct}from"./LineSeries-mg8Ni5g7.js";import{f as j,P as b,_ as A,p as $,a2 as K,n as z,F as q,a1 as B,u as R,q as E}from"./Theme-j0p7GXwZ.js";import{au as W}from"./Accessor-BHnuXKD2.js";import{n as H}from"./Button-CiizicDX.js";import"./ColorSet-BTHKRo6w.js";import"./DefaultTheme-CDLLrEdR.js";import"./Tick-8IC22wWy.js";class k extends U{constructor(){super(...arguments),Object.defineProperty(this,"_ph",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_pw",{enumerable:!0,configurable:!0,writable:!0,value:0})}_makeGraphics(t,e){return this.makeColumn(e,t)}_makeFieldNames(){super._makeFieldNames();const t=this.get("xAxis"),e=this.get("yAxis"),i="CategoryAxis",s="ValueAxis";t.isType(i)&&(this.get("openCategoryXField")||(this._xOpenField=this._xField)),t.isType(s)&&(this.get("openValueXField")||(this._xOpenField=this._xField)),e.isType(i)&&(this.get("openCategoryYField")||(this._yOpenField=this._yField)),e.isType(s)&&(this.get("openValueYField")||(this._yOpenField=this._yField))}_prepareChildren(){super._prepareChildren();const t=this.get("xAxis"),e=this.get("yAxis"),i=this.dataItems.length,s=Math.max(0,this.startIndex()-2),a=Math.min(this.endIndex()+2,i-1);if(t.inited&&e.inited)for(let o=s;o<=a;o++){let n=this.dataItems[o];this._createGraphics(n)}}_updateChildren(){const t=this.chart;t&&(this._ph=t.plotContainer.height(),this._pw=t.plotContainer.width());const e=this.get("xAxis"),i=this.get("yAxis"),s=this.get("baseAxis"),a=this.columns.template;this.isDirty("fill")&&a.get("fill")==null&&a.set("fill",this.get("fill")),this.isDirty("fillPattern")&&a.get("fillPattern")==null&&a.set("fillPattern",this.get("fillPattern")),this.isDirty("stroke")&&a.get("stroke")==null&&a.set("stroke",this.get("stroke"));let o=0,n=0,l=0;b(s.series,m=>{if(m instanceof k){const x=m.get("stacked");x&&l==0&&n++,!x&&m.get("clustered")&&n++}m===this&&(o=n-1),l++}),this.get("clustered")||(o=0,n=1),n===0&&(n=1,o=0);const g=e.get("renderer"),p=i.get("renderer"),r="cellStartLocation",h="cellEndLocation",c=g.get(r,0),f=g.get(h,1),u=p.get(r,0),d=p.get(h,1);if(this._aLocationX0=c+o/n*(f-c),this._aLocationX1=c+(o+1)/n*(f-c),this._aLocationY0=u+o/n*(d-u),this._aLocationY1=u+(o+1)/n*(d-u),e.inited&&i.inited){if(this._axesDirty||this._valuesDirty||this._stackDirty||this.isDirty("vcx")||this.isDirty("vcy")||this._sizeDirty){const m=this.dataItems.length;let x=Math.max(0,this.startIndex()-2),M=Math.min(this.endIndex()+2,m-1);for(let _=0;_<x;_++)this._toggleColumn(this.dataItems[_],!1);let F=this.dataItems[x];for(let _=x;_<=M;_++){let T=this.dataItems[_];if(T.get("valueX")!=null&&T.get("valueY")!=null){if(F=T,_>0&&x>0)for(let X=_-1;X>=0;X--){let y=this.dataItems[X];if(y.get("valueX")!=null&&y.get("valueY")!=null){F=y;break}}break}this._toggleColumn(T,!1)}for(let _=x;_<=M;_++){let T=this.dataItems[_];this._updateGraphics(T,F),T.get("valueX")!=null&&T.get("valueY")!=null&&(F=T)}for(let _=M+1;_<m;_++)this._toggleColumn(this.dataItems[_],!1)}}else this._skipped=!0;this.updateLegendMarker(this.get("tooltipDataItem")),super._updateChildren()}_createGraphics(t){let e=t.get("graphics");if(!e){e=this._makeGraphics(this.columns,t),t.set("graphics",e),e._setDataItem(t);const i=t.get("legendDataItem");if(i){const a=i.get("markerRectangle");if(a){const o=a.states.lookup("default");b(B,n=>{const l=e.get(n,this.get(n));a.set(n,l),o.set(n,l)})}}let s=t.get("rangeGraphics");s&&b(s,a=>{a.dispose()}),s=[],t.setRaw("rangeGraphics",s),this.axisRanges.each(a=>{const o=a.container,n=this._makeGraphics(a.columns,t);s&&s.push(n),n.setPrivate("list",a.columns),o.children.push(n)})}}createAxisRange(t){return b(this.dataItems,e=>{const i=e.get("graphics");i&&(i.dispose(),e.set("graphics",void 0))}),super.createAxisRange(t)}_updateGraphics(t,e){let i=t.get("graphics");const s=this._xField,a=this._yField,o=t.get(s),n=t.get(a);if(o!=null&&n!=null){const l=this._xOpenField,g=this._yOpenField,p=this.get("locationX",t.get("locationX",.5)),r=this.get("locationY",t.get("locationY",.5)),h=this.get("openLocationX",t.get("openLocationX",p)),c=this.get("openLocationY",t.get("openLocationY",r)),f=i.get("width"),u=i.get("height"),d=this.get("stacked"),m=this.get("xAxis"),x=this.get("yAxis"),M=this.get("baseAxis"),F=m.get("start"),_=m.get("end"),T=x.get("start"),X=x.get("end");let y,w,D,C,Y=this.get("vcy",1),L=this.get("vcx",1),N=!1,G=!1;if(x.isType("CategoryAxis")&&m.isType("CategoryAxis")){let P=this._aLocationX0+h-.5,v=this._aLocationX1+p-.5;if(f instanceof R){let I=(v-P)*(1-f.value)/2;P+=I,v-=I}if(y=m.getDataItemPositionX(t,l,P,L),w=m.getDataItemPositionX(t,s,v,L),P=this._aLocationY0+c-.5,v=this._aLocationY1+r-.5,u instanceof R){let I=(v-P)*(1-u.value)/2;P+=I,v-=I}D=x.getDataItemPositionY(t,g,P,Y),C=x.getDataItemPositionY(t,a,v,Y),t.setRaw("point",{x:y+(w-y)/2,y:D+(C-D)/2})}else if(m===M){let P=this._aLocationX0+h-.5,v=this._aLocationX1+p-.5;if(f instanceof R){let I=(v-P)*(1-f.value)/2;P+=I,v-=I}if(y=m.getDataItemPositionX(t,l,P,L),w=m.getDataItemPositionX(t,s,v,L),D=x.getDataItemPositionY(t,a,r,Y),this._yOpenField!==this._yField)C=x.getDataItemPositionY(t,g,c,Y);else if(d){let I=t.get("stackToItemY");C=I?x.getDataItemPositionY(I,a,c,I.component.get("vcy")):x.basePosition()}else C=x.basePosition();t.setRaw("point",{x:y+(w-y)/2,y:D}),G=!0}else if(x===M){let P=this._aLocationY0+c-.5,v=this._aLocationY1+r-.5;if(u instanceof R){let I=(v-P)*(1-u.value)/2;P+=I,v-=I}if(D=x.getDataItemPositionY(t,g,P,Y),C=x.getDataItemPositionY(t,a,v,Y),w=m.getDataItemPositionX(t,s,p,L),this._xOpenField!==this._xField)y=m.getDataItemPositionX(t,l,h,L);else if(d){let I=t.get("stackToItemX");y=I?m.getDataItemPositionX(I,s,h,I.component.get("vcx")):m.basePosition()}else y=m.basePosition();N=!0,t.setRaw("point",{x:w,y:D+(C-D)/2})}this._updateSeriesGraphics(t,i,y,w,D,C,N,G),y<F&&w<F||y>_&&w>_||D<T&&C<=T||D>=X&&C>X||E(y)||E(D)?this._toggleColumn(t,!1):this._toggleColumn(t,!0);let V=t.get("rangeGraphics");V&&b(V,P=>{this._updateSeriesGraphics(t,P,y,w,D,C,N,G)}),this._applyGraphicsStates(t,e)}else this._toggleColumn(t,!1)}_updateSeriesGraphics(t,e,i,s,a,o,n,l){const g=e.get("width"),p=e.get("height"),r=e.get("maxWidth"),h=e.get("maxHeight"),c=this.getPoint(i,a),f=this.getPoint(s,o),u=t.get("point");if(u){const d=this.getPoint(u.x,u.y);u.x=d.x+this._x,u.y=d.y+this._y}if(i=c.x,s=f.x,a=c.y,o=f.y,A(g)){const d=(s-i-g)/2;i+=d,s-=d}if(A(r)&&r<Math.abs(s-i)){const d=(s-i-r)/2;i+=d,s-=d}if(A(p)){const d=(o-a-p)/2;a+=d,o-=d}if(A(h)&&h<Math.abs(o-a)){const d=(o-a-h)/2;a+=d,o-=d}this.get("adjustBulletPosition")&&(n&&(s=Math.min(Math.max(0,s),this._pw),i=Math.min(Math.max(0,i),this._pw)),l&&(a=Math.min(Math.max(0,a),this._ph),o=Math.min(Math.max(0,o),this._ph))),t.setRaw("left",i),t.setRaw("right",s),t.setRaw("top",a),t.setRaw("bottom",o),e.setPrivate("width",s-i),e.setPrivate("height",o-a),e.set("x",i),e.set("y",o-(o-a))}_handleDataSetChange(){super._handleDataSetChange(),b(this._dataItems,t=>{this._toggleColumn(t,!1)})}_applyGraphicsStates(t,e){const i=t.get("graphics"),s=i.states.lookup("dropFromOpen"),a=i.states.lookup("riseFromOpen"),o=i.states.lookup("dropFromPrevious"),n=i.states.lookup("riseFromPrevious");if(s||o||a||n){const l=this.get("xAxis"),g=this.get("yAxis"),p=this.get("baseAxis");let r,h,c;p===l&&g.isType("ValueAxis")?(r=t.get(this._yOpenField),h=t.get(this._yField),c=e.get(this._yField)):p===g&&l.isType("ValueAxis")&&(r=t.get(this._xOpenField),h=t.get(this._xField),c=e.get(this._xField)),A(r)&&A(h)&&(h<r?s&&s.apply():a&&a.apply(),A(c)&&(h<c?o&&o.apply():n&&n.apply()))}}disposeDataItem(t){super.disposeDataItem(t);const e=t.get("graphics");e&&(this.columns.removeValue(e),e.dispose());const i=t.get("rangeGraphics");i&&b(i,s=>{const a=s.getPrivate("list");a&&a.removeValue(s),s.dispose()})}hideDataItem(t,e){const i=Object.create(null,{hideDataItem:{get:()=>super.hideDataItem}});return W(this,void 0,void 0,function*(){const s=[i.hideDataItem.call(this,t,e)],a=t.get("graphics");a&&s.push(a.hide(e));const o=t.get("rangeGraphics");o&&b(o,n=>{s.push(n.hide(e))}),yield Promise.all(s)})}_toggleColumn(t,e){const i=t.get("graphics");i&&i.setPrivate("visible",e);const s=t.get("rangeGraphics");s&&b(s,o=>{o.setPrivate("visible",e)});const a=t.bullets;a&&b(a,o=>{o.setPrivate("hidden",!e)})}showDataItem(t,e){const i=Object.create(null,{showDataItem:{get:()=>super.showDataItem}});return W(this,void 0,void 0,function*(){const s=[i.showDataItem.call(this,t,e)],a=t.get("graphics");a&&s.push(a.show(e));const o=t.get("rangeGraphics");o&&b(o,n=>{s.push(n.show(e))}),yield Promise.all(s)})}updateLegendMarker(t){let e=this.get("legendDataItem");if(this.get("useLastColorForLegendMarker")&&!t){const i=this.dataItems[this.endIndex()-1];i&&(t=i)}if(e){let i=this.columns.template;if(t){let a=t.get("graphics");a&&(i=a)}const s=e.get("markerRectangle");if(s&&!e.get("itemContainer").get("disabled")){const a=s.states.lookup("default");b(B,o=>{const n=i.get(o,this.get(o));s.set(o,n),a.set(o,n)})}}}_getTooltipTarget(t){return this.get("seriesTooltipTarget")=="bullet"?super._getTooltipTarget(t):t.get("graphics")||this}}Object.defineProperty(k,"className",{enumerable:!0,configurable:!0,writable:!0,value:"BaseColumnSeries"}),Object.defineProperty(k,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:U.classNames.concat([k.className])});class O extends Z{constructor(){super(...arguments),Object.defineProperty(this,"_frequency",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"_itemMap",{enumerable:!0,configurable:!0,writable:!0,value:{}})}_afterNew(){this._settings.themeTags=j(this._settings.themeTags,["axis"]),this.fields.push("category"),this.setPrivateRaw("name","category"),this.addTag("category"),super._afterNew()}_prepareChildren(){super._prepareChildren();const t=this.dataItems.length;let e=0;this._valuesDirty&&(this._itemMap={},b(this.dataItems,i=>{i.setRaw("index",e),this._itemMap[i.get("category")]=i,e++}),this.setPrivateRaw("maxZoomFactor",t)),this.setPrivateRaw("startIndex",Math.max(Math.round(this.get("start",0)*t),0)),this.setPrivateRaw("endIndex",Math.min(Math.round(this.get("end",1)*t),t)),(this._sizeDirty||this._valuesDirty||this.isDirty("start")||this.isDirty("end")||this.isPrivateDirty("endIndex")||this.isPrivateDirty("startIndex")||this.isPrivateDirty("width")||this.isPrivateDirty("height"))&&this.dataItems.length>0&&(this._handleRangeChange(),this._prepareAxisItems(),this._updateAxisRanges())}_handleRangeChange(){b(this.series,t=>{let e=this.dataItems[this.startIndex()].get("category"),i=this.dataItems[this.endIndex()-1].get("category"),s=t.get("baseAxis"),a=t.get("xAxis"),o=t.get("yAxis");if(a instanceof O&&o instanceof O)t._markDirtyAxes();else if(s===this){let n,l,g=o;if(a===s?(t.get("categoryXField")&&(n="categoryX"),t.get("openCategoryXField")&&(l="openCategoryX")):o===s&&(t.get("categoryYField")&&(n="categoryY"),t.get("openCategoryYField")&&(l="openCategoryY"),g=a),g instanceof J&&(n||l)){let p,r;for(let u=0,d=t.dataItems.length;u<d;u++){let m=t.dataItems[u];if(n&&m.get(n)===e){p=m;break}if(l&&m.get(l)===e){p=m;break}}for(let u=t.dataItems.length-1;u>=0;u--){let d=t.dataItems[u];if(n&&d.get(n)===i){r=d;break}if(l&&d.get(l)===i){r=d;break}}let h=0,c=t.dataItems.length;p&&(h=t.dataItems.indexOf(p)),r&&(c=t.dataItems.indexOf(r)+1),t.setPrivate("startIndex",h),t.setPrivate("endIndex",c);let f=!1;for(let u=h;u<c;u++){const d=t.dataItems[u];if(b(t.__valueXShowFields,m=>{d.get(m)!=null&&(f=!0)}),b(t.__valueYShowFields,m=>{d.get(m)!=null&&(f=!0)}),f)break}t.setPrivate("outOfSelection",!f)}t._markDirtyAxes()}})}_prepareAxisItems(){var t;const e=this.get("renderer"),i=this.dataItems.length;let s=this.startIndex();s>0&&s--;let a=this.endIndex();a<i&&a++;const o=e.get("minorLabelsEnabled"),n=e.get("minorGridEnabled",o);let l=e.axisLength()/Math.max(e.get("minGridDistance"),1),g=Math.max(1,Math.min(i,Math.ceil((a-s)/l)));s=Math.floor(s/g)*g,this._frequency=g;for(let r=0;r<i;r++)this._toggleDataItem(this.dataItems[r],!1);let p=this.dataItems[s].get("index",0);for(let r=s;r<a;r+=g){let h=this.dataItems[r];this._createAssets(h,[]),this._toggleDataItem(h,!0);let c=g;n&&(c=1),this._prepareDataItem(h,p,c),p++}if(e.get("minorGridEnabled"))for(let r=s;r<a;r++){let h=this.dataItems[r];r%g!=0&&(this._createAssets(h,["minor"],!0),this._toggleDataItem(h,!0),this._prepareDataItem(h,0,1),o||(t=h.get("label"))===null||t===void 0||t.setPrivate("visible",!1))}this._updateGhost()}_prepareDataItem(t,e,i){let s=this.get("renderer"),a=t.get("categoryLocation",0),o=t.get("endCategoryLocation",1),n=t.get("index");A(n)||(n=this.categoryToIndex(t.get("category")));let l,g=this.indexToPosition(n,a),p=t.get("endCategory");p?(l=this.categoryToIndex(p),A(l)||(l=n)):l=n;let r,h,c=this.indexToPosition(l,o);r=t.get("isRange")?l:n+this._frequency-1,h=this.indexToPosition(r,o),s.updateLabel(t.get("label"),g,c,i),s.updateGrid(t.get("grid"),g,c),s.updateTick(t.get("tick"),g,c,i),s.updateFill(t.get("axisFill"),g,h),this._processBullet(t),s.updateBullet(t.get("bullet"),g,c);const f=this.get("fillRule");f&&f(t,e)}startIndex(){let t=this.dataItems.length;return Math.min(Math.max(this.getPrivate("startIndex",0),0),t-1)}endIndex(){let t=this.dataItems.length;return Math.max(1,Math.min(this.getPrivate("endIndex",t),t))}baseValue(){}basePosition(){return 0}getX(t){let e=this._itemMap[t];return e?this._settings.renderer.positionToCoordinate(this.indexToPosition(e.get("index",0))):NaN}getY(t){let e=this._itemMap[t];return e?this._settings.renderer.positionToCoordinate(this.indexToPosition(e.get("index",0))):NaN}getDataItemPositionX(t,e,i,s){const a=t.get(e),o=this._itemMap[a];return o?this.indexToPosition(o.get("index",0),i):NaN}getDataItemCoordinateX(t,e,i,s){return this._settings.renderer.positionToCoordinate(this.getDataItemPositionX(t,e,i,s))}getDataItemPositionY(t,e,i,s){const a=t.get(e),o=this._itemMap[a];return o?this.indexToPosition(o.get("index",0),i):NaN}getDataItemCoordinateY(t,e,i,s){return this._settings.renderer.positionToCoordinate(this.getDataItemPositionY(t,e,i,s))}indexToPosition(t,e){A(e)||(e=.5);let i=this.dataItems.length,s=this.get("startLocation",0);i-=s,i-=1-this.get("endLocation",1);let a=(t+e-s)/i,o=this.dataItems[t];return o&&(a+=o.get("deltaPosition",0)),a}categoryToIndex(t){let e=this._itemMap[t];return e?e.get("index"):NaN}dataItemToPosition(t){return this.indexToPosition(t.get("index"))}roundAxisPosition(t,e){return t+=(.5-e)/this.dataItems.length,this.indexToPosition(this.axisPositionToIndex(t),e)}axisPositionToIndex(t){let e=this.dataItems.length;return $(Math.floor(t*e),0,e-1)}getTooltipText(t,e){const i=this.dataItems[this.axisPositionToIndex(t)];if(i){const s=i.get("label");if(s)return K(s,this.get("tooltipText",""))}}_updateTooltipText(t,e){t._setDataItem(this.dataItems[this.axisPositionToIndex(e)]),t.label.text.markDirtyText()}getSeriesItem(t,e){if(this.dataItems.length>0){let i=this.getPrivate("name")+this.get("renderer").getPrivate("letter"),s=this.axisPositionToIndex(e),a=t.dataItems[s],o=this.dataItems[s],n=o.get("category");if(a&&o&&a.get(i)===n)return a;for(let l=0,g=t.dataItems.length;l<g;l++){let p=t.dataItems[l];if(p.get(i)===n)return p}}}zoomToIndexes(t,e,i){let s=this.dataItems.length;this.zoom(t/s,e/s,i)}zoomToCategories(t,e,i){this.zoomToIndexes(this.categoryToIndex(t),this.categoryToIndex(e)+1,i)}getCellWidthPosition(){return this._frequency/this.dataItems.length/(this.get("end",1)-this.get("start",0))}nextPosition(t){t==null&&(t=1),this.get("renderer").getPrivate("letter")=="Y"&&(t*=-1);const e=this.getPrivate("tooltipPosition",0),i=$(this.axisPositionToIndex(e)+t,0,this.dataItems.length-1);return this.toGlobalPosition(this.indexToPosition(i))}}Object.defineProperty(O,"className",{enumerable:!0,configurable:!0,writable:!0,value:"CategoryAxis"}),Object.defineProperty(O,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:Z.classNames.concat([O.className])});class S extends k{constructor(){super(...arguments),Object.defineProperty(this,"columns",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(new z(q.new({}),()=>H._new(this._root,{position:"absolute",themeTags:j(this.columns.template.get("themeTags",[]),["series","column"])},[this.columns.template])))})}makeColumn(t,e){const i=this.mainContainer.children.push(e.make());return i._setDataItem(t),e.push(i),i}_processAxisRange(t){super._processAxisRange(t),t.columns=new z(q.new({}),()=>H._new(this._root,{position:"absolute",themeTags:j(t.columns.template.get("themeTags",[]),["series","column"])},[this.columns.template,t.columns.template]))}}Object.defineProperty(S,"className",{enumerable:!0,configurable:!0,writable:!0,value:"ColumnSeries"}),Object.defineProperty(S,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:k.classNames.concat([S.className])});export{ht as AxisRendererXAm5,gt as AxisRendererYAm5,O as CategoryAxisAm5,S as ColumnSeriesAm5,dt as LineSeriesAm5,J as ValueAxisAm5,mt as XYChartAm5,ct as XYCursorAm5};
