import{a as F,d as z}from"./generateRendererUtils-5874bc54.js";const D="<Null>",I="equal-interval",N=1,S=5,M=10,C=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,T=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),k=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function b(t){return t==null||typeof t=="string"&&!t?D:t}function $(t){const e=t.normalizationField!=null||t.normalizationType!=null,l=t.minValue!=null||t.maxValue!=null,n=!!t.sqlExpression&&t.supportsSQLExpression;return!e&&!l&&!n}function Y(t){const e=t.returnDistinct?[...new Set(t.values)]:t.values,l=e.filter(i=>i!=null).sort(),n=l.length,r={count:n,min:l[0],max:l[n-1]};return t.supportsNullCount&&(r.nullcount=e.length-n),t.percentileParams&&(r.median=y(e,t.percentileParams)),r}function w(t){const{values:e,useSampleStdDev:l,supportsNullCount:n}=t;let r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,a=null,o=null,u=null,d=null,c=0;const f=t.minValue==null?-1/0:t.minValue,m=t.maxValue==null?1/0:t.maxValue;for(const s of e)Number.isFinite(s)?s>=f&&s<=m&&(a=a===null?s:a+s,r=Math.min(r,s),i=Math.max(i,s),c++):typeof s=="string"&&c++;if(c&&a!=null){o=a/c;let s=0;for(const v of e)Number.isFinite(v)&&v>=f&&v<=m&&(s+=(v-o)**2);d=l?c>1?s/(c-1):0:c>0?s/c:0,u=Math.sqrt(d)}else r=null,i=null;const p={avg:o,count:c,max:i,min:r,stddev:u,sum:a,variance:d};return n&&(p.nullcount=e.length-c),t.percentileParams&&(p.median=y(e,t.percentileParams)),p}function y(t,e){const{fieldType:l,value:n,orderBy:r,isDiscrete:i}=e,a=E(l,r==="desc");if((t=[...t].filter(p=>p!=null).sort((p,s)=>a(p,s))).length===0)return null;if(n<=0)return t[0];if(n>=1)return t[t.length-1];const o=(t.length-1)*n,u=Math.floor(o),d=u+1,c=o%1,f=t[u],m=t[d];return d>=t.length||i||typeof f=="string"||typeof m=="string"?f:f*(1-c)+m*c}function E(t,e){const l=e?1:-1,n=q(e),r=g(e);if(!(t&&["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...T].includes(t)))return(i,a)=>typeof i=="number"&&typeof a=="number"?n(i,a):typeof i=="string"&&typeof a=="string"?r(i,a):l;if(t==="esriFieldTypeDate")return(i,a)=>{const o=new Date(i).getTime(),u=new Date(a).getTime();return isNaN(o)||isNaN(u)?l:n(o,u)};if(T.has(t))return(i,a)=>n(i,a);if(t==="esriFieldTypeString")return(i,a)=>r(i,a);if(t==="esriFieldTypeGUID"||t==="esriFieldTypeGlobalID"){const i=g(e);return(a,o)=>i(x(a),x(o))}return e?(i,a)=>1:(i,a)=>-1}function V(t,e,l){if(l){if(t==null)return e==null?0:1;if(e==null)return-1}else{if(t==null)return e==null?0:-1;if(e==null)return 1}return null}function g(t){return t?(e,l)=>{const n=V(e,l,!0);return n??((e=e.toUpperCase())>(l=l.toUpperCase())?-1:e<l?1:0)}:(e,l)=>{const n=V(e,l,!1);return n??((e=e.toUpperCase())<(l=l.toUpperCase())?-1:e>l?1:0)}}function q(t){return t?(e,l)=>{const n=V(e,l,!0);return n??l-e}:(e,l)=>{const n=V(e,l,!1);return n??e-l}}function x(t){return t.substr(24,12)+t.substr(19,4)+t.substr(16,2)+t.substr(14,2)+t.substr(11,2)+t.substr(9,2)+t.substr(6,2)+t.substr(4,2)+t.substr(2,2)+t.substr(0,2)}function _(t,e){let l;for(l in t)k.includes(l)&&(Number.isFinite(t[l])||(t[l]=null));return e&&["avg","stddev","variance"].forEach(n=>{t[n]!=null&&(t[n]=Math.ceil(t[n]??0))}),t}function Q(t){const e={};for(let l of t)(l==null||typeof l=="string"&&l.trim()==="")&&(l=null),e[l]==null?e[l]={count:1,data:l}:e[l].count++;return{count:e}}function h(t){return(t==null?void 0:t.type)!=="coded-value"?[]:t.codedValues.map(e=>e.code)}function j(t,e,l,n){const r=t.count,i=[];if(l&&e){const a=[],o=h(e[0]);for(const u of o)if(e[1]){const d=h(e[1]);for(const c of d)if(e[2]){const f=h(e[2]);for(const m of f)a.push(`${b(u)}${n}${b(c)}${n}${b(m)}`)}else a.push(`${b(u)}${n}${b(c)}`)}else a.push(u);for(const u of a)r.hasOwnProperty(u)||(r[u]={data:u,count:0})}for(const a in r){const o=r[a];i.push({value:o.data,count:o.count,label:o.label})}return{uniqueValueInfos:i}}function H(t,e,l,n){let r=null;switch(e){case"log":t!==0&&(r=Math.log(t)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(n)&&n!==0&&(r=t/n*100);break;case"field":Number.isFinite(l)&&l!==0&&(r=t/l);break;case"natural-log":t>0&&(r=Math.log(t));break;case"square-root":t>0&&(r=t**.5)}return r}function G(t,e){const l=U({field:e.field,normalizationType:e.normalizationType,normalizationField:e.normalizationField,classificationMethod:e.classificationMethod,standardDeviationInterval:e.standardDeviationInterval,breakCount:e.numClasses||S});return t=P(t,e.minValue,e.maxValue),F({definition:l,values:t,normalizationTotal:e.normalizationTotal})}function P(t,e,l){const n=e??-1/0,r=l??1/0;return t.filter(i=>Number.isFinite(i)&&i>=n&&i<=r)}function U(t){const{breakCount:e,field:l,normalizationField:n,normalizationType:r}=t,i=t.classificationMethod||I,a=i==="standard-deviation"?t.standardDeviationInterval||N:void 0;return new z({breakCount:e,classificationField:l,classificationMethod:i,normalizationField:r==="field"?n:void 0,normalizationType:r,standardDeviationInterval:a})}function J(t,e){var u,d;let l=t.classBreaks;const n=l.length,r=(u=l[0])==null?void 0:u.minValue,i=(d=l[n-1])==null?void 0:d.maxValue,a=e==="standard-deviation",o=C;return l=l.map(c=>{const f=c.label,m={minValue:c.minValue,maxValue:c.maxValue,label:f};if(a&&f){const p=f.match(o),s=(p==null?void 0:p.map(v=>+v.trim()))??[];s.length===2?(m.minStdDev=s[0],m.maxStdDev=s[1],s[0]<0&&s[1]>0&&(m.hasAvg=!0)):s.length===1&&(f.includes("<")?(m.minStdDev=null,m.maxStdDev=s[0]):f.includes(">")&&(m.minStdDev=s[0],m.maxStdDev=null))}return m}),{minValue:r,maxValue:i,classBreakInfos:l,normalizationTotal:t.normalizationTotal}}function K(t,e){const l=B(t,e);if(l.min==null&&l.max==null)return{bins:[],minValue:l.min,maxValue:l.max,normalizationTotal:e.normalizationTotal};const n=l.intervals,r=l.min??0,i=l.max??0,a=n.map((o,u)=>({minValue:n[u][0],maxValue:n[u][1],count:0}));for(const o of t)if(o!=null&&o>=r&&o<=i){const u=O(n,o);u>-1&&a[u].count++}return{bins:a,minValue:r,maxValue:i,normalizationTotal:e.normalizationTotal}}function B(t,e){const{field:l,classificationMethod:n,standardDeviationInterval:r,normalizationType:i,normalizationField:a,normalizationTotal:o,minValue:u,maxValue:d}=e,c=e.numBins||M;let f=null,m=null,p=null;if((!n||n==="equal-interval")&&!i){if(u!=null&&d!=null)f=u,m=d;else{const s=w({values:t,minValue:u,maxValue:d,useSampleStdDev:!i,supportsNullCount:$({normalizationType:i,normalizationField:a,minValue:u,maxValue:d})});f=s.min??null,m=s.max??null}p=A(f??0,m??0,c)}else{const{classBreaks:s}=G(t,{field:l,normalizationType:i,normalizationField:a,normalizationTotal:o,classificationMethod:n,standardDeviationInterval:r,minValue:u,maxValue:d,numClasses:c});f=s[0].minValue,m=s[s.length-1].maxValue,p=s.map(v=>[v.minValue,v.maxValue])}return{min:f,max:m,intervals:p}}function O(t,e){let l=-1;for(let n=t.length-1;n>=0;n--)if(e>=t[n][0]){l=n;break}return l}function A(t,e,l){const n=(e-t)/l,r=[];let i,a=t;for(let o=1;o<=l;o++)i=a+n,i=Number(i.toFixed(16)),r.push([a,o===l?e:i]),a=i;return r}export{G as D,j as F,K as M,J as S,b as c,w as d,Y as f,_ as g,$ as m,y as p,E as v,Q as x,H as z};
