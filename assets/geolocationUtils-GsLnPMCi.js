import{b as s,h as c,j as l,n as m}from"./subclass-BZA_h8Db.js";import{j as g,R as d}from"./Point-Cg0-ChZE.js";import{b as p}from"./Portal-C10FKnaA.js";import{p as f,n as h}from"./project-DlMfXva8.js";const u=()=>m.getLogger("esri.widgets.support.geolocationUtils"),v={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function w(){const e=!!l("esri-geolocation");return e||u().warn("geolocation-unsupported","Geolocation unsupported."),e}function y(){const e=window.isSecureContext;return e||u().warn("insecure-context","Geolocation requires a secure origin."),e}function A(){return w()&&y()}function U(e){return e??(e=v),new Promise((o,r)=>{setTimeout(()=>r(new s("geolocation:timeout","getting the current geolocation position timed out")),15e3),navigator.geolocation.getCurrentPosition(o,r,e??void 0)})}function C(e,t){const{position:o,view:r}=e,i=P(o),n=i==null?void 0:i.coords;if(!n)throw new s("geometry-service:no-coords","Geolocation has no coordinates");return G(S(n),r,t)}function P(e){const t=e&&e.coords||{},o={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed};return e&&{coords:o,timestamp:e.timestamp}}function S({longitude:e,latitude:t,altitude:o}){return new g({longitude:e,latitude:t,z:o||void 0,spatialReference:{wkid:4326}})}function G(e,t,o){if(!t)return Promise.resolve(e);const r=t.spatialReference;return r.isWGS84?Promise.resolve(e):r.isWebMercator?Promise.resolve(d(e)):R(o).then(i=>{if(!i)throw new s("geometry-service:missing-url","Geometry service URL is missing");const n=new f({geometries:[e],outSpatialReference:r});return h(i,n,o).then(a=>a[0])})}function R(e){if(c.geometryServiceUrl)return Promise.resolve(c.geometryServiceUrl);const t=p.getDefault();return t.load(e).catch(()=>{}).then(()=>{var o,r;return(r=(o=t.helperServices)==null?void 0:o.geometry)==null?void 0:r.url})}export{C as f,A as g,U as p};
