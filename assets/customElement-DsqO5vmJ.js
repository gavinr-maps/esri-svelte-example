import{L as w,u as M,c as x,n as C,s as l,x as c,b as g,e as E,i as R,H as S,a as B}from"./index-4eY77cms.js";import{n as V}from"./ref-D9wHsL_T.js";import{d as A}from"./reactiveUtils-XM7cS2OP.js";import{r as a,m as r,a as N}from"./Accessor-BmwT4B0c.js";import{i as P}from"./Evented-Dw4_VOGn.js";import{s as T,M as D}from"./mathUtils-Cfq9PL9W.js";import{t as L}from"./GoTo-zPv0y7kC.js";import{s as k}from"./useT9n-Dwv-EXPO.js";import{u as I}from"./useViewModel-x7-oy52B.js";import{e as $}from"./globalCss-B9-jl_gY.js";import"./directive-helpers-DaBykg1t.js";import"./SimpleObservable-CvOkykwM.js";import"./index-C5b9dHRB.js";import"./component-utils-D0ciaaZ_.js";const O=[-45,0,45,-90,90,-135,180,135],U=[...O,-180],q=200,H="esri-directional-pad",W={compassButton:`${H}__compass`};function F(e){const t=G(e),i=U.map(n=>({angle:n,offset:Math.abs(n-t)})).sort((n,u)=>n.offset-u.offset),o=i[0].angle;return o===-180?180:o}function G({x:e,y:t}){const i=Math.atan2(e,t);return D(i)}function b(e){const t=T(e);return{x:Math.sin(t),y:Math.cos(t)}}function j(e,t){const i=t.y-e.y,o=t.x-e.x,n=Math.sqrt(o*o+i*i);return{x:o/n,y:i/n}}let s=class extends L(P.EventedAccessor){constructor(e){super(e),this._initialAngle=void 0,this._movementVector=void 0,this._widgetCenter=void 0,this._anyAngleMovementEnabled=!1,this._movementTimeout=void 0,this._disabled=!1,this._moveOnceDuration=q,this.angle=void 0,this.speed=1,this.view=null,this.beginFollowingPointer=(t,i)=>{if(this.disabled)return;this._widgetCenter=i;const o=this._pointerLocationToVector(t);if(o===void 0)return;const n=this._resolveClosestAngle(t,o);n!==void 0&&(this._emitMove(b(n)),this.angle=n,this._initialAngle=n,this._setMovementTimeout(()=>{this._widgetCenter===void 0&&this._stopMovement()}),document.addEventListener("pointermove",this._onPointerMove,{passive:!0}),document.addEventListener("pointerup",this._onPointerUp,{passive:!0,once:!0}))},this.moveOnce=t=>{const i=b(t);this._emitMove(i),this._setMovementTimeout(this._stopMovement)},this._pointerLocationToVector=t=>{if(this._widgetCenter===void 0)return;const{x:i,y:o}=j(this._widgetCenter,t);return{x:i,y:-o}},this._resolveClosestAngle=(t,i)=>{var m,p;const o=t.target,n=(m=o==null?void 0:o.getAttribute)==null?void 0:m.call(o,"data-angle");if((p=o==null?void 0:o.classList)==null?void 0:p.contains(W.compassButton))return;const v=Number.parseInt(n??"",10);return Number.isNaN(v)?F(i):v},this._onPointerMove=t=>{var m,p;if(t.buttons===0)return void this._stopMovement();const i=this._pointerLocationToVector(t);if(i===void 0)return;this._setMovementTimeout(void 0);const o=this._resolveClosestAngle(t,i);if(o===void 0)return void this._emitStop();const n=b(o),u=this._initialAngle!=null&&this._initialAngle!==o;this._anyAngleMovementEnabled||(this._anyAngleMovementEnabled=u);const v=this._anyAngleMovementEnabled?i:n;(v.x!==((m=this._movementVector)==null?void 0:m.x)||v.y!==((p=this._movementVector)==null?void 0:p.y))&&(this.angle=o,this._emitMove(v))},this._onPointerUp=()=>{this._movementTimeout===void 0?this._stopMovement():this._widgetCenter=void 0},this._stopMovement=()=>{this._emitStop(),this._widgetCenter=void 0,this._initialAngle=void 0,this._anyAngleMovementEnabled=!1,document.removeEventListener("pointermove",this._onPointerMove),document.removeEventListener("pointerup",this._stopMovement),this._setMovementTimeout(void 0)},this.on("move-start",()=>{var t;return(t=this.view)==null?void 0:t.mapViewNavigation.begin()}),this.on("move-direction-change",({vector:{x:t,y:i}})=>{var o;return(o=this.view)==null?void 0:o.mapViewNavigation.continuousPanVector({x:t*this.speed,y:i*this.speed})}),this.on("move-stop",()=>{var t;return(t=this.view)==null?void 0:t.mapViewNavigation.stop()})}destroy(){this._stopMovement()}get disabled(){const{view:e,_disabled:t,supported:i}=this;return(e==null?void 0:e.ready)===!1||t||!i}set disabled(e){this._disabled=e}get rotation(){var e;return((e=this.view)==null?void 0:e.rotation)??this._get("rotation")??0}set rotation(e){this.view?this.view.constraints.rotationEnabled&&this.callGoTo({target:{rotation:e},options:{animate:e===0&&void 0}}):this._set("rotation",e)}get supported(){return this.view==null||this.view.type==="2d"}get state(){const{disabled:e,angle:t}=this;return e?"disabled":t!=null?"moving":"ready"}_setMovementTimeout(e){clearTimeout(this._movementTimeout),this._movementTimeout=e===void 0?void 0:setTimeout(()=>{this._movementTimeout=void 0,e()},this._moveOnceDuration)}_emitMove(e){this._movementVector==null&&this._emitMoveStartEvent({vector:e});const t=this._movementVector;this._movementVector=e,this._emitMoveDirectionChangeEvent({vector:e,oldVector:t})}_emitStop(){this.angle=void 0,this._movementVector!==void 0&&(this._emitMoveStopEvent({oldVector:this._movementVector}),this._movementVector=void 0)}_emitMoveStartEvent(e){this.emit("move-start",{...e,type:"move-start"})}_emitMoveDirectionChangeEvent(e){this.emit("move-direction-change",{...e,type:"move-direction-change"})}_emitMoveStopEvent(e){this.emit("move-stop",{...e,type:"move-stop"})}};a([r()],s.prototype,"_initialAngle",void 0),a([r()],s.prototype,"_movementVector",void 0),a([r()],s.prototype,"_widgetCenter",void 0),a([r()],s.prototype,"_anyAngleMovementEnabled",void 0),a([r()],s.prototype,"_movementTimeout",void 0),a([r()],s.prototype,"_disabled",void 0),a([r()],s.prototype,"_moveOnceDuration",void 0),a([r()],s.prototype,"disabled",null),a([r()],s.prototype,"angle",void 0),a([r({type:Number,range:{min:0,max:100}})],s.prototype,"speed",void 0),a([r()],s.prototype,"rotation",null),a([r()],s.prototype,"supported",null),a([r({readOnly:!0})],s.prototype,"state",null),a([r()],s.prototype,"view",void 0),s=a([N("esri.widgets.DirectionalPad.DirectionalPadViewModel")],s);const z=s;/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
v4.32.12 */const y=[-45,0,45,-90,90,-135,180,135],J={0:{label:"north",iconName:"chevron-up"},45:{label:"northEast",iconName:"chevron-up-right"},90:{label:"east",iconName:"chevron-right"},135:{label:"southEast",iconName:"chevron-down-right"},180:{label:"south",iconName:"chevron-down"},"-135":{label:"southWest",iconName:"chevron-down-left"},"-90":{label:"west",iconName:"chevron-left"},"-45":{label:"northWest",iconName:"chevron-up-left"}},d="arcgis-directional-pad",h={base:d,buttonsContainer:`${d}__buttons-container`,button:`${d}__button`,compassButton:`${d}__compass`,rotationContainer:`${d}__rotation-container`,rotationSliderContainer:`${d}__rotation-slider-container`,rotationReset:`${d}__rotation-reset-button`,error:`${d}__error`},K=R`@layer{.arcgis-directional-pad{display:flex;flex-direction:column;gap:var(--calcite-spacing-sm);outline:none;box-shadow:none!important;background-color:transparent!important;user-select:none;calcite-action-pad{display:contents}calcite-action-group{touch-action:none}calcite-action{aspect-ratio:1}}.arcgis-directional-pad__buttons-container{--calcite-color-background: transparent;--calcite-action-group-gap: 0;--calcite-action-group-padding: 0;calcite-action{--calcite-color-focus: var(--calcite-color-foreground-3)}calcite-action:not([active]){--calcite-action-background-color-press: var(--calcite-color-foreground-1)}calcite-action[active]{--calcite-action-background-color: var(--calcite-color-foreground-3)}calcite-icon{transform:var(--rotation, unset)}@media (hover: none){calcite-action{--calcite-action-background-color-hover: var(--calcite-color-foreground-1);--calcite-action-text-color-press: var(--calcite-color-text-3)}}}.arcgis-directional-pad__rotation-container{display:block;width:100%;calcite-action{flex:.3}}.arcgis-directional-pad__rotation-slider-container{display:flex;flex:1;align-items:center;calcite-slider{flex:1;padding-inline:var(--calcite-spacing-xxs)}}}`;function Q(e){const{x:t,y:i,width:o,height:n}=e.getBoundingClientRect();return{x:t+o/2,y:i+n/2}}function X(e){var t,i;return((t=e==null?void 0:e.spatialReference)==null?void 0:t.isWebMercator)||((i=e==null?void 0:e.spatialReference)==null?void 0:i.isGeographic)||!1}const Y=I(z),_=class _ extends w{constructor(){super(...arguments),this.messages=k({}),this._onContextMenu=t=>t.preventDefault(),this._buttons={},this.viewModel=Y(this),this.angle=this.viewModel.angle,this.rotation=this.viewModel.rotation,this.autoDestroyDisabled=!1,this.disabled=this.viewModel.disabled,this.hideDirectionalButtons=!1,this.icon="move",this.position="bottom-left",this.showRotationResetButton=!1,this.showRotationSlider=!1,this.state=this.viewModel.state,this.visualScale="s",this.arcgisPropertyChange=M()("state"),this.arcgisReady=x()}get _rotationEnabled(){var t;return(t=this.view)!=null&&t.ready?this.view.constraints.rotationEnabled??!1:!0}async destroy(){await this.manager.destroy()}loaded(){this.manager.onLifecycle(()=>[A(()=>this.viewModel.angle,()=>{var t,i;(t=this._buttonsContainer)!=null&&t.contains(document.activeElement)&&(this.viewModel.angle==null?(i=this.el.childElem)==null||i.focus():S(this._buttons[this.viewModel.angle]))})])}_rotateIcon(t){return{"--rotation":`rotate(${t}deg)`}}_setButtonContainerRef(t){t!==void 0?(this._buttonsContainer=t,queueMicrotask(()=>{this._buttons=Object.fromEntries(Array.from(t.children,i=>[Number.parseInt(i.getAttribute("data-angle")??""),i]))})):(this._buttonsContainer=void 0,this._buttons={})}_onButtonPointerDown(t){var o;if(this._buttonsContainer===void 0)return;(o=t.composedPath().find(n=>{var u;return(u=n.hasPointerCapture)==null?void 0:u.call(n,t.pointerId)}))==null||o.releasePointerCapture(t.pointerId);const i=Q(this._buttonsContainer);this.viewModel.beginFollowingPointer(t,i)}_onSliderInput({currentTarget:t}){typeof t.value=="number"&&(this.viewModel.rotation=t.value)}_onRotationReset(){this.viewModel.rotation=0}_onClick(t){this.viewModel.moveOnce(t)}render(){const{label:t,disabled:i}=this,o=this.view==null||this.view.type==="2d";return c`<div .ariaLabel=${t??void 0} class=${l({[h.base]:!0,[$.widget]:!0,[$.disabled]:i})} tabindex=-1>${o?this._renderContent():this._renderUnsupportedMessage()}</div>`}_renderUnsupportedMessage(){return c`<section class=${l(h.error)}><p>${this.messages.unsupported}</p></section>`}_renderContent(){return[this.hideDirectionalButtons?void 0:this._renderDirectionalButtons(),this.showRotationSlider?this._renderRotation():void 0]}_renderDirectionalButtons(){return c`<calcite-action-pad expand-disabled layout=grid><calcite-action-group class=${l(h.buttonsContainer)} dir=ltr @contextmenu=${{handleEvent:this._onContextMenu,capture:!0}} ${V(this._setButtonContainerRef)}>${y.slice(0,4).map(this._renderButton,this)}${this._renderCompass()}${y.slice(4).map(this._renderButton,this)}</calcite-action-group></calcite-action-pad>`}_renderButton(t){const{label:i,iconName:o}=J[t],n=this.messages[i];return c`<calcite-action .active=${this.angle===t} alignment=center class=${l(h.button)} data-angle=${t??g} .disabled=${this.disabled} @click=${this._onClick.bind(this,t)} @pointerdown=${this._onButtonPointerDown} .scale=${this.visualScale} .text=${n??""} title=${n??g}><calcite-icon .icon=${o} .scale=${this.visualScale}></calcite-icon></calcite-action>`}_renderCompass(){const t=this.disabled||X(this.view)?"compass-needle":"arrow-up",i=this.rotation===0,o=this.messages.resetHeading;return c`<calcite-action alignment=center class=${l(h.compassButton)} .disabled=${this.disabled||!this._rotationEnabled||i} @click=${this._onRotationReset} .scale=${this.visualScale} style=${E(this._rotateIcon(this.rotation))} .text=${o??""} title=${o??g}>${!i&&c`<calcite-icon .icon=${t} .scale=${this.visualScale}></calcite-icon>`||""}</calcite-action>`}_renderRotation(){return c`<calcite-action-pad expand-disabled layout=horizontal><calcite-action-group class=${l(h.rotationContainer)}>${this.showRotationResetButton?this._renderRotationResetButton():null}${this._renderRotationSlider()}</calcite-action-group></calcite-action-pad>`}_renderRotationResetButton(){const t=this.messages.resetHeading;return c`<calcite-action alignment=center class=${l(h.rotationReset)} .disabled=${this.disabled||!this._rotationEnabled} @click=${this._onRotationReset} .scale=${this.visualScale} .text=${t??""} title=${t??g}><calcite-icon flip-rtl icon=rotate .scale=${this.visualScale}></calcite-icon></calcite-action>`}_renderRotationSlider(){return c`<div class=${l(h.rotationSliderContainer)}><calcite-slider .ariaLabel=${this.messages.heading} .disabled=${this.disabled||!this._rotationEnabled} label-handles max=360 min=0 required .scale=${this.visualScale} .value=${Math.round(this.rotation)} @calciteSliderInput=${this._onSliderInput}></calcite-slider></div>`}};_.properties={_rotationEnabled:16,angle:16,rotation:16,autoDestroyDisabled:5,disabled:5,hideDirectionalButtons:5,icon:3,label:1,messageOverrides:0,position:3,referenceElement:1,showRotationResetButton:5,showRotationSlider:5,state:3,visualScale:1},_.shadowRootOptions=C,_.styles=K;let f=_;B("arcgis-directional-pad",f);export{f as ArcgisDirectionalPad};
