const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./editingSupport-22rkzIP8.js","./Graphic-Bi5hWHps.js","./Evented-CXIxDjmW.js","./Accessor-D6mNnsWy.js","./subclass-BR3PhgZG.js","./geometry-CnaxvJsv.js","./Extent-B4rrMrqp.js","./Point-TlcsOcXV.js","./jsonMap-DCC6W5ex.js","./writer-3zufXUNV.js","./assets-BNizZMOZ.js","./index-BVncS3aY.js","./index-CjOb8WjV.css","./Polyline-BQFeqYXi.js","./mathUtils-ClvKsMak.js","./PopupTemplate-D8mXPxzU.js","./Clonable-cKbRam6-.js","./reactiveUtils-BFQ0BtrB.js","./shared-B3wH2qpO.js","./fieldUtils-C5R42-PY.js","./intl-CArXn1et.js","./Promise-CZrWwByK.js","./enumeration--HlxOQ_N.js","./Color-DDUWtbqR.js","./colorUtils-CS9vdHXB.js","./ActionToggle-C0Z1k2jc.js","./Identifiable-BLvpQbOc.js","./symbols-CfvYGR4J.js","./TextSymbol-zZq0BA1M.js","./screenUtils-PfxkaaMN.js","./materialUtils-CQ3JLQ1x.js","./opacityUtils-BT7mQkwC.js","./aaBoundingBox-BGxkJAW0.js","./persistableUrlUtils-Dx61-x4K.js","./collectionUtils-Dm1icNvk.js","./Portal-DCqdz-K4.js","./jsonUtils-DtWlwXHP.js","./uuid-fwrPAdZb.js","./normalizeUtils-CuTX3yb4.js","./normalizeUtilsCommon-DNPu20r0.js","./utils-Blh5cXWv.js","./utils-Bh7lx_TM.js","./EditBusLayer-BXrQoGfQ.js","./infoFor3D-CxOdoily.js","./layerUtils-BzjQnEdj.js"])))=>i.map(i=>d[i]);
import{_ as F}from"./index-BVncS3aY.js";import{t as y}from"./assets-BNizZMOZ.js";import{h as A}from"./symbols-CfvYGR4J.js";import{b as O}from"./reactiveUtils-BFQ0BtrB.js";import{u as j,c as i}from"./subclass-BR3PhgZG.js";import{n as P}from"./jsonMap-DCC6W5ex.js";import{e as E}from"./fieldUtils-C5R42-PY.js";import{r as S}from"./featureQueryAll-ClGLkoIX.js";import{x}from"./layerUtils-BzjQnEdj.js";import{p as L}from"./SimpleRenderer-FL1Ywtqd.js";import{A as R}from"./UniqueValueRenderer-Q9ooDuxf.js";import{c as _}from"./AttachmentQuery-Ccywtvr9.js";import{b as m}from"./Query-BpMwiNVl.js";import q from"./RelationshipQuery-DuLVs9A4.js";const W=new P({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function X(t,e,n,r){const o=await f(t);if(await w(t,e,r),!o.addAttachment)throw new i(r,"Layer source does not support addAttachment capability");return o.addAttachment(e,n)}function w(t,e,n){var a,c;const{attributes:r}=e,{objectIdField:o}=t;return(c=(a=t.capabilities)==null?void 0:a.data)!=null&&c.supportsAttachment?e?r?o&&r[o]?Promise.resolve():Promise.reject(new i(n,`feature is missing the identifying attribute ${o}`)):Promise.reject(new i(n,"'attributes' are required on a feature to query attachments")):Promise.reject(new i(n,"A feature is required to add/delete/update attachments")):Promise.reject(new i(n,"this layer doesn't support attachments"))}async function Y(t,e,n,r,o){const a=await f(t);if(await w(t,e,o),!a.updateAttachment)throw new i(o,"Layer source does not support updateAttachment capability");return a.updateAttachment(e,n,r)}async function tt(t,e,n){const{applyEdits:r}=await F(()=>import("./editingSupport-22rkzIP8.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44]),import.meta.url),o=await t.load();let a=n;return o.type==="feature"&&o.infoFor3D&&e.deleteFeatures!=null&&o.globalIdField!=null&&(a={...a,globalIdToObjectId:await M(o,e.deleteFeatures,o.globalIdField)}),r(o,o.source,e,n)}async function et(t,e,n){const{uploadAssets:r}=await F(()=>import("./editingSupport-22rkzIP8.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44]),import.meta.url),o=await t.load();return r(o,o.source,e,n)}async function rt(t,e,n,r){const o=await f(t);if(await w(t,e,r),!o.deleteAttachments)throw new i(r,"Layer source does not support deleteAttachments capability");return o.deleteAttachments(e,n)}async function nt(t,e,n){const r=(await t.load({signal:e==null?void 0:e.signal})).source;if(!r.fetchRecomputedExtents)throw new i(n,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(e)}async function ot(t,e,n,r){var g,I;e=_.from(e),await t.load();const o=t.source,a=t.capabilities;if(!((g=a==null?void 0:a.data)!=null&&g.supportsAttachment))throw new i(r,"this layer doesn't support attachments");const{attachmentTypes:c,objectIds:p,globalIds:d,num:s,size:u,start:l,where:b}=e;if(!((I=a==null?void 0:a.operations)!=null&&I.supportsQueryAttachments)&&((c==null?void 0:c.length)>0||(d==null?void 0:d.length)>0||(u==null?void 0:u.length)>0||s||l||b))throw new i(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(p!=null&&p.length||d!=null&&d.length||b))throw new i(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!o.queryAttachments)throw new i(r,"Layer source does not support queryAttachments capability",e);return o.queryAttachments(e)}async function at(t,e,n,r){const o=await f(t);if(!o.queryObjectIds)throw new i(r,"Layer source does not support queryObjectIds capability");return o.queryObjectIds(m.from(e)??t.createQuery(),n)}async function it(t,e,n,r){const o=await f(t);if(!o.queryFeatureCount)throw new i(r,"Layer source does not support queryFeatureCount capability");return o.queryFeatureCount(m.from(e)??t.createQuery(),n)}async function st(t,e,n,r){const o=await f(t);if(!o.queryExtent)throw new i(r,"Layer source does not support queryExtent capability");return o.queryExtent(m.from(e)??t.createQuery(),n)}async function ut(t,e,n,r){const o=await f(t);if(!o.queryRelatedFeatures)throw new i(r,"Layer source does not support queryRelatedFeatures capability");return o.queryRelatedFeatures(q.from(e),n)}async function ct(t,e,n,r){const o=await f(t);if(!o.queryRelatedFeaturesCount)throw new i(r,"Layer source does not support queryRelatedFeaturesCount capability");return o.queryRelatedFeaturesCount(q.from(e),n)}async function lt(t){const e=t.source;if(e!=null&&e.refresh)try{const{dataChanged:n,updates:r}=await e.refresh();if(r!=null&&(t.sourceJSON={...t.sourceJSON,...r},t.read(r,{origin:"service",url:t.parsedUrl})),n)return!0}catch{}if(t.definitionExpression)try{return(await E(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function pt(t){var c,p;const e=new m,n=(c=t.capabilities)==null?void 0:c.data,r=(p=t.capabilities)==null?void 0:p.query;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),n&&(n.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),n.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:o,timeExtent:a}=t;return e.timeExtent=o!=null&&a!=null?a.offset(-o.value,o.unit):a||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function dt(t){const{globalIdField:e,fields:n}=t;if(e)return e;if(n){for(const r of n)if(r.type==="esriFieldTypeGlobalID")return r.name}}function ft(t){const{objectIdField:e,fields:n}=t;if(e)return e;if(n){for(const r of n)if(r.type==="esriFieldTypeOID")return r.name}}function yt(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}function mt(t,e){const{subtypes:n,subtypeField:r}=t;if(!e||!(n!=null&&n.length)||!r)return null;const o=e.attributes[r];return o==null?null:n.find(a=>a.code===o)}async function f(t){return(await t.load()).source}async function C(t,e){if(!y||y.findCredential(t))return;let n;try{const r=await x(t,e);r&&(n=await y.checkSignInStatus(`${r}/sharing`))}catch{}if(n)try{const r=e!=null?e.signal:null;await y.getCredential(t,{signal:r})}catch{}}async function ht(t,e,n){var o;const r=(o=t.parsedUrl)==null?void 0:o.path;r&&t.authenticationTriggerEvent===e&&await C(r,n)}function wt(t){return!v(t)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const h=j({types:A});function bt(t,e){var n;if(t.defaultSymbol)return(n=t.types)!=null&&n.length?new R({defaultSymbol:h(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(r=>({id:r.id,symbol:h(r.symbol,r,e)}))}):new L({symbol:h(t.defaultSymbol,t,e)})}function gt(t){var r,o,a;let e=(r=t.sourceJSON)==null?void 0:r.cacheMaxAge;if(!e)return!1;const n=(a=(o=t.editingInfo)==null?void 0:o.lastEditDate)==null?void 0:a.getTime();return n==null||(e*=1e3,Date.now()-n<e)}async function M(t,e,n){if(e==null)return null;const r=[],{objectIdField:o}=t;if(e.forEach(s=>{let u=null;if("attributes"in s){const{attributes:l}=s;u={globalId:l[n],objectId:l[o]!=null&&l[o]!==-1?l[o]:null}}else u={globalId:s.globalId,objectId:s.objectId!=null&&s.objectId!==-1?s.objectId:null};u.globalId!=null&&(u.objectId!=null&&u.objectId!==-1||r.push(u.globalId))}),r.length===0)return null;const a=t.createQuery();a.where=r.map(s=>`${n}='${s}'`).join(" OR "),a.returnGeometry=!1,a.outFields=[o,n],a.cacheHint=!1;const c=await O(S(t,a));if(!c.ok)return null;const p=new Map,d=c.value.features;for(const s of d){const u=s.attributes[n],l=s.attributes[o];u!=null&&l!=null&&l!==-1&&p.set(u,l)}return p}function It(t,e,n){if(!e||!n||!t)return null;const r=n.getAttribute(e);return r==null?null:t.find(o=>{const{id:a}=o;return a!=null&&a.toString()===r.toString()})??null}function v(t){var e;return((e=t.sourceJSON)==null?void 0:e.isMultiServicesView)||G(t)}function G(t){var e,n;return!!((n=(e=t.sourceJSON)==null?void 0:e.capabilities)!=null&&n.toLowerCase().split(",").map(r=>r.trim()).includes("map"))}export{it as A,yt as C,lt as E,at as F,nt as I,M as J,mt as L,ft as M,It as N,st as O,ut as P,C as Q,dt as R,ct as S,ht as T,bt as U,gt as V,v as Z,tt as b,et as g,rt as j,X as m,ot as q,wt as v,Y as w,pt as x,W as y};
