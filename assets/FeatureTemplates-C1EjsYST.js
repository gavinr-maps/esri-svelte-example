const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./TextSymbol-BQ_NW9Xo.js","./Accessor-BHnuXKD2.js","./Color-gncXBiLc.js","./colorUtils-Rxh2V3ai.js","./mathUtils-DV9iOXpW.js","./cast-BA_-jlhc.js","./index-tefRSezt.js","./index-Cx51aysm.css","./JSONSupport-CGdeqxpk.js","./enumeration-Cr5WIZs4.js","./screenUtils-_ZIvrt5o.js","./writer-B2bQV2uU.js","./index-73bQemcW.js","./jsxFactory-CLjKarlq.js","./intl-Do3GEEJ7.js","./Promise-CmQqe-ke.js","./Evented-DCWccWGU.js","./reactiveUtils-BR0C1Kq4.js","./SimpleObservable-7oieNGD8.js","./uuid-Cl5lrJ4c.js","./dom--xxYYVQF.js","./guid-ejniuQmw.js","./observers-BdozwIHb.js","./index-CjrYEQXz.js","./useT9n-CJAswmP1.js","./index-Wn4pOF_U.js","./index-Ch_sYKt7.js","./index-svtat3zr.js","./live-BIBBLA6F.js","./directive-helpers-C0aXnQdc.js","./keyed-CdPY5MOf.js","./ref-Ccn4I0kT.js","./static-g4FJ4v8I.js","./form-B15gmg4q.js","./interactive-B8siLByk.js","./key-CZcQa38B.js","./label-BLne9qNB.js","./loadable-DOQnSSjG.js","./locale-CXx8I9ox.js","./component-CFGnHAqh.js","./Validation-O1TFEQW-.js","./input-DI9tZAPS.js","./index-DbjTV4Hc.js","./index-cLdK6V3t.js","./filter-Cs9GmjDF.js","./escapeRegExp-UP7ghjt8.js","./debounce-DbkufipY.js","./utils-CYuC4O71.js","./index-d5Yy4krW.js","./index-Df8-0rWt.js","./floating-ui-BkLjHVN3.js","./openCloseComponent-dw_x67D_.js","./dynamicClasses-pKEMtFzB.js","./index-DVEy4f7w.js","./index-DIB7yhJF.js","./resources6-Cs2_VmEC.js","./index-BfAp5_ga.js","./customElement-kBYuBfHB.js","./resources5-SciNIBSe.js","./index-nrWOrFCt.js","./resources4-Crg87oFz.js"])))=>i.map(i=>d[i]);
import{_ as S}from"./index-tefRSezt.js";import{o as D,r as o,g as H,m as a,a as F,k as te,D as M,s as v,B as k,bA as $e,i as ne}from"./Accessor-BHnuXKD2.js";import{V as A,d as C,w as ie,P as he,p as Le,a as Ae,A as Ce,C as se}from"./reactiveUtils-BR0C1Kq4.js";import{c as q,r as fe,l as Fe,O as ke,k as Ee}from"./layerUtils-dJgsXxkC.js";import{n as f,v as ye,e as re,O as Me,c as Ve}from"./jsxFactory-CLjKarlq.js";import{i as ve}from"./Evented-DCWccWGU.js";import{h as ge}from"./UpdatingHandles-ptqz1ck8.js";import{d as Ue,s as Oe,K as oe}from"./cast-BA_-jlhc.js";import{m as xe,C as ae}from"./Portal-CTRRujjZ.js";import{p as Pe}from"./Promise-CmQqe-ke.js";import{s as De}from"./ReactiveMap-Dwhwbx9R.js";import{s as He}from"./utils-Cf-KB5Fk.js";import{X as Be,I as Re}from"./VersionManagementService-Cw_pm6KK.js";import{n as Ne}from"./Identifiable-BrT7zvUW.js";import{e as je}from"./globalCss-CZa70j6i.js";import{e as Ge}from"./Heading-DYbI16WN.js";import{b as ze}from"./Graphic-CFXUQZlS.js";import{e as le}from"./screenUtils-_ZIvrt5o.js";import{M as E}from"./opacityUtils-CSd4XoR2.js";import{L as qe}from"./symbolUtils-C5ImIHMe.js";import{e as Je}from"./vmEvent-D4Ubqkbq.js";const J={key:Symbol(),label:"Other​"};function be(e){return"templateInfos"in e}function Ke(e){const t=[];for(const{layer:n,templates:i}of e)for(const s of i)t.push({layer:n,template:s});return t}function We(e,t){const n=new Map;for(const i of e){const s=t(i),{key:r,label:d}=s.key!=null?s:J;D(n,r,()=>({label:d,templateInfos:[]})).templateInfos.push(i)}return Array.from(n.values())}function Qt(e,t){return{label:e.title??"",templateInfos:t.map(n=>({layer:e,template:n}))}}async function Xe(e,t){var n;return e.type==="subtype-sublayer"?await((n=e.parent)==null?void 0:n.load(t)):await e.load(t),e}function Qe(e){const t=new Map,n=[];for(const i of e)if(L(i)){n.push(i);for(const s of i.items)t.set(s.template,s)}else t.set(i.template,i);return[t,n]}const L=e=>"items"in e;function Ye(e){return e.type==="feature"}function Ze(e){return e.type==="group"}function et(e){return e.type==="preset"}let y=class extends H{constructor(t){super(t),this.layers=new A,this.lockType="none",this.tables=new A,this.versionInfo=null,this.versionService=null}get layersAndTables(){return new A([...this.layers.toArray(),...this.tables.toArray()])}updateLockType(){this.lockType=this.versionInfo?this.versionService.getLockType(this.versionInfo.versionIdentifier)??"none":"none"}get featureServiceVersion(){var t;return((t=this.featureService.sourceJSON)==null?void 0:t.currentVersion)??0}};o([a({constructOnly:!0})],y.prototype,"canCreateVersion",void 0),o([a({constructOnly:!0})],y.prototype,"canEditVersionedData",void 0),o([a({constructOnly:!0})],y.prototype,"featureService",void 0),o([a({constructOnly:!0})],y.prototype,"layers",void 0),o([a()],y.prototype,"layersAndTables",null),o([a()],y.prototype,"lockType",void 0),o([a({constructOnly:!0})],y.prototype,"tables",void 0),o([a()],y.prototype,"versionInfo",void 0),o([a({constructOnly:!0})],y.prototype,"versionService",void 0),o([a()],y.prototype,"hasAdvancedEditingUserTypeExtension",void 0),o([a()],y.prototype,"loggedInServiceUser",void 0),o([a()],y.prototype,"featureServiceVersion",null),y=o([F("esri.undoredo.support.ServiceVersionInfo")],y);function tt(e){return!e||e.trim().length===0}const de=new Map;function nt(e){return D(de,e,()=>{const t=new w({view:e});return e.addHandles({remove(){de.delete(e),t.destroy()}}),t.load().catch(n=>{k.getLogger("esri.views.Services").error("Failed to load service metadata",n)}),t})}let w=class extends xe.LoadableMixin(Pe.EsriPromiseMixin(ve.EventedAccessor)){constructor(t){super(t),this._updatingHandles=new ge,this.items=new A,this.tablesAndLayersLookup=new De,this.additionalLayers=new A,this._debouncedCheckAndUpdateServiceInfos=te(async()=>{var i;const n=[];for(const s of this.items){if(s.layersAndTables.length===0)continue;const r=s.layersAndTables.getItemAt(0);(r==null?void 0:r.gdbVersion)!==((i=s.versionInfo)==null?void 0:i.versionIdentifier.name)&&n.push(s)}n.length!==0&&(await ie(()=>!this.updating),await this._updateVersionInfos(n))}),this._debouncedLayersChanged=te(async()=>{const n=this._detectNewLayersAndTables();n.length!==0&&(await ie(()=>!this._updatingHandles.updating),await this._updatingHandles.addPromise((async()=>{const i=new Set;for(const s of n)if(s.type==="feature"||s.type==="subtype-group"){if(!s.url)continue;const r=Ue(s.url).url.path,d=this._findServiceInfo(r);if(d)this.tablesAndLayersLookup.set(s,d),s.isTable?d.tables.push(s):d.layers.push(s);else if(!i.has(r))try{await this._addServiceInfo(r,s)}catch(l){k.getLogger(this).error(`Failed to load feature service: ${r}`,l)}finally{i.add(r)}}})()))}),this._processed=new Set}destroy(){this._set("view",null),this.items.removeAll(),this.tablesAndLayersLookup.clear()}async load(t){return M(t),this.addHandles([C(()=>this._allLayersAndTables,()=>{this._debouncedLayersChanged().catch(n=>{k.getLogger(this).warn("Failed to update service info",n)})}),C(()=>this.items.map(n=>n.layersAndTables.map(i=>i.gdbVersion??"").join(",")),()=>{this.checkAndUpdateServiceInfos().catch(n=>{k.getLogger(this).warn("Failed to update service info",n)})})]),this.addResolvingPromise(this._debouncedLayersChanged()),this}get updating(){return this.loadStatus==="loading"||this._updatingHandles.updating}checkAndUpdateServiceInfos(){return this._debouncedCheckAndUpdateServiceInfos()}changeVersion(t,n,i){return this._updatingHandles.addPromise((async()=>{await this._changeVersionInternal(t,n,i)})())}createVersion(t){return this._updatingHandles.addPromise((async()=>{var c;const n=t.featureServerUrl,i=this._findServiceInfo(n);if(!(i!=null&&i.versionService))throw new v("services:no-version-management-service");const s=i.hasAdvancedEditingUserTypeExtension,r=i.loggedInServiceUser.toUpperCase(),d=tt(t.ownerName)?r:(c=t.ownerName)==null?void 0:c.trim().toUpperCase();if(d!==r){if(i.featureServiceVersion<=11.1)throw new v("services:versioning-api-error");if(!s)throw new v("services:no-advanced-editing-user-type-extension")}if((d==null?void 0:d.toUpperCase())==="SDE"&&t.versionName.toUpperCase()==="DEFAULT")throw new v("services:no-valid-version-name");{const m=await i.versionService.getVersionInfos();if(m!=null&&m.find(u=>u.versionIdentifier.name.toUpperCase()===(d+"."+t.versionName).toUpperCase()||u.versionIdentifier.name.toUpperCase()===(r+"."+t.versionName).toUpperCase()))throw new v("services:no-valid-version-name")}const l=await i.versionService.createVersion({versionName:t.versionName,access:d!==r?"public":t.access,description:t.description});if(d!==r){const{guid:m,name:u}=l.versionIdentifier;await i.versionService.alterVersion({guid:m,name:u},{ownerName:d,access:t.access})}t.switchToVersion&&await this._changeVersionInternal(n,l.versionIdentifier.name,l.versionIdentifier.guid),this.emit("version-created",{versionIdentifier:l.versionIdentifier,versionManagementService:i.versionService})})())}deleteVersion(t,n,i){return this._updatingHandles.addPromise((async()=>{const s=this._findServiceInfo(t);if(!(s!=null&&s.versionService))throw new v("services:no-version-management-service");if(s.featureServiceVersion<=11.1)throw new v("services:versioning-api-error");if(!s.hasAdvancedEditingUserTypeExtension)throw new v("services:no-advanced-editing-user-type-extension");const r={name:n,guid:i};await s.versionService.deleteVersion(r)&&(await this._updateVersionInfo(s),this.emit("version-deleted",{versionIdentifier:r,versionManagementService:s.versionService}))})())}startEditing(t){return this._updatingHandles.addPromise((async()=>{var r;const n=this._findServiceInfo(t);if(!(n!=null&&n.versionService))throw new v("services:no-version-management-service");if(!n.hasAdvancedEditingUserTypeExtension)throw new v("services:no-advanced-editing-user-type-extension");const i=((r=n.versionInfo)==null?void 0:r.versionIdentifier)??{name:n.versionService.defaultVersionIdentifier.name,guid:n.versionService.defaultVersionIdentifier.guid};let s=!0;(n.versionService.getLockType(i)!=="none"||(s=await n.versionService.startReading(i),s))&&(s=await n.versionService.startEditing(i),n.updateLockType())})())}finishEditing(t,n){return this._updatingHandles.addPromise((async()=>{var d;const i=this._findServiceInfo(t);if(!(i!=null&&i.versionService))throw new v("services:no-version-management-service");if(!i.hasAdvancedEditingUserTypeExtension)throw new v("services:no-advanced-editing-user-type-extension");const s=((d=i.versionInfo)==null?void 0:d.versionIdentifier)??{name:i.versionService.defaultVersionIdentifier.name,guid:i.versionService.defaultVersionIdentifier.guid},r=i.versionService.getLockType(s);if(r!=="none")return r==="read"?(await i.versionService.stopReading(s),void i.updateLockType()):r==="edit"?(await i.versionService.stopEditing(s,n),await i.versionService.stopReading(s),void i.updateLockType()):void 0})())}async _changeVersionInternal(t,n,i){var l,c;const s=this._findServiceInfo(t);if(!(s!=null&&s.versionService))throw new v("services:no-version-management-service");const r=((l=s.versionInfo)==null?void 0:l.versionIdentifier)??{name:s.versionService.defaultVersionIdentifier.name,guid:s.versionService.defaultVersionIdentifier.guid},d={name:n,guid:i};await s.versionService.changeVersion((c=this.view)==null?void 0:c.map,r,d)&&await this._updateVersionInfo(s)}async _updateVersionInfo(t){var r;const n=t.versionService;if(!n||t.layersAndTables.length===0)return;const i=(r=t.layersAndTables.getItemAt(0))==null?void 0:r.gdbVersion,s=i?await n.getVersionIdentifierFromName(i):n.defaultVersionIdentifier;t.versionInfo=await n.getVersionInfoExtended(s)}_findServiceInfo(t){return this.items.find(n=>n.featureService.url===t)??null}_removeFeatureService(t){this.items.remove(t)}async _findPortal(t){var r;const n=(r=Oe)==null?void 0:r.findServerInfo(t??"");if(!(n!=null&&n.owningSystemUrl))return null;const i=`${n.owningSystemUrl}/sharing/rest`,s=ae.getDefault();return s!=null&&s.loaded&&oe(s.restUrl)===oe(i)?s:new ae({authMode:"immediate",url:n.owningSystemUrl}).load()}_updateVersionInfos(t){return this._updatingHandles.addPromise((async()=>{for(const n of t)await this._updateVersionInfo(n).catch(i=>{k.getLogger(this).error("Failed to update version details",i)})})())}async _addServiceInfo(t,n){var I;const i=new Be({url:t});await i.load();const s=await this._findPortal(t),r=(I=s==null?void 0:s.user)==null?void 0:I.username;let d=!1;r&&(d=await He(s,r,"advediting"));let l=null;i.versionManagementServiceUrl&&(l=new Re({url:i.versionManagementServiceUrl}),await l.load());const c=n.isTable?[]:[n],m=n.isTable?[n]:[],u=new y({loggedInServiceUser:r??"",hasAdvancedEditingUserTypeExtension:d,versionInfo:null,lockType:"none",canEditVersionedData:!0,canCreateVersion:!0,featureService:i,versionService:l,layers:new A(c),tables:new A(m)});return l&&await this._updateVersionInfo(u),this.items.push(u),this.tablesAndLayersLookup.set(n,u),n.isTable?u.tables.push(n):u.layers.push(n),u}get _allLayersAndTables(){return[...this.view.map.allLayers,...this.view.map.allTables,...this.additionalLayers]}_detectNewLayersAndTables(){const t=new Set(this._allLayersAndTables),n=[];for(const i of t)i.type!=="feature"&&i.type!=="subtype-group"||this._processed.has(i)||n.push(i);for(const i of this._processed)if(!t.has(i)&&(q(i)||fe(i))){const s=this.tablesAndLayersLookup.get(i);if(!s)continue;this.tablesAndLayersLookup.delete(i),i.isTable?s.tables.remove(i):s.layers.remove(i),s.layersAndTables.length===0&&this._removeFeatureService(s)}return this._processed=t,n}};o([a({constructOnly:!0})],w.prototype,"view",void 0),o([a()],w.prototype,"items",void 0),o([a()],w.prototype,"tablesAndLayersLookup",void 0),o([a()],w.prototype,"additionalLayers",void 0),o([a()],w.prototype,"updating",null),o([a()],w.prototype,"_allLayersAndTables",null),w=o([F("esri.undoredo.support.Services")],w);const it=()=>k.getLogger("esri.editing.templateUtils");function st(e){return e!=null&&"prototype"in e}function Ie(e){return K(e)&&!("definition"in e)}function B(e){return K(e)&&"definition"in e}function K(e){return e!=null&&"templateId"in e}function en(e){return B(e)&&(e==null?void 0:e.type)==="feature"&&(e.definition==null||Ye(e.definition))}function tn(e){return B(e)&&(e==null?void 0:e.type)==="group"&&(e.definition==null||Ze(e.definition))}function nn(e){return B(e)&&(e==null?void 0:e.type)==="preset"&&(e.definition==null||et(e.definition))}function sn(e){return B(e)&&(e==null?void 0:e.definition)!=null}const ce=e=>e==null||typeof e!="object"?[]:[..."templates"in e&&Array.isArray(e.templates)?e.templates:[],..."types"in e&&Array.isArray(e.types)?e.types.flatMap(t=>t.templates):[]];async function rt(e,t,n){if(t==null)return e.map(l=>({layer:l,templates:ce(l)}));const i=await lt(e,t);M(n);const s=new Map,r=Array.from(i).map(l=>ot({serviceInfo:l,out:s,signal:n,view:t})),d=await Promise.allSettled(r);for(const l of d.filter(c=>c.status==="rejected"))it().warn("Failed to fetch shared templates for service. Will use standard templates if available.",l.reason);return e.map(l=>({layer:l,templates:s.get(l)??ce(l)}))}async function ot({serviceInfo:e,out:t,signal:n}){const{featureService:i,layersAndTables:s}=e,r=await at({featureService:i,layers:s.toArray(),signal:n});M(n);for(const[d,l]of r.entries())if(l.length!==0)if(q(d)){const c=ct(l),m=[],u=c.get(1/0)??m;for(const I of d.sublayers){const V=c.get(I.subtypeCode)??m;t.set(I,[...V,...u])}}else t.set(d,l)}async function at({featureService:e,layers:t,signal:n}){var d;if(!((d=e.capabilities)!=null&&d.editing.supportsSharedTemplates))return new Map;const i=new Map(t.map(l=>[l.layerId,l])),s=await e.querySharedTemplates({query:{layers:Array.from(i.keys())},requestOptions:{signal:n}}),r=new Map;for(const l of s)for(const c of l.layerIds)i.has(c)&&D(r,i.get(c),()=>[]).push(l);return r}async function lt(e,t){const n=await nt(t).load(),i=new Set;for(const s of e)$e(i,dt(n,s));return await Promise.all(Array.from(i).map(s=>s.featureService.load())),i}function dt(e,t){return Fe(t)&&t.parent?e.tablesAndLayersLookup.get(t.parent):fe(t)?e.tablesAndLayersLookup.get(t):null}function ct(e){const t=new Map;for(const n of e)D(t,n.subtypeCode??1/0,()=>[]).push(n);return t}var G;let b=G=class extends H{constructor(e){super(e),this._activeFetchInfo={id:null,request:null},this.disabledFunction=null,this.layer=null,this.template=null,this.thumbnail=null}initialize(){this.addHandles(C(()=>{const{layer:e}=this;return[e&&"renderer"in e?e.renderer:null,this.template]},()=>{this._activeFetchInfo.id=null,this._activeFetchInfo.request=null,this._set("thumbnail",null)},he))}get description(){var e;return(e=this.template)==null?void 0:e.description}set description(e){this.template&&(this.template.description=e)}get disabled(){var e;return((e=this.disabledFunction)==null?void 0:e.call(this,this))??!1}get label(){var e;return(e=this.template)==null?void 0:e.name}set label(e){this.template&&(this.template.name=e)}get id(){var e;return`${this.label??""}–${(e=this.layer)==null?void 0:e.id}`}get supportsUpload(){var e;return((e=this.layer)==null?void 0:e.type)==="scene"}clone(){const e=this.thumbnail!=null?this.thumbnail.cloneNode(!0):null,t=new G({layer:this.layer,template:this.template});return t._set("thumbnail",e),t}};o([a()],b.prototype,"description",null),o([a()],b.prototype,"disabled",null),o([a()],b.prototype,"disabledFunction",void 0),o([a()],b.prototype,"label",null),o([a()],b.prototype,"layer",void 0),o([a()],b.prototype,"template",void 0),o([a()],b.prototype,"thumbnail",void 0),o([a()],b.prototype,"id",null),o([a()],b.prototype,"supportsUpload",null),b=G=o([F("esri.widgets.FeatureTemplates.TemplateItem")],b);const ut=b;let T=class extends Ne.IdentifiableMixin(H){constructor(t){super(t),this.allItems=[],this.filterFunction=null,this.label=null}get items(){const{filterFunction:t}=this;return t==null||t(this)?this.allItems:this.allItems.filter(t)}get id(){return this.label}reapplyFilter(){this.notifyChange("filterFunction")}findByTemplate(t){return this.items.find(n=>n.template===t)}};o([a()],T.prototype,"allItems",void 0),o([a()],T.prototype,"filterFunction",void 0),o([a()],T.prototype,"items",null),o([a()],T.prototype,"label",void 0),o([a()],T.prototype,"id",null),T=o([F("esri.widgets.FeatureTemplates.TemplateItemGroup")],T);const pt=T,mt=({layer:e})=>({key:e,label:e.title??""}),ht=({layer:e})=>({key:e.geometryType,label:e.geometryType??""});let h=class extends ve.EventedAccessor{constructor(e){super(e),this._allItems=[],this._updatingHandles=new ge,this._updateTask=null,this.disabled=!1,this.disabledItemFunction=null,this.filterFunction=null,this.selectedItem=null,this.templateInfos=null,this.view=null}initialize(){this._get("groupBy")||(this.groupBy="layer"),this.addHandles([C(()=>[this.templateInfos,this.layers],([e],t)=>{e&&e===(t==null?void 0:t.at(0))||(this._updateTask=ne(this._updateTask),e?this._updateAllItems(e):this._getTemplatesAndUpdateAllItems())},Ce),C(()=>this._groupByFunction,()=>{this.templateInfos==null&&(this._updateTask=ne(this._updateTask),this._getTemplatesAndUpdateAllItems())},se),C(()=>this.filterFunction,e=>{for(const t of this._allItems)L(t)&&(t.filterFunction=e)},se)])}set groupBy(e){if(this._set("groupBy",e),typeof e!="function")switch(e){case"layer":this._groupByFunction=mt;break;case"geometry":this._groupByFunction=ht;break;default:this._groupByFunction=null}else this._groupByFunction=t=>this._ensureGroupByObject(e(t))}get layers(){return this._get("layers")}set layers(e){const t="layers";if(this.removeHandles(t),e){const n=()=>this.notifyChange("state");this.addHandles(e.map(i=>Le(()=>i.loadStatus,n)),t)}this._set("layers",e)}get state(){var e;return this.updating?"loading":this.layers.length!==0||(e=this.templateInfos)!=null&&e.length?"ready":"disabled"}get numberOfFeatureTemplates(){return this._allItems.reduce((e,t)=>L(t)?e+t.allItems.length:e+1,0)}get items(){const{filterFunction:e}=this;return e==null?this._allItems:this._allItems.filter(t=>L(t)?t.items.length>0:e(t))}get updating(){return this._updatingHandles.updating}refresh(){this.notifyChange("filterFunction");for(const e of this._allItems)L(e)&&e.reapplyFilter()}select(e,{emit:t=!0}={}){const n=this.selectedItem,i=(e==null?void 0:e.clone())||null;this._set("selectedItem",i),t&&this.emit("select",{item:i,oldItem:n,template:(i==null?void 0:i.template)??null})}_createItem(e,t){return new ut({disabledFunction:this.disabledItemFunction,layer:t,template:e})}_ensureGroupByObject(e){return typeof e=="string"?{key:e,label:e}:e}_updateAllItems(e){const t=this._allItems;if(e.length===0)return ft(t),void(this._allItems=[]);const[n,i]=Qe(t),s=l=>{const c=n.get(l.template);return c?(n.delete(l.template),c):this._createItem(l.template,l.layer)},{filterFunction:r}=this,d=e.filter(z).map(l=>be(l)?new pt({filterFunction:r,label:l.label,allItems:l.templateInfos.filter(z).map(c=>s(c))}):s(l));for(const l of[...n.values(),...i])l.destroy();this._allItems=d}async _getTemplatesFromLayers(e){const t=[],n={signal:e};await Promise.all(this.layers.map(async l=>{var m;await Xe(l,n),M(e);const c=(m=ke(l))==null?void 0:m.operations;c!=null&&c.supportsEditing&&(c!=null&&c.supportsAdd)&&(q(l)?t.push(...l.sublayers):t.push(l))}));const i=await rt(t,this.view,e);M(e);const s=Ke(i),r=this._groupByFunction;if(r==null)return s;const d=We(s,r);return d.length===1&&d[0].label===J.label?d[0].templateInfos:d}async _getTemplatesAndUpdateAllItems(){if(this.layers.length===0)return;const e=Ae(async t=>{const n=await this._getTemplatesFromLayers(t);M(t),this._updateAllItems(n)});this._updateTask=e,this._updatingHandles.addPromise(e.promise)}};function ft(e){for(const t of e){if(L(t))for(const n of t.items)n.destroy();t.destroy()}}function z(e){return be(e)?e.templateInfos.some(z):!K(e.template)||e.template.visible!==!1}o([a()],h.prototype,"_allItems",void 0),o([a()],h.prototype,"_groupByFunction",void 0),o([a()],h.prototype,"_updatingHandles",void 0),o([a()],h.prototype,"disabled",void 0),o([a()],h.prototype,"disabledItemFunction",void 0),o([a({value:null})],h.prototype,"filterFunction",void 0),o([a()],h.prototype,"groupBy",null),o([a({value:[]})],h.prototype,"layers",null),o([a()],h.prototype,"state",null),o([a({readOnly:!0})],h.prototype,"numberOfFeatureTemplates",null),o([a({readOnly:!0})],h.prototype,"items",null),o([a({readOnly:!0})],h.prototype,"selectedItem",void 0),o([a()],h.prototype,"templateInfos",void 0),o([a()],h.prototype,"updating",null),o([a()],h.prototype,"view",void 0),h=o([F("esri.widgets.FeatureTemplates.FeatureTemplatesViewModel")],h);const yt=h;let P=class extends H{constructor(e){super(e),this.filter=!0}};o([a({type:Boolean,nonNullable:!0})],P.prototype,"filter",void 0),P=o([F("esri.widgets.FeatureTemplates.VisibleElements")],P);const _e=P,$="esri-item-list",x=`${$}__list-item`,_={base:$,filterContainerSticky:`${$}__filter-container--sticky`,group:`${$}__group`,groupHeader:`${$}__group__header`,item:x,itemDisabled:`${x}--disabled`,itemIcon:`${x}-icon`,itemContentEnd:`${x}-content-end`,noMatchesMessage:`${$}__no-matches-message`,scroller:`${$}__scroller`,scrollerEnabled:`${$}__scroller--enabled`},vt=4;function gt(e){const{disabled:t,filterText:n="",id:i,messages:s,onFilterChange:r,...d}=e;return f("div",{key:i},e.filterEnabled??1?_t({disabled:t,filterText:n,id:i,messages:s,onFilterChange:r}):null,It({...d,disabled:t,enableListScroll:e.enableListScroll??!0,filterText:n,messages:s}))}function bt(e){return!!e.items}function It(e){const{headingLevel:t,items:n,...i}=e;return n.length===0?f("div",{class:_.noMatchesMessage,key:"no-matches"},e.messages.noMatches):f("div",{class:ye({[_.scroller]:!0,[_.scrollerEnabled]:!!e.enableListScroll}),key:"item-container"},n.map(s=>bt(s)?wt({...i,group:s,headingLevel:t}):we({...i,grouped:!0,item:s})))}function _t(e){const{disabled:t,messages:n,filterText:i,enableListScroll:s}=e;return f("div",{class:s?void 0:_.filterContainerSticky,key:"filter"},f("calcite-input",{disabled:t,placeholder:n.filterPlaceholder,type:"search",value:i,onCalciteInputInput:r=>{const d=r.currentTarget;e.onFilterChange&&e.onFilterChange(d.value)}}))}function we(e){const{disabled:t,grouped:n,identify:i,item:s,onItemMouseEnter:r,onItemMouseLeave:d,onItemSelect:l,renderIcon:c,renderCustomItem:m,renderItemContent:u,renderItemContentEnd:I,renderItemLabel:V,renderItemDescription:R,renderItemActionEnd:N,renderItemTitle:j,selectedItem:Se}=e,W=ue(s,i),X=W===ue(Se,i),Q=m==null?void 0:m(e);if(Q)return Q;const O=u==null?void 0:u(s),Y=I==null?void 0:I(s),Te=N==null?void 0:N(s),Z=!(!s.disabled&&!t),ee=c==null?void 0:c(s);return f("calcite-list-item",{afterUpdate:g=>{g.selected=X},"aria-level":n?"2":"",class:ye({[_.item]:!0,[_.itemDisabled]:Z}),"data-item":s,description:O?void 0:(R==null?void 0:R(s))??void 0,disabled:Z,key:W,label:O?void 0:(V==null?void 0:V(s))??s.label??void 0,onblur:g=>d==null?void 0:d(U(g)),onfocus:g=>r==null?void 0:r(U(g)),onmouseenter:g=>r==null?void 0:r(U(g)),onmouseleave:g=>d==null?void 0:d(U(g)),selected:X,title:(j==null?void 0:j(s))??void 0,onCalciteListItemSelect:g=>{g.preventDefault(),l==null||l(U(g))}},ee?f("div",{class:_.itemIcon,key:"content-start",slot:"content-start"},ee):void 0,O?f("div",{key:"content",slot:"content"},O):null,Y?f("div",{class:_.itemContentEnd,key:"content-end",slot:"content-end"},Y):null,Te??null)}function ue(e,t){return e?`${(t==null?void 0:t(e))||e.id}__${e.label}`:""}function U(e){return e.currentTarget["data-item"]}function wt(e){const{disabled:t,group:n,headingLevel:i=vt,selectionMode:s="none",renderCustomGroupContent:r,...d}=e,l=r==null?void 0:r(e);return f("div",{class:_.group,key:n.label??void 0},f(Ge,{class:_.groupHeader,level:i},n.label),l||f("calcite-list",{disabled:t,label:n.label??"",selectionAppearance:"border",selectionMode:s},n.items.map(c=>we({...d,disabled:t,item:c,grouped:!0}))))}async function St(e,t,n){var r;if(!E(e)&&Ie(e)&&e.thumbnail){const d=`data:image/png;base64,${e.thumbnail.imageData}`,l=document.createElement("div");return l.classList.add("esri-thumbnail-preview"),"geometryType"in t&&t.geometryType&&l.classList.add(`esri-thumbnail-preview--${t.geometryType}`),l.style.backgroundImage=`url(${d})`,l}const i=await Tt(t,e);if(i==null)return null;const s={maxSize:le(32)};if((E(e)||st(e))&&"renderer"in t&&((r=t.renderer)==null?void 0:r.type)==="dictionary"&&(s.fieldMap=t.renderer.fieldMap??void 0,s.feature=E(e)?e:{attributes:e.prototype.attributes??{}}),E(e)&&e.geometry&&(n==null?void 0:n.useGeometry)!==!1&&!e.geometry.type.includes("point")){s.geometry=e.geometry,s.useMarkerSymbolSize=!1;const d=le(22);s.size={width:d,height:d}}return await qe(i,s)}async function Tt(e,t){if(!E(t)&&Ie(t))return pe(e);if("renderer"in e&&e.renderer){const{renderer:n}=e,i=E(t)?t:new ze({attributes:t.prototype.attributes});if("getSymbolAsync"in n){const s=await n.getSymbolAsync(i);if(s)return s}}return pe(e)}async function pe(e){if(!("geometryType"in e))return null;const{geometryType:t}=e,n=t==="point"||t==="multipoint"?await S(()=>import("./TextSymbol-BQ_NW9Xo.js").then(i=>i.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url):t==="polyline"?await S(()=>import("./TextSymbol-BQ_NW9Xo.js").then(i=>i.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url):t==="polygon"||t==="mesh"||t==="multipatch"?await S(()=>import("./TextSymbol-BQ_NW9Xo.js").then(i=>i.j),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url):null;return n?new n.default:null}const $t={base:"esri-feature-templates"};function Lt(e){return e.length>0&&L(e[0])}function At(e){return e.id}let p=class extends Me{constructor(e,t){super(e,t),this.enableListScroll=!0,this.filterText="",this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.selectionMode="none",this.viewModel=new yt,this.visibleElements=new _e,this.renderCustomItem=n=>null,this.renderCustomGroupContent=n=>null,this.renderItemLabel=()=>null,this.renderItemDescription=()=>null,this.renderItemContent=n=>null,this.renderItemContentEnd=n=>null,this._iconIntersectionObserver=new IntersectionObserver((n,i)=>{n.forEach(async s=>{if(s.isIntersecting){const r=s.target;if(Ft(r))return void i.unobserve(r);const d=Ct(r),{layer:l,template:c}=d;me(r,!0);const m=await St(c,l).catch(()=>(me(r,!1),null));if(m==null)return;r.appendChild(m)}})}),this._renderItemIcon=n=>Ee(n.layer)?f("span",{"data-has-icon":!0,"data-item":n,key:"icon"},f("calcite-icon",{icon:"table"})):f("span",{afterCreate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,afterUpdate:this._afterItemCreateOrUpdate,"data-has-icon":!1,"data-item":n,key:"icon"}),this._afterItemCreateOrUpdate=n=>{var i;(i=this._iconIntersectionObserver)==null||i.observe(n)},this._afterItemRemoved=n=>{var i;(i=this._iconIntersectionObserver)==null||i.unobserve(n)}}initialize(){const e=({label:t})=>!this.filterText||!!(t!=null&&t.toLowerCase().includes(this.filterText.toLowerCase()));this.addHandles(C(()=>this.viewModel,(t,n)=>{t&&!t.filterFunction&&(this.filterFunction=e),n&&n!==t&&n.filterFunction===e&&(n.filterFunction=null)},he))}destroy(){var e;(e=this._iconIntersectionObserver)==null||e.disconnect(),this._iconIntersectionObserver=null}loadDependencies(){return Ve({icon:()=>S(()=>import("./index-73bQemcW.js").then(e=>e.i),__vite__mapDeps([12,13,1,14,15,5,6,7,8,16,17,18,19,20,21,22]),import.meta.url),loader:()=>S(()=>import("./index-CjrYEQXz.js"),__vite__mapDeps([23,13,1,14,15,5,6,7,8,16,17,18,19,21,24]),import.meta.url),input:()=>S(()=>import("./index-Wn4pOF_U.js"),__vite__mapDeps([25,12,13,1,14,15,5,6,7,8,16,17,18,19,20,21,22,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,24,41]),import.meta.url),list:()=>S(()=>import("./index-DbjTV4Hc.js"),__vite__mapDeps([42,23,13,1,14,15,5,6,7,8,16,17,18,19,21,24,43,31,29,22,20,30,12,26,27,25,28,32,33,34,35,36,37,38,39,40,41,44,45,46,47]),import.meta.url),"list-item":()=>S(()=>import("./index-d5Yy4krW.js"),__vite__mapDeps([48,12,13,1,14,15,5,6,7,8,16,17,18,19,20,21,22,49,31,29,50,46,34,35,37,51,52,23,24,53,30,39,54,55,56,57,47,58]),import.meta.url),notice:()=>S(()=>import("./index-nrWOrFCt.js"),__vite__mapDeps([59,12,13,1,14,15,5,6,7,8,16,17,18,19,20,21,22,31,29,37,60,51,39,24]),import.meta.url)})}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get filterFunction(){return this.viewModel.filterFunction}set filterFunction(e){this.viewModel.filterFunction=e}get groupBy(){return this.viewModel.groupBy}set groupBy(e){this.viewModel.groupBy=e}get icon(){return"list-rectangle"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get layers(){return this.viewModel.layers}set layers(e){this.viewModel.layers=e}get selectedItem(){return this.viewModel.selectedItem}select(e,t){return this.viewModel.select(e,t)}render(){const{disabled:e,enableListScroll:t,filterText:n,headingLevel:i,messages:s,viewModel:{items:r,numberOfFeatureTemplates:d,selectedItem:l,state:c}}=this,m=this.visibleElements.filter&&d>1;if(Lt(r)){const u=r.find(I=>I.label===J.label);u&&(u.label=s.other)}return f("div",{"aria-label":s.widgetLabel,class:this.classes($t.base,je.widget)},c==="loading"?f("calcite-loader",{key:"loader",label:this.messagesCommon.loading,type:"indeterminate"}):c==="ready"?f(gt,{disabled:e,enableListScroll:t,filterEnabled:m,filterText:n,headingLevel:i,id:this.id,identify:At,items:r,messages:{filterPlaceholder:s.filterPlaceholder,noItems:s.noItems,noMatches:s.noMatches},renderCustomGroupContent:this.renderCustomGroupContent,renderCustomItem:this.renderCustomItem,renderIcon:this._renderItemIcon,renderItemContent:this.renderItemContent,renderItemContentEnd:this.renderItemContentEnd,renderItemDescription:this.renderItemDescription,renderItemLabel:this.renderItemLabel,selectedItem:l??void 0,selectionMode:this.selectionMode??void 0,onFilterChange:u=>{this.filterText=u},onItemSelect:u=>!L(u)&&this.viewModel.select(u)}):null)}};function Ct(e){return e==null?void 0:e["data-item"]}function Ft(e){return!!(e!=null&&e["data-has-icon"])}function me(e,t){e&&(e["data-has-icon"]=t)}o([a()],p.prototype,"disabled",null),o([a()],p.prototype,"enableListScroll",void 0),o([a()],p.prototype,"filterFunction",null),o([a()],p.prototype,"filterText",void 0),o([a()],p.prototype,"groupBy",null),o([a()],p.prototype,"headingLevel",void 0),o([a()],p.prototype,"icon",null),o([a()],p.prototype,"label",null),o([a()],p.prototype,"layers",null),o([a(),re("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],p.prototype,"messages",void 0),o([a(),re("esri/t9n/common")],p.prototype,"messagesCommon",void 0),o([a({readOnly:!0})],p.prototype,"selectedItem",null),o([a()],p.prototype,"selectionMode",void 0),o([a(),Je("select")],p.prototype,"viewModel",void 0),o([a({type:_e,nonNullable:!0})],p.prototype,"visibleElements",void 0),o([a()],p.prototype,"renderCustomItem",void 0),o([a()],p.prototype,"renderCustomGroupContent",void 0),o([a()],p.prototype,"renderItemLabel",void 0),o([a()],p.prototype,"renderItemDescription",void 0),o([a()],p.prototype,"renderItemContent",void 0),o([a()],p.prototype,"renderItemContentEnd",void 0),p=o([F("esri.widgets.FeatureTemplates")],p);const on=p;export{nn as A,on as F,yt as H,nt as T,St as a,rt as b,st as c,K as d,en as g,Qt as l,we as m,gt as s,Ye as t,sn as v,tn as w,B as y};
