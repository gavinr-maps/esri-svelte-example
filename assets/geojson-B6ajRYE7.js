import{t as N}from"./date-M6n_RqpC.js";import{c as P}from"./subclass-BR3PhgZG.js";import{a3 as C}from"./Point-TlcsOcXV.js";import{e as E}from"./OptimizedFeature-7juV2tZm.js";import{e as x}from"./OptimizedGeometry-vU5jWBvU.js";import{c as G,p as D}from"./fieldUtils-C5R42-PY.js";const J={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function b(t){return J[t]}function*M(t){switch(t.type){case"Feature":yield t;break;case"FeatureCollection":for(const o of t.features)o&&(yield o)}}function*R(t){if(t)switch(t.type){case"Point":yield t.coordinates;break;case"LineString":case"MultiPoint":yield*t.coordinates;break;case"MultiLineString":case"Polygon":for(const o of t.coordinates)yield*o;break;case"MultiPolygon":for(const o of t.coordinates)for(const n of o)yield*n}}function*v(t,o={}){const{geometryType:n,objectIdField:e}=o;for(const r of t){const{geometry:s,properties:y,id:i}=r;if(s&&b(s.type)!==n)continue;const l=y||{};let c;e&&(c=l[e],i==null||c||(l[e]=c=i)),yield new E(s?q(new x,s,o):null,l,null,c??void 0)}}function A(t){for(const o of t)if(o.length>2)return!0;return!1}function Z(t){return!T(t)}function H(t){return T(t)}function T(t){let o=0;for(let n=0;n<t.length;n++){const e=t[n],r=t[(n+1)%t.length];o+=e[0]*r[1]-r[0]*e[1]}return o<=0}function L(t){const o=t[0],n=t[t.length-1];return o[0]===n[0]&&o[1]===n[1]&&o[2]===n[2]||t.push(o),t}function q(t,o,n){switch(o.type){case"LineString":return z(t,o,n);case"MultiLineString":return B(t,o,n);case"MultiPoint":return K(t,o,n);case"MultiPolygon":return Q(t,o,n);case"Point":return U(t,o,n);case"Polygon":return V(t,o,n)}}function z(t,o,n){return g(t,o.coordinates,n),t}function B(t,o,n){for(const e of o.coordinates)g(t,e,n);return t}function K(t,o,n){return g(t,o.coordinates,n),t}function Q(t,o,n){for(const e of o.coordinates){O(t,e[0],n);for(let r=1;r<e.length;r++)$(t,e[r],n)}return t}function U(t,o,n){return S(t,o.coordinates,n),t}function V(t,o,n){const e=o.coordinates;O(t,e[0],n);for(let r=1;r<e.length;r++)$(t,e[r],n);return t}function O(t,o,n){const e=L(o);Z(e)?I(t,e,n):g(t,e,n)}function $(t,o,n){const e=L(o);H(e)?I(t,e,n):g(t,e,n)}function g(t,o,n){for(const e of o)S(t,e,n);t.lengths.push(o.length)}function I(t,o,n){for(let e=o.length-1;e>=0;e--)S(t,o[e],n);t.lengths.push(o.length)}function S(t,o,n){const[e,r,s]=o;t.coords.push(e,r),n.hasZ&&t.coords.push(s||0)}function W(t){switch(typeof t){case"string":return N(t)?"esriFieldTypeDate":"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function et(t,o=4326){if(!t)throw new P("geojson-layer:empty","GeoJSON data is empty");if(t.type!=="Feature"&&t.type!=="FeatureCollection")throw new P("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:t});const{crs:n}=t;if(!n)return;const e=typeof n=="string"?n:n.type==="name"?n.properties.name:n.type==="EPSG"?n.properties.code:null,r=C({wkid:o})?new RegExp(".*(CRS84H?|4326)$","i"):new RegExp(`.*(${o})$`,"i");if(!e||!r.test(e))throw new P("geojson:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:n})}function rt(t,o={}){const n=[],e=new Set,r=new Set;let s,y=!1,i=null,l=!1,{geometryType:c=null}=o,h=!1;for(const d of M(t)){const{geometry:m,properties:u,id:a}=d;if((!m||(c||(c=b(m.type)),b(m.type)===c))&&(y||(y=A(R(m))),l||(l=a!=null,l&&(s=typeof a,u&&(i=Object.keys(u).filter(p=>u[p]===a)))),u&&i&&l&&a!=null&&(i.length>1?i=i.filter(p=>u[p]===a):i.length===1&&(i=u[i[0]]===a?i:[])),!h&&u)){let p=!0;for(const f in u){if(e.has(f))continue;const F=u[f];if(F==null){p=!1,r.add(f);continue}const j=W(F);if(j==="unknown"){r.add(f);continue}r.delete(f),e.add(f);const k=G(f);k&&n.push({name:k,alias:f,type:j})}h=p}}const w=G((i==null?void 0:i.length)===1&&i[0]||null)??void 0;if(w){for(const d of n)if(d.name===w&&D(d)){d.type="esriFieldTypeOID";break}}return{fields:n,geometryType:c,hasZ:y,objectIdFieldName:w,objectIdFieldType:s,unknownFields:Array.from(r)}}function it(t,o){return Array.from(v(M(t),o))}export{et as E,rt as I,it as N,b as u};
