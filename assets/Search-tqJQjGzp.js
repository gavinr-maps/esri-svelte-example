const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-k0QevbF9.js","./index-73bQemcW.js","./jsxFactory-CLjKarlq.js","./Accessor-BHnuXKD2.js","./intl-Do3GEEJ7.js","./Promise-CmQqe-ke.js","./cast-BA_-jlhc.js","./index-tefRSezt.js","./index-Cx51aysm.css","./JSONSupport-CGdeqxpk.js","./Evented-DCWccWGU.js","./reactiveUtils-BR0C1Kq4.js","./SimpleObservable-7oieNGD8.js","./uuid-Cl5lrJ4c.js","./dom--xxYYVQF.js","./guid-ejniuQmw.js","./observers-BdozwIHb.js","./index-Ch_sYKt7.js","./index-svtat3zr.js","./index-Wn4pOF_U.js","./live-BIBBLA6F.js","./directive-helpers-C0aXnQdc.js","./keyed-CdPY5MOf.js","./ref-Ccn4I0kT.js","./static-g4FJ4v8I.js","./form-B15gmg4q.js","./interactive-B8siLByk.js","./key-CZcQa38B.js","./label-BLne9qNB.js","./loadable-DOQnSSjG.js","./locale-CXx8I9ox.js","./component-CFGnHAqh.js","./Validation-O1TFEQW-.js","./useT9n-CJAswmP1.js","./input-DI9tZAPS.js","./repeat-Cgn4lGS8.js","./floating-ui-BkLjHVN3.js","./debounce-DbkufipY.js","./openCloseComponent-dw_x67D_.js","./escapeRegExp-UP7ghjt8.js","./index-BM9O7MVS.js","./index-ChHsT86y.js","./text-CbTMlb2o.js","./index-BtF7Kdcs.js","./index-CjrYEQXz.js","./index-Df8-0rWt.js","./dynamicClasses-pKEMtFzB.js","./index-BfAp5_ga.js","./resources6-Cs2_VmEC.js","./index-DIB7yhJF.js","./index-nrWOrFCt.js","./resources4-Crg87oFz.js"])))=>i.map(i=>d[i]);
import{_ as K}from"./index-tefRSezt.js";import{r as o,m as i,a as D,s as E,M as Be,B as j,P as me,c as oe,L as xe,g as vt,Z as le,O as _t,G as ge,ag as wt,N as St,bO as xt,j as bt,b1 as Rt,E as $t,i as Oe}from"./Accessor-BHnuXKD2.js";import{f as Mt}from"./intl-Do3GEEJ7.js";import{V as Ct,d as ne,w as je,P as ye}from"./reactiveUtils-BR0C1Kq4.js";import{e as fe,O as ze,n as v,c as Ft}from"./jsxFactory-CLjKarlq.js";import{P as be,n as Tt}from"./cast-BA_-jlhc.js";import{q as ce,b as ve,f as Et}from"./Graphic-CFXUQZlS.js";import{i as Lt}from"./Evented-DCWccWGU.js";import{Q as It,j as Y,g as he}from"./Point-XGrwlf63.js";import{c as Re,a as _e,n as De,r as At}from"./geometryUtils-3VSSujWc.js";import{E as Nt,h as Ot}from"./Promise-CmQqe-ke.js";import{C as qe}from"./Portal-CTRRujjZ.js";import{d as jt,S as Dt,m as kt}from"./TextSymbol-BQ_NW9Xo.js";import{n as Pt}from"./layerViewUtils-tkZ5z_iY.js";import{n as Gt}from"./Identifiable-BrT7zvUW.js";import{S as ee}from"./JSONSupport-CGdeqxpk.js";import{j as Ze}from"./Polyline-BmuD2-ZN.js";import{p as Vt}from"./FullTextSearch-BWm_kPUE.js";import{s as He}from"./substitute-D1XJWgT5.js";import{f as $e,s as Me,i as Ce}from"./utils-Cy8wFNQo.js";import{w as Fe}from"./Extent-CBBGeHb-.js";import{t as Te}from"./commonProperties-DHiB1uzW.js";import{g as ke,p as Kt,f as Bt}from"./geolocationUtils-IqcQdGRn.js";import{t as zt}from"./GoTo-BsXOAO95.js";import{e as ae}from"./globalCss-CZa70j6i.js";import{t as Pe}from"./accessibleHandler-rIBXQ52V.js";import{e as qt}from"./vmEvent-D4Ubqkbq.js";const se="esri-search",H={base:se,autocomplete:`${se}__autocomplete`,dropdown:`${se}__dropdown`,container:`${se}__container`,form:`${se}__form`},q="esri-search-result-renderer",Z={base:q,showMoreResults:`${q}__more-results--show-more-results`,moreResults:`${q}__more-results`,moreResultsList:`${q}__more-results-list`,moreResultsHeader:`${q}__more-results-header`,moreResultsItem:`${q}__more-results-item`,moreResultsListHeader:`${q}__more-results-list-header`};let x=class extends Gt.IdentifiableMixin(ee){constructor(e){super(e),this.autoNavigate=null,this.filter=null,this.getResults=null,this.getSuggestions=null,this.maxResults=null,this.maxSuggestions=null,this.minSuggestCharacters=null,this.outFields=null,this.placeholder="",this.popupEnabled=null,this.popupTemplate=null,this.prefix="",this.resultGraphicEnabled=null,this.resultSymbol=null,this.suggestionsEnabled=null,this.suffix="",this.withinViewEnabled=!1,this.zoomScale=null}};o([i()],x.prototype,"autoNavigate",void 0),o([i()],x.prototype,"filter",void 0),o([i()],x.prototype,"getResults",void 0),o([i()],x.prototype,"getSuggestions",void 0),o([i()],x.prototype,"maxResults",void 0),o([i()],x.prototype,"maxSuggestions",void 0),o([i()],x.prototype,"minSuggestCharacters",void 0),o([i()],x.prototype,"outFields",void 0),o([i()],x.prototype,"placeholder",void 0),o([i()],x.prototype,"popupEnabled",void 0),o([i({type:ce})],x.prototype,"popupTemplate",void 0),o([i()],x.prototype,"prefix",void 0),o([i()],x.prototype,"resultGraphicEnabled",void 0),o([i()],x.prototype,"resultSymbol",void 0),o([i()],x.prototype,"suggestionsEnabled",void 0),o([i()],x.prototype,"suffix",void 0),o([i()],x.prototype,"withinViewEnabled",void 0),o([i()],x.prototype,"zoomScale",void 0),x=o([D("esri.widgets.Search.SearchSource")],x);const Ee=x,Zt=/https?:\/\/services.*\.arcgis\.com/i,Ht=/(?:\{([^}]+)\})/g,X=()=>j.getLogger("esri.widgets.Search.support.layerSearchUtils");function Jt(e,t){const{exactMatch:s=!1,location:r,maxResults:l,spatialReference:n,source:a,sourceIndex:u,suggestResult:c,view:d}=e,{layer:h,filter:_,zoomScale:y}=a,f=d==null?void 0:d.scale,m=Je(a,d),w=t==null?void 0:t.signal;return Ue(h).then(()=>{const b=h.popupTemplate;return b?b.getRequiredFields(h.fieldsIndex):null}).then(b=>{var ie,Ie,Ae,Ne;const{objectIdField:L,returnZ:F}=h,k=st(a);if(!Le(h,k))throw X().error("invalid-field: displayField is invalid."),new E("getResults():invalid-field","displayField is invalid.");const R=b!=null&&b.length?b:[k],T=a.outFields||R,I=Qe(T);if(T.includes(L)||I||T.push(L),(ie=h.floorInfo)!=null&&ie.floorField&&T.push(h.floorInfo.floorField),!(I||de(h,T)))throw X().error("invalid-field: outField is invalid."),new E("getResults():invalid-field","outField is invalid.");const S=h.createQuery(),{orderByFields:P}=a;if(P&&(S.orderByFields=P),n){S.outSpatialReference=n;const G=1/It(n);G&&(S.maxAllowableOffset=G)}const A=h.geometryType==="mesh"||h.geometryType==="multipatch",te=((Ae=(Ie=h.capabilities)==null?void 0:Ie.data)==null?void 0:Ae.supportsZ)&&!A;if(S.returnZ=te&&F!==!1,S.returnGeometry=!0,S.multipatchOption=A?"xyFootprint":null,T&&(S.outFields=T),r)S.geometry=r;else if(c.key)S.objectIds=[c.key];else{const G=a.searchFields||[k];if(!de(h,G))throw X().error("invalid-field: search field is invalid."),new E("getResults():invalid-field","search field is invalid.");if(tt(h)&&(S.num=l),m&&(S.geometry=m),!((Ne=c.text)==null?void 0:Ne.trim()))return[];const pe=c.text,{prefix:gt="",suffix:mt=""}=a,yt=rt(`${gt}${pe}${mt}`);et(h)&&Xe(h,G)&&!s&&pe&&(S.fullText=Ye({text:pe,searchFields:G}));const ft=ot({searchTerm:yt,layer:h,searchFields:G,filter:_,exactMatch:s,query:S,type:"search"});if(S.where=ft,!We(S))return[]}return h.queryFeatures(S,{signal:w}).then(G=>ns(G,d,a,u,k,f,y))})}function Qt(e,t){const{source:s,spatialReference:r,view:l,suggestTerm:n,maxSuggestions:a,sourceIndex:u,exactMatch:c}=e,{layer:d,filter:h}=s,_=t==null?void 0:t.signal,y=Je(s,l);return Ue(d).then(()=>{if(!tt(d))return[];const f=st(s),m=s.searchFields||[f],w=[];s.suggestionTemplate?s.suggestionTemplate.replaceAll(Ht,(te,ie)=>(w.push(ie),te)):w.push(f);const b=Qe(w);w.includes(d.objectIdField)||b||w.push(d.objectIdField);const L=Le(d,f),F=b||de(d,w),k=de(d,m);if(!L)throw X().error("invalid-field: displayField is invalid."),new E("getSuggestions():invalid-field","displayField is invalid.");if(!F)throw X().error("invalid-field: outField is invalid."),new E("getSuggestions():invalid-field","outField is invalid.");if(!k)throw X().error("invalid-field: search field is invalid."),new E("getSuggestions():invalid-field","search field is invalid.");const R=d.createQuery(),{orderByFields:T}=s;if(T&&(R.orderByFields=T),R.outSpatialReference=r,R.returnGeometry=!1,R.num=a,R.outFields=w,y&&(R.geometry=y),!n.trim())return[];const{prefix:I="",suffix:S=""}=s,P=rt(`${I}${n}${S}`);et(d)&&Xe(d,m)&&!c&&n&&(R.fullText=Ye({text:n,searchFields:m}));const A=ot({searchTerm:P,layer:d,searchFields:m,filter:h,exactMatch:c,query:R,type:"suggest"});return R.where=A,We(R)?d.queryFeatures(R,{signal:_}).then(te=>os(te,s,u,f)):[]})}function Je(e,t){const{filter:s,withinViewEnabled:r}=e,l=t==null?void 0:t.extent;return(s==null?void 0:s.geometry)??(r&&l?l:void 0)}function Qe(e){return e&&e.includes("*")}async function Ue(e){e&&await e.load()}function We(e){return!(!e.fullText&&!e.where)}function Xe(e,t){const s=e==null?void 0:e.indexes;return!s||!(t!=null&&t.length)?!1:s.filter(r=>r.indexType==="FullText").some(r=>{var n;const l=((n=r.fields)==null?void 0:n.split(",").map(a=>a.trim().toLowerCase()))||[];return t.every(a=>l.includes(a.toLowerCase()))})}function Ye({text:e,searchFields:t}){return e.trim().split(" ").filter(s=>!!s.trim()).map(s=>new Vt({onFields:t,searchTerm:s,searchType:"prefix"}))}function et(e){var t,s;return((s=(t=e==null?void 0:e.capabilities)==null?void 0:t.query)==null?void 0:s.supportsFullTextSearch)??!1}function tt(e){var t,s;return((s=(t=e==null?void 0:e.capabilities)==null?void 0:t.query)==null?void 0:s.supportsPagination)??!1}function Ut(e){var t,s,r;return((r=(s=(t=e==null?void 0:e.fieldsIndex)==null?void 0:t.fields)==null?void 0:s.find(l=>l.type==="string"))==null?void 0:r.name)??""}function st(e){return e.displayField||e.layer.displayField||Ut(e.layer)}function de(e,t){return!(!e||!(t!=null&&t.length))&&t.every(s=>Le(e,s))}function Le(e,t){return!!e.getField(t)}function Wt(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}function Xt({codedValues:e},t,s){return me(e??[],r=>{const l=r.name,n=s?l:l.toLowerCase();return(s?t:t.toLowerCase())===n?r.code.toString():null})??null}function rt(e){return e.replaceAll("'","''")}function re(e,t){const s=t==null?void 0:t.where;return s?`(${e}) AND (${s})`:e}function Yt({currentTerm:e,field:t,filter:s,exactMatch:r,url:l,type:n}){const a=t==null?void 0:t.type,u=t==null?void 0:t.name;if(a==="string"||a==="date"||a==="global-id"){const c=Zt.test(l??""),d=c&&Wt(e)?"N":"";return re(r&&n==="search"?`${u} = ${d}'${e}'`:c?`${u} LIKE ${d}${`'${e}%'`}`:`${`LOWER(${u})`} LIKE ${d}${`'${e.toLowerCase()}%'`}`,s)}if(a==="oid"||a==="small-integer"||a==="integer"||a==="single"||a==="double"){const c=Number(e);return isNaN(c)?null:re(`${u} = ${c}`,s)}return re(`${u} = ${e}`,s)}function es(e,t){return e?` OR (${t})`:`(${t})`}function ot({searchTerm:e,layer:t,searchFields:s,filter:r,exactMatch:l,query:n,type:a}){const{definitionExpression:u,url:c}=t;let d="";return!n.fullText&&e&&s&&s.forEach(h=>{var m;const _=t.getField(h),y=(m=t.getFieldDomain)==null?void 0:m.call(t,h,{excludeImpliedDomains:Be("esri-widget-legacy-field-domain-calculation")}),f=(y&&y.type==="coded-value"?Xt(y,e,l):null)||e||null;if(f!==null){const w=Yt({currentTerm:f,field:_,filter:r,exactMatch:l,url:c,type:a});w&&(d+=es(d,w))}}),u&&d?`(${u}) AND (${d})`:u||d}function ts(e,t){let s=null;const{codedValues:r}=e;return r&&r.length&&r.some(l=>l.code===t&&(s=l.name,!0)),s}function ss(e,t){return e[t]??e[Object.keys(e).find(s=>s.toLowerCase()===t.toLowerCase())]}function it(e,t,s){var a;const r=e.sourceLayer,{attributes:l}=e,n=(a=r.getFieldDomain)==null?void 0:a.call(r,s,{feature:e,excludeImpliedDomains:Be("esri-widget-legacy-field-domain-calculation")});if(t)return He(t,l);if(s&&l){const u=r.getField(s),c=ss(l,s);return c==null?"":n&&n.type==="coded-value"?ts(n,c)??"":(u==null?void 0:u.type)==="date"?Nt(new Date(c)):typeof c=="number"?c.toString():typeof c!="string"?"":c.trim()}return""}function rs(e,t,s,r){const l=e.sourceLayer,{attributes:n}=e,{objectIdField:a}=l,u=a?n[a]:null;return{text:it(e,t.suggestionTemplate,r),key:u,sourceIndex:s}}function os(e,t,s,r){return e.features.map(l=>rs(l,t,s,r))}function is(e){return e!=null&&e.minScale!=null&&e.maxScale!=null}function ls(e,t,s,r,l,n,a){const u=e.clone(),c=e.sourceLayer,d=c==null?void 0:c.objectIdField,h=d?e.attributes[d]:null,_=it(e,s.searchTemplate,l);n!=null&&is(c)&&(c.minScale&&c.minScale<n?n=c.minScale:c.maxScale&&c.maxScale>n&&(n=c.maxScale));const y=u.geometry?Re(u.geometry,t??void 0,n??void 0):void 0,f=typeof a=="number"&&y?_e(oe(y),t??void 0,a):y,m=e.clone();return f!=null&&(m.geometry=Ze.fromExtent(f)),{extent:f,target:m,feature:u,key:h,name:_,sourceIndex:r}}function ns(e,t,s,r,l,n,a){return e.features.map(u=>ls(u,t,s,r,l,n,a))}var we;let O=we=class extends Ee{constructor(e){super(e),this.displayField=null,this.exactMatch=null,this.orderByFields=null,this.searchFields=null,this.searchTemplate=null,this.suggestionTemplate=null,this.getResults=(t,s)=>Jt({source:this,...t},s),this.getSuggestions=(t,s)=>Qt({source:this,...t},s)}set layer(e){this._set("layer",e),e&&e.load().catch(()=>{})}get name(){return this._getLayerTitle()??""}set name(e){this._overrideIfSome("name",e)}clone(){return new we({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?oe(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?oe(this.searchFields):null,suggestionTemplate:this.suggestionTemplate,zoomScale:this.zoomScale})}_getFirstStringField(){var e,t;return((t=(e=this.layer.fieldsIndex)==null?void 0:e.fields.find(s=>s.type==="string"))==null?void 0:t.name)??""}_getDisplayField(){return this.displayField||this.layer.displayField||this._getFirstStringField()}_getSearchFieldsString(){const{layer:e,searchFields:t}=this;return e.loaded?`: ${(t||[this._getDisplayField()]).map(s=>{const r=e.getField(s);return(r==null?void 0:r.alias)||s}).join(", ")}`:""}_getLayerTitle(){const{layer:e}=this;if(!e)return;const{title:t}=e;return t?`${t}${this._getSearchFieldsString()}`:void 0}};o([i({json:{read:{source:"field.name"},write:{target:"field.name"}}})],O.prototype,"displayField",void 0),o([i({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],O.prototype,"exactMatch",void 0),o([i({value:null})],O.prototype,"layer",null),o([i()],O.prototype,"name",null),o([i({type:[String],json:{write:!0}})],O.prototype,"orderByFields",void 0),o([i()],O.prototype,"searchFields",void 0),o([i()],O.prototype,"searchTemplate",void 0),o([i()],O.prototype,"suggestionTemplate",void 0),O=we=o([D("esri.widgets.Search.LayerSearchSource")],O);const J=O;function as(e){return!!e&&typeof e.x=="number"&&typeof e.y=="number"}function us(e){return e&&typeof e.xmin=="number"&&typeof e.ymin=="number"&&typeof e.xmax=="number"&&typeof e.ymax=="number"}let B=class extends ee{constructor(t){super(t),this.address=null,this.attributes=null,this.extent=null,this.location=null,this.score=null}};o([i({type:String,json:{write:!0}})],B.prototype,"address",void 0),o([i({type:Object,json:{write:!0}})],B.prototype,"attributes",void 0),o([i({type:Fe,json:{write:!0}})],B.prototype,"extent",void 0),o([i({type:Y,json:{write:!0}})],B.prototype,"location",void 0),o([i({type:Number,json:{write:!0}})],B.prototype,"score",void 0),B=o([D("esri.rest.support.AddressCandidate")],B);const lt=B;let $=class extends ee{constructor(t){super(t),this.address=null,this.apiKey=null,this.categories=null,this.countryCode=null,this.forStorage=null,this.location=null,this.locationType=null,this.magicKey=null,this.maxLocations=null,this.outFields=null,this.outSpatialReference=null,this.searchExtent=null}};o([i({type:Object,json:{write:!0}})],$.prototype,"address",void 0),o([i(Te)],$.prototype,"apiKey",void 0),o([i({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],$.prototype,"categories",void 0),o([i({type:String,json:{write:!0}})],$.prototype,"countryCode",void 0),o([i({type:Boolean,json:{write:!0}})],$.prototype,"forStorage",void 0),o([i({type:Y,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],$.prototype,"location",void 0),o([i({type:["rooftop","street"],json:{write:!0}})],$.prototype,"locationType",void 0),o([i({type:String,json:{write:!0}})],$.prototype,"magicKey",void 0),o([i({type:Number,json:{write:!0}})],$.prototype,"maxLocations",void 0),o([i({type:[String],json:{write:{writer:(e,t)=>{t.outFields=e?e.join(","):null}}}})],$.prototype,"outFields",void 0),o([i({type:he,json:{read:{source:"outSR"},write:{target:"outSR"}}})],$.prototype,"outSpatialReference",void 0),o([i({type:Fe,json:{write:{writer:(e,t)=>{const s=e?e.shiftCentralMeridian():null;t.searchExtent=s}}}})],$.prototype,"searchExtent",void 0),$=o([D("esri.rest.support.AddressToLocationsParameters")],$),$.from=xe($);const nt=$;async function cs(e,t,s){t=nt.from(t);const r=$e(e),{address:l,...n}=t.toJSON(),a={...l,...n,f:"json"},u=Me({...r.query,...a}),c=Ce(u,s),d=`${r.path}/findAddressCandidates`;return be(d,c).then(ds)}function ds({data:e}){if(!e)return[];const{candidates:t,spatialReference:s}=e;return t?t.map(r=>{if(!r)return;const{extent:l,location:n}=r,a=!l||us(l);return as(n)&&a?(l&&(l.spatialReference=s),n&&(n.spatialReference=s),lt.fromJSON(r)):void 0}):[]}let V=class extends ee{constructor(t){super(t),this.apiKey=null,this.location=null,this.locationType=null,this.outSpatialReference=null}};o([i(Te)],V.prototype,"apiKey",void 0),o([i({type:Y,json:{write:{writer:(e,t)=>{const s=e?e.clone().normalize():null,r=s!==void 0;t.location=r?s:null}}}})],V.prototype,"location",void 0),o([i({type:["street","rooftop"],json:{write:!0}})],V.prototype,"locationType",void 0),o([i({type:he,json:{read:{source:"outSR"},write:{target:"outSR"}}})],V.prototype,"outSpatialReference",void 0),V=o([D("esri.rest.support.LocationToAddressParameters")],V),V.from=xe(V);const at=V;async function hs(e,t,s){t=at.from(t);const r=$e(e),l={...t.toJSON(),f:"json"},n=Me({...r.query,...l}),a=Ce(n,s),u=`${r.path}/reverseGeocode`;return be(u,a).then(ps)}function ps({data:e}){if(!e)return;const{address:t,location:s}=e,r=(t==null?void 0:t.Match_addr)||"";return lt.fromJSON({address:r,attributes:t||{},location:s,score:100})}let Q=class extends ee{constructor(e){super(e),this.isCollection=null,this.magicKey=null,this.text=null}};o([i({type:Boolean,json:{write:!0}})],Q.prototype,"isCollection",void 0),o([i({type:String,json:{write:!0}})],Q.prototype,"magicKey",void 0),o([i({type:String,json:{write:!0}})],Q.prototype,"text",void 0),Q=o([D("esri.rest.support.SuggestionCandidate")],Q);const gs=Q;let N=class extends ee{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.location=null,this.maxSuggestions=null,this.outSpatialReference=null,this.searchExtent=null,this.text=null}};o([i(Te)],N.prototype,"apiKey",void 0),o([i({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],N.prototype,"categories",void 0),o([i({type:String,json:{write:!0}})],N.prototype,"countryCode",void 0),o([i({type:Y,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],N.prototype,"location",void 0),o([i({type:Number,json:{write:!0}})],N.prototype,"maxSuggestions",void 0),o([i({type:he,json:{read:{source:"outSR"},write:{target:"outSR"}}})],N.prototype,"outSpatialReference",void 0),o([i({type:Fe,json:{write:{writer:(e,t)=>{const s=e?e.shiftCentralMeridian():null;t.searchExtent=JSON.stringify(s)}}}})],N.prototype,"searchExtent",void 0),o([i({type:String,json:{write:!0}})],N.prototype,"text",void 0),N=o([D("esri.rest.support.SuggestLocationsParameters")],N),N.from=xe(N);const ut=N;async function ms(e,t,s){const r=$e(e),l={...(t=ut.from(t)).toJSON(),f:"json"},n=Me({...r.query,...l}),a=Ce(n,s),u=`${r.path}/suggest`;return be(u,a).then(ys)}function ys(e){const{data:t}=e;if(!t)return[];const{suggestions:s}=t;return s?s.map(r=>new gs(r)):[]}const fs="Single Line Input",vs=3e5;function _s(e,t){return e.location?Rs(e,t):$s(e,t)}function ct(e,t){var r;if(t.localSearchDisabled)return null;const s=e==null?void 0:e.scale;return typeof s=="number"&&s<=vs?(r=e==null?void 0:e.extent)==null?void 0:r.center:null}async function ws(e,t){const{source:s,spatialReference:r,view:l,suggestTerm:n,maxSuggestions:a,sourceIndex:u}=e,c=new ut,{apiKey:d,url:h}=s,_=dt(s,l),y=t==null?void 0:t.signal;if(!h)return null;d&&(c.apiKey=d),s.categories&&(c.categories=s.categories),r&&(c.outSpatialReference=r);const f=ct(l,s);if(f&&(c.location=f),!n.trim())return null;const{prefix:m="",suffix:w=""}=s,b=`${m}${n}${w}`;return c.text=b,_&&(c.searchExtent=_),c.maxSuggestions=a,s.countryCode&&(c.countryCode=s.countryCode),ms(h,c,{signal:y}).then(L=>Cs(L,u))}function Ss(e){return!!e&&/(?:geocode-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}function xs(e){return!!e&&/(?:\/servers\/[\da-z.-]+\/rest\/services\/world\/geocodeserver).*/i.test(e)}function Ge(e){return!!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}const bs="https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer";async function Rs(e,t){const{source:s,spatialReference:r,location:l,sourceIndex:n,view:a}=e,{apiKey:u,url:c,zoomScale:d,defaultZoomScale:h}=s;if(c==null)return[];const _=a==null?void 0:a.scale,y=t==null?void 0:t.signal,f=new at({location:l});u&&(f.apiKey=u),r&&(f.outSpatialReference=r);try{return ht([await hs(c,f,{signal:y})],{sourceIndex:n,scale:_,view:a,zoomScale:d,defaultZoomScale:h})}catch{return[]}}function dt(e,t){const{filter:s,withinViewEnabled:r}=e,l=t==null?void 0:t.scale,n=t==null?void 0:t.extent,a=s==null?void 0:s.geometry;return(a?Re(a,t??void 0,l):void 0)||(r&&n?n:void 0)}async function $s(e,t){var S;const{source:s,suggestResult:r,spatialReference:l,view:n,maxResults:a,sourceIndex:u}=e,c=s==null?void 0:s.zoomScale,d=s==null?void 0:s.defaultZoomScale;if(!((S=r.text)==null?void 0:S.trim()))return null;const _=!r.key&&s.prefix?s.prefix:"",y=!r.key&&s.suffix?s.suffix:"",f=`${_}${r.text}${y}`,m=new nt,{apiKey:w,url:b}=s,L=n==null?void 0:n.scale,F=dt(s,n),k=t==null?void 0:t.signal;if(w&&(m.apiKey=w),!b)return null;s.categories&&(m.categories=s.categories),s.locationType&&(m.locationType=s.locationType),l&&(m.outSpatialReference=l);const R=ct(n,s);R&&(m.location=R),m.maxLocations=a,F&&(m.searchExtent=F),s.countryCode&&(m.countryCode=s.countryCode);const{key:T}=r,I=`${T}`;return T&&(m.magicKey=I),m.address={},m.address[s.singleLineFieldName||fs]=f,s.outFields&&(m.outFields=s.outFields),cs(b,m,{signal:k}).then(P=>ht(P,{key:I,scale:L,sourceIndex:u,view:n,zoomScale:c,defaultZoomScale:d}))}function Ms(e,t){return{text:e.text,key:e.magicKey,sourceIndex:t}}function Cs(e,t){return e.map(s=>Ms(s,t))}function Fs(e,t){const{key:s,scale:r,sourceIndex:l,view:n,zoomScale:a,defaultZoomScale:u}=t,{attributes:c,extent:d,location:h,address:_}=e,y=new ve({geometry:h,attributes:c}),f=d||h,m=f?Re(f,n??void 0,r??void 0):void 0,w=m?typeof a=="number"?_e(m,n??void 0,a):typeof u=="number"&&(f==null?void 0:f.type)==="point"?_e(m,n??void 0,u):m:null,b=h?`${h.x},${h.y}`:"",L=_||b,F=y.clone();return w!=null&&(F.geometry=Ze.fromExtent(w)),{extent:w,feature:y,target:F,key:s,name:L,sourceIndex:l}}function ht(e,t){return e.filter(Boolean).map(s=>Fs(s,t))}var Se;let C=Se=class extends Ee{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.defaultZoomScale=null,this.localSearchDisabled=!1,this.locationType=null,this.name="",this.placeholder="",this.searchTemplate="",this.singleLineFieldName=null,this.suggestionsEnabled=null,this.url=null,this.zoomScale=null,this.getResults=(t,s)=>_s({source:this,...t},s),this.getSuggestions=(t,s)=>ws({source:this,...t},s)}clone(){return new Se({apiKey:this.apiKey,autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?oe(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,categories:this.categories?oe(this.categories):null,countryCode:this.countryCode,locationType:this.locationType,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,zoomScale:this.zoomScale})}};o([i()],C.prototype,"apiKey",void 0),o([i()],C.prototype,"categories",void 0),o([i()],C.prototype,"countryCode",void 0),o([i({json:{write:!0}})],C.prototype,"defaultZoomScale",void 0),o([i()],C.prototype,"localSearchDisabled",void 0),o([i()],C.prototype,"locationType",void 0),o([i({json:{write:!0}})],C.prototype,"name",void 0),o([i({json:{write:!0}})],C.prototype,"placeholder",void 0),o([i()],C.prototype,"searchTemplate",void 0),o([i({json:{write:!0}})],C.prototype,"singleLineFieldName",void 0),o([i({json:{read:{source:"suggest"},write:{target:"suggest"}}})],C.prototype,"suggestionsEnabled",void 0),o([i({json:{write:!0}})],C.prototype,"url",void 0),o([i({json:{write:!0}})],C.prototype,"zoomScale",void 0),C=Se=o([D("esri.widgets.Search.LocatorSearchSource")],C);const pt=C;function M(e,t){return e.hasOwnProperty(t)&&e[t]!=null&&e[t]!==""}const Ts=()=>Mt("esri/widgets/Search/t9n/Search"),Ve="highlight",ue=Ct.ofType({key:e=>e.layer?"layer":"locator",base:Ee,typeMap:{layer:J,locator:pt}}),Ke=he.WGS84,Es="esri/images/search/search-symbol-32.png",Ls=/<[\s\S]*?>/g,U=-1;let p=class extends zt(Lt.EventedMixin(vt)){constructor(e){super(e),this._gotoController=null,this._searching=null,this._updatingPromise=null,this._createdFeatureLayers=[],this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new ue,this.defaultSymbols={point:new Et({url:Tt(Es),size:24,width:24,height:24}),polyline:new jt({color:[130,130,130,1],width:2}),polygon:new Dt({color:[235,235,235,.4],outline:{color:[130,130,130,1],width:2}})},this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=3,this.popupEnabled=!0,this.popupTemplate=null,this.portal=qe.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new ue,this.suggestionDelay=350,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null}initialize(){const e=async()=>{const t=await Ts();this.messages=t,this.defaultPopupTemplate=new ce({title:t.searchResult,content:"{Match_addr}"})};e(),this.addHandles([ne(()=>[this.includeDefaultSources,this.view,this.portal],()=>this._update(),ye),Ot(e)])}destroy(){this._destroyFeatureLayers(),this._abortGoTo(),this.clearGraphics()}get activeSource(){return this.allSources.at(this.activeSourceIndex)??null}get activeSourceIndex(){return this.allSources.length===1||!this.searchAllEnabled?0:U}set activeSourceIndex(e){this._overrideIfSome("activeSourceIndex",e)}get allPlaceholder(){var e;return(e=this.messages)==null?void 0:e.allPlaceholder}set allPlaceholder(e){this._overrideIfSome("allPlaceholder",e)}get allSources(){const{sources:e,defaultSources:t,includeDefaultSources:s}=this,r=typeof s=="function"?s.call(null,{sources:e,defaultSources:t}):s?t.concat(e):e,l=this._get("allSources")||new ue;return l.removeAll(),l.addMany(r.filter(Boolean)),l}get locationEnabled(){return this._get("locationEnabled")||ke()}set locationEnabled(e){if(e===void 0)return void this._clearOverride("locationEnabled");const t=ke();if(e&&!t){const s=new E("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});j.getLogger(this).error(s)}this._override("locationEnabled",!!e&&t)}get placeholder(){const{allSources:e,activeSourceIndex:t,allPlaceholder:s}=this;if(t===U)return s??"";const r=e.at(t);return(r==null?void 0:r.placeholder)??""}set searchTerm(e){this._set("searchTerm",e||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==e&&this._set("selectedSuggestion",null),e===""&&this._clear()}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":this.allSources.length===0?"disabled":"ready"}get updating(){return this._updatingPromise!=null}clear(){this.searchTerm=""}clearGraphics(){this._removeHighlight(),this._closePopup();const{view:e,resultGraphic:t}=this;e&&t&&e.graphics.remove(t),this._set("resultGraphic",null)}search(e,t){this.emit("search-start"),this.clearGraphics();const s=this._createSuggestionForSearch(e),r=(async()=>{var l;try{await this.when();const n=await this._getResultsFromSources(s,t);if((l=t==null?void 0:t.signal)!=null&&l.aborted)return null;const a={activeSourceIndex:this.activeSourceIndex,searchTerm:s.text??"",numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(a,n,s);const u=this._getFirstResult(a.results),c=s.location&&u?u.name:s.text,d=c==null?void 0:c.replace(Ls,"");return this._set("searchTerm",d),(s.key&&typeof s.sourceIndex=="number"||s.location)&&this._set("selectedSuggestion",s),this._set("results",a.results),this._set("resultCount",a.results.reduce((h,_)=>{var y;return h+(((y=_.results)==null?void 0:y.length)??0)},0)),this.emit("search-complete",a),await this._selectFirstResult(u),a}finally{this._clearSearching()}})();return this._searching=r,r}async searchNearby(e){if(!this.locationEnabled){const s=new E("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});throw j.getLogger(this).error(s),s}const t=(async()=>{try{const s=await Kt(),r=await Bt({position:s,view:this.view},e);return await this.search(r,e)}finally{this._clearSearching()}})();return this._searching=t,t}async select(e){if(this.clearGraphics(),!e){const A=new E("select:missing-parameter","Cannot select without a searchResult.",{searchResult:e});throw j.getLogger(this).error(A),A}const{view:t}=this,s=M(e,"sourceIndex")?e.sourceIndex:this._getSourceIndexOfResult(e),r=s!=null?this.allSources.at(s):null;if(!r){const A=new E("select:missing-source","Cannot select without a source.",{source:r});throw j.getLogger(this).error(A),A}const l=r instanceof J?this._getLayerSourcePopupTemplate(r):r.popupTemplate,n=r.resultSymbol||this._getDefaultSymbol(e),a=M(r,"resultGraphicEnabled")?r.resultGraphicEnabled:this.resultGraphicEnabled,u=M(r,"autoNavigate")?r.autoNavigate:this.autoNavigate,c=M(r,"popupEnabled")?r.popupEnabled:this.popupEnabled,d=c?l||this.popupTemplate||this.defaultPopupTemplate:null,{feature:h}=e;if(!h){const A=new E("select:missing-feature","Cannot select without a feature.",{feature:h});throw j.getLogger(this).error(A),A}const{attributes:_,geometry:y,layer:f,sourceLayer:m}=h,w=y?De(y):null,b={layerViewQuery:this._getLayerView(h),elevationQuery:t&&w!=null?At(w,t):Promise.resolve(w)},L=await le(b),F=L.layerViewQuery.value,k=L.elevationQuery.value;n instanceof kt&&(n.text=e.name);const R=t&&u?e.target||e.extent:null;await(R!=null?this._goToSearchResult(R):Promise.resolve());const I=F?h:new ve({geometry:y,symbol:n,attributes:_,layer:f,sourceLayer:m,popupTemplate:d}),S=t==null?void 0:t.popup,P=S&&c&&I.getEffectivePopupTemplate(S.defaultPopupTemplateEnabled);return P&&await t.openPopup({features:[I],location:k}),F&&Pt(F)&&!P&&this._highlightFeature({graphic:I,layerView:F}),!F&&a&&t&&t.graphics.push(I),this._setResultFloor(e),this._set("selectedResult",e),this._set("resultGraphic",I),this.emit("select-result",{result:e,source:r,sourceIndex:s}),e}async suggest(e,t,s){const r=e||this.searchTerm;this.emit("suggest-start",{searchTerm:r}),await this._suggestTimer(t,s);const l=await this._suggestImmediate(r,s);return this._set("suggestions",l==null?void 0:l.results),this._set("suggestionCount",(l==null?void 0:l.results.reduce((n,a)=>{var u;return n+(((u=a.results)==null?void 0:u.length)??0)},0))??null),this.emit("suggest-complete",l),l}async when(){await je(()=>!this.updating)}async _update(){const{portal:e,view:t}=this;if(this.includeDefaultSources){const s=this._updatingPromise=le([e==null?void 0:e.load(),t==null?void 0:t.when()]);if(this.destroyed||(await s,s!==this._updatingPromise))return}await je(()=>this.messages),this.destroyed||this._updateDefaultSources(),this._updatingPromise=null}_clearSearching(){this._searching=null}_convertHelperServices(){var t,s;const e=(s=(t=this.portal)==null?void 0:t.helperServices)==null?void 0:s.geocode;return e?e.map(r=>{var u;if(r.placefinding===!1)return;const l=_t.apiKey&&Ge(r.url)?{url:bs}:null,n=pt.fromJSON({...r,...l}),a=n.url;if(Ge(a)||xs(a)||Ss(a)){const c=n.outFields??["Addr_type","Match_addr","StAddr","City"],d=(n.placeholder||((u=this.messages)==null?void 0:u.placeholder))??"",h=typeof n.defaultZoomScale=="number"?n.defaultZoomScale:2500;n.singleLineFieldName="SingleLine",n.outFields=c,n.placeholder=d,n.defaultZoomScale=h}return n.singleLineFieldName?n:void 0}).filter(ge):[]}_destroyFeatureLayers(){this._createdFeatureLayers.forEach(e=>e==null?void 0:e.destroy()),this._createdFeatureLayers=[]}_getLayerSources(e,t){var r;const s=(r=this.view)==null?void 0:r.map;return e.map(l=>{const n=s.findLayerById(l.id);if(!n)return;const a=this._getLayerJSON(l),u=J.fromJSON(a);return u.placeholder=t,this._getLayer(n,a).then(c=>{u.layer=c}),u}).filter(ge).toArray()}_getTableSources(e,t){var r;const s=(r=this.view)==null?void 0:r.map;return e.map(l=>{if(!l.id)return;const n=s.findTableById(l.id);if(!n)return;const a=this._getLayerJSON(l),u=J.fromJSON(a);return u.placeholder=t,this._getLayer(n,a).then(c=>{u.layer=c}),u}).filter(ge).toArray()}_convertApplicationProperties(){var a,u,c;const e=(a=this.view)==null?void 0:a.map,t=(c=(u=e==null?void 0:e.applicationProperties)==null?void 0:u.viewing)==null?void 0:c.search;if(!t)return[];const{enabled:s,hintText:r,layers:l,tables:n}=t;return s?[...this._getLayerSources(l,r),...this._getTableSources(n,r)]:[]}async _getSubLayer(e,t){var l;if(await e.load(),!e.allSublayers)throw new Error;const s=e.allSublayers.find(n=>n.id===t.subLayer);if(!s)throw new Error;const r=await((l=s.createFeatureLayer)==null?void 0:l.call(s));if(!r)throw new Error;return this._createdFeatureLayers.push(r),r}async _getBuildingSubLayer(e,t){await e.load();const s=e.allSublayers.find(r=>r.id===t.subLayer);if((s==null?void 0:s.type)!=="building-component")throw new Error;if(await s.load(),s.associatedLayer==null)throw new Error;return await s.associatedLayer.load(),s}async _getLayer(e,t){if(e.type==="feature"||e.type==="scene"||e.type==="csv"||e.type==="geojson"||e.type==="ogc-feature")return e;if(e.type==="map-image")try{return await this._getSubLayer(e,t)}catch{const r=new E("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:e});return j.getLogger(this).error(r),null}return e.type==="building-scene"?this._getBuildingSubLayer(e,t):null}_getLayerJSON(e){return typeof e.toJSON=="function"?e.toJSON():e}_updateDefaultSources(){const{defaultSources:e,includeDefaultSources:t}=this;this._destroyFeatureLayers(),e.removeAll(),t&&e.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()])}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear")}_closePopup(){var l;const e=(l=this.view)==null?void 0:l.popup,{resultGraphic:t}=this;if(!e||!t)return;const s="selectedFeature"in e,r=s?e.selectedFeature:null;s&&r&&r===t&&e.close()}_suggestTimer(e,t){const s=e??this.suggestionDelay;return wt(s,null,t==null?void 0:t.signal)}_createLocationForSearch(e){return e instanceof ve&&e.geometry?De(e.geometry):e instanceof Y?e:Array.isArray(e)&&e.length===2?new Y({longitude:e[0],latitude:e[1]}):null}_createSuggestionForSearch(e){if(e&&M(e,"key")&&M(e,"text")&&M(e,"sourceIndex"))return e;const t=this._createLocationForSearch(e),s=typeof e=="string"?e:this.searchTerm,{selectedSuggestion:r,selectedResult:l}=this,n=!e&&r&&l,a=n&&r.key===l.key&&r.sourceIndex===l.sourceIndex,u=n&&r.location;return a||u?r:{location:t,text:t?"":s,sourceIndex:null,key:null}}_getFirstResult(e){return me(e,({results:t})=>t==null?void 0:t[0])??null}async _selectFirstResult(e){return this.autoSelect&&e?this.select(e):null}async _suggestImmediate(e,t){var l;await this.when();const s=await this._getSuggestionsFromSources(e,t);if((l=t==null?void 0:t.signal)!=null&&l.aborted)return null;const r={activeSourceIndex:this.activeSourceIndex,searchTerm:e??"",numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(r,s),r}_formatSourceResponse(e,t,s){const r=(t==null?void 0:t.value)||[],l=t==null?void 0:t.error,n=this.allSources.at(s);if(l){const a={sourceIndex:s,source:n,error:l};e.errors.push(a),j.getLogger(this).error(l),e.numErrors++}else{const a={sourceIndex:s,source:n,results:r};e.results.push(a),e.numResults+=r.length}}_formatResponse(e,t,s){if(t)if(e.activeSourceIndex===U){const r=s&&M(s,"sourceIndex")&&s.sourceIndex!==-1?s.sourceIndex:void 0;t.forEach((l,n)=>{const a=r!==void 0?r:n;this._formatSourceResponse(e,l,a)})}else this._formatSourceResponse(e,t[0],e.activeSourceIndex)}async _getResultsFromSources(e,t){const{allSources:s}=this,r=!e.location&&M(e,"sourceIndex")?e.sourceIndex:this.activeSourceIndex,l=[];if(!s.length){const n=new E("search:no-sources-defined","At least one source is required.",{allSources:s});throw j.getLogger(this).error(n),n}return r===U?s.forEach((n,a)=>{l.push(this._getResultsFromSource(e,a,t))}):l.push(this._getResultsFromSource(e,r,t)),le(l)}async _getSuggestionsFromSources(e,t){const{allSources:s,activeSourceIndex:r}=this,l=[];if(!s.length){const n=new E("suggest:no-sources-defined","At least one source is required.",{allSources:s});throw j.getLogger(this).error(n),n}return r===U?s.forEach((n,a)=>{l.push(this._getSuggestionsFromSource(e,a,t))}):l.push(this._getSuggestionsFromSource(e,r,t)),le(l)}async _getResultsFromSource(e,t,s){var d,h;const r=t!=null?this.allSources.at(t):null;if(!r)return null;const{location:l=null}=e,n=((d=this.view)==null?void 0:d.spatialReference)||Ke,a=M(r,"maxResults")?r.maxResults:this.maxResults,u=!!(r instanceof J&&M(r,"exactMatch"))&&r.exactMatch,{view:c}=this;return(h=r.getResults)==null?void 0:h.call(r,{view:c,sourceIndex:t,location:l,suggestResult:e,spatialReference:n,exactMatch:u,maxResults:a},s)}async _getSuggestionsFromSource(e,t,s){var u,c;const r=this.allSources.at(t);if(!r)return null;e??(e="");const l=M(r,"suggestionsEnabled")?r.suggestionsEnabled:this.suggestionsEnabled,n=e==null?void 0:e.length,a=M(r,"minSuggestCharacters")?r.minSuggestCharacters:this.minSuggestCharacters;if(l&&e.trim()&&n>=a){const d=((u=this.view)==null?void 0:u.spatialReference)||Ke,h=M(r,"maxSuggestions")?r.maxSuggestions:this.maxSuggestions,{view:_}=this,y=!!(r instanceof J&&M(r,"exactMatch"))&&r.exactMatch;return(c=r.getSuggestions)==null?void 0:c.call(r,{view:_,sourceIndex:t,suggestTerm:e,spatialReference:d,maxSuggestions:h,exactMatch:y},s)}return null}_getLayerSourcePopupTemplate(e){const{layer:t}=e;if(t)return M(e,"popupTemplate")?e.popupTemplate:t.popupTemplate}_getSourceIndexOfResult(e){return me(this.results??[],({results:t,sourceIndex:s})=>(t==null?void 0:t.includes(e))?s:null)??null}async _goToSearchResult(e){this._abortGoTo();const t=new AbortController;this._gotoController=t;const s={target:{target:e},options:{signal:t.signal}};e||(s.options.animate=!1),await this.callGoTo(s),this._gotoController=null}_getDefaultSymbol(e){var r;const{defaultSymbols:t}=this,s=(r=e.feature)==null?void 0:r.geometry;if(s==null)return null;switch(s.type){case"point":case"multipoint":return t.point;case"polyline":return t.polyline;case"extent":case"polygon":return t.polygon;default:return null}}_removeHighlight(){this.removeHandles(Ve)}async _getLayerView(e){var r,l;const{view:t}=this;if(!e||!t||((r=e.layer)==null?void 0:r.type)==="building-component"||((l=e.layer)==null?void 0:l.type)==="subtype-sublayer")return null;const{layer:s}=e;return s?(await t.when(),t.whenLayerView(s)):null}_highlightFeature(e){const{graphic:t,layerView:s}=e,{attributes:r,layer:l}=t,{objectIdField:n}=l,a=(n&&(r==null?void 0:r[n]))??null,u=s.highlight(a??t);this.addHandles(u,Ve)}_setResultFloor(e){var l,n,a;const{view:t}=this,s=(l=e.feature)==null?void 0:l.attributes,r=(n=e.feature)==null?void 0:n.sourceLayer;if(r&&"floorInfo"in r&&((a=r==null?void 0:r.floorInfo)!=null&&a.floorField)&&s){const u=s[r.floorInfo.floorField];t==null||t.emit("select-result-floor",u)}}};p.ALL_INDEX=U,o([i()],p.prototype,"_searching",void 0),o([i()],p.prototype,"_updatingPromise",void 0),o([i({readOnly:!0,value:null})],p.prototype,"activeSource",null),o([i()],p.prototype,"activeSourceIndex",null),o([i()],p.prototype,"allPlaceholder",null),o([i({readOnly:!0})],p.prototype,"allSources",null),o([i()],p.prototype,"autoNavigate",void 0),o([i()],p.prototype,"autoSelect",void 0),o([i({type:ce})],p.prototype,"defaultPopupTemplate",void 0),o([i({readOnly:!0})],p.prototype,"defaultSources",void 0),o([i()],p.prototype,"defaultSymbols",void 0),o([i()],p.prototype,"includeDefaultSources",void 0),o([i()],p.prototype,"locationEnabled",null),o([i()],p.prototype,"maxInputLength",void 0),o([i()],p.prototype,"maxResults",void 0),o([i()],p.prototype,"maxSuggestions",void 0),o([i()],p.prototype,"messages",void 0),o([i()],p.prototype,"minSuggestCharacters",void 0),o([i({readOnly:!0})],p.prototype,"placeholder",null),o([i()],p.prototype,"popupEnabled",void 0),o([i({type:ce})],p.prototype,"popupTemplate",void 0),o([i({type:qe})],p.prototype,"portal",void 0),o([i()],p.prototype,"resultCount",void 0),o([i()],p.prototype,"resultGraphicEnabled",void 0),o([i({readOnly:!0})],p.prototype,"resultGraphic",void 0),o([i({readOnly:!0})],p.prototype,"results",void 0),o([i({readOnly:!0})],p.prototype,"selectedSuggestion",void 0),o([i()],p.prototype,"searchAllEnabled",void 0),o([i({readOnly:!0})],p.prototype,"selectedResult",void 0),o([i()],p.prototype,"searchTerm",null),o([i({type:ue})],p.prototype,"sources",void 0),o([i({readOnly:!0})],p.prototype,"state",null),o([i()],p.prototype,"suggestionDelay",void 0),o([i()],p.prototype,"suggestionCount",void 0),o([i({readOnly:!0})],p.prototype,"suggestions",void 0),o([i()],p.prototype,"suggestionsEnabled",void 0),o([i({readOnly:!0})],p.prototype,"updating",null),o([i()],p.prototype,"view",void 0),o([i()],p.prototype,"clear",null),p=o([D("esri.widgets.Search.SearchViewModel")],p);const W=p;let z=class extends ze{constructor(e,t){super(e,t),this.messages=null,this.showMoreResultsOpen=!1,this.viewModel=null}destroy(){this.viewModel=null}render(){const e={[Z.showMoreResults]:this.showMoreResultsOpen};return v("div",{class:this.classes(Z.base,ae.widget)},v("div",{class:this.classes(Z.moreResults,e),key:"esri-search-renderer__container"},this._renderSearchResultName(),this._renderMoreResults()))}_renderMoreResults(){return v("div",{key:"esri-search-renderer__more-results"},this._renderMoreResultsButton(),this._renderMoreResultsLists())}_renderSearchResultName(){var s;const e=(s=this.viewModel)==null?void 0:s.selectedResult,t=(e==null?void 0:e.name)||"";return v("div",{class:Z.moreResultsItem,key:"esri-search-renderer__result-name"},t)}_renderMoreResultsLists(){const{viewModel:e}=this;if(!e)return[];const t=e.results;if((e.resultCount??0)<2)return null;const s=t==null?void 0:t.map(r=>this._renderMoreResultsList(r));return v("div",{class:Z.moreResultsList,key:"esri-search-renderer__more-results-container"},s)}_renderMoreResultsButton(){const{messages:e,viewModel:t}=this;return t?(t.resultCount??0)<2?null:v("div",{class:Z.moreResultsItem,key:"esri-search-renderer__more-results-button"},v("a",{bind:this,class:ae.anchor,href:"#",onclick:this._showMoreResultsClick,onkeydown:this._showMoreResultsClick},this.showMoreResultsOpen?e.hideMoreResults:e.showMoreResults)):null}_renderMoreResultsHeader(e,t){return v("div",{class:Z.moreResultsListHeader,key:`esri-search-result-renderer__header-${t}`},e)}_renderMoreResultsList(e){var h,_,y;const{results:t}=e,s=(t==null?void 0:t.length)??0,r=s>0,l=(h=this.viewModel)==null?void 0:h.selectedResult,n=s===1&&t[0]===l,a=this._getSourceName(e.source,e.sourceIndex),u=(((y=(_=this.viewModel)==null?void 0:_.results)==null?void 0:y.length)??0)>1&&!n?this._renderMoreResultsHeader(a,e.sourceIndex):null,c=r&&t.map((f,m)=>this._renderMoreResultsListItem(f,m)),d=r&&!n?v("ul",{key:`esri-search-result-renderer__list-${e.sourceIndex}`},c):null;return r?v("div",{key:`esri-search-result-renderer__results-${e.sourceIndex}`},u,d):null}_renderMoreResultsListItem(e,t){var r;const s=(r=this.viewModel)==null?void 0:r.selectedResult;return e!==s?v("li",{key:`esri-search-result-renderer__list-item-${t}`},v("a",{bind:this,class:ae.anchor,"data-result":e,href:"#",onclick:this._selectResultClick,onkeydown:this._selectResultClick,tabIndex:0},e.name)):null}_showMoreResultsClick(e){var s,r;e.preventDefault(),this.showMoreResultsOpen=!this.showMoreResultsOpen;const t=(r=(s=this.viewModel)==null?void 0:s.view)==null?void 0:r.popup;t&&"reposition"in t&&t.reposition()}_selectResultClick(e){var s;e.preventDefault();const t=e.currentTarget["data-result"];(s=this.viewModel)==null||s.select(t)}_getSourceName(e,t){return t===W.ALL_INDEX?this.messages.all:e.name}};o([i(),fe("esri/widgets/Search/t9n/Search")],z.prototype,"messages",void 0),o([i()],z.prototype,"showMoreResultsOpen",void 0),o([i()],z.prototype,"viewModel",void 0),o([Pe()],z.prototype,"_showMoreResultsClick",null),o([Pe()],z.prototype,"_selectResultClick",null),z=o([D("esri.widgets.Search.SearchResultRenderer")],z);const Is=z;let g=class extends ze{constructor(e,t){super(e,t),this._currentLocationValue=`${this.id}-search-use-current-location`,this._autocompleteNode=null,this._focusAbortController=null,this._searchResultRenderer=new Is,this._suggestController=null,this._searchController=null,this._lastSearchTerm="",this._locateFailed=!1,this._showNoResults=!1,this.disabled=!1,this.messages=null,this.messagesCommon=null,this.viewModel=new W,this._renderSearchResultsContent=()=>this._searchResultRenderer,this.addHandles([ne(()=>this.viewModel,s=>this._searchResultRenderer.viewModel=s,ye),ne(()=>this.viewModel.results,()=>this._searchResultRenderer.showMoreResultsOpen=!1),ne(()=>{var s;return(s=this.viewModel)==null?void 0:s.defaultPopupTemplate},s=>{s&&(s.content=this._renderSearchResultsContent)},ye)])}loadDependencies(){return Ft({autocomplete:()=>K(()=>import("./index-k0QevbF9.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39]),import.meta.url),"autocomplete-item-group":()=>K(()=>import("./index-BM9O7MVS.js"),__vite__mapDeps([40,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url),"autocomplete-item":()=>K(()=>import("./index-ChHsT86y.js"),__vite__mapDeps([41,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,31,26,42]),import.meta.url),button:()=>K(()=>import("./index-BtF7Kdcs.js"),__vite__mapDeps([43,44,2,3,4,5,6,7,8,9,10,11,12,13,15,33,1,14,16,23,21,24,25,26,28,29,31]),import.meta.url),dropdown:()=>K(()=>import("./index-Df8-0rWt.js"),__vite__mapDeps([45,2,3,4,5,6,7,8,9,10,11,12,13,23,21,14,15,36,37,26,27,29,16,38,46]),import.meta.url),"dropdown-group":()=>K(()=>import("./index-BfAp5_ga.js"),__vite__mapDeps([47,2,3,4,5,6,7,8,9,10,11,12,13,16,48]),import.meta.url),"dropdown-item":()=>K(()=>import("./index-DIB7yhJF.js"),__vite__mapDeps([49,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,23,21,29,31,26,48]),import.meta.url),notice:()=>K(()=>import("./index-nrWOrFCt.js"),__vite__mapDeps([50,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,23,21,29,51,38,31,33]),import.meta.url)})}destroy(){var e;this._cancelQueries(),this._searchResultRenderer=St(this._searchResultRenderer),(e=this._focusAbortController)==null||e.abort()}get _isDisabled(){const{state:e}=this.viewModel;return e==="disabled"||e==="loading"||this.disabled}get _showCurrentLocation(){var e;return this.locationEnabled&&!((e=this.searchTerm)!=null&&e.trim())}get _effectiveActiveMenu(){const{activeMenu:e}=this;return this._isDisabled?"none":e==="warning"?"suggestion":e}get activeMenu(){return"none"}set activeMenu(e){e==="warning"&&xt(j.getLogger(this),"activeMenu","warning",{replacement:"Use the value 'suggestion' instead",version:"4.32",warnOnce:!0}),this._overrideIfSome("activeMenu",e)}get activeSource(){var e;return(e=this.viewModel)==null?void 0:e.activeSource}get activeSourceIndex(){return this.viewModel.activeSourceIndex}set activeSourceIndex(e){this.viewModel.activeSourceIndex=e}get allPlaceholder(){return this.viewModel.allPlaceholder}set allPlaceholder(e){this.viewModel.allPlaceholder=e}get allSources(){return this.viewModel.allSources}get autoNavigate(){return this.viewModel.autoNavigate}set autoNavigate(e){this.viewModel.autoNavigate=e}get autoSelect(){return this.viewModel.autoSelect}set autoSelect(e){this.viewModel.autoSelect=e}get defaultSources(){return this.viewModel.defaultSources}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return"search"}set icon(e){this._overrideIfSome("icon",e)}get includeDefaultSources(){return this.viewModel.includeDefaultSources}set includeDefaultSources(e){this.viewModel.includeDefaultSources=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get locationEnabled(){return this.viewModel.locationEnabled}set locationEnabled(e){this.viewModel.locationEnabled=e}get maxResults(){return this.viewModel.maxResults}set maxResults(e){this.viewModel.maxResults=e}get maxSuggestions(){return this.viewModel.maxSuggestions}set maxSuggestions(e){this.viewModel.maxSuggestions=e}get minSuggestCharacters(){return this.viewModel.minSuggestCharacters}set minSuggestCharacters(e){this.viewModel.minSuggestCharacters=e}get popupEnabled(){return this.viewModel.popupEnabled}set popupEnabled(e){this.viewModel.popupEnabled=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get portal(){var e;return(e=this.viewModel)==null?void 0:e.portal}set portal(e){this.viewModel&&(this.viewModel.portal=e)}get resultGraphic(){return this.viewModel.resultGraphic}set resultGraphic(e){this.viewModel.resultGraphic=e}get resultGraphicEnabled(){return this.viewModel.resultGraphicEnabled}set resultGraphicEnabled(e){this.viewModel.resultGraphicEnabled=e}get results(){return this.viewModel.results}get searchAllEnabled(){return this.viewModel.searchAllEnabled}set searchAllEnabled(e){this.viewModel.searchAllEnabled=e}get searchTerm(){return this.viewModel.searchTerm}set searchTerm(e){this.viewModel.searchTerm=e}get selectedResult(){return this.viewModel.selectedResult}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get suggestions(){return this.viewModel.suggestions}get suggestionsEnabled(){return this.viewModel.suggestionsEnabled}set suggestionsEnabled(e){this.viewModel.suggestionsEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}clear(){this._locateFailed=!1,this.viewModel.clear()}focus(){this._handleFocus(),this._emitFocus()}blur(){var e;(e=this._autocompleteNode)==null||e.blur(),this._emitBlur()}async search(e){this._cancelQueries();const t=new AbortController,{signal:s}=t;this._searchController=t;try{const r=await this.viewModel.search(e,{signal:s});return this._searchController!==t?void 0:(r!=null&&r.numResults||(this._showNoResults=!0,this.activeMenu="suggestion"),this._searchController=null,r)}catch{return this._searchController!==t?void 0:void(this._searchController=null)}}async suggest(e){this._cancelSuggest();const t=new AbortController,{signal:s}=t;this._suggestController=t;try{const r=await this.viewModel.suggest(e,null,{signal:s});return this._suggestController!==t?void 0:(this._suggestController=null,r!=null&&r.numResults&&(this.activeMenu="suggestion",this._scrollToTopSuggestion()),r)}catch{return this._suggestController!==t||(this._suggestController=null),null}}render(){return v("div",{class:this.classes(H.base,ae.widget)},v("div",{class:H.container},this._renderSourcesMenu(),this._renderForm()))}_handleInputKeydown(e){e.key==="Tab"&&this._cancelSuggest()}_emitFocus(){this.emit("search-focus")}_emitBlur(){this.emit("search-blur")}async _handleFocus(){var t,s;(t=this._focusAbortController)==null||t.abort(),this._focusAbortController=new AbortController;const e=this._focusAbortController.signal;await bt(Rt(e)),(s=this._autocompleteNode)==null||s.setFocus()}_renderSourcesMenu(){const{messages:e,_isDisabled:t,_effectiveActiveMenu:s}=this,{allSources:r,searchAllEnabled:l}=this.viewModel;return r.length>1?v("calcite-dropdown",{bind:this,class:H.dropdown,disabled:t,open:s==="source",overlayPositioning:"fixed",onCalciteDropdownClose:this._handleSourceClose,onCalciteDropdownOpen:this._handleSourceOpen,onCalciteDropdownSelect:this._handleSourceSelect},v("calcite-button",{appearance:"outline-fill",iconStart:"caret-down",kind:"neutral",label:e.searchIn,slot:"trigger"}),v("calcite-dropdown-group",{groupTitle:e.searchIn},l?this._renderSource(W.ALL_INDEX):null,r.map((n,a)=>this._renderSource(a)).toArray())):null}_renderUseCurrentLocation(){const{_currentLocationValue:e}=this;return v("calcite-autocomplete-item",{heading:this.messages.useCurrentLocation,iconStart:"gps-on",key:e,value:e})}_handleAutocompleteCreate(e){this._autocompleteNode=e}_handleCalciteAutocompleteTextInput(e){const t=e.target.inputValue;t!==this.viewModel.searchTerm&&(this.viewModel.searchTerm=t,t||this.clear(),this.suggest())}_handleAutocompleteOpen(){this.activeMenu="suggestion"}_handleAutocompleteClose(){this.activeMenu==="suggestion"&&(this.activeMenu="none")}_handleCalciteAutocompleteChange(e){var l;const t=e.target.value;if(t===this._currentLocationValue)return void this._useCurrentLocation();const s=(l=this.viewModel.suggestions)==null?void 0:l.flatMap(n=>n.results??[]),r=s==null?void 0:s.find(n=>`${n.key}`==`${t}`);r&&this.search(r)}_renderAutocomplete(){const{_effectiveActiveMenu:e,messages:t,_isDisabled:s}=this,{maxInputLength:r,placeholder:l,searchTerm:n,state:a}=this.viewModel,u=this.label??t.searchButtonTitle??"";return v("calcite-autocomplete",{afterCreate:this._handleAutocompleteCreate,autocomplete:"off",bind:this,class:H.autocomplete,disabled:s,icon:this.icon,inputValue:n,label:u,loading:a==="searching",maxLength:r,name:this.id,onblur:this._emitBlur,onfocus:this._emitFocus,onkeydown:this._handleInputKeydown,open:e==="suggestion",overlayPositioning:"fixed",placeholder:l,title:n?"":l,onCalciteAutocompleteChange:this._handleCalciteAutocompleteChange,onCalciteAutocompleteClose:this._handleAutocompleteClose,onCalciteAutocompleteOpen:this._handleAutocompleteOpen,onCalciteAutocompleteTextChange:this._handleCalciteAutocompleteTextInput,onCalciteAutocompleteTextInput:this._handleCalciteAutocompleteTextInput},this._renderSuggestions(),this._renderNotices())}_renderForm(){return v("form",{bind:this,class:H.form,disabled:this._isDisabled,key:H.form,onsubmit:this._formSubmit,role:"search"},this._renderAutocomplete())}_renderSuggestGroup(e){var t;return(t=e.results)==null?void 0:t.map(s=>this._renderSuggestion(s))}_renderSuggestions(){const{suggestions:e}=this.viewModel;return this._showNoResults?null:this._showCurrentLocation?this._renderUseCurrentLocation():e==null?void 0:e.map(t=>this._renderSuggestResults(t))}_renderSuggestResults(e){var u;const{allSources:t,activeSourceIndex:s}=this.viewModel,{sourceIndex:r}=e,l=(u=e.results)==null?void 0:u.length,n=t.length>1&&s===W.ALL_INDEX,a=this._getSourceName(r);return l&&n?v("calcite-autocomplete-item-group",{heading:a,key:`suggestion-group-${a}-${r}`},this._renderSuggestGroup(e)):this._renderSuggestGroup(e)}_renderSuggestion(e){return v("calcite-autocomplete-item",{heading:e.text??this.messages.untitledResult,key:`suggestion_${e.key}`,value:`${e.key}`})}_renderSource(e){const t=this._getSourceName(e);return v("calcite-dropdown-item",{"data-source-index":`${e}`,key:`source-${t}-${e}`,selected:e===this.viewModel.activeSourceIndex},t)}_renderNoResultsWarning(e){const{messages:t}=this,s=e?He(t.noResultsFoundForValue,{value:`"${e}"`}):t.noResultsFound;return v("calcite-notice",{icon:"exclamation-mark-triangle",key:"no-results-warning",kind:"warning",open:!0,slot:"content-bottom"},v("div",{slot:"title"},t.noResults),v("div",{slot:"message"},s))}_renderLocateError(){return v("calcite-notice",{icon:"exclamation-mark-circle",key:"locate-warning",kind:"danger",open:!0,slot:"content-bottom"},v("div",{slot:"message"},this.messages.locateError))}_renderNotices(){return this._locateFailed?this._renderLocateError():this._showNoResults?this._renderNoResultsWarning(this._lastSearchTerm??this.viewModel.searchTerm):null}async _useCurrentLocation(){this._cancelQueries();const e=new AbortController,{signal:t}=e;this._searchController=e;try{await this.viewModel.searchNearby({signal:t})}catch(s){$t(s)||(this._locateFailed=!0)}finally{this._searchController=null}}_handleSourceOpen(){this.activeMenu="source"}_handleSourceClose(){this.activeMenu==="source"&&(this.activeMenu="none")}_handleSourceSelect(e){const t=e.target.selectedItems[0].getAttribute("data-source-index");t&&(this.viewModel.activeSourceIndex=parseInt(t,10))}_cancelSuggest(){this.activeMenu="none",this._locateFailed=!1,this._showNoResults=!1,this._suggestController=Oe(this._suggestController)}_cancelQueries(){this._cancelSuggest(),this._searchController=Oe(this._searchController)}_scrollToTopSuggestion(){var e;(e=this._autocompleteNode)==null||e.scrollContentTo({top:0})}_formSubmit(e){e.preventDefault(),this.activeMenu="none",this._lastSearchTerm=this.searchTerm,this.searchTerm&&this.search()}_getSourceName(e){const{messages:t}=this,{allSources:s}=this.viewModel,r=s.at(e);return e===W.ALL_INDEX?t.all:(r==null?void 0:r.name)||t.untitledSource}};o([i()],g.prototype,"_locateFailed",void 0),o([i()],g.prototype,"_showNoResults",void 0),o([i()],g.prototype,"_isDisabled",null),o([i()],g.prototype,"_showCurrentLocation",null),o([i()],g.prototype,"_effectiveActiveMenu",null),o([i()],g.prototype,"activeMenu",null),o([i({readOnly:!0})],g.prototype,"activeSource",null),o([i()],g.prototype,"activeSourceIndex",null),o([i()],g.prototype,"allPlaceholder",null),o([i({readOnly:!0})],g.prototype,"allSources",null),o([i()],g.prototype,"autoNavigate",null),o([i()],g.prototype,"autoSelect",null),o([i({readOnly:!0})],g.prototype,"defaultSources",null),o([i()],g.prototype,"disabled",void 0),o([i()],g.prototype,"goToOverride",null),o([i()],g.prototype,"icon",null),o([i()],g.prototype,"includeDefaultSources",null),o([i()],g.prototype,"label",null),o([i()],g.prototype,"locationEnabled",null),o([i()],g.prototype,"maxResults",null),o([i()],g.prototype,"maxSuggestions",null),o([i(),fe("esri/widgets/Search/t9n/Search")],g.prototype,"messages",void 0),o([i(),fe("esri/t9n/common")],g.prototype,"messagesCommon",void 0),o([i()],g.prototype,"minSuggestCharacters",null),o([i()],g.prototype,"popupEnabled",null),o([i()],g.prototype,"popupTemplate",null),o([i()],g.prototype,"portal",null),o([i()],g.prototype,"resultGraphic",null),o([i()],g.prototype,"resultGraphicEnabled",null),o([i({readOnly:!0})],g.prototype,"results",null),o([i()],g.prototype,"searchAllEnabled",null),o([i()],g.prototype,"searchTerm",null),o([i({readOnly:!0})],g.prototype,"selectedResult",null),o([i()],g.prototype,"sources",null),o([i({readOnly:!0})],g.prototype,"suggestions",null),o([i()],g.prototype,"suggestionsEnabled",null),o([i()],g.prototype,"view",null),o([qt(["search-complete","search-clear","search-start","select-result","suggest-start","suggest-complete"]),i({type:W})],g.prototype,"viewModel",void 0),g=o([D("esri.widgets.Search")],g);const cr=g;export{cr as C,bs as v,Ge as x};
