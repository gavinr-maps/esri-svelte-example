import"./geometry-DpwwkAX1.js";import{d as f,l as E,i as S}from"./screenUtils-PfxkaaMN.js";import{n as i,s as y,r as H,_ as T,f as $,P as N,g as P,c as h}from"./mathUtils-ClvKsMak.js";import{$ as I}from"./projection-A9yUaaTs.js";import{t as R,S as C,E as F,F as G,j as U,e as b}from"./plane-Bz78OrLf.js";import{m as A,h as k}from"./sphere-7666U3LO.js";import{p as _}from"./elevationInfoUtils-Bl7QRRwv.js";import{g}from"./ray-DM1mbnrb.js";import{T as q,e as j,i as z}from"./ElevationProvider-BHZsEIDd.js";import{w as O}from"./verticalOffsetUtils-DaB1QvwW.js";import{w as B}from"./InteractiveToolBase-SWVoyXWH.js";import{_ as w}from"./Point-DB4Hp4hH.js";function J(n,t){return v(n,()=>t)}function cn(n){return v(n,t=>t.plane)}function v(n,t){const r=i(),l=i();let o=!1;return e=>{const a=t(e);if(e.action==="start"){const c=f(e.screenStart,E(R.get())),u=g(n.state.camera,c,x);u!=null&&(o=C(a,u,r))}if(!o)return null;const s=f(e.screenEnd,E(R.get())),d=g(n.state.camera,s,x);return d==null?null:C(a,d,l)?{...e,renderStart:r,renderEnd:l,plane:a,ray:d}:null}}function K(n,t,r=0,l=null,o=null){let e=null;return a=>{if(a.action==="start"&&(e=n.sceneIntersectionHelper.intersectElevationFromScreen(S(a.screenStart.x,a.screenStart.y),t,r,o),e!=null&&l!=null&&!I(e,e,l))||e==null)return null;const s=n.sceneIntersectionHelper.intersectElevationFromScreen(S(a.screenEnd.x,a.screenEnd.y),t,r,o);return s!=null&&(l==null||I(s,s,l))?{...a,mapStart:e,mapEnd:s}:null}}function L(n,t,r,l=null,o=null){return K(n,r,_(t,n,r),l,o)}function dn(n,t,r,l){const o=r.toMap(n.screenStart);return o!=null?L(t,o,r.elevationInfo,l):null}function Q(n,t){const r=D,l=M,o=F();n.renderCoordsHelper.worldUpAtPosition(t,r);const e=T(G(o),r,$(l,t,n.state.camera.eye));return T(e,e,r),U(t,e,o)}function pn(n,t,r){let l=null;const o=new B;return o.next(J(n,Q(n,t))).next(V(n,t)).next(W(n,r)).next(e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,l=e}),e=>(l=null,o.execute(e),l)}function V(n,t){const r=i(),l=y(t);n.renderCoordsHelper.worldUpAtPosition(t,r);const o=i(),e=i(),a=s=>($(s,s,t),b(r,s,s),n.viewingMode==="global"&&y(s)*Math.sign(N(r,s))<.001-l&&$(s,P(s,r,.001),t),h(s,s,t),s);return s=>(s.renderStart=a(H(o,s.renderStart)),s.renderEnd=a(H(e,s.renderEnd)),s)}function mn(n,t){const r=l=>{const o=f(l,E(R.get())),e=g(n.state.camera,o,x);return e==null?null:k(t,e,D,M)[1]};return l=>{const o=r(l.screenStart);if(o==null)return null;const e=r(l.screenEnd);return e==null?null:{...l,renderStart:o,renderEnd:e}}}function W(n,t){const r=n.renderCoordsHelper;return l=>{const o=r.fromRenderCoords(l.renderStart,new w({spatialReference:t})),e=r.fromRenderCoords(l.renderEnd,new w({spatialReference:t}));return o!=null&&e!=null?{...l,mapStart:o,mapEnd:e}:null}}var m;function fn(n){let t=null;return r=>{switch(r.action){case"start":t=n.disableDisplay();break;case"end":case"cancel":t!=null&&(t.remove(),t=null)}return r}}function En(n,t=null){const r=q(n.state.viewingMode);r.options.selectionMode=!0,r.options.store=j.MIN,r.options.hud=!1;const l=S(),o={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},e=i(),a=t??n.spatialReference,s=c=>{n.map.ground&&n.map.ground.opacity<1?o.exclude.add(O):o.exclude.delete(O),n.sceneIntersectionHelper.intersectIntersectorScreen(f(c,l),r,o);const u=r.results.min;let p;if(u.getIntersectionPoint(e))p=u.intersector===z.TERRAIN?m.GROUND:m.OTHER;else{if(!r.results.ground.getIntersectionPoint(e))return null;p=m.GROUND}return{location:n.renderCoordsHelper.fromRenderCoords(e,new w({spatialReference:a})),surfaceType:p}};let d;return c=>{if(c.action==="start"){const p=s(c.screenStart);d=p!=null?p.location:null}if(d==null)return null;const u=s(c.screenEnd);return(u==null?void 0:u.location)!=null?{...c,mapStart:d,mapEnd:u.location,surfaceType:u.surfaceType}:null}}(function(n){n[n.GROUND=0]="GROUND",n[n.OTHER=1]="OTHER"})(m||(m={}));const D=i(),M=i(),x=A();export{W as A,cn as C,L as D,m as F,pn as G,dn as M,J as O,mn as k,fn as q,En as z};
