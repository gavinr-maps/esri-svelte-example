import{o as Pe,r as qe,a as ke,i as ze}from"./colorUtils-0bJDPow9.js";import{b as A}from"./subclass-BZA_h8Db.js";import{t as Ie,e as Re,p as Se,f as Me,m as Ne,a as Te,d as De,c as Le}from"./utils-93yNk4Xc.js";function Ue(r,o){function i(){this.constructor=r}i.prototype=o.prototype,r.prototype=new i}function S(r,o,i,e){var g=Error.call(this,r);return Object.setPrototypeOf&&Object.setPrototypeOf(g,S.prototype),g.expected=o,g.found=i,g.location=e,g.name="SyntaxError",g}function H(r,o,i){return i=i||" ",r.length>o?r:(o-=r.length,r+(i+=i.repeat(o)).slice(0,o))}function Be(r,o){var i,e={},g=(o=o!==void 0?o:{}).grammarSource,$={start:mt},k=mt,z="none",I=")",p=",",v="(",C="%",y="px",V="cm",W="mm",X="in",Y="pt",Z="pc",_="deg",tt="rad",et="grad",rt="turn",yt="#",wt=".",xt="e",nt=/^[ \t\n\r]/,ut=/^[a-z\-]/,at=/^[0-9a-fA-F]/,ot=/^[+\-]/,P=/^[0-9]/,At=O("none"),bt=w("none",!1),Ft=w(")",!1),ct=w(",",!1),$t=O("whitespace"),it=N([" ","	",`
`,"\r"],!1,!1),Ct=O("function"),Et=w("(",!1),jt=O("identifier"),lt=N([["a","z"],"-"],!1,!1),Ot=O("percentage"),Pt=w("%",!1),qt=O("length"),kt=w("px",!1),zt=w("cm",!1),It=w("mm",!1),Rt=w("in",!1),St=w("pt",!1),Mt=w("pc",!1),Nt=O("angle"),Tt=w("deg",!1),Dt=w("rad",!1),Lt=w("grad",!1),Ut=w("turn",!1),Bt=O("number"),Gt=O("color"),Ht=w("#",!1),st=N([["0","9"],["a","f"],["A","F"]],!1,!1),ft=N(["+","-"],!1,!1),q=N([["0","9"]],!1,!1),Jt=w(".",!1),Kt=w("e",!1),Qt=function(){return[]},Vt=function(t,u){return{type:"function",name:t,parameters:u||[]}},Wt=function(t,u){return u.length>0?Oe(t,u,3):[t]},Xt=function(t){return{type:"quantity",value:t.value,unit:t.unit}},Yt=function(t){return{type:"color",colorType:t.type,value:t.value}},Zt=function(t){return t},_t=function(){return L()},te=function(t){return{value:t,unit:"%"}},ee=function(t){return{value:t,unit:"px"}},re=function(t){return{value:t,unit:"cm"}},ne=function(t){return{value:t,unit:"mm"}},ue=function(t){return{value:t,unit:"in"}},ae=function(t){return{value:t,unit:"pt"}},oe=function(t){return{value:t,unit:"pc"}},ce=function(t){return{value:t,unit:"deg"}},ie=function(t){return{value:t,unit:"rad"}},le=function(t){return{value:t,unit:"grad"}},se=function(t){return{value:t,unit:"turn"}},fe=function(t){return{value:t,unit:null}},pe=function(){return{type:"hex",value:L()}},he=function(t){return{type:"function",value:t}},me=function(){return{type:"named",value:L()}},ge=function(){return parseFloat(L())},n=0|o.peg$currPos,h=n,R=[{line:1,column:1}],E=n,D=o.peg$maxFailExpected||[],c=0|o.peg$silentFails;if(o.startRule){if(!(o.startRule in $))throw new Error(`Can't start parsing from rule "`+o.startRule+'".');k=$[o.startRule]}function L(){return r.substring(h,n)}function w(t,u){return{type:"literal",text:t,ignoreCase:u}}function N(t,u,a){return{type:"class",parts:t,inverted:u,ignoreCase:a}}function ve(){return{type:"end"}}function O(t){return{type:"other",description:t}}function pt(t){var u,a=R[t];if(a)return a;if(t>=R.length)u=R.length-1;else for(u=t;!R[--u];);for(a={line:(a=R[u]).line,column:a.column};u<t;)r.charCodeAt(u)===10?(a.line++,a.column=1):a.column++,u++;return R[t]=a,a}function ht(t,u,a){var l=pt(t),f=pt(u);return{source:g,start:{offset:t,line:l.line,column:l.column},end:{offset:u,line:f.line,column:f.column}}}function s(t){n<E||(n>E&&(E=n,D=[]),D.push(t))}function de(t,u,a){return new S(S.buildMessage(t,u),t,u,a)}function mt(){var t;return(t=ye())===e&&(t=we()),t}function ye(){var t,u;return c++,t=n,x(),r.substr(n,4)===z?(u=z,n+=4):(u=e,c===0&&s(bt)),u!==e?(x(),h=t,t=Qt()):(n=t,t=e),c--,t===e&&c===0&&s(At),t}function we(){var t,u;if(t=[],(u=B())!==e)for(;u!==e;)t.push(u),u=B();else t=e;return t}function B(){var t,u,a,l;return t=n,x(),(u=Ae())!==e?(x(),(a=xe())===e&&(a=null),x(),r.charCodeAt(n)===41?(l=I,n++):(l=e,c===0&&s(Ft)),l!==e?(x(),h=t,t=Vt(u,a)):(n=t,t=e)):(n=t,t=e),t}function xe(){var t,u,a,l,f,m,d,b;if(t=n,(u=G())!==e){for(a=[],l=n,f=x(),r.charCodeAt(n)===44?(m=p,n++):(m=e,c===0&&s(ct)),m===e&&(m=null),d=x(),(b=G())!==e?l=f=[f,m,d,b]:(n=l,l=e);l!==e;)a.push(l),l=n,f=x(),r.charCodeAt(n)===44?(m=p,n++):(m=e,c===0&&s(ct)),m===e&&(m=null),d=x(),(b=G())!==e?l=f=[f,m,d,b]:(n=l,l=e);h=t,t=Wt(u,a)}else n=t,t=e;return t}function G(){var t,u;return t=n,(u=be())===e&&(u=Fe())===e&&(u=$e())===e&&(u=Ce()),u!==e&&(h=t,u=Xt(u)),(t=u)===e&&(t=n,(u=Ee())!==e&&(h=t,u=Yt(u)),t=u),t}function x(){var t,u;for(c++,t=[],u=r.charAt(n),nt.test(u)?n++:(u=e,c===0&&s(it));u!==e;)t.push(u),u=r.charAt(n),nt.test(u)?n++:(u=e,c===0&&s(it));return c--,u=e,c===0&&s($t),t}function Ae(){var t,u,a;return c++,t=n,(u=gt())!==e?(r.charCodeAt(n)===40?(a=v,n++):(a=e,c===0&&s(Et)),a!==e?(h=t,t=Zt(u)):(n=t,t=e)):(n=t,t=e),c--,t===e&&(u=e,c===0&&s(Ct)),t}function gt(){var t,u,a;if(c++,t=n,u=[],a=r.charAt(n),ut.test(a)?n++:(a=e,c===0&&s(lt)),a!==e)for(;a!==e;)u.push(a),a=r.charAt(n),ut.test(a)?n++:(a=e,c===0&&s(lt));else u=e;return u!==e&&(h=t,u=_t()),c--,(t=u)===e&&(u=e,c===0&&s(jt)),t}function be(){var t,u,a;return c++,t=n,x(),(u=F())!==e?(r.charCodeAt(n)===37?(a=C,n++):(a=e,c===0&&s(Pt)),a!==e?(h=t,t=te(u)):(n=t,t=e)):(n=t,t=e),c--,t===e&&c===0&&s(Ot),t}function Fe(){var t,u,a;return c++,t=n,x(),(u=F())!==e?(r.substr(n,2)===y?(a=y,n+=2):(a=e,c===0&&s(kt)),a!==e?(h=t,t=ee(u)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,x(),(u=F())!==e?(r.substr(n,2)===V?(a=V,n+=2):(a=e,c===0&&s(zt)),a!==e?(h=t,t=re(u)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,x(),(u=F())!==e?(r.substr(n,2)===W?(a=W,n+=2):(a=e,c===0&&s(It)),a!==e?(h=t,t=ne(u)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,x(),(u=F())!==e?(r.substr(n,2)===X?(a=X,n+=2):(a=e,c===0&&s(Rt)),a!==e?(h=t,t=ue(u)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,x(),(u=F())!==e?(r.substr(n,2)===Y?(a=Y,n+=2):(a=e,c===0&&s(St)),a!==e?(h=t,t=ae(u)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,x(),(u=F())!==e?(r.substr(n,2)===Z?(a=Z,n+=2):(a=e,c===0&&s(Mt)),a!==e?(h=t,t=oe(u)):(n=t,t=e)):(n=t,t=e)))))),c--,t===e&&c===0&&s(qt),t}function $e(){var t,u,a;return c++,t=n,(u=F())!==e?(r.substr(n,3)===_?(a=_,n+=3):(a=e,c===0&&s(Tt)),a!==e?(h=t,t=ce(u)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(u=F())!==e?(r.substr(n,3)===tt?(a=tt,n+=3):(a=e,c===0&&s(Dt)),a!==e?(h=t,t=ie(u)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(u=F())!==e?(r.substr(n,4)===et?(a=et,n+=4):(a=e,c===0&&s(Lt)),a!==e?(h=t,t=le(u)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(u=F())!==e?(r.substr(n,4)===rt?(a=rt,n+=4):(a=e,c===0&&s(Ut)),a!==e?(h=t,t=se(u)):(n=t,t=e)):(n=t,t=e)))),c--,t===e&&(u=e,c===0&&s(Nt)),t}function Ce(){var t,u;return c++,t=n,x(),(u=F())!==e?(h=t,t=fe(u)):(n=t,t=e),c--,t===e&&c===0&&s(Bt),t}function Ee(){var t,u,a,l;if(c++,t=n,r.charCodeAt(n)===35?(u=yt,n++):(u=e,c===0&&s(Ht)),u!==e){if(a=[],l=r.charAt(n),at.test(l)?n++:(l=e,c===0&&s(st)),l!==e)for(;l!==e;)a.push(l),l=r.charAt(n),at.test(l)?n++:(l=e,c===0&&s(st));else a=e;a!==e?(h=t,t=pe()):(n=t,t=e)}else n=t,t=e;return t===e&&(t=n,(u=B())!==e&&(h=t,u=he(u)),(t=u)===e&&(t=n,(u=gt())!==e&&(h=t,u=me()),t=u)),c--,t===e&&(u=e,c===0&&s(Gt)),t}function F(){var t,u,a,l,f,m,d,b;for(t=n,u=r.charAt(n),ot.test(u)?n++:(u=e,c===0&&s(ft)),u===e&&(u=null),a=n,l=[],f=r.charAt(n),P.test(f)?n++:(f=e,c===0&&s(q));f!==e;)l.push(f),f=r.charAt(n),P.test(f)?n++:(f=e,c===0&&s(q));if(r.charCodeAt(n)===46?(f=wt,n++):(f=e,c===0&&s(Jt)),f!==e){if(m=[],d=r.charAt(n),P.test(d)?n++:(d=e,c===0&&s(q)),d!==e)for(;d!==e;)m.push(d),d=r.charAt(n),P.test(d)?n++:(d=e,c===0&&s(q));else m=e;m!==e?a=l=[l,f,m]:(n=a,a=e)}else n=a,a=e;if(a===e)if(a=[],l=r.charAt(n),P.test(l)?n++:(l=e,c===0&&s(q)),l!==e)for(;l!==e;)a.push(l),l=r.charAt(n),P.test(l)?n++:(l=e,c===0&&s(q));else a=e;if(a!==e){if(l=n,r.charCodeAt(n)===101?(f=xt,n++):(f=e,c===0&&s(Kt)),f!==e){if(m=r.charAt(n),ot.test(m)?n++:(m=e,c===0&&s(ft)),m===e&&(m=null),d=[],b=r.charAt(n),P.test(b)?n++:(b=e,c===0&&s(q)),b!==e)for(;b!==e;)d.push(b),b=r.charAt(n),P.test(b)?n++:(b=e,c===0&&s(q));else d=e;d!==e?l=f=[f,m,d]:(n=l,l=e)}else n=l,l=e;l===e&&(l=null),h=t,t=ge()}else n=t,t=e;return t}function je(t,u){return t.map(function(a){return a[u]})}function Oe(t,u,a){return[t].concat(je(u,a))}if(i=k(),o.peg$library)return{peg$result:i,peg$currPos:n,peg$FAILED:e,peg$maxFailExpected:D,peg$maxFailPos:E};if(i!==e&&n===r.length)return i;throw i!==e&&n<r.length&&s(ve()),de(D,E<r.length?r.charAt(E):null,E<r.length?ht(E,E+1):ht(E,E))}function lr(r){if(!r||r.length===0)return null;if(typeof r=="string"){const i=vt(r);return i&&i.length!==0?i:null}const o=r.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new A("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:vt(i.value)}});o.sort((i,e)=>e.effects.length-i.effects.length);for(let i=0;i<o.length-1;i++){if(!Ie(o[i].effects,o[i+1].effects))throw new A("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:o[i].effects,b:o[i+1].effects});Re(o[i].effects,o[i+1].effects)}return o.sort((i,e)=>e.scale-i.scale),o}function vt(r){let o;if(!r)return[];try{o=Be(r)}catch(i){throw new A("effect:invalid-syntax","Invalid effect syntax",{value:r,error:i})}return o.map(i=>Ge(i))}function Ge(r){try{switch(r.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return He(r);case"opacity":return Je(r);case"hue-rotate":return Ke(r);case"blur":return Qe(r);case"drop-shadow":return Ve(r);case"bloom":return We(r)}}catch(o){throw o.details.filter=r,o}throw new A("effect:unknown-effect",`Effect '${r.name}' is not supported`,{effect:r})}function He(r){let o=1;return M(r.parameters,1),r.parameters.length===1&&(o=j(r.parameters[0])),new Se(r.name,o)}function Je(r){let o=1;return M(r.parameters,1),r.parameters.length===1&&(o=j(r.parameters[0])),new Me(o)}function Ke(r){let o=0;return M(r.parameters,1),r.parameters.length===1&&(o=er(r.parameters[0])),new Ne(o)}function Qe(r){let o=0;return M(r.parameters,1),r.parameters.length===1&&(o=Q(r.parameters[0]),T(o,r.parameters[0])),new Te(o)}function Ve(r){const o=[];let i=null;for(const e of r.parameters)if(e.type==="color"){if(o.length&&Object.freeze(o),i)throw new A("effect:type-error","Accepts only one color",{});i=rr(e)}else{const g=Q(e);if(Object.isFrozen(o))throw new A("effect:type-error","<length> parameters not consecutive",{lengths:o});o.push(g),o.length===3&&T(g,e)}if(o.length<2||o.length>3)throw new A("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${o.length}}`,{lengths:o});return new De(o[0],o[1],o[2]||0,i||dt("black"))}function We(r){let o=1,i=0,e=0;return M(r.parameters,3),r.parameters[0]&&(o=j(r.parameters[0])),r.parameters[1]&&(i=Q(r.parameters[1]),T(i,r.parameters[1])),r.parameters[2]&&(e=j(r.parameters[2])),new Le(o,i,e)}function M(r,o){if(r.length>o)throw new A("effect:type-error",`Function supports up to ${o} parameters, Actual: ${r.length}`,{parameters:r})}function U(r){if(r.type==="color")return"<color>";if(r.unit){if(r.unit in K)return"<length>";if(r.unit in J)return"<angle>";if(r.unit==="%")return"<percentage>"}return"<double>"}function T(r,o){if(r<0)throw new A("effect:type-error",`Negative values are not allowed, Actual: ${r}`,{term:o})}function Xe(r){if(r.type!=="quantity"||r.unit!==null)throw new A("effect:type-error",`Expected <double>, Actual: ${U(r)}`,{term:r})}function Ye(r){if(r.type!=="quantity"||r.unit!==null&&r.unit!=="%")throw new A("effect:type-error",`Expected <double> or <percentage>, Actual: ${U(r)}`,{term:r})}Ue(S,Error),S.prototype.format=function(r){var o="Error: "+this.message;if(this.location){var i,e=null;for(i=0;i<r.length;i++)if(r[i].source===this.location.source){e=r[i].text.split(/\r\n|\n|\r/g);break}var g=this.location.start,$=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(g):g,k=this.location.source+":"+$.line+":"+$.column;if(e){var z=this.location.end,I=H("",$.line.toString().length," "),p=e[g.line-1],v=(g.line===z.line?z.column:p.length+1)-g.column||1;o+=`
 --> `+k+`
`+I+` |
`+$.line+" | "+p+`
`+I+" | "+H("",g.column-1," ")+H("",v,"^")}else o+=`
 at `+k}return o},S.buildMessage=function(r,o){var i={literal:function(p){return'"'+g(p.text)+'"'},class:function(p){var v=p.parts.map(function(C){return Array.isArray(C)?$(C[0])+"-"+$(C[1]):$(C)});return"["+(p.inverted?"^":"")+v.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(p){return p.description}};function e(p){return p.charCodeAt(0).toString(16).toUpperCase()}function g(p){return p.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+e(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+e(v)})}function $(p){return p.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+e(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+e(v)})}function k(p){return i[p.type](p)}function z(p){var v,C,y=p.map(k);if(y.sort(),y.length>0){for(v=1,C=1;v<y.length;v++)y[v-1]!==y[v]&&(y[C]=y[v],C++);y.length=C}switch(y.length){case 1:return y[0];case 2:return y[0]+" or "+y[1];default:return y.slice(0,-1).join(", ")+", or "+y[y.length-1]}}function I(p){return p?'"'+g(p)+'"':"end of input"}return"Expected "+z(r)+" but "+I(o)+" found."};const J={deg:1,grad:.9,rad:180/Math.PI,turn:360};function Ze(r){if(r.type!=="quantity"||!(r.value===0&&r.unit===null||r.unit&&J[r.unit]!=null))throw new A("effect:type-error",`Expected <angle>, Actual: ${U(r)}`,{term:r})}const K={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function _e(r){if(r.type!=="quantity"||!(r.value===0&&r.unit===null||r.unit&&K[r.unit]!=null))throw new A("effect:type-error",`Expected <length>, Actual: ${U(r)}`,{term:r})}function j(r){Ye(r);const o=r.value;return T(o,r),r.unit==="%"?.01*o:o}function tr(r){return Xe(r),T(r.value,r),r.value}function er(r){return Ze(r),r.value*J[r.unit]||0}function Q(r){return _e(r),r.value*K[r.unit]||0}function rr(r){switch(r.colorType){case"hex":return Pe(r.value);case"named":return dt(r.value);case"function":return ar(r.value)}}function dt(r){if(!qe(r))throw new A("effect:unknown-color",`color '${r}' isn't valid`,{namedColor:r});return ke(r)}const nr=/^rgba?/i,ur=/^hsla?/i;function ar(r){if(M(r.parameters,4),nr.test(r.name))return[j(r.parameters[0]),j(r.parameters[1]),j(r.parameters[2]),r.parameters[3]?j(r.parameters[3]):1];if(ur.test(r.name))return ze(tr(r.parameters[0]),j(r.parameters[1]),j(r.parameters[2]),r.parameters[3]?j(r.parameters[3]):1);throw new A("effect:syntax-error",`Invalid color function '${r.name}'`,{colorFunction:r})}export{lr as d};
