import{s,M as l,B as m,O as c}from"./Accessor-BmwT4B0c.js";import{E as g,j as d}from"./Point-Cz2JYYmX.js";import{C as f}from"./Portal-CmmHxpLg.js";import{m as p,n as v}from"./project-CvBujuEW.js";const u=()=>m.getLogger("esri.widgets.support.geolocationUtils"),w={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function h(){const e=!!l("esri-geolocation");return e||u().warn("geolocation-unsupported","Geolocation unsupported."),e}function y(){const e=window.isSecureContext;return e||u().warnOnce("insecure-context","Geolocation requires a secure origin."),e}function O(){return h()&&y()}function R(e){return e??(e=w),new Promise((o,r)=>{setTimeout(()=>r(new s("geolocation:timeout","getting the current geolocation position timed out")),15e3),navigator.geolocation.getCurrentPosition(o,r,e??void 0)})}function U(e,t){const{position:o,view:r}=e,i=S(o),n=i==null?void 0:i.coords;if(!n)throw new s("geometry-service:no-coords","Geolocation has no coordinates");return P($(n),r,t)}function S(e){const t=e&&e.coords||{},o={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed,toJSON:()=>({})};return e&&{coords:o,timestamp:e.timestamp,toJSON:()=>({})}}function $({longitude:e,latitude:t,altitude:o}){return new d({longitude:e,latitude:t,z:o||void 0,spatialReference:{wkid:4326}})}function P(e,t,o){if(!t)return Promise.resolve(e);const r=t.spatialReference;return r.isWGS84?Promise.resolve(e):r.isWebMercator?Promise.resolve(g(e)):G(o).then(i=>{if(!i)throw new s("geometry-service:missing-url","Geometry service URL is missing");const n=new p({geometries:[e],outSpatialReference:r});return v(i,n,o).then(a=>a[0])})}function G(e){if(c.geometryServiceUrl)return Promise.resolve(c.geometryServiceUrl);const t=f.getDefault();return t.load(e).catch(()=>{}).then(()=>{var o,r;return(r=(o=t.helperServices)==null?void 0:o.geometry)==null?void 0:r.url})}export{U as f,O as g,R as p};
