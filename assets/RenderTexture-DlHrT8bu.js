import{s as m}from"./mathUtils-Cfq9PL9W.js";import{n as E}from"./vec3f64-BLpZdpfb.js";import{F as x,I as A,N as n,L as c,d as I}from"./projectBuffer-CQnuEMuP.js";import{t as h}from"./Point-Cz2JYYmX.js";import{S as C,K as p}from"./Accessor-BmwT4B0c.js";function U(t,o,e,s){if(o==null||s==null)return!1;const r=x(o,s);if((r==null?void 0:r.projector)==null)return!1;if(r.projector===A)return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],!0;const{source:i,dest:a,projector:R}=r;if(a.spatialReferenceId===n.WEB_MERCATOR){const u=c[i.spatialReferenceId][n.WGS84];return u!=null&&(u(t,0,l,0),I(l,0,e,0),e[3]=_(l[1],t[2],t[3],h.radius),!0)}if(i.spatialReferenceId!==n.WGS84&&i.spatialReferenceId!==n.CGCS2000||a.spatialReferenceId!==n.PLATE_CARREE){R(t,0,e,0);const u=i.metersPerUnit??1,f=a.metersPerUnit??1;e[3]=t[3]*u/f}else{const u=c[i.spatialReferenceId][n.SPHERICAL_ECEF],f=c[n.SPHERICAL_ECEF][n.PLATE_CARREE];let d=t[3];u!=null&&f!=null&&(d=_(t[1],t[2],t[3],h.radius)),R(t,0,e,0),e[3]=d}return!0}function _(t,o,e,s){const r=s+o;if(r<s/2||e>r)return Number.MAX_VALUE;const i=Math.abs(P*t)+Math.asin(e/r);return i>=Math.PI/2?Number.MAX_VALUE:e/Math.cos(i)}const l=E(),P=m(1);class b{constructor(o,e){this._textures=o,this.loadPromise=null,this._disposed=!1;const s=this._textures.acquire(e);C(s)?(s.then(r=>{this._disposed?p(r):this._textureRef=r}),this.loadPromise=s):this._textureRef=s}dispose(){this._textureRef=p(this._textureRef),this._disposed=!0}get glTexture(){return this._textureRef!=null?this._textureRef.glTexture:null}}export{U as l,b as s};
