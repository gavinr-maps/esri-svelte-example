import{V as B}from"./Collection-CEdjem1-.js";import{j as M,g as L,P as Z,ao as _,ac as N,z as J,a8 as K,a9 as Q,Z as X,ad as k,ae as Y}from"./Point-Cg0-ChZE.js";import{M as ee}from"./layerUtils-BrNoooE9.js";import{l as I}from"./ViewingMode-Dodu7ZZk.js";import{b as h}from"./subclass-BZA_h8Db.js";import{s as te,c as H,P as U,u as ie,g as ne}from"./vec32-Dvg_eL9J.js";import{n as $}from"./vec3f64-BLpZdpfb.js";import{b,N as le,O as re,o as oe}from"./Polyline-D9YkgmM_.js";import{s as E,m as z,B as se,w as ae,d as ce}from"./mathUtils-C4_ghTv4.js";import"./geometry-D964gYQX.js";import{w as ue}from"./Extent-Bf3YTe7m.js";import{z as O,p as y}from"./TileInfo-Dphjf6xH.js";const fe=12;let d=class m{constructor(t){const i=m.checkUnsupported(t);if(i!=null)throw i;const n=t;this.spatialReference=n.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=Z(this.spatialReference),this.origin=[n.origin.x,n.origin.y],this.pixelSize=n.size[0],this.dpi=n.dpi;const l=n.lods.reduce((c,f)=>(f.level<c.minLod.level&&(c.minLod=f),c.max=Math.max(c.max,f.level),c),{minLod:n.lods[0],max:-1/0}),r=l.minLod,s=2**r.level;let a=r.resolution*s,u=r.scale*s;this.levels=new Array(l.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:u,tileSize:[a*n.size[0],a*n.size[1]]},a/=2,u/=2}clone(){return new m(this.toTileInfo())}toTileInfo(){return new O({dpi:this.dpi,origin:new M({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,i)=>new y({level:i,scale:t.scale,resolution:t.resolution}))})}getExtent(t,i,n,l){const r=this.levels[t],s=r.tileSize[0],a=r.tileSize[1];l[0]=this.origin[0]+n*s,l[2]=this.origin[0]+(n+1)*s,l[3]=this.origin[1]-i*a,l[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(t,i){this._isWebMercator?(i[0]=_(t[0]),i[1]=N(t[1]),i[2]=_(t[2]),i[3]=N(t[3])):this._isGCS&&(i[0]=E(t[0]),i[1]=E(t[1]),i[2]=E(t[2]),i[3]=E(t[3]))}getExtentGeometry(t,i,n,l=new ue){return this.getExtent(t,i,n,g),l.spatialReference=this.spatialReference,l.xmin=g[0],l.ymin=g[1],l.xmax=g[2],l.ymax=g[3],l.zmin=void 0,l.zmax=void 0,l}ensureMaxLod(t){if(t==null)return!1;let i=!1;for(;this.levels.length<=t;){const{resolution:n,scale:l}=this.levels[this.levels.length-1],r=n/2*this.pixelSize;this.levels.push({resolution:n/2,scale:l/2,tileSize:[r,r]}),i=!0}return i}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const i=this.levels[0].scale;return t>=i?0:Math.log(i/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t,i=1/0){if(m.checkUnsupported(t))return!1;const n=new m(t);if(!n.spatialReference.equals(this.spatialReference)||n.pixelSize!==this.pixelSize)return!1;const l=Math.min(this.levels.length-1,n.levels.length-1,i),r=this.levels[l].resolution;let s=.5*r;return!z(n.origin[0],this.origin[0],s)||!z(n.origin[1],this.origin[1],s)?!1:(s=.5*r/2**l/this.pixelSize*fe,z(r,n.levels[l].resolution,s))}rootTilesInExtent(t,i=null,n=1/0){const l=new Array,r=this.levels[0].tileSize;if(t==null||r[0]===0||r[1]===0)return l;m.computeRowColExtent(t,r,this.origin,g);let s=g[1],a=g[3],u=g[0],c=g[2];const f=c-u,x=a-s;if(f*x>n){const p=Math.floor(Math.sqrt(n));x>p&&(s=s+Math.floor(.5*x)-Math.floor(.5*p),a=s+p),f>p&&(u=u+Math.floor(.5*f)-Math.floor(.5*p),c=u+p)}for(let p=s;p<a;p++)for(let W=u;W<c;W++)l.push([0,p,W]);return i!=null&&(i[0]=this.origin[0]+u*r[0],i[1]=this.origin[1]-a*r[1],i[2]=this.origin[0]+c*r[0],i[3]=this.origin[1]-s*r[1]),l}static computeRowColExtent(t,i,n,l){const r=.001*(t[2]-t[0]+(t[3]-t[1]));l[0]=Math.max(0,Math.floor((t[0]+r-n[0])/i[0])),l[2]=Math.max(0,Math.ceil((t[2]-r-n[0])/i[0])),l[1]=Math.max(0,Math.floor((n[1]-t[3]+r)/i[1])),l[3]=Math.max(0,Math.ceil((n[1]-t[1]-r)/i[1]))}static isPowerOfTwo(t){const i=t.lods,n=i[0].resolution*2**i[0].level;return!i.some(l=>!se(l.resolution,n/2**l.level))}static hasGapInLevels(t){const i=t.lods.map(n=>n.level);i.sort((n,l)=>n-l);for(let n=1;n<i.length;n++)if(i[n]!==i[0]+n)return!0;return!1}static tileSizeSupported(t){const i=t.size[1];return i===t.size[0]&&!(i&i-1)&&i>=128&&i<=512}static hasOriginPerLODs(t){const i=t.origin;return t.lods.some(n=>n.origin!=null&&(n.origin[0]!==i.x||n.origin[1]!==i.y))}static getMissingTileInfoError(){return new h("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return t==null?A():t.lods.length<1?new h("tilingscheme:generic","Tiling scheme must have at least one level"):m.isPowerOfTwo(t)?m.hasGapInLevels(t)?new h("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):m.tileSizeSupported(t)?m.hasOriginPerLODs(t)?new h("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new h("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new h("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,i){const n=t[2]-t[0],l=t[3]-t[1],r=J(i),s=1.2*Math.max(n,l),a=256,u=s/a,c=u*r*(96/.0254),f=new m(new O({size:[a,a],origin:new M({x:t[0]-.5*(s-n),y:t[3]+.5*(s-l)}),lods:[new y({level:0,resolution:u,scale:c})],spatialReference:i}));return f.ensureMaxLod(20),f}static makeWebMercatorAuxiliarySphere(t){const i=new m(m.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(t),i}static makeGCSWithTileSize(t,i=256,n=16){const l=256/i,r=new m(new O({size:[i,i],origin:new M({x:-180,y:90,spatialReference:t}),spatialReference:t,lods:[new y({level:0,resolution:.703125*l,scale:295497598570834e-6*l})]}));return r.ensureMaxLod(n),r}get test(){}};function A(){return new h("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}d.WebMercatorAuxiliarySphereTileInfo=new O({size:[256,256],origin:new M({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:L.WebMercator}),spatialReference:L.WebMercator,lods:[new y({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),d.WebMercatorAuxiliarySphere=d.makeWebMercatorAuxiliarySphere(19);const g=b(),G=64,Je=512,Ke=2.5,Qe=ae(ce/10),Xe=2,he=b();d.WebMercatorAuxiliarySphere.getExtent(0,0,0,he);const Ye=b([-180,-90,180,90]),et="Cannot extend surface to encompass all layers because it would result in too many root tiles.",tt="Surface extent is too large for tile resolution at level 0.",it=4;function me(e){return e!=null&&"type"in e&&e.type==="vector-tile"}function pe(e){return e!=null&&"type"in e&&e.type==="raster-tile"}function ge(e){return e!=null&&"type"in e&&e.type==="tile-texture"}function Te(e){return e!=null&&"type"in e&&e.type==="image+type"}var o;(function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"})(o||(o={}));function Se(e){return P(e)||K(e)||Q(e)}function P(e){return X(e)||k(e)}const w=$(),de=$(),T=$(),S=$();function xe(e,t,i=0){const n=e.extent;if(n==null)return!1;if(i===0)return le(n,t);const l=Math.min(n[2]-n[0],n[3]-n[1]);return re(n,t,i*l)}function v(e,t,i,n){te(w,i),w[n]=t[n];const l=H(w,w,t),r=H(de,e,t),s=U(r,l),a=U(l,l);let u;u=s<=0?t:a<=s?i:ie(w,t,ne(l,l,s/a));const c=H(w,e,u);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function we(e,t,i){const n=e.extent;if(n==null)return 0;T[0]=n[0],T[1]=n[1],T[2]=i,S[0]=n[2],S[1]=n[3],S[2]=i;let l=1/0,r=1/0;return t[0]<T[0]?l=v(t,T,S,0):t[0]>S[0]&&(l=v(t,S,T,0)),t[1]<T[1]?r=v(t,T,S,1):t[1]>S[1]&&(r=v(t,S,T,1)),Math.min(l,r)}function Ee(e,t,i,n){if(e==null)return A();const l=e.spatialReference;if(l.isGeographic&&!P(l))return new h("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=d.checkUnsupported(e);return r??(i==null?new h("tilingscheme:extent-not-exist","The layer does not provide a layer extent."):ve(e,i)||(t==null||l.equals(t)||t.isWGS84&&l.isWebMercator?null:new h("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")))}function ve(e,t){const i=e.lods,n=i[0].resolution*2**i[0].level,l=[n*e.size[0],n*e.size[1]],r=[e.origin.x,e.origin.y],s=oe(t),a=b();d.computeRowColExtent(s,l,r,a);const u=(a[2]-a[0])*(a[3]-a[1]);if(u>G){const c=i[0].scale*2**i[0].level;let f=Math.max((s[3]-s[1])/e.size[1],(s[2]-s[0])/e.size[0])*c/n;const x=Math.floor(Math.log(f)/Math.log(10));return f=Math.ceil(f/10**x)*10**x,new h("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+f.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:f,requiredNumRootTiles:u,allowedNumRootTiles:G})}return null}const Me=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:Ee,isInsideExtent:xe,tiltToExtentEdge:we},Symbol.toStringTag,{value:"Module"}));function Oe(){return!0}function ye(){return 0}function Re(e,t,i,n){if(e==null)return A();const l=(e==null?void 0:e.lods.length)-1,r=e.spatialReference;if(r.isWebMercator){if(!d.makeWebMercatorAuxiliarySphere(l).compatibleWith(e,n))return new h("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!Se(r))return new h("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!d.makeGCSWithTileSize(e.spatialReference,e.size[0],l).compatibleWith(e,n))return e.spatialReference.isWGS84?new h("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new h("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return t==null||e.spatialReference.equals(t)?null:new h("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const $e=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:Re,isInsideExtent:Oe,tiltToExtentEdge:ye},Symbol.toStringTag,{value:"Module"})),be={[I.Global]:$e,[I.Local]:Me};function nt(e,t){e||console.warn("Terrain: "+t)}let R=!1,We=!1;function lt(e){We=e,R=R||e}function rt(e){R=e}function ot(e,t){var i;if(R&&!e){const n=(i=new Error().stack)==null?void 0:i.slice(5);throw console.warn("Terrain internal: "+(t??"")+" at "+n),new Error("Assertion failed"+(t?": "+t:""))}}function C(e){return(e==null?void 0:e.type)==="imagery-tile"||(e==null?void 0:e.type)==="wcs"}function V(e){return(e==null?void 0:e.type)==="imagery-tile-3d"}function j(e){return(e==null?void 0:e.type)==="tile-3d"}function q(e){return(e==null?void 0:e.type)==="vector-tile-3d"}function F(e){return(e==null?void 0:e.type)==="wmts-3d"}function He(e){return(e==null?void 0:e.type)==="elevation-3d"}function st(e){return(e==null?void 0:e.type)==="group"}function at(e){return e&&(j(e)||F(e)||V(e)||q(e))}function ze(e){return e&&(j(e)||V(e)||q(e)||F(e))}function ct(e){return ze(e)||He(e)}function ut(e){var t;return pe((t=e==null?void 0:e.sourceLayerInfo)==null?void 0:t.data)}function ft(e){return Ie(e==null?void 0:e.sourceLayerInfo)||!!(e!=null&&e.isVTLBackground)}function ht(e){var t;return ge((t=e==null?void 0:e.sourceLayerInfo)==null?void 0:t.data)}function mt(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return Te(t)||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData}function Ie(e){return me(e==null?void 0:e.data)}function pt(e){return e!=null&&"release"in e&&e.release(),null}function gt(e){return e.fetchTile&&e.hasOverriddenFetchTile!==!1}function D(e,t,i,n,l){return be[n].checkIfTileInfoSupportedForViewSR(e,i,t,l)}function Tt(e,t,i){var s;let n=null,l=null;if((e==null?void 0:e.type)==="wmts"){const a=Ae(e,t,i);n=a.tileInfo,l=a.fullExtent}else{l=C(e)?e.getCompatibleFullExtent(t):e.fullExtent;const a=i===I.Local;C(e)?n=e.getCompatibleTileInfo(t,l,a):(e==null?void 0:e.type)==="vector-tile"?n=a&&!Le(t)||_e.force512VTL?e.tileInfo:e.tileInfo.getCompatibleForVTL(256):n=e.tileInfo}const r="tilemapCache"in e?(s=e.tilemapCache)==null?void 0:s.effectiveMaxLOD:void 0;return n!=null&&l!=null&&D(n,l,t,i,r)==null?{tileInfo:n,fullExtent:l}:null}function Ae(e,t,i){const n=ee(e);if(n!=null){if(!B.isCollection(n))return{tileInfo:n.tileInfo,fullExtent:n.fullExtent};{const l=n.find(r=>D(r.tileInfo,r.fullExtent,t,i)==null);if(l)return{tileInfo:l.tileInfo,fullExtent:l.fullExtent}}}return{tileInfo:null,fullExtent:null}}function Le(e){return e.isWGS84||e.isWebMercator||k(e)||!Y(e)}const _e={force512VTL:!1};function St(e){return"["+e[0]+","+e[1]+","+e[2]+"]"}function dt(e){return"("+e[0]+","+e[1]+","+e[2]+")"}function xt(e,t,i=Ne){return Math.abs(e-t)<i}function wt(e){return e===o.NORTH_EAST?o.SOUTH_WEST:e===o.NORTH_WEST?o.SOUTH_EAST:e===o.SOUTH_WEST?o.NORTH_EAST:o.NORTH_WEST}function Et(e){return e===o.NORTH?o.SOUTH:e===o.EAST?o.WEST:e===o.SOUTH?o.NORTH:o.EAST}function vt(e){return e===o.NORTH_WEST||e===o.SOUTH_WEST}function Mt(e){return e===o.NORTH_WEST||e===o.NORTH_EAST}function Ot(e){return e===o.NORTH_WEST||e===o.WEST||e===o.SOUTH_WEST}function yt(e){return e===o.NORTH_EAST||e===o.EAST||e===o.SOUTH_EAST}function Rt(e){return e===o.SOUTH_EAST||e===o.SOUTH||e===o.SOUTH_WEST}function $t(e){return e===o.NORTH_EAST||e===o.NORTH||e===o.NORTH_WEST}const bt=[o.NORTH,o.EAST,o.SOUTH,o.WEST],Wt=[o.NORTH_EAST,o.SOUTH_EAST,o.SOUTH_WEST,o.NORTH_WEST],Ne=1e-5;export{bt as $,at as A,dt as B,pt as C,_e as D,R as E,Le as F,St as G,et as H,V as I,vt as J,Mt as K,tt as L,D as M,Ke as N,ct as O,xt as P,Ot as Q,q as R,nt as S,o as T,ze as U,Tt as V,st as W,yt as X,Rt as Y,$t as Z,C as _,ot as a,He as a0,rt as a1,lt as a2,gt as b,Ye as c,Je as d,it as e,d as f,Xe as g,ge as h,pe as i,ft as j,Ae as k,Qe as l,he as m,Wt as n,ut as o,We as p,wt as q,Te as r,mt as s,me as t,P as u,Ie as v,ht as w,Se as x,G as y,Et as z};
