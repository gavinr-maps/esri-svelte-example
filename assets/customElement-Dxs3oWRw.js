const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-DVEy4f7w.js","./index-CjrYEQXz.js","./jsxFactory-CLjKarlq.js","./Accessor-BHnuXKD2.js","./intl-Do3GEEJ7.js","./Promise-CmQqe-ke.js","./cast-BA_-jlhc.js","./index-tefRSezt.js","./index-Cx51aysm.css","./JSONSupport-CGdeqxpk.js","./Evented-DCWccWGU.js","./reactiveUtils-BR0C1Kq4.js","./SimpleObservable-7oieNGD8.js","./uuid-Cl5lrJ4c.js","./guid-ejniuQmw.js","./useT9n-CJAswmP1.js","./index-73bQemcW.js","./dom--xxYYVQF.js","./observers-BdozwIHb.js","./keyed-CdPY5MOf.js","./directive-helpers-C0aXnQdc.js","./ref-Ccn4I0kT.js","./interactive-B8siLByk.js","./loadable-DOQnSSjG.js","./component-CFGnHAqh.js","./index-ujykA9Eq.js","./index-cLdK6V3t.js","./index-Df8-0rWt.js","./floating-ui-BkLjHVN3.js","./debounce-DbkufipY.js","./key-CZcQa38B.js","./openCloseComponent-dw_x67D_.js","./dynamicClasses-pKEMtFzB.js","./index-DIB7yhJF.js","./resources6-Cs2_VmEC.js","./index-BfAp5_ga.js","./customElement-kBYuBfHB.js","./index-DIp-v4qk.js","./static-g4FJ4v8I.js","./FloatingArrow-D9X-HbKW.js","./useFocusTrap-ENcZoC4L.js","./focusTrapComponent-Br_3Mz8_.js","./index-CCqZjfSZ.js","./array-BbE1dLa5.js","./index-nrWOrFCt.js","./resources4-Crg87oFz.js","./index-DxcTRSkS.js","./index-CQ1gJMW-.js","./index-Ch_sYKt7.js","./form-B15gmg4q.js","./label-BLne9qNB.js","./Validation-O1TFEQW-.js","./index-DqW6JA5s.js"])))=>i.map(i=>d[i]);
import{_ as v,L as T,c as f,n as L,x as A,a as C}from"./index-tefRSezt.js";import{n as $}from"./ref-Ccn4I0kT.js";import{r,m as n,a as V,g as b,B as _,s as g}from"./Accessor-BHnuXKD2.js";import{e as D,O as I,c as P,n as i}from"./jsxFactory-CLjKarlq.js";import{f as S}from"./intl-Do3GEEJ7.js";import{V as O,d as U,P as M,v as R}from"./reactiveUtils-BR0C1Kq4.js";import{h as W}from"./UpdatingHandles-ptqz1ck8.js";import{r as F,x as H}from"./layerUtils-dJgsXxkC.js";import{C as q}from"./Portal-CTRRujjZ.js";import{s as z}from"./utils-Cf-KB5Fk.js";import{h as B}from"./Promise-CmQqe-ke.js";import{L as j,p as G,S as J}from"./component-utils-DWY0IMHC.js";import{a as K}from"./disconnected-B4PBI24G.js";import"./directive-helpers-C0aXnQdc.js";import"./Evented-DCWccWGU.js";import"./uuid-Cl5lrJ4c.js";import"./cast-BA_-jlhc.js";import"./JSONSupport-CGdeqxpk.js";import"./SimpleObservable-7oieNGD8.js";import"./writer-B2bQV2uU.js";import"./Extent-CBBGeHb-.js";import"./Point-XGrwlf63.js";const k={noDirtyAreasInExtent:-2147208940,noUtilityNetworkExtension:-2147208474,cannotAcquireVersionLock_v10:-2147217146,cannotAcquireVersionLock_v11:-2147220947};let d=class extends b{constructor(t){super(t),this._activeOperationDidSucceed=!1,this._initialValidationsFinished=!1,this._dirtyAreasLayer=null,this._serverVersion=null,this._updatingHandles=new W,this._validConstructProperties=!1,this.executionError="",this.extentToValidate="current",this.loadErrors=new O}initialize(){const t=async()=>{this.messages||(this.messages=await S("esri/widgets/UtilityNetworkValidateTopology/t9n/UtilityNetworkValidateTopology"))};t().then(()=>{this.view||(this.view=null),this.utilityNetwork||(this.utilityNetwork=null),this.addHandles([U(()=>[this.view,this.utilityNetwork],async()=>{var l,h;const{loadErrors:o,messages:{info:{noUtilityNetwork:s,noView:a}}}=this;this._initialValidationsFinished=!1,o.removeAll(),this._validConstructProperties=!0,this._dirtyAreasLayer=null,this._serverVersion=null,((l=this.utilityNetwork)==null?void 0:l.type)!=="utility"&&(this.loadErrors.push(s),_.getLogger(this).error(new g("utilityNetworkValidateTopology:missing-property",s)),this._validConstructProperties=!1),((h=this.view)==null?void 0:h.type)!=="2d"&&(this.loadErrors.push(a),_.getLogger(this).error(new g("utilityNetworkValidateTopology:missing-property",a)),this._validConstructProperties=!1),this._validConstructProperties&&(this.utilityNetwork.loaded||await this.utilityNetwork.load().catch(u=>{_.getLogger(this).error(u),this._validConstructProperties=!1}),await this._setDirtyAreasLayer()),this._validConstructProperties&&await this._validateNetworkExtension()},M),R(()=>{var o,s;return(s=(o=this.view)==null?void 0:o.map)==null?void 0:s.layers},"change",async()=>{const{loadErrors:o,messages:{info:{noUtilityNetwork:s}}}=this,a=o.find(l=>l===s);this._initialValidationsFinished=!1,a||(o.removeAll(),await this._validateNetworkExtension(),await this._setDirtyAreasLayer()),this._initialValidationsFinished=!0}),B(t)])})}destroy(){this._updatingHandles.destroy()}get state(){return this.loadErrors.length||!this._validConstructProperties?"disabled":this.executionError?"failed":this._updatingHandles.updating?"executing":this._activeOperationDidSucceed?"success":this._initialValidationsFinished?"ready":"loading"}set utilityNetwork(t){this._get("utilityNetwork")!==t&&this._set("utilityNetwork",t)}set view(t){this._get("view")!==t&&this._set("view",t)}async validateTopology(){var l;const{messages:{info:{cannotAcquireVersionLock:t,noDirtyAreasInExtent:o}},utilityNetwork:s,view:a}=this;if(!this.loadErrors.length){this._activeOperationDidSucceed=!1,this._set("executionError","");const h={gdbVersion:s==null?void 0:s.gdbVersion,outSpatialReference:((l=a.spatialReference)==null?void 0:l.clone())||null,validateArea:this.extentToValidate==="current"?a.extent.clone():s.fullExtent.clone()};this._updatingHandles.addPromise(s==null?void 0:s.validateTopology(h).then(()=>{this._activeOperationDidSucceed=!0},u=>{var x;let y="Error: "+u;if(u instanceof g&&((x=u.details)!=null&&x.raw))switch(u.details.raw.extendedCode){case k.noDirtyAreasInExtent:y=o;break;case k.cannotAcquireVersionLock_v10:case k.cannotAcquireVersionLock_v11:y=t;break;default:y=u.details.message}this._set("executionError",y)}))}}async _setDirtyAreasLayer(){var s;const{messages:{info:{noDirtyAreasLayer:t}}}=this,o=(s=this.view)==null?void 0:s.map.allLayers.items.filter(a=>F(a)).find(a=>{var l,h;return((l=a.parsedUrl)==null?void 0:l.path)===((h=this.utilityNetwork)==null?void 0:h.networkSystemLayers.dirtyAreasLayerUrl)});o?(this._dirtyAreasLayer=o,await this._dirtyAreasLayer.load(),this._serverVersion=this._dirtyAreasLayer.version??0,this._validConstructProperties=!0):(this.loadErrors.includes(t)||(this.loadErrors.push(t),_.getLogger(this).error(new g("utilityNetworkValidateTopology:missing-layer",t))),this._validConstructProperties=!1)}async _validateNetworkExtension(){var u;const{messages:{info:{noAdvancedEditingUserTypeExtension:t,noUtilityNetworkServiceUserTypeExtension:o}}}=this,s=await H(this.utilityNetwork.layerUrl),a=new q({url:s});await a.load();const l=((u=a.user)==null?void 0:u.username)??"",h=Number(this._serverVersion)<=11.1?"utilityNetwork":"advediting";if(!await z(a,l,h)){const y=Number(this._serverVersion)<=11.1?o:t;this.loadErrors.push(y),_.getLogger(this).error(new g("utilityNetworkValidateTopology:no-user-type-extension",y)),this._validConstructProperties=!1}this._initialValidationsFinished=!0}};r([n()],d.prototype,"_initialValidationsFinished",void 0),r([n()],d.prototype,"_dirtyAreasLayer",void 0),r([n()],d.prototype,"_validConstructProperties",void 0),r([n({readOnly:!0})],d.prototype,"executionError",void 0),r([n()],d.prototype,"extentToValidate",void 0),r([n()],d.prototype,"loadErrors",void 0),r([n()],d.prototype,"messages",void 0),r([n({readOnly:!0})],d.prototype,"state",null),r([n()],d.prototype,"utilityNetwork",null),r([n()],d.prototype,"view",null),d=r([V("esri.widgets.UtilityNetworkValidateTopology.UtilityNetworkValidateTopologyViewModel")],d);const N=d,w="esri-un-validate-topology",c={container:`${w}__container`,content:`${w}__content`,controlsContainer:`${w}__controls-container`,statusIconError:`${w}__status-icon-error`,statusIconSuccess:`${w}__status-icon-success`,statusIconContainer:`${w}__status-icon-container`};let p=class extends I{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new N}loadDependencies(){return P({action:()=>v(()=>import("./index-DVEy4f7w.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]),import.meta.url),block:()=>v(()=>import("./index-ujykA9Eq.js"),__vite__mapDeps([25,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,26,21,20,18,17,16,27,28,29,22,30,23,31,32,0,19,24,33,34,35,36,37,38,39,40,41,42,43]),import.meta.url),icon:()=>v(()=>import("./index-73bQemcW.js").then(e=>e.i),__vite__mapDeps([16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18]),import.meta.url),notice:()=>v(()=>import("./index-nrWOrFCt.js"),__vite__mapDeps([44,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,21,20,23,45,31,24,15]),import.meta.url),option:()=>v(()=>import("./index-DxcTRSkS.js"),__vite__mapDeps([46,2,3,4,5,6,7,8,9,10,11,12,13,18]),import.meta.url),select:()=>v(()=>import("./index-CQ1gJMW-.js"),__vite__mapDeps([47,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,48,21,20,49,22,50,23,24,51]),import.meta.url),tooltip:()=>v(()=>import("./index-DqW6JA5s.js"),__vite__mapDeps([52,2,3,4,5,6,7,8,9,10,11,12,13,21,20,28,17,14,29,31,39,19]),import.meta.url)})}get extentToValidate(){return this.viewModel.extentToValidate}set extentToValidate(e){this.viewModel.extentToValidate=e}get icon(){return"check-circle"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.label)??""}set label(e){this._overrideIfSome("label",e)}get utilityNetwork(){return this.viewModel.utilityNetwork}set utilityNetwork(e){this.viewModel.utilityNetwork=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const{viewModel:e}=this;return e.state==="disabled"?i("div",{class:c.container},i("calcite-block",{class:c.content,collapsible:!1,heading:this.label,open:!0},this._renderLoadErrorStatusIcon(),this._renderLoadErrorsNotices())):i("div",{class:c.container},i("calcite-block",{class:c.content,collapsible:!0,heading:this.label,open:!1},this._renderStatusIcon(),this._renderValidateTopologyAction(),this._renderControls()))}_extentOptionSelectChange(e){this.extentToValidate=e.currentTarget.value}_getLoadErrorMessagesAsNotices(e,t){return i("calcite-notice",{closable:!1,key:"error-notice-"+t,kind:"warning",open:!0,scale:"s"},i("div",{slot:"message"},e))}_handleValidateTopologyAction(){this.viewModel.validateTopology().catch(()=>{})}_renderControls(){const{viewModel:e}=this;return e.state==="failed"?i("div",{class:c.controlsContainer},this._renderExtentOptionSelect(),this._renderStatusNotice()):this._renderExtentOptionSelect()}_renderExtentOptionSelect(){const{messages:e,viewModel:t}=this;return i("div",{key:"selectExtentDiv"},i("calcite-select",{bind:this,disabled:t.state==="loading"||t.state==="executing",label:e.input.extentToValidate,onCalciteSelectChange:this._extentOptionSelectChange},i("calcite-option",{value:"current"},e.input.currentExtent),i("calcite-option",{value:"entire"},e.input.entireExtent)))}_renderLoadErrorsNotices(){const{viewModel:e}=this;return i("div",{class:c.controlsContainer,key:"loadErrorsDiv"},e.loadErrors.items.map(this._getLoadErrorMessagesAsNotices))}_renderLoadErrorStatusIcon(){return i("div",{class:c.statusIconContainer,key:"statusDiv",slot:"control"},i("calcite-icon",{class:c.statusIconError,icon:"exclamation-mark-triangle",scale:"s"}))}_renderStatusIcon(){const{messages:e,viewModel:t}=this,o=`${this.id}-validation-status-action`,s=`${this.id}-error-status-icon`,a=`${this.id}-success-status-icon`,l=h=>{setTimeout(()=>{h.textContent=""},3500)};return t.state==="executing"?i("div",{key:"statusDivExecuting",slot:"control"},i("calcite-action",{id:o,loading:!0,text:e.status.executing}),i("calcite-tooltip",{overlayPositioning:"fixed",referenceElement:o},i("span",null,e.status.executing))):t.state==="success"?i("div",{afterCreate:l,class:c.statusIconContainer,key:"statusDivSuccess",slot:"control"},i("calcite-icon",{class:c.statusIconSuccess,icon:"check-circle",id:a,scale:"s"}),i("calcite-tooltip",{referenceElement:a},i("span",null,e.status.success))):t.state==="failed"?i("div",{class:c.statusIconContainer,key:"statusDivFailed",slot:"control"},i("calcite-icon",{class:c.statusIconError,icon:"exclamation-mark-triangle",id:s,scale:"s"}),i("calcite-tooltip",{referenceElement:s},i("span",null,t.executionError))):i("div",{class:c.statusIconContainer,key:"statusDiv",slot:"control"})}_renderStatusNotice(){const{viewModel:e}=this;return i("div",{key:"executionErrorDiv"},i("calcite-notice",{closable:!0,kind:"warning",open:!0,scale:"s"},i("div",{slot:"message"},e.executionError)))}_renderValidateTopologyAction(){const{messages:e,viewModel:t}=this,o=`${this.id}-validation-action`;return i("div",{key:"actionDiv",slot:"control"},i("calcite-action",{bind:this,disabled:t.state==="executing",icon:"play-f",id:o,loading:t.state==="loading",onclick:this._handleValidateTopologyAction,text:e.input.validateTopology}),i("calcite-tooltip",{referenceElement:o},i("span",null,t.state==="loading"?e.status.loading:e.input.validateTopology)))}};r([n()],p.prototype,"extentToValidate",null),r([n()],p.prototype,"icon",null),r([n()],p.prototype,"label",null),r([n(),D("esri/widgets/UtilityNetworkValidateTopology/t9n/UtilityNetworkValidateTopology")],p.prototype,"messages",void 0),r([n()],p.prototype,"utilityNetwork",null),r([n()],p.prototype,"view",null),r([n({type:N})],p.prototype,"viewModel",void 0),p=r([V("esri.widgets.UtilityNetworkValidateTopology")],p);const Q=p;/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
v4.32.12 */const m=class m extends T{constructor(){super(...arguments),this._watchHandles=[],this.extentToValidate="current",this.position="bottom-left",this.arcgisReady=f()}willUpdate(t){t.has("referenceElement")&&this.referenceElementWatcher(this.referenceElement),t.has("extentToValidate")&&this.extentToValidateWatcher(this.extentToValidate),t.has("utilityNetwork")&&this.utilityNetworkWatcher(this.utilityNetwork),t.has("position")&&this.positionWatcher(this.position),t.has("view")&&this.viewWatcher(this.view)}async loaded(){const t=this._createParams(),o=new Q(t);this.widget=o,this._addContainer(),j(this),G(this)}disconnectedCallback(){super.disconnectedCallback(),K(this)}referenceElementWatcher(t){J(this,t)}extentToValidateWatcher(t){this.widget&&(this.widget.extentToValidate=t)}utilityNetworkWatcher(t){this.widget&&t&&(this.widget.utilityNetwork=t)}positionWatcher(t){var o;t!==void 0&&this.widget&&this.el.childElem&&((o=this.view.ui)==null||o.move(this.el.childElem,t))}viewWatcher(t){t!==void 0&&this.widget&&(this.widget.view=t,this._loadUtilityNetwork())}_addContainer(){this.widget.container=this.el.childElem}_createParams(){const t={};return this.extentToValidate!==void 0&&(t.extentToValidate=this.extentToValidate),this.utilityNetwork!==void 0&&(t.utilityNetwork=this.utilityNetwork),t}async _loadUtilityNetwork(){var t,o;if((t=this.view)!=null&&t.map&&this.view.map.portalItem){await this.view.map.load();const s=(o=this.view.map.utilityNetworks)==null?void 0:o.getItemAt(0);await(s==null?void 0:s.load()),this.utilityNetwork=s}}_setChildElement(t){this.el.childElem=t}render(){return A`<div ${$(this._setChildElement)}></div>`}};m.properties={extentToValidate:1,position:1,referenceElement:1,utilityNetwork:0,view:0,widget:0},m.shadowRootOptions=L;let E=m;C("arcgis-utility-network-validate-topology",E);export{E as ArcgisUtilityNetworkValidateTopology};
