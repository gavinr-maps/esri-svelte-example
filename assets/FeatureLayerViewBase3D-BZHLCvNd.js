const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Feature3DPipeline-gL2GVk00.js","./tslib.es6-B3Jf3DVX.js","./subclass-BZA_h8Db.js","./Promise-B2Hu02L7.js","./Accessor-BLX9ikPh.js","./reactiveUtils-C5zUhJQJ.js","./asyncUtils-CWX51uTe.js","./Collection-CEdjem1-.js","./Evented-BHRw9x22.js","./shared-B3wH2qpO.js","./SimpleObservable-KocWTzVy.js","./WorkerHandle-T1sH-Myb.js","./workers-D4HfeYKj.js","./Queue-yu3bZ02p.js","./assets-C43MgM-v.js","./index-Bh2oEzTI.js","./index-2kwcjS9-.css","./intl-CChhNOV8.js","./date-DlqISzcw.js","./jsonMap-0cxwUWs2.js","./locale-C9TlLpzi.js","./messages-OmQvZhAg.js","./Extent-Bf3YTe7m.js","./Point-Cg0-ChZE.js","./cast-Bjksrh93.js","./writer-DNAwXnhG.js","./FeatureSet-BHEkYP03.js","./geometry-D964gYQX.js","./Polyline-D9YkgmM_.js","./mathUtils-C4_ghTv4.js","./Graphic-DsxsIjhH.js","./PopupTemplate-BHMhS05j.js","./Clonable-D3rtuBWg.js","./fieldUtils-tmQlKvWo.js","./enumeration-Ba5njXdz.js","./Color-BCS62Hs5.js","./colorUtils-0bJDPow9.js","./ActionToggle-iT4slXc7.js","./Identifiable-B1UbsKNt.js","./symbols-CNimns--.js","./TextSymbol-D8QO_KUV.js","./screenUtils-_ZIvrt5o.js","./materialUtils-DarhapKC.js","./opacityUtils-C68Tlu6_.js","./vec3f64-BLpZdpfb.js","./aaBoundingBox-BE7cC1jD.js","./persistableUrlUtils-fa1mAujs.js","./collectionUtils-D_lHIu88.js","./Portal-C10FKnaA.js","./Loadable-BabW5Xcc.js","./jsonUtils-CEfjT-BK.js","./Field-ybkHhtnK.js","./fieldType-BuzM0UHS.js","./FeaturePipelineRenderManager-DjjUkvYY.js","./vec4f64-o2zAXfmz.js","./ViewingMode-Dodu7ZZk.js","./LodRenderer-EVrH9dsH.js","./vec2-maR1OrZI.js","./common-DQOJ18NT.js","./vec2f64-miziP1SN.js","./Material-_xx7OZxD.js","./interfaces-DDtDqZYj.js","./VertexAttribute-Cq4MnHjR.js","./boundedPlane-EV1sS2Ke.js","./sphere-C77djCO6.js","./mat4-GpOFENPA.js","./vec32-Dvg_eL9J.js","./vec42-YcqnINSP.js","./mat3-BRl2i9Bz.js","./mat3f64-BBpwCtoL.js","./plane-IENfwZlB.js","./mat4f64-Dk4dwAN8.js","./quatf64-CCm9z-pX.js","./mathUtils-BG-eq9fO.js","./lineSegment-D7sKPPYf.js","./glUtil-D0YUa0ow.js","./enums-D9v74xTE.js","./VertexElementDescriptor-BOD-G50G.js","./InterleavedLayout-e-di2fxs.js","./BufferView-_QDXRCew.js","./Util-BIfApRF5.js","./MergedRenderer-Dli9s1X5.js","./VertexArrayObject-lPxPk5E-.js","./Texture-Begq2x5n.js","./frustum-CQrOepbv.js","./NestedMap-GuqgquCN.js","./Matrix3DrawUniform-CiBFaSz6.js","./BindType-BmZEZMMh.js","./compilerUtils-Dw3R0f-Z.js","./renderState-DQLu6AJX.js","./Texture-Fac_8AOC.js","./projectBuffer-Bs7GwaPY.js","./geodesicConstants-DWQLYX7F.js","./lengthUtils-DL1-FDQQ.js","./ShaderTechniqueConfiguration-CBbn2DCi.js","./Indices-DflDlU4Z.js","./triangle-PTGDC_xJ.js","./AlphaCutoff-UcccL64p.js","./requestImageUtils-DgMiQwsm.js","./intersectorUtils-BK9EUwUf.js","./Octree-C8d4sqjv.js","./BufferObject-BVi1lwBq.js","./dehydratedFeatureUtils-B--Sgpdi.js","./verticalOffsetUtils-BDQLpfho.js","./orientedBoundingBox-DOAJUK5g.js","./quat-4pa1e6ds.js","./spatialReferenceEllipsoidUtils-DBE_OFra.js","./computeTranslationToOriginAndRotation-Q27G6TBL.js","./Intersector-BQ92CPLA.js","./sdfPrimitives-CUWZbMRe.js","./vec3f32-nZdmKIgz.js","./doublePrecisionUtils-B0owpBza.js","./floatRGBA-CfH_2xsy.js","./DefaultMaterial-DgOvtNL9.js","./VertexColor.glsl-_ARMpsAT.js","./DecodeSymbolColor.glsl-BPIX0fAF.js","./Scheduler-CJu5awNf.js","./signal-D4lghLjV.js","./debugFlags-BF6Z0j0F.js","./RealisticTree.glsl-CAmeC2w1.js","./HUDMaterial.glsl-D6WRipwF.js","./graphicUtils-CWEFaVJb.js","./projection-B971H0Re.js","./meshVertexSpaceUtils-CXzOFlTI.js","./MeshLocalVertexSpace-LEHwMUnu.js","./projectVectorToVector-G2uWGoIb.js","./projectPointToVector-GINIbYMz.js","./hydratedFeatures-DBKLr8hT.js","./Float4DrawUniform-N58YDhuZ.js","./highlightUtils-BYmbiZ48.js","./languageUtils-JGnUBrxZ.js","./TimeOnly-DOn_Hy89.js","./UnknownTimeZone-BkowvBs8.js","./ImmutableArray-BPVd6ESQ.js","./shared-OyXfj1UM.js","./number-CUaGJe2K.js","./Query-5Xpquc1r.js","./DataLayerSource-BKkswDvG.js","./FullTextSearch-Csd1Hktu.js","./TimeExtent-DocT5yPf.js","./timeUtils-8fb_2oAt.js","./LineCallout.glsl-C1R4fy2f.js","./RibbonLine.glsl-BZu1FDpE.js","./ElevationProvider-C95wyCKc.js","./unitConversionUtils-BMfW9yAe.js","./vec2f32-BbH2jxlN.js","./dehydratedFeatures-BiOblf0d.js","./quantizationUtils-uj_P09aO.js","./featureConversionUtils-D14h8iad.js","./OptimizedFeature-6cJ-QFG5.js","./OptimizedGeometry-BF8iz5FO.js","./OptimizedFeatureSet-Blu9Ckm7.js","./edgeUtils-BUKTgPFR.js","./HeatmapDensity.glsl-BkA5uXmE.js","./timeSupport-CXKPoROL.js","./timeUtils-BnYjW4Rc.js","./utils-BpB3MnW1.js","./Version-BSlAgupz.js","./tagSymbols-BPcGfZon.js","./projectExtentUtils-BJX_ptLZ.js","./geometryServiceUtils-C6Kg3Uew.js","./project-DlMfXva8.js","./utils-6jMaHUrH.js","./utils-Bema0iXE.js","./HighlightDefaults-D4ckYWWJ.js","./UpdatingHandles-GfwcIh5z.js","./arcgisLayerUrl-BX1FE5Hm.js","./layerUtils-BrNoooE9.js","./ShadowCastAccumulate.glsl-BNKV7IEU.js","./Viewpoint-C4FqWA2d.js","./Cyclical-oTUX3aX7.js","./jsxFactory-CJa39Fro.js","./uuid-fwrPAdZb.js","./GraphicsCollection-FfahqxsR.js","./HeightModelInfo-9nOoV6LU.js","./RenderCoordsHelper-C50UGjbb.js","./projectVectorToPoint-DcLtSZYw.js","./scaleUtils-D_Nw3nhM.js","./DefaultUI-C0utm694.js","./InputManager-Ba9xzDpe.js","./Map-iWpb5DpI.js","./Basemap-DVYOaWHz.js","./loadAll-B6mYSptb.js","./PortalItem-DzgXrpyc.js","./writeUtils-Dz7BsE1e.js","./Ground-CAIVlzbd.js","./CollectionFlattener-CQN6i8ZK.js","./editableLayers-Cn9dHzhB.js","./catalogUtils-DyGHPM81.js","./basemapUtils-B9TjOm47.js","./utils-93yNk4Xc.js","./mat4f32-DcsiF_Rp.js","./TablesMixin-5umgS75f.js","./Layer-CVt7Hb5J.js","./ReactiveMap-6CfRGOlR.js","./selectionUtils-DYi6daQO.js","./IViewEvents-Bci6PjlS.js","./interfaces-D6pIddIh.js","./screenUtils-WcqhHU65.js","./a11yUtils-cyWndM8Q.js","./heightModelInfoUtils-C6gW75mB.js","./imageUtils-CtmzXUTE.js","./capabilities-A2uoe7dc.js","./themeUtils-C3zvZbsE.js","./globalCss-CZa70j6i.js","./accessibleHandler-hWbBTR_7.js","./CompassViewModel-C7G3VWNL.js","./utils-DsJqvptN.js","./GoTo-Wtu9mgoE.js","./NavigationToggle-BIWeotJk.js","./ZoomViewModel-oUfjVFgI.js","./viewpointUtils-Bq9TFP4R.js","./earthUtils-ByXwmaX5.js","./spatialReferenceSupport-yRFduOSO.js","./ElevationSamplerData-DF8Bl6I9.js","./terrainUtils-CPZNZdjg.js","./TileInfo-Dphjf6xH.js","./TileKey-DZd6gJy7.js","./OverlayCompositing.glsl-CiE3Tt8y.js","./axisAngleDegrees-Ci2HA7Jo.js","./weather-eV4wTXCK.js","./Intersector-wXoCuQ8W.js","./Program-mfcb06fW.js","./ShadowCastVisualizeTechniqueConfiguration-Bb-Uir0o.js","./Environment-BDo9QJi6.js","./Compositing.glsl-DMM7CJmu.js","./Blit-B-VutIER.js","./unitFormatUtils-CZ2bRlFg.js","./ByteSizeUnit-BsxeN7wM.js","./quantityUtils-D0GB2dMc.js","./ZoomMomentumEstimator-DA-HeSfK.js","./labelFormatUtils-DFKxfrJb.js","./labelUtils-B8petyBk.js","./NormalUtils.glsl-DwmdcsLR.js","./fontUtils-BKHqaMFz.js","./elevationInfoUtils-BC_66_Fg.js","./ElevationQueryTileCache-D4sXpJpw.js","./LayerConstants-B33OP6sh.js","./intersectorUtilsConversions-D_fcRVdX.js","./ElevationRange-BrgM1moX.js","./hitTestSelectUtils-UXJPjatw.js","./MemCache-Dx1v3xLC.js","./vec33-DUxPafiq.js","./Normals-DzBXR8Bg.js","./TileStrategy-DT04gaWW.js","./TileKey-Cs1awCRX.js","./QueueProcessor-DZiVr5XH.js","./RenderableTile-Dl7jrqnB.js","./config-MDUrh2eL.js","./StyleDefinition-BTt_i6C1.js","./enums-CmIX1y88.js","./enums-BRzLM11V.js","./GeometryUtils-Dyjqugo6.js","./DefaultVertexAttributeLayouts-PrbBmwty.js","./DisplayObject-DGZ6h7sV.js","./resources-CLJpJAXm.js","./colorUtils-aL8wj-8G.js","./vec3-kbEkneOB.js","./ShaderTechniqueRepository-hTzew41Z.js","./testSVGPremultipliedAlpha-uTaDUvFS.js","./RenderingContext-C2W2PIoX.js","./ProgramCache-BcuuBWLJ.js","./layerViewUtils-DhFEu8Rd.js","./dehydratedFeatureComparison-06VFTqH5.js","./utils-Ce7L3imC.js","./jsonUtils-CSnQD004.js","./parser-CTsgEym6.js","./cimSymbolUtils-DXvZxabN.js","./utils-D2PLyMFF.js","./LRUCache-B_PHMSGm.js","./queryForSymbologySnapping-KE3-mimJ.js","./Graphics3DFeatureProcessor-BY1APY3j.js","./hash-CcEbRgUF.js","./diffUtils-BP7jmOAy.js","./UniqueValueRenderer-BQtAHUSo.js","./colorRamps-pKd7I5WZ.js","./SizeVariable-936USOrb.js","./sizeVariableUtils-Cmcuvw-4.js","./visualVariableUtils-DX1kS9Se.js","./ColorStop-Dk3U5tCk.js","./jsonUtils-Ds2Sqto-.js","./defaults-DZ1kfMRx.js","./defaultsJSON-GKolV7NZ.js","./RendererLegendOptions-B-4se3aU.js","./styleUtils-BYTm14n3.js","./renderingInfoUtils-DAsRBUXK.js","./ExtentSet-BhWFQ8Zv.js","./ClassBreaksRenderer-BuHwSyVK.js","./jsonUtils-DxpLMo6d.js","./FieldsIndex-DpwHKAMX.js","./OverrideHelper-ti072FkP.js","./HeatmapColorStop-BJc5nbwr.js","./heatmapUtils-Dwiv9IEa.js","./SimpleRenderer-BV2L9G_n.js","./rendererConversion-CcWsy4Z5.js","./optimizedFeatureQueryEngineAdapter-BOPMFOve.js","./centroid-DdLmOD72.js","./PooledRBush-D7s4d_Fs.js","./quickselect-QQC62dOK.js","./popupUtils-BaLxn3kI.js","./Graphics3DObjectStates-DLTNWJbN.js","./attributeUtils-Dc8--CBJ.js","./FeatureFilter-BMHRQSxq.js","./floorFilterUtils-DZ5C6FQv.js","./QueryEngine-DrzbS-Dm.js","./normalizeUtils-EVmAQ-ak.js","./normalizeUtilsCommon-dT81xWiM.js","./WhereClause-BNiy948d.js","./timeSupport-T1g9-JyG.js","./queryUtils-O-WFKoZd.js","./json-Wa8cmqdu.js","./QueryEngineCapabilities-DjYb9CEb.js","./utils-Bh2cHa3t.js","./utils-BwQ00KBJ.js","./utils-rwwdQ1Ui.js","./ClassBreaksDefinition-CS8Z_VNX.js","./SnappingCandidate-O5eRSE6e.js","./FeatureStore-Dr0GQdbp.js","./BoundsStore-BhV7QrYA.js","./heatmapTextureUtils-DJXJBog1.js","./LayerView3D-Dkb0AiwM.js","./query-Dw-gv3BA.js","./pbfQueryUtils-B0fU-MiS.js","./pbf-BtDZ1BpD.js","./queryZScale-w66xFVGx.js","./EventedSet-CCZpNUPJ.js","./FeatureLayerView-DOc7IdzL.js","./FeatureEffect-BEzQmzeC.js","./LayerView-CGYm21KA.js","./RefreshableLayerView-BVliPdnr.js"])))=>i.map(i=>d[i]);
import{_ as N}from"./index-Bh2oEzTI.js";import{r as i}from"./tslib.es6-B3Jf3DVX.js";import{U as v,m as a,a as g,j as T,b as D}from"./subclass-BZA_h8Db.js";import{a as E,b as M,a9 as Q,s as $,u as A,q as b}from"./Accessor-BLX9ikPh.js";import{watch as x,initial as C,syncAndInitial as V,when as I}from"./reactiveUtils-C5zUhJQJ.js";import{b as q,M as Z}from"./dehydratedFeatures-BiOblf0d.js";import{C as H,V as j,h as G}from"./HeatmapDensity.glsl-BkA5uXmE.js";import{l as z}from"./LayerView3D-Dkb0AiwM.js";import{u as L}from"./hydratedFeatures-DBKLr8hT.js";import{t as k}from"./LineCallout.glsl-C1R4fy2f.js";import{E as B,c as J}from"./query-Dw-gv3BA.js";import{h as Y}from"./WorkerHandle-T1sH-Myb.js";import{g as O}from"./Point-Cg0-ChZE.js";import{y as U}from"./Field-ybkHhtnK.js";import{r as K}from"./EventedSet-CCZpNUPJ.js";import{C as m}from"./RibbonLine.glsl-BZu1FDpE.js";import{t as W}from"./ShadowCastAccumulate.glsl-BNKV7IEU.js";import{_ as X}from"./FeatureLayerView-DOc7IdzL.js";import{y as ee}from"./LayerView-CGYm21KA.js";import{i as te}from"./RefreshableLayerView-BVliPdnr.js";class re extends k{constructor(e,r,s,n,u,o){super(e.usedMemory,e.displayedFeatures,e.totalFeatures,e.maximumFeatures,e.nodes,e.core),this.storedFeatures=r,this.totalVertices=s,this.partial=n,this.mode=u,this.symbolComplexity=o}}class se{constructor(e){this._controller=e,this._handle=new oe(r=>e.schedule(r))}destroy(){this._handle.destroy()}invoke(e,r){return e.buffer&&e.buffer.byteLength!==0?(e.options.sourceSpatialReference&&e.options.sourceSpatialReference instanceof O&&(e.options={...e.options,sourceSpatialReference:e.options.sourceSpatialReference.toJSON()}),this._handle.invoke(e,r).then(s=>{let n=0,u=0;const o=O.fromJSON(s.spatialReference);s.spatialReference=o;const l=async p=>{const d=s.fields;if(d){for(;n<d.length;)if(d[n]=U.fromJSON(d[n]),n++,p.madeProgress())return this._controller.reschedule(F=>l(F))}const P=s.features;for(;u<P.length;){const F=P[u];++u,F.uid=E();const w=F.geometry;if(w!=null&&(w.spatialReference=o,ie(w),p.madeProgress()))return this._controller.reschedule(S=>l(S))}return s};return this._controller.schedule(p=>l(p))})):Promise.resolve(null)}}function ie(t){switch(t.type){case"polyline":t.paths.reduce((e,r)=>e+r.length,0)<v&&(t.paths=t.hasZ||t.hasM?t.paths.map(e=>e.map(r=>[r[0],r[1],r[2]])):t.paths.map(e=>e.map(r=>[r[0],r[1]])));break;case"polygon":t.rings.reduce((e,r)=>e+r.length,0)<v&&(t.rings=t.hasZ||t.hasM?t.rings.map(e=>e.map(r=>[r[0],r[1],r[2]])):t.rings.map(e=>e.map(r=>[r[0],r[1]])))}}class oe extends Y{constructor(e){super("PBFDecoderWorker","_parseFeatureQuery",{_parseFeatureQuery:r=>[r.buffer]},e)}}let y=class extends M{constructor(t){super(t)}get implicitFields(){var s;if(!((s=this.layer.outFields)==null?void 0:s.includes("*")))return new Set;const e=new Set(this.layerView.requiredFields),r=new Set(this.layerView.availableFields);return Q(r,e)}get queryFeaturesDehydrated(){var u;const{layer:t}=this,e=t.capabilities,r=e&&e.query,s=r&&r.supportsFormatPBF,n=t.parsedUrl;if(s){this._decoder==null&&(this._decoder=new se(this.controller));const o={sourceSpatialReference:((u=t.spatialReference)==null?void 0:u.toJSON())??null,applyTransform:!0,maxStringAttributeFields:this.implicitFields,maxStringAttributeLength:R};return(l,p)=>B(n,l,"pbf",this._createRequestOptions(p)).then(d=>($(p),this._decoder!=null?this._decoder.invoke({buffer:d.data,options:o},p.signal):Promise.reject(A())))}return(o,l)=>J(n,o,t.spatialReference,this._createRequestOptions(l)).then(p=>q(p.data,{maxStringAttributeFields:this.implicitFields,maxStringAttributeLength:R}))}queryFeatureCount(t,e){return this.layer.queryFeatureCount(t,e)}destroy(){this._decoder=b(this._decoder)}_createRequestOptions(t){return{...t,query:{...this.layer.customParameters,token:this.layer.apiKey,...t==null?void 0:t.query}}}};i([a({constructOnly:!0})],y.prototype,"layer",void 0),i([a({constructOnly:!0})],y.prototype,"layerView",void 0),i([a({constructOnly:!0})],y.prototype,"controller",void 0),i([a({readOnly:!0})],y.prototype,"implicitFields",null),i([a({readOnly:!0})],y.prototype,"queryFeaturesDehydrated",null),y=i([g("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],y);let _=class extends M{constructor(t){super(t)}queryFeaturesDehydrated(t,e){return this.layer.queryFeatures(t,e)}};i([a({constructOnly:!0})],_.prototype,"layer",void 0),_=i([g("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileOGCServiceQuery3D")],_);let f=class extends M{constructor(t){super(t)}queryFeaturesDehydrated(t,e){return this.source.queryFeaturesJSON(t,e).then(q,r=>{if(r&&r.name==="query-features-json:unsupported")return this.layer.queryFeatures(t,e);throw r})}queryFeatureCount(t,e){return this.layer.queryFeatureCount(t,e)}};function ae(t,e){const{layer:r}=t;return r.type==="feature"&&r.source.type==="feature-layer"||r.type==="catalog-footprint"?new y({layer:r,layerView:t,controller:e}):r.type==="feature"&&r.source.type==="memory"||r.type==="csv"||r.type==="geojson"||r.type==="oriented-imagery"||r.type==="wfs"?new f({layer:r,source:r.source}):r.type==="ogc-feature"?new _({layer:r}):null}i([a({constructOnly:!0})],f.prototype,"layer",void 0),i([a({constructOnly:!0})],f.prototype,"source",void 0),f=i([g("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],f);const R=1024;class ne{constructor(e){this._memoryCache=null;const r=e.layerView.layer;this._layerView=e.layerView,this.objectIdField=r.objectIdField,this.globalIdField="globalIdField"in r?r.globalIdField:null,this._returnZ=e.returnZ,this._returnM=e.returnM;const s=this._layerView.view.resourceController;this.query=ae(this._layerView,s.normal),s&&this._memoryCacheEnabled&&(this._memoryCache=s.memoryController.newCache(`fl-${r.uid}`))}get _memoryCacheEnabled(){switch(this._layerView.layer.source.type){case"feature-layer":case"ogc-feature":case"oriented-imagery":return!0;case"csv":case"parquet":case"geojson":case"memory":case"wfs":return!1}}destroy(){this._memoryCache=b(this._memoryCache),this.query.destroy()}createQuery(){const e=this._layerView.layer.createQuery();return e.outFields=this._layerView.availableFields,e.returnZ=this._returnZ,e.returnM=this._returnM,e.outSpatialReference=this.tilingScheme.spatialReference,e}get memoryCache(){return this._memoryCache}get viewingMode(){return this._layerView.view.state.viewingMode}get tilingScheme(){return this._layerView.view.featureTiles.tilingScheme}get scheduler(){var e;return(e=this._layerView.view.resourceController)==null?void 0:e.scheduler}get geometryType(){return this._layerView.layer.geometryType}get fullExtent(){return this._layerView.layer.fullExtent}get tileMaxRecordCount(){return this._layerView.layer.capabilities.query.tileMaxRecordCount}get maxRecordCount(){return this._layerView.layer.capabilities.query.maxRecordCount}get isDraped(){var e;return((e=this._layerView.layer.elevationInfo)==null?void 0:e.mode)==="on-the-ground"}get capabilities(){return this._capabilities??(this._capabilities=ue(this._layerView.layer)),this._capabilities}logFetchError(e,r){e.error("#fetchTile()",this._layerView.layer,(r==null?void 0:r.message)??r)}}function ue(t){const e=t.capabilities.query;return{supportsMultipleResolutions:le(t),supportsPagination:!(!e||!e.supportsPagination),supportsResultType:!(!e||!e.supportsResultType),supportsCacheHint:!(!e||!e.supportsCacheHint),supportsQuantization:!(!e||!e.supportsQuantization),supportsQuantizationEditMode:!(!e||!e.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!e||!e.supportsMaxRecordCountFactor),supportsFormatPBF:!(!e||!e.supportsFormatPBF)}}function le(t){switch(t.geometryType){case"polyline":return!0;case"polygon":return t.capabilities&&t.capabilities.query&&t.capabilities.query.supportsQuantization;default:return!1}}let c=class extends H{constructor(e){super(e),this._controllerTotal=0,this._processorTotal=0,this._needsRefresh=!1,this.suspendResumeExtentMode="data"}initialize(){this.addHandles(x(()=>({controller:this.controller,suspended:this.suspended}),({controller:e,suspended:r})=>{e&&!r&&this._needsRefresh&&(e.refetch(),this._needsRefresh=!1)}))}destroy(){this._fetcherContext=b(this._fetcherContext)}get maximumNumberOfFeatures(){var e;return((e=this.controller)==null?void 0:e.maximumNumberOfFeatures)??this._get("maximumNumberOfFeatures")}set maximumNumberOfFeatures(e){this._set("maximumNumberOfFeatures",e),this.controller&&(this.controller.maximumNumberOfFeatures=e)}get maximumNumberOfFeaturesExceeded(){return!!this.controller&&!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded)}get updatingProgressValue(){var s,n;let e=0;if((s=this.controller)!=null&&s.updating){const u=this.controller.updatingRemaining,o=Math.max(this.controller.updatingTotal,this._controllerTotal);o>0&&(e=(o-u)/o,this._controllerTotal=o)}let r=0;if((n=this.processor)!=null&&n.updating){const u=this.processor.updatingRemaining,o=Math.max(u,this._processorTotal);o>0&&(r=(o-u)/o,this._processorTotal=o)}return .5*(e+r)}get updatePolicy(){if(!this.controller)return m.ASYNC;switch(this.controller.mode){case"snapshot":{const e=pe.get(this.layer.geometryType);return e==null||this.controller.serviceDataCount>e?m.ASYNC:m.SYNC}case"tiles":return m.ASYNC}}get usedMemory(){var e,r;return(((e=this.processor)==null?void 0:e.usedMemory)??0)+(((r=this.controller)==null?void 0:r.memoryForUnusedFeatures)??0)}get unloadedMemory(){var u,o,l,p;const e=((u=this.processor)==null?void 0:u.unprocessedMemoryEstimate)??0,r=((o=this.controller)==null?void 0:o.expectedFeatureDiff)??0,s=((l=this.processor)==null?void 0:l.loadedFeatures)??0,n=s+r>0?s/(s+r):1;return e+r*(((p=this.processor)==null?void 0:p.usedMemoryPerFeature)??0)*n}get ignoresMemoryFactor(){var e;return(e=this.controller)==null?void 0:e.hasMaximumNumberOfFeaturesOverride}get performanceInfo(){var n,u,o,l,p,d;const e=(n=this.controller)==null?void 0:n.displayFeatureLimit,r=e!=null?e.averageSymbolComplexity:void 0,s=r!=null?`f:${r.verticesPerFeature},v:${r.verticesPerCoordinate}`:"n/a";return new re(super.performanceInfo,((o=(u=this.controller)==null?void 0:u.performanceInfo)==null?void 0:o.storedFeatures)??0,((p=(l=this.controller)==null?void 0:l.performanceInfo)==null?void 0:p.totalVertices)??0,this.maximumNumberOfFeaturesExceeded,((d=this.controller)==null?void 0:d.mode)??"n/a",s)}async doRefresh(e){const{controller:r,processor:s,suspended:n}=this;e&&r&&(n?this._needsRefresh=!0:(r.refetch(),this._needsRefresh=!1)),s.refreshFilter()}setVisibility(e,r){var s;(s=this.processor)==null||s.setObjectIdVisibility(e,r)}getMissingAttributesForFeature(e){return this.controller.getMissingAttributesForFeature(e)}getHydratedGeometry(e){const r=this.graphics3DProcessor;if(r==null)return null;const s=r.graphics3DGraphicsByObjectID;if(s==null)return null;const n=s.get(e);return n==null?null:L(n.graphic.geometry)}createController(){this._fetcherContext=new ne({layerView:this.layerView,returnZ:this.hasZ,returnM:this.hasM});const e=new j({layerView:this.layerView,context:this._fetcherContext,graphics:new K,extent:this.clippingExtent});return this.updatingHandles.add(()=>e.serviceDataExtent,r=>{this.processor&&(this.processor.dataExtent=r)},C),this.addHandles(x(()=>this.suspended&&this.layerView.updateSuspended,r=>{r?e.suspend():e.resume()},V)),this.updatingHandles.add(()=>{var r;return(r=this.processor)==null?void 0:r.displayFeatureLimit},r=>e.displayFeatureLimit=r,C),this.addHandles(I(()=>!this.updating,()=>{this._controllerTotal=0,this._processorTotal=0})),e}beforeSetController(e){e.maximumNumberOfFeatures=this.maximumNumberOfFeatures}get test(){return{controller:this.controller,graphics3DProcessor:this.graphics3DProcessor,heatmapProcessor:this.heatmapProcessor,loadedGraphics:this.loadedGraphics}}};i([a()],c.prototype,"layerView",void 0),i([a()],c.prototype,"controller",void 0),i([a()],c.prototype,"_controllerTotal",void 0),i([a()],c.prototype,"_processorTotal",void 0),i([a()],c.prototype,"_needsRefresh",void 0),i([a()],c.prototype,"maximumNumberOfFeatures",null),i([a()],c.prototype,"maximumNumberOfFeaturesExceeded",null),i([a()],c.prototype,"updatingProgressValue",null),i([a()],c.prototype,"updatePolicy",null),i([a()],c.prototype,"suspendResumeExtentMode",void 0),c=i([g("esri.views.3d.layers.graphics.FeatureGraphics3DGraphicsPipeline")],c);const pe=new Map([["point",5e3],["polygon",500],["polyline",1e3]]);let h=class extends te(G(X(z(ee)))){constructor(t){super(t)}initialize(){this.addHandles(x(()=>this._updatingRequiredFieldsPromise,t=>this._updatingHandles.addPromise(t),V))}destroy(){this._updatingHandles.removeAll(),this._fetcherContext=b(this._fetcherContext)}get maximumNumberOfFeatures(){return this.graphicsPipeline.maximumNumberOfFeatures}set maximumNumberOfFeatures(t){this.graphicsPipeline.maximumNumberOfFeatures=t}get maximumNumberOfFeaturesExceeded(){return this.graphicsPipeline!=null&&!this.suspended&&this.graphicsPipeline.maximumNumberOfFeaturesExceeded}get updatingProgressValue(){var t;return((t=this.graphicsPipeline)==null?void 0:t.updatingProgressValue)??0}get updatePolicy(){var t;return((t=this.graphicsPipeline)==null?void 0:t.updatePolicy)??m.ASYNC}get hasZ(){const t=this.layer,e=t.capabilities&&t.capabilities.data;return!(!e||!e.supportsZ)&&("returnZ"in t&&t.returnZ!=null?t.returnZ:e.supportsZ)}get hasM(){const t=this.layer,e=t.capabilities&&t.capabilities.data;return!(!e||!e.supportsM)&&"returnM"in t&&t.returnM!=null&&t.returnM}setVisibility(t,e){var r;(r=this.graphicsPipeline)==null||r.setVisibility(t,e)}createQuery(){return super.createQuery()}queryFeatures(t,e){const r=()=>super.queryFeatures(t,e);return this.layer.geometryType==="mesh"?this._queryFeaturesMesh(this._ensureQuery(t),r):r()}async createGraphicsPipeline(){if(T("feature-pipeline-3d-test")){const{Feature3DPipeline:t}=await N(()=>import("./Feature3DPipeline-gL2GVk00.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329]),import.meta.url);return new t({layerView:this})}return new c({layerView:this})}async doRefresh(t){return await this.graphicsPipeline.doRefresh(t)}_popupFeatureHasRequiredFields(t,e){if(!super._popupFeatureHasRequiredFields(t,e))return!1;const r=Z(t,this.layer.objectIdField);if(r==null)return!0;const s=this.graphicsPipeline.getMissingAttributesForFeature(r);if(s==null)return!0;for(const n of e)if(s.has(n))return!1;return!0}get usedMemory(){var t;return((t=this.graphicsPipeline)==null?void 0:t.usedMemory)??0}get unloadedMemory(){var t;return((t=this.graphicsPipeline)==null?void 0:t.unloadedMemory)??0}get ignoresMemoryFactor(){var t;return((t=this.graphicsPipeline)==null?void 0:t.ignoresMemoryFactor)??!1}async _queryFeaturesMesh(t,e){await this._validateQueryFeaturesMesh(t);const r=await e(),s=this.graphicsPipeline;if(t!=null&&t.outStatistics||s==null)return r;const n=this.layer.objectIdField,u=[];for(const o of r.features)if(o.geometry){const l=s.getHydratedGeometry(o.attributes[n]);l&&(o.geometry=l,u.push(o))}else u.push(o);return r.features=u,r}async _validateQueryFeaturesMesh(t){if(!t)return;const e=s=>{throw new D("feature-layer-view:unsupported-query",`Queries on Mesh feature collection layers do not support '${s}'`)},r=["quantizationParameters","geometryPrecision","maxAllowableOffset"];for(const s of r)t[s]!=null&&e(s);"returnM"in t&&t.returnM&&e("returnM"),"returnCentroid"in t&&t.returnCentroid&&e("returnCentroid"),t.outSpatialReference==null||t.outSpatialReference.equals(this.view.spatialReference)||e("outSpatialReference")}get test(){}};i([a()],h.prototype,"layer",void 0),i([a()],h.prototype,"graphicsPipeline",void 0),i([a()],h.prototype,"maximumNumberOfFeatures",null),i([a()],h.prototype,"maximumNumberOfFeaturesExceeded",null),i([a(W)],h.prototype,"updatingProgress",void 0),i([a({readOnly:!0})],h.prototype,"updatingProgressValue",null),i([a({readOnly:!0})],h.prototype,"updatePolicy",null),i([a({readOnly:!0})],h.prototype,"hasZ",null),i([a({readOnly:!0})],h.prototype,"hasM",null),h=i([g("esri.views.3d.layers.FeatureLayerViewBase3D")],h);const Ne=h;export{Ne as g,re as t};
