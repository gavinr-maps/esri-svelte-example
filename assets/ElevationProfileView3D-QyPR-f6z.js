import{i as E,l as _,D,aA as H,t as R,g as P,r as u,m as v,a as b,aV as L,N as d}from"./Accessor-BmwT4B0c.js";import{a as T,d as n,A as l}from"./reactiveUtils-XM7cS2OP.js";import{n as w,t as y}from"./customElement-DG6XwzUI.js";import{t as V,a as k}from"./visualizationUtils-CppWwI2G.js";import{a as O}from"./elevationInfoUtils-D26wVF2d.js";import{j as A}from"./settings-PZrBMq9n.js";import{j as $}from"./OutlineVisualElement-k2ndyPuX.js";import{e as M}from"./GraphicState-C1muTyhp.js";import{p as j}from"./Material-C_-mgXN8.js";import{n as I}from"./layerViewUtils-Bevty3Jm.js";import{h as S}from"./Color-VJEMvW-n.js";import{e as C}from"./throttle-jjSnxk80.js";import{u as x}from"./vec4f64-o2zAXfmz.js";import"./Evented-Dw4_VOGn.js";import"./SimpleObservable-CvOkykwM.js";import"./index-4eY77cms.js";import"./memoize-DmxaQ-k8.js";import"./jsxFactory-Cnml7uXM.js";import"./intl-Duiy0OzY.js";import"./Promise-DfET-uns.js";import"./cast-CsZslgGN.js";import"./JSONSupport-DcrLLGjL.js";import"./uuid-Cl5lrJ4c.js";import"./Graphic-Dt0LgVGU.js";import"./Clonable-Z-AWS-16.js";import"./writer-DKgfqj4X.js";import"./opacityUtils-Dim20wpZ.js";import"./Point-Cz2JYYmX.js";import"./enumeration-DpvDkLNI.js";import"./ActionToggle-D7439N1A.js";import"./Identifiable-BHVfzH03.js";import"./jsonUtils-CwFG8yN4.js";import"./Extent-g5W9hy0j.js";import"./Polyline-s-JzsQqo.js";import"./mathUtils-Cfq9PL9W.js";import"./typeUtils-B6WBEKDM.js";import"./TextSymbol-BLIQ6RKX.js";import"./screenUtils-_ZIvrt5o.js";import"./collectionUtils-CTT-51g7.js";import"./Portal-CmmHxpLg.js";import"./vec3f64-BLpZdpfb.js";import"./aaBoundingBox-Dw3yBk2f.js";import"./ByteSizeUnit-BsxeN7wM.js";import"./LRUCache-CXiGQWMN.js";import"./MemCache-CmojB_Z1.js";import"./hitTest-Dmi1EcVX.js";import"./projectVectorToVector-CCOy_B5J.js";import"./projectBuffer-CQnuEMuP.js";import"./geodesicConstants-RQL9oKdk.js";import"./projectPointToVector-BoxjK-qy.js";import"./projection-CyCZAIaD.js";import"./LayerConstants-B33OP6sh.js";import"./layerUtils-B__v9OBu.js";import"./ElevationProvider-aS5xrHHy.js";import"./dehydratedFeatureUtils-1rrRm6hF.js";import"./Intersector-tBiZcjSu.js";import"./mat4-Fi6iAz29.js";import"./common-DQOJ18NT.js";import"./mat4f64-Dk4dwAN8.js";import"./vec32-Dvg_eL9J.js";import"./vec42-YcqnINSP.js";import"./sphere-Cin5efBj.js";import"./mat3-CR8GKnhD.js";import"./mat3f64-BBpwCtoL.js";import"./plane-CpXmOyqq.js";import"./quatf64-CCm9z-pX.js";import"./vec2f64-Dy6m9Nrb.js";import"./mathUtils-BgCEaV43.js";import"./ViewingMode-Dodu7ZZk.js";import"./intersectorUtils-BNnvTT1E.js";import"./boundedPlane-DuGhiiFM.js";import"./lineSegment-v806maA5.js";import"./verticalOffsetUtils-BFnFdbst.js";import"./orientedBoundingBox-B17G_yFO.js";import"./quat-CP7JhygC.js";import"./spatialReferenceEllipsoidUtils-DBqQpPRa.js";import"./computeTranslationToOriginAndRotation-DYUrDrjE.js";import"./Attribute-DGhdp5lO.js";import"./intersectorUtilsConversions-CiJ6bOx7.js";import"./Intersector-zrebwyaY.js";import"./defaultUnit-CHqZKPQE.js";import"./getDefaultUnitForView-BBSnYQvp.js";import"./vec2-ChnYg_BJ.js";import"./geodesicUtils-Cvz9v8ds.js";import"./ScheduledQueueProcessor-U8WIIyj8.js";import"./Queue-BQesTh_6.js";import"./ReactiveMap-BHFEHYMj.js";import"./signal-CySMLEX9.js";import"./Scheduler-i_u8qdlN.js";import"./debugFlags-B1LM_Apo.js";import"./traversalUtils-DmE6QkgJ.js";import"./groundInstanceUtils-Ben03ZCf.js";import"./ElevationQuery-HSxD60s-.js";import"./ElevationSamplerData-UywXoG8C.js";import"./ElevationTile-BBBbm-Nl.js";import"./TileKey-DZd6gJy7.js";import"./GraphicsLayer-D3KyXpUc.js";import"./GraphicsCollection-BJ5Nr2H8.js";import"./Layer-DH4_Pn8a.js";import"./TimeExtent-BO6BsF_x.js";import"./timeUtils-C1c_L2Fd.js";import"./ScaleRangeLayer-Cnzwr9PT.js";import"./layerContainerType-C5CzMsLd.js";import"./jsonUtils-DZz5FrgB.js";import"./colorUtils-Rxh2V3ai.js";import"./utils-DYurMneM.js";import"./mat4f32-DcsiF_Rp.js";import"./ElevationInfo-BPOqhCue.js";import"./unitConversionUtils-rg07EgOm.js";import"./lengthUtils-_77UiyVF.js";import"./InputManager-DZ3jJnlx.js";import"./SketchViewModel-Ck9IhuP_.js";import"./UpdatingHandles-CzJ4c3KT.js";import"./layerUtils-DzPrZLjb.js";import"./keybindings-CTmT1RTo.js";import"./SketchLabelOptions-DnwnoaXO.js";import"./SketchOptions-D7mgFOwQ.js";import"./angularMeasurementUtils-hHgHLVYP.js";import"./Cyclical-Dlbl-cQK.js";import"./quantityUtils-BsDK158M.js";import"./SnappingManager-DoaI-UDx.js";import"./RightAngleSnappingHint-BepRvd6S.js";import"./Query-B_2mhyL4.js";import"./Field-BDG0QV_T.js";import"./fieldType-CBeoJWlv.js";import"./FullTextSearch-CBnxSwz4.js";import"./utils-BjSXFjBJ.js";import"./Version-Cd3TlGH0.js";import"./geometry2dUtils-D9Oax6Qb.js";import"./viewUtils-CV6QVz7y.js";import"./hitTestSelectUtils-UXJPjatw.js";import"./screenUtils-BWEEmpSb.js";import"./unitFormatUtils-Q7ZG7HcF.js";import"./substitute-CvdjmBYq.js";import"./UnitSelect-63i0421p.js";import"./globalCss-vQlnDsEX.js";import"./useWidget-BajufX8l.js";import"./index-C5b9dHRB.js";import"./component-utils-D0ciaaZ_.js";import"./AnchorElementViewModel-BV8Tp06L.js";import"./colorUtils-DaPfwnk3.js";import"./ExtendedLineVisualElement-D_FcbyIy.js";import"./Octree-CmoRJhci.js";import"./InterleavedLayout-_dYEAUNK.js";import"./BufferView-0osDbyWD.js";import"./types-D0PSWh4d.js";import"./EngineVisualElement-BU-x7ubB.js";import"./GridLocalOriginFactory-CngFIYNp.js";import"./FloatArray-BQXWSSJh.js";import"./BindType-BBwFZqyN.js";import"./Matrix3PassUniform-uCCQMnlP.js";import"./Texture-BVJ22uHh.js";import"./enums-D9v74xTE.js";import"./getDataTypeBytes-BTGR5GyG.js";import"./renderState-Ci93M1-P.js";import"./basicInterfaces-CZwQPxTp.js";import"./Indices-D8XWalpO.js";import"./triangle-B1tKFm7z.js";import"./VertexAttribute-Cq4MnHjR.js";import"./ShaderTechniqueConfiguration-D4dZMCXS.js";import"./NoParameters-t-PuNrgq.js";import"./glsl-BH37Aalp.js";import"./requestImageUtils-DWgRKL5q.js";import"./TextureFormat-1mYWTFa-.js";import"./RibbonLine.glsl-DwJpAQ1c.js";import"./sdfPrimitives-DBgFWIDT.js";import"./doublePrecisionUtils-B0owpBza.js";import"./floatRGBA-Cb__GiDF.js";import"./ShaderBuilder-BKul5qh8.js";import"./RgbaFloatEncoding.glsl-_io2eW3M.js";import"./OverlayCompositing.glsl-CUa8aMAb.js";import"./SceneLighting-BuSMIzqo.js";import"./RenderCamera-CDB-KFBK.js";import"./axisAngleDegrees-DdLZENJj.js";import"./weather-zOic7P_q.js";import"./BooleanBindUniform-BgD_OP8i.js";import"./Float4DrawUniform-Db0CLl_z.js";import"./RenderPlugin-CTXypYLE.js";import"./HighlightDefaults-CumzVg9-.js";import"./VertexElementDescriptor-BLyltQyJ.js";import"./VertexArrayObject-vYejmVPr.js";import"./BufferObject-BJilD_hc.js";import"./memoryEstimations-Bcyf-mHz.js";import"./NestedMap-GuqgquCN.js";import"./HUDRenderStyle-BhGvVxgm.js";import"./VisualElement-CaupdJPJ.js";import"./LaserlineVisualElement-C8OQFtp1.js";import"./Blit-_zFq7-RL.js";import"./glUtil-CAJRmga-.js";import"./CameraSpace.glsl-g9iLbhnR.js";import"./Float2PassUniform-x4sHx2JD.js";import"./Matrix4PassUniform-COGIPIq4.js";import"./GeometryUtil-D-PMXorz.js";import"./vec3f32-nZdmKIgz.js";import"./lineStippleUtils-C89mzWlO.js";import"./ElevationContext-BJejROd5.js";import"./hydratedFeatures-CNHxsqRS.js";import"./line-BiDIlUeT.js";import"./line-C6947dd5.js";import"./triangulationUtils-Cu97ljqy.js";import"./earcut-D9gy186-.js";import"./deduplicate-Cp1WDW0w.js";let z=class{constructor(t){this._params=t,this._highlightTask=null,this._highlightHandle=null,this._visualElementHandle=null,this._settings=new A({getTheme:()=>this._params.view.effectiveTheme})}destroy(){this.remove()}remove(){this._highlightTask=E(this._highlightTask),this._highlightHandle=_(this._highlightHandle),this._visualElementHandle=_(this._visualElementHandle)}showHighlight(t){if(this.remove(),t==null||!c(t))return;const r=t.layer;this._highlightTask=T(async i=>{const o=await this._params.view.whenLayerView(r);D(i),I(o)&&(this._highlightHandle=o.highlight(t))})}showReshaping(t){if(this.remove(),t==null)return;const r=this._params.view,i=new $({view:r,geometry:c(t)?t.geometry:null,attached:!1,elevationInfo:O(t),renderOccluded:j.OccludeAndTransparentStencil,isDecoration:!0}),o=new M({graphic:t}),e=[n(()=>o.isDraped,m=>{i.isDraped=m}),o.on("changed",()=>{i.geometry=c(t)?t.geometry:null}),r.trackGraphicState(o),r.maskOccludee(t),H(i)];this._settings.visualElements.lineObjects.outline.apply(i),i.attached=!0,this._visualElementHandle=R(e)}};function c(p){return p.geometry!=null&&p.geometry.type==="polyline"}let h=class extends P{constructor(p){super(p),this._chartData=null,this._visualElements=[],this._update=t=>{const{chartData:r}=t;if(r==null)return this.remove();if(!r.refined)return;const i=this._visualElements,o=r.lines.filter(s=>s.viewVisualizationEnabled),e=o.length;for(;i.length>e;)i.pop().destroy();const m=w().profileLinesStyle3D;for(;i.length<e;){const s=new $({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:m.innerWidth,innerColor:m.innerColor,width:m.width,falloff:m.falloff,renderOccluded:m.renderOccluded,isDecoration:!0});i.push(s)}const a=t.spatialReference;for(let s=0;s<e;++s){const g=i[s],f=o[e-1-s];g.geometry=V(f,a),g.color=x(S.toUnitRGBA(f.color))}}}initialize(){const p=w().profileLinesUpdateThrottleMillis;let t=this._update;{const r=C(this._update,p);this.addHandles(r),t=r}this.addHandles([n(()=>({spatialReference:this.view.spatialReference,chartData:this._chartData}),t,l)])}destroy(){this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(p){this._chartData=p}_destroyVisualElements(){this._visualElements.forEach(p=>p.destroy()),this._visualElements.length=0}};u([v()],h.prototype,"view",void 0),u([v()],h.prototype,"_chartData",void 0),h=u([b("esri.widgets.ElevationProfile.support.ProfileLines3D")],h);class To{constructor(t,r){this._handles=new L,this._inputRepresentation=new z({view:t}),this._hoveredPoints=new k({view:t}),this._profileLines=new h({view:t}),this._handles.add([n(()=>r.viewModel.hoveredPoints,i=>this._hoveredPoints.update(i),l),n(()=>{const{state:i,editable:o,highlightEnabled:e,viewModel:m}=r,a=m.input;return a&&(a.commitProperty("geometry"),a.commitProperty("layer")),{input:a,state:i,editable:o,highlightEnabled:e}},i=>this._updateInputRepresentation(i),l),n(()=>r.viewModel.chartData,i=>this._profileLines.update(i),l),n(()=>{var i;return(i=r.viewModel.input)==null?void 0:i.geometry},()=>{this._profileLines.remove()},l)])}destroy(){this._handles=d(this._handles),this._inputRepresentation=d(this._inputRepresentation),this._hoveredPoints=d(this._hoveredPoints),this._profileLines=d(this._profileLines)}_updateInputRepresentation({input:t,state:r,editable:i,highlightEnabled:o}){const e=this._inputRepresentation;if(!o)return e.remove();r===y.Selected?e.showHighlight(t):r!==y.Created||i?e.remove():e.showReshaping(t)}}export{To as ElevationProfileView3D};
