const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./FeatureLayer-wa_7EIxE.js","./index-Bh2oEzTI.js","./index-2kwcjS9-.css","./tslib.es6-B3Jf3DVX.js","./PopupTemplate-BHMhS05j.js","./Clonable-D3rtuBWg.js","./Accessor-BLX9ikPh.js","./subclass-BZA_h8Db.js","./Collection-CEdjem1-.js","./Evented-BHRw9x22.js","./shared-B3wH2qpO.js","./SimpleObservable-KocWTzVy.js","./assets-C43MgM-v.js","./cast-Bjksrh93.js","./writer-DNAwXnhG.js","./fieldUtils-tmQlKvWo.js","./intl-CChhNOV8.js","./date-DlqISzcw.js","./jsonMap-0cxwUWs2.js","./locale-C9TlLpzi.js","./messages-OmQvZhAg.js","./mathUtils-C4_ghTv4.js","./geometry-D964gYQX.js","./Extent-Bf3YTe7m.js","./Point-Cg0-ChZE.js","./Polyline-D9YkgmM_.js","./enumeration-Ba5njXdz.js","./Color-BCS62Hs5.js","./colorUtils-0bJDPow9.js","./ActionToggle-iT4slXc7.js","./Identifiable-B1UbsKNt.js","./ClassBreaksRenderer-BuHwSyVK.js","./symbols-CNimns--.js","./TextSymbol-D8QO_KUV.js","./screenUtils-_ZIvrt5o.js","./materialUtils-DarhapKC.js","./opacityUtils-C68Tlu6_.js","./vec3f64-BLpZdpfb.js","./aaBoundingBox-BE7cC1jD.js","./persistableUrlUtils-fa1mAujs.js","./collectionUtils-D_lHIu88.js","./Portal-C10FKnaA.js","./Loadable-BabW5Xcc.js","./Promise-B2Hu02L7.js","./reactiveUtils-C5zUhJQJ.js","./asyncUtils-CWX51uTe.js","./UniqueValueRenderer-BQtAHUSo.js","./diffUtils-BP7jmOAy.js","./colorRamps-pKd7I5WZ.js","./SizeVariable-936USOrb.js","./sizeVariableUtils-Cmcuvw-4.js","./visualVariableUtils-DX1kS9Se.js","./Graphic-DsxsIjhH.js","./jsonUtils-CEfjT-BK.js","./compilerUtils-Dw3R0f-Z.js","./lengthUtils-DL1-FDQQ.js","./ColorStop-Dk3U5tCk.js","./jsonUtils-Ds2Sqto-.js","./layerUtils-BrNoooE9.js","./defaults-DZ1kfMRx.js","./defaultsJSON-GKolV7NZ.js","./RendererLegendOptions-B-4se3aU.js","./styleUtils-BYTm14n3.js","./jsonUtils-DxpLMo6d.js","./LRUCache-B_PHMSGm.js","./MemCache-Dx1v3xLC.js","./Version-BSlAgupz.js","./FieldsIndex-DpwHKAMX.js","./UnknownTimeZone-BkowvBs8.js","./OverrideHelper-ti072FkP.js","./colorUtils-aL8wj-8G.js","./vec42-YcqnINSP.js","./common-DQOJ18NT.js","./vec4f64-o2zAXfmz.js","./utils-D2PLyMFF.js","./enums-CmIX1y88.js","./quantizationUtils-uj_P09aO.js","./HeatmapColorStop-BJc5nbwr.js","./heatmapUtils-Dwiv9IEa.js","./SimpleRenderer-BV2L9G_n.js","./MultiOriginJSONSupport-B5nfqtQh.js","./layerContainerType-C5CzMsLd.js","./FeatureLayerBase-Ck7-w8TE.js","./formUtils-ylzKAM7E.js","./Field-ybkHhtnK.js","./fieldType-BuzM0UHS.js","./HeightModelInfo-9nOoV6LU.js","./arcgisLayerUrl-BX1FE5Hm.js","./commonProperties-CPyIG_-u.js","./ElevationInfo-CA5m_tHv.js","./unitConversionUtils-BMfW9yAe.js","./AttributeTableTemplate-BZeVyq-j.js","./featureLayerUtils-DBsQMhTm.js","./featureQueryAll-DnVoEjkM.js","./Query-5Xpquc1r.js","./DataLayerSource-BKkswDvG.js","./FullTextSearch-Csd1Hktu.js","./TimeExtent-DocT5yPf.js","./timeUtils-8fb_2oAt.js","./AttachmentQuery-BUlkjzkx.js","./RelationshipQuery-DPPNeuLK.js","./LayerFloorInfo-CIQjg5Vk.js","./Relationship-COPq3qM4.js","./serviceCapabilitiesUtils-DAE5z8FP.js","./Layer-CVt7Hb5J.js","./workers-D4HfeYKj.js","./Queue-yu3bZ02p.js","./editsZScale-Bs7_pSzI.js","./queryZScale-w66xFVGx.js","./projection-B971H0Re.js","./projectBuffer-Bs7GwaPY.js","./geodesicConstants-DWQLYX7F.js","./FeatureSet-BHEkYP03.js","./APIKeyMixin-Di9kcRBS.js","./ArcGISService-B5qxetOY.js","./BlendLayer-CXM4n_Ge.js","./jsonUtils-CSnQD004.js","./parser-CTsgEym6.js","./utils-93yNk4Xc.js","./mat4f32-DcsiF_Rp.js","./mat4-GpOFENPA.js","./CustomParametersMixin-B4u7wiBT.js","./EditBusLayer-DoTks2sU.js","./uuid-fwrPAdZb.js","./FeatureEffectLayer-CpM66wLd.js","./FeatureEffect-BEzQmzeC.js","./FeatureFilter-BMHRQSxq.js","./FeatureReductionLayer-Ddbk727V.js","./FeatureReductionSelection-7vaL4DYT.js","./labelingInfo-DYPSPZCH.js","./labelUtils-B8petyBk.js","./MD5-C9MwAd2G.js","./OperationalLayer-CVyVfSPu.js","./OrderedLayer-C5VLMHgA.js","./OrderByInfo-IYmS1EXF.js","./PortalLayer-CKja4bdW.js","./PortalItem-DzgXrpyc.js","./portalItemUtils-BzVoFAku.js","./RefreshableLayer-D7lXUJRS.js","./ScaleRangeLayer-Bb8Ig1Hz.js","./TemporalLayer-Dpq2hKKV.js","./TimeInfo-LUiaSFyX.js","./TimeInterval-CNlkea1s.js","./FeatureTemplate-CssMa1yk.js","./FeatureType-C0q_coeM.js","./fieldProperties-Cgxj08ZE.js","./versionUtils-CQ_WhYSP.js","./styleUtils-KMFBtb6u.js","./popupUtils-BBuPGAHd.js","./AlphaCutoff-UcccL64p.js","./interfaces-CL2NbQte.js","./MapImageLayer-BowoyVwQ.js","./loadAll-B6mYSptb.js","./scaleUtils-D_Nw3nhM.js","./SublayersOwner-CVD3EI_7.js","./CollectionFlattener-CQN6i8ZK.js","./QueryTask-C8VdGZ7z.js","./infoFor3D-C0hFfS1m.js","./utils-6jMaHUrH.js","./executeForIds-BCHBDnMa.js","./query-Dw-gv3BA.js","./normalizeUtils-EVmAQ-ak.js","./normalizeUtilsCommon-dT81xWiM.js","./utils-Bema0iXE.js","./pbfQueryUtils-B0fU-MiS.js","./pbf-BtDZ1BpD.js","./OptimizedGeometry-BF8iz5FO.js","./OptimizedFeature-6cJ-QFG5.js","./OptimizedFeatureSet-Blu9Ckm7.js","./executeQueryJSON-Cis2sczl.js","./featureConversionUtils-D14h8iad.js","./sublayerUtils-DEyYrAdA.js","./ExportImageParameters-D2m0BUqR.js","./floorFilterUtils-DZ5C6FQv.js","./imageBitmapUtils-aMNhrXcv.js","./calcite-action-Bys6x4p_.js","./action-D0Er9Ef6.js","./jsxFactory-CJa39Fro.js","./dom-D_AJDzAj.js","./interactive-y84HQRWL.js","./loadable-DM18hPdE.js","./locale-A4FuYD8q.js","./key-D63ExP77.js","./observers-D2xgmA06.js","./component-6CIDVndn.js","./t9n-D0ry3MEw.js","./icon-BQO9J86c.js","./loader-C-zIPscB.js","./calcite-block-M0XyV5ob.js","./conditionalSlot-R5D9krYS.js","./Heading-D7P0OjYI.js","./openCloseComponent-CmOrfBN-.js","./floating-ui-Bma_zPVt.js","./debounce-BOqmhDXu.js","./action-menu-C6uYzPu-.js","./array-BMcQdnYi.js","./popover-Q5ruM4hh.js","./focusTrapComponent-BSUg_DLj.js","./FloatingArrow-BBdsG5MP.js","./handle-Ct1HP3bl.js","./scrim-DPa2aeKh.js","./calcite-button-D_Agetwz.js","./button-9P4PM9SO.js","./form-BZPQ5PUM.js","./label-DEe8AW1C.js","./calcite-checkbox-B8olv0Y9.js","./calcite-combobox-DZ_miEwS.js","./combobox-CAZmwDcP.js","./core-Cpfj44ZG.js","./filter-yN6-jZOU.js","./Validation-Bz9yoU6e.js","./utils2-COUKy2o1.js","./chip-ZieJjxzJ.js","./combobox-item-DwxSVkl7.js","./input-message-CWvsvdFk.js","./calcite-combobox-item-BtecfP0L.js","./calcite-flow-BrE9BG4l.js","./calcite-flow-item-B0xZ0mWX.js","./panel-BdAbXPwM.js","./calcite-icon-Cu0W9dtm.js","./calcite-input-DAafN6Cc.js","./input2-BReyTnf4.js","./input-j1u1wOBY.js","./progress-BXyickl_.js","./calcite-input-number-BjjBFtSg.js","./input-number-BVYRKcQu.js","./calcite-label-B1FxWqaL.js","./calcite-list-C4jOVpC-.js","./resources4-DXHY1U7R.js","./utils3-BrU6GrkI.js","./calcite-list-item-vbKS6alm.js","./calcite-loader-DP4PIFO8.js","./calcite-switch-CkUGVtze.js","./switch-Drd7BD6R.js","./calcite-chip-C9GKwE1v.js","./calcite-popover-5MaBc2pF.js","./calcite-link-CJF8okEV.js"])))=>i.map(i=>d[i]);
import{_ as M}from"./index-Bh2oEzTI.js";import{r as n}from"./tslib.es6-B3Jf3DVX.js";import"./geometry-D964gYQX.js";import{l as ft}from"./intl-CChhNOV8.js";import{V as Pt}from"./Collection-CEdjem1-.js";import{i as Dt,n as ae}from"./jsonMap-0cxwUWs2.js";import{watch as Q,initial as Ft,whenOnce as ca}from"./reactiveUtils-C5zUhJQJ.js";import{b as ua}from"./unitFormatUtils-CZ2bRlFg.js";import{f as Y,U as X,i as ne,K as ge,o as da,a7 as Mt,g as ma,F as ha}from"./assets-C43MgM-v.js";import{m as p,a as R,N as ya,b as Z,g as At,O as bt,f as fa}from"./subclass-BZA_h8Db.js";import{g as ce,D as gt,I as vt,z as ba,o as ga,c as va}from"./Point-Cg0-ChZE.js";import{s as _a,f as oe,i as wa,u as Ce}from"./utils-6jMaHUrH.js";import{n as c,e as Fe,B as Ta,r as Ia,u as Sa,v as xa}from"./jsxFactory-CJa39Fro.js";import{b as de,m as _t,u as Ie,c as Nt}from"./Accessor-BLX9ikPh.js";import{m as Oa}from"./Loadable-BabW5Xcc.js";import{s as $a}from"./ReactiveMap-6CfRGOlR.js";import{c as Rt,u as Se,e as wt}from"./screenUtils-_ZIvrt5o.js";import{j as ka,E as Ca}from"./date-DlqISzcw.js";import{l as La}from"./locale-C9TlLpzi.js";import{b as Vt,c as Tt}from"./Portal-C10FKnaA.js";import{v as Ea}from"./Polyline-D9YkgmM_.js";import{J as Pa}from"./fieldUtils-tmQlKvWo.js";import{o as Da}from"./floorFilterUtils-DZ5C6FQv.js";import{getSizeRangeAtScale as Fa}from"./visualVariableUtils-DX1kS9Se.js";import{w as Je}from"./Extent-Bf3YTe7m.js";import{R as Ma}from"./normalizeUtils-EVmAQ-ak.js";import{y as Aa}from"./Field-ybkHhtnK.js";import{r as ve}from"./enumeration-Ba5njXdz.js";import{t as Na,s as Ra}from"./networkEnums-Be43aAGx.js";import{d as Ne}from"./FeatureSet-BHEkYP03.js";import{a as Ut}from"./GPMessage-BgDd7beU.js";import{l as Va}from"./Color-BCS62Hs5.js";import{y as Ua,d as It,S as ja}from"./TextSymbol-D8QO_KUV.js";import{r as Ja}from"./layerViewUtils-DhFEu8Rd.js";import Le from"./PortalItem-DzgXrpyc.js";import{_ as Ba}from"./viewpointUtils-CRlgks6_.js";import{_ as St}from"./InputManager-Ba9xzDpe.js";import{x as Ga}from"./MD5-C9MwAd2G.js";import{e as Me}from"./globalCss-CZa70j6i.js";import{e as Ha}from"./Heading-C-odFCu-.js";import{i as Wa}from"./legacyIcon-CEIp6Pa9.js";import"./messages-OmQvZhAg.js";import"./Evented-BHRw9x22.js";import"./shared-B3wH2qpO.js";import"./SimpleObservable-KocWTzVy.js";import"./asyncUtils-CWX51uTe.js";import"./ByteSizeUnit-BsxeN7wM.js";import"./Cyclical-oTUX3aX7.js";import"./mathUtils-C4_ghTv4.js";import"./quantityUtils-D0GB2dMc.js";import"./cast-Bjksrh93.js";import"./writer-DNAwXnhG.js";import"./Promise-B2Hu02L7.js";import"./uuid-fwrPAdZb.js";import"./Graphic-DsxsIjhH.js";import"./PopupTemplate-BHMhS05j.js";import"./Clonable-D3rtuBWg.js";import"./ActionToggle-iT4slXc7.js";import"./Identifiable-B1UbsKNt.js";import"./symbols-CNimns--.js";import"./materialUtils-DarhapKC.js";import"./opacityUtils-C68Tlu6_.js";import"./vec3f64-BLpZdpfb.js";import"./aaBoundingBox-BE7cC1jD.js";import"./persistableUrlUtils-fa1mAujs.js";import"./collectionUtils-D_lHIu88.js";import"./jsonUtils-CEfjT-BK.js";import"./compilerUtils-Dw3R0f-Z.js";import"./lengthUtils-DL1-FDQQ.js";import"./sizeVariableUtils-Cmcuvw-4.js";import"./colorUtils-0bJDPow9.js";import"./normalizeUtilsCommon-dT81xWiM.js";import"./utils-Bema0iXE.js";import"./fieldType-BuzM0UHS.js";import"./Viewpoint-C4FqWA2d.js";import"./common-DQOJ18NT.js";import"./mat2d-D9DBP-jx.js";import"./mat2df64-CBKYtunK.js";import"./vec2-maR1OrZI.js";import"./vec2f64-miziP1SN.js";import"./projection-B971H0Re.js";import"./projectBuffer-Bs7GwaPY.js";import"./geodesicConstants-DWQLYX7F.js";import"./Queue-yu3bZ02p.js";import"./signal-D4lghLjV.js";const be=Dt()({AIX:"aix",EPS:"eps",GIF:"gif",JPG:"jpg",PDF:"pdf",PNG32:"png32",PNG8:"png8",SVG:"svg",SVGZ:"svgz",TIFF:"tiff"});let J=class extends de{constructor(t){super(t),this.state="pending",this.url=""}initialize(){this.addHandles(Q(()=>[this.extension,this.name],()=>this._setFormattedFileName(),Ft))}_setFormattedFileName(){this.name&&this.extension&&(this.formattedName=this.count?`${this.name}(${this.count}).${this.extension}`:`${this.name}.${this.extension}`)}};n([p()],J.prototype,"count",void 0),n([p()],J.prototype,"error",void 0),n([p()],J.prototype,"extension",void 0),n([p()],J.prototype,"formattedName",void 0),n([p()],J.prototype,"name",void 0),n([p()],J.prototype,"portalItem",void 0),n([p()],J.prototype,"state",void 0),n([p()],J.prototype,"url",void 0),J=n([R("esri.widgets.Print.FileLink")],J);const jt=J;var Re;let H=Re=class extends de{constructor(e){super(e),this.outSpatialReference=null,this.processExtent=null,this.processSpatialReference=null,this.returnColumnName=!1,this.returnFeatureCollection=!1,this.returnM=!1,this.returnZ=!1}static from(e){return ya(Re,e)}};n([p({type:ce})],H.prototype,"outSpatialReference",void 0),n([p({type:Je})],H.prototype,"processExtent",void 0),n([p({type:ce})],H.prototype,"processSpatialReference",void 0),n([p({nonNullable:!0})],H.prototype,"returnColumnName",void 0),n([p({nonNullable:!0})],H.prototype,"returnFeatureCollection",void 0),n([p({nonNullable:!0})],H.prototype,"returnM",void 0),n([p({nonNullable:!0})],H.prototype,"returnZ",void 0),H=Re=n([R("esri.rest.geoprocessor.GPOptions")],H);const Be=H;let B=class extends Y{constructor(){super(...arguments),this.extent=null,this.height=null,this.href=null,this.opacity=1,this.rotation=0,this.scale=null,this.visible=!0,this.width=null}};n([p({type:Je})],B.prototype,"extent",void 0),n([p()],B.prototype,"height",void 0),n([p()],B.prototype,"href",void 0),n([p()],B.prototype,"opacity",void 0),n([p()],B.prototype,"rotation",void 0),n([p()],B.prototype,"scale",void 0),n([p()],B.prototype,"visible",void 0),n([p()],B.prototype,"width",void 0),B=n([R("esri.layers.support.MapImage")],B);const za=B;let me=class extends Y{constructor(t){super(t),this.area=0,this.units=null}};n([p({json:{write:!0}})],me.prototype,"area",void 0),n([ve(Na)],me.prototype,"units",void 0),me=n([R("esri.rest.support.ArealUnit")],me);const qa=me;let he=class extends Y{constructor(t){super(t),this.itemId=null,this.url=null}};n([p({type:String,json:{read:{source:"itemID"},write:{target:"itemID"}}})],he.prototype,"itemId",void 0),n([p({type:String,json:{write:!0}})],he.prototype,"url",void 0),he=n([R("esri.rest.support.DataFile")],he);const Ae=he;let ye=class extends Y{constructor(t){super(t),this.distance=0,this.units=null}};n([p({json:{write:!0}})],ye.prototype,"distance",void 0),n([ve(Ra)],ye.prototype,"units",void 0),ye=n([R("esri.rest.support.LinearUnit")],ye);const Ka=ye,N="multi-value-",Ge=new ae({GPArealUnit:"areal-unit",GPBoolean:"boolean",GPComposite:"composite",GPDataFile:"data-file",GPDate:"date",GPDouble:"double",GPFeatureRecordSetLayer:"feature-record-set-layer",Field:"field",GPLinearUnit:"linear-unit",GPLong:"long",GPRasterData:"raster-data",GPRasterDataLayer:"raster-data-layer",GPRecordSet:"record-set",GPString:"string",GPValueTable:"value-table","GPMultiValue:GPArealUnit":`${N}areal-unit`,"GPMultiValue:GPBoolean":`${N}boolean`,"GPMultiValue:GPComposite":`${N}composite`,"GPMultiValue:GPDataFile":`${N}data-file`,"GPMultiValue:GPDate":`${N}date`,"GPMultiValue:GPDouble":`${N}double`,"GPMultiValue:GPFeatureRecordSetLayer":`${N}feature-record-set-layer`,"GPMultiValue:Field":`${N}field`,"GPMultiValue:GPLinearUnit":`${N}linear-unit`,"GPMultiValue:GPLong":`${N}long`,"GPMultiValue:GPRasterData":`${N}raster-data`,"GPMultiValue:GPRasterDataLayer":`${N}raster-data-layer`,"GPMultiValue:GPRecordSet":`${N}record-set`,"GPMultiValue:GPString":`${N}string`});let re=class extends Y{constructor(t){super(t),this.dataType=null,this.paramName=null,this.value=null}};n([ve(Ge,{ignoreUnknown:!1})],re.prototype,"dataType",void 0),n([p()],re.prototype,"paramName",void 0),n([p()],re.prototype,"value",void 0),re=n([R("esri.rest.support.ParameterValue")],re);const Za=re;let le=class extends Y{constructor(t){super(t),this.format=null,this.itemId=null,this.url=null}};n([p()],le.prototype,"format",void 0),n([p({json:{read:{source:"itemID"},write:{target:"itemID"}}})],le.prototype,"itemId",void 0),n([p()],le.prototype,"url",void 0),le=n([R("esri.rest.support.RasterData")],le);const Qa=le;async function Jt(e,t,a,i,o){const r={},l={},u=[];return Xa(i,u,r),Ma(u).then(d=>{const{outSpatialReference:s,processExtent:m,processSpatialReference:y,returnColumnName:b,returnFeatureCollection:$,returnM:f,returnZ:x}=a,{path:g}=oe(e);for(const I in r){const[_,C]=r[I];l[I]=d.slice(_,C)}const k=s?s.wkid||s:null,D=y?y.wkid||y:null,w=t==="execute"?{returnColumnName:b||void 0,returnFeatureCollection:$||void 0,returnM:f||void 0,returnZ:x||void 0}:null,L=Ee({...m?{context:{extent:m,outSR:k,processSR:D}}:{"env:outSR":k,"env:processSR":D},...i,...w,f:"json"},null,l),S={...o,query:L};return X(`${g}/${t}`,S)})}function Xa(e,t,a){for(const i in e){const o=e[i];if(o&&typeof o=="object"&&o instanceof Ne){const{features:r}=o;a[i]=[t.length,t.length+r.length],r.forEach(l=>{t.push(l.geometry)})}}}async function Ve(e,t){switch(e){case"areal-unit":return qa.fromJSON(t);case"boolean":case"double":case"long":case"string":case"value-table":return t;case"date":return new Date(t);case"data-file":return Ae.fromJSON(t);case"linear-unit":return Ka.fromJSON(t);case"feature-record-set-layer":if("url"in t)return Ae.fromJSON(t);if("layerDefinition"in t){const a=new(await M(async()=>{const{default:r}=await import("./FeatureLayer-wa_7EIxE.js");return{default:r}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150]),import.meta.url)).default,{layerDefinition:i,featureSet:o}=t;return a.read({layerDefinition:i,featureSet:o},{origin:"portal-item"}),a.spatialReference=ce.fromJSON(o.spatialReference??i.spatialReference??i.extent.spatialReference),a}return Ne.fromJSON(t);case"record-set":return"url"in t?Ae.fromJSON(t):Ne.fromJSON(t);case"raster-data":case"raster-data-layer":return"mapImage"in t?za.fromJSON(t.mapImage):Qa.fromJSON(t);case"field":return Aa.fromJSON(t)}}function Ya(e){return e.startsWith(N)}function ei(e){return e.replace(N,"")}async function ti(e,t){const a=ei(e),i=a==="composite"?t.map(o=>Ve(Ge.fromJSON(o.dataType),o.value)):t.map(o=>Ve(a,o));return Promise.all(i)}async function Ue(e){const t=Ge.fromJSON(e.dataType),{paramName:a}=e,i=Ya(t)?await ti(t,e.value):await Ve(t,e.value);return new Za({dataType:t,paramName:a,value:i})}function Ee(e,t,a){for(const i in e){const o=e[i];Array.isArray(o)?e[i]=JSON.stringify(o.map(r=>Ee({item:r},!0).item)):o instanceof Date&&(e[i]=o.getTime())}return _a(e,t,a)}async function Bt(e,t,a,i){return a=Be.from(a||{}),Jt(e,"execute",a,t??{},i).then(async({data:o})=>{var r,l;return{results:await Promise.all(((r=o.results)==null?void 0:r.map(Ue))??[]),messages:((l=o.messages)==null?void 0:l.map(u=>Ut.fromJSON(u)))??[]}})}var Oe;const ai=Dt()({esriJobCancelled:"job-cancelled",esriJobCancelling:"job-cancelling",esriJobDeleted:"job-deleted",esriJobDeleting:"job-deleting",esriJobTimedOut:"job-timed-out",esriJobExecuting:"job-executing",esriJobFailed:"job-failed",esriJobNew:"job-new",esriJobSubmitted:"job-submitted",esriJobSucceeded:"job-succeeded",esriJobWaiting:"job-waiting"},{ignoreUnknown:!1}),xt=1e3;let z=Oe=class extends Y{constructor(e){super(e),this.jobId=null,this.jobStatus=null,this.messages=null,this.progress=null,this.requestOptions=null,this.sourceUrl=null,this._cancelJobTimer=void 0,this._jobCompletionTimer=void 0}async cancelJob(e){const{jobId:t,sourceUrl:a}=this,{path:i}=oe(a),o={...this.requestOptions,...e,query:{f:"json"}},r=`${i}/jobs/${t}/cancel`,{data:l}=await X(r,o),{messages:u,jobStatus:d,progress:s}=Oe.fromJSON(l);return this.set({messages:u,jobStatus:d,progress:s}),d==="job-cancelled"?this:new Promise((m,y)=>{_t(o.signal,()=>{this._clearCancelJobTimer(),y(Ie())}),this._clearCancelJobTimer(),this._cancelJobTimer=setInterval(()=>{this._cancelJobTimer||y(Ie()),this.checkJobStatus(e).then(({jobStatus:b})=>{switch(b){case"job-cancelling":break;case"job-deleted":case"job-deleting":case"job-executing":case"job-failed":case"job-new":case"job-submitted":case"job-succeeded":case"job-timed-out":case"job-waiting":this._clearCancelJobTimer(),y(this);break;case"job-cancelled":this._clearCancelJobTimer(),m(this)}})},xt)})}destroy(){clearInterval(this._cancelJobTimer),clearInterval(this._jobCompletionTimer)}async checkJobStatus(e){const{path:t}=oe(this.sourceUrl),a={...this.requestOptions,...e,query:{f:"json"}},i=`${t}/jobs/${this.jobId}`,{data:o}=await X(i,a),{messages:r,jobStatus:l,progress:u}=Oe.fromJSON(o);return this.set({messages:r,jobStatus:l,progress:u}),this}async fetchResultData(e,t,a){t=Be.from(t||{});const{returnColumnName:i,returnFeatureCollection:o,returnM:r,returnZ:l,outSpatialReference:u}=t,{path:d}=oe(this.sourceUrl),s=Ee({returnColumnName:i||null,returnFeatureCollection:o||null,returnM:r||null,returnZ:l||null,outSR:u,returnType:"data",f:"json"},null),m={...this.requestOptions,...a,query:s},y=`${d}/jobs/${this.jobId}/results/${e}`,{data:b}=await X(y,m);return Ue(b)}async fetchResultImage(e,t,a){const{path:i}=oe(this.sourceUrl),o={...t.toJSON(),f:"json"},r=Ee(o),l={...this.requestOptions,...a,query:r},u=`${i}/jobs/${this.jobId}/results/${e}`,{data:d}=await X(u,l);return Ue(d)}async fetchResultMapImageLayer(){const{path:e}=oe(this.sourceUrl),t=e.indexOf("/GPServer/"),a=`${e.slice(0,Math.max(0,t))}/MapServer/jobs/${this.jobId}`;return new(await M(async()=>{const{default:i}=await import("./MapImageLayer-BowoyVwQ.js");return{default:i}},__vite__mapDeps([151,3,12,7,1,2,6,152,45,8,9,10,11,42,43,80,14,23,24,13,18,153,21,104,22,25,30,97,98,17,19,113,154,66,87,39,88,81,89,15,16,20,90,55,91,36,137,109,37,110,111,155,44,4,5,26,27,28,29,31,32,33,34,35,38,40,41,46,47,48,49,50,51,52,53,54,56,57,58,59,60,61,62,63,64,65,67,68,69,70,71,72,73,74,75,76,77,78,79,156,157,95,84,85,158,159,160,161,162,163,164,165,166,167,168,108,94,96,169,112,170,92,93,99,100,144,143,129,130,101,102,103,148,171,114,115,116,117,118,119,120,121,132,135,136,138,139,140,141,142,172,173,174,146]),import.meta.url)).default({url:a})}async waitForJobCompletion(e={}){const{interval:t=xt,signal:a,statusCallback:i}=e;return new Promise((o,r)=>{_t(a,()=>{this._clearJobCompletionTimer(),r(Ie())}),this._clearJobCompletionTimer(),this._jobCompletionTimer=setInterval(()=>{this._jobCompletionTimer||r(Ie()),this.checkJobStatus().then(({jobStatus:l})=>{switch(l){case"job-succeeded":this._clearJobCompletionTimer(),o(this);break;case"job-executing":case"job-new":case"job-submitted":case"job-waiting":i&&i(this);break;case"job-cancelled":case"job-cancelling":case"job-deleted":case"job-deleting":case"job-failed":case"job-timed-out":this._clearJobCompletionTimer(),r(this)}}).catch(l=>{this._clearJobCompletionTimer(),r(l)})},t)})}_clearCancelJobTimer(){clearInterval(this._cancelJobTimer),this._cancelJobTimer=void 0}_clearJobCompletionTimer(){clearInterval(this._jobCompletionTimer),this._jobCompletionTimer=void 0}};n([p()],z.prototype,"jobId",void 0),n([ve(ai,{ignoreUnknown:!1})],z.prototype,"jobStatus",void 0),n([p({type:[Ut]})],z.prototype,"messages",void 0),n([p()],z.prototype,"progress",void 0),n([p()],z.prototype,"requestOptions",void 0),n([p({json:{write:!0}})],z.prototype,"sourceUrl",void 0),z=Oe=n([R("esri.rest.support.JobInfo")],z);const ii=z;async function Gt(e,t,a,i){return a=Be.from(a||{}),Jt(e,"submitJob",a,t??{},i).then(({data:o})=>{const r=ii.fromJSON(o);return r.sourceUrl=e,r})}const Pe=new ae({MAP_ONLY:"map-only","A3 Landscape":"a3-landscape","A3 Portrait":"a3-portrait","A4 Landscape":"a4-landscape","A4 Portrait":"a4-portrait","Letter ANSI A Landscape":"letter-ansi-a-landscape","Letter ANSI A Portrait":"letter-ansi-a-portrait","Tabloid ANSI B Landscape":"tabloid-ansi-b-landscape","Tabloid ANSI B Portrait":"tabloid-ansi-b-portrait"}),fe=Pe.fromJSON.bind(Pe),oi=Pe.toJSON.bind(Pe);function ri(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}}function li(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}}function Ot(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}}function si(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}}function ni(e,t=15){const a=e.canvas.width,i=e.canvas.height,o=e.getImageData(0,0,a,i).data;let r,l,u,d,s,m;e:for(l=i;l--;)for(r=a;r--;)if(o[4*(a*l+r)+3]>t){m=l;break e}if(!m)return null;e:for(r=a;r--;)for(l=m+1;l--;)if(o[4*(a*l+r)+3]>t){s=r;break e}e:for(r=0;r<=s;++r)for(l=m+1;l--;)if(o[4*(a*l+r)+3]>t){u=r;break e}e:for(l=0;l<=m;++l)for(r=u;r<=s;++r)if(o[4*(a*l+r)+3]>t){d=l;break e}return{x:u,y:d,width:s-u,height:m-d}}function pi(e,t){var o,r;const a=((o=t.color)==null?void 0:o.clone())??new Va([0,255,255]),i=((r=t.haloColor)==null?void 0:r.clone())??a.clone();switch(e){case"envelope":case"polygon":return a.a*=t.fillOpacity??.25,new ja({color:a,outline:new It({color:i}),style:"solid"});case"polyline":return new It({color:i});default:return i.a=1,new Ua({color:i,outline:null})}}function ci(e,t){const a=e.allLayerViews.items;if(t===e.scale)return a.filter(o=>!o.suspended);const i=new Array;for(const o of a){const r=o.parent;r&&r!==o.view&&(di(r)||mi(r))&&!i.includes(r)||o.visible&&o.visibleAtCurrentTimeExtent&&Ja(o.layer.effectiveScaleRange,t)&&i.push(o)}return i}function ui(e){return(e==null?void 0:e.type)==="bing-maps"}function Ht(e){return e&&"blendMode"in e&&"effect"in e}function di(e){return e.layer.type==="catalog"}function mi(e){return e.layer.type==="group"}function hi(e){const t=e.layer;if(Ht(t)){const a=t.blendMode;if((!a||a==="normal")&&(t.effect||"featureEffect"in e&&e.featureEffect))return!0}return!1}let A=class extends de{constructor(t){super(t),this.attributionVisible=!0,this.exportOptions={width:800,height:1100,dpi:96},this.forceFeatureAttributes=!1,this.format="png32",this.includeCharts=!1,this.includeTables=!1,this.label=null,this.layout="map-only",this.layoutItem=null,this.layoutOptions=null,this.outScale=0,this.report=null,this.reportItem=null,this.reportOptions=null,this.scalePreserved=!0,this.showLabels=!0}};n([p()],A.prototype,"attributionVisible",void 0),n([p()],A.prototype,"exportOptions",void 0),n([p()],A.prototype,"forceFeatureAttributes",void 0),n([p()],A.prototype,"format",void 0),n([p()],A.prototype,"includeCharts",void 0),n([p()],A.prototype,"includeTables",void 0),n([p()],A.prototype,"label",void 0),n([p()],A.prototype,"layout",void 0),n([p({type:Le})],A.prototype,"layoutItem",void 0),n([p()],A.prototype,"layoutOptions",void 0),n([p()],A.prototype,"outScale",void 0),n([p()],A.prototype,"report",void 0),n([p({type:Le})],A.prototype,"reportItem",void 0),n([p()],A.prototype,"reportOptions",void 0),n([p()],A.prototype,"scalePreserved",void 0),n([p()],A.prototype,"showLabels",void 0),A=n([R("esri.rest.support.PrintTemplate")],A);const Wt=A,De=new ae({"Attribute List Letter ANSI A Landscape":"attribute-list-letter-ansi-a-landscape","Attribute List Letter ANSI A Portrait":"attribute-list-letter-ansi-a-portrait","Attribute List With Group Letter ANSI A Landscape":"attribute-list-with-group-letter-ansi-a-landscape","Attribute List With Group Letter ANSI A Portrait":"attribute-list-with-group-letter-ansi-a-portrait","Page per Feature Letter ANSI A Landscape":"page-per-feature-letter-ansi-a-landscape","Page per Feature Letter ANSI A Portrait":"page-per-feature-letter-ansi-a-portrait"});De.fromJSON.bind(De);const yi=De.toJSON.bind(De),$t={Feet:"ft",Kilometers:"km",Meters:"m",Miles:"mi"},kt=new ae({esriFeet:"Feet",esriKilometers:"Kilometers",esriMeters:"Meters",esriMiles:"Miles"}),fi=new ae({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"}),je=new Map;async function bi(e,t,a){var u;const i=await He(e,a),o=await vi(t,i);if(await zt(e,a)==="sync"){const{results:d}=await Bt(e,o,void 0,a);return(u=d==null?void 0:d[0])==null?void 0:u.value}const r=await Gt(e,o,void 0,a);await r.waitForJobCompletion({interval:t.updateDelay});const{value:l}=await r.fetchResultData("Output_File",null,a);return l}async function He(e,t){const a=wi(e),i=je.get(a)??{gpServerUrl:a,legendLayerNameMap:{},legendLayers:[]};return i.gpMetadata??(i.gpMetadata=(await X(a,wa({f:"json"},t))).data),i.cimVersion=i.gpMetadata.cimVersion,je.set(a,i),i}async function zt(e,t){return Bi(await He(e,t))}async function gi(e,t){return(await He(e,t)).gpMetadata.tasks}async function vi(e,t){var y,b,$,f,x;t=t||{is11xService:!1,legendLayerNameMap:{},legendLayers:[]};const a=e.template||new Wt;a.showLabels==null&&(a.showLabels=!0);const i=a.exportOptions;let o;const r=oi(a.layout);if(i&&(o={dpi:i.dpi},(r==null?void 0:r.toLowerCase())==="map_only"||r==="")){const{width:g,height:k}=i;o.outputSize=g!=null&&k!=null?[g,k]:void 0}const l=a.layoutOptions;let u;if(l){let g,k;l.scalebarUnit==="Miles"||l.scalebarUnit==="Kilometers"?(g="Kilometers",k="Miles"):l.scalebarUnit!=="Meters"&&l.scalebarUnit!=="Feet"||(g="Meters",k="Feet"),u={titleText:l.titleText,authorText:l.authorText,copyrightText:l.copyrightText,customTextElements:l.customTextElements,elementOverrides:l.elementOverrides,scaleBarOptions:{metricUnit:kt.toJSON(g),metricLabel:g?$t[g]:void 0,nonMetricUnit:kt.toJSON(k),nonMetricLabel:k?$t[k]:void 0}}}let d=null;l!=null&&l.legendLayers&&(d=l.legendLayers.map(g=>{const k=g.layerId;t.legendLayerNameMap[k]=g.title;const D={id:k};return g.subLayerIds&&(D.subLayerIds=g.subLayerIds),D}));const s=await _i(e,a,t);if(s.operationalLayers){const g=new RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),k=/[\u0600-\u06FF]/,D=w=>{var _;const L=w.text,S=w.font,I=(_=S==null?void 0:S.family)==null?void 0:_.toLowerCase();L&&S&&(I==="arial"||I==="arial unicode ms")&&(S.family=g.test(L)?"Arial Unicode MS":"Arial",S.style!=="normal"&&k.test(L)&&(S.family="Arial Unicode MS"))};for(const w of s.operationalLayers)if((y=w.featureCollection)!=null&&y.layers)for(const L of w.featureCollection.layers){if((f=($=(b=L.layerDefinition)==null?void 0:b.drawingInfo)==null?void 0:$.renderer)!=null&&f.symbol){const S=L.layerDefinition.drawingInfo.renderer;S.symbol.type==="esriTS"&&D(S.symbol)}if((x=L.featureSet)!=null&&x.features)for(const S of L.featureSet.features)S.symbol&&S.symbol.type==="esriTS"&&D(S.symbol)}}e.outSpatialReference&&(s.mapOptions.spatialReference=e.outSpatialReference.toJSON()),Object.assign(s,{exportOptions:o,layoutOptions:u||{}}),Object.assign(s.layoutOptions,{legendOptions:{operationalLayers:d??t.legendLayers.slice()}}),t.legendLayers.length=0,je.set(t.gpServerUrl,t);const m={Web_Map_as_JSON:JSON.stringify(s),Format:be.toJSON(a.format),Layout_Template:r,Layout_Item_ID:void 0,Report_Template:yi(a.report),Report_Item_ID:void 0};if(a.layoutItem){delete m.Layout_Template;const g=a.layoutItem;await g.load(),g.access!=="public"&&ne&&await ne.getCredential(t.gpServerUrl),m.Layout_Item_ID=JSON.stringify({id:g.id})}if(a.reportItem){delete m.Report_Template;const g=a.reportItem;await g.load(),g.access!=="public"&&ne&&await ne.getCredential(t.gpServerUrl),m.Report_Item_ID=JSON.stringify({id:g.id})}return e.extraParameters&&Object.assign(m,e.extraParameters),m}async function _i(e,t,a){const i=e.view;let o=i.spatialReference;const r={operationalLayers:await Ti(i,t,a)};t.includeTables&&(r.tables=await Ni(i));let l=e.extent||a.ssExtent||i.extent;if(o!=null&&o.isWrappable&&(l=l.clone()._normalize(!0),o=l.spatialReference),r.mapOptions={extent:l&&l.toJSON(),spatialReference:o&&o.toJSON(),showAttribution:t.attributionVisible},a.ssExtent=null,i.background&&(r.background=i.background.toJSON()),i.rotation&&(r.mapOptions.rotation=-i.rotation),t.scalePreserved&&(r.mapOptions.scale=t.outScale||i.scale),i.timeExtent!=null){const u=i.timeExtent.start!=null?i.timeExtent.start.getTime():null,d=i.timeExtent.end!=null?i.timeExtent.end.getTime():null;r.mapOptions.time=[u,d]}return t.reportOptions&&(r.reportOptions=t.reportOptions),r}function wi(e){let t=e;const a=t.lastIndexOf("/GPServer/");return a>0&&(t=t.slice(0,a+9)),t}async function Ti(e,t,a){var u;const i=[],o={layerView:null,printTemplate:t,view:e};let r=0;t.scalePreserved&&(r=t.outScale||e.scale);const l=ci(e,r);for(const d of l){const s=d.layer;if(!s.loaded||"layers"in s)continue;let m;o.layerView=d,m=hi(d)?await ue(s,o,a):ui(s)?Ii(s):(s==null?void 0:s.type)==="csv"?await xi(s,o,a):(s==null?void 0:s.type)==="catalog-footprint"?await Si(s,o,a):(s==null?void 0:s.type)==="feature"?await Oi(s,o,a):(s==null?void 0:s.type)==="geojson"?await $i(s,o,a):(s==null?void 0:s.type)==="graphics"?await ki(s,o,a):(s==null?void 0:s.type)==="imagery"?Ci(s,a):(s==null?void 0:s.type)==="imagery-tile"?await Li(s,o,a):(s==null?void 0:s.type)==="kml"?await Ei(s,o,a):(s==null?void 0:s.type)==="map-image"?Pi(s,o,a):(s==null?void 0:s.type)==="map-notes"?await Di(o,a):(s==null?void 0:s.type)==="open-street-map"?Fi():(s==null?void 0:s.type)==="stream"?await Mi(s,o,a):(s==null?void 0:s.type)==="subtype-group"?await Ai(s,a):(s==null?void 0:s.type)==="tile"?Ri(s,a):(s==null?void 0:s.type)==="vector-tile"?await Vi(s,o,a):(s==null?void 0:s.type)==="web-tile"?Ui(s):(s==null?void 0:s.type)==="wms"?ji(s,a):(s==null?void 0:s.type)==="wmts"?Ji(s):await ue(s,o,a),m&&(Array.isArray(m)?i.push(...m):(m.id=s.id,m.title=a.legendLayerNameMap[s.id]||s.title,m.opacity=d.fullOpacity,m.minScale=s.minScale||0,m.maxScale=s.maxScale||0,Ht(s)&&s.blendMode&&s.blendMode!=="normal"&&(m.blendMode=s.blendMode),i.push(m)))}if(r)for(const d of i)d.minScale=0,d.maxScale=0;if((u=e.graphics)!=null&&u.length){const d=await W(null,e.graphics,t,a);d&&i.push(d)}return i}function Ii(e){return{culture:e.culture,key:e.key,type:"BingMaps"+(e.style==="aerial"?"Aerial":e.style==="hybrid"?"Hybrid":"Road")}}async function Si(e,{layerView:t,printTemplate:a},i){if(parseFloat(i.cimVersion)<3.1)return W(e,await _e(t),a,i);const o=e.parent,r={id:(l=G(o,"web-map")).id,url:l.url,layerType:l.layerType,customParameters:l.customParameters,dynamicGroupLayer:{visibility:!1},footprintLayer:l.footprintLayer,layerDefinition:l.layerDefinition};var l;return ee(r,o),r}async function xi(e,t,a){e.legendEnabled&&a.legendLayers.push({id:e.id});const i=t.layerView,o=t.printTemplate;if(!(i.filter||e.portalItem&&e.portalItem.access!=="public")){const r=G(e,"web-map");return r.type="CSV",delete r.popupInfo,delete r.layerType,r.showLabels=o.showLabels&&e.labelsVisible,r}return W(e,await _e(i),o,a)}async function W(e,t,a,i){var g,k,D,w,L,S;let o;const r=li(),l=si(),u=Ot(),d=ri(),s=Ot();if(s.layerDefinition.name="textLayer",delete s.layerDefinition.drawingInfo,e){if(e.declaredClass==="esri.layers.FeatureLayer"||e.declaredClass==="esri.layers.StreamLayer"?r.layerDefinition.name=l.layerDefinition.name=u.layerDefinition.name=d.layerDefinition.name=i.legendLayerNameMap[e.id]||e.get("arcgisProps.title")||e.title:e.declaredClass==="esri.layers.GraphicsLayer"&&(t=e.graphics.items),e.renderer){const I=e.renderer.toJSON(),_=r.layerDefinition.drawingInfo;_&&(_.renderer=I);const C=l.layerDefinition.drawingInfo;C&&(C.renderer=I);const V=u.layerDefinition.drawingInfo;V&&(V.renderer=I);const te=d.layerDefinition.drawingInfo;te&&(te.renderer=I)}if(a.showLabels&&e.labelsVisible&&typeof e.write=="function"){const I=G(e,"web-map"),_=(k=(g=I.layerDefinition)==null?void 0:g.drawingInfo)==null?void 0:k.labelingInfo;if(_){o=!0;const C=r.layerDefinition.drawingInfo;C&&(C.labelingInfo=_);const V=l.layerDefinition.drawingInfo;V&&(V.labelingInfo=_);const te=u.layerDefinition.drawingInfo;te&&(te.labelingInfo=_);const we=d.layerDefinition.drawingInfo;we&&(we.labelingInfo=_)}}}let m;e!=null&&e.renderer||o||(delete r.layerDefinition.drawingInfo,delete l.layerDefinition.drawingInfo,delete u.layerDefinition.drawingInfo,delete d.layerDefinition.drawingInfo);const y=e==null?void 0:e.fieldsIndex,b=e==null?void 0:e.renderer;if(y){const I=new Set;o&&await Pa(I,e),b&&typeof b.collectRequiredFields=="function"&&await b.collectRequiredFields(I,y),m=Array.from(I);const _=y.fields.map(C=>C.toJSON());r.layerDefinition.fields=_,l.layerDefinition.fields=_,u.layerDefinition.fields=_,d.layerDefinition.fields=_}const $=t==null?void 0:t.length;let f;for(let I=0;I<$;I++){const _=t[I]||t.at(I);if(_.visible!==!1&&_.geometry){if(f=_.toJSON(),f.hasOwnProperty("popupTemplate")&&delete f.popupTemplate,(D=f.geometry)!=null&&D.z&&delete f.geometry.z,f.symbol&&(f.symbol.angle||delete f.symbol.angle,ke(f.symbol)?f.symbol=await $e(f.symbol,i):f.symbol.text&&delete f.attributes),(!a||!a.forceFeatureAttributes)&&(m==null?void 0:m.length)){const C={};for(const V of m)(w=f.attributes)!=null&&w.hasOwnProperty(V)&&(C[V]=f.attributes[V]);f.attributes=C}_.geometry.type==="polygon"?r.featureSet.features.push(f):_.geometry.type==="polyline"?l.featureSet.features.push(f):_.geometry.type==="point"?(L=f.symbol)!=null&&L.text?s.featureSet.features.push(f):u.featureSet.features.push(f):_.geometry.type==="multipoint"?d.featureSet.features.push(f):_.geometry.type==="extent"&&(f.geometry=Ea.fromExtent(_.geometry).toJSON(),r.featureSet.features.push(f))}}const x=[r,l,d,u,s].filter(I=>I.featureSet.features.length>0);for(const I of x){const _=I.featureSet.features.every(C=>C.symbol);if(_&&(!a||!a.forceFeatureAttributes))for(const C of I.featureSet.features)delete C.attributes;_&&delete I.layerDefinition.drawingInfo,(S=I.layerDefinition.drawingInfo)!=null&&S.renderer&&await qt(I.layerDefinition.drawingInfo.renderer,i)}return x.length?{featureCollection:{layers:x},showLabels:o}:null}async function Oi(e,t,a){var y,b,$,f,x,g,k,D,w,L,S,I;let i;const o=e.renderer,r=parseFloat(a.cimVersion);if(((y=e.featureReduction)==null?void 0:y.type)==="binning"||((b=e.featureReduction)==null?void 0:b.type)==="cluster"&&r<2.9||(o==null?void 0:o.type)==="pie-chart"||(o==null?void 0:o.type)==="dot-density"&&r<2.6)return ue(e,t,a);e.legendEnabled&&a.legendLayers.push({id:e.id});const l=t.layerView,{printTemplate:u,view:d}=t,s=(($=e.source)==null?void 0:$.type)!=="feature-layer"&&((f=e.source)==null?void 0:f.type)!=="ogc-feature";if(l.filter||s||!o||"field"in o&&o.field!=null&&!e.getField(o.field)){const _=await _e(l);i=await W(e,_,u,a)}else{if(i={id:(m=G(e)).id,title:m.title,url:m.url,layerType:m.layerType,customParameters:m.customParameters,layerDefinition:m.layerDefinition,charts:u.includeCharts?m.charts:void 0},i.showLabels=u.showLabels&&e.labelsVisible,ee(i,e),(g=(x=i.layerDefinition)==null?void 0:x.featureReduction)==null||delete g.disablePopup,(D=(k=i.layerDefinition)==null?void 0:k.featureReduction)==null||delete D.popupInfo,((L=(w=i.layerDefinition)==null?void 0:w.drawingInfo)==null?void 0:L.renderer)&&(delete i.layerDefinition.minScale,delete i.layerDefinition.maxScale,await qt(i.layerDefinition.drawingInfo.renderer,a),"visualVariables"in o&&((S=o.visualVariables)==null?void 0:S[0]))){const C=o.visualVariables[0];if(C.type==="size"&&C.maxSize&&typeof C.maxSize!="number"&&C.minSize&&typeof C.minSize!="number"){const V=Fa(C,d.scale);i.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=V.minSize,i.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=V.maxSize}}const _=Da(l);if(_&&(i.layerDefinition??(i.layerDefinition={}),i.layerDefinition.definitionExpression=i.layerDefinition.definitionExpression?`(${i.layerDefinition.definitionExpression}) AND (${_})`:_),e.gdbVersion&&(i.layerDefinition??(i.layerDefinition={}),i.layerDefinition.gdbVersion=e.gdbVersion),((I=l.hasHighlight)==null?void 0:I.call(l))&&"getHighlightIds"in l){const C=l;i.selectionObjectIds=C.getHighlightIds(),i.selectionSymbol=pi(e.geometryType,C.highlightOptions??d.highlightOptions)}}var m;return i}async function $i(e,t,a){var i,o;return((i=e.featureReduction)==null?void 0:i.type)==="binning"||((o=e.featureReduction)==null?void 0:o.type)==="cluster"?ue(e,t,a):(e.legendEnabled&&a.legendLayers.push({id:e.id}),W(e,await _e(t.layerView),t.printTemplate,a))}async function ki(e,{printTemplate:t},a){return W(e,null,t,a)}function Ci(e,t){var o;e.legendEnabled&&t.legendLayers.push({id:e.id});const a={layerType:(i=G(e)).layerType,customParameters:i.customParameters};var i;return a.bandIds=e.bandIds,a.compressionQuality=e.compressionQuality,a.format=e.format,a.interpolation=e.interpolation,(e.mosaicRule||e.definitionExpression)&&(a.mosaicRule=e.exportImageServiceParameters.mosaicRule.toJSON()),e.rasterFunction&&(a.renderingRule=e.rasterFunction.toJSON()),e.renderer&&(a.layerDefinition??(a.layerDefinition={}),(o=a.layerDefinition).drawingInfo??(o.drawingInfo={}),a.layerDefinition.drawingInfo.renderer=e.renderer.toJSON()),ee(a,e),a}async function Li(e,t,a){var r;if(((r=e.renderer)==null?void 0:r.type)==="flow")return ue(e,t,a);e.legendEnabled&&a.legendLayers.push({id:e.id});const i={bandIds:(o=G(e)).bandIds,customParameters:o.customParameters,interpolation:o.interpolation,layerDefinition:o.layerDefinition};var o;return i.layerType="ArcGISImageServiceLayer",ee(i,e),i}async function Ei(e,t,a){const i=t.printTemplate;if(!e.portalItem||e.portalItem.access==="public"){const s=G(e,"web-map");return s.type="kml",delete s.layerType,s.url=ge(e.url),s}const o=[],r=t.layerView,l="data:image/png;base64,";r.allVisibleMapImages.forEach((s,m)=>{const y={id:`${e.id}_image${m}`,type:"image",title:e.id,minScale:e.minScale||0,maxScale:e.maxScale||0,opacity:r.fullOpacity,extent:s.extent};s.href.startsWith(l)?y.imageData=s.href.slice(l.length):y.url=s.href,o.push(y)});const u=[...r.allVisiblePoints.items,...r.allVisiblePolylines.items,...r.allVisiblePolygons.items],d={id:e.id,...await W(null,u,i,a)};return o.push(d),o}function Pi(e,{view:t},a){var s,m;let i;const o={id:e.id,subLayerIds:[]};let r=[];const l=t.scale,u=y=>{const b=l===0,$=y.minScale===0||l<=y.minScale,f=y.maxScale===0||l>=y.maxScale;if(y.visible&&(b||$&&f))if(y.sublayers)y.sublayers.forEach(u);else{const x=y.toExportImageJSON(),g={id:y.id,name:y.title,layerDefinition:{drawingInfo:x.drawingInfo,definitionExpression:x.definitionExpression,source:x.source}};r.unshift(g),o.subLayerIds.push(y.id)}};var d;return e.sublayers&&e.sublayers.forEach(u),r.length&&(r=r.map(({id:y,name:b,layerDefinition:$})=>({id:y,name:b,layerDefinition:$})),i={layerType:(d=G(e)).layerType,customParameters:d.customParameters},i.layers=r,i.visibleLayers=(m=(s=e.capabilities)==null?void 0:s.exportMap)!=null&&m.supportsDynamicLayers?void 0:o.subLayerIds,e.gdbVersion&&(i.gdbVersion=e.gdbVersion),ee(i,e),e.legendEnabled&&a.legendLayers.push(o)),i}async function Di({layerView:e,printTemplate:t},a){const i=[],o=e.layer;if(o.featureCollections!=null)for(const r of o.featureCollections){const l=await W(r,r.source,t,a);l&&i.push(...l.featureCollection.layers)}else if(o.sublayers!=null)for(const r of o.sublayers){const l=await W(null,r.graphics,t,a);l&&i.push(...l.featureCollection.layers)}return{featureCollection:{layers:i}}}function Fi(){return{type:"OpenStreetMap"}}async function ue(e,{printTemplate:t,view:a},i){var y;const o={type:"image"},r={format:"png",ignoreBackground:!0,ignorePadding:!0,layers:[e]};a.rotation!==0&&(r.rotation=0);const l=i.ssExtent||a.state.extent.clone();let u=96,d=!0,s=!0;if(t.exportOptions){const b=t.exportOptions;b.dpi!=null&&b.dpi>0&&(u=b.dpi),b.width!=null&&b.width>0&&(d=b.width%2==a.width%2),b.height!=null&&b.height>0&&(s=b.height%2==a.height%2)}if(t.layout==="map-only"&&t.scalePreserved&&(!t.outScale||t.outScale===a.scale)&&u===96&&(!d||!s)&&a.state.extent.equals(a.extent)&&(r.area={x:0,y:0,width:a.width,height:a.height},d||(r.area.width-=1),s||(r.area.height-=1),!i.ssExtent)){const b=a.toMap(Rt(r.area.width,r.area.height));l.ymin=b.y,l.xmax=b.x,i.ssExtent=l}o.extent=l.clone()._normalize(!0).toJSON();const m=await a.takeScreenshot(r);return o.imageData=(y=da(m.dataUrl))==null?void 0:y.data,o}async function Mi(e,{layerView:t,printTemplate:a},i){return e.legendEnabled&&i.legendLayers.push({id:e.id}),W(e,await _e(t),a,i)}async function Ai(e,t){if(e.legendEnabled)for(const o of e.sublayers)o.legendEnabled&&t.legendLayers.push({id:o.id});const a={customParameters:(i=G(e)).customParameters,effect:i.effect,layerDefinition:i.layerDefinition,layerType:i.layerType,layers:i.layers,url:i.url};var i;if(Array.isArray(a.layers))for(const o of a.layers)delete o.popupInfo;return ee(a,e),a}async function Ni(e){var o,r;const t=[],a=[];for(const l of e.map.allTables)l.type!=="feature"||l.loaded||a.push(l.load());a.length&&await Promise.allSettled(a);for(const l of e.map.allTables)if(l.type==="feature"&&l.loaded&&l.isTable&&((o=l.source)==null?void 0:o.type)==="feature-layer"){const u={id:(i=G(l)).id,title:i.title,customParameters:i.customParameters,layerDefinition:{definitionExpression:(r=i.layerDefinition)==null?void 0:r.definitionExpression},url:i.url};ee(u,l),t.push(u)}var i;return t.length?t:void 0}function Ri(e,t){e.legendEnabled&&t.legendLayers.push({id:e.id});const a={layerType:(i=G(e)).layerType,customParameters:i.customParameters};var i;return ee(a,e),a}async function Vi(e,t,a){const i=t.layerView;if(e.serviceUrl&&e.styleUrl&&!i.spriteSourceChanged&&!i.styleChanged){const o=Ce(e.styleUrl,e.apiKey),r=Ce(e.serviceUrl,e.apiKey);if(!o&&!r||a.cimVersion!=="2.1.0"){const l={type:"VectorTileLayer"};return l.styleUrl=ge(e.styleUrl),l.token=o,r!==o&&(l.additionalTokens=[{url:e.serviceUrl,token:r}]),l}}return ue(e,t,a)}function Ui(e){var i;const t=(i=e.urlTemplate)==null?void 0:i.replace(/\${/g,"{"),a={type:"WebTiledLayer",urlTemplate:t,credits:e.copyright};return e.subDomains&&e.subDomains.length>0&&(a.subDomains=e.subDomains),a}function ji(e,t){let a;const i=[],o=r=>{r.visible&&(r.sublayers?r.sublayers.forEach(o):r.name&&i.unshift(r.name))};return e.sublayers&&e.sublayers.forEach(o),i.length&&(e.legendEnabled&&t.legendLayers.push({id:e.id,subLayerIds:i}),a={type:"wms",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,transparentBackground:e.imageTransparency,visibleLayers:i,url:ge(e.url),version:e.version}),a}function Ji(e){const t=e.activeLayer;return{type:"wmts",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:t.imageFormat,layer:t.id,style:t.styleId,tileMatrixSet:t.tileMatrixSetId,url:ge(e.url)}}function ee(e,t){t.url&&(e.url=ge(e.url||t.url),e.token=Ce(e.url,t.apiKey))}async function $e(e,t){var l;t.canvas||(t.canvas=document.createElement("canvas"));const a=1024;t.canvas.width=a,t.canvas.height=a;const i=t.canvas.getContext("2d");let o,r;if(e.path){const u=new Path2D(e.path);u.closePath(),i.fillStyle=Array.isArray(e.color)?`rgba(${e.color[0]},${e.color[1]},${e.color[2]},${e.color[3]/255})`:"rgb(0,0,0)",i.fill(u);const d=ni(i);if(!d)return null;i.clearRect(0,0,a,a);const s=Se(e.size)/Math.max(d.width,d.height);i.scale(s,s);const m=a/s,y=m/2-d.width/2-d.x,b=m/2-d.height/2-d.y;if(i.translate(y,b),Array.isArray(e.color)&&i.fill(u),((l=e.outline)==null?void 0:l.width)&&Array.isArray(e.outline.color)){const f=e.outline;i.lineWidth=Se(f.width)/s,i.lineJoin="round",i.strokeStyle=`rgba(${f.color[0]},${f.color[1]},${f.color[2]},${f.color[3]/255})`,i.stroke(u),d.width+=i.lineWidth,d.height+=i.lineWidth}d.width*=s,d.height*=s;const $=i.getImageData(a/2-d.width/2,a/2-d.height/2,Math.ceil(d.width),Math.ceil(d.height));o=$.width,r=$.height,i.canvas.width=o,i.canvas.height=r,i.putImageData($,0,0)}else{const u=e.contentType==="image/svg+xml"?"data:image/svg+xml;base64,"+e.imageData:e.url,d=(await X(u,{responseType:"image"})).data;o=Se(e.width),r=Se(e.height),i.canvas.width=o,i.canvas.height=r,i.drawImage(d,0,0,i.canvas.width,i.canvas.height)}return{type:"esriPMS",imageData:i.canvas.toDataURL("image/png").slice(22),angle:e.angle,contentType:"image/png",height:wt(r),width:wt(o),xoffset:e.xoffset,yoffset:e.yoffset}}async function qt(e,t){const a=e.type;if(a==="simple"&&ke(e.symbol))e.symbol=await $e(e.symbol,t);else if(a==="uniqueValue"||a==="classBreaks"){ke(e.defaultSymbol)&&(e.defaultSymbol=await $e(e.defaultSymbol,t));const i=e[a==="uniqueValue"?"uniqueValueInfos":"classBreakInfos"];if(i)for(const o of i)ke(o.symbol)&&(o.symbol=await $e(o.symbol,t))}}async function _e(e){return e.queryFeatures(e.createQuery()).then(t=>t.features)}function G(e,t){return e.write({},{ignorePersistenceEnabled:!0,origin:t})??{}}function Bi(e){var t;return(t=e.gpMetadata)!=null&&t.executionType?fi.fromJSON(e.gpMetadata.executionType):"sync"}function ke(e){var t;return e&&(e.path||e.contentType==="image/svg+xml"||((t=e.url)==null?void 0:t.endsWith(".svg")))}let q=class extends de{constructor(t){super(t),this.extent=null,this.extraParameters=null,this.outSpatialReference=null,this.template=null,this.updateDelay=1e3,this.view=null}};n([p()],q.prototype,"extent",void 0),n([p()],q.prototype,"extraParameters",void 0),n([p()],q.prototype,"outSpatialReference",void 0),n([p()],q.prototype,"template",void 0),n([p()],q.prototype,"updateDelay",void 0),n([p()],q.prototype,"view",void 0),q=n([R("esri.rest.support.PrintParameters")],q);const Gi=q;let F=class extends de{constructor(e){super(e),this.strokeDash=[],this.strokeWidth=2,this.strokeColor=[0,0,0,1],this.strokeBackgroundColor=[0,0,0,0],this.fillColor=[0,0,0,0],this.backgroundFillColor=[0,0,0,.5],this.visible=!0,this.isDecoration=!1,this.boxWidth=0,this.boxHeight=0,this.backgroundWidth=0,this.backgroundHeight=0,this.padding={left:0,top:0,right:0,bottom:0}}get _strokeStyle(){return`rgba(${this.strokeColor.join()})`}get _strokeBackgroundStyle(){return`rgba(${this.strokeBackgroundColor.join()})`}get _fillStyle(){return`rgba(${this.fillColor.join()})`}get _backgroundFillStyle(){return`rgba(${this.backgroundFillColor.join()})`}render(){const{backgroundWidth:e,backgroundHeight:t,boxWidth:a,boxHeight:i,padding:o}=this,r=o.left,l=o.top,u=this.x??r+e/2-a/2,d=this.y??l+t/2-i/2,s=u+a,m=d+i;return c("div",{classes:{"esri-box-overlay-item":!0},styles:{left:"0px",top:"0px",width:"100%",height:"100%",visibility:this.visible?"visible":"hidden"}},c("svg",{styles:{width:"100%",height:"100%"}},c("path",{d:`M ${r} ${l} L ${e+r} ${l} L ${e+r} ${t+l} L ${r} ${t+l} Z M ${u} ${d} L ${u} ${m} L ${s} ${m} L ${s} ${d} Z`,fill:this._backgroundFillStyle,stroke:this._strokeBackgroundStyle,"stroke-width":this.strokeWidth}),c("rect",{fill:this._fillStyle,height:i,stroke:this._strokeStyle,"stroke-dasharray":this.strokeDash.join(" ")||void 0,"stroke-width":this.strokeWidth,width:a,x:u,y:d})))}renderCanvas(){}};n([p()],F.prototype,"strokeDash",void 0),n([p()],F.prototype,"strokeWidth",void 0),n([p()],F.prototype,"strokeColor",void 0),n([p()],F.prototype,"strokeBackgroundColor",void 0),n([p()],F.prototype,"fillColor",void 0),n([p()],F.prototype,"backgroundFillColor",void 0),n([p()],F.prototype,"visible",void 0),n([p()],F.prototype,"isDecoration",void 0),n([p()],F.prototype,"boxWidth",void 0),n([p()],F.prototype,"boxHeight",void 0),n([p()],F.prototype,"backgroundWidth",void 0),n([p()],F.prototype,"backgroundHeight",void 0),n([p()],F.prototype,"x",void 0),n([p()],F.prototype,"y",void 0),n([p()],F.prototype,"padding",void 0),n([p({readOnly:!0})],F.prototype,"_strokeStyle",null),n([p({readOnly:!0})],F.prototype,"_strokeBackgroundStyle",null),n([p({readOnly:!0})],F.prototype,"_fillStyle",null),n([p({readOnly:!0})],F.prototype,"_backgroundFillStyle",null),F=n([R("esri.views.overlay.BoxOverlayItem")],F);const Hi=F;async function Kt(e,t,a){if(!e)throw new Z("print:invalid-layout-info-task-url","Can't fetch layout template info",{url:e});if(await zt(e)==="async"){const i=await Gt(e,t,void 0,a||void 0);return await i.waitForJobCompletion(),(await i.fetchResultData("Output_JSON")).value}return(await Bt(e,t,null,a)).results[0].value}let U=class extends Y{constructor(e){super(e),this.description=null,this.format=null,this.state="not-loaded",this.label=null,this.layoutInfoTaskUrl=null,this.layout=null,this.layoutItem=null,this.layoutOptions=null,this.layoutTemplateInfo=null,this.type=null}get id(){var e;return((e=this.layoutItem)==null?void 0:e.id)??`${this.layout}-${Ga(JSON.stringify(this.toJSON()))}`}get mapSurroundInfoOptions(){var a,i,o;const e=(i=(a=this.layoutTemplateInfo)==null?void 0:a.layoutOptions)==null?void 0:i.mapSurroundInfos;if(!e)return null;const t={northArrow:[],scaleBar:[],legend:[]};for(const r of e)switch(r.type){case"CIMMarkerNorthArrow":t.northArrow.push(r);break;case"CIMScaleLine":t.scaleBar.push(r);break;case"CIMGroupElement":(o=r.elements)!=null&&o.some(l=>l.type==="CIMScaleLine")&&t.scaleBar.push(r);break;case"CIMLegend":t.legend.push(r)}return t}async fetchLayoutItemTemplateInfo(e){var a,i;const{layoutItem:t}=this;if(t!=null&&t.id&&!this.layoutTemplateInfo&&this.state!=="loaded")try{this._set("state","loading");const o=this.layoutInfoTaskUrl;if(!o)throw new Z("print:invalid-layout-info-task-url","Can't fetch layout template info",{url:o});t.access!=="public"&&ne&&await ne.getCredential(o);const r={Layout_Item_ID:JSON.stringify({id:t.id})},l=(await Kt(o,r,e))[0];this._set("layoutTemplateInfo",l);const{hasLegend:u}=l.layoutOptions,d=((a=this.mapSurroundInfoOptions)==null?void 0:a.northArrow.some(({visible:m})=>m))??!1,s=((i=this.mapSurroundInfoOptions)==null?void 0:i.scaleBar.some(({visible:m})=>m))??!1;this._set("layoutOptions",{legend:u,northArrow:d,scaleBar:s}),this._set("state","loaded")}catch(o){this._set("state",Nt(o)?"not-loaded":"error")}}setLayoutTemplateInfo(e){this._set("layoutTemplateInfo",e),this._set("state","loaded")}};n([p({json:{write:!0}})],U.prototype,"description",void 0),n([ve(be)],U.prototype,"format",void 0),n([p({readOnly:!0})],U.prototype,"id",null),n([p({readOnly:!0})],U.prototype,"state",void 0),n([p({json:{write:!0}})],U.prototype,"label",void 0),n([p()],U.prototype,"layoutInfoTaskUrl",void 0),n([p({json:{read:fe,write:!0}})],U.prototype,"layout",void 0),n([p({type:Le,json:{write:!0}})],U.prototype,"layoutItem",void 0),n([p({readOnly:!0,json:{write:!0}})],U.prototype,"layoutOptions",void 0),n([p({readOnly:!0})],U.prototype,"layoutTemplateInfo",void 0),n([p({readOnly:!0})],U.prototype,"mapSurroundInfoOptions",null),n([p()],U.prototype,"type",void 0),U=n([R("esri.widgets.Print.CustomTemplate")],U);const se=U;let P=class extends de{constructor(e){super(e),this._abortController=null,this.attributionEnabled=!0,this.author=null,this.copyright=null,this.customTextElements=null,this.dpi=96,this.fileName=null,this.forceFeatureAttributes=!1,this.format="pdf",this.height=null,this.includeTables=!0,this.id=null,this.state="ready",this.layout="letter-ansi-a-landscape",this.layoutItem=null,this.legendEnabled=!0,this.northArrowEnabled=!1,this.scale=null,this.scaleBarEnabled=!1,this.scaleEnabled=!1,this.title=null,this.width=null}async applyTemplate(e,t){var a,i,o;if(((e==null?void 0:e.id)!==this.id||(e==null?void 0:e.state)==="error")&&(this._abortController&&(this._abortController.abort(),this._abortController=null),e)){if(this._set("state","pending"),this._resetMapSurroundInfoOptions(),this._set("id",e.id),this.set({layout:e.layout,layoutItem:e.layoutItem}),!e.layoutOptions&&e.layoutItem){const r=new AbortController;if(this._abortController=r,await e.fetchLayoutItemTemplateInfo({signal:this._abortController.signal}),e.state!=="loaded")return e.state==="error"&&this._set("state","error"),this._abortController!==r?void 0:void(this._abortController=null);this._abortController=null}this.set({customTextElements:t?At(t):this.customTextElements,format:this.format??e.format,legendEnabled:((a=e.layoutOptions)==null?void 0:a.legend)??this.legendEnabled,northArrowEnabled:((i=e.layoutOptions)==null?void 0:i.northArrow)??this.northArrowEnabled,scaleBarEnabled:((o=e.layoutOptions)==null?void 0:o.scaleBar)??this.scaleBarEnabled}),this._set("state","ready")}}reset(){this._set("id",null),this._set("state","ready"),this.set({layout:null,layoutItem:null,customTextElements:null}),this._resetMapSurroundInfoOptions()}_resetMapSurroundInfoOptions(){this.set({legendEnabled:!0,northArrowEnabled:!1,scaleBarEnabled:!1})}};n([p()],P.prototype,"attributionEnabled",void 0),n([p()],P.prototype,"author",void 0),n([p()],P.prototype,"copyright",void 0),n([p()],P.prototype,"customTextElements",void 0),n([p()],P.prototype,"dpi",void 0),n([p()],P.prototype,"fileName",void 0),n([p()],P.prototype,"forceFeatureAttributes",void 0),n([p()],P.prototype,"format",void 0),n([p()],P.prototype,"height",void 0),n([p()],P.prototype,"includeTables",void 0),n([p({readOnly:!0})],P.prototype,"id",void 0),n([p({readOnly:!0})],P.prototype,"state",void 0),n([p()],P.prototype,"layout",void 0),n([p({type:Le})],P.prototype,"layoutItem",void 0),n([p()],P.prototype,"legendEnabled",void 0),n([p()],P.prototype,"northArrowEnabled",void 0),n([p()],P.prototype,"scale",void 0),n([p()],P.prototype,"scaleBarEnabled",void 0),n([p()],P.prototype,"scaleEnabled",void 0),n([p()],P.prototype,"title",void 0),n([p()],P.prototype,"width",void 0),P=n([R("esri.widgets.Print.TemplateOptions")],P);const Zt=P,Wi=[30,144,255,255],Ct=[237,211,23,255],zi=[216,48,32,255],qi=new Set(["GISProfessionalStdUT","GISProfessionalAdvUT"]),Ki=/(\/GPServer\/).+/i,Zi=new ae({inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"}),pe=Pt.ofType(se);function Qi(e){var a;e.layoutOptions??(e.layoutOptions={}),(a=e.layoutOptions).customTextElements??(a.customTextElements=[]);const t="date";if(!e.layoutOptions.customTextElements.find(i=>t in i)){const{customTextElements:i}=e.layoutOptions;let o=ka(Date.now(),Ca("short-date"));La()==="ar"&&(o=""+o),i.push({date:o})}}function Lt(e,t,a){t&&t.visible!==a&&e.layoutOptions&&(e.layoutOptions.elementOverrides?e.layoutOptions.elementOverrides[t.name]={visible:a}:e.layoutOptions.elementOverrides={[t.name]:{visible:a}})}let E=class extends Oa{constructor(t){super(t),this._serviceTemplateCustomTextElements=null,this._templateIdToCustomTemplate=new $a,this._isFreeHand=!1,this._freeHandWidth=0,this._freehandHeight=0,this._asyncPrintTaskUrl=null,this._layoutInfoTaskUrl=null,this.allowedFormats="all",this.allowedLayouts="all",this.browseTemplates=new pe,this.defaultTemplates=new pe,this.error=null,this.extraParameters=null,this.includeDefaultTemplates=!0,this.outSpatialReference=null,this.portal=Vt.getDefault(),this.portalTemplateIds=[],this.printServiceTemplates=new pe,this.defaultTemplate=null,this.showPrintAreaEnabled=!1,this.printServiceUrl=null,this.printTimeout=12e4,this.templatesInfo=null,this.updateDelay=1e3,this.view=null,this.templateCustomTextElements=null,this.templateOptions=new Zt}initialize(){this.addHandles([Q(()=>[this.showPrintAreaEnabled,this.view],()=>{var t,a;this.showPrintAreaEnabled?this._enablePrintPreview():(this.removeHandles("overlay-handler"),(a=(t=this.view)==null?void 0:t.overlay)==null||a.removeItem(this._getOverlayItem()))}),Q(()=>[this.templateOptions.layout,this.templateOptions.layoutItem],()=>{this.loaded&&this._processTemplateOptions()})])}destroy(){var t;this.removeHandles("overlay-handler"),this.view&&(this._overlayItem&&((t=this.view.overlay)==null||t.removeItem(this._overlayItem),this._overlayItem.destroy(),this._overlayItem=null),this.view=null)}get effectivePrintServiceUrl(){return this.printServiceUrl??null}get effectiveTemplateCustomTextElements(){if(!this._serviceTemplateCustomTextElements)return{};const t=At(this._serviceTemplateCustomTextElements);return this.templateCustomTextElements&&Object.keys(this.templateCustomTextElements).forEach(a=>{var o;const i=t[a];if(i){const r=(o=this.templateCustomTextElements)==null?void 0:o[a];i.forEach(l=>{const[u]=Object.entries(l)[0];r==null||r.forEach(d=>{const[s,m]=Object.entries(d)[0];u===s&&(l[u]=m)})})}}),Object.freeze(t)}get state(){var t;return this.loadStatus==="loading"?"initializing":this.loadStatus==="failed"||this.error?"error":this.loadStatus==="loaded"&&((t=this.view)!=null&&t.ready)?"ready":"disabled"}async load(t){return this.addResolvingPromise(this._loadResources(t).catch(a=>this.error=a)),this}async print(t){var s;const{view:a,extraParameters:i,updateDelay:o,outSpatialReference:r}=this;if(!a)throw new Z("print:view-required","view is not set");Qi(t);const l=this._getOverlayItem(),u=t.scalePreserved||!this.showPrintAreaEnabled?void 0:Ba(new Je,a.viewpoint,t.layout==="map-only"?[t.exportOptions.width,t.exportOptions.height]:[l.boxWidth,l.boxHeight]),d=new Gi({view:a,template:t,extent:u,extraParameters:i,updateDelay:o,outSpatialReference:r});try{const m=!!((s=t.layoutItem)!=null&&s.id)&&(this.portalTemplateIds.includes(t.layoutItem.id)||this.browseTemplates.some(y=>{var b,$;return((b=y.layoutItem)==null?void 0:b.id)===(($=t.layoutItem)==null?void 0:$.id)}));return await bi(m&&this._asyncPrintTaskUrl?this._asyncPrintTaskUrl:this.effectivePrintServiceUrl,d,{timeout:this.printTimeout})}catch(m){throw new Z("print:export-error","An error occurred while exporting the web map.",{error:m})}}toPrintTemplate({attributionEnabled:t,author:a,copyright:i,customTextElements:o,dpi:r,forceFeatureAttributes:l,format:u,height:d,id:s,includeTables:m,layout:y,layoutItem:b,legendEnabled:$,northArrowEnabled:f,scale:x,scaleEnabled:g,title:k,width:D}){var L;if(!y&&!b)throw new Z("print:layout-required","layout is not set");const w=new Wt({attributionVisible:t,forceFeatureAttributes:l,format:u,includeTables:m,layout:y,layoutItem:b,layoutOptions:{authorText:a||"",copyrightText:i||"",customTextElements:o,titleText:k||""},outScale:x??0,scalePreserved:g});if(D&&(w.exportOptions.width=D),d&&(w.exportOptions.height=d),r&&(w.exportOptions.dpi=r),w.layoutOptions){$||(w.layoutOptions.legendLayers=[]);const S=(L=this.getLayoutTemplateById(s))==null?void 0:L.mapSurroundInfoOptions;if(S){Lt(w,S.northArrow[0],f);const I=S.scaleBar;for(const _ of I)Lt(w,_,g)}}return w}getLayoutTemplateById(t){return t?this._templateIdToCustomTemplate.get(t):null}async addPortalTemplate(t){if(!this.portal||!(t!=null&&t.id))return;try{t.loaded||await t.load()}catch{return void this.applyTemplate(this.defaultTemplate)}const a=new se({type:"browse-template",layoutInfoTaskUrl:this._layoutInfoTaskUrl,label:t.title,layoutItem:t});this._templateIdToCustomTemplate.set(a.id,a),this.browseTemplates.add(a)}removePortalTemplate(t){t.layoutItem&&this.templateOptions.id===t.layoutItem.id&&(this.defaultTemplate?this.applyTemplate(this.defaultTemplate):this.templateOptions.reset()),this.browseTemplates.remove(t),this._templateIdToCustomTemplate.delete(t.id)}async applyTemplate(t){if(!t)return void this.templateOptions.reset();!t.layout||!this.templatesInfo||this.templatesInfo.layout.choiceList.includes(t.layout)||(this.defaultTemplate?t=this.defaultTemplate:this.templateOptions.reset());const a=t.layout?this.effectiveTemplateCustomTextElements[t.layout]:null;await this.templateOptions.applyTemplate(t,a)}async _loadResources(t){if(this.destroyed)return;await this._loadUrls(t);const[a,i]=await Promise.all([this._getLayoutToLayoutTemplateInfos(t),this._getPrintServiceTemplatesInfo(t)]);await this._loadAllTemplates(a,t),this._processPrintServiceTemplatesInfo(i),await this._processTemplateOptions(),this._updateOverLayItem()}async _processTemplateOptions(){const{layout:t,layoutItem:a}=this.templateOptions;if(t!=="map-only"&&!this.templateOptions.id){if(a!=null&&a.id){try{a.loaded||await a.load()}catch{return void this.applyTemplate(this.defaultTemplate)}let i=this._templateIdToCustomTemplate.get(a.id);i||(i=new se({label:a.title,layoutItem:a,layoutInfoTaskUrl:this._layoutInfoTaskUrl}),this._templateIdToCustomTemplate.set(i.id,i)),await this.applyTemplate(i)}else if(t){const i=this.defaultTemplates.find(o=>o.layout===this.templateOptions.layout)??this.printServiceTemplates.find(o=>o.layout===this.templateOptions.layout);await this.applyTemplate(i??this.defaultTemplate)}}}async _loadPortal(t){try{await this.portal.load(t)}catch(a){throw new Z("print:could-not-load-portal","Cannot load print resource information from portal",{error:a,url:this.effectivePrintServiceUrl})}}async _loadUrls(t){var i,o;if(this.printServiceUrl)this._set("effectivePrintServiceUrl",this.printServiceUrl),await this._updateLayoutInfoTaskUrl(this.effectivePrintServiceUrl);else{await this._loadPortal(t);const{printTask:r,asyncPrintTask:l,layoutInfoTask:u}=((i=this.portal)==null?void 0:i.helperServices)??{};this._set("effectivePrintServiceUrl",r==null?void 0:r.url),this._asyncPrintTaskUrl=l==null?void 0:l.url,await this._updateLayoutInfoTaskUrl((u==null?void 0:u.url)||this.effectivePrintServiceUrl)}const a=(o=this.effectivePrintServiceUrl)==null?void 0:o.toLowerCase().split("/");if(!(a!=null&&a.includes("gpserver")))throw new Z("print:invalid-print-service-url","Can't fetch print templates information from provided URL",{url:this.effectivePrintServiceUrl})}async _updateLayoutInfoTaskUrl(t,a){if(!t)return;const i=(await gi(t,a)).find(o=>o.includes("Get Layout Templates Info"));i&&(this._layoutInfoTaskUrl=t.replace(Ki,`$1${encodeURI(i)}`))}_getPortalDefaultTemplates(t){var a,i,o,r,l;return((l=(r=(o=(i=(a=this.portal)==null?void 0:a.helperServices)==null?void 0:i.printTask)==null?void 0:o.templates)==null?void 0:r.filter(u=>u.layout.toLowerCase()!=="map_only"))==null?void 0:l.map(u=>{const d=se.fromJSON(u);if(d.type="default-template",d.layoutInfoTaskUrl=this._layoutInfoTaskUrl,d.layout){const s=t.get(d.layout);s&&d.setLayoutTemplateInfo(s)}return d}))??[]}async _getPortalCustomTemplates(t){if(this.printServiceUrl||!this.portal)return[];const{layoutGroupQuery:a,user:i}=this.portal,o=Mt.test(this.portal.url),r=i==null?void 0:i.userLicenseTypeId,l=r&&qi.has(r);if(!a||o&&!l)return[];const u=new Tt({query:a,disableExtraQuery:!0}),d=await this.portal.queryGroups(u,t);if(!d.total)return[];const s=d.results[0],m=new Tt({num:100,query:"type:Layout",sortField:s.sortField,sortOrder:s.sortOrder??void 0}),y=(await s.queryItems(m,t)).results;return y.length?y.map(b=>(this.portalTemplateIds.push(b.id),new se({type:"default-template",label:b.title,layoutItem:b,layoutInfoTaskUrl:this._layoutInfoTaskUrl}))):[]}async _loadAllTemplates(t,a){let i=!1;if(this.includeDefaultTemplates&&this.portal&&!this.printServiceUrl){const o=this._getPortalDefaultTemplates(t);i=!!o.length,this.defaultTemplates.addMany(o);const r=await this._getPortalCustomTemplates(a);this.defaultTemplates.addMany(r);for(const l of this.defaultTemplates)this._templateIdToCustomTemplate.set(l.id,l)}i||t.forEach((o,r)=>{const l=new se({type:"print-service-template",layout:r,layoutInfoTaskUrl:this._layoutInfoTaskUrl});l.setLayoutTemplateInfo(o),this.printServiceTemplates.add(l),this._templateIdToCustomTemplate.set(l.id,l)})}_processPrintServiceTemplatesInfo(t){var i;this._set("templatesInfo",t);const a=(i=t==null?void 0:t.layout)==null?void 0:i.defaultValue;a&&a!=="map-only"&&this._set("defaultTemplate",this.defaultTemplates.find(o=>o.layout===a)??this.printServiceTemplates.find(o=>o.layout===a))}async _getLayoutToLayoutTemplateInfos(t){const a=await Kt(this._layoutInfoTaskUrl,void 0,t),i=new Map,o={};for(const r of a){const l=fe(r.layoutTemplate);i.set(l,r),o[l]=r.layoutOptions.customTextElements}return this._serviceTemplateCustomTextElements=Object.freeze(o),i}async _getPrintServiceTemplatesInfo(t){let a;try{({data:a}=await X(this.effectivePrintServiceUrl,{...t,query:{f:"json"},timeout:this.printTimeout}))}catch(l){throw Nt(l)?l:new Z("print:unavailable-service-info","Can't fetch templates info from service",{error:l})}const{parameters:i}=a,o=i.find(({name:l})=>l==="Format"),r=i.find(({name:l})=>l==="Layout_Template");return{format:this._getFormat(o),layout:this._getLayout(r)}}_getFormat(t){const a=this.allowedFormats==="all"?t.choiceList:t.choiceList.filter(l=>typeof this.allowedFormats!="string"&&this.allowedFormats.some(u=>new RegExp(`\\b${u}\\b`,"i").test(l))),i=(a.length?a:t.choiceList).map(l=>be.fromJSON(l)).filter(bt),o=be.fromJSON(t.defaultValue),r=i.some(l=>new RegExp(`\\b${o}\\b`,"i").test(l))?o:i[0];return{choiceList:i,defaultValue:r}}_getLayout(t){const a=t.choiceList.filter(u=>u.toLowerCase()!=="map_only"),i=this.allowedLayouts==="all"?a:a.filter(u=>this.allowedLayouts.includes(fe(u))),o=(i.length?i:a).map(fe).filter(bt),r=fe(t.defaultValue),l=o.includes(r)?r:o.find(u=>/(?=.*letter)(?=.*landscape)/i.test(u))??o.find(u=>/(?=.*a4)(?=.*landscape)/i.test(u))??o[0];return{choiceList:o,defaultValue:l}}_getOverlayItem(){return this._overlayItem||(this._overlayItem=new Hi({strokeDash:[5],strokeWidth:2,strokeColor:[30,144,255,255]})),this._overlayItem}_enablePrintPreview(){var i,o,r;if(!((i=this.view)!=null&&i.overlay))return;const t=this.templateOptions,a=this._getOverlayItem();this.addHandles([Q(()=>{var l,u,d,s;return[t.width,t.height,t.scaleEnabled,t.scale,t.layout,t.layoutItem,t.id,t.state,(l=this.view)==null?void 0:l.scale,(u=this.view)==null?void 0:u.size,(d=this.view)==null?void 0:d.state.paddedViewState.size,(s=this.view)==null?void 0:s.state.padding,this.loaded]},()=>this._updateOverLayItem(),Ft),(o=this.view)==null?void 0:o.on("drag",["Shift"],l=>this._handleDrag(l),St.WIDGET),(r=this.view)==null?void 0:r.on("key-down",["Escape"],()=>this._resetDrag(),St.WIDGET)],"overlay-handler"),this.view.overlay.addItem(a)}_updateOverLayItem(){var f;if(!this.view)return;const t=this.templateOptions,a=this._getOverlayItem(),i=((f=t.layoutItem)==null?void 0:f.id)??t.layout,o=this.view,r=o.spatialReference,[l,u]=o.state.paddedViewState.size,d=o.state.padding;let s=0,m=0;if(i==="map-only")t.width!=null&&t.height!=null&&(s=t.width,m=t.height);else if(i){const x=t.id?this._templateIdToCustomTemplate.get(t.id):null,{webMapFrameSize:g,pageUnits:k}=(x==null?void 0:x.layoutTemplateInfo)??{};let D=!1;if(g&&k)if(this._isFreeHand){const w=g[0]/g[1];s=this._freeHandWidth,m=this._freehandHeight,s>m?m=s/w:s=m*w}else{const w=Zi.fromJSON(k.toLowerCase()),L=r.unit;gt(w)===gt(L)?(s=vt(g[0],w,L),m=vt(g[1],w,L)):(D=!0,s=g[0],m=g[1])}if(!this._isFreeHand)if(t.scaleEnabled&&t.scale){const w=D?Math.min(l/s,u/m):ba(r)*ga*t.dpi;s*=w,m*=w}else if(s===0||m===0)s=l,m=u;else{const w=(l-.1*l)/s,L=(u-.1*u)/m,S=Math.min(w,L);s*=S,m*=S}}const{scaleEnabled:y,scale:b}=t,$=y&&b?b/this.view.scale:1;if(a.boxWidth=s*$||l,a.boxHeight=m*$||u,d&&(a.padding=d),a.backgroundWidth=l??0,a.backgroundHeight=u??0,this.loadStatus==="loading")a.strokeColor=Ct;else if(this.loadStatus==="loaded")switch(this.templateOptions.state){case"pending":a.strokeColor=Ct;break;case"ready":a.strokeColor=Wi;break;case"error":a.strokeColor=zi}}_resetDrag(){this._isFreeHand=!1,this._updateOverLayItem()}_handleDrag(t){switch(t.action){case"start":this._start();break;case"update":this._update(t);break;case"end":this._end()}t.stopPropagation()}_start(){this._isFreeHand=!0}_update(t){const a=this._getOverlayItem(),{x:i,y:o}=t,{x:r,y:l}=t.origin;i>r?(a.x=r,a.boxWidth=i-r):(a.x=i,a.boxWidth=r-i),o>l?(a.y=l,a.boxHeight=o-l):(a.y=o,a.boxHeight=l-o)}_end(){const t=this._getOverlayItem();if(!this.view||t.x==null||t.y==null)return;const a=this.view,i=a.toMap(Rt(t.x+.5*t.boxWidth,t.y+.5*t.boxHeight));t.x=null,t.y=null,a.goTo({center:i}),this._freeHandWidth=t.boxWidth,this._freehandHeight=t.boxHeight,this.templateOptions.layout==="map-only"&&(this.templateOptions.width=this._freeHandWidth,this.templateOptions.height=this._freehandHeight),this.templateOptions.scale=this.view.scale,this._updateOverLayItem()}};n([p()],E.prototype,"_serviceTemplateCustomTextElements",void 0),n([p()],E.prototype,"_templateIdToCustomTemplate",void 0),n([p()],E.prototype,"allowedFormats",void 0),n([p()],E.prototype,"allowedLayouts",void 0),n([p({type:pe})],E.prototype,"browseTemplates",void 0),n([p({type:pe})],E.prototype,"defaultTemplates",void 0),n([p()],E.prototype,"error",void 0),n([p()],E.prototype,"extraParameters",void 0),n([p()],E.prototype,"includeDefaultTemplates",void 0),n([p({readOnly:!0})],E.prototype,"effectivePrintServiceUrl",null),n([p()],E.prototype,"effectiveTemplateCustomTextElements",null),n([p({type:ce})],E.prototype,"outSpatialReference",void 0),n([p({type:Vt})],E.prototype,"portal",void 0),n([p()],E.prototype,"portalTemplateIds",void 0),n([p({type:pe})],E.prototype,"printServiceTemplates",void 0),n([p({readOnly:!0})],E.prototype,"defaultTemplate",void 0),n([p()],E.prototype,"showPrintAreaEnabled",void 0),n([p()],E.prototype,"printServiceUrl",void 0),n([p()],E.prototype,"printTimeout",void 0),n([p({readOnly:!0})],E.prototype,"state",null),n([p({readOnly:!0})],E.prototype,"templatesInfo",void 0),n([p()],E.prototype,"updateDelay",void 0),n([p()],E.prototype,"view",void 0),n([p()],E.prototype,"templateCustomTextElements",void 0),n([p({type:Zt})],E.prototype,"templateOptions",void 0),E=n([R("esri.widgets.Print.PrintViewModel")],E);const Qt=E,Xt=Pt.ofType(jt),Yt="map-only";var T;(function(e){e.layout="layoutTab",e.mapOnly="mapOnlyTab",e.export="exportTab"})(T||(T={}));const v="esri-print",ie=`${v}__advanced-options-button`,h={base:v,headerTitle:`${v}__header-title`,layoutTabList:`${v}__layout-tab-list`,layoutTab:`${v}__layout-tab`,layoutSection:`${v}__layout-section`,mapOnlySection:`${v}__map-only-section`,panelItemsCentered:`${v}__panel-items--centered`,loader:`${v}__loader`,advancedOptionsButton:ie,advancedOptionsButtonContainer:`${ie}-container`,advancedOptionsButtonTitle:`${ie}-title`,advancedOptionsButtonIconOpened:`${ie}-icon--opened`,advancedOptionsButtonIconClosed:`${ie}-icon--closed`,advancedOptionsButtonIconClosed_RTL:`${ie}-icon--closed-rtl`,swapButton:`${v}__swap-button`,printButton:`${v}__export-button`,printButtonSection:`${v}__export-button-section`,printButtonSectionDivider:`${v}__export-button-section--divider`,templateSelectContainer:`${v}__template-select-container`,templateSelectBlock:`${v}__template-select-block`,templateSelectIcon:`${v}__template-select-icon`,templateSelectError:`${v}__template-select-error`,templateSelectArrow:`${v}__template-select-arrow`,formSectionContainer:`${v}__form-section-container`,formCheckboxLabel:`${v}__form-checkbox-label`,advancedOptionsSection:`${v}__advanced-options-section`,advancedOptionsContainer:`${v}__advanced-options-container`,browseTemplateButtonContainer:`${v}__browse-template-button-container`,browseTemplateButtonContainerFilter:`${v}__browse-template-button-container-filter`,exportedFilesContainer:`${v}__export-panel-container`,exportedFilesTitle:`${v}__export-title`,exportedFile:`${v}__exported-file`,exportedFileLink:`${v}__exported-file-link`,exportedFileLinkTitle:`${v}__exported-file-link-title`,exportedFileLinkDescription:`${v}__exported-file-link-description`,exportedFilesEmpty:`${v}__exported-files-empty`,printWidgetContainer:`${v}__container`,content:`${v}__content`,panelContainer:`${v}__panel-container`,scaleInfoContainer:`${v}__scale-info-container`,scaleInputContainer:`${v}__scale-input-container`,scaleInput:`${v}__scale-input`,sizeContainer:`${v}__size-container`,panelError:`${v}__panel--error`,exportedFileError:`${v}__exported-file--error`,exportedFileLoader:`${v}__exported-file--loader`,exportSection:`${v}__export-section`,exportSectionCentered:`${v}__export-section--centered`,templateButtonContainer:`${v}__template-button-container`,templateDoneButton:`${v}__template-done-button`,templateSelectFlowItemContainer:`${v}__template-select-flow-item-container`,templateSelectFlowItemContent:`${v}__template-select-flow-item-content`,templateSelectFlowItemListHeading:`${v}__template-select-flow-item-list-heading`,srLabel:`${v}__sr-label`,invalidWkidText:`${v}__invalid-wkid-text`};function Xi(e,t,a,i){const o=a/t,r=i/t;return{width:Math.round(e*o),height:Math.round(e*r)}}function Yi(e){return!isNaN(e)&&e>0}function xe(e){return(e==null?void 0:e.toLowerCase())===Yt}function eo(e){var i;const{state:t,extension:a}=e;switch(t){case"pending":return"spinner";case"error":return"exclamation-mark-circle";default:return(i=a==null?void 0:a.toLowerCase())!=null&&i.includes("pdf")?"file-pdf":"file"}}const to=new ae({inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"}),Et=new Map([["a3-landscape","a3-landscape"],["a3-portrait","a3-portrait"],["a4-landscape","a4-landscape"],["a4-portrait","a4-portrait"],["letter-ansi-a-landscape","ansi-a-landscape"],["letter-ansi-a-portrait","ansi-a-portrait"],["tabloid-ansi-b-landscape","ansi-b-landscape"],["tabloid-ansi-b-portrait","ansi-b-portrait"]]);let O=class extends Ta{constructor(e,t){super(e,t),this._activeTabFocusRequested=!1,this._awaitingServerResponse=!1,this._exportedFileNameMap={},this._selectedTab=T.layout,this._pendingExportScroll=!1,this._rootNode=null,this._selectedTemplate=null,this._formats=[],this._showTemplates=!1,this._isValidSpatialReference=!0,this.allowedFormatsForSaving=null,this.browseTemplateButtonOnClick=null,this.exportedLinks=new Xt,this.headerVisible=!0,this.headingLevel=3,this.messagesCommon=null,this.messagesUnits=null,this.saveExportEnabled=!1,this.saveExportHidden=!0,this.saveAsButtonCallback=null,this.viewModel=new Qt,this._onInput=a=>{this._selectedTab===T.layout?this.templateOptions.title=a.target.value:this._selectedTab===T.mapOnly&&(this.templateOptions.fileName=a.target.value)},this._handleLinkClick=a=>{const i=a.currentTarget["data-item"];if(!i||i.state!=="ready"||!i.url)return;const o=Ce(this.viewModel.effectivePrintServiceUrl),r=i.url,l=document.createElement("a");if(l.target="_blank",l.href=r,l.rel="noreferrer",l.download=i.formattedName??"",!o)return l.click(),void a.stopPropagation();a.preventDefault();const u=new URL(r);u.searchParams.set("token",o),l.href=u.href,l.click(),l.href=r},this._focusOnTabChange=this._focusOnTabChange.bind(this)}initialize(){this.addHandles([Q(()=>{var i;return[this.templateOptions.format,(i=this.viewModel.templatesInfo)==null?void 0:i.format]},()=>{var o;const{templatesInfo:i}=this.viewModel;if(i){if(this._formats.length!==i.format.choiceList.length){const r=be.apiValues;this._formats=i.format.choiceList.map(l=>{const u=r.find(d=>new RegExp(`\\b${d}\\b`,"i").test(l))??l;return{value:u,label:l===u?l.toUpperCase():l}}).sort((l,u)=>l.label.localeCompare(u.label))}if(!(!i.format.defaultValue||this.templateOptions.format)){const r=(o=this._formats.find(({value:l})=>new RegExp(`\\b${l}\\b`,"i").test(i.format.defaultValue)))==null?void 0:o.value;r&&(this.templateOptions.format=r)}}}),Q(()=>[this.templateOptions.id,this.viewModel.loaded],async()=>{const{layout:i}=this.templateOptions;this._selectedTab=xe(i)?T.mapOnly:T.layout,this._selectedTab===T.layout&&this.viewModel.loaded&&(this._selectedTemplate=this.viewModel.getLayoutTemplateById(this.templateOptions.id))}),Q(()=>this.templateOptions.dpi,i=>{i<=0&&(this.templateOptions.dpi=1)}),Q(()=>{var i;return(i=this.viewModel.view)==null?void 0:i.scale},i=>{!i||this.templateOptions.scaleEnabled&&this.templateOptions.scale||(this.templateOptions.scale=i)})]);for(const{name:i,extension:o}of this.exportedLinks)i&&o&&this._updateExportedFileNameMap(`${i}${o}`);const{height:e,width:t}=this.templateOptions;this.templateOptions.width=t||800,this.templateOptions.height=e||1100;const a=setTimeout(()=>{this._awaitingServerResponse=!0,this.scheduleRender()},500);this.viewModel.load().then(()=>{clearTimeout(a),this._awaitingServerResponse=!1})}loadDependencies(){return Ia({action:()=>M(()=>import("./calcite-action-Bys6x4p_.js"),__vite__mapDeps([175,176,177,3,16,17,18,7,19,20,6,12,1,2,9,43,44,45,8,10,11,123,13,178,179,180,181,182,183,184,185,186,187]),import.meta.url),block:()=>M(()=>import("./calcite-block-M0XyV5ob.js"),__vite__mapDeps([188,177,3,16,17,18,7,19,20,6,12,1,2,9,43,44,45,8,10,11,123,13,189,183,178,179,181,182,185,190,180,191,192,193,176,184,186,187,194,195,196,197,198,199,200]),import.meta.url),button:()=>M(()=>import("./calcite-button-D_Agetwz.js"),__vite__mapDeps([201,202,177,3,16,17,18,7,19,20,6,12,1,2,9,43,44,45,8,10,11,123,13,203,178,179,204,184,180,181,182,183,185,186,187]),import.meta.url),checkbox:()=>M(()=>import("./calcite-checkbox-B8olv0Y9.js"),__vite__mapDeps([205,177,3,16,17,18,7,19,20,6,12,1,2,9,43,44,45,8,10,11,123,13,178,203,179,182,204,184,180]),import.meta.url),combobox:()=>M(()=>import("./calcite-combobox-DZ_miEwS.js"),__vite__mapDeps([206,207,177,3,16,17,18,7,19,20,6,12,1,2,9,43,44,45,8,10,11,123,13,208,209,193,178,192,203,179,204,184,180,181,182,183,191,185,210,211,212,186,213,189,214]),import.meta.url),"combobox-item":()=>M(()=>import("./calcite-combobox-item-BtecfP0L.js"),__vite__mapDeps([215,213,177,3,16,17,18,7,19,20,6,12,1,2,9,43,44,45,8,10,11,123,13,189,183,178,179,211,184,186]),import.meta.url),flow:()=>M(()=>import("./calcite-flow-BrE9BG4l.js"),__vite__mapDeps([216,177,3,16,17,18,7,19,20,6,12,1,2,9,43,44,45,8,10,11,123,13,183,180]),import.meta.url),"flow-item":()=>M(()=>import("./calcite-flow-item-B0xZ0mWX.js"),__vite__mapDeps([217,177,3,16,17,18,7,19,20,6,12,1,2,9,43,44,45,8,10,11,123,13,178,179,180,181,182,183,185,218,194,195,176,184,186,187,196,192,193,197,191,190,198,200]),import.meta.url),icon:()=>M(()=>import("./calcite-icon-Cu0W9dtm.js"),__vite__mapDeps([219,186,177,3,16,17,18,7,19,20,6,12,1,2,9,43,44,45,8,10,11,123,13,178,183]),import.meta.url),input:()=>M(()=>import("./calcite-input-DAafN6Cc.js"),__vite__mapDeps([220,221,177,3,16,17,18,7,19,20,6,12,1,2,9,43,44,45,8,10,11,123,13,178,203,179,182,204,184,180,181,183,185,210,222,186,214,223]),import.meta.url),"input-number":()=>M(()=>import("./calcite-input-number-BjjBFtSg.js"),__vite__mapDeps([224,225,177,3,16,17,18,7,19,20,6,12,1,2,9,43,44,45,8,10,11,123,13,178,203,179,182,204,184,180,181,183,185,210,222,186,214,223]),import.meta.url),label:()=>M(()=>import("./calcite-label-B1FxWqaL.js"),__vite__mapDeps([226,177,3,16,17,18,7,19,20,6,12,1,2,9,43,44,45,8,10,11,123,13,204,178,184]),import.meta.url),list:()=>M(()=>import("./calcite-list-C4jOVpC-.js"),__vite__mapDeps([227,177,3,16,17,18,7,19,20,6,12,1,2,9,43,44,45,8,10,11,123,13,178,179,183,228,229,180,185,181,182,209,193,186,221,203,204,184,210,222,214,223,187,200]),import.meta.url),"list-item":()=>M(()=>import("./calcite-list-item-vbKS6alm.js"),__vite__mapDeps([230,177,3,16,17,18,7,19,20,6,12,1,2,9,43,44,45,8,10,11,123,13,178,179,181,182,183,185,180,229,228,176,184,186,187,199]),import.meta.url),loader:()=>M(()=>import("./calcite-loader-DP4PIFO8.js"),__vite__mapDeps([231,187,177,3,16,17,18,7,19,20,6,12,1,2,9,43,44,45,8,10,11,123,13,178,181,182,183]),import.meta.url),switch:()=>M(()=>import("./calcite-switch-CkUGVtze.js"),__vite__mapDeps([232,233,177,3,16,17,18,7,19,20,6,12,1,2,9,43,44,45,8,10,11,123,13,178,203,179,182,204,184,180]),import.meta.url),chip:()=>M(()=>import("./calcite-chip-C9GKwE1v.js"),__vite__mapDeps([234,212,177,3,16,17,18,7,19,20,6,12,1,2,9,43,44,45,8,10,11,123,13,178,180,185,181,182,183,179,184,186]),import.meta.url),popover:()=>M(()=>import("./calcite-popover-5MaBc2pF.js"),__vite__mapDeps([235,196,177,3,16,17,18,7,19,20,6,12,1,2,9,43,44,45,8,10,11,123,13,192,178,193,197,191,190,181,182,183,185,180,198,184,176,179,186,187]),import.meta.url),link:()=>M(()=>import("./calcite-link-CJF8okEV.js"),__vite__mapDeps([236,177,3,16,17,18,7,19,20,6,12,1,2,9,43,44,45,8,10,11,123,13,178,179,180,186,183]),import.meta.url)})}destroy(){this.viewModel.destroy()}get allowedFormats(){return this.viewModel.allowedFormats}set allowedFormats(e){this.viewModel.allowedFormats=e}get allowedLayouts(){return this.viewModel.allowedLayouts}set allowedLayouts(e){this.viewModel.allowedLayouts=e}get error(){return this.viewModel.error}get extraParameters(){return this.viewModel.extraParameters}set extraParameters(e){this.viewModel.extraParameters=e}get icon(){return"print"}set icon(e){this._overrideIfSome("icon",e)}get includeDefaultTemplates(){return this.viewModel.includeDefaultTemplates}set includeDefaultTemplates(e){this.viewModel.includeDefaultTemplates=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get outSpatialReference(){return this.viewModel.outSpatialReference}set outSpatialReference(e){this.viewModel.outSpatialReference=e}get portal(){return this.viewModel.portal}set portal(e){this.viewModel.portal=e}get showPrintAreaEnabled(){return this.viewModel.showPrintAreaEnabled}set showPrintAreaEnabled(e){this.viewModel.showPrintAreaEnabled=e}get printServiceUrl(){return this.viewModel.printServiceUrl}set printServiceUrl(e){this.viewModel.printServiceUrl=e}get templateCustomTextElements(){return this.viewModel.templateCustomTextElements}set templateCustomTextElements(e){this.viewModel.templateCustomTextElements=e}get templateOptions(){return this.viewModel.templateOptions}set templateOptions(e){this.viewModel.templateOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){var qe,Ke,Ze,Qe,Xe,Ye,et,tt,at,it,ot,rt,lt,st,nt,pt,ct,ut,dt,mt,ht,yt;const{messages:e,templateOptions:t,viewModel:a,view:i}=this,{attributionEnabled:o,author:r,copyright:l,dpi:u,format:d,height:s,layout:m,layoutItem:y,legendEnabled:b,northArrowEnabled:$,scaleBarEnabled:f,scaleEnabled:x,scale:g,width:k}=t,D=a.state!=="ready"||this._awaitingServerResponse||!(m||y),w=this._renderTitleOrFileNameSection(),L=c("div",{class:h.formSectionContainer},c("calcite-label",null,e.fileFormatTitle,c("calcite-combobox",{clearDisabled:!0,label:e.formatDefaultOption,maxItems:6,placeholder:e.formatDefaultOption,selectionMode:"single-persist",onCalciteComboboxChange:({target:j})=>{var K;this.templateOptions.format=((K=j.selectedItems[0])==null?void 0:K.value)??"pdf"}},this._formats.map(({value:j,label:K},pa)=>c("calcite-combobox-item",{key:`file-format-${pa}`,selected:j===this.templateOptions.format,textLabel:K,value:j}))))),S=c("calcite-label",{layout:"inline"},c("calcite-switch",{checked:this.showPrintAreaEnabled,onCalciteSwitchChange:j=>{this.showPrintAreaEnabled=!!j.target.checked}}),e.printPreview),I=c("div",null,c("div",{class:h.formSectionContainer},c("calcite-label",null,e.template,c("calcite-block",{class:h.templateSelectContainer,collapsible:!1,description:this._getPageSizeLabel(this._selectedTemplate),heading:this._getTemplateLabel(this._selectedTemplate,!0),key:"template-select-block",loading:((qe=this._selectedTemplate)==null?void 0:qe.state)==="loading",onclick:()=>{this._showTemplates=!0}},c("calcite-icon",{class:h.templateSelectIcon,icon:((Ke=this._selectedTemplate)!=null&&Ke.layout?Et.get(this._selectedTemplate.layout):null)||"custom-print",key:"template-select-icon",scale:"l",slot:"content-start"}),((Ze=this._selectedTemplate)==null?void 0:Ze.state)==="error"?c("calcite-icon",{class:h.templateSelectError,icon:"exclamation-mark-circle",key:"template-select-error",scale:"s",slot:"actions-end"}):null,c("calcite-icon",{class:h.templateSelectArrow,icon:Sa()?"chevron-left":"chevron-right",key:"template-select-arrow",scale:"s",slot:"actions-end"})))),S),_=c("div",{class:h.formSectionContainer},c("calcite-label",null,e.dpi,c("calcite-input-number",{bind:this,"data-input-name":"dpi",min:1,value:`${u}`,onCalciteInputNumberInput:this._handleDPIChange}))),C=c("div",{class:h.formSectionContainer},c("calcite-label",null,c("div",{class:h.srLabel},e.outSpatialReference,c("calcite-link",{href:"https://developers.arcgis.com/rest/services-reference/enterprise/using-spatial-references/",target:"_blank"},"(WKID)")),c("calcite-input-number",{bind:this,"data-input-name":"outSpatialReference",integer:!0,numberButtonType:"none",value:((Xe=(Qe=a.outSpatialReference)==null?void 0:Qe.wkid)==null?void 0:Xe.toString())??"",onCalciteInputNumberInput:({target:j})=>{const K=fa(j.value);a.outSpatialReference=Number.isNaN(K)||K==null?null:new ce({wkid:K}),this._isValidSpatialReference=!a.outSpatialReference||va(a.outSpatialReference)}}),this._isValidSpatialReference?null:c("div",{class:h.invalidWkidText,key:`out-sr-${(Ye=a.outSpatialReference)==null?void 0:Ye.wkid}`},e.invalidWkid))),V=c("div",{class:this.classes(h.scaleInfoContainer,h.formSectionContainer)},c("calcite-label",{layout:"inline"},c("calcite-checkbox",{bind:this,checked:x,"data-option-name":"scaleEnabled",onCalciteCheckboxChange:this._toggleInputValue}),e.scale),c("div",{class:h.scaleInputContainer},c("calcite-input-number",{"aria-label":e.scaleLabel,"aria-valuenow":`${g}`,bind:this,class:h.scaleInput,"data-input-name":"scale",disabled:!x,value:`${g}`,onCalciteInputNumberInput:this._updateNumberInputValue}),c("calcite-button",{appearance:"outline","aria-label":e.reset,bind:this,disabled:!x,iconStart:"refresh",kind:"neutral",onclick:this._resetToCurrentScale}))),te=c("div",{"aria-labelledby":`${this.id}__advancedOptionsForLayout`,class:h.advancedOptionsContainer,key:"advanced-section-for-layout"},V,((at=(tt=(et=this._selectedTemplate)==null?void 0:et.layoutTemplateInfo)==null?void 0:tt.layoutOptions)==null?void 0:at.hasAuthorText)??1?c("div",{class:h.formSectionContainer,key:"author-info"},c("calcite-label",null,e.author,c("calcite-input",{bind:this,"data-input-name":"author",value:r??"",onCalciteInputInput:this._updateInputValue}))):null,((rt=(ot=(it=this._selectedTemplate)==null?void 0:it.layoutTemplateInfo)==null?void 0:ot.layoutOptions)==null?void 0:rt.hasCopyrightText)??1?c("div",{class:h.formSectionContainer,key:"copyright-text"},c("calcite-label",null,e.copyright,c("calcite-input",{bind:this,"data-input-name":"copyright",value:l??"",onCalciteInputInput:this._updateInputValue}))):null,_,C,this._renderCustomTextElementSection(),((nt=(st=(lt=this._selectedTemplate)==null?void 0:lt.layoutTemplateInfo)==null?void 0:st.layoutOptions)==null?void 0:nt.hasLegend)??1?c("div",{class:h.formSectionContainer,key:"legend-info"},c("calcite-label",{layout:"inline"},c("calcite-checkbox",{bind:this,checked:b,"data-option-name":"legendEnabled",onCalciteCheckboxChange:this._toggleInputValue}),e.legend)):null,(ct=(pt=this._selectedTemplate)==null?void 0:pt.mapSurroundInfoOptions)!=null&&ct.northArrow.length?c("div",{class:h.formSectionContainer,key:"north-arrow"},c("calcite-label",{layout:"inline"},c("calcite-checkbox",{bind:this,checked:$,"data-option-name":"northArrowEnabled",onCalciteCheckboxChange:this._toggleInputValue}),e.northArrow)):null,(dt=(ut=this._selectedTemplate)==null?void 0:ut.mapSurroundInfoOptions)!=null&&dt.scaleBar.length?c("div",{class:h.formSectionContainer,key:"scale-bar"},c("calcite-label",{layout:"inline"},c("calcite-checkbox",{bind:this,checked:f,"data-option-name":"scaleBarEnabled",onCalciteCheckboxChange:this._toggleInputValue}),e.scaleBar)):null),we=c("div",{"aria-labelledby":`${this.id}__advancedOptionsForMapOnly`,class:h.advancedOptionsContainer},V,_,C,c("div",{class:h.formSectionContainer},c("calcite-label",{layout:"inline"},c("calcite-checkbox",{bind:this,checked:o,"data-option-name":"attributionEnabled",onCalciteCheckboxChange:this._toggleInputValue}),e.attribution)),this._renderCustomTextElementSection()),Te=this.exportedLinks.toArray(),ea=this._renderExportedLink(Te),ta={[h.exportSectionCentered]:!Te.length},aa=this._selectedTab===T.layout?c("section",{"aria-labelledby":`${this.id}__layoutTab`,class:h.layoutSection,id:`${this.id}__layoutContent`,key:"esri-print__layoutContent",role:"tabpanel"},c("div",{class:h.panelContainer},((yt=(ht=(mt=this._selectedTemplate)==null?void 0:mt.layoutTemplateInfo)==null?void 0:ht.layoutOptions)==null?void 0:yt.hasTitleText)??1?w:null,I,this._selectedTab===T.layout?L:null,c("calcite-block",{"aria-label":e.advancedOptions,class:this.classes(h.panelContainer,h.advancedOptionsSection),collapsible:!0,disabled:!(m||y!=null&&y.id),heading:e.advancedOptions,id:"advancedOptionsForLayout",key:"advanced-options-for-layout"},te))):this._selectedTab===T.mapOnly?c("section",{"aria-labelledby":`${this.id}__mapOnlyTab`,class:h.mapOnlySection,id:`${this.id}__mapOnlyContent`,key:"esri-print__mapOnlyContent",role:"tabpanel"},c("div",{class:h.panelContainer},w,L,c("div",null,c("div",{class:this.classes(h.sizeContainer,h.formSectionContainer)},c("calcite-label",null,e.width,c("calcite-input-number",{bind:this,"data-input-name":"width",value:`${k}`,onCalciteInputNumberInput:this._updateNumberInputValue})),c("calcite-label",null,e.height,c("calcite-input-number",{bind:this,"data-input-name":"height",value:`${s}`,onCalciteInputNumberInput:this._updateNumberInputValue})),c("button",{"aria-label":e.swap,bind:this,class:this.classes(Me.widgetButton,h.swapButton,Wa.swap),onclick:this._switchInput,type:"button"})),S),c("calcite-block",{"aria-label":e.advancedOptions,class:this.classes(h.panelContainer,h.advancedOptionsSection),collapsible:!0,heading:e.advancedOptions,id:"advancedOptionsForMapOnly",key:"advanced-options-for-map-only"},we))):c("section",{"aria-labelledby":`${this.id}__exportTab`,class:this.classes(h.exportSection,ta),id:`${this.id}__exportContent`,key:"esri-print__exportContent",role:"tabpanel"},c("div",{class:h.panelContainer},c("div",{afterUpdate:this._scrollExportIntoView,bind:this,class:h.exportedFilesContainer},Te.length===0?c("div",{class:h.exportedFilesEmpty},c("calcite-icon",{icon:"file",scale:"l"}),c("div",null,c(Ha,{class:h.exportedFilesTitle,level:this.headingLevel},e.noExportedFiles),c("div",null,e.exportHint))):ea))),We=(i==null?void 0:i.type)!=="2d",ia=c("div",{class:h.panelError},i?We?e.sceneViewError:e.serviceError:e.noViewError),oa=Te.some(({state:j})=>j==="pending"),ra=c("div",{class:h.content,key:"panel"},c("div",null,c("ul",{bind:this,class:h.layoutTabList,onclick:this._toggleLayoutPanel,onkeydown:this._handleLayoutPanelKeyDown,role:"tablist"},c("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._selectedTab===T.layout}`,class:h.layoutTab,"data-tab-id":T.layout,id:`${this.id}__layoutTab`,role:"tab",tabIndex:0},e.layoutTab),c("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._selectedTab===T.mapOnly}`,class:h.layoutTab,"data-tab-id":T.mapOnly,id:`${this.id}__mapOnlyTab`,role:"tab",tabIndex:0},e.mapOnlyTab),c("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._selectedTab===T.export}`,class:h.layoutTab,"data-tab-id":T.export,id:`${this.id}__exportedFilesTab`,role:"tab",tabIndex:0},oa?c("calcite-loader",{inline:!0,label:"loading",scale:"s"}):null,e.exportsTab)),aa),this._selectedTab!==T.export?c("div",{class:this.classes(h.printButtonSection,!this.saveExportHidden&&this.portal?h.printButtonSectionDivider:null),key:"export-button-section"},!this.saveExportHidden&&this.portal?c("calcite-label",{layout:"inline"},c("calcite-checkbox",{bind:this,checked:this.saveExportEnabled,onCalciteCheckboxChange:j=>{this.saveExportEnabled=!!j.target.checked}}),e.saveExportToMyContent):null,c("calcite-button",{"aria-label":e.exportDescription,bind:this,class:this.classes(h.printButton),disabled:D||!(m||y!=null&&y.id)&&!d,onclick:this._handlePrintMap,scale:"l",width:"full"},e.export)):null),la=c("calcite-flow",{key:"root-flow"},c("calcite-flow-item",{bind:this,key:"root-flow-item"},c("div",{class:h.printWidgetContainer},this.headerVisible?c("header",{class:h.headerTitle},e.export):null,this.error||We||!i?ia:ra)),this._renderChooseTemplateFlowItem()),ze=a.state==="initializing",sa=ze?this._renderLoader():la,na={[h.panelItemsCentered]:ze};return c("div",{bind:this,class:this.classes(h.base,Me.widget,Me.panel,na)},sa)}_getPageSizeLabel(e){if(!e)return;const t=e.layoutTemplateInfo;if(!t)return;const a=to.fromJSON(t.pageUnits.toLowerCase());return`${ft(t.pageSize[0])} x ${ft(t.pageSize[1])} ${ua(this.messagesUnits,a,"abbr")}`}_getTemplateLabel(e,t=!1){if(!e)return t?this.messages.selectTemplate:this.messages.untitled;const{label:a,layout:i,layoutItem:o,type:r}=e;if(r==="print-service-template")return this.messages[i];const l=a??i??(o==null?void 0:o.id);return(l==null?void 0:l.replaceAll("_"," "))??this.messages.untitled}_getPortalTemplates(){const{portalTemplateIds:e}=this.viewModel;return this.includeDefaultTemplates?this.viewModel.defaultTemplates.toArray().filter(({layout:t,layoutItem:a})=>!xe(t)&&!!(a!=null&&a.id)&&e.includes(a.id)):[]}_getDefaultTemplates(){const{portalTemplateIds:e}=this.viewModel;return this.includeDefaultTemplates?this.viewModel.defaultTemplates.toArray().filter(({layout:t,layoutItem:a})=>!(xe(t)||a!=null&&a.id&&e.includes(a.id))):[]}_getPrintServiceTemplates(){return this.includeDefaultTemplates&&this._getDefaultTemplates().length?[]:this.viewModel.printServiceTemplates.toArray().filter(({layout:e})=>!xe(e))}_renderLayoutTemplates(e,t=!1,a=!1){return t&&e.sort((i,o)=>(i.label??"")>(o.label??"")?1:-1),e.map(i=>c("calcite-list-item",{description:this._getPageSizeLabel(i),key:`template-${i.id}-${i.id===this.templateOptions.id}`,label:this._getTemplateLabel(i),selected:i.id===this.templateOptions.id,title:i.description??"",value:i},c("calcite-icon",{icon:(i.layout?Et.get(i.layout):null)||"custom-print",slot:"content-start"}),i.state==="loading"?c("calcite-loader",{inline:!0,key:`template-loader-${i.id}`,label:"loading",scale:"s",slot:"content-end"}):null,(i==null?void 0:i.state)==="error"?c("calcite-icon",{class:h.templateSelectError,icon:"exclamation-mark-circle",key:`template-error-${i.id}`,scale:"s",slot:"content-end"}):null,a?c("calcite-action",{icon:"trash",onclick:()=>this.viewModel.removePortalTemplate(i),slot:"actions-end",text:"delete"}):null))}_renderChooseTemplateFlowItem(){var d;if(!this._showTemplates)return null;const{messages:e}=this,t=Mt.test((d=this.portal)==null?void 0:d.url),a=this.viewModel.browseTemplates.toArray(),i=this._getPortalTemplates(),o=this._getDefaultTemplates(),r=this._getPrintServiceTemplates(),l=a.length+i.length+o.length+r.length>15,u=this.browseTemplateButtonOnClick?c("calcite-button",{appearance:"outline",class:l?h.browseTemplateButtonContainerFilter:h.browseTemplateButtonContainer,iconStart:"folder",key:"browse-template-button",onclick:this.browseTemplateButtonOnClick,slot:l?"filter-actions-end":"default"},l?null:e.browseTemplates):null;return c("calcite-flow-item",{bind:this,closable:!1,heading:e.chooseTemplate,key:"template-flow-item",onCalciteFlowItemBack:s=>{s.preventDefault(),this._showTemplates=!1}},c("div",{class:h.templateSelectFlowItemContainer},c("div",{class:h.templateSelectFlowItemContent},l?null:u,c("calcite-list",{filterEnabled:l,filterProps:["label"],key:"template-list",selectionMode:"single-persist",onCalciteListChange:({target:s})=>{var m;return this.viewModel.applyTemplate((m=s.selectedItems[0])==null?void 0:m.value)}},l?u:null,a.length?c("div",{key:"my-templates"},c("div",{class:h.templateSelectFlowItemListHeading},e.myTemplates,c("calcite-chip",{appearance:"outline",kind:"neutral",scale:"s",value:e.beta},e.beta)),this._renderLayoutTemplates(a,!0,!0)):null,i.length?c("div",{key:"org-templates"},c("div",{class:h.templateSelectFlowItemListHeading},e.organizationTemplates,t?c("calcite-chip",{appearance:"outline",kind:"neutral",scale:"s",value:e.beta},e.beta):null),this._renderLayoutTemplates(i)):null,a.length||i.length?o.length?c("div",{key:"default-templates"},c("div",{class:h.templateSelectFlowItemListHeading},e.defaultTemplates),this._renderLayoutTemplates(o,!0)):null:this._renderLayoutTemplates(o,!0),a.length||i.length?r.length?c("div",{key:"service-templates"},c("div",{class:h.templateSelectFlowItemListHeading},e.defaultTemplates),this._renderLayoutTemplates(r)):null:this._renderLayoutTemplates(r))),c("div",{class:h.templateButtonContainer},c("calcite-button",{class:h.templateDoneButton,onclick:()=>this._showTemplates=!1},this.messagesCommon.done))))}_renderCustomTextElementSection(){const{customTextElements:e}=this.templateOptions;return e?c("div",{class:h.formSectionContainer,key:"custom-text-elements"},e.map((t,a)=>{const[i,o]=Object.entries(t)[0];return i==="date"?null:c("calcite-label",{key:`custom-text-elements-${i}-${a}`},i,c("calcite-input",{bind:this,"data-input-custom":!0,"data-input-name":i,value:o??"",onCalciteInputInput:this._updateInputValue}))})):null}_renderTitleOrFileNameSection(){const{title:e,fileName:t,titlePlaceHolder:a,fileNamePlaceHolder:i}=this.messages,o=this._selectedTab===T.layout?e:t,r=this._selectedTab===T.layout?a:i,l=this._selectedTab===T.layout?this.templateOptions.title:this.templateOptions.fileName;return c("div",{class:h.formSectionContainer,key:o},c("calcite-label",null,o,c("calcite-input",{placeholder:r,value:l??"",onCalciteInputInput:this._onInput})))}_focusOnTabChange(e){if(!this._activeTabFocusRequested)return;const t=e.getAttribute("data-tab-id");(t==="layoutTab"&&this._selectedTab===T.layout||t==="mapOnlyTab"&&this._selectedTab===T.mapOnly||t==="exportTab"&&this._selectedTab===T.export)&&(e.focus(),this._activeTabFocusRequested=!1)}_renderLoader(){const e={[h.loader]:this._awaitingServerResponse};return c("div",{class:this.classes(e),key:"loader"})}_updateExportedFileNameMap(e){this._exportedFileNameMap[e]!==void 0?this._exportedFileNameMap[e]++:this._exportedFileNameMap[e]=0}_createFileLink(e,t){const a=t||this.messages.untitled,i=e.format.toLowerCase(),o=i.includes("png")?"png":i,r=a+o;return this._updateExportedFileNameMap(r),new jt({name:a,extension:o,count:this._exportedFileNameMap[r]})}_resetToCurrentScale(){var e;this.templateOptions.scale=(e=this.viewModel.view)==null?void 0:e.scale}_updateCustomTextElementValue(e,t,a){e.find(i=>{const[o]=Object.entries(i)[0];return o===t})[t]=a}_updateInputValue(e){const t=e.target,a=t.getAttribute("data-input-name"),i=!!t["data-input-custom"],{templateOptions:o}=this;i?this._updateCustomTextElementValue(o.customTextElements,a,t.value):o[a]=t.value}_updateNumberInputValue(e){const t=e.target,a=t.getAttribute("data-input-name"),{templateOptions:i}=this,o=Number(t.value);if(Yi(o))i[a]=o;else{const r=i[a];t.value=`${r}`}}_handleDPIChange(e){const{templateOptions:t}=this,a=t.dpi;this._updateNumberInputValue(e);const i=t.dpi,{height:o,width:r}=Xi(i,a,t.width,t.height);t.height=o,t.width=r}_handlePrintMap(){var r;this._pendingExportScroll=!0;const{templateOptions:e,saveExportEnabled:t}=this,a=this.viewModel.toPrintTemplate(e),i=this._selectedTab===T.layout?(r=a.layoutOptions)==null?void 0:r.titleText:e.fileName,o=this._createFileLink(a,i);this.exportedLinks.add(o),this.emit("submit",{link:o,saveExportEnabled:t}),this._selectedTab=T.export,this.viewModel.print(a).then(l=>{o.set({url:l&&l.url,state:"ready"})}).catch(l=>{o.set({error:l,state:"error"})}).then(()=>{this.emit("complete",{link:o,saveExportEnabled:t}),this.scheduleRender()})}_switchInput(){[this.templateOptions.width,this.templateOptions.height]=[this.templateOptions.height,this.templateOptions.width]}_scrollExportIntoView(){if(!this._pendingExportScroll)return;this._pendingExportScroll=!1;const e=this._rootNode;if(!e)return;const{clientHeight:t,scrollHeight:a}=e,i=a-t;i>0&&(e.scrollTop=i)}_toggleInputValue(e){const t=e.target,a=t.getAttribute("data-option-name");this.templateOptions[a]=t.checked,a==="scaleEnabled"&&this._resetToCurrentScale()}_renderExportedLink(e){const t=this.messages,a=e.map(i=>{const{error:o,url:r,state:l}=i,u=i.formattedName??"",d=l==="error",s=l==="pending",m=l==="ready";let y=r||null;y&&(y=ma(y));const b=ha(r,location.href);let $;$=s?t.pending:m?t.ready:t.errorMessage;const f=d?(o==null?void 0:o.name)==="print-task:cim-symbol-unsupported"?t.exportWebMapCIMError:t.exportWebMapError:"";return c("calcite-list-item",{"aria-label":$,key:u,title:f},c("div",{class:h.exportedFile,"data-item":i,onclick:this._handleLinkClick,slot:"content"},c("div",null,c("div",{class:h.exportedFileLinkTitle},u),c("div",{class:h.exportedFileLinkDescription},s?t.generatingExport:f||(b?t.ready:t.linkReady))),m?c("calcite-icon",{"aria-label":`${u}. ${t.linkReady}`,icon:b?"download-to":"launch",key:`${u}-end-icon`,scale:"s",slot:"content-end"}):null),s?c("calcite-loader",{class:h.exportedFileLoader,inline:!0,key:`${u}-loader`,label:t.generatingExport,scale:"m",slot:"content-start"}):c("calcite-icon",{icon:eo(i),key:`${u}-start-icon`,scale:"s",slot:"content-start"}),s?null:this.saveAsButtonCallback&&!d&&this._isFormatAllowedForSaving(i.extension)?c("calcite-action",{"aria-label":`${f}`,icon:"ellipsis",id:`${u}-popover-button`,key:`${u}-action`,slot:"actions-end",text:`${f}`},c("calcite-popover",{autoClose:!0,key:`${u}-popover`,label:"Popover",offsetDistance:1,overlayPositioning:"fixed",pointerDisabled:!0,referenceElement:`${u}-popover-button`,scale:"s"},c("calcite-list",null,i.portalItem?c("calcite-list-item",{label:t.openItem,onCalciteListItemSelect:()=>{const x=i.portalItem;if(!x||!x.itemPageUrl)return;const g=document.createElement("a");g.target="_blank",g.href=x.itemPageUrl,g.rel="noreferrer",g.click()}},c("calcite-icon",{icon:"launch2",key:`${u}-launch-icon`,scale:"s",slot:"content-start"})):c("calcite-list-item",{label:t.saveAs,onCalciteListItemSelect:async()=>{this.saveAsButtonCallback&&(ca(()=>i.portalItem).then(x=>{x.itemPageUrl&&this.scheduleRender()}),await this.saveAsButtonCallback(i))}},c("calcite-icon",{icon:"save",key:`${u}-save-icon`,scale:"s",slot:"content-start"})),c("calcite-list-item",{label:this.messagesCommon.delete,onCalciteListItemSelect:()=>this.exportedLinks.remove(i)},c("calcite-icon",{icon:"trash",key:`${u}-delete-icon`,scale:"s",slot:"content-start"}))))):c("calcite-action",{"aria-label":`${f}`,icon:"x",key:`${u}-action`,onclick:()=>{this.exportedLinks.remove(i)},slot:"actions-end",text:`${f}`}))});return c("calcite-list",{filterEnabled:(e==null?void 0:e.length)>10},a)}_isFormatAllowedForSaving(e){return!this.allowedFormatsForSaving||this.allowedFormatsForSaving==="all"||!(!e||!this.allowedFormatsForSaving.includes(e))}_toggleLayoutPanel(e){const t=e.target;this._toggleTab(t.getAttribute("data-tab-id"))}_toggleTab(e,t=!0){if(this._selectedTab=e,this._selectedTab===T.mapOnly)this.templateOptions.reset(),this.templateOptions.layout=Yt;else if(this._selectedTab===T.layout){const a=this._selectedTemplate??this.viewModel.defaultTemplate;a?this.viewModel.applyTemplate(a):this.templateOptions.reset()}t&&(this._activeTabFocusRequested=!0)}_handleLayoutPanelKeyDown(e){const{key:t}=e,a=e.target.getAttribute("data-tab-id");if(xa(t))return this._toggleTab(a),e.preventDefault(),void e.stopPropagation();if(t==="ArrowLeft"||t==="ArrowRight"){switch(a){case T.layout:this._toggleTab(t==="ArrowLeft"?T.export:T.mapOnly);break;case T.mapOnly:this._toggleTab(t==="ArrowLeft"?T.layout:T.export);break;case T.export:this._toggleTab(t==="ArrowLeft"?T.mapOnly:T.layout)}e.preventDefault(),e.stopPropagation()}}};n([p()],O.prototype,"_showTemplates",void 0),n([p()],O.prototype,"_isValidSpatialReference",void 0),n([p()],O.prototype,"allowedFormats",null),n([p()],O.prototype,"allowedFormatsForSaving",void 0),n([p()],O.prototype,"allowedLayouts",null),n([p()],O.prototype,"browseTemplateButtonOnClick",void 0),n([p()],O.prototype,"error",null),n([p({type:Xt})],O.prototype,"exportedLinks",void 0),n([p()],O.prototype,"extraParameters",null),n([p()],O.prototype,"headerVisible",void 0),n([p()],O.prototype,"headingLevel",void 0),n([p()],O.prototype,"icon",null),n([p()],O.prototype,"includeDefaultTemplates",null),n([p()],O.prototype,"label",null),n([p(),Fe("esri/widgets/Print/t9n/Print")],O.prototype,"messages",void 0),n([p(),Fe("esri/t9n/common")],O.prototype,"messagesCommon",void 0),n([p(),Fe("esri/core/t9n/Units")],O.prototype,"messagesUnits",void 0),n([p({type:ce})],O.prototype,"outSpatialReference",null),n([p()],O.prototype,"portal",null),n([p()],O.prototype,"saveExportEnabled",void 0),n([p()],O.prototype,"saveExportHidden",void 0),n([p()],O.prototype,"showPrintAreaEnabled",null),n([p()],O.prototype,"printServiceUrl",null),n([p()],O.prototype,"saveAsButtonCallback",void 0),n([p()],O.prototype,"templateCustomTextElements",null),n([p()],O.prototype,"templateOptions",null),n([p()],O.prototype,"view",null),n([p({type:Qt})],O.prototype,"viewModel",void 0),O=n([R("esri.widgets.Print")],O);const Gr=O;export{Gr as default};
