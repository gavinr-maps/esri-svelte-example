import{p as w,A as f,a as l,w as r,t as p}from"./index-69f02a9e-wRYZXCy2.js";import{e as h}from"./component-utils-42b12dba-BfugynV_.js";/*!
 * All material copyright Esri, All Rights Reserved, unless otherwise specified.
 * See https://js.arcgis.com/4.31/esri/copyright.txt for details.
 * v4.31.2
 */const E=(d,e)=>(t,s)=>y(t,d,s);class u extends f{constructor(e,t,s){super(e,t,s),this._watchedViewModelProperties=new Map,this._watchedVisibleElementsProperties={},this._isBindingViewModel={value:!0},Object.defineProperty(this.exports,"viewModel",{value:l.makeGetterProxy(e,this._watchedViewModelProperties,this._isBindingViewModel)}),Object.defineProperty(this.exports,"visibleElements",{value:this._makeVisibleElementsBinder()})}hostConnected(){super.hostConnected(),this._isBindingViewModel.value=!1,this.component.manager.loadedCalled&&h(this.component)}async hostLoad(){if(this._watchedProperties.delete("viewModel"),await super.hostLoad(),this.component.manager.destroyed)return;this._watchMetaProperties(),l.reEmitAccessorEvents(this,this._instance,this.reactiveUtils,"widget"),this.onLifecycle(()=>this.reactiveUtils.watch(()=>this._instance.viewModel,s=>{this.component.viewModel=s},{initial:!0}));const e=this._instance.viewModel;typeof e=="object"&&(l.reEmitAccessorEvents(this,e,this.reactiveUtils,"viewModel"),l.watchComponentUpdates(this,e,this._watchedViewModelProperties),l.watchAccessorUpdates(this,e,this._watchedViewModelProperties));const t=Object.entries(this._watchedVisibleElementsProperties);t.length>0&&this.onLifecycle(()=>t.map(([s,i])=>{let n=this._instance.visibleElements??{},o;for(const c of i.slice(0,-1))if(typeof n[c]=="object"&&n[c]!==null)n=n[c];else{o=!!n[c];break}o===void 0&&(o=!!(n[i.slice(-1)[0]]??!0)),s.startsWith("hide");const m=s.startsWith("hide")||s.startsWith("show")?s.startsWith("hide"):o,a=this.component;return typeof a[s]=="boolean"?this._updateWidgetVisibleElement(i,a[s],m):a[s]=!1,r(this.component,s,c=>this._updateWidgetVisibleElement(i,c,m))}))}_updateWidgetVisibleElement(e,t,s){let i=this._instance.visibleElements??{};for(const o of e.slice(0,-1))(typeof i[o]!="object"||i[o]===null)&&(i[o]={}),i=i[o];const n=!!(s?!t:t);i[e.at(-1)]=n}hostLoaded(){const{el:e}=this.component;e.childElem??(e.childElem=document.createElement("div")),this._instance.container=e.childElem;let t=!1;const s=this.component.el.view;Object.defineProperty(this.component.el,"view",{get:()=>{var i;return this._instance.view??((i=this._instance.viewModel)==null?void 0:i.view)},set:i=>{!("view"in this._instance)&&typeof this._instance.viewModel=="object"?this._instance.viewModel.view=i:this._instance.view=i,!("map"in this._instance)&&typeof this._instance.viewModel=="object"?this._instance.viewModel.map=i.map:this._instance.map=i.map,this._watchViewDestroy(),i&&!t&&(t=!0,this.component.arcgisReady.emit())},configurable:!0,enumerable:!0}),s&&(this._instance.view=s),this.component.el.isConnected&&(h(this.component),this._watchViewDestroy())}hostDisconnected(){var e,t;typeof this.component.el.childElem=="object"&&((t=(e=this.component.el.view)==null?void 0:e.ui)==null||t.remove(this.component.el.childElem))}hostDestroy(){var e;super.hostDestroy(),(e=this._watchViewDestroyHandle)==null||e.remove()}_watchMetaProperties(){r(this.component,"position",e=>{this.component.el.childElem!=null&&typeof e=="string"&&h(this.component)}),r(this.component,"referenceElement",()=>h(this.component))}_makeVisibleElementsBinder(){return new Proxy({},{has:(e,t)=>typeof t=="string"||Reflect.has(e,t),get:(e,t)=>{if(typeof t=="symbol"||t in Promise.prototype)return Reflect.get(e,t);const s=[t],i=this._makeRecursiveProxy(s);return p(this.component,n=>{const o=n;this.component[o]=!1,this._watchedVisibleElementsProperties[o]=s},i)}})}_makeRecursiveProxy(e){const t=new Proxy({},{get:(s,i)=>{const n=Reflect.get(s,i);return typeof i=="symbol"||i in Promise.prototype?n:(e.push(i),t)}});return t}_watchViewDestroy(){var e;(e=this._watchViewDestroyHandle)==null||e.remove(),this._watchViewDestroyHandle=this.reactiveUtils.when(()=>{var t;return((t=this.component.el.view)==null?void 0:t.destroyed)===!0},()=>void this.component.destroy().catch(console.error),{sync:!0})}}const y=w(u);export{E as m};
