import{r as H,o as M,E as w}from"./vec32-Dvg_eL9J.js";import{F as O,N as l,r as v}from"./projectBuffer-CQnuEMuP.js";import{c as z,t as y}from"./Point-Cz2JYYmX.js";import{g as A,B as F,r as h,m as E,a as j}from"./Accessor-BmwT4B0c.js";import{i as L}from"./Evented-Dw4_VOGn.js";import{_ as B}from"./mat4-Fi6iAz29.js";import{e as G}from"./mat4f64-Dk4dwAN8.js";import{n as _}from"./vec3f64-BLpZdpfb.js";import{l as I}from"./RenderTexture-DlHrT8bu.js";import{H as C,i as P}from"./Polyline-s-JzsQqo.js";import{V as W}from"./sphere-Cin5efBj.js";import{e as S}from"./ElevationRange-BrgM1moX.js";import{e as T}from"./LineCallout.glsl-BQyjm-mE.js";import{T as q}from"./Intersector-tBiZcjSu.js";import{e as K}from"./intersectorUtils-BNnvTT1E.js";function le(e,r,t,o){const i=O(r,o);if(i==null)return!1;const s=i.source.spatialReferenceId,a=i.dest.spatialReferenceId;if(s===a&&s!==l.UNKNOWN||z(r,o))return t[0]=1,t[1]=1,t[2]=1,!0;if(s===l.SPHERICAL_ECEF){const m=H(e),f=m/Math.sqrt(e[0]*e[0]+e[1]*e[1]),n=m/y.radius;if(a===l.WEB_MERCATOR)return t[0]=f*n,t[1]=f*n,t[2]=1,!0;if(a===l.WGS84||a===l.CGCS2000){const p=v;return t[0]=p*f*n,t[1]=p*n,t[2]=1,!0}}else if(s===l.PLATE_CARREE){if(a===l.WGS84||a===l.CGCS2000)return t[0]=v,t[1]=v,t[2]=1,!0;if(a===l.WEB_MERCATOR){const m=e[1]/y.radius;return t[0]=1,t[1]=1/Math.cos(m),t[2]=1,!0}}return!1}let u=class extends L.EventedMixin(A){constructor(e){super(e),this._tmpEvent=new T,this._renderCoordsHelper=e.view.renderCoordsHelper,this._renderSR=this._renderCoordsHelper.spatialReference,this._layerElevationSource=e.layerElevationSource}initialize(){this._intersector=q(this.view.state.viewingMode),this._intersector.options.store=K.MIN,this._intersector.options.normalRequired=!1,this._tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"}get spatialReference(){var e,r;return(r=(e=this.view)==null?void 0:e.elevationProvider)==null?void 0:r.spatialReference}getElevation(e,r,t,o){const i=this._renderCoordsHelper,s=M(c,e,r,t);if(!i.toRenderCoords(s,o,s))return F.getLogger(this).error("could not project point to compute elevation"),null;const{layerElevationSource:a,_intersector:m,intersectionHandler:f}=this,n=a.fullExtent,p=n!=null&&Number.isFinite(n.xmin)&&Number.isFinite(n.xmax)&&Number.isFinite(n.ymin)&&Number.isFinite(n.ymax)&&Number.isFinite(n.zmin)&&Number.isFinite(n.zmax)?new S(n.zmin,n.zmax):a.elevationRange;if(p==null)return null;const R=a.elevationOffset,N=p.elevationRangeMin+R,$=p.elevationRangeMax+R,x=i.setAltitude(U,$,s),g=i.setAltitude(V,N,s);return m.reset(x,g,null),f.intersect(m,null,x,g,null,!0),m.results.min.getIntersectionPoint(s)?i.getAltitude(s):null}getSphereElevationBounds(e,r){return I(e,r,b,this._renderSR),this._layerElevationSource.getElevationRange(b)}getRootElevationBounds(){const e=this.layerElevationSource.fullExtent;return e!=null&&e.hasZ?new S(e.zmin,e.zmax):null}objectsChanged(e){this.spatialReference&&(this._computeLayerExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}objectChanged(e){this.spatialReference&&(this._computeObjectExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}_computeObjectExtent(e,r){C(r),this._expandExtent(e,r)}_computeLayerExtent(e,r){C(r);for(const t of e)this._expandExtent(t,r)}_expandExtent(e,r){const t=this.spatialReference;if(t==null||e==null)return;B(d,e.quaternion),d[12]=e.center[0],d[13]=e.center[1],d[14]=e.center[2];const o=e.halfSize;for(let i=0;i<8;++i)c[0]=1&i?o[0]:-o[0],c[1]=2&i?o[1]:-o[1],c[2]=4&i?o[2]:-o[2],w(c,c,d),this._renderCoordsHelper.fromRenderCoords(c,c,t),P(r,c,r)}};h([E({constructOnly:!0})],u.prototype,"layerElevationSource",void 0),h([E({constructOnly:!0})],u.prototype,"intersectionHandler",void 0),h([E({constructOnly:!0})],u.prototype,"view",void 0),h([E()],u.prototype,"spatialReference",null),u=h([j("esri.views.3d.layers.i3s.LayerElevationProvider")],u);const d=G(),b=W(0,0,0,0),c=_(),U=_(),V=_();class ce{constructor(r,t,o,i){this.toMapSpace=r,this.transform=t,this.obb=o,this.geometry=i}}class me{constructor(r,t){this.position=r,this.rotationScale=t,this.origin=void 0}}export{me as i,le as n,ce as t,u as x};
