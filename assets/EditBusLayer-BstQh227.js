import{eh as R,U,_ as V,c8 as H,d as T,f as x,c$ as k,aV as p}from"./index-B1qcMJFy.js";const P=R(),$=new Map,j=new Map;async function B(e,s,d){if(!e||!d)return!1;if(!s)return!0;const n=new URL(e).host;let t=$.get(n);if(!t){const r=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");t=(await U(r,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return t===s}async function N(e,s,d=!1){var r,a;if(!e||!s)return!0;const n=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),t=(r=j.get(n))==null?void 0:r.entries();if(t){for(const[l,c]of t)if(c.name===s){const u=!((a=c.stack)!=null&&a.hasForwardEdits());if(!u&&d){const[{deleteForwardEdits:m},{default:h}]=await Promise.all([V(()=>import("./deleteForwardEdits-CnpQzWqw.js"),__vite__mapDeps([0,1,2]),import.meta.url),V(()=>import("./DeleteForwardEditsParameters-CEvngKf8.js"),__vite__mapDeps([3,1,2]),import.meta.url)]);return m(n,l,new h({sessionId:P,moment:c.moment}))}return u}}return!0}function D(e,s){var t;if(!e)return!1;const d=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),n=(t=j.get(d))==null?void 0:t.entries();if(n){for(const[r,a]of n)if(a.name===s)return a.lockType==="edit"}return!1}const g=new H.EventEmitter;function O(e){return g.on("apply-edits",new WeakRef(e))}function W(e){return g.on("update-moment",new WeakRef(e))}function z(e,s,d=null,n=!1){const t=k();return n=s==null||n,g.emit("apply-edits",{serviceUrl:e,layerId:s,gdbVersion:d,mayReceiveServiceEdits:n,result:t.promise}),t}const w="esri.layers.mixins.EditBusLayer",E=Symbol(w);function C(e){return e!=null&&typeof e=="object"&&E in e}function f(e){return e!=null&&typeof e=="object"&&"gdbVersion"in e}function b(e,s,d){const n=new URL(e).host,t=$.get(n),r=a=>!a||a===t;return r(s)&&r(d)||s===d}const G=e=>{var s;let d=class extends e{constructor(...n){super(...n),this[s]=!0,this._applyEditsHandler=t=>{const{serviceUrl:r,layerId:a,gdbVersion:l,mayReceiveServiceEdits:c,result:u}=t,m=r===this.url,h=a!=null&&this.layerId!=null&&a===this.layerId,A=f(this),S=f(this)&&b(r,l,this.gdbVersion);if(!m||A&&!S||!h&&!c)return;const L=u.then(i=>{var y;if(h&&(i.addedFeatures.length||i.updatedFeatures.length||i.deletedFeatures.length||i.addedAttachments.length||i.updatedAttachments.length||i.deletedAttachments.length))return this.emit("edits",p(i)),i;const I=(y=i.editedFeatures)==null?void 0:y.find(({layerId:F})=>F===this.layerId);if(I){const{adds:F,updates:M,deletes:v}=I.editedFeatures,_={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:F?F.map(({attributes:o})=>({objectId:this.objectIdField&&o[this.objectIdField],globalId:this.globalIdField&&o[this.globalIdField]})):[],deletedFeatures:v?v.map(({attributes:o})=>({objectId:this.objectIdField&&o[this.objectIdField],globalId:this.globalIdField&&o[this.globalIdField]})):[],updatedFeatures:M?M.map(({current:{attributes:o}})=>({objectId:this.objectIdField&&o[this.objectIdField],globalId:this.globalIdField&&o[this.globalIdField]})):[],editedFeatures:p(i.editedFeatures),exceededTransferLimit:!1,historicMoment:p(i.historicMoment)};return this.emit("edits",_),_}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:p(i.editedFeatures),exceededTransferLimit:!1,historicMoment:p(i.historicMoment)}}).then(i=>("historicMoment"in this&&this.historicMoment!==i.historicMoment&&D(r,l)&&(this.historicMoment=i.historicMoment),i));this.emit("apply-edits",{result:L})},this._updateMomentHandler=t=>{const{serviceUrl:r,gdbVersion:a,moment:l}=t,c=r===this.url,u=f(this),m=f(this)&&b(r,a,this.gdbVersion),h=f(this)&&!b(r,this.gdbVersion,null);c&&u&&m&&h&&"historicMoment"in this&&this.historicMoment!==l&&(this.historicMoment=l)},this.when().then(()=>{this.addHandles(O(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(W(this._updateMomentHandler))},()=>{})}};return s=E,d=T([x(w)],d),d};export{G as F,B as a,D as c,z as h,N as i,C as p,P as t};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./deleteForwardEdits-CnpQzWqw.js","./index-B1qcMJFy.js","./index-DAhQBRAS.css","./DeleteForwardEditsParameters-CEvngKf8.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
