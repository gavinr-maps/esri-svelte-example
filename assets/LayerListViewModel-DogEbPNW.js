import{r as o,m as d,a as g}from"./Accessor-BmwT4B0c.js";import{V as H,d as h,P as c}from"./reactiveUtils-XM7cS2OP.js";import{i as V}from"./Evented-Dw4_VOGn.js";import{e as _}from"./utils-BQBvadb7.js";import{O as b}from"./ListItem-DomCK2qd.js";import{m as I,u as A}from"./layerListUtils-BIu86t6C.js";const r={view:"view",viewLayers:"view-layers",mapLayers:"map-layers",layerViews:"layer-views",layerListMode:"layer-list-mode"},E="hide",f=H.ofType(b);let l=class extends V.EventedAccessor{constructor(e){super(e),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.operationalItems=new f,this.view=null}initialize(){this.addHandles([h(()=>{var e;return((e=this.view)==null?void 0:e.ready)===!0},()=>this._viewHandles(),c),h(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled],()=>this._recompileList()),h(()=>_(this.view)?this.view.inGeographicLayout:null,()=>this._compileList())],r.view)}destroy(){this._removeAllItems(),this.view=null}get state(){const{view:e}=this;return e!=null&&e.ready?"ready":e?"loading":"disabled"}get totalItems(){return this.operationalItems.flatten(e=>e.children).length}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}moveListItem(e,t,i,s){var w,L;const a=e==null?void 0:e.layer;if(!a||a.type==="subtype-sublayer"||a.type==="sublayer")return;const n=(L=(w=this.view)==null?void 0:w.map)==null?void 0:L.layers,y=t?I(t):n,m=i?I(i):n;if(!y||!m)return;const{operationalItems:p}=this,M=(t==null?void 0:t.children)||p,v=(i==null?void 0:i.children)||p,u=m.length-s;e.parent=i||null,M.remove(e),y.remove(a),v.includes(e)||v.add(e,u),m.includes(a)||m.add(a,u),this._compileList()}_createLayerViewHandles(e){this.removeHandles(r.layerViews),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),r.layerViews)}_createMapLayerHandles(e){this.removeHandles(r.mapLayers),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),r.mapLayers)}_createListItem(e){const{view:t,listItemCreatedFunction:i,checkPublishStatusEnabled:s,listModeDisabled:a}=this;return new b({checkPublishStatusEnabled:s,listModeDisabled:a,layer:e,listItemCreatedFunction:i,view:t})}_removeAllItems(){this.operationalItems.destroyAll()}_getViewableLayers(e){return e?this.listModeDisabled?e:e.filter(t=>A(t)!==E):void 0}_watchLayersListMode(e){this.removeHandles(r.layerListMode),e&&!this.listModeDisabled&&this.addHandles(h(()=>e.filter(t=>"listMode"in t).map(t=>t.listMode).toArray(),()=>this._compileList()),r.layerListMode)}_compileList(){var s,a;const e=(a=(s=this.view)==null?void 0:s.map)==null?void 0:a.layers,t=_(this.view)&&!this.view.inGeographicLayout?e==null?void 0:e.filter(({type:n})=>n==="link-chart"):e;this._watchLayersListMode(t);const i=this._getViewableLayers(t);i!=null&&i.length?(this._createNewItems(i),this._removeItems(i),this._sortItems(i)):this._removeAllItems()}_createNewItems(e){const{operationalItems:t}=this;e.forEach(i=>{t.some(s=>s.layer===i)||t.add(this._createListItem(i))})}_removeItems(e){const{operationalItems:t}=this,i=[];t.forEach(s=>{s&&e&&e.includes(s.layer)||i.push(s)}),t.destroyMany(i)}_sortItems(e){const{operationalItems:t}=this;t.sort((i,s)=>{const a=e.indexOf(i.layer),n=e.indexOf(s.layer);return a>n?-1:a<n?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){const{view:e}=this;this.removeHandles([r.mapLayers,r.layerViews,r.viewLayers]),e!=null&&e.ready?this.addHandles([h(()=>{var t,i;return(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.allLayers},t=>this._createMapLayerHandles(t),c),h(()=>{var t;return(t=this.view)==null?void 0:t.allLayerViews},t=>this._createLayerViewHandles(t),c)],r.viewLayers):this._removeAllItems()}};o([d()],l.prototype,"checkPublishStatusEnabled",void 0),o([d()],l.prototype,"listItemCreatedFunction",void 0),o([d({nonNullable:!0})],l.prototype,"listModeDisabled",void 0),o([d({type:f})],l.prototype,"operationalItems",void 0),o([d({readOnly:!0})],l.prototype,"state",null),o([d()],l.prototype,"totalItems",null),o([d()],l.prototype,"view",void 0),l=o([g("esri.widgets.LayerList.LayerListViewModel")],l);const $=l;export{$ as v};
