import{p as m,A as w,a as c}from"./index-c99fc80c-xXzSzjCa.js";import"./index-d2df902e-QBEsANpt.js";import{b as h}from"./component-utils-de9339fe-Dlc67iIs.js";/*!
 * All material copyright Esri, All Rights Reserved, unless otherwise specified.
 * See https://js.arcgis.com/4.30/esri/copyright.txt for details.
 * v4.30.7
 */const b=(a,e)=>(t,i)=>p(t,a,i);class f extends w{constructor(e,t,i){super(e,t,i),this._watchedViewModelProperties=new Map,this._watchedVisibleElementsProperties={},this._isBindingViewModel={value:!0},Object.defineProperty(this.exports,"viewModel",{value:c.makeGetterProxy(e,this._watchedViewModelProperties,this._isBindingViewModel)}),Object.defineProperty(this.exports,"visibleElements",{value:this._makeVisibleElementsBinder()})}hostConnected(){super.hostConnected(),this._isBindingViewModel.value=!1,this.component.manager.didLoadCalled&&h(this.component)}async hostLoad(){if(this._watchedProperties.delete("viewModel"),await super.hostLoad(),this.component.manager.destroyed)return;this._watchMetaProperties(),c.reEmitAccessorEvents(this,this._instance,this.reactiveUtils,"widget"),this.onLifecycle(()=>this.reactiveUtils.watch(()=>this._instance.viewModel,i=>{this.component.viewModel=i},{initial:!0}));const e=this._instance.viewModel;if(typeof e=="object")c.reEmitAccessorEvents(this,e,this.reactiveUtils,"viewModel"),c.watchComponentUpdates(this,e,this._watchedViewModelProperties),c.watchAccessorUpdates(this,e,this._watchedViewModelProperties);else if(this._watchedViewModelProperties.size>0)throw new Error(`The widget does not have a viewModel to bind to. Tried to bind the following properties: ${Array.from(this._watchedViewModelProperties.keys()).join(", ")}`);const t=Object.entries(this._watchedVisibleElementsProperties);t.length>0&&this.onLifecycle(()=>t.map(([i,s])=>{let o=this._instance.visibleElements??{},n;for(const r of s.slice(0,-1))if(typeof o[r]=="object"&&o[r]!==null)o=o[r];else{n=!!o[r];break}n===void 0&&(n=!!(o[s.slice(-1)[0]]??!0)),i.startsWith("hide");const d=i.startsWith("hide")||i.startsWith("show")?i.startsWith("hide"):n,l=this.component;return typeof l[i]=="boolean"?this._updateWidgetVisibleElement(s,l[i],d):l[i]=!1,this.watch(i,r=>this._updateWidgetVisibleElement(s,r,d))}))}_updateWidgetVisibleElement(e,t,i){let s=this._instance.visibleElements??{};for(const n of e.slice(0,-1))(typeof s[n]!="object"||s[n]===null)&&(s[n]={}),s=s[n];const o=!!(i?!t:t);s[e.at(-1)]=o}hostLoaded(){const{el:e}=this.component;e.childElem??(e.childElem=document.createElement("div")),this._instance.container=e.childElem;let t=!1;const i=this.component.el.view;Object.defineProperty(this.component.el,"view",{get:()=>{var s;return this._instance.view??((s=this._instance.viewModel)==null?void 0:s.view)},set:s=>{!("view"in this._instance)&&typeof this._instance.viewModel=="object"?this._instance.viewModel.view=s:this._instance.view=s,this._watchViewDestroy(),t||(t=!0,this.component.arcgisReady.emit())},configurable:!0,enumerable:!0}),i&&(this._instance.view=i),this.component.el.isConnected&&(h(this.component),this._watchViewDestroy())}hostDisconnected(){var e,t;typeof this.component.el.childElem=="object"&&((t=(e=this.component.el.view)==null?void 0:e.ui)==null||t.remove(this.component.el.childElem))}hostDestroy(){var e;super.hostDestroy(),(e=this._watchViewDestroyHandle)==null||e.remove()}_watchMetaProperties(){this.watch("position",e=>{this.component.el.childElem!=null&&typeof e=="string"&&h(this.component)}),this.watch("referenceElement",()=>h(this.component))}_makeVisibleElementsBinder(){return new Proxy({},{has:(e,t)=>typeof t=="string"||Reflect.has(e,t),get:(e,t)=>{if(typeof t=="symbol"||t in Promise.prototype)return Reflect.get(e,t);const i=[t],s=this._makeRecursiveProxy(i);return this.component.manager.trackPropKey(o=>{if(o===void 0)throw new Error("Unable to bind visibleElements property. Check for incorrect this.widget.visibleElements usage");this.component[o]=!1,this._watchedVisibleElementsProperties[o]=i},s)}})}_makeRecursiveProxy(e){const t=new Proxy({},{get:(i,s)=>{const o=Reflect.get(i,s);return typeof s=="symbol"||s in Promise.prototype?o:(e.push(s),t)}});return t}_watchViewDestroy(){var e;(e=this._watchViewDestroyHandle)==null||e.remove(),this._watchViewDestroyHandle=this.reactiveUtils.when(()=>{var t;return((t=this.component.el.view)==null?void 0:t.destroyed)===!0},()=>void this.component.destroy().catch(console.error),{sync:!0})}}const p=m(f);export{b as m};
