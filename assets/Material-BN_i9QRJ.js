import{e as n}from"./Evented-CXIxDjmW.js";import{c as x,H as D,S as b}from"./Accessor-D6mNnsWy.js";import{y as o,b as B,ag as $}from"./subclass-BR3PhgZG.js";import{N as R,h as d,e as g,b as C}from"./mathUtils-ClvKsMak.js";import{n as U}from"./interfaces-B8ge7Jg9.js";import{i as Y}from"./basicInterfaces-wONHx_SN.js";import{e as c}from"./VertexAttribute-BnAa5VW0.js";import{l as V}from"./ViewingMode-Dodu7ZZk.js";const G=new Map([[c.POSITION,0],[c.NORMAL,1],[c.NORMALCOMPRESSED,1],[c.UV0,2],[c.COLOR,3],[c.COLORFEATUREATTRIBUTE,3],[c.SIZE,4],[c.TANGENT,4],[c.CENTEROFFSETANDDISTANCE,5],[c.SYMBOLCOLOR,5],[c.FEATUREATTRIBUTE,6],[c.INSTANCEFEATUREATTRIBUTE,6],[c.INSTANCECOLOR,7],[c.OBJECTANDLAYERIDCOLOR,7],[c.INSTANCEOBJECTANDLAYERIDCOLOR,7],[c.INSTANCEMODEL,8],[c.INSTANCEMODELNORMAL,12],[c.INSTANCEMODELORIGINHI,11],[c.INSTANCEMODELORIGINLO,15]]);var f;(function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Mesh=2]="Mesh",e[e.Line=3]="Line",e[e.Point=4]="Point",e[e.Material=5]="Material",e[e.Texture=6]="Texture",e[e.COUNT=7]="COUNT"})(f||(f={}));class w{constructor(){this.id=x()}}let nt=class{constructor(){this.enabled=!0,this._time=D(0)}get time(){return this._time}advance({deltaTime:t,fixedTime:r}){return r!=null?this._time!==r&&(this._time=r,!0):(this._time=D(this._time+t),t!==0)}},q=class{constructor(t,r){this.deltaTime=t,this.fixedTime=r}},s=class extends b{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};n([o()],s.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),n([o()],s.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),n([o()],s.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),n([o()],s.prototype,"DECONFLICTOR_SHOW_GRID",void 0),n([o()],s.prototype,"LABELS_SHOW_BORDER",void 0),n([o()],s.prototype,"TEXT_SHOW_BASELINE",void 0),n([o()],s.prototype,"TEXT_SHOW_BORDER",void 0),n([o()],s.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),n([o()],s.prototype,"OVERLAY_SHOW_CENTER",void 0),n([o()],s.prototype,"SHOW_POI",void 0),n([o()],s.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),n([o()],s.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),n([o()],s.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),n([o()],s.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),n([o()],s.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),n([o()],s.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),n([o()],s.prototype,"I3S_TREE_SHOW_TILES",void 0),n([o()],s.prototype,"I3S_SHOW_MODIFICATIONS",void 0),n([o()],s.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),n([o()],s.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),n([o()],s.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),n([o()],s.prototype,"LINE_WIREFRAMES",void 0),s=n([B("esri.views.3d.support.debugFlags")],s);const lt=new s;function Et(e,t){return new T(e,P,t)}function _t(e,t){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:a}=P;return new T(e,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:S.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:S.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:a,minPixelSize:S.minPixelSize},t)}function X(e){return Math.abs(e*e*e)}function M(e,t,r){const i=r.parameters;return m.scale=Math.min(i.divisor/(t-i.offset),1),m.factor=X(e),m}function H(e,t){return R(e*Math.max(t.scale,t.minScaleFactor),e,t.factor)}function z(e,t,r){const i=M(e,t,r);return i.minScaleFactor=0,H(1,i)}function ut(e,t,r,i){i.scale=z(e,t,r),i.factor=0,i.minScaleFactor=r.minScaleFactor}function ht(e,t,r=[0,0]){const i=Math.min(Math.max(t.scale,t.minScaleFactor),1);return r[0]=e[0]*i,r[1]=e[1]*i,r}function Z(e,t,r,i){return H(e,M(t,r,i))}class T{get minScaleFactor(){return this._fontHeight!=null?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(t,r,i,a=j(),l){this._viewingMode=t,this._description=r,this._ellipsoidRadius=i,this.parameters=a,this._fontHeight=l,this._viewingMode===V.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(t){return(!this.parameters||this.parameters.camera.fovY!==t.fovY||this.parameters.camera.distance!==t.distance)&&(this._calculateParameters(t,this._ellipsoidRadius,this.parameters),!0)}overrideFontHeight(t){return t!==this._fontHeight?new T(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,t):this}_calculateParameters(t,r,i){const{scaleStart:a,scaleFallOffRange:l}=this._description,{fovY:E,distance:_}=t,h=this._calculateCurvatureDependentParameters(t,r),u=this._coverageCompensation(t,r,h),{tiltAngle:p,scaleFallOffFactor:O}=h,A=Math.sin(p)*_,v=.5*Math.PI-p-E*(.5-a*u),L=A/Math.cos(v),y=v+E*l*u,N=(L-O*(A/Math.cos(y)))/(1-O);return i.camera.fovY=t.fovY,i.camera.distance=t.distance,i.offset=N,i.divisor=L-N,i}_calculateCurvatureDependentParametersLocal(t,r,i=F){return i.tiltAngle=this._description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(t,r,i=F){const a=this._description.curvatureDependent,l=1+t.distance/r,E=Math.sqrt(l*l-1),[_,h]=[a.min.curvature,a.max.curvature],u=g((E-_)/(h-_),0,1),[p,O]=[a.min,a.max];return i.tiltAngle=R(p.tiltAngle,O.tiltAngle,u),i.scaleFallOffFactor=R(p.scaleFallOffFactor,O.scaleFallOffFactor,u),i}_surfaceCoverageCompensationLocal(t,r,i){return(t.fovY-i.tiltAngle)/t.fovY}_surfaceCoverageCompensationGlobal(t,r,i){const a=r*r,l=i.tiltAngle+.5*Math.PI,{fovY:E,distance:_}=t,h=_*_+a-2*Math.cos(l)*_*r,u=Math.sqrt(h),p=Math.sqrt(h-a);return(Math.acos(p/u)-Math.asin(r/(u/Math.sin(l)))+.5*E)/E}}const P={curvatureDependent:{min:{curvature:d(10),tiltAngle:d(12),scaleFallOffFactor:.5},max:{curvature:d(70),tiltAngle:d(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},S={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function j(){return{camera:{distance:0,fovY:0},divisor:0,offset:0}}const m={scale:0,factor:0,minScaleFactor:0},F={tiltAngle:0,scaleFallOffFactor:0};function pt(e,t,r,i,a){let l=(r.screenLength||0)*e.pixelRatio;a!=null&&(l=Z(l,i,t,a));const E=l*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return g(E*t,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function W(e,t){const r=t?W(t):{};for(const i in e){let a=e[i];a!=null&&a.forEach&&(a=k(a)),a==null&&i in r||(r[i]=a)}return r}function J(e,t){let r=!1;for(const i in t){const a=t[i];a!==void 0&&(Array.isArray(a)?e[i]===null?(e[i]=a.slice(),r=!0):$(e[i],a)&&(r=!0):e[i]!==a&&(r=!0,e[i]=a))}return r}function k(e){const t=[];return e.forEach(r=>t.push(r)),t}const Ot={multiply:1,ignore:2,replace:3,tint:4};class dt extends w{constructor(t,r){super(),this.type=f.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._vertexAttributeLocations=G,this._pp0=C(0,0,1),this._pp1=C(0,0,0),this._parameters=W(t,r),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(t){return!1}setParameters(t,r=!0){J(this._parameters,t)&&(this.validateParameters(this._parameters),r&&this.parametersChanged())}validateParameters(t){}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this.parametersChanged())}shouldRender(t){return this.isVisible()&&this.isVisibleForOutput(t.output)&&(!this.parameters.isDecoration||t.bindParameters.decorations===Y.ON)&&!!(this.parameters.renderOccluded&t.renderOccludedMask)}isVisibleForOutput(t){return!0}get renderPriority(){return this._renderPriority}set renderPriority(t){t!==this._renderPriority&&(this._renderPriority=t,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){var t;(t=this.repository)==null||t.materialChanged(this)}queryRenderOccludedState(t){return this.isVisible()&&this.parameters.renderOccluded===t}intersectDraped(t,r,i,a,l,E){return this._pp0[0]=this._pp1[0]=a[0],this._pp0[1]=this._pp1[1]=a[1],this.intersect(t,r,i,this._pp0,this._pp1,l)}}class Tt extends q{constructor(t,r,i){super(r,i),this.camera=t}}var I;(function(e){e[e.None=0]="None",e[e.Occlude=1]="Occlude",e[e.Transparent=2]="Transparent",e[e.OccludeAndTransparent=4]="OccludeAndTransparent",e[e.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",e[e.Opaque=16]="Opaque"})(I||(I={}));class St extends U{constructor(){super(...arguments),this.renderOccluded=I.Occlude,this.isDecoration=!1}}export{G as O,Ot as a,ut as b,dt as c,nt as d,f as e,ht as f,_t as g,I as h,J as i,Tt as j,Et as n,pt as o,w as r,H as s,lt as t,St as u};
