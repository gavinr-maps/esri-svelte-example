const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./chartUtilsAm5-SdAMhygp.js","./intl-CChhNOV8.js","./date-DlqISzcw.js","./jsonMap-0cxwUWs2.js","./subclass-BZA_h8Db.js","./locale-C9TlLpzi.js","./messages-OmQvZhAg.js","./Accessor-BLX9ikPh.js","./assets-C43MgM-v.js","./index-Bh2oEzTI.js","./index-2kwcjS9-.css","./tslib.es6-B3Jf3DVX.js","./Theme-CClEG6aO.js","./Tooltip-CbvbKhee.js","./DefaultTheme-DgyNOTWV.js","./calcite-icon-Cu0W9dtm.js","./icon-BQO9J86c.js","./jsxFactory-CJa39Fro.js","./Evented-BHRw9x22.js","./Promise-B2Hu02L7.js","./reactiveUtils-C5zUhJQJ.js","./asyncUtils-CWX51uTe.js","./Collection-CEdjem1-.js","./shared-B3wH2qpO.js","./SimpleObservable-KocWTzVy.js","./uuid-fwrPAdZb.js","./cast-Bjksrh93.js","./dom-D_AJDzAj.js","./observers-D2xgmA06.js","./chartCommon-DHdwUBXF.js","./ResponsiveTheme-Davkijyt.js","./Button-CkcQ3mkT.js","./ColorSet-m18wwIVg.js","./pieChart-B9-E6EvA.js","./Tick-CpbeWzTs.js","./xyChart-DQWUP916.js","./LineSeries-CHF2Cw04.js","./arcade-G0NwyxZJ.js","./Graphic-DsxsIjhH.js","./geometry-D964gYQX.js","./Extent-Bf3YTe7m.js","./Point-Cg0-ChZE.js","./writer-DNAwXnhG.js","./Polyline-D9YkgmM_.js","./mathUtils-C4_ghTv4.js","./PopupTemplate-BHMhS05j.js","./Clonable-D3rtuBWg.js","./fieldUtils-tmQlKvWo.js","./enumeration-Ba5njXdz.js","./Color-BCS62Hs5.js","./colorUtils-0bJDPow9.js","./ActionToggle-iT4slXc7.js","./Identifiable-B1UbsKNt.js","./symbols-CNimns--.js","./TextSymbol-D8QO_KUV.js","./screenUtils-_ZIvrt5o.js","./materialUtils-DarhapKC.js","./opacityUtils-C68Tlu6_.js","./vec3f64-BLpZdpfb.js","./aaBoundingBox-BE7cC1jD.js","./persistableUrlUtils-fa1mAujs.js","./collectionUtils-D_lHIu88.js","./Portal-C10FKnaA.js","./Loadable-BabW5Xcc.js","./jsonUtils-CEfjT-BK.js","./TimeOnly-DOn_Hy89.js","./UnknownTimeZone-BkowvBs8.js","./ImmutableArray-BPVd6ESQ.js","./FeatureLayer-wa_7EIxE.js","./ClassBreaksRenderer-BuHwSyVK.js","./UniqueValueRenderer-BQtAHUSo.js","./diffUtils-BP7jmOAy.js","./colorRamps-pKd7I5WZ.js","./SizeVariable-936USOrb.js","./sizeVariableUtils-Cmcuvw-4.js","./visualVariableUtils-DX1kS9Se.js","./compilerUtils-Dw3R0f-Z.js","./lengthUtils-DL1-FDQQ.js","./ColorStop-Dk3U5tCk.js","./jsonUtils-Ds2Sqto-.js","./layerUtils-BrNoooE9.js","./defaults-DZ1kfMRx.js","./defaultsJSON-GKolV7NZ.js","./RendererLegendOptions-B-4se3aU.js","./styleUtils-BYTm14n3.js","./jsonUtils-DxpLMo6d.js","./LRUCache-B_PHMSGm.js","./MemCache-Dx1v3xLC.js","./Version-BSlAgupz.js","./FieldsIndex-DpwHKAMX.js","./OverrideHelper-ti072FkP.js","./colorUtils-aL8wj-8G.js","./vec42-YcqnINSP.js","./common-DQOJ18NT.js","./vec4f64-o2zAXfmz.js","./utils-D2PLyMFF.js","./enums-CmIX1y88.js","./quantizationUtils-uj_P09aO.js","./HeatmapColorStop-BJc5nbwr.js","./heatmapUtils-Dwiv9IEa.js","./SimpleRenderer-BV2L9G_n.js","./MultiOriginJSONSupport-B5nfqtQh.js","./layerContainerType-C5CzMsLd.js","./FeatureLayerBase-Ck7-w8TE.js","./formUtils-ylzKAM7E.js","./Field-ybkHhtnK.js","./fieldType-BuzM0UHS.js","./HeightModelInfo-9nOoV6LU.js","./arcgisLayerUrl-BX1FE5Hm.js","./commonProperties-CPyIG_-u.js","./ElevationInfo-CA5m_tHv.js","./unitConversionUtils-BMfW9yAe.js","./AttributeTableTemplate-BZeVyq-j.js","./featureLayerUtils-DBsQMhTm.js","./featureQueryAll-DnVoEjkM.js","./Query-5Xpquc1r.js","./DataLayerSource-BKkswDvG.js","./FullTextSearch-Csd1Hktu.js","./TimeExtent-DocT5yPf.js","./timeUtils-8fb_2oAt.js","./AttachmentQuery-BUlkjzkx.js","./RelationshipQuery-DPPNeuLK.js","./LayerFloorInfo-CIQjg5Vk.js","./Relationship-COPq3qM4.js","./serviceCapabilitiesUtils-DAE5z8FP.js","./Layer-CVt7Hb5J.js","./workers-D4HfeYKj.js","./Queue-yu3bZ02p.js","./editsZScale-Bs7_pSzI.js","./queryZScale-w66xFVGx.js","./projection-B971H0Re.js","./projectBuffer-Bs7GwaPY.js","./geodesicConstants-DWQLYX7F.js","./FeatureSet-BHEkYP03.js","./APIKeyMixin-Di9kcRBS.js","./ArcGISService-B5qxetOY.js","./BlendLayer-CXM4n_Ge.js","./jsonUtils-CSnQD004.js","./parser-CTsgEym6.js","./utils-93yNk4Xc.js","./mat4f32-DcsiF_Rp.js","./mat4-GpOFENPA.js","./CustomParametersMixin-B4u7wiBT.js","./EditBusLayer-DoTks2sU.js","./FeatureEffectLayer-CpM66wLd.js","./FeatureEffect-BEzQmzeC.js","./FeatureFilter-BMHRQSxq.js","./FeatureReductionLayer-Ddbk727V.js","./FeatureReductionSelection-7vaL4DYT.js","./labelingInfo-DYPSPZCH.js","./labelUtils-B8petyBk.js","./MD5-C9MwAd2G.js","./OperationalLayer-CVyVfSPu.js","./OrderedLayer-C5VLMHgA.js","./OrderByInfo-IYmS1EXF.js","./PortalLayer-CKja4bdW.js","./PortalItem-DzgXrpyc.js","./portalItemUtils-BzVoFAku.js","./RefreshableLayer-D7lXUJRS.js","./ScaleRangeLayer-Bb8Ig1Hz.js","./TemporalLayer-Dpq2hKKV.js","./TimeInfo-LUiaSFyX.js","./TimeInterval-CNlkea1s.js","./FeatureTemplate-CssMa1yk.js","./FeatureType-C0q_coeM.js","./fieldProperties-Cgxj08ZE.js","./versionUtils-CQ_WhYSP.js","./styleUtils-KMFBtb6u.js","./popupUtils-BBuPGAHd.js","./AlphaCutoff-UcccL64p.js","./interfaces-CL2NbQte.js","./calcite-loader-DP4PIFO8.js","./loader-C-zIPscB.js","./locale-A4FuYD8q.js","./key-D63ExP77.js","./calcite-list-C4jOVpC-.js","./interactive-y84HQRWL.js","./resources4-DXHY1U7R.js","./utils3-BrU6GrkI.js","./loadable-DM18hPdE.js","./t9n-D0ry3MEw.js","./filter-yN6-jZOU.js","./debounce-BOqmhDXu.js","./input2-BReyTnf4.js","./form-BZPQ5PUM.js","./label-DEe8AW1C.js","./component-6CIDVndn.js","./Validation-Bz9yoU6e.js","./input-j1u1wOBY.js","./input-message-CWvsvdFk.js","./progress-BXyickl_.js","./scrim-DPa2aeKh.js","./calcite-list-item-vbKS6alm.js","./action-D0Er9Ef6.js","./handle-Ct1HP3bl.js","./calcite-notice-DSp0z_Oh.js","./conditionalSlot-R5D9krYS.js","./resources2-DjkgwdyM.js","./openCloseComponent-CmOrfBN-.js","./calcite-chip-C9GKwE1v.js","./chip-ZieJjxzJ.js","./calcite-input-DAafN6Cc.js","./calcite-tooltip-rE_jVYtd.js","./floating-ui-Bma_zPVt.js","./FloatingArrow-BBdsG5MP.js"])))=>i.map(i=>d[i]);
import{_ as b}from"./index-Bh2oEzTI.js";import{r as o}from"./tslib.es6-B3Jf3DVX.js";import{s as Oe,l as Gt}from"./intl-CChhNOV8.js";import{watch as k,initial as q,on as Mt,whenOnce as Yt}from"./reactiveUtils-C5zUhJQJ.js";import{m as l,a as V,b as st,n as Ze,ak as Ct,O as Ft}from"./subclass-BZA_h8Db.js";import{s as Se}from"./cast-Bjksrh93.js";import{B as G,n as h,e as z,r as pe,u as ve,s as Zt}from"./jsxFactory-CJa39Fro.js";import{y as Jt,I as Kt}from"./Attachments-PCr7j7mL.js";import{e as $t}from"./Heading-C-odFCu-.js";import{d as Pe}from"./Graphic-DsxsIjhH.js";import{b as oe,D as ei,y as re,q as Et,I as Tt,j as rt,C as ot,c as ti}from"./Accessor-BLX9ikPh.js";import{E as ke,v as xt,U as Lt,y as te,D as ie,Q as nt,z as at,R as ii,M as lt,x as Rt,t as si,u as Je,l as Ke,N as dt,o as ri,b as ct,a as oi,c as ni,K as ai,V as li,i as di,p as ci,f as We,T as ui,w as pi}from"./featureUtils-Do2jvOGL.js";import{e as kt,t as hi}from"./widget-DwhGPDuv.js";import{a as mi,n as Vt,p as fi,d as _i,I as yi,e as Nt,c as gi}from"./PopupTemplate-BHMhS05j.js";import{e as he}from"./globalCss-CZa70j6i.js";import{a as vi}from"./uriUtils-DHHvHAs0.js";import{o as wi}from"./a11yUtils-cyWndM8Q.js";import{x as bi}from"./utils-D3iwntXt.js";import{U as Ii}from"./assets-C43MgM-v.js";import{p as Ai}from"./fieldUtils-tmQlKvWo.js";import{s as He}from"./executeQueryJSON-Cis2sczl.js";import{m as Mi,b as Ae}from"./Query-5Xpquc1r.js";import Ci from"./RelationshipQuery-DPPNeuLK.js";import{r as Fi}from"./themeUtils-C3zvZbsE.js";import"./geometry-D964gYQX.js";import{e as Ot}from"./throttle-jjSnxk80.js";import{j as $i}from"./shared-OyXfj1UM.js";import St from"./FeatureLayer-wa_7EIxE.js";import{j as Pt}from"./Point-Cg0-ChZE.js";import{F as et}from"./FeatureRelationshipViewModel-BPfZSJYn.js";import{s as Dt}from"./ReactiveMap-6CfRGOlR.js";import{c as Ve}from"./popupUtils-BBuPGAHd.js";import{i as Ei}from"./Clonable-D3rtuBWg.js";import{V as ee}from"./Collection-CEdjem1-.js";import{s as qt}from"./Identifiable-B1UbsKNt.js";import{e as Ti,u as xi,p as ut}from"./NetworkElement-CyYx535m.js";import{d as Li}from"./Association-CIWSDxb_.js";import{o as Ri}from"./date-DlqISzcw.js";let we=class extends Jt{constructor(e){super(e),this.description=null,this.title=null}};o([l()],we.prototype,"description",void 0),o([l()],we.prototype,"title",void 0),we=o([V("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],we);const tt=we,Ue="esri-feature-element-info",Be={base:Ue,title:`${Ue}__title`,description:`${Ue}__description`};let de=class extends G{constructor(e,i){super(e,i),this.description=null,this.headingLevel=2,this.title=null}render(){return h("div",{class:Be.base},this._renderTitle(),this._renderDescription())}_renderTitle(){const{title:e}=this;return e?h($t,{class:Be.title,innerHTML:e,level:this.headingLevel}):null}_renderDescription(){const{description:e}=this;return e?h("div",{class:Be.description,innerHTML:e,key:"description"}):null}};o([l()],de.prototype,"description",void 0),o([l()],de.prototype,"headingLevel",void 0),o([l()],de.prototype,"title",void 0),de=o([V("esri.widgets.Feature.support.FeatureElementInfo")],de);const Me=de,ki={base:"esri-feature-attachments"};let X=class extends G{constructor(e,i){super(e,i),this._featureElementInfo=null,this.attachmentsWidget=new Kt,this.headingLevel=2,this.viewModel=new tt}initialize(){this._featureElementInfo=new Me,this.addHandles([k(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.description,(i=this.viewModel)==null?void 0:i.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),q),k(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,q)])}destroy(){var e;this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),(e=this._featureElementInfo)==null||e.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var i;const{attachmentsWidget:e}=this;return h("div",{class:ki.base},(i=this._featureElementInfo)==null?void 0:i.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){var r;const{description:e,title:i,headingLevel:s}=this;(r=this._featureElementInfo)==null||r.set({description:e,title:i,headingLevel:s})}};o([l({readOnly:!0})],X.prototype,"attachmentsWidget",void 0),o([l()],X.prototype,"description",null),o([l()],X.prototype,"displayType",null),o([l()],X.prototype,"graphic",null),o([l()],X.prototype,"headingLevel",void 0),o([l()],X.prototype,"title",null),o([l({type:tt})],X.prototype,"viewModel",void 0),X=o([V("esri.widgets.Feature.FeatureAttachments")],X);const Vi=X;let K=class extends oe{constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles(k(()=>this.creator,i=>{this._destroyContent(),this._createContent(i)},q))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:i,destroyer:s}=this;e&&i&&(ke({type:"content",value:s,event:{graphic:i}}),this._set("created",null))}async _createContent(e){const i=this.graphic;if(!i||!e)return;const s=ke({type:"content",value:e,event:{graphic:i}});this._loadingPromise=s,this.notifyChange("state");const r=await s;s===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))}};o([l({readOnly:!0})],K.prototype,"created",void 0),o([l()],K.prototype,"creator",void 0),o([l()],K.prototype,"destroyer",void 0),o([l({type:Pe})],K.prototype,"graphic",void 0),o([l({readOnly:!0})],K.prototype,"state",null),K=o([V("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],K);const Ne=K,Qe="esri-feature-content",ze={base:Qe,loaderContainer:`${Qe}__loader-container`,loader:`${Qe}__loader`};let ce=class extends G{constructor(e,i){super(e,i),this.viewModel=null,this._addTargetToAnchors=s=>{Array.from(s.querySelectorAll("a")).forEach(r=>{xt(r.href)&&!r.hasAttribute("target")&&r.setAttribute("target","_blank")})}}get creator(){var e;return(e=this.viewModel)==null?void 0:e.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){var e;return(e=this.viewModel)==null?void 0:e.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}render(){var i;const e=(i=this.viewModel)==null?void 0:i.state;return h("div",{class:ze.base},e==="loading"?this._renderLoading():this._renderCreated())}_renderLoading(){return h("div",{class:ze.loaderContainer,key:"loader"},h("div",{class:ze.loader}))}_renderCreated(){var i;const e=(i=this.viewModel)==null?void 0:i.created;return e?e instanceof HTMLElement?h("div",{afterCreate:this._attachToNode,bind:e,key:e}):kt(e)?h("div",{key:e},!e.destroyed&&e.render()):h("div",{afterCreate:this._addTargetToAnchors,innerHTML:e,key:e}):null}_attachToNode(e){const i=this;e.appendChild(i)}};o([l()],ce.prototype,"creator",null),o([l()],ce.prototype,"graphic",null),o([l({type:Ne})],ce.prototype,"viewModel",void 0),ce=o([V("esri.widgets.Feature.FeatureContent")],ce);const Ee=ce;let Y=class extends oe{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:i}=this,s=[];return i==null||i.forEach(r=>{if(!(!r.hasOwnProperty("visible")||r.visible))return;const n=r.clone();n.label=Lt(n,e),s.push(n)}),s}};o([l()],Y.prototype,"attributes",void 0),o([l({type:[mi]})],Y.prototype,"expressionInfos",void 0),o([l()],Y.prototype,"description",void 0),o([l({type:[Vt]})],Y.prototype,"fieldInfos",void 0),o([l({readOnly:!0})],Y.prototype,"formattedFieldInfos",null),o([l()],Y.prototype,"title",void 0),Y=o([V("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Y);const De=Y,Fe="esri-feature-fields",$e={base:Fe,fieldHeader:`${Fe}__field-header`,fieldData:`${Fe}__field-data`,fieldDataDate:`${Fe}__field-data--date`};let Q=class extends G{constructor(e,i){super(e,i),this._featureElementInfo=null,this.viewModel=new De,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new Me,this.addHandles(k(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.description,(i=this.viewModel)==null?void 0:i.title]},()=>this._setupFeatureElementInfo(),q))}destroy(){var e;(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var e;return h("div",{class:$e.base},(e=this._featureElementInfo)==null?void 0:e.render(),this._renderFields())}_renderFieldInfo(e,i){var u;const{attributes:s}=this.viewModel,r=e.fieldName||"",n=e.label||r,a=s?s[r]==null?"":s[r]:"",d=!!((u=e.format)!=null&&u.dateFormat),c=typeof a=="number"&&!d?this._forceLTR(a):vi(this.messagesURIUtils,a),p={[$e.fieldDataDate]:d};return h("tr",{key:`fields-element-info-row-${r}-${i}`},h("th",{class:$e.fieldHeader,innerHTML:n,key:`fields-element-info-row-header-${r}-${i}`}),h("td",{class:this.classes($e.fieldData,p),innerHTML:c,key:`fields-element-info-row-data-${r}-${i}`}))}_renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e!=null&&e.length?h("table",{class:he.table,summary:this.messages.fieldsSummary},h("tbody",null,e.map((i,s)=>this._renderFieldInfo(i,s)))):null}_setupFeatureElementInfo(){var s;const{description:e,title:i}=this;(s=this._featureElementInfo)==null||s.set({description:e,title:i})}_forceLTR(e){return`&lrm;${e}`}};o([l()],Q.prototype,"attributes",null),o([l()],Q.prototype,"description",null),o([l()],Q.prototype,"expressionInfos",null),o([l()],Q.prototype,"fieldInfos",null),o([l()],Q.prototype,"title",null),o([l({type:De,nonNullable:!0})],Q.prototype,"viewModel",void 0),o([l(),z("esri/widgets/Feature/t9n/Feature")],Q.prototype,"messages",void 0),o([l(),z("esri/widgets/support/t9n/uriUtils")],Q.prototype,"messagesURIUtils",void 0),Q=o([V("esri.widgets.Feature.FeatureFields")],Q);const jt=Q,Ni="esri.widgets.Feature.support.relatedFeatureUtils",pt=()=>Ze.getLogger(Ni),ht=new Map;function Te(t){if(!te(t))return null;const[e,i]=t.split("/").slice(1);return{layerId:e,fieldName:i}}function Oi(t,e){if(!e.relationships)return null;let i=null;const{relationships:s}=e;return s.some(r=>r.id===parseInt(t,10)&&(i=r,!0)),i}function Si({originRelationship:t,relationships:e,layerId:i}){return e.find(({relatedTableId:s,id:r})=>`${s}`===i&&r===(t==null?void 0:t.id))??null}function Pi(t,e){const i=e.toLowerCase();for(const s in t)if(s.toLowerCase()===i)return t[s];return null}function Di(t,e){const i=Oi(t,e);if(i)return{url:`${e.url}/${i.relatedTableId}`,sourceSpatialReference:e.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function qi(t,e){if(!e||!t)return;const{features:i,statsFeatures:s}=t,r=i==null?void 0:i.value;e.relatedFeatures=r?r.features:[];const n=s==null?void 0:s.value;e.relatedStatsFeatures=n?n.features:[]}function ji(t,e,i,s){var n;const r=new Ci;return r.outFields=["*"],r.relationshipId=typeof e.id=="number"?e.id:parseInt(e.id,10),r.objectIds=[t.attributes[i.objectIdField]],r.gdbVersion=i.gdbVersion??null,r.historicMoment=i.historicMoment??null,((n=i.queryRelatedFeatures)==null?void 0:n.call(i,r,s))??Promise.resolve({})}function Wi(t,e,i){let s=0;const r=[];for(;s<e.length;)r.push(`${t} IN (${e.slice(s,i+s)})`),s+=i;return r.join(" OR ")}function Hi(t){return t?Ct(t):void 0}function Ui(t){return t?Ct(t,(e,i)=>JSON.stringify(e.toJSON())===JSON.stringify(i.toJSON())):void 0}async function Bi(t,e,i,s){const r=i.layerId.toString(),{layerInfo:n,relation:a,relatedFields:d,outStatistics:c,url:p,sourceSpatialReference:u}=e,m=Hi(d),f=Ui(c);if(!n||!a)return null;const _=Si({originRelationship:a,relationships:n.relationships,layerId:r});if(_!=null&&_.relationshipTableId&&_.keyFieldInRelationshipTable){const v=(await ji(t,_,i,s))[t.attributes[i.objectIdField]];if(!v)return null;const w=v.features.map(I=>I.attributes[n.objectIdField]);if(f!=null&&f.length&&n.supportsStatistics){const I=new Ae;I.where=Wi(n.objectIdField,w,1e3),I.outFields=m,I.outStatistics=f,I.sourceSpatialReference=u;const g={features:Promise.resolve(v),statsFeatures:He(p,I)};return re(g)}}const y=_==null?void 0:_.keyField;if(y){const v=Ai(Yi(n.fields,y)),w=Pi(t.attributes,a.keyField),I=v?`${y}=${w}`:`${y}='${w}'`,g=i.historicMoment,C=i.gdbVersion,E=He(p,new Ae({where:I,outFields:m,sourceSpatialReference:u,historicMoment:g,gdbVersion:C}),s),N=f!=null&&f.length&&n.supportsStatistics?He(p,new Ae({where:I,outFields:m,outStatistics:f,sourceSpatialReference:u}),s):null,P={features:E};return N&&(P.statsFeatures=N),re(P)}return null}function Qi(t,e){return Ii(t,{query:{f:"json"},signal:e==null?void 0:e.signal})}function zi({relatedInfos:t,layer:e},i){const s={};return t.forEach((r,n)=>{const{relation:a}=r;if(!a){const m=new st("relation-required","A relation is required on a layer to retrieve related records.");throw pt().error(m),m}const{relatedTableId:d}=a;if(typeof d!="number"){const m=new st("A related table ID is required on a layer to retrieve related records.");throw pt().error(m),m}const c=`${e.url}/${d}`,p=ht.get(c),u=p??Qi(c);p||ht.set(c,u),s[n]=u}),ei(re(s),i)}function Xi({graphic:t,relatedInfos:e,layer:i},s){const r={};return e.forEach((n,a)=>{n.layerInfo&&(r[a]=Bi(t,n,i,s))}),re(r)}function Gi({relatedInfo:t,fieldName:e,fieldInfo:i}){var s,r;if((s=t.relatedFields)==null||s.push(e),i.statisticType){const n=new Mi({statisticType:i.statisticType,onStatisticField:e,outStatisticFieldName:e});(r=t.outStatistics)==null||r.push(n)}}function Yi(t,e){if(t!=null){e=e.toLowerCase();for(const i of t)if(i&&i.name.toLowerCase()===e)return i}return null}const mt={chartAnimation:!0};let R=class extends oe{constructor(e){super(e),this.abilities={...mt},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...mt,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:i}=this,s=(e+i)%i;this.activeMediaInfoIndex=s}_pageContentElementMedia(e){const{activeMediaInfoIndex:i}=this,s=i+e;this._setContentElementMedia(s)}_formatMediaInfos(){const{mediaInfos:e,layer:i}=this,s=this.attributes??{},r=this.formattedAttributes??{},n=this.expressionAttributes??{},a=this.fieldInfoMap??new Map;return(e==null?void 0:e.map(d=>{const c=d==null?void 0:d.clone();return c?(c.title=ie({attributes:s,fieldInfoMap:a,globalAttributes:r,expressionAttributes:n,layer:i,text:c.title}),c.caption=ie({attributes:s,fieldInfoMap:a,globalAttributes:r,expressionAttributes:n,layer:i,text:c.caption}),c.altText=ie({attributes:s,fieldInfoMap:a,globalAttributes:r,expressionAttributes:n,layer:i,text:c.altText}),c.type==="image"?c.value?(this._setImageValue({value:c.value,formattedAttributes:r,layer:i}),c.value.sourceURL?c:void 0):void 0:c.type==="pie-chart"||c.type==="line-chart"||c.type==="column-chart"||c.type==="bar-chart"?c.value?(this._setChartValue({value:c.value,chartType:c.type,attributes:s,formattedAttributes:r,layer:i,expressionAttributes:n}),c):void 0:null):null}).filter(Ft))??[]}_setImageValue(e){const i=this.fieldInfoMap??new Map,{value:s,formattedAttributes:r,layer:n}=e,{linkURL:a,sourceURL:d}=s;if(d){const c=nt(d,n);s.sourceURL=at({formattedAttributes:r,template:c,fieldInfoMap:i})}if(a){const c=nt(a,n);s.linkURL=at({formattedAttributes:r,template:c,fieldInfoMap:i})}}_setChartValue(e){const{value:i,attributes:s,formattedAttributes:r,chartType:n,layer:a,expressionAttributes:d}=e,{popupTemplate:c,relatedInfos:p}=this,{fields:u,normalizeField:m}=i,f=a;if(i.fields=ii(u,f),m&&(i.normalizeField=lt(m,f)),!u.some(y=>!!(r[y]!=null||te(y)&&(p!=null&&p.size))))return;const _=(c==null?void 0:c.fieldInfos)??[];u.forEach((y,v)=>{var g;const w=(g=i.colors)==null?void 0:g[v];if(te(y))return void(i.series=[...i.series,...this._getRelatedChartInfos({fieldInfos:_,fieldName:y,formattedAttributes:r,chartType:n,value:i,color:w})]);const I=this._getChartOption({value:i,attributes:s,chartType:n,formattedAttributes:r,expressionAttributes:d,fieldName:y,fieldInfos:_,color:w});i.series.push(I)})}_getRelatedChartInfos(e){var y;const{fieldInfos:i,fieldName:s,formattedAttributes:r,chartType:n,value:a,color:d}=e,c=[],p=Te(s),u=p&&((y=this.relatedInfos)==null?void 0:y.get(p.layerId.toString()));if(!u)return c;const{relatedFeatures:m,relation:f}=u;if(!f||!m)return c;const{cardinality:_}=f;return m.forEach(v=>{const{attributes:w}=v;w&&Object.keys(w).forEach(I=>{I===p.fieldName&&c.push(this._getChartOption({value:a,attributes:w,formattedAttributes:r,fieldName:s,chartType:n,relatedFieldName:I,hasMultipleRelatedFeatures:(m==null?void 0:m.length)>1,fieldInfos:i,color:d}))})}),_==="one-to-many"||_==="many-to-many"?c:[c[0]]}_getTooltip({label:e,value:i,chartType:s}){return s==="pie-chart"?`${e}`:`${e}: ${i}`}_getChartOption(e){var D;const{value:i,attributes:s,formattedAttributes:r,expressionAttributes:n,fieldName:a,relatedFieldName:d,fieldInfos:c,chartType:p,hasMultipleRelatedFeatures:u,color:m}=e,f=this.layer,_=this.fieldInfoMap??new Map,{normalizeField:y,tooltipField:v}=i,w=y?te(y)?s[Te(y).fieldName]:s[y]:null,I=Rt(a)&&n&&n[a]!==void 0?n[a]:d&&s[d]!==void 0?s[d]:s[a]!==void 0?s[a]:r[a],g=new fi({fieldName:a,color:m,value:I===void 0?null:I&&w?I/w:I});if(te(a)){const B=_.get(a.toLowerCase()),me=v&&_.get(v.toLowerCase()),je=(B==null?void 0:B.fieldName)??a,fe=u&&v?Te(v).fieldName:(me==null?void 0:me.fieldName)??v,zt=u&&fe?s[fe]:r[fe]??(B==null?void 0:B.label)??(B==null?void 0:B.fieldName)??d,Xt=u&&d?s[d]:r[je];return g.tooltip=this._getTooltip({label:zt,value:Xt,chartType:p}),g}const C=si(c,a),E=lt(a,f),N=v&&r[v]!==void 0?r[v]:Lt(C||new Vt({fieldName:E}),(D=this.popupTemplate)==null?void 0:D.expressionInfos),P=r[E];return g.tooltip=this._getTooltip({label:N,value:P,chartType:p}),g}};o([l()],R.prototype,"abilities",void 0),o([Se("abilities")],R.prototype,"castAbilities",null),o([l()],R.prototype,"activeMediaInfoIndex",void 0),o([l({readOnly:!0})],R.prototype,"activeMediaInfo",null),o([l()],R.prototype,"attributes",void 0),o([l()],R.prototype,"description",void 0),o([l()],R.prototype,"fieldInfoMap",void 0),o([l()],R.prototype,"formattedAttributes",void 0),o([l()],R.prototype,"expressionAttributes",void 0),o([l({readOnly:!0})],R.prototype,"formattedMediaInfos",null),o([l()],R.prototype,"isAggregate",void 0),o([l()],R.prototype,"layer",void 0),o([l({readOnly:!0})],R.prototype,"formattedMediaInfoCount",null),o([l()],R.prototype,"mediaInfos",void 0),o([l()],R.prototype,"popupTemplate",void 0),o([l()],R.prototype,"relatedInfos",void 0),o([l()],R.prototype,"title",void 0),R=o([V("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],R);const se=R,L="esri-feature-media",j={base:L,mediaContainer:`${L}__container`,mediaItemContainer:`${L}__item-container`,mediaItem:`${L}__item`,mediaItemText:`${L}__item-text`,mediaItemTitle:`${L}__item-title`,mediaItemCaption:`${L}__item-caption`,mediaNavigation:`${L}__item-navigation`,mediaPagination:`${L}__pagination`,mediaPaginationText:`${L}__pagination-text`,mediaPrevious:`${L}__previous`,mediaPreviousIconLTR:`${L}__previous-icon`,mediaPreviousIconRTL:`${L}__previous-icon--rtl`,mediaNext:`${L}__next`,mediaNextIconLTR:`${L}__next-icon`,mediaNextIconRTL:`${L}__next-icon--rtl`,mediaChart:`${L}__chart`,mediaPaginationButton:`${L}__pagination-button`,mediaPaginationIcon:`${L}__pagination-icon`,mediaChartRendered:`${L}__chart--rendered`},Xe=15,Z="category",_e="value",Zi="rgba(50, 50, 50, 1)",Ji=250,Ki=500,es=200;let W=class extends G{constructor(t,e){super(t,e),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new se,this.messages=null,this._disposeChart=i=>{var s;(s=this._chartRootMap.get(i))==null||s.dispose(),this._chartRootMap.delete(i)},this._createChart=async i=>{const{destroyed:s,viewModel:r}=this;if(s||!r||!i)return;const{createRoot:n}=await b(()=>import("./chartUtilsAm5-SdAMhygp.js").then(d=>d.c),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url),a=await n(i);this._chartRootMap.set(i,a),this._renderChart({mediaInfo:r.activeMediaInfo,root:a})}}initialize(){this._featureElementInfo=new Me,this.addHandles([k(()=>{var t,e;return[(t=this.viewModel)==null?void 0:t.activeMediaInfo,(e=this.viewModel)==null?void 0:e.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),q),k(()=>{var t,e;return[(t=this.viewModel)==null?void 0:t.description,(e=this.viewModel)==null?void 0:e.title]},()=>this._setupFeatureElementInfo(),q)])}loadDependencies(){return pe({icon:()=>b(()=>import("./calcite-icon-Cu0W9dtm.js"),__vite__mapDeps([15,16,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,27,28]),import.meta.url)})}destroy(){var t;this._clearMediaRefreshTimer(),(t=this._featureElementInfo)==null||t.destroy()}get attributes(){return this.viewModel.attributes}set attributes(t){this.viewModel.attributes=t}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(t){this.viewModel.activeMediaInfoIndex=t}get description(){return this.viewModel.description}set description(t){this.viewModel.description=t}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(t){this.viewModel.fieldInfoMap=t}get layer(){return this.viewModel.layer}set layer(t){this.viewModel.layer=t}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(t){this.viewModel.mediaInfos=t}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(t){this.viewModel.popupTemplate=t}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(t){this.viewModel.relatedInfos=t}get title(){return this.viewModel.title}set title(t){this.viewModel.title=t}render(){var t;return h("div",{bind:this,class:j.base,onkeyup:this._handleMediaKeyup},(t=this._featureElementInfo)==null?void 0:t.render(),this._renderMedia())}_renderMedia(){const{formattedMediaInfoCount:t,activeMediaInfoIndex:e}=this.viewModel,i=this._renderMediaText();return t?h("div",{class:j.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),h("div",{class:j.mediaNavigation},i,t>1?h("div",{class:j.mediaPagination},this._renderMediaPageButton("previous"),h("span",{class:j.mediaPaginationText},Oe(this.messages.pageText,{index:e+1,total:t})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){const{activeMediaInfo:t}=this.viewModel;if(!t)return null;const e=t&&t.title?h("div",{class:j.mediaItemTitle,innerHTML:t.title,key:"media-title"}):null,i=t&&t.caption?h("div",{class:j.mediaItemCaption,innerHTML:t.caption,key:"media-caption"}):null;return e||i?h("div",{class:j.mediaItemText,key:"media-text"},e,i):null}_renderImageMediaInfo(t){if(!t.value)return null;const{_refreshIntervalInfo:e}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:s}=this.viewModel,{value:r,refreshInterval:n,altText:a,title:d,type:c}=t,{sourceURL:p,linkURL:u}=r,m=xt(u??void 0)?"_blank":"_self",f=m==="_blank"?"noreferrer":"",_=n?e:null,y=_?_.timestamp:0,v=_?_.sourceURL:p,w=h("img",{alt:a||d,key:`media-${c}-${i}-${s}-${y}`,src:v??void 0});return(u?h("a",{href:u,rel:f,target:m,title:d},w):null)??w}_renderChartMediaInfo(t){const{activeMediaInfoIndex:e,formattedMediaInfoCount:i}=this.viewModel;return h("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:j.mediaChart,key:`media-${t.type}-${e}-${i}`})}_renderMediaInfoType(){const{activeMediaInfo:t}=this.viewModel;return t?t.type==="image"?this._renderImageMediaInfo(t):t.type.includes("chart")?this._renderChartMediaInfo(t):null:null}_renderMediaInfo(){const{activeMediaInfo:t}=this.viewModel;return t?h("div",{class:j.mediaItemContainer,key:"media-container"},h("div",{class:j.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(t){if(this.viewModel.formattedMediaInfoCount<2)return null;const e=t==="previous",i=e?this.messages.previous:this.messages.next,s=e?"chevron-left":"chevron-right",r=e?"media-previous":"media-next",n=e?this._previous:this._next;return h("button",{"aria-label":i,bind:this,class:j.mediaPaginationButton,key:r,onclick:n,tabIndex:0,title:i,type:"button"},h("calcite-icon",{class:j.mediaPaginationIcon,icon:s,scale:"s"}))}_setupFeatureElementInfo(){var i;const{description:t,title:e}=this;(i=this._featureElementInfo)==null||i.set({description:t,title:e})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;const{isAggregate:t,layer:e}=this.viewModel;return t&&(e!=null&&e.featureReduction)&&"renderer"in e.featureReduction?e.featureReduction.renderer:e==null?void 0:e.renderer}async _getSeriesColors(t){const{colorAm5:e}=await b(()=>import("./chartCommon-DHdwUBXF.js"),__vite__mapDeps([29,12,11,30,31,13,32]),import.meta.url),i=new Map;return t.forEach(s=>{s.color&&i.set(s,e(s.color.toCss(!0)))}),i}async _getRendererColors(){const{colorAm5:t}=await b(()=>import("./chartCommon-DHdwUBXF.js"),__vite__mapDeps([29,12,11,30,31,13,32]),import.meta.url),e=new Map,i=this._getRenderer(),s="default";if(!i)return e;const r=await bi(i);return r.delete(s),Array.from(r.values()).every(n=>(n==null?void 0:n.length)===1)&&Array.from(r.keys()).forEach(n=>{var d,c;const a=(c=(d=r.get(n))==null?void 0:d[0])==null?void 0:c.toCss(!0);a&&e.set(n,t(a))}),e}_handleMediaKeyup(t){const{key:e}=t;e==="ArrowLeft"&&(t.stopPropagation(),this.viewModel.previous()),e==="ArrowRight"&&(t.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!wi()}_getChartAnimationMS(){return this._canAnimateChart()?Ji:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?Ki:0}async _renderChart(t){const{root:e,mediaInfo:i}=t,{value:s,type:r}=i,{ResponsiveThemeAm5:n,DarkThemeAm5:a,AnimatedThemeAm5:d,ColorSetAm5:c,ThemeAm5:p,esriChartColorSet:u}=await b(async()=>{const{ResponsiveThemeAm5:C,DarkThemeAm5:E,AnimatedThemeAm5:N,ColorSetAm5:P,ThemeAm5:D,esriChartColorSet:B}=await import("./chartCommon-DHdwUBXF.js");return{ResponsiveThemeAm5:C,DarkThemeAm5:E,AnimatedThemeAm5:N,ColorSetAm5:P,ThemeAm5:D,esriChartColorSet:B}},__vite__mapDeps([29,12,11,30,31,13,32]),import.meta.url),m=p.new(e);m.rule("ColorSet").set("colors",u),m.rule("ColorSet").set("reuse",!0);const f=[n.new(e),m];Fi()&&f.push(a.new(e)),this._canAnimateChart()&&f.push(d.new(e)),e.setThemes(f);const _=await this._getRendererColors(),y=await this._getSeriesColors(s.series),v=c.new(e,{}),w=y.get(s.series[0]),I=w?{lineSettings:{stroke:w}}:void 0,g=s.series.map((C,E)=>{const N=y.get(C)||_.get(C.fieldName)||v.getIndex(E);return{[Z]:C.tooltip,[_e]:C.value,columnSettings:{fill:N,stroke:N},...I}}).filter(C=>r!=="pie-chart"||C.value!=null&&C.value>0);r==="pie-chart"?this._createPieChart(t,g):this._createXYChart(t,g)}_getDirection(){return ve(this.container)?"rtl":"ltr"}async _customizeChartTooltip(t,e="horizontal"){var s;const{colorAm5:i}=await b(()=>import("./chartCommon-DHdwUBXF.js"),__vite__mapDeps([29,12,11,30,31,13,32]),import.meta.url);t.setAll({pointerOrientation:e}),(s=t.get("background"))==null||s.setAll({stroke:i(Zi)}),t.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:es})}async _createPieChart(t,e){const{TooltipAm5:i}=await b(()=>import("./chartCommon-DHdwUBXF.js"),__vite__mapDeps([29,12,11,30,31,13,32]),import.meta.url),{PieChartAm5:s,PieSeriesAm5:r}=await b(async()=>{const{PieChartAm5:y,PieSeriesAm5:v}=await import("./pieChart-B9-E6EvA.js");return{PieChartAm5:y,PieSeriesAm5:v}},__vite__mapDeps([33,11,34,12,32,14]),import.meta.url),{mediaInfo:n,root:a}=t,{title:d}=n,c=5,p=(n==null?void 0:n.altText)||(n==null?void 0:n.title)||"",u=a.container.children.push(s.new(a,{ariaLabel:p,focusable:!0,paddingBottom:c,paddingTop:c,paddingLeft:c,paddingRight:c})),m=`{category}: {valuePercentTotal.formatNumber('0.00')}%
 ({value})`,f=i.new(a,{labelText:m}),_=u.series.push(r.new(a,{name:d,valueField:_e,categoryField:Z,tooltip:f}));_.ticks.template.set("forceHidden",!0),_.labels.template.set("forceHidden",!0),_.slices.template.states.create("active",{shiftRadius:c}),this._customizeChartTooltip(f),_.slices.template.setAll({ariaLabel:m,focusable:!0,templateField:"columnSettings"}),_.data.setAll(e),_.appear(this._getChartSeriesAnimationMS()),u.appear(this._getChartAnimationMS()),u.root.dom.classList.toggle(j.mediaChartRendered,!0)}_getMinSeriesValue(t){let e=0;return t.forEach(i=>e=Math.min(i.value,e)),e}async _createColumnChart(t,e,i){const{TooltipAm5:s,ScrollbarAm5:r}=await b(()=>import("./chartCommon-DHdwUBXF.js"),__vite__mapDeps([29,12,11,30,31,13,32]),import.meta.url),{CategoryAxisAm5:n,AxisRendererXAm5:a,ValueAxisAm5:d,AxisRendererYAm5:c,ColumnSeriesAm5:p}=await b(async()=>{const{CategoryAxisAm5:C,AxisRendererXAm5:E,ValueAxisAm5:N,AxisRendererYAm5:P,ColumnSeriesAm5:D}=await import("./xyChart-DQWUP916.js");return{CategoryAxisAm5:C,AxisRendererXAm5:E,ValueAxisAm5:N,AxisRendererYAm5:P,ColumnSeriesAm5:D}},__vite__mapDeps([35,36,12,11,32,14,34,31]),import.meta.url),{mediaInfo:u,root:m}=e,{value:f,title:_}=u;t.setAll({wheelX:"panX",wheelY:"zoomX"});const y=t.xAxes.push(n.new(m,{renderer:a.new(m,{inversed:ve(this.container)}),categoryField:Z}));y.get("renderer").labels.template.setAll({forceHidden:!0});const v=t.yAxes.push(d.new(m,{renderer:c.new(m,{inside:!1}),min:this._getMinSeriesValue(f.series)}));v.get("renderer").labels.template.setAll({direction:this._getDirection()});const w="{categoryX}",I=s.new(m,{labelText:w}),g=t.series.push(p.new(m,{name:_,xAxis:y,yAxis:v,valueYField:_e,categoryXField:Z,tooltip:I}));this._customizeChartTooltip(I),g.columns.template.setAll({ariaLabel:w,focusable:!0,templateField:"columnSettings"}),f.series.length>Xe&&t.set("scrollbarX",r.new(m,{orientation:"horizontal"})),y.data.setAll(i),g.data.setAll(i),g.appear(this._getChartSeriesAnimationMS()),t.appear(this._getChartAnimationMS())}async _createBarChart(t,e,i){const{TooltipAm5:s,ScrollbarAm5:r}=await b(()=>import("./chartCommon-DHdwUBXF.js"),__vite__mapDeps([29,12,11,30,31,13,32]),import.meta.url),{CategoryAxisAm5:n,AxisRendererXAm5:a,ValueAxisAm5:d,AxisRendererYAm5:c,ColumnSeriesAm5:p}=await b(async()=>{const{CategoryAxisAm5:C,AxisRendererXAm5:E,ValueAxisAm5:N,AxisRendererYAm5:P,ColumnSeriesAm5:D}=await import("./xyChart-DQWUP916.js");return{CategoryAxisAm5:C,AxisRendererXAm5:E,ValueAxisAm5:N,AxisRendererYAm5:P,ColumnSeriesAm5:D}},__vite__mapDeps([35,36,12,11,32,14,34,31]),import.meta.url),{mediaInfo:u,root:m}=e,{value:f,title:_}=u;t.setAll({wheelX:"panY",wheelY:"zoomY"});const y=t.yAxes.push(n.new(m,{renderer:c.new(m,{inversed:!0}),categoryField:Z}));y.get("renderer").labels.template.setAll({forceHidden:!0});const v=t.xAxes.push(d.new(m,{renderer:a.new(m,{inside:!1,inversed:ve(this.container)}),min:this._getMinSeriesValue(f.series)}));v.get("renderer").labels.template.setAll({direction:this._getDirection()});const w="{categoryY}",I=s.new(m,{labelText:w}),g=t.series.push(p.new(m,{name:_,xAxis:v,yAxis:y,valueXField:_e,categoryYField:Z,tooltip:I}));this._customizeChartTooltip(I,"vertical"),g.columns.template.setAll({ariaLabel:w,focusable:!0,templateField:"columnSettings"}),f.series.length>Xe&&t.set("scrollbarY",r.new(m,{orientation:"vertical"})),y.data.setAll(i),g.data.setAll(i),g.appear(this._getChartSeriesAnimationMS()),t.appear(this._getChartAnimationMS())}async _createLineChart(t,e,i){var E,N,P;const{TooltipAm5:s,ScrollbarAm5:r}=await b(()=>import("./chartCommon-DHdwUBXF.js"),__vite__mapDeps([29,12,11,30,31,13,32]),import.meta.url),{CategoryAxisAm5:n,AxisRendererXAm5:a,ValueAxisAm5:d,AxisRendererYAm5:c,LineSeriesAm5:p}=await b(async()=>{const{CategoryAxisAm5:D,AxisRendererXAm5:B,ValueAxisAm5:me,AxisRendererYAm5:je,LineSeriesAm5:fe}=await import("./xyChart-DQWUP916.js");return{CategoryAxisAm5:D,AxisRendererXAm5:B,ValueAxisAm5:me,AxisRendererYAm5:je,LineSeriesAm5:fe}},__vite__mapDeps([35,36,12,11,32,14,34,31]),import.meta.url),{root:u,mediaInfo:m}=e,{value:f,title:_}=m;t.setAll({wheelX:"panX",wheelY:"zoomX"});const y=t.xAxes.push(n.new(u,{renderer:a.new(u,{inversed:ve(this.container)}),categoryField:Z}));y.get("renderer").labels.template.setAll({forceHidden:!0});const v=t.yAxes.push(d.new(u,{renderer:c.new(u,{inside:!1}),min:this._getMinSeriesValue(f.series)}));v.get("renderer").labels.template.setAll({direction:this._getDirection()});const w="{categoryX}",I=(N=(E=i[0])==null?void 0:E.lineSettings)==null?void 0:N.stroke,g=s.new(u,{getFillFromSprite:!I,labelText:w});I&&((P=g.get("background"))==null||P.setAll({fill:I}));const C=t.series.push(p.new(u,{name:_,xAxis:y,yAxis:v,valueYField:_e,categoryXField:Z,tooltip:g}));C.strokes.template.setAll({templateField:"lineSettings"}),this._customizeChartTooltip(g,"vertical"),f.series.length>Xe&&t.set("scrollbarX",r.new(u,{orientation:"horizontal"})),y.data.setAll(i),C.data.setAll(i),C.appear(this._getChartSeriesAnimationMS()),t.appear(this._getChartAnimationMS())}async _createXYChart(t,e){const{XYChartAm5:i,XYCursorAm5:s}=await b(()=>import("./xyChart-DQWUP916.js"),__vite__mapDeps([35,36,12,11,32,14,34,31]),import.meta.url),{root:r,mediaInfo:n}=t,{type:a}=n,d=(n==null?void 0:n.altText)||(n==null?void 0:n.title)||"",c=r.container.children.push(i.new(r,{ariaLabel:d,focusable:!0,panX:!0,panY:!0}));c.set("cursor",s.new(r,{})),a==="column-chart"&&await this._createColumnChart(c,t,e),a==="bar-chart"&&await this._createBarChart(c,t,e),a==="line-chart"&&await this._createLineChart(c,t,e),c.root.dom.classList.toggle(j.mediaChartRendered,!0)}_clearMediaRefreshTimer(){const{_refreshTimer:t}=this;t&&(clearTimeout(t),this._refreshTimer=null)}_updateMediaInfoTimestamp(t){const e=Date.now();this._refreshIntervalInfo={timestamp:e,sourceURL:t&&this._getImageSource(t,e)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:t}=this.viewModel;(t==null?void 0:t.type)==="image"&&(t==null?void 0:t.refreshInterval)>0&&this._setRefreshTimeout(t)}_setRefreshTimeout(t){const{refreshInterval:e,value:i}=t,s=6e4*e;this._updateMediaInfoTimestamp(i.sourceURL);const r=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},s);this._refreshTimer=r}_getImageSource(t,e){const i=t.includes("?")?"&":"?",[s,r=""]=t.split("#");return`${s}${i}timestamp=${e}${r?"#":""}${r}`}};o([l()],W.prototype,"_refreshIntervalInfo",void 0),o([l()],W.prototype,"attributes",null),o([l()],W.prototype,"activeMediaInfoIndex",null),o([l()],W.prototype,"description",null),o([l()],W.prototype,"fieldInfoMap",null),o([l()],W.prototype,"layer",null),o([l()],W.prototype,"mediaInfos",null),o([l()],W.prototype,"popupTemplate",null),o([l()],W.prototype,"relatedInfos",null),o([l()],W.prototype,"title",null),o([l({type:se})],W.prototype,"viewModel",void 0),o([l(),z("esri/widgets/Feature/t9n/Feature")],W.prototype,"messages",void 0),W=o([V("esri.widgets.Feature.FeatureMedia")],W);const Wt=W,ts="esri.widgets.Feature.support.arcadeFeatureUtils",ft=()=>Ze.getLogger(ts);function is(t){return typeof t=="string"?Je(Ke(t)):Array.isArray(t)?ss(t):(t==null?void 0:t.declaredClass)==="esri.arcade.Dictionary"?rs(t):t}function ss(t){return`<ul class="esri-widget__list">${t.map(e=>`<li>${typeof e=="string"?Je(Ke(e)):e}</li>`).join("")}</ul>`}function rs(t){const e=t.keys().map(i=>{const s=t.field(i);return`<tr><th>${i}</th><td>${typeof s=="string"?Je(Ke(s)):s}</td></tr>`}).join("");return`<table class="${he.table}">${e}</table>`}function Ht(){return b(()=>import("./arcade-G0NwyxZJ.js"),__vite__mapDeps([37,38,11,39,4,40,41,7,26,42,8,9,10,3,43,44,45,46,22,18,23,24,47,1,2,5,6,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,19,20,21,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,25,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170]),import.meta.url)}function os(t){return"createQuery"in t&&"queryFeatures"in t}async function ns({graphic:t,view:e,options:i}){const{isAggregate:s,layer:r}=t;if(!s||!r||(e==null?void 0:e.type)!=="2d")return[];const n=await e.whenLayerView(r);if(!os(n))return[];const a=n.createQuery(),d=t.getObjectId();a.aggregateIds=d!=null?[d]:[];const{features:c}=await n.queryFeatures(a,i);return c}function as({layer:t,aggregatedFeatures:e,interceptor:i}){const{fields:s,objectIdField:r,geometryType:n,spatialReference:a,displayField:d}=t;return new St({fields:s,objectIdField:r,geometryType:n,spatialReference:a,displayField:d,interceptor:i,...t.type==="feature"?{templates:t.templates,typeIdField:t.typeIdField,types:t.types}:null,source:e})}async function Ut({expressionInfo:t,arcade:e,interceptor:i,spatialReference:s,map:r,graphic:n,location:a,view:d,options:c}){var C;if(!(t!=null&&t.expression))return null;const{isAggregate:p}=n,u=(n.sourceLayer||n.layer)??void 0,m=p?"feature-reduction-popup":"popup",f=e.createArcadeProfile(m),_=e.createArcadeExecutor(t.expression,f).catch(E=>ft().error("arcade-executor-error",{error:E,expressionInfo:t})),[y,v]=await Promise.all([ns({graphic:n,view:d,options:c}),_]);if(!v)return null;const w=m==="feature-reduction-popup"?as({layer:u,aggregatedFeatures:y,interceptor:i}):void 0,I={...m==="feature-reduction-popup"?{$aggregatedFeatures:w}:{$datastore:u==null?void 0:u.url,$layer:u!=null&&$i(u)?u:(u==null?void 0:u.type)==="scene"&&u.associatedLayer!=null?u.associatedLayer:void 0,$map:r,$userInput:a,$graph:(u==null?void 0:u.type)==="knowledge-graph-sublayer"?(C=u==null?void 0:u.parentCompositeLayer)==null?void 0:C.knowledgeGraph:void 0},$feature:n},g={abortSignal:(c==null?void 0:c.signal)??void 0,interceptor:i??void 0,rawOutput:!0,spatialReference:s??void 0,timeZone:d==null?void 0:d.timeZone};return await v.executeAsync(I,g).catch(E=>ft().error("arcade-execution-error",{error:E,graphic:n,expressionInfo:t})).finally(()=>w==null?void 0:w.destroy())}async function ls({expressionInfos:t,spatialReference:e,graphic:i,interceptor:s,map:r,view:n,location:a,options:d}){if(!(t!=null&&t.length))return{};const c=await Ht(),p={};for(const f of t)p[`expression/${f.name}`]=Ut({expressionInfo:f,arcade:c,interceptor:s,spatialReference:e,map:r,graphic:i,location:a,view:n,options:d});const u=await re(p),m={};for(const f in u)m[f]=is(u[f].value);return m}const ds=1;let H=class extends oe{constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._cancelQuery=()=>{const{_abortController:i}=this;i&&i.abort(),this._abortController=null},this._createVM=()=>{var r,n;const i=(r=this.contentElement)==null?void 0:r.type;(n=this.contentElementViewModel)==null||n.destroy();const s=i==="fields"?new De:i==="media"?new se:i==="text"?new Ne:null;this._set("contentElementViewModel",s)},this._compile=async()=>{this._cancelQuery();const i=new AbortController;this._abortController=i,await this._compileExpression(),this._abortController===i&&(this._abortController=null)},this._compileThrottled=Ot(this._compile,ds,this),this._compileExpression=async()=>{const{expressionInfo:i,graphic:s,interceptor:r,spatialReference:n,map:a,location:d,view:c,_abortController:p}=this;if(!i||!s)return void this._set("contentElement",null);const u=await Ht();if(p!==this._abortController)return;const m=await Ut({arcade:u,expressionInfo:i,graphic:s,location:d,interceptor:r,map:a,spatialReference:n,view:c});if(!m||m.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const f=await m.castAsJsonAsync(p==null?void 0:p.signal),_=f==null?void 0:f.type,y=_==="media"?yi.fromJSON(f):_==="text"?Nt.fromJSON(f):_==="fields"?gi.fromJSON(f):null;y.type==="media"&&!y.mediaInfos||y.type==="fields"&&!y.fieldInfos||y.type==="text"&&!y.text?this._set("contentElement",null):this._set("contentElement",y)},this.addHandles([k(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),q),k(()=>[this.contentElement],()=>this._createVM(),q)])}initialize(){this.addHandles(this._compileThrottled)}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)??null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{_abortController:e,contentElement:i,contentElementViewModel:s}=this;return e?"loading":i||s?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)??null}set map(e){this._override("map",e)}};o([l()],H.prototype,"_abortController",void 0),o([l({type:_i})],H.prototype,"expressionInfo",void 0),o([l({type:Pe})],H.prototype,"graphic",void 0),o([l({readOnly:!0})],H.prototype,"contentElement",void 0),o([l({readOnly:!0})],H.prototype,"contentElementViewModel",void 0),o([l()],H.prototype,"interceptor",void 0),o([l({type:Pt})],H.prototype,"location",void 0),o([l()],H.prototype,"spatialReference",null),o([l({readOnly:!0})],H.prototype,"state",null),o([l()],H.prototype,"map",null),o([l()],H.prototype,"view",void 0),H=o([V("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],H);const it=H,_t="esri-feature",yt={base:`${_t}-expression`,loadingSpinnerContainer:`${_t}__loading-container`};let xe=class extends G{constructor(e,i){super(e,i),this._contentWidget=null,this.viewModel=new it}initialize(){this.addHandles(k(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),q))}loadDependencies(){return pe({loader:()=>b(()=>import("./calcite-loader-DP4PIFO8.js"),__vite__mapDeps([171,172,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,27,173,174,28]),import.meta.url)})}destroy(){this._destroyContentWidget()}render(){var i;const{state:e}=this.viewModel;return h("div",{class:yt.base},e==="loading"?this._renderLoading():e==="disabled"?null:(i=this._contentWidget)==null?void 0:i.render())}_renderLoading(){return h("div",{class:yt.loadingSpinnerContainer,key:"loading-container"},h("calcite-loader",{inline:!0,label:""}))}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:i}=this.viewModel,s=i==null?void 0:i.type;this._destroyContentWidget();const r=e?s==="fields"?new jt({viewModel:e}):s==="media"?new Wt({viewModel:e}):s==="text"?new Ee({viewModel:e}):null:null;this._contentWidget=r,this.scheduleRender()}};o([l({type:it})],xe.prototype,"viewModel",void 0),xe=o([V("esri.widgets.Feature.FeatureExpression")],xe);const cs=xe;var Ge;const Le="esri-feature",ye=`${Le}-relationship`,J={base:ye,listContainer:`${ye}__list`,listItem:`${ye}__list-item`,listItemHidden:`${ye}__list-item--hidden`,listContainerQuerying:`${ye}__list--querying`,featureObserver:`${Le}__feature-observer`,stickySpinnerContainer:`${Le}__sticky-loading-container`,loadingSpinnerContainer:`${Le}__loading-container`},gt={title:!0,description:!0};let O=Ge=class extends G{constructor(t,e){super(t,e),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([i])=>{i!=null&&i.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.flowItems=null,this.flowType="feature-relationship",this.headingLevel=2,this.viewModel=new et,this.messages=null,this.messagesCommon=null,this.visibleElements={...gt},this._increaseFeaturePage=()=>{const{state:i,showAllEnabled:s,relatedFeatures:r,featuresPerPage:n,featurePage:a}=this.viewModel;i==="ready"&&s&&r.length>=n*a&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new Me,this.addHandles([k(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),q),k(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),Mt(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return pe({icon:()=>b(()=>import("./calcite-icon-Cu0W9dtm.js"),__vite__mapDeps([15,16,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,27,28]),import.meta.url),list:()=>b(()=>import("./calcite-list-C4jOVpC-.js"),__vite__mapDeps([175,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,27,176,28,177,178,179,180,173,174,181,182,16,183,184,185,186,187,188,189,190,172,191]),import.meta.url),"list-item":()=>b(()=>import("./calcite-list-item-vbKS6alm.js"),__vite__mapDeps([192,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,27,176,173,174,28,180,179,178,177,193,186,16,172,194]),import.meta.url),loader:()=>b(()=>import("./calcite-loader-DP4PIFO8.js"),__vite__mapDeps([171,172,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,27,173,174,28]),import.meta.url),notice:()=>b(()=>import("./calcite-notice-DSp0z_Oh.js"),__vite__mapDeps([195,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,196,28,27,179,173,174,180,197,198,186,16]),import.meta.url)})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=Et(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:t,featureCount:e,displayCount:i,state:s}=this.viewModel;return!t&&!!e&&s==="ready"&&(e>i||i===0)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(t){this.viewModel.description=t}get featureCountDescription(){const{messages:t}=this,{featureCount:e}=this.viewModel;return Oe(t==null?void 0:t.numberRecords,{number:e})}get title(){return this.viewModel.title}set title(t){this.viewModel.title=t}castVisibleElements(t){return{...gt,...t}}render(){var e;const{state:t}=this.viewModel;return h("div",{class:this.classes(J.base,he.widget)},(e=this._featureElementInfo)==null?void 0:e.render(),t==="loading"?this._renderLoading():t==="disabled"?this._renderRelationshipNotFound():this._renderRelatedFeatures())}async _selectRecord(t){const{flowItems:e,featureVisibleElements:i}=this;if(!e)return;t.abilities={relationshipContent:!0};const{default:s}=await b(()=>Promise.resolve().then(()=>Qt),void 0,import.meta.url);e.push(new s({flowItems:e,flowType:this.flowType,viewModel:t,visibleElements:i}))}_showAllRecords(){const{flowItems:t}=this;if(!t)return;const{viewModel:e,featureVisibleElements:i}=this;e.showAllEnabled=!0;const s=new Ge({flowItems:t,featureVisibleElements:i,visibleElements:{title:!1,description:!1},viewModel:e});t.push(s)}_renderStickyLoading(){return this.viewModel.state==="querying"?h("div",{class:J.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return h("calcite-loader",{inline:!0,label:""})}_renderLoading(){return h("div",{class:J.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return h("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){const t=ve(this.container)?"chevron-left":"chevron-right";return h("calcite-icon",{icon:t,scale:"s",slot:"content-end"})}_renderRelatedFeature(t){var r;const{itemDescriptionFieldName:e}=this.viewModel,i=t.title;t.description=e&&((r=t.formattedAttributes)==null?void 0:r.global[e]);const s=t.state==="loading";return h("calcite-list-item",{class:this.classes(J.listItem,{[J.listItemHidden]:s}),description:t.description??"",key:t.uid,label:i,onCalciteListItemSelect:()=>this._selectRecord(t)},this._renderChevronIconNode())}_renderShowAllListItem(){var t;return this.displayShowAllButton?h("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:(t=this.messages)==null?void 0:t.showAll,onCalciteListItemSelect:()=>this._showAllRecords()},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){var t;return h("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},h("div",{slot:"message"},(t=this.messages)==null?void 0:t.noRelatedFeatures))}_renderFeatureObserver(){return h("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:J.featureObserver,key:"feature-observer"})}_renderList(){const{relatedFeatureViewModels:t}=this.viewModel;return h("calcite-list",null,t.toArray().map(e=>this._renderRelatedFeature(e)),this._renderShowAllListItem())}_renderRelatedFeatures(){const{displayListItems:t}=this,{state:e}=this.viewModel;return h("div",{class:this.classes(J.listContainer,{[J.listContainerQuerying]:e==="querying"}),key:"list-container"},t?this._renderList():e==="ready"?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){var t;return h("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},h("div",{slot:"message"},(t=this.messages)==null?void 0:t.relationshipNotFound))}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:t}=this.viewModel,e="related-feature-viewmodels";this.removeHandles(e),t==null||t.forEach(i=>{this.addHandles(k(()=>[i.title,i.state],()=>this.scheduleRender(),q),e)}),this.scheduleRender()}_setupFeatureElementInfo(){var r;const{headingLevel:t,visibleElements:e}=this,i=e.description&&this.description,s=e.title&&this.title;(r=this._featureElementInfo)==null||r.set({description:i,title:s,headingLevel:t})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:t,showAllEnabled:e}=this.viewModel;await Tt(0),this._relatedFeatureIntersectionObserverNode&&t==="ready"&&e&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(t){this._relatedFeatureIntersectionObserverNode=t}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};o([l()],O.prototype,"_relatedFeatureIntersectionObserverNode",void 0),o([l({readOnly:!0})],O.prototype,"displayShowAllButton",null),o([l({readOnly:!0})],O.prototype,"displayListItems",null),o([l()],O.prototype,"description",null),o([l({readOnly:!0})],O.prototype,"featureCountDescription",null),o([l()],O.prototype,"featureVisibleElements",void 0),o([l()],O.prototype,"flowItems",void 0),o([l()],O.prototype,"flowType",void 0),o([l()],O.prototype,"headingLevel",void 0),o([l()],O.prototype,"title",null),o([l({type:et})],O.prototype,"viewModel",void 0),o([l(),z("esri/widgets/Feature/t9n/Feature")],O.prototype,"messages",void 0),o([l(),z("esri/t9n/common")],O.prototype,"messagesCommon",void 0),o([l()],O.prototype,"visibleElements",void 0),o([Se("visibleElements")],O.prototype,"castVisibleElements",null),O=Ge=o([V("esri.widgets.Feature.FeatureRelationship")],O);const us=O,F={fromGlobalId:"fromglobalid",fromNetworkSourceId:"fromnetworksourceid",fromTerminalId:"fromterminalid",toGlobalId:"toglobalid",toNetworkSourceId:"tonetworksourceid",toTerminalId:"toterminalid",associationType:"associationtype",globalId:"globalid",status:"status",isContentVisible:"iscontentvisible",percentAlong:"percentalong",assetGroup:"assetgroup",assetType:"assettype"},vt=100;let A=class extends Ei(qt(oe)){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.networkSourceIdsInUse=new Set,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.featureCount=0,this.associationTypes=null,this.showAllEnabled=!1,this.title=null,this.attachmentsFeatureCount=0,this.structureFeatureCount=0,this.contentFeatureCount=0,this.containerFeatureCount=0,this.connectivityFeatureCount=0,this._cancelQuery=()=>{const{_queryAbortController:i}=this;i&&i.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:i}=this;i&&i.abort(),this._queryFeatureCountAbortController=null},this._queryController=async i=>{this._cancelQuery();const s=new AbortController;this._queryAbortController=s,await rt(this._query(i)),this._queryAbortController===s&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._loaded=!1,this._cancelQueryFeatureCount();const i=new AbortController;this._queryFeatureCountAbortController=i,await rt(this._queryFeatureCount()),this._queryFeatureCountAbortController===i&&(this._queryFeatureCountAbortController=null),this._loaded=!0},this._queryDebounced=ot(this._queryController,vt),this._queryFeatureCountDebounced=ot(this._queryFeatureCountController,vt)}initialize(){var e,i;(e=this.associationTypes)==null||e.forEach(s=>{s.open=!1}),this.addHandles([...((i=this.associationTypes)==null?void 0:i.map(s=>k(()=>s.open,()=>{s.open&&this._queryDebounced(s)})))??[],k(()=>[this.graphic,this.layer,this.map,this.associationTypes,this.objectId,this.globalId,this.canQuery],()=>this._queryFeatureCountDebounced(),q)])}destroy(){this._cancelQuery(),this._cancelQueryFeatureCount(),this._destroyAssociatedFeatureViewModels()}get supportsCacheHint(){var e,i,s;return!!((s=(i=(e=this.layer)==null?void 0:e.capabilities)==null?void 0:i.query)!=null&&s.supportsCacheHint)}get canLoad(){return!!this.map&&!!this.associationTypes&&typeof this.globalId=="string"}get canQuery(){var i,s;const e=(s=(i=this.layer)==null?void 0:i.capabilities)==null?void 0:s.query;return!!this.associationTypes&&typeof this.globalId=="string"&&!!(e!=null&&e.supportsPagination)}get objectId(){var e,i;return(this.objectIdField&&((i=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:i[this.objectIdField]))??null}get objectIdField(){var e;return((e=this.layer)==null?void 0:e.objectIdField)||null}get globalId(){var e,i;return(this.globalIdField&&((i=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:i[this.globalIdField]))??null}get globalIdField(){const{layer:e}=this;return(e==null?void 0:e.type)==="subtype-sublayer"&&(e!=null&&e.parent)?e.parent.globalIdField??null:(e==null?void 0:e.globalIdField)??null}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:i,_queryPageAbortController:s,canQuery:r,_loaded:n,canLoad:a}=this;return i||a&&!n?"loading":e||s?"querying":r&&this.featureCount!==0?"ready":"disabled"}get utilityNetwork(){const{layer:e,map:i}=this;return e!=null&&e.loaded&&i?(e==null?void 0:e.type)==="subtype-sublayer"&&(e!=null&&e.parent)?dt(i,e.parent)??null:dt(i,e)??null:null}get associationsLayer(){const{utilityNetwork:e}=this;return e!=null&&e.loaded?new St({url:e.networkSystemLayers.associationsTableUrl,gdbVersion:e.gdbVersion}):null}get attachmentsAssociations(){return this._get("attachmentsAssociations")||new ee}get structureAssociations(){return this._get("structureAssociations")||new ee}get contentAssociations(){return this._get("contentAssociations")||new ee}get containerAssociations(){return this._get("containerAssociations")||new ee}get connectivityAssociations(){return this._get("connectivityAssociations")||new ee}get associationFeatures(){return this._get("associationFeatures")||new Dt}get associationViewModels(){return this._get("associationViewModels")||new Map}refresh(){this._queryFeatureCountDebounced()}_destroyAssociatedFeatureViewModels(){this.associationViewModels.forEach(e=>e.destroyAll())}_generateGlobalIdWhereClause(e,i){const{globalId:s,networkSourceIdsInUse:r}=this,{associatedNetworkSourceId:n}=e,a=i.fieldsIndex.get(F.fromGlobalId),d=i.fieldsIndex.get(F.toGlobalId),c=i.fieldsIndex.get(F.fromNetworkSourceId),p=i.fieldsIndex.get(F.toNetworkSourceId),u=n!=null,m=`(${Array.from(r.values())})`,f=u?` AND ${p.name} = ${n} AND ${p.name} IN ${m}`:"",_=u?` AND ${c.name} = ${n} AND ${c.name} IN ${m}`:"";switch(e.type){case"connectivity":return`((${a.name} = '${s}'${f}) OR (${d.name} = '${s}'${_}))`;case"attachment":case"content":return`${a.name} = '${s}'${f}`;case"container":case"structure":return`${d.name} = '${s}'${_}`;default:return""}}_generateNetworkSourceIdWhereClause(e){const{networkSourceIdsInUse:i}=this,s=`(${Array.from(i.values())})`,r=e.fieldsIndex.get(F.fromNetworkSourceId),n=e.fieldsIndex.get(F.toNetworkSourceId);return`(${r.name} IN ${s} AND ${n.name} IN ${s})`}_generateAssociationTypeWhereClause(e,i){const s=i.fieldsIndex.get(F.associationType);switch(e.type){case"attachment":case"structure":return`${s.name} = 3`;case"connectivity":return`${s.name} IN  (1, 4, 5, 6)`;case"container":case"content":return`${s.name} = 2`;default:return""}}_generateWhereClause(e,i){const s=i.fieldsIndex.get(F.status),r=`(${Ti.join(",")})`,n=`${s.name} IN ${r}`;return`(${this._generateGlobalIdWhereClause(e,i)} AND ${n} AND ${this._generateAssociationTypeWhereClause(e,i)})`}async _loadUtiltyNetworks(){var r;const e=this.map;if(!e)return;await Promise.allSettled(((r=e.utilityNetworks)==null?void 0:r.map(async n=>{await n.load()}))??[]);const i=n=>{if("layerId"in n&&s.isUtilityLayer(n)){const a=s.getSourceIdByLayerId(n.layerId);a!==null&&this.networkSourceIdsInUse.add(a)}},s=this.utilityNetwork;this._set("networkSourceIdsInUse",new Set),e.allLayers.forEach(i),e.allTables.forEach(i)}async _findLayersBySourceId(e){const{utilityNetwork:i,map:s}=this,r=p=>{const u=p;return p.url&&u.layerId===n?p.url.replace(/\/\d+$/,"")===(i==null?void 0:i.featureServiceUrl):!1};await(i==null?void 0:i.load());const n=i.getLayerIdBySourceId(e),a=s.allLayers.filter(r),d=s.allTables.filter(r),c=a.concat(d).toArray();return await Promise.allSettled(c.map(p=>p.load())),c}_clearAssociations(){this.attachmentsAssociations.removeAll(),this.structureAssociations.removeAll(),this.contentAssociations.removeAll(),this.containerAssociations.removeAll(),this.connectivityAssociations.removeAll()}_clearFeatures(){this.associationFeatures.forEach(e=>e.removeAll()),this.associationFeatures.clear()}_getAssociationsByType(e){switch(e){case"attachment":return this.attachmentsAssociations;case"structure":return this.structureAssociations;case"connectivity":return this.connectivityAssociations;case"container":return this.containerAssociations;case"content":return this.contentAssociations}}_createAssociationFromFeature(e,i){if(!e)return null;const s=xi.get(i.attributes[e.fieldsIndex.get(F.associationType).name]);return new Li({globalId:i.attributes[e.fieldsIndex.get(F.globalId).name],fromNetworkElement:new ut({globalId:i.attributes[e.fieldsIndex.get(F.fromGlobalId).name],networkSourceId:i.attributes[e.fieldsIndex.get(F.fromNetworkSourceId).name],terminalId:i.attributes[e.fieldsIndex.get(F.fromTerminalId).name]}),toNetworkElement:new ut({globalId:i.attributes[e.fieldsIndex.get(F.toGlobalId).name],networkSourceId:i.attributes[e.fieldsIndex.get(F.toNetworkSourceId).name],terminalId:i.attributes[e.fieldsIndex.get(F.toTerminalId).name]}),associationType:s,status:i.attributes[e.fieldsIndex.get(F.status).name],isContentVisible:i.attributes[e.fieldsIndex.get(F.isContentVisible).name],percentAlong:i.attributes[e.fieldsIndex.get(F.percentAlong).name]})}async _queryLayer(e,i,s,r,n){const a=e.fieldsIndex.get(F.assetGroup),d=e.fieldsIndex.get(F.assetType),c=s!=null,p=r!=null,u="("+i.map(v=>`'${v}'`).join(", ")+")",m=c?` AND ${a==null?void 0:a.name} = ${s}`:"",f=c&&p?` AND ${d==null?void 0:d.name} = ${r}`:"",_=`${e.globalIdField} IN ${u}`+m+f,y=new Ae({outFields:["*"],cacheHint:this.supportsCacheHint,where:_});return await this._queryAll(y,e,{signal:n==null?void 0:n.signal})}async _createAssociationFeatureObjects(e,i,s,r,n,a){if(e.length===0)return[];const d=new Map;for(const[p,u]of i){const m=await this._findLayersBySourceId(p);for(const f of m)(await this._queryLayer(f,u,r,n,a)).forEach(_=>{if(_.getEffectivePopupTemplate()&&_.layer){const y=d.get(_.attributes[f.globalIdField])??[];y.push(_),d.set(_.attributes[f.globalIdField],y)}})}const c=[];return e.toArray().forEach(p=>{const u=p.fromNetworkElement.globalId===s?p.toNetworkElement:p.fromNetworkElement;(d.get(u.globalId)??[]).forEach(m=>{var _,y;const f=(y=(_=this.utilityNetwork)==null?void 0:_.getTerminalById(u==null?void 0:u.terminalId))==null?void 0:y.name;c.push({association:p,feature:m,terminalName:f})})}),c}_parseFeatureObjects(e,i){e.forEach(s=>{const r=s==null?void 0:s.feature,n=r.layer,a=i.get(n)??new ee;a.add(s),i.set(n,a)})}async _queryAll(e,i,s){var d;const r=[];let n=0,a=!1;e.num=((d=i.sourceJSON)==null?void 0:d.maxRecordCount)??2e3;do{e.start=n;const c=await i.queryFeatures(e,s);r.push(...c.features),a=c.exceededTransferLimit,a&&(n+=c.features.length)}while(a);return r}async _queryAssociatedFeatureCount(e){const{layer:i,globalId:s,supportsCacheHint:r,associationTypes:n,associationsLayer:a,utilityNetwork:d,canQuery:c}=this;if(await Promise.allSettled([i==null?void 0:i.load(),d==null?void 0:d.load(),a==null?void 0:a.load()]),this._clearAssociations(),!(c&&i&&n&&a))return;const p=a.fieldsIndex.get(F.toGlobalId).name,u=a.fieldsIndex.get(F.fromGlobalId).name,m=n.map(g=>this._generateWhereClause(g,a)),f=this._generateNetworkSourceIdWhereClause(a),_=m.join(" OR "),y=new Ae({outFields:["*"],cacheHint:r,returnGeometry:!1,where:`(${_}) AND (${f})`}),v=await this._queryAll(y,a,{signal:e==null?void 0:e.signal}),w=new Map;n.forEach(g=>{w.set(g.type,[])}),v.forEach(g=>{const C=a.fieldsIndex.get(F.associationType);switch(g.attributes[C.name]){case 1:case 4:case 5:case 6:g.attributes[u]===s?w.get("connectivity").push(g.attributes[p]):w.get("connectivity").push(g.attributes[u]),this.connectivityAssociations.add(this._createAssociationFromFeature(a,g));break;case 2:g.attributes[u]===s?(w.get("content").push(g.attributes[p]),this.contentAssociations.add(this._createAssociationFromFeature(a,g))):(w.get("container").push(g.attributes[u]),this.containerAssociations.add(this._createAssociationFromFeature(a,g)));break;case 3:g.attributes[u]===s?(w.get("attachment").push(g.attributes[p]),this.attachmentsAssociations.add(this._createAssociationFromFeature(a,g))):(w.get("structure").push(g.attributes[u]),this.structureAssociations.add(this._createAssociationFromFeature(a,g)))}});const I=n.map(async g=>{const{associatedNetworkSourceId:C,associatedAssetGroup:E,associatedAssetType:N}=g,P=w.get(g.type),D=E!=null?await this._countAssociatedFeatures(C,P,E,N,e):P.length;switch(g.type){case"attachment":this._set("attachmentsFeatureCount",D);break;case"structure":this._set("structureFeatureCount",D);break;case"content":this._set("contentFeatureCount",D);break;case"container":this._set("containerFeatureCount",D);break;case"connectivity":this._set("connectivityFeatureCount",D)}});await Promise.allSettled(I)}async _countAssociatedFeatureCount(e,i,s,r,n){const a=e.fieldsIndex.get(F.assetGroup),d=e.fieldsIndex.get(F.assetType),c=r!=null,p="("+i.map(_=>`'${_}'`).join(", ")+")",u=` AND ${a==null?void 0:a.name} = ${s}`,m=c?` AND ${d==null?void 0:d.name} = ${r}`:"",f=`${e.globalIdField} IN ${p}`+u+m;return e.queryFeatureCount({where:f,outFields:["*"],returnGeometry:!1},{signal:n==null?void 0:n.signal})}async _countAssociatedFeatures(e,i,s,r,n){if(i.length===0)return 0;const a=(await this._findLayersBySourceId(e)).map(async d=>this._countAssociatedFeatureCount(d,i,s,r,n));return(await Promise.all(a)).reduce((d,c)=>d+c,0)}async _queryAssociatedFeatures(e,i){const{layer:s,globalId:r,associationTypes:n,associationsLayer:a,utilityNetwork:d,canQuery:c,associationFeatures:p}=this;if(await Promise.allSettled([s==null?void 0:s.load(),d==null?void 0:d.load(),a==null?void 0:a.load()]),!(c&&s&&n&&a))return;const u=this._getAssociationsByType(e.type),{associatedAssetGroup:m,associatedAssetType:f}=e,_=new Map;u.forEach(v=>{const{networkSourceId:w,elementGlobalId:I}=v.fromNetworkElement.globalId===r?{networkSourceId:v.toNetworkElement.networkSourceId,elementGlobalId:v.toNetworkElement.globalId}:{networkSourceId:v.fromNetworkElement.networkSourceId,elementGlobalId:v.fromNetworkElement.globalId},g=_.get(w)||[];g.push(I),_.set(w,g)});const y=await this._createAssociationFeatureObjects(u,_,r,m,f,i);this._parseFeatureObjects(y,p)}async _queryFeatureCount(){await this._loadUtiltyNetworks();const{_queryFeatureCountAbortController:e,canQuery:i}=this;i?(await this._queryAssociatedFeatureCount(e),this._set("featureCount",this.attachmentsFeatureCount+this.structureFeatureCount+this.contentFeatureCount+this.containerFeatureCount+this.connectivityFeatureCount)):this._set("featureCount",0)}async _query(e){await this._loadUtiltyNetworks();const{_queryAbortController:i}=this;this.featureCount&&(this._destroyAssociatedFeatureViewModels(),this._clearFeatures(),this.destroyed||await this._queryAssociatedFeatures(e,{signal:i==null?void 0:i.signal}))}};o([l()],A.prototype,"_loaded",void 0),o([l()],A.prototype,"_queryAbortController",void 0),o([l()],A.prototype,"_queryPageAbortController",void 0),o([l()],A.prototype,"_queryFeatureCountAbortController",void 0),o([l({readOnly:!0})],A.prototype,"supportsCacheHint",null),o([l({readOnly:!0})],A.prototype,"canLoad",null),o([l({readOnly:!0})],A.prototype,"canQuery",null),o([l()],A.prototype,"networkSourceIdsInUse",void 0),o([l()],A.prototype,"description",void 0),o([l({type:Pe})],A.prototype,"graphic",void 0),o([l()],A.prototype,"layer",void 0),o([l()],A.prototype,"map",void 0),o([l({readOnly:!0})],A.prototype,"objectId",null),o([l({readOnly:!0})],A.prototype,"objectIdField",null),o([l({readOnly:!0})],A.prototype,"globalId",null),o([l({readOnly:!0})],A.prototype,"globalIdField",null),o([l()],A.prototype,"featureCount",void 0),o([l()],A.prototype,"associationTypes",void 0),o([l()],A.prototype,"showAllEnabled",void 0),o([l()],A.prototype,"state",null),o([l()],A.prototype,"title",void 0),o([l({readOnly:!0})],A.prototype,"utilityNetwork",null),o([l({readOnly:!0})],A.prototype,"associationsLayer",null),o([l({readOnly:!0})],A.prototype,"attachmentsFeatureCount",void 0),o([l({readOnly:!0})],A.prototype,"structureFeatureCount",void 0),o([l({readOnly:!0})],A.prototype,"attachmentsAssociations",null),o([l({readOnly:!0})],A.prototype,"structureAssociations",null),o([l({readOnly:!0})],A.prototype,"contentFeatureCount",void 0),o([l({readOnly:!0})],A.prototype,"containerFeatureCount",void 0),o([l({readOnly:!0})],A.prototype,"contentAssociations",null),o([l({readOnly:!0})],A.prototype,"containerAssociations",null),o([l({readOnly:!0})],A.prototype,"connectivityFeatureCount",void 0),o([l({readOnly:!0})],A.prototype,"connectivityAssociations",null),o([l({readOnly:!0})],A.prototype,"associationFeatures",null),o([l({readOnly:!0})],A.prototype,"associationViewModels",null),A=o([V("esri.widgets.Feature.FeatureUtilityNetworkAssociations.FeatureUtilityNetworkAssociationsViewModel")],A);const Ce=A;let be=class extends oe{constructor(t){super(t),this.title=!0,this.description=!0}};o([l({type:Boolean,nonNullable:!0})],be.prototype,"title",void 0),o([l({type:Boolean,nonNullable:!0})],be.prototype,"description",void 0),be=o([V("esri.widgets.Feature.FeatureUtilityNetworkAssociations.VisibleElements")],be);const qe=be;var Ye;const Ie="esri-feature",ne=`${Ie}-relationship`,ae={base:ne,listContainer:`${ne}__list`,listItem:`${ne}__list-item`,listItemHidden:`${ne}__list-item--hidden`,listContainerQuerying:`${ne}__list--querying`,featureObserver:`${Ie}__feature-observer`,stickySpinnerContainer:`${Ie}__sticky-loading-container`,loadingSpinnerContainer:`${Ie}__loading-container`,expander:`${ne}__expander`,filterContainer:`${Ie}__filter-container`};let $=Ye=class extends G{constructor(t,e){super(t,e),this.flowType="feature-utility-network-association-type",this.description=null,this.headingLevel=2,this.title=null,this.viewModel=new Ce,this.parentFeatureViewModel=null,this.listType=null,this.selectedLayer=null,this.flowItems=null,this.messages=null,this.messagesCommon=null,this.visibleElements=new qe,this._featuresPerPage=50,this._maxNumFeatures=1e3,this._currentFeaturePage=1,this._previewDisplayCount=3,this._associatedFeatureIntersectionObserverNode=null,this._associatedFeatureIntersectionObserver=new IntersectionObserver(([i])=>{i!=null&&i.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this._tooltipReferenceMap=new Dt,this._filterText=""}initialize(){this.addHandles([k(()=>[this._associatedFeatureIntersectionObserverNode],()=>this._handleAssociatedFeatureObserverChange())])}loadDependencies(){return pe({chip:()=>b(()=>import("./calcite-chip-C9GKwE1v.js"),__vite__mapDeps([199,200,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,27,179,180,173,174,28,176,186,16]),import.meta.url),icon:()=>b(()=>import("./calcite-icon-Cu0W9dtm.js"),__vite__mapDeps([15,16,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,27,28]),import.meta.url),input:()=>b(()=>import("./calcite-input-DAafN6Cc.js"),__vite__mapDeps([201,183,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,27,184,176,174,185,186,179,173,28,180,187,188,16,189,190]),import.meta.url),loader:()=>b(()=>import("./calcite-loader-DP4PIFO8.js"),__vite__mapDeps([171,172,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,27,173,174,28]),import.meta.url),list:()=>b(()=>import("./calcite-list-C4jOVpC-.js"),__vite__mapDeps([175,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,27,176,28,177,178,179,180,173,174,181,182,16,183,184,185,186,187,188,189,190,172,191]),import.meta.url),"list-item":()=>b(()=>import("./calcite-list-item-vbKS6alm.js"),__vite__mapDeps([192,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,27,176,173,174,28,180,179,178,177,193,186,16,172,194]),import.meta.url),tooltip:()=>b(()=>import("./calcite-tooltip-rE_jVYtd.js"),__vite__mapDeps([202,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,27,203,182,198,204]),import.meta.url)})}destroy(){this._tooltipReferenceMap.clear()}get _numAssociatedFeatures(){const t=this.viewModel.associationViewModels;return this.selectedLayer?t.get(this.selectedLayer).length:0}set currentFeaturePage(t){const{_featuresPerPage:e,_numAssociatedFeatures:i}=this,s=1,r=Math.ceil(i/e)||1;this._currentFeaturePage=Math.max(Math.min(t,r),s)}get currentFeaturePage(){return this._currentFeaturePage}render(){const t=this.viewModel.associationViewModels,{state:e,showAllEnabled:i}=this.viewModel,{state:s}=this.parentFeatureViewModel??{};return h("div",{class:this.classes(ae.base,he.widget)},e==="loading"||e==="querying"||s==="loading"?this._renderLoading():h("calcite-list",null,i&&this.selectedLayer?h(Zt,null,this._renderFilter(),this._renderAssociatedFeatureListPage(),this._renderFeatureObserver()):Array.from(t.keys(),r=>this._renderTypeList(r,t.get(r)))))}_renderFilter(){return h("div",{class:ae.filterContainer,key:"filter"},h("calcite-input",{icon:"search",placeholder:this.messages.associationFilterPlaceholder,type:"search",onCalciteInputInput:t=>{this._filterText=t.target.value.trim().toLowerCase(),this._currentFeaturePage=1}}))}_showAllAssociations(t){const{flowItems:e,viewModel:i,description:s}=this;if(!e||!t)return;i.showAllEnabled=!0;const r=new Ye({selectedLayer:t,title:t==null?void 0:t.title,flowItems:e,parentFeatureViewModel:this.parentFeatureViewModel,featureVisibleElements:this.featureVisibleElements,description:s,visibleElements:{title:!1,description:!1},viewModel:i});e.push(r)}_renderAssociatedFeatureListPage(){const{currentFeaturePage:t,_featuresPerPage:e,_maxNumFeatures:i,_filterText:s}=this,r=Math.min(t*e,i),n=this.viewModel.associationViewModels.get(this.selectedLayer).filter(a=>Ve(a.featureViewModel).toLowerCase().includes(s)).slice(0,r);return[...this._renderTooltips(n),...this._renderAssociatedFeatureList(n)]}async _handleAssociatedFeatureObserverChange(){this._associatedFeatureIntersectionObserverNode&&this._associatedFeatureIntersectionObserver.unobserve(this._associatedFeatureIntersectionObserverNode);const{state:t,showAllEnabled:e}=this.viewModel;await Tt(0),this._associatedFeatureIntersectionObserverNode&&t==="ready"&&e&&this._associatedFeatureIntersectionObserver.observe(this._associatedFeatureIntersectionObserverNode)}_associatedFeatureIntersectionObserverCreated(t){this._associatedFeatureIntersectionObserverNode=t}_renderFeatureObserver(){return h("div",{afterCreate:this._associatedFeatureIntersectionObserverCreated,bind:this,class:ae.featureObserver,key:"feature-observer"})}_increaseFeaturePage(){this.currentFeaturePage++}_renderLoading(){return h("div",{class:ae.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderLoadingIcon(){return h("calcite-loader",{inline:!0,label:""})}isConnectivity(t){return["connectivity","junction-junction-connectivity","junction-edge-from-connectivity","junction-midspan-connectivity","junction-edge-to-connectivity"].includes(t.association.associationType)}_getConnectivityTooltip(t){switch(t){case"connectivity":case"junction-junction-connectivity":return this.messages.associationsJunctionJunction;case"junction-edge-from-connectivity":return this.messages.associationsJunctionEdgeFrom;case"junction-midspan-connectivity":return this.messages.associationsJunctionEdgeMidspan;case"junction-edge-to-connectivity":return this.messages.associationsJunctionEdgeTo;default:return""}}_renderItemTooltip(t){const{_tooltipReferenceMap:e}=this;return this.isConnectivity(t)?h("calcite-tooltip",{key:`tooltip-${t.featureViewModel.uid}`,referenceElement:e.get(t.featureViewModel.uid)},this._getConnectivityTooltip(t.association.associationType)):null}_renderConnectivityIcon(t,e){let i;switch(t){case"junction-edge-from-connectivity":i="connection-end-left";break;case"junction-edge-to-connectivity":i="connection-end-right";break;case"junction-midspan-connectivity":i="connection-middle";break;default:i="connection-to-connection"}return h("calcite-icon",{afterCreate:s=>this._tooltipReferenceMap.set(e,s),afterRemoved:()=>this._tooltipReferenceMap.delete(e),icon:i,scale:"s",slot:"content-start"})}_formatPercentAlong(t){return`${Gt(t.association.percentAlong,{style:"percent",maximumFractionDigits:2})}`}_renderAssociatedFeature(t){const{featureViewModel:e}=t,i=Ve(e),s=e.state==="loading",r=this._findFlowItem(e),n=r<0&&this._isParentFeature(e),a=n||r>=0,d=this.isConnectivity(t),c=d&&t.association.associationType==="junction-midspan-connectivity";return h("calcite-list-item",{class:this.classes(ae.listItem,{[ae.listItemHidden]:s}),description:t.terminalName??"",key:`associated-feature-type-${e.uid}`,label:i,onCalciteListItemSelect:()=>this._handleFeatureClick(n,r,e)},d?this._renderConnectivityIcon(t.association.associationType,t.featureViewModel.uid):null,c?h("calcite-chip",{scale:"s",slot:"content-end",value:t.association.percentAlong},this._formatPercentAlong(t)):null,this._renderChevronIconNode(a))}async _selectAssociation(t){const{flowItems:e,featureVisibleElements:i}=this;if(!e)return;t.abilities={utilityNetworkAssociationsContent:!0};const{default:s}=await b(()=>Promise.resolve().then(()=>Qt),void 0,import.meta.url);e.push(new s({flowItems:e,flowType:"feature-association",viewModel:t,visibleElements:i}))}_handleFeatureClick(t,e,i){if(t)this.flowItems.drain(s=>{"showAllEnabled"in s.viewModel&&(s.viewModel.showAllEnabled=!1),s.viewModel=null,s.destroy()});else if(e<0||!this.flowItems)this._selectAssociation(i);else for(;this.flowItems.length>e+1;){const s=this.flowItems.pop();s&&("showAllEnabled"in s.viewModel&&(s.viewModel.showAllEnabled=!1),s.viewModel=null,s.destroy())}}_featureViewModelMatch(t,e){const i=t.graphic,s=i==null?void 0:i.layer;let r=null;(s==null?void 0:s.type)==="subtype-sublayer"&&s.parent?r=s.parent.globalIdField??null:s&&"globalIdField"in s&&(r=s.globalIdField);const n=r?i==null?void 0:i.attributes[r]:null,a=e.graphic,d=a==null?void 0:a.layer;let c=null;(d==null?void 0:d.type)==="subtype-sublayer"&&d.parent?c=d.parent.globalIdField??null:d&&"globalIdField"in d&&(c=d.globalIdField);const p=c?a==null?void 0:a.attributes[c]:null;return n&&p&&n===p}_isParentFeature(t){var s;const e=(s=this.flowItems)==null?void 0:s.getItemAt(0);if(!e)return!1;const i=e.parentFeatureViewModel;return this._featureViewModelMatch(i,t)}_findFlowItem(t){var e;return((e=this.flowItems)==null?void 0:e.findIndex(i=>{if(i.flowType!=="feature")return!1;const s=i.viewModel;return this._featureViewModelMatch(s,t)}))??-1}_renderTooltips(t){return t.toArray().map(e=>this._renderItemTooltip(e))}_renderAssociatedFeatureList(t){return t.toArray().map(e=>this._renderAssociatedFeature(e))}_renderChevronIconNode(t){return h("calcite-icon",{flipRtl:!0,icon:t?"move-up":"chevron-right",scale:"s",slot:"content-end"})}_renderTypeList(t,e){const{messages:i}=this,s=e.slice(0,this._previewDisplayCount),r=s.length<e.length;return h("calcite-list-item",{key:"show-all",label:t.title,open:!0,value:t.id},h("calcite-chip",{scale:"s",slot:"actions-end",value:t.id},e.length),h("calcite-list",{group:t.id},[this._renderTooltips(s),this._renderAssociatedFeatureList(s)],r?h("calcite-list-item",{description:Oe(i==null?void 0:i.numberRecords,{number:e.length.toString()}),key:"show-all-item",label:i.showAll,onCalciteListItemSelect:()=>this._showAllAssociations(t)},h("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})):null))}};o([l()],$.prototype,"flowType",void 0),o([l()],$.prototype,"description",void 0),o([l()],$.prototype,"headingLevel",void 0),o([l()],$.prototype,"title",void 0),o([l({type:Ce})],$.prototype,"viewModel",void 0),o([l()],$.prototype,"parentFeatureViewModel",void 0),o([l()],$.prototype,"listType",void 0),o([l()],$.prototype,"selectedLayer",void 0),o([l()],$.prototype,"featureVisibleElements",void 0),o([l()],$.prototype,"flowItems",void 0),o([l(),z("esri/widgets/Feature/t9n/Feature")],$.prototype,"messages",void 0),o([l(),z("esri/t9n/common")],$.prototype,"messagesCommon",void 0),o([l({type:qe,nonNullable:!0})],$.prototype,"visibleElements",void 0),o([l()],$.prototype,"_featuresPerPage",void 0),o([l()],$.prototype,"_maxNumFeatures",void 0),o([l()],$.prototype,"_numAssociatedFeatures",null),o([l()],$.prototype,"_currentFeaturePage",void 0),o([l()],$.prototype,"currentFeaturePage",null),o([l()],$.prototype,"_previewDisplayCount",void 0),o([l()],$.prototype,"_associatedFeatureIntersectionObserverNode",void 0),o([l()],$.prototype,"_tooltipReferenceMap",void 0),o([l()],$.prototype,"_filterText",void 0),$=Ye=o([V("esri.widgets.Feature.FeatureUtilityNetworkAssociationType")],$);const ps=$,Re="esri-feature",le=`${Re}-relationship`,ge={base:le,listContainer:`${le}__list`,listItem:`${le}__list-item`,listItemHidden:`${le}__list-item--hidden`,listContainerQuerying:`${le}__list--querying`,featureObserver:`${Re}__feature-observer`,stickySpinnerContainer:`${Re}__sticky-loading-container`,loadingSpinnerContainer:`${Re}__loading-container`,expander:`${le}__expander`};let U=class extends G{constructor(t,e){super(t,e),this._featureElementInfo=null,this.flowType="feature-utility-network-associations",this.flowItems=null,this.parentFeatureViewModel=null,this.headingLevel=2,this.viewModel=new Ce,this.messages=null,this.messagesCommon=null,this.visibleElements=new qe}initialize(){this._featureElementInfo=new Me,this.addHandles([k(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),q)])}loadDependencies(){return pe({chip:()=>b(()=>import("./calcite-chip-C9GKwE1v.js"),__vite__mapDeps([199,200,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,27,179,180,173,174,28,176,186,16]),import.meta.url),icon:()=>b(()=>import("./calcite-icon-Cu0W9dtm.js"),__vite__mapDeps([15,16,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,27,28]),import.meta.url),loader:()=>b(()=>import("./calcite-loader-DP4PIFO8.js"),__vite__mapDeps([171,172,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,27,173,174,28]),import.meta.url),notice:()=>b(()=>import("./calcite-notice-DSp0z_Oh.js"),__vite__mapDeps([195,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,196,28,27,179,173,174,180,197,198,186,16]),import.meta.url),list:()=>b(()=>import("./calcite-list-C4jOVpC-.js"),__vite__mapDeps([175,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,27,176,28,177,178,179,180,173,174,181,182,16,183,184,185,186,187,188,189,190,172,191]),import.meta.url),"list-item":()=>b(()=>import("./calcite-list-item-vbKS6alm.js"),__vite__mapDeps([192,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,27,176,173,174,28,180,179,178,177,193,186,16,172,194]),import.meta.url)})}destroy(){this._featureElementInfo=Et(this._featureElementInfo)}get description(){return this.viewModel.description}set description(t){this.viewModel.description=t}get title(){return this.viewModel.title}set title(t){this.viewModel.title=t}render(){var e;const{state:t}=this.viewModel;return h("div",{class:this.classes(ge.base,he.widget)},(e=this._featureElementInfo)==null?void 0:e.render(),t==="loading"?this._renderLoading():t==="disabled"?this._renderAssociationNotFound():this._renderContent())}_renderStickyLoading(){return this.viewModel.state==="querying"?h("div",{class:ge.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return h("calcite-loader",{inline:!0,label:""})}_renderLoading(){return h("div",{class:ge.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderAssociationNotFound(){var t;return h("calcite-notice",{icon:"exclamation-mark-triangle",key:"association-not-found",kind:"danger",open:!0,scale:"s",width:"full"},h("div",{slot:"message"},(t=this.messages)==null?void 0:t.noAssociations))}_setupFeatureElementInfo(){var r;const{headingLevel:t,visibleElements:e}=this,i=e.description&&this.description,s=e.title&&this.title;(r=this._featureElementInfo)==null||r.set({description:i,title:s,headingLevel:t})}_getAssociationTypeTitle(t){const{messages:e}=this;if(t.title)return t.title;switch(t.type){case"attachment":return e.associationsAttachments;case"connectivity":return e.associationsConnectivity;case"structure":return e.associationsStructure;case"content":return e.associationsContents;case"container":return e.associationsContainer}}_selectAssociationType(t){var a;const{viewModel:e,flowItems:i,parentFeatureViewModel:s}=this;if(!i)return;const{associationTypes:r}=e;r.forEach(d=>{d.type===t.type?d.open=!0:d.open=!1});const n=new ps({viewModel:e,parentFeatureViewModel:s,listType:t,title:this._getAssociationTypeTitle(t),featureVisibleElements:this.featureVisibleElements,description:(a=this.parentFeatureViewModel)==null?void 0:a.title,flowItems:i});i.push(n)}_renderAssociationType(t){const e=this._getAssociationTypeTitle(t);return h("calcite-list-item",{description:t.description,key:`association-type-${t.type}`,label:e,value:t.type,onCalciteListItemSelect:()=>this._selectAssociationType(t)},h("calcite-chip",{scale:"s",slot:"content-end",value:t.type},this._getFeatureCount(t.type)),h("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}_getFeatureCount(t){switch(t){case"attachment":return this.viewModel.attachmentsFeatureCount;case"structure":return this.viewModel.structureFeatureCount;case"content":return this.viewModel.contentFeatureCount;case"container":return this.viewModel.containerFeatureCount;case"connectivity":return this.viewModel.connectivityFeatureCount}}_renderAssociations(t){return h("div",null,this._getFeatureCount(t.type)>0?this._renderAssociationType(t):null)}_renderContent(){const{state:t,associationTypes:e}=this.viewModel;return h("div",{class:this.classes(ge.listContainer,{[ge.listContainerQuerying]:t==="querying"}),key:"list-container"},t==="ready"?h("calcite-list",null,e.map(i=>this._renderAssociations(i))):null,this._renderStickyLoading())}};o([l()],U.prototype,"flowType",void 0),o([l()],U.prototype,"flowItems",void 0),o([l()],U.prototype,"parentFeatureViewModel",void 0),o([l()],U.prototype,"featureVisibleElements",void 0),o([l()],U.prototype,"description",null),o([l()],U.prototype,"headingLevel",void 0),o([l()],U.prototype,"title",null),o([l({type:Ce})],U.prototype,"viewModel",void 0),o([l(),z("esri/widgets/Feature/t9n/Feature")],U.prototype,"messages",void 0),o([l(),z("esri/t9n/common")],U.prototype,"messagesCommon",void 0),o([l({type:qe,nonNullable:!0})],U.prototype,"visibleElements",void 0),U=o([V("esri.widgets.Feature.FeatureUtilityNetworkAssociations")],U);const hs=U;let ms=class{constructor(e,i){this.preLayerQueryCallback=e,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=s=>{}),this.preRequestCallback||(this.preLayerQueryCallback=s=>{})}};var ue;const fs=1,wt="content-view-models",bt="relationship-view-models",_s="association-view-models",It={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0,utilityNetworkAssociationsContent:!0};let M=ue=class extends qt(oe){constructor(t){super(t),this._error=null,this._featureAbortController=null,this._associationVMAbortController=null,this._graphicChangedThrottled=Ot(this._graphicChanged,fs,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...It},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=e=>{const{abilities:i}=this;return e.type==="attachments"&&!!i.attachmentsContent||e.type==="custom"&&!!i.customContent||e.type==="fields"&&!!i.fieldsContent||e.type==="media"&&!!i.mediaContent||e.type==="text"&&!!i.textContent||e.type==="expression"&&!!i.expressionContent||e.type==="relationship"&&!!i.relationshipContent||e.type==="utility-network-associations"&&!!i.utilityNetworkAssociationsContent},this.addHandles(k(()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone],()=>this._graphicChangedThrottled(),q))}initialize(){this.addHandles(this._graphicChangedThrottled)}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return this.graphic!=null?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return ri(ct(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return oi(this.graphic)}castAbilities(t){return{...It,...t}}get isTable(){var t;return((t=this._sourceLayer)==null?void 0:t.isTable)||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(t){this._featureAbortController=new AbortController,this._set("graphic",(t==null?void 0:t.clone())??null)}get spatialReference(){var t;return((t=this.view)==null?void 0:t.spatialReference)??null}set spatialReference(t){this._override("spatialReference",t)}get timeZone(){var t;return((t=this.view)==null?void 0:t.timeZone)??Ri}set timeZone(t){this._overrideIfSome("timeZone",t)}get map(){var t;return((t=this.view)==null?void 0:t.map)||null}set map(t){this._override("map",t)}get waitingForContent(){return!(!this._featureAbortController&&!this._associationVMAbortController)}setActiveMedia(t,e){const i=this.contentViewModels[t];i instanceof se&&i.setActiveMedia(e)}nextMedia(t){const e=this.contentViewModels[t];e instanceof se&&e.next()}previousMedia(t){const e=this.contentViewModels[t];e instanceof se&&e.previous()}async updateGeometry(){var a;const{graphic:t,spatialReference:e,_sourceLayer:i}=this;await(i==null?void 0:i.load());const s=i==null?void 0:i.objectIdField;if(!s||!t||!i)return;const r=(a=t==null?void 0:t.attributes)==null?void 0:a[s];if(r==null)return;const n=[r];if(!t.geometry){const d=await ni({layer:i,graphic:t,outFields:[],objectIds:n,returnGeometry:!0,spatialReference:e}),c=d==null?void 0:d.geometry;c&&(t.geometry=c)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:t}=this;if(!t)return;const e=new AbortController;this._featureAbortController=e;try{await this._queryFeature({signal:e.signal})}catch(i){ti(i)||(this._error=i,Ze.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:t,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===e&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:t}=this;t&&t.abort(),this._featureAbortController=null}_compileContentElement(t,e){return t.type==="attachments"?this._compileAttachments(t,e):t.type==="custom"?this._compileCustom(t,e):t.type==="fields"?this._compileFields(t,e):t.type==="media"?this._compileMedia(t,e):t.type==="text"?this._compileText(t,e):t.type==="expression"?this._compileExpression(t,e):t.type==="relationship"?this._compileRelationship(t,e):t.type==="utility-network-associations"?this._compileUtilityNetworkAssociation(t,e):void 0}_compileContent(t){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(t)?t.filter(this._isAllowedContentType).map((e,i)=>this._compileContentElement(e,i)).filter(Ft):typeof t=="string"?this._compileText(new Nt({text:t}),0).text:t}_destroyContentViewModels(){this.removeHandles(bt),this.removeHandles(wt),this.contentViewModels.forEach(t=>t&&!t.destroyed&&t.destroy()),this._set("contentViewModels",[])}_matchesFeature(t,e){var r;const i=(r=t==null?void 0:t.graphic)==null?void 0:r.getObjectId(),s=e==null?void 0:e.getObjectId();return i!=null&&s!=null&&i===s}_setRelatedFeaturesViewModels({relatedFeatureViewModels:t,relatedFeatures:e,map:i}){const{view:s,spatialReference:r,timeZone:n}=this;e==null||e.filter(Boolean).forEach(a=>{t.some(d=>this._matchesFeature(d,a))||t.add(new ue({abilities:{relationshipContent:!1},map:i,view:s,spatialReference:r,timeZone:n,graphic:a}))}),t.forEach(a=>{(e==null?void 0:e.find(c=>this._matchesFeature(a,c)))||t.remove(a)})}_setExpressionContentVM(t,e){const i=this.formattedAttributes,{contentElement:s,contentElementViewModel:r}=t,n=s==null?void 0:s.type;r&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:s,contentElementIndex:e,formattedAttributes:i}),r.set(this._createFieldsVMParams(s,e))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:s,contentElementIndex:e,formattedAttributes:i}),r.set(this._createMediaVMParams(s,e))),n==="text"&&r.set(this._createTextVMParams(s)))}_compileRelationship(t,e){const{displayCount:i,orderByFields:s,relationshipId:r,title:n,description:a}=t,{_sourceLayer:d,graphic:c,map:p}=this;if(!ai(d))return;const u=new et({displayCount:i,graphic:c,orderByFields:s,relationshipId:r,layer:d,map:p,...this._compileTitleAndDesc({title:n,description:a})});return this.contentViewModels[e]=u,this.addHandles(Mt(()=>u.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(u)),bt),t}_matchesGlobalFeature(t,e){const i=t==null?void 0:t.association.globalId,s=e==null?void 0:e.association.globalId;return i!=null&&s!=null&&i===s}async _setUpUtilityNetworkAssociationsViewModels(t,e,i){const{view:s,spatialReference:r,timeZone:n}=this;t.forEach((d,c)=>{const p=e.get(c);p?d.forEach(u=>{p.find(m=>this._matchesGlobalFeature(u,m))||(d.remove(u),d.length===0&&t.delete(c))}):(d.removeAll(),t.delete(c))}),e.forEach((d,c)=>{const p=t.get(c)||new ee;d==null||d.filter(Boolean).forEach(u=>{p.some(m=>this._matchesGlobalFeature(m,u))||p.add({association:u.association,featureViewModel:new ue({abilities:{utilityNetworkAssociationsContent:!1},map:i,view:s,spatialReference:r,timeZone:n,graphic:u.feature}),terminalName:u.terminalName})}),t.set(c,p)});const a=new AbortController;this._associationVMAbortController=a,await this._sortListObjectsByTitle(t,{signal:a.signal}),this._associationVMAbortController===a&&(this._associationVMAbortController=null)}async _sortListObjectsByTitle(t,e){for(const i of t.values()){const s=i.map(r=>Yt(()=>r.featureViewModel.state==="ready",e==null?void 0:e.signal));await Promise.all(s),i.sort(this._compareByFeatureTitle)}}_compareByFeatureTitle(t,e){const i=Ve(t.featureViewModel),s=Ve(e.featureViewModel);return i.localeCompare(s,void 0,{numeric:!0})}_compileUtilityNetworkAssociation(t,e){const{title:i,description:s,associationTypes:r}=t,{_sourceLayer:n,graphic:a,map:d}=this;if(!li(n))return;const c=new Ce({graphic:a,associationTypes:r,layer:n,map:d,...this._compileTitleAndDesc({title:i,description:s})});return this.contentViewModels[e]=c,this.addHandles([k(()=>c.associationFeatures.values(),()=>this._setUpUtilityNetworkAssociationsViewModels(c.associationViewModels,c.associationFeatures,c.map))],_s),t}_compileExpression(t,e){const{expressionInfo:i}=t,{graphic:s,map:r,spatialReference:n,view:a,location:d}=this,c=new it({expressionInfo:i,graphic:s,interceptor:ue.interceptor,map:r,spatialReference:n,view:a,location:d});return this.contentViewModels[e]=c,this.addHandles(k(()=>c.contentElementViewModel,()=>this._setExpressionContentVM(c,e),q),wt),t}_compileAttachments(t,e){const{graphic:i}=this,{description:s,title:r}=t;return this.contentViewModels[e]=new tt({graphic:i,...this._compileTitleAndDesc({title:r,description:s})}),t}_compileCustom(t,e){const{graphic:i}=this,{creator:s,destroyer:r}=t;return this.contentViewModels[e]=new Ne({graphic:i,creator:s,destroyer:r}),t}_compileTitleAndDesc({title:t,description:e}){const{_fieldInfoMap:i,_sourceLayer:s,graphic:r,formattedAttributes:n}=this,a=r==null?void 0:r.attributes,d=this._expressionAttributes,c=n.global;return{title:ie({attributes:a,fieldInfoMap:i,globalAttributes:c,expressionAttributes:d,layer:s,text:t}),description:ie({attributes:a,fieldInfoMap:i,globalAttributes:c,expressionAttributes:d,layer:s,text:e})}}_createFieldsVMParams(t,e){const i=this._effectivePopupTemplate,s=this.formattedAttributes,r={...s==null?void 0:s.global,...s==null?void 0:s.content[e]},n=(t==null?void 0:t.fieldInfos)||(i==null?void 0:i.fieldInfos),a=n==null?void 0:n.filter(({fieldName:u})=>!!u&&(Rt(u)||te(u)||r.hasOwnProperty(u))),d=i==null?void 0:i.expressionInfos,{description:c,title:p}=t;return{attributes:r,expressionInfos:d,fieldInfos:a,...this._compileTitleAndDesc({title:p,description:c})}}_compileFields(t,e){const i=t.clone(),s=new De(this._createFieldsVMParams(t,e));return this.contentViewModels[e]=s,i.fieldInfos=s.formattedFieldInfos.slice(),i}_createMediaVMParams(t,e){const{abilities:i,graphic:s,_fieldInfoMap:r,_effectivePopupTemplate:n,relatedInfos:a,_sourceLayer:d,_expressionAttributes:c}=this,p=this.formattedAttributes,u=(s==null?void 0:s.attributes)??{},{description:m,mediaInfos:f,title:_}=t;return{abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:t.activeMediaInfoIndex||0,attributes:u,isAggregate:s==null?void 0:s.isAggregate,layer:d,fieldInfoMap:r,formattedAttributes:{...p==null?void 0:p.global,...p==null?void 0:p.content[e]},expressionAttributes:c,mediaInfos:f,popupTemplate:n,relatedInfos:a,...this._compileTitleAndDesc({title:_,description:m})}}_compileMedia(t,e){const i=t.clone(),s=new se(this._createMediaVMParams(t,e));return i.mediaInfos=s.formattedMediaInfos.slice(),this.contentViewModels[e]=s,i}_createTextVMParams(t){var n;const{graphic:e,_fieldInfoMap:i,_sourceLayer:s,_expressionAttributes:r}=this;if(t&&t.text){const a=(e==null?void 0:e.attributes)??{},d=((n=this.formattedAttributes)==null?void 0:n.global)??{};t.text=ie({attributes:a,fieldInfoMap:i,globalAttributes:d,expressionAttributes:r,layer:s,text:t.text})}return{graphic:e,creator:t.text}}_compileText(t,e){const i=t.clone();return this.contentViewModels[e]=new Ne(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:t,_sourceLayer:e,graphic:i,timeZone:s}=this;if(!t)return;const{lastEditInfoEnabled:r}=t,n=e==null?void 0:e.editFieldsInfo;return r&&n?di(n,i==null?void 0:i.attributes,s,e):void 0}_compileTitle(t){var d;const{_fieldInfoMap:e,_sourceLayer:i,graphic:s,_expressionAttributes:r}=this,n=(s==null?void 0:s.attributes)??{},a=((d=this.formattedAttributes)==null?void 0:d.global)??{};return ie({attributes:n,fieldInfoMap:e,globalAttributes:a,expressionAttributes:r,layer:i,text:t})}async _getTitle(){const{_effectivePopupTemplate:t,graphic:e}=this;return e?ke({type:"title",value:t==null?void 0:t.title,event:{graphic:e}}):null}async _getContent(){const{_effectivePopupTemplate:t,graphic:e}=this;return e?ke({type:"content",value:t==null?void 0:t.content,event:{graphic:e}}):null}async _queryFeature(t){const{_featureAbortController:e,_sourceLayer:i,graphic:s,_effectivePopupTemplate:r}=this,n=this.map,a=this.view,d=this.spatialReference,c=this.location;if(e!==this._featureAbortController||!s)return;await ci({graphic:s,popupTemplate:r,layer:i,spatialReference:d},t);const{content:{value:p},title:{value:u}}=await re({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:m}}=await re({checkForRelatedFeatures:this._checkForRelatedFeatures(t),expressionAttributes:ls({expressionInfos:r==null?void 0:r.expressionInfos,spatialReference:d,graphic:s,map:n,interceptor:ue.interceptor,view:a,options:t,location:c})});e===this._featureAbortController&&s&&(this._expressionAttributes=m,this._graphicExpressionAttributes={...s.attributes,...m},this._set("formattedAttributes",this._createFormattedAttributes(p)),this._set("title",this._compileTitle(u)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(p)||null))}_createMediaFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:i}){const{_effectivePopupTemplate:s,graphic:r,relatedInfos:n,_sourceLayer:a,_fieldInfoMap:d,_graphicExpressionAttributes:c,timeZone:p}=this;i.content[e]=We({fieldInfos:s==null?void 0:s.fieldInfos,graphic:r,attributes:{...c,...t.attributes},layer:a,fieldInfoMap:d,relatedInfos:n,timeZone:p})}_createFieldsFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:i}){if(t.fieldInfos){const{graphic:s,relatedInfos:r,_sourceLayer:n,_fieldInfoMap:a,_graphicExpressionAttributes:d,timeZone:c}=this;i.content[e]=We({fieldInfos:t.fieldInfos,graphic:s,attributes:{...d,...t.attributes},layer:n,fieldInfoMap:a,relatedInfos:r,timeZone:c})}}_createFormattedAttributes(t){const{_effectivePopupTemplate:e,graphic:i,relatedInfos:s,_sourceLayer:r,_fieldInfoMap:n,_graphicExpressionAttributes:a,timeZone:d}=this,c=e==null?void 0:e.fieldInfos,p={global:We({fieldInfos:c,graphic:i,attributes:a,layer:r,fieldInfoMap:n,relatedInfos:s,timeZone:d}),content:[]};return Array.isArray(t)&&t.forEach((u,m)=>{u.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:u,contentElementIndex:m,formattedAttributes:p}),u.type==="media"&&this._createMediaFormattedAttributes({contentElement:u,contentElementIndex:m,formattedAttributes:p})}),p}_checkForRelatedFeatures(t){const{graphic:e,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(e,ct(i),t)}async _queryRelatedInfos(t,e,i){const{relatedInfos:s,_sourceLayer:r}=this;s.clear();const n=(r==null?void 0:r.associatedLayer)!=null?await(r==null?void 0:r.associatedLayer.load(i)):r;if(!n||!t)return;const a=e.filter(p=>!!p.fieldName&&te(p.fieldName));if(!(a!=null&&a.length))return;e.forEach(p=>this._configureRelatedInfo(p,n));const d=await zi({relatedInfos:s,layer:n},i);Object.keys(d).forEach(p=>{var f;const u=s.get(p.toString()),m=(f=d[p])==null?void 0:f.value;u&&m&&(u.layerInfo=m.data)});const c=await Xi({graphic:t,relatedInfos:s,layer:n},i);Object.keys(c).forEach(p=>{var u;qi((u=c[p])==null?void 0:u.value,s.get(p.toString()))})}_configureRelatedInfo(t,e){const{relatedInfos:i}=this,s=Te(t.fieldName||"");if(!s)return;const{layerId:r,fieldName:n}=s;if(!r)return;const a=i.get(r.toString())||Di(r,e);a&&(Gi({relatedInfo:a,fieldName:n,fieldInfo:t}),this.relatedInfos.set(r,a))}};M.interceptor=new ms(ui,pi),o([l()],M.prototype,"_error",void 0),o([l()],M.prototype,"_featureAbortController",void 0),o([l()],M.prototype,"_associationVMAbortController",void 0),o([l({readOnly:!0})],M.prototype,"_effectivePopupTemplate",null),o([l({readOnly:!0})],M.prototype,"_fieldInfoMap",null),o([l({readOnly:!0})],M.prototype,"_sourceLayer",null),o([l()],M.prototype,"abilities",void 0),o([Se("abilities")],M.prototype,"castAbilities",null),o([l({readOnly:!0})],M.prototype,"content",void 0),o([l({readOnly:!0})],M.prototype,"contentViewModels",void 0),o([l()],M.prototype,"description",void 0),o([l({type:Boolean})],M.prototype,"defaultPopupTemplateEnabled",void 0),o([l({readOnly:!0})],M.prototype,"isTable",null),o([l({readOnly:!0})],M.prototype,"state",null),o([l({readOnly:!0})],M.prototype,"formattedAttributes",void 0),o([l({type:Pe,value:null})],M.prototype,"graphic",null),o([l({readOnly:!0})],M.prototype,"lastEditInfo",void 0),o([l({type:Pt})],M.prototype,"location",void 0),o([l({readOnly:!0})],M.prototype,"relatedInfos",void 0),o([l()],M.prototype,"spatialReference",null),o([l()],M.prototype,"timeZone",null),o([l({readOnly:!0})],M.prototype,"title",void 0),o([l()],M.prototype,"map",null),o([l({readOnly:!0})],M.prototype,"waitingForContent",null),o([l()],M.prototype,"view",void 0),M=ue=o([V("esri.widgets.Feature.FeatureViewModel")],M);const Bt=M,S="esri-feature",x={base:S,container:`${S}__size-container`,title:`${S}__title`,main:`${S}__main-container`,btn:`${S}__button`,icon:`${S}__icon`,content:`${S}__content`,contentNode:`${S}__content-node`,contentNodeText:`${S}__content-node--text`,contentElement:`${S}__content-element`,text:`${S}__text`,lastEditedInfo:`${S}__last-edited-info`,fields:`${S}__fields`,fieldHeader:`${S}__field-header`,fieldData:`${S}__field-data`,fieldDataDate:`${S}__field-data--date`,loadingSpinnerContainer:`${S}__loading-container`},ys=t=>{let e=class extends t{constructor(){super(...arguments),this.renderNodeContent=i=>kt(i)&&!i.destroyed?h("div",{class:x.contentNode,key:i},i.render()):i instanceof HTMLElement?h("div",{afterCreate:this._attachToNode,bind:i,class:x.contentNode,key:i}):hi(i)?h("div",{afterCreate:this._attachToNode,bind:i.domNode,class:x.contentNode,key:i}):null}_attachToNode(i){const s=this;i.appendChild(s)}};return e=o([V("esri.widgets.Feature.support.FeatureContentMixin")],e),e},At={title:!0,content:!0,lastEditedInfo:!0};let T=class extends ys(G){constructor(t,e){super(t,e),this._contentWidgets=[],this.flowType="feature",this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements={...At},this.viewModel=new Bt}initialize(){this.addHandles(k(()=>{var t;return(t=this.viewModel)==null?void 0:t.contentViewModels},()=>this._setupContentWidgets(),q))}loadDependencies(){return pe({notice:()=>b(()=>import("./calcite-notice-DSp0z_Oh.js"),__vite__mapDeps([195,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,196,28,27,179,173,174,180,197,198,186,16]),import.meta.url),loader:()=>b(()=>import("./calcite-loader-DP4PIFO8.js"),__vite__mapDeps([171,172,17,11,1,2,3,4,5,6,7,8,9,10,18,19,20,21,22,23,24,25,26,27,173,174,28]),import.meta.url)})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(t){this.viewModel.graphic=t}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(t){this.viewModel.defaultPopupTemplateEnabled=t}get isTable(){return this.viewModel.isTable}get icon(){return"polygon"}set icon(t){this._overrideIfSome("icon",t)}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get location(){return this.viewModel.location}set location(t){this.viewModel.location=t}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(t){this.viewModel.spatialReference=t}get timeZone(){return this.viewModel.timeZone}set timeZone(t){this.viewModel.timeZone=t}get title(){return this.viewModel.title}castVisibleElements(t){return{...At,...t}}get map(){return this.viewModel.map}set map(t){this.viewModel.map=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}setActiveMedia(t,e){return this.viewModel.setActiveMedia(t,e)}nextMedia(t){return this.viewModel.nextMedia(t)}previousMedia(t){return this.viewModel.previousMedia(t)}render(){const{state:t}=this.viewModel,e=h("div",{class:x.container,key:"container"},this._renderTitle(),t==="error"?this._renderError():t==="loading"?this._renderLoading():this._renderContentContainer());return h("div",{class:this.classes(x.base,he.widget)},e)}_renderError(){const{messagesCommon:t,messages:e,visibleElements:i}=this;return h("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},i.title?h("div",{key:"error-title",slot:"title"},t.errorMessage):null,h("div",{key:"error-message",slot:"message"},e.loadingError))}_renderLoading(){return h("div",{class:x.loadingSpinnerContainer,key:"loading-container"},h("calcite-loader",{inline:!0,label:""}))}_renderContentContainer(){const{visibleElements:t}=this;return t.content?h("div",{class:x.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){const{visibleElements:t,title:e}=this;return t.title?h($t,{class:x.title,innerHTML:e,level:this.headingLevel}):null}_renderContent(){const t=this.viewModel.content,e="content";if(!t)return null;if(Array.isArray(t))return t.length?h("div",{class:x.contentNode,key:`${e}-content-elements`},t.map(this._renderContentElement,this)):null;if(typeof t=="string"){const i=this._contentWidgets[0];return!i||i.destroyed?null:h("div",{class:this.classes(x.contentNode,x.contentNodeText),key:`${e}-content`},i.render())}return this.renderNodeContent(t)}_renderContentElement(t,e){var s;const{visibleElements:i}=this;if(typeof i.content!="boolean"&&!((s=i.content)!=null&&s[t.type]))return null;switch(t.type){case"attachments":return this._renderAttachments(e);case"custom":return this._renderCustom(t,e);case"fields":return this._renderFields(e);case"media":return this._renderMedia(e);case"text":return this._renderText(t,e);case"expression":return this._renderExpression(e);case"relationship":return this._renderRelationship(e);case"utility-network-associations":return this._renderAssociation(e);default:return null}}_renderAttachments(t){const e=this._contentWidgets[t];if(!e||e.destroyed)return null;const{state:i,attachmentInfos:s}=e.viewModel;return i==="loading"||s.length>0?h("div",{class:this.classes(x.contentElement),key:this._buildKey("attachments-element",t)},e.render()):null}_renderRelationship(t){const e=this._contentWidgets[t];return e&&!e.destroyed&&this.flowItems?h("div",{class:x.contentElement,key:this._buildKey("relationship-element",t)},e.render()):null}_renderAssociation(t){const e=this._contentWidgets[t];return e&&!e.destroyed&&this.flowItems?h("div",{class:x.contentElement,key:this._buildKey("utility-network-association-element",t)},e.render()):null}_renderExpression(t){const e=this._contentWidgets[t];return e&&!e.destroyed&&e.viewModel.contentElement?h("div",{class:x.contentElement,key:this._buildKey("expression-element",t)},e.render()):null}_renderCustom(t,e){const{creator:i}=t,s=this._contentWidgets[e];return!s||s.destroyed?null:i?h("div",{class:x.contentElement,key:this._buildKey("custom-element",e)},s.render()):null}_renderFields(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:h("div",{class:x.contentElement,key:this._buildKey("fields-element",t)},e.render())}_renderMedia(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:h("div",{class:x.contentElement,key:this._buildKey("media-element",t)},e.render())}_renderLastEditInfo(){const{visibleElements:t,messages:e}=this,{lastEditInfo:i}=this.viewModel;if(!i||!t.lastEditedInfo)return null;const{date:s,user:r}=i,n=i.type==="edit"?r?e.lastEditedByUser:e.lastEdited:r?e.lastCreatedByUser:e.lastCreated,a=Oe(n,{date:s,user:r});return h("div",{class:this.classes(x.lastEditedInfo,x.contentElement),key:"edit-info-element"},a)}_renderText(t,e){const i=t.text,s=this._contentWidgets[e];return!s||s.destroyed?null:i?h("div",{class:this.classes(x.contentElement,x.text),key:this._buildKey("text-element",e)},s.render()):null}_buildKey(t,...e){var i,s;return`${t}__${((s=(i=this.viewModel)==null?void 0:i.graphic)==null?void 0:s.uid)||"0"}-${e.join("-")}`}_destroyContentWidget(t){t&&(t.viewModel=null,!t.destroyed&&t.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(t=>this._destroyContentWidget(t)),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:t,visibleElements:e,flowItems:i,viewModel:s}=this,r=s==null?void 0:s.content,{contentViewModels:n}=s;if(Array.isArray(r))r.forEach((a,d)=>{if(a.type==="attachments"&&(this._contentWidgets[d]=new Vi({displayType:a.displayType,headingLevel:e.title&&t<6?t+1:t,viewModel:n[d]})),a.type==="fields"&&(this._contentWidgets[d]=new jt({viewModel:n[d]})),a.type==="media"&&(this._contentWidgets[d]=new Wt({viewModel:n[d]})),a.type==="text"&&(this._contentWidgets[d]=new Ee({viewModel:n[d]})),a.type==="custom"&&(this._contentWidgets[d]=new Ee({viewModel:n[d]})),a.type==="expression"&&(this._contentWidgets[d]=new cs({viewModel:n[d]})),a.type==="relationship"){const c=new us({flowItems:i,featureVisibleElements:e,viewModel:n[d]});this._contentWidgets[d]=c}if(a.type==="utility-network-associations"){const c=new hs({flowItems:i,parentFeatureViewModel:s,featureVisibleElements:e,viewModel:n[d]});this._contentWidgets[d]=c}},this);else{const a=n[0];a&&!a.destroyed&&(this._contentWidgets[0]=new Ee({viewModel:a}))}this.scheduleRender()}};o([l()],T.prototype,"flowType",void 0),o([l()],T.prototype,"graphic",null),o([l()],T.prototype,"defaultPopupTemplateEnabled",null),o([l()],T.prototype,"flowItems",void 0),o([l()],T.prototype,"headingLevel",void 0),o([l({readOnly:!0})],T.prototype,"isTable",null),o([l()],T.prototype,"icon",null),o([l()],T.prototype,"label",null),o([l()],T.prototype,"location",null),o([l(),z("esri/widgets/Feature/t9n/Feature")],T.prototype,"messages",void 0),o([l(),z("esri/t9n/common")],T.prototype,"messagesCommon",void 0),o([l()],T.prototype,"spatialReference",null),o([l()],T.prototype,"timeZone",null),o([l({readOnly:!0})],T.prototype,"title",null),o([l()],T.prototype,"visibleElements",void 0),o([Se("visibleElements")],T.prototype,"castVisibleElements",null),o([l()],T.prototype,"map",null),o([l()],T.prototype,"view",null),o([l({type:Bt})],T.prototype,"viewModel",void 0),T=o([V("esri.widgets.Feature")],T);const gs=T,Qt=Object.freeze(Object.defineProperty({__proto__:null,default:gs},Symbol.toStringTag,{value:"Module"}));export{Qt as F,gs as W,ys as n,Bt as r,x as t};
