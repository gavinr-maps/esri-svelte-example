import{e as f}from"./Accessor-BHnuXKD2.js";import{M as k}from"./mathUtils-DV9iOXpW.js";import{c as v}from"./screenUtils-_ZIvrt5o.js";import{a as I,_ as D}from"./InputManager-Bs9UE-jw.js";import"./IViewEvents-Bci6PjlS.js";const P=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],h={};function b(e){return!!h[e]}function _(e){for(const t of e)if(!b(t))return!1;return!0}P.forEach(e=>{h[e]=!0});class z{constructor(t){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=t,this.inputManager=null}connect(t){t&&this.disconnect(),this.inputManager=t,this._handlers.forEach(({handler:r,priority:a},i)=>{var o;return(o=this.inputManager)==null?void 0:o.installHandlers(i,[r],a)})}disconnect(){this.inputManager&&this._handlers.forEach((t,r)=>{var a;return(a=this.inputManager)==null?void 0:a.uninstallHandlers(r)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(t,r,a,i){const o=Array.isArray(t)?t:t.split(",");if(!_(o))return o.some(b)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let n,s;Array.isArray(r)?s=r:(n=r,s=[]),typeof a=="function"?n=a:i=a,i=i??D.DEFAULT;const p=this._createUniqueGroupName(),c=new x(this.view,o,s,n);this._handlers.set(p,{handler:c,priority:i});for(const l of o){const u=this._handlerCounts.get(l)||0;this._handlerCounts.set(l,u+1)}return this.inputManager&&this.inputManager.installHandlers(p,[c],i),f(()=>this._removeHandler(p,o))}hasHandler(t){return!!this._handlerCounts.get(t)}_removeHandler(t,r){if(this._handlers.has(t)){this._handlers.delete(t);for(const a of r){const i=this._handlerCounts.get(a);i===void 0||(i===1?this._handlerCounts.delete(a):this._handlerCounts.set(a,i-1))}}this.inputManager&&this.inputManager.uninstallHandlers(t)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}}class x extends I{constructor(t,r,a,i){super(!0),this._latestDragStart=void 0,this.view=t;for(const o of r)switch(o){case"click":this.registerIncoming("click",a,n=>i(M(t,n)));break;case"double-click":this.registerIncoming("double-click",a,n=>i(E(t,n)));break;case"immediate-click":this.registerIncoming("immediate-click",a,n=>i(C(t,n)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",a,n=>i(H(t,n)));break;case"hold":this.registerIncoming("hold",a,n=>i(S(t,n)));break;case"drag":this.registerIncoming("drag",a,n=>{const s=this._wrapDrag(n);s&&i(s)});break;case"key-down":this.registerIncoming("key-down",a,n=>i(A(n)));break;case"key-up":this.registerIncoming("key-up",a,n=>i(U(n)));break;case"pointer-down":this.registerIncoming("pointer-down",a,n=>i(d(n,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",a,n=>i(d(n,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",a,n=>i(d(n,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",a,n=>i($(n)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",a,n=>i(q(n)));break;case"pointer-enter":this.registerIncoming("pointer-enter",a,n=>i(d(n,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",a,n=>i(d(n,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",a,n=>{i(G(n))});break;case"focus":this.registerIncoming("focus",a,n=>{i(w(n))});break;case"blur":this.registerIncoming("blur",a,n=>{i(T(n))})}}_wrapDrag(t){const r=t.data,{x:a,y:i}=r.center,{action:o,pointerType:n,button:s}=r;if(o==="start"&&(this._latestDragStart=r),!this._latestDragStart)return;const p=r.pointer.native,c=r.buttons,{cancelable:l,timestamp:u}=t,m={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return o==="end"&&(this._latestDragStart=void 0),{type:"drag",action:o,x:a,y:i,origin:m,pointerType:n,button:s,buttons:c,radius:r.radius,angle:k(r.angle),native:p,timestamp:u,cancelable:l,stopPropagation:()=>t.stopPropagation(),async:y=>t.async(y),preventDefault:()=>t.preventDefault()}}}function w(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function T(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function M(e,t){const{pointerType:r,button:a,buttons:i,x:o,y:n,native:s,eventId:p}=t.data,{cancelable:c,timestamp:l}=t;return{type:"click",pointerType:r,button:a,buttons:i,x:o,y:n,native:s,timestamp:l,screenPoint:v(o,n),mapPoint:g(e,o,n),eventId:p,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:u=>t.async(u),preventDefault:()=>t.preventDefault()}}function E(e,t){const{pointerType:r,button:a,buttons:i,x:o,y:n,native:s,eventId:p}=t.data,{cancelable:c,timestamp:l}=t;return{type:"double-click",pointerType:r,button:a,buttons:i,x:o,y:n,native:s,timestamp:l,mapPoint:g(e,o,n),eventId:p,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:u=>t.async(u),preventDefault:()=>t.preventDefault()}}function C(e,t){const{pointerType:r,button:a,buttons:i,x:o,y:n,native:s,eventId:p}=t.data,c=s.pointerId,{cancelable:l,timestamp:u}=t;return{type:"immediate-click",pointerId:c,pointerType:r,button:a,buttons:i,x:o,y:n,native:s,timestamp:u,mapPoint:g(e,o,n),eventId:p,cancelable:l,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}function H(e,t){const{pointerType:r,button:a,buttons:i,x:o,y:n,native:s,eventId:p}=t.data,c=s.pointerId,{cancelable:l,timestamp:u}=t;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:a,buttons:i,x:o,y:n,native:s,timestamp:u,mapPoint:g(e,o,n),eventId:p,cancelable:l,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}function S(e,t){const{pointerType:r,button:a,buttons:i,x:o,y:n,native:s}=t.data,{cancelable:p,timestamp:c}=t;return{type:"hold",pointerType:r,button:a,buttons:i,x:o,y:n,native:s,timestamp:c,mapPoint:g(e,o,n),cancelable:p,stopPropagation:()=>t.stopPropagation(),async:l=>t.async(l),preventDefault:()=>t.preventDefault()}}function g(e,t,r){return e.toMap(v(t,r),{exclude:[]})}function A(e){const{key:t,repeat:r,native:a}=e.data,{cancelable:i,timestamp:o}=e;return{type:"key-down",key:t,repeat:r,native:a,timestamp:o,cancelable:i,stopPropagation:()=>e.stopPropagation(),async:n=>e.async(n),preventDefault:()=>e.preventDefault()}}function U(e){const{key:t,native:r}=e.data,{cancelable:a,timestamp:i}=e;return{type:"key-up",key:t,native:r,timestamp:i,cancelable:a,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}function d(e,t){const{x:r,y:a,button:i,buttons:o,native:n,eventId:s}=e.data,p=n.pointerId,c=n.pointerType,{cancelable:l,timestamp:u}=e;return{type:t,x:r,y:a,pointerId:p,pointerType:c,button:i,buttons:o,native:n,timestamp:u,eventId:s,cancelable:l,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}function $(e){const{x:t,y:r,buttons:a,native:i,eventId:o}=e.data.currentEvent,{button:n}=e.data.startEvent,s=e.data.startEvent.native.pointerId,p=e.data.startEvent.native.pointerType,c=e.data.action,l={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:u,timestamp:m}=e;return{type:"pointer-drag",x:t,y:r,pointerId:s,pointerType:p,button:n,buttons:a,action:c,origin:l,native:i,timestamp:m,eventId:o,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:y=>e.async(y),preventDefault:()=>e.preventDefault()}}function q(e){const{cancelable:t,data:r,timestamp:a}=e,{x:i,y:o,deltaY:n,native:s}=r;return{type:"mouse-wheel",x:i,y:o,deltaY:n,native:s,timestamp:a,cancelable:t,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}function G(e){const{action:t,state:r,device:a}=e.data,{cancelable:i,timestamp:o}=e,{buttons:n,axes:s}=r;return{type:"gamepad",device:a,timestamp:o,action:t,buttons:n,axes:s,cancelable:i,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}export{z as c,P as r};
