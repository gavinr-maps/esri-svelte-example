const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Feature3DPipeline-Bx_v32hd.js","./Accessor-BmwT4B0c.js","./Promise-DfET-uns.js","./cast-CsZslgGN.js","./index-4eY77cms.js","./index-Cx51aysm.css","./JSONSupport-DcrLLGjL.js","./reactiveUtils-XM7cS2OP.js","./Evented-Dw4_VOGn.js","./SimpleObservable-CvOkykwM.js","./WorkerHandle-CKOgUZ7i.js","./workers-Cds_sd9m.js","./Queue-BQesTh_6.js","./intl-Duiy0OzY.js","./Extent-g5W9hy0j.js","./Point-Cz2JYYmX.js","./writer-DKgfqj4X.js","./FeatureSet-B5-Veyin.js","./Graphic-Dt0LgVGU.js","./Clonable-Z-AWS-16.js","./opacityUtils-Dim20wpZ.js","./enumeration-DpvDkLNI.js","./Color-VJEMvW-n.js","./colorUtils-Rxh2V3ai.js","./mathUtils-Cfq9PL9W.js","./ActionToggle-D7439N1A.js","./Identifiable-BHVfzH03.js","./jsonUtils-CwFG8yN4.js","./Polyline-s-JzsQqo.js","./typeUtils-B6WBEKDM.js","./TextSymbol-BLIQ6RKX.js","./screenUtils-_ZIvrt5o.js","./collectionUtils-CTT-51g7.js","./Portal-CmmHxpLg.js","./vec3f64-BLpZdpfb.js","./aaBoundingBox-Dw3yBk2f.js","./Field-BDG0QV_T.js","./fieldType-CBeoJWlv.js","./FeaturePipelineRenderManager-e1rYpWsw.js","./vec4f64-o2zAXfmz.js","./ViewingMode-Dodu7ZZk.js","./DepthRange-BJLjx8ee.js","./vec2-ChnYg_BJ.js","./common-DQOJ18NT.js","./vec2f64-Dy6m9Nrb.js","./Material-C_-mgXN8.js","./VertexAttribute-Cq4MnHjR.js","./boundedPlane-DuGhiiFM.js","./sphere-Cin5efBj.js","./mat4-Fi6iAz29.js","./vec32-Dvg_eL9J.js","./vec42-YcqnINSP.js","./mat3-CR8GKnhD.js","./mat3f64-BBpwCtoL.js","./plane-CpXmOyqq.js","./mat4f64-Dk4dwAN8.js","./quatf64-CCm9z-pX.js","./mathUtils-BgCEaV43.js","./lineSegment-v806maA5.js","./NoParameters-t-PuNrgq.js","./basicInterfaces-CZwQPxTp.js","./glUtil-CAJRmga-.js","./enums-D9v74xTE.js","./VertexElementDescriptor-BLyltQyJ.js","./Matrix3PassUniform-uCCQMnlP.js","./BindType-BBwFZqyN.js","./RenderPlugin-CTXypYLE.js","./FloatArray-BQXWSSJh.js","./Texture-BVJ22uHh.js","./signal-CySMLEX9.js","./getDataTypeBytes-BTGR5GyG.js","./renderState-Ci93M1-P.js","./Indices-D8XWalpO.js","./InterleavedLayout-_dYEAUNK.js","./BufferView-0osDbyWD.js","./types-D0PSWh4d.js","./triangle-B1tKFm7z.js","./ShaderTechniqueConfiguration-D4dZMCXS.js","./glsl-BH37Aalp.js","./lengthUtils-_77UiyVF.js","./requestImageUtils-DWgRKL5q.js","./TextureFormat-1mYWTFa-.js","./DrawParameters-C9t9_e99.js","./DefaultMaterial-GRoe8HM5.js","./NormalAttribute.glsl-0GHNIsQf.js","./SceneLighting-BuSMIzqo.js","./GLTextureMaterial-96UpbkjC.js","./DefaultBufferWriter-CqCDaNCZ.js","./verticalOffsetUtils-BFnFdbst.js","./orientedBoundingBox-B17G_yFO.js","./quat-CP7JhygC.js","./spatialReferenceEllipsoidUtils-DBqQpPRa.js","./computeTranslationToOriginAndRotation-DYUrDrjE.js","./projectBuffer-CQnuEMuP.js","./geodesicConstants-RQL9oKdk.js","./Attribute-DGhdp5lO.js","./VertexColor.glsl-D3WyDYIi.js","./Matrix3DrawUniform-DD7AqlIc.js","./Matrix4PassUniform-COGIPIq4.js","./doublePrecisionUtils-B0owpBza.js","./VerticalOffset.glsl-CsMbbWIx.js","./Matrix4sPassUniform-SKhQ1xSr.js","./Float2PassUniform-x4sHx2JD.js","./BooleanBindUniform-BgD_OP8i.js","./ShaderBuilder-BKul5qh8.js","./CameraSpace.glsl-g9iLbhnR.js","./LodRenderer-ClQ5I6Kv.js","./RenderCamera-CDB-KFBK.js","./Octree-CmoRJhci.js","./intersectorUtils-BNnvTT1E.js","./BufferObject-BJilD_hc.js","./memoryEstimations-Bcyf-mHz.js","./VertexArrayObject-vYejmVPr.js","./sdfPrimitives-DBgFWIDT.js","./floatRGBA-Cb__GiDF.js","./HighlightDefaults-CumzVg9-.js","./Scheduler-i_u8qdlN.js","./debugFlags-B1LM_Apo.js","./RealisticTree.glsl-PW_KtBDJ.js","./Intersector-tBiZcjSu.js","./Intersector-zrebwyaY.js","./HUDMaterial-DDt4C7E7.js","./HUDVisibility.glsl-DuFScu5i.js","./HUDRenderStyle-BhGvVxgm.js","./RgbaFloatEncoding.glsl-_io2eW3M.js","./Float4DrawUniform-Db0CLl_z.js","./highlightUtils-CENYWDnQ.js","./LineCallout.glsl-BQyjm-mE.js","./visualVariableUtils-Xcorldoo.js","./ElevationContext-BJejROd5.js","./dehydratedFeatureUtils-1rrRm6hF.js","./ElevationProvider-aS5xrHHy.js","./unitConversionUtils-rg07EgOm.js","./hydratedFeatures-CNHxsqRS.js","./projectVectorToVector-CCOy_B5J.js","./projectPointToVector-BoxjK-qy.js","./projection-CyCZAIaD.js","./graphicUtils-BFGMMQ1R.js","./meshVertexSpaceUtils-AgAbm20L.js","./MeshLocalVertexSpace-CnHk-qPr.js","./RibbonLine.glsl-DwJpAQ1c.js","./vec2f32-BbH2jxlN.js","./projectBoundingRect-C2OcwCLZ.js","./dehydratedFeatures-kwLHUA1D.js","./quantizationUtils-DgFbqZi7.js","./featureConversionUtils-CvnFcmH_.js","./OptimizedFeature-P2towpqD.js","./OptimizedGeometry-BJqUA4Pi.js","./OptimizedFeatureSet-Blu9Ckm7.js","./edgeUtils-D0U-z06n.js","./webStyleAcceptedFormats-CG7ZQ6BV.js","./GeometryUtil-D-PMXorz.js","./vec3f32-nZdmKIgz.js","./HeatmapDensity.glsl-C4Ur6ReY.js","./timeSupport-B8qjIabC.js","./timeUtils-C1c_L2Fd.js","./TimeExtent-BO6BsF_x.js","./utils-BjSXFjBJ.js","./Version-Cd3TlGH0.js","./Query-B_2mhyL4.js","./FullTextSearch-CBnxSwz4.js","./projectExtentUtils-B6xjnIBe.js","./geometryServiceUtils-CW7bdn7_.js","./project-CvBujuEW.js","./utils-YowqfOgk.js","./utils-B-dlKIhi.js","./UpdatingHandles-CzJ4c3KT.js","./featureLayerUtils-Btb8HY8h.js","./uuid-Cl5lrJ4c.js","./featureQueryAll-JpNZKIBO.js","./layerUtils-B__v9OBu.js","./SimpleRenderer-CEw_geZx.js","./commonProperties-ZfGquLPI.js","./colorRamps-CRjjPL3r.js","./SizeVariable-B-ghFm6e.js","./ColorStop-BYiAUa8d.js","./jsonUtils-B-voMz-i.js","./defaults-FkBa0ybj.js","./defaultsJSON-GKolV7NZ.js","./UniqueValueRenderer-yoWHKJ_P.js","./diffUtils-BanfihCO.js","./RendererLegendOptions-CYAPr8D6.js","./styleUtils-ColFrJ-Z.js","./AttachmentQuery-CpEmJqq-.js","./NormalizationBinParametersMixin-CZD0XfhN.js","./RelationshipQuery-B5a-mYy7.js","./ShadowCastAccumulate.glsl-DMni1gLj.js","./Camera-CdyTfTAk.js","./Cyclical-Dlbl-cQK.js","./Viewpoint-DvyUmqUt.js","./jsxFactory-Cnml7uXM.js","./GraphicsCollection-BJ5Nr2H8.js","./HeightModelInfo-C05IFsWs.js","./RenderCoordsHelper-DA-pMWeR.js","./projectVectorToPoint-DEm8-dt4.js","./scaleUtils-DPfHG2g0.js","./DefaultUI-BwWVKFUS.js","./InputManager-DZ3jJnlx.js","./Basemap-BZmrlnvW.js","./loadAll-D1eTJ7uv.js","./PortalItem-CTx1kJsR.js","./basemapDefinitions-D-Q7PKmu.js","./writeUtils-CcunaxF8.js","./groundInstanceUtils-Ben03ZCf.js","./CollectionFlattener-U8hHQmGf.js","./editableLayers-CWgCazH-.js","./catalogUtils-CGCu8hgu.js","./basemapEnsureType-CmRtohu0.js","./basemapUtils-oMnqy94d.js","./utils-DYurMneM.js","./mat4f32-DcsiF_Rp.js","./TablesMixin-Bqfi1Ha_.js","./Layer-DH4_Pn8a.js","./timeZoneUtils-DxzjpEBb.js","./ReactiveMap-BHFEHYMj.js","./selectionUtils-DYi6daQO.js","./ViewEvents-c9mvQ_r3.js","./IViewEvents-Bci6PjlS.js","./interfaces-D6pIddIh.js","./screenUtils-BWEEmpSb.js","./a11yUtils-ClKbIIe-.js","./heightModelInfoUtils-D_x68P3s.js","./unitBezier-B1N-tmtC.js","./imageUtils-DsXKmbqJ.js","./capabilities-DwlKKScG.js","./themeUtils-C3zvZbsE.js","./globalCss-vQlnDsEX.js","./accessibleHandler-BaA3O97p.js","./CompassViewModel-DBhnIkQP.js","./GoTo-zPv0y7kC.js","./ZoomViewModel-Bua4WqEj.js","./NormalUtils.glsl-W-nmUbAv.js","./earcut-D9gy186-.js","./vec3-BXNNVgyU.js","./SnappingCandidate-DGkpYqI6.js","./triangulationUtils-Cu97ljqy.js","./deduplicate-Cp1WDW0w.js","./OverlayCompositing.glsl-CUa8aMAb.js","./GridLocalOriginFactory-CngFIYNp.js","./axisAngleDegrees-DdLZENJj.js","./weather-zOic7P_q.js","./NestedMap-GuqgquCN.js","./Normals-D6WqMXVD.js","./fontUtils-CGi-tOxo.js","./cameraUtils-Cg-qbPDO.js","./earthUtils-8WLQbUUl.js","./spatialReferenceSupport-DfixDcu7.js","./ElevationSamplerData-UywXoG8C.js","./terrainUtils-CgFk6NLH.js","./TileInfo-DxwC9WcY.js","./TileKey-DZd6gJy7.js","./FramebufferObject-B01p0UGV.js","./ShadowCastVisualizeTechniqueConfiguration-vN_a9xco.js","./SunCalc-uwgdo0BB.js","./VirtualLighting-CdhwLgbn.js","./ray-C_tSu6xd.js","./RenderFeature-2QP3kBrd.js","./unitFormatUtils-Q7ZG7HcF.js","./ByteSizeUnit-BsxeN7wM.js","./quantityUtils-BsDK158M.js","./ZoomMomentumEstimator-BDiG9U4W.js","./labelFormatUtils-F9rkrs4Y.js","./labelUtils-DCpQ7n-8.js","./elevationInfoUtils-D26wVF2d.js","./hitTest-Dmi1EcVX.js","./LayerConstants-B33OP6sh.js","./intersectorUtilsConversions-CiJ6bOx7.js","./ElevationRange-BrgM1moX.js","./hitTestSelectUtils-UXJPjatw.js","./MemCache-CmojB_Z1.js","./DefaultLoadingContext-pYVsNNqG.js","./wosrLoader-CvsaTck0.js","./TileStrategy-CtmYSAoK.js","./TileKey-DBTeo_j0.js","./ScheduledQueueProcessor-U8WIIyj8.js","./RenderableTile-FJVLrFon.js","./config-BOD8--da.js","./StyleDefinition-C2Flw6Qv.js","./enums-BTM-fOHQ.js","./enums-BRzLM11V.js","./GeometryUtils-F7QfOKlc.js","./DefaultVertexAttributeLayouts-wSIZdMhB.js","./DisplayObject-Dejv4A66.js","./resources-D31XxULB.js","./colorUtils-DaPfwnk3.js","./vec33-KumQEj7U.js","./ShaderTechniqueRepository-Ch1TPHrL.js","./Blit-_zFq7-RL.js","./testSVGPremultipliedAlpha-BGpZOwI7.js","./RenderingContext-7iVYEQBa.js","./ProgramCache-CuBZBhwD.js","./Program-C5Xq9SwE.js","./layerViewUtils-Bevty3Jm.js","./makeScheduleFunction-CggzEh3c.js","./dehydratedFeatureComparison-j4L0peJx.js","./utils-aIx1khaq.js","./jsonUtils-DZz5FrgB.js","./cimSymbolUtils-DzhKvmq_.js","./utils-UPZJIDfz.js","./defaultCIMValues-Bb-CUowV.js","./LRUCache-CXiGQWMN.js","./queryForSymbologySnapping-f8bz6CGc.js","./Graphics3DFeatureProcessor-w1VyLp6M.js","./hash-CcEbRgUF.js","./Graphics3DScaleVisibility-CyLlAoK9.js","./rendererConversion-B_DS3bPe.js","./optimizedFeatureQueryEngineAdapter-D7doR0mc.js","./PooledRBush--ue4CxG1.js","./quickselect-QQC62dOK.js","./popupUtils-CY6-CisY.js","./Graphics3DObjectStates-XVMjaI7s.js","./attributeUtils-Dc8--CBJ.js","./FeatureFilter-Ca1n-g_b.js","./floorFilterUtils-DZ5C6FQv.js","./QueryEngine-BokU27l9.js","./WhereClauseCache-CJbuf62r.js","./WhereClause-xGR0ztic.js","./TimeOnly-CveCl9ie.js","./timeSupport-C7DiFkF_.js","./queryUtils-DBEPdow2.js","./normalizeUtils-BTGdXlpz.js","./normalizeUtilsCommon-lGDszWRI.js","./json-Wa8cmqdu.js","./QueryEngineCapabilities-B_pTbIiR.js","./utils-Co_tyUES.js","./heatmapUtils-Cyq-bAyG.js","./utils-v4CMtYiY.js","./utils-Dyua10sr.js","./ClassBreaksDefinition-C7KVmBug.js","./FixedIntervalBinParameters-ZfcJap1f.js","./FieldsIndex-FW1AMU67.js","./FeatureStore-BuDu5Iw5.js","./BoundsStore-CI-maf3v.js","./heatmapTextureUtils-C_5TPY_E.js","./LayerView3D-BJ3u1Cu5.js","./query-Bjn_Ozo1.js","./pbfQueryUtils-mqiWagfZ.js","./pbf-BsmI3A9L.js","./queryZScale-BdW_vUm_.js","./EventedSet-DZ2rCNIA.js","./FeatureLayerView-CazbeBsE.js","./constants-B4mRqufT.js","./displayFilterUtils-uKPOP7_-.js","./FeatureEffect-DZgZP6Sj.js","./networkFieldUtils-iOtCEyIS.js","./LayerView-DUZfYZew.js","./RefreshableLayerView-CmQe69iO.js"])))=>i.map(i=>d[i]);
import{_ as S}from"./index-4eY77cms.js";import{aR as N,g as M,bs as $,D as T,a6 as D,N as w,r as i,m as a,a as g,M as E,s as Q}from"./Accessor-BmwT4B0c.js";import{d as x,P as v,A as R,p as Z}from"./reactiveUtils-XM7cS2OP.js";import{j as V,R as A}from"./dehydratedFeatures-kwLHUA1D.js";import{O as I,L as H,h as j}from"./HeatmapDensity.glsl-C4Ur6ReY.js";import{l as G}from"./LayerView3D-BJ3u1Cu5.js";import{u as L}from"./hydratedFeatures-CNHxsqRS.js";import{t as z}from"./LineCallout.glsl-BQyjm-mE.js";import{E as k,c as B}from"./query-Bjn_Ozo1.js";import{h as J}from"./WorkerHandle-CKOgUZ7i.js";import{g as O}from"./Point-Cz2JYYmX.js";import{y as Y}from"./Field-BDG0QV_T.js";import{r as U}from"./EventedSet-DZ2rCNIA.js";import{C as m}from"./RibbonLine.glsl-DwJpAQ1c.js";import{t as K}from"./ShadowCastAccumulate.glsl-DMni1gLj.js";import{U as W}from"./FeatureLayerView-CazbeBsE.js";import{y as X}from"./LayerView-DUZfYZew.js";import{i as ee}from"./RefreshableLayerView-CmQe69iO.js";let te=class extends z{constructor(e,r,s,u,n,o){super(e.usedMemory,e.displayedFeatures,e.totalFeatures,e.maximumFeatures,e.nodes,e.core),this.storedFeatures=r,this.totalVertices=s,this.partial=u,this.mode=n,this.symbolComplexity=o}};class re{constructor(e){this._controller=e,this._handle=new ie(r=>e.schedule(r))}destroy(){this._handle.destroy()}invoke(e,r){return e.buffer&&e.buffer.byteLength!==0?(e.options.sourceSpatialReference&&e.options.sourceSpatialReference instanceof O&&(e.options={...e.options,sourceSpatialReference:e.options.sourceSpatialReference.toJSON()}),this._handle.invoke(e,r).then(s=>{let u=0,n=0;const o=O.fromJSON(s.spatialReference);s.spatialReference=o;const l=async p=>{const d=s.fields;if(d){for(;u<d.length;)if(d[u]=Y.fromJSON(d[u]),u++,p.madeProgress())return this._controller.reschedule(F=>l(F))}const P=s.features;for(;n<P.length;){const F=P[n];++n,F.uid=N();const b=F.geometry;if(b!=null&&(b.spatialReference=o,se(b),p.madeProgress()))return this._controller.reschedule(q=>l(q))}return s};return this._controller.schedule(p=>l(p))})):Promise.resolve(null)}}function se(t){switch(t.type){case"polyline":t.paths=t.hasZ&&t.hasM?t.paths.map(e=>e.map(r=>[r[0],r[1],r[2],r[3]])):t.hasZ||t.hasM?t.paths.map(e=>e.map(r=>[r[0],r[1],r[2]])):t.paths.map(e=>e.map(r=>[r[0],r[1]]));break;case"polygon":t.rings=t.hasZ&&t.hasM?t.rings.map(e=>e.map(r=>[r[0],r[1],r[2],r[3]])):t.hasZ||t.hasM?t.rings.map(e=>e.map(r=>[r[0],r[1],r[2]])):t.rings.map(e=>e.map(r=>[r[0],r[1]]))}}class ie extends J{constructor(e){super("PBFDecoderWorker","_parseFeatureQuery",{_parseFeatureQuery:r=>[r.buffer]},e)}}let y=class extends M{constructor(t){super(t)}get implicitFields(){var s;if(!((s=this.layer.outFields)==null?void 0:s.includes("*")))return new Set;const e=new Set(this.layerView.requiredFields),r=new Set(this.layerView.availableFields);return $(r,e)}get queryFeaturesDehydrated(){var n;const{layer:t}=this,e=t.capabilities,r=e&&e.query,s=r&&r.supportsFormatPBF,u=t.parsedUrl;if(s){this._decoder==null&&(this._decoder=new re(this.controller));const o={sourceSpatialReference:((n=t.spatialReference)==null?void 0:n.toJSON())??null,applyTransform:!0,maxStringAttributeFields:this.implicitFields,maxStringAttributeLength:C};return(l,p)=>k(u,l,"pbf",this._createRequestOptions(p)).then(d=>(T(p),this._decoder!=null?this._decoder.invoke({buffer:d.data,options:o},p.signal):Promise.reject(D())))}return(o,l)=>B(u,o,t.spatialReference,this._createRequestOptions(l)).then(p=>V(p.data,{maxStringAttributeFields:this.implicitFields,maxStringAttributeLength:C}))}queryFeatureCount(t,e){return this.layer.queryFeatureCount(t,e)}destroy(){this._decoder=w(this._decoder)}_createRequestOptions(t){return{...t,query:{...this.layer.customParameters,token:this.layer.apiKey,...t==null?void 0:t.query}}}};i([a({constructOnly:!0})],y.prototype,"layer",void 0),i([a({constructOnly:!0})],y.prototype,"layerView",void 0),i([a({constructOnly:!0})],y.prototype,"controller",void 0),i([a({readOnly:!0})],y.prototype,"implicitFields",null),i([a({readOnly:!0})],y.prototype,"queryFeaturesDehydrated",null),y=i([g("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],y);let _=class extends M{constructor(t){super(t)}queryFeaturesDehydrated(t,e){return this.layer.queryFeatures(t,e)}};i([a({constructOnly:!0})],_.prototype,"layer",void 0),_=i([g("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileOGCServiceQuery3D")],_);let f=class extends M{constructor(t){super(t)}queryFeaturesDehydrated(t,e){return this.source.queryFeaturesJSON(t,e).then(V,r=>{if(r&&r.name==="query-features-json:unsupported")return this.layer.queryFeatures(t,e);throw r})}queryFeatureCount(t,e){return this.layer.queryFeatureCount(t,e)}};function oe(t,e){const{layer:r}=t;return r.type==="feature"&&r.source.type==="feature-layer"||r.type==="catalog-footprint"?new y({layer:r,layerView:t,controller:e}):r.type==="feature"&&r.source.type==="memory"||r.type==="csv"||r.type==="geojson"||r.type==="oriented-imagery"||r.type==="wfs"?new f({layer:r,source:r.source}):r.type==="ogc-feature"?new _({layer:r}):null}i([a({constructOnly:!0})],f.prototype,"layer",void 0),i([a({constructOnly:!0})],f.prototype,"source",void 0),f=i([g("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],f);const C=1024;class ae{constructor(e){this._memoryCache=null;const r=e.layerView.layer;this._layerView=e.layerView,this.objectIdField=r.objectIdField,this.globalIdField="globalIdField"in r?r.globalIdField:null,this._returnZ=e.returnZ,this._returnM=e.returnM;const s=this._layerView.view.resourceController;this.query=oe(this._layerView,s.normal),s&&this._memoryCacheEnabled&&(this._memoryCache=s.memoryController.newCache(`fl-${r.uid}`))}get _memoryCacheEnabled(){switch(this._layerView.layer.source.type){case"feature-layer":case"ogc-feature":case"oriented-imagery":return!0;case"csv":case"parquet":case"geojson":case"memory":case"wfs":return!1}}destroy(){this._memoryCache=w(this._memoryCache),this.query.destroy()}createQuery(){const e=this._layerView.layer.createQuery();return e.outFields=this._layerView.availableFields,e.returnZ=this._returnZ,e.returnM=this._returnM,e.outSpatialReference=this.tilingScheme.spatialReference,e}get memoryCache(){return this._memoryCache}get viewingMode(){return this._layerView.view.state.viewingMode}get tilingScheme(){return this._layerView.view.featureTiles.tilingScheme}get scheduler(){var e;return(e=this._layerView.view.resourceController)==null?void 0:e.scheduler}get geometryType(){return this._layerView.layer.geometryType}get fullExtent(){return this._layerView.layer.fullExtent}get tileMaxRecordCount(){return this._layerView.layer.capabilities.query.tileMaxRecordCount}get maxRecordCount(){return this._layerView.layer.capabilities.query.maxRecordCount}get isDraped(){var e;return((e=this._layerView.layer.elevationInfo)==null?void 0:e.mode)==="on-the-ground"}get effectiveDisplayFilter(){return this._layerView.displayFilterEnabled?this._layerView.effectiveDisplayFilter:null}get capabilities(){return this._capabilities??(this._capabilities=ue(this._layerView.layer)),this._capabilities}logFetchError(e,r){e.error("#fetchTile()",this._layerView.layer,(r==null?void 0:r.message)??r)}}function ue(t){const e=t.capabilities.query;return{supportsMultipleResolutions:ne(t),supportsPagination:!(!e||!e.supportsPagination),supportsResultType:!(!e||!e.supportsResultType),supportsCacheHint:!(!e||!e.supportsCacheHint),supportsQuantization:!(!e||!e.supportsQuantization),supportsQuantizationEditMode:!(!e||!e.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!e||!e.supportsMaxRecordCountFactor),supportsFormatPBF:!(!e||!e.supportsFormatPBF)}}function ne(t){switch(t.geometryType){case"polyline":return!0;case"polygon":return t.capabilities&&t.capabilities.query&&t.capabilities.query.supportsQuantization;default:return!1}}let c=class extends I{constructor(e){super(e),this._controllerTotal=0,this._processorTotal=0,this._needsRefresh=!1,this.suspendResumeExtentMode="data"}initialize(){this.addHandles(x(()=>({controller:this.controller,suspended:this.suspended}),({controller:e,suspended:r})=>{e&&!r&&this._needsRefresh&&(e.refetch(),this._needsRefresh=!1)}))}destroy(){this._fetcherContext=w(this._fetcherContext)}get maximumNumberOfFeatures(){var e;return((e=this.controller)==null?void 0:e.maximumNumberOfFeatures)??this._get("maximumNumberOfFeatures")}set maximumNumberOfFeatures(e){this._set("maximumNumberOfFeatures",e),this.controller&&(this.controller.maximumNumberOfFeatures=e)}get maximumNumberOfFeaturesExceeded(){return!!this.controller&&!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded)}get updatingProgressValue(){var s,u;let e=0;if((s=this.controller)!=null&&s.updating){const n=this.controller.updatingRemaining,o=Math.max(this.controller.updatingTotal,this._controllerTotal);o>0&&(e=(o-n)/o,this._controllerTotal=o)}let r=0;if((u=this.processor)!=null&&u.updating){const n=this.processor.updatingRemaining,o=Math.max(n,this._processorTotal);o>0&&(r=(o-n)/o,this._processorTotal=o)}return .5*(e+r)}get updatePolicy(){if(!this.controller)return m.ASYNC;switch(this.controller.mode){case"snapshot":{const e=le.get(this.layer.geometryType);return e==null||this.controller.serviceDataCount>e?m.ASYNC:m.SYNC}case"tiles":return m.ASYNC}}get usedMemory(){var e,r;return(((e=this.processor)==null?void 0:e.usedMemory)??0)+(((r=this.controller)==null?void 0:r.memoryForUnusedFeatures)??0)}get unloadedMemory(){var n,o,l,p;const e=((n=this.processor)==null?void 0:n.unprocessedMemoryEstimate)??0,r=((o=this.controller)==null?void 0:o.expectedFeatureDiff)??0,s=((l=this.processor)==null?void 0:l.loadedFeatures)??0,u=s+r>0?s/(s+r):1;return e+r*(((p=this.processor)==null?void 0:p.usedMemoryPerFeature)??0)*u}get ignoresMemoryFactor(){var e;return(e=this.controller)==null?void 0:e.hasMaximumNumberOfFeaturesOverride}get performanceInfo(){var u,n,o,l,p,d;const e=(u=this.controller)==null?void 0:u.displayFeatureLimit,r=e!=null?e.averageSymbolComplexity:void 0,s=r!=null?`f:${r.verticesPerFeature},v:${r.verticesPerCoordinate}`:"n/a";return new te(super.performanceInfo,((o=(n=this.controller)==null?void 0:n.performanceInfo)==null?void 0:o.storedFeatures)??0,((p=(l=this.controller)==null?void 0:l.performanceInfo)==null?void 0:p.totalVertices)??0,this.maximumNumberOfFeaturesExceeded,((d=this.controller)==null?void 0:d.mode)??"n/a",s)}async doRefresh(e){const{controller:r,processor:s,suspended:u}=this;e&&r&&(u?this._needsRefresh=!0:(r.refetch(),this._needsRefresh=!1)),s.refreshFilter()}setVisibility(e,r){var s;(s=this.processor)==null||s.setObjectIdVisibility(e,r)}getMissingAttributesForFeature(e){return this.controller.getMissingAttributesForFeature(e)}getHydratedGeometry(e){const r=this.graphics3DProcessor;if(r==null)return null;const s=r.graphics3DGraphicsByObjectID;if(s==null)return null;const u=s.get(e);return u==null?null:L(u.graphic.geometry)}createController(){this._fetcherContext=new ae({layerView:this.layerView,returnZ:this.hasZ,returnM:this.hasM});const e=new H({layerView:this.layerView,context:this._fetcherContext,graphics:new U,extent:this.clippingExtent});return this.updatingHandles.add(()=>e.serviceDataExtent,r=>{this.processor&&(this.processor.dataExtent=r)},v),this.addHandles(x(()=>this.suspended&&this.layerView.updateSuspended,r=>{r?e.suspend():e.resume()},R)),this.updatingHandles.add(()=>{var r;return(r=this.processor)==null?void 0:r.displayFeatureLimit},r=>e.displayFeatureLimit=r,v),this.addHandles(Z(()=>!this.updating,()=>{this._controllerTotal=0,this._processorTotal=0})),e}beforeSetController(e){e.maximumNumberOfFeatures=this.maximumNumberOfFeatures}get test(){return{controller:this.controller,graphics3DProcessor:this.graphics3DProcessor,heatmapProcessor:this.heatmapProcessor,loadedGraphics:this.loadedGraphics}}};i([a()],c.prototype,"layerView",void 0),i([a()],c.prototype,"controller",void 0),i([a()],c.prototype,"_controllerTotal",void 0),i([a()],c.prototype,"_processorTotal",void 0),i([a()],c.prototype,"_needsRefresh",void 0),i([a()],c.prototype,"maximumNumberOfFeatures",null),i([a()],c.prototype,"maximumNumberOfFeaturesExceeded",null),i([a()],c.prototype,"updatingProgressValue",null),i([a()],c.prototype,"updatePolicy",null),i([a()],c.prototype,"suspendResumeExtentMode",void 0),c=i([g("esri.views.3d.layers.graphics.FeatureGraphics3DGraphicsPipeline")],c);const le=new Map([["point",5e3],["polygon",500],["polyline",1e3]]);let h=class extends ee(j(W(G(X)))){constructor(t){super(t)}initialize(){this.addHandles(x(()=>this._updatingRequiredPromise,t=>this._updatingHandles.addPromise(t),R))}destroy(){this._updatingHandles.removeAll(),this._fetcherContext=w(this._fetcherContext)}get maximumNumberOfFeatures(){return this.graphicsPipeline.maximumNumberOfFeatures}set maximumNumberOfFeatures(t){this.graphicsPipeline.maximumNumberOfFeatures=t}get maximumNumberOfFeaturesExceeded(){return this.graphicsPipeline!=null&&!this.suspended&&this.graphicsPipeline.maximumNumberOfFeaturesExceeded}get updatingProgressValue(){var t;return((t=this.graphicsPipeline)==null?void 0:t.updatingProgressValue)??0}get updatePolicy(){var t;return((t=this.graphicsPipeline)==null?void 0:t.updatePolicy)??m.ASYNC}get hasZ(){const t=this.layer,e=t.capabilities&&t.capabilities.data;return!(!e||!e.supportsZ)&&("returnZ"in t&&t.returnZ!=null?t.returnZ:e.supportsZ)}get hasM(){const t=this.layer,e=t.capabilities&&t.capabilities.data;return!(!e||!e.supportsM)&&"returnM"in t&&t.returnM!=null&&t.returnM}setVisibility(t,e){var r;(r=this.graphicsPipeline)==null||r.setVisibility(t,e)}createQuery(){return super.createQuery()}queryFeatures(t,e){const r=()=>super.queryFeatures(t,e);return this.layer.geometryType==="mesh"?this._queryFeaturesMesh(this._ensureQuery(t),r):r()}async createGraphicsPipeline(){if(E("feature-pipeline-3d-test")){const{Feature3DPipeline:t}=await S(()=>import("./Feature3DPipeline-Bx_v32hd.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346]),import.meta.url);return new t({layerView:this})}return new c({layerView:this})}async doRefresh(t){return await this.graphicsPipeline.doRefresh(t)}_popupFeatureHasRequiredFields(t,e){if(!super._popupFeatureHasRequiredFields(t,e))return!1;const r=A(t,this.layer.objectIdField);if(r==null)return!0;const s=this.graphicsPipeline.getMissingAttributesForFeature(r);if(s==null)return!0;for(const u of e)if(s.has(u))return!1;return!0}get usedMemory(){var t;return((t=this.graphicsPipeline)==null?void 0:t.usedMemory)??0}get unloadedMemory(){var t;return((t=this.graphicsPipeline)==null?void 0:t.unloadedMemory)??0}get ignoresMemoryFactor(){var t;return((t=this.graphicsPipeline)==null?void 0:t.ignoresMemoryFactor)??!1}async _queryFeaturesMesh(t,e){await this._validateQueryFeaturesMesh(t);const r=await e(),s=this.graphicsPipeline;if(t!=null&&t.outStatistics||s==null)return r;const u=this.layer.objectIdField,n=[];for(const o of r.features)if(o.geometry){const l=s.getHydratedGeometry(o.attributes[u]);l&&(o.geometry=l,n.push(o))}else n.push(o);return r.features=n,r}async _validateQueryFeaturesMesh(t){if(!t)return;const e=s=>{throw new Q("feature-layer-view:unsupported-query",`Queries on Mesh feature collection layers do not support '${s}'`)},r=["quantizationParameters","geometryPrecision","maxAllowableOffset"];for(const s of r)t[s]!=null&&e(s);"returnM"in t&&t.returnM&&e("returnM"),"returnCentroid"in t&&t.returnCentroid&&e("returnCentroid"),t.outSpatialReference==null||t.outSpatialReference.equals(this.view.spatialReference)||e("outSpatialReference")}get test(){}};i([a()],h.prototype,"layer",void 0),i([a()],h.prototype,"graphicsPipeline",void 0),i([a()],h.prototype,"maximumNumberOfFeatures",null),i([a()],h.prototype,"maximumNumberOfFeaturesExceeded",null),i([a(K)],h.prototype,"updatingProgress",void 0),i([a({readOnly:!0})],h.prototype,"updatingProgressValue",null),i([a({readOnly:!0})],h.prototype,"updatePolicy",null),i([a({readOnly:!0})],h.prototype,"hasZ",null),i([a({readOnly:!0})],h.prototype,"hasM",null),h=i([g("esri.views.3d.layers.FeatureLayerViewBase3D")],h);const qe=h;export{qe as g,te as t};
