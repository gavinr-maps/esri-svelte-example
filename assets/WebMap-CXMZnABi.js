const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./layersCreator-pwoFFBtV.js","./reactiveUtils-BFQ0BtrB.js","./Evented-CXIxDjmW.js","./Accessor-D6mNnsWy.js","./subclass-BR3PhgZG.js","./shared-B3wH2qpO.js","./portalLayers-C03kizKz.js","./associatedFeatureServiceUtils-DrLOVkk4.js","./assets-BNizZMOZ.js","./index-BVncS3aY.js","./index-CjOb8WjV.css","./arcgisLayerUrl-ETqee4Bd.js","./persistableUrlUtils-Dx61-x4K.js","./Portal-DCqdz-K4.js","./Promise-CZrWwByK.js","./jsonMap-DCC6W5ex.js","./writer-3zufXUNV.js","./Extent-B4rrMrqp.js","./Point-TlcsOcXV.js","./PortalItem-CaeKabGc.js","./lazyLayerLoader-Dvz94v5M.js","./requestPresets-xNTV8VKT.js","./layerUtils-BzjQnEdj.js","./portalItemUtils-C4O2jNL5.js","./projection-tSh-0UvX.js","./mathUtils-ClvKsMak.js","./Polyline-BQFeqYXi.js","./projectBuffer-iyGwL2dv.js","./geodesicConstants-kj1AtlGg.js","./styleUtils-BATHgMyw.js","./geometryServiceUtils-C-iODloP.js","./project-DXhIgRZA.js","./jsonUtils-DtWlwXHP.js","./utils-Blh5cXWv.js","./utils-Bh7lx_TM.js","./webdocSaveUtils-DYnNg7f2.js","./MultiOriginJSONSupport-CvjUw5hc.js","./originUtils-D69mHv66.js","./multiOriginJSONSupportUtils-C0wm8_Yw.js","./jsonContext-CAJ7-auS.js","./basemapUtils-fcYt_ePc.js","./Basemap-CKBB4cRW.js","./collectionUtils-Dm1icNvk.js","./loadAll-z9YY33Kx.js","./writeUtils-BUKZUL8X.js","./utils-D20M4_S8.js","./colorUtils-CS9vdHXB.js","./screenUtils-PfxkaaMN.js","./mat4f32-DcsiF_Rp.js","./mat4-ybYUU6jq.js","./resourceUtils-O6KYCD03.js","./uuid-fwrPAdZb.js","./resourceUtils-B9NWReyn.js","./saveAPIKeyUtils-BLpn6O2f.js","./saveUtils-BlgyRdsU.js"])))=>i.map(i=>d[i]);
import{_ as M}from"./index-BVncS3aY.js";import{e as i}from"./Evented-CXIxDjmW.js";import{f as d,k as ee,p as te,a4 as re,a as ie,o as oe}from"./assets-BNizZMOZ.js";import{L as ne}from"./Map-D9sO0Jqv.js";import{m as P}from"./Viewpoint-7_owAOZm.js";import{y as n,b as u,a as z,c as N,n as G,O as se}from"./subclass-BR3PhgZG.js";import{V as H,w as ae}from"./reactiveUtils-BFQ0BtrB.js";import{C as pe,m as le}from"./Portal-DCqdz-K4.js";import{t as me}from"./loadAll-z9YY33Kx.js";import{S as ue,x as ce,u as he}from"./Accessor-D6mNnsWy.js";import{S as de}from"./MultiOriginJSONSupport-CvjUw5hc.js";import{o as ye,n as ge}from"./Promise-CZrWwByK.js";import{r as w,o as W}from"./writer-3zufXUNV.js";import{U as fe,f as q}from"./Point-TlcsOcXV.js";import{T as we}from"./UtilityNetwork-C968dv8s.js";import ve from"./PortalItem-CaeKabGc.js";import{f as be}from"./portalItemUtils-C4O2jNL5.js";import{i as Ae,a as Se,l as _e}from"./Viewing-DTDhKnsH.js";import{i as y}from"./Clonable-cKbRam6-.js";import{o as _}from"./enumeration--HlxOQ_N.js";import{n as T}from"./jsonMap-DCC6W5ex.js";import{n as Ie}from"./geometry-CnaxvJsv.js";import{y as $e}from"./jsonUtils-DtWlwXHP.js";import{A as j}from"./interfaces-CL2NbQte.js";import{a as Ve}from"./Widgets-BUn1zToX.js";import{e as xe}from"./jsonContext-CAJ7-auS.js";import{p as Re,n as Pe}from"./project-DXhIgRZA.js";import{f as je}from"./writeUtils-BUKZUL8X.js";import{f as Oe}from"./Bookmark-CmB4s9qL.js";import{m as C}from"./ColorBackground-Ds8mXmIZ.js";import{r as Ee}from"./Version-_Vxue7Ui.js";import"./Basemap-CKBB4cRW.js";import"./collectionUtils-Dm1icNvk.js";import"./Ground-CSI-YC3C.js";import"./Color-DDUWtbqR.js";import"./colorUtils-CS9vdHXB.js";import"./mathUtils-ClvKsMak.js";import"./compilerUtils-BA04t1lN.js";import"./opacityUtils-BT7mQkwC.js";import"./CollectionFlattener-CkyePFnC.js";import"./editableLayers-BdCikvlg.js";import"./catalogUtils--o1nDhfl.js";import"./layerUtils-BzjQnEdj.js";import"./basemapUtils-fcYt_ePc.js";import"./utils-D20M4_S8.js";import"./screenUtils-PfxkaaMN.js";import"./mat4f32-DcsiF_Rp.js";import"./mat4-ybYUU6jq.js";import"./TablesMixin-BWPSKW45.js";import"./Layer-CfUiPX3n.js";import"./TimeExtent-Dl-qaORu.js";import"./timeUtils-DQR2jUPL.js";import"./Identifiable-BLvpQbOc.js";import"./Extent-B4rrMrqp.js";import"./Cyclical-BY_I03kj.js";import"./shared-B3wH2qpO.js";import"./Graphic-Bi5hWHps.js";import"./PopupTemplate-D8mXPxzU.js";import"./fieldUtils-C5R42-PY.js";import"./intl-CArXn1et.js";import"./ActionToggle-C0Z1k2jc.js";import"./symbols-CfvYGR4J.js";import"./TextSymbol-zZq0BA1M.js";import"./materialUtils-CQ3JLQ1x.js";import"./aaBoundingBox-BGxkJAW0.js";import"./Polyline-BQFeqYXi.js";import"./persistableUrlUtils-Dx61-x4K.js";import"./FeatureLayer-UOSH_sw8.js";import"./ClassBreaksRenderer-B2uJHW90.js";import"./UniqueValueRenderer-Q9ooDuxf.js";import"./diffUtils--7ofoPN-.js";import"./colorRamps-BBM5Timv.js";import"./SizeVariable-Bq7jlw1r.js";import"./ColorStop-DEfc5Idt.js";import"./sizeVariableUtils-Cmcuvw-4.js";import"./visualVariableUtils-CrTsYJ9f.js";import"./lengthUtils-vgIBtB6M.js";import"./jsonUtils-aUmUTP_F.js";import"./defaults-CIM29kXM.js";import"./defaultsJSON-GKolV7NZ.js";import"./styleUtils-C7rrjuqd.js";import"./jsonUtils-DsFdmTaK.js";import"./LRUCache-ju6LnIBZ.js";import"./MemCache-C6WUx-5V.js";import"./FieldsIndex-DHql50vu.js";import"./UnknownTimeZone-D0GlcniK.js";import"./OverrideHelper-0-cH6aQ2.js";import"./colorUtils-D5nOabzP.js";import"./vec42-B1mBkh1w.js";import"./vec4f64-CBQL1T0x.js";import"./utils-D8D39sLt.js";import"./quantizationUtils-DFd0XKEL.js";import"./HeatmapColorStop-7F2_sZ2U.js";import"./heatmapUtils-C-uT6ZIV.js";import"./SimpleRenderer-FL1Ywtqd.js";import"./layerContainerType-C5CzMsLd.js";import"./FeatureLayerBase-BE0EfCO4.js";import"./inputs-BiRi4vRH.js";import"./Field-poIiHWUc.js";import"./fieldType-CIG5ey7e.js";import"./formUtils-Dni92j4V.js";import"./HeightModelInfo-CzO-kRMK.js";import"./arcgisLayerUrl-ETqee4Bd.js";import"./commonProperties-BTyJ6vjt.js";import"./ElevationInfo-jptbPjRY.js";import"./unitConversionUtils-BUA_O87q.js";import"./featureLayerUtils-t2Um2-kg.js";import"./featureQueryAll-ClGLkoIX.js";import"./Query-BpMwiNVl.js";import"./DataLayerSource-BX7Ap_tY.js";import"./FullTextSearch-BhJOgh_r.js";import"./AttachmentQuery-Ccywtvr9.js";import"./RelationshipQuery-DuLVs9A4.js";import"./LayerFloorInfo-Bx-Ddgjy.js";import"./Relationship-Cktwo5cM.js";import"./serviceCapabilitiesUtils-C8Sa1o3S.js";import"./workers-D8NOwm_V.js";import"./Queue-DpHko4Yk.js";import"./editsZScale-Bh8FjDvn.js";import"./queryZScale-DGW6qDy9.js";import"./projection-tSh-0UvX.js";import"./projectBuffer-iyGwL2dv.js";import"./geodesicConstants-kj1AtlGg.js";import"./FeatureSet-4rZsDUx9.js";import"./APIKeyMixin-DpJrW91V.js";import"./ArcGISService-aI6tC6k0.js";import"./BlendLayer-DmvCcS5c.js";import"./jsonUtils-C4Wp5KpV.js";import"./parser-BN6zmHl-.js";import"./CustomParametersMixin-BStBpako.js";import"./EditBusLayer-BXrQoGfQ.js";import"./uuid-fwrPAdZb.js";import"./FeatureEffectLayer-DB6VToGX.js";import"./FeatureEffect-By-hP1x9.js";import"./FeatureFilter-DqmBE6ye.js";import"./FeatureReductionLayer-DLpK6ddX.js";import"./FeatureReductionSelection-BoaPXZg2.js";import"./labelingInfo-DAjvnaKu.js";import"./labelUtils-Cczy0uDR.js";import"./MD5-C9MwAd2G.js";import"./OperationalLayer-Bq6MAeyc.js";import"./OrderedLayer-DxmkHdYI.js";import"./OrderByInfo-D0jsxwzL.js";import"./PortalLayer-CX96aZTI.js";import"./RefreshableLayer-B26jSd3d.js";import"./ScaleRangeLayer-CKYXLXxK.js";import"./TemporalLayer-DwHwsJsP.js";import"./TimeInterval-DtVUy51q.js";import"./TimeInfo-C84oEL3g.js";import"./FeatureTemplate-DbIjVC84.js";import"./FeatureType-o-GvSMTI.js";import"./fieldProperties-Lf6CXfwL.js";import"./versionUtils-BzPsp3a1.js";import"./styleUtils-BATHgMyw.js";import"./TopFeaturesQuery-CoSK-G18.js";import"./popupUtils-D3OP9u3f.js";import"./utils-Blh5cXWv.js";import"./utils-Bh7lx_TM.js";import"./timeProperties-DTLK6JEV.js";let v=class extends y(d){constructor(t){super(t),this.expression=null,this.returnType="string",this.title=null}};i([n({type:String,json:{write:{isRequired:!0}}})],v.prototype,"expression",void 0),i([n({type:["number","string"],json:{write:!0}})],v.prototype,"returnType",void 0),i([n({type:String,json:{write:!0}})],v.prototype,"title",void 0),v=i([u("esri.webdoc.geotriggersInfo.ExpressionInfo")],v);const K=v,O=new T({deviceLocation:"device-location"});let $=class extends y(d){constructor(t){super(t),this.filterExpression=null,this.type="device-location"}};i([n({type:K,json:{write:!0}})],$.prototype,"filterExpression",void 0),i([n({type:O.apiValues,readOnly:!0,json:{type:O.jsonValues,read:O.read,write:O.write}})],$.prototype,"type",void 0),$=i([u("esri.webdoc.geotriggersInfo.DeviceLocationFeed")],$);const Le=$;let V=class extends y(d){constructor(t){super(t),this.geometry=null,this.where=null}};i([n({types:Ie,json:{read:$e,write:!0}})],V.prototype,"geometry",void 0),i([n({type:String,json:{write:!0}})],V.prototype,"where",void 0),V=i([u("esri.webdoc.geotriggersInfo.FeatureFilter")],V);const Ue=V;let b=class extends y(d){constructor(t){super(t),this.layerId=null,this.layerUrl=null,this.type="feature-layer"}};i([n({type:String,json:{write:{overridePolicy(){return{isRequired:this.layerUrl===null}}}}})],b.prototype,"layerId",void 0),i([n({type:String,json:{write:{overridePolicy(){return{isRequired:this.layerId===null}}}}})],b.prototype,"layerUrl",void 0),i([_({featureLayer:"feature-layer"},{readOnly:!0})],b.prototype,"type",void 0),b=i([u("esri.webdoc.geotriggersInfo.FeatureLayerSource")],b);const Ne=b;let f=class extends y(d){constructor(t){super(t),this.fenceSource=null,this.filter=null,this.bufferDistance=null,this.type="features"}};i([n({type:Ne,json:{write:{isRequired:!0}}})],f.prototype,"fenceSource",void 0),i([n({type:Ue,json:{write:!0}})],f.prototype,"filter",void 0),i([n({type:Number,json:{write:!0}})],f.prototype,"bufferDistance",void 0),i([_({features:"features"},{readOnly:!0})],f.prototype,"type",void 0),f=i([u("esri.webdoc.geotriggersInfo.FeatureFenceParameters")],f);const Fe=f;let L=class extends y(d){constructor(t){super(t),this.type="fence"}};i([_({fence:"fence"},{readOnly:!0})],L.prototype,"type",void 0),L=i([u("esri.webdoc.geotriggersInfo.Geotrigger")],L);const Q=L;let x=class extends y(d){constructor(t){super(t),this.expressionInfo=null,this.requestedActions=null}};i([n({type:K,json:{write:!0}})],x.prototype,"expressionInfo",void 0),i([n({type:[String],json:{write:!0}})],x.prototype,"requestedActions",void 0),x=i([u("esri.webdoc.geotriggersInfo.GeotriggerNotificationOptions")],x);const Te=x,ke=new T({enterContainsAndExitDoesNotContain:"enter-contains-and-exit-does-not-contain",enterContainsAndExitDoesNotIntersect:"enter-contains-and-exit-does-not-intersect",enterIntersectsAndExitDoesNotIntersect:"enter-intersects-and-exit-does-not-intersect"}),Ge=new T({useGeometry:"use-geometry",useGeometryWithAccuracy:"use-geometry-with-accuracy"}),E=new T({enter:"enter",enterOrExit:"enter-or-exit",exit:"exit"});let c=class extends Q{constructor(t){super(t),this.enterExitRule="enter-contains-and-exit-does-not-intersect",this.feed=null,this.feedAccuracyMode="use-geometry",this.fenceNotificationRule=null,this.fenceParameters=null,this.name=null,this.notificationOptions=null,this.type="fence"}};i([_(ke)],c.prototype,"enterExitRule",void 0),i([n({type:Le,json:{write:{isRequired:!0}}})],c.prototype,"feed",void 0),i([_(Ge)],c.prototype,"feedAccuracyMode",void 0),i([n({type:E.apiValues,json:{type:E.jsonValues,read:E.read,write:{writer:E.write,isRequired:!0}}})],c.prototype,"fenceNotificationRule",void 0),i([n({type:Fe,json:{write:{isRequired:!0}}})],c.prototype,"fenceParameters",void 0),i([n({type:String,json:{write:!0}})],c.prototype,"name",void 0),i([n({type:Te,json:{write:!0}})],c.prototype,"notificationOptions",void 0),i([_({fence:"fence"},{readOnly:!0})],c.prototype,"type",void 0),c=i([u("esri.webdoc.geotriggersInfo.FenceGeotrigger")],c);const Be=c,De={base:Q,key:"type",typeMap:{fence:Be}};let U=class extends y(d){constructor(e){super(e),this.geotriggers=null}};i([n({types:[De],json:{write:{isRequired:!0}}})],U.prototype,"geotriggers",void 0),U=i([u("esri.webdoc.GeotriggersInfo")],U);const Je=U;var B;let A=B=class extends d{constructor(e){super(e),this.activeRange=null,this.currentRangeExtent=null,this.fullRangeExtent=null}clone(){return new B(z({activeRange:this.activeRange,currentRangeExtent:this.currentRangeExtent,fullRangeExtent:this.fullRangeExtent}))}};i([n({type:String,nonNullable:!0,json:{read:{source:"activeRangeName"},write:{target:"activeRangeName",isRequired:!0}}})],A.prototype,"activeRange",void 0),i([n({type:[Number],json:{write:!0}})],A.prototype,"currentRangeExtent",void 0),i([n({type:[Number],json:{write:!0}})],A.prototype,"fullRangeExtent",void 0),A=B=i([u("esri.webdoc.RangeInfo")],A);const Z=A;function Me(e,t){var r;return t.resourceInfo?X(t,t.resourceInfo,{origin:e.origin}):(r=t.portalItem)!=null&&r.id?qe(e,t,t.portalItem):Promise.resolve()}function X(e,t,r){const o={context:{...r,layerContainerType:"operational-layers"}};return e.portalItem&&(o.context.portal=e.portalItem.portal||pe.getDefault()),M(()=>import("./layersCreator-pwoFFBtV.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]),import.meta.url).then(({populateOperationalLayers:s})=>{const l=[],m=t.operationalLayers;m!=null&&m.length&&l.push(s(e.layers,m,o));const p={...o,context:{...o.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"},h=t.tables;return h!=null&&h.length&&l.push(s(e.tables,h,p)),Promise.allSettled(l).then(()=>{})})}async function qe(e,t,r){var m;if(await r.load().catch(p=>{throw new N(`${e.name}:load-portal-item`,"Failed to load portal item",{error:p})}),r.type!==e.itemType)throw new N(`${e.name}:invalid-portal-item`,`Invalid portal item type '${r.type}', expected '${e.itemType}'`,{type:r.type});const o=await r.fetchData();t.resourceInfo=o;const s=xe(r,e.origin);await Ce(e,t,o,s),t.resourceReferences={portalItem:r,paths:s.readResourcePaths};const l=await We(t.initialViewProperties,r,G.getLogger(t));if(l){const p=((m=t.initialViewProperties)==null?void 0:m.clone())??e.createInitialViewProperties();p.viewpoint=l,t.initialViewProperties=p}}function Ce(e,t,r,o){const s=Ze(e,r);return t.read(s,o),X(t,s,o)}function Ze(e,t){const r=e.parseVersion(t.version||"",e.name);return e.currentVersion.validate(r),t.version=`${r.major}.${r.minor}`,t}async function We(e,t,r){var l;if((l=e==null?void 0:e.viewpoint)==null?void 0:l.targetGeometry)return null;const s=await ze(e,t,r);return s?new P({targetGeometry:s}):null}async function ze(e,t,r){const o=e==null?void 0:e.spatialReference,s=t==null?void 0:t.extent;if(!o||!s)return null;if(o.isWGS84)return s.clone();if(o.isWebMercator)return fe(s);const{getGeometryServiceURL:l}=await M(()=>import("./geometryServiceUtils-C-iODloP.js"),__vite__mapDeps([30,4,13,9,10,2,3,8,14,15,16,17,18,31,32,26,25,33,34]),import.meta.url);try{const m=await l(t),p=new Re({geometries:[s],outSpatialReference:o});return(await Pe(m,p))[0]}catch(m){r.error("Error projecting item's extent:",m)}return null}var D;let S=D=class extends d{constructor(e){super(e),this.editing=null,this.offline=null,this.viewing=null}clone(){return new D(z({editing:this.editing,offline:this.offline,viewing:this.viewing}))}};i([n({json:{write:!0}})],S.prototype,"editing",void 0),i([n({json:{write:!0}})],S.prototype,"offline",void 0),i([n({type:Ae,json:{write:!0}})],S.prototype,"viewing",void 0),S=D=i([u("esri.webmap.ApplicationProperties")],S);const He=S;let g=class extends y(ue){constructor(e){super(e),this.background=null,this.rangeInfo=null,this.spatialReference=null,this.timeZone=ye,this.viewpoint=null}};i([n({type:C})],g.prototype,"background",void 0),i([n({type:Z})],g.prototype,"rangeInfo",void 0),i([n({type:q})],g.prototype,"spatialReference",void 0),i([n({nonNullable:!0})],g.prototype,"timeZone",void 0),i([n({type:P})],g.prototype,"viewpoint",void 0),g=i([u("esri.webmap.InitialViewProperties")],g);const F=g;class I extends Ee{constructor(t,r){super(t,r,"webmap")}}const R=new I(2,31),Ke="Web Map",Qe="webmap",J="web-map",Y=H.ofType(Oe),Xe=H.ofType(we),Ye=new Map([["image/jpeg","jpeg"],["image/jpg","jpg"],["image/png","png"],["image/gif","gif"]]),et="ArcGIS Pro",tt=be.JSAPI,k={currentVersion:R,createInitialViewProperties:()=>new F,parseVersion:I.parse,itemType:Ke,name:Qe,origin:J};let a=class extends de(le.LoadableMixin(ge(ne))){constructor(e){super(e),this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1,this._thumbnailFilename=null,this._updateFromPromise=null,this.resourceReferences={portalItem:null,paths:[]},this.applicationProperties=null,this.bookmarks=new Y,this.floorInfo=null,this.geotriggersInfo=null,this.initialViewProperties=new F,this.ipsInfo=null,this.portalItem=null,this.presentation=null,this.sourceVersion=null,this.widgets=null,this.utilityNetworks=null,this._debouncedSaveOperations=ce(async(t,r,o)=>{const{save:s,saveAs:l}=await M(()=>import("./webdocSaveUtils-DYnNg7f2.js"),__vite__mapDeps([35,9,10,4,36,2,3,8,1,5,37,38,18,15,16,11,12,22,13,14,17,19,39,23,24,25,26,27,28,31,32,33,34,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54]),import.meta.url);switch(t){case j.SAVE:return s(k,this,r);case j.SAVE_AS:return l(k,this,o,r)}}),this.authoringApp=this.authoringAppVersion=null,this._isAuthoringAppSetByUser=this._isAuthoringAppVersionSetByUser=!1}destroy(){if(this.portalItem=he(this.portalItem),this.utilityNetworks){const e=this.utilityNetworks.removeAll();for(const t of e)t.destroy();this.utilityNetworks.destroy()}}initialize(){if(this.when().catch(e=>{G.getLogger(this).error("#load()","Failed to load web map",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(t){return void this.addResolvingPromise(Promise.reject(t))}this.read(e)}}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,t){e&&this._isAuthoringAppSetByUser?t.authoringApp=e:t.authoringApp=tt}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,t){e&&this._isAuthoringAppVersionSetByUser?t.authoringAppVersion=e:t.authoringAppVersion=ee}readInitialViewProperties(e,t){var s;const r=new F;t.background&&(r.background=C.fromJSON(t.background));const o=(s=t.initialState)==null?void 0:s.viewpoint;return o&&(o.rotation&&I.parse(t.version||"","webmap").lessThan(2,20)&&t.authoringApp===et&&(o.rotation*=-1),r.viewpoint=P.fromJSON(o)),t.mapRangeInfo&&(r.rangeInfo=Z.fromJSON(t.mapRangeInfo)),t.spatialReference&&(r.spatialReference=q.fromJSON(t.spatialReference)),t.timeZone&&(r.timeZone=t.timeZone),r}writeInitialViewProperties(e,t,r,o){var s;e&&((s=e.background)!=null&&s.color&&(t.background=e.background.write({},o)),e.viewpoint&&(t.initialState={viewpoint:e.viewpoint.write({},o)}),e.rangeInfo&&(t.mapRangeInfo=e.rangeInfo.toJSON(o)),e.spatialReference&&(t.spatialReference=e.spatialReference.write({},o)),t.timeZone=e.timeZone)}writeLayers(e,t,r,o){t[r]=this._writeLayers(e,o,"operational-layers")}readSourceVersion(e,t){const[r,o]=t.version.split(".");return new I(parseInt(r,10),parseInt(o,10))}writeSourceVersion(e,t,r){t[r]=`${R.major}.${R.minor}`}writeTables(e,t,r,o){const s=this._writeLayers(e,o,"tables");s.length&&(t[r]=s)}get thumbnailUrl(){var e;return((e=this.portalItem)==null?void 0:e.thumbnailUrl)||null}set thumbnailUrl(e){e?(this._override("thumbnailUrl",e),this._thumbnailFilename=this._generateCustomThumbnailFilename(e)):this._clearThumbnailOverride()}get updatingFromView(){return!!this._updateFromPromise}load(e){return this.addResolvingPromise(Me(k,this)),Promise.resolve(this)}loadAll(){return me(this,e=>{e(this.ground,this.basemap,this.layers,this.tables)})}read(e,t){t={...t,origin:J};const r=this._getAuthoringPropsState();te(this,e,o=>super.read(e,o),t),this._restoreAuthoringPropsFromState(r)}write(e,t){if(this.loadStatus!=="loaded"){const r=new N("webmap:not-loaded","Web map must be loaded before it can be serialized");throw G.getLogger(this).error("#toJSON()","Web map must be loaded before it can be serialized",this.loadError||this.loadStatus),r}return this._removeDanglingLayerRefs(),t={...t,origin:J,restrictedWebMapWriting:!0,webmap:this},super.write(e,t)}async save(e){return this._debouncedSaveOperations(j.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations(j.SAVE_AS,t,e)}async updateFrom(e,t){const r=this._updateFromInternal(e,t);this._updateFromPromise=r,await r,r===this._updateFromPromise&&(this._updateFromPromise=null)}getLayerJSONFromResourceInfo(e){var r,o,s,l;const t=this.resourceInfo;return this._collectAllLayersJSON([...((r=t==null?void 0:t.baseMap)==null?void 0:r.baseMapLayers)||[],...(t==null?void 0:t.operationalLayers)||[],...((l=(s=(o=this.basemap)==null?void 0:o.resourceInfo)==null?void 0:s.data)==null?void 0:l.baseMapLayers)||[]]).find(m=>m.id===e.id)}async updateItemThumbnail(){var e;this.thumbnailUrl&&this._isOverridden("thumbnailUrl")&&(await((e=this.portalItem)==null?void 0:e.updateThumbnail({thumbnail:this.thumbnailUrl,filename:this._thumbnailFilename})),this._clearThumbnailOverride())}getThumbnailState(){let e=this.thumbnailUrl;return e&&(e=this._isOverridden("thumbnailUrl")?e:re(e,"w","8192")),{thumbnailUrl:e,filename:this._thumbnailFilename}}restoreThumbnailFromState(e){this.thumbnailUrl=e.thumbnailUrl,this._thumbnailFilename=e.filename}_collectAllLayersJSON(e){return e.reduce((t,r)=>(t.push(r),r.layerType==="GroupLayer"&&(t=t.concat(this._collectAllLayersJSON(r.layers||[]))),t),[])}_writeLayers(e,t,r){return t={...t,layerContainerType:r},e.map(o=>je(o,r==="tables"?null:this.getLayerJSONFromResourceInfo(o),t)).filter(se).toArray()}_validateJSON(e){const t=I.parse(e.version||"","webmap");return R.validate(t),e.version=`${t.major}.${t.minor}`,e}_removeDanglingLayerRefs(){var s,l,m;const e=this.applicationProperties,t=(s=e==null?void 0:e.viewing)==null?void 0:s.search,r=p=>this.allLayers.some(h=>h.id===p);if(t!=null&&t.layers&&(t.layers=t.layers.filter(p=>r(p.id))),t!=null&&t.tables&&(t.tables=t.tables.filter(p=>this.tables.some(h=>h.id===p.id))),e){const p=(l=e.editing)==null?void 0:l.locationTracking;p!=null&&p.info&&!r(p.info.layerId)&&(e.editing=null)}const o=(m=this.presentation)==null?void 0:m.slides;o&&o.forEach(p=>{p.visibleLayers&&(p.visibleLayers=p.visibleLayers.filter(h=>r(h.id)))})}async _updateFromInternal(e,t){if(t??(t={}),await ae(()=>e.ready),this._updateInitialViewProperties(e,t),e.map===this)for(const r of e.allLayerViews)"visible"in r&&"visible"in r.layer&&r._isOverridden("visible")&&(r.layer.visible=r.visible),"featureEffect"in r&&"featureEffect"in r.layer&&r._isOverridden("featureEffect")&&(r.layer.featureEffect=r.featureEffect);await this._updateThumbnailUrl(e,t)}_updateInitialViewProperties(e,t){var r,o;if(t.backgroundExcluded||(this.initialViewProperties.background=(r=e.background)==null?void 0:r.clone()),this.initialViewProperties.spatialReference=(o=e.spatialReference)==null?void 0:o.clone(),this.initialViewProperties.timeZone=e.timeZone,t.viewpointExcluded||(this.initialViewProperties.viewpoint=new P({rotation:e.rotation,scale:t.scalePreserved?e.scale:null,targetGeometry:this._getViewExtent(e)})),!t.widgetsExcluded)for(const s of e.persistableViewModels)s.updateWebDocument(this)}_getViewExtent(e){const t=e.center.clone().normalize(),r=e.extent.clone(),o=r.width/2;return r.xmin=t.x-o,r.xmax=t.x+o,r}async _updateThumbnailUrl(e,t){if(t.thumbnailExcluded)return;const r=Se(e,t.thumbnailSize),o=await e.takeScreenshot({format:"png",width:r.width,height:r.height});this._setAutoGeneratedThumbnail(o.dataUrl)}_setAutoGeneratedThumbnail(e){this.thumbnailUrl=e,this._thumbnailFilename=null}_clearThumbnailOverride(){this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"),this._thumbnailFilename=null}_generateCustomThumbnailFilename(e){if(ie(e)){const t=oe(e),r=t==null?void 0:t.mediaType,o=r&&Ye.get(r.toLowerCase())||null,s=`thumbnail${Date.now()}`;return o?`${s}.${o}`:s}return null}_getAuthoringPropsState(){return{authoringApp:this.authoringApp,authoringAppVersion:this.authoringAppVersion,isAuthoringAppSetByUser:this._isAuthoringAppSetByUser,isAuthoringAppVersionSetByUser:this._isAuthoringAppVersionSetByUser}}_restoreAuthoringPropsFromState(e){e.isAuthoringAppSetByUser?this.authoringApp=e.authoringApp:this._isAuthoringAppSetByUser=!1,e.isAuthoringAppVersionSetByUser?this.authoringAppVersion=e.authoringAppVersion:this._isAuthoringAppVersionSetByUser=!1}static fromJSON(e){const t=e;if(!t)throw new N("webmap:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:t})}};a.VERSION=R,i([n()],a.prototype,"_updateFromPromise",void 0),i([n({type:He,json:{write:!0}})],a.prototype,"applicationProperties",void 0),i([n({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],a.prototype,"authoringApp",null),i([w("authoringApp")],a.prototype,"writeAuthoringApp",null),i([n({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],a.prototype,"authoringAppVersion",null),i([w("authoringAppVersion")],a.prototype,"writeAuthoringAppVersion",null),i([n({type:Y,json:{write:{overridePolicy:e=>({enabled:!!(e&&e.length>0),ignoreOrigin:!0})}}})],a.prototype,"bookmarks",void 0),i([n({type:_e,json:{name:"mapFloorInfo",write:!0}})],a.prototype,"floorInfo",void 0),i([n({type:Je,json:{write:!0}})],a.prototype,"geotriggersInfo",void 0),i([n({type:F,nonNullable:!0,json:{read:{source:["background","initialState.viewpoint","mapRangeInfo","spatialReference","timeZone"]},write:{ignoreOrigin:!0,target:{background:{type:C},"initialState.viewpoint":{type:P},mapRangeInfo:{type:Z},spatialReference:{type:q},"timeZone:":{type:String}}}}})],a.prototype,"initialViewProperties",void 0),i([W("initialViewProperties")],a.prototype,"readInitialViewProperties",null),i([w("initialViewProperties")],a.prototype,"writeInitialViewProperties",null),i([n({json:{write:!0,name:"mapIPSInfo"}})],a.prototype,"ipsInfo",void 0),i([n({json:{read:!1,write:{target:"operationalLayers",ignoreOrigin:!0}}})],a.prototype,"layers",void 0),i([w("layers")],a.prototype,"writeLayers",null),i([n({type:ve})],a.prototype,"portalItem",void 0),i([n({json:{write:!0}})],a.prototype,"presentation",void 0),i([n()],a.prototype,"resourceInfo",void 0),i([n({readOnly:!0,type:I,json:{read:{source:"version"},write:{allowNull:!0,ignoreOrigin:!0,target:"version",isRequired:!0}}})],a.prototype,"sourceVersion",void 0),i([W("sourceVersion")],a.prototype,"readSourceVersion",null),i([w("sourceVersion")],a.prototype,"writeSourceVersion",null),i([n({json:{read:!1,write:{ignoreOrigin:!0}}})],a.prototype,"tables",void 0),i([w("tables")],a.prototype,"writeTables",null),i([n()],a.prototype,"thumbnailUrl",null),i([n()],a.prototype,"updatingFromView",null),i([n({type:Ve,json:{write:!0}})],a.prototype,"widgets",void 0),i([n({type:Xe,json:{read:!0,write:!0}})],a.prototype,"utilityNetworks",void 0),a=i([u("esri.WebMap")],a);const ao=a;export{ao as default};
