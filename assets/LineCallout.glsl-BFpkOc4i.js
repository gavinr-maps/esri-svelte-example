const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Graphics3DSymbolLayerFactory-Cz7ZA1xS.js","./Accessor-BHnuXKD2.js","./NormalUtils.glsl-CV524hT5.js","./reactiveUtils-BR0C1Kq4.js","./Evented-DCWccWGU.js","./SimpleObservable-7oieNGD8.js","./earcut-Lltz9D9k.js","./mat4f64-Dk4dwAN8.js","./vec32-Dvg_eL9J.js","./vec3f64-BLpZdpfb.js","./common-DQOJ18NT.js","./Point-XGrwlf63.js","./cast-BA_-jlhc.js","./index-tefRSezt.js","./index-Cx51aysm.css","./JSONSupport-CGdeqxpk.js","./writer-B2bQV2uU.js","./computeTranslationToOriginAndRotation-BT43Xu5d.js","./mathUtils-DV9iOXpW.js","./mat4-Fi6iAz29.js","./projectBuffer-DOU0xvVi.js","./geodesicConstants-yASAK_zX.js","./aaBoundingBox-CeBivBRq.js","./Extent-CBBGeHb-.js","./Polyline-BmuD2-ZN.js","./Indices-Db9lERgy.js","./vec3-Bn81gjoR.js","./colorUtils-Rxh2V3ai.js","./ViewingMode-Dodu7ZZk.js","./ElevationContext-jcnAn7VT.js","./dehydratedFeatureUtils-1rrRm6hF.js","./ElevationProvider-aS5xrHHy.js","./VertexAttribute-Cq4MnHjR.js","./unitConversionUtils-C4AR5obr.js","./lengthUtils-DjJgJFRg.js","./hydratedFeatures-BVVSs98j.js","./Graphic-CFXUQZlS.js","./Clonable-DvJsj5LF.js","./opacityUtils-CSd4XoR2.js","./Promise-CmQqe-ke.js","./enumeration-Cr5WIZs4.js","./Color-gncXBiLc.js","./ActionToggle-__-l4AdQ.js","./Identifiable-BrT7zvUW.js","./jsonUtils-Cu7OBRmN.js","./typeUtils-BSg8Y507.js","./TextSymbol-BQ_NW9Xo.js","./screenUtils-_ZIvrt5o.js","./collectionUtils-CbaToa73.js","./Portal-CTRRujjZ.js","./projectVectorToVector-dS8io47t.js","./projectPointToVector-BS0u8fq6.js","./projection-B2I9Bzj_.js","./mat3-CR8GKnhD.js","./mat3f64-BBpwCtoL.js","./SnappingCandidate-O5eRSE6e.js","./graphicUtils-Daa6cjYT.js","./vec42-YcqnINSP.js","./vec4f64-o2zAXfmz.js","./meshVertexSpaceUtils-SW0WEjNN.js","./MeshLocalVertexSpace-C0YDTRex.js","./triangulationUtils-ChyeOnqC.js","./plane-4dpuo6-e.js","./quatf64-CCm9z-pX.js","./vec2f64-Dy6m9Nrb.js","./mathUtils-B9R7G-2c.js","./deduplicate-8uOXlcvp.js","./Attribute-B-NAci_J.js","./Material-Ba8x5bbY.js","./boundedPlane-Dyz2ub5d.js","./sphere-DQxj5tsv.js","./lineSegment-C-CDF7QX.js","./NoParameters-t-PuNrgq.js","./FloatArray-BCfeX8wo.js","./BindType-BBwFZqyN.js","./Matrix3PassUniform-Bhi2fM3C.js","./Texture-D-SqNa4i.js","./signal-DSa0yokC.js","./enums-D9v74xTE.js","./getDataTypeBytes-BTGR5GyG.js","./renderState-e7QeQoUO.js","./basicInterfaces-CZwQPxTp.js","./InterleavedLayout-Dvj-Snan.js","./BufferView-_QDXRCew.js","./vec2-maR1OrZI.js","./types-D0PSWh4d.js","./triangle-D_E6eTS3.js","./ShaderTechniqueConfiguration-YrUOztAU.js","./glsl-BH37Aalp.js","./requestImageUtils-Brn0e8z8.js","./TextureFormat-1mYWTFa-.js","./edgeUtils-52Urp6s4.js","./floatRGBA-CR2j2c7-.js","./NormalAttribute.glsl-BPQl43kJ.js","./RgbaFloatEncoding.glsl-_io2eW3M.js","./Float4DrawUniform-C_Hqa-pI.js","./Matrix3DrawUniform-B_gSHO7v.js","./OverlayCompositing.glsl-BbJKjUZQ.js","./GridLocalOriginFactory-BvhZ_UoU.js","./RibbonLine.glsl-D3IEIaDR.js","./sdfPrimitives-B8Jbwvqs.js","./doublePrecisionUtils-B0owpBza.js","./Octree-B-jwmuW2.js","./ShaderBuilder-DV1s2efh.js","./SceneLighting-fZH2UQ_L.js","./RenderCamera-BovI3JTe.js","./axisAngleDegrees-8Sw4vC28.js","./quat-4pa1e6ds.js","./weather-DtiKeY2t.js","./BooleanBindUniform-xvVHJCDz.js","./RenderPlugin-B2sz29jJ.js","./HighlightDefaults-ESbuT2uR.js","./VertexElementDescriptor-BOD-G50G.js","./VertexArrayObject-DcVjXzZo.js","./BufferObject-CIl3vJtA.js","./memoryEstimations-5gFNwkKK.js","./NestedMap-GuqgquCN.js","./HUDRenderStyle-BhGvVxgm.js","./Scheduler-B_GuBefw.js","./debugFlags-ZrDyTcDc.js","./Normals-OOhKYumi.js","./DefaultMaterial-B5sYRDQR.js","./GLTextureMaterial-BXvkeRxQ.js","./DefaultBufferWriter-D4XUxbP-.js","./verticalOffsetUtils-CUH6QZ7-.js","./orientedBoundingBox-9z4w3ZAL.js","./spatialReferenceEllipsoidUtils-DM073JUd.js","./VertexColor.glsl-C67vI27I.js","./Matrix4PassUniform-LFIUaE9i.js","./VerticalOffset.glsl-0YVQE7vQ.js","./Matrix4sPassUniform--uPzDbTP.js","./Float2PassUniform-Blij1ug3.js","./CameraSpace.glsl-BZ4Eapt3.js","./fontUtils-D0SfAiSy.js","./CIMSymbolHelper-Vkq7AVTn.js","./BidiEngine-DNnuvc1i.js","./OptimizedGeometry-7IxBWtHr.js","./GeometryUtils-B5FJlfZD.js","./enums-BJSSbDkD.js","./utils-B91u8350.js","./defaultCIMValues-DII_GG3u.js","./rasterizingUtils-5QTNbyfl.js","./definitions-LJaw2n5Z.js","./mat2d-D9DBP-jx.js","./mat2df32-orApM5a3.js","./vec2f32-BbH2jxlN.js","./Rect-CUzevAry.js","./BoundingBox-CnpCxTZE.js","./defaults-Dwxdhopq.js","./defaultsJSON-GKolV7NZ.js","./cimSymbolUtils-azhJhO4Y.js","./utils-9nq77ifz.js","./jsonUtils-TjZmCq6l.js","./utils-DYurMneM.js","./mat4f32-DcsiF_Rp.js","./LRUCache-DS2O1kTf.js","./MemCache-CDoaVBHf.js","./DepthRange-C25RnOB3.js","./GeometryUtil-vHI0hYMT.js","./vec3f32-nZdmKIgz.js","./HUDMaterial-DRUv4rua.js","./HUDVisibility.glsl-DSeZY4v-.js","./line-CTiLAMHp.js","./line-BVlGDkwe.js","./LineMarker.glsl-DDT-WuAq.js","./lineStippleUtils-C89mzWlO.js","./projectVectorToPoint-d6Mr4zvQ.js","./MeshComponent-Csew-urT.js","./imageUtils-brik-GLm.js","./meshProperties-C4iW0Ukm.js","./vertexSpaceConversion-Dbe11h0o.js","./vec4-DcW4fpPA.js","./projectMeshVertexPositions-Ap141qsf.js","./interfaces-DkjgzG8v.js","./resourceUtils-SMgkqOp7.js","./objectResourceUtils-Yt1WQRx6.js","./devEnvironmentUtils-CnNDiFMM.js","./indexUtils-Cyox7Wyy.js","./DefaultLoadingContext-b8vwa5ZD.js","./wosrLoader-F8PxTYxV.js","./Version-9k2AOv05.js","./DefaultLayouts-RacFqL-X.js","./RealisticTree.glsl-BIYA2y1x.js","./Intersector-DqUGp7Vs.js","./intersectorUtils-l6zkk4nF.js","./Intersector-DPK4WnQE.js","./styleUtils-BB-zx7mT.js","./webStyleSymbolUtils-DEYm8EyF.js","./jsonUtils-Dzgxk9pw.js","./layerUtils-dJgsXxkC.js","./webStyleAcceptedFormats-CG7ZQ6BV.js","./LodRenderer-DrfQ8MMz.js","./glUtil-D0YUa0ow.js","./ColorMaterial.glsl-CArPvmMs.js","./TriangleMaterial-t01j2IAH.js","./visualVariableUtils-Bp9QCb8E.js","./projectBoundingRect-BA_jRNoI.js","./dehydratedFeatures-Nwhn-hep.js","./quantizationUtils-2Az-xHPA.js","./Field-Cyk7Ur5d.js","./fieldType-L-VlbZqy.js","./featureConversionUtils-DpmsPUmt.js","./OptimizedFeature-DcMLlxvB.js","./OptimizedFeatureSet-Blu9Ckm7.js"])))=>i.map(i=>d[i]);
import{h as k}from"./Color-gncXBiLc.js";import{R as Me}from"./visualVariableUtils-Bp9QCb8E.js";import{n as ce}from"./vec2f64-Dy6m9Nrb.js";import{s as Ne,E as be,u as Ve,P as qe,c as ke,g as ue,p as ve,o as He}from"./vec32-Dvg_eL9J.js";import{n as S,s as yt}from"./vec3f64-BLpZdpfb.js";import{O as mt,V as ft}from"./plane-4dpuo6-e.js";import{aO as ae,E as gt,i as bt,B as We,r as D,c1 as vt,M as _t,a8 as St,c2 as Pt,a5 as Et,D as _e,G as Ot,a6 as N,a3 as Lt,a4 as Se,F as xt}from"./Accessor-BHnuXKD2.js";import{F as $t,a0 as At,a1 as Ct}from"./Graphic-CFXUQZlS.js";import{u as Pe}from"./screenUtils-_ZIvrt5o.js";import{r as Ze,s as H,n as wt}from"./vec4f64-o2zAXfmz.js";import{n as X}from"./mat4-Fi6iAz29.js";import{e as Qe}from"./mat4f64-Dk4dwAN8.js";import{m as Xe}from"./computeTranslationToOriginAndRotation-BT43Xu5d.js";import{o as M}from"./projectBuffer-DOU0xvVi.js";import{l as Dt,c as Ft,o as ne,e as Tt,h as I,E as Rt,R as It,p as Ye,m as zt,i as Ee,s as Gt}from"./ElevationContext-jcnAn7VT.js";import{t as W,n as jt,b as Ut,e as Bt}from"./Material-Ba8x5bbY.js";import{r as Mt}from"./ElevationProvider-aS5xrHHy.js";import"./Indices-Db9lERgy.js";import{ac as Y,l as Nt,i as Vt,v as qt,o as kt,s as Oe,a as Le,c as xe,m as Ht,t as Wt,E as Zt,A as J,r as $e,e as Qt,f as Xt}from"./FloatArray-BCfeX8wo.js";import"./triangle-D_E6eTS3.js";import{t as Ae}from"./basicInterfaces-CZwQPxTp.js";import"./vec42-YcqnINSP.js";import{e as m}from"./VertexAttribute-Cq4MnHjR.js";import{q as Yt,p as Jt,h as Kt,a as Je,j as er,a3 as tr,u as rr,H as sr}from"./Polyline-BmuD2-ZN.js";import{E as ir,A as K,b as Ke}from"./graphicUtils-Daa6cjYT.js";import{c as he}from"./projectPointToVector-BS0u8fq6.js";import{S as ar,Z as nr,u as or,v as lr,q as oe,p as cr,R as ur,V as hr,f as dr,L as pr,M as yr,T as mr,w as fr}from"./aaBoundingBox-CeBivBRq.js";import{e as et}from"./projectVectorToVector-dS8io47t.js";import{A as gr}from"./RibbonLine.glsl-D3IEIaDR.js";import{t as ee}from"./Attribute-B-NAci_J.js";import{t as G}from"./vec2f32-BbH2jxlN.js";import{H as br}from"./InterleavedLayout-Dvj-Snan.js";import{u as Ce}from"./Matrix3PassUniform-Bhi2fM3C.js";import{b as vr,O as _r,a as Sr}from"./DefaultBufferWriter-D4XUxbP-.js";import{_ as tt}from"./index-tefRSezt.js";import{O as we,R as V}from"./enums-D9v74xTE.js";import{B as Pr,p as Er,r as Or,g as Lr}from"./renderState-e7QeQoUO.js";import{i as F}from"./ShaderTechniqueConfiguration-YrUOztAU.js";import{e as rt}from"./reactiveUtils-BR0C1Kq4.js";import{e as xr}from"./memoryEstimations-5gFNwkKK.js";import{o as De,l as $r}from"./vec2-maR1OrZI.js";import{i as Ar}from"./projectBoundingRect-BA_jRNoI.js";import{c as Cr}from"./Point-XGrwlf63.js";import{z as wr}from"./dehydratedFeatures-Nwhn-hep.js";import{s as Dr}from"./featureConversionUtils-DpmsPUmt.js";import{U as Fr}from"./sphere-DQxj5tsv.js";import{A as Fe,c as Tr}from"./edgeUtils-52Urp6s4.js";import{l as Rr}from"./ViewingMode-Dodu7ZZk.js";import{e as Ir}from"./webStyleAcceptedFormats-CG7ZQ6BV.js";import{m as zr,B as Gr,e as jr,f as Ur,a as Te,F as Br,s as Mr}from"./GeometryUtil-vHI0hYMT.js";import{h as Nr,f as Vr,l as qr,a as kr}from"./RealisticTree.glsl-BIYA2y1x.js";import{z as Hr}from"./DefaultMaterial-B5sYRDQR.js";import{g as Wr,C as Zr}from"./Scheduler-B_GuBefw.js";import"./BindType-BBwFZqyN.js";import{n as x,t as B}from"./glsl-BH37Aalp.js";import"./HUDRenderStyle-BhGvVxgm.js";import{i as Qr}from"./ShaderBuilder-DV1s2efh.js";import{l as Xr,u as Yr,n as Jr}from"./HUDVisibility.glsl-DSeZY4v-.js";import{o as Kr}from"./VerticalOffset.glsl-0YVQE7vQ.js";import{e as es}from"./Float2PassUniform-Blij1ug3.js";let de=class{constructor(e,t){this.renderer=e,this.symbol=t}};function ts(s,e){if(s.symbol!=null)return s.symbol;const t=e==null?void 0:e.renderer;return t!=null&&t.type!=="dot-density"?t.getSymbol(s,e):null}function Yi(s,e){const t=ts(s,e);if(t==null)return null;const r=e==null?void 0:e.renderer,i=new de(r,t);if(r==null||!("visualVariables"in r)||!r.visualVariables)return i;const n=Me(r,s,e)??[],a=["proportional","proportional","proportional"];for(const{variable:o,value:u}of n)switch(o.type){case"color":i.color=u.toRgba();break;case"size":if(o.target==="outline")i.outlineSize=u;else{const c=o.axis,l=o.useSymbolValue?"symbol-value":u;switch(c){case"width":a[0]=l;break;case"depth":a[1]=l;break;case"height":a[2]=l;break;case"width-and-depth":a[0]=a[1]=l;break;default:a[0]=a[1]=a[2]=l}}break;case"opacity":i.opacity=u;break;case"rotation":switch(o.axis){case"tilt":i.tilt=u;break;case"roll":i.roll=u;break;default:i.heading=u}}return a[0]==="proportional"&&a[1]==="proportional"&&a[2]==="proportional"||(i.size=a),i}async function rs(s,e){var t;return s.symbol!=null?s.symbol:((t=e==null?void 0:e.renderer)==null?void 0:t.getSymbolAsync(s,e))??null}async function Ji(s,e){const t=await rs(s,e);if(!t)return null;const r=e==null?void 0:e.renderer,i=new de(r,t);if(!r||!("visualVariables"in r)||!r.visualVariables)return i;const n=Me(r,s,e)??[],a=["proportional","proportional","proportional"];for(const{variable:o,value:u}of n)if(o.type==="color")i.color=k.toUnitRGBA(u);else if(o.type==="size")if(o.target==="outline")i.outlineSize=u;else{const c=o.axis,l=o.useSymbolValue?"symbol-value":u;c==="width"?a[0]=l:c==="depth"?a[1]=l:c==="height"?a[2]=l:a[0]=a[1]=c==="width-and-depth"?l:a[2]=l}else o.type==="opacity"?i.opacity=u:o.type==="rotation"&&o.axis==="tilt"?i.tilt=u:o.type==="rotation"&&o.axis==="roll"?i.roll=u:o.type==="rotation"&&(i.heading=u);return(isFinite(a[0])||isFinite(a[1])||isFinite(a[2]))&&(i.size=a),i}function Ki(s,e=0){const t=s[e];return typeof t=="number"&&isFinite(t)?t:null}function ea(s){for(let e=0;e<3;e++){const t=s[e];if(typeof t=="number")return isFinite(t)?t:0}return 0}let ta=class{constructor(e,t,r){this.baseMaterial=e,this.edgeMaterial=t,this.hasSlicePlane=r}},st=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,t,r,i,n,a,o,u=null){this.graphics3DSymbolLayer=e,this.stageObject=t,this._uniqueGeometries=r,this._uniqueMaterials=i,this._sharedResource=n,this.elevationAligner=a,this.elevationContext=o,this._edgeState=u,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const t=e.stage;t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){var t,r;if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),(t=e.renderer.edgeView)==null||t.removeObject(this.stageObject),this.stageObject.dispose(),(r=this._sharedResource)==null||r.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,t){const{stageObject:r,_edgeState:i,_stageLayer:n}=this;if(i==null)return;const a=Re(i.baseMaterial);i.edgeMaterial.objectTransparency!==a&&(i.edgeMaterial.objectTransparency=a,this.resetEdgeObject(t)),n.stage.renderer.withEdgeView(o=>o.updateAllComponentOpacities(r,[e]))}updateHighlights(e){}slicePlaneEnabledChanged(e,t){const{stageObject:r,_edgeState:i,_stageLayer:n}=this;i!=null&&n.stage.renderer.withEdgeView(a=>{a.updateAllComponentMaterials(r,i.edgeMaterial,e,!t),i.hasSlicePlane=e})}setVisibility(e){const{_edgeState:t,stageObject:r,_stageLayer:i}=this;i!=null&&this.visible!==e&&(this._visible=e,r.visible=e,e&&!this._addedToStage&&(i.add(r),this._addedToStage=!0),t!=null&&i.stage.renderer.withEdgeView(n=>{n.hasObject(r)?n.updateObjectVisibility(r,e):e&&this._addOrUpdateEdgeObject(t,n,!1)}))}get visible(){return this._visible}alignWithElevation(e,t,r,i){if(this.elevationAligner==null)return;r!=null&&Dt(this.elevationContext.featureExpressionInfoContext,r);const n=(a,o)=>Ft(a,e,this.elevationContext,t,o);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,t),this.resetEdgeObject(i)}alignWithAbsoluteElevation(e,t,r){const i=(n,a)=>{a.sampledElevation=e,a.verticalDistanceToGround=0,a.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,i,t),this.resetEdgeObject(r)}getCenterObjectSpace(e=S()){return Ne(e,Fr(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(e=or()){const t=this.stageObject.boundingVolumeObjectSpace;return ar(e,t.min),nr(e,t.max),e}computeAttachmentOrigin(e){const t=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(E)&&(be(E,E,t),Ve(e.render.origin,e.render.origin,E),e.render.num++)}async getProjectedBoundingBox(e,t,r,i,n){const a=this.getBoundingBoxObjectSpace(n),o=ss,u=lr(a)?1:o.length;for(let l=0;l<u;l++){const h=o[l];O[0]=a[h[0]],O[1]=a[h[1]],O[2]=a[h[2]],be(O,O,this.stageObject.transformation),T[3*l]=O[0],T[3*l+1]=O[1],T[3*l+2]=O[2]}if(!e(T,0,u))return null;oe(a);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let l=0;l<3*u;l+=3){for(let h=0;h<3;h++)a[h]=Math.min(a[h],T[l+h]),a[h+3]=Math.max(a[h+3],T[l+h]);c&&r.push({location:T.slice(l,l+3),screenSpaceBoundingRect:c})}if(t!=null&&t.service&&this.elevationContext.mode!=="absolute-height"){cr(a,E);const l=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let h=0;if(t.useViewElevation)h=t.service.getElevation(E[0],E[1],l)??0;else try{const y=ir(a,t.service.spatialReference,t);h=await t.service.queryElevation(E[0],E[1],i,y,l)??0}catch{}ur(a,0,0,-this.alignedSampledElevation+h)}return a}addObjectState(e){e.stateType===Ae.Highlight&&e.addObject(this.stageObject,this.stageObject.highlight(e.highlightName)),e.stateType===Ae.MaskOccludee&&e.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeByObject(this.stageObject)}resetEdgeObject(e){const{_edgeState:t,stageObject:r,_stageLayer:i,_visible:n}=this;t!=null&&i.stage.renderer.withEdgeView(a=>{n?this._addOrUpdateEdgeObject(t,a,e):a.removeObject(r)})}_addOrUpdateEdgeObject(e,t,r){const i=Re(e.baseMaterial);e.edgeMaterial.objectTransparency=i,t.addOrUpdateObject3D(this.stageObject,e.edgeMaterial,e.hasSlicePlane,!r).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}};function Re(s){return s.parameters.transparent?Fe.TRANSPARENT:Fe.OPAQUE}const T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],O=S(),E=S(),ss=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],is=3,as=3,ns=10;function ia(s){switch(s){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function os(s,e){const t=(r,i,n=!1)=>new Nr(r.map(a=>{const o=i(a.tesselation);return n&&zr(o),new Vr([new qr(new kr(o))],a.minScreenSpaceRadius)}));switch(s){case"sphere":return t([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>Mr(e,.5,r,!0));case"cube":return t([{tesselation:0,minScreenSpaceRadius:0}],()=>Br(e,1));case"cone":return t(te,r=>Te(e,1,.5,r,!1),!0);case"inverted-cone":return t(te,r=>Te(e,1,.5,r,!0),!0);case"cylinder":return t(te,r=>Ur(e,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return t([{tesselation:0,minScreenSpaceRadius:0}],()=>jr(e,1),!0);case"diamond":return t([{tesselation:0,minScreenSpaceRadius:0}],()=>Gr(e,1),!0);default:return}}const te=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let P=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new it}},pe=class extends P{constructor(e){super(e),this.estimated=!0}},ls=class extends P{constructor(e,t){super(t),this.numComplexities=e}},cs=class extends pe{constructor(e,t){super(t),this.numComplexities=e}},it=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};const at=new pe({});function ua(s){return s.type==="web-style"?at:ye(s.symbolLayers.toArray().map(e=>nt(s,e)))}function ye(s){let e=0,t=0,r=0,i=!1,n=0;const a=new it;for(const o of s)o!=null&&(e+=o.verticesPerFeature,t+=o.verticesPerCoordinate,r+=o.drawCallsPerFeature,a.bytesPerFeature+=o.memory.bytesPerFeature,a.bytesPerFeatureLabel+=o.memory.bytesPerFeatureLabel,a.resourceBytes+=o.memory.resourceBytes,a.draped.bytesPerFeature+=o.memory.bytesPerFeature,a.draped.bytesPerFeatureLabel+=o.memory.bytesPerFeatureLabel,i=i||o.estimated,++n);return i?new cs(n,{verticesPerFeature:e,verticesPerCoordinate:t,drawCallsPerFeature:r,memory:a}):new ls(n,{verticesPerFeature:e,verticesPerCoordinate:t,drawCallsPerFeature:r,memory:a})}function ha(s){const e=ye(s);return e.numComplexities>0&&(e.verticesPerFeature/=e.numComplexities,e.verticesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities),e}const re={};function nt(s,e){var i,n;const t=us(s,e),r=Tr(e)?2:0;switch(e.type){case"extrude":return new P({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:r,memory:t});case"fill":if(s.type==="mesh-3d")return new P({drawCallsPerFeature:r,memory:t});if(e.outline!=null&&e.outline.size>0)return new P({verticesPerFeature:-12,verticesPerCoordinate:9,memory:t});case"water":return new P({verticesPerFeature:-6,verticesPerCoordinate:3,memory:t});case"line":return new P({verticesPerFeature:-6,verticesPerCoordinate:6,memory:t});case"object":return(i=e.resource)!=null&&i.href?new pe({verticesPerFeature:100,memory:t}):{...hs(((n=e.resource)==null?void 0:n.primitive)??$t),memory:t};case"path":{let a=0,o=0;switch(e.profile){case"circle":a=ns;break;case"quad":a=4;break;default:return void ae(e.profile)}switch(e.join){case"round":o=is;break;case"miter":case"bevel":o=1;break;default:return}const u=2*a,c=a*o*2,l=c+u;let h=-2*c-u;switch(e.cap){case"none":break;case"butt":case"square":h+=2*(a-1);break;case"round":h+=2*(a*(as-1)*2+a);break;default:return}return new P({verticesPerFeature:h,verticesPerCoordinate:l,memory:t})}case"text":case"icon":return new P({verticesPerFeature:6,memory:t});default:return}}function us(s,e){const t=s.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?f.EXTRUDE_EDGES:f.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?f.FILL_OUTLINE:f.FILL;case"water":return f.FILL;case"line":return e.join==="round"?f.LINE_ROUND:f.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return f.PATH_ROUND_CIRCLE;case"quad":return f.PATH_ROUND_QUAD;default:return void ae(e.profile)}case"miter":case"bevel":switch(e.profile){case"circle":return f.PATH_MITER_CIRCLE;case"quad":return f.PATH_MITER_QUAD;default:return void ae(e.profile)}default:return}case"object":return t?f.OBJECT_POINT:f.OBJECT_POLYGON;case"icon":case"text":return t?f.ICON_POINT:f.ICON_POLYGON;default:return}}function hs(s){const e=re[s];if(e)return e;const t=ds(os(s,new Hr({},{spherical:!0,doublePrecisionRequiresObfuscation:!0})).levels);return re[s]=new P({verticesPerFeature:t}),re[s]}function ds(s){return s.reduce((e,t,r)=>e+t.numVertices*(1/10**r),0)/s.reduce((e,t,r)=>e+1/10**r,0)}const f={ICON_POINT:{bytesPerFeature:2346.460896195398,bytesPerFeatureLabel:3484.7516349999996,resourceBytes:0,draped:{bytesPerFeature:2007.3528529826217,bytesPerFeatureLabel:3522.702025}},ICON_POLYGON:{bytesPerFeature:3677.214053765355,bytesPerFeatureLabel:3502.5355950000003,resourceBytes:0,draped:{bytesPerFeature:3030.3700096053935,bytesPerFeatureLabel:3550.247175}},OBJECT_POINT:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992,resourceBytes:0,draped:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992}},OBJECT_POLYGON:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001,resourceBytes:0,draped:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001}},LINE_MITER:{bytesPerFeature:3252.89170349711,bytesPerFeatureLabel:3554.3931949999997,resourceBytes:0,draped:{bytesPerFeature:2843.5793737736867,bytesPerFeatureLabel:3538.2547083333334}},LINE_ROUND:{bytesPerFeature:3384.080501909172,bytesPerFeatureLabel:3522.6055950000004,resourceBytes:0,draped:{bytesPerFeature:2833.1897218657587,bytesPerFeatureLabel:3532.0680950000005}},PATH_MITER_CIRCLE:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998,resourceBytes:0,draped:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998}},PATH_ROUND_CIRCLE:{bytesPerFeature:42934.88589895749,bytesPerFeatureLabel:3729.49955,resourceBytes:0,draped:{bytesPerFeature:42934.88589895749,bytesPerFeatureLabel:3729.49955}},PATH_MITER_QUAD:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925,resourceBytes:0,draped:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925}},PATH_ROUND_QUAD:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997,resourceBytes:0,draped:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997}},FILL:{bytesPerFeature:3419.9079008788176,bytesPerFeatureLabel:3564.2132483333335,resourceBytes:0,draped:{bytesPerFeature:2910.096178654882,bytesPerFeatureLabel:3554.8655816666665}},FILL_OUTLINE:{bytesPerFeature:5018.088812445781,bytesPerFeatureLabel:3524.8219616666665,resourceBytes:0,draped:{bytesPerFeature:4278.49006198517,bytesPerFeatureLabel:3532.068368333334}},EXTRUDE:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005,resourceBytes:0,draped:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005}},EXTRUDE_EDGES:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337,resourceBytes:0,draped:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337}}};var z,C;(function(s){s[s.RecreateSymbol=0]="RecreateSymbol",s[s.RecreateGraphics=1]="RecreateGraphics",s[s.FastUpdate=2]="FastUpdate"})(z||(z={})),function(s){s[s.Slow=0]="Slow",s[s.Fast=1]="Fast",s[s.Mixed=2]="Mixed",s[s.Loading=3]="Loading",s[s.Undefined=4]="Undefined"}(C||(C={}));let me=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=_.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,t){return this._loadStatus===_.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===_.FAILED?(t&&t(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=_.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=_.FAILED,!gt(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(e,t).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=bt(this._abortController):this._loadStatus===_.LOADING&&(this._loadStatus=_.FAILED),this._loader=null}};var _;(function(s){s[s.LOADING=0]="LOADING",s[s.LOADED=1]="LOADED",s[s.FAILED=2]="FAILED"})(_||(_={}));const L=()=>We.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class ps extends me{constructor(e,t,r,i){super(r.schedule),this.symbol=e,this.symbolLayer=t,this._context=r,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1},this._materials=[],this.logger=L(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=i.renderPriority,this._renderPriorityStep=i.renderPriorityStep,this._elevationContext=new ne,this.complexity=this.computeComplexity(),this.ignoreDrivers=i.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=Ie(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}get usedMemory(){const e=this.complexity;return e==null?0:(this.draped?e.memory.draped:e.memory).bytesPerFeature}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const t=this._drivenProperties,r=Ie(e);return r.color!==t.color||r.opacity!==t.opacity||r.opacityAlwaysOpaque!==t.opacityAlwaysOpaque||r.size!==t.size||r.rotation!==t.rotation}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,t,r,i){const n=e.projectionSuccess,a="polygons"in e?e.polygons:null,o=`${i} geometry failed to be created`;n?!this._logGeometryValidationWarnings(t,r,i)&&a&&a.length===0&&r==="rings"&&t.length>0&&t[0].length>2&&L().warnOncePerTick(`${o} (filled rings should use clockwise winding - try reversing the order of vertices)`):L().warnOncePerTick(`${o} (failed to project geometry to view spatial reference)`)}updateFocus(e,t){}_logGeometryValidationWarnings(e,t,r){const i=`${r} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(L().warnOncePerTick(`${i} (no ${t} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(L().warnOncePerTick(`${i} (${t} should be defined as a 2D array)`),!0)}_validateGeometry(e,t=null,r=null){if(t!=null&&!t.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;switch(e.type){case"point":{const i=e;if(!isFinite(i.x)||!isFinite(i.y))return L().warn("point coordinate is not a valid number, graphic skipped"),!1;break}case"polygon":Yt(e)&&L().warnOnce("Fixed a non-closed polygon ring.")}return!0}_defaultElevationInfoNoZ(){return ys}_defaultElevationInfoZ(){return ms}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,t=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||t.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,t=new ne){const r=e.geometry,i=this.getDefaultElevationInfo(r);t.unit=this._elevationContext.unit!=null?this._elevationContext.unit:i.unit,t.mode=this.getGeometryElevationMode(r,i),t.offsetMeters=this._elevationContext.meterUnitOffset??i.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&t.mode==="on-the-ground";n&&(t.mode="relative-to-ground",t.offsetMeters=0);const a=n?Tt:this._elevationContext.featureExpressionInfoContext;return t.updateFeatureExpressionInfoContext(a,e,this._context.layer),t}prepareSymbolLayerPatch(e){}updateGeometry(e,t){return!1}updateTransform(e,t,r,i){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,t=ze){const r=this.draped?1:this._getLayerOpacity();return this._drivenProperties.opacity?r:e?r*e.a:t.hasIntrinsicColor?r:0}_getCombinedOpacityAndColor(e,t=ze){const r=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return K(null,r);const i=e!=null?k.toUnitRGB(e):yt;return K(i,r)}_getVertexOpacityAndColor(e,t=null){const r=this._drivenProperties.color?e.color:null,i=this._drivenProperties.opacity?e.opacity:null,n=K(r,i);return t&&(n[0]*=t,n[1]*=t,n[2]*=t,n[3]*=t),n}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return nt(this.symbol,this.symbolLayer)}globalPropertyChanged(e,t,r){switch(e){case"opacity":return this.layerOpacityChanged(t,r),!0;case"elevationInfo":{const i=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,r,i)!==I.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,t,r){let i=I.UPDATE;return e.forEach(n=>{const a=t(n);if(a!=null){const o=n.graphic;this.setGraphicElevationContext(o,a.elevationContext),a.needsElevationUpdates=r(a.elevationContext.mode)}else i=I.RECREATE}),i}applyRendererDiff(e,t){return z.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const t=this._fastUpdates.visualVariables,r=t.size?Y(t.size.field,e):0,i=t.color?Y(t.color.field,e):0,n=t.opacity?Y(t.opacity.field,e):0;return Ze(r,i,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&L().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var t,r,i,n,a,o,u,c;return{size:((r=(t=this._fastUpdates)==null?void 0:t.visualVariables.size)==null?void 0:r.field)??null,color:((n=(i=this._fastUpdates)==null?void 0:i.visualVariables.color)==null?void 0:n.field)??null,opacity:((o=(a=this._fastUpdates)==null?void 0:a.visualVariables.opacity)==null?void 0:o.field)??null,rotation:((c=(u=this._fastUpdates)==null?void 0:u.visualVariables.rotation)==null?void 0:c.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}}function Ie(s){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1};return s&&"visualVariables"in s&&s.visualVariables&&s.visualVariables.forEach(t=>{switch(t.type){case"color":if(e.color=!0,t.stops)for(let r=0;r<t.stops.length;r++){const i=t.stops[r].color;i&&(e.opacity=!0,i.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0;break;case"rotation":e.rotation=!0}}),e}const ys={mode:"on-the-ground",offset:0,unit:"meters"},ms={mode:"absolute-height",offset:0,unit:"meters"},ze={hasIntrinsicColor:!1};function ot(s){return s.mapPositions!=null}function pa(s,e,t,r){return vs(s,e,t,gs(r,e,t,!0))}function ya(s,e,t,r){const i=qe(t,ke(s,r,e));return Ve(s,e,ue(s,t,i))}const fs={dir:S(),len:0,clip:ce()};function gs(s,e,t,r){const i=fs;return s?(t&&r&&(i.len=ve(e,t)),Ne(i.dir,s)):(i.len=ve(e,t),ke(i.dir,t,e),ue(i.dir,i.dir,1/i.len)),i}function bs(s,e,t){const r=qe(mt(s),t.dir),i=-ft(s,e);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const n=i/r;return r>0?n<t.clip[1]&&(t.clip[1]=n):n>t.clip[0]&&(t.clip[0]=n),t.clip[0]<=t.clip[1]}function vs(s,e,t,r){r.clip[0]=0,r.clip[1]=t?r.len:Number.MAX_VALUE;for(let i=0;i<s.length;i++)if(!bs(s[i],e,r))return!1;return!0}var R,A;(function(s){s[s.USER=1]="USER",s[s.SCALE_RANGE=2]="SCALE_RANGE",s[s.FILTER=4]="FILTER",s[s.DECONFLICTION=8]="DECONFLICTION",s[s.ALL_GRAPHIC=15]="ALL_GRAPHIC",s[s.ALL_LABEL=255]="ALL_LABEL"})(R||(R={})),function(s){s[s.GRAPHIC=1]="GRAPHIC",s[s.LABEL=16]="LABEL"}(A||(A={}));function ma(s,e,t,r,i){const n=s.stageObject,a=n.geometries;let o=0;for(const u of a){if(!ot(u))continue;const{update:c,averageGeometrySampledElevation:l}=ct(u,e,t,r,i);o+=l,c&&n.geometryVertexAttributeUpdated(u,m.POSITION)}return o/a.length}function _s(s,e,t,r,i,n){const a=s.stageObject,o=e.centerPointInElevationSR;let u=0;a.usesVerticalDistanceToGround?(r(o,b),Rt(a,b.verticalDistanceToGround),u=b.sampledElevation):(r(o,b),e.mode!=="absolute-height"&&(u=b.sampledElevation));const c=X(Ss,n??a.transformation),l=He(lt,c[12],c[13],c[14]);W.TESTS_DISABLE_OPTIMIZATIONS?(g[0]=o.x,g[1]=o.y,g[2]=b.z,Xe(o.spatialReference,g,c,i.spatialReference)&&(n?X(n,c):a.transformation=c)):i.setAltitudeOfTransformation(b.z,c);const h=fe/i.unitInMeters;return(Math.abs(c[12]-l[0])>=h||Math.abs(c[13]-l[1])>=h||Math.abs(c[14]-l[2])>=h)&&(n?X(n,c):a.transformation=c),u}const Ss=Qe();function fa(s,e,t,r,i){const n=s.graphics3DSymbolLayer.lodRenderer;if(n==null)return 0;const a=e.centerPointInElevationSR;r(a,b);const o=e.mode!=="absolute-height"?b.sampledElevation:0,u=n.instanceData,c=s.instanceIndex,l=Ps;u.getGlobalTransform(c,l);const h=He(lt,l[12],l[13],l[14]);W.TESTS_DISABLE_OPTIMIZATIONS?(g[0]=a.x,g[1]=a.y,g[2]=b.z,Xe(a.spatialReference,g,l,i.spatialReference)&&u.setGlobalTransform(c,l)):i.setAltitudeOfTransformation(b.z,l);const y=fe/i.unitInMeters;return(W.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(l[12]-h[0])>=y||Math.abs(l[13]-h[1])>=y||Math.abs(l[14]-h[2])>=y)&&u.setGlobalTransform(c,l),o}function ga(s,e,t,r,i){const n=s.stageObject,a=n.geometries;if(a.length===0)return 0;let o=0,u=null,c=0,l=!1;for(const h of a){if(!ot(h))continue;const y=h.attributes.get(m.POSITION);if(y!==u){const{update:d,averageGeometrySampledElevation:U}=ct(h,e,t,r,i);c=U,u=y,l=d}l&&n.geometryVertexAttributeUpdated(h,m.POSITION),o+=c}return o/a.length}const fe=.01,g=S(),v=S(),j=S(),Ps=Qe(),lt=S(),b=new It;function ct(s,e,t,r,i){let n=!1;const a=s.transformation,o=e.requiresSampledElevationInfo;v[0]=a[12],v[1]=a[13],v[2]=a[14],s.invalidateBoundingInfo();const u=s.getMutableAttribute(m.POSITION),c=u.data,l=u.size,h=c.length/l,y=new Mt(s.mapPositions,t);let d=0,U=0;for(let ge=0;ge<h;ge++){if(j[0]=c[d],j[1]=c[d+1],j[2]=c[d+2],r(y,b),o&&(U+=b.sampledElevation),W.TESTS_DISABLE_OPTIMIZATIONS)c[d]=y.array[y.offset],c[d+1]=y.array[y.offset+1],c[d+2]=b.z,M(c,t,d,c,i.spatialReference,d,1),c[d]-=v[0],c[d+1]-=v[1],c[d+2]-=v[2],n=!0;else{g[0]=c[d]+v[0],g[1]=c[d+1]+v[1],g[2]=c[d+2]+v[2],i.setAltitude(g,b.z),c[d]=g[0]-v[0],c[d+1]=g[1]-v[1],c[d+2]=g[2]-v[2];const Q=fe/i.unitInMeters;(Math.abs(j[0]-c[d])>=Q||Math.abs(j[1]-c[d+1])>=Q||Math.abs(j[2]-c[d+2])>=Q)&&(n=!0)}d+=l,y.offset+=3}return U/=h,{update:n,averageGeometrySampledElevation:U}}let Es=class{constructor(e,t,r){this.graphic=e,this.renderingInfo=t,this.layer=r}},Os=class{constructor(e,t=null){this.labelText=t,this.elevationOffset=e??0}};function Ls(s,e,t,r,i){if(ut(s,e))return null;t.localOrigin=$s(s,e);const n=new gr({geometries:[t],castShadow:!1,layerUid:s.layer.uid,graphicUid:i,usesVerticalDistanceToGround:!0});return{object:n,sampledElevation:Ye(n,e,s.elevationProvider,s.renderCoordsHelper,r)}}function _a(s,e,t,r){return ut(e,t)?null:Ye(s,t,e.elevationProvider,e.renderCoordsHelper,r)}function ut(s,e){const t=s.clippingExtent;return!!t&&(he(e,w,s.elevationProvider.spatialReference),!hr(t,w))}function xs(s,e,t){const r=s.elevationContext,i=t.spatialReference;he(e,w,i),r.centerPointInElevationSR=et(w[0],w[1],e.hasZ?w[2]:0,i??null)}function Sa(s){switch(s.type){case"point":return s;case"polygon":case"extent":return Ke(s);case"polyline":{const e=s.paths[0];if(!e||e.length===0)return null;const t=Jt(e,Kt(e)/2);return et(t[0],t[1],t[2],s.spatialReference)}case"mesh":return s.extent.center}return null}function $s(s,e){return he(e,w,s.renderCoordsHelper.spatialReference),s.localOriginFactory.getOrigin(w)}const w=S();function As(s){s.include(Nt),s.uniforms.add(new Vt("geometryDepthTexture",e=>{var t;return(t=e.geometryDepth)==null?void 0:t.attachment})),s.code.add(x`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);
return (elementDepth < (geometryDepth - 1.0));
}`)}function ht(s){const e=new Qr,{vertex:t,fragment:r}=e,{terrainDepthTest:i}=s;return t.include(Xr),e.include(Yr,s),e.vertex.include(qt,s),e.attributes.add(m.UV0,"vec2"),t.uniforms.add(new kt("viewport",n=>n.camera.fullViewport),new Oe("lineSize",(n,a)=>n.size>0?Math.max(1,n.size)*a.camera.pixelRatio:0),new Le("pixelToNDC",n=>De(Ge,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Oe("borderSize",(n,a)=>n.borderColor?a.camera.pixelRatio:0),new es("screenOffset",(n,a)=>De(Ge,n.horizontalScreenOffset*a.camera.pixelRatio,0))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),i&&e.varyings.add("depth","float"),s.occlusionTestEnabled&&e.include(Jr),s.hasScreenSizePerspective&&Kr(t),t.main.add(x`
    ProjectHUDAux projectAux;
    vec4 endPoint = projectPositionHUD(projectAux);

    vec3 vpos = projectAux.posModel;
    if (rejectBySlice(vpos)) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    }
    ${B(s.occlusionTestEnabled,x`if (!testHUDVisibility(endPoint)) {
             gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
             return;
           }`)}

    ${s.hasScreenSizePerspective?x`vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
               vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);`:"vec2 screenOffsetScaled = screenOffset;"}
    // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
    // correct depth value
    vec3 posView = (view * vec4(position, 1.0)).xyz;
    ${B(i,"depth = posView.z;")}

    applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
    vec4 startPoint = proj * vec4(posView, 1.0);

    // Apply screen offset to both start and end point
    vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
    startPoint.xy += screenOffsetNorm * startPoint.w;
    endPoint.xy += screenOffsetNorm * endPoint.w;

    // Align start and end to pixel origin
    vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
    vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${B(s.hudDepth,s.hudDepthAlignStart?"endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);":"startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);")}
    vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);

    // The direction of the line in screen space
    vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
    vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${s.hasScreenSizePerspective?x`float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
               float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);`:x`float lineSizeScaled = lineSize;
               float borderSizeScaled = borderSize;`}
    float halfPixelSize = lineSizeScaled * 0.5;

    // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
    float padding = 1.0 + borderSizeScaled;
    vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

    // Offset x/y from the center of the line in screen space
    projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

    // Compute a coverage varying which we can use in the fragment shader to determine
    // how much a pixel is actually covered by the line (i.e. to anti alias the line).
    // This works by computing two coordinates that can be linearly interpolated and then
    // subtracted to find out how far away from the line edge we are.
    float edgeDirection = (uv0.x * 2.0 - 1.0);

    float halfBorderSize = 0.5 * borderSizeScaled;
    float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
    float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

    float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

    coverageSampling = vec4(
      // Edge coordinate
      outerEdgeCoverageSampler,

      // Border edge coordinate
      outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

      // Line offset
      halfPixelSize - 0.5,

      // Border offset
      halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
    );

    lineSizes = vec2(lineSizeScaled, borderSizeScaled);
    gl_Position = projectedPosition;`),r.uniforms.add(new xe("uColor",n=>n.color??H),new xe("borderColor",n=>n.borderColor??H)),i&&(r.include(As,s),r.uniforms.add(new Le("inverseViewport",n=>n.inverseViewport))),r.main.add(x`
    ${B(i,"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }")}

    vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

    float borderAlpha = uColor.a * borderColor.a * coverage.y;
    float colorAlpha = uColor.a * coverage.x;

    float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);
    ${B(!s.hudDepth,x`vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
           fragColor = vec4(finalRgb, finalAlpha);`)}`),e}const Ge=ce(),Cs=Object.freeze(Object.defineProperty({__proto__:null,build:ht},Symbol.toStringTag,{value:"Module"}));let ws=class extends Ht{constructor(e,t){super(e,t,new Wt(Cs,()=>tt(()=>Promise.resolve().then(()=>Vs),void 0,import.meta.url)))}initializePipeline(e){const{hudDepth:t,terrainDepthTest:r}=e,i={func:r?we.ALWAYS:we.LESS};return Pr(t?{depthTest:i,depthWrite:Er}:{blending:Or(V.ONE,V.SRC_ALPHA,V.ONE_MINUS_SRC_ALPHA,V.ONE_MINUS_SRC_ALPHA),depthTest:i,colorWrite:Lr})}},$=class extends Zt{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hudDepth=!1,this.hudDepthAlignStart=!1,this.terrainDepthTest=!1,this.draped=!1}};D([F()],$.prototype,"screenCenterOffsetUnitsEnabled",void 0),D([F()],$.prototype,"occlusionTestEnabled",void 0),D([F()],$.prototype,"hasVerticalOffset",void 0),D([F()],$.prototype,"hasScreenSizePerspective",void 0),D([F()],$.prototype,"hudDepth",void 0),D([F()],$.prototype,"hudDepthAlignStart",void 0),D([F()],$.prototype,"terrainDepthTest",void 0);class se extends jt{constructor(e,t){super(e,dt),this.produces=new Map([[J.LINE_CALLOUTS,r=>Ce(r)],[J.LINE_CALLOUTS_HUD_DEPTH,r=>Ce(r)]]),this._configuration=new $(t),this._uniqueMaterialIdentifier=le(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,t){const r=t.slot===J.LINE_CALLOUTS_HUD_DEPTH;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hudDepth=r,this._configuration.hudDepthAlignStart=!!this.parameters.hudDepthAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration}get visible(){var e;return this.parameters.color[3]>=$e||(((e=this.parameters.borderColor)==null?void 0:e[3])??0)>=$e}intersect(){}createGLMaterial(e){return new Ds(e)}createBufferWriter(){return new Ts}validateParameters(e){this._uniqueMaterialIdentifier=le(e)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}}function le({renderOccluded:s,isDecoration:e,horizontalScreenOffset:t,color:r,size:i,occlusionTest:n,shaderPolygonOffset:a,hudDepthAlignStart:o,centerOffsetUnits:u,hasSlicePlane:c,screenSizePerspective:l,verticalOffset:h,borderColor:y}){return vt`${s}:${e}:${t}:[${r}]:${i}:${n}:${a}:${o}:${u}:${c}:${l!=null}:{${h.screenLength}:${h.minWorldLength}:${h.maxWorldLength}}:[${y}]`}let Ds=class extends Qt{beginSlot(e){return this.getTechnique(ws,e)}};class dt extends Ut{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=Ze(0,0,0,1),this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.hudDepthAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const Fs=br().vec3f(m.POSITION).vec3f(m.NORMAL).vec2f(m.UV0).vec4f(m.CENTEROFFSETANDDISTANCE),je=[G(0,0),G(1,0),G(0,1),G(1,0),G(1,1),G(0,1)];class Ts{constructor(){this.vertexBufferLayout=Fs}elementCount(e){return 6*e.get(m.POSITION).indices.length}write(e,t,r,i,n,a){vr(r.get(m.POSITION),e,n.position,a,6),_r(r.get(m.NORMAL),t,n.normal,a,6),Sr(r.get(m.CENTEROFFSETANDDISTANCE),n.centerOffsetAndDistance,a,6);for(let o=0;o<je.length;++o)n.uv0.setVec(a+o,je[o])}}class Z extends ps{constructor(e,t){super(e,null,t,zs),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new se(this._materialParameters,this._context.spherical),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){const t=this._materialParameters;return t.horizontalScreenOffset=e.horizontalScreenOffset??0,t.centerOffsetUnits=e.centerOffsetUnits||"world",t}get _materialParameters(){var a;const e=new dt,t=this.symbol,r=t.callout;if(r.color){const o=k.toUnitRGBA(r.color);o[3]*=this._getLayerOpacity(),e.color=o}else e.color=H;if(e.size=Pe(r.size||0),t.verticalOffset){const{screenLength:o,minWorldLength:u,maxWorldLength:c}=t.verticalOffset;e.verticalOffset={screenLength:Pe(o),minWorldLength:u||0,maxWorldLength:c??1/0}}e.borderColor=((a=r.border)==null?void 0:a.color)!=null?k.toUnitRGBA(r.border.color):null;const i=t.symbolLayers.at(0).type==="object",n=t.type==="label-3d";return e.occlusionTest=!i&&!_t("enable-feature:non-occluded-hud"),i&&(e.shaderPolygonOffset=0),e.hudDepthAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return Is}createGraphics3DGraphic(e){const t=e.renderingInfo,r=e.graphic,i=this.setGraphicElevationContext(r,new ne,t.elevationOffset||0),n=t.symbol,a=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(u=>u.type==="object"||u.type==="text"));if(n.type!=="label-3d"&&a||n.type==="point-3d"&&n.symbolLayers.every(u=>u.type==="text"&&!At(u)))return null;const o=Ke(r.geometry);return o==null?null:this._createAs3DShape(o,i,t,r.uid)}layerOpacityChanged(){var e;(e=this._materials[0])==null||e.setParameters(this._materialParameters)}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=zt(Z.elevationModeChangeTypes,r,i);return n!==I.UPDATE||e.forEach(a=>{const o=t(a);o!=null&&this.updateGraphicElevationContext(a.graphic,o)}),n}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,t,r=0){return super.setGraphicElevationContext(e,t),t.addOffsetRenderUnits(r),t}updateGraphicElevationContext(e,t){const{elevationContext:r,metadata:i}=t;this.setGraphicElevationContext(e,r,(i==null?void 0:i.elevationOffset)??0),t.needsElevationUpdates=Ee(r.mode)}computeComplexity(){return new P({verticesPerFeature:6})}_getOrCreateMaterial(e){var i;const t=this._perInstanceMaterialParameters(e),r=le(t);if(r===((i=this._materials[0])==null?void 0:i.uniqueMaterialIdentifier))return{material:this._materials[0],isUnique:!1};if(e.materialCollection!=null){let n=e.materialCollection.get(r);return n==null&&(n=new se(t,this._context.spherical),e.materialCollection.add(r,n)),{material:n,isUnique:!1}}return{material:new se(t,this._context.spherical),isUnique:!0}}_createAs3DShape(e,t,r,i){const n=this._context.layer.uid,a=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:n}),o=this._getOrCreateMaterial(r),u=new Xt(o.material,Rs(r),null,Bt.Point,a),c=Ls(this._context,e,u,t,i);if(c==null)return null;const l=new st(this,c.object,[u],o.isUnique?[o.material]:null,null,_s,t);return l.metadata=new Os(r.elevationOffset),l.alignedSampledElevation=c.sampledElevation,l.needsElevationUpdates=Ee(t.mode),xs(l,e,this._context.elevationProvider),l}}function Rs(s){const{translation:e,centerOffset:t}=s,r=new ee(e?[e[0],e[1],e[2]]:[0,0,0],ie,3,!0),i=new ee(t?[t[0],t[1],t[2],t[3]]:[0,0,0,1],ie,4,!0);return[[m.POSITION,r],[m.NORMAL,new ee([0,0,1],ie,3,!0)],[m.CENTEROFFSETANDDISTANCE,i]]}Z.elevationModeChangeTypes={definedChanged:I.UPDATE,staysOnTheGround:I.UPDATE,onTheGroundChanged:I.RECREATE};const ie=[0],Is={mode:"relative-to-ground",offset:0},zs={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};class La extends de{constructor(e,t,r=S(),i=wt(),n=0,a="world",o=0,u=null){super(e,t),this.translation=r,this.centerOffset=i,this.horizontalScreenOffset=n,this.centerOffsetUnits=a,this.elevationOffset=o,this.materialCollection=u}}class xa extends Es{}const Ue=()=>We.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function $a(s,e){if(!Ct(s))return Ue().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${s.type}' does not support callouts`),null;if(!s.callout)return null;const t=Gs[s.callout.type];return t?new t(s,e):(Ue().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${s.callout.type}`),null)}const Gs={line:Z},Be=new St(Array,s=>dr(s,pr),null,10,5),js=Je();class Us{get labelLayers(){return this._labelLayers||Pt}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e==null?void 0:e.isElevationSource)}constructor(e,t,r,i,n){this.graphic=e,this.graphics3DSymbol=t,this.layers=r,this._visibleFlags=R.ALL_LABEL,this.deconflictionPriority=0,++t.referenced,this._featureExpressionFeature=n?Gt(n,e,i):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(t=>{t.initialize(e),t.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,t){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(t),e.setVisibility(this.isVisible(A.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(t=>{t.type==="draped"&&(e=!0)}),e}isVisible(e=A.GRAPHIC,t){const r=t?this._visibleFlags|t|A.LABEL*t:this._visibleFlags;return e===A.GRAPHIC?(r&R.ALL_GRAPHIC)===R.ALL_GRAPHIC:(r&R.ALL_LABEL)===R.ALL_LABEL}setVisibilityFlag(e,t,r){const i=this.isVisible(e);r?this._visibleFlags|=e*t:this._visibleFlags&=~(e*t);const n=this.isVisible(e);if(i===n)return!1;if(e===A.LABEL)this._forEachLabelGraphic(a=>a.setVisibility(n));else{this._forEachSymbolLayerGraphic(o=>o.setVisibility(n));const a=this.isVisible(A.LABEL);this._forEachLabelGraphic(o=>o.setVisibility(a))}return!0}getVisibilityFlag(e,t){return!!(this._visibleFlags&e*t)}computeExtent(e){if(!this._extent){const t=this.graphic.geometry;if(t==null)return!1;this._extent=Je(),wr(t,this._extent);const r=t.spatialReference;if(!Cr(r,e)&&!Ar(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,t){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,t,r){let i=e.geometry;return i.type!=="mesh"&&i.type!=="extent"||(i=er.fromExtent(i.type==="mesh"?i.extent:i)),Dr(i,t,r)}get usedMemory(){let e=xr(this.graphic.attributes);return this._forEachSymbolLayerGraphic(t=>e+=t.graphics3DSymbolLayer.usedMemory),e}computeAttachmentOrigin(){const e={render:{origin:S(),num:0},draped:{origin:ce(),num:0}};for(const t of this.layers)t!=null&&t.computeAttachmentOrigin(e);return e.render.num>1&&ue(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&$r(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,t,r,i,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?oe(n.boundingBox):n.boundingBox=oe(),n.requiresDrapedElevation=!1,await rt(this.layers,async a=>{if(a==null)return;const o=a.type==="draped"?t:e,u=Be.acquire(),c=await a.getProjectedBoundingBox(o,r,n.screenSpaceObjects,i,u);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&yr(n.boundingBox,u),Be.release(u)}),mr(n.boundingBox)||tr(fr(n.boundingBox,js))?n:null}needsElevationUpdates(){var e;for(const t of this.layers)if(t!=null&&(t.type==="object3d"||t.type==="lod-instance")&&t.needsElevationUpdates)return!0;return((e=this._labelLayers)==null?void 0:e.some(t=>(t==null?void 0:t.needsElevationUpdates)??!1))??!1}alignWithElevation(e,t,r){this._forEachRenderedGraphic(i=>{i.type!=="object3d"&&i.type!=="lod-instance"||i.alignWithElevation(e,t,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(e,t,r){this._forEachRenderedGraphic(i=>{i.type==="object3d"&&i.alignWithAbsoluteElevation(e,t,r)})}addObjectStateSet(e){this._forEachSymbolLayerGraphic(t=>t.addObjectState(e))}removeObjectState(e){this._forEachSymbolLayerGraphic(t=>t.removeObjectState(e))}updateHighlights(e){this._forEachSymbolLayerGraphic(t=>t.updateHighlights(e))}_forEachGraphicList(e,t){e==null||e.forEach(r=>r&&t(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this.labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}}class Aa{constructor(e,t){this.scheduler=e,this.schedule=t,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}get spherical(){return this.stage.view.state.viewingMode===Rr.Global}get doublePrecisionRequiresObfuscation(){return this.stage.renderView.renderingContext.driverTest.doublePrecisionRequiresObfuscation.result}}class Bs{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}}const Ms=2216,Ns=4096;function pt(s){return Ms+Ns*s.symbolLayers.length+s.complexity.memory.resourceBytes}class Ca extends me{set symbol(e){this._symbol=e,e.symbolLayers.forEach((t,r)=>{const i=this.symbolLayers[r];i!=null&&(i.symbol=e,i.symbolLayer=t)})}get symbol(){return this._symbol}constructor(e,t,r){super(t.schedule),this._symbol=e,this._context=t,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let t=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(t=this._backgroundLayers.concat(t));const r=t.length;for(;this.symbolLayers.length<t.length;)this.symbolLayers.push(null);this.symbolLayers.length=t.length;const i=[],{make:n}=await tt(async()=>{const{make:a}=await import("./Graphics3DSymbolLayerFactory-Cz7ZA1xS.js");return{make:a}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203]),import.meta.url);for(let a=0;a<r;a++){const o=t.at(a);if(o.enabled===!1)continue;q.renderPriority=1-(1+a)/r,q.renderPriorityStep=1/r,q.ignoreDrivers=o.ignoreDrivers;const u=n(this.symbol,o,this._context,q),c=Et(e,()=>{this.symbolLayers[a]=null,u.destroy()});c&&i.push(c),this.symbolLayers[a]=u}if(await rt(this.symbolLayers,async(a,o)=>{if(a!=null)try{await a.load(),this._extentPadding+=Math.max(this._extentPadding,a.extentPadding)}catch{this.symbolLayers[o]=null}}),i.forEach(a=>a.remove()),_e(e),this.symbolLayers.length&&!this.symbolLayers.some(a=>!!a))throw new Error}getSymbolLayerSize(e){const t=this.symbolLayers[e];return t!=null?t.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e==null?void 0:e.queryForSnapping)}updateFocus(e,t){this.symbolLayers.forEach(r=>r==null?void 0:r.updateFocus(e,t))}createGraphics3DGraphic(e,t){var a,o;const r=e.graphic,i=this.symbolLayers.map(u=>(u==null?void 0:u.createGraphics3DGraphic(e))??null),n=this._context.arcade||((o=(a=this._context.featureExpressionInfoContext)==null?void 0:a.arcade)==null?void 0:o.modules)||null;return new Us(r,t||this,i,e.layer,n)}get complexity(){return ye(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,t){const r=this.symbolLayers.length;for(let i=0;i<r;i++){const n=this.symbolLayers[i],a=o=>{const u=o.layers[i];return u instanceof st?u:null};if(n!=null&&!n.globalPropertyChanged(e,t,a))return!1}return!0}applyRendererDiff(e,t){return this.loadStatus!==_.LOADED?z.RecreateSymbol:this.symbolLayers.reduce((r,i)=>r!==z.RecreateSymbol&&i!=null?Math.min(r,i.applyRendererDiff(e,t)):r,z.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===_.FAILED||e.diff.type!=="partial")return;const t=e.diff.diff;if(!t.symbolLayers||t.symbolLayers.type!=="partial")return;const r=t.symbolLayers.diff;this.symbolLayers.forEach((i,n)=>{if(i==null)return;const a=r[n];if(a){const o={diff:a,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};i.prepareSymbolLayerPatch(o),e.symbolStatePatches.push(...o.symbolLayerStatePatches),o.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((u,c)=>{const l=u.layers[n];l!=null&&o.graphics3DGraphicPatches.forEach(h=>h(l,c))})}})}updateGeometry(e,t){return this._updateGeometryOrTransform(e,(r,i)=>r.updateGeometry(i,t))}updateTransform(e,t,r,i){return this._updateGeometryOrTransform(e,(n,a)=>n.updateTransform(a,t,r,i))}_updateGeometryOrTransform(e,t){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(i==null)continue;const n=e.layers[r];if(!n||!t(i,n))return!1}return!0}onRemoveGraphic(e){for(let t=0;t<this.symbolLayers.length;t++){const r=this.symbolLayers[t];if(r==null)continue;const i=e.layers[t];i!=null&&r.onRemoveGraphic(i)}}getFastUpdateStatus(){let e=!1,t=!1;for(const r of this.symbolLayers)if(r!=null){if(r.loadStatus===_.LOADING)return C.Loading;r.isFastUpdatesEnabled()?t=!0:e=!0}return t?e?C.Mixed:C.Fast:e?C.Slow:C.Undefined}async queryForSnapping(e,t,r,i){const n=this.symbolLayers.filter(Ot).filter(o=>o.queryForSnapping!=null).map(o=>o.queryForSnapping(e,t,r,i)),a=await Promise.all(n);return _e(i),a.flat()}destroy(){if(!this.destroyed){super.destroy();for(const e of this.symbolLayers)e!=null&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}get cachedMemory(){return pt(this)}}const q=new Bs;let wa=class extends me{constructor(e,t,r){super(t),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const t=await this.symbol.fetchSymbol({signal:e,acceptedFormats:Ir});t.id=this.symbol.id,this.graphics3DSymbol=this._convert(t),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:at}globalPropertyChanged(e,t){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,t)}applyRendererDiff(e,t){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,t):z.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,t){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,t)}updateTransform(e,t,r,i){var n;return((n=this.graphics3DSymbol)==null?void 0:n.updateTransform(e,t,r,i))??!1}onRemoveGraphic(){}updateFocus(e,t){}getFastUpdateStatus(){var e;return((e=this.graphics3DSymbol)==null?void 0:e.getFastUpdateStatus())??C.Loading}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}get cachedMemory(){return pt(this)}};const Fa=1.2,Ta=H,Ra=4;function Ia(s,e,t){if(s==null||t==null)return!1;let r=!0;return p[0]=s.xmin!=null?s.xmin:0,p[1]=s.ymin!=null?s.ymin:0,p[2]=s.zmin!=null?s.zmin:0,r=r&&M(p,s.spatialReference,0,e,t,0),p[0]=s.xmax!=null?s.xmax:0,p[1]=s.ymax!=null?s.ymax:0,p[2]=s.zmax!=null?s.zmax:0,r=r&&M(p,s.spatialReference,0,e,t,3),s.xmin==null&&(e[0]=-1/0),s.ymin==null&&(e[1]=-1/0),s.zmin==null&&(e[2]=-1/0),s.xmax==null&&(e[3]=1/0),s.ymax==null&&(e[4]=1/0),s.zmax==null&&(e[5]=1/0),r}function za(s,e,t){if(s==null||t==null)return!1;let r=!0;return p[0]=s.xmin!=null?s.xmin:0,p[1]=s.ymin!=null?s.ymin:0,p[2]=s.zmin!=null?s.zmin:0,r=r&&M(p,s.spatialReference,0,p,t,0),e[0]=p[0],e[1]=p[1],p[0]=s.xmax!=null?s.xmax:0,p[1]=s.ymax!=null?s.ymax:0,p[2]=s.zmax!=null?s.zmax:0,r=r&&M(p,s.spatialReference,0,p,t,0),e[2]=p[0],e[3]=p[1],s.xmin==null&&(e[0]=-1/0),s.ymin==null&&(e[1]=-1/0),s.xmax==null&&(e[2]=1/0),s.ymax==null&&(e[3]=1/0),r}const p=S();class Ga{constructor(e,t){this.spatialReference=e,this._view=t}getElevation(e,t,r){return this._view.elevationProvider.getElevation(e,t,0,this.spatialReference,r)}async queryElevation(e,t,r,i,n){return this._view.elevationProvider.queryElevation(e,t,0,this.spatialReference,n,r,i)}}class ja{constructor(e,t,r,i){this.spatialReference=t,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...i,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(Wr.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(Zr);else for(const t of this._queries)t.result.reject(N())}queryElevation(e,t,r,i=0){const n=Lt(),a={x:e,y:t,minDemResolution:i,result:n,signal:r};return this._queries.push(a),Se(r,()=>{xt(this._queries,a),n.reject(N())}),n.promise}get running(){return this._queries.length>0}runTask(e){const t=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return t.forEach(l=>l.result.reject()),void e.madeProgress();const i=t.map(l=>[l.x,l.y]),n=t.reduce((l,h)=>Math.min(l,h.minDemResolution),1/0),a=new rr({points:i,spatialReference:this.spatialReference}),o=t.length>1&&t.some(l=>!!l.signal)?new AbortController:null,u=o!=null?o.signal:t[0].signal;if(o!=null){let l=0;t.forEach(h=>Se(h.signal,()=>{l++,h.result.reject(N()),l===t.length&&o.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:u};r.queryElevation(a,c).then(l=>{t.forEach((h,y)=>{h.signal!=null&&h.signal.aborted?h.result.reject(N()):h.result.resolve(l.geometry.points[y][2])})}).catch(l=>{t.forEach(h=>h.result.reject(l))}),e.madeProgress()}get test(){}}let Ua=class{constructor(e,t=0,r=0,i=0,n=0,a=null){this.usedMemory=e,this.displayedFeatures=t,this.totalFeatures=r,this.maximumFeatures=i,this.nodes=n,this.core=a}};function Ma(s){return"performanceInfo"in s}class Na{constructor(e="scene"){this.context=e,this.extent=sr()}}const Vs=Object.freeze(Object.defineProperty({__proto__:null,build:ht},Symbol.toStringTag,{value:"Module"}));export{A,Sa as B,_a as C,La as D,$s as E,xs as F,Ls as G,_s as H,ea as I,ga as J,os as K,R as L,ds as M,us as N,P as O,fa as P,ns as Q,is as R,ia as S,as as T,ma as U,Os as V,ya as W,Ra as X,xa as Y,ja as Z,Ma as _,Fa as a,$a as b,Ga as c,ha as d,Na as e,C as f,pa as g,_ as h,Es as i,wa as j,z as k,Ji as l,ua as m,de as n,Ki as o,Ca as p,ta as q,Yi as r,Aa as s,Ua as t,za as u,st as v,ot as w,Ia as x,ps as y,Ta as z};
