const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./calcite-action-Bys6x4p_.js","./action-D0Er9Ef6.js","./jsxFactory-CJa39Fro.js","./tslib.es6-B3Jf3DVX.js","./intl-CChhNOV8.js","./date-DlqISzcw.js","./jsonMap-0cxwUWs2.js","./subclass-BZA_h8Db.js","./locale-C9TlLpzi.js","./messages-OmQvZhAg.js","./Accessor-BLX9ikPh.js","./assets-C43MgM-v.js","./index-Bh2oEzTI.js","./index-2kwcjS9-.css","./Evented-BHRw9x22.js","./Promise-B2Hu02L7.js","./reactiveUtils-C5zUhJQJ.js","./asyncUtils-CWX51uTe.js","./Collection-CEdjem1-.js","./shared-B3wH2qpO.js","./SimpleObservable-KocWTzVy.js","./uuid-fwrPAdZb.js","./cast-Bjksrh93.js","./dom-D_AJDzAj.js","./interactive-y84HQRWL.js","./loadable-DM18hPdE.js","./locale-A4FuYD8q.js","./key-D63ExP77.js","./observers-D2xgmA06.js","./component-6CIDVndn.js","./t9n-D0ry3MEw.js","./icon-BQO9J86c.js","./loader-C-zIPscB.js","./calcite-block-M0XyV5ob.js","./conditionalSlot-R5D9krYS.js","./Heading-D7P0OjYI.js","./openCloseComponent-CmOrfBN-.js","./floating-ui-Bma_zPVt.js","./debounce-BOqmhDXu.js","./action-menu-C6uYzPu-.js","./array-BMcQdnYi.js","./popover-Q5ruM4hh.js","./focusTrapComponent-BSUg_DLj.js","./FloatingArrow-BBdsG5MP.js","./handle-Ct1HP3bl.js","./scrim-DPa2aeKh.js","./calcite-icon-Cu0W9dtm.js","./calcite-notice-DSp0z_Oh.js","./resources2-DjkgwdyM.js","./calcite-option-BMqKJDtM.js","./calcite-select-CIxePAn2.js","./form-BZPQ5PUM.js","./label-DEe8AW1C.js","./Validation-Bz9yoU6e.js","./input-message-CWvsvdFk.js","./calcite-tooltip-rE_jVYtd.js"])))=>i.map(i=>d[i]);
import{_ as y}from"./index-Bh2oEzTI.js";import{r as s}from"./tslib.es6-B3Jf3DVX.js";import{m as a,a as E,n as v,b as g}from"./subclass-BZA_h8Db.js";import{e as x,B as V,r as N,n as e}from"./jsxFactory-CJa39Fro.js";import"./intl-CChhNOV8.js";import{b as f}from"./Accessor-BLX9ikPh.js";import{V as T}from"./Collection-CEdjem1-.js";import{watch as A,initial as L,on as b}from"./reactiveUtils-C5zUhJQJ.js";import{h as C}from"./UpdatingHandles-GfwcIh5z.js";import{r as D,x as I}from"./layerUtils-BrNoooE9.js";import{b as S}from"./Portal-C10FKnaA.js";import{s as $}from"./utils-ChpoPxsr.js";import{g as P}from"./locale-C9TlLpzi.js";import{h as M}from"./messages-OmQvZhAg.js";import"./Evented-BHRw9x22.js";import"./Promise-B2Hu02L7.js";import"./uuid-fwrPAdZb.js";import"./cast-Bjksrh93.js";import"./assets-C43MgM-v.js";import"./date-DlqISzcw.js";import"./jsonMap-0cxwUWs2.js";import"./shared-B3wH2qpO.js";import"./SimpleObservable-KocWTzVy.js";import"./asyncUtils-CWX51uTe.js";import"./Loadable-BabW5Xcc.js";import"./writer-DNAwXnhG.js";import"./Extent-Bf3YTe7m.js";import"./Point-Cg0-ChZE.js";const m={noDirtyAreasInExtent:-2147208940,noUtilityNetworkExtension:-2147208474,cannotAcquireVersionLock_v10:-2147217146,cannotAcquireVersionLock_v11:-2147220947};let c=class extends f{constructor(t){super(t),this._activeOperationDidSucceed=!1,this._initialValidationsFinished=!1,this._dirtyAreasLayer=null,this._serverVersion=null,this._updatingHandles=new C,this._validConstructProperties=!1,this.executionError="",this.extentToValidate="current",this.loadErrors=new T}initialize(){const t=async()=>{this.messages||(this.messages=await M("esri/widgets/UtilityNetworkValidateTopology/t9n/UtilityNetworkValidateTopology"))};t().then(()=>{this.view||(this.view=null),this.utilityNetwork||(this.utilityNetwork=null),this.addHandles([A(()=>[this.view,this.utilityNetwork],async()=>{var n,u;const{loadErrors:i,messages:{info:{noUtilityNetwork:o,noView:r}}}=this;this._initialValidationsFinished=!1,i.removeAll(),this._validConstructProperties=!0,this._dirtyAreasLayer=null,this._serverVersion=null,((n=this.utilityNetwork)==null?void 0:n.type)!=="utility"&&(this.loadErrors.push(o),v.getLogger(this).error(new g("utilityNetworkValidateTopology:missing-property",o)),this._validConstructProperties=!1),((u=this.view)==null?void 0:u.type)!=="2d"&&(this.loadErrors.push(r),v.getLogger(this).error(new g("utilityNetworkValidateTopology:missing-property",r)),this._validConstructProperties=!1),this._validConstructProperties&&(this.utilityNetwork.loaded||await this.utilityNetwork.load().catch(d=>{v.getLogger(this).error(d),this._validConstructProperties=!1}),await this._setDirtyAreasLayer()),this._validConstructProperties&&await this._validateNetworkExtension()},L),b(()=>{var i,o;return(o=(i=this.view)==null?void 0:i.map)==null?void 0:o.layers},"change",async()=>{const{loadErrors:i,messages:{info:{noUtilityNetwork:o}}}=this,r=i.find(n=>n===o);this._initialValidationsFinished=!1,r||(i.removeAll(),await this._validateNetworkExtension(),await this._setDirtyAreasLayer()),this._initialValidationsFinished=!0}),P(t)])})}destroy(){this._updatingHandles.destroy()}get state(){return this.loadErrors.length||!this._validConstructProperties?"disabled":this.executionError?"failed":this._updatingHandles.updating?"executing":this._activeOperationDidSucceed?"success":this._initialValidationsFinished?"ready":"loading"}set utilityNetwork(t){this._get("utilityNetwork")!==t&&this._set("utilityNetwork",t)}set view(t){this._get("view")!==t&&this._set("view",t)}async validateTopology(){var n;const{messages:{info:{cannotAcquireVersionLock:t,noDirtyAreasInExtent:i}},utilityNetwork:o,view:r}=this;if(!this.loadErrors.length){this._activeOperationDidSucceed=!1,this._set("executionError","");const u={gdbVersion:o==null?void 0:o.gdbVersion,outSpatialReference:((n=r.spatialReference)==null?void 0:n.clone())||null,validateArea:this.extentToValidate==="current"?r.extent.clone():o.fullExtent.clone()};this._updatingHandles.addPromise(o==null?void 0:o.validateTopology(u).then(()=>{this._activeOperationDidSucceed=!0},d=>{var w;let h="Error: "+d;if(d instanceof g&&((w=d.details)!=null&&w.raw))switch(d.details.raw.extendedCode){case m.noDirtyAreasInExtent:h=i;break;case m.cannotAcquireVersionLock_v10:case m.cannotAcquireVersionLock_v11:h=t;break;default:h=d.details.message}this._set("executionError",h)}))}}async _setDirtyAreasLayer(){var o;const{messages:{info:{noDirtyAreasLayer:t}}}=this,i=(o=this.view)==null?void 0:o.map.allLayers.items.filter(r=>D(r)).find(r=>{var n,u;return((n=r.parsedUrl)==null?void 0:n.path)===((u=this.utilityNetwork)==null?void 0:u.networkSystemLayers.dirtyAreasLayerUrl)});i?(this._dirtyAreasLayer=i,await this._dirtyAreasLayer.load(),this._serverVersion=this._dirtyAreasLayer.version??0,this._validConstructProperties=!0):(this.loadErrors.includes(t)||(this.loadErrors.push(t),v.getLogger(this).error(new g("utilityNetworkValidateTopology:missing-layer",t))),this._validConstructProperties=!1)}async _validateNetworkExtension(){var d;const{messages:{info:{noAdvancedEditingUserTypeExtension:t,noUtilityNetworkServiceUserTypeExtension:i}}}=this,o=await I(this.utilityNetwork.layerUrl),r=new S({url:o});await r.load();const n=((d=r.user)==null?void 0:d.username)??"",u=Number(this._serverVersion)<=11.1?"utilityNetwork":"advediting";if(!await $(r,n,u)){const h=Number(this._serverVersion)<=11.1?i:t;this.loadErrors.push(h),v.getLogger(this).error(new g("utilityNetworkValidateTopology:no-user-type-extension",h)),this._validConstructProperties=!1}this._initialValidationsFinished=!0}};s([a()],c.prototype,"_initialValidationsFinished",void 0),s([a()],c.prototype,"_dirtyAreasLayer",void 0),s([a()],c.prototype,"_validConstructProperties",void 0),s([a({readOnly:!0})],c.prototype,"executionError",void 0),s([a()],c.prototype,"extentToValidate",void 0),s([a()],c.prototype,"loadErrors",void 0),s([a()],c.prototype,"messages",void 0),s([a({readOnly:!0})],c.prototype,"state",null),s([a()],c.prototype,"utilityNetwork",null),s([a()],c.prototype,"view",null),c=s([E("esri.widgets.UtilityNetworkValidateTopology.UtilityNetworkValidateTopologyViewModel")],c);const k=c,_="esri-un-validate-topology",l={container:`${_}__container`,content:`${_}__content`,controlsContainer:`${_}__controls-container`,statusIconError:`${_}__status-icon-error`,statusIconSuccess:`${_}__status-icon-success`,statusIconContainer:`${_}__status-icon-container`};let p=class extends V{constructor(t,i){super(t,i),this.messages=null,this.viewModel=new k}loadDependencies(){return N({action:()=>y(()=>import("./calcite-action-Bys6x4p_.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]),import.meta.url),block:()=>y(()=>import("./calcite-block-M0XyV5ob.js"),__vite__mapDeps([33,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,34,28,23,24,26,27,30,35,25,36,37,38,1,29,31,32,39,40,41,42,43,44,45]),import.meta.url),icon:()=>y(()=>import("./calcite-icon-Cu0W9dtm.js"),__vite__mapDeps([46,31,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,28]),import.meta.url),notice:()=>y(()=>import("./calcite-notice-DSp0z_Oh.js"),__vite__mapDeps([47,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,34,28,23,25,26,27,30,48,36,29,31]),import.meta.url),option:()=>y(()=>import("./calcite-option-BMqKJDtM.js"),__vite__mapDeps([49,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,28]),import.meta.url),select:()=>y(()=>import("./calcite-select-CIxePAn2.js"),__vite__mapDeps([50,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,51,24,52,29,25,28,53,31,54]),import.meta.url),tooltip:()=>y(()=>import("./calcite-tooltip-rE_jVYtd.js"),__vite__mapDeps([55,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,37,38,36,43]),import.meta.url)})}get extentToValidate(){return this.viewModel.extentToValidate}set extentToValidate(t){this.viewModel.extentToValidate=t}get icon(){return"check-circle"}set icon(t){this._overrideIfSome("icon",t)}get label(){var t;return((t=this.messages)==null?void 0:t.label)??""}set label(t){this._overrideIfSome("label",t)}get utilityNetwork(){return this.viewModel.utilityNetwork}set utilityNetwork(t){this.viewModel.utilityNetwork=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){const{viewModel:t}=this;return t.state==="disabled"?e("div",{class:l.container},e("calcite-block",{class:l.content,collapsible:!1,heading:this.label,open:!0},this._renderLoadErrorStatusIcon(),this._renderLoadErrorsNotices())):e("div",{class:l.container},e("calcite-block",{class:l.content,collapsible:!0,heading:this.label,open:!1},this._renderStatusIcon(),this._renderValidateTopologyAction(),this._renderControls()))}_extentOptionSelectChange(t){this.extentToValidate=t.target.value}_getLoadErrorMessagesAsNotices(t,i){return e("calcite-notice",{closable:!1,key:"error-notice-"+i,kind:"warning",open:!0,scale:"s"},e("div",{slot:"message"},t))}_handleValidateTopologyAction(){this.viewModel.validateTopology().catch(()=>{})}_renderControls(){const{viewModel:t}=this;return t.state==="failed"?e("div",{class:l.controlsContainer},this._renderExtentOptionSelect(),this._renderStatusNotice()):this._renderExtentOptionSelect()}_renderExtentOptionSelect(){const{messages:t,viewModel:i}=this;return e("div",{key:"selectExtentDiv"},e("calcite-select",{bind:this,disabled:i.state==="loading"||i.state==="executing",label:t.input.extentToValidate,onCalciteSelectChange:this._extentOptionSelectChange},e("calcite-option",{value:"current"},t.input.currentExtent),e("calcite-option",{value:"entire"},t.input.entireExtent)))}_renderLoadErrorsNotices(){const{viewModel:t}=this;return e("div",{class:l.controlsContainer,key:"loadErrorsDiv"},t.loadErrors.items.map(this._getLoadErrorMessagesAsNotices))}_renderLoadErrorStatusIcon(){return e("div",{class:l.statusIconContainer,key:"statusDiv",slot:"control"},e("calcite-icon",{class:l.statusIconError,icon:"exclamation-mark-triangle",scale:"s"}))}_renderStatusIcon(){const{messages:t,viewModel:i}=this,o=`${this.id}-validation-status-action`,r=`${this.id}-error-status-icon`,n=`${this.id}-success-status-icon`,u=d=>{setTimeout(()=>{d.textContent=""},3500)};return i.state==="executing"?e("div",{key:"statusDivExecuting",slot:"control"},e("calcite-action",{id:o,loading:!0,text:t.status.executing}),e("calcite-tooltip",{referenceElement:o},e("span",null,t.status.executing))):i.state==="success"?e("div",{afterCreate:u,class:l.statusIconContainer,key:"statusDivSuccess",slot:"control"},e("calcite-icon",{class:l.statusIconSuccess,icon:"check-circle",id:n,scale:"s"}),e("calcite-tooltip",{referenceElement:n},e("span",null,t.status.success))):i.state==="failed"?e("div",{class:l.statusIconContainer,key:"statusDivFailed",slot:"control"},e("calcite-icon",{class:l.statusIconError,icon:"exclamation-mark-triangle",id:r,scale:"s"}),e("calcite-tooltip",{referenceElement:r},e("span",null,i.executionError))):e("div",{class:l.statusIconContainer,key:"statusDiv",slot:"control"})}_renderStatusNotice(){const{viewModel:t}=this;return e("div",{key:"executionErrorDiv"},e("calcite-notice",{closable:!0,kind:"warning",open:!0,scale:"s"},e("div",{slot:"message"},t.executionError)))}_renderValidateTopologyAction(){const{messages:t,viewModel:i}=this,o=`${this.id}-validation-action`;return e("div",{key:"actionDiv",slot:"control"},e("calcite-action",{bind:this,disabled:i.state==="executing",icon:"play-f",id:o,loading:i.state==="loading",onclick:this._handleValidateTopologyAction,text:t.input.validateTopology}),e("calcite-tooltip",{referenceElement:o},e("span",null,i.state==="loading"?t.status.loading:t.input.validateTopology)))}};s([a()],p.prototype,"extentToValidate",null),s([a()],p.prototype,"icon",null),s([a()],p.prototype,"label",null),s([a(),x("esri/widgets/UtilityNetworkValidateTopology/t9n/UtilityNetworkValidateTopology")],p.prototype,"messages",void 0),s([a()],p.prototype,"utilityNetwork",null),s([a()],p.prototype,"view",null),s([a({type:k})],p.prototype,"viewModel",void 0),p=s([E("esri.widgets.UtilityNetworkValidateTopology")],p);const ut=p;export{ut as default};
