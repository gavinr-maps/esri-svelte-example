import{t as O}from"./date-Ctp1FiBW.js";import{s as h}from"./Accessor-BmwT4B0c.js";import{F as $}from"./Point-Cz2JYYmX.js";import{s as I}from"./OptimizedFeature-P2towpqD.js";import{e as N}from"./OptimizedGeometry-BJqUA4Pi.js";import{p as F,g as C}from"./opacityUtils-Dim20wpZ.js";const E={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function w(t){return E[t]}function*j(t){switch(t.type){case"Feature":yield t;break;case"FeatureCollection":for(const o of t.features)o&&(yield o)}}function*x(t){if(t)switch(t.type){case"Point":yield t.coordinates;break;case"LineString":case"MultiPoint":yield*t.coordinates;break;case"MultiLineString":case"Polygon":for(const o of t.coordinates)yield*o;break;case"MultiPolygon":for(const o of t.coordinates)for(const e of o)yield*e}}function*D(t,o={}){const{geometryType:e,objectIdField:n}=o;for(const r of t){const{geometry:c,properties:p,id:i}=r;if(c&&w(c.type)!==e)continue;const f=p||{};let u;n&&(u=f[n],i==null||u||(f[n]=u=i)),yield new I(c?Z(new N,c,o):null,f,null,u)}}function J(t){for(const o of t)if(o.length>2)return!0;return!1}function R(t){return!k(t)}function A(t){return k(t)}function k(t){let o=0;for(let e=0;e<t.length;e++){const n=t[e],r=t[(e+1)%t.length];o+=n[0]*r[1]-r[0]*n[1]}return o<=0}function G(t){const o=t[0],e=t[t.length-1];return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]||t.push(o),t}function Z(t,o,e){switch(o.type){case"LineString":return v(t,o,e);case"MultiLineString":return H(t,o,e);case"MultiPoint":return q(t,o,e);case"MultiPolygon":return z(t,o,e);case"Point":return B(t,o,e);case"Polygon":return K(t,o,e)}}function v(t,o,e){return d(t,o.coordinates,e),t}function H(t,o,e){for(const n of o.coordinates)d(t,n,e);return t}function q(t,o,e){return d(t,o.coordinates,e),t}function z(t,o,e){for(const n of o.coordinates){M(t,n[0],e);for(let r=1;r<n.length;r++)T(t,n[r],e)}return t}function B(t,o,e){return P(t,o.coordinates,e),t}function K(t,o,e){const n=o.coordinates;M(t,n[0],e);for(let r=1;r<n.length;r++)T(t,n[r],e);return t}function M(t,o,e){const n=G(o);R(n)?L(t,n,e):d(t,n,e)}function T(t,o,e){const n=G(o);A(n)?L(t,n,e):d(t,n,e)}function d(t,o,e){for(const n of o)P(t,n,e);t.lengths.push(o.length)}function L(t,o,e){for(let n=o.length-1;n>=0;n--)P(t,o[n],e);t.lengths.push(o.length)}function P(t,o,e){const[n,r,c]=o;t.coords.push(n,r),e.hasZ&&t.coords.push(c||0)}function Q(t){switch(typeof t){case"string":return O(t)?"esriFieldTypeDate":"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function tt(t,o=4326){if(!t)throw new h("geojson-layer:empty","GeoJSON data is empty");if(t.type!=="Feature"&&t.type!=="FeatureCollection")throw new h("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:t});const{crs:e}=t;if(!e)return;const n=typeof e=="string"?e:e.type==="name"?e.properties.name:e.type==="EPSG"?e.properties.code:null,r=$({wkid:o})?new RegExp(".*(CRS84H?|4326)$","i"):new RegExp(`.*(${o})$`,"i");if(!n||!r.test(n))throw new h("geojson:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:e})}function ot(t,o={}){const e=[],n=new Set,r=new Set;let c,p=!1,i=null,f=!1,{geometryType:u=null}=o;for(const y of j(t)){const{geometry:m,properties:l,id:a}=y;if((!m||(u||(u=w(m.type)),w(m.type)===u))&&(p||(p=J(x(m))),f||(f=a!=null,f&&(c=typeof a,l&&(i=Object.keys(l).filter(s=>l[s]===a)))),l&&i&&f&&a!=null&&(i.length>1?i=i.filter(s=>l[s]===a):i.length===1&&(i=l[i[0]]===a?i:[])),l))for(const s in l){if(n.has(s))continue;const b=Q(l[s]);if(b==="unknown"){r.add(s);continue}r.delete(s),n.add(s);const S=F(s);S&&e.push({name:S,alias:s,type:b})}}const g=F((i==null?void 0:i.length)===1&&i[0]||null)??void 0;if(g){for(const y of e)if(y.name===g&&C(y)){y.type="esriFieldTypeOID";break}}return{fields:e,geometryType:u,hasZ:p,objectIdFieldName:g,objectIdFieldType:c,unknownFields:Array.from(r)}}function et(t,o){return Array.from(D(j(t),o))}export{tt as E,ot as I,et as N,w as u};
