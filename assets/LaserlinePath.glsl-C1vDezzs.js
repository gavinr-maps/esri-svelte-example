import{r as c}from"./mathUtils-DV9iOXpW.js";import{o as f}from"./vec32-Dvg_eL9J.js";import{n as g}from"./vec3f64-BLpZdpfb.js";import{E as n,a as l}from"./vec42-YcqnINSP.js";import{r as u}from"./vec4f64-o2zAXfmz.js";import{n as p}from"./projectVectorToVector-dS8io47t.js";import{s as S}from"./aaBoundingBox-CeBivBRq.js";import{c as m}from"./plane-4dpuo6-e.js";import{l as x}from"./ViewingMode-Dodu7ZZk.js";import{a as b}from"./Object3DVisualElement-BtsT49h4.js";import{f as z,o as v}from"./ElevationContext-jcnAn7VT.js";import{s as y,c as E,a as C,u as I}from"./sdfPrimitives-B8Jbwvqs.js";import{l as w}from"./GeometryUtil-vHI0hYMT.js";import{e as o}from"./VertexAttribute-Cq4MnHjR.js";import{a as M}from"./HUDMaterial-DRUv4rua.js";import"./vec2-maR1OrZI.js";import"./vec2f64-Dy6m9Nrb.js";import"./lineSegment-C-CDF7QX.js";import"./sphere-DQxj5tsv.js";import"./BindType-BBwFZqyN.js";import"./Accessor-BHnuXKD2.js";import"./glsl-BH37Aalp.js";import"./ShaderBuilder-DV1s2efh.js";import{y as P,V as $,w as O}from"./LaserlineVisualElement-BPYPJd-Q.js";import"./mat4-Fi6iAz29.js";import"./mat4f64-Dk4dwAN8.js";let se=class extends b{constructor(e){super(e),this._material=null,this._texture=null,this._geometry=null,this._size=3,this._color=u(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=u(1,1,1,1),this._elevationInfo=null,this.applyProperties(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){n(e,this._color)||(l(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,this.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){n(e,this._outlineColor)||(l(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}_updateMaterial(){var e;(e=this._material)==null||e.setParameters(this._materialParameters)}_updateSizeAttribute(){const e=this.object;if(e==null)return;const t=e.geometries[0];if(t==null)return;const i=t.getMutableAttribute(o.SIZE).data,r=this._geometrySize;i[0]=r,i[1]=r,e.geometryVertexAttributeUpdated(e.geometries[0],o.SIZE)}get _materialParameters(){var e;return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:y(this._primitive),distanceFieldBoundingBox:E,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:(e=this._texture)==null?void 0:e.id,polygonOffset:!1,shaderPolygonOffset:0,drawAsLabel:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}get _geometrySize(){return this._size/C}createExternalResources(){this._texture=I(this._primitive,this._preferredTextureSize),this._material=new M(this._materialParameters,this.view.state.viewingMode===x.Global);const e=this.view._stage;this._texture.load(e.renderView.renderingContext),e.add(this._texture)}destroyExternalResources(){this._texture&&(this.view._stage.remove(this._texture),this._texture.dispose(),this._texture=null),this._material=null}createGeometries(e){const t=this._createRenderGeometry();t!=null&&e.addGeometry(t)}forEachExternalMaterial(e){this._material&&e(this._material)}get _preferredTextureSize(){return c(2*this._geometrySize,16,128)}calculateMapBounds(e){var r;const t=(r=this.object)==null?void 0:r.geometries[0];if(!t)return!1;const i=t.attributes.get(o.POSITION).data;return p(i,this.view.renderCoordsHelper.spatialReference,h,this.view.spatialReference),S(e,h),!0}_createRenderGeometry(){const{geometry:e,_material:t}=this;if(e==null||t==null)return null;const{renderCoordsHelper:i,elevationProvider:r}=this.view,_=z(e,r,v.fromElevationInfo(this.elevationInfo),i),d=f(m.get(),e.x,e.y,_),s=m.get();p(d,e.spatialReference,s,i.spatialReference);const a=this._geometrySize;return w(t,{position:s,size:[a,a],centerOffsetAndDistance:[0,0,0,1]})}};const h=g(),ne=Object.freeze(Object.defineProperty({__proto__:null,build:P,defaultAngleCutoff:$},Symbol.toStringTag,{value:"Module"})),le=Object.freeze(Object.defineProperty({__proto__:null,build:O},Symbol.toStringTag,{value:"Module"}));export{ne as L,se as S,le as a};
