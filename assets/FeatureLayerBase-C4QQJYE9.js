import{r as e,m as r,a as f,c as x,bA as U,bB as M,B as W}from"./Accessor-BmwT4B0c.js";import{S as g}from"./JSONSupport-DcrLLGjL.js";import{a as V,S as L,C as q}from"./cast-CsZslgGN.js";import{o as p,r as I}from"./writer-DKgfqj4X.js";import{i as _,W as k,x as Q,G,h as Z,m as J,u as X,s as K}from"./formUtils-l8pvwous.js";import{_ as Y,a5 as H,X as ee,Z as B}from"./opacityUtils-Dim20wpZ.js";import{V as A}from"./reactiveUtils-XM7cS2OP.js";import{a as te}from"./layerContainerType-C5CzMsLd.js";import{w as re}from"./Extent-g5W9hy0j.js";import{v as ie}from"./HeightModelInfo-C05IFsWs.js";import{au as se,av as oe,g as C}from"./Point-Cz2JYYmX.js";import{c as ne,v as le,j as pe,y as ae}from"./commonProperties-B0GHoNP5.js";import{a as b}from"./Clonable-Z-AWS-16.js";import{a as O}from"./timeZoneUtils-DxzjpEBb.js";import{j as de,X as R,r as ue,i as S,M as ye,k as ce,z as me}from"./featureLayerUtils-Btb8HY8h.js";import{p as fe}from"./LayerFloorInfo-iCgtHY6f.js";import{p as he}from"./Relationship-CTbzI1Kb.js";import{c as ve}from"./serviceCapabilitiesUtils-B2yGaMdk.js";import{i as ge}from"./Field-BDG0QV_T.js";var D;let h=D=class extends g{constructor(o){super(o),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new D({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};e([r({type:String,json:{write:!0}})],h.prototype,"expression",void 0),e([r({type:String,json:{write:!0}})],h.prototype,"name",void 0),e([r({type:["boolean","date","number","string"],json:{write:!0}})],h.prototype,"returnType",void 0),e([r({type:String,json:{write:!0}})],h.prototype,"title",void 0),h=D=e([f("esri.form.ExpressionInfo")],h);const Fe=h;var T;let d=T=class extends _{constructor(o){super(o),this.elements=null,this.initialState="expanded",this.type="group"}castElements(o){return k(o,w,!1)}readElements(o,t){return Q(t.formElements,w,!1)}writeElements(o,t){t.formElements=G(o,w,!1)}clone(){return new T({description:this.description,elements:x(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};e([r({json:{write:!0}})],d.prototype,"elements",void 0),e([V("elements")],d.prototype,"castElements",null),e([p("elements",["formElements"])],d.prototype,"readElements",null),e([I("elements")],d.prototype,"writeElements",null),e([r({type:["collapsed","expanded"],json:{write:!0}})],d.prototype,"initialState",void 0),e([r({type:String,json:{read:!1,write:!0}})],d.prototype,"type",void 0),d=T=e([f("esri.form.elements.GroupElement")],d);const w=Z(d),xe=d;var $;const j=Z(xe);let a=$=class extends g{constructor(o){super(o),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(o){return k(o,j)}readElements(o,t){return Q(t.formElements,j)}writeElements(o,t){t.formElements=G(o,j)}clone(){return new $({description:this.description,expressionInfos:x(this.expressionInfos),elements:x(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}async getFieldsUsed(o,t){const i=new Set,{description:s,elements:n,expressionInfos:l,title:m}=this;if(F(i,o,s),F(i,o,m),!n)return[];const z=Ie(n,l).map(E=>Y(i,o,E));await Promise.all(z);for(const E of n)N(i,{fieldsIndex:o,relationships:t},E);return Array.from(i).sort()}};function N(o,t,i){var n;const{fieldsIndex:s}=t;if(!s||s.fields.length!==o.size)switch(F(o,s,i.label),F(o,s,i.description),i.type){case"field":B(o,s,i.fieldName);break;case"group":i.elements.forEach(l=>N(o,t,l));break;case"relationship":if(t.relationships){const l=t.relationships.find(m=>m.id===i.relationshipId);l&&B(o,s,l.keyField)}H(o,s,(n=i.orderByFields)==null?void 0:n.map(l=>l.field));break;case"text":F(o,s,i.text)}}function Ie(o,t){if(!t||t.length===0)return[];const i=P(o),s=[];for(const n of t)i.has(n.name)&&s.push(n.expression);return s}function P(o){const t=new Set;for(const i of o)if(U(t,i.visibilityExpression),!J(i)){if(X(i))M(t,P(i.elements));else if(U(t,i.editableExpression),K(i)){const{requiredExpression:s,valueExpression:n}=i;M(t,[s,n])}}return t}function F(o,t,i){H(o,t,ee(i))}e([r({type:String,json:{write:!0}})],a.prototype,"description",void 0),e([r({json:{write:!0}})],a.prototype,"elements",void 0),e([V("elements")],a.prototype,"castElements",null),e([p("elements",["formElements"])],a.prototype,"readElements",null),e([I("elements")],a.prototype,"writeElements",null),e([r({type:[Fe],json:{write:!0}})],a.prototype,"expressionInfos",void 0),e([r({type:Boolean,json:{default:!1,write:!0}})],a.prototype,"preserveFieldValuesWhenHidden",void 0),e([r({type:String,json:{write:!0}})],a.prototype,"title",void 0),a=$=e([f("esri.form.FormTemplate")],a);const Pe=a;let y=class extends b.ClonableMixin(g){constructor(t){super(t),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.timeZone=null}};e([r()],y.prototype,"creatorField",void 0),e([r()],y.prototype,"creationDateField",void 0),e([r()],y.prototype,"editorField",void 0),e([r()],y.prototype,"editDateField",void 0),e([r()],y.prototype,"realm",void 0),e([r(O("dateFieldsTimeReference",!0))],y.prototype,"timeZone",void 0),y=e([f("esri.layers.support.EditFieldsInfo")],y);const be=y;let u=class extends b.ClonableMixin(g){constructor(o){super(o)}};e([r({constructOnly:!0,json:{write:!0}})],u.prototype,"name",void 0),e([r({constructOnly:!0,json:{write:!0}})],u.prototype,"fields",void 0),e([r({constructOnly:!0,json:{write:!0}})],u.prototype,"isAscending",void 0),e([r({constructOnly:!0,json:{write:!0}})],u.prototype,"indexType",void 0),e([r({constructOnly:!0,json:{write:!0}})],u.prototype,"isUnique",void 0),e([r({constructOnly:!0,json:{write:!0}})],u.prototype,"description",void 0),u=e([f("esri.layers.support.FeatureIndex")],u);let v=class extends b.ClonableMixin(g){constructor(t){super(t),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};e([r({type:String,json:{read:{source:"shapeAreaFieldName"}}})],v.prototype,"shapeAreaField",void 0),e([r({type:String,json:{read:{source:"shapeLengthFieldName"}}})],v.prototype,"shapeLengthField",void 0),e([r({type:String,json:{read:o=>se.read(o)||oe.read(o)}})],v.prototype,"units",void 0),v=e([f("esri.layers.support.GeometryFieldsInfo")],v);const Ee=v;let c=class extends b.ClonableMixin(g){constructor(o){super(o),this.code=null,this.defaultValues={},this.domains=null,this.name=null}readDomains(o){if(!o)return null;const t={};for(const i of Object.keys(o))t[i]=ge(o[i]);return t}writeDomains(o,t){var s;if(!o)return;const i={};for(const n of Object.keys(o))o[n]&&(i[n]=(s=o[n])==null?void 0:s.toJSON());t.domains=i}};e([r({type:Number,json:{write:!0}})],c.prototype,"code",void 0),e([r({type:Object,json:{write:!0}})],c.prototype,"defaultValues",void 0),e([r({json:{write:!0}})],c.prototype,"domains",void 0),e([p("domains")],c.prototype,"readDomains",null),e([I("domains")],c.prototype,"writeDomains",null),e([r({type:String,json:{write:!0}})],c.prototype,"name",void 0),c=e([f("esri.layers.support.Subtype")],c);const Se=c,Le=o=>{let t=class extends o{constructor(){super(...arguments),this.copyright=null,this.capabilities=null,this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.definitionExpression=null,this.displayField=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.fieldsIndex=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.globalIdField=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.indexes=new(A.ofType(u)),this.isTable=!1,this.layerId=void 0,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.preferredTimeZone=null,this.relationships=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.sourceJSON=null,this.spatialReference=C.WGS84,this.subtypeField=null,this.subtypes=null,this.trackIdField=null,this.version=void 0}getFieldDomain(){throw new Error("Not implemented")}getField(i){return this.fieldsIndex.get(i)}get authenticationTriggerEvent(){if(!this.url)return null;const{capabilities:i}=this;if(i){const{query:n,operations:l,editing:m}=i;if(!n.supportsQueryByOthers||!n.supportsQueryByAnonymous||l.supportsEditing&&!(m.supportsUpdateByOthers&&m.supportsUpdateByAnonymous&&m.supportsDeleteByOthers&&m.supportsDeleteByAnonymous))return"load"}if(R(this.serviceDefinitionExpression)||R(this.definitionExpression))return"load";if(this.userHasUpdateItemPrivileges){if(ue(this))return"load";if(this.hasUpdateItemRestrictions)return i.operations.supportsQuery?"editing":"load"}if(this.userHasFullEditingPrivileges&&this.hasFullEditingRestrictions)return"editing";const s=this.editFieldsInfo;return(s!=null&&s.creatorField||s!=null&&s.editorField)&&(i!=null&&i.operations.supportsEditing)?"editing":null}readCapabilitiesFromService(i,s){return ve(s,this.url)}readEditingInfo(i,s){const{editingInfo:n}=s;return n?{lastEditDate:n.lastEditDate!=null?new Date(n.lastEditDate):null}:null}get effectiveCapabilities(){const i=this.capabilities;if(!i)return null;const s=x(i),{operations:n,editing:l}=s;return S(this)?(this.userHasUpdateItemPrivileges&&(n.supportsQuery=!0),s):this.userHasUpdateItemPrivileges?(n.supportsAdd=n.supportsDelete=n.supportsEditing=n.supportsQuery=n.supportsUpdate=l.supportsDeleteByOthers=l.supportsGeometryUpdate=l.supportsUpdateByOthers=!0,s):(this.userHasFullEditingPrivileges&&n.supportsEditing&&(n.supportsAdd=n.supportsDelete=n.supportsUpdate=l.supportsGeometryUpdate=!0),s)}get effectiveEditingEnabled(){return!1}readGlobalIdFieldFromService(i,s){return ye(s)}get hasFullEditingRestrictions(){const i=this.capabilities;if(!i||S(this))return!1;const{operations:s,editing:n}=i;return s.supportsEditing&&!(s.supportsAdd&&s.supportsDelete&&s.supportsUpdate&&n.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){const i=this.capabilities;if(!i)return!1;const{operations:s,editing:n}=i;return S(this)?!s.supportsQuery:!(s.supportsAdd&&s.supportsDelete&&s.supportsEditing&&s.supportsQuery&&s.supportsUpdate&&n.supportsDeleteByOthers&&n.supportsGeometryUpdate&&n.supportsUpdateByOthers)}readIsTableFromService(i,s){return s.type==="Table"}readMaxScale(i,s){return s.effectiveMaxScale||i||0}readMinScale(i,s){return s.effectiveMinScale||i||0}readObjectIdFieldFromService(i,s){return ce(s)}readServiceDefinitionExpression(i,s){return s.definitionQuery||s.definitionExpression}set url(i){if(i==null)return void this._set("url",i);const s=L({layer:this,url:i,nonStandardUrlAllowed:!0,logger:W.getLogger(this)});this._set("url",s.url),s.layerId!=null&&this._set("layerId",s.layerId)}writeUrl(i,s,n,l){q(this,i,null,s,l)}readVersion(i,s){return me(s)}};return e([r({readOnly:!0})],t.prototype,"authenticationTriggerEvent",null),e([r({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],t.prototype,"copyright",void 0),e([r({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","isDataBranchVersioned","isDataVersioned","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],t.prototype,"capabilities",void 0),e([p("service","capabilities")],t.prototype,"readCapabilitiesFromService",null),e([r(O("dateFieldsTimeReference"))],t.prototype,"dateFieldsTimeZone",void 0),e([r({type:Boolean})],t.prototype,"datesInUnknownTimezone",void 0),e([r({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],t.prototype,"definitionExpression",void 0),e([r({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],t.prototype,"displayField",void 0),e([r({readOnly:!0,type:be})],t.prototype,"editFieldsInfo",void 0),e([r({readOnly:!0})],t.prototype,"editingInfo",void 0),e([p("editingInfo")],t.prototype,"readEditingInfo",null),e([r({readOnly:!0})],t.prototype,"effectiveCapabilities",null),e([r()],t.prototype,"effectiveEditingEnabled",null),e([r((()=>{const i=x(ne),s=i.json.origins;return s["web-map"]={read:!1,write:!1},s["portal-item"]={read:!1,write:!1},i})())],t.prototype,"elevationInfo",void 0),e([r()],t.prototype,"fieldsIndex",void 0),e([r({type:fe,json:{name:"layerDefinition.floorInfo",write:{layerContainerTypes:te}}})],t.prototype,"floorInfo",void 0),e([r({type:re,json:{origins:{service:{read:{source:"extent"}}}}})],t.prototype,"fullExtent",void 0),e([r()],t.prototype,"gdbVersion",void 0),e([r({readOnly:!0,type:Ee,json:{read:{source:"geometryProperties"}}})],t.prototype,"geometryFieldsInfo",void 0),e([r({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:de.read}}}})],t.prototype,"geometryType",void 0),e([r({type:String})],t.prototype,"globalIdField",void 0),e([p("service","globalIdField",["globalIdField","fields"])],t.prototype,"readGlobalIdFieldFromService",null),e([r({readOnly:!0})],t.prototype,"hasFullEditingRestrictions",null),e([r({type:Boolean,json:{origins:{service:{read:!0}}}})],t.prototype,"hasM",void 0),e([r({readOnly:!0})],t.prototype,"hasUpdateItemRestrictions",null),e([r({type:Boolean,json:{origins:{service:{read:!0}}}})],t.prototype,"hasZ",void 0),e([r({readOnly:!0,type:ie})],t.prototype,"heightModelInfo",void 0),e([r({type:Date})],t.prototype,"historicMoment",void 0),e([r({type:A.ofType(u),readOnly:!0})],t.prototype,"indexes",void 0),e([r({readOnly:!0})],t.prototype,"isTable",void 0),e([p("service","isTable",["type"])],t.prototype,"readIsTableFromService",null),e([r({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],t.prototype,"layerId",void 0),e([r(le)],t.prototype,"maxScale",void 0),e([p("service","maxScale",["maxScale","effectiveMaxScale"])],t.prototype,"readMaxScale",null),e([r(pe)],t.prototype,"minScale",void 0),e([p("service","minScale",["minScale","effectiveMinScale"])],t.prototype,"readMinScale",null),e([r({type:String})],t.prototype,"objectIdField",void 0),e([p("service","objectIdField",["objectIdField","fields"])],t.prototype,"readObjectIdFieldFromService",null),e([r(O("preferredTimeReference"))],t.prototype,"preferredTimeZone",void 0),e([r({type:[he],readOnly:!0})],t.prototype,"relationships",void 0),e([r({type:Boolean})],t.prototype,"returnM",void 0),e([r({type:Boolean})],t.prototype,"returnZ",void 0),e([r({readOnly:!0,json:{write:!1}})],t.prototype,"serverGens",void 0),e([r({readOnly:!0})],t.prototype,"serviceDefinitionExpression",void 0),e([p("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],t.prototype,"readServiceDefinitionExpression",null),e([r({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],t.prototype,"serviceItemId",void 0),e([r()],t.prototype,"sourceJSON",void 0),e([r({type:C,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],t.prototype,"spatialReference",void 0),e([r({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],t.prototype,"subtypeField",void 0),e([r({type:[Se],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],t.prototype,"subtypes",void 0),e([r({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],t.prototype,"trackIdField",void 0),e([r(ae)],t.prototype,"url",null),e([I("url")],t.prototype,"writeUrl",null),e([r({json:{origins:{service:{read:!0}},read:!1}})],t.prototype,"version",void 0),e([p("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],t.prototype,"readVersion",null),t=e([f("esri.layers.mixins.FeatureLayerBase")],t),t};export{Le as R,Pe as V,Se as c};
