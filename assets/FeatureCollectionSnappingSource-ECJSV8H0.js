import{e as p}from"./Evented-CXIxDjmW.js";import{S as F,s,z as E}from"./Accessor-D6mNnsWy.js";import{t as V}from"./memoize-DsJmrG76.js";import{d as c,P as h,v as $}from"./reactiveUtils-BFQ0BtrB.js";import{y as n,b as C}from"./subclass-BR3PhgZG.js";import{y as D}from"./elevationInfoUtils-Bl7QRRwv.js";import{j as A,y as I}from"./SnappingManager-GEHlVC1V.js";import{o as P,i as z}from"./queryEngineUtils-BrxRWmJW.js";import{i as d,r as G,n as v}from"./symbologySnappingCandidates-IFxTX5nl.js";import"./shared-B3wH2qpO.js";import"./Point-DB4Hp4hH.js";import"./jsonMap-DCC6W5ex.js";import"./writer-3zufXUNV.js";import"./assets-C2mb-ea2.js";import"./index-CeCSsEgo.js";import"./unitConversionUtils-Dl04YuQU.js";import"./lengthUtils-D7_DvYH0.js";import"./projection-A9yUaaTs.js";import"./mathUtils-ClvKsMak.js";import"./Extent-DHjqVB-p.js";import"./Polyline-D97hl-6E.js";import"./projectBuffer-vsa0P_cF.js";import"./geodesicConstants-XRAvAZCD.js";import"./projectVectorToVector-Chzd0Pq0.js";import"./projectPointToVector-D3506wm2.js";import"./Color-DDUWtbqR.js";import"./colorUtils-CS9vdHXB.js";import"./vec2-B_ymkwGp.js";import"./UpdatingHandles-CMtXpTiG.js";import"./vec2f64-Diu2Kaa8.js";import"./vec42-B1mBkh1w.js";import"./vec4f64-CBQL1T0x.js";import"./geodesicUtils-iciHABcX.js";import"./geometry-DpwwkAX1.js";import"./plane-Bz78OrLf.js";import"./mat3f64-BBpwCtoL.js";import"./mat4f64-Dk4dwAN8.js";import"./quatf64-BrpT0VRp.js";import"./mathUtils-kvswLROa.js";import"./sphere-7666U3LO.js";import"./mat4-ybYUU6jq.js";import"./geometry2dUtils-BraNT6Fs.js";import"./fieldUtils-CNduWQU9.js";import"./intl-Dpfm8vPB.js";import"./Promise-CZrWwByK.js";import"./FeatureFilter-BzdN7b7E.js";import"./TimeExtent-41gxTbrv.js";import"./timeUtils-DQR2jUPL.js";import"./Query-Cx4awVKu.js";import"./enumeration--HlxOQ_N.js";import"./jsonUtils-Cma_7A64.js";import"./DataLayerSource-6X35yXpo.js";import"./Field-C8SaaeoI.js";import"./fieldType-CIG5ey7e.js";import"./FullTextSearch-BNIhEccm.js";import"./Clonable-cKbRam6-.js";import"./floorFilterUtils-DZ5C6FQv.js";import"./layerUtils-erzwAANv.js";import"./InputManager-C4xu1R9l.js";import"./Queue-DpHko4Yk.js";import"./signal-DzOfzcfh.js";import"./keybindings-DYR2fa8r.js";import"./utils-CXgSw6Sd.js";import"./layerViewUtils-D2JqIDZ8.js";import"./geodesicLengthMeasurementUtils-B9-VlVgL.js";import"./screenUtils-PfxkaaMN.js";import"./quantityUtils-d_-fFwhF.js";import"./geometryEngine-BT1Ysmbs.js";import"./geometryEngineBase-RmbNeFm7.js";import"./_commonjsHelpers-DCkdB7M8.js";import"./hydrated-DO_xxk1P.js";import"./Cyclical-BY_I03kj.js";import"./VertexSnappingCandidate-B0YOrUrc.js";import"./PointSnappingHint-DzxtkBUe.js";import"./LRUCache-ju6LnIBZ.js";import"./MemCache-C6WUx-5V.js";let o=class extends F{get availability(){return 1}get updating(){return this.layerSource.updating}get _snappingElevationAligner(){const{view:t}=this,{layer:i}=this.layerSource,e=t!=null&&t.type==="3d";if(!e||i.type==="subtype-group")return d();const r=async(a,l)=>(await E(t.whenLayerView(i),l)).elevationAlignPointsInFeatures(a,l);return d(e,{elevationInfo:i.elevationInfo,alignPointsInFeatures:r})}get _snappingElevationFilter(){const{view:t}=this,i=t!=null&&t.type==="3d"&&this.layerSource.layer.type!=="subtype-group";return G(i)}get _symbologySnappingFetcher(){const{view:t}=this,{layer:i}=this.layerSource;return t!=null&&t.type==="3d"&&i.type!=="subtype-group"?v(this._symbologySnappingSupported,async(e,r)=>{const a=await t.whenLayerView(i);return s(r),a.queryForSymbologySnapping({candidates:e,spatialReference:t.spatialReference},r)}):v()}get _symbologySnappingSupported(){return this._layerView3D!=null&&this._layerView3D.symbologySnappingSupported}initialize(){const{view:t}=this,{layer:i}=this.layerSource;t!=null&&t.type==="3d"&&i.type!=="subtype-group"&&(t.whenLayerView(i).then(e=>this._layerView3D=e),this.addHandles([t.elevationProvider.on("elevation-change",({context:e})=>{const{elevationInfo:r}=i;D(e,r)&&this._snappingElevationAligner.notifyElevationSourceChange()}),c(()=>i.elevationInfo,()=>this._snappingElevationAligner.notifyElevationSourceChange(),h),c(()=>{var e;return this._layerView3D!=null?(e=this._layerView3D.layer)==null?void 0:e.renderer:null},()=>this._symbologySnappingFetcher.notifySymbologyChange(),h),$(()=>{var e;return(e=this._layerView3D)==null?void 0:e.layer},["edits","apply-edits","graphic-update"],()=>this._symbologySnappingFetcher.notifySymbologyChange())]))}constructor(t){super(t),this.view=null,this._layerView3D=null,this._memoizedMakeGetGroundElevation=V(z)}refresh(){}async fetchCandidates(t,i){var g;const{layer:e}=this.layerSource,r=e.source;if(!(r!=null&&r.querySnapping))return[];const a=A(e),l=I(t,((g=this.view)==null?void 0:g.type)??"2d",a),S=await r.querySnapping(l,{signal:i});s(i);const y=t.coordinateHelper.spatialReference,m=await this._snappingElevationAligner.alignCandidates(S.candidates,y,i);s(i);const u=await this._symbologySnappingFetcher.fetch(m,i);s(i);const w=u.length===0?m:[...m,...u],f=this._snappingElevationFilter.filter(l,w),_=this._memoizedMakeGetGroundElevation(this.view,y);return f.map(b=>P(b,_))}};p([n({constructOnly:!0})],o.prototype,"layerSource",void 0),p([n({constructOnly:!0})],o.prototype,"view",void 0),p([n()],o.prototype,"_snappingElevationAligner",null),p([n()],o.prototype,"_snappingElevationFilter",null),p([n()],o.prototype,"_symbologySnappingFetcher",null),p([n()],o.prototype,"_layerView3D",void 0),p([n()],o.prototype,"_symbologySnappingSupported",null),o=p([C("esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource")],o);export{o as FeatureCollectionSnappingSource};
