import{f}from"./utils-YowqfOgk.js";import{I as l,P as c,V as y}from"./cast-CsZslgGN.js";import{v as S}from"./jsonUtils-CwFG8yN4.js";import{R}from"./normalizeUtils-BTGdXlpz.js";import{a2 as s,c as g}from"./Point-Cz2JYYmX.js";import{t as d}from"./query-Bjn_Ozo1.js";import{c as x}from"./AttributeBinsFeatureSet-DM20I0Go.js";import J from"./AttributeBinsQuery-bynNlZ_X.js";import"./Accessor-BmwT4B0c.js";import"./index-4eY77cms.js";import"./JSONSupport-DcrLLGjL.js";import"./Extent-g5W9hy0j.js";import"./Polyline-s-JzsQqo.js";import"./writer-DKgfqj4X.js";import"./mathUtils-Cfq9PL9W.js";import"./normalizeUtilsCommon-lGDszWRI.js";import"./utils-B-dlKIhi.js";import"./pbfQueryUtils-mqiWagfZ.js";import"./pbf-BsmI3A9L.js";import"./memoryEstimations-Bcyf-mHz.js";import"./OptimizedGeometry-BJqUA4Pi.js";import"./OptimizedFeature-P2towpqD.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./queryZScale-BdW_vUm_.js";import"./projection-CyCZAIaD.js";import"./SimpleObservable-CvOkykwM.js";import"./vec3f64-BLpZdpfb.js";import"./projectBuffer-CQnuEMuP.js";import"./geodesicConstants-RQL9oKdk.js";import"./Graphic-Dt0LgVGU.js";import"./Clonable-Z-AWS-16.js";import"./reactiveUtils-XM7cS2OP.js";import"./Evented-Dw4_VOGn.js";import"./opacityUtils-Dim20wpZ.js";import"./Promise-DfET-uns.js";import"./enumeration-DpvDkLNI.js";import"./Color-VJEMvW-n.js";import"./colorUtils-Rxh2V3ai.js";import"./ActionToggle-D7439N1A.js";import"./Identifiable-BHVfzH03.js";import"./typeUtils-B6WBEKDM.js";import"./TextSymbol-BLIQ6RKX.js";import"./screenUtils-_ZIvrt5o.js";import"./collectionUtils-CTT-51g7.js";import"./Portal-CmmHxpLg.js";import"./aaBoundingBox-Dw3yBk2f.js";import"./FeatureSet-B5-Veyin.js";import"./Field-BDG0QV_T.js";import"./fieldType-CBeoJWlv.js";import"./queryUtils-DBEPdow2.js";import"./json-Wa8cmqdu.js";import"./FixedIntervalBinParameters-ZfcJap1f.js";import"./NormalizationBinParametersMixin-CZD0XfhN.js";import"./Query-B_2mhyL4.js";import"./FullTextSearch-CBnxSwz4.js";import"./TimeExtent-BO6BsF_x.js";import"./timeUtils-C1c_L2Fd.js";import"./timeZoneUtils-DxzjpEBb.js";function N(o){const i=o.geometry,r=o.toJSON(),t=r;let e,m,p;if(i!=null&&(m=i.spatialReference,p=s(m),t.geometryType=S(i),t.geometry=JSON.stringify(i),t.inSR=p),r.outSR?(t.outSR=s(r.outSR),e=o.outSpatialReference):i&&(t.outSR=t.inSR,e=m),t.bin&&(t.bin=JSON.stringify(t.bin)),t.quantizationParameters&&(t.quantizationParameters=JSON.stringify(t.quantizationParameters)),t.outStatistics&&(t.outStatistics=JSON.stringify(t.outStatistics)),t.outTimeReference&&(t.outTimeReference=JSON.stringify(t.outTimeReference)),r.timeExtent){const a=r.timeExtent,{start:n,end:u}=a;n==null&&u==null||(t.time=n===u?n:`${n??"null"},${u??"null"}`),delete r.timeExtent}return o.defaultSpatialReference&&g(m,e)&&(t.defaultSR=t.inSR,delete t.inSR,delete t.outSR),t}async function O(o,i,r){return i.timeExtent!=null&&i.timeExtent.isEmpty?{data:{features:[]}}:await q(o,i,r)}async function q(o,i,r={}){const t=typeof o=="string"?l(o):o,e=i.geometry?[i.geometry]:[],m=await R(e,null,{signal:r.signal}),p=m==null?void 0:m[0];p!=null&&((i=i.clone()).geometry=p);const a=d({...t.query,f:"json",...N(i)});return c(y(t.path,"queryBins"),{...r,query:{...a,...r.query}})}async function bt(o,i,r){const{data:t}=await O(f(o),J.from(i),r);return x.fromJSON(t)}export{bt as executeAttributeBinsQuery};
