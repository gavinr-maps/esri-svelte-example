const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./meshFeatureSet-GfLj7Azz.js","./Graphic-Dc7F67nR.js","./Evented-CXIxDjmW.js","./Accessor-D6mNnsWy.js","./subclass-BR3PhgZG.js","./geometry-DpwwkAX1.js","./Extent-DHjqVB-p.js","./Point-DB4Hp4hH.js","./jsonMap-DCC6W5ex.js","./writer-3zufXUNV.js","./assets-C2mb-ea2.js","./index-CeCSsEgo.js","./index-CjOb8WjV.css","./Polyline-D97hl-6E.js","./mathUtils-ClvKsMak.js","./PopupTemplate-ByHks6sq.js","./Clonable-cKbRam6-.js","./reactiveUtils-BFQ0BtrB.js","./shared-B3wH2qpO.js","./fieldUtils-CNduWQU9.js","./intl-Dpfm8vPB.js","./Promise-CZrWwByK.js","./enumeration--HlxOQ_N.js","./Color-DDUWtbqR.js","./colorUtils-CS9vdHXB.js","./ActionToggle-C0Z1k2jc.js","./Identifiable-BLvpQbOc.js","./symbols-CsUQ5BxR.js","./TextSymbol-gKE-H_J6.js","./screenUtils-PfxkaaMN.js","./materialUtils-CQ3JLQ1x.js","./opacityUtils-BT7mQkwC.js","./aaBoundingBox-rJEWaOSN.js","./persistableUrlUtils-BcifXQ1Z.js","./collectionUtils-Dm1icNvk.js","./Portal-liet8xHC.js","./jsonUtils-Cma_7A64.js","./Mesh-DBjiOEHo.js","./axisAngleDegrees-CHCWDIqP.js","./mat4-ybYUU6jq.js","./quat-ChS85qAG.js","./mat3f64-BBpwCtoL.js","./quatf64-BrpT0VRp.js","./vec42-B1mBkh1w.js","./vec4f64-CBQL1T0x.js","./MeshComponent-D1ps11B9.js","./imageUtils-9KeT6Jbh.js","./MeshVertexAttributes-DVEL_Tlm.js","./MeshLocalVertexSpace-Xt9zU6DE.js","./MeshTransform-DLV7aKpV.js","./mat4f64-Dk4dwAN8.js","./meshVertexSpaceUtils-CtidK-ZY.js","./triangulationUtils-D8OjVISe.js","./earcut-BqgeR2O3.js","./_commonjsHelpers-DCkdB7M8.js","./DoubleArray-CF_CpVBS.js","./Indices-B6BGScAS.js","./plane-Bz78OrLf.js","./vec2f64-Diu2Kaa8.js","./mathUtils-kvswLROa.js","./deduplicate-DxTSMkFY.js","./projection-CJ-ESJIf.js","./mat3-DRqs2t5W.js","./projection-A9yUaaTs.js","./projectBuffer-vsa0P_cF.js","./geodesicConstants-XRAvAZCD.js","./spatialReferenceEllipsoidUtils-BL8s_3ls.js","./computeTranslationToOriginAndRotation-CLzktXYu.js","./BufferView-B7Z-dzh4.js","./vec2-B_ymkwGp.js","./vec3-C3Q-RF_i.js","./vec4-L9zJLV3y.js","./projectPointToVector-D3506wm2.js","./vertexSpaceConversion-DhlFeppE.js","./External-w9Liy2RE.js","./infoFor3D-CxOdoily.js","./FeatureSet-DyOnd9Rj.js","./Field-C8SaaeoI.js","./fieldType-CIG5ey7e.js","./RelationshipQuery-kHvI2dm7.js","./DataLayerSource-6X35yXpo.js","./executeRelationshipQuery-1vmZH8DO.js","./utils-D61i9O7E.js","./query-DbJf0nTj.js","./normalizeUtils-Bi6Jza1f.js","./normalizeUtilsCommon-tgSpcwHH.js","./utils-Dx8bgRIB.js","./pbfQueryUtils-C7MaRxj2.js","./pbf-CmaozfCN.js","./OptimizedGeometry-vU5jWBvU.js","./OptimizedFeature-7juV2tZm.js","./OptimizedFeatureSet-Blu9Ckm7.js","./queryZScale-B_YkkRy9.js","./queryAttachments-CVryA1Mj.js","./AttachmentInfo-BoDg34HQ.js","./executeTopFeaturesQuery-C9-9C9cM.js","./queryTopFeatures-BK5hHCq1.js","./TopFeaturesQuery-BBItvyOE.js","./TimeExtent-41gxTbrv.js","./timeUtils-DQR2jUPL.js","./executeForTopIds-p-ISo_VE.js","./executeForTopExtents-B1APStwO.js","./executeForTopCount-BlZQuhvM.js"])))=>i.map(i=>d[i]);
import{_ as a}from"./index-CeCSsEgo.js";import{e as n}from"./Evented-CXIxDjmW.js";import{S as T,z as p}from"./Accessor-D6mNnsWy.js";import{y as l,b as A,h as N,c as f}from"./subclass-BR3PhgZG.js";import{I as Q}from"./assets-C2mb-ea2.js";import{G as j}from"./Point-DB4Hp4hH.js";import{u as h,i as y}from"./infoFor3D-CxOdoily.js";import{K as _}from"./DataLayerSource-6X35yXpo.js";import{f as S}from"./utils-D61i9O7E.js";import{s as P,a as q}from"./executeForIds-D-tq3ZnE.js";import"./geometry-DpwwkAX1.js";import{x as $}from"./query-DbJf0nTj.js";import{b as D}from"./Query-Cx4awVKu.js";import{w as L}from"./Extent-DHjqVB-p.js";import{a as z}from"./executeQueryJSON-CmP_8PTA.js";import{n as J}from"./executeQueryPBF-SPg7y6Hr.js";import{d as C}from"./FeatureSet-DyOnd9Rj.js";async function U(r,t,e){const o=S(r),u=await $(o,D.from(t),{...e}),i=u.data.extent;return!i||isNaN(i.xmin)||isNaN(i.ymin)||isNaN(i.xmax)||isNaN(i.ymax)?{count:u.data.count,extent:null}:{count:u.data.count,extent:L.fromJSON(i)}}let s=class extends T{constructor(r){super(r),this.dynamicDataSource=null,this.fieldsIndex=null,this.gdbVersion=null,this.infoFor3D=null,this.pbfSupported=!1,this.queryAttachmentsSupported=!1,this.sourceSpatialReference=null,this.url=null}get parsedUrl(){return Q(this.url)}async execute(r,t){const e=await this.executeJSON(r,t);return this.featureSetFromJSON(r,e,t)}async executeJSON(r,t){var c;const e=this._normalizeQuery(r),o=((c=r.outStatistics)==null?void 0:c[0])!=null,u=N("featurelayer-pbf-statistics"),i=!o||u;let m;if(this.pbfSupported&&i)try{m=await J(this.url,e,t)}catch(d){if(d.name!=="query:parsing-pbf")throw d;this.pbfSupported=!1}return this.pbfSupported&&i||(m=await z(this.url,e,t)),this._normalizeFields(m.fields),m}async featureSetFromJSON(r,t,e){if(!this._queryIs3DObjectFormat(r)||this.infoFor3D==null||!t.features)return C.fromJSON(t);const{meshFeatureSetFromJSON:o}=await p(a(()=>import("./meshFeatureSet-GfLj7Azz.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78]),import.meta.url),e);return o(r,this.infoFor3D,t)}executeForCount(r,t){return P(this.url,this._normalizeQuery(r),t)}executeForExtent(r,t){return U(this.url,this._normalizeQuery(r),t)}executeForIds(r,t){return q(this.url,this._normalizeQuery(r),t)}async executeRelationshipQuery(r,t){const[{default:e},{executeRelationshipQuery:o}]=await p(Promise.all([a(()=>import("./RelationshipQuery-kHvI2dm7.js"),__vite__mapDeps([79,2,3,4,5,6,7,8,9,10,11,12,13,14,80,22,77,78]),import.meta.url),a(()=>import("./executeRelationshipQuery-1vmZH8DO.js"),__vite__mapDeps([81,82,4,10,11,12,2,3,7,8,9,83,36,6,13,14,84,85,5,86,87,88,89,90,91,92,63,17,18,64,65,76,1,15,16,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,77,78,79,80]),import.meta.url)]),t);return r=e.from(r),(this.gdbVersion||this.dynamicDataSource)&&((r=r.clone()).gdbVersion=r.gdbVersion||this.gdbVersion,r.dynamicDataSource=r.dynamicDataSource||this.dynamicDataSource),o(this.url,r,t)}async executeRelationshipQueryForCount(r,t){const[{default:e},{executeRelationshipQueryForCount:o}]=await p(Promise.all([a(()=>import("./RelationshipQuery-kHvI2dm7.js"),__vite__mapDeps([79,2,3,4,5,6,7,8,9,10,11,12,13,14,80,22,77,78]),import.meta.url),a(()=>import("./executeRelationshipQuery-1vmZH8DO.js"),__vite__mapDeps([81,82,4,10,11,12,2,3,7,8,9,83,36,6,13,14,84,85,5,86,87,88,89,90,91,92,63,17,18,64,65,76,1,15,16,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,77,78,79,80]),import.meta.url)]),t);return r=e.from(r),(this.gdbVersion||this.dynamicDataSource)&&((r=r.clone()).gdbVersion=r.gdbVersion||this.gdbVersion,r.dynamicDataSource=r.dynamicDataSource||this.dynamicDataSource),o(this.url,r,t)}async executeAttachmentQuery(r,t){const{executeAttachmentQuery:e,fetchAttachments:o,processAttachmentQueryResult:u}=await p(a(()=>import("./queryAttachments-CVryA1Mj.js"),__vite__mapDeps([93,10,4,11,12,2,3,83,36,6,7,8,9,13,14,84,85,5,82,86,87,88,89,90,91,92,63,17,18,64,65,94]),import.meta.url),t),i=S(this.url);return u(i,await(this.queryAttachmentsSupported?e(i,r,t):o(i,r,t)))}async executeTopFeaturesQuery(r,t){const{executeTopFeaturesQuery:e}=await p(a(()=>import("./executeTopFeaturesQuery-C9-9C9cM.js"),__vite__mapDeps([95,82,4,10,11,12,2,3,96,36,6,7,8,9,13,14,84,85,5,86,83,87,88,89,90,91,92,63,17,18,64,65,76,1,15,16,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,77,78,97,98,99]),import.meta.url),t);return e(this.parsedUrl,r,this.sourceSpatialReference,t)}async executeForTopIds(r,t){const{executeForTopIds:e}=await p(a(()=>import("./executeForTopIds-p-ISo_VE.js"),__vite__mapDeps([100,82,4,10,11,12,2,3,96,36,6,7,8,9,13,14,84,85,5,86,83,87,88,89,90,91,92,63,17,18,64,65,97,98,99,21]),import.meta.url),t);return e(this.parsedUrl,r,t)}async executeForTopExtents(r,t){const{executeForTopExtents:e}=await p(a(()=>import("./executeForTopExtents-B1APStwO.js"),__vite__mapDeps([101,5,4,6,2,3,7,8,9,10,11,12,13,14,82,96,36,84,85,86,83,87,88,89,90,91,92,63,17,18,64,65,97,98,99,21]),import.meta.url),t);return e(this.parsedUrl,r,t)}async executeForTopCount(r,t){const{executeForTopCount:e}=await p(a(()=>import("./executeForTopCount-BlZQuhvM.js"),__vite__mapDeps([102,82,4,10,11,12,2,3,96,36,6,7,8,9,13,14,84,85,5,86,83,87,88,89,90,91,92,63,17,18,64,65,97,98,99,21]),import.meta.url),t);return e(this.parsedUrl,r,t)}_normalizeQuery(r){let t=D.from(r);t.sourceSpatialReference=t.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(t=t===r?t.clone():t,t.gdbVersion=r.gdbVersion||this.gdbVersion,t.dynamicDataSource=r.dynamicDataSource?_.from(r.dynamicDataSource):this.dynamicDataSource);const{infoFor3D:e}=this;if(e!=null&&this._queryIs3DObjectFormat(r)){t=t===r?t.clone():t,t.formatOf3DObjects=null;const{supportedFormats:o,queryFormats:u}=e,i=h("model/gltf-binary",o)??y("glb",o),m=h("model/gltf+json",o)??y("gltf",o);for(const c of u){if(c===i){t.formatOf3DObjects=c;break}c!==m||t.formatOf3DObjects||(t.formatOf3DObjects=c)}if(!t.formatOf3DObjects)throw new f("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(t.outSpatialReference&&!j(t.outSpatialReference,this.sourceSpatialReference))throw new f("query:unsupported-out-spatial-reference","3D object feature services do not support projection of geometries");if(t.outFields==null||!t.outFields.includes("*")){t=t===r?t.clone():t,t.outFields==null&&(t.outFields=[]);const{originX:c,originY:d,originZ:x,translationX:b,translationY:F,translationZ:O,scaleX:g,scaleY:R,scaleZ:V,rotationX:E,rotationY:I,rotationZ:v,rotationDeg:w}=e.transformFieldRoles;t.outFields.push(c,d,x,b,F,O,g,R,V,E,I,v,w)}}return t}_normalizeFields(r){if(this.fieldsIndex!=null&&r!=null)for(const t of r){const e=this.fieldsIndex.get(t.name);e&&Object.assign(t,e.toJSON())}}_queryIs3DObjectFormat(r){return this.infoFor3D!=null&&r.returnGeometry===!0&&r.multipatchOption!=="xyFootprint"&&!r.outStatistics}};n([l({type:_})],s.prototype,"dynamicDataSource",void 0),n([l()],s.prototype,"fieldsIndex",void 0),n([l()],s.prototype,"gdbVersion",void 0),n([l()],s.prototype,"infoFor3D",void 0),n([l({readOnly:!0})],s.prototype,"parsedUrl",null),n([l()],s.prototype,"pbfSupported",void 0),n([l()],s.prototype,"queryAttachmentsSupported",void 0),n([l()],s.prototype,"sourceSpatialReference",void 0),n([l({type:String})],s.prototype,"url",void 0),s=n([A("esri.layers.graphics.sources.support.QueryTask")],s);const nt=s;export{nt as x};
