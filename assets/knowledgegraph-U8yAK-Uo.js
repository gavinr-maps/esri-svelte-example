const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./knowledgeGraphService-D9jMriz8.js","./geometry-CnaxvJsv.js","./subclass-BR3PhgZG.js","./Extent-B4rrMrqp.js","./Evented-CXIxDjmW.js","./Accessor-D6mNnsWy.js","./Point-TlcsOcXV.js","./jsonMap-DCC6W5ex.js","./writer-3zufXUNV.js","./assets-BNizZMOZ.js","./index-BVncS3aY.js","./index-CjOb8WjV.css","./Polyline-BQFeqYXi.js","./mathUtils-ClvKsMak.js","./Relationship-PsMGgasm.js"])))=>i.map(i=>d[i]);
import{_ as k}from"./index-BVncS3aY.js";import{s as N}from"./subclass-BR3PhgZG.js";import"./geometry-CnaxvJsv.js";import{a as I,b as l,r as f,a1 as C,m as P,G as y,al as J,P as V,N as W,U as _,W as M,E as q,X as T,w as Q,v as U,am as j,an as A,ao as L}from"./arcadeUtils-CcRQEDay.js";import{l as O}from"./portalUtils-CNzriRTA.js";import{f as b,n as D,R as H,U as X}from"./Point-TlcsOcXV.js";import{_ as z,W as B,K as Y}from"./projection-tSh-0UvX.js";import{C as E}from"./Portal-DCqdz-K4.js";import Z from"./PortalItem-CaeKabGc.js";import{p as $,n as tt}from"./project-DXhIgRZA.js";import{s as rt,m as nt,t as et,p as it,c as ot}from"./Relationship-PsMGgasm.js";import"./Extent-B4rrMrqp.js";import"./Evented-CXIxDjmW.js";import"./Accessor-D6mNnsWy.js";import"./Polyline-BQFeqYXi.js";import"./writer-3zufXUNV.js";import"./mathUtils-ClvKsMak.js";import"./jsonMap-DCC6W5ex.js";import"./TimeOnly-BtK5SiqG.js";import"./UnknownTimeZone-D0GlcniK.js";import"./Promise-CZrWwByK.js";import"./assets-BNizZMOZ.js";import"./ImmutableArray-BPVd6ESQ.js";import"./Field-poIiHWUc.js";import"./enumeration--HlxOQ_N.js";import"./fieldType-CIG5ey7e.js";import"./number-CrcpkfNb.js";import"./jsonUtils-DtWlwXHP.js";import"./featureConversionUtils-B-SknPj_.js";import"./aaBoundingBox-BGxkJAW0.js";import"./OptimizedFeature-7juV2tZm.js";import"./OptimizedGeometry-vU5jWBvU.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./FieldsIndex-DHql50vu.js";import"./fieldUtils-C5R42-PY.js";import"./intl-CArXn1et.js";import"./hash-CcEbRgUF.js";import"./uuid-fwrPAdZb.js";import"./reactiveUtils-BFQ0BtrB.js";import"./shared-B3wH2qpO.js";import"./projectBuffer-iyGwL2dv.js";import"./geodesicConstants-kj1AtlGg.js";import"./persistableUrlUtils-Dx61-x4K.js";import"./utils-Blh5cXWv.js";import"./utils-Bh7lx_TM.js";let u=null;async function at(t){const r=N.geometryServiceUrl??"";if(!r){z()||await B();for(const n of t)n.container[n.indexer]=Y(n.container[n.indexer],b.WGS84);return}const e=t.map(n=>n.container[n.indexer]),o=new $({geometries:e,outSpatialReference:b.WGS84}),p=await tt(r,o);for(let n=0;n<p.length;n++){const i=t[n];i.container[i.indexer]=p[n]}}async function G(t,r){const e=new Z({portal:t,id:r});return await e.load(),u===null&&(u=await k(()=>import("./knowledgeGraphService-D9jMriz8.js").then(o=>o.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url)),await u.fetchKnowledgeGraph(e.url)}function R(t,r,e,o,p){if(t===null)return null;if(y(t)||q(t))return t;if(T(t)||T(t))return t.toJSDate();if(Q(t))return t.toStorageFormat();if(U(t))return t.toStorageString();if(j(t)){const n={};for(const i of t.keys())n[i]=R(t.field(i),r,e,o,p),n[i]instanceof D&&p.push({container:n,indexer:i});return n}if(_(t)){const n=t.map(i=>R(i,r,e,o,p));for(let i=0;i<n.length;i++)n[i]instanceof D&&p.push({container:n,indexer:i});return n}return A(t)?t.spatialReference.isWGS84?t:t.spatialReference.isWebMercator&&r?H(t):t:void 0}function pt(t,r){if(!t)return t;if(t.spatialReference.isWGS84&&r.spatialReference.isWebMercator)return X(t);if(t.spatialReference.equals(r.spatialReference))return t;throw new l(r,f.WrongSpatialReference,null)}function v(t,r){if(!t)return null;const e={};for(const o in t)e[o]=g(t[o],r);return e}function g(t,r){return t===null?null:_(t)?t.map(e=>g(e,r)):t instanceof nt?{graphTypeName:t.typeName,id:t.id,graphType:"entity",properties:v(t.properties,r)}:t instanceof et?{graphType:"object",properties:v(t.properties,r)}:t instanceof it?{graphTypeName:t.typeName,id:t.id,graphType:"relationship",originId:t.originId??null,destinationId:t.destinationId??null,properties:v(t.properties,r)}:t instanceof ot?{graphType:"path",path:t.path?t.path.map(e=>g(e,r)):null}:A(t)?pt(t,r):y(t)||q(t)||L(t)?t:null}function $t(t){t.mode==="async"&&(t.functions.knowledgegraphbyportalitem=function(r,e){return t.standardFunctionAsync(r,e,(o,p,n)=>{var c,d;if(I(n,2,2,r,e),n[0]===null)throw new l(r,f.PortalRequired,e);if(n[0]instanceof C){const m=P(n[1]);let h;return h=(c=r.services)!=null&&c.portal?r.services.portal:E.getDefault(),G(O(n[0],h),m)}if(y(n[0])===!1)throw new l(r,f.InvalidParameter,e);const i=P(n[0]);return G(((d=r.services)==null?void 0:d.portal)??E.getDefault(),i)})},t.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),t.functions.querygraph=function(r,e){return t.standardFunctionAsync(r,e,async(o,p,n)=>{var x;I(n,2,4,r,e);const i=n[0];if(!J(i))throw new l(r,f.InvalidParameter,e);const c=n[1];if(!y(c))throw new l(r,f.InvalidParameter,e);u===null&&(u=await k(()=>import("./knowledgeGraphService-D9jMriz8.js").then(a=>a.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url));let d=null;const m=V(n[2],null);if(!(m instanceof W||m===null))throw new l(r,f.InvalidParameter,e);if(m){let a=[];d=R(m,!0,!1,r,a),a=a.filter(s=>!s.container[s.indexer].spatialReference.isWGS84),a.length>0&&await at(a)}const h=new rt({openCypherQuery:c,bindParameters:d});(((x=i==null?void 0:i.serviceDefinition)==null?void 0:x.currentVersion)??11.3)>11.2&&(h.outputSpatialReference=r.spatialReference);const F=(await u.executeQueryStreaming(i,h)).resultRowsStream.getReader(),S=[];try{for(;;){const{done:a,value:s}=await F.read();if(a)break;if(_(s))for(const w of s)S.push(g(w,r));else{const w=[];for(const K of s)w.push(g(s[K],r));S.push(w)}}}catch(a){throw a}return W.convertJsonToArcade(S,M(r),!1,!0)})},t.signatures.push({name:"querygraph",min:2,max:4}))}export{$t as registerFunctions};
