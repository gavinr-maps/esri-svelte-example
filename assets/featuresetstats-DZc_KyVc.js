import{R as s,i as y,z as d}from"./opacityUtils-Dim20wpZ.js";import{a as F,r as A}from"./executionError-DNkSe-Q-.js";import{o as w,B as u,d as f,q as c,i as S}from"./deepClone-DD9qKKD3.js";import{l as m}from"./arcade-BXELiP5l.js";import{D as p,i as h}from"./WhereClause-xGR0ztic.js";import"./Accessor-BmwT4B0c.js";import"./index-4eY77cms.js";import"./Promise-DfET-uns.js";import"./cast-CsZslgGN.js";import"./JSONSupport-DcrLLGjL.js";import"./Point-Cz2JYYmX.js";import"./writer-DKgfqj4X.js";import"./ImmutableArray-BPVd6ESQ.js";import"./shared-2m9g3-y2.js";import"./TimeOnly-CveCl9ie.js";import"./Extent-g5W9hy0j.js";import"./Field-BDG0QV_T.js";import"./enumeration-DpvDkLNI.js";import"./fieldType-CBeoJWlv.js";import"./number-QOqKffTG.js";import"./Polyline-s-JzsQqo.js";import"./mathUtils-Cfq9PL9W.js";import"./jsonUtils-CwFG8yN4.js";import"./featureConversionUtils-CvnFcmH_.js";import"./aaBoundingBox-Dw3yBk2f.js";import"./OptimizedFeature-P2towpqD.js";import"./memoryEstimations-Bcyf-mHz.js";import"./OptimizedGeometry-BJqUA4Pi.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./FieldsIndex-FW1AMU67.js";import"./timeZoneUtils-DxzjpEBb.js";import"./unitConversion-DvIVg62C.js";import"./hash-CcEbRgUF.js";import"./uuid-Cl5lrJ4c.js";import"./Portal-CmmHxpLg.js";async function e(i,r,t,o){if(t.length===1){if(s(t[0]))return m(i,t[0],c(t[1],-1));if(f(t[0]))return m(i,t[0].toArray(),c(t[1],-1))}else if(t.length===2){if(s(t[0]))return m(i,t[0],c(t[1],-1));if(f(t[0]))return m(i,t[0].toArray(),c(t[1],-1));if(u(t[0])){const a=await t[0].load(),n=await g(p.create(t[1],{fieldsIndex:a.getFieldsIndex(),timeZone:a.dateFieldsTimeZoneDefaultUTC}),o,r);return l(r,await t[0].calculateStatistic(i,n,c(t[2],1e3),r.abortSignal))}}else if(t.length===3&&u(t[0])){const a=await t[0].load(),n=await g(p.create(t[1],{fieldsIndex:a.getFieldsIndex(),timeZone:a.dateFieldsTimeZoneDefaultUTC}),o,r);return l(r,await t[0].calculateStatistic(i,n,c(t[2],1e3),r.abortSignal))}return m(i,t,-1)}function l(i,r){return r instanceof h?d.fromReaderAsTimeStampOffset(r.toStorageFormat()):r instanceof Date?d.dateJSAndZoneToArcadeDate(r,S(i)):r}async function g(i,r,t){const o=i.getVariables();if(o.length>0){const a={};for(const n of o)a[n]=r.evaluateIdentifier(t,{name:n});i.parameters=a}return i}function nt(i){i.mode==="async"&&(i.functions.stdev=function(r,t){return i.standardFunctionAsync(r,t,(o,a,n)=>e("stdev",r,n,i))},i.functions.variance=function(r,t){return i.standardFunctionAsync(r,t,(o,a,n)=>e("variance",r,n,i))},i.functions.average=function(r,t){return i.standardFunctionAsync(r,t,(o,a,n)=>e("mean",r,n,i))},i.functions.mean=function(r,t){return i.standardFunctionAsync(r,t,(o,a,n)=>e("mean",r,n,i))},i.functions.sum=function(r,t){return i.standardFunctionAsync(r,t,(o,a,n)=>e("sum",r,n,i))},i.functions.min=function(r,t){return i.standardFunctionAsync(r,t,(o,a,n)=>e("min",r,n,i))},i.functions.max=function(r,t){return i.standardFunctionAsync(r,t,(o,a,n)=>e("max",r,n,i))},i.functions.count=function(r,t){return i.standardFunctionAsync(r,t,async(o,a,n)=>{if(w(n,1,1,r,t),u(n[0]))return n[0].count(o.abortSignal);if(s(n[0])||y(n[0]))return n[0].length;if(f(n[0]))return n[0].length();throw new F(r,A.InvalidParameter,t)})})}export{nt as registerFunctions};
