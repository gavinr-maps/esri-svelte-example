import{l as E}from"./Color-BCS62Hs5.js";import{G as D}from"./colorUtils-aL8wj-8G.js";import{b as U}from"./subclass-BZA_h8Db.js";import{c as V}from"./fontUtils-BKHqaMFz.js";import{u as b}from"./screenUtils-_ZIvrt5o.js";import{u as T,y as O,g as W,f as G}from"./utils-Ce7L3imC.js";import{t as S,e as H,d as F,l as I}from"./symbolUtils-_AKSLEsP.js";import{s as L}from"./TextSymbol-D8QO_KUV.js";import"./colorUtils-0bJDPow9.js";import"./mathUtils-C4_ghTv4.js";import"./vec42-YcqnINSP.js";import"./common-DQOJ18NT.js";import"./vec4f64-o2zAXfmz.js";import"./index-Bh2oEzTI.js";import"./symbols-CNimns--.js";import"./tslib.es6-B3Jf3DVX.js";import"./enumeration-Ba5njXdz.js";import"./jsonMap-0cxwUWs2.js";import"./writer-DNAwXnhG.js";import"./fieldUtils-tmQlKvWo.js";import"./Accessor-BLX9ikPh.js";import"./intl-CChhNOV8.js";import"./date-DlqISzcw.js";import"./locale-C9TlLpzi.js";import"./messages-OmQvZhAg.js";import"./assets-C43MgM-v.js";import"./geometry-D964gYQX.js";import"./Extent-Bf3YTe7m.js";import"./Point-Cg0-ChZE.js";import"./cast-Bjksrh93.js";import"./Polyline-D9YkgmM_.js";import"./materialUtils-DarhapKC.js";import"./opacityUtils-C68Tlu6_.js";import"./vec3f64-BLpZdpfb.js";import"./aaBoundingBox-BE7cC1jD.js";import"./persistableUrlUtils-fa1mAujs.js";import"./Collection-CEdjem1-.js";import"./Evented-BHRw9x22.js";import"./shared-B3wH2qpO.js";import"./SimpleObservable-KocWTzVy.js";import"./collectionUtils-D_lHIu88.js";import"./Portal-C10FKnaA.js";import"./Loadable-BabW5Xcc.js";import"./Promise-B2Hu02L7.js";import"./Clonable-D3rtuBWg.js";import"./reactiveUtils-C5zUhJQJ.js";import"./asyncUtils-CWX51uTe.js";import"./jsonUtils-CSnQD004.js";import"./parser-CTsgEym6.js";import"./utils-93yNk4Xc.js";import"./mat4f32-DcsiF_Rp.js";import"./mat4-GpOFENPA.js";import"./cimSymbolUtils-DXvZxabN.js";import"./utils-D2PLyMFF.js";import"./enums-CmIX1y88.js";import"./LRUCache-B_PHMSGm.js";import"./MemCache-Dx1v3xLC.js";import"./jsxFactory-CJa39Fro.js";import"./uuid-fwrPAdZb.js";import"./mat2df32-orApM5a3.js";import"./mat2d-D9DBP-jx.js";import"./webStyleSymbolUtils-CwdsUGtV.js";import"./devEnvironmentUtils-CnNDiFMM.js";import"./jsonUtils-Ds2Sqto-.js";import"./layerUtils-BrNoooE9.js";import"./defaults-DZ1kfMRx.js";import"./defaultsJSON-GKolV7NZ.js";import"./styleUtils-BYTm14n3.js";const R="picture-fill",$="picture-marker",J="simple-fill",K="simple-line",N="simple-marker",Q="text",X="Aa",Y=S.size,C=S.maxSize,_=S.maxOutlineSize,Z=S.lineWidth,A=225,ii=document.createElement("canvas");function q(o,i){const a=ii.getContext("2d"),e=[];i&&(i.weight&&e.push(i.weight),i.size&&e.push(i.size+"px"),i.family&&e.push(i.family)),a.font=e.join(" ");const{width:m,actualBoundingBoxLeft:s,actualBoundingBoxRight:u,actualBoundingBoxAscent:l,actualBoundingBoxDescent:h}=a.measureText(o);return{width:Math.ceil(Math.max(m,s+u)),height:Math.ceil(l+h),x:Math.floor(s),y:Math.floor((l-h)/2)}}function x(o){const i=o==null?void 0:o.size;return{width:i!=null&&typeof i=="object"&&"width"in i?b(i.width):null,height:i!=null&&typeof i=="object"&&"height"in i?b(i.height):null}}async function oi(o,i){const a=i.fill,e=o.color;if((a==null?void 0:a.type)==="pattern"&&e&&o.type!==R){const m=await G(a.src,e.toCss(!0));a.src=m,i.fill=a}}async function ei(o,i,a,e){var u,l,h;if(!("font"in o)||!o.font||i.shape.type!=="text")return;try{await V(o.font)}catch{}const{width:m,height:s}=x(e);if(!/[\uE600-\uE6FF]/.test(i.shape.text)){const{width:d,height:f,x:t,y:n}=q(i.shape.text,{weight:(u=i.font)==null?void 0:u.weight,size:(l=i.font)==null?void 0:l.size,family:(h=i.font)==null?void 0:h.family});a[0]=m??d,a[1]=s??f,i.shape.x=t,i.shape.y=n;let w="angle"in o?o.angle:null;if((e==null?void 0:e.rotation)!=null&&(w=(w??0)+e.rotation),w){const M=w*(Math.PI/180),p=Math.abs(Math.sin(M)),c=Math.abs(Math.cos(M));a[1]=a[0]*p+a[1]*c}}}function ai(o,i,a,e,m){var s;if(o.haloColor!=null&&o.haloSize!=null){m.masking??(m.masking=a.map(()=>[]));const u=b(o.haloSize);e[0]+=u,e[1]+=u,a.unshift([{...i,fill:null,stroke:{color:o.haloColor,width:2*u,join:"round",cap:"round"}}]),m.masking.unshift([{shape:{type:"rect",x:0,y:0,width:e[0]+2*L,height:e[1]+2*L},fill:[255,255,255],stroke:null},{...i,fill:[0,0,0,0],stroke:null}])}o.backgroundColor==null&&o.borderLineColor==null||(e[0]+=2*L,e[1]+=2*L,a.unshift([{shape:{type:"rect",x:0,y:0,width:e[0],height:e[1]},fill:o.backgroundColor,stroke:{color:o.borderLineColor,width:b(o.borderLineSize)}}]),(s=m.masking)==null||s.unshift([]))}function P(o,i){return o>i?"dark":"light"}function ti(o,i){var M;const a=typeof(i==null?void 0:i.size)=="number"?i==null?void 0:i.size:null,e=a!=null?b(a):null,m=(i==null?void 0:i.maxSize)!=null?b(i.maxSize):null;let s="angle"in o?o.angle:null;(i==null?void 0:i.rotation)!=null&&(s=(s??0)+i.rotation);const u=T(o);let l=O(o);ni(o,245)!=="dark"||i!=null&&i.ignoreWhiteSymbols||(l={width:.75,...l,color:"#bdc3c7"});const h={shape:null,fill:u,stroke:l,offset:[0,0]};l!=null&&l.width&&(l.width=Math.min(l.width,_));const d=(l==null?void 0:l.width)||0;let f=(i==null?void 0:i.size)!=null&&((i==null?void 0:i.scale)==null||(i==null?void 0:i.scale)),t=0,n=0,w=!1;switch(o.type){case N:{const p=o.style,{width:c,height:r}=x(i),v=c===r&&c!=null?c:e??Math.min(b(o.size),m||C);switch(t=v,n=v,p){case"circle":h.shape={type:"circle",cx:0,cy:0,r:.5*v},f||(t+=d,n+=d);break;case"cross":h.shape={type:"path",path:[{command:"M",values:[0,.5*n]},{command:"L",values:[t,.5*n]},{command:"M",values:[.5*t,0]},{command:"L",values:[.5*t,n]}]};break;case"diamond":h.shape={type:"path",path:[{command:"M",values:[0,.5*n]},{command:"L",values:[.5*t,0]},{command:"L",values:[t,.5*n]},{command:"L",values:[.5*t,n]},{command:"Z",values:[]}]},f||(t+=d,n+=d);break;case"square":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,0]},{command:"L",values:[t,n]},{command:"L",values:[0,n]},{command:"Z",values:[]}]},f||(t+=d,n+=d),s&&(w=!0);break;case"triangle":h.shape={type:"path",path:[{command:"M",values:[.5*t,0]},{command:"L",values:[t,n]},{command:"L",values:[0,n]},{command:"Z",values:[]}]},f||(t+=d,n+=d),s&&(w=!0);break;case"x":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,n]},{command:"M",values:[t,0]},{command:"L",values:[0,n]}]},s&&(w=!0);break;case"path":h.shape={type:"path",path:o.path||""},f||(t+=d,n+=d),s&&(w=!0),f=!0}break}case K:{const{width:p,height:c}=x(i),r=W(l).reduce((B,k)=>B+k,0),v=r&&Math.ceil(Z/r),y=c??e??d,g=p??(r*v||Z);l&&(l.width=y),t=g,n=y,f=!0,h.shape={type:"path",path:[{command:"M",values:[y/2,n/2]},{command:"L",values:[t-y/2,n/2]}]};break}case R:case J:{const p=typeof(i==null?void 0:i.symbolConfig)=="object"&&!!((M=i==null?void 0:i.symbolConfig)!=null&&M.isSquareFill),{width:c,height:r}=x(i);t=!p&&c!==r||c==null?e??Y:c,n=!p&&c!==r||r==null?t:r,f||(t+=d,n+=d),f=!0,h.shape=p?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,0]},{command:"L",values:[t,n]},{command:"L",values:[0,n]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:H.fill[0];break}case $:{const p=Math.min(b(o.width),m||C),c=Math.min(b(o.height),m||C),{width:r,height:v}=x(i),y=r===v&&r!=null?r:e??Math.max(p,c),g=p/c;t=g<=1?Math.ceil(y*g):y,n=g<=1?y:Math.ceil(y/g),h.shape={type:"image",x:-Math.round(t/2),y:-Math.round(n/2),width:t,height:n,src:o.url||""},s&&(w=!0);break}case Q:{const p=o,c=(i==null?void 0:i.overrideText)||p.text||X,r=p.font,{width:v,height:y}=x(i),g=y??e??Math.min(b(r.size),m||C),{width:B,height:k}=q(c,{weight:r.weight,size:g,family:r.family}),z=/[\uE600-\uE6FF]/.test(c);t=v??(z?g:B),n=z?g:k;let j=.5*(z?g:k);z&&(j+=5),h.shape={type:"text",text:c,x:p.xoffset||0,y:p.yoffset||j,align:"middle",alignBaseline:p.verticalAlignment,decoration:r&&r.decoration,rotated:p.rotated,kerning:p.kerning},h.font=r&&{size:g,style:r.style,decoration:r.decoration,weight:r.weight,family:r.family};break}}return{shapeDescriptor:h,size:[t,n],renderOptions:{node:i==null?void 0:i.node,scale:f,opacity:i==null?void 0:i.opacity,rotations:[s],useRotationSize:w,effectView:i==null?void 0:i.effectView,ariaLabel:i==null?void 0:i.ariaLabel}}}async function xo(o,i){var u;const{shapeDescriptor:a,size:e,renderOptions:m}=ti(o,i);if(!a.shape)throw new U("symbolPreview: renderPreviewHTML2D","symbol not supported.");await oi(o,a),await ei(o,a,e,i);const s=[[a]];if(typeof(i==null?void 0:i.symbolConfig)=="object"&&((u=i==null?void 0:i.symbolConfig)!=null&&u.applyColorModulation)){const l=.6*e[0];s.unshift([{...a,offset:[-l,0],fill:F(a.fill,-.3)}]),s.push([{...a,offset:[l,0],fill:F(a.fill,.3)}]),e[0]+=2*l,m.scale=!1}return o.type==="text"&&ai(o,a,s,e,m),I(s,e,m)}function ni(o,i=A){const a=T(o),e=O(o),m=!a||"type"in a?null:new E(a),s=e!=null&&e.color?new E(e==null?void 0:e.color):null,u=m?P(D(m),i):null,l=s?P(D(s),i):null;return l?u?u===l?u:i>=A?"light":"dark":l:u}export{ni as getContrastingBackgroundTheme,ti as getRenderSymbolParameters,xo as previewSymbol2D};
