const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./editingSupport-DwgIc4Po.js","./Graphic-Dt0LgVGU.js","./Accessor-BmwT4B0c.js","./Clonable-Z-AWS-16.js","./reactiveUtils-XM7cS2OP.js","./Evented-Dw4_VOGn.js","./SimpleObservable-CvOkykwM.js","./JSONSupport-DcrLLGjL.js","./cast-CsZslgGN.js","./index-4eY77cms.js","./index-Cx51aysm.css","./writer-DKgfqj4X.js","./opacityUtils-Dim20wpZ.js","./Promise-DfET-uns.js","./Point-Cz2JYYmX.js","./enumeration-DpvDkLNI.js","./Color-VJEMvW-n.js","./colorUtils-Rxh2V3ai.js","./mathUtils-Cfq9PL9W.js","./ActionToggle-D7439N1A.js","./Identifiable-BHVfzH03.js","./jsonUtils-CwFG8yN4.js","./Extent-g5W9hy0j.js","./Polyline-s-JzsQqo.js","./typeUtils-B6WBEKDM.js","./TextSymbol-BLIQ6RKX.js","./screenUtils-_ZIvrt5o.js","./collectionUtils-CTT-51g7.js","./Portal-CmmHxpLg.js","./vec3f64-BLpZdpfb.js","./aaBoundingBox-Dw3yBk2f.js","./uuid-Cl5lrJ4c.js","./normalizeUtils-BTGdXlpz.js","./normalizeUtilsCommon-lGDszWRI.js","./utils-YowqfOgk.js","./utils-B-dlKIhi.js","./EditBusLayer-KXo-LY9o.js","./infoFor3D-C7tb3HsI.js","./layerUtils-B__v9OBu.js"])))=>i.map(i=>d[i]);
import{_ as O}from"./index-4eY77cms.js";import{o as j,s as y}from"./cast-CsZslgGN.js";import{c as T}from"./reactiveUtils-XM7cS2OP.js";import{W as C,s}from"./Accessor-BmwT4B0c.js";import{e as B,F as R,y as _}from"./opacityUtils-Dim20wpZ.js";import{e as k}from"./uuid-Cl5lrJ4c.js";import{p as q,a as A}from"./Field-BDG0QV_T.js";import{r as M}from"./featureQueryAll-JpNZKIBO.js";import{I as z,x as L}from"./layerUtils-B__v9OBu.js";import{p as N}from"./SimpleRenderer-CEw_geZx.js";import{A as G}from"./UniqueValueRenderer-yoWHKJ_P.js";import V from"./AttachmentQuery-CpEmJqq-.js";import{n as $}from"./NormalizationBinParametersMixin-CZD0XfhN.js";import{b as m}from"./Query-B_2mhyL4.js";import S from"./RelationshipQuery-B5a-mYy7.js";import{D as J}from"./Graphic-Dt0LgVGU.js";const wt=new j({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function bt(t,e,r,n){const o=await f(t);if(await w(t,e,n),!o.addAttachment)throw new s(n,"Layer source does not support addAttachment capability");return o.addAttachment(e,r)}function w(t,e,r){var i,u;const{attributes:n}=e,{objectIdField:o}=t;return(u=(i=t.capabilities)==null?void 0:i.data)!=null&&u.supportsAttachment?e?n?o&&n[o]?Promise.resolve():Promise.reject(new s(r,`feature is missing the identifying attribute ${o}`)):Promise.reject(new s(r,"'attributes' are required on a feature to query attachments")):Promise.reject(new s(r,"A feature is required to add/delete/update attachments")):Promise.reject(new s(r,"this layer doesn't support attachments"))}async function gt(t,e,r,n,o){const i=await f(t);if(await w(t,e,o),!i.updateAttachment)throw new s(o,"Layer source does not support updateAttachment capability");return i.updateAttachment(e,r,n)}async function It(t,e,r){const{applyEdits:n}=await O(()=>import("./editingSupport-DwgIc4Po.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38]),import.meta.url),o=await t.load();let i=r;return o.type==="feature"&&o.infoFor3D&&e.deleteFeatures!=null&&o.globalIdField!=null&&(i={...i,globalIdToObjectId:await K(o,e.deleteFeatures,o.globalIdField)}),n(o,o.source,e,r)}async function Ft(t,e,r){const{uploadAssets:n}=await O(()=>import("./editingSupport-DwgIc4Po.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38]),import.meta.url),o=await t.load();return n(o,o.source,e,r)}async function xt(t,e,r,n){const o=await f(t);if(await w(t,e,n),!o.deleteAttachments)throw new s(n,"Layer source does not support deleteAttachments capability");return o.deleteAttachments(e,r)}async function Pt(t,e,r){const n=(await t.load({signal:e==null?void 0:e.signal})).source;if(!n.fetchRecomputedExtents)throw new s(r,"Layer source does not support fetchUpdates capability");return n.fetchRecomputedExtents(e)}async function vt(t,e,r,n){var g,I,F,x;e=V.from(e),await t.load();const o=t.source,i=t.capabilities;if(!((g=i==null?void 0:i.data)!=null&&g.supportsAttachment))throw new s(n,"this layer doesn't support attachments");const{attachmentTypes:u,objectIds:l,globalIds:c,num:p,size:a,start:d,where:b}=e;if(!((I=i==null?void 0:i.operations)!=null&&I.supportsQueryAttachments)&&((u==null?void 0:u.length)>0||(c==null?void 0:c.length)>0||(a==null?void 0:a.length)>0||p||d||b))throw new s(n,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(l!=null&&l.length||c!=null&&c.length||b))throw new s(n,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!o.queryAttachments)throw new s(n,"Layer source does not support queryAttachments capability",e);return!((F=i==null?void 0:i.attachment)!=null&&F.supportsOrderByFields)&&((x=e.orderByFields)!=null&&x.length)&&((e=e.clone()).orderByFields=null),o.queryAttachments(e)}async function Ot(t,e,r,n){const o=await f(t);if(!o.queryObjectIds)throw new s(n,"Layer source does not support queryObjectIds capability");return o.queryObjectIds(m.from(e)??t.createQuery(),r)}async function qt(t,e,r,n){const o=await f(t);if(!o.queryFeatureCount)throw new s(n,"Layer source does not support queryFeatureCount capability");return o.queryFeatureCount(m.from(e)??t.createQuery(),r)}async function At(t,e,r,n){const o=await f(t);if(!o.queryExtent)throw new s(n,"Layer source does not support queryExtent capability");return o.queryExtent(m.from(e)??t.createQuery(),r)}async function Lt(t,e,r,n){const o=await f(t);if(!o.queryRelatedFeatures)throw new s(n,"Layer source does not support queryRelatedFeatures capability");return o.queryRelatedFeatures(S.from(e),r)}async function St(t,e,r,n){const o=await f(t);if(!o.queryRelatedFeaturesCount)throw new s(n,"Layer source does not support queryRelatedFeaturesCount capability");return o.queryRelatedFeaturesCount(S.from(e),r)}async function Et(t){const e=t.source;if(e!=null&&e.refresh)try{const{dataChanged:r,updates:n}=await e.refresh();if(n!=null&&(t.sourceJSON={...t.sourceJSON,...n},t.read(n,{origin:"service",url:t.parsedUrl})),r)return!0}catch{}if(t.definitionExpression)try{return(await B(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function Dt(t){var u,l;const e=new m,r=(u=t.capabilities)==null?void 0:u.data,n=(l=t.capabilities)==null?void 0:l.query;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,n&&(e.compactGeometryEnabled=n.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=n.supportsDefaultSpatialReference),r&&(r.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),r.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:o,timeExtent:i}=t;return e.timeExtent=o!=null&&i!=null?i.offset(-o.value,o.unit):i||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function jt(t){const{globalIdField:e,fields:r}=t;if(e)return e;if(r){for(const n of r)if(n.type==="esriFieldTypeGlobalID")return n.name}}function Tt(t){const{objectIdField:e,fields:r}=t;if(e)return e;if(r){for(const n of r)if(n.type==="esriFieldTypeOID")return n.name}}function Ct(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}function Bt(t,e,r,n){var c,p;const o=r==null?void 0:r.feature,i=!!((c=t.subtypes)!=null&&c.length);if(i&&!(r!=null&&r.excludeImpliedDomains)){const a=U(t,e);if(a)return a}const u=i&&Q(t,o);if(u){const a=(p=u==null?void 0:u.domains)==null?void 0:p[e];return(a==null?void 0:a.type)==="inherited"?n:a}const l=X(t.types,t.typeIdField,o);if(l){const a=l.domains&&l.domains[e];if(a&&(a==null?void 0:a.type)!=="inherited")return a}if(n)return n;if(!(r!=null&&r.excludeImpliedDomains)){const a=Z(t,e);if(a)return a}return null}function Q(t,e){const{subtypes:r,subtypeField:n}=t;if(!(e!=null&&e.attributes)||!(r!=null&&r.length)||!n)return null;const o=e.attributes[n];return o==null?null:r.find(i=>i.code===o)}function U(t,e){var u,l;const{fieldsIndex:r,subtypeField:n}=t,{name:o,type:i}=r.get(e)??{};if(!o)return null;if((n&&((u=r.get(n))==null?void 0:u.name))===o&&((l=t.subtypes)!=null&&l.length)){const c=t.subtypes.map(p=>new q({code:E(p.code,i),name:p.name}));if(c!=null&&c.length)return new A({codedValues:c})}return null}function Z(t,e){var i,u;const{fieldsIndex:r}=t,{name:n,type:o}=r.get(e)??{};if(!n)return null;if(("typeIdField"in t?(i=r.get(t.typeIdField))==null?void 0:i.name:null)===n&&"types"in t&&((u=t.types)!=null&&u.length)){const l=t.types.map(c=>new q({code:E(c.id,o),name:c.name}));return new A({codedValues:l})}return null}function E(t,e){return e?R({type:e})&&typeof t=="number"?`${t}`:_({type:e})&&typeof t=="string"?Number.parseInt(t,10):t:t}async function f(t){return(await t.load()).source}async function Rt(t,e){if(!y)return;const r=y.findCredential(t);if(r)return r.userId;let n;try{const o=await L(t,e);o&&(n=await y.checkSignInStatus(`${o}/sharing`))}catch{}return n?n.userId:null}async function D(t,e){if(!y||y.findCredential(t))return;let r;try{const n=await L(t,e);n&&(r=await y.checkSignInStatus(`${n}/sharing`))}catch{}if(r)try{const n=e!=null?e.signal:null;await y.getCredential(t,{signal:n})}catch{}}async function _t(t,e,r){var o;const n=(o=t.parsedUrl)==null?void 0:o.path;n&&t.authenticationTriggerEvent===e&&await D(n,r)}async function kt(t){var r;const e=(r=t.parsedUrl)==null?void 0:r.path;e&&H(t)&&await D(e)}function H(t){return W(t)&&("serviceDefinitionExpression"in t&&P(t.serviceDefinitionExpression)||"definitionExpression"in t&&P(t.definitionExpression))}function W(t){var e;return!(!z(t)||!((e=t.capabilities)!=null&&e.query.supportsCurrentUser))}function P(t){return!!(t!=null&&t.toLowerCase().includes("current_user"))}function Mt(t){return!Y(t)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const h=C({types:J});function zt(t,e){var r;if(t.defaultSymbol)return(r=t.types)!=null&&r.length?new G({defaultSymbol:h(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(n=>({id:n.id,symbol:h(n.symbol,n,e)}))}):new N({symbol:h(t.defaultSymbol,t,e)})}function Nt(t){var n,o,i;let e=(n=t.sourceJSON)==null?void 0:n.cacheMaxAge;if(!e)return!1;const r=(i=(o=t.editingInfo)==null?void 0:o.lastEditDate)==null?void 0:i.getTime();return r==null||(e*=1e3,Date.now()-r<e)}async function K(t,e,r){if(e==null)return null;const n=[],{objectIdField:o}=t;if(e.forEach(p=>{let a=null;if("attributes"in p){const{attributes:d}=p;a={globalId:d[r],objectId:d[o]!=null&&d[o]!==-1?d[o]:null}}else a={globalId:p.globalId,objectId:p.objectId!=null&&p.objectId!==-1?p.objectId:null};a.globalId!=null&&(a.objectId!=null&&a.objectId!==-1||n.push(a.globalId))}),n.length===0)return null;const i=t.createQuery();i.where=n.map(p=>`${r}='${p}'`).join(" OR "),i.returnGeometry=!1,i.outFields=[o,r],i.cacheHint=!1;const u=await T(M(t,i));if(!u.ok)return null;const l=new Map,c=u.value.features;for(const p of c){const a=p.attributes[r],d=p.attributes[o];a!=null&&d!=null&&d!==-1&&l.set(k(a),d)}return l}function X(t,e,r){if(!e||!r||!t)return null;const n=r.getAttribute(e);return n==null?null:t.find(o=>{const{id:i}=o;return i!=null&&i.toString()===n.toString()})??null}function Y(t){var e;return((e=t.sourceJSON)==null?void 0:e.isMultiServicesView)||tt(t)}function tt(t){var e,r;return!!((r=(e=t.sourceJSON)==null?void 0:e.capabilities)!=null&&r.toLowerCase().split(",").map(n=>n.trim()).includes("map"))}function Gt(t,e,r){const n=e==null?void 0:e.queryAttributeBins;if(!n)throw new s(r,"Layer source does not support binning");switch(t.binParameters.type){case"auto-interval":if(!n.supportsAutoInterval)throw new s(r,"Layer source does not support auto-interval binning");if(t.binParameters.normalizationType&&(!n.supportsNormalization||!v(t.binParameters.normalizationType,n.supportedNormalizationTypes)))throw new s(r,"Layer source does not support normalization binning");break;case"date":if(!n.supportsDate)throw new s(r,"Layer source does not support date binning");if(t.binParameters.snapToData&&!n.supportsSnapToData)throw new s(r,"Layer source does not support snapToData binning");if(t.binParameters.returnFullIntervalBin&&!n.supportsReturnFullIntervalBin)throw new s(r,"Layer source does not support returnFullIntervalBin binning");break;case"fixed-boundaries":if(!n.supportsFixedBoundaries)throw new s(r,"Layer source does not support fixed-boundaries binning");break;case"fixed-interval":if(!n.supportsFixedInterval)throw new s(r,"Layer source does not support fixed-interval binning");if(t.binParameters.normalizationType&&(!n.supportsNormalization||!v(t.binParameters.normalizationType,n.supportedNormalizationTypes)))throw new s(r,"Layer source does not support normalization binning")}if(t.binParameters.stackBy&&!n.supportsStackBy)throw new s(r,"Layer source does not support stackBy binning");if(t.binParameters.splitBy&&!n.supportsSplitBy)throw new s(r,"Layer source does not support splitBy binning");if(t.binParameters.firstDayOfWeek&&!n.supportsFirstDayOfWeek)throw new s(r,"Layer source does not support firstDayOfWeek binning");const o=n==null?void 0:n.supportedStatistics;if(t.outStatistics&&o){const i=new Map([["count","count"],["sum","sum"],["min","min"],["max","max"],["avg","avg"],["stddev","stddev"],["var","var"],["percentile-continuous","percentileContinuous"],["percentile-discrete","percentileDiscrete"],["centroid-aggregate","centroid"],["convex-hull-aggregate","convexHull"],["envelope-aggregate","envelope"]]);for(const{statisticType:u}of t.outStatistics){const l=i.get(u);if(l&&!o[l])throw new s(r,`Layer source does not support ${u} statistic type`)}}}function v(t,e){return t!=null&&!!(e!=null&&e[$.toJSON(t)])}export{vt as A,Et as B,St as C,At as D,qt as E,bt as F,Z as G,_t as H,Rt as J,Ot as L,jt as M,Bt as N,Pt as O,gt as P,Dt as R,Ft as S,Lt as T,Q as U,U as V,kt as W,P as X,Mt as Y,D as Z,Gt as a,Y as i,wt as j,Tt as k,K as n,X as o,It as q,Nt as r,zt as t,xt as v,Ct as z};
