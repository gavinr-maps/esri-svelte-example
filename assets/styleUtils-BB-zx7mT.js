import{R as d,P as w,K as p}from"./cast-BA_-jlhc.js";import{s as b,V as h,M as g}from"./Accessor-BHnuXKD2.js";import{C as R,c as U}from"./Portal-CTRRujjZ.js";const i=new Map;async function $(e,s){try{return{data:(await C(e,s)).data,baseUrl:d(e),styleUrl:e}}catch(t){return h(t),null}}function N(e,s,t){var u;const r=s.portal!=null?s.portal:R.getDefault();let n;const f=`${r.url} - ${(u=r.user)==null?void 0:u.username} - ${e}`,a=i.get(f);if(a)return a;const o=k(e,r,t).then(l=>(n=l,l.fetchData())).then(l=>({data:l,baseUrl:n.itemUrl??"",styleName:e}));return i.set(f,o),o}function k(e,s,t){return s.load(t).then(()=>{const r=new U({disableExtraQuery:!0,query:`owner:${y} AND type:${m} AND typekeywords:"${e}"`});return s.queryItems(r,t)}).then(({results:r})=>{var a;let n=null;const f=e.toLowerCase();if(r&&Array.isArray(r)){for(const o of r)if(((a=o.typeKeywords)==null?void 0:a.some(l=>l.toLowerCase()===f))&&o.type===m&&o.owner===y){n=o;break}}if(!n)throw new b("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return n.load(t)})}function A(e,s,t){return(e==null?void 0:e.styleUrl)!=null?$(e.styleUrl,t):(e==null?void 0:e.styleName)!=null?N(e.styleName,s,t):Promise.reject(new b("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function D(e){return e===null||e.type==="CIMSymbolReference"?e:{type:"CIMSymbolReference",symbol:e}}function M(e,s){for(const t of s)switch(t){case"cim":if(e.cimRef)return{format:t,url:encodeURI(e.cimRef)};break;case"web-gltf-basisu":{const r=c(e,"gltf_basisu");if(r)return{format:t,url:r};break}case"web-gltf":{const r=c(e,"gltf");if(r)return{format:t,url:r};break}case"web":{const r=c(e,"gltf");if(r)return{format:"web-gltf",url:r};if(e.webRef)return{format:t,url:encodeURI(e.webRef)};break}}}function c(e,s){var t,r;if(!g("enable-feature:force-wosr"))return(r=(t=e.formatInfos)==null?void 0:t.find(n=>n.type===s))==null?void 0:r.href}function C(e,s){const t={responseType:"json",query:{f:"json"},...s};return w(p(e),t)}const y="esri_en",m="Style",S="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";export{S as h,A as i,D as m,C as p,M as y};
