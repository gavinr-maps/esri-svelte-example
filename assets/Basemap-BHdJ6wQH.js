const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./layersCreator-CoWD_P2i.js","./reactiveUtils-BR0C1Kq4.js","./Accessor-BHnuXKD2.js","./Evented-DCWccWGU.js","./SimpleObservable-7oieNGD8.js","./loadUtils-BiECFALG.js","./requestPresets-v9_cUP4i.js","./cast-BA_-jlhc.js","./index-tefRSezt.js","./index-Cx51aysm.css","./JSONSupport-CGdeqxpk.js","./associatedFeatureServiceUtils-Bfw5GA1N.js","./Portal-CTRRujjZ.js","./Promise-CmQqe-ke.js","./writer-B2bQV2uU.js","./Extent-CBBGeHb-.js","./Point-XGrwlf63.js","./PortalItem-CXk7DqVv.js","./fetchService-zLGBmq3X.js","./lazyLayerLoader-cbt8Aa3v.js","./portalLayers-B1IFhyYP.js","./layerUtils-dJgsXxkC.js","./portalItemUtils-rm7sAgcm.js","./projection-B2I9Bzj_.js","./vec3f64-BLpZdpfb.js","./Polyline-BmuD2-ZN.js","./mathUtils-DV9iOXpW.js","./projectBuffer-DOU0xvVi.js","./geodesicConstants-yASAK_zX.js","./styleUtils-BQ_uVsZf.js"])))=>i.map(i=>d[i]);
import{_ as R}from"./index-tefRSezt.js";import{r as o,m as i,a as M,g as P,B as g,N,aH as L,c as A,D as I}from"./Accessor-BHnuXKD2.js";import{L as v,I as _,P as $}from"./cast-BA_-jlhc.js";import{V as f}from"./reactiveUtils-BR0C1Kq4.js";import{n as S}from"./collectionUtils-CbaToa73.js";import{S as B}from"./JSONSupport-CGdeqxpk.js";import{m as J,C as x}from"./Portal-CTRRujjZ.js";import{t as K}from"./loadAll-Do8S8AWH.js";import{r as T}from"./writer-B2bQV2uU.js";import{g as D}from"./Point-XGrwlf63.js";import k from"./PortalItem-CXk7DqVv.js";import{s as C,a as j}from"./basemapDefinitions-BmB40s1J.js";import{p as E}from"./intl-Do3GEEJ7.js";import{r as q}from"./Promise-CmQqe-ke.js";import{g as U}from"./writeUtils-C3ZSK02Z.js";import"./Evented-DCWccWGU.js";import"./SimpleObservable-7oieNGD8.js";import"./Extent-CBBGeHb-.js";import"./layerUtils-dJgsXxkC.js";let c=class extends P{constructor(e){super(e),this.apiKey=null,this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2",this.worldview=null}get languageParameter(){const e=this.language;let t=e==="local"||e==="global"?e:E(e??q())??"global";return t=t==="no"?"nb":t,t}};o([i()],c.prototype,"apiKey",void 0),o([i()],c.prototype,"id",void 0),o([i()],c.prototype,"language",void 0),o([i()],c.prototype,"places",void 0),o([i()],c.prototype,"serviceUrl",void 0),o([i()],c.prototype,"worldview",void 0),c=o([M("esri.support.BasemapStyle")],c);const V=c;var m;let W=0,l=m=class extends B.JSONSupportMixin(J){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+W++,this.baseLayers=new f,this.referenceLayers=new f;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&g.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},s=r=>{r.parent=null};this.addHandles([this.baseLayers.on("after-add",r=>t(r.item)),this.referenceLayers.on("after-add",r=>t(r.item)),this.baseLayers.on("after-remove",r=>s(r.item)),this.referenceLayers.on("after-remove",r=>s(r.item))])}initialize(){this.when().catch(e=>{g.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.baseLayers.toArray();for(const s of e)s.destroy();const t=this.referenceLayers.toArray();for(const s of t)s.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=N(this.portalItem)}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",S(e,this._get("baseLayers")))}_writeBaseLayers(e,t,s){const r=[];e&&(s={...s,layerContainerType:"basemap"},this.baseLayers.forEach(a=>{const n=U(a,s.webmap?s.webmap.getLayerJSONFromResourceInfo(a):null,s);n!=null&&r.push(n)}),this.referenceLayers.forEach(a=>{const n=U(a,s.webmap?s.webmap.getLayerJSONFromResourceInfo(a):null,s);n!=null&&(a.type!=="scene"&&(n.isReference=!0),r.push(n))})),t.baseMapLayers=r}set referenceLayers(e){this._set("referenceLayers",S(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return K(this,e=>{e(this.baseLayers,this.referenceLayers)})}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(t=>L(t)?t.clone():t),referenceLayers:this.referenceLayers.map(t=>L(t)?t.clone():t)};return this.loaded&&(e.loadStatus="loaded"),new m({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){var s;return e=e||{},t!=null&&t.origin||(t={origin:"web-map",...t}),super.write(e,t),!this.loaded&&((s=this.resourceInfo)!=null&&s.data.baseMapLayers)&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const a=A(r);return a.url&&v(a.url)&&(a.url=`https:${a.url}`),a.templateUrl&&v(a.templateUrl)&&(a.templateUrl=`https:${a.templateUrl}`),a})),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:s,style:r}=this;I(e);const a=[];if(t){const n=t.context?t.context.url:null;if(a.push(this._loadLayersFromJSON(t.data,n,e)),t.data.id&&!t.data.title){const y=t.data.id;a.push(C(y).then(p=>{p&&this.read({title:p},t.context)}))}}else s?a.push(this._loadFromItem(s,e)):r&&a.push(this._loadFromStylesService(r,e));await Promise.all(a)}async _loadLayersFromJSON(e,t,s){var h,b;const r=(h=this.resourceInfo)==null?void 0:h.context,a=((b=this.portalItem)==null?void 0:b.portal)||(r==null?void 0:r.portal)||null,n=H[(r==null?void 0:r.origin)||""]??"web-map",{populateOperationalLayers:y}=await R(async()=>{const{populateOperationalLayers:u}=await import("./layersCreator-CoWD_P2i.js");return{populateOperationalLayers:u}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]),import.meta.url),p=[];if(I(s),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const u={context:{...r,origin:n,url:t,portal:a,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},w=d=>n==="web-scene"&&d.layerType==="ArcGISSceneServiceLayer"||d.isReference,O=y(this.baseLayers,e.baseMapLayers.filter(d=>!w(d)),u);p.push(O);const F=y(this.referenceLayers,e.baseMapLayers.filter(w),u);p.push(F)}await Promise.allSettled(p)}async _loadFromItem(e,t){const s=await e.load(t),r=await s.fetchData("json",t),a=_(e.itemUrl??"");return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:z[e.type||""]??"web-map",portal:e.portal||x.getDefault(),url:a}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||x.getDefault(),url:a}),this._loadLayersFromJSON(this.resourceInfo.data,a,t)}async _loadFromStylesService(e,t){const s=e.serviceUrl.endsWith("/webmaps")?e.serviceUrl.slice(0,-8):e.serviceUrl,r=`${s}/styles/${e.id}/self`,a=`${s}/webmaps/${e.id}`,[n,y]=await Promise.all([(await $(r,{query:{token:e.apiKey},signal:t==null?void 0:t.signal})).data,(await $(a,{query:{language:e.languageParameter,places:e.places,worldview:e.worldview,token:e.apiKey},signal:t==null?void 0:t.signal})).data]);this.thumbnailUrl??(this.thumbnailUrl=n.thumbnailUrl);const p=_(a);if(this._set("resourceInfo",{data:y.baseMap??{},context:{origin:"web-map",url:p}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:y.spatialReference},this.resourceInfo.context),await this._loadLayersFromJSON(this.resourceInfo.data,p,t),e.apiKey)for(const h of[...this.baseLayers,...this.referenceLayers])"apiKey"in h&&(h.apiKey=e.apiKey)}static fromId(e){const t=j[e];return t?t.itemId?new m({portalItem:{id:t.itemId,portal:{url:"https://www.arcgis.com"}}}):m.fromJSON(t,{origin:t.is3d?"web-scene":"web-map"}):null}};o([i({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,s,r){this._writeBaseLayers(e,t,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:f}},writer(e,t,s,r){this._writeBaseLayers(e,t,r)}}}}}})],l.prototype,"baseLayers",null),o([i({type:String,json:{origins:{"web-scene":{write:!0}}}})],l.prototype,"id",void 0),o([i({type:k})],l.prototype,"portalItem",void 0),o([i()],l.prototype,"referenceLayers",null),o([i({readOnly:!0})],l.prototype,"resourceInfo",void 0),o([i({type:D})],l.prototype,"spatialReference",void 0),o([i({type:V})],l.prototype,"style",void 0),o([i()],l.prototype,"thumbnailUrl",void 0),o([i({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],l.prototype,"title",void 0),o([T("title")],l.prototype,"writeTitle",null),l=m=o([M("esri.Basemap")],l);const z={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},H={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},ue=l;export{ue as default};
