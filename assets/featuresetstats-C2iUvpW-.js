import{R as s,i as y,z as d}from"./opacityUtils-CSd4XoR2.js";import{a as F,r as A}from"./executionError-HS8X1L-B.js";import{o as w,B as u,a as f,q as c,i as S}from"./deepClone-DC5Ed1NQ.js";import{l as m}from"./arcade-CrJG569S.js";import{D as p,i as h}from"./WhereClause-diW5rNp6.js";import"./Accessor-BHnuXKD2.js";import"./index-tefRSezt.js";import"./Promise-CmQqe-ke.js";import"./cast-BA_-jlhc.js";import"./JSONSupport-CGdeqxpk.js";import"./Point-XGrwlf63.js";import"./writer-B2bQV2uU.js";import"./ImmutableArray-BPVd6ESQ.js";import"./shared-M7rSkUll.js";import"./TimeOnly-yGYcAQQJ.js";import"./Extent-CBBGeHb-.js";import"./Field-Cyk7Ur5d.js";import"./enumeration-Cr5WIZs4.js";import"./fieldType-L-VlbZqy.js";import"./number-BWHn6sm2.js";import"./Polyline-BmuD2-ZN.js";import"./mathUtils-DV9iOXpW.js";import"./jsonUtils-Cu7OBRmN.js";import"./featureConversionUtils-DpmsPUmt.js";import"./aaBoundingBox-CeBivBRq.js";import"./OptimizedFeature-DcMLlxvB.js";import"./memoryEstimations-5gFNwkKK.js";import"./OptimizedGeometry-7IxBWtHr.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./FieldsIndex-DFdVonga.js";import"./timeZoneUtils-COos5xIr.js";import"./unitConversion-BDsSPToO.js";import"./hash-CcEbRgUF.js";import"./uuid-Cl5lrJ4c.js";import"./Portal-CTRRujjZ.js";async function e(i,r,t,o){if(t.length===1){if(s(t[0]))return m(i,t[0],c(t[1],-1));if(f(t[0]))return m(i,t[0].toArray(),c(t[1],-1))}else if(t.length===2){if(s(t[0]))return m(i,t[0],c(t[1],-1));if(f(t[0]))return m(i,t[0].toArray(),c(t[1],-1));if(u(t[0])){const a=await t[0].load(),n=await g(p.create(t[1],{fieldsIndex:a.getFieldsIndex(),timeZone:a.dateFieldsTimeZoneDefaultUTC}),o,r);return l(r,await t[0].calculateStatistic(i,n,c(t[2],1e3),r.abortSignal))}}else if(t.length===3&&u(t[0])){const a=await t[0].load(),n=await g(p.create(t[1],{fieldsIndex:a.getFieldsIndex(),timeZone:a.dateFieldsTimeZoneDefaultUTC}),o,r);return l(r,await t[0].calculateStatistic(i,n,c(t[2],1e3),r.abortSignal))}return m(i,t,-1)}function l(i,r){return r instanceof h?d.fromReaderAsTimeStampOffset(r.toStorageFormat()):r instanceof Date?d.dateJSAndZoneToArcadeDate(r,S(i)):r}async function g(i,r,t){const o=i.getVariables();if(o.length>0){const a={};for(const n of o)a[n]=r.evaluateIdentifier(t,{name:n});i.parameters=a}return i}function nt(i){i.mode==="async"&&(i.functions.stdev=function(r,t){return i.standardFunctionAsync(r,t,(o,a,n)=>e("stdev",r,n,i))},i.functions.variance=function(r,t){return i.standardFunctionAsync(r,t,(o,a,n)=>e("variance",r,n,i))},i.functions.average=function(r,t){return i.standardFunctionAsync(r,t,(o,a,n)=>e("mean",r,n,i))},i.functions.mean=function(r,t){return i.standardFunctionAsync(r,t,(o,a,n)=>e("mean",r,n,i))},i.functions.sum=function(r,t){return i.standardFunctionAsync(r,t,(o,a,n)=>e("sum",r,n,i))},i.functions.min=function(r,t){return i.standardFunctionAsync(r,t,(o,a,n)=>e("min",r,n,i))},i.functions.max=function(r,t){return i.standardFunctionAsync(r,t,(o,a,n)=>e("max",r,n,i))},i.functions.count=function(r,t){return i.standardFunctionAsync(r,t,async(o,a,n)=>{if(w(n,1,1,r,t),u(n[0]))return n[0].count(o.abortSignal);if(s(n[0])||y(n[0]))return n[0].length;if(f(n[0]))return n[0].length();throw new F(r,A.InvalidParameter,t)})})}export{nt as registerFunctions};
