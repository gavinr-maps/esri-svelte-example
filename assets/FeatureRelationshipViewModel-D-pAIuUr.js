const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-73bQemcW.js","./jsxFactory-CLjKarlq.js","./Accessor-BHnuXKD2.js","./intl-Do3GEEJ7.js","./Promise-CmQqe-ke.js","./cast-BA_-jlhc.js","./index-tefRSezt.js","./index-Cx51aysm.css","./JSONSupport-CGdeqxpk.js","./Evented-DCWccWGU.js","./reactiveUtils-BR0C1Kq4.js","./SimpleObservable-7oieNGD8.js","./uuid-Cl5lrJ4c.js","./dom--xxYYVQF.js","./guid-ejniuQmw.js","./observers-BdozwIHb.js","./index-DbjTV4Hc.js","./index-CjrYEQXz.js","./useT9n-CJAswmP1.js","./index-cLdK6V3t.js","./ref-Ccn4I0kT.js","./directive-helpers-C0aXnQdc.js","./keyed-CdPY5MOf.js","./index-Ch_sYKt7.js","./index-svtat3zr.js","./index-Wn4pOF_U.js","./live-BIBBLA6F.js","./static-g4FJ4v8I.js","./form-B15gmg4q.js","./interactive-B8siLByk.js","./key-CZcQa38B.js","./label-BLne9qNB.js","./loadable-DOQnSSjG.js","./locale-CXx8I9ox.js","./component-CFGnHAqh.js","./Validation-O1TFEQW-.js","./input-DI9tZAPS.js","./filter-Cs9GmjDF.js","./escapeRegExp-UP7ghjt8.js","./debounce-DbkufipY.js","./utils-CYuC4O71.js","./index-d5Yy4krW.js","./index-Df8-0rWt.js","./floating-ui-BkLjHVN3.js","./openCloseComponent-dw_x67D_.js","./dynamicClasses-pKEMtFzB.js","./index-DVEy4f7w.js","./index-DIB7yhJF.js","./resources6-Cs2_VmEC.js","./index-BfAp5_ga.js","./customElement-kBYuBfHB.js","./resources5-SciNIBSe.js","./index-nrWOrFCt.js","./resources4-Crg87oFz.js","./uniqueValues-DUGfIBoI.js","./utils-D8exU0T6.js","./screenUtils-_ZIvrt5o.js","./timeUtils-D2X862bk.js","./Point-XGrwlf63.js","./writer-B2bQV2uU.js","./quantizationUtils-2Az-xHPA.js","./Extent-CBBGeHb-.js","./Polyline-BmuD2-ZN.js","./mathUtils-DV9iOXpW.js","./opacityUtils-CSd4XoR2.js","./heatmapUtils-DA7NmY3d.js","./vec42-YcqnINSP.js","./common-DQOJ18NT.js","./vec4f64-o2zAXfmz.js","./utils-DLmnG8WZ.js","./mat4f32-DcsiF_Rp.js","./mat4-Fi6iAz29.js","./vec3f64-BLpZdpfb.js","./timeZoneUtils-COos5xIr.js","./utils-B8VMZhYy.js","./ClassBreaksDefinition-DvZJqFCP.js","./enumeration-Cr5WIZs4.js","./workers-D8Q3pEzK.js","./Queue-BOnccek2.js","./Graphic-CFXUQZlS.js","./Clonable-DvJsj5LF.js","./Color-gncXBiLc.js","./colorUtils-Rxh2V3ai.js","./ActionToggle-__-l4AdQ.js","./Identifiable-BrT7zvUW.js","./jsonUtils-Cu7OBRmN.js","./typeUtils-BSg8Y507.js","./TextSymbol-BQ_NW9Xo.js","./collectionUtils-CbaToa73.js","./Portal-CTRRujjZ.js","./aaBoundingBox-CeBivBRq.js","./jsonUtils-DD1NMzWj.js","./typeUtils-CfF4cYo5.js","./ClassBreaksRenderer-BBSNkSFx.js","./commonProperties-bGHL1a5M.js","./colorRamps-Dkx8zIVn.js","./SizeVariable-IzD1bP2e.js","./visualVariableUtils-Bp9QCb8E.js","./lengthUtils-DjJgJFRg.js","./ColorStop-CDpeFWOz.js","./jsonUtils-Dzgxk9pw.js","./layerUtils-dJgsXxkC.js","./defaults-Dwxdhopq.js","./defaultsJSON-GKolV7NZ.js","./RendererLegendOptions-mgfHoilI.js","./LRUCache-DS2O1kTf.js","./MemCache-CDoaVBHf.js","./Version-9k2AOv05.js","./FieldsIndex-DFdVonga.js","./utils-B91u8350.js","./defaultCIMValues-DII_GG3u.js","./enums-BJSSbDkD.js","./HeatmapColorStop-c4wClnpW.js","./SimpleRenderer-gSw1WaJS.js","./UniqueValueRenderer-Cri3tgP5.js","./diffUtils-CMkuJvD2.js","./styleUtils-BB-zx7mT.js","./utils-Cy8wFNQo.js","./Query-DCBIeen2.js","./Field-Cyk7Ur5d.js","./fieldType-L-VlbZqy.js","./FullTextSearch-BWm_kPUE.js","./TimeExtent-J5qnUFx_.js","./executeQueryJSON-CLYdIUdF.js","./query-BS_L6I0Q.js","./normalizeUtils-XRAPXbWa.js","./normalizeUtilsCommon-D0zPTJCj.js","./utils-CkSELPnj.js","./pbfQueryUtils-AwPAOS5M.js","./pbf-CFI-xDDp.js","./memoryEstimations-5gFNwkKK.js","./OptimizedGeometry-7IxBWtHr.js","./OptimizedFeature-DcMLlxvB.js","./OptimizedFeatureSet-Blu9Ckm7.js","./queryZScale-DwN6mTru.js","./projection-B2I9Bzj_.js","./projectBuffer-DOU0xvVi.js","./geodesicConstants-yASAK_zX.js","./FeatureSet-DpCN730g.js","./statsWorker-B2GRH8fO.js","./AttributeBinsQuery-BPaJ86G0.js","./queryUtils-DBeaQ3x_.js","./json-Wa8cmqdu.js","./FixedIntervalBinParameters-uigAmvtd.js","./NormalizationBinParametersMixin-D6iHLB7I.js","./viewpointUtils-DmJh_Ev7.js","./Viewpoint-Cv8Otrne.js","./Camera-DJtV7zYb.js","./Cyclical-CPiNl4ru.js","./mat2d-D9DBP-jx.js","./mat2df64-CBKYtunK.js","./vec2-maR1OrZI.js","./vec2f64-Dy6m9Nrb.js"])))=>i.map(i=>d[i]);
import{_ as T}from"./index-tefRSezt.js";import{r,m as i,a as S,g as U,j as N,k as $,N as de,av as J,G as X}from"./Accessor-BHnuXKD2.js";import{d as M,V as q,P as V}from"./reactiveUtils-BR0C1Kq4.js";import{O as re,n as v,e as Y,c as ye}from"./jsxFactory-CLjKarlq.js";import{e as he}from"./Heading-DYbI16WN.js";import{e as pe}from"./globalCss-CZa70j6i.js";import{b as ie}from"./Graphic-CFXUQZlS.js";import{a as se}from"./Clonable-DvJsj5LF.js";import{n as ae}from"./Identifiable-BrT7zvUW.js";import{s as ge}from"./ReactiveMap-Dwhwbx9R.js";import{l as Z}from"./layerUtils-dJgsXxkC.js";import{p as _e}from"./NetworkElement-Dpf4duUb.js";import{b as me}from"./Query-DCBIeen2.js";import{findUtilityNetwork as be,getFixedFieldName as Ce,isRelatableFeatureSupportedLayer as Fe,findRelatedLayer as we}from"./featureUtils-x0Mr5AqG.js";import ee from"./RelationshipQuery-W-4bfgaH.js";import{K as fe}from"./featureFormUtils-BLdtQWdc.js";let O=class extends U{constructor(e){super(e),this.title=!0,this.description=!0}};r([i({type:Boolean,nonNullable:!0})],O.prototype,"title",void 0),r([i({type:Boolean,nonNullable:!0})],O.prototype,"description",void 0),O=r([S("esri.widgets.Feature.FeatureUtilityNetworkAssociations.VisibleElements")],O);const ne=O,x="esri-feature-element-info",B={base:x,title:`${x}__title`,description:`${x}__description`};let P=class extends re{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return v("div",{class:B.base},this._renderTitle(),this._renderDescription())}_renderTitle(){const{title:e}=this;return e?v(he,{class:B.title,innerHTML:e,level:this.headingLevel}):null}_renderDescription(){const{description:e}=this;return e?v("div",{class:B.description,innerHTML:e,key:"description"}):null}};r([i()],P.prototype,"description",void 0),r([i()],P.prototype,"headingLevel",void 0),r([i()],P.prototype,"title",void 0),P=r([S("esri.widgets.Feature.support.FeatureElementInfo")],P);const Ae=P,j={fromGlobalId:"fromglobalid",fromNetworkSourceId:"fromnetworksourceid",fromTerminalId:"fromterminalid",toGlobalId:"toglobalid",toNetworkSourceId:"tonetworksourceid",toTerminalId:"toterminalid",associationType:"associationtype",globalId:"globalid",status:"status",isContentVisible:"iscontentvisible",percentAlong:"percentalong",assetGroup:"assetgroup",assetType:"assettype"},te=100;let l=class extends se.ClonableMixin(ae.IdentifiableMixin(U)){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.networkSourceIdsInUse=new Set,this.source="popup",this.description=null,this.graphic=null,this.layer=null,this.map=null,this.featureCount=0,this.associationTypes=null,this.showAllEnabled=!1,this.title=null,this.attachmentsFeatureCount=0,this.structureFeatureCount=0,this.contentFeatureCount=0,this.containerFeatureCount=0,this.connectivityFeatureCount=0,this._queryOpenAssociationType=async()=>{this.activeAssociationType&&await this._queryDebounced(this.activeAssociationType)},this._cancelQuery=()=>{const{_queryAbortController:t}=this;t&&t.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:t}=this;t&&t.abort(),this._queryFeatureCountAbortController=null},this._queryController=async t=>{this._cancelQuery();const o=new AbortController;this._queryAbortController=o,await N(this._query(t)),this._queryAbortController===o&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._loaded=!1,this._cancelQueryFeatureCount();const t=new AbortController;this._queryFeatureCountAbortController=t,await N(this._queryFeatureCount()),this._queryFeatureCountAbortController===t&&(this._queryFeatureCountAbortController=null),this._loaded=!0},this._queryDebounced=$(this._queryController,te),this._queryFeatureCountDebounced=$(this._queryFeatureCountController,te)}initialize(){this.addHandles([M(()=>[this.graphic,this.layer,this.map,this.associationTypes,this.objectId,this.globalId,this.canQuery],()=>this.refresh(),V),M(()=>this.activeAssociationType,e=>this._queryDebounced(e),V)])}destroy(){this._cancelQuery(),this._cancelQueryFeatureCount(),this._destroyAssociatedFeatureViewModels()}get supportsCacheHint(){var e,t,o;return!!((o=(t=(e=this.layer)==null?void 0:e.capabilities)==null?void 0:t.query)!=null&&o.supportsCacheHint)}get canLoad(){return!!this.map&&!!this.associationTypes&&typeof this.globalId=="string"}get canQuery(){var t,o;const e=(o=(t=this.layer)==null?void 0:t.capabilities)==null?void 0:o.query;return!!this.associationTypes&&typeof this.globalId=="string"&&!!(e!=null&&e.supportsPagination)}set displayCount(e){this._set("displayCount",Math.max(e??3,0))}get displayCount(){return this._get("displayCount")}get objectId(){var e,t;return(this.objectIdField&&((t=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:t[this.objectIdField]))??null}get objectIdField(){var e;return((e=this.layer)==null?void 0:e.objectIdField)||null}get globalId(){var e,t;return(this.globalIdField&&((t=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:t[this.globalIdField]))??null}get globalIdField(){const{layer:e}=this;return e==null?void 0:e.globalIdField}get activeAssociationType(){return this._get("activeAssociationType")}set activeAssociationType(e){e&&!this.associationTypes.includes(e)||this._set("activeAssociationType",e)}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:o,canQuery:s,_loaded:a,canLoad:n,source:y}=this;return t||n&&!a?"loading":e||o?"querying":!s||y==="popup"&&this.featureCount===0?"disabled":"ready"}get utilityNetwork(){const{layer:e,map:t}=this;if(!(e!=null&&e.loaded)||!t)return null;const o=Z(e)?e.parent:e;return be(t,o)}get attachmentsAssociations(){return this._get("attachmentsAssociations")||new q}get structureAssociations(){return this._get("structureAssociations")||new q}get contentAssociations(){return this._get("contentAssociations")||new q}get containerAssociations(){return this._get("containerAssociations")||new q}get connectivityAssociations(){return this._get("connectivityAssociations")||new q}get associationFeatures(){return this._get("associationFeatures")||new ge}get associationViewModels(){return this._get("associationViewModels")||new Map}async refresh(){await this._queryFeatureCountDebounced(),await this._queryOpenAssociationType()}getFeatureCountForAssociationType(e){switch(e){case"attachment":return this.attachmentsFeatureCount;case"structure":return this.structureFeatureCount;case"content":return this.contentFeatureCount;case"container":return this.containerFeatureCount;case"connectivity":return this.connectivityFeatureCount}}_destroyAssociatedFeatureViewModels(){this.associationViewModels.forEach(e=>e.destroyAll())}async _loadUtiltyNetworks(){var o;const e=this.map;if(!e)return;await Promise.allSettled(((o=e.utilityNetworks)==null?void 0:o.map(async s=>{await s.load()}))??[]);const t=this.utilityNetwork;if(t){const s=a=>{if("layerId"in a&&t.isUtilityLayer(a)){const n=t.getSourceIdByLayerId(a.layerId);n!==null&&this.networkSourceIdsInUse.add(n)}};this._set("networkSourceIdsInUse",new Set),e.allLayers.forEach(s),e.allTables.forEach(s)}}async _findLayersBySourceId(e){const{utilityNetwork:t,map:o}=this,s=h=>{const C=h;return h.url&&C.layerId===a?h.url.replace(/\/\d+$/,"")===(t==null?void 0:t.featureServiceUrl):!1};await(t==null?void 0:t.load());const a=t.getLayerIdBySourceId(e),n=o.allLayers.filter(s),y=o.allTables.filter(s),u=n.concat(y).toArray();return await Promise.allSettled(u.map(h=>h.load())),u}_clearAssociations(){this.attachmentsAssociations.removeAll(),this.structureAssociations.removeAll(),this.contentAssociations.removeAll(),this.containerAssociations.removeAll(),this.connectivityAssociations.removeAll()}_clearFeatures(){this.associationFeatures.forEach(e=>e.removeAll()),this.associationFeatures.clear()}_getAssociationsByType(e){switch(e){case"attachment":return this.attachmentsAssociations;case"structure":return this.structureAssociations;case"connectivity":return this.connectivityAssociations;case"container":return this.containerAssociations;case"content":return this.contentAssociations}}async _queryLayer(e,t,o,s,a){const n=e.fieldsIndex.get(j.assetGroup),y=e.fieldsIndex.get(j.assetType),u=o!=null,h=s!=null,C="("+t.map(m=>`'${m}'`).join(", ")+")",_=u?` AND ${n==null?void 0:n.name} = ${o}`:"",p=u&&h?` AND ${y==null?void 0:y.name} = ${s}`:"",b=`${e.globalIdField} IN ${C}`+_+p,d=new me({outFields:["*"],cacheHint:this.supportsCacheHint,where:b});return await this._queryAll(d,e,{signal:a==null?void 0:a.signal})}async _createAssociationFeatureObjects(e,t,o,s,a,n){if(e.length===0)return[];const y=new Map;for(const[h,C]of t){const _=await this._findLayersBySourceId(h);for(const p of _)(await this._queryLayer(p,C,s,a,n)).forEach(b=>{if(this.source==="popup"?b.layer&&b.getEffectivePopupTemplate():b.layer){const d=y.get(b.attributes[p.globalIdField])??[];d.push(b),y.set(b.attributes[p.globalIdField],d)}})}const u=[];return await Promise.all(e.toArray().map(async h=>{const{fromNetworkElement:C,toNetworkElement:_}=h,p=C.globalId===o?_:C,b=y.get(p.globalId)??[];await Promise.all(b.map(async d=>{var g,A;const m=(A=(g=this.utilityNetwork)==null?void 0:g.getTerminalById(p==null?void 0:p.terminalId))==null?void 0:A.name;if(d.layer&&"getFeatureTitle"in d.layer){const w=await d.layer.getFeatureTitle(d);u.push({title:w,association:h,feature:d,terminalName:m})}else u.push({association:h,feature:d,terminalName:m})}))})),u}_parseFeatureObjects(e,t){e.forEach(o=>{const s=o==null?void 0:o.feature,a=s.layer,n=t.get(a)??new q;n.add(o),t.set(a,n)})}async _queryAll(e,t,o){var y;const s=[];let a=0,n=!1;e.num=((y=t.sourceJSON)==null?void 0:y.maxRecordCount)??2e3;do{e.start=a;const u=await t.queryFeatures(e,o);s.push(...u.features),n=u.exceededTransferLimit,n&&(a+=u.features.length)}while(n);return s}async _queryAssociations(e){const{layer:t,globalId:o,associationTypes:s,utilityNetwork:a,canQuery:n}=this;if(await Promise.allSettled([t==null?void 0:t.load(),a==null?void 0:a.load()]),this._clearAssociations(),!(n&&t&&s&&a&&o))return;const y=Z(t)?t.parent:t,u=new _e({globalId:o,networkSourceId:a.getSourceIdByLayerId(y.layerId)}),h=new Set;s.forEach(d=>{switch(d.type){case"attachment":case"structure":h.add("attachment");break;case"container":case"content":h.add("containment");break;case"connectivity":h.add("connectivity"),h.add("junction-junction-connectivity"),h.add("junction-edge-from-connectivity"),h.add("junction-edge-midspan-connectivity"),h.add("junction-edge-to-connectivity")}});const C=await(a==null?void 0:a.queryAssociations({elements:[u],types:Array.from(h)},{signal:e==null?void 0:e.signal})),_=new Map,p=new Map;s.forEach(d=>{p.set(d.type,d),_.set(d.type,[])}),C.forEach(d=>{var A,w,F,k,L,E;const{toNetworkElement:m,fromNetworkElement:g}=d;switch(d.associationType){case"connectivity":case"junction-junction-connectivity":case"junction-edge-from-connectivity":case"junction-edge-midspan-connectivity":case"junction-edge-to-connectivity":if((g==null?void 0:g.globalId)===o){if(this._shouldDiscardNetworkElement(m,"connectivity",p))break;(A=_.get("connectivity"))==null||A.push(m.globalId)}else{if(this._shouldDiscardNetworkElement(g,"connectivity",p))break;(w=_.get("connectivity"))==null||w.push(g.globalId)}this.connectivityAssociations.add(d);break;case"containment":if((g==null?void 0:g.globalId)===o){if(this._shouldDiscardNetworkElement(m,"content",p))break;(F=_.get("content"))==null||F.push(m.globalId),this.contentAssociations.add(d)}else{if(this._shouldDiscardNetworkElement(g,"container",p))break;(k=_.get("container"))==null||k.push(g.globalId),this.containerAssociations.add(d)}break;case"attachment":if((g==null?void 0:g.globalId)===o){if(this._shouldDiscardNetworkElement(m,"attachment",p))break;(L=_.get("attachment"))==null||L.push(m.globalId),this.attachmentsAssociations.add(d)}else{if(this._shouldDiscardNetworkElement(g,"structure",p))break;(E=_.get("structure"))==null||E.push(g.globalId),this.structureAssociations.add(d)}}});const b=s.map(async d=>{const{associatedNetworkSourceId:m,associatedAssetGroup:g,associatedAssetType:A}=d,w=_.get(d.type),F=g!=null?await this._countAssociatedFeatures(m,w,g,A,e):w.length;switch(d.type){case"attachment":this._set("attachmentsFeatureCount",F);break;case"structure":this._set("structureFeatureCount",F);break;case"content":this._set("contentFeatureCount",F);break;case"container":this._set("containerFeatureCount",F);break;case"connectivity":this._set("connectivityFeatureCount",F)}});await Promise.allSettled(b)}async _countAssociatedFeatureCount(e,t,o,s,a){const n=e.fieldsIndex.get(j.assetGroup),y=e.fieldsIndex.get(j.assetType),u=s!=null,h="("+t.map(b=>`'${b}'`).join(", ")+")",C=` AND ${n==null?void 0:n.name} = ${o}`,_=u?` AND ${y==null?void 0:y.name} = ${s}`:"",p=`${e.globalIdField} IN ${h}`+C+_;return e.queryFeatureCount({where:p,outFields:["*"],returnGeometry:!1},{signal:a==null?void 0:a.signal})}async _countAssociatedFeatures(e,t,o,s,a){if(t.length===0)return 0;const n=(await this._findLayersBySourceId(e)).map(async y=>this._countAssociatedFeatureCount(y,t,o,s,a));return(await Promise.all(n)).reduce((y,u)=>y+u,0)}async _queryAssociatedFeatures(e,t){const{layer:o,globalId:s,associationTypes:a,utilityNetwork:n,canQuery:y,associationFeatures:u}=this;if(await Promise.allSettled([o==null?void 0:o.load(),n==null?void 0:n.load()]),!(y&&o&&a&&n))return;const h=this._getAssociationsByType(e.type),{associatedAssetGroup:C,associatedAssetType:_}=e,p=new Map;h.forEach(d=>{const{fromNetworkElement:m,toNetworkElement:g}=d,{networkSourceId:A,elementGlobalId:w}=m.globalId===s?{networkSourceId:g.networkSourceId,elementGlobalId:g.globalId}:{networkSourceId:m.networkSourceId,elementGlobalId:m.globalId},F=p.get(A)||[];F.push(w),p.set(A,F)});const b=await this._createAssociationFeatureObjects(h,p,s,C,_,t);this._parseFeatureObjects(b,u)}async _queryFeatureCount(){await this._loadUtiltyNetworks();const{_queryFeatureCountAbortController:e,canQuery:t}=this;t?(await this._queryAssociations(e),this._set("featureCount",this.attachmentsFeatureCount+this.structureFeatureCount+this.contentFeatureCount+this.containerFeatureCount+this.connectivityFeatureCount)):this._set("featureCount",0)}async _query(e){if(!e)return;await this._loadUtiltyNetworks();const{_queryAbortController:t}=this;this._destroyAssociatedFeatureViewModels(),this._clearFeatures(),this.featureCount!==0&&(this.destroyed||await this._queryAssociatedFeatures(e,{signal:t==null?void 0:t.signal}))}_shouldDiscardNetworkElement(e,t,o){var u;if(!e)return!1;const{networkSourceIdsInUse:s}=this,{networkSourceId:a}=e,n=(u=o.get(t))==null?void 0:u.associatedNetworkSourceId,y=s.has(a);return n!=null&&n!==a||!y}};r([i()],l.prototype,"_loaded",void 0),r([i()],l.prototype,"_queryAbortController",void 0),r([i()],l.prototype,"_queryPageAbortController",void 0),r([i()],l.prototype,"_queryFeatureCountAbortController",void 0),r([i({readOnly:!0})],l.prototype,"supportsCacheHint",null),r([i({readOnly:!0})],l.prototype,"canLoad",null),r([i({readOnly:!0})],l.prototype,"canQuery",null),r([i()],l.prototype,"networkSourceIdsInUse",void 0),r([i({constructOnly:!0})],l.prototype,"source",void 0),r([i()],l.prototype,"description",void 0),r([i({value:3})],l.prototype,"displayCount",null),r([i({type:ie})],l.prototype,"graphic",void 0),r([i()],l.prototype,"layer",void 0),r([i()],l.prototype,"map",void 0),r([i({readOnly:!0})],l.prototype,"objectId",null),r([i({readOnly:!0})],l.prototype,"objectIdField",null),r([i({readOnly:!0})],l.prototype,"globalId",null),r([i({readOnly:!0})],l.prototype,"globalIdField",null),r([i()],l.prototype,"featureCount",void 0),r([i()],l.prototype,"associationTypes",void 0),r([i()],l.prototype,"activeAssociationType",null),r([i()],l.prototype,"showAllEnabled",void 0),r([i()],l.prototype,"state",null),r([i()],l.prototype,"title",void 0),r([i({readOnly:!0})],l.prototype,"utilityNetwork",null),r([i({readOnly:!0})],l.prototype,"attachmentsFeatureCount",void 0),r([i({readOnly:!0})],l.prototype,"structureFeatureCount",void 0),r([i({readOnly:!0})],l.prototype,"attachmentsAssociations",null),r([i({readOnly:!0})],l.prototype,"structureAssociations",null),r([i({readOnly:!0})],l.prototype,"contentFeatureCount",void 0),r([i({readOnly:!0})],l.prototype,"containerFeatureCount",void 0),r([i({readOnly:!0})],l.prototype,"contentAssociations",null),r([i({readOnly:!0})],l.prototype,"containerAssociations",null),r([i({readOnly:!0})],l.prototype,"connectivityFeatureCount",void 0),r([i({readOnly:!0})],l.prototype,"connectivityAssociations",null),r([i({readOnly:!0})],l.prototype,"associationFeatures",null),r([i({readOnly:!0})],l.prototype,"associationViewModels",null),l=r([S("esri.widgets.support.UtilityNetworkAssociations.FeatureUtilityNetworkAssociationsViewModel")],l);const le=l,G="esri-feature-utility-network-associations",oe=`${G}__loading-container`,D={base:G,listContainer:`${G}__list`,loadingContainer:oe,loadingContainerSticky:`${oe}--sticky`};let f=class extends re{constructor(t,o){super(t,o),this._featureElementInfo=null,this.onSelectAssociationType=()=>{},this.flowType="feature-utility-network-associations",this.flowItems=null,this.parentFeatureViewModel=null,this.headingLevel=5,this.viewModel=new le,this.messages=null,this.messagesCommon=null,this.visibleElements=new ne}initialize(){this._featureElementInfo=new Ae,this.addHandles([M(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),V)])}loadDependencies(){return ye({icon:()=>T(()=>import("./index-73bQemcW.js").then(t=>t.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]),import.meta.url),list:()=>T(()=>import("./index-DbjTV4Hc.js"),__vite__mapDeps([16,17,1,2,3,4,5,6,7,8,9,10,11,12,14,18,19,20,21,15,13,22,0,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40]),import.meta.url),"list-item":()=>T(()=>import("./index-d5Yy4krW.js"),__vite__mapDeps([41,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,42,20,21,43,39,29,30,32,44,45,17,18,46,22,34,47,48,49,50,40,51]),import.meta.url),loader:()=>T(()=>import("./index-CjrYEQXz.js"),__vite__mapDeps([17,1,2,3,4,5,6,7,8,9,10,11,12,14,18]),import.meta.url),notice:()=>T(()=>import("./index-nrWOrFCt.js"),__vite__mapDeps([52,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,20,21,32,53,44,34,18]),import.meta.url)})}destroy(){this._featureElementInfo=de(this._featureElementInfo)}get description(){return this.viewModel.description}set description(t){this.viewModel.description=t}get title(){return this.viewModel.title}set title(t){this.viewModel.title=t}render(){var o;const{state:t}=this.viewModel;return v("div",{class:this.classes(D.base,pe.widget)},(o=this._featureElementInfo)==null?void 0:o.render(),t==="loading"?this._renderLoading():t==="disabled"?this._renderAssociationNotFound():this._renderContent())}_renderStickyLoading(){return this.viewModel.state==="querying"?v("div",{class:D.loadingContainerSticky,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return v("calcite-loader",{inline:!0,label:this.messagesCommon.loading})}_renderLoading(){return v("div",{class:D.loadingContainer,key:"loading-container"},this._renderLoadingIcon())}_renderAssociationNotFound(){var t;return v("calcite-notice",{icon:"exclamation-mark-triangle",key:"association-not-found",kind:"danger",open:!0,scale:"s",width:"full"},v("div",{slot:"message"},(t=this.messages)==null?void 0:t.noAssociations))}_renderAssociationType(t){const{viewModel:o}=this,s=this._getAssociationTypeTitle(t);return v("calcite-list-item",{description:J(t.description),key:`association-type-${t.type}`,label:J(s),value:t.type,onCalciteListItemSelect:()=>this.onSelectAssociationType({viewModel:o,listType:t,title:s})},v("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderAssociations(t){const{viewModel:o}=this;return o.source==="featureForm"||o.getFeatureCountForAssociationType(t.type)>0?this._renderAssociationType(t):void 0}_renderContent(){const{messages:t,viewModel:o}=this,{state:s,associationTypes:a}=o;return v("div",{class:D.listContainer,key:"list-container"},s==="ready"?v("div",null,v("calcite-list",{displayMode:"flat",label:t==null?void 0:t.associationsList},a.map(n=>this._renderAssociations(n)))):null,this._renderStickyLoading())}_getAssociationTypeTitle(t){const{messages:o}=this;if(t.title)return t.title;switch(t.type){case"attachment":return o.associationsAttachments;case"connectivity":return o.associationsConnectivity;case"structure":return o.associationsStructure;case"content":return o.associationsContents;case"container":return o.associationsContainer}}_setupFeatureElementInfo(){var n;const{headingLevel:t,visibleElements:o}=this,s=o.description&&this.description,a=o.title&&this.title;(n=this._featureElementInfo)==null||n.set({description:s,title:a,headingLevel:t})}};r([i({constructOnly:!0})],f.prototype,"onSelectAssociationType",void 0),r([i()],f.prototype,"flowType",void 0),r([i()],f.prototype,"flowItems",void 0),r([i()],f.prototype,"parentFeatureViewModel",void 0),r([i()],f.prototype,"featureVisibleElements",void 0),r([i()],f.prototype,"description",null),r([i()],f.prototype,"headingLevel",void 0),r([i()],f.prototype,"title",null),r([i({type:le})],f.prototype,"viewModel",void 0),r([i(),Y("esri/widgets/Feature/t9n/Feature")],f.prototype,"messages",void 0),r([i(),Y("esri/t9n/common")],f.prototype,"messagesCommon",void 0),r([i({type:ne,nonNullable:!0})],f.prototype,"visibleElements",void 0),f=r([S("esri.widgets.Feature.FeatureUtilityNetworkAssociations")],f);const xe=f,H=100;let c=class extends se.ClonableMixin(ae.IdentifiableMixin(U)){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.activeCategory=null,this.allCategories=null,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:t}=this;t&&t.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:t}=this;t&&t.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:t}=this;t&&t.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const t=new AbortController;this._queryAbortController=t,await N(this._query()),this._queryAbortController===t&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._loaded=!1,this._cancelQueryFeatureCount();const t=new AbortController;this._queryFeatureCountAbortController=t,await N(this._queryFeatureCount()),this._queryFeatureCountAbortController===t&&(this._queryFeatureCountAbortController=null),this._loaded=!0},this._queryPageController=async()=>{const t=new AbortController;this._queryPageAbortController=t,await N(this._queryPage()),this._queryPageAbortController===t&&(this._queryPageAbortController=null)},this._queryDebounced=$(this._queryController,H),this._queryFeatureCountDebounced=$(this._queryFeatureCountController,H),this._queryPageDebounced=$(this._queryPageController,H),this._query=async()=>{var s;const{_queryAbortController:t,relatedFeatures:o}=this;this.featureCount&&(((s=this.relatedLayer)==null?void 0:s.type)!=="subtype-group"||this.activeCategory)&&(this._destroyRelatedFeatureViewModels(),this.featurePage=1,o.destroyAll(),this.destroyed||o.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:t==null?void 0:t.signal}))))},this.addHandles([M(()=>{var t;return[this.displayCount,this.graphic,this.layer,(t=this.layer)==null?void 0:t.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount,this.activeCategory]},()=>this._queryDebounced(),V),M(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),M(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery,this.activeCategory],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.destroyAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){const{featuresPerPage:t,featureCount:o}=this,s=1,a=Math.ceil(o/t)||1;this._set("featurePage",Math.min(Math.max(e,s),a))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:e,relatedLayer:t}=this;return e&&(t!=null&&t.loaded)?e.map(o=>{const s=o.clone();return s.field=Ce(o.field,t),s}):e??[]}get supportsCacheHint(){var e,t,o;return!!((o=(t=(e=this.layer)==null?void 0:e.capabilities)==null?void 0:t.queryRelated)!=null&&o.supportsCacheHint)}get canLoad(){return!!this.map&&this.relationshipId!=null&&typeof this.objectId=="number"}get canQuery(){var t,o;const e=(o=(t=this.layer)==null?void 0:t.capabilities)==null?void 0:o.queryRelated;return!!(this.relatedLayer&&this.relationship&&this.relationshipId!=null&&this.objectId!=null&&(e!=null&&e.supportsCount)&&(e!=null&&e.supportsPagination))}get allCategoriesCount(){var e;return((e=this.allCategories)==null?void 0:e.length)??0}get categories(){const{allCategories:e}=this;return this.showAllEnabled?e:(e==null?void 0:e.slice(0,this.displayCount))??null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e??3,0),10))}get displayCount(){return this._get("displayCount")}get itemDescriptionFieldName(){var e;return((e=this.orderByFieldsFixedCasing[0])==null?void 0:e.field)||null}get objectId(){var e,t;return(this.objectIdField&&((t=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:t[this.objectIdField]))??null}get objectIdField(){var e;return((e=this.layer)==null?void 0:e.objectIdField)||null}get relatedFeatures(){return this._get("relatedFeatures")||new q}get relatedLayer(){const{layer:e,map:t,relationship:o}=this;if(!(e!=null&&e.loaded)||!t||!o)return null;const s=e.type==="subtype-sublayer"&&e.parent&&Fe(e.parent)?e.parent:e;return we(t,s,o)??null}get relatedLayerKeyField(){var o,s;const{relatedLayer:e,relationshipId:t}=this;return e!=null&&e.loaded&&t!=null?(s=(o=e.relationships)==null?void 0:o.find(a=>a.id===t))==null?void 0:s.keyField:null}get relatedLayerKeyFields(){var t;const{relatedLayer:e}=this;return e!=null&&e.loaded?((t=e.relationships)==null?void 0:t.map(o=>o.keyField).filter(X))??[]:[]}get relationship(){var o;const{relationshipId:e,layer:t}=this;return e!=null&&(t!=null&&t.loaded)?((o=t.relationships)==null?void 0:o.find(({id:s})=>s===e))??null:null}get relationshipKey(){var t,o;const{relationshipKeyField:e}=this;return(e&&((o=(t=this.graphic)==null?void 0:t.attributes)==null?void 0:o[e]))??null}get relationshipKeyField(){var e;return((e=this.relationship)==null?void 0:e.keyField)||null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new q}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:o,canQuery:s,_loaded:a,canLoad:n}=this;return t||n&&!a?"loading":e||o?"querying":s?"ready":"disabled"}getRelatedFeatureByObjectId(e){return this.relatedFeatures.find(t=>t.getObjectId()===e)}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){var e;(e=this.relatedFeatureViewModels)==null||e.destroyAll()}async _queryFeatureCount(){const{layer:e,relatedLayer:t}=this;await(e==null?void 0:e.load()),await(t==null?void 0:t.load());const{_queryFeatureCountAbortController:o,activeCategory:s,canQuery:a,objectId:n,relatedLayerKeyField:y,relationshipId:u,relationshipKey:h,supportsCacheHint:C}=this;if(!a||!e||!t||n==null)return this._set("featureCount",0),void this._set("allCategories",null);if((t==null?void 0:t.type)==="subtype-group"&&!s){if(this._set("featureCount",0),this._destroyRelatedFeatureViewModels(),this.featurePage=1,this.relatedFeatures.destroyAll(),y&&h!=null){const{default:m}=await T(()=>import("./uniqueValues-DUGfIBoI.js"),__vite__mapDeps([54,2,55,56,57,4,5,6,7,8,58,59,60,61,62,63,64,65,66,67,68,69,10,9,11,70,71,72,3,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152]),import.meta.url),{uniqueValueInfos:g}=await m({layer:t,sqlWhere:`${y} = '${h}'`,field:t.subtypeField,signal:o==null?void 0:o.signal}),A=g.map(({count:w,value:F})=>{var L,E;const k=(E=(L=t.subtypes)==null?void 0:L.find(Q=>Q.code===F))==null?void 0:E.name;return F!=null&&k?{count:w,value:F,name:k}:void 0}).filter(X);this._set("allCategories",A)}return}const{historicMoment:_,gdbVersion:p}=e,b=new ee({cacheHint:C,gdbVersion:p,historicMoment:_,relationshipId:u,returnGeometry:!1,objectIds:[n],where:this._getRelationshipWhereClause(t)}),d=await e.queryRelatedFeaturesCount(b,{signal:o==null?void 0:o.signal});this._set("allCategories",null),this._set("featureCount",d[n]||0)}_getRelationshipWhereClause(e){const{activeCategory:t}=this,o=e.createQuery(),s="subtypeField"in e?e.subtypeField:void 0,a=t&&s?`${s} = ${t.value}`:void 0,n=o.where;return n&&a?`(${n}) AND (${a})`:n??a}_sliceFeatures(e){const{showAllEnabled:t,displayCount:o}=this;return t?e:o?e.slice(0,o):[]}async _queryPage(){var n;const{relatedFeatures:e,featurePage:t,showAllEnabled:o,_queryPageAbortController:s,featureCount:a}=this;!o||t<2||!a||((n=this.relatedLayer)==null?void 0:n.type)==="subtype-group"&&!this.activeCategory||e.addMany(await this._queryRelatedFeatures({signal:s==null?void 0:s.signal}))}async _queryRelatedFeatures(e){var K;const{displayCount:t,featureCount:o,featurePage:s,featuresPerPage:a,layer:n,orderByFieldsFixedCasing:y,relatedLayer:u,relatedLayerKeyFields:h,relationshipId:C,showAllEnabled:_,supportsCacheHint:p}=this,{canQuery:b,objectId:d}=this;if(!b||!n||!u||d==null)return[];const m=_?((s-1)*a+o)%o:0,g=_?a:t,A=u.objectIdField,w="subtypeField"in u?u.subtypeField:void 0,F=[...y.map(I=>I.field),...fe(u),...h,A,w].filter(ve),k=y.map(I=>`${I.field} ${I.order}`),{historicMoment:L,gdbVersion:E}=n,Q=new ee({orderByFields:k,start:m,num:g,outFields:F,cacheHint:p,historicMoment:L,gdbVersion:E,relationshipId:C,returnGeometry:!1,objectIds:[d],where:this._getRelationshipWhereClause(u)}),ue=await n.queryRelatedFeatures(Q,{signal:e==null?void 0:e.signal}),R=((K=ue[d])==null?void 0:K.features)||[];return u.type==="subtype-group"&&w?R.forEach(I=>{var z;const ce=I.attributes[w],W=(z=u.findSublayerForSubtypeCode)==null?void 0:z.call(u,ce);I.sourceLayer=W,I.layer=W}):R.forEach(I=>{I.sourceLayer=u,I.layer=u}),R}};function ve(e){return e!=null&&e!==""}r([i()],c.prototype,"_loaded",void 0),r([i()],c.prototype,"_queryAbortController",void 0),r([i()],c.prototype,"_queryPageAbortController",void 0),r([i()],c.prototype,"_queryFeatureCountAbortController",void 0),r([i({value:1})],c.prototype,"featurePage",null),r([i()],c.prototype,"featuresPerPage",void 0),r([i({readOnly:!0})],c.prototype,"orderByFieldsFixedCasing",null),r([i({readOnly:!0})],c.prototype,"supportsCacheHint",null),r([i({readOnly:!0})],c.prototype,"canLoad",null),r([i({readOnly:!0})],c.prototype,"canQuery",null),r([i()],c.prototype,"activeCategory",void 0),r([i({readOnly:!0})],c.prototype,"allCategories",void 0),r([i({readOnly:!0})],c.prototype,"allCategoriesCount",null),r([i({readOnly:!0})],c.prototype,"categories",null),r([i()],c.prototype,"description",void 0),r([i({value:3})],c.prototype,"displayCount",null),r([i({type:ie})],c.prototype,"graphic",void 0),r([i({readOnly:!0})],c.prototype,"itemDescriptionFieldName",null),r([i()],c.prototype,"layer",void 0),r([i()],c.prototype,"map",void 0),r([i({readOnly:!0})],c.prototype,"objectId",null),r([i({readOnly:!0})],c.prototype,"objectIdField",null),r([i()],c.prototype,"orderByFields",void 0),r([i({readOnly:!0})],c.prototype,"relatedFeatures",null),r([i({readOnly:!0})],c.prototype,"relatedLayer",null),r([i({readOnly:!0})],c.prototype,"relatedLayerKeyField",null),r([i({readOnly:!0})],c.prototype,"relatedLayerKeyFields",null),r([i({readOnly:!0})],c.prototype,"relationship",null),r([i({readOnly:!0})],c.prototype,"relationshipKey",null),r([i({readOnly:!0})],c.prototype,"relationshipKeyField",null),r([i({readOnly:!0})],c.prototype,"featureCount",void 0),r([i({readOnly:!0})],c.prototype,"relatedFeatureViewModels",null),r([i()],c.prototype,"relationshipId",void 0),r([i()],c.prototype,"showAllEnabled",void 0),r([i()],c.prototype,"state",null),r([i()],c.prototype,"title",void 0),c=r([S("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],c);const Be=c;export{le as _,ne as i,Ae as l,Be as m,xe as w};
