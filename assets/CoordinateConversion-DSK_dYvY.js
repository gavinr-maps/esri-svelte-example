const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./calcite-button-D_Agetwz.js","./button-9P4PM9SO.js","./jsxFactory-CJa39Fro.js","./tslib.es6-B3Jf3DVX.js","./intl-CChhNOV8.js","./date-DlqISzcw.js","./jsonMap-0cxwUWs2.js","./subclass-BZA_h8Db.js","./locale-C9TlLpzi.js","./messages-OmQvZhAg.js","./Accessor-BLX9ikPh.js","./assets-C43MgM-v.js","./index-Bh2oEzTI.js","./index-2kwcjS9-.css","./Evented-BHRw9x22.js","./Promise-B2Hu02L7.js","./reactiveUtils-C5zUhJQJ.js","./asyncUtils-CWX51uTe.js","./Collection-CEdjem1-.js","./shared-B3wH2qpO.js","./SimpleObservable-KocWTzVy.js","./uuid-fwrPAdZb.js","./cast-Bjksrh93.js","./form-BZPQ5PUM.js","./dom-D_AJDzAj.js","./interactive-y84HQRWL.js","./label-DEe8AW1C.js","./component-6CIDVndn.js","./loadable-DM18hPdE.js","./locale-A4FuYD8q.js","./key-D63ExP77.js","./observers-D2xgmA06.js","./t9n-D0ry3MEw.js","./icon-BQO9J86c.js","./loader-C-zIPscB.js","./calcite-checkbox-B8olv0Y9.js","./calcite-input-DAafN6Cc.js","./input2-BReyTnf4.js","./Validation-Bz9yoU6e.js","./input-j1u1wOBY.js","./input-message-CWvsvdFk.js","./progress-BXyickl_.js","./calcite-label-B1FxWqaL.js","./calcite-option-BMqKJDtM.js","./calcite-select-CIxePAn2.js"])))=>i.map(i=>d[i]);
import{_ as y}from"./index-Bh2oEzTI.js";import{r}from"./tslib.es6-B3Jf3DVX.js";import{m as p,a as V,n as P,b as w}from"./subclass-BZA_h8Db.js";import{b as J,a0 as q}from"./Accessor-BLX9ikPh.js";import{s as U}from"./cast-Bjksrh93.js";import{e as k,B as Z,r as K,n,u as O,m as Q}from"./jsxFactory-CJa39Fro.js";import{c as X}from"./assets-C43MgM-v.js";import{d as Y}from"./Graphic-DsxsIjhH.js";import"./intl-CChhNOV8.js";import{V as I}from"./Collection-CEdjem1-.js";import{o as tt}from"./Evented-BHRw9x22.js";import{watch as S,initial as et,when as ot}from"./reactiveUtils-C5zUhJQJ.js";import{j as z}from"./Point-Cg0-ChZE.js";import{W as it}from"./projection-B971H0Re.js";import{n as st}from"./symbols-CNimns--.js";import{p as nt,c as B,u as rt,m as at}from"./formatUtils-C08vjXVT.js";import{t as lt}from"./GoTo-Wtu9mgoE.js";import{g as dt,c as D}from"./locale-C9TlLpzi.js";import{h as pt}from"./messages-OmQvZhAg.js";import{e as M}from"./globalCss-CZa70j6i.js";import{e as G}from"./Heading-C-odFCu-.js";import{i as ct}from"./legacyIcon-CEIp6Pa9.js";import{t as f}from"./accessibleHandler-hWbBTR_7.js";import"./Promise-B2Hu02L7.js";import"./uuid-fwrPAdZb.js";import"./geometry-D964gYQX.js";import"./Extent-Bf3YTe7m.js";import"./Polyline-D9YkgmM_.js";import"./writer-DNAwXnhG.js";import"./mathUtils-C4_ghTv4.js";import"./jsonMap-0cxwUWs2.js";import"./PopupTemplate-BHMhS05j.js";import"./Clonable-D3rtuBWg.js";import"./fieldUtils-tmQlKvWo.js";import"./date-DlqISzcw.js";import"./enumeration-Ba5njXdz.js";import"./Color-BCS62Hs5.js";import"./colorUtils-0bJDPow9.js";import"./ActionToggle-iT4slXc7.js";import"./Identifiable-B1UbsKNt.js";import"./jsonUtils-CEfjT-BK.js";import"./shared-B3wH2qpO.js";import"./SimpleObservable-KocWTzVy.js";import"./asyncUtils-CWX51uTe.js";import"./vec3f64-BLpZdpfb.js";import"./projectBuffer-Bs7GwaPY.js";import"./geodesicConstants-DWQLYX7F.js";import"./TextSymbol-D8QO_KUV.js";import"./screenUtils-_ZIvrt5o.js";import"./materialUtils-DarhapKC.js";import"./opacityUtils-C68Tlu6_.js";import"./aaBoundingBox-BE7cC1jD.js";import"./persistableUrlUtils-fa1mAujs.js";import"./collectionUtils-D_lHIu88.js";import"./Portal-C10FKnaA.js";import"./Loadable-BabW5Xcc.js";import"./number-CUaGJe2K.js";import"./coordinateFormatter-Bqv90CKy.js";let C=class extends J{constructor(o){super(o),this.format=null,this.position={coordinate:null,location:null}}get displayCoordinate(){var o,t;return(t=this.format)==null?void 0:t.getDisplayCoordinate((o=this.position)==null?void 0:o.coordinate)}};r([p({readOnly:!0})],C.prototype,"displayCoordinate",null),r([p()],C.prototype,"format",void 0),r([p()],C.prototype,"position",void 0),C=r([V("esri.widgets.CoordinateConversion.support.Conversion")],C);const T=C,$={default:"default",crosshair:"crosshair"},ht=new z([0,0,500]),ut="xy",mt=["mgrs","utm","usng","dd","dms","ddm"],A="esri__coordinateConversionWidgetState",b={conversions:"conversions",formats:"formats",view:"view",viewChange:"view-change"},vt="esri/images/search/search-symbol-32.png";let g=class extends lt(tt.EventedAccessor){constructor(t){super(t),this._conversionPromise=null,this._locationGraphic=null,this._pointerCount=0,this.conversions=new I,this.formats=new I,this.formatterAvailable=!1,this.messages=null,this.filteredFormats=new I,this.locationSymbol=new st({url:X(vt),width:24,height:24}),this.storageEnabled=!0,this.storageType="session",this.view=null,this._saveWidgetState=this._saveWidgetState.bind(this),this._handleFormatChange=this._handleFormatChange.bind(this),this._handleConversionChange=this._handleConversionChange.bind(this),this._handleViewChange=this._handleViewChange.bind(this),this._onClick=this._onClick.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerUp=this._onPointerUp.bind(this)}initialize(){const t=async()=>this.messages=await pt("esri/widgets/CoordinateConversion/t9n/CoordinateConversion");this.formats.addMany(nt()),t().then(()=>{if(!this.destroyed&&(B(this.messages,this.formats),this.storageEnabled&&this._loadWidgetState(),this.formats.forEach(e=>{e.viewModel=this,this.addHandles(S(()=>e.currentPattern,this._saveWidgetState),e.name??"unnamed-format")}),this.addHandles(this.conversions.on("change",this._handleConversionChange),b.conversions),this.addHandles(this.formats.on("change",this._handleFormatChange),b.formats),this.addHandles(dt(()=>{t().then(()=>{B(this.messages,this.formats)})})),it().then(()=>{this.formatterAvailable=!0}).catch(e=>{P.getLogger(this).error(new w("coordinate-conversion:projection-load-failed","Failed to load the projection module.",{error:e})),this.formatterAvailable=!1,this._filterFormatsAndConversions()}).then(()=>this.addHandles(S(()=>this.view,this._handleViewChange,et),b.viewChange)),this.conversions.length===0)){const e=this.formats.find(i=>i.name===ut)||this.formats.at(0);this.conversions.add(new T({format:e}))}})}destroy(){this.removeHandles(),this._cleanUpView(this.view),this.view=null}castConversions(t){return this._castToConversions(t)}set currentLocation(t){this._set("currentLocation",t),this._updateConversions()}get currentLocation(){return this._get("currentLocation")||null}set mode(t){switch(t){case"capture":this.currentLocation=null,this._startCaptureMode(),this._set("mode",t);break;case"live":this._startLiveMode(),this._set("mode",t)}}get mode(){return this._get("mode")||"live"}get state(){const{messages:t,view:e}=this,i=e==null?void 0:e.ready;return t?i?"ready":e?"loading":"disabled":"disabled"}get storage(){const{storageType:t}=this;return t==="session"?sessionStorage:localStorage}get waitingForConversions(){return this._conversionPromise!=null}setLocation(t){var i,s;if(this._locationGraphic&&((i=this.view)==null||i.graphics.remove(this._locationGraphic)),!t)return;const e=t.clone();e.hasZ&&(e.z=void 0),this._locationGraphic=new Y({geometry:e,symbol:this.locationSymbol}),(s=this.view)==null||s.graphics.add(this._locationGraphic)}async convert(t,e){if(!rt(e))throw new w("coordinate-conversion:invalid-point","Invalid point cannot be converted.",{point:e});return Promise.resolve().then(()=>t.convert(e))}async goToLocation(t){var a,d,u;const{view:e}=this;if(!e)throw new w("coordinate-conversion:go-to-failed","no view");const i=e.type==="3d"?e.clippingArea:null,s=(d=(a=e.map)==null?void 0:a.basemap)==null?void 0:d.baseLayers;if(i||(s==null?void 0:s.length)>0){const v=i??((u=s.at(0))==null?void 0:u.fullExtent);if(v!=null&&!v.contains(t))throw new w("coordinate-conversion:go-to-failed","Point outside basemap extent.",{point:t})}return this.callGoTo({target:t})}pause(){this.currentLocation=null,this.removeHandles(b.view),this.view&&(this.view.cursor=$.default,this._locationGraphic&&this.view.graphics.remove(this._locationGraphic))}async previewConversion(t,e=this.currentLocation||ht){return(await H(t,e)).displayCoordinate}resume(){this.mode==="capture"?this._startCaptureMode():this._startLiveMode()}reverseConvert(t,e){return e.reverseConvert(t)}async updateConversions(t,e){if((e==null?void 0:e.type)!=="point")throw this._clearConversions(this.conversions),new w("coordinate-conversion:invalid-input-point","Point is invalid, conversions cannot be updated.",{point:e});return this._convertMany(t,e)}_castToConversions(t){const e=new I;return t.forEach(i=>{let s=null;if(i instanceof T)s=i;else if(typeof i=="string"){const a=this.formats.find(d=>d.name===i);a&&(s=new T({format:a}))}s&&e.add(s)}),e}_cleanUpView(t){t&&(this._locationGraphic&&t.graphics.remove(this._locationGraphic),this.removeHandles(b.view),t.cursor=$.default)}_clearConversions(t){t.forEach(e=>{e.position={location:null,coordinate:null}})}async _convertMany(t,e){return Promise.all(t.map(i=>H(i,e)))}_handleConversionChange(t){for(const e of t.added){const{format:i}=e;i&&(i.viewModel=this,this.currentLocation&&(this._set("waitingForConversions",!0),this.convert(i,this.currentLocation).then(s=>{e.position=s,this._set("waitingForConversions",!1)})))}this._saveWidgetState()}_handleFormatChange(t){t.added.forEach(e=>{this.addHandles(S(()=>e.currentPattern,this._saveWidgetState),e.name??"unnamed-format"),e.viewModel=this}),t.removed.forEach(e=>{e.viewModel=null;const i=this.conversions.filter(s=>s.format===e);this.conversions.removeMany(i),e.name&&this.removeHandles(e.name)})}_loadWidgetState(){try{const t=JSON.parse(this.storage.getItem(A));t&&this._setWidgetState(t)}catch(t){P.getLogger(this).error(new w("coordinate-conversion:invalid-session-storage-json","Could not read from storage.",{error:t}))}}_startCaptureMode(){this.removeHandles(b.view),this.view&&(this.view.cursor=$.crosshair,this.currentLocation&&this.setLocation(this.currentLocation),this.addHandles(this.view.on("click",this._onClick),b.view))}_startLiveMode(){this._pointerCount=0,this.removeHandles(b.view),this.view&&(this.view.cursor=$.default,this._locationGraphic&&this.view.graphics.remove(this._locationGraphic),this.addHandles([this.view.on("pointer-down",this._onPointerDown),this.view.on("pointer-up",this._onPointerUp),this.view.on("pointer-move",this._onPointerMove)],b.view))}_handleViewChange(t,e){e&&e!==t&&this._cleanUpView(e),t&&(this.mode==="capture"?this._startCaptureMode():this._startLiveMode(),e&&this._filterFormatsAndConversions())}_onClick(t){var e;if(t.button===0){const i=(e=this.view)==null?void 0:e.toMap(t),s=i==null?void 0:i.normalize();this.setLocation(s),this.currentLocation=s}}_onPointerDown(t){var i;const{pointerType:e}=t;if(this._pointerCount++,(e==="touch"||e==="pen")&&this._pointerCount===1){const s=(i=this.view)==null?void 0:i.toMap(t);this.currentLocation=s==null?void 0:s.normalize()}}_onPointerMove(t){var i;const{pointerType:e}=t;if(e==="mouse"||this._pointerCount===1){const s=(i=this.view)==null?void 0:i.toMap(t);this.currentLocation=s==null?void 0:s.normalize()}}_onPointerUp(){this._pointerCount--}_setWidgetState(t){try{t.formats.forEach(e=>{const i=this.formats.find(s=>s.name===e.name);i&&t.locale===D()&&e.currentPattern&&(i.currentPattern=e.currentPattern),i&&e.index>=0&&this.conversions.add(new T({format:i}))})}catch(e){P.getLogger(this).warn(new w("coordinate-conversion:session-storage-read-error","Could not get widget state from stored JSON.",{error:e}))}}_saveWidgetState(){if(!this.storageEnabled)return;const t=this._toJSON();try{this.storage.setItem(A,JSON.stringify({formats:t,locale:D()}))}catch(e){P.getLogger(this).error(new w("coordinate-conversion:local-storage-write-error","Could not write to localStorage.",{error:e}))}}async _updateConversions(){try{await this.updateConversions(this.conversions.toArray(),this.currentLocation)}catch{}}_toJSON(){return this.formats.filter(t=>{const e=t.name;return e==="xy"||e==="basemap"||at(e)}).map(t=>({name:t.name,currentPattern:t.currentPattern,defaultPattern:t.defaultPattern,index:this.conversions.findIndex(e=>e.format===t)})).sort((t,e)=>t.index-e.index).toArray()}_filterFormatsAndConversions(){const{formatterAvailable:t,conversions:e,formats:i}=this;t||this.addHandles(ot(()=>{var s;return(s=this.view)==null?void 0:s.spatialReference},s=>{const a=s.isWebMercator||s.isWGS84,d=i.filter(m=>{const{name:_}=m;return!!_t(_)||_==="xy"&&!a}),u=this.filteredFormats.filter(m=>m.name==="xy"&&a&&!this.formats.includes(m)),v=e.filter(m=>d.includes(m.format));i.removeMany(d),e.removeMany(v),this.filteredFormats.addMany(d.filter(m=>!this.filteredFormats.includes(m))),i.addMany(u)},{once:!0,initial:!0}),b.view)}};async function H(o,t){var e;try{o.position=await((e=o.format)==null?void 0:e.convert(t))}catch{o.position=null}return o}function _t(o){return mt.includes(o)}r([p()],g.prototype,"conversions",void 0),r([U("conversions")],g.prototype,"castConversions",null),r([p({type:z})],g.prototype,"currentLocation",null),r([p()],g.prototype,"formats",void 0),r([p()],g.prototype,"messages",void 0),r([p()],g.prototype,"mode",null),r([p()],g.prototype,"filteredFormats",void 0),r([p({readOnly:!0})],g.prototype,"state",null),r([p()],g.prototype,"locationSymbol",void 0),r([p({readOnly:!0,dependsOn:["storageType"]})],g.prototype,"storage",null),r([p()],g.prototype,"storageEnabled",void 0),r([p()],g.prototype,"storageType",void 0),r([p({readOnly:!0})],g.prototype,"waitingForConversions",null),r([p()],g.prototype,"view",void 0),g=r([V("esri.widgets.CoordinateConversion.CoordinateConversionViewModel")],g);const j=g,h="esri-coordinate-conversion",l={base:h,captureMode:`${h}--capture-mode`,noBasemap:`${h}--no-basemap`,popup:`${h}__popup`,clipboardPopup:`${h}__clipboard-popup`,conversionList:`${h}__conversion-list`,conversionRow:`${h}__row`,coordDisplay:`${h}__display`,expandButton:`${h}__expand-button`,expanded:`${h}__conversions-view--expanded`,expandDown:`${h}__conversions-view--expand-down`,expandUp:`${h}__conversions-view--expand-up`,conversionsView:`${h}__conversions-view`,rowSelect:`${h}__select-row`,toolDisplay:`${h}__tools`,modeToggle:`${h}__mode-toggle`,rowButton:`${h}__row-button`,coordinateInput:`${h}__input-coordinate`,inputForm:`${h}__input-form`,inputFormGroup:`${h}__input-group`,inputSelect:`${h}__input-select`,sectionHeading:`${h}__heading`,patternInput:`${h}__pattern-input`,settings:`${h}__settings`,settingsFormGroup:`${h}__settings-group`,settingsFormGroupHorizontal:`${h}__settings-group-horizontal`,previewCoordinate:`${h}__preview-coordinate`},R={settingsButton:!0,inputButton:!0,captureButton:!0,expandButton:!0},gt=750,bt=2500;let c=class extends Z{constructor(o,t){super(o,t),this._popupMessage=null,this._popupTimeoutId=void 0,this._clipboardPopupTimeoutId=void 0,this._coordinateInput=null,this._badInput=!1,this._goToEnabled=!1,this._conversionFormat=null,this._settingsFormat=null,this._previewConversion=null,this._expanded=!1,this._clipboardPopupVisible=!1,this._popupVisible=!1,this._settingsVisible=!1,this._inputVisible=!1,this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.orientation="auto",this.viewModel=new j,this.visibleElements={...R}}loadDependencies(){return K({button:()=>y(()=>import("./calcite-button-D_Agetwz.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34]),import.meta.url),checkbox:()=>y(()=>import("./calcite-checkbox-B8olv0Y9.js"),__vite__mapDeps([35,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,24,23,25,30,26,27,28]),import.meta.url),input:()=>y(()=>import("./calcite-input-DAafN6Cc.js"),__vite__mapDeps([36,37,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,24,23,25,30,26,27,28,29,31,32,38,39,33,40,41]),import.meta.url),label:()=>y(()=>import("./calcite-label-B1FxWqaL.js"),__vite__mapDeps([42,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,26,24,27]),import.meta.url),option:()=>y(()=>import("./calcite-option-BMqKJDtM.js"),__vite__mapDeps([43,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,31]),import.meta.url),select:()=>y(()=>import("./calcite-select-CIxePAn2.js"),__vite__mapDeps([44,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,24,23,25,26,27,28,31,38,33,40]),import.meta.url)})}get conversions(){return this.viewModel.conversions}set conversions(o){this.viewModel.conversions=o}get currentLocation(){return this.viewModel.currentLocation}set currentLocation(o){this.viewModel.currentLocation=o}get formats(){return this.viewModel.formats}set formats(o){this.viewModel.formats=o}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(o){this.viewModel.goToOverride=o}get icon(){return"coordinate-system"}set icon(o){this._overrideIfSome("icon",o)}get label(){var o;return((o=this.messages)==null?void 0:o.widgetLabel)??""}set label(o){this._overrideIfSome("label",o)}get mode(){return this.viewModel.mode}set mode(o){this.viewModel.mode=o}set multipleConversions(o){o===!1&&(this._expanded=!1,this.conversions.splice(1,this.conversions.length-1)),this._set("multipleConversions",o)}get multipleConversions(){const o=this._get("multipleConversions");return typeof o!="boolean"||o}get locationSymbol(){return this.viewModel.locationSymbol}set locationSymbol(o){this.viewModel.locationSymbol=o}get storageEnabled(){return this.viewModel.storageEnabled}set storageEnabled(o){this.viewModel.storageEnabled=o}get storageType(){return this.viewModel.storageType}set storageType(o){this.viewModel.storageType=o}get view(){return this.viewModel.view}set view(o){this.viewModel.view=o}castVisibleElements(o){return{...R,...o}}reverseConvert(o,t){return this.viewModel.reverseConvert(o,t)}render(){var u,v;const o=(u=this.viewModel)==null?void 0:u.state,t=o==="disabled"?n("div",{key:"esri-coordinate__no-basemap"},(v=this.messages)==null?void 0:v.noBasemap):null,e=!t&&this._inputVisible?this._renderInputForm():null,i=!t&&this._settingsVisible?this._renderSettings():null,s=t||e||i?null:this._renderConversionsView(),a=this._popupVisible?this._renderPopup():null,d={[l.captureMode]:this.mode==="capture",[M.disabled]:o==="loading",[l.noBasemap]:o==="disabled"};return n("div",{class:this.classes(l.base,M.widget,d)},a,t,s,i,e)}_addConversion(o){const t=o.target,e=t.selectedOption.value,i=W(t);if(e==null||i==null)return;const s=new T({format:e});t.value="default",i>=0?(this.conversions.removeAt(i),this.conversions.add(s,i)):this.conversions.add(s)}_findSettingsFormat(){return this._settingsFormat||this.conversions.reduceRight((o,t)=>{const e=t.format;return e!=null&&e.hasDisplayProperties?e:o},null)||this.formats.find(o=>o.hasDisplayProperties)}_hidePopup(){this._popupTimeoutId&&(clearTimeout(this._popupTimeoutId),this._popupTimeoutId=void 0),this._popupVisible=!1,this._popupMessage=null,this.scheduleRender()}_hideClipboardPopup(){this._clipboardPopupTimeoutId&&(clearTimeout(this._clipboardPopupTimeoutId),this._clipboardPopupTimeoutId=void 0),this._clipboardPopupVisible=!1,this.scheduleRender()}_onConvertComplete(){this._inputVisible=!1,this._coordinateInput.value=""}_onCopy(o){var e,i;const t=(e=wt(o.currentTarget))==null?void 0:e.displayCoordinate;t!=null&&((i=o.clipboardData)==null||i.setData("text/plain",t),this._showClipboardPopup(),o.preventDefault())}_processUserInput(o){const t=q(o,"key"),e=this.viewModel;if(t!=="Enter"&&t)this._badInput&&(this._badInput=!1);else{const i=this._conversionFormat||this.conversions.at(0).format;if(!i)return;const s=this._coordinateInput.value;this._reverseConvert(s,i).then(a=>{this.mode==="capture"?e.resume():this.mode="capture",this.currentLocation=a,e.setLocation(a),this._onConvertComplete()}).catch(a=>{var d;P.getLogger(this).error(a),this._showPopup((d=this.messages)==null?void 0:d.invalidCoordinate),this._badInput=!0})}}async _reverseConvert(o,t){const e=this.viewModel,i=await t.reverseConvert(o);return this._goToEnabled&&i&&e.goToLocation(i).catch(s=>{var a;P.getLogger(this).warn(s),this._showPopup((a=this.messages)==null?void 0:a.locationOffBasemap)}),i}_setInputFormat(o){const t=o.target.selectedOption.value;t!=null&&(this._conversionFormat=t)}_setPreviewConversion(){var e,i;const o=this._findSettingsFormat(),t=this.viewModel;if(o){const s=this.conversions.find(a=>a.format===o);this._previewConversion=new T({format:o,position:{location:this.currentLocation,coordinate:(e=s==null?void 0:s.position)==null?void 0:e.coordinate}}),(i=this._previewConversion.position)!=null&&i.coordinate||t.previewConversion(this._previewConversion)}}_setSettingsFormat(o){const t=o.target.selectedOption.value;t!=null&&(this._settingsFormat=t,this._setPreviewConversion())}_showClipboardPopup(){this._clipboardPopupVisible?clearTimeout(this._clipboardPopupTimeoutId):this._clipboardPopupVisible=!0,this.scheduleRender(),this._popupTimeoutId=setTimeout(()=>{this._popupTimeoutId=void 0,this._hideClipboardPopup()},gt)}_showPopup(o,t=bt){this._popupMessage=o,this._popupVisible?clearTimeout(this._popupTimeoutId):this._popupVisible=!0,this.scheduleRender(),this._popupTimeoutId=setTimeout(()=>{this._popupTimeoutId=void 0,this._hidePopup()},t)}_toggleGoTo(){this._goToEnabled=!this._goToEnabled}_updateCurrentPattern(o){o.stopPropagation();const t=o.target,e=this._findSettingsFormat();e&&(e.currentPattern=t.value)}_renderConversion(o,t){const{messages:e}=this;if(!e)return n("li",null);const{format:i}=o,s=(i==null?void 0:i.label)??"",a=`${this.id}__list-item-${t}`,d=`${s} ${e.conversionOutputSuffix}`,u=t===0,v=u||this._expanded,m=u?this._renderFirstConversion(o):this._renderTools(t,o,a),_=u&&!o.displayCoordinate?e.noLocation:o.displayCoordinate,x=n("div",{"aria-label":_,class:l.coordDisplay,"data-conversion":o,role:"listitem",tabIndex:0,title:_??""},_),F=this._renderOptions(this.formats.filter(L=>L!==i));return v?n("li",{"aria-label":d,class:l.conversionRow,id:a,key:o,role:"group",tabIndex:0,title:d},n("calcite-select",{"aria-controls":a,bind:this,class:l.rowSelect,"data-index":t,label:e.selectFormat,scale:"s",onCalciteSelectChange:this._addConversion},n("calcite-option",{label:s.toUpperCase(),selected:!0},s.toUpperCase()),F),x,m):null}_renderCopyButton(o){const t=this._clipboardPopupVisible&&this._renderClipboardPopup(),{messagesCommon:e}=this;return e?n("li",{"aria-label":e.copy,bind:this,class:this.classes(M.widgetButton,l.rowButton),"data-conversion":o,onclick:this._copyCoordinateOutput,oncopy:this._onCopy,onkeydown:this._copyCoordinateOutput,role:"button",tabIndex:0,title:e.copy},t,n("span",{"aria-hidden":"true",class:ct.duplicate})):n("li",null)}_renderFirstConversion(o){const t=this.id,{messages:e,messagesCommon:i,multipleConversions:s,visibleElements:a}=this;if(!i||!e)return n("ul",null);const d=this.mode==="live"?e.captureMode:e.liveMode,u=this._expanded?i.collapse:i.expand,v=o.displayCoordinate&&this.mode==="capture"?this._renderCopyButton(o):null,m=s&&a.expandButton&&this._renderIconButton({iconType:this._expanded?"chevron-down":"chevron-up",clickFunction:this._toggleExpand,classes:[l.expandButton],attributes:{"aria-controls":`${t}__${l.conversionList}`,label:u}}),_=!s&&a.captureButton&&this._renderIconButton({iconType:this.mode==="live"?"pin-tear":"pin-tear-f",clickFunction:this._toggleMode,classes:[l.modeToggle],attributes:{label:d}});return n("ul",{class:l.toolDisplay},v,m,_)}_renderInputForm(){const o=this._conversionFormat||this.conversions.at(0).format,t=this.formats.findIndex(_=>_.name===(o==null?void 0:o.name)),e=this.id,i=`${e}__${l.coordinateInput}`,s=`${e}__${l.coordinateInput}__header`,a=this._renderOptions(this.formats,!0,t),{messages:d,messagesCommon:u,headingLevel:v}=this;if(!u||!d)return n("div",null);const m=this._renderIconButton({iconType:O(this.container)?"arrow-right":"arrow-left",clickFunction:this._toggleInputVisibility,attributes:{label:u.back}});return n("div",{"aria-labelledby":s,class:l.inputForm,key:"esri-coordinate-conversion__input-form",role:"search"},n("div",{class:l.sectionHeading},m,n(G,{class:M.heading,id:s,level:v},d.inputCoordTitle)),n("div",{class:l.inputFormGroup},n("calcite-select",{"aria-controls":i,bind:this,class:l.inputSelect,label:d.selectFormat,scale:"s",onCalciteSelectChange:this._setInputFormat},a),n("calcite-input",{afterCreate:Q,"aria-labelledby":s,bind:this,class:l.coordinateInput,"data-format":o,"data-node-ref":"_coordinateInput",id:i,onkeydown:this._processUserInput,placeholder:d.inputCoordTitle,required:!0,scale:"s",spellcheck:!1,status:this._badInput?"invalid":"idle"})),n("div",{class:l.inputFormGroup},n("calcite-label",{layout:"inline",scale:"s"},n("calcite-checkbox",{bind:this,checked:this._goToEnabled,onCalciteCheckboxChange:this._toggleGoTo}),d.goTo),n("calcite-button",{appearance:"outline",bind:this,kind:"neutral",onclick:this._processUserInput,type:"button",width:"auto"},d.convert)))}_renderConversionsView(){const{messages:o}=this;if(!o)return n("div",null);const t=`${this.id}__${l.conversionList}`,e=this._renderPrimaryTools(),i=this._renderOptions(this.formats),s=this.conversions.map((u,v)=>this._renderConversion(u,v)).toArray(),a=this._expanded?n("div",{class:l.conversionRow},n("calcite-select",{"aria-controls":t,bind:this,"data-index":-1,label:o.addConversion,scale:"s",onCalciteSelectChange:this._addConversion},n("calcite-option",{disabled:!0,selected:!0,value:"default"},o.addConversion),i),e):null,d={[l.expanded]:this._expanded,[l.expandUp]:this.orientation==="expand-up",[l.expandDown]:this.orientation==="expand-down"};return n("div",{class:this.classes(l.conversionsView,d),key:"esri-coordinate-conversion__main-view"},n("ul",{"aria-expanded":this._expanded?"true":"false",class:l.conversionList,id:t},s),a)}_renderOptions(o,t,e){var a;const i=this.conversions.at(0),s=(a=i.format)==null?void 0:a.name;return o.map((d,u)=>{const v=!(t||!i)&&(s===d.name||this.conversions.map(m=>{var _;return(_=m.format)==null?void 0:_.name}).includes(d.name));return n("calcite-option",{disabled:v,key:d.name??"unnamed-format",label:d.label.toUpperCase(),selected:u===e,value:d},d.label)}).toArray()}_renderPopup(){return n("div",{class:l.popup,role:"alert"},this._popupMessage)}_renderClipboardPopup(){const{messages:o}=this;return o?n("div",{class:this.classes(l.popup,l.clipboardPopup),role:"alert"},o.copySuccessMessage):n("div",null)}_renderPrimaryTools(){const{messages:o,visibleElements:t}=this;if(!o)return n("ul",null);const e=this.mode==="live"?o.captureMode:o.liveMode,i=t.inputButton&&this._renderIconButton({iconType:"pencil",clickFunction:this._toggleInputVisibility,attributes:{label:o.inputCoordTitle}}),s=t.captureButton&&this._renderIconButton({iconType:this.mode==="live"?"pin-tear":"pin-tear-f",clickFunction:this._toggleMode,classes:[l.modeToggle],attributes:{label:e}}),a=t.settingsButton&&this._renderIconButton({iconType:"gear",clickFunction:this._toggleSettingsVisibility,attributes:{label:o.settingsTitle}});return n("ul",{class:l.toolDisplay},i,s,a)}_renderSettings(){var E;const o=this.id,t=`${o}__${l.patternInput}`,e=`${o}__${l.patternInput}__header`,i=`${o}__${l.previewCoordinate}`,s=this.formats.filter(N=>N.hasDisplayProperties),a=this._findSettingsFormat(),d=a?s.indexOf(a):-1,u=this._renderOptions(s,!0,d),v=a==null?void 0:a.currentPattern,{messages:m,messagesCommon:_,headingLevel:x}=this;if(!_||!m)return n("div",null);const F=this._renderIconButton({iconType:O(this.container)?"arrow-right":"arrow-left",clickFunction:this._toggleSettingsVisibility,attributes:{label:_.back}}),L=this._renderIconButton({iconType:"refresh",clickFunction:this._setDefaultPattern,attributes:{label:m.defaultPattern}});return n("div",{"aria-labelledby":e,class:l.settings,key:l.settings},n("div",{class:l.sectionHeading},F,n(G,{class:M.heading,id:e,level:x},m.settingsTitle)),n("div",{class:l.settingsFormGroup},n("label",{for:t},m.changeCoordinateDisplay),n("calcite-select",{bind:this,label:m.selectFormat,width:"full",onCalciteSelectChange:this._setSettingsFormat},u),n("div",{class:l.settingsFormGroupHorizontal},n("calcite-input",{"aria-controls":i,bind:this,class:l.patternInput,id:t,spellcheck:!1,type:"text",value:v,onCalciteInputInput:this._updateCurrentPattern}),L)),n("div",{class:l.settingsFormGroup},n("label",null,_.preview,n("div",{class:l.previewCoordinate,id:i,tabIndex:0},(E=this._previewConversion)==null?void 0:E.displayCoordinate))))}_renderIconButton(o){const{iconType:t,clickFunction:e,classes:i,attributes:s}=o;return n("calcite-button",{appearance:"transparent",bind:this,class:this.classes(i),iconStart:t,kind:"neutral",onclick:e,onkeydown:e,...s})}_renderTools(o,t,e){const i=t.displayCoordinate&&this.mode==="capture"?this._renderCopyButton(t):null,{messages:s}=this;if(!s)return n("ul",null);const a=this._renderIconButton({iconType:"x",clickFunction:this._removeConversion,attributes:{"aria-controls":e,label:s.removeConversion,"data-index":o}});return n("ul",{class:l.toolDisplay,role:"listitem"},i,n("li",{class:this.classes(l.rowButton)},a))}_copyCoordinateOutput(o){const t=o.target;if(!("createTextRange"in document.body)){const e=window.getSelection(),i=document.createRange();i.selectNodeContents(t),e==null||e.removeAllRanges(),e==null||e.addRange(i)}document.execCommand("copy")}_removeConversion(o){const t=W(o.currentTarget);t!=null&&this.conversions.removeAt(t)}_setDefaultPattern(o){o.stopPropagation();const t=this._findSettingsFormat();t&&(t.currentPattern=t.defaultPattern)}_toggleExpand(){this._expanded=!this._expanded}_toggleInputVisibility(){this._inputVisible=!this._inputVisible,this._popupVisible&&this._hidePopup(),this._inputVisible?this.viewModel.pause():this.viewModel.resume()}_toggleMode(){this.mode=this.mode==="live"?"capture":"live"}_toggleSettingsVisibility(){this._settingsVisible=!this._settingsVisible,this._popupVisible&&this._hidePopup(),this._settingsVisible?(this._setPreviewConversion(),this.viewModel.pause()):this.viewModel.resume()}};r([p()],c.prototype,"conversions",null),r([p()],c.prototype,"currentLocation",null),r([p()],c.prototype,"formats",null),r([p()],c.prototype,"goToOverride",null),r([p()],c.prototype,"headingLevel",void 0),r([p()],c.prototype,"icon",null),r([p()],c.prototype,"label",null),r([p(),k("esri/widgets/CoordinateConversion/t9n/CoordinateConversion")],c.prototype,"messages",void 0),r([p(),k("esri/t9n/common")],c.prototype,"messagesCommon",void 0),r([p()],c.prototype,"mode",null),r([p()],c.prototype,"orientation",void 0),r([p()],c.prototype,"multipleConversions",null),r([p()],c.prototype,"locationSymbol",null),r([p()],c.prototype,"storageEnabled",null),r([p()],c.prototype,"storageType",null),r([p()],c.prototype,"view",null),r([p({type:j})],c.prototype,"viewModel",void 0),r([p()],c.prototype,"visibleElements",void 0),r([U("visibleElements")],c.prototype,"castVisibleElements",null),r([f()],c.prototype,"_copyCoordinateOutput",null),r([f()],c.prototype,"_removeConversion",null),r([f()],c.prototype,"_setDefaultPattern",null),r([f()],c.prototype,"_toggleExpand",null),r([f()],c.prototype,"_toggleInputVisibility",null),r([f()],c.prototype,"_toggleMode",null),r([f()],c.prototype,"_toggleSettingsVisibility",null),c=r([V("esri.widgets.CoordinateConversion")],c);const Me=c;function W(o){return o["data-index"]}function wt(o){return o["data-conversion"]}export{Me as default};
