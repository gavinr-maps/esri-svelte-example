import{b as h}from"./Graphic-Dt0LgVGU.js";import{B as y,o as l}from"./Accessor-BmwT4B0c.js";import{w as S}from"./Extent-g5W9hy0j.js";import E from"./Mesh-n20h-u6K.js";import{g}from"./Point-Cz2JYYmX.js";import{i as N,a as D}from"./External-wgBWsUOW.js";import{s as M}from"./infoFor3D-C7tb3HsI.js";import{d as w}from"./FeatureSet-B5-Veyin.js";import{n as F,i as T}from"./meshFeatureAttributes-D_YhcfFZ.js";import"./Clonable-Z-AWS-16.js";import"./reactiveUtils-XM7cS2OP.js";import"./Evented-Dw4_VOGn.js";import"./SimpleObservable-CvOkykwM.js";import"./JSONSupport-DcrLLGjL.js";import"./cast-CsZslgGN.js";import"./index-4eY77cms.js";import"./writer-DKgfqj4X.js";import"./opacityUtils-Dim20wpZ.js";import"./Promise-DfET-uns.js";import"./enumeration-DpvDkLNI.js";import"./Color-VJEMvW-n.js";import"./colorUtils-Rxh2V3ai.js";import"./mathUtils-Cfq9PL9W.js";import"./ActionToggle-D7439N1A.js";import"./Identifiable-BHVfzH03.js";import"./jsonUtils-CwFG8yN4.js";import"./Polyline-s-JzsQqo.js";import"./typeUtils-B6WBEKDM.js";import"./TextSymbol-BLIQ6RKX.js";import"./screenUtils-_ZIvrt5o.js";import"./collectionUtils-CTT-51g7.js";import"./Portal-CmmHxpLg.js";import"./vec3f64-BLpZdpfb.js";import"./aaBoundingBox-Dw3yBk2f.js";import"./axisAngleDegrees-DdLZENJj.js";import"./mat4-Fi6iAz29.js";import"./common-DQOJ18NT.js";import"./quat-CP7JhygC.js";import"./mat3f64-BBpwCtoL.js";import"./quatf64-CCm9z-pX.js";import"./vec32-Dvg_eL9J.js";import"./vec42-YcqnINSP.js";import"./MeshComponent-rpOomp-7.js";import"./imageUtils-DsXKmbqJ.js";import"./meshProperties-C4iW0Ukm.js";import"./MeshLocalVertexSpace-CnHk-qPr.js";import"./MeshTransform-mu8wTSqx.js";import"./mat4f64-Dk4dwAN8.js";import"./MeshVertexAttributes-CAQDsbB5.js";import"./meshVertexSpaceUtils-AgAbm20L.js";import"./triangulationUtils-Cu97ljqy.js";import"./earcut-D9gy186-.js";import"./Indices-D8XWalpO.js";import"./plane-CpXmOyqq.js";import"./vec2f64-Dy6m9Nrb.js";import"./vec4f64-o2zAXfmz.js";import"./mathUtils-BgCEaV43.js";import"./deduplicate-Cp1WDW0w.js";import"./projectPointToVector-BoxjK-qy.js";import"./projection-CyCZAIaD.js";import"./projectBuffer-CQnuEMuP.js";import"./geodesicConstants-RQL9oKdk.js";import"./vertexSpaceConversion-Dzgt1uZW.js";import"./mat3-CR8GKnhD.js";import"./spatialReferenceEllipsoidUtils-DBqQpPRa.js";import"./computeTranslationToOriginAndRotation-DYUrDrjE.js";import"./vec3-BXNNVgyU.js";import"./BufferView-0osDbyWD.js";import"./vec2-ChnYg_BJ.js";import"./vec4-CYI93Mrm.js";import"./Field-BDG0QV_T.js";import"./fieldType-CBeoJWlv.js";const b=()=>y.getLogger("esri.rest.support.meshFeatureSet");function Vt(t,e,r){const o=r.features;r.features=[],delete r.geometryType;const i=w.fromJSON(r);if(i.geometryType="mesh",!r.assetMaps)return i;const m=O(e,r.assetMaps),s=t.sourceSpatialReference??g.WGS84,u=r.globalIdFieldName,{outFields:p}=t,f=p!=null&&p.length>0?I(p.includes("*")?null:new Set(p)):()=>({});for(const n of o){const a=L(n,u,s,e,m);i.features.push(new h({geometry:a,attributes:f(n)}))}return i}function I(t){return({attributes:e})=>{if(!e)return{};if(!t)return e;for(const r in e)t.has(r)||delete e[r];return e}}function L(t,e,r,o,i){const m=t.attributes[e],s=i.get(m);if(s==null||!t.geometry)return null;const u=F(t.attributes,r,o.transformFieldRoles),p=S.fromJSON(t.geometry);p.spatialReference=r;const f=T(t.attributes,o.transformFieldRoles),n=r.isGeographic?"local":"georeferenced",a=P(s);return a?E.createWithExternalSource(u,a,{extent:p,transform:f,vertexSpace:n,unitConversionDisabled:!0}):E.createIncomplete(u,{extent:p,transform:f,vertexSpace:n})}var c;function O(t,e){const r=new Map;for(const o of e){const i=o.parentGlobalId;if(i==null)continue;const m=o.assetName,s=o.assetType,u=o.assetHash,p=o.assetURL,f=o.conversionStatus,n=o.seqNo,a=M(s,t.supportedFormats);if(!a){b().error("mesh-feature-set:unknown-format",`Service returned an asset of type ${s}, but it does not list it as a supported type`);continue}const d=l(r,i,()=>({files:new Map}));l(d.files,m,()=>({name:m,type:s,mimeType:a,status:$(f),parts:[]})).parts[n]={hash:u,url:p}}return r}function P(t){const e=Array.from(t.files.values()),r=new Array;for(const o of e){if(o.status!==c.COMPLETED)return null;const i=new Array;for(const m of o.parts){if(!m)return null;i.push(new N(m.url,m.hash))}r.push(new D(o.name,o.mimeType,i))}return r}function $(t){switch(t){case"COMPLETED":case"SUBMITTED":return c.COMPLETED;case"INPROGRESS":return c.PENDING;default:return c.FAILED}}(function(t){t[t.FAILED=0]="FAILED",t[t.PENDING=1]="PENDING",t[t.COMPLETED=2]="COMPLETED"})(c||(c={}));export{O as assetMapFromAssetMapsJSON,L as extractMesh,Vt as meshFeatureSetFromJSON};
