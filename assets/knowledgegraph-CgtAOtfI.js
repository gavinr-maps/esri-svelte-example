const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./knowledgeGraphService-9oFvDyoC.js","./geometry-D964gYQX.js","./subclass-BZA_h8Db.js","./Extent-Bf3YTe7m.js","./tslib.es6-B3Jf3DVX.js","./Point-Cg0-ChZE.js","./Accessor-BLX9ikPh.js","./cast-Bjksrh93.js","./writer-DNAwXnhG.js","./assets-C43MgM-v.js","./index-Bh2oEzTI.js","./index-2kwcjS9-.css","./jsonMap-0cxwUWs2.js","./Polyline-D9YkgmM_.js","./mathUtils-C4_ghTv4.js","./GraphQueryStreaming-BltM_QD2.js"])))=>i.map(i=>d[i]);
import{_ as G}from"./index-Bh2oEzTI.js";import{h as Q}from"./subclass-BZA_h8Db.js";import"./geometry-D964gYQX.js";import{t as J,N as I}from"./arcadeUtils-BE8Aletj.js";import{i as P,a as l,r as u,d as T,P as y,$ as K,Y as V,E as _,B as j,z as q,e as W,t as M,l as B,Q as C,q as A,a3 as L}from"./languageUtils-JGnUBrxZ.js";import{l as O}from"./portalUtils-DzVhPDyr.js";import{g as b,n as D,a as z,R as U}from"./Point-Cg0-ChZE.js";import{_ as Y,W as H,K as X}from"./projection-B971H0Re.js";import{b as E}from"./Portal-C10FKnaA.js";import Z from"./PortalItem-DzgXrpyc.js";import{p as $,n as tt}from"./project-DlMfXva8.js";import{s as rt,m as it,t as nt,p as et,c as ot}from"./GraphQueryStreaming-BltM_QD2.js";import"./Extent-Bf3YTe7m.js";import"./tslib.es6-B3Jf3DVX.js";import"./Polyline-D9YkgmM_.js";import"./writer-DNAwXnhG.js";import"./mathUtils-C4_ghTv4.js";import"./jsonMap-0cxwUWs2.js";import"./TimeOnly-DOn_Hy89.js";import"./UnknownTimeZone-BkowvBs8.js";import"./date-DlqISzcw.js";import"./locale-C9TlLpzi.js";import"./deepClone-CWS5qiGp.js";import"./ImmutableArray-BPVd6ESQ.js";import"./Accessor-BLX9ikPh.js";import"./jsonUtils-CEfjT-BK.js";import"./featureConversionUtils-D14h8iad.js";import"./aaBoundingBox-BE7cC1jD.js";import"./OptimizedFeature-6cJ-QFG5.js";import"./OptimizedGeometry-BF8iz5FO.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./FieldsIndex-DpwHKAMX.js";import"./assets-C43MgM-v.js";import"./fieldUtils-tmQlKvWo.js";import"./intl-CChhNOV8.js";import"./messages-OmQvZhAg.js";import"./number-CUaGJe2K.js";import"./shared-OyXfj1UM.js";import"./Field-ybkHhtnK.js";import"./enumeration-Ba5njXdz.js";import"./fieldType-BuzM0UHS.js";import"./hash-CcEbRgUF.js";import"./uuid-fwrPAdZb.js";import"./Query-5Xpquc1r.js";import"./cast-Bjksrh93.js";import"./DataLayerSource-BKkswDvG.js";import"./FullTextSearch-Csd1Hktu.js";import"./Clonable-D3rtuBWg.js";import"./TimeExtent-DocT5yPf.js";import"./timeUtils-8fb_2oAt.js";import"./SimpleObservable-KocWTzVy.js";import"./vec3f64-BLpZdpfb.js";import"./projectBuffer-Bs7GwaPY.js";import"./geodesicConstants-DWQLYX7F.js";import"./Loadable-BabW5Xcc.js";import"./Promise-B2Hu02L7.js";import"./persistableUrlUtils-fa1mAujs.js";import"./utils-6jMaHUrH.js";import"./utils-Bema0iXE.js";let f=null;async function at(t){const r=Q.geometryServiceUrl??"";if(!r){Y()||await H();for(const i of t)i.container[i.indexer]=X(i.container[i.indexer],b.WGS84);return}const n=t.map(i=>i.container[i.indexer]),o=new $({geometries:n,outSpatialReference:b.WGS84}),p=await tt(r,o);for(let i=0;i<p.length;i++){const e=t[i];e.container[e.indexer]=p[i]}}async function k(t,r){const n=new Z({portal:t,id:r});return await n.load(),f===null&&(f=await G(()=>import("./knowledgeGraphService-9oFvDyoC.js").then(o=>o.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]),import.meta.url)),await f.fetchKnowledgeGraph(n.url)}function v(t,r,n,o,p){if(t===null)return null;if(y(t)||q(t))return t;if(W(t)||W(t))return t.toJSDate();if(M(t))return t.toStorageFormat();if(B(t))return t.toStorageString();if(C(t)){const i={};for(const e of t.keys())i[e]=v(t.field(e),r,n,o,p),i[e]instanceof D&&p.push({container:i,indexer:e});return i}if(_(t)){const i=t.map(e=>v(e,r,n,o,p));for(let e=0;e<i.length;e++)i[e]instanceof D&&p.push({container:i,indexer:e});return i}return A(t)?t.spatialReference.isWGS84?t:t.spatialReference.isWebMercator&&r?z(t):t:void 0}function pt(t,r){if(!t)return t;if(t.spatialReference.isWGS84&&r.spatialReference.isWebMercator)return U(t);if(t.spatialReference.equals(r.spatialReference))return t;throw new l(r,u.WrongSpatialReference,null)}function R(t,r){if(!t)return null;const n={};for(const o in t)n[o]=g(t[o],r);return n}function g(t,r){return t===null?null:_(t)?t.map(n=>g(n,r)):t instanceof it?{graphTypeName:t.typeName,id:t.id,graphType:"entity",properties:R(t.properties,r)}:t instanceof nt?{graphType:"object",properties:R(t.properties,r)}:t instanceof et?{graphTypeName:t.typeName,id:t.id,graphType:"relationship",originId:t.originId??null,destinationId:t.destinationId??null,properties:R(t.properties,r)}:t instanceof ot?{graphType:"path",path:t.path?t.path.map(n=>g(n,r)):null}:A(t)?pt(t,r):y(t)||q(t)||L(t)?t:null}function cr(t){t.mode==="async"&&(t.functions.knowledgegraphbyportalitem=function(r,n){return t.standardFunctionAsync(r,n,(o,p,i)=>{var c,d;if(P(i,2,2,r,n),i[0]===null)throw new l(r,u.PortalRequired,n);if(i[0]instanceof J){const m=T(i[1]);let h;return h=(c=r.services)!=null&&c.portal?r.services.portal:E.getDefault(),k(O(i[0],h),m)}if(y(i[0])===!1)throw new l(r,u.InvalidParameter,n);const e=T(i[0]);return k(((d=r.services)==null?void 0:d.portal)??E.getDefault(),e)})},t.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),t.functions.querygraph=function(r,n){return t.standardFunctionAsync(r,n,async(o,p,i)=>{var x;P(i,2,4,r,n);const e=i[0];if(!K(e))throw new l(r,u.InvalidParameter,n);const c=i[1];if(!y(c))throw new l(r,u.InvalidParameter,n);f===null&&(f=await G(()=>import("./knowledgeGraphService-9oFvDyoC.js").then(a=>a.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]),import.meta.url));let d=null;const m=V(i[2],null);if(!(m instanceof I||m===null))throw new l(r,u.InvalidParameter,n);if(m){let a=[];d=v(m,!0,!1,r,a),a=a.filter(s=>!s.container[s.indexer].spatialReference.isWGS84),a.length>0&&await at(a)}const h=new rt({openCypherQuery:c,bindParameters:d});(((x=e==null?void 0:e.serviceDefinition)==null?void 0:x.currentVersion)??11.3)>11.2&&(h.outputSpatialReference=r.spatialReference);const F=(await f.executeQueryStreaming(e,h)).resultRowsStream.getReader(),S=[];try{for(;;){const{done:a,value:s}=await F.read();if(a)break;if(_(s))for(const w of s)S.push(g(w,r));else{const w=[];for(const N of s)w.push(g(s[N],r));S.push(w)}}}catch(a){throw a}return I.convertJsonToArcade(S,j(r),!1,!0)})},t.signatures.push({name:"querygraph",min:2,max:4}))}export{cr as registerFunctions};
