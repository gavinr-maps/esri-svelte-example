const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-DVEy4f7w.js","./index-CjrYEQXz.js","./jsxFactory-CLjKarlq.js","./Accessor-BHnuXKD2.js","./intl-Do3GEEJ7.js","./Promise-CmQqe-ke.js","./cast-BA_-jlhc.js","./index-tefRSezt.js","./index-Cx51aysm.css","./JSONSupport-CGdeqxpk.js","./Evented-DCWccWGU.js","./reactiveUtils-BR0C1Kq4.js","./SimpleObservable-7oieNGD8.js","./uuid-Cl5lrJ4c.js","./guid-ejniuQmw.js","./useT9n-CJAswmP1.js","./index-73bQemcW.js","./dom--xxYYVQF.js","./observers-BdozwIHb.js","./keyed-CdPY5MOf.js","./directive-helpers-C0aXnQdc.js","./ref-Ccn4I0kT.js","./interactive-B8siLByk.js","./loadable-DOQnSSjG.js","./component-CFGnHAqh.js","./index-TFxiSNpz.js","./index-DIp-v4qk.js","./floating-ui-BkLjHVN3.js","./debounce-DbkufipY.js","./openCloseComponent-dw_x67D_.js","./static-g4FJ4v8I.js","./FloatingArrow-D9X-HbKW.js","./useFocusTrap-ENcZoC4L.js","./focusTrapComponent-Br_3Mz8_.js","./key-CZcQa38B.js","./index-CCqZjfSZ.js","./array-BbE1dLa5.js","./index-BSRDeu3E.js","./ExpandToggle-UGfmSgey.js","./index-D1jScw4i.js","./index-cLdK6V3t.js","./index-DSiQ4rVy.js","./index-BtF7Kdcs.js","./form-B15gmg4q.js","./label-BLne9qNB.js","./index-1VSl9HgO.js","./index-DbjTV4Hc.js","./index-Ch_sYKt7.js","./index-svtat3zr.js","./index-Wn4pOF_U.js","./live-BIBBLA6F.js","./locale-CXx8I9ox.js","./Validation-O1TFEQW-.js","./input-DI9tZAPS.js","./filter-Cs9GmjDF.js","./escapeRegExp-UP7ghjt8.js","./utils-CYuC4O71.js","./index-d5Yy4krW.js","./index-Df8-0rWt.js","./dynamicClasses-pKEMtFzB.js","./index-DIB7yhJF.js","./resources6-Cs2_VmEC.js","./index-BfAp5_ga.js","./customElement-kBYuBfHB.js","./resources5-SciNIBSe.js","./index-BfIped4_.js"])))=>i.map(i=>d[i]);
import{_ as p}from"./index-tefRSezt.js";import{r as s,m as n,a as T,av as x,g as U,B as N,j,b1 as q}from"./Accessor-BHnuXKD2.js";import{l as b}from"./intl-Do3GEEJ7.js";import{V as K,d as _,p as G}from"./reactiveUtils-BR0C1Kq4.js";import{e as J}from"./throttle-jjSnxk80.js";import{n as Q}from"./geometryUtils-3VSSujWc.js";import{e as X,n as Y}from"./actionUtils-DSzWsgMf.js";import{n as ee,j as te,t as ie}from"./Feature-B-8YZl_M.js";import{h as oe}from"./Spinner-BaW8zyoW.js";import{e as A,O as L,c as B,n as a,i as se,T as ne}from"./jsxFactory-CLjKarlq.js";import{n as h,D as R,f as le}from"./FeaturesViewModel-DowTkE6M.js";import{n as re,i as V}from"./actions-Bp0YlyZO.js";import{s as f}from"./substitute-D1XJWgT5.js";import{e as C}from"./globalCss-CZa70j6i.js";import{e as ae}from"./Heading-DYbI16WN.js";import{e as de}from"./vmEvent-D4Ubqkbq.js";const w=re.clone();let M=class extends L{constructor(e,i){super(e,i),this.messages=null,this.closed=!1,this.closable=!0,this._handleOpenFeature=t=>{this.emit("open-feature",{feature:t})},this._handleZoomToFeature=t=>{this.emit("zoom-to-feature",{featureWidget:t})}}loadDependencies(){return B({action:()=>p(()=>import("./index-DVEy4f7w.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]),import.meta.url),"action-bar":()=>p(()=>import("./index-TFxiSNpz.js"),__vite__mapDeps([25,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,35,36,37,38]),import.meta.url),"action-group":()=>p(()=>import("./index-BSRDeu3E.js").then(e=>e.i),__vite__mapDeps([37,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,35,36]),import.meta.url),"flow-item":()=>p(()=>import("./index-D1jScw4i.js"),__vite__mapDeps([39,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,35,36,40,41]),import.meta.url)})}render(){const{flowItems:e}=this,i=e==null?void 0:e.toArray();return a(se,null,i==null?void 0:i.map((t,o)=>this._renderFlowItem(t,o===e.length-1)))}_handleCloseClick(){this.emit("close")}_handleExitClick(){this.emit("exit")}_handleDrillInBackClick(){const{flowItems:e}=this,i=e==null?void 0:e.pop();i&&("activeCategory"in i.viewModel?(i.viewModel.activeCategory=null,e.length||(i.viewModel.showAllEnabled=!1)):"showAllEnabled"in i.viewModel&&(i.viewModel.showAllEnabled=!1),i&&(i.viewModel=null,i.destroy()))}_getExitMessage(e){switch(e.flowType){case"feature":case"feature-association":return"";case"feature-relationship":return this.messages.exitRelatedRecords;case"feature-utility-network-associations":case"feature-utility-network-association-type":return this.messages.exitAssociations}}_renderFlowItem(e,i){const{messages:t,closable:o,closed:r}=this,c="graphic"in e&&!e.isTable,d=e.flowType==="feature-association",u=this._getExitMessage(e),m=t.selectFeature;return a("calcite-flow-item",{bind:this,closable:o,closed:r,description:x(this._getDrillInFlowItemDescription(e)??""),heading:x(e.title??""),key:`flow-item-${e.viewModel.uid}`,selected:i,onCalciteFlowItemBack:g=>{g.preventDefault(),this._handleDrillInBackClick()},onCalciteFlowItemClose:this._handleCloseClick},a("calcite-action",{appearance:"transparent",bind:this,class:h.actionExit,icon:"move-up",key:"exit-action",onclick:this._handleExitClick,slot:"header-actions-start",text:u,title:u}),c?a("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-feature-action",onclick:()=>this._handleOpenFeature(e),slot:"header-actions-end",text:m,title:m}):null,d?a("calcite-action-bar",{expandDisabled:!0,expanded:!0,key:"header-action-bar",scale:"s",slot:"action-bar"},a("calcite-action-group",{overlayPositioning:"fixed",scale:"s"},this._renderDefaultActions(e))):null,a("div",{class:h.container},e.render()))}_renderDefaultActions(e){const i=this._getActionTitle(w);return a("calcite-action",{active:w.active,appearance:"solid",bind:this,"data-action-uid":w.uid,disabled:w.disabled,icon:w.icon??"question",indicator:w.indicator,key:`action-${w.uid}`,loading:w.active,onclick:()=>this._handleZoomToFeature(e),scale:"s",text:i,textEnabled:!0,title:i})}_getActionTitle(e){const{messages:i}=this,{id:t}=e,o=e.title??"";return t==="zoom-to-feature"?f(o,{messages:i}):o}_getDrillInFlowItemDescription(e){switch(e.flowType){case"feature":case"feature-association":case"feature-utility-network-associations":return e.viewModel.description??"";case"feature-relationship":return e.allItemsDescription;case"feature-utility-network-association-type":return e.description??""}}};s([n()],M.prototype,"flowItems",void 0),s([n(),A("esri/widgets/Features/t9n/Features")],M.prototype,"messages",void 0),s([n()],M.prototype,"closed",void 0),s([n()],M.prototype,"closable",void 0),M=s([T("esri.widgets.Features.FeaturesDrillIn")],M);const ce=M;let v=class extends U{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!1,this.featureMenuHeading=!0,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.flow=!0,this.heading=!0,this.spinner=!0}};s([n({type:Boolean,nonNullable:!0})],v.prototype,"actionBar",void 0),s([n({type:Boolean,nonNullable:!0})],v.prototype,"closeButton",void 0),s([n({type:Boolean,nonNullable:!0})],v.prototype,"collapseButton",void 0),s([n({type:Boolean,nonNullable:!0})],v.prototype,"featureMenuHeading",void 0),s([n({type:Boolean,nonNullable:!0})],v.prototype,"featureNavigation",void 0),s([n({type:Boolean,nonNullable:!0})],v.prototype,"featureListLayerTitle",void 0),s([n({type:Boolean,nonNullable:!0})],v.prototype,"flow",void 0),s([n({type:Boolean,nonNullable:!0})],v.prototype,"heading",void 0),s([n({type:Boolean,nonNullable:!0})],v.prototype,"spinner",void 0),v=s([T("esri.widgets.Features.FeaturesVisibleElements")],v);const W=v,k="selected-index",ue=0,D="features-spinner";function O(e){return(e==null?void 0:e.declaredClass.startsWith("esri.layers."))??!1}let l=class extends ee(L){constructor(e,i){super(e,i),this._featureMenuIntersectionObserverCallback=([t])=>{t!=null&&t.isIntersecting&&this.viewModel.featurePage!=null&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._featureMenuIntersectionObserverNode=null,this._spinner=null,this._feature=null,this._focusAbortController=null,this._drillInFlowItems=new K,this._drillInWidget=new ce({flowItems:this._drillInFlowItems}),this._rootNode=null,this._rootFlowItemNode=null,this._featureMenuViewportNode=null,this._actionBarMenuNode=null,this.collapsed=!1,this.featureNavigationTop=!1,this.headerActions=new V,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new R,this.visibleElements=new W,this._renderAction=(t,o)=>{const r=this._getActionTitle(t),{type:c,active:d,uid:u,disabled:m,indicator:g}=t;return t.visible?a("calcite-action",{active:c==="toggle"&&t.value,appearance:"solid",bind:this,"data-action-id":t.id,"data-action-uid":u,disabled:m,icon:this._getActionIcon(t),indicator:g,key:`action-${o}`,loading:d,onclick:this._triggerAction,scale:"s",text:r,textEnabled:!this._hideActionText,title:this._hideActionText?r:void 0},this._getFallbackIcon(t)):null},this._openFeatureMenu=()=>{this.featureMenuOpen=!0,this._focusFlowItemNode()},this._closeFeatureMenu=()=>{this.featureMenuOpen=!1,this._focusFlowItemNode()},this._previousFeature=()=>{this.viewModel.previous()},this._nextFeature=()=>{this.viewModel.next()},this._handleFeatureBack=()=>{this.initialDisplayMode==="list"?(this.selectedFeatureIndex=-1,this._focusFlowItemNode()):this._openFeatureMenu()},this._handleFeatureMenuBack=()=>{this.initialDisplayMode==="list"?(this.selectedFeatureIndex=-1,this._focusFlowItemNode()):this.featureMenuOpen&&this._closeFeatureMenu()},this._storeRootNode=t=>{this._rootNode=t},this._displaySpinnerThrottled=J(()=>this._displaySpinner(),ue),this._addSelectedFeatureIndexHandle(),this.addHandles([this._displaySpinnerThrottled,_(()=>{var t;return(t=this.viewModel)==null?void 0:t.active},()=>this._toggleScreenLocationEnabled()),_(()=>{var t;return(t=this.viewModel)==null?void 0:t.active},t=>this._drillInWidget.closed=!t),_(()=>{var t;return(t=this.visibleElements)==null?void 0:t.closeButton},t=>this._drillInWidget.closable=t),_(()=>{var t;return(t=this.visibleElements)==null?void 0:t.spinner},t=>this._spinnerEnabledChange(t)),_(()=>{var t;return(t=this.viewModel)==null?void 0:t.view},(t,o)=>this._viewChange(t,o)),_(()=>{var t,o;return(o=(t=this.viewModel)==null?void 0:t.view)==null?void 0:o.ready},(t,o)=>this._viewReadyChange(t??!1,o??!1)),_(()=>{var t,o;return[(t=this.viewModel)==null?void 0:t.waitingForResult,(o=this.viewModel)==null?void 0:o.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),_(()=>{var t;return(t=this.viewModel)==null?void 0:t.screenLocation},()=>this._closeOpenActionMenu()),_(()=>this.selectedFeatureWidget,()=>this._destroyDrillInFlowItemWidgets()),_(()=>{var o;const t=(o=this.selectedFeatureWidget)==null?void 0:o.viewModel;return[t==null?void 0:t.title,t==null?void 0:t.state]},()=>this._setTitleFromFeatureWidget()),_(()=>{var o;const t=(o=this.selectedFeatureWidget)==null?void 0:o.viewModel;return[t==null?void 0:t.content,t==null?void 0:t.state]},()=>this._setContentFromFeatureWidget()),_(()=>{var t;return(t=this.viewModel)==null?void 0:t.featureViewModels},()=>this._featureMenuViewportScrollTop()),_(()=>this._drillInFlowItems.length,()=>this._focusFlowItemNode()),this._drillInWidget.on("close",()=>this.close()),this._drillInWidget.on("exit",()=>this._destroyDrillInFlowItemWidgets()),this._drillInWidget.on("open-feature",({feature:t})=>this._openRelatedFeature(t)),this._drillInWidget.on("zoom-to-feature",({featureWidget:t})=>le(this.viewModel,t))])}loadDependencies(){return B({action:()=>p(()=>import("./index-DVEy4f7w.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]),import.meta.url),"action-bar":()=>p(()=>import("./index-TFxiSNpz.js"),__vite__mapDeps([25,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,35,36,37,38]),import.meta.url),"action-group":()=>p(()=>import("./index-BSRDeu3E.js").then(e=>e.i),__vite__mapDeps([37,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,35,36]),import.meta.url),button:()=>p(()=>import("./index-BtF7Kdcs.js"),__vite__mapDeps([42,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,21,20,30,43,22,44,23,24]),import.meta.url),icon:()=>p(()=>import("./index-73bQemcW.js").then(e=>e.i),__vite__mapDeps([16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18]),import.meta.url),flow:()=>p(()=>import("./index-1VSl9HgO.js"),__vite__mapDeps([45,2,3,4,5,6,7,8,9,10,11,12,13,21,20,18,23,17,14]),import.meta.url),"flow-item":()=>p(()=>import("./index-D1jScw4i.js"),__vite__mapDeps([39,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,35,36,40,41]),import.meta.url),list:()=>p(()=>import("./index-DbjTV4Hc.js"),__vite__mapDeps([46,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,40,21,20,18,17,19,16,47,48,49,50,30,43,22,34,44,23,51,24,52,53,54,55,28,56]),import.meta.url),"list-item":()=>p(()=>import("./index-d5Yy4krW.js"),__vite__mapDeps([57,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,58,21,20,27,28,22,34,23,29,59,1,15,0,19,24,60,61,62,63,56,64]),import.meta.url),"list-item-group":()=>p(()=>import("./index-BfIped4_.js"),__vite__mapDeps([65,2,3,4,5,6,7,8,9,10,11,12,13,22,64]),import.meta.url),loader:()=>p(()=>import("./index-CjrYEQXz.js"),__vite__mapDeps([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]),import.meta.url)})}destroy(){var e,i,t;this._destroyDrillInFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._unobserveFeatureMenuObserver(),(e=this._featureMenuIntersectionObserver)==null||e.disconnect(),(i=this._drillInWidget)==null||i.destroy(),(t=this._focusAbortController)==null||t.abort()}get _hideActionText(){var i;if(!this.responsiveActionsEnabled)return!1;const e=(i=this.view)==null?void 0:i.widthBreakpoint;return e==="xsmall"||e==="small"||e==="medium"}get _featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&!!this.viewModel.selectedFeature&&this.visibleElements.featureNavigation}get _isCollapsed(){return this._collapseEnabled&&this.collapsed}get _collapseEnabled(){return this.visibleElements.collapseButton&&(this.initialDisplayMode==="list"||!!this.title&&!!this.content)}get active(){return this.viewModel.active}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get icon(){return null}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(e){this.viewModel.featureMenuOpen=e}get featureMenuTitle(){return this.viewModel.featureMenuTitle}set featureMenuTitle(e){this.viewModel.featureMenuTitle=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get initialDisplayMode(){return this.viewModel.initialDisplayMode}set initialDisplayMode(e){this.viewModel.initialDisplayMode=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedDrillInFeature(){const e=Array.from(this._drillInFlowItems).at(-1);if(!e)return null;const{flowType:i}=e;return i==="feature-association"||i==="feature-relationship"?e.graphic??null:null}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){const{_feature:e,headingLevel:i,_drillInFlowItems:t,timeZone:o,spatialReference:r,map:c}=this,{selectedFeatureViewModel:d}=this.viewModel,u={title:!1};return d?(e?(e.viewModel=d,e.visibleElements=u):this._feature=new te({flowItems:t,headingLevel:i+1,timeZone:o,spatialReference:r,map:c,viewModel:d,visibleElements:u}),this._feature):null}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}blur(){var i;const{active:e}=this.viewModel;e?(i=this._rootFlowItemNode)==null||i.blur():N.getLogger(this).warn("Features can only be blurred when currently active.")}clear(){return this.viewModel.clear()}close(){this.viewModel.visible=!1}fetchFeatures(e,i){return this.viewModel.fetchFeatures(e,i)}focus(){const{active:e}=this.viewModel;e?this._focusFlowItemNode():N.getLogger(this).warn("Features can only be focused when currently active.")}next(){return this.viewModel.next()}open(e){this.removeHandles(k);const i={collapsed:(e==null?void 0:e.collapsed)??!1};this.set(i),this.viewModel.open(e),this.addHandles(G(()=>!this.viewModel.waitingForResult,()=>this._addSelectedFeatureIndexHandle(),{once:!0}))}previous(){return this.viewModel.previous()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){return a("div",{afterCreate:this._storeRootNode,bind:this,class:this.classes(h.base,C.widget,C.panel),onkeydown:this._onMainKeydown},this._renderHeader(),this._renderContentContainer())}_renderFeatureNavigation(){return[this._renderPagination(),this.initialDisplayMode==="list"?this._renderFeaturePaginationText():this._renderFeatureMenuButton()]}_renderHeader(){return this.featureNavigationTop&&this._featureNavigationVisible?a("div",{class:h.header,key:"header-actions"},this._renderFeatureNavigation()):null}_renderFooter(){return!this.featureNavigationTop&&this._featureNavigationVisible?a("div",{class:h.footer,key:"footer-actions",slot:"footer"},this._renderFeatureNavigation()):null}_renderFeaturePaginationText(){const{messages:e,viewModel:i}=this,{featureCount:t,selectedFeatureIndex:o}=i;return a("div",{class:h.paginationText,key:"feature-pagination-text"},f(e.pageText,{index:b(o+1),total:b(t)}))}_renderFeatureMenuButton(){const{messages:e,viewModel:i}=this,{featureCount:t,selectedFeatureIndex:o,pendingPromisesCount:r}=i;return a("calcite-action",{appearance:"solid",bind:this,class:h.paginationMenuButton,icon:"list",key:"feature-menu-button",label:e.selectFeature,loading:r>0,onclick:this._openFeatureMenu,scale:"s",text:f(e.pageText,{index:b(o+1),total:b(t)}),textEnabled:!0,title:e.selectFeature})}_renderPagination(){const{previous:e,next:i}=this.messagesCommon.pagination;return a("calcite-action-bar",{class:h.paginationActionBar,expandDisabled:!0,key:"pagination-action-bar",layout:"horizontal",overflowActionsDisabled:!0,scale:"s"},a("calcite-action-group",{scale:"s"},a("calcite-action",{appearance:"solid",class:h.paginationPrevious,icon:"chevron-left",iconFlipRtl:!0,label:e,onclick:this._previousFeature,scale:"s",text:e,title:e}),a("calcite-action",{appearance:"solid",icon:"chevron-right",iconFlipRtl:!0,label:i,onclick:this._nextFeature,scale:"s",text:i,title:i})))}_renderFeatureMenuItem(e){const{initialDisplayMode:i}=this,{selectedFeatureViewModel:t,featureViewModels:o}=this.viewModel,r=e===t,c=o.indexOf(e);return a("calcite-list-item",{bind:this,"data-feature-index":c,key:`feature-menu-item-${e.uid}`,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onmouseleave:this._removeActiveFeature,onmouseover:this._setActiveFeature,selected:r,onCalciteListItemSelect:this._selectFeature},a("span",{innerHTML:e.title||this.messagesCommon.untitled,slot:"content"}),i==="list"?a("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}):null)}_groupResultsByLayer(){const{featureViewModels:e}=this.viewModel,i=new Map;return e.forEach(t=>{const o=t==null?void 0:t.graphic;if(!o)return;const{layer:r,sourceLayer:c}=o,d=(O(r)?r:null)||(O(c)?c:null),u=i.get(d)??[];i.set(d,[...u,t])}),i}_renderFeatureMenu(){const{messages:e,viewModel:i}=this,t=this._groupResultsByLayer(),o=this.initialDisplayMode==="list"?"none":"single";return i.featureViewModels.length?a("calcite-list",{displayMode:"flat",label:e==null?void 0:e.featuresList,selectionAppearance:"icon",selectionMode:o},Array.from(t.keys(),r=>{var u;const c=(u=t.get(r))==null?void 0:u.map(m=>this._renderFeatureMenuItem(m)),d=r?r.title??this.messagesCommon.untitled:null;return this.visibleElements.featureListLayerTitle&&d!==null?a("calcite-list-item-group",{heading:d,key:(r==null?void 0:r.uid)||"map-graphics"},c):c})):null}_renderHeaderAction(e,i){const t=e.title||"";return e.visible?a("calcite-action",{active:e.type==="toggle"&&e.value,appearance:"solid",bind:this,"data-action-id":e.id,"data-action-uid":e.uid,disabled:e.disabled,icon:e.icon??void 0,indicator:e.indicator,key:`header-action-${i}`,loading:e.active,onclick:this._triggerHeaderAction,slot:"header-actions-end",text:t,title:t}):null}_renderHeaderActions(){return this.headerActions.map((e,i)=>this._renderHeaderAction(e,i)).toArray()}_renderContentFeature(){const{headingLevel:e,visibleElements:i,_isCollapsed:t,_collapseEnabled:o,featureNavigationTop:r,_drillInFlowItems:c,initialDisplayMode:d,selectedFeature:u,featureMenuOpen:m}=this,{title:g,active:y}=this.viewModel,F=i.heading&&g?g:"";if(d==="list"&&!u)return null;const I=c.length===0&&(d==="list"?!!u:!m);return a("calcite-flow-item",{afterCreate:this._storeRootFlowItemNode,bind:this,class:this.classes({[h.contentFeature]:!0,[h.flowItemCollapsed]:t}),closable:i.closeButton,closed:!y,collapsed:t,collapseDirection:r?"down":"up",collapsible:o,headingLevel:e,key:"root-flow-item",selected:I,onCalciteFlowItemBack:this._handleFeatureBack,onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},F?a(ae,{class:this.classes(h.featuresHeading,C.heading),innerHTML:F,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),a("div",{class:this.classes(h.container,h.contentContainer)},this._renderContent()),this._renderFooter())}_renderFeatureMenuContainer(){const{viewModel:e,visibleElements:i,featureMenuTitle:t,messages:o,messagesCommon:r,_drillInFlowItems:c,initialDisplayMode:d,featureMenuOpen:u,selectedFeature:m,_collapseEnabled:g,_isCollapsed:y,featureNavigationTop:F,headingLevel:I}=this,{active:$,featureViewModels:P,pendingPromisesCount:S}=e,{featureMenuHeading:E}=i,H=t??o.selectFeature;if(d==="feature"&&!u)return null;const Z=c.length===0&&(d==="list"?!m:u);return a("calcite-flow-item",{afterCreate:this._storeFeatureMenuFlowItemNode,bind:this,class:this.classes({[h.flowItemCollapsed]:y}),closable:d==="list"&&i.closeButton,closed:!$,collapsed:d==="list"&&y,collapseDirection:F?"down":"up",collapsible:d==="list"&&g,description:E?f(o.total,{total:P.length}):void 0,heading:E?H:void 0,headingLevel:I,key:"feature-menu",loading:e.waitingForContents,selected:Z,onCalciteFlowItemBack:z=>{z.preventDefault(),this._handleFeatureMenuBack()},onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},d==="list"?this._renderHeaderActions():null,S>0?a("calcite-loader",{class:h.loader,inline:!0,key:"feature-menu-loader",label:r.loading,slot:"header-actions-end"}):null,a("div",{class:h.container},this._renderFeatureMenu()),a("div",{afterCreate:this._featureMenuIntersectionObserverCreated,bind:this,class:h.featureMenuObserver}),d==="feature"?a("calcite-button",{appearance:"transparent",onclick:this._handleFeatureMenuBack,slot:"footer-actions",width:"full"},r.back):null)}_renderContentContainer(){const e=this.initialDisplayMode==="list"?[this._renderFeatureMenuContainer(),this._renderContentFeature(),this._drillInWidget.render()]:[this._renderContentFeature(),this._renderFeatureMenuContainer(),this._drillInWidget.render()];return this.visibleElements.flow?a("calcite-flow",{key:"content-container"},e):e}_getFallbackIcon(e){const{className:i,icon:t}=e;if(t)return null;const o=X({action:e,feature:this.selectedFeature}),r={[h.icon]:!!i,[h.actionImage]:!!o};return i&&(r[i]=!0),o||i?a("span",{"aria-hidden":"true",class:this.classes(h.icon,r),key:"icon",styles:Y(o)}):null}_renderActionBar(){var e;return!this._isCollapsed&&this.visibleElements.actionBar&&((e=this.viewModel.allActions)!=null&&e.length)?a("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},a("calcite-action-group",{afterCreate:i=>this._actionBarMenuNode=i,overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(this._renderAction)}_renderContent(){var i;const e=(i=this.viewModel)==null?void 0:i.content;return e?typeof e=="string"?a("div",{class:ie.contentNode,innerHTML:e,key:e}):this.renderNodeContent(e):null}_handleCollapseToggle(){this.collapsed=!this.collapsed}async _openRelatedFeature(e){await e.viewModel.updateGeometry();const i=e.graphic,t=i==null?void 0:i.geometry;if(t==null||i==null)return;this._destroyDrillInFlowItemWidgets(),await this.viewModel.zoomTo({target:t});const o=Q(t);this.open({features:[i],location:o??void 0}),this._focusFlowItemNode()}async _focusFlowItemNode(){var t,o;(t=this._focusAbortController)==null||t.abort(),this._focusAbortController=new AbortController;const e=this._focusAbortController.signal;await j(q(e));const i=(o=this._rootNode)==null?void 0:o.querySelector("calcite-flow-item[selected]");ne(i)}_storeRootFlowItemNode(e){this._rootFlowItemNode=e}_storeFeatureMenuFlowItemNode(e){this._featureMenuViewportNode=e}_setActiveFeature(e){var o;const{viewModel:i}=this,t=e.currentTarget["data-feature-index"];i.activeFeature=((o=i.features)==null?void 0:o[t])||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_selectFeature(e){const i=e.currentTarget["data-feature-index"];isNaN(i)||(this.viewModel.selectedFeatureIndex=i),this.initialDisplayMode==="feature"?this._handleFeatureMenuBack():this._focusFlowItemNode()}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_getActionIcon(e){return e.icon?e.icon:e.image||e.className?void 0:"question"}_getActionTitle(e){const{messages:i,selectedFeature:t,messagesCommon:o}=this,{id:r}=e,c=t==null?void 0:t.attributes,d=e.title??"",u=r==="zoom-to-feature"?f(d,{messages:i}):r==="remove-selected-feature"?f(d,{messages:o}):r==="zoom-to-clustered-features"||r==="browse-clustered-features"?f(d,{messages:i}):e.title;return u&&c?f(u,c):u??""}_onMainKeydown(e){const{key:i}=e;i==="ArrowLeft"&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.previous()),i==="ArrowRight"&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.next())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:e,messagesCommon:i}=this,t=e==null?void 0:e.viewModel;e&&(this.viewModel.title=(t==null?void 0:t.state)==="error"?i==null?void 0:i.errorMessage:(t==null?void 0:t.title)||"")}_addSelectedFeatureIndexHandle(){const e=_(()=>{var i;return(i=this.viewModel)==null?void 0:i.selectedFeatureIndex},(i,t)=>this._selectedFeatureIndexUpdated(i,t));this.addHandles(e,k)}_selectedFeatureIndexUpdated(e,i){const{featureCount:t}=this.viewModel;t&&e!==i&&e!==-1&&(this._destroyDrillInFlowItemWidgets(),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_triggerHeaderAction(e){const i=e.currentTarget;if(i.disabled)return;const t=i.dataset.actionUid,o=this.headerActions.find(({uid:r})=>r===t);o&&!o.disabled&&((o==null?void 0:o.type)==="toggle"&&(o.value=!o.value),this.emit("trigger-header-action",{action:o}))}_triggerAction(e){const i=e.currentTarget;if(i.disabled)return;const t=i.dataset.actionUid,{allActions:o}=this.viewModel,r=o.findIndex(d=>d.uid===t),c=o.at(r);c&&c.type==="toggle"&&(c.value=!c.value),this.viewModel.triggerAction(r)}_createSpinner(e){e&&(this._spinner=new oe({view:e}),e.ui.add(this._spinner,{key:D,position:"manual",internal:!0}))}_wireUpView(e){var i;this._destroySpinner(),e&&((i=this.visibleElements)!=null&&i.spinner)&&this._createSpinner(e)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_viewReadyChange(e,i){var t;e?this._wireUpView((t=this.viewModel)==null?void 0:t.view):i&&this.viewModel.clear()}_viewChange(e,i){e&&i&&this.viewModel.clear()}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,!e.destroyed&&e.destroy()),this._feature=null}_closeOpenActionMenu(){const{_actionBarMenuNode:e}=this;e&&(e.menuOpen=!1)}_destroyDrillInFlowItemWidgets(){this._drillInFlowItems.drain(e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),"activeCategory"in e.viewModel&&(e.viewModel.activeCategory=null),e.viewModel=null,e.destroy()})}_toggleScreenLocationEnabled(){const{viewModel:e}=this;e&&(e.screenLocationEnabled=e.active)}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:i,waitingForResult:t}=this.viewModel;t&&i?e.show({location:i}):e.hide()}_destroySpinner(){var i,t;const{_spinner:e}=this;e&&((t=(i=e.view)==null?void 0:i.ui)==null||t.remove(e,D),e.destroy(),this._spinner=null)}_spinnerEnabledChange(e){var i;this._destroySpinner(),e&&this._createSpinner((i=this.viewModel)==null?void 0:i.view)}};s([n()],l.prototype,"_drillInFlowItems",void 0),s([n()],l.prototype,"_hideActionText",null),s([n()],l.prototype,"_featureNavigationVisible",null),s([n()],l.prototype,"_isCollapsed",null),s([n()],l.prototype,"_collapseEnabled",null),s([n({readOnly:!0})],l.prototype,"active",null),s([n()],l.prototype,"collapsed",void 0),s([n()],l.prototype,"content",null),s([n()],l.prototype,"icon",null),s([n()],l.prototype,"featureMenuOpen",null),s([n()],l.prototype,"featureMenuTitle",null),s([n()],l.prototype,"featureNavigationTop",void 0),s([n()],l.prototype,"features",null),s([n()],l.prototype,"goToOverride",null),s([n({type:V})],l.prototype,"headerActions",void 0),s([n()],l.prototype,"headingLevel",void 0),s([n()],l.prototype,"initialDisplayMode",null),s([n()],l.prototype,"location",null),s([n()],l.prototype,"label",null),s([n()],l.prototype,"map",null),s([n(),A("esri/widgets/Features/t9n/Features")],l.prototype,"messages",void 0),s([n(),A("esri/t9n/common")],l.prototype,"messagesCommon",void 0),s([n()],l.prototype,"promises",null),s([n()],l.prototype,"responsiveActionsEnabled",void 0),s([n({readOnly:!0})],l.prototype,"selectedFeature",null),s([n({readOnly:!0})],l.prototype,"selectedDrillInFeature",null),s([n()],l.prototype,"selectedFeatureIndex",null),s([n({readOnly:!0})],l.prototype,"selectedFeatureWidget",null),s([n()],l.prototype,"spatialReference",null),s([n()],l.prototype,"title",null),s([n()],l.prototype,"timeZone",null),s([n()],l.prototype,"updateLocationEnabled",null),s([n()],l.prototype,"view",null),s([n({type:R}),de(["triggerAction","trigger-action"])],l.prototype,"viewModel",void 0),s([n({type:W,nonNullable:!0})],l.prototype,"visibleElements",void 0),s([n()],l.prototype,"visible",null),l=s([T("esri.widgets.Features")],l);const Ee=l;export{Ee as B};
