import{e as n}from"./Evented-CXIxDjmW.js";import{y as r,b as M}from"./subclass-BR3PhgZG.js";import{e as D,B as E,n as u}from"./jsxFactory-CbAu6VfF.js";import{e as f}from"./globalCss-CZa70j6i.js";import{i as L}from"./legacyIcon-CtsJ0OTG.js";import{S as x}from"./Accessor-D6mNnsWy.js";import{V as m,d as A,P as z,v as C}from"./reactiveUtils-BFQ0BtrB.js";import{p as _}from"./ClipRect-DgcoGaf3.js";import"./intl-Dpfm8vPB.js";import"./Promise-CZrWwByK.js";import"./jsonMap-DCC6W5ex.js";import"./assets-C2mb-ea2.js";import"./index-CeCSsEgo.js";import"./uuid-fwrPAdZb.js";import"./shared-B3wH2qpO.js";function H(i,e){const t=10**e;return Math.round(i*t)/t}const w={left:0,right:0,top:0,bottom:0};let h=class extends x{constructor(e){super(e),this._leadingClips=new Map,this._trailingClips=new Map,this.direction="horizontal",this.leadingLayers=new m,this.max=100,this.min=0,this.precision=4,this.step=.5,this.stepMultiplier=10,this.trailingLayers=new m,this.view=null}initialize(){this.addHandles([A(()=>{var e;return[this.view,(e=this.view)==null?void 0:e.ready,this.position,this.direction]},()=>this._clipLayers(),z),C(()=>this.leadingLayers,"change",()=>this._clipLeadingLayers()),C(()=>this.trailingLayers,"change",()=>this._clipTrailingLayers())])}destroy(){this._removeExistingClips()}get position(){return 25}set position(e){const{precision:t,min:o,max:l}=this;this._set("position",H(Math.max(Math.min(e,l),o),t))}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}_clipLayers(){this._clipLeadingLayers(),this._clipTrailingLayers()}_clipLeadingLayers(){this._removeClips("leading");const{leadingLayers:e}=this;e.forEach(t=>this._clipLayer({layer:t,type:"leading"}))}_clipTrailingLayers(){this._removeClips("trailing");const{trailingLayers:e}=this;e.forEach(t=>this._clipLayer({layer:t,type:"trailing"}))}async _getLayerView(e){const{view:t}=this;if(!e||!t)return null;const o=await t.whenLayerView(e);return"clips"in o?o:null}_getVerticalClipRect(e){const{position:t}=this;return e==="leading"?new _({...w,bottom:100-t+"%"}):e==="trailing"?new _({...w,top:`${t}%`}):null}_getHorizontalClipRect(e){const{position:t}=this;return e==="leading"?new _({...w,right:100-t+"%"}):e==="trailing"?new _({...w,left:`${t}%`}):null}_getClipRect(e){const{direction:t}=this;return t==="vertical"?this._getVerticalClipRect(e):t==="horizontal"?this._getHorizontalClipRect(e):null}async _clipLayer(e){const{_leadingClips:t,_trailingClips:o}=this,{layer:l,type:a}=e,d=a==="trailing"?o:a==="leading"?t:null,s=await this._getLayerView(l);if(!(s&&"clips"in s&&d&&s.hasOwnProperty("clips")))return;const c=d.get(s);c&&s.clips.remove(c);const y=this._getClipRect(a);y&&(d.set(s,y),s.clips.add(y))}_removeClips(e){const{_leadingClips:t,_trailingClips:o}=this,l=e==="trailing"?o:e==="leading"?t:null;l&&(l.forEach((a,d)=>{d&&d.hasOwnProperty("clips")&&d.clips.remove(a)}),l.clear())}_removeExistingClips(){this._removeClips("leading"),this._removeClips("trailing")}};n([r()],h.prototype,"direction",void 0),n([r({type:m,nonNullable:!0})],h.prototype,"leadingLayers",void 0),n([r({readOnly:!0})],h.prototype,"max",void 0),n([r({readOnly:!0})],h.prototype,"min",void 0),n([r()],h.prototype,"position",null),n([r()],h.prototype,"precision",void 0),n([r({readOnly:!0})],h.prototype,"state",null),n([r()],h.prototype,"step",void 0),n([r()],h.prototype,"stepMultiplier",void 0),n([r({type:m,nonNullable:!0})],h.prototype,"trailingLayers",void 0),n([r()],h.prototype,"view",void 0),h=n([M("esri.widgets.Swipe.SwipeViewModel")],h);const P=h,g="esri-swipe",v={base:g,baseDisabled:`${g}--disabled`,vertical:`${g}--vertical`,horizontal:`${g}--horizontal`,container:`${g}__container`,divider:`${g}__divider`,handle:`${g}__handle`,handleHidden:`${g}__handle--hidden`,handleIcon:`${g}__handle-icon`},b={handle:!0,divider:!0};let p=class extends E{constructor(i,e){super(i,e),this.disabled=!1,this.messages=null,this.viewModel=new P,this._pointerOffset=0,this._container=null,this._onContainerPointerDown=this._onContainerPointerDown.bind(this),this._onContainerPointerMove=this._onContainerPointerMove.bind(this),this._onContainerPointerUp=this._onContainerPointerUp.bind(this)}get direction(){return this.viewModel.direction}set direction(i){this.viewModel.direction=i}get dragLabel(){var i;return((i=this.messages)==null?void 0:i.dragLabel)??""}set dragLabel(i){this._overrideIfSome("dragLabel",i)}get icon(){return"compare"}set icon(i){this._overrideIfSome("icon",i)}get label(){var i;return((i=this.messages)==null?void 0:i.widgetLabel)??""}set label(i){this._overrideIfSome("label",i)}get leadingLayers(){return this.viewModel.leadingLayers}set leadingLayers(i){this.viewModel.leadingLayers=i}get position(){return this.viewModel.position}set position(i){this.viewModel.position=i}get trailingLayers(){return this.viewModel.trailingLayers}set trailingLayers(i){this.viewModel.trailingLayers=i}get view(){return this.viewModel.view}set view(i){this.viewModel.view=i}set visibleElements(i){this._set("visibleElements",{...b,...i})}get visibleElements(){return this._get("visibleElements")||b}render(){const{state:i,direction:e}=this.viewModel,t=i==="disabled"||this.disabled,o={[f.disabled]:t,[v.baseDisabled]:t,[v.vertical]:e==="vertical",[v.horizontal]:e==="horizontal"};return u("div",{class:this.classes(v.base,f.widget,o)},i==="disabled"?null:this._renderContainer())}_renderHandle(){const{direction:i}=this.viewModel,{visibleElements:e}=this,t={[L.dragHorizontal]:i==="vertical",[L.dragVertical]:i==="horizontal"},o=this.classes(v.handle,!e.handle&&v.handleHidden);return u("div",{class:o,key:"handle",role:"presentation"},u("span",{"aria-hidden":"true",class:this.classes(v.handleIcon,t)}))}_renderDivider(){const{visibleElements:i}=this;return i&&i.divider?u("div",{class:v.divider,key:"divider",role:"presentation"}):null}_renderContent(){return[this._renderDivider(),this._renderHandle()]}_renderContainer(){const{disabled:i,dragLabel:e,viewModel:t}=this,{max:o,min:l,direction:a,position:d}=t,s=`${d}%`,c={top:a==="vertical"?s:void 0,left:a==="vertical"?void 0:s},y=this._renderContent();return u("div",i?{class:v.container,key:"container",role:"presentation",styles:c}:{afterCreate:this._afterContainerCreate,"aria-label":e,"aria-orientation":a,"aria-valuemax":`${o}`,"aria-valuemin":`${l}`,"aria-valuenow":`${d}`,"aria-valuetext":s,bind:this,class:v.container,key:"container",onkeydown:this._onContainerKeyDown,role:"slider",styles:c,tabIndex:0,title:e,"touch-action":"none"},y)}_afterContainerCreate(i){this._container=i,i.addEventListener("pointerdown",this._onContainerPointerDown)}_calculatePointerOffset(i){const{direction:e}=this,t=i.target,o=(e==="vertical"?t.clientHeight:t.clientWidth)/2,l=t.getBoundingClientRect(),a=i.clientX-l.left,d=i.clientY-l.top;this._pointerOffset=e==="vertical"?d-o:a-o}_onContainerPointerDown(i){i.preventDefault(),this._container&&document.activeElement!==this.container&&this._container.focus(),this._calculatePointerOffset(i),document.addEventListener("pointerup",this._onContainerPointerUp),document.addEventListener("pointermove",this._onContainerPointerMove)}_onContainerPointerUp(i){i.preventDefault(),document.removeEventListener("pointerup",this._onContainerPointerUp),document.removeEventListener("pointermove",this._onContainerPointerMove)}_onContainerPointerMove(i){i.preventDefault();const{_pointerOffset:e,container:t,direction:o}=this,{clientX:l,clientY:a}=i,{top:d,left:s,width:c,height:y}=t.getBoundingClientRect(),$=(o==="vertical"?a-d-e:l-s-e)/(o==="vertical"?y:c)*100;this.position=$}_getKeyPosition(i){const{key:e}=i,{position:t}=this,{max:o,min:l,step:a,stepMultiplier:d,direction:s}=this.viewModel,c=a*d;return["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Home","End","PageUp","PageDown"].includes(e)&&(i.preventDefault(),i.stopPropagation()),(s==="vertical"?e==="ArrowDown"||e==="ArrowRight":e==="ArrowUp"||e==="ArrowRight")?t+(i.shiftKey?c:a):(s==="vertical"?e==="ArrowUp"||e==="ArrowLeft":e==="ArrowDown"||e==="ArrowLeft")?t-(i.shiftKey?c:a):e==="Home"?l:e==="End"?o:(s==="vertical"?e==="PageDown":e==="PageUp")?t+c:(s==="vertical"?e==="PageUp":e==="PageDown")?t-c:null}_onContainerKeyDown(i){const e=this._getKeyPosition(i);typeof e=="number"&&(this.position=e)}};n([r()],p.prototype,"direction",null),n([r()],p.prototype,"disabled",void 0),n([r()],p.prototype,"dragLabel",null),n([r()],p.prototype,"icon",null),n([r()],p.prototype,"label",null),n([r()],p.prototype,"leadingLayers",null),n([r(),D("esri/widgets/Swipe/t9n/Swipe")],p.prototype,"messages",void 0),n([r()],p.prototype,"position",null),n([r()],p.prototype,"trailingLayers",null),n([r()],p.prototype,"view",null),n([r({type:P})],p.prototype,"viewModel",void 0),n([r()],p.prototype,"visibleElements",null),p=n([M("esri.widgets.Swipe")],p);const F=p;export{F as default};
