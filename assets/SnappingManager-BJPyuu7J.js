const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SelfSnappingEngine-C3m3A2A3.js","./tslib.es6-B3Jf3DVX.js","./Accessor-BLX9ikPh.js","./subclass-BZA_h8Db.js","./Collection-CEdjem1-.js","./Evented-BHRw9x22.js","./shared-B3wH2qpO.js","./SimpleObservable-KocWTzVy.js","./Cyclical-oTUX3aX7.js","./mathUtils-C4_ghTv4.js","./quantityUtils-D0GB2dMc.js","./Point-Cg0-ChZE.js","./cast-Bjksrh93.js","./writer-DNAwXnhG.js","./assets-C43MgM-v.js","./index-Bh2oEzTI.js","./index-2kwcjS9-.css","./jsonMap-0cxwUWs2.js","./vec3f64-BLpZdpfb.js","./elevationInfoUtils-BC_66_Fg.js","./unitConversionUtils-BMfW9yAe.js","./lengthUtils-DL1-FDQQ.js","./vec2-maR1OrZI.js","./common-DQOJ18NT.js","./angularMeasurementUtils-7e2vxqzG.js","./vec2f64-miziP1SN.js","./vec32-Dvg_eL9J.js","./projectVectorToVector-G2uWGoIb.js","./Extent-Bf3YTe7m.js","./Polyline-D9YkgmM_.js","./projectBuffer-Bs7GwaPY.js","./geodesicConstants-DWQLYX7F.js","./projectPointToVector-GINIbYMz.js","./projection-B971H0Re.js","./geodesicUtils-FCYOaNwu.js","./geometry-D964gYQX.js","./geodesicLengthMeasurementUtils-he3vjGJN.js","./geometryEngine-DGiYLHJy.js","./geometryEngineBase-yFIvKOkM.js","./_commonjsHelpers-DCkdB7M8.js","./hydrated-C9rxSL4a.js","./geodesicMeasurementUtils-Bt9h4589.js","./geometry2dUtils-DdyQE7AQ.js","./asyncUtils-CWX51uTe.js","./reactiveUtils-C5zUhJQJ.js","./Color-BCS62Hs5.js","./colorUtils-0bJDPow9.js","./fieldUtils-tmQlKvWo.js","./intl-CChhNOV8.js","./date-DlqISzcw.js","./locale-C9TlLpzi.js","./messages-OmQvZhAg.js","./timeUtils-8fb_2oAt.js","./Query-5Xpquc1r.js","./enumeration-Ba5njXdz.js","./jsonUtils-CEfjT-BK.js","./DataLayerSource-BKkswDvG.js","./Field-ybkHhtnK.js","./fieldType-BuzM0UHS.js","./FullTextSearch-Csd1Hktu.js","./Clonable-D3rtuBWg.js","./TimeExtent-DocT5yPf.js","./InputManager-Ba9xzDpe.js","./Queue-yu3bZ02p.js","./signal-D4lghLjV.js","./keybindings-DoOdil3D.js","./utils-BpB3MnW1.js","./Version-BSlAgupz.js","./vec42-YcqnINSP.js","./vec4f64-o2zAXfmz.js","./plane-IENfwZlB.js","./mat3f64-BBpwCtoL.js","./mat4f64-Dk4dwAN8.js","./quatf64-CCm9z-pX.js","./mathUtils-BG-eq9fO.js","./sphere-C77djCO6.js","./mat4-GpOFENPA.js","./mat3-BRl2i9Bz.js","./screenUtils-_ZIvrt5o.js","./viewUtils-DrPohWV3.js","./GridSnappingEngine-BoqBC54D.js","./normalizeUtils-EVmAQ-ak.js","./normalizeUtilsCommon-dT81xWiM.js","./utils-6jMaHUrH.js","./utils-Bema0iXE.js","./scaleUtils-D_Nw3nhM.js","./gridUtils-BX6Ojh6T.js","./FeatureSnappingEngine-DPQqxb42.js","./UpdatingHandles-GfwcIh5z.js","./FeatureFilter-BMHRQSxq.js","./floorFilterUtils-DZ5C6FQv.js","./layerUtils-BrNoooE9.js","./layerViewUtils-DhFEu8Rd.js"])))=>i.map(i=>d[i]);
import{_ as jt}from"./index-Bh2oEzTI.js";import{r as l}from"./tslib.es6-B3Jf3DVX.js";import{aa as dn,b as ne,s as kt,i as fn}from"./Accessor-BLX9ikPh.js";import{d as gn}from"./asyncUtils-CWX51uTe.js";import{o as yn}from"./Evented-BHRw9x22.js";import{m as h,a as ht,O as mn,S as En,n as _n,X as vn}from"./subclass-BZA_h8Db.js";import{watch as Yt,syncAndInitial as Ne,sync as Sn}from"./reactiveUtils-C5zUhJQJ.js";import{K as ge,N as wn}from"./projection-B971H0Re.js";import{m as Ln,j as it,x as bn,E as $n}from"./elevationInfoUtils-BC_66_Fg.js";import{r as Lt,n as f,t as B,N as Tn}from"./vec3f64-BLpZdpfb.js";import{e as pt,a as xe}from"./projectVectorToVector-G2uWGoIb.js";import{l as bt}from"./Color-BCS62Hs5.js";import{f as Pe}from"./assets-C43MgM-v.js";import{V as ut}from"./Collection-CEdjem1-.js";import{r as Nn}from"./fieldUtils-tmQlKvWo.js";import{g as xn}from"./timeUtils-8fb_2oAt.js";import{H as _,p as Re,R as N,P as T,q as w,o as tt,s as Ae,c as Mt,_ as $t,Z as Bt,v as Jt,j as Pn,A as Rn,J as An,u as Mn,I as Cn}from"./vec32-Dvg_eL9J.js";import{b as On}from"./Query-5Xpquc1r.js";import{_ as qn}from"./InputManager-Ba9xzDpe.js";import{c as ye}from"./keybindings-DoOdil3D.js";import{r as In}from"./utils-BpB3MnW1.js";import{m as Dn,l as zn}from"./mathUtils-C4_ghTv4.js";import{e as et,p as Tt,j as Ct,d as vt,B as Fn,q as jn,_ as kn,o as Me,b as Ce,E as me,m as Hn}from"./vec2-maR1OrZI.js";import{n as K,r as St,a as Vn}from"./vec2f64-miziP1SN.js";import{s as Gn,j as Zn}from"./vec42-YcqnINSP.js";import{n as Wn}from"./vec4f64-o2zAXfmz.js";import{i as Un}from"./geodesicConstants-DWQLYX7F.js";import{j as Qt,q as Oe,b as qe}from"./geodesicUtils-FCYOaNwu.js";import{M as A,z as Xn,l as Ot,Q as Kt,k as Ie,V as Yn,H as De,O as ze,p as Bn}from"./plane-IENfwZlB.js";import{I as Jn,O as Qn,_ as Kn,$ as ti,U as ei}from"./sphere-C77djCO6.js";import{q as Fe}from"./mathUtils-BG-eq9fO.js";import{e as lt}from"./common-DQOJ18NT.js";import{j as b,d as ni}from"./geometry2dUtils-DdyQE7AQ.js";import{c as ii,f as si}from"./screenUtils-_ZIvrt5o.js";import{i as ri}from"./viewUtils-DrPohWV3.js";var nt;function je(e,t,n){return P(e,t,n)}function P(e=0,t=0,n=0){return Lt(e,t,n)}function ks(e){return e}function Hs(e){return e}function J(e,t,n){return Lt(e,t,n)}function st(e){const[t,n,i]=e;return e.length>3?[t,n,i,e[3]]:[t,n,i]}function Ht(e){return e[3]=((e.length>3?e[3]:void 0)??nt.NONE)|nt.TARGET,e}function Vs(e){return!!(((e.length>3?e[3]:void 0)??nt.NONE)&nt.TARGET)}function Ee(e,t,{coordinateHelper:n,elevationInfo:i},s){return e?ct(n.vectorToDehydratedPoint(e,ai),t,i,s):null}function ct(e,t,n,i=P()){return i[0]=e.x,i[1]=e.y,i[2]=e.z??0,t==null||(t.type==="2d"?i[2]=0:i[2]=Ln(t,e,n,it)??0),i}function Gs(e,t,n){return n?(xe(n,e[0],e[1],e[2],t),n):pt(e[0],e[1],e[2],t)}function _e(e,t,{z:n,m:i},s,r){const{spatialReference:o,elevationInfo:a}=s;let c;n==null&&i==null?c=void 0:t==null||t.type==="2d"?c=n??void 0:c=bn(t,e,o,it,a)??0;const[u,p]=e;return r?xe(r,u,p,c,o):r=pt(u,p,c,o),i!=null&&(r.m=i,r.hasM=!0),r}function Zs(e,t,n,i,s=P()){const[r,o]=e;return s[0]=r,s[1]=o,e.length>3&&(s[3]=e[3]??nt.NONE),(n==null?void 0:n.type)!=="3d"?(s[2]=t.value,s):(s[2]=$n(n,r,o,t.value,i,t.elevationInfo,it)??0,s)}(function(e){e[e.NONE=0]="NONE",e[e.TARGET=1]="TARGET"})(nt||(nt={}));const ai=pt(0,0,0,null);let q=class extends Pe{constructor(){super(...arguments),this.enabled=!0}};l([h({type:Boolean})],q.prototype,"enabled",void 0),q=l([ht("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],q);let m=class extends Pe{constructor(e){super(e),this.lineSnapper=new q,this.parallelLineSnapper=new q,this.rightAngleSnapper=new q,this.rightAngleTriangleSnapper=new q,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new bt([255,127,0]),this.orangeTransparent=new bt([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};l([h({type:q,constructOnly:!0,nonNullable:!0,json:{write:!0}})],m.prototype,"lineSnapper",void 0),l([h({type:q,constructOnly:!0,nonNullable:!0,json:{write:!0}})],m.prototype,"parallelLineSnapper",void 0),l([h({type:q,constructOnly:!0,nonNullable:!0,json:{write:!0}})],m.prototype,"rightAngleSnapper",void 0),l([h({type:q,constructOnly:!0,nonNullable:!0,json:{write:!0}})],m.prototype,"rightAngleTriangleSnapper",void 0),l([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],m.prototype,"shortLineThreshold",void 0),l([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],m.prototype,"distance",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],m.prototype,"pointThreshold",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],m.prototype,"intersectionParallelLineThreshold",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],m.prototype,"parallelLineThreshold",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],m.prototype,"verticalLineThresholdMeters",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],m.prototype,"touchSensitivityMultiplier",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],m.prototype,"pointOnLineThreshold",void 0),l([h({type:bt,nonNullable:!0})],m.prototype,"orange",void 0),l([h({type:bt,nonNullable:!0})],m.prototype,"orangeTransparent",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],m.prototype,"lineHintWidthReference",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],m.prototype,"lineHintWidthTarget",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],m.prototype,"lineHintFadedExtensions",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],m.prototype,"parallelLineHintWidth",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],m.prototype,"parallelLineHintLength",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],m.prototype,"parallelLineHintOffset",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],m.prototype,"rightAngleHintSize",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],m.prototype,"rightAngleHintOutlineSize",void 0),l([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],m.prototype,"satisfiesConstraintScreenThreshold",void 0),m=l([ht("esri.views.interactive.snapping.Settings.Defaults")],m);const Nt=new m;var L;(function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"})(L||(L={}));let qt=class{constructor(t,n){this.isDraped=t,this.domain=n}},oi=class ke extends qt{constructor(t,n,i=L.ALL){super(n,i),this.intersectionPoint=t}equals(t){return t instanceof ke&&_(this.intersectionPoint,t.intersectionPoint)}},j=class He extends qt{constructor(t,n,i,s,r=L.ALL,o=!0,a=!0){super(s,r),this.type=t,this.lineStart=n,this.lineEnd=i,this.fadeLeft=o,this.fadeRight=a}equals(t){return t instanceof He&&this.type===t.type&&_(this.lineStart,t.lineStart)&&_(this.lineEnd,t.lineEnd)&&this.fadeLeft===t.fadeLeft&&this.fadeRight===t.fadeRight}get length(){return Re(this.lineStart,this.lineEnd)}},ci=class Ve extends qt{constructor(t,n,i,s=L.ALL){super(i,s),this.lineStart=t,this.lineEnd=n}equals(t){return t instanceof Ve&&_(this.lineStart,t.lineStart)&&_(this.lineEnd,t.lineEnd)}},Ge=class Ze extends qt{constructor(t,n,i,s,r=L.ALL){super(s,r),this.previousVertex=t,this.centerVertex=n,this.nextVertex=i}equals(t){return t instanceof Ze&&_(this.previousVertex,t.previousVertex)&&_(this.centerVertex,t.centerVertex)&&_(this.nextVertex,t.nextVertex)}};function ie({start:e,end:t,type:n},i,s){const r=[],o=et(dt,t,e),a=et(It,e,i),c=Tt(o),u=2*Ct(o,a),p=u*u-4*c*(Tt(a)-s*s);if(p===0){const d=-u/(2*c);(n===x.PLANE||d>=0)&&r.push(vt(K(),e,o,d))}else if(p>0){const d=Math.sqrt(p),E=(-u+d)/(2*c);(n===x.PLANE||E>=0)&&r.push(vt(K(),e,o,E));const g=(-u-d)/(2*c);(n===x.PLANE||g>=0)&&r.push(vt(K(),e,o,g))}return r}function We(e,t){const n=e.start,i=e.end,s=et(dt,i,n),r=tt(zt,-s[1],s[0],0),o=t.start,a=t.end,c=N(re,a,o),u=T(c,r),p=tt(tn,n[0],n[1],0),d=N(en,p,o),E=T(d,r),g=lt();if(Math.abs(u)<g)return[];const v=w(nn,o,c,E/u);if(t.type===b.RAY){const $=N(te,v,o);if(T($,c)<-g)return[]}if(e.type===x.HALF_PLANE){const $=Fn(It,v,n);if(Ct($,s)<-g)return[]}return[B(v)]}function ui(e,t){return hi(xt(ae,t[2],e),t)}function Ue(e,t){return Qe(xt(ae,0,e),xt(gi,0,t)).map(([i,s])=>St(i,s))}function Xe(e,t,n){return Be(e,xt(ae,e[2],t),n)}function Ye(e,t,n,i=f()){const s=et(dt,e,t),r=jn(s);return vt(i,t,s,r===0?1:n/r),i[2]=e[2],i}function Be(e,{start:t,end:n,type:i},s=f()){const r=N(Dt,e,t),o=N(zt,n,t),a=T(r,o)/T(o,o);return w(s,t,o,i===b.RAY?Math.max(a,0):a)}const li=(()=>{const e=f(),t=f(),n=f();return({start:i,end:s},{center:r,radius:o,normal:a,slicePlane:c})=>{const u=Ot(r,a,fi);if(y(Kt(u,i),0)&&y(Kt(u,s),0)){Fe(a,e,t);const d=(v,$)=>(Mt(n,$,r),Me(v,T(n,e),T(n,t)),v),E=ni({start:d(dt,i),end:d(It,s),type:b.LINE},Vn,o),g=[];for(const[v,$]of E){const R=Ae(f(),r);w(R,R,e,v),w(R,R,t,$),c&&!Y(c,R)||g.push(R)}return g}const p=f();return Ie(u,i,s,p)?!y(Re(p,r),o)||c&&!Y(c,p)?[]:[p]:[]}})();function Je({start:e,end:t,type:n},i,s){const r=[],o=Mt(Dt,t,e),a=et(It,e,i),c=Tt(o),u=2*Ct(o,a),p=u*u-4*c*(Tt(a)-s*s);if(p===0){const d=-u/(2*c);(n===b.LINE||d>=0)&&r.push(w(f(),e,o,d))}else if(p>0){const d=Math.sqrt(p),E=(-u+d)/(2*c);(n===b.LINE||E>=0)&&r.push(w(f(),e,o,E));const g=(-u-d)/(2*c);(n===b.LINE||g>=0)&&r.push(w(f(),e,o,g))}return r}function Qe(e,t){const n=e.start,i=e.end,s=t.start,r=t.end,o=N(Dt,i,n),a=N(zt,r,s),c=N(re,s,n),u=$t(tn,o,a);if(!y(T(c,u),0))return[];const p=Bt(u);if(y(p,0))return[];const d=$t(en,c,a),E=T(d,u)/p,g=w(nn,n,o,E);if(e.type===b.RAY){const v=N(te,g,n);if(T(o,v)<-lt())return[]}if(t.type===b.RAY){const v=N(te,g,s);if(T(a,v)<-lt())return[]}return[B(g)]}function hi({start:e,end:t,type:n},i){const s=N(Dt,i,e),r=N(zt,t,e),o=$t(re,r,s),a=Bt(o)/Bt(r),c=lt();if(a<c)switch(n){case b.LINE:return[B(i)];case b.RAY:return T(r,s)<-c?[]:[B(i)]}return[]}function se(e,t,n,i){const[s,r]=e,[o,a]=n,c=o-s,u=a-r,p=c*c+u*u,d=Math.sqrt(p);if(d>t+i)return[];if(d<Math.abs(t-i))return[];if(y(d,0)&&y(t,i))return[];const E=(t*t-i*i+p)/(2*d),g=Math.sqrt(t*t-E*E),v=g*u/d,$=g*c/d,[R,Q]=kn(dt,e,n,E/d);return y(v,$)?[St(R,Q)]:[St(R+v,Q-$),St(R-v,Q+$)]}function xt(e,t,{start:n,end:i,type:s}){return tt(e.start,n[0],n[1],t),tt(e.end,i[0],i[1],t),e.type=di[s],e}function Ke(e,t){return y(e[2],t[2])}function y(e,t){return Dn(Math.abs(e-t),0,lt())}function pi(e,t){return t.filter(n=>Y(e,n))}function Y(e,t){return Xn(e,t)}var x;(function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"})(x||(x={}));const di={[x.PLANE]:b.LINE,[x.HALF_PLANE]:b.RAY},dt=K(),It=K(),Dt=f(),zt=f(),re=f(),tn=f(),en=f(),nn=f(),te=f(),fi=A(),ae={start:f(),end:f(),type:b.LINE},gi={start:f(),end:f(),type:b.LINE};class C{intersect(t){return H(this,t)}closestPoints(t){return[this.closestTo(t)]}}class rt extends C{constructor(t){super(),this.point=t}equals(t){return this===t||O(t)&&_(this.point,t.point)}closestTo(){return st(this.point)}}class oe extends C{constructor(t,n,i){super(),this.start=t,this.end=n,this.lineLike={start:t,end:n,type:i}}equals(t){return this===t||D(t)&&this.lineLike.type===t.lineLike.type&&_(this.start,t.start)&&_(this.end,t.end)}closestTo(t){const n=P();return Be(t,this.lineLike,n),n}}class ce extends oe{constructor(t,n){super(t,n,b.LINE)}}class yi extends oe{constructor(t,n){super(t,n,b.RAY)}}class sn extends C{constructor(t){super(),this.constraints=t}equals(t){return this===t||ee(t)&&En(this.constraints,t.constraints,(n,i)=>n.equals(i))}closestTo(t){let n,i=1/0;for(const s of this.constraints){const r=s.closestTo(t),o=Jt(t,r);o<i&&(i=o,n=r)}return st(n??t)}closestPoints(t){return this.constraints.flatMap(n=>n===this?[]:n.closestPoints(t))}}class rn extends C{constructor(t,n){super(),this.center=t,this.radius=n}equals(t){return this===t||F(t)&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius}closestTo(t){const n=P();return Ye(t,this.center,this.radius,n),n}}class ue extends C{constructor(t,n){super(),this.center=t,this.radius=n}equals(t){return this===t||G(t)&&_(this.center,t.center)&&this.radius===t.radius}closestTo(t){const n=P();return Ye(t,this.center,this.radius,n),n[2]=this.center[2],n}asCircle(){return new le(st(this.center),this.radius,J(0,0,1))}}class le extends C{constructor(t,n,i,s=void 0){super(),this.center=t,this.radius=n,this.normal=i,this.slicePlane=s}equals(t){return this===t||U(t)&&_(this.center,t.center)&&_(this.normal,t.normal)&&this.radius===t.radius}closestTo(t){const{center:n,radius:i}=this;De(this.getPlane(mi),t,Vt);const s=N(Vt,Vt,n),r=Pn(s);if(y(r,0))return st(t);const o=i/Math.sqrt(r),a=P();w(a,n,s,o);const{slicePlane:c}=this;if(c&&!Y(c,a)){const u=pe(c,this);return(u==null?void 0:u.closestTo(t))??st(t)}return a}getPlane(t=A()){return Ot(this.center,this.normal,t)}}const Vt=f(),mi=A();class Ei extends C{constructor(t){super(),this.z=t}equals(t){return this===t||V(t)&&this.z===t.z}closestTo(t){return J(t[0],t[1],this.z)}getPlane(t=A()){return tt(ve,0,0,this.z),Ot(ve,Tn,t)}}const ve=f();class he extends C{constructor(t,n,i){super(),this.start=t,this.end=n,this.planeLike={start:t,end:n,type:i}}equals(t){return this===t||z(t)&&this.planeLike.type===t.planeLike.type&&_(this.start,t.start)&&_(this.end,t.end)}closestTo(t){const n=P();return Xe(t,this.planeLike,n),n}closestEndTo(t){const{start:n,end:i}=this.planeLike;return Math.sign(Ct(et(_i,i,n),et(vi,t,n)))>0?this.end:this.start}getPlane(t=A()){const n=Ae(Se,this.end);return n[2]+=1,Bn(this.start,this.end,n,t)}getSlicePlane(t=A()){const{start:n,end:i,type:s}=this.planeLike;if(s===x.PLANE)return;const r=tt(Se,n[0],n[1],0),o=tt(we,i[0],i[1],0),a=Mt(we,o,r);return Ot(r,a,t),t}}const _i=K(),vi=K(),Se=f(),we=f();class Xs extends he{constructor(t,n){super(t,n,x.HALF_PLANE)}}class an extends he{constructor(t,n){super(t,n,x.PLANE)}}class Si extends C{constructor(t,n){super(),this.sphere=Qn(t,n)}equals(t){return this===t||Z(t)&&Kn(this.sphere,t.sphere)}closestTo(t){const n=P();return ti(this.sphere,t,n),n}get center(){return ei(this.sphere)}get radius(){return this.sphere[3]}}class on extends C{constructor(t,n,i){super(),this.start=t,this.end=n,this.getZ=i,this.planeLike={start:t,end:n,type:x.PLANE}}equals(t){return this===t||Pt(t)&&_(this.start,t.start)&&_(this.end,t.end)&&this.getZ===t.getZ}closestTo(t){return Ni(this,t)}addIfOnTheGround(t,n){for(const i of n){const s=this.getZ(i[0],i[1])??0;y(i[2],s)&&(i[2]=s,t.push(i))}}}class wi extends C{constructor(t,n,i){super(),this._x=t,this._y=n,this._z=i}equals(t){return this===t||Vi(t)&&this._x===t._x&&this._y===t._y&&this._z===t._z}closestTo([t,n,i]){return je(this._x??t,this._y??n,this._z??i)}}class Li extends C{constructor(t,n,i,s,r){super(),this._origin=t,this._spatialReference=n,this._distanceMeters=i,this._z=s,this._directionDegrees=r}equals(t){return this===t||Hi(t)&&me(this._origin,t._origin)&&this._spatialReference===t._spatialReference&&this._distanceMeters===t._distanceMeters&&this._z===t._z&&this._directionDegrees===t._directionDegrees}closestTo([t,n,i]){return Me(ot,t,n),me(ot,this._origin)||this._applyDirectionAndDistance(ot),je(ot[0],ot[1],this._z??i)}_applyDirectionAndDistance(t){if(this._directionDegrees!=null&&this._distanceMeters!=null)Qt(t,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)$i(t,this._origin,this._directionDegrees,t,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:n}=Oe(bi,this._origin,t,this._spatialReference);Qt(t,this._origin,n??0,this._distanceMeters,this._spatialReference)}}}const ot=[0,0],bi=new qe;function $i(e,t,n,i,s){let{azimuth:r,distance:o}=Oe(Ti,t,i,s);r??(r=0);let a=o*Math.cos((r-n)*Un);a=Math.max(0,a),Qt(e,t,n,a,s)}const Ti=new qe;function Ni(e,t){const n=P();return Xe(t,e.planeLike,n),n[2]=e.getZ(n[0],n[1])??un,n}function H(e,t){if(ee(e)){const n=[];for(const i of e.constraints){const s=i.intersect(t);s&&n.push(s)}return de(n)}if(ee(t))return H(t,e);if(Pt(e))return Le(e,t);if(Pt(t))return Le(t,e);if(O(e)){const{point:n}=e;if(O(t))return _(n,t.point)?e:void 0;const i=t.closestTo(n);return An(i,n)?e:void 0}if(D(e)){if(O(t))return H(t,e);if(D(t))return I(Qe(e.lineLike,t.lineLike));if(V(t))return xi(e,t);if(z(t))return I(We(t.planeLike,e.lineLike));if(F(t))return I(Je(e.lineLike,t.center,t.radius));if(U(t))return I(li(e.lineLike,t));if(G(t))return Pi(e,t);if(Z(t))return Ri(e,t)}else if(V(e)){if(O(t)||D(t))return H(t,e);if(V(t))return Ai(e,t);if(z(t))return Mi(e,t);if(F(t))return Ci(e,t);if(U(t))return qi(e,t);if(G(t))return Oi(e,t);if(Z(t))return Ii(e,t)}else if(z(e)){if(O(t)||D(t)||V(t))return H(t,e);if(z(t))return Gt(Ue(e.planeLike,t.planeLike));if(F(t))return Gt(ie(e.planeLike,t.center,t.radius));if(U(t))return zi(e,t);if(G(t))return Di(e,t);if(Z(t))return Fi(e,t)}else if(F(e)){if(O(t)||D(t)||V(t)||z(t))return H(t,e);if(F(t))return Gt(se(e.center,e.radius,t.center,t.radius));if(U(t))return void 0;if(G(t))return ji(e,t);if(Z(t))return void 0}else if(U(e)){if(O(t)||D(t)||V(t)||z(t)||F(t))return H(t,e);if(U(t))return void 0;if(G(t))return t.asCircle(),void 0;if(Z(t))return void 0}else if(G(e)){if(O(t)||D(t)||V(t)||z(t)||F(t)||U(t))return H(t,e);if(G(t))return ki(t,e);if(Z(t))return void 0}else if(Z(e)){if(O(t)||D(t)||V(t)||z(t)||F(t)||G(t))return H(t,e);if(Z(t))return void 0}}const xi=(()=>{const e=A();return(t,n)=>{const{start:i,end:s}=t;if(Ke(i,s)&&y(i[2],n.z))return t;const r=P();return Ie(n.getPlane(e),i,s,r)?new rt(r):void 0}})();function Pi({lineLike:e},{center:t,radius:n}){const i=t[2];return I(Je(e,t,n).filter(s=>y(s[2],i)))}function Ri({lineLike:e},{sphere:t}){return I(Jn(t,e.start,e.end))}const pe=(()=>{const e=Wn(),t=f(),n=f();return(i,s,r)=>{const{normal:o,center:a,radius:c}=s;Fe(o,t,n);const u=ze(i),p=c*T(u,t),d=c*T(u,n);Gn(e,a[0],a[1],a[2],1);const E=Zn(i,e),g=Math.hypot(p,d),v=y(g,0);if(y(Kt(i,a),0)){if(v)return s;if(y(c,0))return!r||Y(r,a)?new rt(st(a)):void 0;$t(t,u,o),Rn(t,t);const Ft=new Array,mt=B(a);w(mt,mt,t,c),r&&!Y(r,mt)||Ft.push(mt);const Et=B(a);return w(Et,Et,t,-c),r&&!Y(r,Et)||Ft.push(Et),I(Ft)}if(v)return;const $=-E/g;if(Math.abs($)>1||y($,1))return;const R=Math.atan(p/d),Q=zn($)-R,fe=Math.PI-Q,ft=new Array,gt=f();w(gt,a,t,c*Math.cos(Q)),w(gt,gt,n,c*Math.sin(Q)),ft.push(gt);const yt=f();return w(yt,a,t,c*Math.cos(fe)),w(yt,yt,n,c*Math.sin(fe)),ft.push(yt),I(r?pi(r,ft):ft)}})();function Ai(e,t){return y(e.z,t.z)?e:void 0}function Mi({z:e},{planeLike:t}){const[n,i]=t.start,[s,r]=t.end,o=J(n,i,e),a=J(s,r,e);return t.type===x.PLANE?new ce(o,a):new yi(o,a)}function Ci(e,t){const[n,i]=t.center;return new ue(J(n,i,e.z),t.radius)}function Oi(e,t){return y(t.center[2],e.z)?t:void 0}const qi=(()=>{const e=A();return(t,n)=>pe(t.getPlane(e),n,n.slicePlane)})();function Ii(e,{center:t,radius:n}){const i=Math.abs(t[2]-e.z);if(i>n&&!y(i,n))return;const s=J(t[0],t[1],e.z),r=Math.sqrt(n**2-i**2);return y(r,0)?void 0:new ue(s,r)}const Di=(()=>{const e=A();return(t,{center:n,radius:i})=>{const s=ie(t.planeLike,n,i),r=n[2];t.getSlicePlane(e);const o=new Array;for(const[a,c]of s){const u=[a,c,r];Y(e,u)&&o.push(u)}return I(o)}})(),zi=(()=>{const e=A(),t=A();return(n,i)=>pe(n.getPlane(e),i,n.getSlicePlane(t))})(),Fi=(()=>{const e=A();return(t,{center:n,radius:i})=>{const s=t.getPlane(e),r=Yn(s,n),o=Math.abs(r);if(o>i&&!y(o,i))return;const a=Math.sqrt(i**2-r**2);if(y(a,0)){const p=P();return De(s,n,p),new rt(p)}const c=P(),u=B(ze(s));return w(c,n,u,r),new le(c,a,u,t.getSlicePlane())}})();function ji(e,t){const n=Ce(e.center,t.center);return y(n,0)&&y(e.radius,t.radius)?t:cn(se(e.center,e.radius,t.center,t.radius),t.center[2])}function ki(e,t){if(!Ke(e.center,t.center))return;const n=Ce(e.center,t.center);return y(n,0)&&y(e.radius,t.radius)?e:cn(se(e.center,e.radius,t.center,t.radius),e.center[2])}function Le(e,t){const{planeLike:n,getZ:i}=e,s=new Array;if(O(t))e.addIfOnTheGround(s,ui(n,t.point));else if(D(t))e.addIfOnTheGround(s,We(n,t.lineLike));else if(F(t))for(const[r,o]of ie(n,t.center,t.radius)){const a=i(r,o);a!=null&&s.push(Lt(r,o,a))}else if(z(t)||Pt(t))for(const[r,o]of Ue(n,t.planeLike)){const a=i(r,o)??un;s.push(Lt(r,o,a))}return I(s)}function Gt(e){return de(e.map(([t,n])=>{const i=J(t,n,0),s=J(t,n,1);return new ce(i,s)}))}function I(e){return de(e.map(t=>t?new rt(t):void 0))}function cn(e,t){return I(e.map(([n,i])=>[n,i,t]))}function de(e){if(e.length!==0)return e.length===1?e[0]??void 0:new sn(e.filter(mn))}function ee(e){return e instanceof sn}function O(e){return e instanceof rt}function D(e){return e instanceof oe}function V(e){return e instanceof Ei}function z(e){return e instanceof he}function F(e){return e instanceof rn}function G(e){return e instanceof ue}function U(e){return e instanceof le}function Z(e){return e instanceof Si}function Pt(e){return e instanceof on}function Hi(e){return e instanceof Li}function Vi(e){return e instanceof wi}const un=0,Ys=Symbol("grid-placement-graphic");function ln(e,t){const n=e.x-t.x,i=e.y-t.y;return n*n+i*i}function Bs(e,t){return Math.sqrt(ln(e,t))}function Gi(e,t){t.sort((n,i)=>Jt(n.targetPoint,e)-Jt(i.targetPoint,e))}var M;function Js({point:e,distance:t,returnEdge:n,vertexMode:i,coordinateHelper:{spatialReference:s},filter:r},o,a){return a=a!=null?a.clone():new On({where:"1=1"}),r&&(a.geometry=r.geometry,a.distance=r.distance,a.spatialRelationship=r.spatialRelationship,a.where=Nn(a.where,r.where),a.timeExtent=xn(a.timeExtent,r.timeExtent),a.objectIds=Zi(a.objectIds,r.objectIds)),{point:pt(e[0],e[1],e[2],s.toJSON()),mode:o,distance:t,returnEdge:n,vertexMode:i,query:a.toJSON()}}function Zi(e,t){return e||t?t?e?Array.from(dn(new Set(e),new Set(t))):t:e:null}function Qs(e,t,n){return{left:Ee(e.leftVertex.pos,t,n),right:Ee(e.rightVertex.pos,t,n)}}function Ks(e){return e.createQuery()}(function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(M||(M={}));const be=Symbol("snapping-toggle");function tr(e,t=()=>{}){const n=Yt(()=>({view:e.view,snappingOptions:e.snappingOptions}),({view:i,snappingOptions:s})=>{if(e.removeHandles(be),!i||!s)return;const r=qn.TOOL,o=[i.on("key-down",a=>{a.key!==ye.toggle||a.repeat||(s.enabledToggled=!0,t())},r),i.on("key-up",a=>{a.key===ye.toggle&&(s.enabledToggled=!1,t())},r),i.on("pointer-move",a=>{const c=a.native.ctrlKey;s.enabledToggled!==c&&(s.enabledToggled=c,t())},r)];e.addHandles(o,be)},Ne);e.addHandles(n)}function er(e){var t;return In(e)&&"utilityNetworks"in e&&!!((t=e.utilityNetworks)!=null&&t.length)}let X=class extends ne{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new ut}};l([h({constructOnly:!0})],X.prototype,"layer",void 0),l([h()],X.prototype,"enabled",void 0),l([h()],X.prototype,"updating",void 0),l([h()],X.prototype,"availability",void 0),l([h()],X.prototype,"sublayerSources",void 0),X=l([ht("esri.views.interactive.snapping.FeatureSnappingLayerSource")],X);const hn=X;let S=class extends ne{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new ut,this.distance=Nt.distance,this.touchSensitivityMultiplier=Nt.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){var a;const e=this.featureSources;e.some($e)&&_n.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const t=e.filter(Xi),n=((a=this._get("_effectiveFeatureSources"))==null?void 0:a.filter($e))??new ut;for(const c of t){const u=n.find(p=>p.layer===c.layer.parent);if(u)u.sublayerSources.includes(c)||u.sublayerSources.add(c);else if(c.layer.parent){const p=new hn({layer:c.layer.parent});p.sublayerSources.add(c),n.add(p)}}for(const c of n){const u=c.sublayerSources.filter(p=>!t.includes(p));c.sublayerSources.removeMany(u)}n.removeMany(n.filter(c=>c.sublayerSources.length===0));const i=e.filter(Ui),s=this._get("_effectiveFeatureSources")??new ut,{added:r,removed:o}=vn(s.toArray(),[...i,...n]);return s.removeMany(o),s.addMany(r),s}};l([h()],S.prototype,"enabled",void 0),l([h()],S.prototype,"enabledToggled",void 0),l([h()],S.prototype,"forceDisabled",void 0),l([h()],S.prototype,"selfEnabled",void 0),l([h()],S.prototype,"featureEnabled",void 0),l([h()],S.prototype,"gridEnabled",void 0),l([h()],S.prototype,"attributeRulesEnabled",void 0),l([h({type:ut.ofType(hn)})],S.prototype,"featureSources",void 0),l([h()],S.prototype,"distance",void 0),l([h()],S.prototype,"touchSensitivityMultiplier",void 0),l([h({readOnly:!0})],S.prototype,"effectiveEnabled",null),l([h({readOnly:!0})],S.prototype,"effectiveGridEnabled",null),l([h({readOnly:!0})],S.prototype,"effectiveSelfEnabled",null),l([h({readOnly:!0})],S.prototype,"effectiveFeatureEnabled",null),l([h({readOnly:!0})],S.prototype,"_effectiveFeatureSources",null),S=l([ht("esri.views.interactive.snapping.SnappingOptions")],S);const Wi=S;function $e(e){return e.layer.type==="subtype-group"}function Ui(e){return e.layer.type!=="subtype-group"}function Xi(e){return e.layer.type==="subtype-sublayer"}class at{constructor(t,n,i,s){this.targetPoint=t,this.constraint=n,this.isDraped=i,this.domain=s}}let pn=class extends at{constructor({targetPoint:t,objectId:n,constraint:i,isDraped:s}){super(t,i,s,L.FEATURE),this.objectId=n}},Yi=class extends pn{constructor(t){super({...t,isDraped:!0,constraint:new on(t.edgeStart,t.edgeEnd,t.getGroundElevation)})}get hints(){return[new j(M.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},Bi=class extends pn{constructor(t){super({...t,constraint:new ce(t.edgeStart,t.edgeEnd)})}get hints(){return[new j(M.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},wt=class extends at{constructor(t,n,i,s){super(t,new rt(t),s,L.ALL),this.first=n,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new oi(this.targetPoint,this.isDraped,this.domain)]}};class Ji extends at{constructor({lineStart:t,lineEnd:n,targetPoint:i,isDraped:s}){super(i,new an(t,n),s,L.SELF),this._referenceLineHint=new j(M.REFERENCE_EXTENSION,t,n,s,this.domain)}get hints(){return[this._referenceLineHint,new j(M.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}let Qi=class extends at{constructor({referenceLine:t,lineStart:n,targetPoint:i,isDraped:s}){const r=B(n),{left:o,right:a}=t;Mt(r,Mn(r,r,a),o),super(i,new an(n,r),s,L.SELF),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new j(M.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new ci(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(t=>new j(M.REFERENCE,t.edge.left,t.edge.right,this.isDraped,this.domain,t.fadeLeft,t.fadeRight))]}addReferenceLine(t){const n={edge:t,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(i=>{_(t.right,i.edge.left)&&(i.fadeLeft=!1,n.fadeRight=!1),_(t.right,i.edge.right)&&(i.fadeRight=!1,n.fadeRight=!1),_(t.left,i.edge.right)&&(i.fadeRight=!1,n.fadeLeft=!1),_(t.left,i.edge.left)&&(i.fadeLeft=!1,n.fadeLeft=!1)}),this._referenceLines.push(n)}},Ki=class extends at{constructor({targetPoint:t,constraint:n,previousVertex:i,otherVertex:s,otherVertexType:r,isDraped:o,selfSnappingType:a,objectId:c,domain:u}){super(t,n,o,u??L.SELF),this.previousVertex=i,this.otherVertex=s,this.otherVertexType=r,this.selfSnappingType=a??At.None,this.objectId=c??null}get hints(){const t=this.previousVertex,n=this.otherVertexType===Rt.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===Rt.CENTER?this.targetPoint:this.otherVertex;return[new j(M.TARGET,n,i,this.isDraped,this.domain),new j(M.REFERENCE,t,n,this.isDraped,this.domain),new Ge(this.previousVertex,n,i,this.isDraped,this.domain)]}};var Rt,At;(function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"})(Rt||(Rt={})),function(e){e[e.None=0]="None",e[e.LastVertex=1]="LastVertex",e[e.FirstVertex=2]="FirstVertex",e[e.ExistingEdge=3]="ExistingEdge"}(At||(At={}));class ts extends at{constructor({targetPoint:t,point1:n,point2:i,isDraped:s}){super(t,new rn(Cn(f(),n,i,.5),.5*Hn(n,i)),s,L.SELF),this._p1=n,this._p2=i}get hints(){return[new j(M.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new j(M.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new Ge(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}function es(e,t,n,i){return i.type==="2d"?(_t.x=e[0],_t.y=e[1],_t.spatialReference=t,i.toScreen(_t)):(ri(e,t,n,i,Te),i.state.camera.projectToScreen(Te,Zt),ii(Zt[0],Zt[1]))}const _t=pt(0,0,0,null),Te=f(),Zt=si();let k=class extends yn.EventedMixin(ne){constructor(e){super(e),this.options=new Wi,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=W.MAIN}initialize(){this.addHandles([Yt(()=>{const{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:n,effectiveFeatureEnabled:i,effectiveGridEnabled:s}=this.options;return{selfEnabled:n,featureEnabled:i,gridEnabled:this.view.type==="2d"&&s,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}},(e,t)=>{var n;t&&(this.doneSnapping(),this.emit("changed")),(n=this._loadTask)==null||n.abort(),this._loadTask=gn(i=>this._updateEngines(e,t,i))},Ne),Yt(()=>this.options,e=>{for(const t of this._engines)t.options=e},Sn)])}destroy(){this._destroyEngines()}get updating(){var e;return this._engines.some(t=>t.updating)||!((e=this._loadTask)!=null&&e.finished)}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,n){if(!e.viewReady)return void this._destroyEngines();(t==null?void 0:t.viewSpatialReference)!==e.viewSpatialReference&&this._destroyEngines();const{_engineCache:i}=this,s=[];e.featureEnabled&&!i.has("feature")&&s.push(this._setupFeatureSnappingEngine(n)),e.selfEnabled&&!i.has("self")&&s.push(this._setupSelfSnappingEngine(n)),e.gridEnabled&&!i.has("grid")&&this.view.type==="2d"&&s.push(this._setupGridSnappingEngine(n)),await Promise.allSettled(s),n.aborted||(this._engines=Array.from(i.values()))}async _setupSelfSnappingEngine(e){const{SelfSnappingEngine:t}=await jt(()=>import("./SelfSnappingEngine-C3m3A2A3.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79]),import.meta.url);kt(e);const n=new t({view:this.view,options:this.options});this._engineCache.set("self",n)}async _setupGridSnappingEngine(e){const{view:t}=this,{GridSnappingEngine:n}=await jt(async()=>{const{GridSnappingEngine:i}=await import("./GridSnappingEngine-BoqBC54D.js");return{GridSnappingEngine:i}},__vite__mapDeps([80,1,2,3,9,11,12,13,14,15,16,17,26,18,23,33,7,28,29,30,31,81,82,55,35,83,84,85,86,34,43,5,44,4,6,19,20,21,27,32,45,46,47,48,49,50,51,52,53,54,56,57,58,59,60,61,62,63,64,65,66,67,22,25,68,69,70,71,72,73,74,75,76,77,42,78,79]),import.meta.url);if(kt(e),t.type==="2d"){const i=new n({view:t,options:this.options});this._engineCache.set("grid",i)}}async _setupFeatureSnappingEngine(e){const{FeatureSnappingEngine:t}=await jt(()=>import("./FeatureSnappingEngine-DPQqxb42.js"),__vite__mapDeps([87,15,16,1,2,3,44,43,4,5,6,7,11,12,13,14,17,22,23,26,18,88,19,20,21,47,48,49,50,51,9,35,28,29,89,53,54,55,56,57,58,59,60,61,52,90,91,92,33,30,31,27,32,45,46,62,63,64,65,66,67,25,68,69,34,70,71,72,73,74,75,76,77,42,78,79]),import.meta.url);kt(e);const{view:n,options:i,_engineCache:s}=this,r=new t({view:n,options:i,spatialReference:n.spatialReference});s.set("feature",r)}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}snap(e){return ss(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:n}=e;this._removeVisualization();const i=this._currentMainCandidate;if(i==null)return t;const s=this._selectUpdateInput(e);if(s==null)return t;const{spatialReference:r}=n,o=ge(s,r);if(o==null)return t;const{view:a}=this,{elevationInfo:c,visualizer:u}=n,p=[],d=ct(o,a,c),E=i.constraint.closestTo(d);if(!this._arePointsWithinScreenThreshold(d,E,n)||!Ut(i,n.drawConstraints))return this._resetSnappingState(),t;i.targetPoint=Ht(E),p.push(...i.hints);for(const g of this._currentOtherActiveCandidates)Ut(g,n.drawConstraints)&&(g.targetPoint=Ht(E),p.push(...g.hints));return u!=null&&this.addHandles(u.draw(p,{spatialReference:r,elevationInfo:rs(n),view:a,selfSnappingZ:n.selfSnappingZ}),Wt),_e(E,a,t,n)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case W.MAIN:return e;case W.SCENE:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=W.MAIN}_removeVisualization(){this.removeHandles(Wt)}async _snapSinglePoint({point:e,context:t,signal:n}){const{view:i}=this,{elevationInfo:s}=t,r=ct(e,i,s),o=await this._fetchCandidates(r,L.ALL,t,n);return this._createSnapResult(r,W.MAIN,o,i,e,t,n)}async _snapMultiPoint({point:e,scenePoint:t,context:n,signal:i}){const{view:s}=this,{coordinateHelper:r,elevationInfo:o,spatialReference:a}=n;await wn(t.spatialReference,a);const c=ge(t,a),u=ct(c,s,o),p=await this._fetchCandidates(u,L.FEATURE,n,i);if(p.length>0){const g=await this._fetchCandidates(u,L.SELF,n,i);return this._createSnapResult(u,W.SCENE,[...p,...g],s,c,n,i)}const d=ct(e,s,o),E=await this._fetchCandidates(d,L.SELF,n,i);return this._createSnapResult(d,W.MAIN,E,s,{z:r.hasZ()&&e.hasZ?e.z??0:void 0,m:r.hasM()&&e.hasM?e.m??0:void 0},n,i)}async _fetchCandidates(e,t,n,i){return(await Promise.all(this._engines.map(s=>s.fetchCandidates(e,t,n,i)))).flat()}_createSnapResult(e,t,n,i,s,r,o){return{get valid(){return!fn(o)},apply:()=>{const{spatialReference:a}=r,{snappedPoint:c,hints:u}=this._processCandidates(e,t,n,r);return this._removeVisualization(),r.visualizer!=null&&this.addHandles(r.visualizer.draw(u,{spatialReference:a,elevationInfo:it,view:i,selfSnappingZ:r.selfSnappingZ}),Wt),_e(c,i,s,r)}}}_processCandidates(e,t,n,i){if(n.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),Gi(e,n);const s=this._currentMainCandidate;if(s!=null){const r=is(s,n);if(r>=0){if(!(n[r]instanceof wt))return this._intersectWithOtherCandidates(r,n,e,t,i);if(this._arePointsWithinScreenThreshold(e,s.targetPoint,i))return this._updateSnappingCandidate(s,t,n,i)}}return this._intersectWithOtherCandidates(0,n,e,t,i)}_intersectWithOtherCandidates(e,t,n,i,s){const{coordinateHelper:r}=s,o=t[e],a=[];for(let c=0;c<t.length;++c){if(c===e)continue;const u=t[c],p=o.constraint.intersect(u.constraint);if(p)for(const d of p.closestPoints(o.targetPoint))a.push([new wt(Ht(d),o,u,u.isDraped),this._squaredScreenDistance(n,d,r)])}return a.length>0&&(a.sort((c,u)=>c[1]-u[1]),a[0][1]<this._squaredPointProximityThreshold(s.pointer))?this._updateSnappingCandidate(a[0][0],i,t,s):Ut(o,s.drawConstraints)?this._updateSnappingCandidate(o,i,t,s):{snappedPoint:n,hints:[]}}_updateSnappingCandidate(e,t,n,i){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const s=this._currentMainCandidate.targetPoint,r=[];r.push(...e.hints);for(const o of n){if(e instanceof wt){if(o.constraint.equals(e.first.constraint)||o.constraint.equals(e.second.constraint))continue}else if(o.constraint.equals(e.constraint))continue;const a=o.constraint.closestTo(s);this._squaredScreenDistance(a,s,i.coordinateHelper)<ns()&&(o.targetPoint=s,this._currentOtherActiveCandidates.push(o),r.push(...o.hints))}return{snappedPoint:s,hints:r}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,n){return this._squaredScreenDistance(e,t,n.coordinateHelper)<this._squaredPointProximityThreshold(n.pointer)}_squaredScreenDistance(e,t,n){return ln(this._toScreen(e,n),this._toScreen(t,n))}_toScreen(e,t){return es(e,t.spatialReference,it,this.view)}get test(){}};var W;l([h({constructOnly:!0})],k.prototype,"view",void 0),l([h()],k.prototype,"options",void 0),l([h({readOnly:!0})],k.prototype,"updating",null),l([h()],k.prototype,"_loadTask",void 0),l([h()],k.prototype,"_engines",void 0),l([h()],k.prototype,"_squaredMouseProximityThreshold",null),l([h()],k.prototype,"_squaredTouchProximityThreshold",null),k=l([ht("esri.views.interactive.snapping.SnappingManager")],k),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(W||(W={}));const Wt="visualization-handle";function ns(){return Nt.satisfiesConstraintScreenThreshold*Nt.satisfiesConstraintScreenThreshold}function Ut(e,t){return!t||t.direction==null&&t.distance==null||!(e instanceof Yi||e instanceof Bi||e instanceof Ji||e instanceof Qi||e instanceof ts)&&(!(e instanceof Ki)||t.direction==null&&e.selfSnappingType===At.LastVertex)}function is(e,t){return e instanceof wt?Xt(t,e.first)>=0&&Xt(t,e.second)>=0?0:-1:Xt(t,e)}function Xt(e,t){let n=-1;for(let i=0;i<e.length;++i)if(t.constraint.equals(e[i].constraint)){n=i;break}return n}function ss(e){return e.scenePoint!=null}function rs({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?it:t}export{Ki as A,Rt as B,Xs as C,es as D,Gi as E,Bs as F,tr as G,ks as H,k as I,ct as J,_e as K,rn as L,de as M,Ee as N,Ei as O,Li as P,O as Q,Ks as R,ln as S,Gs as T,Qs as U,Be as V,Qi as W,At as X,ts as Y,wi as Z,Ge as a,qt as b,Ji as c,wt as d,P as e,je as f,Ht as g,Yi as h,Bi as i,J as j,pn as k,rt as l,Ys as m,j as n,oi as o,Nt as p,Js as q,ci as r,Hs as s,Wi as t,hn as u,L as v,Vs as w,M as x,Zs as y,er as z};
