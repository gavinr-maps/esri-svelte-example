var e=Object.defineProperty,r=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,s=(r,a,t)=>a in r?e(r,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[a]=t,o=(e,r)=>{for(var a in r||(r={}))n.call(r,a)&&s(e,a,r[a]);if(t)for(var a of t(r))l.call(r,a)&&s(e,a,r[a]);return e},u=(e,t)=>r(e,a(t));import{r as i,dv as y,q as c,w as d,dw as f,dx as p,cA as b,L as v}from"./vendor.d0a39f0f.js";import{a as I}from"./lazyLayerLoader.87256c2d.js";async function S(e){var r;const a=null==(r=e.properties)?void 0:r.customParameters,t=await async function(e,r){let a=y(e);if(c(a)&&(a=await async function(e,r){var a;const t=await h(e,r);let n=null,l=null;const s=t.type;if("Feature Layer"===s||"Table"===s?(n="FeatureServer",l=t.id):"indexedVector"===s?n="VectorTileServer":t.hasOwnProperty("mapName")?n="MapServer":t.hasOwnProperty("bandCount")&&t.hasOwnProperty("pixelSizeX")?n="ImageServer":t.hasOwnProperty("maxRecordCount")&&t.hasOwnProperty("allowGeometryUpdates")?n="FeatureServer":t.hasOwnProperty("streamUrls")?n="StreamServer":m(t)?(n="SceneServer",l=t.id):t.hasOwnProperty("layers")&&m(null==(a=t.layers)?void 0:a[0])&&(n="SceneServer"),!n)return null;const o=null!=l?f(e):null;return{title:i(o)&&t.name||p(e),serverType:n,sublayer:l,url:{path:i(o)?o.serviceUrl:b(e).path}}}(e,r)),c(a))throw new d("arcgis-layers:url-mismatch","The url '${url}' is not a valid arcgis resource",{url:e});const{serverType:t,sublayer:n}=a;let l;const s={FeatureServer:"FeatureLayer",StreamServer:"StreamLayer",VectorTileServer:"VectorTileLayer"};switch(t){case"MapServer":l=null!=n?"FeatureLayer":async function(e,r){return(await h(e,r)).tileInfo}(e,r).then((e=>e?"TileLayer":"MapImageLayer"));break;case"ImageServer":l=h(e,r).then((e=>{const r=e.tileInfo&&e.tileInfo.format;return e.tileInfo?!r||"LERC"!==r.toUpperCase()||e.cacheType&&"elevation"!==e.cacheType.toLowerCase()?"ImageryTileLayer":"ElevationLayer":"ImageryLayer"}));break;case"SceneServer":l=h(a.url.path,r).then((e=>{const r={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};if(e&&Array.isArray(e.layers)&&e.layers.length>0){const a=e.layers[0].layerType;if(null!=r[a])return r[a]}return"SceneLayer"}));break;default:l=s[t]}const o={FeatureLayer:!0,SceneLayer:!0},u="FeatureServer"===t,v={parsedUrl:a,Constructor:null,layerOrTableId:u?n:null,sublayerIds:null,tableIds:null},S=await l;if(o[S]&&null==n){const a=await async function(e,r,a){var t,n;let l,s=!1;if("FeatureServer"===r){const r=await async function(e,r){var a,t;let n=await h(e,r);n=n||{},n.layers=(null==(a=n.layers)?void 0:a.filter(O))||[];const l={serviceJSON:n};if(n.currentVersion<10.5)return l;const s=await h(e+"/layers",r);return l.layersJSON={layers:(null==s||null==(t=s.layers)?void 0:t.filter(O))||[],tables:(null==s?void 0:s.tables)||[]},l}(e,a);s=!!r.layersJSON,l=r.layersJSON||r.serviceJSON}else l=await h(e,a);const o=null==(t=l)?void 0:t.layers,u=null==(n=l)?void 0:n.tables;return{layerIds:(null==o?void 0:o.map((e=>e.id)).reverse())||[],tableIds:(null==u?void 0:u.map((e=>e.id)).reverse())||[],layerInfos:s?o:[],tableInfos:s?u:[]}}(e,t,r);if(u&&(v.sublayerInfos=a.layerInfos,v.tableInfos=a.tableInfos),a.layerIds.length+a.tableIds.length!==1)v.sublayerIds=a.layerIds,v.tableIds=a.tableIds;else if(u){var w,L;v.layerOrTableId=null!=(w=a.layerIds[0])?w:a.tableIds[0],v.sourceJSON=null!=(L=a.layerInfos[0])?L:a.tableInfos[0]}}return v.Constructor=await async function(e){return(0,I[e])()}(S),v}(e.url,a),n=u(o({},e.properties),{url:e.url});if(!t.sublayerIds)return null!=t.layerOrTableId&&(n.layerId=t.layerOrTableId,n.sourceJSON=t.sourceJSON),new t.Constructor(n);const l=new((await import("./GroupLayer.b585b0c8.js")).default)({title:t.parsedUrl.title});return function(e,r,a){function t(e,t){const n=u(o({},a),{layerId:e,sublayerTitleMode:"service-name"});return i(t)&&(n.sourceJSON=t),new r.Constructor(n)}r.sublayerIds.forEach((a=>{const n=t(a,w(r.sublayerInfos,a));e.add(n)})),r.tableIds.forEach((a=>{const n=t(a,w(r.tableInfos,a));e.tables.add(n)}))}(l,t,n),l}function w(e,r){return e?e.find((e=>e.id===r)):null}function m(e){return(null==e?void 0:e.hasOwnProperty("store"))&&e.hasOwnProperty("id")&&"number"==typeof e.id}function O(e){return!e.type||"Feature Layer"===e.type}async function h(e,r){return(await v(e,{responseType:"json",query:o({f:"json"},r)})).data}export{S as fromUrl};
