const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./groupLayerUtils-DbkOffFU.js","./utils-BGV5vBjY.js","./subclass-BZA_h8Db.js","./originUtils-D69mHv66.js","./multiOriginJSONSupportUtils-C0wm8_Yw.js","./Portal-C10FKnaA.js","./index-Bh2oEzTI.js","./index-2kwcjS9-.css","./tslib.es6-B3Jf3DVX.js","./assets-C43MgM-v.js","./Accessor-BLX9ikPh.js","./Loadable-BabW5Xcc.js","./Promise-B2Hu02L7.js","./writer-DNAwXnhG.js","./Extent-Bf3YTe7m.js","./Point-Cg0-ChZE.js","./cast-Bjksrh93.js","./jsonMap-0cxwUWs2.js","./locale-C9TlLpzi.js","./PortalItem-DzgXrpyc.js","./persistableUrlUtils-fa1mAujs.js","./jsonContext-DueMnVx9.js","./portalItemUtils-BzVoFAku.js","./projection-B971H0Re.js","./SimpleObservable-KocWTzVy.js","./vec3f64-BLpZdpfb.js","./Polyline-D9YkgmM_.js","./mathUtils-C4_ghTv4.js","./projectBuffer-Bs7GwaPY.js","./geodesicConstants-DWQLYX7F.js","./saveUtils-gB1pYTqT.js","./resourceUtils-BZzv7-k7.js","./uuid-fwrPAdZb.js","./resourceUtils-VfNT3fc0.js"])))=>i.map(i=>d[i]);
import{_ as u}from"./index-Bh2oEzTI.js";import{r as o}from"./tslib.es6-B3Jf3DVX.js";import{n as b}from"./CollectionFlattener-CQN6i8ZK.js";import{t as v}from"./loadAll-B6mYSptb.js";import{d as c,m as l,a as f,n as _}from"./subclass-BZA_h8Db.js";import{S as w}from"./MultiOriginJSONSupport-B5nfqtQh.js";import{C as g,d as I,p as L}from"./Accessor-BLX9ikPh.js";import{watch as d,syncAndInitial as O,on as S,sync as y}from"./reactiveUtils-C5zUhJQJ.js";import{r as h,o as $}from"./writer-DNAwXnhG.js";import A from"./Layer-CVt7Hb5J.js";import{l as V}from"./BlendLayer-CXM4n_Ge.js";import{b as P}from"./OperationalLayer-CVyVfSPu.js";import{j as E}from"./PortalLayer-CKja4bdW.js";import{t as M}from"./ScaleRangeLayer-Bb8Ig1Hz.js";import{a as C}from"./lazyLayerLoader-Buplpp4b.js";import T from"./PortalItem-DzgXrpyc.js";import{n as x,l as G,t as R}from"./TablesMixin-5umgS75f.js";import{e as j}from"./tagSymbols-BPcGfZon.js";import{A as m}from"./interfaces-CL2NbQte.js";import{r as H}from"./saveUtils-gB1pYTqT.js";import{f as F}from"./writeUtils-Dz7BsE1e.js";import"./Collection-CEdjem1-.js";import"./Evented-BHRw9x22.js";import"./shared-B3wH2qpO.js";import"./SimpleObservable-KocWTzVy.js";import"./asyncUtils-CWX51uTe.js";import"./Loadable-BabW5Xcc.js";import"./Promise-B2Hu02L7.js";import"./assets-C43MgM-v.js";import"./geometry-D964gYQX.js";import"./Extent-Bf3YTe7m.js";import"./Point-Cg0-ChZE.js";import"./cast-Bjksrh93.js";import"./jsonMap-0cxwUWs2.js";import"./Polyline-D9YkgmM_.js";import"./mathUtils-C4_ghTv4.js";import"./Identifiable-B1UbsKNt.js";import"./TimeExtent-DocT5yPf.js";import"./timeUtils-8fb_2oAt.js";import"./date-DlqISzcw.js";import"./locale-C9TlLpzi.js";import"./jsonUtils-CSnQD004.js";import"./parser-CTsgEym6.js";import"./colorUtils-0bJDPow9.js";import"./utils-93yNk4Xc.js";import"./screenUtils-_ZIvrt5o.js";import"./mat4f32-DcsiF_Rp.js";import"./mat4-GpOFENPA.js";import"./vec3f64-BLpZdpfb.js";import"./common-DQOJ18NT.js";import"./layerContainerType-C5CzMsLd.js";import"./commonProperties-CPyIG_-u.js";import"./persistableUrlUtils-fa1mAujs.js";import"./ElevationInfo-CA5m_tHv.js";import"./fieldUtils-tmQlKvWo.js";import"./intl-CChhNOV8.js";import"./messages-OmQvZhAg.js";import"./unitConversionUtils-BMfW9yAe.js";import"./lengthUtils-DL1-FDQQ.js";import"./AttributeTableTemplate-BZeVyq-j.js";import"./opacityUtils-C68Tlu6_.js";import"./layerUtils-BrNoooE9.js";import"./Portal-C10FKnaA.js";import"./portalItemUtils-BzVoFAku.js";import"./projection-B971H0Re.js";import"./projectBuffer-Bs7GwaPY.js";import"./geodesicConstants-DWQLYX7F.js";import"./requestPresets-B-6DU6iY.js";import"./collectionUtils-D_lHIu88.js";let r=class extends V(M(P(E(x(G(w(A))))))){constructor(i){super(i),this.allLayers=new b({getCollections:()=>[this.layers],getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=R(this),this.fullExtent=void 0,this.operationalLayerType="GroupLayer",this.spatialReference=void 0,this.type="group",this._debouncedSaveOperations=g(async(t,e,s)=>{const{save:a,saveAs:p}=await u(()=>import("./groupLayerUtils-DbkOffFU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33]),import.meta.url);switch(t){case m.SAVE:return a(this,e);case m.SAVE_AS:return p(this,s,e)}})}initialize(){this._enforceVisibility(this.visibilityMode,this.visible),this.addHandles([d(()=>{let i=this.parent;for(;i&&"parent"in i&&i.parent;)i=i.parent;return i&&j in i},i=>{const t="prevent-adding-tables";this.removeHandles(t),i&&(this.tables.removeAll(),this.addHandles(S(()=>this.tables,"before-add",e=>{e.preventDefault(),_.getLogger(this).errorOnce("tables","tables in group layers in a webscene are not supported. Please move the tables from the group layer to the webscene if you want to persist them.")}),t))},O),d(()=>this.visible,this._onVisibilityChange.bind(this),y)])}destroy(){this.allLayers.destroy(),this.allTables.destroy()}get sourceIsPortalItem(){return this.portalItem&&this.originIdOf("portalItem")===I.USER}_writeLayers(i,t,e,s){const a=[];if(!i)return a;i.forEach(p=>{const n=F(p,s.webmap?s.webmap.getLayerJSONFromResourceInfo(p):null,s);n!=null&&n.layerType&&a.push(n)}),t.layers=a}set portalItem(i){this._set("portalItem",i)}readPortalItem(i,t,e){const{itemId:s,layerType:a}=t;if(a==="GroupLayer"&&s)return new T({id:s,portal:e==null?void 0:e.portal})}writePortalItem(i,t){i!=null&&i.id&&(t.itemId=i.id)}set visibilityMode(i){const t=this._get("visibilityMode")!==i;this._set("visibilityMode",i),t&&this._enforceVisibility(i,this.visible)}async beforeSave(){return H(this)}load(i){const t=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Group Layer","Scene Service"],layerModuleTypeMap:C},i).catch(e=>{if(L(e),this.sourceIsPortalItem)throw e});return this.addResolvingPromise(t),Promise.resolve(this)}async loadAll(){return v(this,i=>{i(this.layers,this.tables)})}async save(i){return this._debouncedSaveOperations(m.SAVE,i)}async saveAs(i,t){return this._debouncedSaveOperations(m.SAVE_AS,t,i)}layerAdded(i){i.visible&&this.visibilityMode==="exclusive"?this._turnOffOtherLayers(i):this.visibilityMode==="inherited"&&(i.visible=this.visible),this.hasHandles(i.uid)?console.error(`Layer read to Grouplayer: uid=${i.uid}`):this.addHandles(d(()=>i.visible,t=>this._onChildVisibilityChange(i,t),y),i.uid)}layerRemoved(i){this.removeHandles(i.uid),this._enforceVisibility(this.visibilityMode,this.visible)}_turnOffOtherLayers(i){this.layers.forEach(t=>{t!==i&&(t.visible=!1)})}_enforceVisibility(i,t){if(!c(this).initialized)return;const e=this.layers;let s=e.find(a=>a.visible);switch(i){case"exclusive":e.length&&!s&&(s=e.at(0),s.visible=!0),this._turnOffOtherLayers(s);break;case"inherited":e.forEach(a=>{a.visible=t})}}_onVisibilityChange(i){this.visibilityMode==="inherited"&&this.layers.forEach(t=>{t.visible=i})}_onChildVisibilityChange(i,t){switch(this.visibilityMode){case"exclusive":t?this._turnOffOtherLayers(i):this._isAnyLayerVisible()||(i.visible=!0);break;case"inherited":i.visible=this.visible}}_isAnyLayerVisible(){return this.layers.some(i=>i.visible)}};o([l({readOnly:!0,dependsOn:[]})],r.prototype,"allLayers",void 0),o([l({readOnly:!0})],r.prototype,"allTables",void 0),o([l({json:{read:!0,write:!0}})],r.prototype,"blendMode",void 0),o([l()],r.prototype,"fullExtent",void 0),o([l({readOnly:!0})],r.prototype,"sourceIsPortalItem",null),o([l({json:{read:!1,write:{ignoreOrigin:!0}}})],r.prototype,"layers",void 0),o([h("layers")],r.prototype,"_writeLayers",null),o([l({type:["GroupLayer"]})],r.prototype,"operationalLayerType",void 0),o([l({json:{origins:{"web-map":{read:!1,write:{overridePolicy(i,t,e){return{enabled:(i==null?void 0:i.type)==="Group Layer"&&(e==null?void 0:e.initiator)!==this}}}},"web-scene":{read:!1,write:!1}}}})],r.prototype,"portalItem",null),o([$("web-map","portalItem",["itemId"])],r.prototype,"readPortalItem",null),o([h("web-map","portalItem",{itemId:{type:String}})],r.prototype,"writePortalItem",null),o([l()],r.prototype,"spatialReference",void 0),o([l({json:{read:!1},readOnly:!0,value:"group"})],r.prototype,"type",void 0),o([l({type:["independent","inherited","exclusive"],value:"independent",json:{write:!0,origins:{"web-map":{type:["independent","exclusive"],write:(i,t,e)=>{i!=="inherited"&&(t[e]=i)}}}}})],r.prototype,"visibilityMode",null),r=o([f("esri.layers.GroupLayer")],r);const tt=r;export{tt as default};
