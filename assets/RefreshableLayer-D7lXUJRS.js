import{r as a}from"./tslib.es6-B3Jf3DVX.js";import{m as f,a as c,n as u}from"./subclass-BZA_h8Db.js";import{k as d,C as p,j as v}from"./Accessor-BLX9ikPh.js";import{s as y}from"./cast-Bjksrh93.js";import{a as g}from"./layerContainerType-C5CzMsLd.js";import{V as I}from"./Collection-CEdjem1-.js";import{sync as $}from"./reactiveUtils-C5zUhJQJ.js";const n=new I,o=new WeakMap;function b(e){C(e)&&n.push(new WeakRef(e))}function w(e){const r=n.find(s=>s.deref()===e);r&&n.remove(r)}function C(e){return e!=null&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function m(e,r){return Number.isFinite(e)&&Number.isFinite(r)?r<=0?e:m(r,e%r):0}let h=0,i=0;function D(){const e=Date.now();let r=!1;for(const s of n){const t=s.deref();t?t.refreshInterval&&e-(o.get(t)??0)+5>=6e4*t.refreshInterval&&(o.set(t,e),t.refresh(e)):r=!0}if(r)for(let s=n.length-1;s>=0;s--)n.at(s).deref()||n.removeAt(s)}d(()=>{const e=Date.now();let r=0;for(const s of n){const t=s.deref();t&&(r=m(Math.round(6e4*t.refreshInterval),r),t.refreshInterval?o.get(t)||o.set(t,e):o.delete(t))}if(r!==i){if(i=r,clearInterval(h),i===0)return void(h=0);h=setInterval(D,i)}},$);function F(e){return e!=null&&typeof e=="object"&&"refreshTimestamp"in e&&"refresh"in e}const l=.1,H=e=>{let r=class extends e{constructor(...s){super(...s),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=p(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||b(this)},()=>{})}destroy(){w(this)}castRefreshInterval(s){return s>=l?s:s<=0?0:l}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(s=Date.now()){v(this._debounceHasDataChanged()).then(t=>{t&&this._set("refreshTimestamp",s),this.emit("refresh",{dataChanged:t})},t=>{u.getLogger(this).error(t),this.emit("refresh",{dataChanged:!1,error:t})})}async hasDataChanged(){return!0}get test(){}};return a([f({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:g}}}}})],r.prototype,"refreshInterval",void 0),a([y("refreshInterval")],r.prototype,"castRefreshInterval",null),a([f({readOnly:!0})],r.prototype,"refreshTimestamp",void 0),a([f({readOnly:!0})],r.prototype,"refreshParameters",null),r=a([c("esri.layers.mixins.RefreshableLayer")],r),r};export{H as f,F as m};
