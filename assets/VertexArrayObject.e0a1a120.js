var At=Object.defineProperty;var H=Object.getOwnPropertySymbols;var vt=Object.prototype.hasOwnProperty,Et=Object.prototype.propertyIsEnumerable;var X=(r,t,e)=>t in r?At(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,G=(r,t)=>{for(var e in t||(t={}))vt.call(t,e)&&X(r,e,t[e]);if(H)for(var e of H(t))Et.call(t,e)&&X(r,e,t[e]);return r};import{m as N,o as q,p as W,q as v,r as E,u as yt}from"./vendor.f5642644.js";import{r as g,s as M,o as D,f as Q,c as B}from"./Texture.36d56722.js";const T=N.getLogger("esri.views.webgl.BufferObject");class O{constructor(t,e,i,n,o){this._context=t,this.bufferType=e,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(g.Buffer,this),this._glName=this._context.gl.createBuffer(),M(this._context.gl),n&&this.setData(n,o)}static createIndex(t,e,i,n){return new O(t,34963,e,i,n)}static createVertex(t,e,i){return new O(t,34962,e,i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===34962?this._size:this._indexType===5125?4*this._size:2*this._size}dispose(){var t;(t=this._context)!=null&&t.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(g.Buffer,this),this._context=null):this._glName&&T.warn("Leaked WebGL buffer object")}setData(t,e){if(!t)return;if(typeof t=="number"){if(t<0&&T.error("Buffer size cannot be negative!"),this._size=t,this.bufferType===34963&&e)switch(this._indexType=e,this._size=t,e){case 5123:t*=2;break;case 5125:t*=4}}else{let o=t.byteLength;q(t)&&(o/=2,this._indexType=5123),W(t)&&(o/=4,this._indexType=5125),this._size=o}const i=this._context.getBoundVAO();this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;n.bufferData(this.bufferType,t,this.usage),M(n),this._context.bindVAO(i)}setSubData(t,e=0,i=0,n=t.byteLength){if(!t)return;(e<0||e>=this._size)&&T.error("offset is out of range!");let o=e,s=i,a=n,c=t.byteLength;q(t)?(c/=2,o*=2,s*=2,a*=2):W(t)&&(c/=4,o*=4,s*=4,a*=4),n===void 0&&(n=c-1),i>=n&&T.error("end must be bigger than start!"),e+i-n>this._size&&T.error("An attempt to write beyond the end of the buffer!");const h=this._context.getBoundVAO();this._context.bindVAO(null),this._context.bindBuffer(this);const l=this._context.gl,f=ArrayBuffer.isView(t)?t.buffer:t,d=s===0&&a===t.byteLength?f:f.slice(s,a);l.bufferSubData(this.bufferType,o,d),M(l),this._context.bindVAO(h)}setSubDataFromView(t,e,i,n){if(!t)return;(e<0||e>=this._size)&&T.error("offset is out of range!"),i>=n&&T.error("end must be bigger than start!"),e+i-n>this._size&&T.error("An attempt to write beyond the end of the buffer!");const o=this._context.getBoundVAO();this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl,a=i===0&&n===t.length?t:t.subarray(i,n);s.bufferSubData(this.bufferType,e*t.BYTES_PER_ELEMENT,a),M(s),this._context.bindVAO(o)}}class C{constructor(t,e){this._context=t,this._desc=e,this._context.instanceCounter.increment(g.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this),i.renderbufferStorage(i.RENDERBUFFER,e.internalFormat,e.width,e.height)}get descriptor(){return this._desc}resize(t,e){const i=this._desc;if(i.width===t&&i.height===e)return;i.width=t,i.height=e;const n=this._context.gl;this._context.bindRenderbuffer(this),n.renderbufferStorage(n.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(g.Renderbuffer,this),this._context=null)}}function ne(r,t){return r.vertexBuffers[t].size/St(r.layout[t])}function St(r){return r[0].stride}function Ft(r,t,e,i,n){const o=r.gl,s=r.capabilities.instancing;r.bindBuffer(e);for(const a of i){const c=t.get(a.name);c===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`),a.baseInstance&&!a.divisor&&console.error(`Vertex attribute '${a.name}' uses baseInstanceOffset without divisor.`);const h=(n||(0+a.baseInstance?a.baseInstance:0))*a.stride;if(a.count<=4)o.vertexAttribPointer(c,a.count,a.type,a.normalized,a.stride,a.offset+h),o.enableVertexAttribArray(c),a.divisor>0&&s&&s.vertexAttribDivisor(c,a.divisor);else if(a.count===9)for(let l=0;l<3;l++)o.vertexAttribPointer(c+l,3,a.type,a.normalized,a.stride,a.offset+12*l+h),o.enableVertexAttribArray(c+l),a.divisor>0&&s&&s.vertexAttribDivisor(c+l,a.divisor);else if(a.count===16)for(let l=0;l<4;l++)o.vertexAttribPointer(c+l,4,a.type,a.normalized,a.stride,a.offset+16*l+h),o.enableVertexAttribArray(c+l),a.divisor>0&&s&&s.vertexAttribDivisor(c+l,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function Dt(r,t,e,i){const n=r.gl,o=r.capabilities.instancing;r.bindBuffer(e);for(const s of i){const a=t.get(s.name);if(s.count<=4)n.disableVertexAttribArray(a),s.divisor&&s.divisor>0&&o&&o.vertexAttribDivisor(a,0);else if(s.count===9)for(let c=0;c<3;c++)n.disableVertexAttribArray(a+c),s.divisor&&s.divisor>0&&o&&o.vertexAttribDivisor(a+c,0);else if(s.count===16)for(let c=0;c<4;c++)n.disableVertexAttribArray(a+c),s.divisor&&s.divisor>0&&o&&o.vertexAttribDivisor(a+c,0);else console.error("Unsupported vertex attribute element count: "+s.count)}r.unbindBuffer(34962)}function wt(r){switch(r){case 6406:case 6409:case 36168:case 33778:case 33779:case 37490:case 37491:case 37496:case 37497:return 1;case 6410:case 32854:case 33325:case 32854:case 33189:return 2;case 6407:case 6402:return 3;case 6408:case 34041:case 33326:case 35898:case 33327:case 34041:return 4;case 33328:case 34842:return 8;case 34837:return 12;case 34836:return 16;case 33776:case 33777:case 37488:case 37489:case 37492:case 37493:case 37494:case 37495:return .5}return 0}function z(r){if(v(r))return 0;if("descriptor"in r)return r.glName?z(r.descriptor):0;const t=r.internalFormat||"pixelFormat"in r&&r.pixelFormat;if(!t)return 0;const e="hasMipmap"in r&&r.hasMipmap?1.3:1,i=r.width*r.height;return wt(t)*i*e}const Ut=N.getLogger("esri.views.webgl.FrameBufferObject");class y{constructor(t,e,i=null,n=null){if(this._context=t,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._initialized=!1,this._desc=G({},e),t.instanceCounter.increment(g.Framebuffer,this),E(i)){Array.isArray(i)||(i=[i]);for(let c=0;c<i.length;++c){var o,s;const h=i[c];let l;S(h)?(l=h.descriptor,this._colorAttachments.set(36064+c,h)):(l=h,this._colorAttachments.set(36064+c,new D(t,h))),((o=this._desc)==null?void 0:o.colorTarget)!==0&&((s=this._desc)==null?void 0:s.colorTarget)!==2&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),this._validateColorAttachmentPoint(36064+c),this._validateTextureDimensions(l,this._desc)}}if(n instanceof C){var a;const c=(a=this._desc.depthStencilTarget)!=null?a:3;c===2?this._stencilAttachment=n:c===1||c===3?this._depthAttachment=n:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),Y(n.descriptor,this._desc)}else if(E(n)){let c;this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),S(n)?(this._depthStencilTexture=n,c=n.descriptor):this._depthStencilTexture=new D(this._context,n),this._validateTextureDimensions(c,this._desc)}}dispose(){if(!this._desc)return;const t=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(t),this._context.instanceCounter.decrement(g.Framebuffer,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const t=this._colorAttachments.get(36064);return t&&S(t)?t:null}get colorAttachment(){return this._colorAttachments.get(36064)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width}get height(){return this._desc.height}get gpuMemoryUsage(){return z(this.colorAttachment)+z(this.depthStencilAttachment)}getColorTexture(t){const e=this._colorAttachments.get(t);return e&&S(e)?e:null}framebufferTexture2D(t,e,i=36064,n=3553,o=0){e.framebufferTexture2D(e.FRAMEBUFFER,i,n,t,o)}attachColorTexture(t,e=36064){if(!t)return;this._validateColorAttachmentPoint(e);const i=t.descriptor;this._validateTextureDimensions(i,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(t.glName,this._context.gl,e)),this._colorAttachments.set(e,t)}detachColorTexture(t=36064){const e=this._colorAttachments.get(t);if(S(e)){const i=e;return this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(null,this._context.gl,t)),this._colorAttachments.delete(t),i}}attachDepthStencilTexture(t){if(v(t))return;const e=t.descriptor;e.pixelFormat!==34041&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),e.dataType!==34042&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDimensions(e,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==4&&(this._desc.depthStencilTarget=4),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(t.glName,this._context.gl,Q)),this._depthStencilTexture=t}detachDepthStencilTexture(){const t=this._depthStencilTexture;return t&&this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(null,this._context.gl,Q)),this._depthStencilTexture=null,t}attachDepthStencilBuffer(t){if(v(t))return;const e=t.descriptor;if(e.internalFormat!==34041&&e.internalFormat!==33189&&console.error("Depth/Stencil buffer must have correct internalFormat"),Y(e,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=e.internalFormat===34041?3:1,this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,n=this._desc.depthStencilTarget===1?i.DEPTH_ATTACHMENT:i.DEPTH_STENCIL_ATTACHMENT;i.framebufferRenderbuffer(i.FRAMEBUFFER,n,i.RENDERBUFFER,t.glName)}this._depthAttachment=t}detachDepthStencilBuffer(){const t=this._context.gl,e=this._depthAttachment;if(e&&this._initialized){this._context.bindFramebuffer(this);const i=this._desc.depthStencilTarget===1?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(t.FRAMEBUFFER,i,t.RENDERBUFFER,null)}return this._depthAttachment=null,e}detachAll(){this.detachColorTexture(),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(t,e,i,n,o,s,a){(t<0||e<0||o<0||s<0)&&console.error("Offsets cannot be negative!"),(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");const c=this._desc,h=a.descriptor;a.descriptor.target!==3553&&console.error("Texture target must be TEXTURE_2D!"),(t+i>c.width||e+n>c.height||o+i>h.width||s+n>h.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const l=this._context,f=l.bindTexture(a,D.TEXTURE_UNIT_FOR_UPDATES);l.bindFramebuffer(this),l.gl.copyTexSubImage2D(3553,0,o,s,t,e,i,n),l.bindTexture(f,D.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,e,i,n,o,s,a){(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(t,e,i,n,o,s,a)}resize(t,e){const i=this._desc;if(i.width!==t||i.height!==e){if(!this._initialized)return i.width=t,i.height=e,this._colorAttachments.forEach(n=>{n&&n.resize(t,e)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(t,e));i.width=t,i.height=e,this._colorAttachments.forEach(n=>{n&&n.resize(t,e)}),this._depthStencilTexture!=null?this._depthStencilTexture.resize(t,e):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(t,e),this._stencilAttachment&&this._stencilAttachment.resize(t,e)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(t=3553){var e,i,n,o;const s=this._context.gl;if(this._initialized)return void s.bindFramebuffer(s.FRAMEBUFFER,this.glName);this._glName&&s.deleteFramebuffer(this._glName);const a=this._context,c=s.createFramebuffer(),h=this._desc,l=(e=h.colorTarget)!=null?e:1,f=(i=h.width)!=null?i:1,d=(n=h.height)!=null?n:1;if(s.bindFramebuffer(s.FRAMEBUFFER,c),this._colorAttachments.size===0)if(l===0)this._colorAttachments.set(36064,Mt(a,h,this.descriptor.colorTarget===2?34067:3553));else{const u=new C(a,{internalFormat:32854,width:f,height:d});this._colorAttachments.set(36064,u)}this._colorAttachments.forEach((u,P)=>{u&&(S(u)?this.framebufferTexture2D(u.glName,s,P,t):s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,u.glName))});const m=(o=h.depthStencilTarget)!=null?o:0;switch(m){case 1:case 3:{this._depthAttachment||(this._depthAttachment=new C(a,{internalFormat:h.depthStencilTarget===1?33189:34041,width:f,height:d}));const u=m===1?s.DEPTH_ATTACHMENT:s.DEPTH_STENCIL_ATTACHMENT;s.framebufferRenderbuffer(s.FRAMEBUFFER,u,s.RENDERBUFFER,this._depthAttachment.glName);break}case 2:this._stencilAttachment||(this._stencilAttachment=new C(a,{internalFormat:36168,width:f,height:d})),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.STENCIL_ATTACHMENT,s.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:if(!this._depthStencilTexture){a.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const u={target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:f,height:d};this._depthStencilTexture=new D(a,u)}this.framebufferTexture2D(this._depthStencilTexture.glName,s,s.DEPTH_STENCIL_ATTACHMENT,t)}B()&&s.checkFramebufferStatus(s.FRAMEBUFFER)!==s.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=c,this._initialized=!0}_disposeColorAttachments(){this._colorAttachments.forEach((t,e)=>{if(S(t))this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(null,this._context.gl,e)),t.dispose();else if(t instanceof WebGLRenderbuffer){const i=this._context.gl;this._initialized&&(this._context.bindFramebuffer(this),i.framebufferRenderbuffer(i.FRAMEBUFFER,e,i.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(t)}}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const e=this._desc.depthStencilTarget===1?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(t.FRAMEBUFFER,e,t.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(null,t,t.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateTextureDimensions(t,e){t.target!==3553&&t.target!==34067&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),e.width!==void 0&&e.width>=0&&e.height!==void 0&&e.height>=0?e.width===t.width&&e.height===t.height||console.error("Color attachment texture must match the framebuffer's!"):(e.width=t.width,e.height=t.height)}_validateColorAttachmentPoint(t){if(y._MAX_COLOR_ATTACHMENTS===-1){const i=this._context.capabilities.drawBuffers;if(i){const n=this._context.gl;y._MAX_COLOR_ATTACHMENTS=n.getParameter(i.MAX_COLOR_ATTACHMENTS)}else y._MAX_COLOR_ATTACHMENTS=1}const e=t-36064;e+1>y._MAX_COLOR_ATTACHMENTS&&Ut.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${e+1}. Implementation supports up to ${y._MAX_COLOR_ATTACHMENTS} color attachments`)}}function S(r){return"type"in r&&r.type==="texture"}function Mt(r,t,e){return new D(r,{target:e,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:t.width,height:t.height})}function Y(r,t){t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===r.width&&t.height===r.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=r.width,t.height=r.height)}y._MAX_COLOR_ATTACHMENTS=-1;const Ct=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var Z,K={exports:{}};(Z=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(K.exports=Z);const Rt=K.exports;var J,tt={exports:{}};J=tt,function(r){var t=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];t!==void 0&&(J.exports=t)}();const et=tt.exports;var it={exports:{}};(function(r){(function(t){var e=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]}();e!==void 0&&(r.exports=e)})()})(it);const Pt=it.exports;var p=999,rt=9999,V=0,k=1,nt=2,st=3,ot=4,R=5,Lt=6,Nt=7,Bt=8,at=9,Ot=10,ct=11,zt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function Vt(){var r,t,e,i=0,n=0,o=p,s=[],a=[],c=1,h=0,l=0,f=!1,d=!1,m="";return function(_){return a=[],_!==null?P(_.replace?_.replace(/\r\n/g,`
`):_):ft()};function u(_){_.length&&a.push({type:zt[o],data:_,position:l,line:c,column:h})}function P(_){var A;for(i=0,e=(m+=_).length;r=m[i],i<e;){switch(A=i,o){case V:i=mt();break;case k:i=_t();break;case nt:i=$();break;case st:i=gt();break;case ot:i=xt();break;case ct:i=pt();break;case R:i=bt();break;case rt:i=Tt();break;case at:i=dt();break;case p:i=ut()}A!==i&&(m[A]===`
`?(h=0,++c):++h)}return n+=i,m=m.slice(i),a}function ft(_){return s.length&&u(s.join("")),o=Ot,u("(eof)"),a}function ut(){return s=s.length?[]:s,t==="/"&&r==="*"?(l=n+i-1,o=V,t=r,i+1):t==="/"&&r==="/"?(l=n+i-1,o=k,t=r,i+1):r==="#"?(o=nt,l=n+i,i):/\s/.test(r)?(o=at,l=n+i,i):(f=/\d/.test(r),d=/[^\w_]/.test(r),l=n+i,o=f?ot:d?st:rt,i)}function dt(){return/[^\s]/g.test(r)?(u(s.join("")),o=p,i):(s.push(r),t=r,i+1)}function $(){return r!=="\r"&&r!==`
`||t==="\\"?(s.push(r),t=r,i+1):(u(s.join("")),o=p,i)}function _t(){return $()}function mt(){return r==="/"&&t==="*"?(s.push(r),u(s.join("")),o=p,i+1):(s.push(r),t=r,i+1)}function gt(){if(t==="."&&/\d/.test(r))return o=R,i;if(t==="/"&&r==="*")return o=V,i;if(t==="/"&&r==="/")return o=k,i;if(r==="."&&s.length){for(;L(s););return o=R,i}if(r===";"||r===")"||r==="("){if(s.length)for(;L(s););return u(r),o=p,i+1}var _=s.length===2&&r!=="=";if(/[\w_\d\s]/.test(r)||_){for(;L(s););return o=p,i}return s.push(r),t=r,i+1}function L(_){for(var A,w,I=0;;){if(A=et.indexOf(_.slice(0,_.length+I).join("")),w=et[A],A===-1){if(I--+_.length>0)continue;w=_.slice(0,1).join("")}return u(w),l+=w.length,(s=s.slice(w.length)).length}}function pt(){return/[^a-fA-F0-9]/.test(r)?(u(s.join("")),o=p,i):(s.push(r),t=r,i+1)}function xt(){return r==="."||/[eE]/.test(r)?(s.push(r),o=R,t=r,i+1):r==="x"&&s.length===1&&s[0]==="0"?(o=ct,s.push(r),t=r,i+1):/[^\d]/.test(r)?(u(s.join("")),o=p,i):(s.push(r),t=r,i+1)}function bt(){return r==="f"&&(s.push(r),t=r,i+=1),/[eE]/.test(r)||r==="-"&&/[eE]/.test(t)?(s.push(r),t=r,i+1):/[^\d]/.test(r)?(u(s.join("")),o=p,i):(s.push(r),t=r,i+1)}function Tt(){if(/[^\d\w_]/.test(r)){var _=s.join("");return o=Rt.indexOf(_)>-1?Bt:Pt.indexOf(_)>-1?Nt:Lt,u(s.join("")),o=p,i}return s.push(r),t=r,i+1}}function kt(r){var t=Vt(),e=[];return e=(e=e.concat(t(r))).concat(t(null))}function jt(r){return kt(r)}function $t(r){return r.map(t=>t.type!=="eof"?t.data:"").join("")}const j=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function It(r,t="100",e="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const n of r)if(n.type==="preprocessor"){const o=i.exec(n.data);if(o){const s=o[1].replace(/\s\s+/g," ");if(s===e)return s;if(s===t)return n.data="#version "+e,t;throw new Error("unknown glsl version: "+s)}}return r.splice(0,0,{type:"preprocessor",data:"#version "+e},{type:"whitespace",data:`
`}),null}function Ht(r,t){for(let e=t-1;e>=0;e--){const i=r[e];if(i.type!=="whitespace"&&i.type!=="block-comment"){if(i.type!=="keyword")break;if(i.data==="attribute"||i.data==="in")return!0}}return!1}function U(r,t,e,i){i=i||e;for(const n of r)if(n.type==="ident"&&n.data===e)return i in t?t[i]++:t[i]=0,U(r,t,i+"_"+t[i],i);return e}function ht(r,t,e="afterVersion"){function i(c,h){for(let l=h;l<c.length;l++){const f=c[l];if(f.type==="operator"&&f.data===";")return l}return null}function n(c){let h=-1,l=0,f=-1;for(let d=0;d<c.length;d++){const m=c[d];if(m.type==="preprocessor"&&(m.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++l:m.data.match(/\#endif\s*.*/)&&--l),e!=="afterVersion"&&e!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(f=Math.max(f,d)),e==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const u=i(c,d);if(u===null)throw new Error("precision statement not followed by any semicolons!");f=Math.max(f,u)}h<f&&l===0&&(h=d)}return h+1}const o={data:`
`,type:"whitespace"},s=c=>c<r.length&&/[^\r\n]$/.test(r[c].data);let a=n(r);s(a-1)&&r.splice(a++,0,o);for(const c of t)r.splice(a++,0,c);s(a-1)&&s(a)&&r.splice(a,0,o)}function Xt(r,t,e,i="lowp"){ht(r,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:e},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function Gt(r,t,e,i,n="lowp"){ht(r,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:e},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function qt(r,t){let e,i,n=-1;for(let o=t;o<r.length;o++){const s=r[o];if(s.type==="operator"&&(s.data==="["&&(e=o),s.data==="]")){i=o;break}s.type==="integer"&&(n=parseInt(s.data,10))}return e&&i&&r.splice(e,i-e+1),n}function Wt(r,t){const e=Qt();if(E(e))return e;const i=jt(r);if(It(i,"100","300 es")==="300 es")throw new Error("shader is already glsl 300 es");let n=null,o=null;const s={},a={};for(let c=0;c<i.length;++c){const h=i[c];switch(h.type){case"keyword":t===35633&&h.data==="attribute"?h.data="in":h.data==="varying"&&(h.data=t===35633?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(h.data.trim())&&(h.data=h.data.replace(/(2D|Cube|EXT)/g,"")),t===35632&&h.data==="gl_FragColor"&&(n||(n=U(i,s,"fragColor"),Xt(i,n,"vec4")),h.data=n),t===35632&&h.data==="gl_FragData"){const l=qt(i,c+1),f=U(i,s,"fragData");Gt(i,f,"vec4",l,"mediump"),h.data=f}else t===35632&&h.data==="gl_FragDepthEXT"&&(o||(o=U(i,s,"gl_FragDepth")),h.data=o);break;case"ident":if(Ct.indexOf(h.data)>=0){if(t===35633&&Ht(i,c))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");h.data in a||(a[h.data]=U(i,s,h.data)),h.data=a[h.data]}}}for(let c=i.length-1;c>=0;--c){const h=i[c];if(h.type==="preprocessor"){const l=h.data.match(/\#extension\s+(.*)\:/);if(l&&l[1]&&j.indexOf(l[1].trim())>=0){const m=i[c+1];i.splice(c,m&&m.type==="whitespace"?2:1)}const f=h.data.match(/\#ifdef\s+(.*)/);f&&f[1]&&j.indexOf(f[1].trim())>=0&&(h.data="#if 1");const d=h.data.match(/\#ifndef\s+(.*)/);d&&d[1]&&j.indexOf(d[1].trim())>=0&&(h.data="#if 0")}}return Yt(r,$t(i))}function Qt(r){return null}function Yt(r,t){return t}class se{constructor(t,e,i,n){this._context=t,this._locations=n,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v={},this._nameToUniform2={},this._nameToUniform3={},this._nameToUniform4={},this._nameToUniformMatrix3={},this._nameToUniformMatrix4={},t||console.error("RenderingContext isn't initialized!"),e.length===0&&console.error("Shaders source should not be empty!"),this._vShader=lt(this._context,35633,e),this._fShader=lt(this._context,35632,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(g.VertexShader,this),this._context.instanceCounter.increment(g.FragmentShader,this)}get glName(){if(E(this._glName))return this._glName;if(v(this._vShader))return null;const t=this._context.gl,e=t.createProgram();return t.attachShader(e,this._vShader),t.attachShader(e,this._fShader),this._locations.forEach((i,n)=>t.bindAttribLocation(e,i,n)),t.linkProgram(e),B()&&!t.getProgramParameter(e,t.LINK_STATUS)&&console.error(`Could not link shader
validated: ${t.getProgramParameter(e,t.VALIDATE_STATUS)}, gl error ${t.getError()}, vertex: ${t.getShaderParameter(this._vShader,t.COMPILE_STATUS)}, fragment: ${t.getShaderParameter(this._fShader,t.COMPILE_STATUS)}, info log: ${t.getProgramInfoLog(e)}`),this._glName=e,this._context.instanceCounter.increment(g.Program,this),e}dispose(){const t=this._context.gl;this._vShader&&(t.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(g.VertexShader,this)),this._fShader&&(t.deleteShader(this._fShader),this._fShader=null,this._context.instanceCounter.decrement(g.FragmentShader,this)),this._glName&&(t.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(g.Program,this))}_getUniformLocation(t){return this._nameToUniformLocation[t]===void 0&&(this._nameToUniformLocation[t]=this._context.gl.getUniformLocation(this.glName,t)),this._nameToUniformLocation[t]}hasUniform(t){return this._getUniformLocation(t)!==null}setUniform1i(t,e){const i=this._nameToUniform1[t];(i===void 0||e!==i)&&(this._context.useProgram(this),this._context.gl.uniform1i(this._getUniformLocation(t),e),this._nameToUniform1[t]=e)}setUniform1iv(t,e){const i=this._nameToUniform1v[t];x(i,e)&&(this._context.useProgram(this),this._context.gl.uniform1iv(this._getUniformLocation(t),e),i===void 0?this._nameToUniform1v[t]=Array.from(e):b(e,i))}setUniform2iv(t,e){const i=this._nameToUniform2[t];x(i,e)&&(this._context.useProgram(this),this._context.gl.uniform2iv(this._getUniformLocation(t),e),i===void 0?this._nameToUniform2[t]=Array.from(e):b(e,i))}setUniform3iv(t,e){const i=this._nameToUniform3[t];x(i,e)&&(this._context.useProgram(this),this._context.gl.uniform3iv(this._getUniformLocation(t),e),i===void 0?this._nameToUniform3[t]=Array.from(e):b(e,i))}setUniform4iv(t,e){const i=this._nameToUniform4[t];x(i,e)&&(this._context.useProgram(this),this._context.gl.uniform4iv(this._getUniformLocation(t),e),i===void 0?this._nameToUniform4[t]=Array.from(e):b(e,i))}setUniform1f(t,e){const i=this._nameToUniform1[t];(i===void 0||e!==i)&&(this._context.useProgram(this),this._context.gl.uniform1f(this._getUniformLocation(t),e),this._nameToUniform1[t]=e)}setUniform1fv(t,e){const i=this._nameToUniform1v[t];x(i,e)&&(this._context.useProgram(this),this._context.gl.uniform1fv(this._getUniformLocation(t),e),i===void 0?this._nameToUniform1v[t]=Array.from(e):b(e,i))}setUniform2f(t,e,i){const n=this._nameToUniform2[t];(n===void 0||e!==n[0]||i!==n[1])&&(this._context.useProgram(this),this._context.gl.uniform2f(this._getUniformLocation(t),e,i),n===void 0?this._nameToUniform2[t]=[e,i]:(n[0]=e,n[1]=i))}setUniform2fv(t,e){const i=this._nameToUniform2[t];x(i,e)&&(this._context.useProgram(this),this._context.gl.uniform2fv(this._getUniformLocation(t),e),i===void 0?this._nameToUniform2[t]=Array.from(e):b(e,i))}setUniform3f(t,e,i,n){const o=this._nameToUniform3[t];(o===void 0||e!==o[0]||i!==o[1]||n!==o[2])&&(this._context.useProgram(this),this._context.gl.uniform3f(this._getUniformLocation(t),e,i,n),o===void 0?this._nameToUniform3[t]=[e,i,n]:(o[0]=e,o[1]=i,o[2]=n))}setUniform3fv(t,e){const i=this._nameToUniform3[t];x(i,e)&&(this._context.useProgram(this),this._context.gl.uniform3fv(this._getUniformLocation(t),e),i===void 0?this._nameToUniform3[t]=Array.from(e):b(e,i))}setUniform4f(t,e,i,n,o){const s=this._nameToUniform4[t];(s===void 0||e!==s[0]||i!==s[1]||n!==s[2]||o!==s[3])&&(this._context.useProgram(this),this._context.gl.uniform4f(this._getUniformLocation(t),e,i,n,o),s===void 0?this._nameToUniform4[t]=[e,i,n,o]:(s[0]=e,s[1]=i,s[2]=n,s[3]=o))}setUniform4fv(t,e){const i=this._nameToUniform4[t];x(i,e)&&(this._context.useProgram(this),this._context.gl.uniform4fv(this._getUniformLocation(t),e),i===void 0?this._nameToUniform4[t]=Array.from(e):b(e,i))}setUniformMatrix3fv(t,e,i=!1,n=!1){const o=this._nameToUniformMatrix3[t];(n?o!==e:Jt(o,e))&&(this._context.useProgram(this),this._context.gl.uniformMatrix3fv(this._getUniformLocation(t),i,e),o===void 0?this._nameToUniformMatrix3[t]=Array.from(e):b(e,o))}setUniformMatrix4fv(t,e,i=!1){const n=this._nameToUniformMatrix4[t];te(n,e)&&(this._context.useProgram(this),this._context.gl.uniformMatrix4fv(this._getUniformLocation(t),i,e),n===void 0?this._nameToUniformMatrix4[t]=Array.from(e):b(e,n))}assertCompatibleVertexAttributeLocations(t){t.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){}}function x(r,t){if(v(r)||r.length!==t.length)return!0;for(let e=0;e<r.length;++e)if(r[e]!==t[e])return!0;return!1}function lt(r,t,e){const i=r.webglVersion==="webgl2"?Wt(e,t):e,n=r.gl,o=n.createShader(t);return n.shaderSource(o,i),n.compileShader(o),B()&&!n.getShaderParameter(o,n.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===35633?"vertex":"fragment"," shader")),console.error(n.getShaderInfoLog(o)),console.error(Zt(i)),r.webglVersion==="webgl2"&&(console.log("Shader source before transpilation:"),console.log(e))),o}function Zt(r){let t=2;return r.replace(/\n/g,()=>`
`+Kt(t++)+":")}function Kt(r){return r>=1e3?r.toString():("  "+r).slice(-3)}function b(r,t){for(let e=0;e<r.length;++e)t[e]=r[e]}function Jt(r,t){return!!v(r)||(r.length!==9?x(r,t):r.length!==9||r[0]!==t[0]||r[1]!==t[1]||r[2]!==t[2]||r[3]!==t[3]||r[4]!==t[4]||r[5]!==t[5]||r[6]!==t[6]||r[7]!==t[7]||r[8]!==t[8])}function te(r,t){return!!v(r)||(r.length!==16?x(r,t):r.length!==16||r[0]!==t[0]||r[1]!==t[1]||r[2]!==t[2]||r[3]!==t[3]||r[4]!==t[4]||r[5]!==t[5]||r[6]!==t[6]||r[7]!==t[7]||r[8]!==t[8]||r[9]!==t[9]||r[10]!==t[10]||r[11]!==t[11]||r[12]!==t[12]||r[13]!==t[13]||r[14]!==t[14]||r[15]!==t[15])}const F=N.getLogger("esri.views.webgl.VertexArrayObject");class oe{constructor(t,e,i,n,o=null){this._context=t,this._locations=e,this._layout=i,this._buffers=n,this._indexBuffer=o,this._glName=null,this._initialized=!1,t.instanceCounter.increment(g.VAO,this)}get glName(){return this._glName}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((t,e)=>t+this._buffers[e].size,E(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(t=!0){if(!this._context)return void((this._glName||t&&Object.getOwnPropertyNames(this._buffers).length>0)&&F.warn("Leaked WebGL VAO"));if(this._glName){var e,i;const n=(e=this._context)==null||(i=e.capabilities)==null?void 0:i.vao;n?(n.deleteVertexArray(this._glName),this._glName=null):F.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),t){for(const n in this._buffers)this._buffers[n].dispose(),delete this._buffers[n];this._indexBuffer=yt(this._indexBuffer)}this._context.instanceCounter.decrement(g.VAO,this),this._context=null}initialize(){if(this._initialized)return;const t=this._context.capabilities.vao;if(t){const e=t.createVertexArray();t.bindVertexArray(e),this._bindLayout(),t.bindVertexArray(null),this._glName=e}this._initialized=!0}bind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:t,_layout:e,_indexBuffer:i}=this;t||F.error("Vertex buffer dictionary is empty!");const n=this._context.gl;for(const o in t){const s=t[o];s||F.error("Vertex buffer is uninitialized!");const a=e[o];a||F.error("Vertex element descriptor is empty!"),Ft(this._context,this._locations,s,a)}E(i)&&(this._context.capabilities.vao?n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:t,_layout:e}=this;t||F.error("Vertex buffer dictionary is empty!");for(const i in t){const n=t[i];n||F.error("Vertex buffer is uninitialized!");const o=e[i];Dt(this._context,this._locations,n,o)}E(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}export{wt as a,C as e,oe as f,y as l,se as n,O as o,ne as r};
