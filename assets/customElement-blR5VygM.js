import{i as T,L as y,u as b,c as f,n as E,x as p,s as u,d as M,b as I,a as P}from"./index-tefRSezt.js";import{r as _}from"./index-BkKcLxWB.js";import{r as e,m as a,a as $,j as O,k as F,E as S}from"./Accessor-BHnuXKD2.js";import{b as C}from"./GeolocationPositioning-C-Mrji1g.js";import{s as W}from"./useT9n-B0I3cNlQ.js";import{u as x}from"./useViewModel-BxErfUSG.js";import{e as k}from"./globalCss-CyPh17x2.js";import"./Graphic-CFXUQZlS.js";import"./Clonable-DvJsj5LF.js";import"./reactiveUtils-BR0C1Kq4.js";import"./Evented-DCWccWGU.js";import"./SimpleObservable-7oieNGD8.js";import"./JSONSupport-CGdeqxpk.js";import"./cast-BA_-jlhc.js";import"./writer-B2bQV2uU.js";import"./opacityUtils-CSd4XoR2.js";import"./Promise-CmQqe-ke.js";import"./Point-XGrwlf63.js";import"./enumeration-Cr5WIZs4.js";import"./Color-gncXBiLc.js";import"./colorUtils-Rxh2V3ai.js";import"./mathUtils-DV9iOXpW.js";import"./ActionToggle-__-l4AdQ.js";import"./Identifiable-BrT7zvUW.js";import"./jsonUtils-Cu7OBRmN.js";import"./Extent-CBBGeHb-.js";import"./Polyline-BmuD2-ZN.js";import"./typeUtils-BSg8Y507.js";import"./TextSymbol-BQ_NW9Xo.js";import"./screenUtils-_ZIvrt5o.js";import"./collectionUtils-CbaToa73.js";import"./Portal-CTRRujjZ.js";import"./vec3f64-BLpZdpfb.js";import"./aaBoundingBox-CeBivBRq.js";import"./geolocationUtils-IqcQdGRn.js";import"./project-BoEABhcm.js";import"./utils-Cy8wFNQo.js";import"./utils-CkSELPnj.js";import"./GoTo-BsXOAO95.js";import"./component-utils-DWY0IMHC.js";const D=15e3;let r=class extends C{constructor(i){super(i),this._watchId=void 0,this._trackStartingTimeoutId=void 0,this._settingPosition=null,this._trackController=null,this.error=void 0,this.positionFilterFunction=null}destroy(){this._stopTracking()}get state(){return this._geolocationUsable?this.view&&!this.view.ready?"disabled":this._settingPosition||this._trackStartingTimeoutId!==void 0?"waiting":this.tracking?"tracking":this.error!=null?"error":"ready":"feature-unsupported"}get tracking(){return this._watchId!==void 0}start(){this.state!=="disabled"&&this.state!=="feature-unsupported"&&this._startTracking()}stop(){this.state!=="disabled"&&this.state!=="feature-unsupported"&&this._stopTracking()}_stopWatchingPosition(){this._watchId!==void 0&&(navigator.geolocation.clearWatch(this._watchId),this._watchId=void 0)}_stopTracking(){this._abortTrack(),this._clearWaitingTimer(),this._stopWatchingPosition(),this._clearGraphic()}_startTracking(){this._stopTracking();const i=F(async t=>{this._abortTrack();const o=new AbortController;this._trackController=o;const{timestamp:n,coords:s}=t,h={timestamp:n,coords:{...s}};this.error=void 0;try{if(typeof this.positionFilterFunction=="function"&&!this.positionFilterFunction.call(null,{position:h})||(await this.updatePosition(t,o),this._trackController!==o))return;this._clearWaitingTimer(),this._addGraphic(),this.emit("track",{position:t}),this._trackController=null}catch(c){if(S(c))return;throw this._trackController=null,this._emitError(c),this._clearWaitingTimer(),c}},0);this._watchId=navigator.geolocation.watchPosition(t=>{this._settingPosition=i(t).catch(O)},this._handleWatchPositionError.bind(this),this.geolocationOptions??void 0),this._trackStartingTimeoutId=setTimeout(()=>{this._trackStartingTimeoutId=void 0},D)}_handleWatchPositionError(i){i.code===i.PERMISSION_DENIED&&this._stopTracking(),this._emitError(i)}_abortTrack(){var i;(i=this._trackController)==null||i.abort(),this._trackController=null}_clearWaitingTimer(){clearTimeout(this._trackStartingTimeoutId),this._trackStartingTimeoutId=void 0,this._settingPosition=null}_emitError(i){this.error=i,this.emit("track-error",{error:i})}};e([a()],r.prototype,"_watchId",void 0),e([a()],r.prototype,"_trackStartingTimeoutId",void 0),e([a()],r.prototype,"_settingPosition",void 0),e([a()],r.prototype,"error",void 0),e([a()],r.prototype,"positionFilterFunction",void 0),e([a({readOnly:!0})],r.prototype,"state",null),e([a({readOnly:!0})],r.prototype,"tracking",null),e([a()],r.prototype,"start",null),e([a()],r.prototype,"stop",null),r=e([$("esri.widgets.Track.TrackViewModel")],r);const G=r;/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
v4.32.12 */const L=T`@layer{arcgis-track{display:block}}`,R={base:"esri-track"},N=x(G),l=class l extends y{constructor(){super(...arguments),this.messages=W(),this.viewModel=N(this),this.autoDestroyDisabled=!1,this.error=this.viewModel.error,this.geolocationOptions=this.viewModel.geolocationOptions,this.goToOverride=this.viewModel.goToOverride,this.goToLocationDisabled=this.viewModel.goToLocationEnabled,this.graphic=this.viewModel.graphic,this.icon="compass-north-circle",this.position="top-left",this.positionFilterFunction=this.viewModel.positionFilterFunction,this.scale=this.viewModel.scale,this.state=this.viewModel.state,this.tracking=this.viewModel.tracking,this.arcgisComplete=_(()=>this.viewModel,"track"),this.arcgisError=_(()=>this.viewModel,"track-error"),this.arcgisPropertyChange=b()("state"),this.arcgisReady=f()}async destroy(){await this.manager.destroy()}async start(){this.viewModel.start()}async stop(){this.viewModel.stop()}_localizeError(t){var o,n,s;if(t instanceof GeolocationPositionError)return t.code===GeolocationPositionError.PERMISSION_DENIED?(o=this.messages)==null?void 0:o.permissionError:t.code===GeolocationPositionError.TIMEOUT?(n=this.messages)==null?void 0:n.timeoutError:(s=this.messages)==null?void 0:s.positionUnavailable;if(t instanceof Error)return t.message}_toggleTracking(){if(!this.viewModel)return;const{state:t}=this.viewModel;if(!(t==="feature-unsupported"||t==="disabled")){if(t==="tracking"||t==="waiting"){this.viewModel.stop();return}this.viewModel.start()}}render(){var m;const{viewModel:t,messages:o,icon:n}=this,s=t==null?void 0:t.state,h=s==="tracking",c=this._localizeError((m=this.viewModel)==null?void 0:m.error),g=(h?o==null?void 0:o.stopTracking:o==null?void 0:o.startTracking)??"",v=s==="feature-unsupported",w=(s==="tracking"?"pause":void 0)??n??void 0;return p`<div class=${u(M(R.base,k.widget))}>${!v&&p`<calcite-button class=${u(k.widgetButton)} .disabled=${s==="disabled"} .iconStart=${w} kind=neutral .label=${g} .loading=${s==="waiting"} @click=${this._toggleTracking} title=${g??I}></calcite-button>`||""}${c?p`<calcite-tooltip open overlay-positioning=fixed .referenceElement=${this.el}>${c}</calcite-tooltip>`:null}</div>`}};l.properties={autoDestroyDisabled:5,error:1,geolocationOptions:1,goToOverride:0,goToLocationDisabled:7,graphic:0,icon:3,label:1,messageOverrides:0,position:3,positionFilterFunction:0,referenceElement:1,scale:9,state:0,tracking:4},l.shadowRootOptions=E,l.styles=L;let d=l;P("arcgis-track",d);export{d as ArcgisTrack};
