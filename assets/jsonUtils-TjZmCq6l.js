import{s as x,_ as qe}from"./Accessor-BHnuXKD2.js";import{i as Me,r as Re,a as ze,o as Ie}from"./colorUtils-Rxh2V3ai.js";import{t as Ne,e as Te,p as Be,f as De,m as Je,l as Le,d as Ue,c as Ge,a as _e}from"./utils-DYurMneM.js";function He(e,a){function c(){this.constructor=e}c.prototype=a.prototype,e.prototype=new c}function I(e,a,c,n){var f=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(f,I.prototype),f.expected=a,f.found=c,f.location=n,f.name="SyntaxError",f}function _(e,a,c){return c=c||" ",e.length>a?e:(a-=e.length,e+(c+=c.repeat(a)).slice(0,a))}function Ke(e,a){var c,n={},f=(a=a!==void 0?a:{}).grammarSource,F={start:gt},q=gt,M="none",R=")",h=",",d="(",C="%",y="px",V="cm",W="mm",X="in",Y="pt",Z="pc",tt="deg",et="rad",nt="grad",rt="turn",xt="#",At=".",$t="e",ut=/^[ \t\n\r]/,at=/^[a-z\-]/,ot=/^[0-9a-fA-F]/,ct=/^[+\-]/,P=/^[0-9]/,Ft=k("none"),Ct=w("none",!1),Et=w(")",!1),it=w(",",!1),jt=k("whitespace"),st=T([" ","	",`
`,"\r"],!1,!1),kt=k("function"),Ot=w("(",!1),Pt=k("identifier"),lt=T([["a","z"],"-"],!1,!1),St=k("percentage"),qt=w("%",!1),Mt=k("length"),Rt=w("px",!1),zt=w("cm",!1),It=w("mm",!1),Nt=w("in",!1),Tt=w("pt",!1),Bt=w("pc",!1),Dt=k("angle"),Jt=w("deg",!1),Lt=w("rad",!1),Ut=w("grad",!1),Gt=w("turn",!1),_t=k("number"),Ht=k("color"),Kt=w("#",!1),ft=T([["0","9"],["a","f"],["A","F"]],!1,!1),pt=T(["+","-"],!1,!1),S=T([["0","9"]],!1,!1),Qt=w(".",!1),Vt=w("e",!1),Wt=function(){return[]},Xt=function(t,u){return{type:"function",name:t,parameters:u||[]}},Yt=function(t,u){return u.length>0?Se(t,u,3):[t]},Zt=function(t){return{type:"quantity",value:t.value,unit:t.unit}},te=function(t){return{type:"color",colorType:t.type,value:t.value}},ee=function(t){return t},ne=function(){return J()},re=function(t){return{value:t,unit:"%"}},ue=function(t){return{value:t,unit:"px"}},ae=function(t){return{value:t,unit:"cm"}},oe=function(t){return{value:t,unit:"mm"}},ce=function(t){return{value:t,unit:"in"}},ie=function(t){return{value:t,unit:"pt"}},se=function(t){return{value:t,unit:"pc"}},le=function(t){return{value:t,unit:"deg"}},fe=function(t){return{value:t,unit:"rad"}},pe=function(t){return{value:t,unit:"grad"}},he=function(t){return{value:t,unit:"turn"}},me=function(t){return{value:t,unit:null}},ge=function(){return{type:"hex",value:J()}},de=function(t){return{type:"function",value:t}},ve=function(){return{type:"named",value:J()}},ye=function(){return parseFloat(J())},r=0|a.peg$currPos,m=r,z=[{line:1,column:1}],E=r,D=a.peg$maxFailExpected||[],i=0|a.peg$silentFails;if(a.startRule){if(!(a.startRule in F))throw new Error(`Can't start parsing from rule "`+a.startRule+'".');q=F[a.startRule]}function J(){return e.substring(m,r)}function w(t,u){return{type:"literal",text:t,ignoreCase:u}}function T(t,u,o){return{type:"class",parts:t,inverted:u,ignoreCase:o}}function we(){return{type:"end"}}function k(t){return{type:"other",description:t}}function ht(t){var u,o=z[t];if(o)return o;if(t>=z.length)u=z.length-1;else for(u=t;!z[--u];);for(o={line:(o=z[u]).line,column:o.column};u<t;)e.charCodeAt(u)===10?(o.line++,o.column=1):o.column++,u++;return z[t]=o,o}function mt(t,u,o){var s=ht(t),p=ht(u);return{source:f,start:{offset:t,line:s.line,column:s.column},end:{offset:u,line:p.line,column:p.column}}}function l(t){r<E||(r>E&&(E=r,D=[]),D.push(t))}function be(t,u,o){return new I(I.buildMessage(t,u),t,u,o)}function gt(){var t;return(t=xe())===n&&(t=Ae()),t}function xe(){var t,u;return i++,t=r,b(),e.substr(r,4)===M?(u=M,r+=4):(u=n,i===0&&l(Ct)),u!==n?(b(),m=t,t=Wt()):(r=t,t=n),i--,t===n&&i===0&&l(Ft),t}function Ae(){var t,u;if(t=[],(u=U())!==n)for(;u!==n;)t.push(u),u=U();else t=n;return t}function U(){var t,u,o,s;return t=r,b(),(u=Fe())!==n?(b(),(o=$e())===n&&(o=null),b(),e.charCodeAt(r)===41?(s=R,r++):(s=n,i===0&&l(Et)),s!==n?(b(),m=t,t=Xt(u,o)):(r=t,t=n)):(r=t,t=n),t}function $e(){var t,u,o,s,p,g,v,A;if(t=r,(u=G())!==n){for(o=[],s=r,p=b(),e.charCodeAt(r)===44?(g=h,r++):(g=n,i===0&&l(it)),g===n&&(g=null),v=b(),(A=G())!==n?s=p=[p,g,v,A]:(r=s,s=n);s!==n;)o.push(s),s=r,p=b(),e.charCodeAt(r)===44?(g=h,r++):(g=n,i===0&&l(it)),g===n&&(g=null),v=b(),(A=G())!==n?s=p=[p,g,v,A]:(r=s,s=n);m=t,t=Yt(u,o)}else r=t,t=n;return t}function G(){var t,u;return t=r,(u=Ce())===n&&(u=Ee())===n&&(u=je())===n&&(u=ke()),u!==n&&(m=t,u=Zt(u)),(t=u)===n&&(t=r,(u=Oe())!==n&&(m=t,u=te(u)),t=u),t}function b(){var t,u;for(i++,t=[],u=e.charAt(r),ut.test(u)?r++:(u=n,i===0&&l(st));u!==n;)t.push(u),u=e.charAt(r),ut.test(u)?r++:(u=n,i===0&&l(st));return i--,u=n,i===0&&l(jt),t}function Fe(){var t,u,o;return i++,t=r,(u=dt())!==n?(e.charCodeAt(r)===40?(o=d,r++):(o=n,i===0&&l(Ot)),o!==n?(m=t,t=ee(u)):(r=t,t=n)):(r=t,t=n),i--,t===n&&(u=n,i===0&&l(kt)),t}function dt(){var t,u,o;if(i++,t=r,u=[],o=e.charAt(r),at.test(o)?r++:(o=n,i===0&&l(lt)),o!==n)for(;o!==n;)u.push(o),o=e.charAt(r),at.test(o)?r++:(o=n,i===0&&l(lt));else u=n;return u!==n&&(m=t,u=ne()),i--,(t=u)===n&&(u=n,i===0&&l(Pt)),t}function Ce(){var t,u,o;return i++,t=r,b(),(u=$())!==n?(e.charCodeAt(r)===37?(o=C,r++):(o=n,i===0&&l(qt)),o!==n?(m=t,t=re(u)):(r=t,t=n)):(r=t,t=n),i--,t===n&&i===0&&l(St),t}function Ee(){var t,u,o;return i++,t=r,b(),(u=$())!==n?(e.substr(r,2)===y?(o=y,r+=2):(o=n,i===0&&l(Rt)),o!==n?(m=t,t=ue(u)):(r=t,t=n)):(r=t,t=n),t===n&&(t=r,b(),(u=$())!==n?(e.substr(r,2)===V?(o=V,r+=2):(o=n,i===0&&l(zt)),o!==n?(m=t,t=ae(u)):(r=t,t=n)):(r=t,t=n),t===n&&(t=r,b(),(u=$())!==n?(e.substr(r,2)===W?(o=W,r+=2):(o=n,i===0&&l(It)),o!==n?(m=t,t=oe(u)):(r=t,t=n)):(r=t,t=n),t===n&&(t=r,b(),(u=$())!==n?(e.substr(r,2)===X?(o=X,r+=2):(o=n,i===0&&l(Nt)),o!==n?(m=t,t=ce(u)):(r=t,t=n)):(r=t,t=n),t===n&&(t=r,b(),(u=$())!==n?(e.substr(r,2)===Y?(o=Y,r+=2):(o=n,i===0&&l(Tt)),o!==n?(m=t,t=ie(u)):(r=t,t=n)):(r=t,t=n),t===n&&(t=r,b(),(u=$())!==n?(e.substr(r,2)===Z?(o=Z,r+=2):(o=n,i===0&&l(Bt)),o!==n?(m=t,t=se(u)):(r=t,t=n)):(r=t,t=n)))))),i--,t===n&&i===0&&l(Mt),t}function je(){var t,u,o;return i++,t=r,(u=$())!==n?(e.substr(r,3)===tt?(o=tt,r+=3):(o=n,i===0&&l(Jt)),o!==n?(m=t,t=le(u)):(r=t,t=n)):(r=t,t=n),t===n&&(t=r,(u=$())!==n?(e.substr(r,3)===et?(o=et,r+=3):(o=n,i===0&&l(Lt)),o!==n?(m=t,t=fe(u)):(r=t,t=n)):(r=t,t=n),t===n&&(t=r,(u=$())!==n?(e.substr(r,4)===nt?(o=nt,r+=4):(o=n,i===0&&l(Ut)),o!==n?(m=t,t=pe(u)):(r=t,t=n)):(r=t,t=n),t===n&&(t=r,(u=$())!==n?(e.substr(r,4)===rt?(o=rt,r+=4):(o=n,i===0&&l(Gt)),o!==n?(m=t,t=he(u)):(r=t,t=n)):(r=t,t=n)))),i--,t===n&&(u=n,i===0&&l(Dt)),t}function ke(){var t,u;return i++,t=r,b(),(u=$())!==n?(m=t,t=me(u)):(r=t,t=n),i--,t===n&&i===0&&l(_t),t}function Oe(){var t,u,o,s;if(i++,t=r,e.charCodeAt(r)===35?(u=xt,r++):(u=n,i===0&&l(Kt)),u!==n){if(o=[],s=e.charAt(r),ot.test(s)?r++:(s=n,i===0&&l(ft)),s!==n)for(;s!==n;)o.push(s),s=e.charAt(r),ot.test(s)?r++:(s=n,i===0&&l(ft));else o=n;o!==n?(m=t,t=ge()):(r=t,t=n)}else r=t,t=n;return t===n&&(t=r,(u=U())!==n&&(m=t,u=de(u)),(t=u)===n&&(t=r,(u=dt())!==n&&(m=t,u=ve()),t=u)),i--,t===n&&(u=n,i===0&&l(Ht)),t}function $(){var t,u,o,s,p,g,v,A;for(t=r,u=e.charAt(r),ct.test(u)?r++:(u=n,i===0&&l(pt)),u===n&&(u=null),o=r,s=[],p=e.charAt(r),P.test(p)?r++:(p=n,i===0&&l(S));p!==n;)s.push(p),p=e.charAt(r),P.test(p)?r++:(p=n,i===0&&l(S));if(e.charCodeAt(r)===46?(p=At,r++):(p=n,i===0&&l(Qt)),p!==n){if(g=[],v=e.charAt(r),P.test(v)?r++:(v=n,i===0&&l(S)),v!==n)for(;v!==n;)g.push(v),v=e.charAt(r),P.test(v)?r++:(v=n,i===0&&l(S));else g=n;g!==n?o=s=[s,p,g]:(r=o,o=n)}else r=o,o=n;if(o===n)if(o=[],s=e.charAt(r),P.test(s)?r++:(s=n,i===0&&l(S)),s!==n)for(;s!==n;)o.push(s),s=e.charAt(r),P.test(s)?r++:(s=n,i===0&&l(S));else o=n;if(o!==n){if(s=r,e.charCodeAt(r)===101?(p=$t,r++):(p=n,i===0&&l(Vt)),p!==n){if(g=e.charAt(r),ct.test(g)?r++:(g=n,i===0&&l(pt)),g===n&&(g=null),v=[],A=e.charAt(r),P.test(A)?r++:(A=n,i===0&&l(S)),A!==n)for(;A!==n;)v.push(A),A=e.charAt(r),P.test(A)?r++:(A=n,i===0&&l(S));else v=n;v!==n?s=p=[p,g,v]:(r=s,s=n)}else r=s,s=n;s===n&&(s=null),m=t,t=ye()}else r=t,t=n;return t}function Pe(t,u){return t.map(function(o){return o[u]})}function Se(t,u,o){return[t].concat(Pe(u,o))}if(c=q(),a.peg$library)return{peg$result:c,peg$currPos:r,peg$FAILED:n,peg$maxFailExpected:D,peg$maxFailPos:E};if(c!==n&&r===e.length)return c;throw c!==n&&r<e.length&&l(we()),be(D,E<e.length?e.charAt(E):null,E<e.length?mt(E,E+1):mt(E,E))}function wt(e){if(!e||e.length===0)return null;if(typeof e=="string"){const c=vt(e);return c&&c.length!==0?c:null}const a=e.map(c=>{if(!Number.isFinite(c.scale)||c.scale<=0)throw new x("effect:invalid-scale","scale must be finite and greater than 0",{stop:c});return{scale:c.scale,effects:vt(c.value)}});a.sort((c,n)=>n.effects.length-c.effects.length);for(let c=0;c<a.length-1;c++){if(!Ne(a[c].effects,a[c+1].effects))throw new x("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:a[c].effects,b:a[c+1].effects});Te(a[c].effects,a[c+1].effects)}return a.sort((c,n)=>n.scale-c.scale),a}function vt(e){let a;if(!e)return[];try{a=Ke(e)}catch(c){throw new x("effect:invalid-syntax","Invalid effect syntax",{value:e,error:c})}return a.map(c=>Qe(c))}function Qe(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return Ve(e);case"opacity":return We(e);case"hue-rotate":return Xe(e);case"blur":return Ye(e);case"drop-shadow":return Ze(e);case"bloom":return tn(e)}}catch(a){throw a.details.filter=e,a}throw new x("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}function Ve(e){let a=1;return N(e.parameters,1),e.parameters.length===1&&(a=j(e.parameters[0])),new Be(e.name,a)}function We(e){let a=1;return N(e.parameters,1),e.parameters.length===1&&(a=j(e.parameters[0])),new De(a)}function Xe(e){let a=0;return N(e.parameters,1),e.parameters.length===1&&(a=on(e.parameters[0])),new Je(a)}function Ye(e){let a=0;return N(e.parameters,1),e.parameters.length===1&&(a=Q(e.parameters[0]),B(a,e.parameters[0])),new Le(a)}function Ze(e){const a=[];let c=null;for(const n of e.parameters)if(n.type==="color"){if(a.length&&Object.freeze(a),c)throw new x("effect:type-error","Accepts only one color",{});c=cn(n)}else{const f=Q(n);if(Object.isFrozen(a))throw new x("effect:type-error","<length> parameters not consecutive",{lengths:a});a.push(f),a.length===3&&B(f,n)}if(a.length<2||a.length>3)throw new x("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${a.length}}`,{lengths:a});return new Ue(a[0],a[1],a[2]||0,c||bt("black"))}function tn(e){let a=1,c=0,n=0;return N(e.parameters,3),e.parameters[0]&&(a=j(e.parameters[0])),e.parameters[1]&&(c=Q(e.parameters[1]),B(c,e.parameters[1])),e.parameters[2]&&(n=j(e.parameters[2])),new Ge(a,c,n)}function N(e,a){if(e.length>a)throw new x("effect:type-error",`Function supports up to ${a} parameters, Actual: ${e.length}`,{parameters:e})}function L(e){if(e.type==="color")return"<color>";if(e.unit){if(e.unit in K)return"<length>";if(e.unit in H)return"<angle>";if(e.unit==="%")return"<percentage>"}return"<double>"}function B(e,a){if(e<0)throw new x("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:a})}function en(e){if(e.type!=="quantity"||e.unit!==null)throw new x("effect:type-error",`Expected <double>, Actual: ${L(e)}`,{term:e})}function nn(e){if(e.type!=="quantity"||e.unit!==null&&e.unit!=="%")throw new x("effect:type-error",`Expected <double> or <percentage>, Actual: ${L(e)}`,{term:e})}He(I,Error),I.prototype.format=function(e){var a="Error: "+this.message;if(this.location){var c,n=null;for(c=0;c<e.length;c++)if(e[c].source===this.location.source){n=e[c].text.split(/\r\n|\n|\r/g);break}var f=this.location.start,F=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(f):f,q=this.location.source+":"+F.line+":"+F.column;if(n){var M=this.location.end,R=_("",F.line.toString().length," "),h=n[f.line-1],d=(f.line===M.line?M.column:h.length+1)-f.column||1;a+=`
 --> `+q+`
`+R+` |
`+F.line+" | "+h+`
`+R+" | "+_("",f.column-1," ")+_("",d,"^")}else a+=`
 at `+q}return a},I.buildMessage=function(e,a){var c={literal:function(h){return'"'+f(h.text)+'"'},class:function(h){var d=h.parts.map(function(C){return Array.isArray(C)?F(C[0])+"-"+F(C[1]):F(C)});return"["+(h.inverted?"^":"")+d.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(h){return h.description}};function n(h){return h.charCodeAt(0).toString(16).toUpperCase()}function f(h){return h.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+n(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+n(d)})}function F(h){return h.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+n(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+n(d)})}function q(h){return c[h.type](h)}function M(h){var d,C,y=h.map(q);if(y.sort(),y.length>0){for(d=1,C=1;d<y.length;d++)y[d-1]!==y[d]&&(y[C]=y[d],C++);y.length=C}switch(y.length){case 1:return y[0];case 2:return y[0]+" or "+y[1];default:return y.slice(0,-1).join(", ")+", or "+y[y.length-1]}}function R(h){return h?'"'+f(h)+'"':"end of input"}return"Expected "+M(e)+" but "+R(a)+" found."};const H={deg:1,grad:.9,rad:180/Math.PI,turn:360};function rn(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&H[e.unit]!=null))throw new x("effect:type-error",`Expected <angle>, Actual: ${L(e)}`,{term:e})}const K={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function un(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&K[e.unit]!=null))throw new x("effect:type-error",`Expected <length>, Actual: ${L(e)}`,{term:e})}function j(e){nn(e);const a=e.value;return B(a,e),e.unit==="%"?.01*a:a}function an(e){return en(e),B(e.value,e),e.value}function on(e){return rn(e),e.value*H[e.unit]||0}function Q(e){return un(e),e.value*K[e.unit]||0}function cn(e){switch(e.colorType){case"hex":return Me(e.value);case"named":return bt(e.value);case"function":return fn(e.value)}}function bt(e){if(!Re(e))throw new x("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return ze(e)}const sn=/^rgba?/i,ln=/^hsla?/i;function fn(e){if(N(e.parameters,4),sn.test(e.name))return[j(e.parameters[0]),j(e.parameters[1]),j(e.parameters[2]),e.parameters[3]?j(e.parameters[3]):1];if(ln.test(e.name))return Ie(an(e.parameters[0]),j(e.parameters[1]),j(e.parameters[2]),e.parameters[3]?j(e.parameters[3]):1);throw new x("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}function wn(e,a,c){var n;try{return hn(e)}catch(f){(n=c==null?void 0:c.messages)==null||n.push(f)}return null}function bn(e,a,c,n){try{const f=pn(e);qe(c,f,a)}catch(f){n.messages&&n.messages.push(f)}}function pn(e){const a=wt(e);return a?_e(a)?a.map(c=>c.toJSON()):a.map(({scale:c,effects:n})=>({scale:c,value:n.map(f=>f.toJSON())})):null}function hn(e){if(!e||e.length===0)return null;if(mn(e)){const a=[];for(const c of e)a.push({scale:c.scale,value:yt(c.value)});return a}return yt(e)}function mn(e){const a=e[0];return!!a&&"scale"in a}function yt(e){if(!(e!=null&&e.length))return"";const a=[];for(const c of e){let n=[];switch(c.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":n=[O(c,"amount")];break;case"blur":n=[O(c,"radius","pt")];break;case"hue-rotate":n=[O(c,"angle","deg")];break;case"drop-shadow":n=[O(c,"xoffset","pt"),O(c,"yoffset","pt"),O(c,"blurRadius","pt"),gn(c,"color")];break;case"bloom":n=[O(c,"strength"),O(c,"radius","pt"),O(c,"threshold")]}const f=`${c.type}(${n.filter(Boolean).join(" ")})`;wt(f),a.push(f)}return a.join(" ")}function O(e,a,c){if(e[a]==null)throw new x("effect:missing-parameter",`Missing parameter '${a}' in ${e.type} effect`,{effect:e});return c?e[a]+c:""+e[a]}function gn(e,a){if(e[a]==null)throw new x("effect:missing-parameter",`Missing parameter '${a}' in ${e.type} effect`,{effect:e});const c=e[a];return`rgba(${c[0]||0}, ${c[1]||0}, ${c[2]||0}, ${c[3]/255||0})`}export{bn as a,wt as d,yt as i,wn as n};
