import{V as L}from"./reactiveUtils-XM7cS2OP.js";import{P as v}from"./Accessor-BmwT4B0c.js";import{x as S,_ as g,K as h}from"./cast-CsZslgGN.js";import{r as R}from"./utils-DYurMneM.js";import{a as s}from"./basemapDefinitions-D-Q7PKmu.js";function N(e,a){var t,r,l,n;return!(!((r=(t=e.basemap)==null?void 0:t.referenceLayers)!=null&&r.some(i=>i.uid===a))&&!((n=(l=e.basemap)==null?void 0:l.baseLayers)!=null&&n.some(i=>i.uid===a)))}function I(e){let a=null;const t=u(e),r=!(t!=null&&t.baseLayers.length);for(const l in s){const n=b(t,m(s[l]),{mustMatchReferences:r});if(n==="equal"){a=l;break}n==="base-layers-equal"&&(a=l)}return a}function j(e,a){var t,r;return e===a||((t=e==null?void 0:e.portalItem)==null?void 0:t.id)!=null&&e.portalItem.id===((r=a==null?void 0:a.portalItem)==null?void 0:r.id)?!0:b(u(e),u(a),{mustMatchReferences:!0})==="equal"}function B(e){return!!(e!=null&&e.baseLayers.concat(e.referenceLayers).some(x))}function x(e){if(c(e.url))return!0;if(e.type==="vector-tile")for(const a in e.sourceNameToSource){const t=e.sourceNameToSource[a];if(c(t==null?void 0:t.sourceUrl))return!0}return!1}function K(e,a){var n;if(a==null||e==null)return{spatialReference:null,updating:!1};if(a.loadStatus==="not-loaded")return a.load(),{spatialReference:null,updating:!0};if(a.spatialReference)return{spatialReference:a.spatialReference,updating:!1};if(a.baseLayers.length===0)return{spatialReference:null,updating:!1};const t=a.baseLayers.at(0);switch(t.loadStatus){case"not-loaded":t.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const r=(("supportedSpatialReferences"in t?t.supportedSpatialReferences:null)||["tileInfo"in t?(n=t.tileInfo)==null?void 0:n.spatialReference:t.spatialReference]).filter(Boolean),l=e.spatialReference;return l?{spatialReference:r.find(i=>l.equals(i))??r[0]??null,updating:!1}:{spatialReference:r[0],updating:!1}}const q=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function c(e){if(!e)return!1;const a=new S(g(e));return!!a.authority&&q.test(a.authority)}function u(e){return e?!e.loaded&&e.resourceInfo?m(e.resourceInfo.data):{baseLayers:f(e.baseLayers),referenceLayers:f(e.referenceLayers)}:null}function f(e){return(L.isCollection(e)?e.toArray():e).map(T)}function T(e){var a,t;return{type:e.type,effect:"effect"in e?e.effect:void 0,url:d("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&e.minScale!=null?e.minScale:0,maxScale:"maxScale"in e&&e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visible==null||!!e.visible,sublayers:e.type!=="map-image"&&e.type!=="wms"||e.sublayers==null||(a=e.sublayers)==null?void 0:a.map(r=>({id:r.id,visible:r.visible})),activeLayerId:e.type==="wmts"?(t=e.activeLayer)==null?void 0:t.id:void 0}}function o(e){return e.isReference||e.layerType==="ArcGISSceneServiceLayer"}function m(e){return e?{baseLayers:y((e.baseMapLayers??[]).filter(a=>!o(a))),referenceLayers:y((e.baseMapLayers??[]).filter(a=>o(a)))}:null}function y(e){return e.map(a=>U(a))}function U(e){let a;switch(e.layerType){case"VectorTileLayer":a="vector-tile";break;case"ArcGISTiledMapServiceLayer":a="tile";break;case"ArcGISSceneServiceLayer":a="scene";break;default:a="unknown"}return{type:a,effect:e.effect,url:d(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale??0,maxScale:e.maxScale??0,opacity:e.opacity??1,visible:e.visibility==null||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}function b(e,a,t){return e!=null!=(a!=null)?"not-equal":!e||!a?"equal":p(e.baseLayers,a.baseLayers)?p(e.referenceLayers,a.referenceLayers)?"equal":t.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal"}function p(e,a){if(e.length!==a.length)return!1;for(let t=0;t<e.length;t++)if(!w(e[t],a[t]))return!1;return!0}function w(e,a){if(e.type!==a.type||e.url!==a.url||e.minScale!==a.minScale||e.maxScale!==a.maxScale||e.visible!==a.visible||e.opacity!==a.opacity||!R(e.effect,a.effect))return!1;if(e.activeLayerId!=null||a.activeLayerId!=null)return e.activeLayerId===a.activeLayerId;if(e.sublayers!=null||a.sublayers!=null){if(e.sublayers==null||a.sublayers==null||e.sublayers.length!==a.sublayers.length)return!1;for(let t=0;t<e.sublayers.length;t++){const r=e.sublayers.at(t),l=a.sublayers.at(t);if((r==null?void 0:r.id)!==(l==null?void 0:l.id)||(r==null?void 0:r.visible)!==(l==null?void 0:l.visible))return!1}}return!0}function d(e){return e?h(e).replace(/^\s*https?:/i,"").toLowerCase():""}function P(e){if(!e)return null;const{thumbnailUrl:a}=e;if(a)return a;const t=I(e);return t?s[t].thumbnailUrl:v(e.baseLayers,M)}function M(e){var a;return"portalItem"in e?(a=e.portalItem)==null?void 0:a.thumbnailUrl:void 0}export{T as I,x as b,N as c,K as d,P as j,B as m,w,j as y};
