const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./statsWorker-Qmvx-8Is.js","./utils-Bh2cHa3t.js","./geometry-D964gYQX.js","./subclass-BZA_h8Db.js","./Extent-Bf3YTe7m.js","./tslib.es6-B3Jf3DVX.js","./Point-Cg0-ChZE.js","./Accessor-BLX9ikPh.js","./cast-Bjksrh93.js","./writer-DNAwXnhG.js","./assets-C43MgM-v.js","./index-Bh2oEzTI.js","./index-2kwcjS9-.css","./jsonMap-0cxwUWs2.js","./Polyline-D9YkgmM_.js","./mathUtils-C4_ghTv4.js","./screenUtils-_ZIvrt5o.js","./timeUtils-8fb_2oAt.js","./date-DlqISzcw.js","./locale-C9TlLpzi.js","./quantizationUtils-uj_P09aO.js","./fieldUtils-tmQlKvWo.js","./intl-CChhNOV8.js","./messages-OmQvZhAg.js","./heatmapUtils-Dwiv9IEa.js","./vec42-YcqnINSP.js","./common-DQOJ18NT.js","./vec4f64-o2zAXfmz.js","./utils-BwQ00KBJ.js","./Basemap-DVYOaWHz.js","./Collection-CEdjem1-.js","./Evented-BHRw9x22.js","./shared-B3wH2qpO.js","./SimpleObservable-KocWTzVy.js","./collectionUtils-D_lHIu88.js","./Loadable-BabW5Xcc.js","./Promise-B2Hu02L7.js","./loadAll-B6mYSptb.js","./asyncUtils-CWX51uTe.js","./Portal-C10FKnaA.js","./PortalItem-DzgXrpyc.js","./persistableUrlUtils-fa1mAujs.js","./writeUtils-Dz7BsE1e.js","./layerUtils-BrNoooE9.js","./mat4f32-DcsiF_Rp.js","./mat4-GpOFENPA.js","./vec3f64-BLpZdpfb.js","./utils-rwwdQ1Ui.js","./ClassBreaksDefinition-CS8Z_VNX.js","./enumeration-Ba5njXdz.js","./geometryEngineWorker-BiqU-FdE.js","./geometryEngineJSON-BwrklJA_.js","./geometryEngineBase-yFIvKOkM.js","./_commonjsHelpers-DCkdB7M8.js","./json-Wa8cmqdu.js","./CSVSourceWorker-CwcRnjak.js","./date-DLgTylpo.js","./projection-B971H0Re.js","./projectBuffer-Bs7GwaPY.js","./geodesicConstants-DWQLYX7F.js","./OptimizedFeature-6cJ-QFG5.js","./OptimizedGeometry-BF8iz5FO.js","./FeatureStore-Dr0GQdbp.js","./aaBoundingBox-BE7cC1jD.js","./featureConversionUtils-D14h8iad.js","./jsonUtils-CEfjT-BK.js","./OptimizedFeatureSet-Blu9Ckm7.js","./BoundsStore-BhV7QrYA.js","./PooledRBush-D7s4d_Fs.js","./quickselect-QQC62dOK.js","./timeSupport-T1g9-JyG.js","./queryUtils-O-WFKoZd.js","./normalizeUtils-EVmAQ-ak.js","./normalizeUtilsCommon-dT81xWiM.js","./utils-6jMaHUrH.js","./utils-Bema0iXE.js","./optimizedFeatureQueryEngineAdapter-BOPMFOve.js","./centroid-DdLmOD72.js","./QueryEngine-DrzbS-Dm.js","./LRUCache-B_PHMSGm.js","./MemCache-Dx1v3xLC.js","./WhereClause-BNiy948d.js","./TimeOnly-DOn_Hy89.js","./UnknownTimeZone-BkowvBs8.js","./fieldType-BuzM0UHS.js","./QueryEngineCapabilities-DjYb9CEb.js","./SnappingCandidate-O5eRSE6e.js","./FieldsIndex-DpwHKAMX.js","./Scheduler-CJu5awNf.js","./reactiveUtils-C5zUhJQJ.js","./signal-D4lghLjV.js","./debugFlags-BF6Z0j0F.js","./number-CUaGJe2K.js","./clientSideDefaults-BCN5Jkqv.js","./capabilities-Y9lFlGVh.js","./defaultsJSON-GKolV7NZ.js","./EdgeProcessingWorker-BeA9hOwL.js","./workerHelper-DDJ6ziyx.js","./InterleavedLayout-e-di2fxs.js","./BufferView-_QDXRCew.js","./vec2-maR1OrZI.js","./vec32-Dvg_eL9J.js","./Util-BIfApRF5.js","./vec2f64-miziP1SN.js","./bufferLayouts-viU4JW-U.js","./glUtil-D0YUa0ow.js","./enums-D9v74xTE.js","./VertexElementDescriptor-BOD-G50G.js","./VertexAttribute-Cq4MnHjR.js","./edgeProcessing-CaTaoQ4d.js","./deduplicate-DIJK2kGw.js","./Indices-DflDlU4Z.js","./Normals-DzBXR8Bg.js","./ElevationSamplerWorker-DrdcwWVO.js","./MeshLocalVertexSpace-LEHwMUnu.js","./Clonable-D3rtuBWg.js","./vertexSpaceConversion-CPh5QK5U.js","./mat3-BRl2i9Bz.js","./mat3f64-BBpwCtoL.js","./mat4f64-Dk4dwAN8.js","./spatialReferenceEllipsoidUtils-DBE_OFra.js","./computeTranslationToOriginAndRotation-Q27G6TBL.js","./projectPointToVector-GINIbYMz.js","./meshVertexSpaceUtils-CXzOFlTI.js","./vec3-kbEkneOB.js","./vec4-BpYqBTK4.js","./FeatureServiceSnappingSourceWorker-DbSCZ0bD.js","./UpdatingHandles-GfwcIh5z.js","./TileInfo-Dphjf6xH.js","./TileKey-DZd6gJy7.js","./Query-5Xpquc1r.js","./DataLayerSource-BKkswDvG.js","./Field-ybkHhtnK.js","./FullTextSearch-Csd1Hktu.js","./TimeExtent-DocT5yPf.js","./ElevationInfo-CA5m_tHv.js","./unitConversionUtils-BMfW9yAe.js","./lengthUtils-DL1-FDQQ.js","./symbologySnappingCandidates-DEMddSdd.js","./arcgisLayerUrl-BX1FE5Hm.js","./pbfQueryUtils-B0fU-MiS.js","./pbf-BtDZ1BpD.js","./query-Dw-gv3BA.js","./queryZScale-w66xFVGx.js","./ByteSizeUnit-BsxeN7wM.js","./GeoJSONSourceWorker-dgjih0QU.js","./geojson-DMG1YeVa.js","./sourceUtils--DUSj3Of.js","./LercWorker-CqqoM7eq.js","./MemorySourceWorker-B8YhYWEG.js","./objectIdUtils-4dd1rf9p.js","./PBFDecoderWorker-BPeLSivI.js","./compilerUtils-Dw3R0f-Z.js","./dehydratedFeatures-BiOblf0d.js","./FeaturePipelineWorker-BURPijpi.js","./TileStrategy-DT04gaWW.js","./TileKey-Cs1awCRX.js","./QueueProcessor-DZiVr5XH.js","./Queue-yu3bZ02p.js","./ReactiveMap-6CfRGOlR.js","./definitions-DfvbPdMm.js","./diffUtils-BP7jmOAy.js","./AttributeStore-BCrjTIMI.js","./LabelMetric-CbxH21Le.js","./enums-CmIX1y88.js","./Texture-Begq2x5n.js","./Program-mfcb06fW.js","./BufferObject-BVi1lwBq.js","./BoundingBox-CnpCxTZE.js","./vec2f32-BbH2jxlN.js","./CIMSymbolHelper-BObHJeub.js","./BidiEngine-DNnuvc1i.js","./TextSymbol-D8QO_KUV.js","./Color-BCS62Hs5.js","./colorUtils-0bJDPow9.js","./fontUtils-BKHqaMFz.js","./GeometryUtils-Dyjqugo6.js","./utils-D2PLyMFF.js","./mat2d-D9DBP-jx.js","./mat2df32-orApM5a3.js","./Rect-CUzevAry.js","./defaults-DZ1kfMRx.js","./UpdateTracking2D-DEYEtGAB.js","./BindType-BmZEZMMh.js","./labelFormatUtils-DFKxfrJb.js","./labelUtils-B8petyBk.js","./MeshWriterRegistry-BE3LBdtr.js","./PieChartMeshWriter-BNtUIwqu.js","./TurboLine-8twcK4AX.js","./earcut-Lltz9D9k.js","./constants-F8oTIn7N.js","./grouping-CZyomf7p.js","./Tile-Bf5TzhCn.js","./ogcFeatureUtils-YVfdd5m4.js","./StreamFeatureManager-CcWkr8oc.js","./CircularArray-CujHzHWW.js","./createConnection-CCcalz4a.js","./PointCloudWorker-Bq74cAO1.js","./quat-4pa1e6ds.js","./quatf64-CCm9z-pX.js","./vec3f32-nZdmKIgz.js","./PointCloudWorkerUtil-BMHmT1-d.js","./PointCloudUniqueValueRenderer-CiNZlN7O.js","./RendererLegendOptions-B-4se3aU.js","./ColorStop-Dk3U5tCk.js","./I3SBinaryReader-D1r70N_w.js","./orientedBoundingBox-DOAJUK5g.js","./plane-IENfwZlB.js","./mathUtils-BG-eq9fO.js","./ViewingMode-Dodu7ZZk.js","./RasterWorker-BPOeAVwa.js","./dataUtils-CRhrrZcr.js","./pixelRangeUtils-DHjFxYEg.js","./RasterSymbolizer-zx8ns-Zp.js","./colorUtils-aL8wj-8G.js","./GCSShiftTransform-DL7f-AoC.js","./rasterProjectionHelper-Cyb7j9c9.js","./colorRamps-pKd7I5WZ.js","./SceneLayerSnappingSourceWorker-CPGmX1pm.js","./lineSegment-D7sKPPYf.js","./sphere-C77djCO6.js","./Octree-C8d4sqjv.js","./frustum-CQrOepbv.js","./SceneLayerWorker-BKtczrfS.js","./I3SNode-DvnboJA7.js","./I3SUtil-BALmNw_P.js","./projectVectorToVector-G2uWGoIb.js","./edgeUtils-BUKTgPFR.js","./floatRGBA-CfH_2xsy.js","./DecodeSymbolColor.glsl-BPIX0fAF.js","./interfaces-DDtDqZYj.js","./Matrix3DrawUniform-CiBFaSz6.js","./Float4DrawUniform-N58YDhuZ.js","./layerViewUtils-DhFEu8Rd.js","./ElevationRange-BrgM1moX.js","./WFSSourceWorker-DOz-uvrh.js","./wfsUtils-DdStB1Ak.js","./xmlUtils-CtUoQO7q.js","./WorkerTileHandler-a9Vl5Nw-.js","./enums-BRzLM11V.js","./config-MDUrh2eL.js","./StyleDefinition-BTt_i6C1.js","./SourceLayerData-BUlGom-K.js","./StyleRepository-B0FilPGd.js","./unitBezier-BX6NeAEr.js","./Lyr3DWorker-DKDiMmzX.js","./ILyr3DWasmPerSceneView-KC8PJi3s.js","./Lyr3DModule-Ccn5rG84.js","./Feature3DPipelineWorker-CIyJg65y.js","./FeaturePipelineRenderManager-DjjUkvYY.js","./LodRenderer-EVrH9dsH.js","./Material-_xx7OZxD.js","./boundedPlane-EV1sS2Ke.js","./MergedRenderer-Dli9s1X5.js","./VertexArrayObject-lPxPk5E-.js","./NestedMap-GuqgquCN.js","./renderState-DQLu6AJX.js","./Texture-Fac_8AOC.js","./ShaderTechniqueConfiguration-CBbn2DCi.js","./triangle-PTGDC_xJ.js","./AlphaCutoff-UcccL64p.js","./requestImageUtils-DgMiQwsm.js","./intersectorUtils-BK9EUwUf.js","./dehydratedFeatureUtils-B--Sgpdi.js","./verticalOffsetUtils-BDQLpfho.js","./Intersector-BQ92CPLA.js","./sdfPrimitives-CUWZbMRe.js","./doublePrecisionUtils-B0owpBza.js","./DefaultMaterial-DgOvtNL9.js","./VertexColor.glsl-_ARMpsAT.js","./RealisticTree.glsl-CAmeC2w1.js","./HUDMaterial.glsl-D6WRipwF.js","./graphicUtils-CWEFaVJb.js","./hydratedFeatures-DBKLr8hT.js","./Graphic-DsxsIjhH.js","./PopupTemplate-BHMhS05j.js","./ActionToggle-iT4slXc7.js","./Identifiable-B1UbsKNt.js","./symbols-CNimns--.js","./materialUtils-DarhapKC.js","./opacityUtils-C68Tlu6_.js","./RenderCoordsHelper-C50UGjbb.js","./projectVectorToPoint-DcLtSZYw.js"])))=>i.map(i=>d[i]);
import{j as l,b as $,e as ae,t as le,h as P,n as Y}from"./subclass-BZA_h8Db.js";import{c as J,i as ce,u as L,m as ue,l as k,S as C,h as he,L as de,s as j,T,w as pe}from"./Accessor-BLX9ikPh.js";import{s as _e}from"./Queue-yu3bZ02p.js";import{a3 as Z,a4 as me,U as ge,_ as f,c as fe}from"./assets-C43MgM-v.js";import{_ as u}from"./index-Bh2oEzTI.js";import"./intl-CChhNOV8.js";import{c as H}from"./locale-C9TlLpzi.js";const ee="20241106",te="4a32008d0254ea616a8e5f1a7b7dd5baf6852418",re=new FinalizationRegistry(t=>{t.close()});function be(t,e){re.register(t,e,e)}function ye(t){re.unregister(t)}function se(t,e){return new Proxy({},{get:(s,r,o)=>(...n)=>{let i,a;const c=n[n.length-1];return ke(c)&&(i=c.signal,a=c.transferList,n.pop()),t.apply(e?`${e}.${r.toString()}`:r.toString(),n,{transferList:a,signal:i})}})}function ke(t){return typeof t=="object"&&!Array.isArray(t)&&t!=null&&("signal"in t||"transferList"in t||Object.keys(t).length===0)}const ve={statsWorker:()=>u(()=>import("./statsWorker-Qmvx-8Is.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49]),import.meta.url),geometryEngineWorker:()=>u(()=>import("./geometryEngineWorker-BiqU-FdE.js"),__vite__mapDeps([50,51,52,53,54]),import.meta.url),CSVSourceWorker:()=>u(()=>import("./CSVSourceWorker-CwcRnjak.js"),__vite__mapDeps([55,2,3,4,5,6,7,8,9,10,11,12,13,14,15,38,56,57,33,46,58,59,54,60,61,62,31,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,18,19,84,85,20,21,22,23,1,16,17,24,25,26,27,28,29,30,32,34,35,36,37,39,40,41,42,43,44,45,47,48,49,86,87,88,89,90,91,92,93,94,95]),import.meta.url),EdgeProcessingWorker:()=>u(()=>import("./EdgeProcessingWorker-BeA9hOwL.js"),__vite__mapDeps([96,97,98,99,100,26,101,46,25,102,103,27,104,105,106,107,108,109,110,15,111,3,112,7]),import.meta.url),ElevationSamplerWorker:()=>u(()=>import("./ElevationSamplerWorker-DrdcwWVO.js"),__vite__mapDeps([113,3,68,7,69,114,5,115,10,11,12,49,13,46,116,15,6,8,9,117,26,118,45,119,101,120,121,58,59,122,57,33,4,14,123,124,99,100,25,125]),import.meta.url),FeatureServiceSnappingSourceWorker:()=>u(()=>import("./FeatureServiceSnappingSourceWorker-DbSCZ0bD.js"),__vite__mapDeps([126,5,2,3,4,6,7,8,9,10,11,12,13,14,15,31,89,38,30,32,33,127,62,63,64,65,60,61,66,67,68,69,70,71,57,46,58,59,72,73,74,75,54,76,77,78,79,80,81,82,83,18,19,84,85,20,21,22,23,1,16,17,24,25,26,27,28,29,34,35,36,37,39,40,41,42,43,44,45,47,48,49,86,87,88,90,91,128,129,130,131,132,133,115,134,135,136,137,138,139,140,141,142,143,144]),import.meta.url),GeoJSONSourceWorker:()=>u(()=>import("./GeoJSONSourceWorker-dgjih0QU.js"),__vite__mapDeps([145,10,3,11,12,5,7,38,65,4,6,8,9,13,14,15,64,63,60,61,66,62,31,67,68,69,70,71,57,33,46,58,59,72,73,2,74,75,54,76,77,78,79,80,81,82,83,18,19,84,85,20,21,22,23,1,16,17,24,25,26,27,28,29,30,32,34,35,36,37,39,40,41,42,43,44,45,47,48,49,86,87,88,89,90,91,146,56,93,94,95,147]),import.meta.url),LercWorker:()=>u(()=>import("./LercWorker-CqqoM7eq.js"),__vite__mapDeps([148,15]),import.meta.url),MemorySourceWorker:()=>u(()=>import("./MemorySourceWorker-B8YhYWEG.js"),__vite__mapDeps([149,3,65,4,5,6,7,8,9,10,11,12,13,14,15,64,63,60,61,66,150,62,31,67,68,69,70,71,57,33,46,58,59,72,73,2,74,75,54,76,77,78,79,80,81,82,83,18,19,84,85,20,21,22,23,1,16,17,24,25,26,27,28,29,30,32,34,35,36,37,38,39,40,41,42,43,44,45,47,48,49,86,87,88,89,90,91,93,94,95,147,56]),import.meta.url),PBFDecoderWorker:()=>u(()=>import("./PBFDecoderWorker-BPeLSivI.js"),__vite__mapDeps([151,152,3,7,6,5,8,9,10,11,12,13,57,33,46,4,14,15,58,59,153,63,20,2,132,49,84,64,65,60,61,66,140,141]),import.meta.url),FeaturePipelineWorker:()=>u(()=>import("./FeaturePipelineWorker-BURPijpi.js"),__vite__mapDeps([154,3,7,89,38,5,30,31,32,33,16,128,13,10,11,12,6,8,9,14,4,15,129,155,156,100,26,157,158,159,90,160,161,162,163,164,165,106,166,167,107,168,169,2,82,83,18,19,170,171,172,173,174,49,175,65,61,176,177,178,179,180,181,95,63,77,64,60,66,182,183,102,103,25,27,127,21,22,23,184,185,87,71,57,46,58,59,72,73,74,75,54,70,130,131,132,84,133,115,134,17,186,187,188,189,190,191,76,78,79,80,81,85,20,1,24,28,29,34,35,36,37,39,40,41,42,43,44,45,47,48,86,88,91,192,69,142,140,141,143,139,193,146,56,93,94,147,194,195,196]),import.meta.url),PointCloudWorker:()=>u(()=>import("./PointCloudWorker-Bq74cAO1.js"),__vite__mapDeps([197,3,198,118,199,46,26,101,25,200,6,5,7,8,9,10,11,12,13,58,15,59,201,202,49,203,115,173,174,204,205,108,206,117,119,27,120,121,45,207,103,208,209]),import.meta.url),RasterWorker:()=>u(()=>import("./RasterWorker-BPOeAVwa.js"),__vite__mapDeps([210,2,3,4,5,6,7,8,9,10,11,12,13,14,15,57,33,46,58,59,211,212,213,53,173,174,214,25,26,27,215,49,65,216,217,132,84]),import.meta.url),SceneLayerSnappingSourceWorker:()=>u(()=>import("./SceneLayerSnappingSourceWorker-CPGmX1pm.js"),__vite__mapDeps([218,5,7,3,101,46,26,219,15,220,45,25,27,14,9,4,6,8,10,11,12,13,117,118,207,119,199,103,208,221,222,102,109,110,111,98,99,100,108,104,105,106,107,112]),import.meta.url),SceneLayerWorker:()=>u(()=>import("./SceneLayerWorker-BKtczrfS.js").then(t=>t.S),__vite__mapDeps([223,11,12,15,6,5,7,3,8,9,10,13,114,115,49,46,124,224,27,220,45,26,101,25,14,4,117,118,207,119,199,103,208,225,2,57,33,58,59,226,122,130,65,131,132,84,133,134,17,18,19,205,108,121,227,173,174,16,152,228,229,230,231,183,232,206,198,120,209,233,234]),import.meta.url),WFSSourceWorker:()=>u(()=>import("./WFSSourceWorker-DOz-uvrh.js"),__vite__mapDeps([235,38,5,7,3,6,8,9,10,11,12,13,64,63,4,14,15,65,60,61,66,62,31,67,68,69,70,71,57,33,46,58,59,72,73,2,74,75,54,76,77,78,79,80,81,82,83,18,19,84,85,20,21,22,23,1,16,17,24,25,26,27,28,29,30,32,34,35,36,37,39,40,41,42,43,44,45,47,48,49,86,87,88,89,90,91,146,56,147,236,237,139,132]),import.meta.url),WorkerTileHandler:()=>u(()=>import("./WorkerTileHandler-a9Vl5Nw-.js"),__vite__mapDeps([238,7,3,239,176,14,5,9,4,6,8,10,11,12,13,15,180,240,241,164,141,188,160,242,243,106,107,173,174,214,25,26,27,244,189,171]),import.meta.url),Lyr3DWorker:()=>u(()=>import("./Lyr3DWorker-DKDiMmzX.js"),__vite__mapDeps([245,246,247,11,12,10,3,5,7]),import.meta.url),Feature3DPipelineWorker:()=>u(()=>import("./Feature3DPipelineWorker-CIyJg65y.js"),__vite__mapDeps([248,5,31,7,3,89,38,30,32,33,6,8,9,10,11,12,13,78,57,46,4,14,15,58,59,63,65,72,73,2,74,75,64,60,61,66,79,80,81,82,83,18,19,84,70,71,54,85,20,21,22,23,1,16,17,24,25,26,27,28,29,34,35,36,37,39,40,41,42,43,44,45,47,48,49,86,87,88,90,91,130,131,132,133,115,134,159,68,69,77,142,140,141,143,209,111,249,250,100,103,251,230,108,252,220,101,117,118,207,119,199,208,219,105,106,107,98,99,102,253,254,165,222,255,231,183,152,256,257,137,258,259,260,261,262,221,167,263,264,206,198,120,121,265,266,200,267,228,268,269,229,270,271,272,123,114,226,122,273,274,275,173,174,276,277,278,172,279,280,232,281,282]),import.meta.url)},oe="worker:port-closed";var h;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(h||(h={}));let we=0;function ne(){return we++}function Ee(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function v(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function W(t,e,s,r){if(e.type===h.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==h.INVOKE&&e.type!==h.RESPONSE)return void t.postMessage(e);let o;if(Ee(s)?(o=V(s.transferList),e.data=s.result):(o=V(r),e.data=s),o){if(l("ff")){for(const n of o)if("byteLength"in n&&n.byteLength>267386880){const i="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case h.INVOKE:throw i;case h.RESPONSE:return void W(t,{type:h.RESPONSE,jobId:e.jobId,error:v(i)})}}}t.postMessage(e,o)}else t.postMessage(e)}function w(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function V(t){if(!(t!=null&&t.length))return null;if(l("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(s=>!Pe(s));return e.length?e:null}function Pe(t){var e;return t instanceof ArrayBuffer||((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="ArrayBuffer"}async function Ke(t){try{return await t}catch(e){const s=(e==null?void 0:e.name)===oe;if(!(J(e)||s))throw e;return}}const{CLOSE:U,ABORT:x,INVOKE:F,RESPONSE:b,OPEN_PORT:q,ON:Oe}=h,Ie=2;class Se{constructor(e){this._invoke=e,this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._timer=null,this._process=this._process.bind(this)}push(e){e.type===h.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class _{static connect(e,s){const r=new MessageChannel;let o;o=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new _(r.port1,{channel:r,client:o,schedule:s});return typeof o=="object"&&"remoteClient"in o&&(o.remoteClient=n),_.clients.set(n,o),r.port2}static loadWorker(e){const s=ve[e];return s?s():Promise.resolve(null)}constructor(e,s,r){this._port=e,this._jobQueue=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new Se(o=>this._onInvokeMessage(o)),this._client=s.client,this._onMessage=this._onMessage.bind(this),this._channel=s.channel,this._schedule=s.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:U}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,s,r){return this.apply(e,[s],r)}apply(e,s,r){const o=r==null?void 0:r.signal,n=r==null?void 0:r.transferList;if(!this._port)return Promise.reject(new $(oe,`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:s}));const i=ne();return new Promise((a,c)=>{if(ce(o))return this._processWork(),void c(L());const d=ue(o,()=>{const m=this._outJobs.get(i);m&&(this._outJobs.delete(i),this._processWork(),k(m.abortHandle),this._post({type:x,jobId:i}),c(L()))}),p={resolve:a,reject:c,abortHandle:d,debugInfo:e};this._outJobs.set(i,p),this._post({type:F,jobId:i,methodName:e,abortable:o!=null},s,n)})}createInvokeProxy(e){return se(this,e)}on(e,s){const r=new MessageChannel;function o(n){s(n.data)}return this._port.postMessage({type:h.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",o),r.port1.start(),ae(()=>{r.port1.postMessage({type:h.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",o)})}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:q,port:e.port2}),e.port1}_processWork(){var i;if(this._outJobs.size>=Ie)return;const e=(i=this._jobQueue)==null?void 0:i.pop();if(!e)return;const{methodName:s,data:r,invokeOptions:o,resolver:n}=e;this.apply(s,r,o).then(a=>n.resolve(a)).catch(a=>n.reject(a))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{k(e.abortHandle),e.reject(L(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e,!0)):this._processMessage(e,!1)}_processMessage(e,s){const r=w(e);if(r)switch(r.type){case b:this._onResponseMessage(r);break;case F:s?this._onInvokeMessage(r):this._invokeQueue.push(r);break;case x:this._onAbortMessage(r);break;case U:this._onCloseMessage();break;case q:this._onOpenPortMessage(r);break;case Oe:this._onOnMessage(r)}}_onAbortMessage(e){const s=this._inJobs,r=e.jobId,o=s.get(r);this._invokeQueue.push(e),o&&(o.controller&&o.controller.abort(),s.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&_.clients.get(this)===e&&e.destroy(),_.clients.delete(this),e!=null&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:s,jobId:r,data:o=[],abortable:n}=e,i=n?new AbortController:null,a=this._inJobs;let c,d=this._client,p=d[s];try{if(!p&&s&&s.includes(".")){const m=s.split(".");for(let E=0;E<m.length-1;E++)d=d[m[E]],p=d[m[E+1]]}if(typeof p!="function")throw new TypeError(`${s} is not a function`);o.push({client:this,signal:i?i.signal:null}),c=p.apply(d,o)}catch(m){return void this._post({type:b,jobId:r,error:v(m)})}C(c)?(a.set(r,{controller:i,promise:c}),c.then(m=>{a.has(r)&&(a.delete(r),this._post({type:b,jobId:r},m))},m=>{a.has(r)&&(a.delete(r),J(m)||this._post({type:b,jobId:r,error:v(m||{message:`Error encountered at method ${s}`})}))})):this._post({type:b,jobId:r},c)}_onOpenPortMessage(e){new _(e.port,{client:this._client})}_onOnMessage(e){const{port:s}=e,r=this._client.on(e.eventType,n=>{s.postMessage(n)}),o=he(e.port,"message",n=>{const i=w(n);(i==null?void 0:i.type)===h.CLOSE&&(o.remove(),r.remove(),s.close())})}_onResponseMessage(e){const{jobId:s,error:r,data:o}=e,n=this._outJobs;if(!n.has(s))return;const i=n.get(s);n.delete(s),this._processWork(),k(i.abortHandle),r?i.reject($.fromJSON(JSON.parse(r))):i.resolve(o)}_post(e,s,r){return W(this._port,e,s,r)}}_.kernelInfo={buildDate:ee,fullVersion:Z,revision:te},_.clients=new Map;let Me=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new _e}destroy(){this.close()}get closed(){var e;return!((e=this._clients)!=null&&e.length)}open(e,s){return new Promise((r,o)=>{let n=!0;const i=a=>{j(s.signal),n&&(n=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const c=e[a];C(c)?this._clientPromises[a]=c.then(d=>(this._clients[a]=new _(d,s,this._ongoingJobsQueue),i(r),this._clients[a]),()=>(i(o),null)):(this._clients[a]=new _(c,s,this._ongoingJobsQueue),this._clientPromises[a]=Promise.resolve(this._clients[a]),i(r))}})}broadcast(e,s,r){const o=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const i=this._clientPromises[n];o[n]=i.then(a=>a==null?void 0:a.invoke(e,s,r))}return o}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(L(`Worker closing, aborting job calling '${e.methodName}'`));for(const s of this._clientPromises)s.then(r=>r==null?void 0:r.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,ye(this)}invoke(e,s,r){return this.apply(e,[s],r)}apply(e,s,r){const o=de();this._ongoingJobsQueue.push({methodName:e,data:s,invokeOptions:r,resolver:o});for(let n=0;n<this._clientPromises.length;n++){const i=this._clients[n];i?i.jobAdded():this._clientPromises[n].then(a=>a==null?void 0:a.jobAdded())}return o.promise}createInvokeProxy(e){return se(this,e)}on(e,s){return Promise.all(this._clientPromises).then(()=>le(this._clients.map(r=>r.on(e,s))))}openPorts(){return new Promise(e=>{const s=new Array(this._clientPromises.length);let r=s.length;for(let o=0;o<this._clientPromises.length;++o)this._clientPromises[o].then(n=>{n&&(s[o]=n.openPort()),--r==0&&e(s)})})}get test(){}};const Le={async request(t,e){var i,a;const s=t.options,r=s.responseType;s.signal=e==null?void 0:e.signal,s.responseType=r==="native"||r==="native-request-init"?"native-request-init":r&&["blob","json","text"].includes(r)&&((i=me(t.url))!=null&&i.after)?r:"array-buffer";const o=await ge(t.url,s),n={data:o.data,httpStatus:o.httpStatus,ssl:o.ssl};switch((a=o.requestOptions)==null?void 0:a.responseType){case"native-request-init":return delete n.data.signal,n;case"blob":n.data=await n.data.arrayBuffer();break;case"json":n.data=new TextEncoder().encode(JSON.stringify(n.data)).buffer;break;case"text":n.data=new TextEncoder().encode(n.data).buffer}return{result:n,transferList:[n.data]}}},B={};function Ne(t){var s;const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:((s=t.packages)==null?void 0:s.slice())||[],paths:{...B.paths,...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=B.baseUrl),e}class Ae{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(s=>{this[s]=(...r)=>e[s](...r)})}}let N=class{constructor(){this._dispatcher=new Ae,this._workerPostMessage({type:h.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){T(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,s,r){this._dispatcher.addEventListener(e,s,r)}removeEventListener(e,s,r){this._dispatcher.removeEventListener(e,s,r)}_workerPostMessage(e){T(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const s=w(e);if(s&&s.type===h.OPEN){const{modulePath:r,jobId:o}=s;let n=await _.loadWorker(r);n||(n=await import(r));const i=_.connect(n);this._workerPostMessage({type:h.OPENED,jobId:o,data:i})}}};const R=()=>Y.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:$e}=h,je='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})})).finally((()=>{t&&t.removeEventListener("abort",s)}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let O,I;const K="Failed to create Worker. Fallback to execute module in main thread";async function Re(){if(!l("esri-workers"))return Q(new N);if(!O&&!I)try{const e=je.split("{CONFIGURATION}").join(Je());O=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){I=e||{}}let t;if(O)try{t=new Worker(O,{name:"esri-worker-"+Ce++})}catch{R().warn(K,I),t=new N}else R().warn(K,I),t=new N;return Q(t)}async function Q(t){return new Promise(e=>{function s(o){const n=w(o);n&&n.type===$e&&(t.removeEventListener("message",s),t.removeEventListener("error",r),e(t))}function r(o){o.preventDefault(),t.removeEventListener("message",s),t.removeEventListener("error",r),R().warn("Failed to create Worker. Fallback to execute module in main thread",o),(t=new N).addEventListener("message",s),t.addEventListener("error",r)}t.addEventListener("message",s),t.addEventListener("error",r)})}function Je(){let t;if(P.default!=null){const o={...P};delete o.default,t=JSON.parse(JSON.stringify(o))}else t=JSON.parse(JSON.stringify(P));t.assetsPath=f(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?f(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=H(),t.has={"esri-csp-restrictions":l("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":l("esri-2d-update-debug"),"esri-2d-log-updating":l("esri-2d-log-updating"),"featurelayer-pbf":l("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":l("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":l("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":l("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":l("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":l("featurelayer-query-max-depth"),"featurelayer-query-pausing-enabled":l("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-enabled":l("featurelayer-snapshot-enabled"),"esri-atomics":l("esri-atomics"),"esri-shared-array-buffer":l("esri-shared-array-buffer"),"esri-tiles-debug":l("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":l("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":l("feature-polyline-generalization-factor"),"host-webworker":1},t.workers.loaderUrl&&(t.workers.loaderUrl=f(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=f(t.workers.workerPath):t.workers.workerPath=f(fe("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=P.workers.loaderConfig,s=Ne({baseUrl:e==null?void 0:e.baseUrl,locale:H(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:s,kernelInfo:{buildDate:ee,fullVersion:Z,revision:te}})}let Ce=0;const{ABORT:z,INVOKE:We,OPEN:De,OPENED:Te,RESPONSE:y}=h;class D{static async create(e){const s=await Re();return new D(s,e)}constructor(e,s){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=s,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",r=>{r.preventDefault(),Y.getLogger("esri.core.workers.WorkerOwner").error(r)})}terminate(){this.worker.terminate()}async open(e,s={}){const{signal:r}=s,o=ne();return new Promise((n,i)=>{const a={resolve:n,reject:i,abortHandle:pe(r,()=>{this._outJobs.delete(o),this._post({type:z,jobId:o})})};this._outJobs.set(o,a),this._post({type:De,jobId:o,modulePath:e})})}_onMessage(e){const s=w(e);if(s)switch(s.type){case Te:this._onOpenedMessage(s);break;case y:this._onResponseMessage(s);break;case z:this._onAbortMessage(s);break;case We:this._onInvokeMessage(s)}}_onAbortMessage(e){const s=this._inJobs,r=e.jobId,o=s.get(r);o&&(o.controller&&o.controller.abort(),s.delete(r))}_onInvokeMessage(e){const{methodName:s,jobId:r,data:o,abortable:n}=e,i=n?new AbortController:null,a=this._inJobs,c=Le[s];let d;try{if(typeof c!="function")throw new TypeError(`${s} is not a function`);d=c.call(null,o,{signal:i?i.signal:null})}catch(p){return void this._post({type:y,jobId:r,error:v(p)})}C(d)?(a.set(r,{controller:i,promise:d}),d.then(p=>{a.has(r)&&(a.delete(r),this._post({type:y,jobId:r},p))},p=>{a.has(r)&&(a.delete(r),p||(p={message:"Error encountered at method"+s}),J(p)||this._post({type:y,jobId:r,error:v(p||{message:`Error encountered at method ${s}`})}))})):this._post({type:y,jobId:r},d)}_onOpenedMessage(e){const{jobId:s,data:r}=e,o=this._outJobs.get(s);o&&(this._outJobs.delete(s),k(o.abortHandle),o.resolve(r))}_onResponseMessage(e){const{jobId:s,error:r,data:o}=e,n=this._outJobs.get(s);n&&(this._outJobs.delete(s),k(n.abortHandle),r?n.reject($.fromJSON(JSON.parse(r))):n.resolve(o))}_post(e,s,r){return W(this.worker,e,s,r)}}const G=l("host-browser")?Math.min(navigator.hardwareConcurrency-1,l("workers-pool-size")??8):0;let g=l("esri-mobile")?Math.min(G,3):G;g||(g=l("safari")&&l("mac")?7:2);let X=0;const A=[];function Ge(){ie()}async function S(t,e){const s=new Me,{registryTarget:r,...o}=e;return await s.open(t,o),r&&be(r,s),s}async function Xe(t,e={}){if(typeof t!="string")throw new $("workers:undefined-module","modulePath is missing");let s=e.strategy||"distributed";if(l("host-webworker")&&!l("esri-workers")&&(s="local"),s==="local"){let r=await _.loadWorker(t);r||(r=await import(t)),j(e.signal);const o=e.client||r;return S([_.connect(r,e.schedule)],{...e,client:o})}if(await ie(),j(e.signal),s==="dedicated"){const r=X++%g;return S([await A[r].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const r=Math.min(e.maxNumWorkers,g);if(r<g){const o=new Array(r);for(let n=0;n<r;++n){const i=X++%g;o[n]=A[i].open(t,e)}return S(o,e)}}return S(A.map(r=>r.open(t,e)),e)}let M=null;async function ie(){if(M)return M;new AbortController;const t=[];for(let e=0;e<g;e++){const s=D.create(e).then(r=>(A[e]=r,r));t.push(s)}return M=Promise.all(t),M}export{_ as E,Ke as O,Me as c,Ge as m,Xe as p};
