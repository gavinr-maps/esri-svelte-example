import{e as a,t as $}from"./Evented-CXIxDjmW.js";import{c as pr,n as Ae,o as Gr,W as qr,h as hr,y as tr,b as Wr}from"./subclass-BR3PhgZG.js";import{a as Ut}from"./BindType-BmZEZMMh.js";import{s as Zr}from"./Util-BMqL_pkg.js";import"./Texture-BbJIOVx_.js";import"./enums-BlUEVwJR.js";import{r as Xr}from"./Program-BE7XUO18.js";import{T as Jr}from"./LabelMetric-Agz2doNK.js";import{l as yr}from"./highlightReasons-BXkdrXK1.js";import{S as Qr}from"./Accessor-D6mNnsWy.js";import{s as Yr}from"./ReactiveMap-Dl_3-Rm5.js";import{d as tn}from"./reactiveUtils-BFQ0BtrB.js";import{h as en}from"./UpdatingHandles-CMtXpTiG.js";var er;(function(r){r[r.Fill=0]="Fill",r[r.PatternFill=1]="PatternFill",r[r.ComplexFill=2]="ComplexFill",r[r.OutlineFill=3]="OutlineFill",r[r.PatternOutlineFill=4]="PatternOutlineFill",r[r.ComplexOutlineFill=5]="ComplexOutlineFill",r[r.Marker=6]="Marker",r[r.PieChart=7]="PieChart",r[r.Line=8]="Line",r[r.TexturedLine=9]="TexturedLine",r[r.Text=10]="Text",r[r.Label=11]="Label",r[r.Heatmap=12]="Heatmap",r[r.DotDensity=13]="DotDensity",r[r.Test=14]="Test"})(er||(er={}));var rr;(function(r){r[r.Geographic=0]="Geographic",r[r.Arithmatic=1]="Arithmatic"})(rr||(rr={}));const Vi=3.14159265359/180,rn=3.14159265359/128,Fi=1,nn=1.1,sn=1,Ni=24,Ci=8,on=1e-5,nr=.05,an=1e-30,un=4,ln=0,cn=2,Pi=2,Oi=3,Mi=0,Di=3,dn=16777216,pn=()=>Ae.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let fr=class{constructor(){this._includedModules=new Map}include(t,e){this._includedModules.has(t)?this._includedModules.get(t):(this._includedModules.set(t,e),t(this.builder,e))}},hn=class extends fr{constructor(){super(...arguments),this.vertex=new ir,this.fragment=new ir,this.attributes=new mn,this.varyings=new gn,this.extensions=new de,this.constants=new mr}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t,e=!0){const n=this.extensions.generateSource(t),i=this.attributes.generateSource(t),s=this.varyings.generateSource(t),o=t==="vertex"?this.vertex:this.fragment,l=o.uniforms.generateSource(),d=o.code.generateSource(),c=t==="vertex"?vn:bn(e),y=this.constants.generateSource().concat(o.constants.generateSource());return`${e?"#version 300 es":""}
${n.join(`
`)}
${c}
${y.join(`
`)}
${l.join(`
`)}
${i.join(`
`)}
${s.join(`
`)}
${d.join(`
`)}`}generateBindPass(t){const e=new Map;this.vertex.uniforms.entries.forEach(s=>{const o=s.bind[Ut.Pass];o&&e.set(s.name,o)}),this.fragment.uniforms.entries.forEach(s=>{const o=s.bind[Ut.Pass];o&&e.set(s.name,o)});const n=Array.from(e.values()),i=n.length;return(s,o)=>{for(let l=0;l<i;++l)n[l](t,s,o)}}generateBindDraw(t){const e=new Map;this.vertex.uniforms.entries.forEach(s=>{const o=s.bind[Ut.Draw];o&&e.set(s.name,o)}),this.fragment.uniforms.entries.forEach(s=>{const o=s.bind[Ut.Draw];o&&e.set(s.name,o)});const n=Array.from(e.values()),i=n.length;return(s,o,l)=>{for(let d=0;d<i;++d)n[d](t,s,o,l)}}},yn=class{constructor(){this._entries=new Map}add(...t){for(const e of t)this._add(e)}get(t){return this._entries.get(t)}_add(t){if(t!=null){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new pr(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}else pn().error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(t=>t.arraySize!=null?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`)}get entries(){return Array.from(this._entries.values())}},fn=class{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}},ir=class extends fr{constructor(){super(...arguments),this.uniforms=new yn,this.code=new fn,this.constants=new mr}get builder(){return this}},mn=class{constructor(){this._entries=new Array}add(t,e){this._entries.push([t,e])}generateSource(t){return t==="fragment"?[]:this._entries.map(e=>`in ${e[1]} ${e[0]};`)}},gn=class{constructor(){this._entries=new Map}add(t,e){this._entries.has(t)&&Zr(this._entries.get(t)===e),this._entries.set(t,e)}generateSource(t){const e=new Array;return this._entries.forEach((n,i)=>e.push(t==="vertex"?`out ${n} ${i};`:`in ${n} ${i};`)),e}},de=class pe{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const e=t==="vertex"?pe.ALLOWLIST_VERTEX:pe.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(n=>e.includes(n)).map(n=>`#extension ${n} : enable`)}};de.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],de.ALLOWLIST_VERTEX=[];let mr=class w{constructor(){this._entries=new Set}add(t,e,n){let i="ERROR_CONSTRUCTOR_STRING";switch(e){case"float":i=w._numberToFloatStr(n);break;case"int":i=w._numberToIntStr(n);break;case"bool":i=n.toString();break;case"vec2":i=`vec2(${w._numberToFloatStr(n[0])},                            ${w._numberToFloatStr(n[1])})`;break;case"vec3":i=`vec3(${w._numberToFloatStr(n[0])},                            ${w._numberToFloatStr(n[1])},                            ${w._numberToFloatStr(n[2])})`;break;case"vec4":i=`vec4(${w._numberToFloatStr(n[0])},                            ${w._numberToFloatStr(n[1])},                            ${w._numberToFloatStr(n[2])},                            ${w._numberToFloatStr(n[3])})`;break;case"ivec2":i=`ivec2(${w._numberToIntStr(n[0])},                             ${w._numberToIntStr(n[1])})`;break;case"ivec3":i=`ivec3(${w._numberToIntStr(n[0])},                             ${w._numberToIntStr(n[1])},                             ${w._numberToIntStr(n[2])})`;break;case"ivec4":i=`ivec4(${w._numberToIntStr(n[0])},                             ${w._numberToIntStr(n[1])},                             ${w._numberToIntStr(n[2])},                             ${w._numberToIntStr(n[3])})`;break;case"mat2":case"mat3":case"mat4":i=`${e}(${Array.prototype.map.call(n,s=>w._numberToFloatStr(s)).join(", ")})`}return this._entries.add(`const ${e} ${t} = ${i};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}};function bn(r=!0){return`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif
${r?"out vec4 fragColor;":""}
`}const vn=`precision highp float;
precision highp sampler2D;`;function wn(r){return r.split(" ").map((t,e)=>e>0?t.charAt(0).toUpperCase()+t.slice(1):t).join("")}function xn(r,t){const e=[];for(e.push(t);e.length;){const n=e.pop();if(typeof n=="object"&&!r.has(n.uid)){r.add(n.uid);for(const i of n.children)e.push(i)}}}let ut=class he{constructor(){this.uid=he.NodeCount++,this._debugName=null,this._isMutable=!1,this.isImplicit=!1}get isMutable(){return this._isMutable}setMutable(){return this._isMutable=!0,this}setDebugName(t){return t=wn(t),this._debugName=t,this.isImplicit&&this.children[0]instanceof he&&this.children[0].setDebugName(t),this}get debugInfo(){return{name:this._debugName??""}}cloneInto(t){t._debugName=this._debugName,t._isMutable=this._isMutable,t.isImplicit=this.isImplicit,t.uid=this.uid}};function p(r){return typeof r=="object"?r.clone():r}ut.NodeCount=0;let S=class extends ut{constructor(){super(...arguments),this.shaderType="primitive-node"}},$n=class gr extends ut{constructor(t){super(),this.child=t,this.shaderType="scope-node"}get children(){return[this.child]}clone(){const t=new gr(p(this.child));return this.cloneInto(t),t}},_n=class br extends ut{constructor(t,e,n){super(),this.property=t,this.target=e,this.returnType=n,this.shaderType="property-access-node"}get children(){const t=[this.target];return typeof this.property!="string"&&t.push(this.property),t}clone(){const t=new br(this.property,p(this.target),this.returnType);return this.cloneInto(t),t}};class Ee extends ut{constructor(t,e,n){super(),this.condition=t,this.ifTrue=e,this.ifFalse=n,this.shaderType="condition-node"}get children(){return[this.condition,this.ifTrue,this.ifFalse]}clone(){const t=p(this.ifTrue),e=this.ifFalse?p(this.ifFalse):null,n=new Ee(this.condition,t,e);return this.cloneInto(n),n}}let Sn=class vr extends ut{constructor(t,e,n,i){super(),this.captureList=t,this.returnType=e,this.generator=i,this.shaderType="block-node",n&&(this.subgraph=new $n(n))}get children(){return Object.keys(this.captureList).map(t=>this.captureList[t]).concat(this.subgraph??[])}clone(){const t={};for(const n in this.captureList)t[n]=p(this.captureList[n]);const e=new vr(t,this.returnType,this.subgraph?p(this.subgraph.child):this.subgraph,this.generator);return this.cloneInto(e),e}},st=class wr extends ut{constructor(t,e,n,i,s,o=!1){super(),this.token=t,this._children=e,this.isInfix=n,this.isPropertyAccess=i,this.returnType=s,this.isTernary=o,this.shaderType="function-node"}get children(){return this._children}clone(){const t=new wr(this.token,this._children.map(p),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);return this.cloneInto(t),t}};var Vt,ye,fe,me,ge,be,ve,we,xe,$e,_e,Se,Ie,Te;function In(r){const t=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(const e of t)if(e.includes(r))return e.map(n=>Nn[n]);throw new Error("Unable to find type family")}function xr(r){return new Proxy(r,{get(t,e){if(e==="constructor")return new Proxy(t.constructor,{construct:(n,i,s)=>xr(new n(...i))});if(e in t)return t[e];if(typeof e=="string"){const n=In(r.type);return z(r,e,n[e.length-1])}}})}function A(r){return new Proxy(r,{construct:(t,e,n)=>xr(new t(...e))})}function Tn(r){return new Proxy(r,{get(t,e){if(e in t)return t[e];if(typeof e=="string"){const n=parseInt(e,10);if(!isNaN(n))return z(r,`[${n}]`,r.elementType.constructor)}}})}function Vn(r){return new Proxy(r,{construct:(t,e,n)=>Tn(new t(...e))})}let Ve=class extends Error{},K=Vt=class extends S{constructor(r,t){super(),this.elementType=r,this.size=t,this.children=[],this.type="array"}clone(){const r=new Vt(this.elementType,this.size);return super.cloneInto(r),r}get(r){if(typeof r=="number"){const t=new tt(r);return t.isImplicit=!0,z(this,t,this.elementType.constructor)}return z(this,r,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(r,t,e){return On(this,r,t,e)}glslFindIndex(r,t,e){return Mn(this,r,t,e)}static ofType(r,t){const e={construct:(n,i)=>new Vt(new r,t)};return new Proxy(Vt,e)}};K.type="array",K=Vt=a([Vn],K);let G=class $r extends S{constructor(){super(...arguments),this.type="sampler2D",this.children=[]}clone(){const t=new $r;return t.children=this.children.map(p),super.cloneInto(t),t}};G.type="sampler2D";let u=class pt extends S{constructor(t){super(),this.type="float",this.children=[t]}clone(){const t=new pt(p(this.children[0]));return super.cloneInto(t),t}multiply(t){return et(this,typeof t=="number"?I(t,pt):t)}divide(t){return kt(this,typeof t=="number"?I(t,pt):t)}add(t){return bt(this,typeof t=="number"?I(t,pt):t)}subtract(t){return At(this,typeof t=="number"?I(t,pt):t)}};u.type="float";let g=ye=class extends S{constructor(r,t){super(),this.type="vec2",this.children=[r,t].filter(e=>e!=null)}clone(){const r=new ye(p(this.children[0]),p(this.children[1]));return super.cloneInto(r),r}get 0(){return z(this,"[0]",u)}get 1(){return z(this,"[1]",u)}get 2(){throw new Ve}get 3(){throw new Ve}multiply(r){return et(this,typeof r=="number"?I(r,u):r)}divide(r){return kt(this,typeof r=="number"?I(r,u):r)}add(r){return bt(this,typeof r=="number"?I(r,u):r)}subtract(r){return At(this,typeof r=="number"?I(r,u):r)}};g.type="vec2",g=ye=a([A],g);let T=fe=class extends S{constructor(r,t,e){super(),this.type="vec3",this.children=[r,t,e].filter(n=>n!=null)}get 0(){return z(this,"[0]",u)}get 1(){return z(this,"[1]",u)}get 2(){return z(this,"[2]",u)}get 3(){throw new Ve}clone(){const r=new fe(p(this.children[0]),p(this.children[1]),p(this.children[2]));return super.cloneInto(r),r}multiply(r){return et(this,typeof r=="number"?I(r,u):r)}divide(r){return kt(this,typeof r=="number"?I(r,u):r)}add(r){return bt(this,typeof r=="number"?I(r,u):r)}subtract(r){return At(this,typeof r=="number"?I(r,u):r)}};T.type="vec3",T=fe=a([A],T);let v=me=class extends S{constructor(r,t,e,n){super(),this.type="vec4",this.children=[r,t,e,n].filter(i=>i!=null)}clone(){const r=new me(p(this.children[0]),p(this.children[1]),p(this.children[2]),p(this.children[3]));return super.cloneInto(r),r}get 0(){return z(this,"[0]",u)}get 1(){return z(this,"[1]",u)}get 2(){return z(this,"[2]",u)}get 3(){return z(this,"[3]",u)}multiply(r){return et(this,typeof r=="number"?I(r,u):r)}divide(r){return kt(this,typeof r=="number"?I(r,u):r)}add(r){return bt(this,typeof r=="number"?I(r,u):r)}subtract(r){return At(this,typeof r=="number"?I(r,u):r)}};v.type="vec4",v=me=a([A],v);let Ht=ge=class extends S{constructor(r){super(),this.type="uint",this.children=[r]}clone(){const r=new ge(p(this.children[0]));return super.cloneInto(r),r}};Ht.type="uint",Ht=ge=a([A],Ht);let Gt=be=class extends S{constructor(r,t){super(),this.type="uvec2",this.children=[r,t].filter(e=>e!=null)}clone(){const r=new be(p(this.children[0]),p(this.children[1]));return super.cloneInto(r),r}};Gt.type="uvec2",Gt=be=a([A],Gt);let qt=ve=class extends S{constructor(r,t,e){super(),this.type="uvec3",this.children=[r,t,e].filter(n=>n!=null)}clone(){const r=new ve(p(this.children[0]),p(this.children[1]),p(this.children[2]));return super.cloneInto(r),r}};qt.type="uvec3",qt=ve=a([A],qt);let Wt=we=class extends S{constructor(r,t,e,n){super(),this.type="uvec4",this.children=[r,t,e,n].filter(i=>i!=null)}clone(){const r=new we(p(this.children[0]),p(this.children[1]),p(this.children[2]),p(this.children[3]));return super.cloneInto(r),r}};Wt.type="uvec4",Wt=we=a([A],Wt);class D extends S{constructor(t){super(),this.type="bool",this.children=[t]}and(t){return Ne(this,t)}or(t){return Ir(this,t)}clone(){const t=new D(p(this.children[0]));return super.cloneInto(t),t}}D.type="bool";let Zt=xe=class extends S{constructor(r,t){super(),this.type="bvec2",this.children=[r,t].filter(e=>e!=null)}all(){return Ke(this)}any(){return Le(this)}clone(){const r=new xe(p(this.children[0]),p(this.children[1]));return super.cloneInto(r),r}};Zt.type="bvec2",Zt=xe=a([A],Zt);let Xt=$e=class extends S{constructor(r,t,e){super(),this.type="bvec3",this.children=[r,t,e].filter(n=>n!=null)}all(){return Ke(this)}any(){return Le(this)}clone(){const r=new $e(p(this.children[0]),p(this.children[1]),p(this.children[2]));return super.cloneInto(r),r}};function I(r,t){return typeof r=="number"?new t(r):r}Xt.type="bvec3",Xt=$e=a([A],Xt);let Jt=_e=class extends S{constructor(r,t,e,n){super(),this.type="bvec4",this.children=[r,t,e,n].filter(i=>i!=null)}all(){return Ke(this)}any(){return Le(this)}clone(){const r=new _e(p(this.children[0]),p(this.children[1]),p(this.children[2]),p(this.children[3]));return super.cloneInto(r),r}};Jt.type="bvec4",Jt=_e=a([A],Jt);let tt=class ht extends S{constructor(t){super(),this.type="int",this.children=[t]}multiply(t){return et(this,I(t,ht))}add(t){return bt(this,I(t,ht))}subtract(t){return At(this,I(t,ht))}divide(t){return kt(this,I(t,ht))}clone(){const t=new ht(p(this.children[0]));return super.cloneInto(t),t}};tt.type="int";let Qt=Se=class extends S{constructor(r,t){super(),this.type="ivec2",this.children=[r,t].filter(e=>e!=null)}clone(){const r=new Se(p(this.children[0]),p(this.children[1]));return super.cloneInto(r),r}};Qt.type="ivec2",Qt=Se=a([A],Qt);let Yt=Ie=class extends S{constructor(r,t,e){super(),this.type="ivec3",this.children=[r,t,e].filter(n=>n!=null)}clone(){const r=new Ie(p(this.children[0]),p(this.children[1]),p(this.children[2]));return super.cloneInto(r),r}};Yt.type="ivec3",Yt=Ie=a([A],Yt);let te=Te=class extends S{constructor(r,t,e,n){super(),this.type="ivec4",this.children=[r,t,e,n].filter(i=>i!=null)}clone(){const r=new Te(p(this.children[0]),p(this.children[1]),p(this.children[2]),p(this.children[3]));return super.cloneInto(r),r}};te.type="ivec4",te=Te=a([A],te);let Fn=class _r extends S{constructor(t,e,n,i){super(),this.type="mat2",this.children=[t,e,n,i]}clone(){const t=new _r(p(this.children[0]),p(this.children[1]),p(this.children[2]),p(this.children[3]));return super.cloneInto(t),t}};Fn.type="mat2";class M extends S{static identity(){return new M(1,0,0,0,1,0,0,0,1)}static fromRotation(t){const e=He(t),n=Tr(t);return new M(n,e,0,re(e),n,0,0,0,1)}constructor(t,e,n,i,s,o,l,d,c){super(),this.type="mat3",this.children=[t,e,n,i,s,o,l,d,c]}add(t){return bt(this,t)}multiply(t){return et(this,t)}clone(){const t=new M(p(this.children[0]),p(this.children[1]),p(this.children[2]),p(this.children[3]),p(this.children[4]),p(this.children[5]),p(this.children[6]),p(this.children[7]),p(this.children[8]));return super.cloneInto(t),t}}M.type="mat3";class Nt extends S{static identity(){return new Nt(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(t,e,n,i,s,o,l,d,c,y,f,b,F,N,L,J){super(),this.type="mat4",this.children=[t,e,n,i,s,o,l,d,c,y,f,b,F,N,L,J]}static fromColumns(t,e,n,i){return new Nt(t.x,t.y,t.z,t.w,e.x,e.y,e.z,e.w,n.x,n.y,n.z,n.w,i.x,i.y,i.z,i.w)}multiply(t){return et(this,t)}clone(){const t=new Nt(p(this.children[0]),p(this.children[1]),p(this.children[2]),p(this.children[3]),p(this.children[4]),p(this.children[5]),p(this.children[6]),p(this.children[7]),p(this.children[8]),p(this.children[9]),p(this.children[10]),p(this.children[11]),p(this.children[12]),p(this.children[13]),p(this.children[14]),p(this.children[15]));return super.cloneInto(t),t}}Nt.type="mat4";const Nn={float:u,vec2:g,vec3:T,vec4:v,int:tt,ivec2:Qt,ivec3:Yt,ivec4:te,uint:Ht,uvec2:Gt,uvec3:qt,uvec4:Wt,bool:D,bvec2:Zt,bvec3:Xt,bvec4:Jt},ct=(...r)=>new tt(...r),x=(...r)=>new u(...r),Fe=(...r)=>new g(...r),Cn=(...r)=>new T(...r),Pn=(...r)=>new v(...r),sr=(...r)=>new M(...r);function z(r,t,e){const n=new e(new _n(t,r,e));return n.isImplicit=!0,n}function E(r,t,e,n=null){if(n){const s=new n,o=new n(new st(r,[t,e],!0,!1,s));return o.isImplicit=!0,o}if(t.type==="float"||t.type==="int"){const s=new e.constructor(new st(r,[t,e],!0,!1,e.constructor));return s.isImplicit=!0,s}if((t.type==="mat2"||t.type==="mat3"||t.type==="mat4")&&e.type!=="float"){const s=new e.constructor(new st(r,[t,e],!0,!1,e.constructor));return s.isImplicit=!0,s}const i=new t.constructor(new st(r,[t,e],!0,!1,t.constructor));return i.isImplicit=!0,i}function R(r,t,e=t.constructor){const n=new e(new st(r,[t],!1,!1,e));return n.isImplicit=!0,n}function lt(r,t,e,n=t.constructor){const i=new n(new st(r,[t,e],!1,!1,n));return i.isImplicit=!0,i}function Ue(r,t,e,n,i=t.constructor){const s=new i(new st(r,[t,e,n],!1,!1,i));return s.isImplicit=!0,s}function re(r){return et(r,x(-1))}function Sr(r,t,e,n){return new t(new Sn(r,t,e,n))}function On(r,t,e=0,n=r.size){const i=new tt(e).setMutable().setDebugName("FindIndexIterator"),s=t(r.get(i)).setDebugName("FindIndexPredicate");return Sr({iter:i},tt,s,({out:l,iter:d,subgraph:c})=>`
${l} = -1;

for (; ${d} < ${n}; ${d}++) {

${c.body}

  if (${c.varName}) {
    ${l} = ${d};
    break;
  }

}
`).setDebugName("FindIndexBlock")}function Mn(r,t,e=0,n=r.size){return Sr({array:r},tt,null,({out:s,array:o})=>`
${s} = -1;
for (int i = ${e}; i < ${n}; i++) {
  bool condition;
  ${t({array:o,i:"i",out:"condition"})}
  if (condition) {
    ${s} = i;
    break;
  }
}
`).setDebugName("GlslFindIndexBlock")}function V(r,t,e){const n=typeof t=="function"?t():t,i=typeof e=="function"?e():e,s=new n.constructor(new Ee(r,n,i));return s.isImplicit=!0,s}function zt(...r){const t=r.map(([l,d])=>typeof d=="function"?[l,d()]:[l,d]),e=t[0][1].constructor,n=t.findIndex(l=>l[0]===!0);if(n===-1)throw new Error("A cond must have a fallthrough case with `true`/; ");const i=t.slice(0,n),s=t[n][1],o=new e(i.reduceRight((l,d)=>V(d[0],d[1],l),s));return o.isImplicit=!0,o}function et(r,t){return E("*",r,t)}function kt(r,t){return E("/",r,t)}function bt(r,t){return E("+",r,t)}function At(r,t){return E("-",r,t)}function ji(r,t){return E(">>",r,t)}function Hi(r,t){return E("&",r,t)}function Re(r,t){return E("==",r,t,D)}function Dn(r,t){return E("<",r,t,D)}function oe(r,t){return E("<=",r,t,D)}function k(r,t){return E(">",r,t,D)}function ae(r,t){return E(">=",r,t,D)}function Ir(...r){return r.length<=1?r[0]:r.slice(1).reduce((t,e)=>zn(t,e),r[0])}function zn(r,t){return E("||",r,t,D)}function Ne(...r){return r.length<=1?r[0]:r.slice(1).reduce((t,e)=>kn(t,e),r[0])}function kn(r,t){return E("&&",r,t,D)}function An(r){return R("abs",r)}function Ke(r){return R("all",r,D)}function Le(r){return R("any",r,D)}function En(r){return R("ceil",r)}function Be(r,t,e){return Ue("clamp",r,t,e,r.constructor)}function Tr(r){return R("cos",r)}function Vr(r,t){return lt("distance",r,t,u)}function je(r,t){return lt("dot",r,t,u)}function Un(r){return R("floor",r)}function Fr(r){return R("fract",r)}function Nr(r){return R("length",r,u)}function ft(r,t){return lt("max",r,t)}function Ce(r,t){return lt("min",r,t)}function vt(r,t,e){return Ue("mix",r,t,e)}function wt(r,t){return lt("mod",r,t)}function Rn(r){return R("normalize",r)}function Kn(r){return r.type==="bool"?R("!",r):R("not",r)}function He(r){return R("sin",r)}function Gi(r,t,e){return Ue("smoothstep",r,t,e)}function Y(r,t){return lt("step",r,t,t.constructor)}function q(r,t){return lt("texture2D",r,t,v)}const _t=5;function C(r,t,e){const n=t.split(`
`);for(const i of n)if(i.trim().length){{let s="";e!=null&&(s+=`/*id:${e??"000"}*/   `),r.body+=s.padEnd(14)}r.body+=" ".repeat(r.indent)+i+`
`}}let or=class{write(t){for(const e of t.rootOutputNodes())t.shouldPruneOutputNode(e)||(e.variableName=this._write(t,e.node));return t}_createVarName(t,e){let n="";return typeof e!="boolean"&&typeof e!="number"&&e.debugInfo.name&&(n=`${e.debugInfo.name}_`),`${n}v${t.varCount++}`}_write(t,e,n=!1){if(typeof e=="number"||typeof e=="boolean")return e.toString();let i=t.getEmit(e);if(i)return i;switch(e.shaderType){case"scope-node":i=this._writeScopeNode(t,e);break;case"primitive-node":i=this._writePrimitiveNode(t,e,n);break;case"function-node":i=this._writeFunctionNode(t,e);break;case"property-access-node":i=this._writePropertyAccessNode(t,e);break;case"text-node":i=e.text;break;case"block-node":i=this._writeBlockNode(t,e);break;case"condition-node":i=this._writeConditionNode(t,e)}return t.setEmit(e,i),i}_writeScopeNode(t,e){const n=new e.child.constructor;n.setDebugName(e.debugInfo.name);const i=this._write(t,n,!0);return C(t,`{ /*ScopeStart: ${e.uid} ${e.debugInfo.name}*/`),t.indent+=2,C(t,`${i} = ${this._write(t,e.child)};`),t.indent-=2,C(t,`} /*ScopeEnd: ${e.uid} ${e.debugInfo.name}*/`),i}_writeConditionNode(t,e){const n=new e.ifTrue.constructor,i=this._write(t,n,!0);C(t,`if (${this._write(t,e.condition)}) {`),t.indent+=2;const s=t.createSubgraphContext(),o=this._write(s,e.ifTrue);if(t.body+=s.body,o&&C(t,`${i} = ${o};`),t.indent-=2,C(t,"}"),e.ifFalse){C(t,"else {"),t.indent+=2;const l=t.createSubgraphContext(),d=this._write(l,e.ifFalse);t.body+=l.body,d&&C(t,`${i} = ${d};`),t.indent-=2,C(t,"}")}return i}_writeBlockNode(t,e){const{captureList:n,generator:i,returnType:s}=e,o={};for(const y in n){if(!n[y])continue;const f=this._write(t,n[y]);o[y]=f}const l=new s,d=this._write(t,l,!0);if(o.out=d,e.subgraph){const y=t.createSubgraphContext(),f=this._write(y,e.subgraph.child),b=y.body;o.subgraph={varName:f,body:b}}const c=i(o);return C(t,`{
`),t.indent+=2,C(t,c),t.indent-=2,C(t,`}
`),d}_writePropertyAccessNode(t,e){const n=this._write(t,e.target);return typeof e.property=="string"&&e.property.includes("[")?`${n}${e.property}`:typeof e.property!="string"?`${n}[${this._write(t,e.property)}]`:`${n}.${e.property}`}_writeFunctionNode(t,e){const n=e.returnType.type;if(e.isInfix){const[o,l]=e.children.map(c=>this._write(t,c)),d=this._createVarName(t,e);return C(t,`${n.padEnd(_t)} ${d} = ${o} ${e.token} ${l};`,e.uid),d}const i=e.children.map(o=>this._write(t,o)).join(", "),s=this._createVarName(t,e);return C(t,`${n.padEnd(_t)} ${s} = ${e.token}(${i});`,e.uid),s}_writePrimitiveNode(t,e,n=!1){var c;const i=t.getInput(e);if(i)return i.isUsed=!0,i.variableName;const s=e.children.length===1&&((c=e.children[0])==null?void 0:c.type)===e.type;if(e.isImplicit||s)return this._write(t,e.children[0]);const o=this._createVarName(t,e);if(n)return C(t,`${e.type.padEnd(_t)} ${o};`,e.uid),o;const l=!e.debugInfo.name&&!e.isMutable;if(l&&e.type==="float"&&typeof e.children[0]=="number")return Number.isInteger(e.children[0])?e.children[0].toFixed(1):e.children[0].toString();if(l&&e.type==="int"&&typeof e.children[0]=="number"&&Number.isInteger(e.children[0]))return e.children[0].toString();const d=e.children.map(y=>this._write(t,y)).join(", ");return e.type==="array"?(C(t,`${e.type.padEnd(_t)} ${o} = [${d}];`,e.uid),o):l?`${e.type}(${d})`:(C(t,`${e.type.padEnd(_t)} ${o} = ${e.type}(${d});`,e.uid),o)}},dt=class Cr{constructor(t,e,n){this.variableName=t,this.variableInputType=e,this.node=n,this.type="shader-input",this.isUsed=!1}clone(){return new Cr(this.variableName,this.variableInputType,p(this.node))}},St=class Pr{constructor(t,e,n){this.outVariableName=t,this.outVariableType=e,this.node=n,this.type="shader-output"}clone(){const t=new Pr(this.outVariableName,this.outVariableType,p(this.node));return t.variableName=this.variableName,t}},ar=class ee{static createVertex(t,e,n,i,s,o){const l=[];for(const c in t){const y=t[c],f=n.get(c);f?l.push(new dt(f,"builtin",y)):l.push(new dt("a_"+c,"attribute",y))}for(const c of i){const y=c.uniformHydrated;l.push(new dt(c.uniformName,"uniform",y))}const d=[];for(const c in e){const y=e[c];c==="glPosition"?d.push(new St("gl_Position","builtin",y)):c==="glPointSize"?d.push(new St("gl_PointSize","builtin",y)):d.push(new St("v_"+c,"varying",y))}return new ee(l,d,s,o)}static createFragment(t,e,n,i,s,o){const l=[],d=Array.from(s.rootOutputNodes());for(const y in t){const f=t[y],b=n.get(y);if(b){l.push(new dt(b,"builtin",f));continue}const F=d.find(N=>N.node===f);F&&l.push(new dt(F.outVariableName,F.outVariableType,f))}for(const y of i){const f=y.uniformHydrated;l.push(new dt(y.uniformName,"uniform",f))}const c=[];for(const y in e){const f=e[y],b=n.get(y);if(y==="discard")c.push(new St(null,"discard",f));else{if(!b)throw new Error(`Member ${y} in shader fragment output shoule be tagged as builtin`);c.push(new St(b,"builtin",f))}}return new ee(l,c,o)}constructor(t,e,n,i){this.type="shader-graph-context",this.indent=0,this.body="",this.varCount=0,this._inputShaderTypesByNodeUid=new Map,this._nodeEmitMap=new Map;for(const s of t)this._inputShaderTypesByNodeUid.set(s.node.uid,s);this._outputShaderTypes=e,this._transformFeedbackBindings=n,this._transformFeedbackNames=new Set(n.map(s=>"v_"+s.propertyKey)),this._usedInFragmentShader=i}shouldPruneOutputNode(t){return!!this._usedInFragmentShader&&t.outVariableType!=="builtin"&&!this._transformFeedbackNames.has(t.outVariableName)&&!this._usedInFragmentShader.has(t.node.uid)}setEmit(t,e){this._nodeEmitMap.set(t.uid,e)}getEmit(t){return this._nodeEmitMap.get(t.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(t){return this._inputShaderTypesByNodeUid.get(t.uid)}*rootOutputNodes(){for(const t of this._outputShaderTypes)yield t}*nodes(){const t=[];for(const e of this._outputShaderTypes.values())t.push(e.node);for(;t.length;){const e=t.pop();typeof e!="number"&&typeof e!="boolean"&&t.push(...e.children.filter(Boolean)),yield e}}*nodesOfTypeOrFunction(){for(const t of this.nodes())typeof t!="number"&&typeof t!="boolean"&&(yield t)}createSubgraphContext(){const t=this.clone();return t.body="",t.indent=this.indent+2,t._nodeEmitMap=new Map(this._nodeEmitMap),t}clone(){const t=new ee([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);return t._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid,t.indent=this.indent,t.body=this.body,t.varCount=this.varCount,t._nodeEmitMap=this._nodeEmitMap,t}insertVertexShader(t){t.vertex.code.add(""),this._insertInputs(t,"vertex"),t.vertex.code.add(""),t.vertex.code.add("// OUTPUTS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this.rootOutputNodes()){const n=e.outVariableType==="builtin";this.shouldPruneOutputNode(e)||(n?t.vertex.code.add(`// ${e.outVariableType.padEnd(7)} ${e.node.type.padEnd(9)} ${e.outVariableName};`):t.vertex.code.add(`${e.outVariableType.padEnd(10)} ${e.node.type.padEnd(9)} ${e.outVariableName};`))}t.vertex.code.add(""),t.vertex.code.add("void main() {"),t.vertex.code.add("  "+this.body.split(`
`).join(`
  `));for(const e of this.rootOutputNodes())this.shouldPruneOutputNode(e)||t.vertex.code.add(`  ${e.outVariableName} = ${e.variableName};`);t.vertex.code.add("}")}insertFragmentShader(t){this._insertInputs(t,"fragment"),t.fragment.code.add(""),t.fragment.code.add("void main() {"),t.fragment.code.add("  "+this.body.split(`
`).join(`
  `));for(const e of this.rootOutputNodes())e.outVariableType==="discard"?(t.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),t.fragment.code.add(`  if (${e.variableName}) {`),t.fragment.code.add("    discard;"),t.fragment.code.add("  }"),t.fragment.code.add("  ")):t.fragment.code.add(`  ${e.outVariableName} = ${e.variableName};`);t.fragment.code.add("}")}_insertInputs(t,e){t[e].code.add("// INPUTS: "),t[e].code.add("// --------------------------------------------------------- ");for(const n of this.inputs())n.isUsed&&n.variableInputType!=="builtin"&&(n.node.type==="array"?t[e].code.add(`${n.variableInputType.padEnd(10)} ${n.node.elementType.type.padEnd(9)} ${n.variableName}[${n.node.size}];`):t[e].code.add(`${n.variableInputType.padEnd(10)} ${n.node.type.padEnd(9)} ${n.variableName};`))}};const Ln=()=>Ae.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram");function It(r,t,e){const n=t.length;if(n!==e){const i=new pr("Invalid Uniform",`Invalid length, expected ${e} but got ${n}`,{uniformName:r,values:t});Ln().errorOnce(i)}}class ur{constructor(t,e,n,i,s,o){this._program=null,this._vao=null,this._temporaryTextures=[],this.vertexShader=t,this.fragmentShader=e,this._locations=n,this._locationInfo=i,this._uniformBindings=s,this._transformFeedbackBindings=o}destroy(){this._program&&this._program.dispose(),this.cleanupTemporaryTextures()}get locations(){return this._locations}get locationInfo(){return this._locationInfo}setUniforms(t){this._uniforms=t}cleanupTemporaryTextures(){for(const t of this._temporaryTextures)t.dispose();this._temporaryTextures=[]}bind(t){const e=this._uniforms;if(!this._program){const i=new Map;for(const[o,l]of this._locations)i.set(o,l);const s=[];for(const o of this._transformFeedbackBindings??[]){const{index:l,propertyKey:d}=o;s[l]=`v_${d}`}this._program=new Xr(t,this.vertexShader,this.fragmentShader,i,new Map,s)}const n=this._program;t.useProgram(n);for(const i of this._uniformBindings){const{shaderModulePath:s,uniformName:o,uniformType:l,uniformArrayLength:d}=i,c=Gr(s,e);if(c==null){if(l==="sampler2D")continue;throw new Error(`Failed to find uniform value for ${s}`)}switch(l==="array"?i.uniformArrayElementType:l){case"sampler2D":{const{unit:y,texture:f}=c;if(n.setUniform1i(o,y),"type"in f)t.bindTexture(f,y);else{const b=Jr(t,f.descriptor,f.data);t.bindTexture(b,y)}break}case"int":if(!d){n.setUniform1i(o,c);break}It(i.uniformName,c,d),n.setUniform1iv(o,c);break;case"float":if(!d){n.setUniform1f(o,c);break}It(i.uniformName,c,d),n.setUniform1fv(o,c);break;case"vec2":if(!d){n.setUniform2f(o,c[0],c[1]);break}It(i.uniformName,c,d),n.setUniform2fv(o,c.flat());break;case"vec3":if(!d){n.setUniform3f(o,c[0],c[1],c[2]);break}It(i.uniformName,c,d),n.setUniform3fv(o,c.flat());break;case"vec4":if(!d){n.setUniform4f(o,c[0],c[1],c[2],c[3]);break}It(i.uniformName,c,d),n.setUniform4fv(o,c.flat());break;case"mat3":n.setUniformMatrix3fv(o,c.flat());break;case"mat4":n.setUniformMatrix4fv(o,c.flat());break;default:throw new Error(`Unable to set uniform for type ${l}`)}}}}function Tt(r){return new r}function xt(r,t,e){const n=r.constructor[t]??[];r.constructor.hasOwnProperty(t)||Object.defineProperty(r.constructor,t,{value:n.slice()}),r.constructor[t].push(e)}function m(r,t){return(e,n)=>{xt(e,"locations",{typeCtor:t,propertyKey:n,parameterIndex:null,index:r})}}const Bn=r=>(t,e)=>{xt(t,"builtins",{builtin:r,propertyKey:e})},_=r=>(t,e,n)=>{xt(t,"inputs",{inputCtor:r,propertyKey:e,parameterIndex:n})},h=r=>(t,e)=>{xt(t,"uniforms",{typeCtor:r,propertyKey:e})},P=r=>(t,e)=>{xt(t,"options",{typeCtor:r,propertyKey:e})},lr=(r,t)=>{xt(r,"defines",{propertyKey:t})},Pe=(r,t)=>(e,n)=>{e.constructor.builtins.push({builtin:r,propertyKey:n,typeCtor:t})};let Oe=class{};Oe.builtins=[],a([Pe("gl_VertexID",tt)],Oe.prototype,"glVertexID",void 0);class jn{}let Ct=class{};Ct.builtins=[],a([Pe("gl_FragCoord",v)],Ct.prototype,"glFragCoord",void 0),a([Pe("gl_PointCoord",g)],Ct.prototype,"glPointCoord",void 0);let Or=class{};a([Bn("gl_FragColor")],Or.prototype,"glFragColor",void 0);let U=class{constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}},Hn=class{constructor(){this.logShader=!1,this.computeAttributes={}}get vertexInput(){const t=this._shaderModuleClass.inputs.findLast(e=>e.propertyKey==="vertex"&&e.parameterIndex===0);if(!t)throw new Error("Unable to find vertex input parameter");return t}get computeInput(){return this._shaderModuleClass.inputs.findLast(t=>t.propertyKey==="vertex"&&t.parameterIndex===1)}get fragmentInput(){const t=this._shaderModuleClass.inputs.findLast(e=>e.propertyKey==="fragment");if(!t)throw new Error("Unable to find fragment input parameter");return t}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){var t;return[...this.vertexInput.inputCtor.locations,...((t=this.computeInput)==null?void 0:t.inputCtor.locations)??[]]}get locationsMap(){const t=new Map,e=new Set;for(const n of this.locations)e.has(n.index)?Ae.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",`Unable to assigned attribute ${n.propertyKey} to ${n.index}. Index already in use`,{locationsMap:t}):(t.set(n.propertyKey,n.index),e.add(n.index));return t}get locationInfo(){if(!this._locationInfo){const t=this.locationsMap,e=Array.from(t.entries()).map(([s,o])=>`${s}.${o}`).join("."),n=qr(e),i=this.computeAttributes;this._locationInfo={hash:n,locations:t,computeAttributeMap:i}}return this._locationInfo}get renamedLocationsMap(){const t=new Map;for(const e of this.locations)t.set("a_"+e.propertyKey,e.index);return t}get optionPropertyKeys(){if(!this._optionPropertyKeys){const t=new Set;for(const e of this._options)t.add(e.propertyKey);this._optionPropertyKeys=t}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(t,e,n,i){try{const{vertex:s,fragment:o,uniformBindings:l}=this._generateShaders(t,e,n,i);return new ur(s,o,this.renamedLocationsMap,this.locationInfo,l,this.transformFeedbackBindings)}catch{return new ur("","",this.renamedLocationsMap,this.locationInfo,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(t){const e=this._options.find(i=>i.propertyKey===t);if(e)return{type:"option",className:e.typeCtor};const n=this._uniforms.find(i=>i.propertyKey===t);if(!n)throw new Error(`Unable to find uniform class type for property: ${t}`);return{type:"required",className:n.typeCtor}}getShaderKey(t,e,n,i){const s=Object.keys(t).map(c=>`${c}.${t[c]}`).join("."),o=Object.keys(n).map(c=>`${c}.${n[c]}`).join("."),l=Object.keys(i).map(c=>`${c}.${i[c]}`).join("."),d=Object.keys(e).filter(c=>this.optionPropertyKeys.has(c)&&e[c]).join(".");return`${this.constructor.name}.${s}.${o}.${l}.${d}`}_generateShaders(t,e,n,i){const s=[];this._setDefines(n),this._setOptionalUniforms(s,e),this._setRequiredUniforms(s);const o=this._hydrateVertexInput(i),l=this._injectPackPrecisionFactor(o,t),d=this._hydrateComputeInput(),c=d&&this._injectComputePackPrecisionFactor(d,t),y=this.vertex(l,c),f=this._hydrateFragmentInput(y),b=this.fragment(f),F=new Set;for(const jr in b){const Hr=b[jr];xn(F,Hr)}const N=this._getVertexInputBuiltins(),L=ar.createVertex({...o,...d},y,N,s,this.transformFeedbackBindings,F);new or().write(L);const J=this._getFragmentInputBuiltins(b);J.set("glPointCoord","gl_PointCoord");const $t=ar.createFragment(f,b,J,s,L,this.transformFeedbackBindings);new or().write($t);const Et=this._createShaderBuilder(L,$t),Qe=Et.generate("vertex",!1),Ye=Et.generate("fragment",!1);return this.logShader&&(console.log(Qe),console.log(Ye)),{vertex:Qe,fragment:Ye,uniformBindings:s}}_setDefines(t){for(const e in t)this[e]=t[e]}_setOptionalUniforms(t,e){for(const n of this._options)e[n.propertyKey]?this[n.propertyKey]=this._hydrateUniformGroup(t,n):this[n.propertyKey]=null}_setRequiredUniforms(t){for(const e of this._uniforms)this[e.propertyKey]=this._hydrateUniformGroup(t,e)}_hydrateUniformGroup(t,e){const n=new e.typeCtor;for(const i of n._uniforms??[]){const s=Tt(i.typeCtor),o=`u_${e.propertyKey}_${i.propertyKey}`,l=s.type,d=[e.propertyKey,i.propertyKey].join(".");if("type"in i.typeCtor&&i.typeCtor.type==="array"){const c=s;t.push({shaderModulePath:d,uniformName:o,uniformType:l,uniformArrayLength:c.size,uniformArrayElementType:c.elementType.type,uniformHydrated:s})}else t.push({shaderModulePath:d,uniformName:o,uniformType:l,uniformHydrated:s});n[i.propertyKey]=s}return n}_hydrateVertexInput(t){const e=this.vertexInput.inputCtor,n=e.locations.reduce((i,s)=>t[s.propertyKey]===!1?i:{...i,[s.propertyKey]:Tt(s.typeCtor)},{});for(const{propertyKey:i,typeCtor:s}of e.builtins){const o=Tt(s);n[i]=o}return n}_hydrateComputeInput(){return this.computeInput==null?null:this.computeInput.inputCtor.locations.reduce((t,e)=>({...t,[e.propertyKey]:Tt(e.typeCtor)}),{})}_injectPackPrecisionFactor(t,e){const n={};for(const i in t){const s=t[i],o=e[i];if(o){if(s.type!=="float"&&s.type!=="vec2"&&s.type!=="vec3"&&s.type!=="vec4")throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${s.type}`);n[i]=s.divide(new u(o))}else n[i]=s}return n}_injectComputePackPrecisionFactor(t,e){const n={},i=new Map;for(const s in this.computeAttributes)for(const o of this.computeAttributes[s]??[])i.set(o,s);for(const s in t){const o=t[s],l=i.get(s);if(!l)continue;const d=e[l];if(d){if(o.type!=="float"&&o.type!=="vec2"&&o.type!=="vec3"&&o.type!=="vec4")throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${o.type}`);n[s]=o.divide(new u(d))}else n[s]=o}return n}_hydrateFragmentInput(t){const e={};for(const n in t)e[n]=t[n];for(const{propertyKey:n,typeCtor:i}of Ct.builtins){const s=Tt(i);e[n]=s}return e}_getVertexInputBuiltins(){const t=this.vertexInput.inputCtor,e=new Map;for(const{builtin:n,propertyKey:i}of t.builtins)e.set(i,n);return e}_getFragmentInputBuiltins(t){const e=t.constructor,n=new Map;for(const i of e.builtins??[])n.set(i.propertyKey,i.builtin);return n}_createShaderBuilder(t,e){const n=new hn;return this._insertDebugInfo(n),t.insertVertexShader(n),e.insertFragmentShader(n),n}_insertDebugInfo(t){t.vertex.code.add("// DEFINES: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this._defines)this[e.propertyKey]?t.vertex.code.add(`//   ${e.propertyKey}: true`):t.vertex.code.add(`//   ${e.propertyKey}: false`);t.vertex.code.add(""),t.vertex.code.add("// OPTIONS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this._options)this[e.propertyKey]?t.vertex.code.add(`//   ${e.propertyKey}: true`):t.vertex.code.add(`//   ${e.propertyKey}: false`)}};function cr(r){const t=x(12.9898),e=x(78.233),n=x(43758.5453),i=je(r,Fe(t,e)),s=wt(i,x(3.14));return Fr(He(s).multiply(n))}function at(r){return Re(r,x(an))}function Gn(r,t){return r.x.multiply(t.y).subtract(t.x.multiply(r.y))}function qn(r){return r.multiply(2).subtract(1)}function rt(r,t){const e=x(2**t);return wt(Un(r.divide(e)),x(2))}function Yi(r,t){return k(rt(r,t),x(.5))}function ce(r,t){return rt(r,t+yr.length)}function Wn(r,t){return rt(r,t)}function Zn(r){const t=rt(r.z,7),e=x(1).subtract(t),n=r.xyz.subtract(Cn(0,0,x(128)));return e.multiply(r).add(t.multiply(n))}function Xn(r){const t=Pn(.99609375,.0038909912109375,1519918441772461e-20,59371814131736755e-24);return je(r,t)}function ts(r){return ft(ft(ft(r.x,r.y),r.z),r.w)}let j=class extends U{getVisualVariableData(t){if(!this._vvData){const e=this.getAttributeDataCoords(t);this._vvData=q(this.visualVariableData,e).setDebugName("storage2")}return this._vvData}getAttributeDataCoords(t){if(!this._uv){const e=Zn(t),n=this.size,i=ct(e.x),s=ct(e.y).multiply(ct(256)),o=ct(e.z).multiply(ct(256)).multiply(ct(256)),l=x(i.add(s).add(o)),d=wt(l,n),c=l.subtract(d).divide(n);this._uv=new g(d,c).add(.5).divide(n)}return this._uv}getFilterData(t){const e=this.getAttributeDataCoords(t);return q(this.filterFlags,e).setDebugName("storage0")}getAnimationData(t){const e=this.getAttributeDataCoords(t);return q(this.animation,e).setDebugName("storage1")}getVVData(t){return this.getVisualVariableData(t)}getDataDrivenData0(t){const e=this.getAttributeDataCoords(t);return q(this.dataDriven0,e).setDebugName("storage30")}getDataDrivenData1(t){const e=this.getAttributeDataCoords(t);return q(this.dataDriven1,e).setDebugName("storage31")}getDataDrivenData2(t){const e=this.getAttributeDataCoords(t);return q(this.dataDriven2,e).setDebugName("storage32")}getGPGPUData(t){const e=this.getAttributeDataCoords(t);return q(this.gpgpu,e).setDebugName("storage4")}getFilterFlags(t){return hr("webgl-ignores-sampler-precision")?En(this.getFilterData(t).x.multiply(x(255))):this.getFilterData(t).x.multiply(x(255))}getAnimationValue(t){return this.getAnimationData(t).x}getSizeValue(t){return this.getVisualVariableData(t).x}getColorValue(t){return this.getVisualVariableData(t).y}getOpacityValue(t){return this.getVisualVariableData(t).z}getRotationValue(t){return this.getVisualVariableData(t).w}};a([h(G)],j.prototype,"filterFlags",void 0),a([h(G)],j.prototype,"animation",void 0),a([h(G)],j.prototype,"gpgpu",void 0),a([h(G)],j.prototype,"visualVariableData",void 0),a([h(G)],j.prototype,"dataDriven0",void 0),a([h(G)],j.prototype,"dataDriven1",void 0),a([h(G)],j.prototype,"dataDriven2",void 0),a([h(u)],j.prototype,"size",void 0);let Me=class extends U{};a([h(u)],Me.prototype,"activeReasons",void 0),a([h(u)],Me.prototype,"highlightAll",void 0);class Ft extends U{}a([h(g)],Ft.prototype,"position",void 0),a([h(u)],Ft.prototype,"distance",void 0),a([h(u)],Ft.prototype,"smallSymbolDistance",void 0),a([h(u)],Ft.prototype,"smallSymbolSizeThreshold",void 0);let O=class extends U{};a([h(M)],O.prototype,"displayViewScreenMat3",void 0),a([h(M)],O.prototype,"displayViewMat3",void 0),a([h(M)],O.prototype,"displayMat3",void 0),a([h(M)],O.prototype,"viewMat3",void 0),a([h(M)],O.prototype,"tileMat3",void 0),a([h(u)],O.prototype,"displayZoomFactor",void 0),a([h(u)],O.prototype,"requiredZoomFactor",void 0),a([h(g)],O.prototype,"tileOffset",void 0),a([h(u)],O.prototype,"currentScale",void 0),a([h(u)],O.prototype,"currentZoom",void 0),a([h(u)],O.prototype,"metersPerSRUnit",void 0),a([h(u)],O.prototype,"rotation",void 0),a([h(u)],O.prototype,"pixelRatio",void 0);let ot=class extends Oe{};a([m(0,T)],ot.prototype,"id",void 0),a([m(1,u)],ot.prototype,"bitset",void 0),a([m(2,g)],ot.prototype,"pos",void 0);let X=class extends jn{};a([m(14,g)],X.prototype,"nextPos1",void 0),a([m(15,g)],X.prototype,"nextPos2",void 0);let ue=class extends Ct{},Z=class extends Hn{clip(t,e){let n=new u(0);const i=this.storage.getFilterFlags(t);if(n=n.add(x(2).multiply(x(1).subtract(ce(i,0)))),this.inside?n=n.add(x(2).multiply(x(1).subtract(ce(i,1)))):this.outside?n=n.add(x(2).multiply(ce(i,1))):this.highlight&&(n=n.add(x(2).multiply(x(1).subtract(this._checkHighlight(i))))),e!=null){const s=new u(1).subtract(Y(e.x,this.view.currentZoom)),o=Y(e.y,this.view.currentZoom);n=n.add(new u(2).multiply(s.add(o)))}return n}getFragmentOutput(t,e,n=new u(1/255)){const i=new Or;return i.glFragColor=this._maybeWriteHittest(e)??this._maybeHighlight(t,n)??t,i}_maybeHighlight(t,e){return this.highlight?new v(t.rgb,Y(e,t.a)):null}_checkHighlight(t){let e=this._checkHighlightBit(t,0);for(let n=1;n<yr.length;n++)e=e.add(this._checkHighlightBit(t,n));return Y(new u(.1),e.add(this.highlight.highlightAll))}_checkHighlightBit(t,e){return Wn(t,e).multiply(rt(this.highlight.activeReasons,e))}maybeRunHittest(t,e,n){if(this.hittestRequest==null)return null;const i=this.hittest(t,e,n);let s=V(k(i,this.hittestRequest.distance),new u(2),new u(0));const o=this.storage.getAttributeDataCoords(t.id),l=qn(o);s=s.add(this.clip(t.id,t.zoomRange));const d=new v(new u(1/255),0,0,0);return{glPointSize:new u(1),glPosition:new v(l,s,1),color:d}}_maybeWriteHittest(t){return this.hittestRequest!=null?t.color:null}};a([lr],Z.prototype,"inside",void 0),a([lr],Z.prototype,"outside",void 0),a([P(Me)],Z.prototype,"highlight",void 0),a([h(j)],Z.prototype,"storage",void 0),a([h(O)],Z.prototype,"view",void 0),a([P(Ft)],Z.prototype,"hittestRequest",void 0);function Jn(r,t){return je(r,Rn(t))}function Pt(r,t,e){const n=e.subtract(t),i=Jn(r.subtract(t),n),s=Be(i.divide(Nr(n)),new u(0),new u(1));return Vr(r,t.add(s.multiply(e.subtract(t))))}function Qn(r){const t=An(r);return Y(t.x.add(t.y).add(t.z),new u(1.05))}function Yn(r,t,e,n){const i=new M(e.x.multiply(n.y).subtract(n.x.multiply(e.y)),n.x.multiply(t.y).subtract(t.x.multiply(n.y)),t.x.multiply(e.y).subtract(e.x.multiply(t.y)),e.y.subtract(n.y),n.y.subtract(t.y),t.y.subtract(e.y),n.x.subtract(e.x),t.x.subtract(n.x),e.x.subtract(t.x)),s=t.x.multiply(e.y.subtract(n.y)),o=e.x.multiply(n.y.subtract(t.y)),l=n.x.multiply(t.y.subtract(e.y)),d=s.add(o).add(l);return new u(1).divide(d).multiply(i.multiply(new T(1,r)))}function ti(r,t,e,n){return Re(Qn(Yn(r,t,e,n)),new u(1))}function ei(r,t,e,n){const i=e.subtract(t),s=n.subtract(t),o=Gn(i,s),l=Ne(Dn(o,new u(nr)),k(o,new u(-nr)));return zt([Ne(Kn(l),ti(r.xy,t,e,n)),new u(-1)],[!0,()=>{const d=Pt(r,t,e),c=Pt(r,e,n),y=Pt(r,n,t);return Ce(Ce(d,c),y)}])}function Mr(r){return r.distance.add(1)}function Ge(r,t,e){const{viewMat3:n,tileMat3:i}=r.view,s=n.multiply(i),o=s.multiply(new T(t.pos,1)),l=s.multiply(new T(e.nextPos1,1)),d=s.multiply(new T(e.nextPos2,1));return ei(r.hittestRequest.position,o.xy,l.xy,d.xy)}function us(r,t,e){return Vr(r,e).subtract(t)}let Ot=class extends U{getColor(t,e,n){return zt([Ir(at(t),n),e],[oe(t,this.values.first()),this.colors.first()],[ae(t,this.values.last()),this.colors.last()],[!0,()=>{const i=this.values.findIndex(c=>k(c,t)),s=this.values.get(i),o=i.subtract(1),l=this.values.get(o),d=t.subtract(l).divide(s.subtract(l));return vt(this.colors.get(o),this.colors.get(i),d)}])}};a([h(K.ofType(v,8))],Ot.prototype,"colors",void 0),a([h(K.ofType(u,8))],Ot.prototype,"values",void 0);let Mt=class extends U{getOpacity(t){return zt([at(t),new u(1)],[oe(t,this.opacityValues.first()),this.opacities.first()],[ae(t,this.opacityValues.last()),this.opacities.last()],[!0,()=>{const e=this.opacityValues.findIndex(l=>k(l,t)),n=this.opacityValues.get(e),i=e.subtract(1),s=this.opacityValues.get(i),o=t.subtract(s).divide(n.subtract(s));return vt(this.opacities.get(i),this.opacities.get(e),o)}])}};a([h(K.ofType(u,8))],Mt.prototype,"opacities",void 0),a([h(K.ofType(u,8))],Mt.prototype,"opacityValues",void 0);function Dr(r){return r.visualVariableSizeMinMaxValue!=null||r.visualVariableSizeScaleStops!=null||r.visualVariableSizeStops!=null||r.visualVariableSizeUnitValue!=null}function ri(r,t,e){var n,i,s,o;if(Dr(r)){const l=r.storage.getSizeValue(t);return((n=r.visualVariableSizeMinMaxValue)==null?void 0:n.getSize(l,e))??((i=r.visualVariableSizeScaleStops)==null?void 0:i.getSizeForViewScale(r.view.currentScale))??((s=r.visualVariableSizeStops)==null?void 0:s.getSize(l,e))??((o=r.visualVariableSizeUnitValue)==null?void 0:o.getSize(l,e))}return e}function qe(r,t,e,n=new D(!1)){if(r.visualVariableColor==null)return e;const i=r.storage.getColorValue(t);return r.visualVariableColor.getColor(i,e,n)}function We(r,t){if(r.visualVariableOpacity==null)return new u(1);const e=r.storage.getOpacityValue(t);return r.visualVariableOpacity.getOpacity(e)}function ds(r,t){if(r.visualVariableRotation==null)return M.identity();const e=r.storage.getRotationValue(t);return r.visualVariableRotation.getVVRotationMat3(e)}let Dt=class extends ot{};a([m(3,v)],Dt.prototype,"color",void 0),a([m(4,g)],Dt.prototype,"zoomRange",void 0);let yt=class extends Z{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,e){const n=We(this,t.id),i=qe(this,t.id,t.color).multiply(n),s=this.view.displayViewScreenMat3.multiply(new T(t.pos.xy,1)),o=this.clip(t.id,t.zoomRange);return{glPosition:new v(s.xy,o,1),color:i,...this.maybeRunHittest(t,e,null)}}fragment(t){return this.getFragmentOutput(t.color,t,new u(0))}hittest(t,e){return Ge(this,t,e)}};a([P(Ot)],yt.prototype,"visualVariableColor",void 0),a([P(Mt)],yt.prototype,"visualVariableOpacity",void 0),a([$(0,_(Dt)),$(1,_(X))],yt.prototype,"vertex",null),a([$(0,_(ue))],yt.prototype,"fragment",null);let mt=class extends U{getPatternOffsetAtTileOrigin(t,e=new u(0),n=new u(1)){const i=new g(dn).divide(t);let s=t.multiply(Fr(this.maxIntsToLocalOrigin.multiply(i))).add(this.tileOffsetFromLocalOrigin).subtract(new u(.5).multiply(t));return s=new g(s.x.multiply(n).subtract(s.y.multiply(e)),s.x.multiply(e).add(s.y.multiply(n))),wt(s,t)}};a([h(g)],mt.prototype,"tileOffsetFromLocalOrigin",void 0),a([h(g)],mt.prototype,"maxIntsToLocalOrigin",void 0);let gt=class extends U{};a([h(g)],gt.prototype,"size",void 0),a([h(G)],gt.prototype,"texture",void 0);let nt=class extends Dt{};a([m(5,v)],nt.prototype,"tlbr",void 0),a([m(6,u)],nt.prototype,"width",void 0),a([m(7,u)],nt.prototype,"height",void 0),a([m(8,g)],nt.prototype,"offset",void 0),a([m(9,g)],nt.prototype,"scale",void 0),a([m(10,u)],nt.prototype,"angle",void 0);let ni=class extends ue{};function ii(r,t,e,n,i){const s=Re(rt(i,cn),x(1)),o=Xn(new v(r,0));return V(s,sr(n.divide(t.x),e.divide(t.y),0,re(e.divide(t.x)),n.divide(t.y),0,cr(Fe(o,0)),cr(Fe(0,o)),1),sr(n.divide(t.x),e.divide(t.y),0,re(e.divide(t.x)),n.divide(t.y),0,0,0,1))}function zr(r,t){const e=r.view.requiredZoomFactor,n=new g(t.width,t.height),i=n.multiply(t.scale).multiply(e),s=t.angle.multiply(rn),o=He(s),l=Tr(s),d=ii(t.id,i,o,l,t.bitset),c=r.localTileOffset.getPatternOffsetAtTileOrigin(n,o,l),y=e.multiply(t.scale).multiply(t.offset.subtract(c)).divide(i),f=new T(t.pos,1),b=d.multiply(f).xy.subtract(y),F=t.tlbr.divide(r.mosaicInfo.size.xyxy);let N=rt(t.bitset,un);return r.visualVariableColor!=null&&(N=V(at(r.storage.getColorValue(t.id)),new u(0),N)),{tileTextureCoord:b,tlbr:F,sampleAlphaOnly:N}}function kr(r,t){const e=wt(t.tileTextureCoord,new u(1)),n=vt(t.tlbr.xy,t.tlbr.zw,e);let i=q(r.mosaicInfo.texture,n);return i=V(k(t.sampleAlphaOnly,new u(.5)),i.aaaa,i),t.color.multiply(i)}let Rt=class extends yt{vertex(t,e){return{...super.vertex(t,e),...zr(this,t)}}fragment(t){const e=kr(this,t);return this.getFragmentOutput(e,t,new u(0))}};a([h(gt)],Rt.prototype,"mosaicInfo",void 0),a([h(mt)],Rt.prototype,"localTileOffset",void 0),a([$(0,_(nt)),$(1,_(X))],Rt.prototype,"vertex",null),a([$(0,_(ni))],Rt.prototype,"fragment",null);class Ze extends U{getSize(t,e){const n=this.minMaxValueAndSize.xy,i=this.minMaxValueAndSize.zw;return V(at(t),e,()=>{const s=t.subtract(n.x).divide(n.y.subtract(n.x)),o=Be(s,new u(0),new u(1));return i.x.add(o.multiply(i.y.subtract(i.x)))})}}a([h(v)],Ze.prototype,"minMaxValueAndSize",void 0);class ne extends U{getSizeForViewScale(t){return zt([oe(t,this.values.first()),this.sizes.first()],[ae(t,this.values.last()),this.sizes.last()],[!0,()=>{const e=this.values.findIndex(l=>k(l,t)),n=this.values.get(e),i=e.subtract(1),s=this.values.get(i),o=t.subtract(s).divide(n.subtract(s));return vt(this.sizes.get(i),this.sizes.get(e),o)}])}}a([h(K.ofType(u,8))],ne.prototype,"sizes",void 0),a([h(K.ofType(u,8))],ne.prototype,"values",void 0);let ie=class extends U{getSize(t,e){const n=zt([at(t),e],[oe(t,this.values.first()),this.sizes.first()],[ae(t,this.values.last()),this.sizes.last()],[!0,()=>{const i=this.values.findIndex(c=>k(c,t)),s=this.values.get(i),o=i.subtract(1),l=this.values.get(o),d=t.subtract(l).divide(s.subtract(l));return vt(this.sizes.get(o),this.sizes.get(i),d)}]);return V(at(n),e,n)}};a([h(K.ofType(u,8))],ie.prototype,"sizes",void 0),a([h(K.ofType(u,8))],ie.prototype,"values",void 0);class Xe extends U{getSize(t,e){return V(at(t),e,t.multiply(this.unitValueToPixelsRatio))}}a([h(u)],Xe.prototype,"unitValueToPixelsRatio",void 0);class it extends ot{}a([m(3,v)],it.prototype,"color",void 0),a([m(4,g)],it.prototype,"offset",void 0),a([m(5,g)],it.prototype,"normal",void 0),a([m(6,u)],it.prototype,"halfWidth",void 0),a([m(7,u)],it.prototype,"referenceHalfWidth",void 0),a([m(8,g)],it.prototype,"zoomRange",void 0);let Ar=class extends ue{},se=class extends U{};function Er(r){return ft(new u(nn).multiply(Y(r,new u(sn))),new u(1))}function si(r,t){const{halfWidth:e,normal:n}=r,i=Er(e),s=Nr(n).multiply(e);return Be(i.multiply(e.subtract(s)).divide(t.add(i).subtract(new u(1))),new u(0),new u(1))}function oi(r,t){const{id:e,halfWidth:n,referenceHalfWidth:i}=t;if(Dr(r)){const s=new u(2).multiply(i),o=ri(r,e,s);return new u(.5).multiply(n.divide(ft(i,new u(on)))).multiply(o)}return n}function Ur(r,t){const{id:e,offset:n,pos:i,normal:s,zoomRange:o}=t,{displayViewScreenMat3:l,displayViewMat3:d}=r.view,c=qe(r,e,t.color),y=We(r,e),f=oi(r,t),b=new u(.5).multiply(r.antialiasingControls.antialiasing),F=ft(f.add(b),new u(.45)).add(new u(.1).multiply(b)),N=Er(F).multiply(F).multiply(n),L=d.multiply(new T(N,new u(0))),J=l.multiply(new T(i,new u(1))).add(L),$t=new u(2).multiply(Y(f,new u(0))).add(r.clip(e,o)),Et=new v(J.xy,$t,1);return{color:c,opacity:y,halfWidth:F,normal:s,scaledOffset:N,scaledHalfWidth:f,glPosition:new v(Et.xy,$t,1)}}function le(r,t){const{opacity:e,color:n}=r,i=si(r,t);return e.multiply(n).multiply(i)}a([h(u)],se.prototype,"antialiasing",void 0),a([h(u)],se.prototype,"blur",void 0);class B extends Z{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,e){const n=Ur(this,t);return{...n,...this.maybeRunHittest(t,e,n.halfWidth)}}fragment(t){const e=le(t,this.antialiasingControls.blur);return this.getFragmentOutput(e,t)}hittest(t,e,n){const{viewMat3:i,tileMat3:s}=this.view,o=i.multiply(s),l=o.multiply(new T(t.pos,1)),d=o.multiply(new T(e.nextPos1,1)),c=o.multiply(new T(e.nextPos2,1)),{distance:y,smallSymbolDistance:f,smallSymbolSizeThreshold:b}=this.hittestRequest,F=Y(n,b.multiply(.5)).multiply(y.subtract(f)),N=this.hittestRequest.position;return Ce(Pt(N,l.xy,d.xy),Pt(N,l.xy,c.xy)).subtract(n).add(F)}}a([h(se)],B.prototype,"antialiasingControls",void 0),a([P(Ot)],B.prototype,"visualVariableColor",void 0),a([P(Mt)],B.prototype,"visualVariableOpacity",void 0),a([P(Ze)],B.prototype,"visualVariableSizeMinMaxValue",void 0),a([P(ne)],B.prototype,"visualVariableSizeScaleStops",void 0),a([P(ie)],B.prototype,"visualVariableSizeStops",void 0),a([P(Xe)],B.prototype,"visualVariableSizeUnitValue",void 0),a([$(0,_(it)),$(1,_(X))],B.prototype,"vertex",null),a([$(0,_(Ar))],B.prototype,"fragment",null);class Q extends ot{}a([m(3,g)],Q.prototype,"offset",void 0),a([m(4,v)],Q.prototype,"color",void 0),a([m(5,g)],Q.prototype,"normal",void 0),a([m(6,u)],Q.prototype,"halfWidth",void 0),a([m(7,u)],Q.prototype,"referenceHalfWidth",void 0),a([m(8,g)],Q.prototype,"zoomRange",void 0);let Rr=class extends Ar{};function Je(r,t,e){const{id:n,bitset:i}=t,s=rt(i,ln),o=k(s,new u(.5)),l=Ur(r,t),d=V(o,l.halfWidth,new u(0)),c=We(r,n),y=qe(r,n,t.color),f=V(o,t.color,y.multiply(c)),b=r.view.displayViewScreenMat3.multiply(new T(t.pos.xy,1)),F=r.clip(t.id),N=new v(b.xy,F,1),L=V(o,l.glPosition,N),J=e&&r.maybeRunHittest(t,e,o);return{isOutline:s,color:f,opacity:new u(1),halfWidth:d,normal:l.normal,glPosition:L,...J}}let W=class extends Z{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}};a([h(se)],W.prototype,"antialiasingControls",void 0),a([P(Ot)],W.prototype,"visualVariableColor",void 0),a([P(Mt)],W.prototype,"visualVariableOpacity",void 0),a([P(Ze)],W.prototype,"visualVariableSizeMinMaxValue",void 0),a([P(ne)],W.prototype,"visualVariableSizeScaleStops",void 0),a([P(ie)],W.prototype,"visualVariableSizeStops",void 0),a([P(Xe)],W.prototype,"visualVariableSizeUnitValue",void 0);class De extends W{vertex(t,e){return Je(this,t,e)}fragment(t){const{color:e,isOutline:n}=t,i=k(n,new u(.5)),s=le(t,this.antialiasingControls.blur),o=V(i,s,e),l=V(i,new u(1/255),new u(0));return this.getFragmentOutput(o,t,l)}hittest(t,e,n){return V(n,Mr(this.hittestRequest),Ge(this,t,e))}}a([$(0,_(Q)),$(1,_(X))],De.prototype,"vertex",null),a([$(0,_(Rr))],De.prototype,"fragment",null);class ze extends Dt{}a([m(5,v)],ze.prototype,"tlbr",void 0),a([m(6,u)],ze.prototype,"inverseRasterizationScale",void 0);class ai extends ue{}function ui(r){const t=new u(1),e=new u(0);return new M(t.divide(r.x),e.divide(r.y),0,re(e.divide(r.x)),t.divide(r.y),0,0,0,1)}function Kr(r,t){const e=t.tlbr.xy,n=t.tlbr.zw,i=n.x.subtract(e.x),s=e.y.subtract(n.y),o=new g(i,s).multiply(t.inverseRasterizationScale),l=o.multiply(r.view.requiredZoomFactor),d=ui(l),c=r.localTileOffset.getPatternOffsetAtTileOrigin(o).divide(l),y=new T(t.pos,1);return{tileTextureCoord:d.multiply(y).xy.subtract(c),tlbr:t.tlbr.divide(r.mosaicInfo.size.xyxy)}}function Lr(r,t){const e=wt(r.tileTextureCoord,new u(1)),n=vt(r.tlbr.xy,r.tlbr.zw,e),i=q(t.texture,n);return r.color.multiply(i)}class Kt extends yt{vertex(t,e){return{...super.vertex(t,e),...Kr(this,t)}}fragment(t){const e=Lr(t,this.mosaicInfo);return this.getFragmentOutput(e,t,new u(0))}}a([h(gt)],Kt.prototype,"mosaicInfo",void 0),a([h(mt)],Kt.prototype,"localTileOffset",void 0),a([$(0,_(ze)),$(1,_(X))],Kt.prototype,"vertex",null),a([$(0,_(ai))],Kt.prototype,"fragment",null);class ke extends Q{}a([m(9,v)],ke.prototype,"tlbr",void 0),a([m(10,u)],ke.prototype,"inverseRasterizationScale",void 0);class Br extends Rr{}let Lt=class extends De{vertex(t,e){return{...Je(this,t,e),...Kr(this,t)}}fragment(t){const{isOutline:e}=t,n=k(e,new u(.5)),i=le(t,this.antialiasingControls.blur),s=Lr(t,this.mosaicInfo),o=V(n,i,s),l=V(n,new u(1/255),new u(0));return this.getFragmentOutput(o,t,l)}};a([h(gt)],Lt.prototype,"mosaicInfo",void 0),a([h(mt)],Lt.prototype,"localTileOffset",void 0),a([$(0,_(ke)),$(1,_(X))],Lt.prototype,"vertex",null),a([$(0,_(Br))],Lt.prototype,"fragment",null);const li=16,dr=1/li,ci=128;class H extends ot{}a([m(3,v)],H.prototype,"color",void 0),a([m(4,v)],H.prototype,"tlbr",void 0),a([m(5,u)],H.prototype,"angle",void 0),a([m(6,u)],H.prototype,"aux1",void 0),a([m(7,u)],H.prototype,"aux2",void 0),a([m(8,g)],H.prototype,"aux3",void 0),a([m(9,g)],H.prototype,"aux4",void 0),a([m(10,g)],H.prototype,"zoomRange",void 0);class di extends Br{}class Bt extends W{vertex(t,e){const{aux1:n,aux2:i,aux3:s,aux4:o}=t,l={...t,width:n,height:i,offset:s,scale:o.multiply(dr)},d={...t,halfWidth:n,referenceHalfWidth:i,offset:s,normal:o.subtract(ci).multiply(dr)},c=Je(this,d),y=zr(this,l),f=k(c.isOutline,new u(.5));return{...c,...y,...this.maybeRunHittest(t,e,f)}}fragment(t){const{isOutline:e}=t,n=k(e,new u(.5)),i=le(t,this.antialiasingControls.blur),s=kr(this,t),o=V(n,i,s),l=V(n,new u(1/255),new u(0));return this.getFragmentOutput(o,t,l)}hittest(t,e,n){return V(n,Mr(this.hittestRequest),Ge(this,t,e))}}a([h(gt)],Bt.prototype,"mosaicInfo",void 0),a([h(mt)],Bt.prototype,"localTileOffset",void 0),a([$(0,_(H)),$(1,_(X))],Bt.prototype,"vertex",null),a([$(0,_(di))],Bt.prototype,"fragment",null);const pi=8388607,hi=8388608,Is=r=>r&pi;function Ts(r,t){return((t?hi:0)|r)>>>0}const Vs={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4}};let jt=class extends Qr{constructor(r){super(r),this.debugName="",this._updatingHandles=new en,this._idToUpdatingState=new Yr}get updating(){const r=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some(t=>t);if(hr("esri-2d-log-updating")){const t=Array.from(this._idToUpdatingState.entries()).map(([e,n])=>`-> ${e}: ${n}`).join(`
`);console.log(`${this.debugName}: Updating: ${r}
-> Handles: ${this._updatingHandles.updating}
${t}`)}return r}addUpdateTracking(r,t){const e=tn(()=>t.updating,n=>this._idToUpdatingState.set(r,n),{sync:!0});this.addHandles(e)}addPromise(r){return this._updatingHandles.addPromise(r)}};a([tr({constructOnly:!0})],jt.prototype,"debugName",void 0),a([tr({readOnly:!0})],jt.prototype,"updating",null),jt=a([Wr("esri.views.2d.layers.support.UpdateTracking2D")],jt);export{at as $,ue as A,ln as B,cn as C,Pi as D,Oi as E,Mi as F,T as G,Di as H,ot as I,Z as J,lr as K,Nt as L,je as M,ts as N,Mr as O,U as P,yt as Q,Bt as R,li as S,De as T,K as U,Kt as V,Lt as W,us as X,Ct as Y,V as Z,Rt as _,q as a,Re as a0,rr as a1,Vi as a2,He as a3,Tr as a4,P as a5,jn as a6,An as a7,Ce as a8,Un as a9,si as aA,X as aB,Yi as aC,We as aD,qe as aE,rn as aF,Dn as aG,Fi as aH,Vr as aI,Yn as aJ,re as aK,Qn as aL,ur as aM,rt as aa,Ni as ab,ri as ac,ds as ad,Ir as ae,k as af,D as ag,Ci as ah,ei as ai,tt as aj,ji as ak,Hi as al,Ot as am,Mt as an,Ze as ao,ne as ap,ie as aq,Xe as ar,gt as as,B as at,it as au,Fr as av,vt as aw,Xn as ax,Be as ay,Ur as az,Oe as b,ft as c,jt as d,er as e,Is as f,h as g,m as h,u as i,Hn as j,an as k,Y as l,v as m,pi as n,Vs as o,Nr as p,un as q,Gi as r,Ts as s,M as t,_ as u,g as v,ci as w,G as x,Or as y,O as z};
