import{d as U,b as A,A as p,N as Mt,z as $t,g as Tt,O as ot,c as Zt,t as tn,e as ut,r as xt,n as L}from"./mathUtils-ClvKsMak.js";import{p as nn,o as en,l as Ot,m as on,x as an}from"./mat4-ybYUU6jq.js";import{e as Bt}from"./mat4f64-Dk4dwAN8.js";import{r as rn,_ as H}from"./vec2-B_ymkwGp.js";import{r as J,n as cn}from"./vec2f64-Diu2Kaa8.js";import{l as dt}from"./ViewingMode-Dodu7ZZk.js";import{o as ln}from"./_commonjsHelpers-DCkdB7M8.js";import{v as sn}from"./mathUtils-kvswLROa.js";import{e as Pt}from"./Evented-CXIxDjmW.js";import{r as wt,t as un}from"./ShaderTechniqueConfiguration-D3UbJ2mX.js";var zt,Et,It,Jt={exports:{}};zt=Jt,Et=function(){var n=Math.PI,t=Math.sin,e=Math.cos,o=Math.tan,l=Math.asin,a=Math.atan2,m=Math.acos,r=n/180,g=864e5,s=2440588,O=2451545,D={dec:0,ra:0};function _(i){return i.valueOf()/g-.5+s}function P(i){return new Date((i+.5-s)*g)}function w(i){return _(i)-O}var I=23.4397*r;function N(i,c){return a(t(i)*e(I)-o(c)*t(I),e(i))}function y(i,c){return l(t(c)*e(I)+e(c)*t(I)*t(i))}function M(i,c,u){return a(t(i),e(i)*t(c)-o(u)*e(c))}function T(i,c,u){return l(t(c)*t(u)+e(c)*e(u)*e(i))}function G(i,c){return r*(280.16+360.9856235*i)-c}function R(i){return r*(357.5291+.98560028*i)}function d(i){return r*(1.9148*t(i)+.02*t(2*i)+3e-4*t(3*i))}function ft(i,c){return i+c+102.9372*r+n}function mt(i,c){var u=R(i),f=ft(u,d(u));return c||(c={dec:0,ra:0}),c.dec=y(f,0),c.ra=N(f,0),c}var z={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(i,c,u,f){var b=r*-u,v=r*c,$=w(i),x=mt($,D),E=G($,b)-x.ra;return f||(f={azimuth:0,altitude:0}),f.azimuth=M(E,v,x.dec),f.altitude=T(E,v,x.dec),f}},F=[[-.83,"sunrise","sunset"]];z.addTime=function(i,c,u){F.push([i,c,u])};var ht=9e-4;function Vt(i,c){return Math.round(i-ht-c/(2*n))}function gt(i,c,u){return ht+(i+c)/(2*n)+u}function bt(i,c,u){return O+i+.0053*t(c)-.0069*t(2*u)}function Wt(i,c,u){return m((t(i)-t(c)*t(u))/(e(c)*e(u)))}function pt(i){var c=r*(134.963+13.064993*i),u=r*(93.272+13.22935*i),f=r*(218.316+13.176396*i)+6.289*r*t(c),b=5.128*r*t(u),v=385001-20905*e(c);return{ra:N(f,b),dec:y(f,b),dist:v}}return z.getTimes=function(i,c,u){var f=r*-u,b=r*c,v=Vt(w(i),f),$=gt(0,f,v),x=R($),E=d(x),K=ft(x,E),Q=y(K,0),C=bt($,x,K);function Xt(W){return bt(gt(Wt(W,b,Q),f,v),x,K)}function Yt(W){var Nt=(t(W)-t(b)*t(Q))/(e(b)*e(Q));return Nt<-1?z.PolarException.MIDNIGHT_SUN:Nt>1?z.PolarException.POLAR_NIGHT:z.PolarException.NORMAL}var j,yt,V,vt,At,k={solarNoon:P(C),nadir:P(C-.5),polarException:z.PolarException.NORMAL};for(j=0,yt=F.length;j<yt;j+=1)At=C-((vt=Xt((V=F[j])[0]*r))-C),k[V[1]]=P(At),k[V[2]]=P(vt);return k.polarException=Yt(F[0][0]*r),k},z.getMoonPosition=function(i,c,u){var f=r*-u,b=r*c,v=w(i),$=pt(v),x=G(v,f)-$.ra,E=T(x,b,$.dec);return E+=.017*r/o(E+10.26*r/(E+5.1*r)),{azimuth:M(x,b,$.dec),altitude:E,distance:$.dist}},z.getMoonFraction=function(i){var c=w(i),u=mt(c),f=pt(c),b=149598e3,v=m(t(u.dec)*t(f.dec)+e(u.dec)*e(f.dec)*e(u.ra-f.ra)),$=a(b*t(v),f.dist-b*e(v));return(1+e($))/2},z},(It=Et())!==void 0&&(zt.exports=It);const S=ln(Jt.exports),h={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};class q{constructor(t,e){this.direct=t,this.ambient=e}}function zn(n,t,e,o,l,a){U(a.ambient.color,1,1,1),a.ambient.intensity=h.global.ambient,U(a.direct.color,1,1,1),a.direct.intensity=h.global.direct;const m=t[2],r=ut((Math.abs(m)-h.local.altitude)/(h.global.altitude-h.local.altitude),0,1);let g;if(a.globalFactor=r,n!=null&&(g=S.getTimes(n,t[1],t[0])),r<1){let s;if(n!=null)s=bn(n,g,o);else{const O=Qt(o);s={direct:{intensity:h.local.directAtNoon*O.direct,color:A(1,1,1)},ambient:{intensity:h.local.ambientAtNoon*O.ambient,color:A(1,1,1)},timeOfDay:"early afternoon"}}p(a.ambient.color,s.ambient.color,a.ambient.color,r),a.ambient.intensity=Mt(s.ambient.intensity,a.ambient.intensity,r),p(a.direct.color,s.direct.color,a.direct.color,r),a.direct.intensity=Mt(s.direct.intensity,a.direct.intensity,r),a.specularStrength=o==="rainy"||o==="snowy"||o==="foggy"?0:1,a.environmentStrength=o==="rainy"?.7:o==="snowy"||o==="foggy"?.75:1}a.noonFactor=n!=null?gn(n,g):1,n!=null?Kt(n,t,e,a.direct.directionToLightSource):dn(l,e,a.direct.directionToLightSource)}function dn(n,t,e){t===dt.Global?$t(tt,n.eye):U(tt,0,0,1),Tt(nt,n.viewForward,-1);const o=sn(nt,tt),l=Math.max(o-2*et,0),a=.85*l/(l+1),m=Math.max(et,o-et-a);nn(kt,-m,n.viewRight),ot(e,nt,kt),Zt(e,e,Tt(pn,n.viewRight,yn)),$t(e,e)}function Kt(n,t,e,o){const l=hn,a=en(mn);if(e===dt.Global)S.getPosition(n,0,0,l),U(o,0,0,-1),Ot(a,a,-l.azimuth),on(a,a,-l.altitude),ot(o,o,a);else{const m=h.planarDirection,r=m.globalAngles,g=t[2];let s=(Math.abs(g)-m.localAltitude)/(m.globalAltitude-m.localAltitude);s=ut(s,0,1),s<1?(S.getPosition(n,t[1],t[0],l),l.azimuth=(1-s)*l.azimuth+s*r.azimuth,l.altitude=(1-s)*l.altitude+s*r.altitude):(l.azimuth=r.azimuth,l.altitude=r.altitude),U(o,0,-1,0),an(a,a,-l.azimuth),Ot(a,a,-l.altitude),ot(o,o,a)}}function En(n,t){if(t===dt.Global)return!0;const e=h.planarDirection;return Math.abs(n)<e.localAltitude}function In(n,t,e,o,l){const a=n.getTime(),m=t.getTime()-a,r=Math.floor(m/e)+1,g=new Array(r);for(let s=0;s<r;++s)jt.setTime(a+e*s),g[s]=L(),Kt(jt,o,l,g[s]);return g}const fn=A(.5773502691896258,-.5773502691896258,.5773502691896258);class Gn{constructor(){this.ambient={color:A(1,1,1),intensity:.55},this.direct={color:A(1,1,1),intensity:.55,directionToLightSource:tn(fn)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const mn=Bt(),hn={azimuth:0,altitude:0};function gn(n,t){const e=n.valueOf();let o,l;t.polarException===S.PolarException.MIDNIGHT_SUN?(o=e-60*(n.getHours()+48)*60*1e3-60*n.getMinutes()*1e3,l=o+432e6):t.polarException===S.PolarException.POLAR_NIGHT?(o=e-2,l=e-1):(o=t.sunrise.valueOf(),l=t.sunset.valueOf());const a=o+(l-o)/2;return 1-ut(Math.abs(e-a)/432e5,0,1)}function Qt(n){switch(n){case"disabled":case"sunny":case"cloudy":return new q(1,1);case"rainy":return new q(.4,1.2);case"snowy":return new q(.5,1.3);case"foggy":return new q(.2,1.6)}}function Gt(n,t){const e=(n[0]+n[1]+n[2])/3;n[0]+=(e-n[0])*t,n[1]+=(e-n[1])*t,n[2]+=(e-n[2])*t}const X=A(.01,.01,.01),it=A(1,.6,.5),at=A(1,.98,.98),St=A(1,1,1),Y=A(.8,.8,1),rt=A(.8,.8,1),ct=A(.98,.98,1),Dt=A(1,1,1),Z=J(.01,h.local.ambientAtNight),lt=J(h.local.directAtTwilight,h.local.ambientAtTwilight),st=J(.9*h.local.directAtNoon,h.local.ambientAtNoon),Ht=J(h.local.directAtNoon,h.local.ambientAtNoon),Lt=st,_t=at,Rt=ct,Ut=lt,Ft=it,Ct=rt;function bn(n,t,e){const o=n.valueOf();let l,a;t.polarException===S.PolarException.MIDNIGHT_SUN?(l=o-60*(n.getHours()+48)*60*1e3-60*n.getMinutes()*1e3,a=l+432e6):t.polarException===S.PolarException.POLAR_NIGHT?(l=o-2,a=o-1):(l=t.sunrise.valueOf(),a=t.sunset.valueOf());const m=a-l,r=l+m/2,g=m/4,s=r-g,O=r+g,D=.06*m,_=l-D/2,P=l+D/2,w=a-D/2,I=a+D/2,N=cn(),y=L(),M=L();let T="";if(o<_||o>I)rn(N,Z),xt(y,X),xt(M,Y),T="night";else if(o<P){const d=(o-_)/(P-_);H(N,Z,lt,d),p(y,X,it,d),p(M,Y,rt,d),T="sun rising"}else if(o<s){const d=(o-P)/(s-P);H(N,lt,st,d),p(y,it,at,d),p(M,rt,ct,d),T="early morning"}else if(o<r){const d=(o-s)/(r-s);H(N,st,Ht,d),p(y,at,St,d),p(M,ct,Dt,d),T="late morning"}else if(o<O){const d=(o-r)/(O-r);H(N,Ht,Lt,d),p(y,St,_t,d),p(M,Dt,Rt,d),T="early afternoon"}else if(o<w){const d=(o-O)/(w-O);H(N,Lt,Ut,d),p(y,_t,Ft,d),p(M,Rt,Ct,d),T="late afternoon"}else if(o<I){const d=(o-w)/(I-w);H(N,Ut,Z,d),p(y,Ft,X,d),p(M,Ct,Y,d),T="sun setting"}let G=0;switch(e){case"rainy":case"foggy":G=.8;break;case"snowy":G=.5}G>0&&(Gt(y,G),Gt(M,G));const R=Qt(e);return{direct:{intensity:N[0]*R.direct,color:y},ambient:{intensity:N[1]*R.ambient,color:M},timeOfDay:T}}const jt=new Date(0),kt=Bt(),tt=L(),nt=L(),pn=L(),et=.25,yn=.2;var B;(function(n){n[n.Gradient=0]="Gradient",n[n.Threshold=1]="Threshold",n[n.COUNT=2]="COUNT"})(B||(B={}));class qt extends un{constructor(){super(...arguments),this.visualization=B.Gradient,this.bandsEnabled=!1}}Pt([wt({count:B.COUNT})],qt.prototype,"visualization",void 0),Pt([wt()],qt.prototype,"bandsEnabled",void 0);export{In as D,Gn as I,dn as O,zn as S,qt as r,B as t,S as u,En as z};
