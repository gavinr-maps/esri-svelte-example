import{_ as L,gd as Q,ay as $}from"./index-B1qcMJFy.js";import{y as W}from"./DoubleArray-D7gNrzaD.js";import{i as X,a as Z}from"./MeshLocalVertexSpace-Bs8ui3ZL.js";import{n as ee,s as te}from"./vec3-DSi-VB0T.js";import"./vec4f64-CCf6w8sj.js";import"./sphere-Cf-VEmWa.js";import"./I3SUtil-CNcR_ykx.js";import"./vec42-B-sS29RP.js";import"./ObjectStack-aJ7Mjxbo.js";import"./plane-CxxdxNVW.js";import"./mat3f64-q3fE-ZOt.js";import"./mat4f64-CSKppSlJ.js";import"./quatf64-Bdb9ZJJK.js";import"./computeTranslationToOriginAndRotation-cKPYaaYJ.js";import"./I3SBinaryReader-C6ibilxO.js";import"./VertexAttribute-BlT9lbVY.js";import"./symbolColorUtils-CXirog80.js";import"./orientedBoundingBox-CGA_gRQo.js";import"./quat-9HFu1srU.js";var R,B;(function(e){e[e.None=0]="None",e[e.Int16=1]="Int16",e[e.Int32=2]="Int32"})(R||(R={})),function(e){e[e.Replace=0]="Replace",e[e.Outside=1]="Outside",e[e.Inside=2]="Inside",e[e.Finished=3]="Finished"}(B||(B={}));function oe(){return v||(v=new Promise(e=>L(()=>import("./i3s-ClY_1OJ3.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(t=>t.i).then(({default:t})=>{const o=t({locateFile:ne,onRuntimeInitialized:()=>e(o)});delete o.then})).catch(e=>{throw e})),v}function ne(e){return Q(`esri/libs/i3s/${e}`)}let v;var k,g,j,H,V;(function(e){e[e.Unmodified=0]="Unmodified",e[e.Culled=1]="Culled",e[e.NotChecked=2]="NotChecked"})(k||(k={})),function(e){e[e.Unmodified=0]="Unmodified",e[e.PotentiallyModified=1]="PotentiallyModified",e[e.Culled=2]="Culled",e[e.Unknown=3]="Unknown",e[e.NotChecked=4]="NotChecked"}(g||(g={}));(function(e){e[e.Unknown=0]="Unknown",e[e.Uncached=1]="Uncached",e[e.Cached=2]="Cached"})(j||(j={})),function(e){e[e.None=0]="None",e[e.MaxScreenThreshold=1]="MaxScreenThreshold",e[e.ScreenSpaceRelative=2]="ScreenSpaceRelative",e[e.RemovedFeatureDiameter=3]="RemovedFeatureDiameter",e[e.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera"}(H||(H={})),function(e){e[e.Hole=0]="Hole",e[e.Leaf=1]="Leaf"}(V||(V={}));async function Re(e){r=await _();const t=[e.geometryBuffer];return{result:Y(r,e,t),transferList:t}}async function Pe(e){var m;r=await _();const t=[e.geometryBuffer],{geometryBuffer:o}=e,a=o.byteLength,i=r._malloc(a),u=new Uint8Array(r.HEAPU8.buffer,i,a);u.set(new Uint8Array(o));const f=r.dracoDecompressPointCloudData(i,u.byteLength);if(r._free(i),f.error.length>0)throw new Error(`i3s.wasm: ${f.error}`);const l=((m=f.featureIds)==null?void 0:m.length)>0?f.featureIds.slice():null,s=f.positions.slice();return l&&t.push(l.buffer),t.push(s.buffer),{result:{positions:s,featureIds:l},transferList:t}}async function Se(e){await _(),ie(e);const t={buffer:e.buffer};return{result:t,transferList:[t.buffer]}}async function Ue(e){await _(),re(e)}async function Oe(e){r=await _(),r.setLegacySchema(e.context,e.jsonSchema)}async function Me(e){const{localMatrix:t,origin:o,positions:a,vertexSpace:i,localMode:u}=e,f=$.fromJSON(e.inSpatialReference),l=$.fromJSON(e.outSpatialReference);let s;if(i.type==="georeferenced"&&i.origin==null){const[{projectBuffer:c},{initializeProjection:b}]=await Promise.all([L(()=>import("./index-B1qcMJFy.js").then(d=>d.ks),__vite__mapDeps([1,2]),import.meta.url),L(()=>import("./index-B1qcMJFy.js").then(d=>d.kt),__vite__mapDeps([1,2]),import.meta.url)]);await b(f,l),s=new Float64Array(a.length),c(a,f,0,s,l,0,s.length/3)}else{const c=i.type==="georeferenced"?X.fromJSON(i):Z.fromJSON(i),{project:b}=await L(()=>import("./georeference-DRAcP5YF.js").then(d=>d.g),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10,11,12,13,14,15]),import.meta.url);s=W(b({positions:a,transform:t?{localMatrix:t}:void 0,vertexSpace:c,inSpatialReference:f,outSpatialReference:l,localMode:u}))}const m=s.length,[P,S,U]=o;for(let c=0;c<m;c+=3)s[c]-=P,s[c+1]-=S,s[c+2]-=U;return{result:{projected:s,original:a},transferList:[s.buffer,a.buffer]}}async function ve({normalMatrix:e,normals:t}){const o=new Float32Array(t.length);return ee(o,t,e),te(o,o),{result:{transformed:o,original:t},transferList:[o.buffer,t.buffer]}}function Te(e){J(e)}let I,r;function re(e){if(!r)return;const t=e.modifications,o=r._malloc(8*t.length),a=new Float64Array(r.HEAPU8.buffer,o,t.length);for(let i=0;i<t.length;++i)a[i]=t[i];r.setModifications(e.context,o,t.length,e.isGeodetic),r._free(o)}function Y(e,t,o){const{context:a,localOrigin:i,globalTrafo:u,mbs:f,obbData:l,elevationOffset:s,geometryBuffer:m,geometryDescriptor:P,indexToVertexProjector:S,vertexToRenderProjector:U}=t,c=e._malloc(m.byteLength),b=33,d=e._malloc(b*Float64Array.BYTES_PER_ELEMENT),T=new Uint8Array(e.HEAPU8.buffer,c,m.byteLength);T.set(new Uint8Array(m));const p=new Float64Array(e.HEAPU8.buffer,d,b);A(p,i);let E=p.byteOffset+3*p.BYTES_PER_ELEMENT,w=new Float64Array(p.buffer,E);A(w,u),E+=16*p.BYTES_PER_ELEMENT,w=new Float64Array(p.buffer,E),A(w,f),E+=4*p.BYTES_PER_ELEMENT,l&&(w=new Float64Array(p.buffer,E),A(w,l));const x=P,z={isDraco:!1,isLegacy:!1,color:t.layouts.some(y=>y.some(h=>h.name==="color")),normal:t.needNormals&&t.layouts.some(y=>y.some(h=>h.name==="normalCompressed")),uv0:t.layouts.some(y=>y.some(h=>h.name==="uv0")),uvRegion:t.layouts.some(y=>y.some(h=>h.name==="uvRegion")),featureIndex:x.featureIndex},n=e.process(a,!!t.obbData,c,T.byteLength,x,z,d,s,S,U,t.normalReferenceFrame);if(e._free(d),e._free(c),n.error.length>0)throw new Error(`i3s.wasm: ${n.error}`);if(n.discarded)return null;const O=n.componentOffsets.length>0?n.componentOffsets.slice():null,M=n.featureIds.length>0?n.featureIds.slice():null,G=n.anchorIds.length>0?Array.from(n.anchorIds):null,q=n.anchors.length>0?Array.from(n.anchors):null,D=n.interleavedVertedData.slice().buffer,F=n.indicesType===R.Int16?new Uint16Array(n.indices.buffer,n.indices.byteOffset,n.indices.byteLength/2).slice():new Uint32Array(n.indices.buffer,n.indices.byteOffset,n.indices.byteLength/4).slice(),C=n.positions.slice(),N=n.positionIndicesType===R.Int16?new Uint16Array(n.positionIndices.buffer,n.positionIndices.byteOffset,n.positionIndices.byteLength/2).slice():new Uint32Array(n.positionIndices.buffer,n.positionIndices.byteOffset,n.positionIndices.byteLength/4).slice(),K={layout:t.layouts[0],interleavedVertexData:D,indices:F,hasColors:n.hasColors,hasModifications:n.hasModifications,positionData:{data:C,indices:N}};return M&&o.push(M.buffer),O&&o.push(O.buffer),o.push(D),o.push(F.buffer),o.push(C.buffer),o.push(N.buffer),{componentOffsets:O,featureIds:M,anchorIds:G,anchors:q,transformedGeometry:K,obb:n.obb}}function xe(e){return e===0?g.Unmodified:e===1?g.PotentiallyModified:e===2?g.Culled:g.Unknown}function ie(e){if(!r)return;const{context:t,buffer:o}=e,a=r._malloc(o.byteLength),i=o.byteLength/Float64Array.BYTES_PER_ELEMENT,u=new Float64Array(r.HEAPU8.buffer,a,i),f=new Float64Array(o);u.set(f),r.filterOBBs(t,a,i),f.set(u),r._free(a)}function J(e){r&&r.destroy(e)===0&&(r=null)}function A(e,t){for(let o=0;o<t.length;++o)e[o]=t[o]}async function De(){r||await _()}function _(){return r?Promise.resolve(r):(I||(I=oe().then(e=>(r=e,I=null,r))),I)}const Fe={transform:(e,t)=>r&&Y(r,e,t),destroy:J};export{Te as destroyContext,Pe as dracoDecompressPointCloudData,Se as filterObbsForModifications,ie as filterObbsForModificationsSync,De as initialize,xe as interpretObbModificationResults,Re as process,Me as project,Oe as setLegacySchema,Ue as setModifications,re as setModificationsSync,Fe as test,ve as transformNormals};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./i3s-ClY_1OJ3.js","./index-B1qcMJFy.js","./index-DAhQBRAS.css","./georeference-DRAcP5YF.js","./mat3f64-q3fE-ZOt.js","./mat4f64-CSKppSlJ.js","./computeTranslationToOriginAndRotation-cKPYaaYJ.js","./DoubleArray-D7gNrzaD.js","./quat-9HFu1srU.js","./quatf64-Bdb9ZJJK.js","./vec42-B-sS29RP.js","./vec4f64-CCf6w8sj.js","./meshVertexSpaceUtils-BNBosy7D.js","./MeshLocalVertexSpace-Bs8ui3ZL.js","./vec3-DSi-VB0T.js","./BufferView-BM2WiAif.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
