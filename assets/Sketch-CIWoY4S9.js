const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-BPm91e5Z.js","./index-CMxz6F2k.js","./jsxFactory-Cnml7uXM.js","./Accessor-BmwT4B0c.js","./intl-Duiy0OzY.js","./Promise-DfET-uns.js","./cast-CsZslgGN.js","./index-4eY77cms.js","./index-Cx51aysm.css","./JSONSupport-DcrLLGjL.js","./Evented-Dw4_VOGn.js","./reactiveUtils-XM7cS2OP.js","./SimpleObservable-CvOkykwM.js","./uuid-Cl5lrJ4c.js","./guid-ejniuQmw.js","./useT9n-C1Hrfc-A.js","./index-DwIhxbHs.js","./dom-DEluURzl.js","./observers-Co4E8E8j.js","./keyed-CU1C-h1n.js","./directive-helpers-DaBykg1t.js","./ref-D9wHsL_T.js","./interactive-DTzfFku4.js","./loadable-XBvaWFYY.js","./component-CBVlbUuE.js","./index-Cz6Ao6Wl.js","./index-DMeQur4V.js","./floating-ui-IixYHfbQ.js","./debounce-DbkufipY.js","./openCloseComponent-nqWrSaIH.js","./static-DLD4WjLv.js","./FloatingArrow-BZRr6Zld.js","./useFocusTrap-COeL24Kx.js","./focusTrapComponent-D1wJZ4RD.js","./key-CZcQa38B.js","./index-DK5B8inx.js","./array-BbE1dLa5.js","./index-BeicfmvH.js","./ExpandToggle-BhiztZLi.js","./index-C-gtoBEV.js","./geometryEngineJSON-Bvf5zUh7.js","./geometryEngineBase-B0ZyeKAX.js","./_commonjsHelpers-DCkdB7M8.js","./json-Wa8cmqdu.js","./index-BtUFGore.js"])))=>i.map(i=>d[i]);
import{_ as M}from"./index-4eY77cms.js";import{r as n,m as l,a as O,g as pe,N as Q,G as de,e as ue,a7 as Z,j as H,k as Me,a4 as Oe,l as B,aS as j,B as G,t as J}from"./Accessor-BmwT4B0c.js";import"./intl-Duiy0OzY.js";import{V as he,a as Ce,d as V,p as $e,A as ee}from"./reactiveUtils-XM7cS2OP.js";import{a as ke}from"./SketchOptions-D7mgFOwQ.js";import{n as u,h as Se,O as z,c as W,i as me,e as F}from"./jsxFactory-Cnml7uXM.js";import{y as ge,o as D}from"./SketchViewModel-Ck9IhuP_.js";import{p as ve,k as Ee,l as Ie,f as Pe}from"./VisibleElements-Bff5I3yV.js";import{a as Re}from"./cast-CsZslgGN.js";import{e as xe}from"./globalCss-vQlnDsEX.js";import{i as X}from"./Evented-Dw4_VOGn.js";import{r as Ae,s as ye,a as _e,u as Le,i as Ve,c as te}from"./layerUtils-B__v9OBu.js";import{r as oe}from"./layerUtils-DzPrZLjb.js";import{o as K}from"./layerViewUtils-Bevty3Jm.js";import{c as ze}from"./screenUtils-_ZIvrt5o.js";import{j as De}from"./Point-Cz2JYYmX.js";import{N as ie,S as He,s as Be,a as Ge,y as Fe,A as We,g as Ue,j as Ke}from"./Polyline-s-JzsQqo.js";import{o as je}from"./mat2df64-CBKYtunK.js";import{F as Ne,u as re,W as qe}from"./surfaceCoordinateSystems-DVyjKZ7x.js";import{L as Qe,T as Ze,v as Je,b as Xe}from"./createUtils-BLSknDZf.js";import{n as Ye}from"./InteractiveToolBase-rZBtMOMv.js";import{p as U}from"./keybindings-CTmT1RTo.js";import{v as et}from"./opacityUtils-Dim20wpZ.js";import{o as tt,r as ot}from"./drapedUtils--IsYcWNz.js";import{e as it}from"./vmEvent-D4Ubqkbq.js";import{s as se}from"./substitute-CvdjmBYq.js";import"./Promise-DfET-uns.js";import"./SimpleObservable-CvOkykwM.js";import"./SketchLabelOptions-DnwnoaXO.js";import"./angularMeasurementUtils-hHgHLVYP.js";import"./Cyclical-Dlbl-cQK.js";import"./mathUtils-Cfq9PL9W.js";import"./quantityUtils-BsDK158M.js";import"./vec2-ChnYg_BJ.js";import"./common-DQOJ18NT.js";import"./vec2f64-Dy6m9Nrb.js";import"./vec32-Dvg_eL9J.js";import"./vec3f64-BLpZdpfb.js";import"./projectVectorToVector-CCOy_B5J.js";import"./Extent-g5W9hy0j.js";import"./projectBuffer-CQnuEMuP.js";import"./geodesicConstants-RQL9oKdk.js";import"./projectPointToVector-BoxjK-qy.js";import"./projection-CyCZAIaD.js";import"./geodesicUtils-Cvz9v8ds.js";import"./uuid-Cl5lrJ4c.js";import"./UpdatingHandles-CzJ4c3KT.js";import"./GraphicsLayer-D3KyXpUc.js";import"./GraphicsCollection-BJ5Nr2H8.js";import"./Graphic-Dt0LgVGU.js";import"./Clonable-Z-AWS-16.js";import"./JSONSupport-DcrLLGjL.js";import"./writer-DKgfqj4X.js";import"./enumeration-DpvDkLNI.js";import"./Color-VJEMvW-n.js";import"./colorUtils-Rxh2V3ai.js";import"./ActionToggle-D7439N1A.js";import"./Identifiable-BHVfzH03.js";import"./jsonUtils-CwFG8yN4.js";import"./typeUtils-B6WBEKDM.js";import"./TextSymbol-BLIQ6RKX.js";import"./collectionUtils-CTT-51g7.js";import"./Portal-CmmHxpLg.js";import"./aaBoundingBox-Dw3yBk2f.js";import"./Layer-DH4_Pn8a.js";import"./TimeExtent-BO6BsF_x.js";import"./timeUtils-C1c_L2Fd.js";import"./ScaleRangeLayer-Cnzwr9PT.js";import"./layerContainerType-C5CzMsLd.js";import"./jsonUtils-DZz5FrgB.js";import"./utils-DYurMneM.js";import"./mat4f32-DcsiF_Rp.js";import"./mat4-Fi6iAz29.js";import"./ElevationInfo-BPOqhCue.js";import"./unitConversionUtils-rg07EgOm.js";import"./lengthUtils-_77UiyVF.js";import"./elevationInfoUtils-D26wVF2d.js";import"./InputManager-DZ3jJnlx.js";import"./Queue-BQesTh_6.js";import"./signal-CySMLEX9.js";import"./SnappingManager-DoaI-UDx.js";import"./RightAngleSnappingHint-BepRvd6S.js";import"./Query-B_2mhyL4.js";import"./Field-BDG0QV_T.js";import"./fieldType-CBeoJWlv.js";import"./FullTextSearch-CBnxSwz4.js";import"./utils-BjSXFjBJ.js";import"./Version-Cd3TlGH0.js";import"./vec42-YcqnINSP.js";import"./vec4f64-o2zAXfmz.js";import"./plane-CpXmOyqq.js";import"./mat3f64-BBpwCtoL.js";import"./mat4f64-Dk4dwAN8.js";import"./quatf64-CCm9z-pX.js";import"./mathUtils-BgCEaV43.js";import"./sphere-Cin5efBj.js";import"./mat3-CR8GKnhD.js";import"./geometry2dUtils-D9Oax6Qb.js";import"./viewUtils-CV6QVz7y.js";import"./hitTestSelectUtils-UXJPjatw.js";import"./screenUtils-BWEEmpSb.js";import"./directionModeIcons-Br5woIHu.js";import"./LabeledSwitch--Ta60UQe.js";import"./layerListUtils-BIu86t6C.js";import"./LayerListViewModel-DogEbPNW.js";import"./utils-BQBvadb7.js";import"./ListItem-DomCK2qd.js";import"./widget-GKEQ1p1m.js";import"./memoize-DmxaQ-k8.js";import"./ReactiveSet-DgPcISC1.js";import"./diffUtils-BanfihCO.js";import"./dehydratedFeatureComparison-j4L0peJx.js";import"./ViewingMode-Dodu7ZZk.js";import"./DrawingMode-Cvvf0VVz.js";import"./EditGeometryOperations-CAMJU2Wn.js";import"./dragEventPipeline-Dj33NxJd.js";import"./meshVertexSpaceUtils-AgAbm20L.js";import"./MeshLocalVertexSpace-CnHk-qPr.js";import"./hydratedFeatures-CNHxsqRS.js";import"./SnappingContext-lR2hMWGP.js";import"./SnappingDragPipelineStep-dx2sltqU.js";import"./Scheduler-i_u8qdlN.js";import"./debugFlags-B1LM_Apo.js";import"./SnappingOperation-D1hMlFdT.js";import"./mat2d-D9DBP-jx.js";import"./quat-CP7JhygC.js";import"./Circle-DhDdChqp.js";import"./geometryEngine-CLtm9OQA.js";import"./geometryEngineBase-B0ZyeKAX.js";import"./_commonjsHelpers-DCkdB7M8.js";import"./hydrated-DcIAHEVL.js";import"./interfaces-D6pIddIh.js";const w={groupSeparator:1,action:{s:32,m:48,l:64},splitButtonPart:{horizontal:{s:16,m:16,l:24},vertical:{s:16,m:24,l:40}}},fe={splitButton:{horizontal:"chevron-down",vertical:"ellipsis"},overflow:"ellipsis"};function we(t,e){var o;return t.vnodeSelector===e?[t]:((o=t.children)==null?void 0:o.flatMap(i=>we(i,e)))??[]}const Y=t=>{let e=class extends t{constructor(){super(...arguments),this.priority=0,this.scale="m",this.slot=void 0,this.lastActiveKey=null,this.layout="horizontal"}destroy(){var o;(o=this.measurementManager)==null||o.managedElements.remove(this),this.measurementManager=null}set measurementManager(o){const i=this._get("measurementManager");o!==i&&(i&&i.managedElements.remove(this),this._set("measurementManager",o),o==null||o.managedElements.add(this))}set budgetedLength(o){this.budgetedLength!==o&&(this._set("budgetedLength",o),this.scheduleRender())}get actionChildren(){var o;return((o=this.children)==null?void 0:o.flatMap(i=>we(i,"calcite-action")))??[]}get activeChildElement(){var i;const o=this.actionChildren.find(r=>{var s;return((s=r.properties)==null?void 0:s.active)===!0});return o?(this._set("lastActiveKey",(i=o.properties)==null?void 0:i.key),o):this.lastActiveKey?this.actionChildren.find(r=>{var s;return((s=r.properties)==null?void 0:s.key)===this.lastActiveKey}):void 0}_handleClick(o){o!=null&&o.dataset&&"dataset"in o&&o.dataset.actionKey&&(this.lastActiveKey=o.dataset.actionKey)}};return n([l()],e.prototype,"priority",void 0),n([l()],e.prototype,"measurementManager",null),n([l()],e.prototype,"budgetedLength",null),n([l()],e.prototype,"actionChildren",null),n([l()],e.prototype,"activeChildElement",null),n([l()],e.prototype,"scale",void 0),n([l()],e.prototype,"slot",void 0),n([l()],e.prototype,"lastActiveKey",void 0),n([l()],e.prototype,"layout",void 0),e=n([O("esri.widgets.Sketch.support.ResponsiveToolbar.ToolbarGroupBase")],e),e},ne=Symbol("on-resize-handle-key");let x=class extends Y(z){constructor(t){super(t),this._measuredWidth=0,this._measuredHeight=0,this._measuredElement=null}destroy(){this._measuredElement=null}get lengthOptions(){return[this.layout==="horizontal"?this._measuredWidth:this._measuredHeight]}render(){return u("div",{afterCreate:t=>{this._measuredElement=t.firstElementChild,this.addHandles(Se(this._measuredElement,()=>{var e,o;this._measuredWidth=((e=this._measuredElement)==null?void 0:e.clientWidth)??0,this._measuredHeight=((o=this._measuredElement)==null?void 0:o.clientHeight)??0}),ne)},afterRemoved:()=>this.removeHandles(ne)},this.children)}};n([l()],x.prototype,"_measuredWidth",void 0),n([l()],x.prototype,"_measuredHeight",void 0),n([l()],x.prototype,"lengthOptions",null),n([l()],x.prototype,"_measuredElement",void 0),x=n([O("esri.widgets.Sketch.support.ResponsiveToolbar.MeasuredContentGroup")],x);const rt=x;let I=class extends Y(z){constructor(e){super(e),this.allowCollapse=!0,this.messagesCommon=null}loadDependencies(){return W({action:()=>M(()=>import("./index-BPm91e5Z.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]),import.meta.url),"action-group":()=>M(()=>import("./index-Cz6Ao6Wl.js").then(e=>e.i),__vite__mapDeps([25,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,35,36]),import.meta.url),"action-menu":()=>M(()=>import("./index-DK5B8inx.js").then(e=>e.i),__vite__mapDeps([35,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,36]),import.meta.url)})}get minimumLength(){const{actionChildren:e,scale:o}=this;return e.length?this.allowCollapse?w.groupSeparator+w.action[o]*Math.min(e.length,2):w.groupSeparator+w.action[o]*e.length:0}get lengthOptions(){const{actionChildren:e,scale:o,minimumLength:i,allowCollapse:r,priority:s}=this,a=[i];if(e.length<=2||!r||s<1)return a;for(let c=1;c<e.length-1;c++)a.push(i+w.action[o]*c);return a}render(){if(!this.actionChildren.length)return u(me,null,void 0);const{budgetedLength:e,actionChildren:o,activeChildElement:i,layout:r,slot:s,scale:a}=this,c=Math.floor(e/w.action[a]),d=[],p=[];if(c>=o.length)d.push(...o);else{const m=i??d.at(0);if(d.push(...o.slice(0,c-1)),p.push(...o.slice(c-1)),m&&p.includes(m)){const[_]=p.splice(p.indexOf(m),1),g=d.pop();d.push(_),g&&p.unshift(g)}}return u("calcite-action-group",{key:"overflow-button-group",layout:r,onclick:m=>this._handleClick(m.target),slot:s},d.map(m=>this._renderManagedAction(m)),p.length>0?u("calcite-action-menu",{key:"split-button-dropdown",label:this.messagesCommon.more,overlayPositioning:"fixed"},u("calcite-action",{icon:fe.overflow,key:"split-button-dropdown-trigger",scale:a,slot:"trigger",text:this.messagesCommon.more}),p.map(m=>this._renderManagedAction(m))):void 0)}_renderManagedAction(e){var o,i;return u("calcite-action",{...e==null?void 0:e.properties,"data-action-key":(o=e==null?void 0:e.properties)==null?void 0:o.key,text:((i=e==null?void 0:e.properties)==null?void 0:i.text)??""})}};I.vnodeSelector="calcite-action-group",n([l()],I.prototype,"allowCollapse",void 0),n([l()],I.prototype,"minimumLength",null),n([l(),F("esri/t9n/common")],I.prototype,"messagesCommon",void 0),n([l()],I.prototype,"lengthOptions",null),I=n([O("esri.widgets.Sketch.support.ResponsiveToolbar.OverflowGroup")],I);const st=I;let P=class extends pe{constructor(){super(...arguments),this.measuredElement=null,this.managedElements=new he,this.availableLength=0,this.layout="horizontal",this._resizeObserver=new ResizeObserver(()=>{this._measure()})}get _sortedElements(){return[...this.managedElements].sort((t,e)=>e.priority-t.priority)}connect(t){this._resizeObserver.disconnect(),this.measuredElement=t,this._resizeObserver.observe(t),this._measure()}allocate(){const t=new Map,{availableLength:e,_sortedElements:o}=this;let i=0;for(const r of o){const s=r.lengthOptions[0];t.set(r,s),i+=s}for(const r of o)for(;i<e;){const s=t.get(r);if(!s)break;const a=r.lengthOptions.find(d=>d>s);if(!a)break;const c=i-s+a;if(c>e)break;t.set(r,a),i=c}for(const[r,s]of t)r.budgetedLength=s}_measure(){const t=this.measuredElement;this.availableLength=t?this.layout==="horizontal"?t.clientWidth??0:t.clientHeight??0:0,this.allocate()}destroy(){this._resizeObserver.disconnect()}};n([l()],P.prototype,"measuredElement",void 0),n([l()],P.prototype,"managedElements",void 0),n([l()],P.prototype,"_sortedElements",null),n([l()],P.prototype,"availableLength",void 0),n([l()],P.prototype,"layout",void 0),P=n([O("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbarManager")],P);const nt=P,lt={splitButtonBase:"esri-split-button--split-part"};let A=class extends Y(z){constructor(e){super(e),this.messagesCommon=null}loadDependencies(){return W({action:()=>M(()=>import("./index-BPm91e5Z.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]),import.meta.url),"action-group":()=>M(()=>import("./index-Cz6Ao6Wl.js").then(e=>e.i),__vite__mapDeps([25,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,35,36]),import.meta.url),"action-menu":()=>M(()=>import("./index-DK5B8inx.js").then(e=>e.i),__vite__mapDeps([35,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,36]),import.meta.url)})}get minimumLength(){const e=this.actionChildren;return e.length?e.length===1?w.action[this.scale]+w.groupSeparator:w.action[this.scale]+w.splitButtonPart[this.layout][this.scale]+w.groupSeparator:0}get lengthOptions(){const{actionChildren:e,minimumLength:o,layout:i,scale:r,priority:s}=this;if(e.length<2||s<0)return[o];const a=w.groupSeparator+w.action[r]*e.length;return[w.groupSeparator+w.action[r]+w.splitButtonPart[i][r],a]}render(){if(!this.actionChildren.length)return u(me,null,void 0);const{actionChildren:e,minimumLength:o,budgetedLength:i,layout:r,slot:s}=this,a=e.length<2||i>o;return u("calcite-action-group",{key:"split-button-group",layout:r,onclick:c=>this._handleClick(c.target),slot:s},a?this._renderUnSplit():this._renderSplit())}_renderSplit(){const{activeChildElement:e,layout:o,actionChildren:i,scale:r,messagesCommon:s}=this,a=e??i.at(0);if(!a)return;const c=i.filter(d=>d!==a);return[this._renderManagedAction(a),u("calcite-action-menu",{key:"split-button-dropdown",label:s.more,overlayPositioning:"fixed",placement:o==="horizontal"?"bottom-end":"right-end"},u("calcite-action",{class:`${lt.splitButtonBase}--${o}--${this.scale}`,compact:o==="horizontal",icon:fe.splitButton[o],key:"split-button-dropdown-trigger",scale:r,slot:"trigger",text:s.more}),c==null?void 0:c.map(d=>this._renderManagedAction(d)))]}_renderUnSplit(){return this.actionChildren.map(e=>this._renderManagedAction(e))}_renderManagedAction(e){var o,i;return u("calcite-action",{...e==null?void 0:e.properties,"data-action-key":(o=e==null?void 0:e.properties)==null?void 0:o.key,text:((i=e==null?void 0:e.properties)==null?void 0:i.text)??""})}};A.vnodeSelector="calcite-action-group",n([l()],A.prototype,"minimumLength",null),n([l()],A.prototype,"lengthOptions",null),n([l(),F("esri/t9n/common")],A.prototype,"messagesCommon",void 0),A=n([O("esri.widgets.Sketch.support.ResponsiveToolbar.SplitButton")],A);const C="esri-responsive-toolbar",$={rulerBase:`${C}__ruler`,rulerBarHorizontal:`${C}__ruler--bar`,rulerBarVertical:`${C}__ruler--bar--vertical`,rulerPadVertical:`${C}__ruler--pad--vertical`,rulerPadHorizontal:`${C}__ruler--pad--horizontal`,bar:`${C}__bar`,barHorizontal:`${C}__bar--horizontal`,barVertical:`${C}__bar--vertical`,pad:`${C}__pad`,padVertical:`${C}__pad--vertical`,padHorizontal:`${C}__pad--horizontal`};let R=class extends z{constructor(e){super(e),this.scale="m",this.barStyle="floating",this._measurementManager=new nt,this._managedWidgets=new Map}loadDependencies(){return W({"action-bar":()=>M(()=>import("./index-BeicfmvH.js"),__vite__mapDeps([37,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,35,36,25,38]),import.meta.url),"action-pad":()=>M(()=>import("./index-C-gtoBEV.js"),__vite__mapDeps([39,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,35,36,25,38]),import.meta.url)})}destroy(){this._measurementManager=Q(this._measurementManager),this._managedWidgets.forEach(e=>e.destroy()),this._managedWidgets.clear()}set layout(e){const o=this._get("layout");this._set("layout",e),this._measurementManager&&(this._measurementManager.layout=e),o!==e&&this.scheduleRender()}render(){const{layout:e,scale:o,barStyle:i}=this,r={layout:e,scale:o,expandDisabled:!0,key:"measured-toolbar"},s=i==="docked"?e==="vertical"?$.rulerBarVertical:$.rulerBarHorizontal:e==="horizontal"?$.rulerPadHorizontal:$.rulerPadVertical;return u("div",null,u("div",{afterCreate:a=>{var c;(c=this._measurementManager)==null||c.connect(a)},class:this.classes($.rulerBase,s)}),i==="docked"?u("calcite-action-bar",{...r,classes:{[$.barHorizontal]:this.layout==="horizontal",[$.barVertical]:this.layout==="vertical",[$.bar]:!0},overflowActionsDisabled:!0},this._renderChildren()):u("calcite-action-pad",{...r,class:this.classes($.pad,e==="horizontal"?$.padHorizontal:$.padVertical)},this._renderChildren()))}_renderChildren(){var r;if(!this.children)return;const e=this.children.filter(s=>{var a;return((a=s.properties)==null?void 0:a.key)!==void 0&&"group-kind"in s.properties}),o=new Set,i=e.map(s=>{const a=s.properties,c=a.key;o.add(c);const d=this.barStyle==="docked"?a.slot??void 0:void 0,p=a.priority??0,m=a["group-kind"]??"overflow-group",_=a["allow-collapse"]??!0,g=this._managedWidgets.get(c);if(g)return g.children=s.children,g.priority=p,"allowCollapse"in g&&(g.allowCollapse=_),g.slot=d,g.layout=this.layout,g.scale=this.scale,g.measurementManager=this._measurementManager,g;const y={scale:this.scale,priority:p,measurementManager:this._measurementManager,children:s.children,slot:d,layout:this.layout};switch(m){case"split-button":{const f=new A({...y});return this._managedWidgets.set(c,f),f}case"overflow-group":{const f=new st({...y,allowCollapse:_});return this._managedWidgets.set(c,f),f}case"measured-content":{const f=new rt({...y});return this._managedWidgets.set(c,f),f}}}).filter(de);return Array.from(this._managedWidgets.keys()).filter(s=>!o.has(s)).forEach(s=>{var a;(a=this._managedWidgets.get(s))==null||a.destroy(),this._managedWidgets.delete(s)}),(r=this._measurementManager)==null||r.allocate(),i.map(s=>s.render())}};n([l()],R.prototype,"scale",void 0),n([l({value:"horizontal"})],R.prototype,"layout",null),n([l()],R.prototype,"barStyle",void 0),n([l()],R.prototype,"_measurementManager",void 0),n([l()],R.prototype,"_managedWidgets",void 0),R=n([O("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbar")],R);const le=R;let b=class extends pe{constructor(e){super(e),this.coordinates=void 0,this.strokeDash=[],this.strokeWidth=1,this.strokeColor=[0,0,0,1],this.strokeDashColor=[255,255,255,1],this.fillColor=[0,0,0,0],this.visible=!0,this.isDecoration=!0}get _strokeStyle(){const e=this.strokeColor;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get _strokeBackgroundStyle(){const e=this.strokeDashColor;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get _fillStyle(){const e=this.fillColor;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get _renderCoordinates(){const e=[];if(!this.coordinates)return{coordinates:e,rect:ie};const o=He(Be(Ge(ie),this.coordinates),2*this.strokeWidth);o[0]=Math.floor(o[0]),o[1]=Math.floor(o[1]),o[2]=Math.ceil(o[2]+.5),o[3]=Math.ceil(o[3]+.5);for(const i of this.coordinates)e.push([Math.floor(i[0]-o[0])+.5,Math.floor(i[1]-o[1])+.5]);return e.reverse(),{coordinates:e,rect:o}}render(){const{coordinates:e,rect:o}=this._renderCoordinates,i=Fe(o),r=We(o);return u("div",{classes:{"esri-outline-overlay-item":!0},styles:{left:o[0]+"px",top:o[1]+"px",width:i+"px",height:r+"px",visibility:this.visible?"visible":"hidden"}},u("svg",{height:r,styles:{display:"block"},width:i},u("polygon",{fill:this._fillStyle,points:e.map(([s,a])=>`${s},${a}`).join(" "),stroke:this._strokeBackgroundStyle,"stroke-width":this.strokeWidth}),u("polygon",{fill:"transparent",points:e.map(([s,a])=>`${s},${a}`).join(" "),stroke:this._strokeStyle,"stroke-dasharray":this.strokeDash.length?this.strokeDash.join(" "):void 0,"stroke-width":this.strokeWidth})))}renderCanvas(){}};n([l()],b.prototype,"coordinates",void 0),n([l()],b.prototype,"strokeDash",void 0),n([l()],b.prototype,"strokeWidth",void 0),n([l()],b.prototype,"strokeColor",void 0),n([l()],b.prototype,"strokeDashColor",void 0),n([l()],b.prototype,"fillColor",void 0),n([l()],b.prototype,"visible",void 0),n([l()],b.prototype,"isDecoration",void 0),n([l({readOnly:!0})],b.prototype,"_strokeStyle",null),n([l({readOnly:!0})],b.prototype,"_strokeBackgroundStyle",null),n([l({readOnly:!0})],b.prototype,"_fillStyle",null),n([l({readOnly:!0})],b.prototype,"_renderCoordinates",null),b=n([O("esri.views.overlay.OutlineOverlayItem")],b);const at=b;let T=class extends X.EventedMixin(Ye){constructor(e){super(e),this._overlayItem=void 0,this.geometryType=null,this.mode=null,this.type="draw-screen"}initialize(){this.drawOperation=this._makeDrawOperation();const e=o=>this.drawOperation.on(o,i=>{this._updateVisuals(),this.emit(o,i)});this.addHandles([e("vertex-add"),e("vertex-remove"),e("vertex-update"),e("cursor-update"),e("complete")]),this.finishToolCreation()}destroy(){this.drawOperation=Q(this.drawOperation),this._set("view",null)}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centeredToggled(e){this._set("centeredToggled",e),this._updateVisuals()}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set uniformSizeToggled(e){this._set("uniformSizeToggled",e),this._updateVisuals()}get updating(){var e;return((e=this.drawOperation)==null?void 0:e.updating)??!1}get cursor(){return this.geometryType==="point"?"default":"crosshair"}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}undo(){this.drawOperation.undo()}reset(){}_makeDrawOperation(){const{view:e}=this;return new Ne({view:e,manipulators:this.manipulators,geometryType:ct(this.geometryType),drawingMode:this.mode,hasZ:!1,defaultZ:0,snapToSceneEnabled:!1,drawSurface:new re,hasM:!1,snappingManager:null,snappingVisualizer:null,graphic:null,cursor:this.cursor})}get coordinates(){var a,c,d;const{drawOperation:e}=this;if(!(e!=null&&e.geometryIncludingUncommittedVertices.length))return[];const{coordinateHelper:o}=e,i=e.committableVertex,r=e.committedVertices.slice();i!=null&&r.push(o.pointToArray(i));const s=r.length;switch(this.geometryType){case"circle":case"rectangle":{const p=new qe(je,re.spatialReference),m=this.geometryType==="circle"?Qe:Ze,_=this.geometryType==="circle"?Je:Xe;if(s===1&&e.isCompleted){const g=r[0],y=p.makeMapPoint(g[0]+pt,g[1]);return((a=m([g,y],p,!0))==null?void 0:a.geometry.rings[0])??[]}if(s===2){const g=this.geometryType!=="rectangle",y=this.centeredToggled!==g,f=this.geometryType!=="rectangle";return(this.uniformSizeToggled!==f?(c=m(r,p,y))==null?void 0:c.geometry.rings[0]:(d=_(r,p,y))==null?void 0:d.geometry.rings[0])??[]}return[]}}return r}_updateVisuals(){var e;if(!this._overlayItem){const o=new at({strokeDash:[5],strokeDashColor:[255,255,255,255]});(e=this.view.overlay)==null||e.addItem(o),this.addHandles(ue(()=>{var i;(i=this.view.overlay)==null||i.removeItem(o),o==null||o.destroy(),this._overlayItem=void 0})),this._overlayItem=o}this._overlayItem.coordinates=this.coordinates}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}};function ct(t){switch(t){case"polygon":case"point":return t;case"circle":case"rectangle":return"segment"}}n([l({value:!1})],T.prototype,"centeredToggled",null),n([l()],T.prototype,"drawOperation",void 0),n([l({value:!0})],T.prototype,"enabled",null),n([l({value:!1})],T.prototype,"uniformSizeToggled",null),n([l({constructOnly:!0})],T.prototype,"geometryType",void 0),n([l({constructOnly:!0})],T.prototype,"mode",void 0),n([l({readOnly:!0})],T.prototype,"type",void 0),n([l({readOnly:!0})],T.prototype,"updating",null),n([l({constructOnly:!0,nonNullable:!0})],T.prototype,"view",void 0),n([l()],T.prototype,"cursor",null),T=n([O("esri.views.draw.DrawScreenTool")],T);const pt=48;async function dt(){return M(()=>import("./geometryEngineJSON-Bvf5zUh7.js").then(t=>t.g),__vite__mapDeps([40,41,42,43]),import.meta.url)}async function ut(){return dt().then(({contains:t,intersects:e,overlaps:o,simplify:i})=>({contains:t,intersects:e,overlaps:o,simplify:i}))}async function ht(t){const{currentSelection:e,selector:o,signal:i,sources:r,view:s}=t;if(!(r!=null&&r.length))return{added:[],removed:[]};const{layers:a,layerViews:c,graphicsLayers:d}=yt(r),p=(await Z(Promise.all([gt(o,a,s,i),vt(o,c,s,i),mt(o,d,s)]),i)).flat();if(!e)return{added:p,removed:[]};const m=e.toArray(),_=p.filter(y=>!ae(m,y)),g=m.filter(y=>!ae(p,y));return e.removeMany(g),e.addMany(_),{added:_,removed:g}}const mt=async(t,e,o)=>bt({candidates:e.flatMap(i=>i.graphics.toArray())??[],selector:t,view:o}),gt=async(t,e,o,i)=>{const r=await H(ft({selector:t,signal:i,layers:e,view:o}));return r?be(r):[]},vt=async(t,e,o,i)=>{const r=await H(_t({selector:t,signal:i,layerViews:e,view:o}));return r?be(r):[]};function be(t){const e=[];for(let o=0;o<t.length;o++){const i=t[o];i.status==="fulfilled"&&e.push(...i.value)}return e}function yt(t){const e=[],o=[],i=[];return t.forEach(r=>{var s,a;Ae(r)?e.push(r):(ye(r)||_e(r))&&((s=r.layers)!=null&&s.length)?e.push(...r.layers.toArray()):Le(r)&&((a=r.sublayers)!=null&&a.length)?i.push(...r.sublayers.toArray()):Ve(r)?i.push(r):K(r)&&o.push(r)}),{layers:e,layerViews:o,graphicsLayers:i}}function ae(t,e){if(t.includes(e))return!0;const o=e.getObjectId(),i=o!=null,{layer:r,uid:s}=e;return i?t.some(a=>{if(r===a.layer)return o===a.getObjectId()}):t.some(a=>{if(r===a.layer)return s===a.uid})}async function _t(t){const{layerViews:e,selector:o,signal:i,view:r}=t;return Z(Promise.allSettled(e.map(async s=>{const a=s.createQuery(),{geometry:c}=Te(o,s.layer,r);return a.outFields=["*"],a.geometry=c,a.returnGeometry=!0,a.outSpatialReference=r.spatialReference,s.queryFeatures(a,{signal:i}).then(({features:d})=>d)})),i)}async function ft(t){const{layers:e,selector:o,signal:i,view:r}=t;return Z(Promise.allSettled(e.map(async s=>s.queryFeatures(wt(s.createQuery(),o,s,r),{signal:i}).then(({features:a})=>a))),i)}function Te(t,e,o){var d;const i="renderer"in e?tt({renderer:e.renderer}):0,r=t.type==="point"?ot(t,i,o):t,s="displayField"in e?e.displayField:null,a=et({displayField:s,fields:e.fields}),c=[e.objectIdField];if(a!=null&&e.fieldsIndex.has(a)&&c.push(a),"globalIdField"in e&&e.globalIdField!=null&&e.fieldsIndex.has(e.globalIdField)&&c.push(e.fieldsIndex.get(e.globalIdField).name),te(e)&&e.subtypeField!=null&&e.fieldsIndex.has(e.subtypeField)&&c.push(e.fieldsIndex.get(e.subtypeField).name),"utilityNetworks"in o.map&&((d=o.map.utilityNetworks)!=null&&d.length)&&(te(e)||e.type==="feature")){const p=e.fieldsIndex.get("assetgroup"),m=e.fieldsIndex.get("assettype");p!=null&&p.name&&c.push(p.name),m!=null&&m.name&&c.push(m.name)}return{geometry:r,outFields:c}}function wt(t,e,o,i){const{outFields:r,geometry:s}=Te(e,o,i);return t.outFields=r,t.geometry=s,t.returnGeometry=!0,t.outSpatialReference=i.spatialReference,t}async function bt(t){const{selector:e,candidates:o,view:i}=t;if(!(o!=null&&o.length)||!e)return[];const{spatialReference:r}=i,s=e,a=await ut();return o.filter(c=>c.geometry&&c.geometry.type!=="mesh"&&a.intersects(r,s,c.geometry))}const Tt=100;let L=class extends X.EventedAccessor{constructor(e){super(e),this._processTask=null,this.options=null,this.selection=new he,this.sources=null,this._process=Me(async(o,i)=>{const{callback:r,selector:s,completed:a}=o,c=Ce(async d=>{var y;const{options:p,sources:m,selection:_,view:g}=this;if(!(!(m!=null&&m.length)&&!(g!=null&&g.selectionManager.sources.length))&&g){if(s&&m!=null){const f=await ht({currentSelection:_,selector:s,signal:d,sources:m,view:g});a&&(p==null?void 0:p.persistSelection)!==!1&&((y=g.selectionManager)==null||y.updateSelection({current:_.toArray(),...f}))}r&&r()}else _.removeAll()});return Oe(i,()=>c.abort()),this._processTask=c,c.promise},Tt)}initialize(){this._setup()}cancel(){var e;this.removeAllHandles(),(e=this._processTask)==null||e.abort()}async _setup(){const{view:e}=this;if(await e.whenReady(),this.destroyed)return;const o=this.options,i=(o==null?void 0:o.createTool)??"rectangle",r=(o==null?void 0:o.mode)??(i==="polygon"?"click":"hybrid"),s=Symbol();this._tool=new T({view:e,mode:r,geometryType:i}),o!=null&&o.selectOnComplete||this.addHandles(this._tool.on(["cursor-update","vertex-add","vertex-remove"],()=>H(this._process({selector:this._selectionArea}))),s),this.addHandles([e.on("key-down",a=>{if(!a.repeat)switch(a.key){case U.constraint:this._tool.uniformSizeToggled=!0,a.stopPropagation();break;case U.center:this._tool.centeredToggled=!0,a.stopPropagation()}}),e.on("key-up",a=>{switch(a.key){case U.constraint:this._tool.uniformSizeToggled=!1,a.stopPropagation();break;case U.center:this._tool.centeredToggled=!1,a.stopPropagation()}}),this._tool.on("complete",async a=>{this.removeHandles(s);const c=()=>{this.removeAllHandles(),this.emit("complete",{aborted:a.aborted,selection:this.selection.toArray()})};a.aborted?(this.cancel(),this.selection.removeAll(),c()):await this._process({selector:this._selectionArea,callback:c,completed:!0})})],s),this.addHandles(ue(()=>e.tools.remove(this._tool))),e.addAndActivateTool(this._tool)}get _selectionArea(){const e=ze(),o=this._tool.coordinates,i=this.view.spatialReference,r=a=>{e.x=a[0],e.y=a[1];const{x:c,y:d}=this.view.toMap(e);return[c,d]};if(o.length===0)return;if(o.length===1||o.every(([a,c])=>a===o[0][0]&&c===o[0][1])){const[a,c]=r(o[0]);return new De({x:a,y:c,spatialReference:i})}const s=o.map(r);if(s.length!==0)return Ue(s)||s.reverse(),new Ke({spatialReference:i,rings:[s]})}};n([l()],L.prototype,"options",void 0),n([l({readOnly:!0})],L.prototype,"selection",void 0),n([l()],L.prototype,"sources",void 0),n([l({constructOnly:!0})],L.prototype,"view",void 0),L=n([O("esri.widgets.support.Selector2D.SelectionOperation")],L);const Mt=L;let k=class extends X.EventedAccessor{constructor(e){super(e),this._operationHandlesGroup=null,this.activeOperation=null,this.layerViewPreferenceEnabled=!0,this.sources=null}initialize(){this.addHandles([V(()=>this._sources,e=>{this.activeOperation&&(this.activeOperation.sources=e)})])}destroy(){this._operationHandlesGroup=B(this._operationHandlesGroup)}get _sources(){const{layerViewPreferenceEnabled:e,sources:o,view:i}=this;return i&&(o!=null&&o.length)?o.flatMap(r=>{if(K(r))return r;if(ye(r)||_e(r)){const a=r.layers||[],c=a.map(d=>{const p=oe(i,d)||void 0;return e&&K(p)?p:d});return c.length?c.toArray():a.length?a.toArray():r}if(!e)return r;const s=oe(i,r)||void 0;return K(s)?s:r}):[]}get layers(){return j(G.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources}set layers(e){j(G.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources=e}get state(){const{_sources:e,view:o}=this,i=!(e!=null&&e.length)&&!(o!=null&&o.selectionManager.sources.length);return this.activeOperation?"active":o!=null&&o.ready&&!i?"ready":"disabled"}cancel(){var e;this.state==="active"&&((e=this.activeOperation)==null||e.cancel(),this._set("activeOperation",null))}activate(e){const{_sources:o,state:i,view:r}=this,s=!(o!=null&&o.length)&&!(r!=null&&r.selectionManager.sources.length);if(i==="disabled"||s||!this.view)return;i==="active"&&this.cancel();const a=new Mt({view:this.view,sources:o,options:e});return this._operationHandlesGroup=J([a.selection.on("change",c=>this.emit("selection-change",c)),a.once("complete",c=>this._onOperationComplete(c))]),this._set("activeOperation",a),a}_onOperationComplete(e){this._operationHandlesGroup=B(this._operationHandlesGroup),this._set("activeOperation",null),this.emit("complete",e)}};n([l()],k.prototype,"_sources",null),n([l({readOnly:!0})],k.prototype,"activeOperation",void 0),n([l()],k.prototype,"layers",null),n([l()],k.prototype,"layerViewPreferenceEnabled",void 0),n([l()],k.prototype,"sources",void 0),n([l({readOnly:!0})],k.prototype,"state",null),n([l()],k.prototype,"view",void 0),k=n([O("esri.widgets.support.SelectionToolbar.SelectionToolbarViewModel")],k);const Ot=k,ce={lassoTool:!0,rectangleTool:!0},N="esri-selection-toolbar",q={base:N,container:`${N}__container`,toolButton:`${N}__tool-button`};let v=class extends z{constructor(t,e){super(t,e),this._viewModelHandlesGroup=null,this.activeToolInfo=null,this.defaultLassoToolOptions={createTool:"polygon",mode:"freehand"},this.defaultRectangleToolOptions={createTool:"rectangle"},this.messages=null,this.toolConfigs=[],this.viewModel=new Ot,this.visibleElements={...ce},this.scale="s",this.layout="horizontal",this._viewModelHandlesGroup=J([this.viewModel.on("complete",o=>{this._set("activeToolInfo",null),this.emit("complete",o)})])}destroy(){this._viewModelHandlesGroup=B(this._viewModelHandlesGroup)}loadDependencies(){return W({action:()=>M(()=>import("./index-BPm91e5Z.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]),import.meta.url)})}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get layers(){return j(G.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources}set layers(t){j(G.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources=t}get layerViewPreferenceEnabled(){return this.viewModel.layerViewPreferenceEnabled}set layerViewPreferenceEnabled(t){this.viewModel.layerViewPreferenceEnabled=t}get sources(){return this.viewModel.sources}set sources(t){this.viewModel.sources=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}castVisibleElements(t){return{...ce,...t}}get state(){return this.viewModel.state}get visibleToolCount(){const{view:t,toolConfigs:e,visibleElements:o}=this;return((e==null?void 0:e.length)??0)+((t==null?void 0:t.type)==="2d"?(o.lassoTool?1:0)+(o.rectangleTool?1:0):0)}activate(t){if(this.cancel(),this.state!=="disabled")switch(t){case"lasso":this._activateTool("lasso");break;case"rectangle":this._activateTool("rectangle");break;default:this._activateTool(t)}}cancel(){this.viewModel.cancel(),this._set("activeToolInfo",null)}render(){return u("div",{"aria-label":this.label,class:this.classes(q.base,xe.widget)},u("div",{class:q.container},this._renderDefaultTools(),this._renderCustomTools()))}_renderDefaultTools(){var t;if(((t=this.view)==null?void 0:t.type)==="2d")return[this._renderRectangleTool(),this._renderLassoTool()]}_renderCustomTools(){var t;if((t=this.toolConfigs)!=null&&t.length)return this.toolConfigs.map(({toolName:e,icon:o,toolKey:i})=>this._renderToolWithTooltip(e,i,o))}_renderLassoTool(){const{messages:t,visibleElements:e}=this;if(!e.lassoTool)return;const o=t.selectByLasso;return this._renderToolWithTooltip("lasso","lasso","lasso-select",o)}_renderRectangleTool(){const{messages:t,visibleElements:e}=this;if(!e.rectangleTool)return;const o=t.selectByRectangle;return this._renderToolWithTooltip("rectangle","rectangle","cursor-marquee",o)}_renderToolWithTooltip(t,e,o,i=t){var s;const r=`${this.id}-tool-${e}`;return u("calcite-action",{active:((s=this.activeToolInfo)==null?void 0:s.toolName)===t,bind:this,class:q.toolButton,disabled:this.state==="disabled",icon:o||"selection",id:r,key:r,onclick:()=>this._toggleTool(t),scale:this.scale,text:i,title:i})}_activateTool(t){const e=this._getToolOptions(t);if(!e)return;const o=this.viewModel.activate(e);o&&this._set("activeToolInfo",{toolName:t,operation:o})}_toggleTool(t){if(this.activeToolInfo){const e=this.activeToolInfo.toolName;if(this.cancel(),e===t)return}this._activateTool(t)}_getToolOptions(t){return t==="lasso"?this.defaultLassoToolOptions:t==="rectangle"?this.defaultRectangleToolOptions:this.toolConfigs.find(e=>e.toolName===t)}};n([l({readOnly:!0})],v.prototype,"activeToolInfo",void 0),n([l()],v.prototype,"defaultLassoToolOptions",void 0),n([l()],v.prototype,"defaultRectangleToolOptions",void 0),n([l()],v.prototype,"label",null),n([l()],v.prototype,"layers",null),n([l()],v.prototype,"layerViewPreferenceEnabled",null),n([l(),F("esri/widgets/support/SelectionToolbar/t9n/SelectionToolbar")],v.prototype,"messages",void 0),n([l()],v.prototype,"sources",null),n([l()],v.prototype,"toolConfigs",void 0),n([l()],v.prototype,"view",null),n([l()],v.prototype,"viewModel",void 0),n([l()],v.prototype,"visibleElements",void 0),n([Re("visibleElements")],v.prototype,"castVisibleElements",null),n([l()],v.prototype,"scale",void 0),n([l()],v.prototype,"state",null),n([l()],v.prototype,"layout",void 0),n([l()],v.prototype,"visibleToolCount",null),v=n([O("esri.widgets.support.SelectionToolbar")],v);const Ct=v,E="esri-sketch",S={base:E,vertical:`${E}--vertical`,docked:`${E}-bar`,floating:`${E}-pad`,chipHorizontal:`${E}__selection-count-chip--horizontal`,chipVertical:`${E}__selection-count-chip--vertical`,chipVerticalSmall:`${E}__selection-count-chip--vertical--s`,popoverWrapper:`${E}__popover-wrapper`},$t={point:"pin",polyline:"line",polygon:"polygon",rectangle:"rectangle",circle:"circle",multipoint:"pins",mesh:"i3-d-building",freehandPolygon:"freehand-area",freehandPolyline:"freehand"};let h=class extends z{constructor(t,e){super(t,e),this._activeCustomToolOptions=null,this._selectionToolbar=null,this._viewModelHandlesGroup=null,this.availableCreateTools=["point","polyline","polygon","rectangle","circle"],this.customToolOptions=null,this.customActions=null,this.toolbarKind="floating",this.contextualToolLocation="separate",this.groupCollapsePriorities=null,this.messages=null,this.messagesCommon=null,this.visibleElements=new ve,this._defaultViewModel=null,this._calcitePopoverReferenceElement=null,this._relativeLocation="top",this._popoverOpen=!1,this._activateCreateTool=this._activateCreateTool.bind(this),this.viewModel=(t==null?void 0:t.viewModel)||(this._defaultViewModel=new ge({creationMode:(t==null?void 0:t.creationMode)??"continuous"}))}initialize(){const{layer:t,view:e}=this,o=new Ct({view:(e==null?void 0:e.type)==="2d"?e:null,sources:t?[t]:null,scale:this.scale});this.addHandles([V(()=>this.viewModel,i=>{this._viewModelHandlesGroup=B(this._viewModelHandlesGroup),i&&(this._viewModelHandlesGroup=J([i.on("create",()=>this.scheduleRender()),i.on("update",()=>this.scheduleRender()),i.on("delete",r=>this.emit("delete",r)),i.on("undo",()=>this.scheduleRender()),i.on("redo",()=>this.scheduleRender()),V(()=>i.layer,r=>{this._selectionToolbar&&(this._selectionToolbar.sources=r?[r]:null)}),V(()=>i.view,r=>{this._selectionToolbar&&(this._selectionToolbar.view=(r==null?void 0:r.type)==="2d"?r:null)}),V(()=>i.state,()=>this.notifyChange("state"))]))},ee),$e(()=>o.activeToolInfo,()=>this.viewModel.cancel()),o.on("complete",i=>this._onSelectionOperationComplete(i)),V(()=>{const{selectionTools:i}=this.visibleElements;return{lassoTool:!!(i!=null&&i["lasso-selection"]),rectangleTool:!!(i!=null&&i["rectangle-selection"])}},i=>{Object.assign(o.visibleElements,i)},ee)]),this._selectionToolbar=o}loadDependencies(){return W({action:()=>M(()=>import("./index-BPm91e5Z.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]),import.meta.url),chip:()=>M(()=>import("./index-BtUFGore.js"),__vite__mapDeps([44,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,21,20,23,22,34,24,15]),import.meta.url),popover:()=>M(()=>import("./index-DMeQur4V.js").then(t=>t.i),__vite__mapDeps([26,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,27,28,29,30,31,32,33,34]),import.meta.url)})}destroy(){var t;(t=this._selectionToolbar)==null||t.destroy(),this._viewModelHandlesGroup=B(this._viewModelHandlesGroup)}get activeTool(){var r;const t=(r=this._selectionToolbar)==null?void 0:r.activeToolInfo;if(t)switch(t.toolName){case"lasso":return"lasso-selection";case"rectangle":return"rectangle-selection";case"default":return"custom-selection"}const e=this._effectiveAvailableCreateTools,{activeTool:o,activeCreateToolDrawMode:i}=this.viewModel;return o==="polygon"&&i==="freehand"&&(e!=null&&e.includes("freehandPolygon"))?"freehandPolygon":o==="polyline"&&i==="freehand"&&(e!=null&&e.includes("freehandPolyline"))?"freehandPolyline":this.viewModel.activeTool}get activeTooltip(){return this.viewModel.activeTooltip}get createGraphic(){return this.viewModel.createGraphic}get creationMode(){return this.viewModel.creationMode}set creationMode(t){this.viewModel.creationMode=t}get defaultCreateOptions(){return this.viewModel.defaultCreateOptions}set defaultCreateOptions(t){this.viewModel.defaultCreateOptions=t}get defaultUpdateOptions(){return this.viewModel.defaultUpdateOptions}set defaultUpdateOptions(t){this.viewModel.defaultUpdateOptions=t}get icon(){return"pencil"}set icon(t){this._overrideIfSome("icon",t)}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(t){this.viewModel.labelOptions=t}get layer(){return this.viewModel.layer}set layer(t){this.viewModel.layer=t}set layout(t){this._set("layout",t),this._selectionToolbar&&(this._selectionToolbar.layout=t)}set scale(t){this._set("scale",t),this._selectionToolbar&&(this._selectionToolbar.scale=t)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(t){this.viewModel.snappingOptions=t}get state(){var t;return(t=this._selectionToolbar)!=null&&t.activeToolInfo?"active":this.viewModel.state}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(t){this.viewModel.tooltipOptions=t}get updateGraphics(){return this.viewModel.updateGraphics}get valueOptions(){return this.viewModel.valueOptions}set valueOptions(t){this.viewModel.valueOptions=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}set viewModel(t){const e=this._get("viewModel");t!==e&&(e&&e===this._defaultViewModel&&Q(e),this._set("viewModel",t))}get _effectiveAvailableCreateTools(){const{availableCreateTools:t,view:e,visibleElements:o}=this,i=t==null?void 0:t.filter(r=>{var s;return!!((s=o.createTools)!=null&&s[r])});return(e==null?void 0:e.type)==="3d"?i==null?void 0:i.filter(r=>r!=="multipoint"):i}create(t,e,o){const i=(o==null?void 0:o.createOptions)??e;return this._activeCustomToolOptions=o,H(this.viewModel.create(t,i))}update(t,e){return H(this.viewModel.update(t,e))}complete(){this.viewModel.complete()}cancel(){var t;(t=this._selectionToolbar)==null||t.cancel(),this.viewModel.cancel(),this._activeCustomToolOptions=null}undo(){var t;this.viewModel.undo(),(t=this.view)==null||t.focus()}redo(){var t;this.viewModel.redo(),(t=this.view)==null||t.focus()}delete(){this.viewModel.delete()}duplicate(){return this.viewModel.duplicate()}dismissFloatingElements(){this._popoverOpen=!1}render(){var r,s,a;const{toolbarKind:t,layout:e,scale:o}=this,i=(r=this.customActions)==null?void 0:r.filter(c=>c.position==="selection-toolbar");return u("div",null,u("div",{classes:{[S.base]:!0,[S.floating]:t==="floating",[S.docked]:t==="docked",[S.vertical]:e==="vertical"}},u(le,{barStyle:t,layout:e,scale:o},this._renderSelectionSetItemGroupInline(),u("div",{"group-kind":"split-button",key:"selection-split-button",priority:((s=this.groupCollapsePriorities)==null?void 0:s.get("selectionTools"))??D.Low},this._renderDefaultSelectionButton(),(a=this._selectionToolbar)==null?void 0:a.render(),i==null?void 0:i.map(c=>this._renderToolbarItem(c))),this._renderCreateToolActionGroup(),this._renderUndoRedoMenuItemGroup(),this._renderSettingsMenuItemGroup()),this._renderSelectionSetToolbar(),this._renderSettingsMenuPopover()))}_renderSettingsMenuPopover(){const{messagesCommon:t,snappingOptions:e,view:o,viewModel:i,visibleElements:r}=this;if(!this._calcitePopoverReferenceElement)return;const s={directionModePicker:r.directionModePicker,labelsToggle:r.labelsToggle,tooltipsToggle:r.tooltipsToggle},a=this.layout==="horizontal"?this._relativeLocation==="top"?"bottom-end":"top-end":"right-end";return u("calcite-popover",{closable:!0,focusTrapDisabled:!0,heading:t.settings,label:t.settings,open:this._popoverOpen,overlayPositioning:"fixed",placement:a,referenceElement:this._calcitePopoverReferenceElement,scale:this.scale,onCalcitePopoverBeforeClose:()=>this._popoverOpen=!1,onCalcitePopoverBeforeOpen:c=>this._remeasurePopoverSizes(c.currentTarget),onCalcitePopoverClose:()=>this._refocusOnView()},u("div",{class:S.popoverWrapper},Object.values(s).includes(!0)?u(Ee,{sketchOptions:i.sketchOptions,viewType:o==null?void 0:o.type,visibleElements:new Ie(s)}):void 0,r.snappingControls&&o&&e?u(Pe,{snappingManager:this.viewModel.snappingManager,snappingOptions:e,view:o,visibleElements:r.snappingControlsElements}):void 0))}_renderSelectionSetToolbar(){if(this.contextualToolLocation!=="separate")return;const t=this._renderSelectionSetItemGroup();return t!=null&&t.length?u(le,{barStyle:this.toolbarKind,layout:this.layout,scale:this.scale},t):void 0}_renderSelectionSetItemGroupInline(){return this.contextualToolLocation==="separate"?[]:this._renderSelectionSetItemGroup()}_renderUndoRedoMenuItemGroup(){var t;return u("div",{"group-kind":"split-button",key:"undo-redo-menu",priority:((t=this.groupCollapsePriorities)==null?void 0:t.get("undoRedo"))??D.Medium,slot:"actions-end"},this._renderUndoButton(),this._renderRedoButton())}_renderSettingsMenuItemGroup(){var i,r;const t=[],e=[];(i=this.customActions)==null||i.forEach(s=>{s.position==="settings-before"?e.push(s):s.position==="settings-after"&&t.push(s)});const o=[...e.map(s=>this._renderToolbarItem(s)),this._renderSettingsMenuButton(),...t.map(s=>this._renderToolbarItem(s))].filter(de);if(o.length)return u("div",{"allow-collapse":!1,"group-kind":"overflow-group",key:"settings-menu",priority:((r=this.groupCollapsePriorities)==null?void 0:r.get("settings"))??D.Max,slot:"actions-end"},o)}_renderSelectionSetItemGroup(){var r,s,a;if(!this.updateGraphics.length)return[];const t=this.contextualToolLocation==="inline-end"?"actions-end":void 0,e=(r=this.customActions)==null?void 0:r.filter(c=>c.position==="before-selection-set"),o=(s=this.customActions)==null?void 0:s.filter(c=>c.position==="after-selection-set"),i=((a=this.groupCollapsePriorities)==null?void 0:a.get("selectionSet"))??D.High;return[u("div",{"group-kind":"measured-content",key:"selection-count-chip-group",priority:i,slot:t},this._renderFeatureCountChip()),u("div",{"allow-collapse":!1,"group-kind":"overflow-group",key:"selection-set-tool-group",priority:i,slot:t},e==null?void 0:e.map(c=>this._renderToolbarItem(c)),this._renderDuplicateButton(),this._renderDeleteButton(),o==null?void 0:o.map(c=>this._renderToolbarItem(c)))]}_renderDefaultSelectionButton(){if(!this.viewModel.updateOnGraphicClick)return[];const{messages:t,state:e}=this;return this._renderToolbarItem({id:"pointer-select",text:t.selectFeature,icon:"cursor",onclick:this._activateDefaultSelectTool,active:e==="ready"})}_renderCreateToolActionGroup(){var o,i,r;const t=((o=this._effectiveAvailableCreateTools)==null?void 0:o.flatMap(s=>this._renderBuiltInCreateToolItem(s)))??[],e=((i=this.customToolOptions)==null?void 0:i.flatMap(s=>this._renderCustomToolItem(s)))??[];return u("div",{"group-kind":"overflow-group",key:"create-tools-group",priority:((r=this.groupCollapsePriorities)==null?void 0:r.get("createTools"))??D.High},t,e)}_renderBuiltInCreateToolItem(t){return this._renderToolbarItem({id:`${t}-button`,text:this.messages.draw[t],icon:$t[t],onclick:()=>this._activateCreateTool(t),active:this.activeTool===t&&!this._activeCustomToolOptions})}_renderCustomToolItem(t){var o;const{toolKey:e}=t;return this._renderToolbarItem({id:`custom-${t.toolKey}`,text:t.label,icon:t.icon,onclick:()=>this._activateCreateTool(t.toolName,null,t),active:((o=this._activeCustomToolOptions)==null?void 0:o.toolKey)===e})}_renderUndoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"undo-button",text:this.messages.undo,icon:"undo",disabled:!this.viewModel.canUndo(),onclick:this.undo,flipRTL:!0}):[]}_renderRedoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"redo-button",text:this.messages.redo,icon:"redo",disabled:!this.viewModel.canRedo(),onclick:this.redo,flipRTL:!0}):[]}_renderSettingsMenuButton(){return this.visibleElements.settingsMenu?this._renderToolbarItem({id:"settings-menu-action",text:this.messagesCommon.settings,icon:"gear",active:this._popoverOpen,onclick:()=>this._popoverOpen=!this._popoverOpen,afterCreate:t=>this._calcitePopoverReferenceElement=t,afterUpdate:t=>this._calcitePopoverReferenceElement=t,afterRemoved:()=>this._calcitePopoverReferenceElement=null}):[]}_renderFeatureCountChip(){if(!this.visibleElements.selectionCountLabel)return[];const{layout:t,messages:e,scale:o,id:i,updateGraphics:{length:r}}=this,s=se(e.selectedCount,{count:r}),a=o==="s"?99:999,c=r>a?se(e.selectedCountTruncated,{truncated:a}):r,d=o==="s"&&t==="vertical",p=d?`${i}-selection-chip-small`:`${i}-selection-chip`;return[d?u("span",{classes:{[S.chipVertical]:!0,[S.chipVerticalSmall]:this.scale==="s"},id:p,tabIndex:0,title:s},c):u("calcite-chip",{appearance:"outline",class:t==="horizontal"?S.chipHorizontal:S.chipVertical,id:p,kind:"brand",label:s,scale:o==="l"?"m":"s",tabIndex:0,title:t==="vertical"?s:void 0},t==="vertical"?c:s)]}_renderDuplicateButton(){if(!this.visibleElements.duplicateButton)return[];const{messages:t}=this;return this._renderToolbarItem({id:"duplicate",text:this.updateGraphics.length>1?t.duplicateFeatures:t.duplicateFeature,icon:"copy",onclick:this._onDuplicateSelect})}_renderDeleteButton(){if(!this.visibleElements.deleteButton)return[];const{messages:t}=this,e=this.updateGraphics.length>1?t.deleteFeatures:t.deleteFeature;return this._renderToolbarItem({id:"delete",text:e,icon:"trash",onclick:this.delete})}_renderToolbarItem({id:t,text:e,icon:o,disabled:i,onclick:r,active:s,flipRTL:a,afterCreate:c,afterUpdate:d,afterRemoved:p}){const m=`${this.id}-${t}`;return[u("calcite-action",{active:s,afterCreate:c,afterRemoved:p,afterUpdate:d,bind:this,"data-testid":t,disabled:i||this.state==="disabled",icon:o,iconFlipRtl:a??!1,id:m,key:t,onclick:r,scale:this.scale,text:e,title:e})]}_remeasurePopoverSizes(t){var e,o,i,r,s,a;try{const c=t.parentElement,d=(o=(e=this==null?void 0:this.view)==null?void 0:e.container)==null?void 0:o.getBoundingClientRect(),p=c==null?void 0:c.style;if(!(c&&d&&p&&((r=(i=this.view)==null?void 0:i.container)!=null&&r.contains(c))))return;const m=this._calcitePopoverReferenceElement;if(!m)return;const{bottom:_,top:g}=m.getBoundingClientRect();if(this.layout==="horizontal"){const f=_<d.height/2;f!==(this._relativeLocation==="top")&&(this._relativeLocation=f?"top":"bottom"),f?(p==null||p.setProperty("--sketch-view-height-offset",_-d.top+"px"),p==null||p.setProperty("--sketch-view-margin-offset","30px")):(p==null||p.setProperty("--sketch-view-height-offset",d.bottom-g+"px"),p==null||p.setProperty("--sketch-view-margin-offset","15px"))}else this.layout==="vertical"&&(p.setProperty("--sketch-view-height-offset","15px"),p.setProperty("--sketch-view-margin-offset","15px"));const y=(a=(s=t.shadowRoot)==null?void 0:s.querySelector("div.header"))==null?void 0:a.getBoundingClientRect().height;p.setProperty("--sketch-popover-header-offset",`${y}px`)}catch(c){G.getLogger(this.declaredClass).warnOnce("Sketch failed to lay out settings menu.",c)}}_activateCreateTool(t,e,o){var r;const i=this._activeCustomToolOptions;if(o||i){if((o==null?void 0:o.toolKey)===(i==null?void 0:i.toolKey))return void this.cancel()}else if(this.activeTool===t)return void this.cancel();(r=this._selectionToolbar)==null||r.cancel(),this.create(t,e,o)}_onDuplicateSelect(){const t=this.duplicate(),e=this.viewModel.activeTool;e!=="transform"&&e!=="reshape"||this.update(t,{tool:e})}_onSelectionOperationComplete(t){const{viewModel:{defaultUpdateOptions:e}}=this,{selection:o}=t;if(!t.aborted&&o.length){const i=e.tool,r=o.length>1&&i==="reshape"?"transform":i;this.update(o,{...e,tool:r})}this.notifyChange("state")}_activateDefaultSelectTool(){var t;this.cancel(),(t=this.view)==null||t.focus()}_refocusOnView(){var t;this.activeTool&&((t=this.view)==null||t.focus())}};n([l()],h.prototype,"_activeCustomToolOptions",void 0),n([l()],h.prototype,"activeTool",null),n([l({readOnly:!0})],h.prototype,"activeTooltip",null),n([l({cast:t=>{if(!(t!=null&&t.length))return null;const e=new Set(["point","polyline","polygon","rectangle","circle","multipoint","freehandPolyline","freehandPolygon","mesh"]);return t.filter(o=>e.has(o))}})],h.prototype,"availableCreateTools",void 0),n([l({readOnly:!0})],h.prototype,"createGraphic",null),n([l()],h.prototype,"creationMode",null),n([l()],h.prototype,"customToolOptions",void 0),n([l()],h.prototype,"customActions",void 0),n([l()],h.prototype,"defaultCreateOptions",null),n([l()],h.prototype,"defaultUpdateOptions",null),n([l()],h.prototype,"icon",null),n([l()],h.prototype,"label",null),n([l()],h.prototype,"labelOptions",null),n([l()],h.prototype,"layer",null),n([l({type:["horizontal","vertical"],value:"horizontal"})],h.prototype,"layout",null),n([l({value:"m"})],h.prototype,"scale",null),n([l()],h.prototype,"toolbarKind",void 0),n([l()],h.prototype,"contextualToolLocation",void 0),n([l()],h.prototype,"groupCollapsePriorities",void 0),n([l(),F("esri/widgets/Sketch/t9n/Sketch")],h.prototype,"messages",void 0),n([l(),F("esri/t9n/common")],h.prototype,"messagesCommon",void 0),n([l()],h.prototype,"snappingOptions",null),n([l()],h.prototype,"state",null),n([l()],h.prototype,"tooltipOptions",null),n([l({readOnly:!0})],h.prototype,"updateGraphics",null),n([l({type:ke,nonNullable:!0})],h.prototype,"valueOptions",null),n([l()],h.prototype,"view",null),n([l({type:ge}),it(["create","update","undo","redo"])],h.prototype,"viewModel",null),n([l({type:ve,nonNullable:!0})],h.prototype,"visibleElements",void 0),n([l()],h.prototype,"_effectiveAvailableCreateTools",null),n([l()],h.prototype,"_defaultViewModel",void 0),n([l()],h.prototype,"_calcitePopoverReferenceElement",void 0),n([l()],h.prototype,"_relativeLocation",void 0),n([l()],h.prototype,"_popoverOpen",void 0),h=n([O("esri.widgets.Sketch")],h);const sr=h;export{sr as default};
