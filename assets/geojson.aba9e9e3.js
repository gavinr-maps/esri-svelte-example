import{ex as e,aU as n,q as t}from"./vendor.5b1a85aa.js";const o={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function r(e){return o[e]}function*i(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const n of e.features)n&&(yield n)}}function*s(e){if(!e)return null;switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const n of e.coordinates)yield*n;break;case"MultiPolygon":for(const n of e.coordinates)for(const e of n)yield*e}}function c(e){for(const n of e)if(n.length>2)return!0;return!1}function u(e){let n=0;for(let t=0;t<e.length;t++){const o=e[t],r=e[(t+1)%e.length];n+=o[0]*r[1]-r[0]*o[1]}return n<=0}function l(e){const n=e[0],t=e[e.length-1];return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]||e.push(n),e}function f(e,n,t){switch(n.type){case"LineString":return function(e,n,t){return p(e,n.coordinates,t),e}(e,n,t);case"MultiLineString":return function(e,n,t){for(const o of n.coordinates)p(e,o,t);return e}(e,n,t);case"MultiPoint":return function(e,n,t){return p(e,n.coordinates,t),e}(e,n,t);case"MultiPolygon":return function(e,n,t){for(const o of n.coordinates){a(e,o[0],t);for(let n=1;n<o.length;n++)y(e,o[n],t)}return e}(e,n,t);case"Point":return function(e,n,t){return g(e,n.coordinates,t),e}(e,n,t);case"Polygon":return function(e,n,t){const o=n.coordinates;a(e,o[0],t);for(let r=1;r<o.length;r++)y(e,o[r],t);return e}(e,n,t)}}function a(e,n,t){const o=l(n);!function(e){return!u(e)}(o)?p(e,o,t):d(e,o,t)}function y(e,n,t){const o=l(n);!function(e){return u(e)}(o)?p(e,o,t):d(e,o,t)}function p(e,n,t){for(const o of n)g(e,o,t);e.lengths.push(n.length)}function d(e,n,t){for(let o=n.length-1;o>=0;o--)g(e,n[o],t);e.lengths.push(n.length)}function g(e,n,t){const[o,r,i]=n;e.coords.push(o,r),t.hasZ&&e.coords.push(i||0)}function h(e){switch(typeof e){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function m(e){if(!e)throw new t("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new t("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:n}=e;if(!n)return;const o="string"==typeof n?n:"name"===n.type?n.properties.name:"EPSG"===n.type?n.properties.code:null,r=new RegExp(".*(CRS84H?|4326)$","i");if(!o||!r.test(o))throw new t("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:n})}function b(e,n={}){const t=[],o=new Set,u=new Set;let l,f=!1,a=Number.NEGATIVE_INFINITY,y=null,p=!1,{geometryType:d=null}=n,g=!1;for(const b of i(e)){const{geometry:e,properties:n,id:i}=b;if((!e||(d||(d=r(e.type)),r(e.type)===d))&&(f||(f=c(s(e))),p||(p=null!=i,p&&(l=typeof i,"number"===l&&(y=Object.keys(n).filter((e=>n[e]===i))))),p&&"number"===l&&null!=i&&(a=Math.max(a,i),y.length>1?y=y.filter((e=>n[e]===i)):1===y.length&&(y=n[y[0]]===i?y:[])),!g&&n)){let e=!0;for(const r in n){if(o.has(r))continue;const i=n[r];if(null==i){e=!1,u.add(r);continue}const s=h(i);"unknown"!==s?(u.delete(r),o.add(r),t.push({name:r,alias:r,type:s})):u.add(r)}g=e}}const m=y&&1===y.length&&y[0]||null;if(m)for(const r of t)r.name===m&&(r.type="esriFieldTypeOID");return{fields:t,geometryType:d,hasZ:f,maxObjectId:Math.max(0,a),objectIdFieldName:m,objectIdFieldType:l,unknownFields:Array.from(u)}}function w(t,o){return Array.from(function*(t,o={}){const{geometryType:i,objectIdField:s}=o;for(const u of t){var c;const{geometry:t,properties:l,id:a}=u;if(t&&r(t.type)!==i)continue;const y=l||{};let p=null!=(c=y[s])?c:null;s&&null!=a&&!y[s]&&(y[s]=p=a);const d=new e(t?f(new n,t,o):null,y,null,p);yield d}}(i(t),o))}export{m as I,b as T,w as k,r};
