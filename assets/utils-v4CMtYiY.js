import{j as u,E as f,x as $,a as y,k as T,n as p}from"./Promise-DfET-uns.js";import{I as h,b as w,w as Z,o as S}from"./opacityUtils-Dim20wpZ.js";import"./reactiveUtils-XM7cS2OP.js";import"./cast-CsZslgGN.js";import"./mat4f32-DcsiF_Rp.js";import"./mat4-Fi6iAz29.js";import"./Accessor-BmwT4B0c.js";import"./intl-Duiy0OzY.js";import{h as U}from"./timeZoneUtils-DxzjpEBb.js";const j=",",C={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},D=new Set(["integer","small-integer"]);let l=null;function q(e){return h(e)||w(e)||Z(e)}async function z(e){const{field:n,field2:t,field3:s,normalizationField:a,valueExpression:i}=e;let o=[];if(i){if(!l){const{arcadeUtils:r}=await S();l=r}o=l.extractFieldNames(i)}return n&&o.push(n),t&&o.push(t),s&&o.push(s),a&&o.push(a),o}function m(e){return String(e).padStart(2,"0")}function d(e,n,t){let s;return n==="date"||n==="number"?(n==="number"&&(e=new Date(e)),s=`TIMESTAMP'${t?e.getFullYear():e.getUTCFullYear()}-${m((t?e.getMonth():e.getUTCMonth())+1)}-${m(t?e.getDate():e.getUTCDate())} ${m(t?e.getHours():e.getUTCHours())}:${m(t?e.getMinutes():e.getUTCMinutes())}:${m(t?e.getSeconds():e.getUTCSeconds())}'`):s=e,s}function H(e,n,t,s){const{hasQueryEngine:a}=e,i=`(${d(t,g(e,t),a)} - ${d(n,g(e,n),a)})`;let o=C[s],r="/";return o<1&&(o=1/o,r="*"),{sqlExpression:o===1?i:`(${i} ${r} ${o})`,sqlWhere:null}}function g(e,n){if(n instanceof Date)return"date";if(typeof n=="number")return"number";if(typeof n=="string"){const t=e.getField(n);if(n.toLowerCase()==="<now>")return;if(h(t))return"field"}}function O(e,n){const t=n&&e.getField(n);return!!t&&D.has(t.type)}function Y(e){return`cast(${e} as float)`}function A(e,n){const{format:t,timeZoneOptions:s,fieldType:a}=n??{};let i,o;if(s&&({timeZone:i,timeZoneName:o}=U(s.layerTimeZone,s.datesInUnknownTimezone,s.viewTimeZone,u(t||"short-date-short-time"),a)),typeof e=="string"&&isNaN(Date.parse(a==="time-only"?`1970-01-01T${e}Z`:e)))return e;switch(a){case"date-only":{const r=u(t||"short-date");return typeof e=="string"?T(e,{...r}):f(e,{...r,timeZone:p})}case"time-only":{const r=u(t||"short-time");return typeof e=="string"?y(e,r):f(e,{...r,timeZone:p})}case"timestamp-offset":{if(!i&&typeof e=="string"&&new Date(e).toISOString()!==e)return e;const r=t||s?u(t||"short-date-short-time"):void 0,c=r?{...r,timeZone:i,timeZoneName:o}:void 0;return typeof e=="string"?$(e,c):f(e,c)}default:{const r=t||s?u(t||"short-date-short-time"):void 0;return f(typeof e=="string"?new Date(e):e,r?{...r,timeZone:i,timeZoneName:o}:void 0)}}}export{q as $,Y as M,A as N,z as U,j as f,O as j,H as k};
