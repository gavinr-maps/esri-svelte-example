const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./AttachmentQuery-CpEmJqq-.js","./Accessor-BmwT4B0c.js","./JSONSupport-DcrLLGjL.js","./writer-DKgfqj4X.js","./ImageryTileLayer-DODATc71.js","./index-4eY77cms.js","./index-Cx51aysm.css","./Graphic-Dt0LgVGU.js","./Clonable-Z-AWS-16.js","./reactiveUtils-XM7cS2OP.js","./Evented-Dw4_VOGn.js","./SimpleObservable-CvOkykwM.js","./cast-CsZslgGN.js","./opacityUtils-Dim20wpZ.js","./Promise-DfET-uns.js","./Point-Cz2JYYmX.js","./enumeration-DpvDkLNI.js","./Color-VJEMvW-n.js","./colorUtils-Rxh2V3ai.js","./mathUtils-Cfq9PL9W.js","./ActionToggle-D7439N1A.js","./Identifiable-BHVfzH03.js","./jsonUtils-CwFG8yN4.js","./Extent-g5W9hy0j.js","./Polyline-s-JzsQqo.js","./typeUtils-B6WBEKDM.js","./TextSymbol-BLIQ6RKX.js","./screenUtils-_ZIvrt5o.js","./collectionUtils-CTT-51g7.js","./Portal-CmmHxpLg.js","./vec3f64-BLpZdpfb.js","./aaBoundingBox-Dw3yBk2f.js","./MultiOriginJSONSupport-DbmrbwMa.js","./Layer-DH4_Pn8a.js","./TimeExtent-BO6BsF_x.js","./timeUtils-C1c_L2Fd.js","./ArcGISService-CDyDWGI0.js","./ScaleRangeLayer-Cnzwr9PT.js","./layerContainerType-C5CzMsLd.js","./jsonUtils-DZz5FrgB.js","./utils-DYurMneM.js","./mat4f32-DcsiF_Rp.js","./mat4-Fi6iAz29.js","./common-DQOJ18NT.js","./CustomParametersMixin-Be7WOSEG.js","./xmlUtilities-DcaYVE0g.js","./commonProperties-B0GHoNP5.js","./ElevationInfo-BPOqhCue.js","./unitConversionUtils-rg07EgOm.js","./lengthUtils-_77UiyVF.js","./AttributeTableTemplate-cR37sM72.js","./multidimensionalUtils-CBM5TBCZ.js","./ImageHistogramParameters-DjY5GV8g.js","./workers-Cds_sd9m.js","./Queue-BQesTh_6.js","./intl-Duiy0OzY.js","./dataUtils-Pv68iOZD.js","./pixelRangeUtils-Bk2sXCMF.js","./Field-BDG0QV_T.js","./fieldType-CBeoJWlv.js","./ClassBreaksRenderer-C7fhua2J.js","./commonProperties-ZfGquLPI.js","./colorRamps-CRjjPL3r.js","./SizeVariable-B-ghFm6e.js","./visualVariableUtils-Xcorldoo.js","./ColorStop-BYiAUa8d.js","./jsonUtils-B-voMz-i.js","./layerUtils-B__v9OBu.js","./defaults-FkBa0ybj.js","./defaultsJSON-GKolV7NZ.js","./RendererLegendOptions-CYAPr8D6.js","./UniqueValueRenderer-yoWHKJ_P.js","./diffUtils-BanfihCO.js","./styleUtils-ColFrJ-Z.js","./RasterSymbolizer-DU-Ljv5-.js","./_commonjsHelpers-DCkdB7M8.js","./colorUtils-DaPfwnk3.js","./vec42-YcqnINSP.js","./vec4f64-o2zAXfmz.js","./ClassBreaksDefinition-C7KVmBug.js","./normalizeUtils-BTGdXlpz.js","./normalizeUtilsCommon-lGDszWRI.js","./utils-YowqfOgk.js","./utils-B-dlKIhi.js","./utils-aIx1khaq.js","./cimSymbolUtils-DzhKvmq_.js","./utils-UPZJIDfz.js","./defaultCIMValues-Bb-CUowV.js","./enums-BTM-fOHQ.js","./LRUCache-CXiGQWMN.js","./MemCache-CmojB_Z1.js","./TileInfo-DxwC9WcY.js","./TileKey-DZd6gJy7.js","./QueueProcessor-BzFcKfHF.js","./ReactiveMap-BHFEHYMj.js","./signal-CySMLEX9.js","./RawBlockCache-agRrIZ9j.js","./rasterProjectionHelper-Wej15Bp6.js","./projection-CyCZAIaD.js","./projectBuffer-CQnuEMuP.js","./geodesicConstants-RQL9oKdk.js","./rasterFunctionHelper-Dw9wV9wU.js","./FeatureSet-B5-Veyin.js","./OperationalLayer-B__lrMRq.js","./PortalLayer-Cqwv_mmr.js","./PortalItem-CTx1kJsR.js","./portalItemUtils-ByOtbGao.js","./RasterPresetRendererMixin-C1pGDzmv.js","./RefreshableLayer-C90FXoHt.js","./TemporalLayer-CMqBosxi.js","./TimeInfo-CctegBed.js","./TimeInterval-B7L-CEq7.js","./timeZoneUtils-DxzjpEBb.js","./rasterFieldUtils-Bs-oNwHn.js","./GCSShiftTransform--7Cqhewv.js","./TilemapCache-DhTdJKX8.js","./ByteSizeUnit-BsxeN7wM.js","./memoryEstimations-Bcyf-mHz.js","./popupUtils-CmsUVJA0.js","./interfaces-CL2NbQte.js","./DataCaptureAdapter-DYxkt-AJ.js","./SketchHandlerMixin-F33sMlwQ.js","./OrientedImageryLayer-Copf-Ns-.js","./FeatureLayer-U46cmps3.js","./FeatureLayerBase-C4QQJYE9.js","./formUtils-l8pvwous.js","./HeightModelInfo-C05IFsWs.js","./featureLayerUtils-Btb8HY8h.js","./uuid-Cl5lrJ4c.js","./featureQueryAll-JpNZKIBO.js","./Query-B_2mhyL4.js","./FullTextSearch-CBnxSwz4.js","./SimpleRenderer-CEw_geZx.js","./NormalizationBinParametersMixin-CZD0XfhN.js","./RelationshipQuery-B5a-mYy7.js","./LayerFloorInfo-iCgtHY6f.js","./Relationship-CTbzI1Kb.js","./serviceCapabilitiesUtils-B2yGaMdk.js","./infoFor3D-C7tb3HsI.js","./editsZScale-LI19I1vI.js","./queryZScale-BdW_vUm_.js","./APIKeyMixin-3z69J1h4.js","./DisplayFilteredLayer-CzliK74b.js","./scaleUtils-DPfHG2g0.js","./displayFilterUtils-uKPOP7_-.js","./EditBusLayer-KXo-LY9o.js","./FeatureEffectLayer-BZmannck.js","./FeatureEffect-DZgZP6Sj.js","./FeatureFilter-Ca1n-g_b.js","./FeatureReductionLayer-B6VhUfZv.js","./FeatureReductionSelection-BJWsAyix.js","./labelingInfo-BgG6IH9B.js","./labelUtils-DCpQ7n-8.js","./jsonUtils-BZp85R7u.js","./typeUtils-B3iPBwJ2.js","./Version-Cd3TlGH0.js","./FieldsIndex-FW1AMU67.js","./HeatmapColorStop-CHbSyb1s.js","./heatmapUtils-Cyq-bAyG.js","./MD5-C9MwAd2G.js","./OrderedLayer-ucEg87Tu.js","./OrderByInfo-KsusEmpW.js","./TrackableLayer-DaYHUnrc.js","./FeatureTemplate-Dh5_oWTV.js","./FeatureType-DhERcdEP.js","./fieldProperties-DDN0PSrH.js","./TitleCreator-DIyQ9Yy3.js","./versionUtils-BfhafDf-.js","./styleUtils-Bye9ft1s.js","./a11yUtils-ClKbIIe-.js","./mat3f64-BBpwCtoL.js","./mat4f64-Dk4dwAN8.js","./mat3-CR8GKnhD.js","./vec32-Dvg_eL9J.js","./vec3-BXNNVgyU.js","./ElevationLayer-DgTsopHz.js","./ArcGISCachedService-DOAXZxHU.js","./TileInfoTilemapCache-Bwgork4j.js","./LercDecoder-y0ZHeHqS.js","./WorkerHandle-CKOgUZ7i.js","./ImageryLayer-C6jIREWT.js","./imageBitmapUtils-DPq40V9d.js","./executeForIds-BgTHdLi8.js","./query-Bjn_Ozo1.js","./pbfQueryUtils-mqiWagfZ.js","./pbf-BsmI3A9L.js","./OptimizedGeometry-BJqUA4Pi.js","./OptimizedFeature-P2towpqD.js","./OptimizedFeatureSet-Blu9Ckm7.js","./executeQueryJSON-BvVQs3iA.js","./ElevationSamplerData-UywXoG8C.js","./ElevationTile-BBBbm-Nl.js","./requestPresets-D39VZbLJ.js","./jsxFactory-Cnml7uXM.js","./vec2-ChnYg_BJ.js","./UpdatingHandles-CzJ4c3KT.js","./geometryEngineAsync-CqGSRNkr.js","./GraphicsLayer-D3KyXpUc.js","./GraphicsCollection-BJ5Nr2H8.js","./Circle-DhDdChqp.js","./geodesicUtils-Cvz9v8ds.js","./Mesh-n20h-u6K.js","./axisAngleDegrees-DdLZENJj.js","./quat-CP7JhygC.js","./quatf64-CCm9z-pX.js","./MeshComponent-rpOomp-7.js","./imageUtils-DsXKmbqJ.js","./meshProperties-C4iW0Ukm.js","./MeshLocalVertexSpace-CnHk-qPr.js","./MeshTransform-mu8wTSqx.js","./MeshVertexAttributes-CAQDsbB5.js","./meshVertexSpaceUtils-AgAbm20L.js","./triangulationUtils-Cu97ljqy.js","./earcut-D9gy186-.js","./Indices-D8XWalpO.js","./plane-CpXmOyqq.js","./vec2f64-Dy6m9Nrb.js","./mathUtils-BgCEaV43.js","./deduplicate-Cp1WDW0w.js","./projectPointToVector-BoxjK-qy.js","./vertexSpaceConversion-Dzgt1uZW.js","./spatialReferenceEllipsoidUtils-DBqQpPRa.js","./computeTranslationToOriginAndRotation-DYUrDrjE.js","./BufferView-0osDbyWD.js","./vec4-CYI93Mrm.js","./External-wgBWsUOW.js","./sphere-Cin5efBj.js","./deepClone-DD9qKKD3.js","./executionError-DNkSe-Q-.js","./ImmutableArray-BPVd6ESQ.js","./shared-2m9g3-y2.js","./TimeOnly-CveCl9ie.js","./number-QOqKffTG.js","./floorFilterUtils-DZ5C6FQv.js","./Draw-BNcmHGQG.js","./projectVectorToVector-CCOy_B5J.js","./ViewingMode-Dodu7ZZk.js","./SnappingVisualizer2D-xvUExsy2.js","./RightAngleSnappingHint-BepRvd6S.js","./InputManager-DZ3jJnlx.js","./keybindings-CTmT1RTo.js","./utils-BjSXFjBJ.js","./elevationInfoUtils-D26wVF2d.js","./geometry2dUtils-D9Oax6Qb.js","./SnappingVisualizer-bfo0JaXd.js","./PointSnappingHint-DWAfJfrj.js","./EditGeometryOperations-CAMJU2Wn.js","./SnappingContext-lR2hMWGP.js","./SnappingOperation-D1hMlFdT.js","./Scheduler-i_u8qdlN.js","./debugFlags-B1LM_Apo.js","./screenUtils-BWEEmpSb.js","./surfaceCoordinateSystems-DVyjKZ7x.js","./memoize-DmxaQ-k8.js","./ReactiveSet-DgPcISC1.js","./dehydratedFeatureComparison-j4L0peJx.js","./DrawingMode-Cvvf0VVz.js","./dragEventPipeline-Dj33NxJd.js","./hydratedFeatures-CNHxsqRS.js","./quantityUtils-BsDK158M.js","./angularMeasurementUtils-hHgHLVYP.js","./Cyclical-Dlbl-cQK.js","./SketchLabelOptions-DnwnoaXO.js","./SnappingDragPipelineStep-dx2sltqU.js","./mat2d-D9DBP-jx.js","./mat2df64-CBKYtunK.js","./InteractiveToolBase-rZBtMOMv.js","./interfaces-D6pIddIh.js","./drawUtils-BdkQO_cU.js","./Camera-CdyTfTAk.js","./DefaultUI-BwWVKFUS.js","./Basemap-BZmrlnvW.js","./loadAll-D1eTJ7uv.js","./basemapDefinitions-D-Q7PKmu.js","./writeUtils-CcunaxF8.js","./groundInstanceUtils-Ben03ZCf.js","./CollectionFlattener-U8hHQmGf.js","./editableLayers-CWgCazH-.js","./catalogUtils-CGCu8hgu.js","./basemapEnsureType-CmRtohu0.js","./basemapUtils-oMnqy94d.js","./TablesMixin-Bqfi1Ha_.js","./selectionUtils-DYi6daQO.js","./ViewEvents-c9mvQ_r3.js","./IViewEvents-Bci6PjlS.js","./HighlightDefaults-CumzVg9-.js","./heightModelInfoUtils-D_x68P3s.js","./unitBezier-B1N-tmtC.js","./capabilities-DwlKKScG.js","./themeUtils-C3zvZbsE.js","./globalCss-vQlnDsEX.js","./accessibleHandler-BaA3O97p.js","./CompassViewModel-DBhnIkQP.js","./GoTo-zPv0y7kC.js","./ZoomViewModel-Bua4WqEj.js","./ShadowCastAccumulate.glsl-DMni1gLj.js","./Viewpoint-DvyUmqUt.js","./projectBoundingRect-C2OcwCLZ.js","./boundedPlane-DuGhiiFM.js","./lineSegment-v806maA5.js","./RenderCoordsHelper-DA-pMWeR.js","./projectVectorToPoint-DEm8-dt4.js","./dehydratedFeatureUtils-1rrRm6hF.js","./NormalUtils.glsl-W-nmUbAv.js","./ElevationContext-BJejROd5.js","./ElevationProvider-aS5xrHHy.js","./VertexAttribute-Cq4MnHjR.js","./SnappingCandidate-DGkpYqI6.js","./LineCallout.glsl-BQyjm-mE.js","./Material-C_-mgXN8.js","./NoParameters-t-PuNrgq.js","./FloatArray-BQXWSSJh.js","./BindType-BBwFZqyN.js","./Matrix3PassUniform-uCCQMnlP.js","./Texture-BVJ22uHh.js","./enums-D9v74xTE.js","./getDataTypeBytes-BTGR5GyG.js","./renderState-Ci93M1-P.js","./basicInterfaces-CZwQPxTp.js","./InterleavedLayout-_dYEAUNK.js","./types-D0PSWh4d.js","./triangle-B1tKFm7z.js","./ShaderTechniqueConfiguration-D4dZMCXS.js","./glsl-BH37Aalp.js","./requestImageUtils-DWgRKL5q.js","./TextureFormat-1mYWTFa-.js","./graphicUtils-BFGMMQ1R.js","./RibbonLine.glsl-DwJpAQ1c.js","./sdfPrimitives-DBgFWIDT.js","./doublePrecisionUtils-B0owpBza.js","./floatRGBA-Cb__GiDF.js","./Octree-CmoRJhci.js","./ShaderBuilder-BKul5qh8.js","./RgbaFloatEncoding.glsl-_io2eW3M.js","./Attribute-DGhdp5lO.js","./vec2f32-BbH2jxlN.js","./DefaultBufferWriter-CqCDaNCZ.js","./dehydratedFeatures-kwLHUA1D.js","./quantizationUtils-DgFbqZi7.js","./featureConversionUtils-CvnFcmH_.js","./edgeUtils-D0U-z06n.js","./NormalAttribute.glsl-0GHNIsQf.js","./Float4DrawUniform-Db0CLl_z.js","./Matrix3DrawUniform-DD7AqlIc.js","./webStyleAcceptedFormats-CG7ZQ6BV.js","./GeometryUtil-D-PMXorz.js","./vec3f32-nZdmKIgz.js","./RealisticTree.glsl-PW_KtBDJ.js","./Intersector-tBiZcjSu.js","./intersectorUtils-BNnvTT1E.js","./verticalOffsetUtils-BFnFdbst.js","./orientedBoundingBox-B17G_yFO.js","./Intersector-zrebwyaY.js","./DefaultMaterial-GRoe8HM5.js","./SceneLighting-BuSMIzqo.js","./GLTextureMaterial-96UpbkjC.js","./VertexColor.glsl-D3WyDYIi.js","./Matrix4PassUniform-COGIPIq4.js","./VerticalOffset.glsl-CsMbbWIx.js","./Matrix4sPassUniform-SKhQ1xSr.js","./Float2PassUniform-x4sHx2JD.js","./BooleanBindUniform-BgD_OP8i.js","./CameraSpace.glsl-g9iLbhnR.js","./HUDRenderStyle-BhGvVxgm.js","./HUDVisibility.glsl-DuFScu5i.js","./OverlayCompositing.glsl-CUa8aMAb.js","./GridLocalOriginFactory-CngFIYNp.js","./RenderCamera-CDB-KFBK.js","./weather-zOic7P_q.js","./RenderPlugin-CTXypYLE.js","./VertexElementDescriptor-BLyltQyJ.js","./VertexArrayObject-vYejmVPr.js","./BufferObject-BJilD_hc.js","./NestedMap-GuqgquCN.js","./Normals-D6WqMXVD.js","./fontUtils-CGi-tOxo.js","./cameraUtils-Cg-qbPDO.js","./earthUtils-8WLQbUUl.js","./spatialReferenceSupport-DfixDcu7.js","./terrainUtils-CgFk6NLH.js","./FramebufferObject-B01p0UGV.js","./glUtil-CAJRmga-.js","./ShadowCastVisualizeTechniqueConfiguration-vN_a9xco.js","./SunCalc-uwgdo0BB.js","./VirtualLighting-CdhwLgbn.js","./ray-C_tSu6xd.js","./RenderFeature-2QP3kBrd.js","./unitFormatUtils-Q7ZG7HcF.js","./ZoomMomentumEstimator-BDiG9U4W.js","./HUDMaterial-DDt4C7E7.js","./labelFormatUtils-F9rkrs4Y.js","./DepthRange-BJLjx8ee.js","./hitTest-Dmi1EcVX.js","./LayerConstants-B33OP6sh.js","./intersectorUtilsConversions-CiJ6bOx7.js","./ElevationRange-BrgM1moX.js","./hitTestSelectUtils-UXJPjatw.js","./DefaultLoadingContext-pYVsNNqG.js","./wosrLoader-CvsaTck0.js","./DrawParameters-C9t9_e99.js","./TileStrategy-CtmYSAoK.js","./TileKey-DBTeo_j0.js","./ScheduledQueueProcessor-U8WIIyj8.js","./RenderableTile-FJVLrFon.js","./config-BOD8--da.js","./StyleDefinition-C2Flw6Qv.js","./enums-BRzLM11V.js","./GeometryUtils-F7QfOKlc.js","./DefaultVertexAttributeLayouts-wSIZdMhB.js","./DisplayObject-Dejv4A66.js","./resources-D31XxULB.js","./vec33-KumQEj7U.js","./ShaderTechniqueRepository-Ch1TPHrL.js","./Blit-_zFq7-RL.js","./testSVGPremultipliedAlpha-BGpZOwI7.js","./RenderingContext-7iVYEQBa.js","./ProgramCache-CuBZBhwD.js","./Program-C5Xq9SwE.js","./layerViewUtils-Bevty3Jm.js","./makeScheduleFunction-CggzEh3c.js","./vmEvent-D4Ubqkbq.js","./quantityFormatUtils-Bo0-7oki.js","./geometryEngine-CLtm9OQA.js","./geometryEngineBase-B0ZyeKAX.js","./hydrated-DcIAHEVL.js","./MapView-Cd0qxfR5.js","./View2D-CUfvXSSH.js","./viewpointUtils-CtXMVquh.js","./mat2df32-orApM5a3.js","./Tile-DxjvolLp.js","./quickselect-QQC62dOK.js","./definitions-CP59Y04S.js","./substitute-CvdjmBYq.js","./useWidget-BajufX8l.js","./index-C5b9dHRB.js","./component-utils-D0ciaaZ_.js","./MapViewAdapter-B6r9hUb-.js","./SceneViewAdapter-CwBosDzc.js","./SketchViewModel-Ck9IhuP_.js","./layerUtils-DzPrZLjb.js","./SketchOptions-D7mgFOwQ.js","./SnappingManager-DoaI-UDx.js","./viewUtils-CV6QVz7y.js","./MeasurementAdapter-BbFucHUR.js","./index-BPm91e5Z.js","./index-CMxz6F2k.js","./guid-ejniuQmw.js","./useT9n-C1Hrfc-A.js","./index-DwIhxbHs.js","./dom-DEluURzl.js","./observers-Co4E8E8j.js","./keyed-CU1C-h1n.js","./directive-helpers-DaBykg1t.js","./ref-D9wHsL_T.js","./interactive-DTzfFku4.js","./loadable-XBvaWFYY.js","./component-CBVlbUuE.js","./index-C6d66FVb.js","./index-DyXGQ9Xl.js","./index-DVGzfobf.js","./floating-ui-IixYHfbQ.js","./debounce-DbkufipY.js","./key-CZcQa38B.js","./openCloseComponent-nqWrSaIH.js","./dynamicClasses-pKEMtFzB.js","./index-C7Sgjfzm.js","./resources6-Cs2_VmEC.js","./index-XCNLEnDV.js","./customElement-_nG5icNK.js","./index-DMeQur4V.js","./static-DLD4WjLv.js","./FloatingArrow-BZRr6Zld.js","./useFocusTrap-COeL24Kx.js","./focusTrapComponent-D1wJZ4RD.js","./index-DK5B8inx.js","./array-BbE1dLa5.js","./index-C6rrpqn6.js","./index-BeicfmvH.js","./index-Cz6Ao6Wl.js","./ExpandToggle-BhiztZLi.js","./index--OBudxYA.js","./label-CHHpnzD0.js","./index-CV25o1as.js","./resources4-Crg87oFz.js","./index-DGDPL4q1.js","./index-DCkSSz85.js","./interact.min-CL6XG3vV.js","./_commonjsHelpers-DqlTr81k.js","./index-09m8YzVy.js","./index-fFnlo_g2.js","./Validation-BYp9DS84.js","./form-BzoUrXC7.js","./locale-CXx8I9ox.js","./math-BpAtBkbz.js","./index-Bts9-rBr.js","./ImageOverlays-DOJK5l8P.js","./LayerList-BJxqZcXa.js","./LayerListItem-F6gOcfEF.js","./actionUtils-CtQI3q6p.js","./layerListUtils-BIu86t6C.js","./LayerListViewModel-DogEbPNW.js","./utils-BQBvadb7.js","./ListItem-DomCK2qd.js","./widget-GKEQ1p1m.js","./listUtils-vswmtyNy.js","./ImageMeasurementWidget-tawpW0v6.js","./UnitSelect-63i0421p.js","./SketchTools-CAWgoQbZ.js"])))=>i.map(i=>d[i]);
import{_ as z,L as nr,u as lr,c as cr,n as hr,i as ur,a as mr}from"./index-4eY77cms.js";import{i as ma,l as Da,p as Zt,D as dr,n as pr,s as da,a as gr,P as yr,f as Ha,b as fr,S as Na}from"./OrientedImageryLayer-Copf-Ns-.js";import{B as D,E as ne,ac as Ue,s as Q,D as L,r as c,a as me,m as u,b2 as vr,aG as wr,N as ie,i as Fe,ad as pa,aS as Ae,G as It,z as ga,g as _r}from"./Accessor-BmwT4B0c.js";import"./intl-Duiy0OzY.js";import{o as br}from"./a11yUtils-ClKbIIe-.js";import{d as O,A as q,C as Mr,V as B,p as Cr,P as Ze,a as ye,v as ya,w as Ir}from"./reactiveUtils-XM7cS2OP.js";import{s as Ba}from"./ReactiveMap-BHFEHYMj.js";import{S as ze}from"./JSONSupport-DcrLLGjL.js";import{M as fe,s as Y,r as Te}from"./mathUtils-Cfq9PL9W.js";import{e as ft}from"./mat3f64-BBpwCtoL.js";import{e as Dt,t as Pr}from"./mat4f64-Dk4dwAN8.js";import{u as xr}from"./vec4f64-o2zAXfmz.js";import{c as R,n as Ut,t as $r}from"./vec3f64-BLpZdpfb.js";import{u as ja,i as Fr}from"./mat3-CR8GKnhD.js";import{e as Wa,J as Sr}from"./mat4-Fi6iAz29.js";import{R as J,u as le,p as Rr}from"./vec32-Dvg_eL9J.js";import{j as V,g as Z,O as qa,t as Qt,E as Ht,aD as Or,Q as fa}from"./Point-Cz2JYYmX.js";import{J as re,o as Ar,O as Nt}from"./projection-CyCZAIaD.js";import{a as Tr}from"./vec3-BXNNVgyU.js";import{c as Lr,j as se,u as Za,P as _e,g as Vr}from"./Polyline-s-JzsQqo.js";import kr from"./ElevationLayer-DgTsopHz.js";import Er from"./ImageryLayer-C6jIREWT.js";import{B as zr}from"./ImageryTileLayer-DODATc71.js";import{m as Gr}from"./ElevationSamplerData-UywXoG8C.js";import{t as Dr}from"./ElevationTile-BBBbm-Nl.js";import{a as Hr}from"./LercDecoder-y0ZHeHqS.js";import{w as Ua}from"./ImageHistogramParameters-DjY5GV8g.js";import{z as Qa}from"./TileInfo-DxwC9WcY.js";import{t as Nr}from"./TileKey-DZd6gJy7.js";import{P as Jt,z as Br,a as jr,o as Wr}from"./cast-CsZslgGN.js";import{w as qr}from"./Extent-g5W9hy0j.js";import"./normalizeUtilsCommon-lGDszWRI.js";import{t as Zr}from"./requestPresets-D39VZbLJ.js";import{n as va,A as wa}from"./opacityUtils-Dim20wpZ.js";import{O as vt,n as M,c as Ja,e as tt}from"./jsxFactory-Cnml7uXM.js";import{b as H,u as Yt,v as Xt,d as Ya,w as Kt,t as Ur,Z as Qr,_ as Jr,$ as Xa}from"./Graphic-Dt0LgVGU.js";import{i as ea}from"./Evented-Dw4_VOGn.js";import{p as Yr}from"./Promise-DfET-uns.js";import{m as de}from"./vec2-ChnYg_BJ.js";import{h as Xr}from"./UpdatingHandles-CzJ4c3KT.js";import{union as Kr}from"./geometryEngineAsync-CqGSRNkr.js";import{h as Be}from"./GraphicsLayer-D3KyXpUc.js";import{a as Ka}from"./Clonable-Z-AWS-16.js";import{r as ei}from"./enumeration-DpvDkLNI.js";import{o as te,r as _a}from"./writer-DKgfqj4X.js";import{b as eo}from"./Query-B_2mhyL4.js";import{b as Bt}from"./Circle-DhDdChqp.js";import Qe from"./Mesh-n20h-u6K.js";import{f as to,a as ao,w as io}from"./MeshComponent-rpOomp-7.js";import{p as ta}from"./MeshVertexAttributes-CAQDsbB5.js";import{M as ro,A as ba,x as ti,p as lt,k as ai}from"./plane-CpXmOyqq.js";import{S as oo,q as so,F as no,O as lo}from"./sphere-Cin5efBj.js";import{S as co}from"./deepClone-DD9qKKD3.js";import{o as ho}from"./floorFilterUtils-DZ5C6FQv.js";import{S as Je,y as Ye,d as aa}from"./TextSymbol-BLIQ6RKX.js";import{l as uo}from"./Draw-BNcmHGQG.js";import{s as mo}from"./drawUtils-BdkQO_cU.js";import{_ as po}from"./InputManager-DZ3jJnlx.js";import{d as ii}from"./Camera-CdyTfTAk.js";import{L as ri,E as go}from"./DefaultUI-BwWVKFUS.js";import{n as yo}from"./ShadowCastAccumulate.glsl-DMni1gLj.js";import{p as fo}from"./ZoomViewModel-Bua4WqEj.js";import{e as ct}from"./globalCss-vQlnDsEX.js";import{e as ht}from"./vmEvent-D4Ubqkbq.js";import{f as vo}from"./jsonUtils-CwFG8yN4.js";import{h as wo}from"./Color-VJEMvW-n.js";import{P as _o,E as bo}from"./colorUtils-DaPfwnk3.js";import{k as Mo,x as oi}from"./quantityFormatUtils-Bo0-7oki.js";import{l as Co,a as si}from"./quantityUtils-BsDK158M.js";import{geodesicDensify as ni,simplify as ia,geodesicLength as li,geodesicArea as Io,planarLength as ci,planarArea as Po,rotate as Pt,intersect as xo,nearestCoordinate as $o}from"./geometryEngine-CLtm9OQA.js";import{y as hi,R as ut,v as Ma}from"./geodesicUtils-Cvz9v8ds.js";import{p as ui}from"./MapView-Cd0qxfR5.js";import{D as Ca}from"./rasterFunctionHelper-Dw9wV9wU.js";import{c as Fo}from"./viewpointUtils-CtXMVquh.js";import{s as mi}from"./substitute-CvdjmBYq.js";import{P as So}from"./useWidget-BajufX8l.js";const Ia=120,k=[21,36,51,60],Ro=3.5,xt=["FAR_WEST","FAR_NORTH","FAR_EAST","FAR_SOUTH","WEST","NORTH","EAST","SOUTH","NEAR_WEST","NEAR_NORTH","NEAR_EAST","NEAR_SOUTH"],pe=23.937554159486076,ge=96.06244584051393,$t={EAST:[pe,pe,ge,pe,60,pe],NORTH:[pe,ge,pe,pe,pe,60],SOUTH:[ge,pe,ge,ge,ge,60],WEST:[ge,ge,pe,ge,60,ge]},Pa=-999,Oo=100,Ao=()=>["after-data-capture-complete","deselect-data-capture-features","select-data-capture-features"],ra="ImageGeometry",oa="OIObjectId";function To(e){return(e==null?void 0:e.type)==="3d"}function Lo(e){return(e==null?void 0:e.declaredClass)==="esri.Graphic"}function Vo(e){return/(tiff|tif|mrf)$/i.test(e??"")}function xa(e){if(!e||!URL.canParse(e))return!1;const{pathname:t}=new URL(e);return/.*\.(tiff|tif|mrf)$/i.test(t??"")}function ko(e){return Math.abs(e)>=135?"WEST":e<-45&&e>-135?"SOUTH":e<=45?"EAST":"NORTH"}function Eo(e,t){const a=e/t*k[2];return a<=k[0]?"NEAR":a<=k[1]?"":"FAR"}function zo(e){return e&&e.url&&e.datasetFormat?e:null}function Go(e){return typeof e=="string"&&e.length?e:zo(e)}const Do=e=>t=>t.layer===e;function Ho(e){return(e==null?void 0:e.name)==="NoAttachmentError"}const di=e=>`${e}:missing-property`,pi=(e,t)=>`Property ${t} is missing in ${e}`,mt=(e="esri.widgets.OrientedImageryViewer",t)=>{throw D.getLogger(e).error(t),t},gi=async(e,t)=>{var r;const a=await Jt(e,{...t,method:"head"}),i=(r=a==null?void 0:a.getHeader)==null?void 0:r.call(a,"Content-Type");if(i)return i.split("/")[1]};async function No(e,t,a){if(!t.extent||!t.url)throw mt("esri.layer.orientedImagery.transformations",new Q("update-elevation:missing-property","both extent and url are required to create a sampler",t));const i=await sa(t);if(!i)throw mt("esri.layers.orientedImagery.transformations",new Q("update-elevation:elevation-source","could not create a sampler using provided elevation source",t));return yi(e,i,a)}async function yi(e,t,a){await Ue(a);const i=qo(t,a),r=Array.isArray(e)?e:[e];return await Promise.all(r.map(i))}var Le;(function(e){e[e.DYNAMIC=0]="DYNAMIC",e[e.ELEVATION=1]="ELEVATION",e[e.IMAGE=2]="IMAGE"})(Le||(Le={}));const sa=async(e,t)=>{let a;const{extent:i,rasterFunction:r,url:o,lod:s}=e;try{a=await Wo(o)}catch(n){if(ne(n))return;D.getLogger("esri.layers.orientedImagery.transformations").error("updateElevationUsingElevationSource",n)}switch(a){case Le.DYNAMIC:return await jo(o,i,r,t);case Le.ELEVATION:return await Bo(o,i,s,t);default:return}};async function Bo(e,t,a,i){var s;const r=new kr(e);let o;try{const{tileInfo:n}=await r.load(),l=(a&&((s=n.lodAt(Math.min(n.lods.length-1,a)))==null?void 0:s.resolution))??"finest-contiguous";o=await r.createElevationSampler(t,{...i,demResolution:l})}catch(n){if(ne(n))return;D.getLogger(r).error(n)}finally{r.destroy()}return o}async function jo(e,t,a,i){const r=a?new Ua({functionName:a}):void 0,o=new Er({url:e,rasterFunction:r,format:"lerc"});await o.load(i);let s,n=512,l=512;const h=t.width/t.height;h>1?(l/=h,s=t.height/l):(n*=h,s=t.width/n);const m=await o.fetchImage(t,n,l,i),d=Qa.create({scales:[s],size:512,spatialReference:t.spatialReference}),p=new Nr(null,0,0,0,Lr(t)),g=new Hr(m.pixelData.pixelBlock.pixels[0],n,l,0),f=new Dr(p,g);return new Gr(f,d,void 0)}async function Wo(e,t){var o;await Ue(t);const a=await Zr(e),{tileInfo:i,cacheType:r}=a;if(!a.hasOwnProperty("bandCount")||!a.hasOwnProperty("pixelSizeX"))throw new Q("elevation-source:invalid-service-url",`ElevationSource URL expects an elevation 3D image service but given ${e}`);return i?((o=i==null?void 0:i.format)==null?void 0:o.toUpperCase())!=="LERC"||r&&r.toLowerCase()!=="elevation"?Le.IMAGE:Le.ELEVATION:Le.DYNAMIC}function qo(e,t){return async a=>{let i=a.clone();const r=a.spatialReference.equals(e.spatialReference)?i:await re(a,e.spatialReference,t),o=e.queryElevation(r);return o&&(i=a.spatialReference.equals(e.spatialReference)?o.clone():await re(o,a.spatialReference,t)),i.z=i.z??1,i}}async function Zo(e,t,a){return await Ue(a),e.map(i=>(i.z=t,i))}const na=new V({x:0,y:0,z:0,spatialReference:Z.WebMercator}),wt=1e3,Uo=114,Qo=120,Jo=50;function je(e,t,a){const[i,r,o,s]=t,[n,l,h,m]=a;$a(i,r,o,s);const d=$a(n,l,h,m),p=Fa(i,r,o,s),g=Fa(n,l,h,m),f=Wa(Dt(),p),y=Sr(Dt(),f,g),[w,v,b,C]=Xo(e,y);return[w/C,v/C,d?0:b/C]}function $a(e,t,a,i){return e[2]===0&&t[2]===0&&a[2]===0&&i[2]===0&&(e[2]=t[2]=a[2]=i[2]=1,!0)}function Yo(e){return e===0?1:e}function Xo(e,t){const[a,i,r]=e,o=[0,0,0,0];return o[0]=a*t[0]+i*t[1]+r*t[2]+t[3],o[1]=a*t[4]+i*t[5]+r*t[6]+t[7],o[2]=a*t[8]+i*t[9]+r*t[10]+t[11],o[3]=Yo(a*t[12]+i*t[13]+r*t[14]+t[15]),o}function Fa(e,t,a,i){const r=Ko(xr([...i,1]),Wa(new Array(16),Pr(e[0],t[0],a[0],0,e[1],t[1],a[1],0,e[2],t[2],a[2],0,1,1,1,1))),o=r[0],s=r[1],n=r[2],l=Dt();return l[0]=o*e[0],l[1]=s*t[0],l[2]=n*a[0],l[3]=0,l[4]=o*e[1],l[5]=s*t[1],l[6]=n*a[1],l[7]=0,l[8]=o*e[2],l[9]=s*t[2],l[10]=n*a[2],l[11]=0,l[12]=o,l[13]=s,l[14]=n,l[15]=1,l}function Ge(e,t,a,i,r=R()){return r[0]=e[0]+t[0]*a,r[1]=e[1]+t[1]*a,r[2]=e[2]+t[2]*(a/i),r}function N(e,t,a){const i=R();return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*(t/a),i}function be(e,t){const[a,i,r]=e,o=R();return o[0]=a*t[0]+i*t[3]+r*t[6],o[1]=a*t[1]+i*t[4]+r*t[7],o[2]=a*t[2]+i*t[5]+r*t[8],o}function Ko(e,t){const[a,i,r,o]=e,s=new Array(4);return s[0]=a*t[0]+i*t[1]+r*t[2]+o*t[3],s[1]=a*t[4]+i*t[5]+r*t[6]+o*t[7],s[2]=a*t[8]+i*t[9]+r*t[10]+o*t[11],s[3]=a*t[12]+i*t[13]+r*t[14]+o*t[15],s}function es(e,t,a,i=!0){if(!Number.isFinite(e))throw new Q("InvalidRotationAngle","Please specify a valid angle for rotation");const r=a*(i?Y(e):e),o=Math.cos(r),s=Math.sin(r),n=ft();switch(t){case 0:n[4]=o,n[5]=-s,n[7]=s,n[8]=o;break;case 1:n[0]=o,n[2]=s,n[6]=-s,n[8]=o;break;case 2:n[0]=o,n[1]=-s,n[3]=s,n[4]=o;break;default:throw new Q("InvalidRotationAxis","Please specify either 0, 1 or 2 for X, Y or Z axis respectively")}return n}const fi={HPR:[[2,-1],[0,1],[2,-1]],OPK:[[0,1],[1,1],[2,1]]};function vi(e,t,a=!0){if((e==null?void 0:e.length)!==3||(t==null?void 0:t.length)!==3)throw new Q("InvalidRotationAngles","Please specify three angles with config for rotation");const i=ft();for(let r=0;r<3;r++){const[o,s]=t[r],n=es(e[r],o,s,a);Fr(i,n,i)}return i}function ts(e,t=!0){return vi(e,fi.OPK,t)}function jt(e,t=!0){return vi(e,fi.HPR,t)}function wi(e,t,a){const i=Math.sin(Y(a)),r=Math.cos(Y(a)),o=[[e,0],[e,t],[0,t]];o.forEach((n,l)=>{o[l]=[r*n[0]-i*n[1],i*n[0]+r*n[1]]});const s={xmin:Math.min(0,o[0][0],o[1][0],o[2][0]),xmax:Math.max(0,o[0][0],o[1][0],o[2][0]),ymin:Math.min(0,o[0][1],o[1][1],o[2][1]),ymax:Math.max(0,o[0][1],o[1][1],o[2][1])};return{hfov:Math.abs(s.xmax-s.xmin),vfov:Math.abs(s.ymax-s.ymin)}}function as(e,t){const a=Number(e[0]),i=Number(e[1]),r=Number(e[2]),[o,s,n,l]=t,h=Y(o),m=Y(s),d=n/Math.sqrt(1-l*Math.sin(h)**2),p=a/d,g=i/d,f=r/d,y=Math.cos(h)-Math.sin(h)*g+Math.cos(h)*f,w=Math.sin(h)+Math.cos(h)*g+Math.sin(h)*f,v=Math.sqrt(y**2+p**2),b=l*d*Math.sin(h),C=(A,E=5)=>{if(E===0)return A;const T=C(A,E-1);return Math.atan(w/v-(b-l*(n/Math.sqrt(1-l*Math.sin(T)**2))*Math.sin(T))/(d*v))},F=C(h),I=Math.atan(a/(d*y))+m,S=fe(F);return[fe(I),S,a/(Math.cos(F)*Math.sin(I-m))-n/Math.sqrt(1-l*Math.sin(F)**2)]}function Pe(e,t,a){const i=360/t,r=180/a;return{heading:(e.x-t/2)*i,pitch:90-(e.y-a/2)*r}}function Oe(e,t,a,i=wt/2){const{heading:r,pitch:o}=is(e,i);return _i(r,o,t,a)}function _i(e,t,a,i){return{x:a/2+e/(360/a),y:i-t/(180/i),heading:e,pitch:t}}function is(e,t){const a=fe(Math.acos(-e.z/t));return{heading:fe(Math.atan2(e.x,e.y)),pitch:a}}function xe(e,t,a=wt/2){return[a*(Math.sin(Y(e))*Math.sin(Y(t))),a*(Math.cos(Y(e))*Math.sin(Y(t))),a*Math.cos(Y(180-t))]}function at(e,t,a,i=wt/2){const{heading:r,pitch:o}=Pe(e,t,a);return xe(r,o,i)}async function rs(e,t,a){const i=await re(t,e.spatialReference,a);let r=fe(Math.atan2(i.y-e.y,i.x-e.x));return r=r>=0&&r<=90?90-r:r>90&&r<=180?360-r+90:90+Math.abs(r),r}function it(e,t,a){const i=Math.cos(a),r=Math.sin(a),o=[1,0,0,1,0,0],s=o[0]*i+o[2]*r,n=o[1]*i+o[3]*r,l=-o[0]*r+o[2]*i,h=-o[1]*r+o[3]*i;return o[0]=s,o[1]=n,o[2]=l,o[3]=h,[e*o[0]+t*o[2]+o[4],e*o[1]+t*o[3]+o[5]]}const ue=e=>e.toArray(),Me=(...e)=>e.some(t=>t);function os(e,t){if(Me(e.length===0,e.some(({x:a,y:i})=>Me(a==null,i==null)),!t.hasZ))throw new Error("Input pixels must have x, y and camera location must have z value")}function bi(e,t){if(e.some(a=>a.z==null)||t.z==null)throw new Error("Input points and camera location must have z value")}function Mi(e){if((e==null?void 0:e.length)!==9)throw new Error("Rotation matrix is not provided or is not a valid 3x3 matrix")}function Xe(e,t){return qa(t)?1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*e/Qt.radius))):1}const ss=e=>t=>new V(t,e),We=e=>e!=null&&"queryExtent"in e;function ns(e,t,a,i){return[[-t,-t],[+t,-t],[+t,+t],[-t,+t]].map(([r,o])=>je(Tr(R(),a,[r,o,0]),i,e))}function ls({a0:e,a1:t,a2:a,b0:i,b1:r,b2:o},s,n,l){const h=[e??s/2-.5,t,a??0,i??n/2-.5,r??0,o].map(cs);return l!=null&&hs(h)?{affines:h,focalLength:l}:{affines:[s/2-.5,1,0,n/2-.5,0,-1]}}function cs(e,t){if(e==null)return null;const a=parseFloat(`${e}`);return isNaN(a)?null:a}function hs(e){return e[1]!=null&&e[5]!=null}function rt(e,t,a){const{cameraHeight:i,cameraPitch:r,cameraRoll:o,elevation:s,farDistance:n,horizontalFieldOfView:l,location:h,verticalFieldOfView:m}=e,d=s??(h.z??0)-i;return{...Ci(e,t,a),averageElevation:d,cameraPitch:r,cameraRoll:o??0,farDistance:n,horizontalFieldOfView:l,verticalFieldOfView:m}}function us(e,t,a,i){return ys(i)?ts([i.omega,i.phi,i.kappa]):fs(i)?jt([i.heading,i.pitch,i.roll]):jt([e,t,a??0])}function Sa(e,t,a){const{cameraHeading:i,cameraHeight:r,elevation:o,farDistance:s,horizontalFieldOfView:n,location:l,verticalFieldOfView:h}=e;return{averageElevation:o??(l.z??0)-r,cameraLocation:l,cameraHeading:i,farDistance:s,horizontalFieldOfView:n,imageHeight:a,imageWidth:t,verticalFieldOfView:h}}function Ci(e,t,a){const{a0:i,a1:r,a2:o,b0:s,b1:n,b2:l,cameraHeading:h,cameraOrientation:m,cameraPitch:d,cameraRoll:p,focalLength:g,horizontalFieldOfView:f,location:y,matrix:w,principalX:v,principalY:b,radial:C,tangential:F,verticalFieldOfView:I}=e,{affines:S,focalLength:A}=ls({a0:i,a1:r,a2:o,b0:s,b1:n,b2:l},t,a,g),E=w??us(h,d,p,m),T=v!=null&&b!=null?[v,b]:void 0;return{affineTransformations:(m==null?void 0:m.affineTransformations)??S,cameraLocation:y.clone(),focalLength:(m==null?void 0:m.focalLength)??A,horizontalFieldOfView:f,imageHeight:a,imageWidth:t,principalOffsetPoint:(m==null?void 0:m.principalOffsetPoint)??T,radialDistortionCoefficients:(m==null?void 0:m.radialDistortionCoefficients)??C,rotationMatrix:E,tangentialDistortionCoefficients:(m==null?void 0:m.tangentialDistortionCoefficients)??F,verticalFieldOfView:I}}const Ii=e=>e!=null&&"elevationSample"in e&&e.elevationSample!=null,la=e=>Zt(e==null?void 0:e.elevationSource)&&(e==null?void 0:e.extent)!=null,ms=e=>Da(e==null?void 0:e.elevationSource),He=async(e,t)=>t!=null&&(Ii(t)||ms(t))?t:la(t)?{elevationSample:await sa({...ze.isSerializable(t.elevationSource)?t.elevationSource.toJSON():t.elevationSource,extent:t.extent}),elevationSource:new ma({constantElevation:e})}:{elevationSource:new ma({constantElevation:e})},ds=e=>va(e==null?void 0:e.heading)&&va(e==null?void 0:e.pitch),ps=(e,t)=>[[-e,-t],[e,-t],[e,t],[-e,t]];function gs(e){const{cameraLocation:t,farDistance:a,horizontalFieldOfView:i,rotationMatrix:r,scalingFactor:o,verticalFieldOfView:s}=e,n=ft();ja(n,r);const l=2*Math.tan(Y(s)/2)*a*o,h=2*Math.tan(Y(i)/2)*a*o,m=be([0,0,-1],n),d=Ge([t.x,t.y,t.z],m,e.farDistance*o,o),p=be([0,1,0],n),g=be([1,0,0],n),f=N(p,l/2,o),y=N(g,h/2,o),w=J(R(),f,y),v=le(R(),f,y);return[le(R(),d,w),le(R(),d,v),J(R(),d,w),J(R(),d,v)]}const ys=e=>(e==null?void 0:e.type)===2,fs=e=>(e==null?void 0:e.type)===1;function vs(e){const t=e%360;return t<-180?t+360:t}function Ft(e,t,a){if(e==="panoramic"){const[i,r]=a;return Oe({x:t.x,y:t.y,z:t.z},i,r)}return{x:t.x+.5,y:.5-t.y}}var Ra;(function(e){e[e.CLOCKWISE=-1]="CLOCKWISE",e[e.COUNTERCLOCKWISE=1]="COUNTERCLOCKWISE"})(Ra||(Ra={}));function St(e,t,a,i){return[[[a-e/Math.SQRT2,i-e/Math.SQRT2],[a+e/Math.SQRT2,i-e/Math.SQRT2],[a+t/Math.SQRT2,i-t/Math.SQRT2],[a-t/Math.SQRT2,i-t/Math.SQRT2]],[[a+e/Math.SQRT2,i-e/Math.SQRT2],[a+e/Math.SQRT2,i+e/Math.SQRT2],[a+t/Math.SQRT2,i+t/Math.SQRT2],[a+t/Math.SQRT2,i-t/Math.SQRT2]],[[a+e/Math.SQRT2,i+e/Math.SQRT2],[a-e/Math.SQRT2,i+e/Math.SQRT2],[a-t/Math.SQRT2,i+t/Math.SQRT2],[a+t/Math.SQRT2,i+t/Math.SQRT2]],[[a-e/Math.SQRT2,i+e/Math.SQRT2],[a-e/Math.SQRT2,i-e/Math.SQRT2],[a-t/Math.SQRT2,i-t/Math.SQRT2],[a-t/Math.SQRT2,i+t/Math.SQRT2]]]}function Rt(e,t,a){const[i,r,o,s]=e;return`M ${i.join(" ")} A ${t} ${t} 0 0 1 ${r.join(" ")} L ${o.join(" ")} A ${a} ${a} 0 0 0 ${s.join(" ")} Z`}function ws(e,t,a){const[i,r,o,s]=[...e,0];return[...St(i,r,t,a).map(n=>Rt(n,i,r)),...St(r,o,t,a).map(n=>Rt(n,r,o)),...St(o,s,t,a).map(n=>Rt(n,o,s))]}const U="esri-oriented-imagery-viewer",ot=`${U}__carousel`,Ot=`${U}__image-enhancement`,ae=`${U}__navigation`,_s="--oi-navigation-tool-rotation-from",bs="--oi-navigation-tool-rotation-to",Ve=`${U}__image-overlays`,$={alert:`${U}__alert`,addCoverage:`${U}__body-additional-coverage`,addExpPoints:`${U}__body-additional-camera-locations`,carousel:`${U}__carousel`,carouselContainer:`${ot}-container`,carouselContent:`${ot}-content`,carouselItem:`${ot}-item`,carouselItemWrapper:`${ot}-item-wrapper`,currentCoverage:`${U}__body-current-coverage`,feature:`${ae}-feature`,imageEnhancementToolContainer:`${Ot}-tool-container`,imageEnhancementTools:`${Ot}-tools`,imageEnhancementWrapper:`${Ot}-wrapper`,imageOverlays:Ve,imageOverlaysContainer:`${Ve}-container`,imageOverlaysNoResult:`${Ve}-no-result`,imageOverlaysIncreasedHeight:`${Ve}-increased-height`,imageOverlaysLayerList:`${Ve}-layer-list`,measurementResults:`${U}__measurement-results`,measurementsBar:`${U}__measurements-bar`,measurementsButton:`${U}__measurements-button`,measurementsTable:`${U}__measurements-table`,measurementDisplay:`${U}__measurement-display`,messageBox:`${U}__message-box`,navigationPathOffset0:`${ae}-feature-path-stop-offset-0`,navigationPathOffset1:`${ae}-feature-path-stop-offset-1`,navigationWrapper:`${ae}-wrapper`,navigationZoomed:`${ae}-wrapper--zoomed`,north:`${ae}-pointer-north`,outerSector:`${ae}-sector-outer`,overlaysSwitch:`${Ve}-switch`,pointer:`${ae}-pointer`,rotateWithAnimation:`${ae}-animate`,sector:`${ae}-sector`,sectorCross:`${ae}-sector-cross`,sectorDisabled:`${ae}-sector-disabled`,sectorEnabled:`${ae}-sector-enabled`,sectorSeparator:`${ae}-sector-separator`,selectedFeaturePath:`${ae}-feature-path`,sketchTools:`${U}__sketch-tools`,viewer:`${U}__viewer`,viewerHidden:`${U}__viewer--hidden`,viewerContainer:`${U}__viewer-container`},nt=e=>e==="FA",Pi=async(e,t,a)=>{var n;const i=new(await z(()=>import("./AttachmentQuery-CpEmJqq-.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(l=>l.default))({objectIds:[t]}),r=await e.queryAttachments(i,a),o=(n=r[`${t}`])==null?void 0:n[0],s=o==null?void 0:o.url;if(!s)throw new Q("NoAttachmentError","no attachments found",{[e.objectIdField]:t,layer:e});return{datasetFormat:o.contentType.split("/")[1].toUpperCase(),url:s}};async function xi(e,t){const a=typeof e=="string",i=a?e:e.url,{pathname:r,searchParams:o,origin:s}=new URL(i);let n=a?Br(r):e.datasetFormat;n||(n=await gi(i));const l=await z(()=>import("./ImageryTileLayer-DODATc71.js").then(m=>m.R),__vite__mapDeps([4,5,6,1,7,8,9,10,11,2,12,3,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119]),import.meta.url).then(m=>m.default),h=await l.open({ioConfig:{customFetchParameters:Object.fromEntries(o),skipMapInfo:!0},datasetFormat:n==null?void 0:n.toUpperCase(),url:`${s}${r}`,signal:t==null?void 0:t.signal});return h?Ms(h,{signal:t==null?void 0:t.signal}):null}async function Ms(e,t){const{level:a,offset:i,size:r}=Cs(e),{pixelBlock:o}=await e.fetchRawPixels(a,i,r,t);return L(t),o}function Cs(e){const{storageInfo:t,width:a,height:i}=e.rasterInfo,{maximumPyramidLevel:r,pyramidScalingFactor:o}=t,s=o??2;return{level:r,offset:{x:0,y:0},size:{width:Math.ceil(a/s**r),height:Math.ceil(i/s**r)}}}async function Is(e,t,a){if(!e)throw new Q("NoLayerError","No layer provided, cannot load image from attachment",{layer:e,objectId:t});const{datasetFormat:i,url:r}=await Pi(e,+t,a);return Vo(i)?await xi({datasetFormat:i,url:r},a):(await Jt(r,{...a,useRequestQueue:!0,responseType:"image",query:{w:Oo}})).data}function Ps(e,t,a=0){const{height:i,width:r}=e;t.width=r,t.height=i;const o=t.getContext("2d");if(!o)return;const s=xs(e,t,o);s.getContext("2d")&&(a>0?$s(o,s,r,i,a):o.drawImage(s,0,0))}function xs(e,t,a){const i=document.createElement("canvas"),r=i.getContext("2d");if(e instanceof HTMLImageElement)i.width=e.width,i.height=e.height,r==null||r.drawImage(e,0,0);else{const o=a.createImageData(t.width,t.height);o&&(o.data.set(e.getAsRGBA()),i.width=o.width,i.height=o.height,r==null||r.putImageData(o,0,0))}return i}function $s(e,t,a,i,r){const o=Y(r),s=[it(0,0,o),it(a,0,o),it(a,i,o),it(0,i,o)],n=Math.max(...s.map(m=>m[0]))-Math.min(...s.map(m=>m[0])),l=Math.max(...s.map(m=>m[1]))-Math.min(...s.map(m=>m[1])),h=Math.min(a/n,i/l);e.save(),e.clearRect(0,0,a,i),e.translate(a/2,i/2),e.rotate(o),e.scale(h,h),e.drawImage(t,-a/2,-i/2,a,i),e.restore()}let Wt=class{static getCameraOrientation(e){return dr(e)}static register(e,t,a){pr.set(e,{desc:t,constructor:a})}};Wt=c([me("esri.layers.orientedImagery.core.cameraOrientationFactory")],Wt);const Fs=Wt;function Ss(e){throw new Q("exposure-point:missing-default-value",`a value for ${e} is missing in default properties`)}function Rs(e,t){throw new Q("exposure-point:missing-attribute-value",`a value for ${e} is missing in attribute table`,{exposurePoint:t})}const Se=e=>({cast:t=>{const a=parseFloat(t);return Number.isFinite(a)?a:void 0},json:{name:e,write:{writer:(t,a,i)=>{a[i]=Number.isFinite(t)?t:void 0}}}}),At=e=>({cast:t=>typeof t=="string"?t.split(";").map(Number):t,json:{default:e,write:{writer:(t,a,i)=>{a[i]=t==null?void 0:t.join(";")}}}});let x=class extends Ka.ClonableMixin(ze){constructor(t){super(t),this.cameraOrientation=null,this.elevation=null,this.elevationSource=null,this.name=null,this.sourceMap=null}read(t,a){const i={},{attributes:r,layer:o,geometry:s}=t,n={};for(const l in r)i[l.toLowerCase()]=r[l],n[l.toLowerCase()]=l;super.read({geometry:s,layer:o??{},sourceMap:n,...i},a)}write(t,a){const i=super.write(t,a),{sourceMap:r}=this;if(!r||!i)return i;const o={};for(const s in i){const n=r[s.toLowerCase()];n&&(o[n]=i[s])}return o}readCameraHeading(t,a){const{cameraheading:i,camheading:r,layer:o}=a;return i??r??o.cameraHeading}readCameraHeight(t,a){const{cameraheight:i,avghtag:r,layer:o}=a;return i??r??o.cameraHeight}readCamOffset(t,a){const{cameraoffset:i,camoffset:r}=a;return(i==null?void 0:i.split(";").map(Number))??(r==null?void 0:r.split(";").map(Number))??null}writeCameraOffset(t,a){t&&(a.cameraOffset=t.join(";"))}readCameraOrientation(t,a){const{cameraorientation:i,camori:r}=a;return i??r}readCameraPitch(t,a){const{camerapitch:i,campitch:r,layer:o}=a;return i??r??o.cameraPitch}readCameraRoll(t,a){const{cameraroll:i,camroll:r,layer:o}=a;return i??r??o.cameraRoll}readDepthImage(t,a){const{depthimage:i,depthimg:r,layer:o}=a,s=i??r??null,{depthImagePathPrefix:n,depthImagePathSuffix:l}=o??{};return da(s,n,l)}readElevationSource(t,a){const{elevationsource:i,layer:r}=a,{demPathSuffix:o,demPathPrefix:s}=r;if(i){const n=this._parseIfJSON(i);return gr(n,s,o)}return r.effectiveElevationSource}readFarDistance(t,a){const{fardistance:i,fardist:r,layer:o}=a;return i??r??o.farDistance}readHFOV(t,a){const{horizontalfieldofview:i,hfov:r,layer:o}=a;return i??r??o.horizontalFieldOfView}readImageURL(t,a){const{imagepath:i,layer:r}=a;i||Rs("imagePath",this);const{imagePathPrefix:o,imagePathSuffix:s}=r;return da(i,o,s)}readImageRotation(t,a){const{imagerotation:i,imgrot:r,layer:o}=a;return i??r??o.imageRotation}get isHorizontal(){return this.orientedImageryType==="horizontal"}get isInspection(){return this.orientedImageryType==="inspection"}get isNadir(){return this.orientedImageryType==="nadir"}get isOblique(){return this.orientedImageryType==="oblique"}get isSpherical(){return this.orientedImageryType==="360"}get location(){const{cameraOrientation:t,cameraHeight:a,elevation:i}=this;if(t){const{type:o,x:s,y:n,z:l,horizontalWKID:h,verticalWKID:m}=t,d=typeof h=="number"?{wkid:h}:{wkt:h};if(o===yr.LTP){const{latitude:f,longitude:y,ellipsoidRadius:w,squaredEccentricity:v,properties:b}=t,{x:C,y:F,z:I}=b;return new V(as([C,F,I],[f,y,w,v]))}const p=new V({x:s,y:n,z:l,spatialReference:d}),g=m?Ar("point",{wkid:m},d):null;return g&&g(p),p}if(typeof a!="number")throw Ss("cameraHeight");const r=this.geometry.clone();return r.z=r.hasZ?r.z:(i??0)+a,r}set matrix(t){if(!t||t.length!==9)return D.getLogger(this).warn("Ignoring rotation matrix because it doesn't have 9 values",{value:t}),void this._set("matrix",null);this._set("matrix",t)}readNearDistance(t,a){const{neardistance:i,neardist:r,layer:o}=a;return i??r??o.nearDistance}readOrientationAccuracy(t,a){const{accuracy:i,orientationaccuracy:r}=a;return(r==null?void 0:r.split(";").map(Number))??(i==null?void 0:i.split(";").map(Number))??null}writeOrientationAccuracy(t,a){t&&(a.orientationAccuracy=t.join(";"))}readOIType(t,a){const{orientedimagerytype:i,oitype:r,camerapitch:o,campitch:s,layer:n}=a,l=Ha.read(i??r??n.orientedImageryType),h=o??s??n.cameraPitch;return l==="oblique"?h<10?"nadir":"oblique":l}set radial(t){if(t)if(typeof t!="string")this._set("radial",t);else{const[a,i,r]=t.split(";").map(Number);this._set("radial",[a??0,i??0,r??0])}else this._set("radial",[0,0,0])}set tangential(t){if(t)if(typeof t!="string")this._set("tangential",t);else{const[a,i]=t.split(";").map(Number);this._set("tangential",[a??0,i??0])}else this._set("tangential",[0,0])}readVFOV(t,a){const{verticalfieldofview:i,vfov:r,layer:o}=a;return i??r??o.verticalFieldOfView}_parseIfJSON(t){let a=null;try{a=JSON.parse(t)}catch(i){D.getLogger(this).error("couldn't parse the given elevation source JSON",t,i)}return a}};c([u(Se())],x.prototype,"a0",void 0),c([u(Se())],x.prototype,"a1",void 0),c([u(Se())],x.prototype,"a2",void 0),c([u({type:Date,json:{write:{enabled:!0,target:"acquisitionDate"},name:"acquisitiondate"}})],x.prototype,"acquisitionDate",void 0),c([u(Se())],x.prototype,"b0",void 0),c([u(Se())],x.prototype,"b1",void 0),c([u(Se())],x.prototype,"b2",void 0),c([u({type:Number,json:{write:!0,read:{source:["cameraheading","camheading","layer.cameraHeading"]}}})],x.prototype,"cameraHeading",void 0),c([te("cameraHeading")],x.prototype,"readCameraHeading",null),c([u({type:Number,json:{write:!0}})],x.prototype,"cameraHeight",void 0),c([te("cameraHeight",["cameraheight","avghtag","layer.cameraHeight"])],x.prototype,"readCameraHeight",null),c([u()],x.prototype,"cameraOffset",void 0),c([te("cameraOffset",["cameraoffset","camoffset"])],x.prototype,"readCamOffset",null),c([_a("cameraOffset")],x.prototype,"writeCameraOffset",null),c([u({json:{write:{writer:(e,t,a)=>{t[a]=e.toString()}}},type:fr}),jr(e=>e?Fs.getCameraOrientation(e):null)],x.prototype,"cameraOrientation",void 0),c([te("cameraOrientation",["cameraorientation","camori"])],x.prototype,"readCameraOrientation",null),c([u({type:Number,json:{write:!0}})],x.prototype,"cameraPitch",void 0),c([te("cameraPitch",["camerapitch","campitch","layer.cameraPitch"])],x.prototype,"readCameraPitch",null),c([u({type:Number,json:{write:!0}})],x.prototype,"cameraRoll",void 0),c([te("cameraRoll",["cameraroll","camroll","layer.cameraRoll"])],x.prototype,"readCameraRoll",null),c([u({json:{write:!0},type:String})],x.prototype,"depthImage",void 0),c([te("depthImage",["depthimage","depthimg"])],x.prototype,"readDepthImage",null),c([u({type:Number,json:{write:!0}})],x.prototype,"elevation",void 0),c([u({json:{write:!0},clonable:"reference"})],x.prototype,"elevationSource",void 0),c([te("elevationSource",["elevationsource","layer.effectiveElevationSource"])],x.prototype,"readElevationSource",null),c([u({json:{name:"exposurestationid",write:{target:"exposureStationId"}},type:String})],x.prototype,"exposureStationId",void 0),c([u({type:Number,json:{write:!0}})],x.prototype,"farDistance",void 0),c([te("farDistance",["fardistance","fardist","layer.farDistance"])],x.prototype,"readFarDistance",null),c([u(Se("focallength"))],x.prototype,"focalLength",void 0),c([u({type:V,json:{name:"geometry"}})],x.prototype,"geometry",void 0),c([u({type:Number,json:{write:!0}})],x.prototype,"horizontalFieldOfView",void 0),c([te("horizontalFieldOfView",["horizontalfieldofview","hfov","layer.horizontalFieldOfView"])],x.prototype,"readHFOV",null),c([u({json:{write:!0},type:String})],x.prototype,"imagePath",void 0),c([te("imagePath",["imagepath"])],x.prototype,"readImageURL",null),c([u({type:Number,json:{write:!0}})],x.prototype,"imageRotation",void 0),c([te("imageRotation",["imagerotation","imgrot","layer.imageRotation"])],x.prototype,"readImageRotation",null),c([u()],x.prototype,"isHorizontal",null),c([u()],x.prototype,"isInspection",null),c([u()],x.prototype,"isNadir",null),c([u()],x.prototype,"isOblique",null),c([u()],x.prototype,"isSpherical",null),c([u()],x.prototype,"location",null),c([u(At())],x.prototype,"matrix",null),c([u({json:{write:!0},type:String})],x.prototype,"name",void 0),c([u({type:Number,json:{write:!0}})],x.prototype,"nearDistance",void 0),c([te("nearDistance",["neardistance","neardist","layer.nearDistance"])],x.prototype,"readNearDistance",null),c([u({json:{write:!0,name:"objectid"},type:Number})],x.prototype,"objectId",void 0),c([u()],x.prototype,"orientationAccuracy",void 0),c([te("orientationAccuracy",["accuracy","orientationaccuracy"])],x.prototype,"readOrientationAccuracy",null),c([_a("orientationAccuracy")],x.prototype,"writeOrientationAccuracy",null),c([ei(Ha)],x.prototype,"orientedImageryType",void 0),c([te("orientedImageryType",["orientedimagerytype","oitype","layer.orientedImageryType"])],x.prototype,"readOIType",null),c([u({type:Number,json:{write:!0,read:{source:"principalx"}}})],x.prototype,"principalX",void 0),c([u({type:Number,json:{write:!0,read:{source:"principaly"}}})],x.prototype,"principalY",void 0),c([u(At([0,0,0]))],x.prototype,"radial",null),c([u({type:Number,json:{name:"sortorder",write:{target:"sortOrder"}}})],x.prototype,"sortOrder",void 0),c([u({type:Object})],x.prototype,"sourceMap",void 0),c([u(At([0,0]))],x.prototype,"tangential",null),c([u({type:Number,json:{write:!0}})],x.prototype,"verticalFieldOfView",void 0),c([te("verticalFieldOfView",["verticalfieldofview","vfov","layer.verticalFieldOfView"])],x.prototype,"readVFOV",null),x=c([me("esri.layers.orientedImagery.core.ExposurePoint")],x);const $i=x,Ne={},Os=1e3;async function As(e,t){var n;const{point:a,queryParams:i}=e;if(a==null)return null;const r={};let o=e.layerInstanceOrURL;const s=a.spatialReference.isGeographic?Ht(a.clone()):a.clone();if(r.outSpatialReference=s.spatialReference,i&&(r.maxRecordCountFactor=i.maxRecordCountFactor??5,r.outFields=i.outFields??["*"],r.where=i.where??"1=1",r.returnGeometry=i.returnGeometry??!0,r.outSpatialReference=i.outSpatialReference),typeof o=="string"&&(Ne.layer&&Ne.layer.url===o?o=Ne.layer:((n=Ne.layer)==null||n.destroy(),o=Ne.layer=new Na({url:o}))),o)try{await o.load();const l=o,h=Ls(s,(i==null?void 0:i.maximumDistance)??l.maximumDistance??Os);r.returnZ=l.hasZ;const m=new eo({geometry:h,...r}),d=await l.queryFeatures(m,t);return Ts(l)(d)}catch(l){vr(l)}return null}function Ts(e){return t=>{const{features:a,spatialReference:i}=t;return a.forEach(r=>{r.geometry&&(r.geometry.spatialReference=i);const o=$i.fromJSON({...r.toJSON(),layer:e});o&&(r.attributes=o),r.layer=e,r.spatialReference=i}),t}}function Ls(e,t){const a=e.x-t,i=e.x+t,r=e.y-t,o=e.y+t;return new qr({xmin:a,xmax:i,ymin:r,ymax:o,spatialReference:e.spatialReference})}function Vs(e){const{camera:t,features:a,selectedPoint:i}=e;if(!a.length)return[];e.currentImage??(e.currentImage={attributes:{cameraHeading:0,cameraPitch:0}});const r=ks(t,i,e.currentImage);return a.map(r)}function ks(e,t,a){return t.z??(t.z=0),t.elevation??(t.elevation=0),i=>{const{hfovWeight:r,vfovWeight:o,distanceWeight:s}=Es(i.attributes,e?"3d":"2d"),n=i.attributes,{cameraHeight:l,cameraHeading:h,cameraPitch:m,farDistance:d,horizontalFieldOfView:p,verticalFieldOfView:g,isOblique:f}=n,y=n.geometry,w=180*Math.atan2(y.y-t.y,y.x-t.x)/Math.PI,v=Or(t,y);let b,C,F=p,I=g,S=!1;e?(b=e.heading,C=e.tilt,F=180,I=180,S=!0):!f||m<10?(b=h,C=m,S=!1):(b=a.attributes.cameraHeading,C=m,S=!0,F=180),b>180&&(b-=360);let A=1;y.spatialReference.isWebMercator&&(A=1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*y.y/Qt.radius))));const E=Math.sqrt((Math.sqrt((t.x-y.x)**2+(t.y-y.y)**2)/A)**2+((t.z??0)-(t.elevation??0)-l)**2),T=90-180*Math.atan2(t.y-y.y,t.x-y.x)/Math.PI;let G=(Math.abs(T-b)>180?Math.abs(360-Math.abs(T-b)):Math.abs(T-b))/F;G=4*G+1;const ce=180*Math.acos((n.cameraHeight-(t.z??0)+(t.elevation??0))/E)/Math.PI;let he=Math.abs(ce-C)/I;he=4*he+1;let et=E/Math.sqrt(d**2+l**2);et=4*et+1;const ua=r*G+o*he+s*et;let Mt;if(S){const Ct=h>180?h-360:h;Mt=r*((Math.abs(T-Ct)>180?Math.abs(360-Math.abs(T-Ct)):Math.abs(T-Ct))/p*4+1)+o*(Math.abs(ce-m)/g*4+1)+s*et}else Mt=ua;return{suitability:ua,trueSuitability:Mt,feature:i,angle:w,distance:v,verticalAngle:Math.abs(180*Math.atan(v/l)/Math.PI)}}}function Es(e,t){const a="isOblique"in e?e:new $i(e),{isOblique:i,isSpherical:r,isNadir:o}=a;return r?{hfovWeight:t==="2d"?0:1,vfovWeight:t==="2d"?0:.6,distanceWeight:t==="2d"?1:.5}:o?{hfovWeight:.25,vfovWeight:1,distanceWeight:1}:i?{hfovWeight:1,vfovWeight:.25,distanceWeight:1}:{hfovWeight:1,vfovWeight:1,distanceWeight:1}}const oe=Math.PI/180;function Tt(e){return e.isSpherical?Ns(e):zs(e)}function zs(e){const{horizontalFieldOfView:t,verticalFieldOfView:a,geometry:i,cameraHeading:r}=e,o=Xe(i.y,i.spatialReference);let s=e.cameraPitch,n=e.cameraRoll??0,l=150;t>150&&(s=90,n=0,l=5);const h=Math.ceil(t/l),m=Gs(h,r,t);let d=e.farDistance?e.farDistance*o:e.cameraHeight*o/Math.cos(s*oe);e.cameraPitch+a/2>=90&&(d=(e.farDistance||20)*o);const p=new se({spatialReference:i==null?void 0:i.spatialReference});p.imageID=e.objectId;let g=null;for(const f of m)g=Ds(f,s,e.cameraHeight,i,d,o,a,t,h,p,n,e.nearDistance);return g.imageID=e.objectId,{polygon:p,frustum:g}}function Gs(e,t,a){const i=[];if(e%2==0)for(let r=0;r<e/2;r++)i.push(t-a/e*(r+.5),t+a/e*(r+.5));else{i.push(t);for(let r=1;r<e/2;r++)i.push(t-a/e*r,t+a/e*r)}return i.sort(),i}function Ds(e,t,a,i,r,o,s,n,l,h,m=0,d=0){const p=ja(ft(),jt([e,t,m??0])),g=js({cameraHeight:a,cameraPitch:t,farDistance:r,location:i,horizontalFieldOfView:n,nearDistance:d,verticalFieldOfView:s},p),f=be([0,0,-1],p),{x:y,y:w}=i,v=Ge([y,w,a],f,r,o),b=2*Math.tan(s*oe/2)*r,C=2*Math.tan(n/l*oe/2)*r,F=be([0,1,0],p),I=be([1,0,0],p),S=N(F,b/2,o),A=N(I,C/2,o),E=J(R(),S,A),T=le(R(),S,A),G=Hs([le(R(),v,E),le(R(),v,T),J(R(),v,E),J(R(),v,T)],a,i,o);return G.push(G[0]),h.addRing(G),g}function Hs(e,t,a,i){return e.map(r=>Ws(r,t,a,i))}function Ns(e){const{geometry:t,farDistance:a,objectId:i,nearDistance:r,cameraHeight:o}=e,s=Xe(t.y,t.spatialReference),n=new Bt({center:t.clone(),radius:a*s});if(n.imageID=i,r){const m=new Bt({center:t.clone(),radius:r*s});n.addRing(m.rings[0])}const l=t.clone();l.z=o-a*s;const h=Qe.createSphere(l,{size:2*a*s});return h.imageID=i,{polygon:n,frustum:h}}function Bs(e,t){return e.contains(t)}function Lt(e,t){return Math.sign(e)!==Math.sign(t)}function js(e,t,a){const{cameraHeight:i,cameraPitch:r,farDistance:o,location:s,horizontalFieldOfView:n,nearDistance:l,verticalFieldOfView:h}=e,m=Fi(s),d=!(r+h/2>=90),p=2*Math.tan(h*oe/2)*l,g=2*Math.tan(n*oe/2)*l,f=2*Math.tan(h*oe/2)*o,y=2*Math.tan(n*oe/2)*o;let w,v;v=[0,0,-1],v=be(v,t),w=Ge([s.x,s.y,i],v,o,m),d&&(w[2]=0);const b=Ge([s.x,s.y,i],v,l,m);let C=[0,1,0];C=be(C,t);let F=[1,0,0];F=be(F,t);let I=[],S=[];l?(S=[{faces:[4,0,3,4,7,3]},{faces:[5,1,2,5,6,2]},{faces:[4,0,1,4,5,1]},{faces:[6,2,3,6,7,3]}],I=I.concat(le(R(),b,J(R(),N(C,p/2,m),N(F,g/2,m)))),I=I.concat(le(R(),b,le(R(),N(C,p/2,m),N(F,g/2,m)))),I=I.concat(J(R(),b,J(R(),N(C,p/2,m),N(F,g/2,m)))),I=I.concat(J(R(),b,le(R(),N(C,p/2,m),N(F,g/2,m))))):(I=[s.x,s.y,i],S=[{faces:[0,1,2,0,2,3,0,3,4,0,4,1]}]),I=I.concat(le(R(),w,J(R(),N(C,f/2,m),N(F,y/2,m)))),I=I.concat(le(R(),w,le(R(),N(C,f/2,m),N(F,y/2,m)))),I=I.concat(J(R(),w,J(R(),N(C,f/2,m),N(F,y/2,m)))),I=I.concat(J(R(),w,le(R(),N(C,f/2,m),N(F,y/2,m))));const A=new ta({position:Float64Array.from(I)});return new Qe({vertexAttributes:A,components:S,spatialReference:s.spatialReference})}function Ws(e,t,a,i){{const r=Math.sqrt((e[2]-t)**2+(Math.sqrt((e[0]-a.x)**2+(e[1]-a.y)**2)/i)**2)*i,o=N(J(R(),[e[0],e[1],e[2]],[a.x,a.y,t]),1/r,1/i),s=t/(t-e[2]),n={x:(1-s)*a.x+s*e[0],y:(1-s)*a.y+s*e[1],z:(1-s)*t+s*e[2]},l=Math.sqrt((n.z-t)**2+(Math.sqrt((n.x-a.x)**2+(n.y-a.y)**2)/i)**2)*i,h=N(J(R(),[n.x,n.y,n.z],[a.x,a.y,t]),1/l,1/i);return Lt(o[0],h[0])&&Lt(o[1],h[1])&&Lt(o[2],h[2])||e[2]>=0?[e[0],e[1],0]:[n.x,n.y,n.z]}}function qs(e){const{spatialReference:t,x:a,y:i}=e.geometry,{cameraHeading:r,cameraPitch:o,farDistance:s,nearDistance:n}=e,l=Fi(e.geometry),h=new se({spatialReference:t}),m=Math.abs(1.44*s*l);let d=Math.abs(1.44*n*l);(o<20||r==null)&&(d=m);const p=[];return p[0]={x:a+m*Math.sin((r-45)*oe),y:i+m*Math.cos((r-45)*oe)},p[1]={x:a+m*Math.sin((r+45)*oe),y:i+m*Math.cos((r+45)*oe)},p[2]={x:a+d*Math.sin((r+135)*oe),y:i+d*Math.cos((r+135)*oe)},p[3]={x:a+d*Math.sin((r+225)*oe),y:i+d*Math.cos((r+225)*oe)},h.addRing([[p[0].x,p[0].y,0],[p[1].x,p[1].y,0],[p[2].x,p[2].y,0],[p[3].x,p[3].y,0],[p[0].x,p[0].y,0]]),h}function Fi(e){return e&&qa(e==null?void 0:e.spatialReference)?1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*e.y/Qt.radius))):1}function Zs(e,t){const a=1+t/100;if(e.declaredClass==="esri.geometry.Circle"){const{radius:i,center:r}=e,o=new Bt({radius:i*a,center:r});return e.rings.length>1&&o.addRing(e.rings[1]),o}if(e.declaredClass==="esri.geometry.Polygon"){const i=new se({spatialReference:e.spatialReference}),r=e.centroid;if(r){const o=[];for(let s=0;s<e.rings[0].length;s++){const n=Math.sqrt((r.x-e.rings[0][s][0])**2+(r.y-e.rings[0][s][1])**2),l=N(J(R(),[e.rings[0][s][0],e.rings[0][s][1],0],[r.x,r.y,0]),1/n,1),h=Ge([r.x,r.y,0],l,n*a,1);o.push({x:h[0],y:h[1]})}i.addRing([[o[0].x,o[0].y,0],[o[1].x,o[1].y,0],[o[2].x,o[2].y,0],[o[3].x,o[3].y,0],[o[0].x,o[0].y,0]])}return i}return e}async function xc(e,t,a){const{cameraHeight:i,cameraLocation:r,cameraPitch:o,frustumVertices:s,horizontalFieldOfView:n,imageHeight:l,imageWidth:h,inSRS:m,outSRS:d,verticalFieldOfView:p,cameraRoll:g,options:f}=a,y=new Z(m),w=new Z(d),v=wi(n,p,g??0),b=s.length>15;return o+v.vfov/2>=90?await Xs(s,e,h,l,y,w,b,f):await Us(s,e,t,r,i,b,y,w,f)}async function Us(e,t,a,i,r,o,s,n,l){const h=Qs(e,t,a,i,r);if(!h)return;const{farPlane:m,nearPlane:d}=h,p=await Si([...(d==null?void 0:d.vertexPositions)??e.slice(0,3),...m.vertexPositions],s,n,l),g=Ti(p);return new Qe({vertexAttributes:new ta({position:p}),components:Ai(o?Ri(g,!0):Oi(g,!0)),spatialReference:n})}function Qs(e,t,a,i,r){const o=Oa(e),s=Oa(e,"near");if(!o)return;const n=t.length;for(let l=0;l<n;l++){const h=Array.from(a[l]),m=[h[0]-i[0],h[1]-i[1],h[2]-(i[2]??r)];Ys(i,m,l,s),Js(i,m,l,o)}return{farPlane:o,nearPlane:s}}function Js(e,t,a,i){const{coefficients:r,vertexPositions:o}=i,s=R();ti(r,{origin:e,direction:t},s)&&o.splice(3*a,3,...s)}function Ys(e,t,a,i){if(!i)return;const r=R();ti(i.coefficients,{origin:e,direction:t},r)&&i.vertexPositions.splice(3*a,3,...r)}async function Xs(e,t,a,i,r,o,s,n){let l,h=s?new Array:[e[0],e[1],e[2]],m=new Array;for(const g of t)s?(l=je([g[0],g[1],1],[[0,0,1],[a,0,1],[a,i,1],[0,i,1]],[[e[0],e[1],e[2]],[e[3],e[4],e[5]],[e[6],e[7],e[8]],[e[9],e[10],e[11]]]),h=h.concat(...l),l=je([g[0],g[1],1],[[0,0,1],[a,0,1],[a,i,1],[0,i,1]],[[e[12],e[13],e[14]],[e[15],e[16],e[17]],[e[18],e[19],e[20]],[e[21],e[22],e[23]]]),m=m.concat(...l)):(l=je([g[0],g[1],1],[[0,0,1],[a,0,1],[a,i,1],[0,i,1]],[[e[3],e[4],e[5]],[e[6],e[7],e[8]],[e[9],e[10],e[11]],[e[12],e[13],e[14]]]),h=h.concat(...l));h=h.concat(m);const d=await Si(h,r,o,n),p=Ti(d);return new Qe({vertexAttributes:new ta({position:d}),components:Ai(s?Ri(p,!0):Oi(p,!0)),spatialReference:o})}async function Si(e,t,a,i){if(t.equals(a))return e;const r=e.reduce((s,n,l)=>{const h=Math.floor(l/3);return s[h]||(s[h]=new Array),s[h].push(n),s},new Array),{points:o}=await re(new Za(r,t),a,i);return L(i),o.flat()}function Oa(e,t="far"){const a=ro();let i;switch(t){case"far":if(i=Array.from(e.length===15?e.slice(3):e.slice(12)),ba(a,i,!1))return{coefficients:a,vertexPositions:i};break;case"near":return i=Array.from(e.slice(0,12)),e.length===15||!ba(a,i,!1)?void 0:{coefficients:a,vertexPositions:i}}}const Ri=(e,t=!1)=>{if(t&&e-2<=4||e<=4||e%2!=0)throw new Error("Invalid number of vertices");const a=[],i=e/2,r=Math.round((t?e-2:e)/2);for(let o=0;o<r;o++){const s=o+i,n=t?s+1:s,l=n%e,h=(t?s:n+1)%e;a.push({faces:new Uint32Array([o,h,l,o,o+1,l])})}return a};function Oi(e,t=!1){if(e<3||t&&e-1<3)throw new Error("Invalid number of vertices");const a=[],i=t?e-2:e-1;for(let r=0;r<i;r++)a.push({faces:new Uint32Array([0,r+1,r+2])});return a}const Ai=e=>e.map(t=>new to(t)),Ti=e=>e.length/3;async function De(e,t,a){const i=Array.isArray(e)?e:[e];let r;if(Ii(t))r=await yi(i,t.elevationSample,a);else if(la(t)){const{elevationSource:o,extent:s}=t,{url:n,lod:l,rasterFunction:h}=o;r=await No(i,{url:n,lod:l,rasterFunction:h,extent:s},a)}else r=await Zo(i,t.elevationSource.constantElevation,a);return Array.isArray(e)?r:r[0]}function $e(e,t){const{cameraLocation:a,pointsToTransform:i,scalingFactor:r}=en(e,t.cameraLocation,t.rotationMatrix),o=new Array;return Ks(i,o,{...t,cameraLocation:a,scalingFactor:r,...rn(t)}),Array.isArray(e)?o:o[0]}function Ks(e,t,a){const{affineTransformations:i,cameraLocation:r,focalLengthX:o,focalLengthY:s,principalOffsetPoint:n,radialDistortionCoefficients:l,rotationMatrix:h,scalingFactor:m,tangentialDistortionCoefficients:d}=a;for(const p of e){const g=Ut();J(g,p,r),g[0]=g[0]/m,g[1]=g[1]/m;const f=-o*((h[0]*g[0]+h[3]*g[1]+h[6]*g[2])/(h[2]*g[0]+h[5]*g[1]+h[8]*g[2])),y=-s*((h[1]*g[0]+h[4]*g[1]+h[7]*g[2])/(h[2]*g[0]+h[5]*g[1]+h[8]*g[2])),w=f*f+y*y;let v=0,b=0,C=0,F=0,I=0,S=0,A=0;l&&(v=l[0]??0,b=l[1]??0,C=l[2]??0),d&&(F=d[0],I=d[1]),n&&(S=n[0]??0,A=n[1]??0);const E=1+v*w+b*w*w+C*w*w*w;let T=f*E+F*(w+2*f**2)+2*I*f*y,G=y*E+I*(w+2*y**2)+2*F*f*y;T+=S,G+=A;const ce=Number(i[0])+Number(i[1])*T+Number(i[2])*G,he=Number(i[3])+Number(i[4])*T+Number(i[5])*G;t.push({x:ce,y:he})}}function Ke(e,t){const{cameraHeading:a,imageHeight:i,imageWidth:r}=t,{cameraLocation:o,pointsToTransform:s}=tn(e,t.cameraLocation),n=new Array;for(const l of s){const h=Rr(o,l),m=vs(fe(Math.atan2(l[0]-o[0],l[1]-o[1]))-a),d=fe(Math.acos((o[2]-l[2])/h));n.push(_i(m,d,r,i))}return Array.isArray(e)?n:n[0]}function en(e,t,a){const i=Array.isArray(e)||"items"in e?e:[e];bi(i,t),Li(i,t),Mi(a);const r=Xe(t.y,t.spatialReference);return{pointsToTransform:i.map(o=>o.toArray()),scalingFactor:r,cameraLocation:t.toArray()}}function tn(e,t){const a=Array.isArray(e)||"items"in e?e:[e];return bi(a,t),Li(a,t),{pointsToTransform:a.map(i=>i.toArray()),cameraLocation:t.toArray()}}function Li(e,t){if(e.some(a=>!a.spatialReference.equals(t.spatialReference)))throw new Error("Input points and camera location must have the same spatial reference")}function an(e){return(e==null?void 0:e.focalLength)!=null}function rn(e){if(an(e))return{focalLengthX:e.focalLength,focalLengthY:e.focalLength};const{imageWidth:t,imageHeight:a,horizontalFieldOfView:i,verticalFieldOfView:r}=e;return{focalLengthX:t/(2*Math.tan(Y(i)/2)),focalLengthY:a/(2*Math.tan(Y(r)/2))}}async function on(e,t,a,i=Vi){const{cameraLocation:r,farPlaneVertices:o}=a,s=ue(r),n=new Array;await Ei(o,a,n);let l=lt(n[0],n[1],n[2]),h=e.clone();for(let m=0;m<i;m++){const d=Ut();if(!ai(l,s,ue(e),d))break;let p=0,g=null;if({error:p,imagePoint:g,pointWithZ:h}=await nn(t,new V(d,r.spatialReference),a),p<=1)break;const[f,y]=ki(r.spatialReference,n);if(Me(f<=1,y<=1))break;n.splice(0,n.length,...await zi(f,y,new V(d,r.spatialReference),a)),l=lt(n[0],n[1],n[2])}return ue(h)}async function sn(e,t,a,i=Vi){const{cameraLocation:r,farPlaneVertices:o}=a,s=ue(r),n=new Array;await Ei(o,a,n);let l=lt(n[0],n[1],n[2]),h=e.clone();for(let m=0;m<i;m++){const d=Ut();if(!ai(l,s,ue(e),d))break;let p,g=0;if({error:g,imagePoint:p,pointWithZ:h}=await ln(t,new V(d,r.spatialReference),a),g<=1)break;const[f,y]=ki(r.spatialReference,n);if(Me(f<=1,y<=1))break;n.splice(0,n.length,...await zi(f,y,new V(d,r.spatialReference),a)),l=lt(n[0],n[1],n[2])}return ue(h)}const Vi=10,Aa=10;function ki(e,t){var i,r;const a=new se({spatialReference:e});return a.addRing(t),[(i=a.extent)!=null&&i.width?a.extent.width/Aa:1,(r=a.extent)!=null&&r.height?a.extent.height/Aa:1]}async function Ei(e,t,a){const i=co(e),r=await De(i,t);a.push(...r.map(ue))}async function nn(e,t,a){const i=await De(t,a),r=$e(i,a);return{error:cn(r,e),imagePoint:r,pointWithZ:i}}async function ln(e,t,a){const i=await De(t,a),r=Ke(i,a);return{error:hn(r,e),imagePoint:r,pointWithZ:i}}const cn=(e,t)=>Math.abs(e.x-t.x)+Math.abs(e.y-t.y),hn=(e,t)=>Math.abs(e.heading-t.heading)+Math.abs(e.pitch-t.pitch);async function zi(e,t,a,i){const r=[[-e,-t],[e,-t],[e,t],[-e,t]].map(([o,s])=>new V([a.x+o,a.y+s],a.spatialReference));return De(r,i).then(o=>o.map(s=>s.toArray()))}async function _t(e,t,a){const{verticalFieldOfView:i,imageBoundaries:r,scalingFactor:o,farPlaneVertices:s,cameraLocation:n,pixelsToTransform:l,vecToPoint:h}=fn(e,t),m=new Array;return await un(l,s,r,h,t,m,n,o,i,a),Array.isArray(e)?m:m[0]}async function un(e,t,a,i,r,o,s,n,l,h){let m=r.averageElevation;for(const d of e){const p=dn(t,a,d,i,r);h&&Me(We(h.elevationSample),la(h))&&(m=(await on(i(p),{x:d[0],y:d[1]},{...r,...h,farPlaneVertices:t.map(i)}))[2]),o.push(i(Gi(p,s,n,m,r.cameraPitch,l)))}}function Gi(e,t,a,i,r,o){let s=$r(e);const n=Math.sqrt((e[2]-t[2])**2+(Math.sqrt((e[0]-t[0])**2+(e[1]-t[1])**2)/a)**2)*a,l=N(J(R(),e,t),1/n,1/a);if(mn(e[2],i,r,o)){const h=Math.abs((t[2]-i)/-l[2])*a;s=Ge(t,l,h,a)}else s[2]=i;return s}function mn(e,t,a,i){return e<t||a+i/2<90}function dn(e,t,a,i,r){let o=null;const s=9;let n,l=0,h=e,m=t;for(;l<=s;){const d=gn(a,m,h,r);if(n=d.error,o=d.transformedPoint,Me(n<=1,l===s))break;h=ns(h,n,a,t),m=pn(h,i,r),l++}return o}function pn(e,t,a){return $e(e.map(t),a).map(({x:i,y:r})=>[i,r,1])}function gn(e,t,a,i){const{cameraLocation:r}=i,o=je(e,t,a),{x:s,y:n}=$e(new V(o,r.spatialReference),i);return{transformedPoint:o,error:yn(e,[s,n,1])}}function yn(e,t){return Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1])}function fn(e,t){const a=wr(e)||"items"in e?e:[e],{cameraLocation:i,rotationMatrix:r}=t;if(os(a,i),Mi(r),(r==null?void 0:r.length)!==9)throw new Error("Rotation matrix is not provided or is not a valid 3x3 matrix");const o=Xe(i.y,i.spatialReference),s=gs({...t,scalingFactor:o}),n=$e(s.map(h=>new V(h,i.spatialReference)),t),{vfov:l}=wi(t.horizontalFieldOfView,t.verticalFieldOfView,t.cameraRoll);return{cameraLocation:i.toArray(),imageBoundaries:n.map(({x:h,y:m})=>[h,m,1]),verticalFieldOfView:l,farPlaneVertices:s,scalingFactor:o,pixelsToTransform:a.map(h=>[h.x,h.y,1]),vecToPoint:ss(i.spatialReference)}}async function bt(e,t,a){const{cameraHeading:i,cameraLocation:r,farDistance:o,imageHeight:s,imageWidth:n,verticalFieldOfView:l}=t,h=Xe(r.y,r.spatialReference),m=new Array,[d,p,g]=r.toArray(),f=lo([d,p,g??0],o*h),y=na.toArray(),w=Array.isArray(e)?e:[e];for(const v of w){let b,C;if(ds(v))b=v.heading,C=v.pitch;else{const E=Pe({x:v.x,y:v.y},n,s);b=E.heading,C=E.pitch}b=(b+i)%360;const F=oo([y[0],y[1],y[2]],xe(b,C)),I=so([d,p,g??0],F.direction),S=R();no(f,I,S);let A=t.averageElevation;a&&(Zt(a)||We(a.elevationSample))&&C+l/2<90&&(A=(await sn(new V(S,r.spatialReference),{heading:b,pitch:C},{...t,...a,farPlaneVertices:ps(o,o).map(([E,T])=>new V([r.x+E,r.y+T],r.spatialReference))}))[2]),m.push(new V(Gi(S,r.toArray(),h,A,C,l),r.spatialReference))}return Array.isArray(e)?m:m[0]}let we=class extends Ka.ClonableMixin(ze){constructor(e){super(e),this.maxFOV=0,this.minFOV=0,this.view=null,this.zoomFactor=5}get canZoomIn(){return!!this.view&&(this.minFOV===0||this.view.camera.fov>this.minFOV)}get canZoomOut(){return!!this.view&&(this.maxFOV===0||this.view.camera.fov<this.maxFOV)}};c([u({type:Boolean,readOnly:!0})],we.prototype,"canZoomIn",null),c([u({type:Boolean,readOnly:!0})],we.prototype,"canZoomOut",null),c([u({type:Number})],we.prototype,"maxFOV",void 0),c([u({type:Number})],we.prototype,"minFOV",void 0),c([u()],we.prototype,"view",void 0),c([u({type:Number})],we.prototype,"zoomFactor",void 0),we=c([me("esri.widgets.PanoramicViewer.PanoramicZoomConditions")],we);const dt=we;let Ie=class extends fo{constructor(t){super(t),this.panoramicZoomConditions=new dt,this.zoomTo=a=>{this.view.camera.fov=this.constrainFOV(a),this.view.camera=this.view.camera.clone()}}initialize(){this.addHandles([O(()=>{var t;return[(t=this.view)==null?void 0:t.ready,this.panoramicZoomConditions]},()=>{var t;(t=this.view)!=null&&t.ready&&(this.panoramicZoomConditions.view=this.view,this.zoomTo(this.view.camera.fov))},q),O(()=>[this.panoramicZoomConditions.maxFOV,this.panoramicZoomConditions.minFOV],([t,a])=>{t!=null&&a!=null&&this.zoomTo(this.view.camera.fov)},Mr)])}get canZoomIn(){return this.panoramicZoomConditions.canZoomIn}get canZoomOut(){return this.panoramicZoomConditions.canZoomOut}get state(){var t;return(t=this.view)!=null&&t.ready?"ready":"disabled"}set view(t){this._set("view",t)}constrainFOV(t){const{maxFOV:a,minFOV:i}=this.panoramicZoomConditions;return Te(t,i,a)}zoomIn(){if(!this.canZoomIn)return;const t=this.view.camera.fov-this.panoramicZoomConditions.zoomFactor;this.zoomTo(t)}zoomOut(){if(!this.canZoomOut)return;const t=this.view.camera.fov+this.panoramicZoomConditions.zoomFactor;this.zoomTo(t)}};c([u()],Ie.prototype,"canZoomIn",null),c([u()],Ie.prototype,"canZoomOut",null),c([u({type:dt})],Ie.prototype,"panoramicZoomConditions",void 0),c([u()],Ie.prototype,"state",null),c([u()],Ie.prototype,"view",null),Ie=c([me("esri.widgets.PanoramicViewer.PanoramicZoomViewModel")],Ie);const vn=Ie;function wn(e,t=na,a=wt){const i=t.clone();i.z=-500;const r=Qe.createSphere(i,{size:a,densificationFactor:2,vertexSpace:"georeferenced",material:new ao({colorTexture:new io({data:e})})});if(r.components[0].trustSourceNormals=!0,r.vertexAttributes.uv){const o=r.vertexAttributes.uv.length??0;for(let s=0;s<o;s++)r.vertexAttributes.uv[2*s+0]=1-r.vertexAttributes.uv[2*s+0],r.vertexAttributes.uv[2*s+1]=r.vertexAttributes.uv[2*s+1]}return r.centerAt(i),r}function _n(e){return new H({geometry:e,symbol:new Yt({symbolLayers:new B([new Xt])})})}function Vt(e,t){return 2*fe(Math.atan(Math.tan(Y(e/2))*Math.sqrt(t**2+1)))}const ke={default:"default",navigation:"navigation",fovConstraint:"fov-constraint",clickAction:"image-click-action"};let j=class extends ea.EventedAccessor{constructor(t){super(t),this._startPosition=null,this._targetPosition=null,this._graphics=new Be({elevationInfo:{mode:"relative-to-ground"}}),this._imageGraphic=null,this._loadController=null,this._map=new ri({ground:new go({opacity:0,navigationConstraint:null}),layers:new B([this._graphics])}),this._zoomViewModel=null,this.autoLoad=!1,this.clickAction="none",this.imageSize=null,this.imageSource=null,this.pitch=90,this.state="ready",this.yaw=0,this._addNavigationHandles=()=>{this.imageRenderer.basemapTerrain.suspended=!0,this.imageRenderer.constraints.tilt.max=180,this.removeHandles(ke.navigation),this.addHandles([this.imageRenderer.on("mouse-wheel",this._handleWheel),this.imageRenderer.on("double-click",this._handleDoubleClick),this.imageRenderer.on("drag",this._handleDrag),this.imageRenderer.on("key-down",a=>{const i=["+","-","Shift","_","=","ArrowUp","ArrowDown","ArrowRight","ArrowLeft"],r=a.key;i.includes(r)&&a.stopPropagation()})],ke.navigation)},this._addHFOVHandles=()=>{this.removeHandles(ke.fovConstraint),this.addHandles(O(()=>[this.maxHFOV,this.minHFOV],()=>{this._zoomViewModel&&(this._zoomViewModel.panoramicZoomConditions=new dt({view:this.imageRenderer,maxFOV:this.maxHFOV,minFOV:this.minHFOV}))},q),ke.fovConstraint)},this._addZoomHandles=()=>{this._zoomViewModel=new vn({view:this.imageRenderer,panoramicZoomConditions:new dt({maxFOV:this.maxHFOV,minFOV:this.minHFOV})});const a=this.imageRenderer.ui.find("zoom");a&&(a.viewModel=this._zoomViewModel),this._addHFOVHandles()},this._cancelLoadWithController=()=>{var a;(a=this._loadController)==null||a.abort(),this._loadController=null},this._handleDoubleClick=a=>{a.stopPropagation(),a.native.ctrlKey?this._zoomOut():this._zoomIn()},this._handleDrag=a=>{a.stopPropagation();const{action:i,x:r,y:o}=a;switch(i){case"start":this._startPosition=this._targetPosition={x:r,y:o};break;case"update":this._targetPosition={x:r,y:o},this._updateCameraHeadingAndTilt()}},this._handleImageClick=a=>{if(this.state==="image-loaded"&&this.imageRenderer.ready)switch(this.clickAction){case"emit":a.stopPropagation(),this.emit("click",a);break;case"hittest":a.stopPropagation(),a.async(async()=>{const i=await this.imageRenderer.hitTest(a.screenPoint,{include:this._graphics});this.emit("hittest-response",i)});break;case"pixel-location":{if(a.stopPropagation(),!this.imageSize||!a.mapPoint)return void this.emit("pixel-location",null);const i=Oe(a.mapPoint,this.imageSize[0],this.imageSize[1]);this.emit("pixel-location",{...i,spatialReference:Z.WebMercator});break}}},this._handleWheel=a=>{const i=a.deltaX??a.native.deltaX;a.stopPropagation(),i>0||a.deltaY>0?this._zoomOut():this._zoomIn()},this._loadWithController=()=>{this._cancelLoadWithController(),this._loadController=new AbortController,this.loadImage(this._loadController)},this._zoomIn=()=>{var a;return(a=this._zoomViewModel)==null?void 0:a.zoomIn()},this._zoomOut=()=>{var a;return(a=this._zoomViewModel)==null?void 0:a.zoomOut()},this.addGraphic=(a,i)=>this.state==="image-loaded"&&!this._graphics.graphics.includes(a)&&(this._graphics.graphics.add(a,i),!0),this.addManyGraphics=a=>{if(this.state!=="image-loaded")return!1;const i=a.filter(r=>!this._graphics.graphics.includes(r));return this._graphics.graphics.addMany(i),!0},this.clearGraphics=()=>{this._graphics.graphics.removeAll()},this.clearImage=()=>{this.imageSize=null,this._removeImageSphere()},this.removeGraphic=a=>!(this.state!=="image-loaded"||!this._graphics.graphics.includes(a))&&(this._graphics.remove(a),!0),this.removeManyGraphics=a=>{if(this.state!=="image-loaded")return!1;const i=a.filter(r=>this._graphics.graphics.includes(r));return this._graphics.removeMany(i),!0},this._imageRenderer=new yo({map:this._map,viewingMode:"local",camera:{position:na},environment:{atmosphereEnabled:!1,starsEnabled:!1,lighting:{type:"virtual"}},popupEnabled:!1,spatialReference:Z.WebMercator,ui:{components:["zoom"]}})}destroy(){this._imageRenderer.destroy()}initialize(){this.state="initialized",this.addHandles([O(()=>this.imageSource,()=>{this.imageSource&&this.autoLoad&&this._loadWithController()},q),O(()=>this.fov,()=>{this._reloadCamera()},q),O(()=>this.yaw,t=>{this.camera.heading=t,this._reloadCamera()},q),O(()=>this.pitch,t=>{this.camera.tilt=t,this._reloadCamera()},q),Cr(()=>this.imageRenderer.ready,()=>{this._addNavigationHandles(),this._addZoomHandles()},q),O(()=>this.clickAction,t=>{this.removeHandles(ke.clickAction),t!=="none"&&this.addHandles(this.imageRenderer.on("click",this._handleImageClick))},q)],ke.default)}get camera(){return this.imageRenderer.camera}set camera(t){t&&(this.imageRenderer.camera=t.clone())}get fov(){return this.camera.fov}set fov(t){var a;Number.isFinite(t)&&((a=this._zoomViewModel)==null||a.zoomTo(t))}get hfov(){const{fov:t}=this.camera,{size:[a,i]}=this.imageRenderer,r=a/i,o=Math.atan(r);return 2*fe(Math.atan(Math.tan(Y(t/2))*Math.sin(o)))}get imageRenderer(){return this._imageRenderer}get maxHFOV(){const{size:[t,a]}=this.imageRenderer;return Vt(Qo,t/a)}get minHFOV(){const{size:[t,a]}=this.imageRenderer;return Vt(Jo,t/a)}get vfov(){const{fov:t}=this.camera,{size:[a,i]}=this.imageRenderer,r=a/i,o=Math.atan(r);return 2*fe(Math.atan(Math.tan(Y(t/2))*Math.cos(o)))}async _loadImageInternal(t,a){let i;this.state="image-loading";try{i=(await Jt(t,{responseType:"image",...a})).data}catch(r){throw ne(r)?this.state="image-load-aborted":this.state="image-load-error",r}return this._updateImageSphere(i,a)}_reloadCamera(){this.camera=this.camera.clone()}_removeImageSphere(){this._imageGraphic&&(this._graphics.remove(this._imageGraphic),this._imageGraphic=ie(this._imageGraphic)),this.state="ready",this.imageSize=null}_updateCameraHeadingAndTilt(){if(!this._startPosition||!this._targetPosition)return;const t=this.camera.heading+(this._startPosition.x-this._targetPosition.x)/this.imageRenderer.width*this.camera.fov;this.yaw=(t+360)%360;const a=this.camera.tilt-(this._startPosition.y-this._targetPosition.y)/this.imageRenderer.height*this.imageRenderer.camera.tilt;this.pitch=Math.min(179.5,Math.max(.5,a)),this._startPosition=this._targetPosition}async _updateImageSphere(t,a){await Ue(a);const{size:[i,r]}=this.imageRenderer;return this._imageGraphic=_n(wn(t)),this._graphics.add(this._imageGraphic),this.fov=Vt(Uo,i/r),this.state="image-loaded",this.imageSize=[t.width,t.height],this._imageGraphic.geometry}async loadImage(t){return this._removeImageSphere(),this.imageSource?this._loadImageInternal(this.imageSource,t):mt(this.declaredClass,new Q(di("panoramic-viewer"),pi("PanoramicViewerViewModel","imageSource")))}};c([u()],j.prototype,"_graphics",void 0),c([u()],j.prototype,"_imageGraphic",void 0),c([u()],j.prototype,"_imageRenderer",void 0),c([u()],j.prototype,"_loadController",void 0),c([u()],j.prototype,"_map",void 0),c([u()],j.prototype,"_zoomViewModel",void 0),c([u({type:Boolean})],j.prototype,"autoLoad",void 0),c([u({type:ii})],j.prototype,"camera",null),c([ei(new Wr({emit:"emit",hittest:"hittest",none:"none","pixel-location":"pixel-location"}))],j.prototype,"clickAction",void 0),c([u({type:Number})],j.prototype,"fov",null),c([u({readOnly:!0})],j.prototype,"hfov",null),c([u({readOnly:!0})],j.prototype,"imageRenderer",null),c([u()],j.prototype,"imageSize",void 0),c([u()],j.prototype,"imageSource",void 0),c([u({readOnly:!0})],j.prototype,"maxHFOV",null),c([u({readOnly:!0})],j.prototype,"minHFOV",null),c([u({type:Number})],j.prototype,"pitch",void 0),c([u()],j.prototype,"state",void 0),c([u({readOnly:!0})],j.prototype,"vfov",null),c([u({type:Number})],j.prototype,"yaw",void 0),j=c([me("esri.widgets.PanoramicViewer.PanoramicViewerViewModel")],j);const Di=j,bn="esri-panoramic-viewer";let X=class extends vt{constructor(e){super(e),this.viewModel=new Di,this._afterContainerCreate=t=>{this.imageRenderer.container=t},this.addGraphic=(t,a)=>{this.viewModel.addGraphic(t,a)},this.addManyGraphics=t=>{this.viewModel.addManyGraphics(t)},this.clearGraphics=()=>{this.viewModel.clearGraphics()},this.clearImage=()=>{this.viewModel.clearImage()},this.loadImage=t=>this.viewModel.loadImage(t),this.removeGraphic=t=>{this.viewModel.removeGraphic(t)},this.removeManyGraphics=t=>{this.viewModel.removeManyGraphics(t)}}get autoLoad(){return this.viewModel.autoLoad}set autoLoad(e){this.viewModel.autoLoad=e}get camera(){return this.viewModel.camera}set camera(e){e&&(this.viewModel.camera=e)}get clickAction(){return this.viewModel.clickAction}set clickAction(e){this.viewModel.clickAction=e}get fov(){return this.camera.fov}set fov(e){this.viewModel.fov=e}get hfov(){return this.viewModel.hfov}get icon(){return"i360-view"}set icon(e){this._overrideIfSome("icon",e)}get imageRenderer(){return this.viewModel.imageRenderer}get imageSize(){return this.viewModel.imageSize}get imageSource(){return this.viewModel.imageSource}set imageSource(e){this.viewModel.imageSource=e}get pitch(){return this.viewModel.pitch}set pitch(e){this.viewModel.pitch=e}get state(){return this.viewModel.state}get vfov(){return this.viewModel.vfov}get yaw(){return this.viewModel.yaw}set yaw(e){this.viewModel.yaw=e}render(){return M("div",{afterCreate:this._afterContainerCreate,bind:this,class:this.classes(ct.widget,bn)})}};c([u({type:Boolean})],X.prototype,"autoLoad",null),c([u({type:ii})],X.prototype,"camera",null),c([u()],X.prototype,"clickAction",null),c([u({type:Number})],X.prototype,"fov",null),c([u({readOnly:!0,type:Number})],X.prototype,"hfov",null),c([u()],X.prototype,"icon",null),c([u({readOnly:!0})],X.prototype,"imageRenderer",null),c([u({readOnly:!0})],X.prototype,"imageSize",null),c([u()],X.prototype,"imageSource",null),c([u({type:Number})],X.prototype,"pitch",null),c([u({readOnly:!0})],X.prototype,"state",null),c([u({readOnly:!0,type:Number})],X.prototype,"vfov",null),c([ht(["click","hittest-response","pixel-location"]),u({type:Di})],X.prototype,"viewModel",void 0),c([u({type:Number})],X.prototype,"yaw",null),X=c([me("esri.widgets.PanoramicViewer")],X);const Mn=X,Cn=new Ye({size:15,style:"circle",color:[255,102,102,.5],outline:null}),Ta=new Ye({size:10,style:"circle",color:[0,128,192,.5],outline:null}),Sc=new Je({style:"solid",color:[0,128,192,.5],outline:null}),Rc=new Je({style:"solid",color:[255,102,102,.5],outline:null}),La=new Ye({size:10,style:"diamond",color:[255,102,102],outline:null}),In=new Kt({symbolLayers:new B([new Qr({size:10,material:{color:"red"},resource:{primitive:"x"},outline:{color:"black",size:1}})])}),Pn=new Kt({symbolLayers:new B([new Xa({width:9,height:9,depth:9,material:{color:[255,102,102]},resource:{primitive:"diamond"},castShadows:!1})])}),Va=new Ya({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,size:10,frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[0,1.4142135623730951],[3.585786437626905,5],[5,3.585786437626905],[1.4142135623730951,0],[5,-3.585786437626905],[3.585786437626905,-5],[0,-1.4142135623730951],[-3.585786437626905,-5],[-5,-3.585786437626905],[-1.4142135623730951,0],[-5,3.585786437626905],[-3.585786437626905,5],[0,1.4142135623730951]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,width:1,color:[0,0,0,100]},{type:"CIMSolidFill",enable:!0,color:[255,0,0,255]}]}}]}]}}}),Oc=new Yt({symbolLayers:new B([new Xt({material:{color:[255,102,102,.5]},edges:null})])}),Ac=new Yt({symbolLayers:new B([new Xt({material:{color:[0,128,192,.25]},edges:null})])}),xn=new Ye({size:8,style:"triangle",color:[255,165,0],outline:{color:[0,0,0],width:.5}}),$n=new Kt({symbolLayers:new B([new Xa({width:12,height:12,depth:12,material:{color:[255,165,0]},resource:{primitive:"tetrahedron"},outline:{color:"black",size:1},castShadows:!1})])}),ka=(e,t=3.5)=>new Ya({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[14,12],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:t,color:bo(e).toArray()},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:t,color:e.toArray()}]}}}),Ea=new Ur({symbolLayers:new B([new Jr({profile:"circle",width:7,material:{color:"orange"},cap:"round"})])}),Fn=e=>new Je({color:_o(e,.3),outline:{color:e,width:2}});function Sn(e){switch(e){case"point":return t=>new Ye({size:10,style:"circle",color:t??Hi(),outline:new aa({color:[0,0,0],width:2})});case"polygon":return t=>new Je({color:null,outline:pt(t),style:"none"});case"polyline":return t=>pt(t)}}function Hi(){return new wo([255,0,0])}function pt(e){return new aa({color:e??Hi(),width:2})}function Rn(e){return new Je({color:null,outline:pt(e),style:"none"})}function On(e,t,a){return e===t?a:e==="polyline"?pt(a==null?void 0:a.color):Rn(a==null?void 0:a.color)}function gt(e,t,a){const i=e.toLowerCase(),r=t.toLowerCase()===i,o=(a==null?void 0:a.toLowerCase())===i;return Me(r,o)}function An(e){return e==="point"||e==="polygon"||e==="polyline"}function Tn(e,t,a){return An(e.geometryType)&&e.fields.filter(({name:i,type:r,alias:o})=>gt(a!=null&&a.length?a:oa,i,o)||gt(t!=null&&t.length?t:ra,i,o)&&r==="blob").length===2}function Tc(e){return e.type==="feature"&&Ln(e)}function Ln(e){return e.geometryType==="point"||e.geometryType==="polygon"||e.geometryType==="polyline"}function Vn(e,t,a){if(!e)return;const{renderer:i}=e,r=Sn(t),o=i?"symbol"in i?i.symbol:"defaultSymbol"in i?i.defaultSymbol:i.getSymbol():null,s=r(o==null?void 0:o.color);a[`${t}Symbol`]=(t===e.geometryType?o:null)??s}function kn(e,t,a){const i=e.fields.find(({name:o,alias:s,type:n})=>gt(t!=null&&t.length?t:ra,o,s)&&n==="blob"),r=e.fields.find(({name:o,alias:s})=>gt(a!=null&&a.length?a:oa,o,s));if(!i||!r)throw new Q("invalid-data-capture-layer","Data capture layer is not configured correctly.",{layer:e,imageGeometryField:i,oiObjectIdField:r});return{imageGeometryField:i,oiObjectIdField:r}}function En(e,t,a,i,r,o,s){let n=zn(e,t);if(!n)throw new Q("InvalidGeometry");return n=Dn(n,o,r),new H({attributes:e,layer:a,symbol:On(n.type,a.geometryType,s),geometry:n,visible:a.visible&&i})}function zn(e,t){const{geometry:a}=JSON.parse(atob(e[t]));return vo(a)}function Lc(e,t,a){switch(t){case"default":return Gn(e);case"panoramic":return Ni(e,a)}}function Gn(e){switch(e.type){case"point":e.x+=.5,e.y=.5-e.y;break;case"polyline":e.paths=e.paths.map(t=>t.map(([a,i])=>[a+.5,.5-i]));break;case"polygon":e.rings=e.rings.map(t=>t.map(([a,i])=>[a+.5,.5-i]));break;case"multipoint":e.points=e.points.map(([t,a])=>[t+.5,.5-a]);break;case"extent":e.xmin+=.5,e.xmax+=.5,e.ymin=.5-e.ymin,e.ymax=.5-e.ymax}return e}function Ni(e,t){switch(e.type){case"point":{const{x:a,y:i}=Oe(e,t[0],t[1]);e.x=a,e.y=i,delete e.z;break}case"polyline":e.paths=e.paths.map(a=>a.map(i=>{const{x:r,y:o}=Oe({x:i[0],y:i[1],z:i[2]},t[0],t[1]);return[r,o]}));break;case"polygon":e.rings=e.rings.map(a=>a.map(i=>{const{x:r,y:o}=Oe({x:i[0],y:i[1],z:i[2]},t[0],t[1]);return[r,o]}));break;case"multipoint":e.points=e.points.map(a=>{const{x:i,y:r}=Oe({x:a[0],y:a[1],z:a[2]},t[0],t[1]);return[i,r]});break;case"extent":{const{xmin:a,xmax:i,ymin:r,ymax:o}=Ni(se.fromExtent(e),t).extent;e.xmax=i,e.xmin=a,e.ymax=o,e.ymin=r;break}}return e}function Dn(e,t,a){switch(t){case"default":return Hn(e);case"panoramic":return Bi(e,a)}}function Hn(e){switch(e.type){case"point":e.x-=.5,e.y=.5-e.y;break;case"polyline":e.paths=e.paths.map(t=>t.map(([a,i])=>[a-.5,.5-i]));break;case"polygon":e.rings=e.rings.map(t=>t.map(([a,i])=>[a-.5,.5-i]));break;case"multipoint":e.points=e.points.map(([t,a])=>[t-.5,.5-a]);break;case"extent":e.xmin-=.5,e.xmax-=.5,e.ymin=.5-e.ymin,e.ymax=.5-e.ymax}return e}function Bi(e,t){switch(e.type){case"point":{const[a,i,r]=at(e,t[0],t[1]);e.x=a,e.y=i,e.z=r;break}case"polyline":e.paths=e.paths.map(a=>a.map(i=>{const[r,o,s]=at({x:i[0],y:i[1]},t[0],t[1]);return[r,o,s]}));break;case"polygon":e.rings=e.rings.map(a=>a.map(i=>{const[r,o,s]=at({x:i[0],y:i[1]},t[0],t[1]);return[r,o,s]}));break;case"multipoint":e.points=e.points.map(a=>{const[i,r,o]=at({x:a[0],y:a[1]},t[0],t[1]);return[i,r,o]});break;case"extent":{const{xmin:a,xmax:i,ymin:r,ymax:o}=Bi(se.fromExtent(e),t).extent;e.xmax=i,e.xmin=a,e.ymax=o,e.ymin=r}}return e}const ji=1e5;function ca(e,t){let a=180*Math.atan2(-e.y+t.y,e.x-t.x)/Math.PI;return a<0&&(a+=180),a*Math.PI/180}function Nn(e,t){let a=180*Math.atan2(-e.y+t.y,e.x-t.x)/Math.PI;return a<0&&(a+=180),a*Math.PI/180}function ha(e,t,a){if(!(e!=null&&e.length)||!(t!=null&&t.length)||!a)return;const[i,r]=e,[,o]=t,s=o-r;return[i+s*Math.cos(a),r+s*Math.sin(a)]}function Wi(e,t,a){if(hi(e)){const l=ut([t],"meters")[0];return{area:Ma([a],"square-meters")[0],perimeter:l}}const i=Z.WGS84,r=Nt(t,i),o=Nt(a,i);let s=ni(o,ji);if(s=ia(s),!s)return null;const n=ut([r],"meters")[0];return{area:Ma([s],"square-meters")[0],perimeter:n}}async function Bn(e,t,a,i,r=!1,o){if(t.length<2||!i||!a||!e)return null;const s=er(a,e);if(!s)return null;const n=t.map(g=>[g.x,g.y]),l=n.at(0),h=n.at(-1);if(!l||!h)return null;const m=s.map(g=>ar([l,h],g,e,r,!1)),d=await Promise.all(m);L(o);let p=0;for(const g of d){if(!g)return null;const f=Math.abs(g-i);p=Math.max(f,p)}return p}async function jn(e,t,a,i,r,o=!1,s){if(t.length<2||!i||!a||!e)throw new Error("Missing parameters");const n=tr(a,e),l=t.map(f=>[f.x,f.y]),h=l.at(0),m=l.at(-1),d=n.map(f=>ir([h,m],f,e,r,o,!1)),p=await Promise.all(d);L(s);let g=0;for(const f of p){if(!f)return 0;const y=Math.abs(f-i);g=Math.max(y,g)}return g}function Wn(e,t){const a=Ce(e,!1);if(a!=null&&a.length)return 20*de([a[0].x,a[0].y],[a.at(-1).x,a.at(-1).y])/t}function qi(e){const t=e.spatialReference;if(t.isGeographic){if(hi(t))return ut([e],"meters")[0];const a=Nt(e,Z.WGS84);return ut([a],"meters")[0]}return t.isWebMercator?li(e,"meters"):ci(e,"meters")}function Zi(e,t){const a=ia(t);if(!a)return null;const i=ci(e,"meters");return{area:Po(a,"square-meters"),perimeter:i}}function Ui(e,t){let a=ni(t,ji,"meters");if(a=ia(a),!a)return null;const i=li(e,"meters");return{area:Io(a,"square-meters"),perimeter:i}}async function qn(e,t,a){if(!t||!e)throw new Error("Missing required parameters");const i=await _t(e,t);L(a);const r=i.clone();r.z?r.z+=20:r.z=20;const{averageElevation:o,cameraPitch:s,cameraRoll:n,farDistance:l,...h}=t;return $e(r,h)}async function Zn(e,t,a,i){const{attributes:r}=a,{location:o}=r,{updateElevationProps:s,...n}=t;if(!e||!t)throw new Error("Missing parameters");let l=o.clone();l.spatialReference.isGeographic&&(l=await re(l,Z.WebMercator));const h=await bt(e,{...n,cameraLocation:l},s);L(i);const m=h.clone();return m.z?m.z+=20:m.z=20,Ke(m,n)}function Qi(e,t,a,i,r=0,o=1,s){const{averageElevation:n,cameraPitch:l,cameraRoll:h,farDistance:m,...d}=i;if(r>=5||o<=.1)return{value:e};const p=new V({x:t.x,y:t.y,z:t.z?t.z+e:e,spatialReference:i.cameraLocation.spatialReference}),g=$e(p,d),f=de([a[0].x,a[0].y],[g.x,g.y]),y=a.at(0),w=a.at(-1);if(!y||!w)return null;const v=de([y.x,y.y],[w.x,w.y])*e/f;return Qi(v,t,a,i,r+1,Math.abs(e-v))}function Ji(e,t,a,i,r=0,o=1,s){const{averageElevation:n,horizontalFieldOfView:l,verticalFieldOfView:h,farDistance:m,...d}=i;if(r>=5||o<=.1)return{value:e};const p=new V({x:t.x,y:t.y,z:t.z?t.z+e:e,spatialReference:i.cameraLocation.spatialReference}),g=Ke(p,d),f=de([a[0].x,a[0].y],[g.x,g.y]),y=a.at(0),w=a.at(-1);if(!y||!w)return null;const v=de([y.x,y.y],[w.x,w.y])*e/f;return Ji(v,t,a,i,r+1,Math.abs(e-v))}async function Yi(e,t){const{updateElevationProps:a,...i}=t;return await _t(e,i,a)}async function Xi(e,t){const{updateElevationProps:a,...i}=t;return bt(e,i,a)}function Un(e){navigator.clipboard.writeText(e).catch(t=>{throw t})}function Ki(e){const t=e.map(i=>[i.x,i.y]),a=e[0].spatialReference;return new _e({paths:[t],spatialReference:a})}function Ce(e,t){return e.map(a=>({x:t?.5+a[0]:a[0],y:t?.5-a[1]:a[1]}))}function Vc(e,t,a,i,r){const o=e==="measurement"?t:a;if(r&&o)return oi(i,si(o,"meters"),r,3)||null}function er(e,t){const{cameraPitch:a,cameraRoll:i,cameraLocation:r}=e,{x:o,y:s,z:n,spatialReference:l}=r;if(t.every(b=>b===0)||!t||!t.length)return null;const[h,m,,d,p]=t,g=[-d,0,d],f=[-p,0,p],y=[-h,0,h],w=[-m,0,m],v=[];for(const b of g)for(const C of f)for(const F of y)for(const I of y)for(const S of w){const A={...e};A.cameraPitch=a+b,A.cameraRoll=i+C,A.cameraLocation=new V({x:o+F,y:s+I,z:n?n+S:0,spatialReference:{wkid:l.wkid}}),v.push(A)}return v}function tr(e,t){const{cameraHeading:a,cameraLocation:i}=e,{x:r,y:o,z:s,spatialReference:n}=i;if(t.every(y=>y===0)||!t||!t.length)throw new Error("Invalid parameters");const[l,h,m]=t,d=m>0?[-m,0,m]:[],p=l>0?[-l,0,l]:[],g=h>0?[-h,0,h]:[],f=[];for(const y of d)for(const w of p)for(const v of p)for(const b of g){const C={...e};C.cameraHeading=a+y,C.cameraLocation=new V({x:r+w,y:o+v,z:s?s+b:0,spatialReference:{wkid:n.wkid}}),f.push(C)}return f}function kc(e,t,a,i,r){const o=e==="measurement"?t:qt(a);if(r&&o)return oi(i,si(o,"meters"),r,3)||null}function Ec(e,t,a,i,r){const o=e==="measurement"?t:a;if(r&&o)return Mo(i,Co(o,"square-meters"),r,3)||null}function qt(e){return Math.sqrt(e.reduce((t,a)=>t+a**2,0))}function za(e,t,a){if(t==="default")return e;const i={x:e[0],y:e[1],z:e[2]},r=Oe(i,a[0],a[1]);return[r.x,r.y]}async function ar(e,t,a,i=!1,r=!1,o){if(!e||!t||e.length<2)return null;const s=Ce(e,i);if(!s||s.length<2)return null;const[n,l]=[s[0],s.at(-1)];if(!l)return null;const h=[n],m=await _t(n,t);L(o);const d=m.clone();d.z?d.z+=20:d.z=20;const{averageElevation:p,cameraPitch:g,cameraRoll:f,farDistance:y,...w}=t,v=$e(d,w),b=de([n.x,n.y],[v.x,v.y]),C=ca(n,v);if(!C)return;const F=ha([n.x,n.y],[l.x,l.y],C);if(!(F!=null&&F.length))return;h.push({x:F[0],y:F[1]});const I=20*de([h[0].x,h[0].y],[h[1].x,h[1].y])/b;if(!r)return I;const S=Qi(I,m,h,t,0,1);return S==null?void 0:S.value}async function ir(e,t,a,i,r=!1,o=!1,s){const{attributes:n}=i,{location:l}=n,{updateElevationProps:h,...m}=t;if(!e||!t||e.length<2)throw new Error("Invalid parameters");const d=Ce(e,r),[p,g]=[d[0],d.at(-1)],f=[p];let y=l.clone();y.spatialReference.isGeographic&&(y=await re(y,Z.WebMercator));const w=await bt(p,{...m,cameraLocation:y},h);L(s);const v=w.clone();v.z?v.z+=20:v.z=20;const b=Ke(v,m),C=de([p.x,p.y],[b.x,b.y]),F=ca(p,b);if(!F)return;const I=ha([p.x,p.y],[g.x,g.y],F);if(!(I!=null&&I.length))return;f.push({x:I[0],y:I[1]});const S=20*de([f[0].x,f[0].y],[f[1].x,f[1].y])/C;if(!o)return S;const A=Ji(S,w,f,t,0,1);return A==null?void 0:A.value}async function kt(e,t,a=!1){if(e.length<3)return null;const i=Ce(e,a),r=await Yi(i,t),o=r.map(({x:h,y:m})=>[h,m]);e.push(e[0]),o.push(o[0]);const s=r[0].spatialReference,n=new _e({paths:[o],spatialReference:s}),l=new se({rings:[o],spatialReference:s});return s.isGeographic?Wi(s,n,l):s.isWebMercator?Ui(n,l):Zi(n,l)}async function Et(e,t,a=!1,i){if(e.length<3)return null;const r=Ce(e,a),o=await Xi(r,t);L(i);const s=o.map(({x:m,y:d})=>[m,d]);e.push(e[0]),s.push(s[0]);const n=o[0].spatialReference,l=new _e({paths:[s],spatialReference:n}),h=new se({rings:[s],spatialReference:n});return n.isGeographic?Wi(n,l,h):n.isWebMercator?Ui(l,h):Zi(l,h)}async function zt(e,t,a=!1){const i=Ce(e,a);return qi(Ki(await Yi(i,t)))}async function Gt(e,t,a=!1,i){const r=Ce(e,a),o=await Xi(r,t);return L(i),qi(Ki(o))}const Ga={click:"click-handle",enhancements:"enhancements-handle"};let W=class extends ea.EventedAccessor{constructor(e){super(e),this._imageChanged=!1,this._panConstraint=null,this._image=null,this._loadController=null,this._overlays=new Be({blendMode:"source-atop"}),this._map=new ri,this.autoLoad=!1,this.clickAction="none",this.error=null,this.imageSource=null,this.imageRotation=0,this.state="ready",this._cancelLoadWithController=()=>{var t;(t=this._loadController)==null||t.abort(),this._loadController=null},this._createImageHandles=()=>{this.removeHandles(Ga.enhancements),this.addHandles(O(()=>[this.brightness,this.contrast,this.sharpness],([t,a,i])=>{var r;(r=this.image)!=null&&r.loaded&&(this.image.effect=`contrast(${10*(a+10)}%) brightness(${10*(t+10)}%)`,this.sharpenImage(this.image,i))},q))},this._createPanConstraint=()=>{const{image:t,imageRenderer:a}=this,i=r=>{if(!(t&&a&&r.targetGeometry&&t.serviceRasterInfo))return r;const{extent:o}=t.serviceRasterInfo,{constraints:s,rotation:n,width:l,height:h}=a,{extent:m}=Pt(se.fromExtent(o),n),{width:d,height:p}=m,g=r.targetGeometry.clone(),f=s.scaleToZoom(r.scale),y=1/2**f,w=l/h;let v=y*d,b=y*p;f&&(d/l>p/h?b=v/w:v=b*w);const C=m.clone();return C.xmin+=v/2,C.xmax-=v/2,C.ymin+=b/2,C.ymax-=b/2,r.targetGeometry=$o(C,g).coordinate,this.state="image-loaded",r};return{constrain:i,applyPanConstraint:i}},this._createResizeHandles=t=>{t.removeHandles("resize"),t.addHandles(O(()=>{if(!this.imageRenderer.ready)return;const{extent:a}=t.serviceRasterInfo,{width:i,height:r,rotation:o}=this.imageRenderer,{extent:s}=Pt(se.fromExtent(a),o),{width:n,height:l}=s;return Math.max(n/i,l/r)},a=>{if(!this.imageRenderer||a==null)return;const{constraints:i,scale:r,spatialReference:o}=this.imageRenderer,s=i.minScale,n=Fo(o),l=.25*n,h=n*a;let m=h;const d=[];for(;m>l;)d.push(m),m/=2;d.push(m);const{lods:p}=Qa.create({scales:d});if(i.set({minScale:h,lods:p}),this._imageChanged)return this.imageRenderer.scale=h,void(this._imageChanged=!1);this.imageRenderer.scale=Math.abs(r-s)<=1e-6?h:r},q),"resize")},this._loadImageInternal=(t,a={})=>{this.state="image-loading",this.clearImage(),this.error=null,this._imageChanged=!0;const i=typeof t=="string",r=i?void 0:t.datasetFormat,o=i?t:t.url,{customParameters:s,options:n}=a;return this._image=new zr({ioConfig:{skipExtensions:["aux.xml","jgw"],skipMapInfo:!0,datasetFormat:r},url:o,customParameters:s}),this._image.when(async l=>{this._updatePanConstraint(),this._createResizeHandles(l),this._map.add(l),this.state="image-loaded"},l=>{ne(l)?this.state="image-load-aborted":(this.state="image-load-error",this.error=l,D.getLogger(this).error(`error occurred while loading image ${i?t:JSON.stringify(t)}`,l),this.imageSource=null)}),this._image.load(n)},this._loadWithController=()=>{this._cancelLoadWithController(),this._loadController=new AbortController,this.loadImage(this._loadController)},this._updatePanConstraint=()=>{this._panConstraint&&this.imageRenderer.constraints.customConstraints.remove(this._panConstraint),this._panConstraint=this._createPanConstraint(),this.imageRenderer.constraints.customConstraints.add(this._panConstraint)},this.addGraphic=(t,a)=>{this._overlays.graphics.add(t,a)},this.addManyGraphics=t=>{this._overlays.addMany(t)},this.clearGraphics=()=>{this._overlays.graphics.removeAll()},this.clearImage=()=>{this.image&&(this._map.layers.remove(this.image),this._image=ie(this._image))},this.loadImage=t=>{const{customParameters:a,imageSource:i}=this;return i?this._loadImageInternal(i,{customParameters:a,options:t}):mt(this.declaredClass,new Q(di("image-viewer"),pi("ImageViewerViewModel","imageSource")))},this.removeGraphic=t=>{this._overlays.remove(t)},this.removeManyGraphics=t=>{this._overlays.removeMany(t)},this._imageRenderer=new ui({constraints:{snapToZoom:!0,rotationEnabled:!1},map:this._map,popupEnabled:!1,spatialReference:Z.WebMercator,ui:{components:["zoom"]}})}destroy(){this._imageRenderer.destroy()}initialize(){this.state="initialized",this.addHandles([O(()=>this.imageSource,e=>{e&&this.autoLoad&&this._loadWithController()},q),O(()=>{var e;return(e=this.image)==null?void 0:e.loaded},()=>{this._createImageHandles()}),O(()=>this.imageRotation,()=>{this._rotateImage()}),O(()=>this.imageRenderer.map,(e,t)=>{t==null||t.layers.remove(this._overlays),e==null||e.layers.add(this._overlays)},Ze),O(()=>this.imageRenderer.map.allLayers.length,e=>{e&&this.imageRenderer.map.layers.reorder(this._overlays,e-1)},q),O(()=>this.clickAction,e=>{this.removeHandles(Ga.click),e!=="none"&&this.addHandles(this.imageRenderer.on("click",t=>{var a,i;if((a=this.image)!=null&&a.loaded&&this.imageRenderer.ready)switch(e){case"emit":t.stopPropagation(),this.emit("click",t);break;case"hittest":t.stopPropagation(),t.async(async()=>{const r=await this.imageRenderer.hitTest(t.screenPoint,{include:this._overlays});this.emit("hittest-response",r)});break;case"pixel-location":{if(t.stopPropagation(),!((i=this.image)!=null&&i.serviceRasterInfo)||!t.mapPoint)return void this.emit("pixel-location",null);const{extent:r,pixelSize:o}=this.image.serviceRasterInfo,s=(t.mapPoint.x-r.xmin)*o.x,n=(r.ymax-t.mapPoint.y)*o.y,l=new V({x:s,y:n,spatialReference:r.spatialReference});this.emit("pixel-location",l);break}}}))},q)])}get brightness(){return this._get("brightness")??0}set brightness(e){this._set("brightness",Te(e,-10,10))}get contrast(){return this._get("contrast")??0}set contrast(e){this._set("contrast",Te(e,-10,10))}get image(){return this._image}get imagePointsInView(){var m,d,p;const{extent:e,ready:t}=this.imageRenderer,a=this.imageRotation,i=(m=this.image)==null?void 0:m.fullExtent,r=(d=this.image)==null?void 0:d.serviceRasterInfo,o=((p=this._imageRenderer.allLayerViews.find(({layer:g})=>g===this.image))==null?void 0:p.attached)===!0;if(!(t&&e&&i&&r&&o))return null;const s=Pt(se.fromExtent(e),a),n=se.fromExtent(i),l=xo(s,n),{rings:h}=l;return h.flat().map(([g,f])=>({x:(g-r.extent.xmin)*r.pixelSize.x,y:(r.extent.ymax-f)*r.pixelSize.y}))}get imageSize(){const{image:e}=this;if(!(e!=null&&e.raster))return null;const{width:t,height:a}=e.raster.rasterInfo;return[t,a]}get imageRenderer(){return this._imageRenderer}get imageView(){return this.imageRenderer.allLayerViews.find(e=>e.layer===this.image)}get sharpness(){return this._get("sharpness")??0}set sharpness(e){this._set("sharpness",Te(e,0,1))}_rotateImage(){this.imageRenderer.constraints.rotationEnabled=!0,this.imageRenderer.rotation=this.imageRotation,this.imageRenderer.constraints.rotationEnabled=!1}sharpenImage(e,t){if(!t)return void(e.rasterFunction=null);const a=[0,-1*t,0,-1*t,4*t+1,-1*t,0,-1*t,0],i=new Ua({functionName:"Convolution",functionArguments:{type:Ca.userDefined,cols:3,rows:3,kernel:a,convolutionType:Ca.userDefined}});e.rasterFunction=i}};c([u()],W.prototype,"_image",void 0),c([u()],W.prototype,"_imageRenderer",void 0),c([u()],W.prototype,"_loadController",void 0),c([u()],W.prototype,"_overlays",void 0),c([u()],W.prototype,"_map",void 0),c([u({type:Boolean})],W.prototype,"autoLoad",void 0),c([u({type:Number})],W.prototype,"brightness",null),c([u()],W.prototype,"clickAction",void 0),c([u({type:Number})],W.prototype,"contrast",null),c([u({type:Object})],W.prototype,"customParameters",void 0),c([u({type:Q})],W.prototype,"error",void 0),c([u({readOnly:!0})],W.prototype,"image",null),c([u({readOnly:!0})],W.prototype,"imagePointsInView",null),c([u({readOnly:!0})],W.prototype,"imageSize",null),c([u({cast:Go})],W.prototype,"imageSource",void 0),c([u({readOnly:!0})],W.prototype,"imageRenderer",null),c([u({type:Number})],W.prototype,"imageRotation",void 0),c([u()],W.prototype,"imageView",null),c([u({type:Number})],W.prototype,"sharpness",null),c([u()],W.prototype,"state",void 0),W=c([me("esri.widgets.OrientedImageryViewer.components.ImageViewerViewModel")],W);const rr=W,Qn="esri-image-viewer";let K=class extends vt{constructor(){super(...arguments),this.viewModel=new rr,this._afterContainerCreate=e=>{this.imageRenderer.container=e},this.addGraphic=(e,t)=>{this.viewModel.addGraphic(e,t)},this.addManyGraphics=e=>{this.viewModel.addManyGraphics(e)},this.clearGraphics=()=>{this.viewModel.clearGraphics()},this.clearImage=()=>{this.viewModel.clearImage()},this.loadImage=async e=>this.viewModel.loadImage(e),this.removeGraphic=e=>{this.viewModel.removeGraphic(e)},this.removeManyGraphics=e=>{this.viewModel.removeManyGraphics(e)}}get autoLoad(){return this.viewModel.autoLoad}set autoLoad(e){this.viewModel.autoLoad=e}get brightness(){return this.viewModel.brightness}set brightness(e){this.viewModel.brightness=e}get clickAction(){return this.viewModel.clickAction}set clickAction(e){this.viewModel.clickAction=e}get contrast(){return this.viewModel.contrast}set contrast(e){this.viewModel.contrast=e}get customParameters(){return this.viewModel.customParameters}set customParameters(e){this.viewModel.customParameters=e}get error(){return this.viewModel.error}get imageSize(){var t;const e=(t=this.viewModel.image)==null?void 0:t.serviceRasterInfo;return e?[e.width,e.height]:[0,0]}get imagePointsInView(){return this.viewModel.imagePointsInView}get imageRenderer(){return this.viewModel.imageRenderer}get imageRotation(){return this.viewModel.imageRotation}set imageRotation(e){this.viewModel.imageRotation=e}get imageSource(){return this.viewModel.imageSource}set imageSource(e){this.viewModel.imageSource=e}get sharpness(){return this.viewModel.sharpness}set sharpness(e){this.viewModel.sharpness=e}get state(){return this.viewModel.state}render(){return M("div",{afterCreate:this._afterContainerCreate,bind:this,class:this.classes(ct.widget,Qn)})}};c([u({type:Boolean})],K.prototype,"autoLoad",null),c([u({type:Number}),u()],K.prototype,"brightness",null),c([u()],K.prototype,"clickAction",null),c([u({type:Number})],K.prototype,"contrast",null),c([u({type:Object})],K.prototype,"customParameters",null),c([u({readOnly:!0})],K.prototype,"error",null),c([u()],K.prototype,"imageSize",null),c([u({readOnly:!0})],K.prototype,"imagePointsInView",null),c([u({readOnly:!0,type:ui})],K.prototype,"imageRenderer",null),c([u()],K.prototype,"imageRotation",null),c([u()],K.prototype,"imageSource",null),c([ht(["click","hittest-response","pixel-location"]),u({type:rr})],K.prototype,"viewModel",void 0),c([u({type:Number})],K.prototype,"sharpness",null),c([u({readOnly:!0})],K.prototype,"state",null),K=c([me("esri.widgets.OrientedImageryViewer.components.ImageViewer")],K);const Jn=K,ve={click:"view-click",imageClick:"image-click",interactionHandles:"interaction-handles"},Yn=new Set(["JPG","JPEG"]),Xn=/\.(\w+)$/,Re=()=>new Q("orientedimageryviewer:sketch-not-initialized","Sketch property is not initialized, call loadSketch first");let _=class extends ea.EventedMixin(Yr){constructor(e){super(e),this.additionalFeatures=new B,this.additionalCameraLocations=new B,this.additionalFootprints=new B,this.areaMeasurementResult=0,this.areaMeasurementAccuracy=0,this.bestFeatureAngle=0,this.bestFeatureCurrentFootprint=null,this.bestFeatureFootprint=null,this.collectionId=null,this.conversionProps=null,this.coverageFrustums=new B,this.coveragePolygons=new B,this.currentBestFeature=null,this.currentBestFeatureLocation=null,this.currentCoverageVisible=!0,this.determineWorkflowForFeature=async(t,a,i)=>{const{currentBestFeature:r,selectedPoint:o,view:s}=this;if(s==null||s.closePopup(),r&&o){this._initialCurrentCoverageUpdate=!0,this._updateGroundElevation=!0;try{await this._updatePointsAndPolygons(i),await this._loadImage(i)}catch(n){ne(n)||(this.loadImageError(n),D.getLogger(this).error("#loadIImage()","error occured while loading image",n))}}},this.disabled=!1,this.displayMessage={key:"onLoadMessage",type:"info"},this.displayNewMeasurementButton=!0,this.distanceMeasurementResult=0,this.distanceAccuracyArray=[],this.dataCaptureLayer=null,this.features=new B,this.groundCoordinates=null,this.heightMeasurementPixels=[],this.heightGraphic=null,this.heightMeasurementResult=0,this.heightMeasurementAccuracy=0,this.measurementAngle=null,this.tempDistance=null,this.imageGeometryField=null,this.imageLocationToolState=!1,this.isAdditionalCoverageVisible=!1,this.isAdditionalPointSourcesVisible=!1,this.layer=null,this.localPort=null,this.mapImageConversionToolState=!1,this.measureType=null,this.measurementGraphic=null,this.navigatorCurrentBestFeature=null,this.oiObjectIdField=null,this.overlayedCameraLocations=new B,this.overlayedMapFeatures=new Ba,this.pixelCoordinates=null,this.pointSources=new B,this.previousFeatureAngle=0,this.selectedPoint=null,this.shouldShowSelectedImage=!1,this.sketch=null,this.draw=null,this.sketchAdapter=null,this.updateFootprint=async(t,a)=>{var i;this.state==="image-loaded"&&await((i=this._adapter)==null?void 0:i.updateFootprint(t,a))},this.updateFootprintPanorama=async(t,a)=>{var i;await((i=this._adapter)==null?void 0:i.updateFootprintPanorama(t,a))},this._adapter=null,this._highlightedFeatureHandle=null,this._imageViewer=new Jn,this._initialCurrentCoverageUpdate=!0,this._locationPointOnImage=null,this._overlays=new Be({listMode:"hide",internal:!0,elevationInfo:{mode:"absolute-height"}}),this._panoramicViewer=new Mn,this._previousCursor=null,this._referencePointOnGround=null,this._referencePointOnImage=null,this._sectorData=null,this._updatingHandles=new Xr,this._clickTask=null,this._crossSymbol=null,this.footprintExtent=null,this._featureChangedTask=null,this._openPopupTask=null,this._suitabilities=null,this._transformController=new AbortController,this._updateFootprintTask=null,this._updateGroundElevation=!1,this.hideImageGeometry=t=>{},this.highlight=t=>{var i;if(!this._overlaysView)return;this.removeHighlight();const a=this.additionalFootprints.find(({attributes:{imageID:r}})=>r===Number(t));this._highlightedFeatureHandle=a?(i=this._overlaysView)==null?void 0:i.highlight(a):null},this.loadDataCaptureAdapter=async t=>{await this.loadSketch(t);const a=z(()=>import("./DataCaptureAdapter-DYxkt-AJ.js"),__vite__mapDeps([120,1,9,10,11,94,121,5,6,122,123,7,8,2,12,3,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,38,124,125,58,59,126,46,47,48,49,50,112,127,128,129,130,131,34,35,67,132,61,62,63,64,65,66,68,69,71,72,70,73,0,133,134,135,136,137,138,33,53,54,55,139,140,98,99,100,102,141,36,37,39,40,41,42,43,44,142,143,144,145,146,147,148,149,150,151,152,153,154,60,89,90,155,156,86,87,88,157,158,77,78,159,103,160,161,104,105,106,108,109,110,111,162,163,164,165,166,167,168,118,119,169,170,171,172,173,174,175,176,91,92,177,115,116,117,178,179,180,51,52,56,57,74,75,76,79,80,81,82,83,84,85,181,113,107,182,183,184,185,186,187,188,189,4,45,93,95,96,97,101,114,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435]),import.meta.url),{default:i}=await a;return L(t),this.sketchAdapter=new i({viewModel:this}),this.sketchAdapter},this.loadImageFromSource=async(t,a)=>this._updatingHandles.addPromise(this._loadImageFromSourceInternal(t,a)),this.loadImageViewer=t=>{this._imageViewer.container=t},this.loadPanoramicViewer=t=>{this._panoramicViewer.container=t},this.removeHighlight=()=>{var t;return(t=this._highlightedFeatureHandle)==null?void 0:t.remove()},this.revealImageGeometry=t=>{},this.toggleImageAttributes=()=>{Fe(this._openPopupTask),this._openPopupTask=ye(async t=>{const{currentBestFeature:a,popupEnabled:i,layer:r,view:o}=this;if(o==null||o.closePopup(),!(o&&a&&i&&r))return;const{attributes:s,geometry:n}=a,l=new H({geometry:n,attributes:s.toJSON(),layer:r});L(t),await o.openPopup({features:[l],location:s.location.clone()})})},this._createViewClickHandle=()=>{if(this.removeHandles(ve.click),this.state==="disabled"||this.view==null)return;const t=this.mapImageConversionToolState&&this.state==="image-loaded"?this._mapImageConversionToolViewClickHandler:this._viewClickHandler;this.addHandles(this.view.on("click",t,po.WIDGET),ve.click)},this._createImageClickHandle=()=>{this.removeHandles(ve.imageClick);const{mapImageConversionToolState:t,mode:a,activeViewer:i,currentBestFeature:r,footprintExtent:o}=this,s=i==null?void 0:i.imageSize;if(!(t&&a!=="none"&&s&&o&&r))return;i.clickAction="pixel-location";let n=null;const l=ya(()=>i,"pixel-location",h=>{this.plotReferencePointOnImage(h),n==null||n.abort(),n=ye(async m=>{if(!h)return;const d=await this.getMapPoint(h,{feature:r,imageSize:s,mode:a}).then(p=>{var f;const g=(f=this.view)==null?void 0:f.spatialReference;return Me(!g,p.spatialReference.equals(g))?p:re(p,g)});L(m),this.plotReferencePointOnGround(d)})});this.addHandles(l,ve.imageClick)},this._createImageLocationHandle=()=>{this.removeHandles(ve.imageClick);const{imageLocationToolState:t,mode:a,activeViewer:i,currentBestFeature:r,footprintExtent:o}=this,s=i==null?void 0:i.imageSize;if(!(t&&a!=="none"&&s&&o&&r))return;i.clickAction="pixel-location";let n=null;const l=ya(()=>i,"pixel-location",h=>{this.pixelCoordinates=h,this.plotLocationPointOnImage(h),n==null||n.abort(),n=ye(async m=>{var g;if(!h)return;let d=await this.getMapPoint(h,{feature:r,imageSize:s,mode:a});L(m);const p=(g=this.view)==null?void 0:g.spatialReference;p&&!d.spatialReference.equals(p)&&(d=await re(d,p),L(m)),this.groundCoordinates=d})});this.addHandles(l,ve.imageClick)},this._loadImage=async t=>{const{currentBestFeature:a,layer:i,mode:r}=this;if(this.clearGraphics(),!i||!a||r==="none")return;const{attributes:o}=a,{imagePath:s,imageRotation:n,cameraHeading:l,cameraRoll:h,cameraPitch:m,objectId:d,cameraOrientation:p,location:g}=o,f=(h??0)+(n??0),y=g.spatialReference.isWGS84&&(p==null?void 0:p.type)!==4?Ht(g):new V(g);let w=s;if(nt(s))try{w=await Pi(i,d,t)}catch(v){return ne(v)?void 0:Ho(v)?(D.getLogger(this).error(v),void this.setMessage("noAttachment","error",`${i.objectIdField}: ${d}`)):(D.getLogger(this).error(v,{[i.objectIdField]:d,layer:i}),void this.setMessage("imageLoadError","error",`query-attachments-failed:${i.objectIdField} ${d}`))}try{await this.loadImageFromSource(w,{imageRotation:f,options:t,pitch:m,yaw:l,mode:r,cameraLocation:y}),L(t),await this.transformAndPlotSelectedLocation(t)}catch(v){ne(v)||this.loadImageError(v)}},this._loadImageFromSourceInternal=async(t,a)=>{var d;const{mode:i,imageRotation:r,options:o}=a,s=typeof t=="string",n=s?t:t.url,{pathname:l,searchParams:h}=new URL(n);let m=s?(d=l.match(Xn))==null?void 0:d[1]:t.datasetFormat;if(!m)try{m=await gi(n,{...a.options})}catch(p){ne(p)||D.getLogger(this).error("#getContentType()",p)}switch(m??(m="UNKNOWN FORMAT"),i){case"default":this._imageViewer.imageSource={datasetFormat:m.toUpperCase(),url:n.split("?")[0]},this._imageViewer.customParameters=Object.fromEntries(h),this._imageViewer.imageRotation=r??0,await this._imageViewer.loadImage(o);break;case"panoramic":if(Yn.has(m.toUpperCase())){const{selectedPoint:p}=this,{pitch:g,yaw:f,cameraLocation:y,viewAngle:w}=a;this._panoramicViewer.imageSource=n;let v=f??0;typeof w=="number"?v=w-v:y&&p&&(v=await rs(y,p)-v),this._panoramicViewer.pitch=g??0,this._panoramicViewer.yaw=v,await this._panoramicViewer.loadImage(o)}else this.setMessage("unsupportedPanoramicImageryError","error",void 0,{datasetFormat:m});break}},this._loadViewAdapter=async t=>{const{view:a}=this;if(a)switch(a.type){case"2d":{const{default:i}=await z(()=>import("./MapViewAdapter-B6r9hUb-.js"),__vite__mapDeps([436,7,1,8,9,10,11,2,12,5,6,3,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,122,123,32,38,124,125,58,59,126,46,47,48,49,50,112,127,128,129,130,131,34,35,67,132,61,62,63,64,65,66,68,69,71,72,70,73,0,133,134,135,136,137,138,33,53,54,55,139,140,98,99,100,102,141,36,37,39,40,41,42,43,44,142,143,144,145,146,147,148,149,150,151,152,153,154,60,89,90,155,156,86,87,88,157,158,77,78,159,103,160,161,104,105,106,108,109,110,111,162,163,164,165,166,167,168,118,119,169,94,170,171,172,173,174,175,176,91,92,177,115,116,117,178,179,180,51,52,56,57,74,75,76,79,80,81,82,83,84,85,181,113,107,182,183,184,185,186,187,188,189,4,45,93,95,96,97,101,114,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435]),import.meta.url);L(t),this._adapter=new i(this);break}case"3d":{const{default:i}=await z(()=>import("./SceneViewAdapter-CwBosDzc.js"),__vite__mapDeps([437,7,1,8,9,10,11,2,12,5,6,3,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,201,202,42,43,203,170,204,173,77,205,206,207,208,209,171,210,211,212,213,214,215,216,78,217,218,219,98,99,100,220,172,221,222,174,223,194,224,225,138,122,123,32,38,124,125,58,59,126,46,47,48,49,50,112,127,128,129,130,131,34,35,67,132,61,62,63,64,65,66,68,69,71,72,70,73,0,133,134,135,136,137,33,53,54,55,139,140,102,141,36,37,39,40,41,44,142,143,144,145,146,147,148,149,150,151,152,153,154,60,89,90,155,156,86,87,88,157,158,159,103,160,161,104,105,106,108,109,110,111,162,163,164,165,166,167,168,118,119,169,94,175,176,91,92,177,115,116,117,178,179,180,51,52,56,57,74,75,76,79,80,81,82,83,84,85,181,113,107,182,183,184,185,186,187,188,189,4,45,93,95,96,97,101,114,190,191,192,193,195,196,197,198,199,200,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435]),import.meta.url);L(t),this._adapter=new i(this);break}}else this._adapter=null},this._mapImageConversionToolViewClickHandler=t=>{t.stopPropagation(),t.preventDefault(),t.mapPoint&&this.plotMapPoint(t.mapPoint)},this._viewClickHandler=t=>{var a;(a=this._clickTask)==null||a.abort(),this._clickTask=ye(async i=>{const{pointerType:r,button:o,mapPoint:s}=t;if((r!=="mouse"||o===0)&&s)return t.stopPropagation(),t.preventDefault(),this._updatingHandles.addPromise(this.loadBestImage(s,{signal:i}))})},this.plotSelectedPointOnImage=async(t,a)=>{if(await Ue(a),!t)return;const i=new V({...ze.isSerializable(t)?t.toJSON():t});if(this.mode==="default")i.x-=.5,i.y=.5-i.y,i.spatialReference=this._imageViewer.imageRenderer.spatialReference.clone(),this._crossSymbol=new H({geometry:i,symbol:Va}),this._imageViewer.addGraphic(this._crossSymbol,0);else if(this.mode==="panoramic"){const{imageSize:r}=this._panoramicViewer;if(!r)return;const[o,s]=r,{heading:n,pitch:l}=Pe(t,o,s),h=xe(n,l);this._crossSymbol=new H({geometry:new V(h,Z.WebMercator),symbol:In}),this._panoramicViewer.addGraphic(this._crossSymbol,0)}},this.handleSectorClick=this.handleSectorClick.bind(this),this.searchBestImage=this.searchBestImage.bind(this),this.transformAndPlotReferencePointOnImage=this.transformAndPlotReferencePointOnImage.bind(this),this.updateSuitabilities=this.updateSuitabilities.bind(this),this.selectBestFeature=this.selectBestFeature.bind(this)}initialize(){this.addHandles([O(()=>this.view,()=>{this.load()},q),O(()=>{var e;return(e=this.view)==null?void 0:e.map},(e,t)=>{t==null||t.layers.remove(this._overlays),e==null||e.layers.add(this._overlays)},Ze),O(()=>{var e,t,a;return(a=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.allLayers)==null?void 0:a.length},e=>{var t,a;e&&((a=(t=this.view)==null?void 0:t.map)==null||a.layers.reorder(this._overlays,e-1))},Ze),O(()=>[this.state,this.mapImageConversionToolState,this.view],()=>{this._createViewClickHandle(),this._createImageClickHandle()},q),O(()=>[this.state,this.imageLocationToolState,this.view],()=>{if(this._createImageLocationHandle(),!this.imageLocationToolState)return this.clearPreviousGroundLocation(),void this._resetCursor();this._setMeasurementCursor()},q),O(()=>this.measureType,()=>{this.clearPreviousMeasurements()},q),O(()=>this.bestFeatureAngle,(e,t)=>{this.previousFeatureAngle=t??0},q),O(()=>this.currentBestFeature,async(e,t)=>{Fe(this._featureChangedTask),this._featureChangedTask=ye(async a=>this.determineWorkflowForFeature.apply(this,[e,t,{signal:a}])),await this._featureChangedTask.promise},{sync:!0}),O(()=>this.mode,e=>{switch(this.removeHandles(ve.interactionHandles),e){case"default":this.addHandles(O(()=>{const{state:t}=this;return t==="image-loaded"?this._imageViewer.imagePointsInView:null},t=>{t&&(Fe(this._updateFootprintTask),this._updateFootprintTask=ye(async a=>{await this.updateFootprint(t,{signal:a})}))},{...q,equals:(t,a)=>pa(t,a,ga)}),ve.interactionHandles);break;case"panoramic":this.addHandles(O(()=>{const{currentBestFeature:t,state:a}=this,{imageSize:i,vfov:r,hfov:o,pitch:s,yaw:n}=this._panoramicViewer;return t&&i&&!a.includes("loading")?[r,o,n,s]:null},t=>{if(!t||this.state.includes("loading"))return;const[a,i,r,o]=t;Fe(this._updateFootprintTask),this._updateFootprintTask=ye(async s=>{await this.updateFootprintPanorama({verticalFieldOfView:a,horizontalFieldOfView:i,yaw:r,pitch:o},{signal:s})})},{...q,equals:(t,a)=>pa(t,a,ga)}),ve.interactionHandles)}},q),O(()=>[this.brightness,this.contrast,this.sharpness],()=>{const{_imageViewer:e,brightness:t,contrast:a,mode:i,sharpness:r}=this;i==="default"&&(e.brightness=t,e.contrast=a,e.sharpness=r)},q),O(()=>{var e;return(e=this.activeViewer)==null?void 0:e.imageRenderer},()=>{var e;this.sketch&&(this.sketch.view=(e=this.activeViewer)==null?void 0:e.imageRenderer)})]),this.when().finally(()=>{this.notifyChange("state")})}destroy(){var e,t;this._updateFootprintTask=Fe(this._updateFootprintTask),this._clickTask=Fe(this._clickTask),this.coverageFrustums.destroy(),this.coveragePolygons.destroy(),this.pointSources.destroy(),this.additionalFootprints.destroy(),this.additionalCameraLocations.destroy(),this.bestFeatureFootprint=ie(this.bestFeatureFootprint),this.bestFeatureCurrentFootprint=ie(this.bestFeatureCurrentFootprint),this._crossSymbol=ie(this._crossSymbol),this._referencePointOnGround=ie(this._referencePointOnGround),this._referencePointOnImage=ie(this._referencePointOnImage),this._locationPointOnImage=ie(this._locationPointOnImage),this._overlays&&((t=(e=this.view)==null?void 0:e.map)==null||t.remove(this._overlays)),this._overlays.destroy(),this._imageViewer.destroy(),this._panoramicViewer.destroy()}get activeLayer(){return Ae(D.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer}set activeLayer(e){Ae(D.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer=e}get activeViewer(){const{_imageViewer:e,_panoramicViewer:t,mode:a}=this;switch(a){case"default":return e;case"panoramic":return t;default:return null}}get accuracyParametersMissing(){var e,t;return((t=(e=this.layer)==null?void 0:e.orientationAccuracy)==null?void 0:t.every(a=>a===0))??!0}get brightness(){return this._get("brightness")??0}set brightness(e){this._set("brightness",Te(e,-10,10))}get contrast(){return this._get("contrast")??0}set contrast(e){this._set("contrast",Te(e,-10,10))}get featureCount(){var e;return((e=this.features)==null?void 0:e.length)??0}get imageGalleryEnabled(){var a;const{currentBestFeature:e}=this;if(!e)return!1;const t=(a=e.attributes.imagePath)==null?void 0:a.trim();return xa(t)||nt(t)}get imageLoaded(){return Ae(D.getLogger(this),"imageLoaded",{replacement:'Use OrientedImageryViewer.state === "image-loaded"',version:"4.29",warnOnce:!0}),this.state==="image-loaded"}get invalidCameraHeading(){var e,t;return((t=(e=this.currentBestFeature)==null?void 0:e.attributes)==null?void 0:t.cameraHeading)===Pa}get imagePointsInView(){const{mode:e,_imageViewer:t}=this;return e==="default"?t.imagePointsInView:null}get layerView(){const{layer:e,view:t}=this;if(e&&t)return t.allLayerViews.find(Do(e))}get layerFloorFilterClause(){const{layerView:e}=this;return e?ho(e):null}get mode(){var i;const e=(i=this.currentBestFeature)==null?void 0:i.attributes;if(!e)return"none";const{horizontalFieldOfView:t,isSpherical:a}=e;return t===360||a?"panoramic":"default"}get popupEnabled(){var e;return((e=this.layer)==null?void 0:e.popupEnabled)===!0}get referencePoint(){var e;return(e=this._referencePointOnGround)==null?void 0:e.geometry}get sectorData(){const{_sectorData:e}=this;return e?xt.map(t=>e[t]):null}get sharpness(){return this._get("sharpness")??0}set sharpness(e){this._set("sharpness",Te(e,0,1))}get sketchGraphicsLayer(){var e;return(e=this.sketch)==null?void 0:e.layer}get state(){var r;const{mode:e,disabled:t,_updatingHandles:{updating:a},_featureChangedTask:i}=this;if(t)return"disabled";if(!this.isFulfilled()||a||(i==null?void 0:i.finished)===!1)return"loading";if(this.isRejected())return"error";if(((r=this.displayMessage)==null?void 0:r.type)==="error")return"image-load-error";switch(e){case"default":return this._imageViewer.state;case"panoramic":return this._panoramicViewer.state}return"ready"}get thumbnails(){const{features:e}=this;return e?new B(e.map(({attributes:{imagePath:t,objectId:a,cameraRoll:i,imageRotation:r}})=>{const o=t==null?void 0:t.trim();return xa(o)||nt(o)?{url:o,objectId:a,rotation:(i??0)+(r??0)}:null}).filter(It)):null}set view(e){this._set("view",e)}get _sketchGraphicsLayer(){const{mode:e}=this;switch(e){case"panoramic":return new Be({elevationInfo:{mode:"absolute-height"}});case"default":return new Be;case"none":return}}get _overlaysView(){var e;return(e=this.view)==null?void 0:e.layerViews.find(({layer:t})=>t===this._overlays)}async computeHeight(e,t,a=!0){const{currentBestFeature:i,activeViewer:r,layer:o,footprintExtent:s}=this,n=r==null?void 0:r.imageSize,l=i==null?void 0:i.attributes,h=o==null?void 0:o.orientationAccuracy;if(!l||!n||!e||e.length<2||!h)return;const m=t==="panoramic"?await this.getMeasurementPropertiesPanoramic():rt(l,n[0],n[1]),d=e.at(0),p=e.at(-1);if(!(m&&d&&p&&h&&s))return;const g=[p,d],f=Ce(g,!1),y=t==="panoramic"?await ir(g,m,h,i,!0,!1):await ar(g,m,h,!0,a);if(!y)return;const w=t==="panoramic"?await jn(h,f,m,y,i,!0):await Bn(h,f,m,y,!0);return w?{value:y,accuracy:w}:{value:y}}async calculateAreaMeasurement(e,t,a){var r;if(e.length<3||!this.currentBestFeature||!((r=this.activeViewer)!=null&&r.imageSize)||t==="none")return null;const i=t==="default"?await this.getMeasurementProperties():await this.getMeasurementPropertiesPanoramic();return L(a),i?t==="default"?await kt(e,i,!0):await Et(e,i,!0,a):null}async calculateDistanceMeasurement(e,t,a){const{currentBestFeature:i,activeViewer:r}=this;if(e.length<2||!i||!(r!=null&&r.imageSize)||t==="none")return null;const o=t==="default"?await this.getMeasurementProperties():await this.getMeasurementPropertiesPanoramic();return L(a),o?t==="default"?await zt([e.at(0),e.at(-1)],o,!0):await Gt([e.at(0),e.at(-1)],o,!0):null}async calculateAccuracy(e,t,a){const{layer:i,currentBestFeature:r,activeViewer:o}=this,s=i==null?void 0:i.orientationAccuracy,n=(s==null?void 0:s.every(w=>w===0))||!(s!=null&&s.length);if(t==="area"&&e.length<3||t==="distance"&&e.length<2||!r||!(o!=null&&o.imageSize)||n)return null;const l=await this.getMeasurementProperties();if(L(a),!l)return null;const h=t==="area"?await kt(e,l,!0):await zt([e.at(0),e.at(-1)],l,!0);L(a);const{updateElevationProps:m,...d}=l,p=er(d,s);if(!(p!=null&&p.length))return null;const g=p.map(w=>({...w,updateElevationProps:m})).map(async w=>{const v=t==="area"?await kt(e,w,!0):await zt([e.at(0),e.at(-1)],w,!0);if(L(a),v&&h){if(t==="area"){const b=typeof v!="number"?v.area:null;return b?Math.abs(b-h.area):null}return Math.abs(v-h)}return null}),f=await Promise.all(g);L(a);const y=f.filter(w=>w!==null);return y.length===0?null:qt(y)}async calculateAccuracyPanoramic(e,t,a){const{layer:i,currentBestFeature:r,activeViewer:o,mode:s}=this,n=i==null?void 0:i.orientationAccuracy,l=(n==null?void 0:n.every(v=>v===0))||!(n!=null&&n.length);if(t==="area"&&e.length<3||t==="distance"&&e.length<2||!r||!(o!=null&&o.imageSize)||l||s!=="panoramic")return null;const h=await this.getMeasurementPropertiesPanoramic();if(L(a),!h)return null;const m=t==="area"?await Et(e,h,!0):await Gt([e.at(0),e.at(-1)],h,!0);L(a);const{updateElevationProps:d,...p}=h,g=tr(p,n);if(!(g!=null&&g.length))return null;const f=g.map(v=>({...v,updateElevationProps:d})).map(async v=>{const b=t==="area"?await Et(e,v,!0):await Gt([e.at(0),e.at(-1)],v,!0);if(L(a),b&&m){if(t==="area"){const C=typeof b!="number"?b.area:null;return C?Math.abs(C-m.area):null}return Math.abs(b-m)}return null}),y=await Promise.all(f);L(a);const w=y.filter(v=>v!==null);return w.length===0?null:qt(w)}async calculateHeightMeasurementInfo(e,t,a){const{currentBestFeature:i,activeViewer:r}=this,o=r==null?void 0:r.imageSize;if(!i||!r||!(o!=null&&o.length)||t==="none")return;const{attributes:s}=i,[n]=Ce([e],t!=="panoramic"),l=t==="panoramic"?await this.getMeasurementPropertiesPanoramic():rt(s,o[0],o[1]);if(t==="panoramic"){if(!l)return;const p=await Zn(n,l,i,a);if(!p)return;(p==null?void 0:p.heading)>180&&(p.heading-=360);const g=Nn(n,p),f=de([n.x,n.y],[p.x,p.y]);return!g||!f?void 0:{measurementAngle:g,tempDistance:f}}const h=await qn(n,l,a);if(!h)return;const m=ca(n,h),d=de([n.x,n.y],[h.x,h.y]);return m&&d?{measurementAngle:m,tempDistance:d}:void 0}clearPreviousMeasurements(){this.clearMeasurementGraphics(),this.resetMeasurementData(),this.stopMeasurement()}clearPreviousGroundLocation(){this.groundCoordinates=null,this.pixelCoordinates=null,this.clearLocationPointOnImage()}clearMeasurementGraphics(){var e,t;this.measurementGraphic&&((e=this.activeViewer)==null||e.removeGraphic(this.measurementGraphic),this.measurementGraphic=null),this.heightGraphic&&((t=this.activeViewer)==null||t.removeGraphic(this.heightGraphic),this.heightGraphic=null)}digitizeCancel(){var e;return(e=this.sketch)==null?void 0:e.cancel()}digitizeCanRedo(){var e;return((e=this.sketch)==null?void 0:e.canRedo())??!1}digitizeCanUndo(){var e;return((e=this.sketch)==null?void 0:e.canUndo())??!1}digitizeComplete(){var e;return(e=this.sketch)==null?void 0:e.complete()}async digitizeCreate(e,t){const{sketch:a,dataCaptureLayer:i}=this;if(!a)throw Re();Vn(i,e,a),await a.create(e,{...t,defaultZ:0})}async digitizeDelete(){if(!this.sketch)throw Re();return this.sketch.delete()}digitizeDuplicate(){if(!this.sketch)throw Re();return this.sketch.duplicate()}digitizePlace(e,t){if(!this.sketch)throw Re();return this.sketch.place(e,t)}digitizeRedo(){if(!this.sketch)throw Re();return this.sketch.redo()}digitizeUndo(){if(!this.sketch)throw Re();return this.sketch.undo()}digitizeUpdate(e,t){if(!this.sketch)throw Re();return this.sketch.update(e,t)}async displayHeightResults(){const{currentBestFeature:e,activeViewer:t,heightMeasurementPixels:a,mode:i}=this,r=t==null?void 0:t.imageSize;if(!(e==null?void 0:e.attributes)||!r)return;const s=await this.computeHeight(a,i);s!=null&&s.value&&(s!=null&&s.accuracy)&&(this.heightMeasurementResult=s.value,this.heightMeasurementAccuracy=s.accuracy)}filterByFootprints(e,t){const a=[],i=[],r=[];return e.forEach(o=>{const{layer:{coveragePercent:s},attributes:n}=o;let l;const h=fa(o.geometry.spatialReference);n.cameraHeight/=h,n.farDistance/=h,n.nearDistance/=h,Da(n.elevationSource)&&(n.elevationSource.constantElevation/=h);const{polygon:m,frustum:d}=Tt(n);if(l=m.clone(),n.isInspection&&(l=qs(n)),s&&(l=Zs(l,s)),Bs(l,t)){r.push(o);const{geometry:p,objectId:g,cameraHeight:f,cameraHeading:y}=n,w=p.clone();w.z=f,w.imageID=g,this.pointSources.push(w),y!==Pa&&(a.push(m),d&&i.push(d))}}),{features:r,polygons:a,frustums:i}}getMeasurementProperties(){const{currentBestFeature:e,activeViewer:t}=this;if(!e||!(t!=null&&t.imageSize))return;const{elevationSample:a,attributes:i}=e,{elevationSource:r,cameraHeight:o}=i,s=rt(i,t.imageSize[0],t.imageSize[1]);let n=s.cameraLocation;return(n.spatialReference.isGeographic?re(n,Z.WebMercator):Promise.resolve(n)).then(l=>(n=l,He((n.z??0)-o,{elevationSample:a,elevationSource:r,extent:this.footprintExtent}))).then(l=>("elevationSample"in l&&We(l.elevationSample)&&(e.elevationSample=l.elevationSample),{...s,cameraLocation:n,updateElevationProps:l}))}getMeasurementPropertiesPanoramic(){const{currentBestFeature:e,activeViewer:t}=this;if(!e||!(t!=null&&t.imageSize))return;const{elevationSample:a,attributes:i}=e,{elevationSource:r,cameraHeight:o}=i,s=Sa(i,t.imageSize[0],t.imageSize[1]);let n=s.cameraLocation;return(n.spatialReference.isGeographic?re(n,Z.WebMercator):Promise.resolve(n)).then(l=>(n=l,He((n.z??0)-o,{elevationSample:a,elevationSource:r,extent:this.footprintExtent}))).then(l=>("elevationSample"in l&&We(l.elevationSample)&&(e.elevationSample=l.elevationSample),{...s,cameraLocation:n,updateElevationProps:l}))}async deleteDataCaptureFeatures(e){const{dataCaptureLayer:t}=this;if(!t)throw new Q("Data capture layer is not available");return t.queryFeatures({objectIds:e}).then(({features:a})=>t.applyEdits({deleteFeatures:a}))}handleSectorClick(e){var a;if(isNaN(e))return;const t=(a=this._sectorData)==null?void 0:a[xt[e]];t!=null&&t.length&&this._updateCurrentBestFeature(t.at(0))}handleFeatureClick(e){var r;const{sector:t,featureIndexInSector:a}=e;if(isNaN(a))return;const i=(r=this._sectorData)==null?void 0:r[t];i!=null&&i.length&&this._updateCurrentBestFeature(i.at(a))}handleDrawCursorUpdateEvents(e){const{measurementAngle:t,tempDistance:a,heightMeasurementPixels:i,mode:r,activeViewer:o}=this,s=o==null?void 0:o.imageSize;if(!e.vertices||!s)return;const n=za(e.vertices.at(-1),r,s);if(i.length<1||!n||!a||!t||r==="none")return;const l=ha(i[0],n,t);if(!(l!=null&&l.length))return;this.heightMeasurementPixels.push(l),r==="panoramic"?this.createPolylineGraphicPano():this.createPolylineGraphic();const h=Wn(this.heightMeasurementPixels,a);h&&(this.heightMeasurementResult=h)}async handleDrawVertexAddEvents(e,t){var n;const{currentBestFeature:a,activeViewer:i,heightMeasurementPixels:r,mode:o}=this;if(!a||!i||!((n=e.vertices)!=null&&n.length)||o==="none")return;const s=i==null?void 0:i.imageSize;if(!r.length&&s){const l=za(e.vertices.at(-1),o,s);this.heightMeasurementPixels.push(l);const h=await this.calculateHeightMeasurementInfo(l,o,t);if(!(h!=null&&h.measurementAngle)||!(h!=null&&h.tempDistance))return;this.measurementAngle=h.measurementAngle,this.tempDistance=h.tempDistance}}async load(e){return this.addResolvingPromise(this._loadViewAdapter(e).catch(t=>{if(!ne(t))throw t})),this}async loadBestImage(e,t){var a,i;return(a=this.view)==null||a.closePopup(),this.displayMessage=null,this.clearPreviousGroundLocation(),this.imageLocationToolState=!1,this.selectedPoint=e.spatialReference.isGeographic?Ht(e):e.clone(),this.features.removeAll(),this.currentBestFeature=null,this.additionalFeatures.removeAll(),this.additionalFootprints.removeAll(),this.additionalCameraLocations.removeAll(),this.bestFeatureCurrentFootprint=ie(this.bestFeatureCurrentFootprint),(i=this._overlays)==null||i.removeAll(),this._fetchFeaturesWithController(e,t)}loadImageError(e){D.getLogger(this).error("oriented-imagery-viewer:load-image",e),this.setMessage("imageLoadError","error",e.message)}async loadSketch(e){var t;if(!this.sketch){const a=z(()=>import("./SketchViewModel-Ck9IhuP_.js").then(r=>r.S),__vite__mapDeps([438,5,6,1,9,10,11,195,15,12,2,3,98,30,23,24,19,99,100,197,198,7,8,13,14,16,17,18,20,21,22,25,26,27,28,29,31,33,34,35,37,38,39,40,41,42,43,47,48,49,67,242,439,239,54,95,240,262,440,260,261,259,194,216,173,235,219,200,441,238,130,58,59,131,241,155,77,78,215,170,171,204,217,226,172,243,442,396,251]),import.meta.url),{default:i}=await a;L(e),this.sketch=new i({layer:this._sketchGraphicsLayer,view:(t=this.activeViewer)==null?void 0:t.imageRenderer,updateOnGraphicClick:!1,defaultUpdateOptions:{reshapeOptions:{edgeOperation:"none",shapeOperation:"none",vertexOperation:void 0},enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,multipleSelectionEnabled:!1,toggleToolOnClick:!1,tool:"transform"}})}return this.sketch}async loadMeasurementAdapter(e){if(!this.sketchAdapter){const t=z(()=>import("./MeasurementAdapter-BbFucHUR.js"),__vite__mapDeps([443,1,9,10,11,14,12,5,6,2,98,30,15,3,23,24,19,99,100,121,122,123,7,8,13,16,17,18,20,21,22,25,26,27,28,29,31,32,38,124,125,58,59,126,46,47,48,49,50,112,127,128,129,130,131,34,35,67,132,61,62,63,64,65,66,68,69,71,72,70,73,0,133,134,135,136,137,138,33,53,54,55,139,140,102,141,36,37,39,40,41,42,43,44,142,143,144,145,146,147,148,149,150,151,152,153,154,60,89,90,155,156,86,87,88,157,158,77,78,159,103,160,161,104,105,106,108,109,110,111,162,163,164,165,166,167,168,118,119,169,94,170,171,172,173,174,175,176,91,92,177,115,116,117,178,179,180,51,52,56,57,74,75,76,79,80,81,82,83,84,85,181,113,107,182,183,184,185,186,187,188,189,4,45,93,95,96,97,101,114,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435]),import.meta.url),{default:a}=await t;if(L(e),this.sketchAdapter=new a({viewModel:this}),!this.sketchAdapter.viewModel.isResolved())return}return this.sketchAdapter}async startMeasurement(e,t){var n;await this.loadSketch(t),await this.loadMeasurementAdapter(t);const{sketch:a,sketchAdapter:i,activeViewer:r,mode:o}=this;if(!a||!i||!r||o==="none")return;if(this.displayNewMeasurementButton=!1,o==="panoramic"&&(a.defaultCreateOptions.defaultZ=0),await a.create(e),o==="panoramic"){const{drawOperation:l}=a.view.activeTool;l.constraintsEnabled=!1,l._set("elevationDrawSurface",null)}const s=(n=this.activeViewer)==null?void 0:n.imageRenderer.effectiveTheme.accentColor;s&&this.sketch&&(this.sketch.polygonSymbol=Fn(s),this.sketch.polylineSymbol=o==="panoramic"?Ea:ka(s))}startHeightMeasurement(){var e;this.heightMeasurementPixels=[],this.displayNewMeasurementButton=!1,this.draw??(this.draw=new uo({view:(e=this.activeViewer)==null?void 0:e.imageRenderer})),this.draw.create("polyline").on(["cursor-update","vertex-add","draw-complete"],t=>this.handleDrawEvents(t))}createPolylineGraphic(){var a,i,r;const e=[this.heightMeasurementPixels[0],this.heightMeasurementPixels.at(-1)],t=(a=this.activeViewer)==null?void 0:a.imageRenderer.spatialReference;if(this.heightGraphic)this.heightGraphic.geometry=new _e({paths:[e],spatialReference:t});else{const o=new _e({paths:[e],spatialReference:t}),s=(i=this.activeViewer)==null?void 0:i.imageRenderer.effectiveTheme.accentColor;this.heightGraphic=new H({geometry:o,symbol:ka(s,2.5)}),(r=this.activeViewer)==null||r.addGraphic(this.heightGraphic)}}createPolylineGraphicPano(){var h,m;const e=(h=this.activeViewer)==null?void 0:h.imageRenderer.spatialReference,t=(m=this.activeViewer)==null?void 0:m.imageSize;if(!t)return;const a={x:this.heightMeasurementPixels[0][0],y:this.heightMeasurementPixels[0][1]},i={x:this.heightMeasurementPixels.at(-1)[0],y:this.heightMeasurementPixels.at(-1)[1]},{heading:r,pitch:o}=Pe(a,t[0],t[1]),{heading:s,pitch:n}=Pe(i,t[0],t[1]),l=[[...xe(r,o)],[...xe(s,n)]];if(this.heightGraphic)this.heightGraphic.geometry=new _e({paths:[l],spatialReference:e});else{const d=new _e({paths:[l],spatialReference:e});this.heightGraphic=new H({geometry:d,symbol:Ea}),this._panoramicViewer.addGraphic(this.heightGraphic,0)}}async handleDrawEvents(e,t){if(this.draw)switch(e.type){case"cursor-update":this.handleDrawCursorUpdateEvents(e);break;case"vertex-add":this.handleDrawVertexAddEvents(e,t);break;case"draw-complete":await this.displayHeightResults()}}initializeMeasurement(e){switch(this.clearMeasurementGraphics(),this.resetMeasurementData(),e){case"distance":this.startMeasurement("polyline");break;case"area":this.startMeasurement("polygon");break;case"height":this.startHeightMeasurement()}}async overlayCameraLocations(e){const{activeViewer:t,currentBestFeature:a,overlayedCameraLocations:i,layer:r,mode:o,state:s}=this,n=t==null?void 0:t.imageSize;if(!n||!a||!r||o==="none"||s.includes("loading"))return;const{polygon:l}=Tt(a.attributes);if(t.removeManyGraphics(i.toArray()),i.removeAll(),e){const{features:h}=await r.queryFeatures({where:`${r.objectIdField} <> ${a.attributes.objectId}`,geometry:l,returnGeometry:!0,outFields:[r.objectIdField]}),m=await Promise.all(h.map(async d=>{const{attributes:p,geometry:g}=d,f=await this.getPixels(g,{feature:a,imageSize:n,mode:o}),y=Ta.clone();return y.outline=new aa({color:[0,0,0],width:1}),new H({attributes:p,symbol:y,geometry:f})}));i.addMany(m),t.addManyGraphics(i.toArray())}}overlayGraphicsOnImage(e,t){var a;this.removeOverlayedGraphicsOnImage(e),this.overlayedMapFeatures.set(e,t),(a=this.activeViewer)==null||a.addManyGraphics(t.toArray())}async overlayMapFeatures(e,t=!1){const{activeViewer:a,currentBestFeature:i,mode:r,state:o,layer:s}=this,n=a==null?void 0:a.imageSize;if(!n||!i||r==="none"||o.includes("loading")||!s)return;const{polygon:l}=Tt(i.attributes);try{const{imageGeometryField:d,oiObjectIdField:p}=kn(e,s.imageGeometryField,s.imageReferenceField);this.imageGeometryField=d.name,this.oiObjectIdField=p.name}catch(d){D.getLogger(this).warn("oriented-imagery-viewer:overlay-map-features",d)}const{features:h}=await e.queryFeatures({geometry:l,returnGeometry:!0,outFields:["*"]}),m=new B((await Promise.all(h.map(async d=>{var b,C,F;const p=((b=d.symbol)==null?void 0:b.clone())??((F=(C=e.renderer)==null?void 0:C.getSymbol(d))==null?void 0:F.clone()),{attributes:g,geometry:f}=d,y=f,{imageGeometryField:w,oiObjectIdField:v}=this;if(w&&v&&Tn(e,w,v)&&`${g[v]}`==`${i.attributes.objectId}`)try{return En(g,w,e,t,n,r,p)}catch(I){D.getLogger(this).warn("oriented-imagery-viewer:overlay-map-features","couldn't create graphic from attributes, geometry will be used",{error:I,feature:d,layer:e,imageGeometryField:this.imageGeometryField,imageReferenceField:this.oiObjectIdField})}switch(y==null?void 0:y.type){case"point":{const I=await this.getPixels(y,{feature:i,imageSize:n,mode:r});return new H({attributes:g,layer:e,symbol:p,geometry:I,visible:e.visible&&t})}case"polygon":{const{rings:I,spatialReference:S}=y,A=I.map(T=>T.map(([G,ce,he])=>new V({x:G,y:ce,z:he,spatialReference:S}))),E=await Promise.all(A.map(async T=>this.getPixels(T,{feature:i,imageSize:n,mode:r}).then(G=>G.map(ue))));return new H({attributes:g,layer:e,symbol:p,geometry:new se({rings:E,spatialReference:Z.WebMercator}),visible:e.visible&&t})}case"polyline":{const{paths:I,spatialReference:S}=y,A=I.map(T=>T.map(([G,ce,he])=>new V({x:G,y:ce,z:he,spatialReference:S}))),E=await Promise.all(A.map(async T=>this.getPixels(T,{feature:i,imageSize:n,mode:r}).then(G=>G.map(ue))));return new H({attributes:g,layer:e,symbol:p,geometry:new _e({paths:E,spatialReference:Z.WebMercator}),visible:e.visible&&t})}case"multipoint":{const{points:I,spatialReference:S}=y,A=I.map(([T,G,ce])=>new V({x:T,y:G,z:ce,spatialReference:S})),E=await this.getPixels(A,{feature:i,imageSize:n,mode:r}).then(T=>T.map(ue));return new H({attributes:g,layer:e,symbol:p,geometry:new Za({points:E,spatialReference:Z.WebMercator}),visible:e.visible&&t})}}return null}))).filter(It));this.overlayGraphicsOnImage(`${e.id}`,m)}async getPixels(e,t){const{imageSize:a,mode:i}=t,r=(await this.worldToImage(Array.isArray(e)?e:[e])).map(o=>{if(i==="default")return new V({x:o.x-.5,y:.5-o.y,spatialReference:Z.WebMercator});const[s,n]=a,{heading:l,pitch:h}=Pe(o,s,n),m=xe(l,h);return new V(m,Z.WebMercator)});return Array.isArray(e)?r:r[0]}async getMapPoint(e,t){const{feature:a,mode:i,imageSize:r}=t,{elevationSample:o,attributes:s}=a,{elevationSource:n,location:l,elevation:h,cameraHeight:m}=s;let d=l.clone();d.spatialReference.isGeographic&&(d=await re(d,Z.WebMercator));const p=await He(h??(l.z??0)-m,{elevationSample:o,elevationSource:n,extent:this.footprintExtent});let g;if("elevationSample"in p&&We(p.elevationSample)&&(a.elevationSample=p.elevationSample),i==="default"){const f=rt(s,r[0],r[1]);g=await _t(Array.isArray(e)?e:[e],{...f,cameraLocation:d},p)}else{const f=Sa(s,r[0],r[1]);g=await bt(Array.isArray(e)?e:[e],{...f,cameraLocation:d},p)}return Array.isArray(e)?g:g[0]}async plotMapPoint(e){var t;return this.plotReferencePoint(e),this.transformAndPlotReferencePointOnImage({feature:this.currentBestFeature,selectedLocation:e,options:{signal:(t=this._transformController)==null?void 0:t.signal}})}plotReferencePointOnGround(e){var t,a,i;this._referencePointOnGround&&((t=this._overlays)==null||t.remove(this._referencePointOnGround),this._referencePointOnGround.destroy()),e!=null&&(this._referencePointOnGround=new H({geometry:new V({...e.toJSON()}),symbol:La}),this.view?(a=this._overlays)==null||a.add(this._referencePointOnGround):this.emit("plot-ground-point",{data:{point:(i=this._referencePointOnGround)==null?void 0:i.geometry}}))}plotReferencePointOnImage(e){if(this.state==="image-loaded")switch(this.clearReferencePointOnImage(),this.mode){case"default":{const t=ze.isSerializable(e)?e.toJSON():e;t.x-=.5,t.y=.5-t.y,this._referencePointOnImage=new H({geometry:new V({spatialReference:this._imageViewer.imageRenderer.spatialReference,...t}),symbol:La}),this._imageViewer.addGraphic(this._referencePointOnImage,0);break}case"panoramic":{const{imageSize:t}=this._panoramicViewer;if(!t)return;const[a,i]=t,{heading:r,pitch:o}=Pe(e,a,i),s=xe(r,o);this._referencePointOnImage=new H({geometry:new V(s,Z.WebMercator),symbol:Pn}),this._panoramicViewer.addGraphic(this._referencePointOnImage,0);break}}}plotLocationPointOnImage(e){if(this.state==="image-loaded")switch(this.clearLocationPointOnImage(),this.mode){case"default":this._plotLocationPointOnDefaultImage(e);break;case"panoramic":this._plotLocationPointOnPanoramicImage(e)}}removeAllOverlayMapFeatures(){this.overlayedMapFeatures.forEach(e=>{this._imageViewer.removeManyGraphics(e.toArray())}),this.overlayedMapFeatures.clear()}removeOverlayedGraphicsOnImage(e){var a;const t=this.overlayedMapFeatures.get(e);t!=null&&t.length&&((a=this.activeViewer)==null||a.removeManyGraphics(t.toArray()),this.overlayedMapFeatures.delete(e))}resetImage(){switch(this.setMessage("onLoadMessage","info"),this.mode){case"default":this._imageViewer.clearImage(),this._imageViewer.clearGraphics();break;case"panoramic":this._panoramicViewer.clearGraphics()}this._clickTask=Fe(this._clickTask)}resetMeasurementData(){this.areaMeasurementResult=0,this.areaMeasurementAccuracy=0,this.distanceMeasurementResult=0,this.distanceAccuracyArray=[],this.heightMeasurementPixels=[],this.heightMeasurementResult=0,this.tempDistance=null,this.measurementAngle=null,this.heightMeasurementAccuracy=0,this.heightGraphic=null}async saveDrawing(){const{dataCaptureLayer:e,sketchAdapter:t}=this;if(!e||(t==null?void 0:t.type)!=="data-capture")return;const{pendingGraphics:a,savedGraphics:i}=t,r=a.get(e.id),o=r==null?void 0:r.toArray();if(!r||!(o!=null&&o.length))return;const{addFeatureResults:s}=await this.saveDataCaptureFeatures(o),n=s.reduce((l,{objectId:h,globalId:m,error:d},p)=>{const g=o[p],{attributes:f}=g;return d?l.error.push(g):(h&&(f[e.objectIdField]=h),m&&e.globalIdField&&(f[e.globalIdField]=m),l.success.push(g)),l},{success:[],error:[]});i.addMany(n.success),r.removeAll(),r.addMany(n.error)}async saveDataCaptureFeatures(e){const{activeViewer:t,currentBestFeature:a,dataCaptureLayer:i,mode:r}=this,o=t==null?void 0:t.imageSize;if(!o||!a||r==="none")throw new Q("Image size, current best feature and mode are required to save data capture features");if(!i)throw new Q("Data capture layer is not available");const s=await Promise.all(e.map(async l=>{const h=l.clone(),{geometry:m}=h;if(!m)return;const d=m.type,p=i.hasZ,g=i.geometryType,f=d!==g,y=f?await z(()=>import("./transformers-DtkRkbRv.js"),[],import.meta.url):null,w=y==null?void 0:y.default[g],v=f?w==null?void 0:w(m):m;if(v)switch(v.type){case"point":return h.geometry=await this.getMapPoint(Ft(r,v,o),{feature:a,imageSize:o,mode:r}),p||(delete h.geometry.z,h.geometry.hasZ=!1),h.geometry.hasM=!1,h;case"polygon":{const b=await Promise.all(v.rings.map(async C=>this.getMapPoint(C.map(([F,I,S])=>Ft(r,{x:F,y:I,z:S},o)),{feature:a,imageSize:o,mode:r})));return h.geometry=new se({spatialReference:b[0][0].spatialReference,hasZ:p,hasM:!1,rings:b.map(C=>C.map(ue))}),h}case"polyline":{const b=await Promise.all(v.paths.map(async C=>this.getMapPoint(C.map(([F,I,S])=>Ft(r,{x:F,y:I,z:S},o)),{feature:a,imageSize:o,mode:r})));return h.geometry=new _e({spatialReference:b[0][0].spatialReference,hasZ:p,hasM:!1,paths:b.map(C=>C.map(ue))}),h}}})),n=s.filter(It);return i.applyEdits({addFeatures:n}).then(l=>{const{addFeatureResults:h}=l;let m=0;const d=s.map(p=>{const g=h[m++];return p?g:{error:new Q("Error in saving data capture features"),objectId:null,globalId:null}});return{...l,addFeatureResults:d}})}async searchBestImage(e,t){try{const a=await As(e,t);a&&await this._processFeatureResponse(a,e.point,{signal:t==null?void 0:t.signal})}catch(a){ne(a)||(this.setMessage("imageLoadError","error",a.message),D.getLogger(this).error("error occurred while finding best image",a))}}selectBestFeature(e){var t;this.currentBestFeature=(t=this.features)==null?void 0:t.find(({attributes:a})=>a.objectId===Number(e))}setAdditionalCameraLocationsVisibility(e){this.additionalCameraLocations.forEach(t=>{t.visible=e})}setAdditionalCoverageVisibility(e){this.additionalFootprints.forEach(t=>{t.visible=e})}setCurrentCoverageVisibility(e){this.bestFeatureCurrentFootprint&&(this.bestFeatureCurrentFootprint.visible=e),this.currentBestFeatureLocation&&(this.currentBestFeatureLocation.visible=e)}setMapImageConversionToolState(e){this.mapImageConversionToolState=e}async startDataCapture(e,t){var d,p;const a=(d=this.activeViewer)==null?void 0:d.imageRenderer,{oiObjectIdField:i,currentBestFeature:r}=this;if(!a||!r||!i)return;const{attributes:{objectId:o}}=r,s=((p=this.overlayedMapFeatures.get(e.id))==null?void 0:p.toArray())??[],n=[],l=[];for(const g of s)`${g.getAttribute(i)}`==`${o}`?n.push(g):l.push(g);this.overlayGraphicsOnImage(e.id,new B(l)),this.collectionId=e.id;const h=await this.loadSketch(t),m=await this.loadDataCaptureAdapter(t);L(t),h.layer.addMany(n),h.layer.blendMode="source-atop",m.savedGraphics.addMany(n),a.ui.find("zoom").visible=!1,a.map.layers.add(this.sketchGraphicsLayer)}async stopDataCapture(e=!1){var r,o,s;(r=this.sketch)==null||r.cancel(),(o=this.sketchGraphicsLayer)==null||o.removeAll(),this.sketchAdapter=ie(this.sketchAdapter),this.sketch=ie(this.sketch),this.collectionId=null;const{dataCaptureLayer:t}=this,a=(s=this.activeViewer)==null?void 0:s.imageRenderer;if(!a||a.destroyed)return;a.map.layers.remove(this.sketchGraphicsLayer),e&&t&&await this.overlayMapFeatures(t,!0);const i=a.ui.find("zoom");i&&(i.visible=!0)}stopMeasurement(){var e,t;this.heightMeasurementPixels=[],(e=this.draw)==null||e.reset(),(t=this.sketch)==null||t.cancel()}toggleAllOverlayMapFeatures(e){this.overlayedMapFeatures.forEach(t=>{this._toggleVisiblity(t,e)})}toggleOverlayMapFeatures(e,t){const a=this.overlayedMapFeatures.get(e);a&&this._toggleVisiblity(a,t)}toggleSelection(e){const{sketch:t}=this;t&&(t.updateOnGraphicClick=e,t.cancel())}async transformAndPlotReferencePointOnImage(e){var n;const{selectedLocation:t,options:a}=e;let i=!1,r=!1;const o=(n=this.bestFeatureFootprint)==null?void 0:n.geometry;switch(o==null?void 0:o.type){case"polygon":{const l=t.spatialReference.equals(o.spatialReference)?t:await re(t,o.spatialReference);i=o.contains(l);break}case"mesh":{const l=t.spatialReference.equals(o.spatialReference)?t:await re(t,o.spatialReference);r=o.extent.contains(l);break}}if(!i&&!r)return void this.clearReferencePointOnImage();const s=await this.worldToImage(t,a);if(s)return L(a),this.plotReferencePointOnImage(s),{x:s.x,y:s.y};this.clearReferencePointOnImage()}updateSuitabilities(e){e.sort((a,i)=>a.suitability-i.suitability),this._suitabilities=e;const t=this._suitabilities.map(({feature:a})=>a);this._initialCurrentCoverageUpdate=!0,this._updateFeatures(t),this._groupFeaturesBySectors()}async _fetchFeatures(e,t){if(!this.view)return;const a=this.layer;if(a){const i={include:a},r=this.view.toScreen(e);if(!r)return;const o=await this.view.hitTest(r,i);return this._processHitTestResults(a,o,t)}}async _fetchFeaturesWithController(e,t){try{await this._fetchFeatures(e,t)}catch(a){if(ne(a))return;this.setMessage("imageLoadError","error"),D.getLogger(this).error("error occurred while fetching features",a)}}_groupFeaturesBySectors(){const{_suitabilities:e,additionalFeatures:t,currentBestFeature:a,features:i,invalidCameraHeading:r}=this;if(!e||!t||!a||!i||r)return void(this._sectorData=null);this._sectorData={};for(const l of xt)this._sectorData[l]=new B;const o=e.map((l,h)=>({...l,featureIndex:h}));o.sort((l,h)=>l.trueSuitability-h.trueSuitability);const s=o.map(({distance:l})=>l),n=Math.max(...s);o.forEach(l=>{var A,E;const{distance:h,angle:m,featureIndex:d}=l,p=h/n*k[2],g=Eo(h,n),f=ko(m);if(!this._sectorData)return;const y=k[3]+p*Math.sin(m*Math.PI/180),w=k[3]+p*Math.cos(m*Math.PI/180);let v;const b=i.at(d),C=b===this.currentBestFeature,F=((A=this.currentBestFeature)==null?void 0:A.attributes.cameraPitch)&&((E=this.currentBestFeature)==null?void 0:E.attributes.cameraPitch)<5;if(C&&F)v=-90;else{const T=y-k[3],G=w-k[3],ce=G/Math.sqrt(T**2+G**2);let he=180*Math.acos(ce)/Math.PI;(T<0&&G<0||T<0&&G>0)&&(he*=-1),v=he}const I=g===""?f:`${g}_${f}`;C&&(v===this.bestFeatureAngle?this.previousFeatureAngle=v:this.bestFeatureAngle=v,this.navigatorCurrentBestFeature=F?null:{x:y,y:w,direction:f});const S=this._sectorData[I];S.add({angle:m,featureIndex:d,x:y,y:w,objectID:b.attributes.objectId,sector:I,featureIndexInSector:S.length})})}_plotLocationPointOnDefaultImage(e){const t=ze.isSerializable(e)?e.toJSON():e;t.x-=.5,t.y=.5-t.y,this._locationPointOnImage=new H({geometry:new V({spatialReference:this._imageViewer.imageRenderer.spatialReference,...t}),symbol:xn}),this._imageViewer.addGraphic(this._locationPointOnImage,0)}_plotLocationPointOnPanoramicImage(e){const{imageSize:t}=this._panoramicViewer;if(!t)return;const[a,i]=t,{heading:r,pitch:o}=Pe(e,a,i),s=xe(r,o);this._locationPointOnImage=new H({geometry:new V(s,Z.WebMercator),symbol:$n}),this._panoramicViewer.addGraphic(this._locationPointOnImage,0)}async _processFeatureResponse(e,t,a){var l;const{features:i}=e;if(!(i!=null&&i.length))return this.setMessage("noImageError","error"),void(this.currentBestFeature=null);this.coveragePolygons.removeAll(),this.coverageFrustums.removeAll(),this.pointSources.removeAll();const{features:r,polygons:o,frustums:s}=this.filterByFootprints(i,t);if(!r.length)return this.setMessage("noImageError","error"),void(this.currentBestFeature=null);let n;if(this.coveragePolygons.addMany(o),this.coverageFrustums.addMany(s),o[0]){let h=new se({spatialReference:o[0].spatialReference});for(const d of o)h=await Kr(h,d);const m=[];for(const{geometry:d}of r)h.contains(d)||m.push([d.x,d.y]);if(m.sort((d,p)=>+Vr([d,p])),h.addRing(m),this.footprintExtent=mo(h.extent,2,2),(l=this.view)==null?void 0:l.supportsGround)try{n=await this.view.map.ground.createElevationSampler(this.footprintExtent,a)}catch(d){ne(d)||D.getLogger(this).error(d)}}if((n||r[0].attributes.elevationSource)&&this.footprintExtent){const h=r[0].attributes.elevationSource;Zt(h)&&!n&&(n=await sa({extent:this.footprintExtent,lod:h.lod,url:h.url,rasterFunction:h.rasterFunction}));const m=await He((r[0].attributes.location.z??0)-r[0].attributes.cameraHeight,{elevationSample:n,elevationSource:h,extent:this.footprintExtent}),[d,...p]=await De([t,...r.map(g=>g.attributes.geometry.clone())],m);r[0].elevationSample=n??m.elevationSample,t.elevation=d.z,r.forEach((g,f)=>{g.attributes.elevation=p[f].z})}r[0].elevationSample&&r.forEach(h=>{h.elevationSample=r[0].elevationSample}),this._suitabilities=Vs({features:r,selectedPoint:t,camera:To(this.view)?this.view.camera:null,currentImage:this.currentBestFeature}),this.updateSuitabilities(this._suitabilities)}async _processHitTestResults(e,t,a){var p;const{screenPoint:i,results:[r]}=t,o=(r==null?void 0:r.type)==="graphic"&&this.shouldShowSelectedImage,s=(r==null?void 0:r.mapPoint)??((p=this.view)==null?void 0:p.toMap(i));if(!s)return;const{layerFloorFilterClause:n}=this,l=e.spatialReference.equals(s.spatialReference)?s:await re(s,e.spatialReference),h=wa("1=1",wa(e.definitionExpression,n)),m=l.spatialReference.isGeographic?1:fa(l.spatialReference),d={layerInstanceOrURL:e,point:l,queryParams:{where:h,maximumDistance:e.maximumDistance?e.maximumDistance/m:void 0,objectIds:o?[r.graphic.getAttribute(e.objectIdField)]:void 0}};await this.searchBestImage(d,a)}_resetCursor(){const{activeViewer:e}=this;e&&(e.imageRenderer.cursor=this._previousCursor)}_setMeasurementCursor(){const{activeViewer:e}=this;e&&(this._previousCursor=e.imageRenderer.cursor,e.imageRenderer.cursor="crosshair")}_toggleVisiblity(e,t){e.forEach(a=>{a.visible=t})}_updateFeatures(e){if(!e.length)return this.currentBestFeature=null,void this.additionalFeatures.removeAll();this.features.removeAll(),this.features.addMany(e),e.length>1?this.additionalFeatures.addMany(e.slice(1)):this.additionalFeatures.removeAll(),this._updateGroundElevation=!0,this.currentBestFeature=e[0]}async _updatePointsAndPolygons(e){var o;const{pointSources:t,currentBestFeature:a,currentCoverageVisible:i,isAdditionalPointSourcesVisible:r}=this;if(a&&(this.additionalFootprints.removeAll(),this.additionalCameraLocations.removeAll(),this.bestFeatureCurrentFootprint&&(this.bestFeatureCurrentFootprint.destroy(),this.bestFeatureCurrentFootprint=null,this.bestFeatureFootprint=null),!this.invalidCameraHeading)){await((o=this._adapter)==null?void 0:o.createFootprints(e)),L(e);for(const s of t)s.imageID===a.attributes.objectId?this.currentBestFeatureLocation=new H({attributes:{imageID:s.imageID},geometry:s.clone(),symbol:Cn,visible:i}):this.additionalCameraLocations.push(new H({attributes:{imageID:s.imageID},geometry:s.clone(),symbol:Ta,visible:r}))}}_updateCurrentBestFeature(e){var i,r,o;if(!e)return;this.currentBestFeature=(i=this.features)==null?void 0:i.at(e.featureIndex);const t=((r=this.currentBestFeature)==null?void 0:r.attributes.cameraPitch)&&((o=this.currentBestFeature)==null?void 0:o.attributes.cameraPitch)<5;let a;if(t)a=-90;else{const s=e.x-k[3],n=e.y-k[3],l=n/Math.sqrt(s**2+n**2);let h=180*Math.acos(l)/Math.PI;(s<0&&n<0||s<0&&n>0)&&(h*=-1),a=h}a===this.bestFeatureAngle?this.previousFeatureAngle=a:this.bestFeatureAngle=a,this.navigatorCurrentBestFeature=t?null:{x:e.x,y:e.y,direction:e.sector.includes("_")?e.sector.split("_")[1]:e.sector}}clearGraphics(){this._imageViewer.clearGraphics(),this._panoramicViewer.clearGraphics()}clearReferencePointOnImage(){this._referencePointOnImage&&(this._imageViewer.removeGraphic(this._referencePointOnImage),this._panoramicViewer.removeGraphic(this._referencePointOnImage),this._referencePointOnImage=ie(this._referencePointOnImage))}clearLocationPointOnImage(){this._locationPointOnImage&&(this._imageViewer.removeGraphic(this._locationPointOnImage),this._panoramicViewer.removeGraphic(this._locationPointOnImage),this._locationPointOnImage=ie(this._locationPointOnImage))}plotReferencePoint(e){"mapPoint"in e?this.plotReferencePointOnGround(e.mapPoint):this.plotReferencePointOnGround(e)}setMessage(e,t,a,i){this.displayMessage={key:e,type:t,data:a,map:i}}async transformAndPlotSelectedLocation(e){const{currentBestFeature:t,invalidCameraHeading:a,selectedPoint:i,activeViewer:r}=this;if(this._crossSymbol&&(this._panoramicViewer.removeGraphic(this._crossSymbol),this._imageViewer.removeGraphic(this._crossSymbol),this._crossSymbol=ie(this._crossSymbol)),!i||!t||(r==null?void 0:r.state)!=="image-loaded"||a)return;let o;try{o=await this.worldToImage(i,e),L(e),await this.plotSelectedPointOnImage(o,e)}catch(s){ne(s)||D.getLogger(this).error("failed to transform map point to pixel, cross symbol will not be plotted on image",{error:s,selectedPoint:i,feature:t})}}async worldToImage(e,t){const{footprintExtent:a}=this,{imageSize:i}=this.activeViewer;if(this.mode==="none"||!this.currentBestFeature||!i||!a)return;const{attributes:{location:r,elevationSource:o,cameraHeading:s,elevation:n,cameraHeight:l},elevationSample:h}=this.currentBestFeature;let m=r.clone();const d=await He(n??(r.z??0)-l,{elevationSample:h,elevationSource:o});this.currentBestFeature.elevationSample=d.elevationSample;const p=Array.isArray(e)?e:[e];let g,f=await Promise.all(p.map(y=>new Promise(w=>{if(!y.hasZ)return w(De(y,d));w(y)})));if(r.spatialReference.isGeographic&&(m=await re(m,Z.WebMercator,t)),f=await Promise.all(f.map(async y=>m.spatialReference.equals(y.spatialReference)?y:await re(y,m.spatialReference,t))),L(t),this.mode==="panoramic")g=Ke(f,{imageHeight:i[1],imageWidth:i[0],cameraHeading:s,cameraLocation:m});else{const y=Ci(this.currentBestFeature.attributes,i[0],i[1]);g=$e(f,{...y,cameraLocation:m})}return Array.isArray(e)?g:g[0]}updateCurrentCoveragePolygon(e){var p,g,f;const{additionalFootprints:t,additionalCameraLocations:a,currentBestFeature:i,currentBestFeatureLocation:r,currentCoverageVisible:o,selectedPoint:s,view:n,_adapter:l,mode:h}=this,{attributes:{objectId:m},elevationSample:d}=i;if(this._initialCurrentCoverageUpdate){if((p=this._overlays)==null||p.removeAll(),this._initialCurrentCoverageUpdate=!1,this.bestFeatureCurrentFootprint=ie(this.bestFeatureCurrentFootprint),e&&!this.invalidCameraHeading&&(e.visible=o,this.bestFeatureCurrentFootprint=e),n){const y=[...t,...a,r].filter(Lo);n.supportsGround&&d&&(l!=null&&l.updateGroundElevation)&&(this._updateGroundElevation&&l.updateGroundElevation(y,d),h==="panoramic"&&l.updateGroundElevation([this.bestFeatureCurrentFootprint],d)),this._updateGroundElevation=!1,s&&(y.splice(-2,0,this.bestFeatureCurrentFootprint),y.push(new H({geometry:s.clone(),symbol:Va.clone(),attributes:{imageID:m}}))),this._overlays.graphics.addMany(y)}}else if(n){if(this.invalidCameraHeading)return;this.bestFeatureCurrentFootprint&&((g=this._overlays)==null||g.remove(this.bestFeatureCurrentFootprint),this.bestFeatureCurrentFootprint=ie(this.bestFeatureCurrentFootprint));const y=this.bestFeatureCurrentFootprint&&this._overlays?this._overlays.graphics.indexOf(this.bestFeatureCurrentFootprint):-1;e&&(this.bestFeatureCurrentFootprint=e,n!=null&&n.supportsGround&&d&&(l!=null&&l.updateGroundElevation)&&h==="panoramic"&&l.updateGroundElevation([e],d),e.visible=this.currentCoverageVisible,(f=this._overlays)==null||f.graphics.add(this.bestFeatureCurrentFootprint,y>=0?y:this._overlays.graphics.length-1))}}};c([u()],_.prototype,"activeLayer",null),c([u({readOnly:!0})],_.prototype,"activeViewer",null),c([u()],_.prototype,"accuracyParametersMissing",null),c([u()],_.prototype,"additionalFeatures",void 0),c([u({type:B.ofType(H)})],_.prototype,"additionalCameraLocations",void 0),c([u({type:B.ofType(H)})],_.prototype,"additionalFootprints",void 0),c([u()],_.prototype,"areaMeasurementResult",void 0),c([u()],_.prototype,"areaMeasurementAccuracy",void 0),c([u()],_.prototype,"bestFeatureAngle",void 0),c([u()],_.prototype,"bestFeatureCurrentFootprint",void 0),c([u({type:H})],_.prototype,"bestFeatureFootprint",void 0),c([u({type:Number})],_.prototype,"brightness",null),c([u()],_.prototype,"collectionId",void 0),c([u({type:Number})],_.prototype,"contrast",null),c([u()],_.prototype,"conversionProps",void 0),c([u()],_.prototype,"coverageFrustums",void 0),c([u()],_.prototype,"coveragePolygons",void 0),c([u()],_.prototype,"currentBestFeature",void 0),c([u()],_.prototype,"currentBestFeatureLocation",void 0),c([u()],_.prototype,"currentCoverageVisible",void 0),c([u({json:{write:!1}})],_.prototype,"determineWorkflowForFeature",void 0),c([u()],_.prototype,"disabled",void 0),c([u()],_.prototype,"displayMessage",void 0),c([u()],_.prototype,"displayNewMeasurementButton",void 0),c([u()],_.prototype,"distanceMeasurementResult",void 0),c([u()],_.prototype,"distanceAccuracyArray",void 0),c([u()],_.prototype,"dataCaptureLayer",void 0),c([u({readOnly:!0})],_.prototype,"featureCount",null),c([u()],_.prototype,"features",void 0),c([u()],_.prototype,"groundCoordinates",void 0),c([u()],_.prototype,"heightMeasurementPixels",void 0),c([u()],_.prototype,"heightGraphic",void 0),c([u()],_.prototype,"heightMeasurementResult",void 0),c([u()],_.prototype,"heightMeasurementAccuracy",void 0),c([u()],_.prototype,"measurementAngle",void 0),c([u()],_.prototype,"tempDistance",void 0),c([u({readOnly:!0})],_.prototype,"imageGalleryEnabled",null),c([u()],_.prototype,"imageGeometryField",void 0),c([u({readOnly:!0})],_.prototype,"imageLoaded",null),c([u()],_.prototype,"imageLocationToolState",void 0),c([u({readOnly:!0})],_.prototype,"invalidCameraHeading",null),c([u()],_.prototype,"imagePointsInView",null),c([u()],_.prototype,"isAdditionalCoverageVisible",void 0),c([u()],_.prototype,"isAdditionalPointSourcesVisible",void 0),c([u()],_.prototype,"layer",void 0),c([u()],_.prototype,"layerView",null),c([u({readOnly:!0})],_.prototype,"layerFloorFilterClause",null),c([u({type:Number})],_.prototype,"localPort",void 0),c([u()],_.prototype,"mapImageConversionToolState",void 0),c([u()],_.prototype,"measureType",void 0),c([u()],_.prototype,"measurementGraphic",void 0),c([u({readOnly:!0,value:"none"})],_.prototype,"mode",null),c([u()],_.prototype,"navigatorCurrentBestFeature",void 0),c([u()],_.prototype,"oiObjectIdField",void 0),c([u({type:B.ofType(H)})],_.prototype,"overlayedCameraLocations",void 0),c([u()],_.prototype,"overlayedMapFeatures",void 0),c([u()],_.prototype,"pixelCoordinates",void 0),c([u()],_.prototype,"pointSources",void 0),c([u({readOnly:!0})],_.prototype,"popupEnabled",null),c([u()],_.prototype,"previousFeatureAngle",void 0),c([u()],_.prototype,"referencePoint",null),c([u({readOnly:!0})],_.prototype,"sectorData",null),c([u()],_.prototype,"selectedPoint",void 0),c([u({type:Number})],_.prototype,"sharpness",null),c([u()],_.prototype,"shouldShowSelectedImage",void 0),c([u()],_.prototype,"sketch",void 0),c([u()],_.prototype,"draw",void 0),c([u()],_.prototype,"sketchAdapter",void 0),c([u({readOnly:!0})],_.prototype,"sketchGraphicsLayer",null),c([u({readOnly:!0})],_.prototype,"state",null),c([u({readOnly:!0})],_.prototype,"thumbnails",null),c([u()],_.prototype,"updateFootprint",void 0),c([u()],_.prototype,"updateFootprintPanorama",void 0),c([u({value:null})],_.prototype,"view",null),c([u()],_.prototype,"_adapter",void 0),c([u()],_.prototype,"_sketchGraphicsLayer",null),c([u()],_.prototype,"_highlightedFeatureHandle",void 0),c([u()],_.prototype,"_imageViewer",void 0),c([u()],_.prototype,"_initialCurrentCoverageUpdate",void 0),c([u()],_.prototype,"_locationPointOnImage",void 0),c([u()],_.prototype,"_overlays",void 0),c([u({readOnly:!0})],_.prototype,"_overlaysView",null),c([u()],_.prototype,"_panoramicViewer",void 0),c([u()],_.prototype,"_previousCursor",void 0),c([u()],_.prototype,"_referencePointOnGround",void 0),c([u()],_.prototype,"_referencePointOnImage",void 0),c([u()],_.prototype,"_sectorData",void 0),c([u({readOnly:!0})],_.prototype,"_updatingHandles",void 0),c([u()],_.prototype,"footprintExtent",void 0),c([u()],_.prototype,"_featureChangedTask",void 0),_=c([me("esri.widgets.OrientedImageryViewer.OrientedImageryViewerViewModel")],_);const or=_;let ee=class extends _r{constructor(){super(...arguments),this.additionalFootprintToggle=!0,this.additionalCameraLocationsToggle=!0,this.currentFootprintToggle=!0,this.imageEnhancement=!0,this.imageGallery=!0,this.imageOverlays=!0,this.measurementTools=!0,this.mapImageConversionTool=!0,this.menu=!0,this.navigationTool=!0,this.digitization=!0,this.title=!0,this.showPopupsAction=!0}get coverageMenu(){return Ae(D.getLogger(this),"coverageMenu",{replacement:"menu"}),this.menu}set coverageMenu(e){Ae(D.getLogger(this),"coverageMenu",{replacement:"menu"}),this.menu=e}};c([u({type:Boolean,nonNullable:!0})],ee.prototype,"additionalFootprintToggle",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"additionalCameraLocationsToggle",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"currentFootprintToggle",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"coverageMenu",null),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"imageEnhancement",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"imageGallery",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"imageOverlays",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"measurementTools",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"mapImageConversionTool",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"menu",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"navigationTool",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"digitization",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"title",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"showPopupsAction",void 0),ee=c([me("esri.widgets.OrientedImageryViewer.OrientedImageryViewerVisibleElements")],ee);const sr=ee;let Ee=class extends vt{constructor(e){super(e),this.messages=null}loadDependencies(){return Ja({action:()=>z(()=>import("./index-BPm91e5Z.js"),__vite__mapDeps([444,445,193,1,55,14,12,5,6,2,10,9,11,128,446,447,448,449,450,451,452,453,454,455,456]),import.meta.url),block:()=>z(()=>import("./index-C6d66FVb.js"),__vite__mapDeps([457,445,193,1,55,14,12,5,6,2,10,9,11,128,446,447,458,453,452,450,449,448,459,460,461,454,462,455,463,464,444,451,456,465,466,467,468,469,470,471,472,473,474,475]),import.meta.url),panel:()=>z(()=>import("./index-C6rrpqn6.js").then(e=>e.i),__vite__mapDeps([476,445,193,1,55,14,12,5,6,2,10,9,11,128,446,447,448,449,450,444,451,452,453,454,455,456,469,460,461,463,470,471,472,473,462,474,475,458]),import.meta.url)})}get _renderLocation(){const{groundCoordinates:e}=this;return e?M("calcite-block",{heading:this.getLocation(),headingLevel:6},M("calcite-action",{icon:"copy-to-clipboard",onclick:()=>this.copyLocation(),slot:"control",text:"Copy"})):null}copyLocation(){const{groundCoordinates:e}=this;if(!e)return;const t=this.getLocation();t&&Un(t)}getLocation(){const{groundCoordinates:e}=this;if((e==null?void 0:e.longitude)==null||(e==null?void 0:e.latitude)==null)return"";const t={groundX:e.longitude.toFixed(3),groundY:e.latitude.toFixed(3)};return mi("{groundX} , {groundY}",t)}render(){return M("calcite-panel",{class:$.measurementResults,key:"ground-location-container"},this._renderLocation)}};c([u()],Ee.prototype,"messages",void 0),c([u()],Ee.prototype,"groundCoordinates",void 0),c([u()],Ee.prototype,"_renderLocation",null),Ee=c([me("esri.widgets.OrientedImageryViewer.components.ImageLocationWidget")],Ee);const Kn=Ee,st={overlayed:"overlayed"};let P=class extends vt{constructor(e,t){super(e,t),this.dataCaptureEnabled=!1,this.galleryOpened=!1,this.imageEnhancementToolActive=!1,this.imageOverlaysOpened=!1,this.navigationToolActive=!1,this.viewModel=new or,this.messagesCommon=null,this.messagesSketch=null,this.pixelMeasurementUnit="meters",this.pixelAreaMeasurementUnit="square-meters",this.showCameraLocations=!1,this.showMapFeatures=!1,this.visibleElements=new sr,this._actionItems=new Ba,this._imageOverlaysLoaderTask=null,this._imageMeasurementToolsLoaderTask=null,this._clearMeasurements=()=>{this.viewModel.measureType=null,this.viewModel.clearPreviousMeasurements()},this._clearImageLocation=()=>{this.imageLocationToolActive=!1},this._navigationToolExpanded=!1,this._navigationTool=null,this._warningTitleElement=null,this._galleryController=new AbortController,this._galleryObserver=new IntersectionObserver(this._lazyLoadImage.bind(this)),this._overlayedLayers=new B,this._previousAction=null,this._handleDataCaptureLayerChange=async a=>{if(this.dataCaptureLayer&&await this.stopDataCapture(!0),this.dataCaptureLayer=this.dataCaptureLayer===a?null:a,this.dataCaptureLayer)return this.startDataCapture(this.dataCaptureLayer)},this._handleOverlayLayerDeselect=a=>{const i=a.layer;i===this.dataCaptureLayer&&(this.stopDataCapture(),this.dataCaptureLayer=null),this.removeOverlayedGraphicsOnImage(`${i.id}`)},this._handleOverlayLayerSelect=a=>{const i=a.layer;this.viewModel.overlayMapFeatures(i,this.showMapFeatures),this.addHandles(O(()=>i.visible,()=>{this.viewModel.toggleOverlayMapFeatures(i.id,i.visible)}),`${st.overlayed}-${i.id}`)},this._highlight=a=>{var r;const i=(r=a.target)==null?void 0:r.dataset.objectid;i&&this.viewModel.highlight(i)},this._onAction=a=>{const{target:i}=a,{dataset:{action:r}}=i,{_previousAction:o}=this,s=o==null?void 0:o.dataset.action,n=(s==null?void 0:s.includes("draw"))??!1,l=s==="select-feature",h=s!==r;switch(r){case"draw-point":case"draw-polygon":case"draw-polyline":{o&&Me(l,n&&h)&&(o.active=!1),i.active=!i.active;const m=r.replace("draw-","");this.viewModel.digitizeCreate(m),this._previousAction=i.active?i:null;break}case"save":this.viewModel.saveDrawing();break;case"select-feature":n&&(this._previousAction.active=!1),i.active=!i.active,this.viewModel.toggleSelection(i.active),this._previousAction=i.active?i:null;break;case"delete-feature":this.viewModel.digitizeDelete()}},this._onImageOverlayClosed=()=>{this.imageOverlaysOpened=!1},this._onShowCameraLocationsChanged=a=>{this.showCameraLocations=a},this._onShowMapFeaturesChanged=a=>{this.showMapFeatures=a},this._removeActionElement=a=>{this._actionItems.delete(a.text)},this._removeHighlight=()=>this.viewModel.removeHighlight(),this._restoreOverlays=async()=>Promise.all(this._overlayedLayers.map(a=>this.viewModel.overlayMapFeatures(a,this.showMapFeatures))),this._scaleNavigationTool=()=>{this._navigationToolExpanded=!this._navigationToolExpanded},this._sketchLoaderTask=null,this._toggleImageAttributes=()=>{this.viewModel.toggleImageAttributes()},this._loadImageFromGallery=this._loadImageFromGallery.bind(this),this._registerGalleryItem=this._registerGalleryItem.bind(this),this._unregisterGalleryItem=this._unregisterGalleryItem.bind(this),this.loadImageFromSource=this.loadImageFromSource.bind(this),this.updateSuitabilities=this.updateSuitabilities.bind(this)}initialize(){this.addHandles([O(()=>{var e;return[(e=this.viewModel)==null?void 0:e.bestFeatureAngle,this._navigationTool]},([e,t])=>{t&&this._updateNavigationTool(t)},Ze),O(()=>this.currentCoverageVisible,e=>this._onCurrentCoverageVisibilityChange(e)),O(()=>this.isAdditionalCoverageVisible,e=>this._onAdditionalCoverageVisibilityChange(e)),O(()=>this.isAdditionalPointSourcesVisible,e=>this._onAdditionalCameraLocationsVisibility(e)),O(()=>({features:this.currentBestFeature,showCameraLocations:this.showCameraLocations,state:this.viewModel.state}),({showCameraLocations:e,state:t})=>{t==="image-loaded"&&this.viewModel.overlayCameraLocations(e)},q),O(()=>({feature:this.currentBestFeature,showMapFeatures:this.showMapFeatures,state:this.viewModel.state}),async(e,t)=>{var a;if(e.showMapFeatures!==(t==null?void 0:t.showMapFeatures)&&this.viewModel.toggleAllOverlayMapFeatures(e.showMapFeatures),e.feature!=null&&e.feature!==(t==null?void 0:t.feature)){if(this.viewModel.removeAllOverlayMapFeatures(),await Ir(()=>this.viewModel.state==="image-loaded"),this.dataCaptureLayer&&this.stopDataCapture(),await this._restoreOverlays(),!this.dataCaptureLayer)return;await this.startDataCapture(this.dataCaptureLayer),(a=this._previousAction)!=null&&a.active&&(this._previousAction.active=!1,this._previousAction=null)}},Ze)])}loadDependencies(){return Ja({"action-bar":()=>z(()=>import("./index-BeicfmvH.js"),__vite__mapDeps([477,445,193,1,55,14,12,5,6,2,10,9,11,128,446,447,448,449,450,444,451,452,453,454,455,456,469,460,461,463,470,471,472,473,462,474,475,478,479]),import.meta.url),"action-group":()=>z(()=>import("./index-Cz6Ao6Wl.js").then(e=>e.i),__vite__mapDeps([478,445,193,1,55,14,12,5,6,2,10,9,11,128,446,447,448,449,450,444,451,452,453,454,455,456,469,460,461,463,470,471,472,473,462,474,475]),import.meta.url),action:()=>z(()=>import("./index-BPm91e5Z.js"),__vite__mapDeps([444,445,193,1,55,14,12,5,6,2,10,9,11,128,446,447,448,449,450,451,452,453,454,455,456]),import.meta.url),label:()=>z(()=>import("./index--OBudxYA.js"),__vite__mapDeps([480,193,1,55,14,12,5,6,2,10,9,11,128,481,449,446]),import.meta.url),notice:()=>z(()=>import("./index-CV25o1as.js"),__vite__mapDeps([482,448,193,1,55,14,12,5,6,2,10,9,11,128,449,446,450,453,452,455,483,463,456,447]),import.meta.url),panel:()=>z(()=>import("./index-C6rrpqn6.js").then(e=>e.i),__vite__mapDeps([476,445,193,1,55,14,12,5,6,2,10,9,11,128,446,447,448,449,450,444,451,452,453,454,455,456,469,460,461,463,470,471,472,473,462,474,475,458]),import.meta.url),shell:()=>z(()=>import("./index-DGDPL4q1.js"),__vite__mapDeps([484,193,1,55,14,12,5,6,2,10,9,11,128,451,452,449,446]),import.meta.url),dialog:()=>z(()=>import("./index-DCkSSz85.js"),__vite__mapDeps([485,445,193,1,55,14,12,5,6,2,10,9,11,128,446,447,458,453,452,450,449,448,444,451,454,455,456,469,460,461,463,470,471,472,473,462,474,475,476,486,487,464]),import.meta.url),dropdown:()=>z(()=>import("./index-DVGzfobf.js"),__vite__mapDeps([459,193,1,55,14,12,5,6,2,10,9,11,128,453,452,449,446,460,461,454,462,455,450,463,464]),import.meta.url),"dropdown-group":()=>z(()=>import("./index-XCNLEnDV.js"),__vite__mapDeps([467,193,1,55,14,12,5,6,2,10,9,11,128,450,466]),import.meta.url),"dropdown-item":()=>z(()=>import("./index-C7Sgjfzm.js"),__vite__mapDeps([465,448,193,1,55,14,12,5,6,2,10,9,11,128,449,446,450,453,452,455,456,454,466]),import.meta.url),slider:()=>z(()=>import("./index-09m8YzVy.js"),__vite__mapDeps([488,448,193,1,55,14,12,5,6,2,10,9,11,128,449,446,450,489,453,452,451,490,491,454,462,481,455,492,493,447]),import.meta.url),tooltip:()=>z(()=>import("./index-Bts9-rBr.js"),__vite__mapDeps([494,193,1,55,14,12,5,6,2,10,9,11,128,453,452,460,449,446,461,463,471,451]),import.meta.url)})}destroy(){this._galleryController.abort(),this._galleryObserver.disconnect()}get accuracyParametersMissing(){return this.viewModel.accuracyParametersMissing}get activeLayer(){return Ae(D.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer}set activeLayer(e){Ae(D.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer=e}get currentBestFeature(){return this.viewModel.currentBestFeature}set currentBestFeature(e){this.viewModel.currentBestFeature=e}get currentCoverageVisible(){return this.viewModel.currentCoverageVisible}set currentCoverageVisible(e){this.viewModel.currentCoverageVisible=e}get dataCaptureLayer(){return this.viewModel.dataCaptureLayer}set dataCaptureLayer(e){this.viewModel.dataCaptureLayer=e}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get displayMessage(){return this.viewModel.displayMessage}get features(){return this.viewModel.features}get imagePointsInView(){return this.viewModel.imagePointsInView}get icon(){return"oriented-imagery-widget"}set icon(e){this._overrideIfSome("icon",e)}get imageGalleryEnabled(){return this.viewModel.imageGalleryEnabled}get imageLocationToolActive(){return this.viewModel.imageLocationToolState}set imageLocationToolActive(e){this.viewModel.imageLocationToolState=e}get invalidCameraHeading(){return this.viewModel.invalidCameraHeading}get isAdditionalCoverageVisible(){return this.viewModel.isAdditionalCoverageVisible}set isAdditionalCoverageVisible(e){this.viewModel.isAdditionalCoverageVisible=e}get isAdditionalPointSourcesVisible(){return this.viewModel.isAdditionalPointSourcesVisible}set isAdditionalPointSourcesVisible(e){this.viewModel.isAdditionalPointSourcesVisible=e}get mapImageConversionToolState(){return this.viewModel.mapImageConversionToolState}set mapImageConversionToolState(e){this.viewModel.mapImageConversionToolState=e}get measureType(){return this.viewModel.measureType}set measureType(e){this.viewModel.measureType=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get popupEnabled(){const{popupEnabled:e,state:t}=this.viewModel;return t==="image-loaded"&&e}get referencePoint(){return this.viewModel.referencePoint??null}get sketchViewModel(){return this.viewModel.sketch}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set determineWorkflowForFeature(e){this.viewModel.determineWorkflowForFeature=e}get determineWorkflowForFeature(){return this.viewModel.determineWorkflowForFeature}set updateFootprint(e){this.viewModel.updateFootprint=e}get updateFootprint(){return this.viewModel.updateFootprint}_renderActionBar(){return M("calcite-action-bar",{expandDisabled:!0,layout:"horizontal",slot:"action-bar"},M("calcite-action-group",null,this._currentFootprintToggle(),this._additionalFootprintToggle(),this._additionalPointSourcesToggle()),M("calcite-action-group",null,this._mapImageConversionToggle(),this._navigationToolToggle(),this._imageEnhancementsToggle()),M("calcite-action-group",null,this._measurementToolsToggle(),this._imageGalleryToggle(),this._imageOverlaysToggle(),this._openPopupAction()),this._actionTooltips())}_actionTooltips(){return[...this._actionItems].map(([e,t])=>M("calcite-tooltip",{closeOnClick:!0,key:e,placement:"bottom",referenceElement:t},M("span",null,e)))}get _activeMeasurementIcon(){const{measureType:e,imageLocationToolActive:t}=this;if(t)return"pin-tear";switch(e){case"area":return"measure-area";case"height":return"measure-building-height-top-base";default:return"measure-line"}}get _activeMeasurementHeading(){const{measureType:e,messages:t}=this,{groundArea:a,heightAboveGround:i,groundDistance:r}=t;switch(e){case"area":return a;case"height":return i;default:return r}}_additionalFootprintToggle(){const{isAdditionalCoverageVisible:e,invalidCameraHeading:t,visibleElements:{additionalFootprintToggle:a}}=this;return a?M("calcite-action",{active:e,...this._commonActionProperties,class:$.addCoverage,disabled:t,icon:"trapezoid-area",onclick:this._toggleAdditionalCoverage,text:this.messages.additionalFootprints}):null}_additionalPointSourcesToggle(){const{isAdditionalPointSourcesVisible:e,invalidCameraHeading:t,visibleElements:{additionalCameraLocationsToggle:a}}=this;return a?M("calcite-action",{active:e,...this._commonActionProperties,class:$.addExpPoints,disabled:t,icon:"circle-area",onclick:this._toggleAdditionalCameraLocations,text:this.messages.additionalCameraLocations}):null}get _measurementToggle(){var r;const{viewModel:{state:e,measureType:t},id:a}=this;if(e!=="image-loaded"||!t)return;this._imageMeasurementToolsLoaderTask||this._loadImageMeasurementResources();const i=(r=this._imageMeasurementToolsLoaderTask)==null?void 0:r.value;return i?M("calcite-dialog",{bind:this,dragEnabled:!0,escapeDisabled:!0,heading:this._activeMeasurementHeading,id:`${a}-${t}-measurement`,open:!0,placement:"bottom-start",resizable:!0,scale:"s",slot:"dialogs",width:"s",onCalciteDialogBeforeClose:this._clearMeasurements},M(i,{measurementType:t,measurementUnitMessages:this.measurementUnitMessages,messages:this.messages,oiViewModel:this.viewModel})):null}get _commonActionProperties(){return{afterCreate:this._storeActionElement,afterRemoved:this._removeActionElement,afterUpdate:this._storeActionElement,bind:this}}_renderRoot(){const{viewModel:{state:e}}=this;return M("calcite-panel",null,M("calcite-shell",null,M("calcite-panel",{bind:this,class:$.viewerContainer,heading:this.visibleElements.title?this.messages.title:void 0,loading:e.includes("loading")},this.visibleElements.menu?this._renderActionBar():null,this._imageViewer,this._panoramicViewer,this._messageBox,this.invalidCameraHeading?[this._renderWarning(this.messages.invalidCameraHeadingWarningTitle),this._renderWarningTooltip(this.messages.invalidCameraHeadingWarningDescription)]:[this._imageGalleryPanel,this._renderNavigation,this._imageOverlaysPanel()],this._imageEnhancementTools,this._renderSketch()),this._measurementToggle,this._locationToggle))}_currentFootprintToggle(){const{currentCoverageVisible:e,invalidCameraHeading:t}=this,{currentFootprintToggle:a}=this.visibleElements;return a?M("calcite-action",{active:e,...this._commonActionProperties,class:$.currentCoverage,disabled:t,icon:"trapezoid-area",onclick:this._toggleCurrentCoverage,text:this.messages.currentFootprint}):null}get _imageEnhancementTools(){const{imageEnhancementToolActive:e,viewModel:{brightness:t,contrast:a,sharpness:i,state:r}}=this;return e&&r==="image-loaded"?M("calcite-panel",{bind:this,class:$.imageEnhancementWrapper,closable:!0,closed:!e,heading:this.messages.imageEnhancement,key:this.messages.imageEnhancement,onCalcitePanelClose:this._toggleImageEnhancementToolState},M("div",{class:$.imageEnhancementTools},M("div",{class:$.imageEnhancementToolContainer},M("calcite-label",null,this.messages.brightness,M("calcite-slider",{bind:this,labelTicks:!0,max:10,min:-10,ticks:5,value:t,onCalciteSliderInput:this._handleBrightnessChange}))),M("div",{class:$.imageEnhancementToolContainer},M("calcite-label",null,this.messages.contrast,M("calcite-slider",{bind:this,labelTicks:!0,max:10,min:-10,ticks:5,value:a,onCalciteSliderInput:this._handleContrastChange}))),M("div",{class:$.imageEnhancementToolContainer},M("calcite-label",null,this.messages.sharpness,M("calcite-slider",{bind:this,labelTicks:!0,max:1,min:0,step:.1,ticks:.5,value:i,onCalciteSliderInput:this._handleSharpnessChange})))),M("calcite-action",{bind:this,icon:"reset",onclick:this._resetImageTools,slot:"header-actions-end",text:this.messagesCommon.reset})):null}_imageEnhancementsToggle(){const{state:e,mode:t}=this.viewModel,{imageEnhancement:a}=this.visibleElements;return a?M("calcite-action",{active:this.imageEnhancementToolActive,...this._commonActionProperties,disabled:t!=="default"||e!=="image-loaded",icon:"sliders-horizontal",onclick:this._toggleImageEnhancementToolState,text:this.messages.imageEnhancement}):null}get _imageGalleryPanel(){const{container:e,galleryOpened:t,imageGalleryEnabled:a}=this;return a&&t&&e?this._imageGalleryContext:null}get _imageGalleryContext(){const{galleryOpened:e,invalidCameraHeading:t}=this;return M("calcite-panel",{bind:this,class:$.carousel,closable:!0,closed:!e,disabled:t,heading:this.messages.imageGallery,key:this.messages.imageGallery,onCalcitePanelClose:this._toggleImageGallery},M("div",{class:$.carouselContainer},this._renderThumbnails))}_imageGalleryToggle(){const{imageGalleryEnabled:e,invalidCameraHeading:t,visibleElements:{imageGallery:a}}=this;return a?M("calcite-action",{active:this.galleryOpened,...this._commonActionProperties,disabled:!e||t,icon:"images",onclick:this._toggleImageGallery,text:this.messages.imageGallery}):null}get _imageOverlaysComponent(){var g,f,y;const{_imageOverlayMessages:e,_imageOverlaysLoaderTask:t,_overlayedLayers:a,dataCaptureEnabled:i,dataCaptureLayer:r,imageOverlaysOpened:o,showCameraLocations:s,showMapFeatures:n,view:l,layer:h}=this;if(!h)return null;const m=(g=h.imageGeometryField)!=null&&g.length?h.imageGeometryField:ra,d=(f=h.imageReferenceField)!=null&&f.length?h.imageReferenceField:oa;t||(this._imageOverlaysLoaderTask=ye(async()=>(await z(async()=>{const{default:w}=await import("./ImageOverlays-DOJK5l8P.js");return{default:w}},__vite__mapDeps([495,5,6,1,9,10,11,21,277,278,67,12,2,20,193,55,14,128,496,94,497,498,432,499,500,501,502,503,290,504,420,122,123,7,8,3,13,15,16,17,18,19,22,23,24,25,26,27,28,29,30,31,32,38,124,125,58,59,126,46,47,48,49,50,112,127,129,130,131,34,35,132,61,62,63,64,65,66,68,69,71,72,70,73,0,133,134,135,136,137,138,33,53,54,139,140,98,99,100,102,141,36,37,39,40,41,42,43,44,142,143,144,145,146,147,148,149,150,151,152,153,154,60,89,90,155,156,86,87,88,157,158,77,78,159,103,160,161,104,105,106,108,109,110,111,162,163,164,165,166,167,168,118,119,169,170,171,172,173,174,175,176,91,92,177,115,116,117,178,179,180,51,52,56,57,74,75,76,79,80,81,82,83,84,85,181,113,107,182,183,184,185,186,187,188,189,4,45,93,95,96,97,101,114,190,191,192,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,279,280,281,282,283,284,285,286,287,288,289,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,421,422,423,424,425,426,427,428,429,430,431,433,434,435]),import.meta.url)).default));const p=(y=this._imageOverlaysLoaderTask)==null?void 0:y.value;return p?M(p,{closed:!o,dataCaptureEnabled:i,dataCaptureLayer:r,imageGeometryField:m,imageReferenceField:d,messages:e,overlayedLayers:a,showCameraLocations:s,showMapFeatures:n,view:l,onDataCaptureLayerChanged:this._handleDataCaptureLayerChange,onImageOverlaysClosed:this._onImageOverlayClosed,onLayerDeselected:this._handleOverlayLayerDeselect,onLayerSelected:this._handleOverlayLayerSelect,onShowCameraLocationsChanged:this._onShowCameraLocationsChanged,onShowMapFeaturesChanged:this._onShowMapFeaturesChanged}):null}get _imageOverlayMessages(){return{...this.messages,...this.messagesSketch}}get _imageSketchToolsMessages(){return{...this.messagesSketch,...this.messagesCommon}}_imageOverlaysPanel(){const{imageOverlaysOpened:e,viewModel:{state:t}}=this,a=this.classes({[$.imageOverlaysContainer]:!0,[ct.hidden]:!e||t!=="image-loaded"});return M("div",{class:a,key:this.messages.imageOverlays},this._imageOverlaysComponent)}_imageOverlaysToggle(){const{viewModel:{state:e},imageOverlaysOpened:t,invalidCameraHeading:a,visibleElements:{imageOverlays:i}}=this;return i?M("calcite-action",{active:t,...this._commonActionProperties,disabled:e!=="image-loaded"||a,icon:"layers",onclick:this._toggleImageOverlays,text:this.messages.imageOverlays}):null}get _imageViewer(){const{displayMessage:e,loadImageViewer:t,mode:a}=this.viewModel,i=e!=null||a!=="default",r=this.classes({[$.viewer]:!i,[$.viewerHidden]:i});return M("calcite-panel",{afterCreate:t,bind:this,class:r},this._renderSketch())}get _locationToggle(){const{viewModel:{state:e,groundCoordinates:t},imageLocationToolActive:a,messages:{groundLocation:i}}=this;if(e==="image-loaded"&&t&&a)return M("calcite-dialog",{bind:this,dragEnabled:!0,escapeDisabled:!0,heading:i,id:i,open:!0,placement:"bottom-start",resizable:!0,scale:"s",slot:"dialogs",width:"s",onCalciteDialogBeforeClose:this._clearImageLocation},M(Kn,{groundCoordinates:t,messages:this.messages}))}_mapImageConversionToggle(){const{mapImageConversionToolState:e,viewModel:{state:t},invalidCameraHeading:a,visibleElements:{mapImageConversionTool:i}}=this;return i?M("calcite-action",{active:e,...this._commonActionProperties,disabled:t!=="image-loaded"||a,icon:"image-pin",onclick:this._toggleMapImageConversionToolState,text:this.messages.mapImageConversionTool}):null}_measurementToolsToggle(){const{_activeMeasurementIcon:e,measureType:t,viewModel:a,accuracyParametersMissing:i,messages:r,visibleElements:{measurementTools:o}}=this,{state:s}=a,{measurementTools:n,groundDistance:l,groundArea:h,heightAboveGround:m,groundLocation:d}=r;return o?M("calcite-dropdown",{disabled:i,key:"measurement-tools",width:"m"},M("calcite-action",{...this._commonActionProperties,icon:e,slot:"trigger",text:n}),M("calcite-dropdown-group",null,M("calcite-dropdown-item",{bind:this,disabled:s!=="image-loaded",iconStart:"measure-line",key:"distance-measurement",onclick:p=>this._toggleMeasurementSketch(p,"distance"),selected:t==="distance"},l),M("calcite-dropdown-item",{bind:this,disabled:s!=="image-loaded",iconStart:"measure-area",key:"area-measurement",onclick:p=>this._toggleMeasurementSketch(p,"area"),selected:t==="area"},h),M("calcite-dropdown-item",{bind:this,disabled:s!=="image-loaded",iconStart:"measure-building-height-top-base",key:"height-dropdown",onclick:p=>this._toggleMeasurementSketch(p,"height"),selected:t==="height"},m),M("calcite-dropdown-item",{bind:this,disabled:s!=="image-loaded",iconStart:"pin-tear",key:"surface-location",onclick:p=>this._toggleLocationTool(p),selected:this.imageLocationToolActive},d))):null}get _messageBox(){const{messages:e,viewModel:{displayMessage:t}}=this;if(!t)return null;const{data:a,key:i,map:r}=t,o=`${r?mi(e[i],r):e[i]}`;return M("span",{class:$.messageBox},a?`${o} ${a}`:o)}_navigationToolToggle(){const{state:e}=this.viewModel,{visibleElements:{navigationTool:t}}=this;return t?M("calcite-action",{active:this.navigationToolActive,...this._commonActionProperties,disabled:e!=="image-loaded"||this.invalidCameraHeading,icon:"explore",onclick:this._toggleNavigationTool,text:this.messages.navigationTool}):null}_openPopupAction(){const{showPopupsAction:e}=this.visibleElements;return e?M("calcite-action",{...this._commonActionProperties,disabled:!this.popupEnabled,icon:"popup",onclick:this._toggleImageAttributes,text:this.messages.showPopups}):null}get _panoramicViewer(){const{displayMessage:e,loadPanoramicViewer:t,mode:a}=this.viewModel,i=e!=null||a!=="panoramic",r=this.classes({[$.viewer]:!i,[$.viewerHidden]:i});return M("calcite-panel",{afterCreate:t,bind:this,class:r})}_closeAllImageTools(){this.imageEnhancementToolActive=!1,this.navigationToolActive=!1,this.imageOverlaysOpened=!1,this.galleryOpened=!1,this.measureType=null,this.imageLocationToolActive=!1}_handleBrightnessChange(e){this.viewModel.brightness=e.currentTarget.value??0}_handleContrastChange(e){this.viewModel.contrast=e.currentTarget.value??0}_handleSharpnessChange(e){this.viewModel.sharpness=e.currentTarget.value??0}_lazyLoadImage(e,t){e.forEach(async a=>{if(a.isIntersecting){const i=a.target,r=i.getAttribute("data-src"),o=i.getAttribute("data-rotation"),s=i.getAttribute("data-objectid"),n=o?parseFloat(o)%360:0,{layer:l,_galleryController:{signal:h}}=this;if(!r||!s)return;let m;try{m=nt(r)?await Is(l,s,{signal:h}):await xi(r,{signal:h})}catch(d){ne(d)||D.getLogger("esri.widgets.OrientedImageryViewer").error("#lazyLoadImage()",d)}finally{t.unobserve(i)}if(!m)return;Ps(m,i,n)}})}_loadImageFromGallery(e){var i;const{target:t}=e;if(!t)return;const a=t.getAttribute("data-objectid");a&&((i=this.viewModel.currentBestFeature)==null?void 0:i.attributes.objectId)!==Number(a)&&this.viewModel.selectBestFeature(a)}_loadImageMeasurementResources(){this._imageMeasurementToolsLoaderTask=ye(async()=>{const{default:e}=await z(()=>import("./ImageMeasurementWidget-tawpW0v6.js"),__vite__mapDeps([505,5,6,1,15,12,2,3,193,55,14,10,9,11,128,432,506,122,123,7,8,13,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,38,124,125,58,59,126,46,47,48,49,50,112,127,129,130,131,34,35,67,132,61,62,63,64,65,66,68,69,71,72,70,73,0,133,134,135,136,137,138,33,53,54,139,140,98,99,100,102,141,36,37,39,40,41,42,43,44,142,143,144,145,146,147,148,149,150,151,152,153,154,60,89,90,155,156,86,87,88,157,158,77,78,159,103,160,161,104,105,106,108,109,110,111,162,163,164,165,166,167,168,118,119,169,94,170,171,172,173,174,175,176,91,92,177,115,116,117,178,179,180,51,52,56,57,74,75,76,79,80,81,82,83,84,85,181,113,107,182,183,184,185,186,187,188,189,4,45,93,95,96,97,101,114,190,191,192,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,433,434,435]),import.meta.url);return e})}_loadSketchResources(){this._sketchLoaderTask=ye(async()=>(await z(async()=>{const{default:e}=await import("./SketchTools-CAWgoQbZ.js");return{default:e}},__vite__mapDeps([507,5,6,1,193,55,14,12,2,10,9,11,128]),import.meta.url)).default)}_onAdditionalCoverageVisibilityChange(e){this.viewModel.setAdditionalCoverageVisibility(e)}_onAdditionalCameraLocationsVisibility(e){this.viewModel.setAdditionalCameraLocationsVisibility(e)}_onCurrentCoverageVisibilityChange(e){this.viewModel.setCurrentCoverageVisibility(e)}_registerGalleryItem(e){this._galleryObserver.observe(e)}_renderWarning(e){const{invalidCameraHeading:t,viewModel:{state:a}}=this;return t&&a==="image-loaded"?[M("calcite-notice",{class:$.alert,closable:!0,icon:"exclamation-mark-triangle-f",iconFlipRtl:!0,kind:"warning",open:!0,scale:"s"},M("div",{afterCreate:i=>this._storeWarningTitleElement(i),slot:"title"},e))]:null}_renderWarningTooltip(e){const{_warningTitleElement:t}=this;if(e!=null&&e.length&&t)return M("calcite-tooltip",{closeOnClick:!0,referenceElement:t},e)}get _renderNavigation(){const{viewModel:{sectorData:e,navigatorCurrentBestFeature:t,currentBestFeature:a,state:i}}=this;if(!this.container||!a)return null;let r,o,s,n,l;if(t){const{x:w,y:v,direction:b}=t,[C,F,I,S]=$t[b];r=`M ${w} ${v} L ${C} ${F} A ${k[2]} ${k[2]} 0 0 1 ${I} ${S} Z`,o=w,n=v,s=$t[b][4],l=$t[b][5]}const h=w=>{var b;const v=(b=w.target.dataset)==null?void 0:b.sector;v&&this.viewModel.handleSectorClick(+v)},m=w=>{const v=w.target.dataset;if(!v)return;const{featureIndexInSector:b,sector:C}=v;b&&C&&this.viewModel.handleFeatureClick({sector:C,featureIndexInSector:+b})},d=w=>{w.removeEventListener("click",m)},p=a.attributes.objectId,g=e==null?void 0:e.map(w=>w==null?void 0:w.items).filter(Boolean).flatMap(w=>w==null?void 0:w.map(({x:v,y:b,objectID:C,featureIndexInSector:F,sector:I})=>M("circle",{afterRemoved:d,class:this.classes($.feature,{selected:p===C}),cx:v,cy:b,"data-feature-index-in-sector":F,"data-sector":I,key:`${$.feature}-${C}`,onclick:m,r:Ro}))),f=w=>{w.removeEventListener("click",h)},y=this.classes({[$.navigationWrapper]:!0,[$.navigationZoomed]:this._navigationToolExpanded});return this.navigationToolActive&&i==="image-loaded"?M("div",{bind:this,class:y,key:this.messages.navigationTool},M("svg",{afterCreate:w=>this._storeNavigationToolReference(w),class:br()?ae:$.rotateWithAnimation,focusable:"false",height:Ia,role:"img",width:Ia,xmlns:"http://www.w3.org/2000/svg"},M("defs",null,M("linearGradient",{gradientUnits:"userSpaceOnUse",id:`${this.id}-coverage-fill`,x1:o,x2:s,y1:n,y2:l},M("stop",{class:$.navigationPathOffset0,offset:0}),M("stop",{class:$.navigationPathOffset1,offset:1}))),M("g",null,M("circle",{class:this.classes($.sector,$.outerSector),cx:k[3],cy:k[3],onclick:this._scaleNavigationTool,r:k[3]}),M("circle",{class:$.sector,cx:k[3],cy:k[3],r:k[2]}),M("circle",{class:$.sector,cx:k[3],cy:k[3],r:k[1]}),M("circle",{class:$.sector,cx:k[3],cy:k[3],r:k[0]}),M("path",{class:$.pointer,d:"M 56.5 6.06217782649107 L 60 0 L 63.5 6.06217782649107 Z",key:`${$.pointer}-west`}),M("path",{class:this.classes($.pointer,$.north),d:"M 113.93782217350893 56.5 L 120 60 L 113.93782217350893 63.5 Z",key:`${$.pointer}-north`}),M("path",{class:$.pointer,d:"M 56.5 113.93782217350893 L 60 120 L 63.5 113.93782217350893 Z",key:`${$.pointer}-east`}),M("path",{class:$.pointer,d:"M 6.06217782649107 56.5 L 0 60 L 6.06217782649107 63.5 Z",key:`${$.pointer}-south`}),M("path",{class:this.classes($.sector,$.sectorSeparator),d:"M 23.937554159486076 23.937554159486076 L 96.06244584051393 96.06244584051393 M 23.937554159486076 96.06244584051393 L 96.06244584051393 23.937554159486076",key:$.sectorSeparator}),ws([k[2],k[1],k[0]],k[3],k[3]).map((w,v)=>{var b;return M("path",{afterRemoved:f,class:this.classes($.sector,(b=e==null?void 0:e[v])!=null&&b.length?$.sectorEnabled:$.sectorDisabled),d:w,"data-sector":`${v}`,key:`${$.sector}-${v}`,onclick:h})}),M("path",{class:this.classes($.sector,$.sectorCross),d:"M 56.4 56.4 L 63.53 63.53 M 63.53 56.4 L 56.4 63.53",key:$.sectorCross}),g,a.attributes.cameraPitch>=5&&r?M("path",{class:$.selectedFeaturePath,d:r,fill:`url(#${this.id}-coverage-fill)`,key:$.selectedFeaturePath}):null))):null}_renderSketch(){var o;const{dataCaptureLayer:e,imageOverlaysOpened:t}=this;if(!e||t||(this._sketchLoaderTask||this._loadSketchResources(),!((o=this._sketchLoaderTask)!=null&&o.value)))return null;const{geometryType:a}=e,i=a==="point"?"pin":a==="polyline"?"line":"polygon",r=this._sketchLoaderTask.value;return M("div",{class:$.sketchTools},M(r,{icon:i,messages:this._imageSketchToolsMessages,type:a,onAction:this._onAction}))}get _renderThumbnails(){const{currentBestFeature:e,thumbnails:t}=this.viewModel;return e?M("div",{class:$.carouselContent},t==null?void 0:t.items.map(({url:a,objectId:i,rotation:r},o)=>M("div",{class:`${$.carouselItemWrapper}${e.attributes.objectId===i?"--selected":""}`,key:`${$.carouselItemWrapper}-${o}`},M("canvas",{afterCreate:this._registerGalleryItem,afterRemoved:this._unregisterGalleryItem,alt:`thumbnail-${i}`,class:$.carouselItem,"data-objectid":`${i}`,"data-rotation":`${r}`,"data-src":a,onclick:this._loadImageFromGallery,onmouseenter:this._highlight,onmouseleave:this._removeHighlight})))):null}_resetImageTools(){this.viewModel.sharpness=this.viewModel.brightness=this.viewModel.contrast=0}_storeActionElement(e){this._actionItems.set(e.text,e)}_storeNavigationToolReference(e){this._navigationTool=e}_storeWarningTitleElement(e){this._warningTitleElement=e}_toggleAdditionalCameraLocations(){this.isAdditionalPointSourcesVisible=!this.isAdditionalPointSourcesVisible}_toggleAdditionalCoverage(){this.isAdditionalCoverageVisible=!this.isAdditionalCoverageVisible}_toggleCurrentCoverage(){this.currentCoverageVisible=!this.currentCoverageVisible}_toggleImageEnhancementToolState(e){e.stopPropagation();const t=this.imageEnhancementToolActive;this._closeAllImageTools(),this.imageEnhancementToolActive=!t}_toggleImageOverlays(e){e.stopPropagation();const t=this.imageOverlaysOpened;this._closeAllImageTools(),this.imageOverlaysOpened=!t}_toggleImageGallery(e){e.stopPropagation();const t=this.galleryOpened;this._closeAllImageTools(),this.galleryOpened=!!this.imageGalleryEnabled&&!t}_toggleLocationTool(e){const t=this.imageLocationToolActive;this._closeAllImageTools(),this.imageLocationToolActive=!t,e.stopPropagation()}_toggleMeasurementSketch(e,t){e.stopPropagation();const a=this.measureType;this._closeAllImageTools(),this.measureType=a===t?null:t,this.measureType===t&&(this.viewModel.displayNewMeasurementButton=!0)}_toggleNavigationTool(){const e=this.navigationToolActive;this._closeAllImageTools(),this.navigationToolActive=!e}_toggleMapImageConversionToolState(){this.mapImageConversionToolState=!this.mapImageConversionToolState}_unregisterGalleryItem(e){this._galleryObserver.unobserve(e)}_updateNavigationTool(e){const{previousFeatureAngle:t,bestFeatureAngle:a}=this.viewModel,i=(a-t+540)%360-180;e.style.setProperty(_s,`${t}deg`),e.style.setProperty(bs,`${t+i}deg`)}async loadBestImage(e){return this.viewModel.loadBestImage(e)}loadImageFromSource(e,t){return this.viewModel.loadImageFromSource(e,t)}async overlayMapFeatures(e,t){return this.removeHandles(`${st.overlayed}-${e.id}`),this.addHandles(O(()=>e.visible,()=>{this.viewModel.toggleOverlayMapFeatures(e.id,e.visible)}),`${st.overlayed}-${e.id}`),this._overlayedLayers.add(e),this.viewModel.overlayMapFeatures(e,t&&this.showMapFeatures)}async plotMapPoint(e){return this.viewModel.plotMapPoint(e)}plotReferencePointOnGround(e){this.viewModel.plotReferencePointOnGround(e)}plotReferencePointOnImage(e){this.viewModel.plotReferencePointOnImage(e)}removeOverlayedGraphicsOnImage(e){this.removeHandles(`${st.overlayed}-${e}`),this._overlayedLayers.remove(this._overlayedLayers.find(t=>t.id===e)),this.viewModel.removeOverlayedGraphicsOnImage(e)}resetImage(){this.viewModel.resetImage()}render(){return M("div",{class:this.classes(ct.widget,U)},this._renderRoot())}async startDataCapture(e){return this.viewModel.startDataCapture(e)}async stopDataCapture(e){return this.viewModel.stopDataCapture(e)}updateSuitabilities(e){this.viewModel.updateSuitabilities(e)}};c([u({readOnly:!0})],P.prototype,"accuracyParametersMissing",null),c([u()],P.prototype,"activeLayer",null),c([u()],P.prototype,"currentBestFeature",null),c([u()],P.prototype,"currentCoverageVisible",null),c([u()],P.prototype,"dataCaptureEnabled",void 0),c([u()],P.prototype,"dataCaptureLayer",null),c([u()],P.prototype,"disabled",null),c([u()],P.prototype,"features",null),c([u()],P.prototype,"imagePointsInView",null),c([u()],P.prototype,"galleryOpened",void 0),c([u()],P.prototype,"icon",null),c([u()],P.prototype,"imageEnhancementToolActive",void 0),c([u({readOnly:!0})],P.prototype,"imageGalleryEnabled",null),c([u()],P.prototype,"imageLocationToolActive",null),c([u()],P.prototype,"imageOverlaysOpened",void 0),c([u({readOnly:!0})],P.prototype,"invalidCameraHeading",null),c([u()],P.prototype,"isAdditionalCoverageVisible",null),c([u()],P.prototype,"isAdditionalPointSourcesVisible",null),c([u()],P.prototype,"mapImageConversionToolState",null),c([u()],P.prototype,"measureType",null),c([u()],P.prototype,"layer",null),c([u()],P.prototype,"navigationToolActive",void 0),c([ht(Ao()),u({type:or})],P.prototype,"viewModel",void 0),c([u(),tt("esri/widgets/OrientedImageryViewer/t9n/OrientedImageryViewer")],P.prototype,"messages",void 0),c([u(),tt("esri/core/t9n/Units")],P.prototype,"measurementUnitMessages",void 0),c([u(),tt("esri/t9n/common")],P.prototype,"messagesCommon",void 0),c([u(),tt("esri/widgets/Sketch/t9n/Sketch")],P.prototype,"messagesSketch",void 0),c([u()],P.prototype,"pixelMeasurementUnit",void 0),c([u()],P.prototype,"pixelAreaMeasurementUnit",void 0),c([u({readOnly:!0})],P.prototype,"popupEnabled",null),c([u()],P.prototype,"referencePoint",null),c([u()],P.prototype,"showCameraLocations",void 0),c([u()],P.prototype,"showMapFeatures",void 0),c([ht(["create","delete","redo","undo","update"]),u({readOnly:!0})],P.prototype,"sketchViewModel",null),c([u()],P.prototype,"view",null),c([u({type:sr,nonNullable:!0})],P.prototype,"visibleElements",void 0),c([u()],P.prototype,"determineWorkflowForFeature",null),c([u()],P.prototype,"updateFootprint",null),c([u()],P.prototype,"_actionItems",void 0),c([u()],P.prototype,"_activeMeasurementIcon",null),c([u()],P.prototype,"_activeMeasurementHeading",null),c([u()],P.prototype,"_imageOverlaysLoaderTask",void 0),c([u()],P.prototype,"_imageMeasurementToolsLoaderTask",void 0),c([u()],P.prototype,"_measurementToggle",null),c([u()],P.prototype,"_commonActionProperties",null),c([u()],P.prototype,"_imageEnhancementTools",null),c([u()],P.prototype,"_imageGalleryPanel",null),c([u()],P.prototype,"_imageGalleryContext",null),c([u()],P.prototype,"_imageOverlaysComponent",null),c([u()],P.prototype,"_imageOverlayMessages",null),c([u()],P.prototype,"_imageSketchToolsMessages",null),c([u()],P.prototype,"_imageViewer",null),c([u()],P.prototype,"_locationToggle",null),c([u()],P.prototype,"_messageBox",null),c([u()],P.prototype,"_navigationToolExpanded",void 0),c([u()],P.prototype,"_navigationTool",void 0),c([u()],P.prototype,"_panoramicViewer",null),c([u()],P.prototype,"_warningTitleElement",void 0),c([u()],P.prototype,"_renderNavigation",null),c([u()],P.prototype,"_renderThumbnails",null),c([u()],P.prototype,"_sketchLoaderTask",void 0),P=c([me("esri.widgets.OrientedImageryViewer")],P);const el=P;/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
v4.32.12 */const tl=ur`@layer{arcgis-oriented-imagery-viewer{display:block}}`,al=So(el),qe=class qe extends nr{constructor(){super(...arguments),this.widget=al(this),this._hasOrientedImageryLayerToAdd=!1,this.viewModel=this.widget.viewModel,this.autoDestroyDisabled=!1,this.currentCoverageVisible=this.widget.currentCoverageVisible,this.dataCaptureEnabled=this.widget.dataCaptureEnabled,this.disabled=this.widget.disabled,this.galleryOpened=this.widget.galleryOpened,this.icon=this.widget.icon,this.imageEnhancementToolActive=this.widget.imageEnhancementToolActive,this.imageGalleryEnabled=this.widget.imageGalleryEnabled,this.isAdditionalCoverageVisible=this.widget.isAdditionalCoverageVisible,this.isAdditionalPointSourcesVisible=this.widget.isAdditionalPointSourcesVisible,this.label=this.widget.label,this.layer=this.widget.layer,this.mapImageConversionToolState=this.widget.mapImageConversionToolState,this.navigationToolActive=this.widget.navigationToolActive,this.position="bottom-left",this.referencePoint=this.widget.referencePoint,this.arcgisPropertyChange=lr()("imageGalleryEnabled","layer"),this.arcgisReady=cr()}async destroy(){await this.manager.destroy()}willUpdate(t){if(t.has("orientedImageryLayerItemId")){const a=this.orientedImageryLayerItemId;a&&this.widget&&(this.layer=new Na({portalItem:{id:a}}),this.widget.view?this.widget.view.map.add(this.layer):this._hasOrientedImageryLayerToAdd=!0)}}loaded(){this._hasOrientedImageryLayerToAdd&&(this.widget.view?this._onReady():this.el.addEventListener("arcgisReady",()=>{this._onReady()},{once:!0}))}_onReady(){var a;const{layer:t}=this;t&&((a=this.widget.view)==null||a.map.add(t),this._hasOrientedImageryLayerToAdd=!1)}};qe.properties={autoDestroyDisabled:5,currentCoverageVisible:5,dataCaptureEnabled:5,disabled:5,galleryOpened:5,icon:1,imageEnhancementToolActive:5,imageGalleryEnabled:4,isAdditionalCoverageVisible:5,isAdditionalPointSourcesVisible:5,label:1,layer:0,mapImageConversionToolState:5,navigationToolActive:5,orientedImageryLayerItemId:1,position:1,referenceElement:1,referencePoint:0},qe.shadowRootOptions=hr,qe.styles=tl;let yt=qe;mr("arcgis-oriented-imagery-viewer",yt);const zc=Object.freeze(Object.defineProperty({__proto__:null,ArcgisOrientedImageryViewer:yt},Symbol.toStringTag,{value:"Module"}));export{Tt as A,Un as B,Ac as I,_i as J,Vc as K,Oc as L,Si as N,Sc as S,Oe as T,kc as X,Ec as Y,xc as a,zc as c,Rc as f,$ as i,Lc as k,Tn as u,Tc as x};
