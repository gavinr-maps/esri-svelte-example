const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-BtUFGore.js","./index-DwIhxbHs.js","./jsxFactory-Cnml7uXM.js","./Accessor-BmwT4B0c.js","./intl-Duiy0OzY.js","./Promise-DfET-uns.js","./cast-CsZslgGN.js","./index-4eY77cms.js","./index-Cx51aysm.css","./JSONSupport-DcrLLGjL.js","./Evented-Dw4_VOGn.js","./reactiveUtils-XM7cS2OP.js","./SimpleObservable-CvOkykwM.js","./uuid-Cl5lrJ4c.js","./dom-DEluURzl.js","./guid-ejniuQmw.js","./observers-Co4E8E8j.js","./ref-D9wHsL_T.js","./directive-helpers-DaBykg1t.js","./loadable-XBvaWFYY.js","./interactive-DTzfFku4.js","./key-CZcQa38B.js","./component-CBVlbUuE.js","./useT9n-C1Hrfc-A.js","./index-Dd_Yvsgp.js","./index-CMxz6F2k.js","./index-jjUP6Yam.js","./static-DLD4WjLv.js","./form-BzoUrXC7.js","./label-CHHpnzD0.js","./index-BCDLx0rN.js","./index-DyXGQ9Xl.js","./keyed-CU1C-h1n.js","./index-fFnlo_g2.js","./index-DWeq-ojO.js","./index-pyEU_klK.js","./live-D7NQ-TrC.js","./locale-CXx8I9ox.js","./Validation-BYp9DS84.js","./input-DI9tZAPS.js","./filter-D4A4y0z5.js","./escapeRegExp-CdLjXKbf.js","./debounce-DbkufipY.js","./utils-Dtivty39.js","./index-B0pN5y8B.js","./index-DVGzfobf.js","./floating-ui-IixYHfbQ.js","./openCloseComponent-nqWrSaIH.js","./dynamicClasses-pKEMtFzB.js","./index-BPm91e5Z.js","./index-C7Sgjfzm.js","./resources6-Cs2_VmEC.js","./index-XCNLEnDV.js","./customElement-_nG5icNK.js","./resources5-SciNIBSe.js","./index-Bts9-rBr.js","./FloatingArrow-BZRr6Zld.js","./index-C6d66FVb.js","./index-DMeQur4V.js","./useFocusTrap-COeL24Kx.js","./focusTrapComponent-D1wJZ4RD.js","./index-DK5B8inx.js","./array-BbE1dLa5.js","./index-BYx-hdGk.js","./core-zHisM37C.js","./utils3-Iojtwv7b.js","./index-CP8r2QEY.js","./text-C54aRk62.js","./index-Cl5r3sNd.js","./index-Dwo8yu4W.js","./customElement-BxsvsANk.js","./index-Cl-EVQNh.js","./index-Brz2wqWq.js","./global-BYws3GYH.js","./index-BVlRRyQC.js","./index-Dc6NQLgc.js","./math-BpAtBkbz.js","./index-zL7usBBl.js","./repeat-B6KIBwLP.js","./index--OBudxYA.js","./index-CV25o1as.js","./resources4-Crg87oFz.js","./index-DgqiEeTY.js","./index-DanFJwSx.js","./index-BciJpaKz.js","./index-Bi6d-iof.js","./throttle-DCm6gPaM.js"])))=>i.map(i=>d[i]);
import{_ as w}from"./index-4eY77cms.js";import{g as S,r as l,m as u,a as T,G as ve,o as se,E as Ee,B as ue,a3 as Qe,aR as et,j as _t,k as tt,N as Ae,aO as vt,b0 as Te,av as Re}from"./Accessor-BmwT4B0c.js";import{l as bt}from"./intl-Duiy0OzY.js";import{d as R,v as Ve,P as re,V as Le,A as Ct,w as it}from"./reactiveUtils-XM7cS2OP.js";import{F as Ft,I as wt,X as xt,a as Vt,y as It,i as $e}from"./opacityUtils-Dim20wpZ.js";import{c as st,O as Oe,P as Et}from"./layerUtils-B__v9OBu.js";import{A as At,n as m,c as nt,i as Tt,e as J,O as Rt,T as Lt}from"./jsxFactory-Cnml7uXM.js";import{l as ot,a as at,O as ke,r as $t}from"./FieldInput-CzBlibcv.js";import{m as Ot,_ as Ie,w as kt}from"./FeatureRelationshipViewModel-CSg-U4Be.js";import{isRelatableFeatureSupportedLayer as rt,isAssociatedFeatureSupportedLayer as Me}from"./featureUtils-BovNToiy.js";import{q as be,O as X,Y as Mt,D as Ce,B as Ne,M as Se,P as Nt,S as St,W as Dt,l as lt,I as Pt,L as jt,V as z,A as Ut,b as Fe,U as ut,e as Gt,Z as De,v as Ht,_ as Zt,E as ce,w as Pe,z as Bt,J as Wt,C as zt,t as qt}from"./featureFormUtils-Cjx4R4NB.js";import{b as Jt}from"./Graphic-Dt0LgVGU.js";import{i as Kt}from"./Evented-Dw4_VOGn.js";import{p as Yt,n as je,e as Xt,t as Qt}from"./Promise-DfET-uns.js";import{h as de}from"./UpdatingHandles-CzJ4c3KT.js";import{c as Ue,V as ei}from"./FeatureLayerBase-C4QQJYE9.js";import{l as he,u as Ge,s as ti,y as ii,m as si}from"./formUtils-l8pvwous.js";import{e as ni}from"./editableLayers-CWgCazH-.js";import{P as q,d as me}from"./cast-CsZslgGN.js";import{S as oi}from"./JSONSupport-DcrLLGjL.js";import{m as ai}from"./Portal-CmmHxpLg.js";import{s as ri}from"./ReactiveMap-BHFEHYMj.js";import{t as He}from"./ReactiveSet-DgPcISC1.js";import{n as li}from"./Identifiable-BHVfzH03.js";import{createArcadeProfile as ui,createArcadeExecutor as di}from"./arcade-BRtVPTX5.js";import{e as le}from"./globalCss-vQlnDsEX.js";import{e as dt,n as pi}from"./Heading-BcR6CGTM.js";import{h as ci,n as Ze,a as hi,b as Be}from"./isConnectivityMidspan-Bt3Op6WB.js";import{s as W}from"./substitute-CvdjmBYq.js";import{T as mi,F as yi,j as Q,V as ee,C as te,E as We,b as fi,N as gi}from"./dateUtils-CkANlKbA.js";import{e as _i}from"./vmEvent-D4Ubqkbq.js";const $="esri-feature-form",ye=`${$}__group`,H=`${$}__input`,fe=`${$}__related-records`,x={base:$,form:`${$}__form`,formHeader:`${$}__form-header`,label:`${$}__label`,labelTextContent:`${$}__label-text-content`,fieldInput:`${H}`,inputRadio:`${H}--radio`,inputRadioGroup:`${H}--radio-group`,inputRadioLabel:`${H}--radio-label`,inputDisabled:`${H}--disabled`,inputSwitch:`${H}--switch`,centeredButton:`${$}__centered-button`,description:`${$}__description-text`,listObserver:`${$}__list-observer`,relatedRecordsHeader:`${fe}_header`,relatedRecordsLabel:`${fe}_label`,relatedRecordsList:`${fe}_list`,dateInputContainer:`${`${$}__date`}-input-container`,textElement:`${$}__text-element`,group:ye,groupSequential:`${ye}--sequential`,groupActive:`${ye}--active`};let j=class extends S{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.codedValue=null}};l([u()],j.prototype,"objectType",void 0),l([u()],j.prototype,"maxValue",void 0),l([u()],j.prototype,"minValue",void 0),l([u()],j.prototype,"codedValue",void 0),j=l([T("esri.layers.support.ContingentValue")],j);const E=j;let U=class extends S{constructor(t){super(t),this.isRetired=!1}};l([u()],U.prototype,"id",void 0),l([u()],U.prototype,"isRetired",void 0),l([u()],U.prototype,"subtype",void 0),l([u()],U.prototype,"values",void 0),U=l([T("esri.layers.support.Contingency")],U);const ze=U;let K=class extends S{constructor(t){super(t)}};l([u()],K.prototype,"fieldGroup",void 0),l([u()],K.prototype,"type",void 0),K=l([T("esri.layers.support.ContingencyConstraintViolation")],K);const qe=K;let Y=class extends S{constructor(t){super(t)}};l([u()],Y.prototype,"contingentValuesAllGroups",void 0),l([u()],Y.prototype,"contingentValuesByFieldGroup",void 0),Y=l([T("esri.layers.support.ContingentValuesResult")],Y);const vi=Y;let G=class extends S{constructor(t){super(t),this.fields=null,this.isEditingRestrictive=!1}};l([u()],G.prototype,"name",void 0),l([u()],G.prototype,"fields",void 0),l([u()],G.prototype,"isEditingRestrictive",void 0),l([u()],G.prototype,"contingencies",void 0),G=l([T("esri.layers.support.FieldGroup")],G);const we=G;var ne;let D=ne=class extends oi.JSONSupportMixin(ai){constructor(e){super(e),this.request=q,this.fieldGroups=null,this.fieldGroupDefinitions=null}initialize(){}get subtypeFieldName(){return be(this.layer).typeFieldName}static async createLoadedLayerContingentValuesCache(e){await e.load();const t=e.sourceJSON;if(e.layerId===void 0)return null;const i=t.hasContingentValuesDefinition;if(i)return new ne({layer:e}).load();if(i===void 0){const s=me(e.url);if(s==null)return null;const n=s.url.path;if((await Ke(n)).supportsQueryDataElements){const o=e.layerId.toString(),a=await Je(n,o);if(a){const r=a.map(d=>({name:d.name,isEditingRestrictive:d.isEditingRestrictive,fields:d.fieldNames.names.map(p=>e.fieldsIndex.normalizeFieldName(p))}));return new ne({layer:e,fieldGroupDefinitions:r}).load()}}}return null}async load(e){const t=this.layer.load(e).then(()=>this._initializeContingentValues(this.fieldGroupDefinitions,e));return this.addResolvingPromise(t),this}validateContingencyConstraints(e,t){const i=Object.keys(e),s=[],n=[];for(const o of this.fieldGroups){const a=o.isEditingRestrictive?"error":"warning";if(t&&!o.fields.some(c=>t.includes(c)))continue;if(!o.fields.every(c=>i.includes(c))){n.push(new qe({fieldGroup:o,type:a}));continue}let r=!1;const d=e[this.subtypeFieldName],p=o.contingencies.filter(c=>!(!c.isRetired&&c.subtype)||c.subtype.code===d);if(p.length!==0){for(const c of p){let h=!0;for(const f in c.values){const y=c.values[f];if(y.objectType!=="any"){if(y.objectType==="null"){if(e[f]!=null){h=!1;break}}else if(y.objectType==="code"){if(e[f]!==y.codedValue.code){h=!1;break}}else if(y.objectType==="range"){const g=e[f];if(g<y.minValue||g>y.maxValue){h=!1;break}}}}if(h){r=!0;break}}r||s.push(new qe({fieldGroup:o,type:a}))}}return{invalid:s,incomplete:n}}getContingentValues(e,t,i=!1){const s=e[this.subtypeFieldName],n=s!=null,o={};let a=[];const r=this.fieldGroups.filter(d=>d.fields.includes(t));a.push(new E({objectType:"any"}));for(const d of r){let p=[];const c=d.contingencies.filter(y=>!(y.isRetired||y.subtype&&n&&y.subtype.code!==s));let h=!1;const f={};for(const y of c){let g,b=!0;for(const _ in y.values){const I=y.values[_];if(t!==_){if(e[_]!==void 0&&I.objectType!=="any"){if(I.objectType==="null")e[_]!==null&&(b=!1);else if(I.objectType==="code")e[_]!==I.codedValue.code&&(b=!1);else if(I.objectType==="range"){const k=e[_];(k<I.minValue||k>I.maxValue)&&(b=!1)}}}else g=I,h=h||I.objectType==="range"}if(g&&b){if(g.objectType==="any"){p.length=0,p.push(g);break}const _=bi(g);f[_]||p.push(g),f[_]=!0}}h&&(p=Ci(p)),o[d.name]=p,a=i?xi(a,p):[]}return r.length===1&&i&&(a=[]),new vi({contingentValuesAllGroups:a,contingentValuesByFieldGroup:o})}async _initializeContingentValues(e,t){const i=e??await this._fetchFieldGroupDefs(t);if(i.length===0)return void(this.fieldGroups=[]);const s=await this._fetchContingentValues(i,t);this.fieldGroups=s}async _fetchFieldGroupDefs(e){if(this.layer.layerId===void 0)return[];const t=this.layer.sourceJSON,i=this.layer.layerId.toString(),s=me(this.layer.url).url.path;return t.hasContingentValuesDefinition?(await Vi(s,i,e)).map(n=>({name:n.name,isEditingRestrictive:n.restrictive,fields:n.fields.map(o=>this.layer.fieldsIndex.normalizeFieldName(o))})):t.hasContingentValuesDefinition!==void 0?[]:Ke(s,e).then(async n=>n.supportsQueryDataElements?(await Je(s,i,e)).map(o=>({name:o.name,isEditingRestrictive:o.isEditingRestrictive,fields:o.fieldNames.names.map(a=>this.layer.fieldsIndex.normalizeFieldName(a))})):[])}async _fetchContingentValues(e,t){if(this.layer.layerId===void 0)return[];const i=this.layer.sourceJSON,s=this.layer.layerId.toString(),n=me(this.layer.url).url.path;if(i.hasContingentValuesDefinition){const a=await Ei(n,s,t);return this._constructFieldGroupsAGOL(e,a)}const o=await Ii(n,s,t);return this._constructFieldGroupsEnterprise(e,o)}_constructFieldGroupsAGOL(e,t){return e.map(i=>{const s=t.contingentValuesDefinition.fieldGroups.find(n=>n.name===i.name);if(s){let n=[];return n=t.contingentValuesDefinition.hasSubType?this._parseAGOLFieldGroupSubtype(i,t,s.subTypes):this._parseAGOLFieldGroup(i,t,s.contingentValues),new we({name:i.name,isEditingRestrictive:i.isEditingRestrictive,fields:i.fields,contingencies:n})}return null}).filter(ve)}_parseAGOLFieldGroupSubtype(e,t,i){let s=[];return i==null||i.forEach(n=>{const o=this._getSubtypeAGOL(n.name);s=s.concat(this._parseAGOLFieldGroup(e,t,n.contingentValues,o))}),s}_parseAGOLFieldGroup(e,t,i,s=null){const n=[];for(const o of i??[]){const a=this._parseAGOLContingency(o,e,t,s);n.push(a)}return n}_parseAGOLContingency(e,t,i,s){const n=e.id,o=!!e.retired&&e.retired===1,a={};for(let r=0,d=0;r<t.fields.length;r++){const p=t.fields[r],c=i.typeCodes[e.types[r]];if(c==="Code"){let h=e.values[d];d++;const f=this._getDomain(s,p),y=this.layer.getField(p);if((y==null?void 0:y.type)==="string"){const _=i.stringDicts.find(I=>I.domain===(f==null?void 0:f.name));_&&(h=_.entries[h])}const g=f==null?void 0:f.codedValues.find(_=>_.code===h),b=new E({codedValue:g,objectType:"code"});a[p]=b}else if(c==="Range"){const h=e.values[d];d++;const f=h.range[0],y=h.range[1],g=new E({minValue:f,maxValue:y,objectType:"range"});a[p]=g}else if(c==="Any"){const h=new E({objectType:"any"});a[p]=h}else{const h=new E({objectType:"null"});a[p]=h}}return new ze({id:n,isRetired:o,subtype:s,values:a})}_constructFieldGroupsEnterprise(e,t){const i=t.fieldGroups;return e.map(s=>{const n=i.find(o=>o.name===s.name);if(n){const o=n.contingencies.map(a=>{const r=a.id,d=a.isRetired||!1,p=this._getSubtypeEnterprise(a.subtypeCode),c={};for(let h=0;h<s.fields.length;h++){const f=s.fields[h];let y=a.values[h];if(typeof y=="number"||typeof y=="string"){const g=this._getDomain(p,f),b=this.layer.getField(f);Ft(b)?y=t.stringDictionary[y]:wt(b)&&(y=new Date(`${y}+00:00`).getTime());const _=g==null?void 0:g.codedValues.find(k=>k.code===y),I=new E({codedValue:_,objectType:"code"});c[f]=I}else if(typeof y=="object"){const g=y.minValue,b=y.maxValue,_=new E({minValue:g,maxValue:b,objectType:"range"});c[f]=_}else if(y){const g=new E({objectType:"any"});c[f]=g}else{const g=new E({objectType:"null"});c[f]=g}}return new ze({id:r,isRetired:d,subtype:p,values:c})});return new we({name:s.name,isEditingRestrictive:s.isEditingRestrictive,fields:s.fields,contingencies:o})}return null}).filter(ve)}_getSubtypeEnterprise(e){const t=this.layer.sourceJSON;let i;if(t.subtypes){const s=t.subtypes.find(n=>n.code===e);i=Ue.fromJSON(s)}return i||null}_getSubtypeAGOL(e){const t=this.layer.sourceJSON;let i;if(t.subtypes){const s=t.subtypes.find(n=>n.name===e);i=Ue.fromJSON(s)}return i||null}_getDomain(e,t){const i=e?Ai(e,t):this.layer.getFieldDomain(t);return(i==null?void 0:i.type)==="inherited"?this.layer.getFieldDomain(t):i}};function bi(e){switch(e.objectType){case"any":return"@any@";case"null":return"@null@";case"code":return e.codedValue.name+e.codedValue.code.toString();case"range":return e.minValue.toString()+"-"+e.maxValue.toString()}}function Ci(e){let t,i;e.sort((n,o)=>n.objectType==="null"?-1:o.objectType==="null"?1:n.minValue-o.minValue);const s=[];for(const n of e)n.objectType!=="null"?t!=null&&i!=null?i<n.minValue?(s.push(new E({objectType:"range",minValue:t,maxValue:i})),t=n.minValue,i=n.maxValue):i<n.maxValue&&(i=n.maxValue):(t=n.minValue,i=n.maxValue):s.push(n);return s.push(new E({objectType:"range",minValue:t,maxValue:i})),s}function Fi(e,t){const i=[];let s,n=0;for(const o of e)for(;n<t.length;n++){const a=t[n];if(o.objectType==="null"&&a.objectType==="null")i.push(new E({objectType:"null"}));else{if(o.objectType==="null")break;if(a.objectType==="null")continue}if(o.maxValue<a.minValue)break;if(o.maxValue===a.minValue){i.push(new E({objectType:"range",minValue:o.maxValue,maxValue:a.minValue}));break}if(!(o.minValue>a.maxValue))if(o.minValue!==a.maxValue){if(s=o.minValue>a.minValue?o.minValue:a.minValue,o.maxValue<a.maxValue){i.push(new E({objectType:"range",minValue:s,maxValue:o.maxValue}));break}i.push(new E({objectType:"range",minValue:s,maxValue:a.maxValue}))}else i.push(new E({objectType:"range",minValue:o.minValue,maxValue:a.maxValue}))}return i}function wi(e,t){const i=[];for(const s of e)t.some(n=>{if(s.objectType===n.objectType)switch(s.objectType){case"any":case"null":return!0;case"code":return s.codedValue.code===n.codedValue.code&&s.codedValue.name===n.codedValue.name}return!1})&&i.push(s);return i}function xi(e,t){var n,o;if(e.length===0||t.length===0)return[];if(e[0].objectType==="any")return t;if(t[0].objectType==="any")return e;const i=e[0].objectType==="range"||((n=e[1])==null?void 0:n.objectType)==="range",s=t[0].objectType==="range"||((o=t[1])==null?void 0:o.objectType)==="range";return i||s?Fi(e,t):wi(e,t)}async function Vi(e,t,i){return q(`${e}/${t}/fieldgroups`,{responseType:"json",query:{f:"json"},...i}).then(s=>s.data.fieldGroups??[])}async function Je(e,t,i){return q(`${e}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...i}).then(s=>{var n;return((n=s.data.layerDataElements)==null?void 0:n[0].dataElement.fieldGroups)??[]})}async function Ke(e,t){return q(e,{responseType:"json",query:{f:"json"},...t}).then(i=>i.data)}async function Ii(e,t,i){return q(`${e}/queryContingentValues`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...i}).then(s=>{var n;return(n=s.data.contingentValueSets)==null?void 0:n[0]})}async function Ei(e,t,i){return q(`${e}/${t}/contingentValues`,{responseType:"json",query:{f:"json"},...i}).then(s=>s.data)}function Ai(e,t){const i=e.domains;if(i){const[s,n]=Object.entries(i).find(([o])=>o.trim().toLowerCase()===t.trim().toLowerCase())||[];return n||null}return null}l([u({constructOnly:!0})],D.prototype,"layer",void 0),l([u({constructOnly:!0})],D.prototype,"request",void 0),l([u({type:[we]})],D.prototype,"fieldGroups",void 0),l([u({constructOnly:!0})],D.prototype,"fieldGroupDefinitions",void 0),l([u()],D.prototype,"subtypeFieldName",null),D=ne=l([T("esri.layers.support.LayerContingentValuesCache")],D);const Ti=D,ge="#JSAPI_FORM_EXPRESSIONS_MANAGER_GEOMETRY";let M=class extends S{constructor(t){super(t),this._fieldReferencesLookup=new Map,this._fieldsAffectedLookup=new Map,this.preserveFieldValuesWhenHidden=!0,this._latestFieldValues={...t.feature.attributes}}initialize(){this._dependencyGraph=this._buildDependencyGraph()}destroy(){this.resetExecutors()}get _asyncExecutors(){return this.executors.filter(t=>t.isAsync)}get _baseContext(){const{editType:t,layer:i,map:s,originalFeature:n,spatialReference:o,timeZone:a}=this.arcadeContextInfo,r=(i==null?void 0:i.type)==="scene"&&i.associatedLayer!=null?i.associatedLayer:i;return[{$originalfeature:n,$editcontext:{editType:t},$layer:r,$featureset:r,$datastore:i==null?void 0:i.url,$map:s},{rawOutput:!0,spatialReference:o??void 0,timeZone:a}]}set feature(t){this._latestFieldValues={...t==null?void 0:t.attributes},this._set("feature",t)}evaluateAll(){return this._evaluate(this.executors)}evaluateAsyncExpressions(){return this._evaluate(this._asyncExecutors)}evaluateExpressions(t){return this._evaluate(t)}evaluateInvalidated(t){const{_fieldReferencesLookup:i,_latestFieldValues:s,feature:n}=this,o=new Set;for(const a of t)if(s[a]=n.getAttribute(a),i.has(a))for(const r of i.get(a))o.add(r);return this._evaluate([...o])}async evaluateInvalidatedByGeometry(){if(this._fieldReferencesLookup.has(ge))return this._evaluate([...this._fieldReferencesLookup.get(ge)])}resetExecutors(){for(const t of this.executors)t.reset()}_buildDependencyGraph(){var d;const{_fieldReferencesLookup:t,_fieldsAffectedLookup:i,executors:s,preserveFieldValuesWhenHidden:n}=this,o=new Map(this.fieldInputs.map(p=>[p.name,p])),a=n===!1,r=new Map(s.map(p=>[p,new Array]));for(const p of s){for(const c of p.fieldsUsed){se(t,c,()=>new Set).add(p);const h=o.get(c);[h==null?void 0:h.valueExpressionExecutor,h==null?void 0:h.editableExpressionExecutor,a?(d=h==null?void 0:h.group)==null?void 0:d.visibilityExpressionExecutor:null,a?h==null?void 0:h.visibilityExpressionExecutor:null].filter(f=>f!=null&&f!==p).forEach(f=>{r.get(f).push(p),se(i,f,()=>new Set).add(h)})}p.geometryUsed&&se(t,ge,()=>new Set).add(p)}return r}async _evaluate(t){const i=new Map,{_dependencyGraph:s,_fieldsAffectedLookup:n,_latestFieldValues:o}=this;for(const r of t)pt(r,i,s);for(const[r,{resolver:d,dependencyPromises:p}]of i)Promise.all(p).then(async()=>{const[c,h]=this._makeContext(o);return r.executeAsync(c,h)}).then(()=>{if(n.has(r))for(const c of n.get(r))this._latestFieldValues[c.name]=c.value;d.resolve()},c=>{!c||Ee(c)||Ye(c)||r.markStale(),d.reject(c)});const a=(await Promise.allSettled(Array.from(i.values(),({resolver:r})=>r.promise))).filter(r=>r.status==="rejected"&&!(Ee(r.reason)||Ye(r.reason)));if(a.length>0){const r=new AggregateError(a,`One or more expression executions failed. First error message: ${a[0].reason}`);throw ue.getLogger(this).error(r),r}}_makeContext(t){const[i,s]=this._baseContext,n=this.feature.clone();return n.attributes=t,[{...i,$feature:n},s]}get test(){}};l([u()],M.prototype,"_asyncExecutors",null),l([u()],M.prototype,"_baseContext",null),l([u()],M.prototype,"feature",null),l([u({constructOnly:!0})],M.prototype,"preserveFieldValuesWhenHidden",void 0),l([u()],M.prototype,"executors",void 0),l([u()],M.prototype,"fieldInputs",void 0),l([u()],M.prototype,"arcadeContextInfo",void 0),M=l([T("esri.widgets.FeatureForm.FormExpressionsManager")],M);const pt=(e,t,i)=>{if(t.has(e))return;const s=Qe();t.set(e,{resolver:s,dependencyPromises:[]}),e.abort();const n=i.get(e);for(const o of n)pt(o,t,i),t.get(o).dependencyPromises.push(s.promise)},Ye=e=>e&&typeof e=="object"&&"message"in e&&e.message==="Cancelled";let N=class extends ot{constructor(t){super(t),this._expressionTrackingHandles=new Map,this.id=et().toString(),this.type="group"}initialize(){this.addHandles([R(()=>[this.visible,this.inputs],([t])=>{const{inputs:i}=this,s=!!t&&void 0;for(const n of i)X(n)&&(n.required=s)},{initial:!0,equals:(t,i)=>i[0]===t[0]&&i[1]===t[1]})])}destroy(){for(const t of this._expressionTrackingHandles.values())t.remove()}get initialState(){return this.element.initialState||"expanded"}get inputs(){return this._get("inputs")}set inputs(t){this.removeAllHandles(),t&&this.addHandles(t.map(i=>R(()=>i.visible,()=>this._dirtyEvaluatedVisibilityExpression()))),this._set("inputs",t)}get open(){return this.initialState==="expanded"}set open(t){this._override("open",t)}get visible(){return this.evaluatedVisibilityExpression!==!1&&this.inputs&&this.inputs.some(t=>t.visible)}_dirtyEvaluatedVisibilityExpression(){const{element:t}=this;t.visibilityExpression&&this.notifyChange("evaluatedVisibilityExpression")}};l([u()],N.prototype,"id",void 0),l([u()],N.prototype,"initialState",null),l([u()],N.prototype,"inputs",null),l([u()],N.prototype,"open",null),l([u()],N.prototype,"type",void 0),l([u()],N.prototype,"visible",null),N=l([T("esri.widgets.FeatureForm.GroupInput")],N);const Ri=N,Li=3;let F=class extends at{constructor(e){super(e),this._relationshipVM=null,this.group=null,this.type="relationship",this.addHandles([R(()=>({feature:this.feature,element:this.element,layer:this.layer}),t=>this._createRelationshipVM(t),re),Ve(()=>this.relatedLayer,"edits",()=>{var t;return(t=this._relationshipVM)==null?void 0:t.refresh()})])}destroy(){var e;(e=this._relationshipVM)==null||e.destroy()}get canAddRelatedFeature(){var o;const{editable:e,featureCount:t,relationship:i}=this;if(!i||!this.loaded||!this.relatedLayerAllowsAdds||(o=this.allCategories)!=null&&o.length&&!this.activeCategory)return!1;const{cardinality:s,role:n}=i;return!(s==="one-to-one"&&t>0)&&s!=="many-to-many"&&!(s==="one-to-many"&&n==="destination"&&t>0)&&e}get activeCategory(){var e;return(e=this._relationshipVM)==null?void 0:e.activeCategory}set activeCategory(e){const t=this._relationshipVM;t&&(t.activeCategory=e)}get allCategories(){var s;const{relatedLayer:e}=this,t=(s=this._relationshipVM)==null?void 0:s.categories;if(!st(e))return;const i=(e.subtypes??[]).map(({code:n,name:o})=>{const a=t==null?void 0:t.find(r=>r.name===o);return{name:o,count:(a==null?void 0:a.count)??0,value:(a==null?void 0:a.value)??n}});return i.length?i:null}get categories(){var e;return this.showAllEnabled?this.allCategories:(e=this.allCategories)==null?void 0:e.slice(0,this.displayCount)}get displayCount(){return this.element.displayCount??Li}get displayType(){return this.element.displayType}get editable(){return!!this.relatedLayerAllowsEdits&&(this.evaluatedEditableExpression??!0)}get featureCount(){var e;return((e=this._relationshipVM)==null?void 0:e.featureCount)??0}get label(){var e,t;return(e=this.activeCategory)!=null&&e.name?this.activeCategory.name:this.getFormattedLabel((t=this.element)==null?void 0:t.label)}get loaded(){var e;return((e=this._relationshipVM)==null?void 0:e.state)!=="loading"}get map(){return this._get("map")}set map(e){var t;e&&((t=this._relationshipVM)==null||t.set("map",e)),this._set("map",e)}get orderByFields(){return this.element.orderByFields}get originHasValidKey(){return!(!this.relationship||!this.feature.getAttribute(this.relationship.keyField))}get relationship(){var e;return(e=this._relationshipVM)==null?void 0:e.relationship}get relationshipId(){return this.element.relationshipId}get relatedFeatureInfos(){var a;const{_relationshipVM:e,timeZone:t}=this;if(!((a=e==null?void 0:e.relatedFeatures)!=null&&a.length)||!(e!=null&&e.relatedLayer))return[];const{itemDescriptionFieldName:i,relatedFeatures:s,relatedLayer:n}=e,o=n&&"formTemplate"in n&&n.formTemplate?n.formTemplate.title:void 0;return s.map(r=>{let d;if(i){const p=r.getAttribute(i),c=n.fieldsIndex.get(i);if(c){const h=Mt({values:[p],fields:[c],timeZone:t??void 0})[i];h!=null&&(d=h.toString())}}return{feature:r,description:d,title:o?Ce({label:o,attributes:r.attributes,fieldsIndex:n.fieldsIndex,timeZone:t}):void 0}}).toArray()}get relatedLayer(){var e;return(e=this._relationshipVM)==null?void 0:e.relatedLayer}get relatedLayerIsTable(){var e;return!!((e=this.relatedLayer)!=null&&e.isTable)}get relatedLayerAllowsAdds(){var i;const{relatedLayer:e}=this;if(!e||!this.relatedLayerAllowsEdits)return!1;const t=Oe(e);return!!((i=t==null?void 0:t.operations)!=null&&i.supportsAdd)}get relatedLayerAllowsEdits(){var i;const{relatedLayer:e}=this;if(!e)return!1;const t=Oe(e);return!!((i=t==null?void 0:t.operations)!=null&&i.supportsEditing)}get showAllEnabled(){return this._get("showAllEnabled")}set showAllEnabled(e){var t;(t=this._relationshipVM)==null||t.set("showAllEnabled",e),this._set("showAllEnabled",e)}get showAllActionVisible(){return!this.showAllEnabled&&this.featureCount>0&&this.featureCount>this.displayCount}get showAllCategoriesVisible(){var t;const e=((t=this.allCategories)==null?void 0:t.length)??0;return!this.showAllEnabled&&e>0&&e>this.displayCount}get visible(){const{relationship:e}=this;if(!e)return!1;const{cardinality:t}=e;return t!=="many-to-many"&&(this.evaluatedVisibilityExpression!=null?this.evaluatedVisibilityExpression:this.element!=null)}get updating(){var e,t;return((e=this._relationshipVM)==null?void 0:e.state)==="loading"||((t=this._relationshipVM)==null?void 0:t.state)==="querying"}incrementPage(){this._relationshipVM&&this._relationshipVM.featurePage++}getRelatedFeatureByObjectId(e){var t;return(t=this._relationshipVM)==null?void 0:t.getRelatedFeatureByObjectId(e)}_createRelationshipVM(e){var p;const{feature:t,element:i,layer:s}=e;if((p=this._relationshipVM)==null||p.destroy(),!t||!i||!s)return;const{displayCount:n,map:o,orderByFields:a,relationshipId:r,showAllEnabled:d}=this;rt(s)&&(this._relationshipVM=new Ot({graphic:t,displayCount:n,layer:s,map:o,orderByFields:a,relationshipId:r,showAllEnabled:d}))}};l([u()],F.prototype,"_relationshipVM",void 0),l([u()],F.prototype,"canAddRelatedFeature",null),l([u()],F.prototype,"activeCategory",null),l([u()],F.prototype,"allCategories",null),l([u()],F.prototype,"categories",null),l([u()],F.prototype,"displayCount",null),l([u()],F.prototype,"displayType",null),l([u()],F.prototype,"editable",null),l([u()],F.prototype,"featureCount",null),l([u()],F.prototype,"group",void 0),l([u()],F.prototype,"label",null),l([u()],F.prototype,"loaded",null),l([u()],F.prototype,"map",null),l([u()],F.prototype,"orderByFields",null),l([u()],F.prototype,"originHasValidKey",null),l([u()],F.prototype,"relationship",null),l([u()],F.prototype,"relationshipId",null),l([u()],F.prototype,"relatedFeatureInfos",null),l([u()],F.prototype,"relatedLayer",null),l([u()],F.prototype,"relatedLayerIsTable",null),l([u()],F.prototype,"relatedLayerAllowsAdds",null),l([u()],F.prototype,"relatedLayerAllowsEdits",null),l([u()],F.prototype,"showAllEnabled",null),l([u()],F.prototype,"showAllActionVisible",null),l([u()],F.prototype,"showAllCategoriesVisible",null),l([u({readOnly:!0})],F.prototype,"type",void 0),l([u()],F.prototype,"visible",null),l([u()],F.prototype,"updating",null),F=l([T("esri.widgets.FeatureForm.RelationshipInput")],F);const $i=F;function Oi(e){const t=/{[^{]+?}/g,i=[...e.matchAll(t)];let s=0;const n=[],o=[];for(const a of i){const r=a[0];n.push(e.slice(s,a.index)),o.push(r),s=a.index+r.length}return n.push(e.slice(s)),{literals:n,templates:o}}function ki(e,t){return t.reduce((i,s,n)=>i.concat(e.at(n),s),"").concat(e.at(-1))}let xe;const Mi=["blockquote","html","hr","checkbox","table","tablerow","tablecell","image"];async function Ni(e){return xe||await Si(),xe.parse(e)}async function Si(){const{Marked:e}=await w(()=>import("./marked.esm-lAzAxdAn.js"),[],import.meta.url),t=function({text:o}){return`<span style="text-decoration:line-through;">${o}</span>`},i=function({href:o,text:a,title:r}){return`<a${o!=null?` href="${o}"`:""}${r!=null?` title="${r}"`:""} target="_blank">${a??""}</a>`},s=()=>"",n={};for(const o of Mi)n[o]=s;xe=new e({renderer:{del:t,link:i,...n}})}let L=class extends ot{constructor(t){super(t),this.group=null,this.id=`TextElementInput-${et()}`,this.type="text",this._expressionReferences=new ri,this._expressionsUsed=new He,this._fieldsUsed=new He,this._literalParts=new Le,this._templateParts=new Le,this._updatingHandles=new de}initialize(){const{rawText:t}=this;t?this.textFormat==="markdown"?this._updatingHandles.addPromise(Ni(t).then(i=>this._initializeTextParts(i))):this._initializeTextParts(t):this._literalParts.push("")}get expressionsUsed(){return Array.from(this._expressionsUsed)}get fieldsIndex(){return this.layer.fieldsIndex}set fieldsIndex(t){this._overrideIfSome("fieldsIndex",t)}get fieldsUsed(){return Array.from(this._fieldsUsed)}get rawText(){return this.element.text}get text(){const t=this._templateParts.map(i=>{var s;return`${((s=this._expressionReferences.get(i))==null?void 0:s.lastEvaluatedValue)??""}`});return At.sanitize(ki(this._literalParts,t))}get textFormat(){return this.element.textFormat}get updating(){return this._updatingHandles.updating||Array.from(this._expressionReferences.values()).some(t=>t==null?void 0:t.updating)}setExpressionExecutor(t,i){this._expressionReferences.set(Ne(t),i)}setFieldExecutor(t,i){this._expressionReferences.set(Se(t),i)}_initializeTextParts(t){const{fieldsIndex:i}=this,{literals:s,templates:n}=Oi(t),o=[],a=[];for(let r=0;r<n.length;r++){const d=s[r],p=xt(n[r])[0];if(Nt(p))this._expressionsUsed.add(St(p)),this._expressionReferences.set(p,null),o.push(d),a.push(p);else if(Dt(p)){this._expressionsUsed.add(p);const c=Ne(p);this._expressionReferences.set(c,null),o.push(d),a.push(c)}else if(i!=null&&i.has(p)){const c=i.normalizeFieldName(p);this._fieldsUsed.add(c);const h=Se(c);this._expressionReferences.set(h,null),o.push(d),a.push(h)}else s[r+1]=d.concat(p,s[r+1])}o.push(s.at(-1)),this._literalParts.addMany(o),this._templateParts.addMany(a)}};l([u()],L.prototype,"expressionsUsed",null),l([u()],L.prototype,"fieldsIndex",null),l([u()],L.prototype,"fieldsUsed",null),l([u()],L.prototype,"group",void 0),l([u()],L.prototype,"id",void 0),l([u()],L.prototype,"rawText",null),l([u()],L.prototype,"text",null),l([u()],L.prototype,"textFormat",null),l([u()],L.prototype,"type",void 0),l([u()],L.prototype,"updating",null),L=l([T("esri.widgets.FeatureForm.TextElementInput")],L);const Di=L;let V=class extends li.IdentifiableMixin(at){constructor(e){super(e),this.group=null,this.type="utilityNetworkAssociations",this.featureItem=null,this._updatingHandlesSetUp=new de,this.addHandles([R(()=>({feature:this.feature,element:this.element,layer:this.layer}),t=>this._createAssociationVM(t),re),R(()=>this.feature,()=>this._setFeatureItem()),R(()=>this.associatedLayer,(t,i)=>this._updateLayerEditHandle(t,i),re)])}destroy(){var e;(e=this._associationsVM)==null||e.destroy(),this._updatingHandlesSetUp.destroy()}get activeAssociationType(){var e;return(e=this._associationsVM)==null?void 0:e.activeAssociationType}get associatedFeatures(){const{associatedLayer:e}=this;if(e)return this.associatedFeatureInfos.get(e)}get associatedFeatureInfos(){var s;const{_associationsVM:e}=this;if(!((s=e==null?void 0:e.associationFeatures)!=null&&s.size)||!(e!=null&&e.utilityNetwork))return new Map;const{associationFeatures:t}=e,i=new Map;return t.forEach((n,o)=>{const a=n.map(r=>{if(r.title==null){const d=lt(r.feature);return{...r,title:d}}return r});i.set(o,a)}),i}get associatedLayer(){return this._get("associatedLayer")}set associatedLayer(e){this._associationsVM.showAllEnabled=e!=null,this._set("associatedLayer",e)}get associationsViewModel(){return this._associationsVM}get canAddAssociation(){const{editable:e,utilityNetwork:t}=this;return!(!t||!this.loaded)&&e}get editable(){return this.evaluatedEditableExpression??!0}get featureCount(){var e;return((e=this._associationsVM)==null?void 0:e.featureCount)??0}get viewModel(){return this._associationsVM}get loaded(){var e;return((e=this._associationsVM)==null?void 0:e.state)!=="loading"&&!this._updatingHandlesSetUp.updating}get map(){return this._get("map")}set map(e){var t;e&&((t=this._associationsVM)==null||t.set("map",e)),this._set("map",e)}get utilityNetwork(){var e;return(e=this._associationsVM)==null?void 0:e.utilityNetwork}get associationTypes(){var e;return((e=this._associationsVM)==null?void 0:e.associationTypes)??this.element.associationTypes}get visible(){const{utilityNetwork:e}=this;return!!e&&(this.evaluatedVisibilityExpression!=null?this.evaluatedVisibilityExpression:this.element!=null)}get updating(){var e,t;return((e=this._associationsVM)==null?void 0:e.state)==="loading"||((t=this._associationsVM)==null?void 0:t.state)==="querying"}async refresh(){await _t(this._associationsVM.refresh())}_updateLayerEditHandle(e,t){t&&"layerId"in t&&this.removeHandles(t==null?void 0:t.layerId),Me(e)&&this.addHandles(Ve(()=>e,"edits",()=>this.refresh()),e.layerId)}_createAssociationVM(e){var a;const{feature:t,element:i,layer:s}=e;if((a=this._associationsVM)==null||a.destroy(),!t||!i||!s)return;const{map:n,associationTypes:o}=this;Me(s)&&(this._associationsVM=new Ie({graphic:t,layer:s,map:n,associationTypes:o,source:"featureForm",title:this.label,description:this.description}))}_setFeatureItem(){this._updatingHandlesSetUp.addPromise((async()=>{const{feature:e,layer:t}=this;e&&t&&"getFeatureTitle"in t&&(this.featureItem={feature:e,label:await t.getFeatureTitle(e)})})())}};l([u()],V.prototype,"_associationsVM",void 0),l([u()],V.prototype,"activeAssociationType",null),l([u()],V.prototype,"associatedFeatures",null),l([u()],V.prototype,"associatedFeatureInfos",null),l([u()],V.prototype,"associatedLayer",null),l([u()],V.prototype,"associationsViewModel",null),l([u()],V.prototype,"canAddAssociation",null),l([u()],V.prototype,"editable",null),l([u()],V.prototype,"featureCount",null),l([u()],V.prototype,"viewModel",null),l([u()],V.prototype,"group",void 0),l([u()],V.prototype,"loaded",null),l([u()],V.prototype,"map",null),l([u()],V.prototype,"utilityNetwork",null),l([u()],V.prototype,"associationTypes",null),l([u({readOnly:!0})],V.prototype,"type",void 0),l([u()],V.prototype,"visible",null),l([u()],V.prototype,"updating",null),l([u()],V.prototype,"featureItem",void 0),V=l([T("esri.widgets.FeatureForm.UtilityNetworkAssociationInput")],V);const ct=V;var ht;const Pi=Symbol("FormExpressionArcadeExecutor");let A=class extends S{constructor(e){super(e),this[ht]=!0,this._lastEvaluatedValue=null,this._abortController=new AbortController,this._initialExecutionComplete=!1,this._stale=!1,this._updatingTracking=new de,this._executeAsyncDebounced=tt(async(t,i,s)=>{const n=await this.executor.executeAsync(t,{...i,abortSignal:s});return s.aborted?this._lastEvaluatedValue:(this._lastEvaluatedValue=n,this._stale=!1,n)})}get initialExecutionComplete(){return this._initialExecutionComplete}get isAsync(){return this.executor.isAsync}get fieldsUsed(){return this.executor.fieldsUsed}get syntaxTree(){return this.executor.syntaxTree}get updating(){return this._updatingTracking.updating}get stale(){return this._stale}get geometryUsed(){return this.executor.geometryUsed}get variablesUsed(){return this.executor.variablesUsed}get lastEvaluatedValue(){return this._lastEvaluatedValue}abort(){this._abortController.abort()}execute(e,t){this._abortController=new AbortController;const i=this.executor.execute(e,{...t,abortSignal:this._abortController.signal});return this._lastEvaluatedValue=i,this._initialExecutionComplete=!0,i}async executeAsync(e,t){return this._abortController=new AbortController,this._updatingTracking.addPromise(this._executeAsyncDebounced(e,t??{},this._abortController.signal).then(()=>{this._initialExecutionComplete=!0}))}markStale(){this._stale=!0}reset(){this.abort(),this._lastEvaluatedValue=null,this._stale=!1}};ht=Pi,l([u()],A.prototype,"_lastEvaluatedValue",void 0),l([u()],A.prototype,"_initialExecutionComplete",void 0),l([u()],A.prototype,"_stale",void 0),l([u()],A.prototype,"_updatingTracking",void 0),l([u({constructOnly:!0})],A.prototype,"executor",void 0),l([u()],A.prototype,"initialExecutionComplete",null),l([u()],A.prototype,"isAsync",null),l([u()],A.prototype,"fieldsUsed",null),l([u()],A.prototype,"syntaxTree",null),l([u()],A.prototype,"updating",null),l([u()],A.prototype,"stale",null),l([u()],A.prototype,"geometryUsed",null),l([u()],A.prototype,"variablesUsed",null),l([u()],A.prototype,"lastEvaluatedValue",null),A=l([T("esri.widgets.support.forms.expressions.FormExpressionArcadeExecutor")],A);const ji=async(e,t)=>{const i=ui("form-calculation"),s=await di(e,i,{});return t!=null&&t.fieldsIndex&&(s.fieldsUsed=Vt(t.fieldsIndex,s.fieldsUsed)),new A({executor:s})},_e=new Jt({attributes:{}}),Ui={field:["editableExpression","requiredExpression","valueExpression","visibilityExpression"],group:["visibilityExpression"],relationship:["editableExpression","visibilityExpression"],text:["visibilityExpression"],utilityNetworkAssociations:["editableExpression","visibilityExpression"]},Gi="#JSAPI_CONTINGENT_VALUE_EMPTY_HASH",Z="#JSAPI_CONTINGENT_VALUE_ANY_HASH",Hi="#JSAPI_CONTINGENT_VALUE_NULL_HASH",mt="esri.widgets.FeatureForm.FeatureFormViewModel",yt=()=>ue.getLogger(mt);let v=class extends Yt.EsriPromiseMixin(Kt.EventedAccessor){constructor(e){super(e),this._expressionExecutorsInUse=new Set,this._expressionExecutorLookup=new Map,this._expressionsManager=null,this._contingentValuesCache=null,this._featureClone=_e.clone(),this._initialFeature=_e.clone(),this._timeZone=null,this._updatingHandles=new de,this.activeAssociation=null,this.arcadeEditType="NA",this.contingencyConstraintViolations=new Map,this.disabled=!1,this.highlightHelper=null,this.inputs=[],this.map=null,this.callbacks=null,this.strict=!1,this.pendingSubtypeChoice=null,this._updateInputs=tt(async()=>{this._stopExpressions();const{_featureClone:t,_initialFeature:i,arcadeEditType:s,formTemplate:n,inputs:o,layer:a,timeZone:r}=this;if(!a)return;const d={arcadeEditType:s,feature:t,initialFeature:i,layer:a,timeZone:r},p=o.slice(),c=n!=null&&n.elements&&n.elements.length>0?await this._updateInputsUsingFormElements(p,n.elements,d):this._updateInputsUsingLayerFields(p,a==null?void 0:a.fields,d);this.inputs=c,await this._startExpressions()})}initialize(){const e=R(()=>{var s;return[this.layer,!!((s=this.layer)!=null&&s.loaded),this.formTemplate,this.feature,this.timeZone,this.arcadeEditType]},([s,n])=>{s!=null&&(n?this._updatingHandles.addPromise(this._updateInputs()):s.load().catch(()=>{}))},Ct),t=R(()=>this._arcadeContextInfo,s=>{this._expressionsManager!=null&&(this._expressionsManager.arcadeContextInfo=s,this._updatingHandles.addPromise(this._expressionsManager.evaluateAll().finally(()=>this._afterExpressionsEvaluated())))}),i=R(()=>this.layer,s=>{const n=(s==null?void 0:s.type)==="subtype-sublayer"?s.parent:(s==null?void 0:s.type)==="feature"?s:null;n&&this.addResolvingPromise(Ti.createLoadedLayerContingentValuesCache(n).then(o=>{this._contingentValuesCache=o,this.notifyChange("fieldsWithContingentValues")}))},{initial:!0});this.addHandles([e,t,i])}destroy(){var e;this.feature=null,this.layer=null,this._contingentValuesCache=Ae(this._contingentValuesCache),(e=this.highlightHelper)==null||e.removeAll(),this._updatingHandles.destroy()}get _expressionInfosLookup(){var e,t;return new Map((t=(e=this.formTemplate)==null?void 0:e.expressionInfos)==null?void 0:t.map(i=>[i.name,i]))}get activeAssociationInput(){return this.allAssociationInputs.find(e=>e.uid===this.associationId)}get activeRelationshipInput(){return this.allRelationshipInputs.find(e=>e.relationshipId===this.relationshipId||e.activeCategory||e.showAllEnabled)}get _arcadeContextInfo(){const{_initialFeature:e,arcadeEditType:t,layer:i,map:s,spatialReference:n,timeZone:o}=this;return{layer:ni(i)?i:null,originalFeature:e,editType:t,map:s,spatialReference:n,timeZone:o}}get associationId(){return this._get("associationId")}set associationId(e){var t;e==null&&((t=this.activeAssociationInput)!=null&&t.viewModel)&&(this.activeAssociationInput.associatedLayer=null,this.activeAssociationInput.viewModel.activeAssociationType=null),this._set("associationId",e)}get associatedLayer(){var e;return(e=this.activeAssociationInput)==null?void 0:e.associatedLayer}set associatedLayer(e){this.activeAssociationInput&&(this.activeAssociationInput.associatedLayer=e)}get allAssociationInputs(){return Pt(this.inputs)}get allFieldInputs(){return jt(this.inputs)}get allGroupInputs(){return this.inputs.filter(z)}get allRelationshipInputs(){return Ut(this.inputs)}get _layerFieldsByName(){var e;return new Map((e=this.layer)==null?void 0:e.fields.map(t=>[t.name,t]))}get feature(){return this._get("feature")}set feature(e){const t=this._get("feature");this._featureClone=e?e.clone():_e.clone(),this._initialFeature=this._featureClone.clone(),this._expressionsManager&&(this._expressionsManager.feature=this._featureClone),e?(this._resetFieldInputValues(this._featureClone),this.allRelationshipInputs.forEach(i=>i.feature=e)):(this.inputs.forEach(i=>i.destroy()),this.inputs.length=0),t!==e&&(this.pendingSubtypeChoice=null),this.contingencyConstraintViolations.clear(),this._set("feature",e)}get fieldsWithContingentValues(){if(this._contingentValuesCache==null)return new Set;const e=this._contingentValuesCache.fieldGroups.flatMap(t=>t.fields);return new Set(e)}get formTemplate(){return this.layer&&"formTemplate"in this.layer?this.layer.formTemplate:null}set formTemplate(e){e===void 0?this._clearOverride("formTemplate"):this._override("formTemplate",e)}get formDescription(){const{formTemplate:e,layer:t}=this;return e!=null&&e.description&&t?Ce({label:e.description,attributes:this.getValues(),fieldsIndex:t.fieldsIndex,timeZone:this.timeZone}):null}get formTitle(){const{formTemplate:e,layer:t}=this;return e!=null&&e.title&&t?Ce({label:e.title,attributes:this.getValues(),fieldsIndex:t.fieldsIndex,timeZone:this.timeZone}):null}get formHeaderVisible(){const{activeRelationshipInput:e,activeAssociationInput:t,formDescription:i,formTitle:s}=this;return!(e||t||!i&&!s)}get joinedContingentValues(){return this._joinContingentValues()}get layer(){var e;return(e=this.feature)!=null&&e.sourceLayer&&"applyEdits"in this.feature.sourceLayer?this.feature.sourceLayer:null}set layer(e){this._override("layer",e)}get relationshipId(){return this._get("relationshipId")}set relationshipId(e){const t=this.allRelationshipInputs;if(e!=null&&e===this.relationshipId||t.forEach(i=>{i.showAllEnabled=!1,i.activeCategory=null}),e!=null){const i=t.find(s=>s.relationshipId===e);i&&(i.showAllEnabled=!0)}this._set("relationshipId",e)}get spatialReference(){var e;return((e=this.layer)==null?void 0:e.spatialReference)??null}set spatialReference(e){this._override("spatialReference",e)}get state(){var e;return(e=this.layer)!=null&&e.loaded?"ready":"disabled"}get submittable(){return!!this.valid||this.allFieldInputs.filter(e=>!e.valid).every(({submittable:e})=>e)}get timeZone(){const{layer:e}=this;if(e&&"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone)return je;const t=e&&"preferredTimeZone"in e&&e.preferredTimeZone;return this._timeZone===Qt?t||je:this._timeZone||Xt}set timeZone(e){this._timeZone=e}get updating(){return this._updatingHandles.updating}get valid(){const e=this.allFieldInputs;return e.length>0&&e.every(({valid:t})=>t)}findField(e){return this.allFieldInputs.find(t=>t.name===e)}getFieldValueOptionsForField(e,t){var a;const i=this.findField(e);if(!i)return[[],[],[]];const s=((a=i.domain)==null?void 0:a.type)==="coded-value"?i.domain.codedValues.map(({name:r,code:d})=>({name:r,value:d})):[],n=i.value==null||s.some(r=>r.value===i.value)?[]:[{name:`${i.value}`,value:i.value}],o=this.fieldsWithContingentValues.has(e)?this._getContingentValueOptionsForField(e,t):[];if(o.length>0){const r=new Set(o.map(d=>d.value));return[o,s.filter(d=>!r.has(d.value)),n]}return[s,[],n]}getValue(e){var i;const t=(i=this.layer)==null?void 0:i.getField(e);if(t!=null)return this._featureClone.getAttribute(t.name)??null}setValue(e,t){const{_featureClone:i,strict:s}=this,n=this.findField(e);t=t===""?null:t,n&&i.getAttribute(e)!==t&&(n.value=t,s&&!n.valid||(this._afterValueChange(n),this._expressionsManager!=null&&this._updatingHandles.addPromise(this._expressionsManager.evaluateInvalidated([n.name]).finally(()=>this._afterExpressionsEvaluated()))))}getValues(){return{...this._featureClone.attributes}}overrideInitialFeature(e){this._initialFeature=e}submit(){const e=this.allFieldInputs,t=new Set(e.filter(n=>n.valid).map(({name:n})=>n)),i=e.filter(n=>!n.valid).map(({name:n})=>n),s=this.getValues();if(this.validateContingencyConstraints(s,{includeIncompleteViolations:!0}).length>0)for(const[n,o]of this.contingencyConstraintViolations.entries())o.type==="error"&&(t.delete(n),i.push(n));this.notifyChange("submittable"),this.notifyChange("valid"),this.emit("submit",{valid:[...t],invalid:i,values:s})}validateContingencyConstraints(e,t){const{_contingentValuesCache:i}=this,s=new Map;if(this.contingencyConstraintViolations=s,i==null)return[];const{invalid:n,incomplete:o}=i.validateContingencyConstraints(e),a=[...n,...t!=null&&t.includeIncompleteViolations?o:[]];for(const r of a)for(const d of r.fieldGroup.fields)s.set(d,r);return a}notifyFeatureGeometryChanged(){const{_expressionsManager:e,feature:t,_featureClone:i}=this;t&&(i.geometry=t.geometry,e!=null&&this._updatingHandles.addPromise(e.evaluateInvalidatedByGeometry().finally(()=>this._afterExpressionsEvaluated())))}applySubtypeDefaults(e){const{defaultValues:t}=e,{allFieldInputs:i}=this;for(const{name:s}of i){const n=t[s];n!=null&&this.setValue(s,n)}}_emitChangeEvent({name:e,valid:t,value:i}){this.emit("value-change",{layer:this.layer,feature:this.feature,fieldName:e,value:i,valid:t})}async _updateInputsUsingFormElements(e,t,i){const s=new Map;for(const a of e)if(z(a)){s.set(a.element,a);for(const r of a.inputs)r.element&&s.set(r.element,r)}else a.element&&s.set(a.element,a);const n=new Map,o=await this._updateInputsUsingFormElementsRecursive({existingInputsByElement:s,updatedElements:t.filter(Xe),sharedInitializationProperties:i,group:null,newExpressionExecutorPromises:n});for(const[a,r]of s.entries())s.delete(a),r.destroy();return await Promise.all(Array.from(n.values())),o}async _updateInputsUsingFormElementsRecursive(e){const{existingInputsByElement:t,updatedElements:i,sharedInitializationProperties:s,group:n,newExpressionExecutorPromises:o}=e,a=[];for(const r of i){const d=t.has(r),p=d?t.get(r):this._makeInputFromElement(r,s,n);if(p){if(a.push(p),await it(()=>!p.updating),this._assignExpressionExecutors(p,r,o),d)if(t.delete(r),z(p)){const{feature:c,timeZone:h}=s;p.set({feature:c,timeZone:h})}else if(Fe(p)){const c=this.relationshipId===r.relationshipId;p.set(s),p.set({map:this.map,showAllEnabled:c})}else he(p)?(p.set(s),p.set({map:this.map})):p.set(s);if(Ge(r)){const c=r.elements.filter(h=>Xe(h));p.inputs=await this._updateInputsUsingFormElementsRecursive({existingInputsByElement:t,updatedElements:c,sharedInitializationProperties:s,group:p,newExpressionExecutorPromises:o})}}}return a}_updateInputsUsingLayerFields(e,t,i){var o,a;if(!Array.isArray(t))return yt().warn(this.declaredClass,"No attribute fields found."),[];const s=new Map;for(const r of e)if(z(r)){for(const d of r.inputs)d.destroy();r.inputs.length=0,r.destroy()}else Fe(r)?r.destroy():X(r)&&(r.element!==null?r.destroy():s.set(r.field,r));const n=[];for(const r of t){const d=((o=i.feature)==null?void 0:o.getAttribute(r.name))??null,p=s.get(r)??new ke({field:r,preservesValueWhenHidden:(a=this.formTemplate)==null?void 0:a.preserveFieldValuesWhenHidden});n.push(p.set({...i,value:d})),s.delete(r)}for(const[r,d]of s.entries())s.delete(r),d.destroy();return n}_resetFieldInputValues(e){for(const t of this.allFieldInputs)t.value=e.getAttribute(t.name)}_makeInputFromElement(e,t,i){return Ge(e)?Zi(e,t):ti(e)?this._makeFieldInputFromElement(e,t,i):ii(e)?this._makeRelationshipInputFromElement(e,t,i):he(e)?this._makeUtilityNetworkAssociationInputFromElement(e,t,i):si(e)?Bi(e,t):he(e)?this._makeUtilityNetworkAssociationInputFromElement(e,t,i):vt()}_makeFieldInputFromElement(e,t,i){var c;const{arcadeEditType:s,feature:n,initialFeature:o,layer:a,timeZone:r}=t,{fieldName:d}=e,p=d&&this._layerFieldsByName.get(d);return p?new ke({arcadeEditType:s,element:e,field:p,value:(n==null?void 0:n.getAttribute(e.fieldName))??null,feature:n,initialFeature:o,layer:a,group:i,preservesValueWhenHidden:(c=this.formTemplate)==null?void 0:c.preserveFieldValuesWhenHidden,timeZone:r}):null}_makeRelationshipInputFromElement(e,t,i=null){const{map:s}=this,{feature:n,layer:o,timeZone:a}=t,r=new $i({element:e,feature:n,group:i,layer:o,map:s,timeZone:a});return r.addHandles(Ve(()=>r.relatedLayer,"edits",()=>{var d;return(d=this._expressionsManager)==null?void 0:d.evaluateAsyncExpressions()})),r}_makeUtilityNetworkAssociationInputFromElement(e,t,i=null){const{map:s}=this,{feature:n,layer:o,timeZone:a}=t;return new ct({element:e,feature:n,group:i,layer:o,map:s,timeZone:a})}_assignExpressionExecutors(e,t,i){var o;const s=Ui[t.type],n=[];for(const a of s){const r=`${a}Executor`;if(e[r]){this._useExecutor(e[r]);continue}const d=t[a];if(d!=null&&d!==""){const p=((o=this._expressionInfosLookup.get(d))==null?void 0:o.expression)??d;n.push(this._getOrCreateExecutorForExpression(p,i).then(c=>{e[r]=this._useExecutor(c)}))}}return ut(e)&&n.push(...this._assignTextElementExpressionExecutors(e,i)),n}_assignTextElementExpressionExecutors(e,t){const{_expressionInfosLookup:i}=this,s=[];for(const n of e.expressionsUsed){const o=i.get(n);o!=null?s.push(this._getOrCreateExecutorForExpression(o.expression,t).then(a=>e.setExpressionExecutor(n,this._useExecutor(a)))):ue.getLogger(this).error("feature-form:expression-not-found",`Could not find expressionInfo object with name '${n}'`)}for(const n of e.fieldsUsed){const o=`return $feature['${n}'];`;s.push(this._getOrCreateExecutorForExpression(o,t).then(a=>e.setFieldExecutor(n,this._useExecutor(a))))}return s}async _getOrCreateExecutorForExpression(e,t){const{_expressionExecutorLookup:i}=this;if(i.has(e))return i.get(e);if(t.has(e))return t.get(e);const s=ji(e,this.layer);t.set(e,s);const n=await s;return i.set(e,n),n}_createExpressionsManager(e){const{_arcadeContextInfo:t,_featureClone:i,allFieldInputs:s,formTemplate:n}=this;this._expressionsManager=new M({executors:e,feature:i,arcadeContextInfo:t,fieldInputs:s,preserveFieldValuesWhenHidden:(n==null?void 0:n.preserveFieldValuesWhenHidden)===!0})}async _startExpressions(){if(this._expressionExecutorsInUse.size===0)return;const e=Array.from(this._expressionExecutorsInUse);this._createExpressionsManager(e),await this._expressionsManager.evaluateAll().finally(()=>this._afterExpressionsEvaluated())}_stopExpressions(){this._expressionsManager=Ae(this._expressionsManager),this._expressionExecutorsInUse.clear()}_useExecutor(e){return this._expressionExecutorsInUse.add(e),e}_afterValueChange(e){var p;const{name:t,value:i}=e,{_featureClone:s,formTemplate:n,layer:o}=this;if(!o)return;const a=s.getAttribute(t);s.setAttribute(t,i);const{typeFieldName:r,types:d}=be(o);if((e.isSubtypeField||t===r)&&i!==a){if(o.type==="subtype-sublayer"){const h=(p=o.parent)==null?void 0:p.findSublayerForFeature(s);h&&(this.feature&&(this.feature.sourceLayer=h),s.sourceLayer=h)}const c=new Set;for(const h of d)if(h.domains&&typeof h.domains=="object")for(const f of Object.keys(h.domains))c.add(f);for(const h of c){const f=this.findField(h);f&&f.notifyChange("domain")}this.notifyChange("joinedContingentValues")}if(n!=null){const{description:c,title:h}=n;h&&Te(h,t)&&this.notifyChange("formTitle"),c&&Te(c,t)&&this.notifyChange("formDescription")}this._emitChangeEvent(e)}_afterExpressionsEvaluated(){const{_featureClone:e}=this;for(const t of this.allFieldInputs)t.value!==e.getAttribute(t.name)&&this._afterValueChange(t)}_joinContingentValues(){const e=this._contingentValuesCache;if(e==null)return[];const{typeFieldName:t}=be(this.layer),i=t?this.getValue(t):null,s=[];for(const a of e.fieldGroups){const{contingencies:r,fields:d,name:p}=a,c=[];for(const h of r)h.isRetired||h.subtype!=null&&h.subtype.code!==i||c.push({values:h.values});c.length>0&&s.push({name:p,fields:d,contingencies:c})}const[n,o]=this._generateJoinPlan(s);return[...n.flatMap(a=>this._joinFieldGroupContingencies(a)),...o.flatMap(a=>a.contingencies)]}_generateJoinPlan(e){const t=new Map,i=[],s=new Set;for(const d of e)for(const p of d.fields)if(t.has(p)){const c=t.get(p),h=d,f=[c.name,h.name].sort().join("|");if(s.has(f))continue;i.push([c,h]),s.add(f),t.set(p,h)}else t.set(p,d);const n=new Set(i.flat()),o=new Set(e);for(const d of n)o.delete(d);const a=new Map,r=new Map;for(const d of new Set(i.flat())){const p=Symbol(d.name);a.set(p,new Set([d])),r.set(d,p)}for(const[d,p]of i){const c=r.get(d),h=r.get(p);if(c===h)continue;const f=a.get(c),y=a.get(h);for(const g of y)f.add(g),r.set(g,c);a.delete(h)}return[[...a.values()].map(d=>[...d]),[...o]]}_joinFieldGroupContingencies(e){var d,p;const t=e.slice(),i=t.shift();let s=t.shift(),n=this._generateJoinKey(i.fields,s.fields),o=new Set([...i.fields,...s.fields]),a=new Map;for(const c of i.contingencies){const[h]=this._hashContingency(c,n.codedValueFields,!0);a.has(h)?(d=a.get(h))==null||d.push(c):a.set(h,[c])}for(;t.length>0;){const c=new Map,h=t.shift(),f=this._generateJoinKey(o,h.fields);for(const y of s.contingencies){const[g,b]=this._hashContingency(y,n.codedValueFields),_=b?this._findMatchingContingenciesWithAnyHashMask(a,g):a.get(g);if(a.has(Z)&&(_==null||_.push(...this._findMatchingContingenciesContainingAny(y,a.get(Z),n.codedValueFields))),_!=null)for(const I of _){const k=n.rangeFields.length>0?this._joinContingenciesWithRangeDomains(I,y,n.rangeFields):this._joinContingencies(I,y);if(k==null)break;const[pe]=this._hashContingency(k,f.codedValueFields,!0);c.has(pe)?(p=c.get(pe))==null||p.push(k):c.set(pe,[k])}}a=c,s=h,n=f,o=new Set([...o,...s.fields])}const r=[];for(const c of s.contingencies){const[h,f]=this._hashContingency(c,n.codedValueFields),y=f?this._findMatchingContingenciesWithAnyHashMask(a,h):a.get(h);if(a.has(Z)&&y.push(...this._findMatchingContingenciesContainingAny(c,a.get(Z),n.codedValueFields)),y!=null)for(const g of y){const b=n.rangeFields.length>0?this._joinContingenciesWithRangeDomains(g,c,n.rangeFields):this._joinContingencies(g,c);b!=null&&r.push(b)}}return r}_joinContingencies(e,t){const i={values:{...e.values,...t.values}};for(const[s,n]of Object.entries(i.values))n.objectType==="any"&&e.values[s]!=null&&(i.values[s]=e.values[s]);return i}_joinContingenciesWithRangeDomains(e,t,i){const s=this._joinContingencies(e,t);for(const n of i){const o=e.values[n],a=t.values[n],{leftIsNull:r,rightIsNull:d,bothAreNull:p,leftIsAny:c,rightIsAny:h,bothAreAny:f,leftIsRange:y,rightIsRange:g}=this._compareObjectTypes(o.objectType,a.objectType);if(p||f)continue;if(r&&h||d&&c){s.values[n]=new E({objectType:"null"});continue}if(r&&g||d&&y)return null;c?(o.minValue=-1/0,o.maxValue=1/0):h&&(a.minValue=-1/0,a.maxValue=1/0);const b=Math.max(o.minValue,a.minValue),_=Math.min(o.maxValue,a.maxValue);if(b>_)return null;s.values[n]=new E({objectType:"range",minValue:b,maxValue:_})}return s}_findMatchingContingenciesContainingAny(e,t,i){return t.filter(s=>i.every(n=>{var r,d;const o=s.values[n],a=e.values[n];return o.objectType==="any"||a.objectType==="any"||((r=o.codedValue)==null?void 0:r.code)===((d=a.codedValue)==null?void 0:d.code)}))}_findMatchingContingenciesWithAnyHashMask(e,t){const i=RegExp(`${t}$`),s=[];for(const[n,o]of e){if(n===Z)break;i.test(n)&&s.push(...o)}return s}_generateJoinKey(e,t){var p;const i=Array.isArray(e)?new Set(e):e,s=Array.isArray(t)?new Set(t):t,n=i.size<s.size?i:s,o=n===i?s:i,{feature:a}=this,r=new Set,d=new Set;for(const c of n)if(o.has(c)){const h=(p=this.layer)==null?void 0:p.getFieldDomain(c,{feature:a??void 0,excludeImpliedDomains:!0});if(h==null)continue;switch(h.type){case"coded-value":r.add(c);break;case"range":d.add(c)}}return{codedValueFields:[...r],rangeFields:[...d]}}_contingencyIsValid(e,t){const i={};for(const{name:s,value:n}of this.allFieldInputs)this.fieldsWithContingentValues.has(s)&&n!=null&&s!==e&&(i[s]=n);return Object.entries(i).every(([s,n])=>!t.values.hasOwnProperty(s)||Gt(n,t.values[s]))}_getContingentValueOptionsForField(e,t){const i=this.joinedContingentValues.slice(),s=new Map,n={code:"",name:t??"No value"};for(const o of i){const a=o.values[e];if((a==null?void 0:a.objectType)==="code"||(a==null?void 0:a.objectType)==="null"){const{code:r,name:d}=a.codedValue&&a.objectType!=="null"?a.codedValue:n;!s.has(r)&&this._contingencyIsValid(e,o)&&s.set(r,{name:d,value:r})}}return[...s.values()]}_hashContingency(e,t,i=!1){var o;if(t.length<1)return[Gi,!1];const s=[];let n=!1;for(const a of t){const r=e.values[a];if(r.objectType==="any"){if(i)return[Z,!0];n=!0,s.push(`${a}:.*`)}else r.objectType==="null"?s.push(`${a}:${Hi}`):s.push(`${a}:${(o=r.codedValue)==null?void 0:o.code}`)}return[s.sort().join("&"),n]}_compareObjectTypes(e,t){return{leftIsNull:e==="null",rightIsNull:t==="null",bothAreNull:e==="null"&&t==="null",leftIsAny:e==="any",rightIsAny:t==="any",bothAreAny:e==="any"&&t==="any",leftIsRange:e==="range",rightIsRange:t==="range"}}get test(){return{featureClone:this._featureClone}}};function Xe(e){return e.type==="field"||e.type==="group"||e.type==="relationship"||e.type==="text"||e.type==="utilityNetworkAssociations"||(yt().warn("form-info::unsupported-element-type","Only element types 'field', 'group' and 'relationship' are supported",`Element ${e.label} has unsupported type '${e.type}'`),!1)}function Zi(e,t){const{feature:i,layer:s}=t;return new Ri({element:e,inputs:[],feature:i,layer:s})}function Bi(e,t,i=null){const{feature:s,layer:n,timeZone:o}=t;return new Di({element:e,feature:s,group:i,layer:n,timeZone:o})}l([u()],v.prototype,"_expressionInfosLookup",null),l([u()],v.prototype,"_featureClone",void 0),l([u()],v.prototype,"_timeZone",void 0),l([u()],v.prototype,"activeAssociation",void 0),l([u()],v.prototype,"activeAssociationInput",null),l([u()],v.prototype,"activeRelationshipInput",null),l([u()],v.prototype,"_arcadeContextInfo",null),l([u()],v.prototype,"associationId",null),l([u()],v.prototype,"associatedLayer",null),l([u()],v.prototype,"allAssociationInputs",null),l([u()],v.prototype,"allFieldInputs",null),l([u()],v.prototype,"allGroupInputs",null),l([u()],v.prototype,"allRelationshipInputs",null),l([u()],v.prototype,"_layerFieldsByName",null),l([u()],v.prototype,"arcadeEditType",void 0),l([u()],v.prototype,"contingencyConstraintViolations",void 0),l([u()],v.prototype,"disabled",void 0),l([u()],v.prototype,"feature",null),l([u()],v.prototype,"fieldsWithContingentValues",null),l([u({type:ei})],v.prototype,"formTemplate",null),l([u()],v.prototype,"formDescription",null),l([u()],v.prototype,"formTitle",null),l([u()],v.prototype,"formHeaderVisible",null),l([u()],v.prototype,"highlightHelper",void 0),l([u()],v.prototype,"inputs",void 0),l([u()],v.prototype,"joinedContingentValues",null),l([u()],v.prototype,"layer",null),l([u()],v.prototype,"map",void 0),l([u()],v.prototype,"callbacks",void 0),l([u()],v.prototype,"relationshipId",null),l([u()],v.prototype,"spatialReference",null),l([u()],v.prototype,"state",null),l([u()],v.prototype,"strict",void 0),l([u()],v.prototype,"submittable",null),l([u()],v.prototype,"timeZone",null),l([u()],v.prototype,"updating",null),l([u()],v.prototype,"valid",null),l([u()],v.prototype,"pendingSubtypeChoice",void 0),l([u()],v.prototype,"getValues",null),l([u()],v.prototype,"submit",null),l([u()],v.prototype,"test",null),v=l([T(mt)],v);const Wi=v;let oe=class extends S{constructor(t){super(t),this.associationDetails=!0}};l([u({type:Boolean,nonNullable:!0})],oe.prototype,"associationDetails",void 0),oe=l([T("esri.widgets.FeatureForm.VisibleElements")],oe);const ft=oe;function zi(e,t,i){const{associationType:s}=e;switch(s){case"attachment":return t==="to"?i.attachment:i.structure;case"containment":return t==="to"?i.content:i.container;case"junction-edge-from-connectivity":case"junction-edge-to-connectivity":case"junction-edge-midspan-connectivity":case"junction-junction-connectivity":case"connectivity":return i.connectivity}}function qi(e){const{feature:t,association:i,associationType:s,messages:n}=e,{attachment:o,connectivity:a,container:r,content:d,structure:p}=n,c=t.sourceLayer;if(!i&&!s)return;if(!i)switch(s){case"attachment":return o;case"container":return r;case"connectivity":return a;case"content":return d;case"structure":return p}if(!c)return;const h=t.attributes[c.globalIdField]===i.fromNetworkElement.globalId?"from":"to";return zi(i,h,n)}function Ji(e){const{feature:t,heading:i}=e,s=i||lt(t),n=qi(e)??"";return m("calcite-block",{description:n,heading:s})}let ae=class extends S{constructor(e){super(e),this.associationDetails=!0}};l([u({type:Boolean,nonNullable:!0})],ae.prototype,"associationDetails",void 0),ae=l([T("esri.widgets.FeatureForm.FeatureFormUtilityNetworkAssociations.VisibleElements")],ae);const gt=ae,ie="esri-feature-form-utility-network-association-list",B={base:ie,header:`${ie}__header`,headingContent:`${ie}__heading-content`,listContainer:`${ie}__list-container`};let O=class extends ci{constructor(e,t){super(e,t),this._isLoadingSelectFeature=!1,this.associationInput=null,this.headingLevel=5,this.messagesFeatureForm=null,this.onSelectLayer=()=>{},this.onSelectFeature=async()=>{},this.onAddAssociation=()=>{},this.viewModel=new Ie,this.visibleElements=new gt}initialize(){this.setUpObserver()}loadDependencies(){return nt({chip:()=>w(()=>import("./index-BtUFGore.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]),import.meta.url),fab:()=>w(()=>import("./index-Dd_Yvsgp.js"),__vite__mapDeps([24,25,2,3,4,5,6,7,8,9,10,11,12,13,15,23,1,14,16,26,17,18,27,28,20,29,19,22]),import.meta.url),icon:()=>w(()=>import("./index-DwIhxbHs.js").then(e=>e.i),__vite__mapDeps([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),import.meta.url),list:()=>w(()=>import("./index-BCDLx0rN.js"),__vite__mapDeps([30,25,2,3,4,5,6,7,8,9,10,11,12,13,15,23,31,17,18,16,14,32,1,33,34,35,36,27,28,20,21,29,19,37,22,38,39,40,41,42,43]),import.meta.url),"list-item":()=>w(()=>import("./index-B0pN5y8B.js"),__vite__mapDeps([44,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,45,17,18,46,42,20,21,19,47,48,25,23,49,32,22,50,51,52,53,43,54]),import.meta.url),tooltip:()=>w(()=>import("./index-Bts9-rBr.js"),__vite__mapDeps([55,2,3,4,5,6,7,8,9,10,11,12,13,17,18,46,14,15,42,47,56,32]),import.meta.url)})}get associatedFeatureCount(){const{associationInput:e}=this;if(!e)return 0;const{associatedFeatureInfos:t,associatedLayer:i}=e,s=i?t.get(i):null;return s?s.length:0}render(){const{associationInput:e}=this;if(!e)return m("div",{class:this.classes(B.base,le.widget)});const{associatedLayer:t}=e,{state:i}=this.viewModel;return m("div",{class:this.classes(B.base,le.widget)},i==="loading"||i==="querying"?this.renderLoading():t?this._renderFeatureList(e,t):this._renderLayerList(e))}_renderLayerList(e){var s;const{associatedFeatureInfos:t,editable:i}=e;return m("div",{class:B.listContainer},m("calcite-list",{label:(s=this.messagesFeatureForm)==null?void 0:s.associations.associatedLayers},Array.from(t.keys(),n=>this._renderLayerItem(e,n))),i?m("calcite-fab",{appearance:"outline-fill",icon:"plus",key:`${e.uid}-add-button`,kind:"neutral",onclick:()=>this.onAddAssociation({feature:e.feature,associationType:e.activeAssociationType,utilityNetwork:e.utilityNetwork}),text:this.messagesCommon.add,textEnabled:!0}):null)}_renderFeatureList(e,t){var i;return m(Tt,null,this._renderHeader(e,t),m("div",{class:B.listContainer},this.renderFeatureCountWarning(),m("calcite-list",{label:(i=this.messagesFeatureForm)==null?void 0:i.associations.associatedFeatures},this._renderAssociatedFeatureListPage(e,t),this.renderFeatureObserver())))}_renderLayerTitle(e){return e.title?m(dt,{key:"title",level:this.headingLevel},m("div",{class:B.headingContent},m("calcite-icon",{icon:"layer"}),e.title)):null}_renderTotal(e,t){const{messagesFeature:i}=this,{associatedFeatureInfos:s}=e,n=s.get(t),o=W(i==null?void 0:i.numberRecords,{number:(n==null?void 0:n.length)??"0"});return m("div",{key:t.id},o)}_renderHeader(e,t){const{messagesFeatureForm:i}=this,{activeAssociationType:s,featureItem:n,feature:o}=e;return m("div",{class:B.header,key:"filter"},this.visibleElements.associationDetails?m(Ji,{associationType:s==null?void 0:s.type,feature:o,heading:n==null?void 0:n.label,messages:i.associations}):void 0,this._renderLayerTitle(t),this.renderFilter(),this._renderTotal(e,t))}_renderAssociatedFeatureListPage(e,t){var a;const{filterText:i,endIndex:s}=this,n=this.messagesCommon.untitled,o=((a=e.associatedFeatureInfos.get(t))==null?void 0:a.filter(r=>De(r,n).toLowerCase().includes(i)??!1).slice(0,s).toArray())??[];return[...this._renderTooltips(o),...this._renderAssociatedFeatureList(o)]}_renderItemTooltip(e){const{tooltipReferenceMap:t}=this,i=e.feature.uid.toString();return Ze(e.association)?m("calcite-tooltip",{key:`tooltip-${i}`,overlayPositioning:"fixed",referenceElement:t.get(i)},this.getConnectivityTooltip(e.association.associationType)):null}_renderAssociatedFeature(e){const t=this.messagesCommon.untitled,i=De(e,t),s=e.feature.uid.toString();return m("calcite-list-item",{description:Re(e.terminalName??""),key:`associated-feature-type-${s}`,label:Re(i),onCalciteListItemSelect:()=>this._selectAssociation(e)},Ze(e.association)?this.renderConnectivityIcon(e.association.associationType,s):null,hi(e.association)?m("calcite-chip",{label:Be(e.association),scale:"s",slot:"content-end"},Be(e.association)):null,m("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderTooltips(e){return e.map(t=>this._renderItemTooltip(t))}_renderAssociatedFeatureList(e){return e.map(t=>this._renderAssociatedFeature(t))}_renderLayerItem(e,t){var n;const{associatedFeatureInfos:i}=e,s=((n=i.get(t))==null?void 0:n.length)??0;return m("calcite-list-item",{key:`${t.id}-show-all`,label:t.title??this.messagesCommon.untitled,open:!0,value:t.id,onCalciteListItemSelect:()=>this._showAllAssociations(t)},m("calcite-chip",{label:s.toString(),scale:"s",slot:"content-end"},s),m("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}async _selectAssociation(e){this._isLoadingSelectFeature||(this._isLoadingSelectFeature=!0,await this.onSelectFeature({feature:e.feature,association:e.association}),this._isLoadingSelectFeature=!1)}_showAllAssociations(e){this.onSelectLayer({layer:e,associationInput:this.associationInput})}};l([u()],O.prototype,"associatedFeatureCount",null),l([u({type:ct})],O.prototype,"associationInput",void 0),l([u()],O.prototype,"headingLevel",void 0),l([u(),J("esri/widgets/FeatureForm/t9n/FeatureForm")],O.prototype,"messagesFeatureForm",void 0),l([u({constructOnly:!0})],O.prototype,"onSelectLayer",void 0),l([u({constructOnly:!0})],O.prototype,"onSelectFeature",void 0),l([u({constructOnly:!0})],O.prototype,"onAddAssociation",void 0),l([u({type:Ie})],O.prototype,"viewModel",void 0),l([u({type:gt,nonNullable:!0})],O.prototype,"visibleElements",void 0),O=l([T("esri.widgets.FeatureForm.FeatureFormUtilityNetworkAssociations.FeatureFormUtilityNetworkAssociationList")],O);const Ki=O,P="data-field-name";let C=class extends Rt{constructor(e,t){super(e,t),this._associationsWidgetsMap=new Map,this._attemptFocusOnNextRender=!1,this._dateComponentMap=new Map,this._inputsWithChanges=new Set,this._focusedFieldName=null,this._pendingSubtypeChoice=null,this._listObserverNode=null,this._listObserver=new IntersectionObserver(i=>{i.length&&i[0].isIntersecting&&this._incrementRelatedRecordPage()},{root:window.document}),this._prompt=null,this._featureFormUNAssociationList=null,this.groupDisplay="all",this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesFeature=null,this.messagesTemplates=null,this.viewModel=new Wi,this.visibleElements=new ft,this._onShowAllRelatedRecordsClick=i=>{const{feature:s,callbacks:n}=this;s&&(n!=null&&n.showAllRelatedRecords)&&n.showAllRelatedRecords({parentFeature:s,relationshipId:i})},this._onAddRelatedRecordsClick=(i,s,n)=>{const{feature:o,callbacks:a}=this;let r=n;if(o&&(a!=null&&a.addRelatedRecord)){if(st(n)&&i.activeCategory){const d=i.activeCategory.value,p=n.findSublayerForSubtypeCode(d);p&&rt(p)&&(r=p)}a.addRelatedRecord({parentFeature:o,relatedLayer:r,relationshipId:s})}},this._onFormKeyDown=this._onFormKeyDown.bind(this),this._onFormSubmit=this._onFormSubmit.bind(this),this._onGroupToggle=this._onGroupToggle.bind(this),this._onComponentBlur=this._onComponentBlur.bind(this),this._onComponentFocus=this._onComponentFocus.bind(this),this._onComponentKeyDown=this._onComponentKeyDown.bind(this),this._afterComponentCreate=this._afterComponentCreate.bind(this),this._afterComponentCreateOrUpdate=this._afterComponentCreateOrUpdate.bind(this),this._afterDateComponentCreate=this._afterDateComponentCreate.bind(this),this._afterDateComponentCreateOrUpdate=this._afterDateComponentCreateOrUpdate.bind(this),this._afterRadioGroupCreateOrUpdate=this._afterRadioGroupCreateOrUpdate.bind(this)}initialize(){this.addHandles([R(()=>this.feature,()=>{this._inputsWithChanges.clear(),this._dateComponentMap.clear(),it(()=>!this.viewModel.updating).then(()=>{const e=this._getFocusableInput("forward");this._syncGroupInputStates(),this._focusedFieldName=(e==null?void 0:e.name)||null,this._attemptFocusOnNextRender=!0})}),R(()=>[this._featureFormUNAssociationList,this.visibleElements.associationDetails],([e,t])=>{e&&(e.visibleElements.associationDetails=t)},re),R(()=>this.groupDisplay,()=>this._syncGroupInputStates()),this.on("submit",e=>{if(e.invalid.length>0){const[t]=e.invalid;e.invalid.forEach(i=>this._inputsWithChanges.add(i)),this._focusedFieldName=t,this._attemptFocusOnNextRender=!0,this.scheduleRender()}}),R(()=>[this.viewModel.activeRelationshipInput,this._listObserverNode],()=>this._onObserverChange()),R(()=>this.viewModel.activeAssociationInput,e=>{e&&this._featureFormUNAssociationList&&(this._featureFormUNAssociationList.associationInput=e,this._featureFormUNAssociationList.viewModel=e.viewModel)})])}loadDependencies(){return nt({block:()=>w(()=>import("./index-C6d66FVb.js"),__vite__mapDeps([57,25,2,3,4,5,6,7,8,9,10,11,12,13,15,23,31,17,18,16,14,1,45,46,42,20,21,19,47,48,49,32,22,50,51,52,53,58,27,56,59,60,61,62]),import.meta.url),button:()=>w(()=>import("./index-jjUP6Yam.js"),__vite__mapDeps([26,25,2,3,4,5,6,7,8,9,10,11,12,13,15,23,1,14,16,17,18,27,28,20,29,19,22]),import.meta.url),chip:()=>w(()=>import("./index-BtUFGore.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]),import.meta.url),combobox:()=>w(()=>import("./index-BYx-hdGk.js"),__vite__mapDeps([63,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,33,0,17,18,19,20,21,22,23,32,36,64,40,41,42,46,28,29,47,38,65]),import.meta.url),"combobox-item":()=>w(()=>import("./index-CP8r2QEY.js"),__vite__mapDeps([66,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,32,18,20,65,22,67]),import.meta.url),"combobox-item-group":()=>w(()=>import("./index-Cl5r3sNd.js"),__vite__mapDeps([68,2,3,4,5,6,7,8,9,10,11,12,13,15,65,14]),import.meta.url),icon:()=>w(()=>import("./index-DwIhxbHs.js").then(e=>e.i),__vite__mapDeps([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),import.meta.url),input:()=>w(()=>import("./index-pyEU_klK.js"),__vite__mapDeps([35,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,33,34,36,18,32,17,27,28,20,21,29,19,37,22,38,23,39]),import.meta.url),"input-date-picker":()=>w(()=>import("./index-Dwo8yu4W.js"),__vite__mapDeps([69,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,33,34,70,36,18,17,28,20,29,19,22,38,39,23,37,21,71,72,25,49,32,73,46,42,47,60]),import.meta.url),"input-message":()=>w(()=>import("./index-fFnlo_g2.js"),__vite__mapDeps([33,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),import.meta.url),"input-number":()=>w(()=>import("./index-BVlRRyQC.js"),__vite__mapDeps([74,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,33,34,36,18,32,17,28,20,21,29,19,37,22,38,39,23]),import.meta.url),"input-time-picker":()=>w(()=>import("./index-Dc6NQLgc.js").then(e=>e.i),__vite__mapDeps([75,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,33,34,70,36,18,17,28,20,29,19,22,38,39,23,25,49,32,58,46,42,47,27,56,59,60,21,37,76]),import.meta.url),"input-time-zone":()=>w(()=>import("./index-zL7usBBl.js"),__vite__mapDeps([77,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,33,0,17,18,19,20,21,22,23,63,32,36,64,40,41,42,46,28,29,47,38,65,66,67,68,78,37]),import.meta.url),label:()=>w(()=>import("./index--OBudxYA.js"),__vite__mapDeps([79,2,3,4,5,6,7,8,9,10,11,12,13,29,14,15]),import.meta.url),list:()=>w(()=>import("./index-BCDLx0rN.js"),__vite__mapDeps([30,25,2,3,4,5,6,7,8,9,10,11,12,13,15,23,31,17,18,16,14,32,1,33,34,35,36,27,28,20,21,29,19,37,22,38,39,40,41,42,43]),import.meta.url),"list-item":()=>w(()=>import("./index-B0pN5y8B.js"),__vite__mapDeps([44,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,45,17,18,46,42,20,21,19,47,48,25,23,49,32,22,50,51,52,53,43,54]),import.meta.url),loader:()=>w(()=>import("./index-CMxz6F2k.js"),__vite__mapDeps([25,2,3,4,5,6,7,8,9,10,11,12,13,15,23]),import.meta.url),notice:()=>w(()=>import("./index-CV25o1as.js"),__vite__mapDeps([80,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,81,47,22,23]),import.meta.url),"radio-button":()=>w(()=>import("./index-DgqiEeTY.js"),__vite__mapDeps([82,2,3,4,5,6,7,8,9,10,11,12,13,17,18,62,14,15,28,20,29,19]),import.meta.url),"radio-button-group":()=>w(()=>import("./index-DanFJwSx.js"),__vite__mapDeps([83,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,33,19,38]),import.meta.url),switch:()=>w(()=>import("./index-BciJpaKz.js"),__vite__mapDeps([84,2,3,4,5,6,7,8,9,10,11,12,13,17,18,14,15,28,20,21,29,19]),import.meta.url),"text-area":()=>w(()=>import("./index-Bi6d-iof.js"),__vite__mapDeps([85,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,33,36,18,17,28,29,37,21,19,20,38,39,23,86,42]),import.meta.url)})}destroy(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode)}get _relatedRecordsEnabled(){const{callbacks:e}=this;return!(!e||!(e.addRelatedRecord||e.editRelatedRecord||e.showAllRelatedRecords))}get _utilityNetworkAssociationsEnabled(){const{callbacks:e}=this;return!(!(e!=null&&e.viewAssociatedLayers)||!e.viewAssociatedFeatures)}get _subtypes(){return Et(this.layer)}get associationId(){return this.viewModel.associationId}set associationId(e){this.viewModel.associationId=e}get associatedLayer(){return this.viewModel.associatedLayer}set associatedLayer(e){this.viewModel.associatedLayer=e}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get feature(){return this.viewModel.feature}set feature(e){this.viewModel.feature=e}get formTemplate(){return this.viewModel.formTemplate}set formTemplate(e){this.viewModel.formTemplate=e}get icon(){return"form-field"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get callbacks(){return this.viewModel.callbacks}set callbacks(e){this.viewModel.callbacks=e}get relationshipId(){return this.viewModel.relationshipId}set relationshipId(e){this.viewModel.relationshipId=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get strict(){return this.viewModel.strict}set strict(e){this.viewModel.strict=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get showPrompt(){return e=>{var t,i;(i=(t=this._prompt)==null?void 0:t.cancel)==null||i.call(t),this._prompt=e}}set showPrompt(e){this._overrideIfSome("showPrompt",e)}get clearPrompt(){return()=>this._prompt=null}set clearPrompt(e){this._overrideIfSome("clearPrompt",e)}getValues(){return this.viewModel.getValues()}submit(){return this.viewModel.submit()}render(){const{state:e}=this.viewModel;return m("div",{class:this.classes(x.base,le.widget,le.panel)},e==="ready"?this._renderForm():null)}_renderForm(){return m("div",null,m("form",{class:x.form,novalidate:!0,onkeydown:this._onFormKeyDown,onsubmit:this._onFormSubmit},this._renderHeader(),this._renderContent()),this._prompt?m($t,{...this._prompt,headingLevel:this.headingLevel}):void 0)}_renderHeader(){const e=this.viewModel,{formTitle:t,formDescription:i}=e;if(!e.formHeaderVisible)return;const s=t!=null&&m(dt,{key:"title",level:this.headingLevel},t),n=i!=null&&m("p",{class:x.description,key:"description"},i);return m("div",{class:x.formHeader},s,n)}_renderContent(){const{viewModel:e}=this;return e.activeRelationshipInput?this._renderRelationshipInput(e.activeRelationshipInput):e.activeAssociationInput?this._renderFeatureFormUtilityNetworkAssociationList():e.inputs.filter(ve).filter(t=>t.visible).map(t=>this._renderInput(t))}_renderInput(e){return z(e)?this._renderGroup(e):X(e)?this._renderLabeledField(e):Fe(e)?this._renderRelationshipInput(e):ut(e)?this._renderTextElementInput(e):Ht(e)?this._renderUtilityNetworkAssociationsElementInput(e):void 0}_renderFeatureFormUtilityNetworkAssociationList(){var e;return(e=this._featureFormUNAssociationList)==null?void 0:e.render()}_selectAssociatedLayer(e){const{feature:t,callbacks:i}=this;t&&(i!=null&&i.viewAssociatedFeatures)&&i.viewAssociatedFeatures({associatedLayer:e.layer})}async _selectAssociatedFeature(e){const{feature:t,callbacks:i}=this;t&&(i!=null&&i.selectAssociatedFeature)&&await i.selectAssociatedFeature({parentFeature:t,...e})}_onAddAssociation(e){const{feature:t,callbacks:i}=this;t&&(i!=null&&i.addAssociation)&&i.addAssociation(e)}_setUpUtilityNetworkAssociationList(){this._featureFormUNAssociationList||(this._featureFormUNAssociationList=new Ki({onSelectLayer:this._selectAssociatedLayer.bind(this),onSelectFeature:this._selectAssociatedFeature.bind(this),onAddAssociation:this._onAddAssociation.bind(this)}))}_renderUtilityNetworkAssociationsElementInput(e){if(this._utilityNetworkAssociationsEnabled)return this._setUpUtilityNetworkAssociationList(),se(this._associationsWidgetsMap,e,()=>new kt({onSelectAssociationType:({viewModel:t,listType:i})=>{t.activeAssociationType=i;const{feature:s,callbacks:n}=this;s&&(n!=null&&n.viewAssociatedLayers)&&n.viewAssociatedLayers({associationId:e.uid})},viewModel:e.associationsViewModel})).render()}_renderDescriptionOrEmpty(e,t){return e==null?null:m("div",{class:this.classes(x.description),id:t},e)}_renderGroup(e){const{disabled:t,formTemplate:i,headingLevel:s}=this,{description:n,id:o,inputs:a,label:r,open:d}=e,p=a.filter(y=>y.visible),c=this.viewModel.findField(this._focusedFieldName),h=(c==null?void 0:c.group)===e,f=this.groupDisplay==="sequential";return m("calcite-block",{class:this.classes(x.group,f?x.groupSequential:null,h?x.groupActive:null,t?x.inputDisabled:null),collapsible:!0,"data-group":e,description:n||void 0,disabled:t,heading:r??"",headingLevel:i!=null&&i.title?pi(s):s,id:o,key:o,open:d,onCalciteBlockToggle:({currentTarget:y})=>this._onGroupToggle(y,e)},p.map(y=>this._renderInput(y)))}_getFocusableInput(e,t){const i=Zt(this.viewModel.inputs);let s;if(e==="backward"&&i.reverse(),t)if(z(t)){const n=t.inputs.find(o=>o.visible);s=n?i.indexOf(n):0}else{let n;if(ce(t)&&!t.group.open){const o=t.group.inputs.filter(X);n=e==="forward"?o[o.length-1]:o[0]}else n=t;s=i.indexOf(n)+1}else s=0;for(let n=s;n<i.length;n++){const o=i[n];if(o.visible&&X(o))return o}return null}_renderLabeledField(e){var d;const{dataType:t,feature:i,label:s,layer:n,required:o}=e,a={"aria-label":o?W(this.messages.requiredFieldLabel,{name:s}):s,class:x.label,key:`${n.id}-${i.uid}-${e.name}`},r=[m("div",{class:x.labelTextContent,key:"labelTextContainer"},s,o?m("span",{"aria-hidden":"true",title:this.messagesCommon.required},"*"):void 0),t!=="unsupported"?this._renderFieldInput(e):this._renderReadOnlyComponent(e),this._renderAuxiliaryText(e)];return t==="date"&&((d=e.domain)==null?void 0:d.type)!=="coded-value"?m("label",{...a},r):m("calcite-label",{...a},r)}_renderFieldInput(e){const{dataType:t,domain:i,inputType:s,name:n}=e,o=this.getCommonInputProps(e);if((i==null?void 0:i.type)==="coded-value"){const a=this.viewModel.getFieldValueOptionsForField(n,this.messages.empty);return s!=="switch"||e.hasInvalidSwitchValue?s==="radio-buttons"?this._renderRadioButtonComponents(e,a.flat(),o):this._renderComboBoxComponent(e,a,o):this._renderSwitchComponent(e,o)}return s==="datetime-picker"||t==="date"?this._renderDateComponents(e,o):t==="number"?this._renderNumberComponent(e,o):this._renderStringComponent(e,o)}_renderStringComponent(e,t){return e.inputType==="text-area"?t.readOnly?m("calcite-input",{...t,loading:e.updating,type:"textarea",onCalciteInputInput:i=>this._saveValueFromComponent(i.currentTarget)}):m("calcite-text-area",{...t,resize:"vertical",onCalciteTextAreaInput:i=>this._saveValueFromComponent(i.currentTarget)}):m("calcite-input",{...t,loading:e.updating,type:"text",onCalciteInputInput:i=>this._saveValueFromComponent(i.currentTarget)})}_renderNumberComponent(e,t){const i=It(e.field),s=i&&t.value!==""?Math.round(parseFloat(t.value)).toString():t.value;return m("calcite-input-number",{...t,integer:i,loading:e.updating,type:"number",value:s,onCalciteInputNumberInput:n=>this._saveValueFromComponent(n.currentTarget)})}_renderDateComponents(e,t){const{field:i}=e;switch(i.type){case"date":return this._renderDateFieldComponents(e,t);case"date-only":return this._renderDateOnlyFieldComponent(e,t);case"time-only":return this._renderTimeOnlyFieldComponent(e,t);case"timestamp-offset":return this._renderTimestampOffsetFieldComponents(e,t);default:return this._renderReadOnlyComponent(e,mi(i,t.value,{timeZone:this.timeZone,...yi(i)}))}}_renderDateOnlyFieldComponent(e,t){const{range:i,valid:s,value:n}=e,{class:o,key:a,readOnly:r}=t,{rawMax:d,rawMin:p}=i;return m("calcite-input-date-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!s,class:o,"data-date-part":"date","data-field-name":t[P],key:`${a}-date-input`,max:$e(d)?d:void 0,min:$e(p)?p:void 0,numberingSystem:Q,onblur:c=>{this._focusedFieldName=null,this._saveValueFromDateComponent(c.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:r,value:n!=null?`${n}`:void 0,onCalciteInputDatePickerChange:c=>this._saveValueFromDateComponent(c.currentTarget)})}_renderTimeOnlyFieldComponent(e,t){const{valid:i,value:s}=e,{class:n,key:o,readOnly:a}=t;return m("calcite-input-time-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!i,class:n,"data-date-part":"time","data-field-name":t[P],key:`${o}-time-input`,numberingSystem:Q,onblur:r=>{this._focusedFieldName=null,this._saveValueFromDateComponent(r.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:a,step:e.timeStep,value:s!=null?`${s}`:void 0,onCalciteInputTimePickerChange:r=>this._saveValueFromDateComponent(r.currentTarget)})}_renderTimestampOffsetFieldComponents(e,t){const{name:i,range:s,timeZone:n,valid:o,value:a}=e,{class:r,key:d,readOnly:p}=t,{rawMax:c,rawMin:h}=s,f={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!o,numberingSystem:Q,overlayPositioning:"fixed",readOnly:p,[P]:i,onfocus:this._onComponentFocus},y=ee(c,n),g=ee(h,n),b=ee(a,n);return m("div",{class:x.dateInputContainer,key:`${d}-date-time-container`},m("calcite-input-date-picker",{...f,class:r,"data-date-part":"date",key:`${d}-date-input`,max:(y==null?void 0:y.date)??void 0,min:(g==null?void 0:g.date)??void 0,onblur:_=>{this._focusedFieldName=null,this._saveValueFromDateComponent(_.target)},value:b.date??void 0,onCalciteInputDatePickerChange:_=>this._saveValueFromDateComponent(_.currentTarget)}),m("calcite-input-time-picker",{...f,class:r,"data-date-part":"time",key:`${d}-time-input`,onblur:_=>{this._focusedFieldName=null,this._saveValueFromDateComponent(_.target)},step:e.timeStep,value:b.time??void 0,onCalciteInputTimePickerChange:_=>this._saveValueFromDateComponent(_.currentTarget)}),e.includeTimeOffset?m("calcite-input-time-zone",{...f,class:r,"data-date-part":"timeZone",disabled:p,key:`${d}-timezone-input`,onblur:_=>{this._focusedFieldName=null,this._saveValueFromDateComponent(_.target)},value:b.timeZoneOffset??"0",onCalciteInputTimeZoneChange:_=>this._saveValueFromDateComponent(_.currentTarget)}):null)}_renderDateFieldComponents(e,t){const{includeTime:i,name:s,valid:n,value:o}=e,{class:a,key:r,max:d,min:p,readOnly:c}=t,{timeZone:h}=this,f={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!n,numberingSystem:Q,overlayPositioning:"fixed",readOnly:c,[P]:s,onfocus:this._onComponentFocus},y=te(o,h),g=te(d,h),b=te(p,h);return m("div",{class:x.dateInputContainer,key:`${r}-date-time-container`},m("calcite-input-date-picker",{...f,class:a,"data-date-part":"date",key:`${r}-date-input`,max:(g==null?void 0:g.date)??void 0,min:(b==null?void 0:b.date)??void 0,onblur:_=>{this._focusedFieldName=null,this._saveValueFromDateComponent(_.target)},value:y.date??void 0,onCalciteInputDatePickerChange:_=>this._saveValueFromDateComponent(_.currentTarget)}),i?m("calcite-input-time-picker",{...f,class:a,"data-date-part":"time",key:`${r}-time-input`,onblur:_=>{this._focusedFieldName=null,this._saveValueFromDateComponent(_.target)},step:1,value:y.time??void 0,onCalciteInputTimePickerChange:_=>this._saveValueFromDateComponent(_.currentTarget)}):null)}_renderReadOnlyComponent(e,t){const i=this.getCommonInputProps(e);return m("calcite-input",{...i,class:this.classes(x.fieldInput,x.inputDisabled),readOnly:!0,type:"text",value:t!=null?`${t}`:i.value})}_renderComboBoxComponent(e,t,i){const{value:s,name:n}=e,{viewModel:o,_inputsWithChanges:a}=this,r=o.arcadeEditType==="INSERT",d=a.has(n),p=s==null&&(!r||d),c=r&&e.showNoValueOptionEnabled&&!d?()=>{}:i.onblur;return m("calcite-combobox",{...i,allowCustomValues:!1,clearDisabled:!0,disabled:i.readOnly,onblur:c,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:({currentTarget:h})=>{p&&h.selectedItems.length===0?this._ignoreDeselectionOfNoValueOption(h):e.isSubtypeField&&h.selectedItems.length===0?h.value=`${e.value}`:this._saveValueFromComponent(h)}},this.renderComboboxOptionsList(e,t))}renderComboboxOptionsList(e,t){const{value:i,name:s}=e,{messages:n,messagesTemplates:o,viewModel:a,_inputsWithChanges:r}=this,[d,p,c]=t.map(b=>b.map(({name:_,value:I})=>m("calcite-combobox-item",{key:`#${I}`,selected:i===I,textLabel:_,value:`${I}`}))),h=[];p.length>0&&h.push(m("calcite-combobox-item-group",{key:"other",label:o.other},p)),c.length>0&&h.push(m("calcite-combobox-item-group",{key:"unsupported",label:n.subtypes.unsupportedDomainGroupTitle},c)),h.length>0?h.unshift(m("calcite-combobox-item-group",{key:"recommended",label:n.recommended},d)):h.push(...d);const f=a.arcadeEditType==="INSERT",y=r.has(s),g=i==null&&(!f||y);return e.showNoValueOptionEnabled&&h.unshift(m("calcite-combobox-item",{key:"empty-option",selected:g,textLabel:e.showNoValueLabel||n.empty,value:""})),h}_renderRadioButtonComponents(e,t,i){const{name:s,value:n}=e,o=t.map(({name:a,value:r})=>this._renderRadioButtonComponent({key:a,label:a,name:s,value:r,selected:r===n,props:i}));if(e.showNoValueOptionEnabled){const a="",r=e.showNoValueLabel||this.messages.empty,d=n===a||n===null;o.unshift(this._renderRadioButtonComponent({key:"empty-option",label:r,name:s,value:a,selected:d,props:i}))}return m("calcite-radio-button-group",{afterCreate:this._afterRadioGroupCreateOrUpdate,afterUpdate:this._afterRadioGroupCreateOrUpdate,class:x.inputRadioGroup,"data-field-name":i[P],key:`${i.key}-radio-group`,layout:"vertical",name:i.key,required:i.required},o)}_renderSwitchComponent(e,t){const{value:i}=e,s=!!Pe(e.element,"switch")&&i===e.element.input.onValue;return m("calcite-switch",{...t,checked:s,class:x.inputSwitch,disabled:t.readOnly,onblur:()=>{this._focusedFieldName=null},onCalciteSwitchChange:n=>this._saveValueFromComponent(n.currentTarget)})}_renderRadioButtonComponent({key:e,name:t,value:i,selected:s,label:n,props:o}){return m("calcite-label",{class:x.inputRadioLabel,key:e,layout:"inline"},m("calcite-radio-button",{...o,afterCreate:void 0,afterUpdate:void 0,checked:s,class:x.inputRadio,disabled:o.readOnly,name:t,onblur:()=>{this._focusedFieldName=null},value:i,onCalciteRadioButtonChange:({currentTarget:a})=>{a.checked&&this._saveValueFromComponent(a)}}),n)}_renderAuxiliaryText(e){const t=e.name,i=this._inputsWithChanges.has(t)&&!e.submittable?Bt(e,this.messages,this.timeZone):this.viewModel.contingencyConstraintViolations.get(t)!=null?this.messages.validationErrors.valuesIncompatible:e.valueExpressionExecutor!=null&&e.valueExpressionExecutor.stale?this.messages.valueExpressionError:null;return i!=null?m("calcite-input-message",{icon:!0,status:"invalid"},i):this._inputsWithChanges.has(t)&&e.valueIsOutOfDomain?m("calcite-input-message",{icon:!0,status:"idle"},this.messages.subtypes.fieldOutOfSubtypeDomainWarning):this._renderDescriptionOrEmpty(e.description)}_renderShowAllRelatedRecordsListItem(e){var i;if(!e.showAllActionVisible||!((i=this.callbacks)!=null&&i.showAllRelatedRecords))return;const t=this.messages;return m("calcite-list-item",{description:W(t.totalCount,{count:e.featureCount}),key:"show-all-related-features",label:t.showAll,value:!0,onCalciteListItemSelect:()=>this._onShowAllRelatedRecordsClick(e.relationshipId)},m("calcite-icon",{icon:"list",scale:"s",slot:"content-end"}))}_renderAddRelatedRecordButton(e){const{canAddRelatedFeature:t,relationshipId:i,relatedLayer:s}=e,{messages:n,callbacks:o}=this;if(t&&(o!=null&&o.addRelatedRecord)&&s)return m("calcite-button",{alignment:"center",appearance:"outline-fill",class:x.centeredButton,disabled:e.updating||!e.originHasValidKey,iconStart:"plus",key:`${i}-add-button`,onclick:()=>{!e.updating&&e.originHasValidKey&&this._onAddRelatedRecordsClick(e,i,s)},round:!0,scale:"s",width:"full"},e.relatedLayerIsTable?n.addRecord:n.addFeature)}_renderRelatedRecordListItem(e,t){const{feature:i,description:s,title:n}=e,{feature:o,callbacks:a}=this,{highlightHelper:r}=this.viewModel,d=()=>{r==null||r.removeAll(),a!=null&&a.editRelatedRecord&&o&&a.editRelatedRecord({parentFeature:o,relationshipId:t,relatedFeature:i})},p=r?()=>r.add(i):void 0,c=r?()=>r.remove(i):void 0;return m("calcite-list-item",{bind:this,description:s,key:`${t}-${i.uid}`,label:n,onclick:d,onmouseenter:p,onmouseleave:c,value:n},m("calcite-icon",{icon:Wt(i),slot:"content-start"}),m("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderRelationshipInput(e){if(!this._relatedRecordsEnabled||!e.editable)return;const{relationshipId:t,activeCategory:i}=e,s=i?null:this._renderDescriptionOrEmpty(e.description);return m("calcite-label",{class:this.classes(x.label,x.relatedRecordsLabel),key:`relationship-${t}-container`},m("div",null,this._renderRelatedRecordsHeaderContainer(e),s,this._renderRelationshipInputContent(e)),this._renderAddRelatedRecordButton(e))}_renderRelationshipInputContent(e){var t;return e.featureCount>0?this._renderRelatedRecordsList(e):e.activeCategory&&e.featureCount===0?this._renderNoRelatedRecordsNotice():(t=e.allCategories)!=null&&t.length?this._renderCategoryList(e):e.loaded?e.originHasValidKey?this._renderNoRelatedRecordsNotice():this._renderNoValidOriginKeyNotice(e):void 0}_renderCategoryList(e){var t;return m("calcite-list",{displayMode:"flat",label:this.messages.relatedRecordsList,loading:e.updating},(t=e.categories)==null?void 0:t.map(i=>this._renderCategory(e,i)),this._renderShowAllCategoriesListItem(e))}_renderCategory(e,t){const{count:i,name:s,value:n}=t,o=bt(i);return m("calcite-list-item",{key:`${s}-${n}`,label:s,onCalciteListItemSelect:()=>this._selectCategory(e,t)},m("calcite-chip",{label:o,scale:"s",slot:"content-end"},o),m("calcite-icon",{flipRtl:!0,icon:"chevron-left",scale:"s",slot:"content-end"}))}_selectCategory(e,t){this.relationshipId=e.relationshipId,e.activeCategory=t}_renderShowAllCategoriesListItem(e){var i;if(!e.showAllCategoriesVisible)return;const t=this.messages;return m("calcite-list-item",{description:W(t.totalCount,{count:((i=e.allCategories)==null?void 0:i.length)??0}),key:"show-all-categories",label:t.showAll,value:!0,onCalciteListItemSelect:()=>e.showAllEnabled=!0},m("calcite-icon",{icon:"list",scale:"s",slot:"content-end"}))}_renderRelatedRecordsHeaderContainer(e){var i;const t=e.updating||!e.loaded;return m("div",{class:x.relatedRecordsHeader,key:`relationship-${e.relationshipId}-header`},m("span",null,e.label),t?m("calcite-loader",{inline:!0,key:"loader",label:(i=this.messagesCommon)==null?void 0:i.loading,scale:"s",type:"indeterminate"}):void 0)}_renderRelatedRecordsList(e){var i;const{relationshipId:t}=e;return m("calcite-list",{class:x.relatedRecordsList,label:(i=this.messages)==null?void 0:i.relatedRecordsList},e.relatedFeatureInfos.map(s=>this._renderRelatedRecordListItem(s,t)),this._renderShowAllRelatedRecordsListItem(e),this._renderObserverNode())}_renderNoValidOriginKeyNotice(e){var d,p,c;const{messages:t}=this,i=e.relatedLayerIsTable?t.noOriginKeyRecord:t.noOriginKeyFeature,s=(d=e.relationship)==null?void 0:d.keyField,n=this.viewModel.findField(s),o=(p=e.layer)==null?void 0:p.fieldsIndex.get(s),a=(n==null?void 0:n.label)||(o==null?void 0:o.alias)||s,r=W(i,{relatedLayerName:(c=e.relatedLayer)==null?void 0:c.title,originKeyField:a});return m("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},m("div",{slot:"message"},r))}_renderNoRelatedRecordsNotice(){return m("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},m("div",{slot:"message"},this.messagesFeature.noRelatedFeatures))}_renderObserverNode(){var e;if((e=this.viewModel.activeRelationshipInput)!=null&&e.showAllEnabled)return m("div",{afterCreate:this._afterListObserverCreated,afterRemoved:this._afterListObserverRemoved,bind:this,class:x.listObserver,key:"feature-observer"})}_renderTextElementInput(e){return m("div",{class:x.textElement,innerHTML:e.text,key:e.id})}getCommonInputProps(e){const{disabled:t}=this,{editable:i,hint:s,label:n,maxLength:o,minLength:a,name:r,range:{max:d,min:p},required:c,valid:h,value:f}=e,y=this._inputsWithChanges.has(r),g=!i||t;return{afterCreate:this._afterComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,"aria-invalid":h?"false":"true",class:this.classes(x.fieldInput,g?x.inputDisabled:null),status:y&&!h?"invalid":"idle",key:r,label:n,max:d??void 0,min:p??void 0,maxLength:o>-1?o:void 0,minLength:a>-1?a:void 0,placeholder:s??void 0,readOnly:g,required:c,value:f==null?"":`${f}`,onblur:this._onComponentBlur,onfocus:this._onComponentFocus,onkeydown:this._onComponentKeyDown,[P]:r}}_getFieldInputFromHTMLElement(e){return this.viewModel.findField(e.getAttribute(P))}_afterDateComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e),i=e.dataset.datePart,s=this._dateComponentMap.get(t.name);if("valueAsDate"in e&&e.value!=null&&t.value!=null){const n=new ResizeObserver(()=>{switch(e.value=void 0,t.field.type){case"date":e.value=te(t.value,this.timeZone).date??"";break;case"timestamp-offset":e.value=ee(t.value,this.timeZone).date??"";break;default:e.value=`${t.value}`}n.unobserve(e)});n.observe(e)}if(s!=null)switch(i){case"date":s.date=e;break;case"time":s.time=e;break;case"timeZone":s.timeZone=e}else this._dateComponentMap.set(t.name,{[i]:e});this._afterDateComponentCreateOrUpdate(e)}_afterDateComponentCreateOrUpdate(e){this._afterComponentCreateOrUpdate(e)}_afterComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e);zt(t)&&e.value!=null&&"setNumberValue"in e&&e.setNumberValue({committing:!1,value:e.value,origin:"direct"}),this._afterComponentCreateOrUpdate(e)}_afterRadioGroupCreateOrUpdate(e){const t=e.selectedItem,i=e.querySelector("calcite-radio-button"),s=t||i;s&&this._afterComponentCreateOrUpdate(s)}_afterComponentCreateOrUpdate(e){const{viewModel:t}=this,i=this._getFieldInputFromHTMLElement(e),s=t.findField(this._focusedFieldName);this._attemptFocusOnNextRender&&s===i&&(this._attemptFocusOnNextRender=!1,ce(i)&&(i.group.open=!0),Lt(e))}_onComponentFocus(e){const t=e.target,i=this._getFieldInputFromHTMLElement(t);this._focusedFieldName=i.name}_onComponentBlur(e){const t=e.target;this._focusedFieldName=null,"readOnly"in t&&t.readOnly||this._saveValueFromComponent(t)}_saveValueFromDateComponent(e){const{timeZone:t}=this,i=this._getFieldInputFromHTMLElement(e),s=i.field.type,{name:n,range:o}=i,a=this._dateComponentMap.get(n);if(!a)return;let r=this.viewModel.getValue(n),d=null;s==="date-only"?d=Array.isArray(e.value)?e.value[0]:e.value:s==="time-only"?(r=We(r),d=We(e.value)):d=s==="timestamp-offset"?e.value!=null?fi({dateComponent:a.date,timeComponent:a.time,timeZoneComponent:a.timeZone,oldValue:r,defaultTimeZone:t}):null:e.value!=null?gi({oldValue:r,dateComponent:a.date,timeComponent:a.time,timeZone:t,max:o.max,min:o.min}):null,d!==null&&e.value?r!==d&&this._updateFieldValue(n,d):this._updateFieldValue(n,null)}_saveValueFromComponent(e){const t=this._getFieldInputFromHTMLElement(e),i=this._parseValue(e),s=t.value;t.isSubtypeField&&qt(this.layer,s,i)?this._pendingSubtypeChoice||i===s||(this._pendingSubtypeChoice=this._handleSubtypeChoice(t,i)):this._updateFieldValue(t.name,i)}async _handleSubtypeChoice(e,t){var g;const{value:i,name:s}=e,{messages:n,viewModel:o,messagesCommon:a,_subtypes:r}=this;if(this._updateFieldValue(s,t),!(r!=null&&r.length))return;const d=r.find(b=>b.code===t),p=((g=r.find(b=>b.code===i))==null?void 0:g.name)??`${i}`;if(!d)return;const c=Qe();o.pendingSubtypeChoice=c;let h="update-fields";const f=[{label:n.subtypes.useDefaultValuesOption,value:"update-fields"},{label:n.subtypes.keepCurrentValuesOption,value:"keep-existing"}],y={context:"info",title:n.subtypes.changeWarningTitle,message:W(n.subtypes.changeWarning,{originalType:p,newType:d.name}),radios:f,defaultRadioSelection:"update-fields",onRadioSelection:b=>h=b,actions:{primary:{label:a.apply,action:()=>c.resolve(h),type:"positive"},secondary:{label:a.cancel,type:"neutral",action:()=>c.resolve("undo")}},cancel:()=>c.reject()};try{switch(this.showPrompt(y),await c.promise){case"update-fields":o.applySubtypeDefaults(d),this._validateContingenciesForNonNullFields();break;case"keep-existing":this._validateContingenciesForNonNullFields();break;case"undo":this._updateFieldValue(e.name,i)}}finally{o.pendingSubtypeChoice=null,this.clearPrompt(),this._pendingSubtypeChoice=null}}_onComponentKeyDown({key:e,target:t}){const i=this._getFieldInputFromHTMLElement(t);e==="Enter"&&ce(i)&&!i.group.open&&(i.group.open=!0)}_updateFieldValue(e,t){const i=this.viewModel.getValue(e);this.viewModel.setValue(e,t),this._inputsWithChanges.add(e),i!==t&&this.viewModel.fieldsWithContingentValues.has(e)&&this._validateContingenciesForNonNullFields()}_validateContingenciesForNonNullFields(){const e=Object.fromEntries(Object.entries(this.getValues()).filter(([t,i])=>i!=null));this.viewModel.validateContingencyConstraints(e)}_parseValue(e){const t=this._getFieldInputFromHTMLElement(e),i=e.value;return Pe(t.element,"switch")?e.checked?t.element.input.onValue:t.element.input.offValue:i==null||i===""?null:t.dataType==="number"?i==="-0"||i==="-0."||i==="-0,"?i:parseFloat(i):t.field.type==="date"?parseFloat(i):i}_ignoreDeselectionOfNoValueOption(e){const{firstChild:t,selectedItems:i}=e;i.length===0&&t&&"selected"in t?t.selected=!0:ue.getLogger(this).warnOnce("Failed to override user attempt to deselect 'No value' option.")}_onGroupToggle(e,t){var i;e.open?(t.open=!0,this._focusedFieldName=((i=this._getFocusableInput("forward",t))==null?void 0:i.name)||null,this._attemptFocusOnNextRender=!0,this.groupDisplay==="sequential"&&this.viewModel.allGroupInputs.forEach(s=>{s!==t&&(s.open=!1)})):t.open=!1,this.scheduleRender()}_onFormSubmit(e){e.preventDefault()}_onFormKeyDown(e){e.key==="Enter"&&this.viewModel.submit()}_afterListObserverCreated(e){this.viewModel.activeRelationshipInput&&(this._listObserverNode=e)}_afterListObserverRemoved(){this._listObserverNode=null}_onObserverChange(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode);const e=this.viewModel.activeRelationshipInput;e&&this._listObserverNode&&e.showAllEnabled&&this._listObserver.observe(this._listObserverNode)}_incrementRelatedRecordPage(){const e=this.viewModel.activeRelationshipInput;e==null||e.incrementPage()}_syncGroupInputStates(){if(this.groupDisplay!=="sequential")return;const e=this.viewModel.allGroupInputs;if(!e.length)return;const t=e.filter(i=>i.open);t.length===0?e[0].open=!0:t.length>1&&t.slice(1).forEach(i=>i.open=!1)}get test(){return{inputsWithChanges:this._inputsWithChanges,updateValue:this._saveValueFromComponent.bind(this)}}};l([u()],C.prototype,"_listObserverNode",void 0),l([u()],C.prototype,"_relatedRecordsEnabled",null),l([u()],C.prototype,"_utilityNetworkAssociationsEnabled",null),l([u()],C.prototype,"_prompt",void 0),l([u()],C.prototype,"_subtypes",null),l([u()],C.prototype,"associationId",null),l([u()],C.prototype,"associatedLayer",null),l([u()],C.prototype,"disabled",null),l([u()],C.prototype,"feature",null),l([u()],C.prototype,"_featureFormUNAssociationList",void 0),l([u()],C.prototype,"formTemplate",null),l([u()],C.prototype,"groupDisplay",void 0),l([u()],C.prototype,"headingLevel",void 0),l([u()],C.prototype,"icon",null),l([u()],C.prototype,"label",null),l([u()],C.prototype,"layer",null),l([u()],C.prototype,"map",null),l([u(),J("esri/widgets/FeatureForm/t9n/FeatureForm")],C.prototype,"messages",void 0),l([u(),J("esri/t9n/common")],C.prototype,"messagesCommon",void 0),l([u(),J("esri/widgets/Feature/t9n/Feature")],C.prototype,"messagesFeature",void 0),l([u(),J("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],C.prototype,"messagesTemplates",void 0),l([u()],C.prototype,"callbacks",null),l([u()],C.prototype,"relationshipId",null),l([u()],C.prototype,"spatialReference",null),l([u()],C.prototype,"strict",null),l([u()],C.prototype,"timeZone",null),l([u()],C.prototype,"showPrompt",null),l([u()],C.prototype,"clearPrompt",null),l([u(),_i(["value-change","submit"])],C.prototype,"viewModel",void 0),l([u({type:ft,nonNullable:!0})],C.prototype,"visibleElements",void 0),l([u()],C.prototype,"test",null),C=l([T("esri.widgets.FeatureForm")],C);const Ss=C;export{Ss as e,Wi as n,zi as t};
