import{r}from"./tslib.es6-B3Jf3DVX.js";import{s as B}from"./intl-CChhNOV8.js";import{m as a,a as F}from"./subclass-BZA_h8Db.js";import{e as S,B as D,n as d,o as N}from"./jsxFactory-CJa39Fro.js";import{b as I}from"./Accessor-BLX9ikPh.js";import{e as f}from"./globalCss-CZa70j6i.js";import"./date-DlqISzcw.js";import"./jsonMap-0cxwUWs2.js";import"./locale-C9TlLpzi.js";import"./messages-OmQvZhAg.js";import"./assets-C43MgM-v.js";import"./index-Bh2oEzTI.js";import"./Evented-BHRw9x22.js";import"./Promise-B2Hu02L7.js";import"./reactiveUtils-C5zUhJQJ.js";import"./asyncUtils-CWX51uTe.js";import"./Collection-CEdjem1-.js";import"./shared-B3wH2qpO.js";import"./SimpleObservable-KocWTzVy.js";import"./uuid-fwrPAdZb.js";import"./cast-Bjksrh93.js";let p=class extends I{constructor(t){super(t),this.average=null,this.bins=null,this.max=null,this.min=null}get binRange(){const{bins:t}=this;return t&&t.length>1?t[t.length-1].maxValue-t[0].minValue:0}set labelFormatFunction(t){this._set("labelFormatFunction",t)}get range(){const{max:t,min:e}=this;return t!=null&&e!=null?t-e:0}get state(){const{bins:t,range:e}=this;return e>0&&(t!=null&&t.length)?"ready":"disabled"}};r([a()],p.prototype,"average",void 0),r([a()],p.prototype,"bins",void 0),r([a({readOnly:!0})],p.prototype,"binRange",null),r([a()],p.prototype,"labelFormatFunction",null),r([a()],p.prototype,"max",void 0),r([a()],p.prototype,"min",void 0),r([a({readOnly:!0})],p.prototype,"range",null),r([a({readOnly:!0})],p.prototype,"state",null),p=r([F("esri.widgets.Histogram.HistogramViewModel")],p);const U=p;var v;const c="esri-histogram",h={base:c,horizontalLayout:`${c}--horizontal`,verticalLayout:`${c}--vertical`,content:`${c}__content`,svg:`${c}__svg`,bar:`${c}__bar`,bars:`${c}__bars`,label:`${c}__label`,dataLines:`${c}__data-lines`,dataLinesSubgroup:`${c}__data-lines-subgroup`,dataLine:`${c}__data-line`,averageLabel:`${c}__average-label`,averageDataLine:`${c}__average-data-line`,averageSymbol:`${c}__average-symbol`};let l=v=class extends D{constructor(t,e){super(t,e),this._bgFillId=`${this.id}-bg-fill`,this._containerNode=null,this._containerDimensions={width:0,height:0},this._defaultBarColor="#d8d8d8",this.barCreatedFunction=null,this.dataLines=null,this.dataLineCreatedFunction=null,this.dataLineUpdatedFunction=null,this.messages=null,this.viewModel=new U}get average(){return this.viewModel.average}set average(t){this.viewModel.average=t}get bins(){return this.viewModel.bins}set bins(t){this.viewModel.bins=t}get icon(){return"graph-histogram"}set icon(t){this._overrideIfSome("icon",t)}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get labelFormatFunction(){return this.viewModel.labelFormatFunction}set labelFormatFunction(t){this.viewModel.labelFormatFunction=t}set layout(t){t!=="vertical"&&(t="horizontal"),this._set("layout",t)}get max(){return this.viewModel.max}set max(t){this.viewModel.max=t}get min(){return this.viewModel.min}set min(t){this.viewModel.min=t}get state(){return this.viewModel.state}static fromHistogramResult(t){const{bins:e,maxValue:i,minValue:n}=t;return new v({bins:e,max:i,min:n})}render(){const{label:t,layout:e,state:i}=this,n=this.classes(h.base,f.widget,e==="horizontal"?h.horizontalLayout:h.verticalLayout,i==="disabled"?f.disabled:null);return d("div",{afterCreate:this._afterContainerNodeCreate,"aria-label":t,bind:this,class:n},i==="ready"?this._renderContent():null)}_renderContent(){if(!this._containerNode)return;const t=this._bgFillId,e=`clip-path: url(#${t})`;return d("div",{class:h.content},d("svg",{class:h.svg,xmlns:"http://www.w3.org/2000/svg"},d("defs",null,this._renderFillDefinition(t)),d("g",{style:e},this._renderBarsGroup()),this._renderLinesGroup()))}_renderBarsGroup(){return d("g",{class:this.classes(h.bars)},this._renderBars())}_renderBars(){const{layout:t,viewModel:{binRange:e,range:i}}=this;if(!e||!i)return;const n=e/i,{width:s,height:o}=this._containerDimensions;if(o===0&&s===0)return;if(o===0&&s!==0)return void this.scheduleRender();const[u,g]=t==="vertical"?[o*n,s]:[o,s*n];return this._getBarDimensions(u,g).map(([m,b],_)=>this._renderBar(_,m,b))}_renderBar(t,e,i){const{bins:n,layout:s,max:o,messages:u,viewModel:{range:g}}=this;if(!n||o==null)return;const{width:m,height:b}=this._containerDimensions,_=n.slice()[t],{count:w,maxValue:y,minValue:x}=_,L=o-y,[C,M]=s==="vertical"?[0,L*(b/g)]:[m-i-L*(m/g),b-e],$=B(u.barLabel,{count:w,maxValue:y,minValue:x});return d("rect",{afterCreate:this._afterBarCreate,"aria-label":$,bind:this,class:h.bar,"data-index":t,fill:this._defaultBarColor,height:e,role:"img","shape-rendering":"crispEdges","stroke-width":"0",width:i,x:C,y:M})}_renderLinesGroup(){return d("g",{class:this.classes(h.dataLines)},this._renderAverageLine(),this._renderCustomLines())}_renderAverageLine(){const{average:t}=this;if(t==null)return;const e=[d("tspan",{class:this.classes(h.averageSymbol)},"xÌ„ "),d("tspan",{class:this.classes(h.averageLabel)},this.labelFormatFunction?this.labelFormatFunction(t,"average"):t)];return d("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(h.dataLinesSubgroup)},d("title",{key:"title"},t),this._renderLine(t,this.classes(h.averageDataLine)),this._renderLabel({label:e,value:t}))}_renderCustomLines(){var t;if((t=this.dataLines)!=null&&t.length)return this.dataLines.map((e,i)=>this._renderLineSubgroup(e,i))}_renderLineSubgroup(t,e){const{value:i}=t;return d("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(h.dataLinesSubgroup),"data-index":e},d("title",{key:"title"},i),this._renderLine(i),this._renderLabel(t))}_renderLine(t,e){const[i,n,s,o]=this._getLinePosition(t);return d("line",{class:this.classes(h.dataLine,e),"shape-rendering":"crispEdges",x1:i,x2:n,y1:s,y2:o})}_renderLabel(t,e){const{label:i,value:n}=t,[s,o]=this._getLabelPosition(n);return d("text",{class:this.classes(h.label,e),"text-anchor":"end",transform:this.layout==="horizontal"?"rotate(270)":null,x:s,y:o-2},i??"")}_renderFillDefinition(t){const{width:e,height:i}=this._containerDimensions;return d("clipPath",{id:t},d("rect",{height:i,width:e,x:"0",y:"0"}))}_afterContainerNodeCreate(t){this._containerNode=t,this.addHandles(N(t,e=>{const{width:i,height:n}=e.contentRect;this._containerDimensions={width:i,height:n}}))}_getIndexFromElement(t){var n;const e=(n=t.dataset)==null?void 0:n.index,i=t.getAttribute("data-index");return e!=null?parseInt(e,10):i!=null?parseInt(i,10):null}_afterBarCreate(t){if(this.barCreatedFunction){const e=this._getIndexFromElement(t)??-1;this.barCreatedFunction(e,t)}}_afterLinesSubgroupCreate(t){if(this.dataLineCreatedFunction){const e=this._getIndexFromElement(t),i=t.childNodes[1],n=t.childNodes[2]?t.childNodes[2]:null;this.dataLineCreatedFunction(i,n,e)}}_afterLinesSubgroupUpdate(t){if(this.dataLineUpdatedFunction){const e=this._getIndexFromElement(t),i=t.childNodes[1],n=t.childNodes[2]?t.childNodes[2]:null;this.dataLineUpdatedFunction(i,n,e)}}_getBarDimensions(t,e){const{bins:i,layout:n}=this,s=i?i.map(u=>u.count):[],o=Math.max.apply(Math,s);return s.map(u=>n==="vertical"?[t/s.length,o!==0?u/o*e:0]:[o!==0?u/o*t:0,e/s.length])}_getLinePosition(t){const{layout:e,min:i,viewModel:{range:n}}=this;if(i==null)return[0,0,0,0];const s=Math.round((t-i)/n*100)/100,{width:o,height:u}=this._containerDimensions,[g,m]=[s*o||1,u-s*u||1];return e==="vertical"?[0,"100%",m,m]:[g,g,"100%",0]}_getLabelPosition(t){const{layout:e,min:i,viewModel:{range:n}}=this;if(i==null)return[0,0];const s=Math.round((t-i)/n*100)/100,{width:o,height:u}=this._containerDimensions;return e==="vertical"?[o,u-s*u]:[0,s*o]}};r([a()],l.prototype,"_bgFillId",void 0),r([a()],l.prototype,"_containerNode",void 0),r([a()],l.prototype,"_containerDimensions",void 0),r([a()],l.prototype,"_defaultBarColor",void 0),r([a()],l.prototype,"average",null),r([a()],l.prototype,"barCreatedFunction",void 0),r([a()],l.prototype,"dataLines",void 0),r([a()],l.prototype,"dataLineCreatedFunction",void 0),r([a()],l.prototype,"dataLineUpdatedFunction",void 0),r([a()],l.prototype,"icon",null),r([a()],l.prototype,"label",null),r([a()],l.prototype,"labelFormatFunction",null),r([a({value:"horizontal"})],l.prototype,"layout",null),r([a()],l.prototype,"max",null),r([a(),S("esri/widgets/Histogram/t9n/Histogram")],l.prototype,"messages",void 0),r([a()],l.prototype,"min",null),r([a({readOnly:!0})],l.prototype,"state",null),r([a()],l.prototype,"viewModel",void 0),l=v=r([F("esri.widgets.Histogram")],l);const et=l;export{et as default};
