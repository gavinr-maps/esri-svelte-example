import{L as T,u as y,c as f,n as b,s as u,d as E,b as M,x as p,i as I,a as P}from"./index-4eY77cms.js";import{r as _}from"./index-C5b9dHRB.js";import{k as $,j as O,E as F,r as e,m as a,a as S}from"./Accessor-BmwT4B0c.js";import{b as C}from"./GeolocationPositioning-CECWv2rf.js";import{s as W}from"./useT9n-Dwv-EXPO.js";import{u as x}from"./useViewModel-x7-oy52B.js";import{e as k}from"./globalCss-B9-jl_gY.js";import"./Graphic-Dt0LgVGU.js";import"./Clonable-Z-AWS-16.js";import"./reactiveUtils-XM7cS2OP.js";import"./Evented-Dw4_VOGn.js";import"./SimpleObservable-CvOkykwM.js";import"./JSONSupport-DcrLLGjL.js";import"./cast-CsZslgGN.js";import"./writer-DKgfqj4X.js";import"./opacityUtils-Dim20wpZ.js";import"./Promise-DfET-uns.js";import"./Point-Cz2JYYmX.js";import"./enumeration-DpvDkLNI.js";import"./Color-VJEMvW-n.js";import"./colorUtils-Rxh2V3ai.js";import"./mathUtils-Cfq9PL9W.js";import"./ActionToggle-D7439N1A.js";import"./Identifiable-BHVfzH03.js";import"./jsonUtils-CwFG8yN4.js";import"./Extent-g5W9hy0j.js";import"./Polyline-s-JzsQqo.js";import"./typeUtils-B6WBEKDM.js";import"./TextSymbol-BLIQ6RKX.js";import"./screenUtils-_ZIvrt5o.js";import"./collectionUtils-CTT-51g7.js";import"./Portal-CmmHxpLg.js";import"./vec3f64-BLpZdpfb.js";import"./aaBoundingBox-Dw3yBk2f.js";import"./geolocationUtils-BUZ2_doz.js";import"./project-CvBujuEW.js";import"./utils-YowqfOgk.js";import"./utils-B-dlKIhi.js";import"./GoTo-zPv0y7kC.js";import"./component-utils-D0ciaaZ_.js";const D=15e3;let r=class extends C{constructor(i){super(i),this._watchId=void 0,this._trackStartingTimeoutId=void 0,this._settingPosition=null,this._trackController=null,this.error=void 0,this.positionFilterFunction=null}destroy(){this._stopTracking()}get state(){return this._geolocationUsable?this.view&&!this.view.ready?"disabled":this._settingPosition||this._trackStartingTimeoutId!==void 0?"waiting":this.tracking?"tracking":this.error!=null?"error":"ready":"feature-unsupported"}get tracking(){return this._watchId!==void 0}start(){this.state!=="disabled"&&this.state!=="feature-unsupported"&&this._startTracking()}stop(){this.state!=="disabled"&&this.state!=="feature-unsupported"&&this._stopTracking()}_stopWatchingPosition(){this._watchId!==void 0&&(navigator.geolocation.clearWatch(this._watchId),this._watchId=void 0)}_stopTracking(){this._abortTrack(),this._clearWaitingTimer(),this._stopWatchingPosition(),this._clearGraphic()}_startTracking(){this._stopTracking();const i=$(async t=>{this._abortTrack();const o=new AbortController;this._trackController=o;const{timestamp:n,coords:s}=t,h={timestamp:n,coords:{...s}};this.error=void 0;try{if(typeof this.positionFilterFunction=="function"&&!this.positionFilterFunction.call(null,{position:h})||(await this.updatePosition(t,o),this._trackController!==o))return;this._clearWaitingTimer(),this._addGraphic(),this.emit("track",{position:t}),this._trackController=null}catch(c){if(F(c))return;throw this._trackController=null,this._emitError(c),this._clearWaitingTimer(),c}},0);this._watchId=navigator.geolocation.watchPosition(t=>{this._settingPosition=i(t).catch(O)},this._handleWatchPositionError.bind(this),this.geolocationOptions??void 0),this._trackStartingTimeoutId=setTimeout(()=>{this._trackStartingTimeoutId=void 0},D)}_handleWatchPositionError(i){i.code===i.PERMISSION_DENIED&&this._stopTracking(),this._emitError(i)}_abortTrack(){var i;(i=this._trackController)==null||i.abort(),this._trackController=null}_clearWaitingTimer(){clearTimeout(this._trackStartingTimeoutId),this._trackStartingTimeoutId=void 0,this._settingPosition=null}_emitError(i){this.error=i,this.emit("track-error",{error:i})}};e([a()],r.prototype,"_watchId",void 0),e([a()],r.prototype,"_trackStartingTimeoutId",void 0),e([a()],r.prototype,"_settingPosition",void 0),e([a()],r.prototype,"error",void 0),e([a()],r.prototype,"positionFilterFunction",void 0),e([a({readOnly:!0})],r.prototype,"state",null),e([a({readOnly:!0})],r.prototype,"tracking",null),e([a()],r.prototype,"start",null),e([a()],r.prototype,"stop",null),r=e([S("esri.widgets.Track.TrackViewModel")],r);const G=r;/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
v4.32.12 */const L=I`@layer{arcgis-track{display:block}}`,R={base:"esri-track"},N=x(G),l=class l extends T{constructor(){super(...arguments),this.messages=W(),this.viewModel=N(this),this.autoDestroyDisabled=!1,this.error=this.viewModel.error,this.geolocationOptions=this.viewModel.geolocationOptions,this.goToOverride=this.viewModel.goToOverride,this.goToLocationDisabled=this.viewModel.goToLocationEnabled,this.graphic=this.viewModel.graphic,this.icon="compass-north-circle",this.position="top-left",this.positionFilterFunction=this.viewModel.positionFilterFunction,this.scale=this.viewModel.scale,this.state=this.viewModel.state,this.tracking=this.viewModel.tracking,this.arcgisComplete=_(()=>this.viewModel,"track"),this.arcgisError=_(()=>this.viewModel,"track-error"),this.arcgisPropertyChange=y()("state"),this.arcgisReady=f()}async destroy(){await this.manager.destroy()}async start(){this.viewModel.start()}async stop(){this.viewModel.stop()}_localizeError(t){var o,n,s;if(t instanceof GeolocationPositionError)return t.code===GeolocationPositionError.PERMISSION_DENIED?(o=this.messages)==null?void 0:o.permissionError:t.code===GeolocationPositionError.TIMEOUT?(n=this.messages)==null?void 0:n.timeoutError:(s=this.messages)==null?void 0:s.positionUnavailable;if(t instanceof Error)return t.message}_toggleTracking(){if(!this.viewModel)return;const{state:t}=this.viewModel;if(!(t==="feature-unsupported"||t==="disabled")){if(t==="tracking"||t==="waiting"){this.viewModel.stop();return}this.viewModel.start()}}render(){var m;const{viewModel:t,messages:o,icon:n}=this,s=t==null?void 0:t.state,h=s==="tracking",c=this._localizeError((m=this.viewModel)==null?void 0:m.error),g=(h?o==null?void 0:o.stopTracking:o==null?void 0:o.startTracking)??"",v=s==="feature-unsupported",w=(s==="tracking"?"pause":void 0)??n??void 0;return p`<div class=${u(E(R.base,k.widget))}>${!v&&p`<calcite-button class=${u(k.widgetButton)} .disabled=${s==="disabled"} .iconStart=${w} kind=neutral .label=${g} .loading=${s==="waiting"} @click=${this._toggleTracking} title=${g??M}></calcite-button>`||""}${c?p`<calcite-tooltip open overlay-positioning=fixed .referenceElement=${this.el}>${c}</calcite-tooltip>`:null}</div>`}};l.properties={autoDestroyDisabled:5,error:1,geolocationOptions:1,goToOverride:0,goToLocationDisabled:7,graphic:0,icon:3,label:1,messageOverrides:0,position:3,positionFilterFunction:0,referenceElement:1,scale:9,state:0,tracking:4},l.shadowRootOptions=b,l.styles=L;let d=l;P("arcgis-track",d);export{d as ArcgisTrack};
