import{u as y,e as l}from"./screenUtils-_ZIvrt5o.js";import{t as b}from"./CIMSymbolHelper-BDfNg_6w.js";import{CIMSymbolRasterizer as V}from"./CIMSymbolRasterizer-DN1BvqaU.js";import{OverrideHelper as $}from"./OverrideHelper-BItCoKFp.js";import{V as q}from"./utils-UPZJIDfz.js";import{l as D,t as S}from"./symbolUtils-CHmFfSx2.js";import"./BidiEngine-QXap_35O.js";import"./Accessor-BmwT4B0c.js";import"./Polyline-s-JzsQqo.js";import"./writer-DKgfqj4X.js";import"./Extent-g5W9hy0j.js";import"./Point-Cz2JYYmX.js";import"./cast-CsZslgGN.js";import"./index-4eY77cms.js";import"./JSONSupport-DcrLLGjL.js";import"./mathUtils-Cfq9PL9W.js";import"./TextSymbol-BLIQ6RKX.js";import"./Color-VJEMvW-n.js";import"./colorUtils-Rxh2V3ai.js";import"./enumeration-DpvDkLNI.js";import"./fontUtils-CGi-tOxo.js";import"./jsonUtils-CwFG8yN4.js";import"./OptimizedGeometry-BJqUA4Pi.js";import"./memoryEstimations-Bcyf-mHz.js";import"./GeometryUtils-F7QfOKlc.js";import"./enums-BTM-fOHQ.js";import"./defaultCIMValues-Bb-CUowV.js";import"./rasterizingUtils-C1EbvluX.js";import"./floatRGBA-Cb__GiDF.js";import"./definitions-CP59Y04S.js";import"./mat2d-D9DBP-jx.js";import"./common-DQOJ18NT.js";import"./mat2df32-orApM5a3.js";import"./vec2-ChnYg_BJ.js";import"./vec2f32-BbH2jxlN.js";import"./Rect-CUzevAry.js";import"./BoundingBox-CnpCxTZE.js";import"./defaults-FkBa0ybj.js";import"./defaultsJSON-GKolV7NZ.js";import"./CIMResourceManager-d5CfLxhB.js";import"./imageUtils-DsXKmbqJ.js";import"./colorUtils-DaPfwnk3.js";import"./vec42-YcqnINSP.js";import"./vec4f64-o2zAXfmz.js";import"./opacityUtils-Dim20wpZ.js";import"./Promise-DfET-uns.js";import"./callExpressionWithFeature-Dty09cLj.js";import"./quantizationUtils-DgFbqZi7.js";import"./utils-aIx1khaq.js";import"./reactiveUtils-XM7cS2OP.js";import"./Evented-Dw4_VOGn.js";import"./SimpleObservable-CvOkykwM.js";import"./vec3f64-BLpZdpfb.js";import"./jsonUtils-DZz5FrgB.js";import"./utils-DYurMneM.js";import"./mat4f32-DcsiF_Rp.js";import"./mat4-Fi6iAz29.js";import"./cimSymbolUtils-DzhKvmq_.js";import"./LRUCache-CXiGQWMN.js";import"./MemCache-CmojB_Z1.js";import"./Graphic-Dt0LgVGU.js";import"./Clonable-Z-AWS-16.js";import"./ActionToggle-D7439N1A.js";import"./Identifiable-BHVfzH03.js";import"./typeUtils-B6WBEKDM.js";import"./collectionUtils-CTT-51g7.js";import"./Portal-CmmHxpLg.js";import"./aaBoundingBox-Dw3yBk2f.js";import"./jsxFactory-Cnml7uXM.js";import"./intl-Duiy0OzY.js";import"./uuid-Cl5lrJ4c.js";import"./webStyleSymbolUtils-C6Yokq8v.js";import"./devEnvironmentUtils-CnNDiFMM.js";import"./jsonUtils-B-voMz-i.js";import"./layerUtils-B__v9OBu.js";import"./styleUtils-ColFrJ-Z.js";import"./webStyleAcceptedFormats-CG7ZQ6BV.js";const f=new V(null),u=l(S.size),G=l(S.maxSize),M=l(S.lineWidth),E=1;async function U(r,t,n){const e=t==null?void 0:t.size;let i=e!=null&&typeof e=="object"&&"width"in e?e.width:e,m=e!=null&&typeof e=="object"&&"height"in e?e.height:e;if(i==null||m==null)if(n==="esriGeometryPolygon")i=m=t.maxSize?Math.min(t.maxSize,u):u;else{const o=await k(r,t,n);o&&(i=o.width,m=o.height),n==="esriGeometryPolyline"&&(i=t.maxSize?Math.min(t.maxSize,M):M),i=i!=null&&isFinite(i)?Math.min(i,G):u,m=m!=null&&isFinite(m)?Math.max(Math.min(m,G),E):u}return t.style==="legend"&&n==="esriGeometryPolyline"&&(i=M),{width:i,height:m}}async function k(r,t,n){const{feature:e,fieldMap:i,viewParams:m}=t.cimOptions||t,o=await $.resolveSymbolOverrides(r.data,e,null,i,n,null,m);if(!o)return null;(r=r.clone()).data={type:"CIMSymbolReference",symbol:o},r.data.primitiveOverrides=void 0;const a=[];return b.fetchResources(o,f.resourceManager,a),b.fetchFonts(o,f.resourceManager,a),a.length>0&&await Promise.all(a),b.getEnvelope(o,null,f.resourceManager)}async function si(r,t={}){var z,P;const{node:n,opacity:e,symbolConfig:i}=t,m=i!=null&&typeof i=="object"&&"isSquareFill"in i&&i.isSquareFill,o=t.cimOptions||t,a=o.geometryType||q((z=r==null?void 0:r.data)==null?void 0:z.symbol),p=await U(r,t,a),{feature:I,fieldMap:L}=o,O=t!=null&&t.geometry||m||a!=="esriGeometryPolygon"?"preview":"legend";let v=p;const x=p;if(t!=null&&t.geometry&&(a==="esriGeometryPolygon"||a==="esriGeometryPolyline")&&(y(p.width)<200||y(p.height)<200)){const R=p.width>p.height?l(200)*p.height/p.width:l(200);v={width:p.width>p.height?l(200):l(200)*p.width/p.height,height:R}}const g=await f.rasterizeCIMSymbolAsync(r,I,v,O,L,a,null,o.viewParams,o.allowScalingUp,(P=t==null?void 0:t.geometry)==null?void 0:P.toJSON());if(!g)return null;const{width:F,height:j}=g,h=document.createElement("canvas");h.width=F,h.height=j,h.getContext("2d").putImageData(g,0,0);const d=y(x.width),w=y(x.height),s=new Image(d,w);s.src=h.toDataURL(),s.ariaLabel=t.ariaLabel??null,s.alt=t.ariaLabel??"",e!=null&&(s.style.opacity=`${e}`);let c=s;if(t.effectView!=null){const C={shape:{type:"image",x:0,y:0,width:d,height:w,src:s.src},fill:null,stroke:null,offset:[0,0]};c=D([[C]],[d,w],{effectView:t.effectView,ariaLabel:t.ariaLabel})}return n&&c&&n.appendChild(c),c}export{si as previewCIMSymbol};
