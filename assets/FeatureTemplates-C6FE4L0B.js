const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./TextSymbol-zZq0BA1M.js","./Evented-CXIxDjmW.js","./Accessor-D6mNnsWy.js","./subclass-BR3PhgZG.js","./Color-DDUWtbqR.js","./colorUtils-CS9vdHXB.js","./mathUtils-ClvKsMak.js","./jsonMap-DCC6W5ex.js","./enumeration--HlxOQ_N.js","./screenUtils-PfxkaaMN.js","./writer-3zufXUNV.js","./assets-BNizZMOZ.js","./index-BVncS3aY.js","./index-CjOb8WjV.css","./calcite-icon-DtUarwQp.js","./icon-D6t4qKDg.js","./jsxFactory-Be5PKa9i.js","./intl-CArXn1et.js","./Promise-CZrWwByK.js","./reactiveUtils-BFQ0BtrB.js","./shared-B3wH2qpO.js","./uuid-fwrPAdZb.js","./dom-BkQ_hHOr.js","./observers-DSkGD1TQ.js","./calcite-loader-Cyav0WwQ.js","./loader-ew3V3w9x.js","./locale-BvYy6Wxh.js","./key-D5DPfjW0.js","./calcite-input-p_Le978W.js","./input2-BjqyiC1c.js","./form-BOCdnUd9.js","./interactive-QOqfpSSx.js","./label-1rGx7O4B.js","./component-ByvC-PUv.js","./loadable-Bgtgv1lm.js","./t9n-Atzq4sOi.js","./Validation-Dm76Kltf.js","./input-Dt5r39B0.js","./input-message-BGlL44gg.js","./progress-CMyqabfC.js","./calcite-list-CauCCaYV.js","./resources4-CT6dxwoZ.js","./utils3-SlIPNAt8.js","./filter-BHzLPuAd.js","./debounce-C5YDvsuO.js","./scrim-fRLdjgt6.js","./calcite-list-item-DnfVo5id.js","./action-CFB8-9mS.js","./handle-DVEsJI64.js","./calcite-notice-CVdHfJFK.js","./conditionalSlot-eNLH0S30.js","./openCloseComponent-Bqj9CrBJ.js"])))=>i.map(i=>d[i]);
import{_ as I}from"./index-BVncS3aY.js";import{e as s,o as Y}from"./Evented-CXIxDjmW.js";import{d as N,P as J,p as Z}from"./reactiveUtils-BFQ0BtrB.js";import{y as o,b as $}from"./subclass-BR3PhgZG.js";import{O as ee,k as te}from"./layerUtils-BzjQnEdj.js";import{n as m,f as K,e as R,B as re,r as ie}from"./jsxFactory-Be5PKa9i.js";import{V as Q}from"./featureFormUtils-8KaQp8jR.js";import{S as A,d as j}from"./Accessor-D6mNnsWy.js";import{d as se}from"./Graphic-Bi5hWHps.js";import{V as le}from"./symbolUtils-DE-py14C.js";import{s as oe}from"./Identifiable-BLvpQbOc.js";import{e as ne}from"./Heading-DPYpGh42.js";import{e as ae}from"./globalCss-CZa70j6i.js";import{e as de}from"./vmEvent-D4Ubqkbq.js";var S;let b=S=class extends A{constructor(e){super(e),this._activeFetchInfo={id:null,request:null},this.disabled=!1,this.layer=null,this.template=null,this.thumbnail=null}initialize(){this.addHandles(N(()=>{const{layer:e}=this;return[e&&"renderer"in e?e.renderer:null,this.template]},()=>{this._activeFetchInfo.id=null,this._activeFetchInfo.request=null,this._set("thumbnail",null)},J))}get description(){var e;return(e=this.template)==null?void 0:e.description}set description(e){this.template&&(this.template.description=e)}get label(){var e;return(e=this.template)==null?void 0:e.name}set label(e){this.template&&(this.template.name=e)}get id(){var e;return`${this.label??""}–${(e=this.layer)==null?void 0:e.id}`}get supportsUpload(){var e;return((e=this.layer)==null?void 0:e.type)==="scene"}clone(){const e=this.thumbnail!=null?this.thumbnail.cloneNode(!0):null,t=new S({layer:this.layer,template:this.template});return t._set("thumbnail",e),t}static async fetchThumbnail(e,t){var l;const r=await ue(e,t);if(r==null)return null;const i={maxSize:36};return((l=e.renderer)==null?void 0:l.type)==="dictionary"&&(i.fieldMap=e.renderer.fieldMap??void 0,i.feature={attributes:t.prototype.attributes??{}}),await le(r,i)}};s([o()],b.prototype,"description",null),s([o()],b.prototype,"disabled",void 0),s([o()],b.prototype,"label",null),s([o()],b.prototype,"layer",void 0),s([o()],b.prototype,"template",void 0),s([o({readOnly:!0})],b.prototype,"thumbnail",void 0),s([o()],b.prototype,"id",null),s([o()],b.prototype,"supportsUpload",null),b=S=s([$("esri.widgets.FeatureTemplates.TemplateItem")],b);const x=b;async function ue(e,t){const{renderer:r}=e;if(r){const i=new se({attributes:t.prototype.attributes}),l=await r.getSymbolAsync(i);if(l)return l}return pe(e)}async function pe(e){const{geometryType:t}=e,r=t==="point"||t==="multipoint"?await I(()=>import("./TextSymbol-zZq0BA1M.js").then(i=>i.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url):t==="polyline"?await I(()=>import("./TextSymbol-zZq0BA1M.js").then(i=>i.h),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url):t==="polygon"||t==="mesh"||t==="multipatch"?await I(()=>import("./TextSymbol-zZq0BA1M.js").then(i=>i.j),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url):null;return r?new r.default:null}let w=class extends oe(A){constructor(t){super(t),this.items=null,this.label=null}get id(){return this.label}findByTemplate(t){return this.items.find(r=>r.template===t)}};s([o()],w.prototype,"items",void 0),s([o()],w.prototype,"label",void 0),s([o()],w.prototype,"id",null),w=s([$("esri.widgets.FeatureTemplates.TemplateItemGroup")],w);const me=w,U=e=>e==null||typeof e!="object"?[]:[..."templates"in e&&Array.isArray(e.templates)?e.templates:[],..."types"in e&&Array.isArray(e.types)?e.types.flatMap(t=>t.templates):[]];var T;const ce=({layer:e})=>({key:e,label:e.title??""}),he=({layer:e})=>({key:e.geometryType,label:e.geometryType??""});let h=T=class extends Y.EventedAccessor{constructor(e){super(e),this._groupPool=new j(me),this._itemPool=new j(x),this.disabled=!1,this.disabledItemFunction=null,this.filterFunction=null,this.selectedItem=null}initialize(){this._get("groupBy")||(this.groupBy="layer")}get _featureTemplatesByLayer(){if(!this.layers)return new Map;const e=new Map;for(const t of this.layers)if(t.type==="subtype-group")for(const r of t.sublayers)e.set(r,U(r));else e.set(t,U(t));return e}set groupBy(e){if(this._set("groupBy",e),typeof e!="function")switch(e){case"layer":this._groupByFunction=ce;break;case"geometry":this._groupByFunction=he;break;default:this._groupByFunction=null}else this._groupByFunction=t=>this._ensureGroupByObject(e(t))}set layers(e){const t="layers";if(this.removeHandles(t),e){const r=()=>this.notifyChange("state");this.addHandles(e.map(i=>Z(()=>i.loadStatus,r)),t)}this._set("layers",e)}get layers(){return this._get("layers")}get state(){const{layers:e}=this;return e&&e.length!==0?e.some(t=>t.loadStatus==="loading"||t.loadStatus==="not-loaded")?"loading":"ready":"disabled"}get numberOfFeatureTemplates(){return Array.from(this._featureTemplatesByLayer.values()).reduce((e,t)=>e+t.length,0)}get items(){var a,c,f;if(this.numberOfFeatureTemplates===0)return this._releasePreviousItems(),[];const e=this._featureTemplatesByLayer,t=[],r=this.filterFunction!=null?this.filterFunction:T._nullFilterFunction;for(const[u,p]of e)if(u.loaded||u.type==="subtype-sublayer"&&((a=u.parent)!=null&&a.loaded)){const n=(c=ee(u))==null?void 0:c.operations;if(n!=null&&n.supportsEditing&&(n!=null&&n.supportsAdd))for(const y of p)t.push({layer:u,template:y,matchesFilter:r({label:y.name})})}if(this._groupByFunction==null){const u=t.filter(({matchesFilter:p})=>p).map(({template:p,layer:n})=>this._createItem(p,n));return this._releasePreviousItems(),u}const i=new Map;for(const u of t){const{template:p,layer:n}=u,y=this._groupByFunction({template:p,layer:n}),{key:_,label:v}=y.key!=null?y:T.nullGroupBy;i.has(_)||i.set(_,{label:v,templateItemInfos:[]}),(f=i.get(_))==null||f.templateItemInfos.push(u)}const l=[];for(const u of i.values()){const{label:p,templateItemInfos:n}=u,y=n.filter(({matchesFilter:v})=>v),_=r({label:p})?n:n.length>0?y:[];if(_.length>0){const v=_.map(({template:B,layer:E})=>this._createItem(B,E));l.push(this._createGroup(p,v))}}return l.length===1&&l[0].label===T.nullGroupBy.label?(this._releasePreviousItems(),l[0].items):(this._releasePreviousItems(),l)}refresh(){this.notifyChange("items")}select(e,{emit:t=!0}={}){const r=this.selectedItem,i=(e==null?void 0:e.clone())||null;this._set("selectedItem",i),t&&this.emit("select",{item:i,oldItem:r,template:(i==null?void 0:i.template)??null})}_createItem(e,t){var l;const r=this._itemPool.acquire(),i=((l=this.disabledItemFunction)==null?void 0:l.call(this,{template:e,layer:t}))??!1;return r.set({disabled:i,layer:t,template:e}),r}_createGroup(e,t){const r=this._groupPool.acquire();return r.set("label",e),r.items=t,r}_releasePreviousItems(){this._destroyItems(this._get("items"))}_destroyItems(e){e&&(e[0]instanceof x?e.forEach(t=>this._destroyItem(t)):e.forEach(t=>this._destroyGroup(t)))}_destroyGroup(e){e.items.forEach(t=>this._destroyItem(t)),e.items.length=0,this._groupPool.release(e)}_destroyItem(e){e.layer=null,e.template=null,this._itemPool.release(e)}_ensureGroupByObject(e){return typeof e=="string"?{key:e,label:e}:e}};h.nullGroupBy={key:Symbol(),label:"Other​"},h._nullFilterFunction=e=>!0,s([o()],h.prototype,"_featureTemplatesByLayer",null),s([o()],h.prototype,"_groupByFunction",void 0),s([o()],h.prototype,"disabled",void 0),s([o()],h.prototype,"disabledItemFunction",void 0),s([o()],h.prototype,"filterFunction",void 0),s([o()],h.prototype,"groupBy",null),s([o()],h.prototype,"layers",null),s([o()],h.prototype,"state",null),s([o({readOnly:!0})],h.prototype,"numberOfFeatureTemplates",null),s([o({readOnly:!0})],h.prototype,"items",null),s([o({readOnly:!0})],h.prototype,"selectedItem",void 0),h=T=s([$("esri.widgets.FeatureTemplates.FeatureTemplatesViewModel")],h);const H=h,C="esri-item-list",M=`${C}__list-item`,g={base:C,filterContainerSticky:`${C}__filter-container--sticky`,group:`${C}__group`,groupHeader:`${C}__group__header`,item:M,itemDisabled:`${M}--disabled`,itemIcon:`${M}-icon`,itemContentEnd:`${M}-content-end`,noMatchesMessage:`${C}__no-matches-message`,scroller:`${C}__scroller`,scrollerEnabled:`${C}__scroller--enabled`},ye=4;function fe(e){const{disabled:t,filterText:r="",id:i,messages:l,onFilterChange:a,...c}=e;return m("div",{key:i},e.filterEnabled??1?ge({disabled:t,filterText:r,id:i,messages:l,onFilterChange:a}):null,_e({...c,disabled:t,enableListScroll:e.enableListScroll??!0,filterText:r,messages:l}))}function be(e){return!!e.items}function _e(e){const{headingLevel:t,items:r,...i}=e;return r.length===0?m("div",{class:g.noMatchesMessage,key:"no-matches"},e.messages.noMatches):m("div",{class:K({[g.scroller]:!0,[g.scrollerEnabled]:!!e.enableListScroll}),key:"item-container"},r.map(l=>be(l)?ve({...i,group:l,headingLevel:t}):W({...i,grouped:!0,item:l})))}function ge(e){const{disabled:t,messages:r,filterText:i,enableListScroll:l}=e;return m("div",{class:l?void 0:g.filterContainerSticky,key:"filter"},m("calcite-input",{disabled:t,placeholder:r.filterPlaceholder,type:"search",value:i,onCalciteInputInput:a=>{const c=a.currentTarget;e.onFilterChange&&e.onFilterChange(c.value)}}))}function W(e){const{disabled:t,grouped:r,identify:i,item:l,onItemMouseEnter:a,onItemMouseLeave:c,onItemSelect:f,renderIcon:u,renderCustomItem:p,renderItemContent:n,renderItemContentEnd:y,renderItemLabel:_,renderItemDescription:v,selectedItem:B}=e,E=z(l,i),D=E===z(B,i),G=p==null?void 0:p(e);if(G)return G;const L=n==null?void 0:n(l),V=y==null?void 0:y(l),P=!(!l.disabled&&!t);return m("calcite-list-item",{afterUpdate:F=>{F.selected=D},"aria-level":r?"2":"",class:K({[g.item]:!0,[g.itemDisabled]:P}),"data-item":l,description:L?void 0:(v==null?void 0:v(l))??void 0,disabled:P,key:E,label:L?void 0:(_==null?void 0:_(l))??l.label??void 0,onmouseenter:F=>a==null?void 0:a(k(F)),onmouseleave:F=>c==null?void 0:c(k(F)),selected:D,tabIndex:P?-1:0,onCalciteListItemSelect:F=>{F.preventDefault(),f==null||f(k(F))}},m("div",{class:g.itemIcon,key:"content-start",slot:"content-start"},u==null?void 0:u(l)),L?m("div",{key:"content",slot:"content"},L):null,V?m("div",{class:g.itemContentEnd,key:"content-end",slot:"content-end"},V):null)}function z(e,t){return e?`${(t==null?void 0:t(e))||e.id}__${e.label}`:""}function k(e){return e.currentTarget["data-item"]}function ve(e){const{disabled:t,group:r,headingLevel:i=ye,selectionMode:l="none",renderCustomGroupContent:a,...c}=e,f=a==null?void 0:a(e);return m("div",{class:g.group,key:r.label??void 0},m(ne,{class:g.groupHeader,level:i},r.label),f||m("calcite-list",{disabled:t,selectionAppearance:"border",selectionMode:l},r.items.map(u=>W({...c,disabled:t,item:u,grouped:!0}))))}let O=class extends A{constructor(e){super(e),this.filter=!0}};s([o({type:Boolean,nonNullable:!0})],O.prototype,"filter",void 0),O=s([$("esri.widgets.FeatureTemplates.VisibleElements")],O);const X=O,Ie={base:"esri-feature-templates"};function Fe(e){return e.length>0&&Q(e[0])}function Ce(e){return e.id}let d=class extends re{constructor(e,t){super(e,t),this.enableListScroll=!0,this.filterText="",this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.selectionMode="none",this.viewModel=new H,this.visibleElements=new X,this.renderCustomItem=r=>null,this.renderCustomGroupContent=r=>null,this.renderItemLabel=()=>null,this.renderItemDescription=()=>null,this.renderItemContent=r=>null,this.renderItemContentEnd=r=>null,this._iconIntersectionObserver=new IntersectionObserver((r,i)=>{r.forEach(async l=>{if(l.isIntersecting){const a=l.target;if(Te(a))return void i.unobserve(a);const c=we(a),{layer:f,template:u}=c;q(a,!0);const p=await x.fetchThumbnail(f,u).catch(()=>(q(a,!1),null));if(p==null)return;a.appendChild(p)}})}),this._renderItemIcon=r=>te(r.layer)?m("span",{"data-has-icon":!0,"data-item":r,key:"icon"},m("calcite-icon",{icon:"table"})):m("span",{afterCreate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,afterUpdate:this._afterItemCreateOrUpdate,"data-has-icon":!1,"data-item":r,key:"icon"}),this._afterItemCreateOrUpdate=r=>{var i;(i=this._iconIntersectionObserver)==null||i.observe(r)},this._afterItemRemoved=r=>{var i;(i=this._iconIntersectionObserver)==null||i.unobserve(r)}}initialize(){const e=({label:t})=>!this.filterText||!!(t!=null&&t.toLowerCase().includes(this.filterText.toLowerCase()));this.addHandles(N(()=>this.viewModel,(t,r)=>{t&&!t.filterFunction&&(this.filterFunction=e),r&&r!==t&&r.filterFunction===e&&(r.filterFunction=null)},J))}destroy(){var e;(e=this._iconIntersectionObserver)==null||e.disconnect(),this._iconIntersectionObserver=null}loadDependencies(){return ie({icon:()=>I(()=>import("./calcite-icon-DtUarwQp.js"),__vite__mapDeps([14,15,16,1,2,3,17,18,7,11,12,13,19,20,21,22,23]),import.meta.url),loader:()=>I(()=>import("./calcite-loader-Cyav0WwQ.js"),__vite__mapDeps([24,25,16,1,2,3,17,18,7,11,12,13,19,20,21,22,26,27,23]),import.meta.url),input:()=>I(()=>import("./calcite-input-p_Le978W.js"),__vite__mapDeps([28,29,16,1,2,3,17,18,7,11,12,13,19,20,21,22,30,31,27,32,33,34,26,23,35,36,37,15,38,39]),import.meta.url),list:()=>I(()=>import("./calcite-list-CauCCaYV.js"),__vite__mapDeps([40,16,1,2,3,17,18,7,11,12,13,19,20,21,22,31,23,41,42,34,35,26,27,43,44,15,29,30,32,33,36,37,38,39,25,45]),import.meta.url),"list-item":()=>I(()=>import("./calcite-list-item-DnfVo5id.js"),__vite__mapDeps([46,16,1,2,3,17,18,7,11,12,13,19,20,21,22,31,26,27,23,35,34,42,41,47,33,15,25,48]),import.meta.url),notice:()=>I(()=>import("./calcite-notice-CVdHfJFK.js"),__vite__mapDeps([49,16,1,2,3,17,18,7,11,12,13,19,20,21,50,23,22,34,26,27,35,51,33,15]),import.meta.url)})}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get filterFunction(){return this.viewModel.filterFunction}set filterFunction(e){this.viewModel.filterFunction=e}get groupBy(){return this.viewModel.groupBy}set groupBy(e){this.viewModel.groupBy=e}get icon(){return"list-rectangle"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get layers(){return this.viewModel.layers}set layers(e){this.viewModel.layers=e}get selectedItem(){return this.viewModel.selectedItem}select(e,t){return this.viewModel.select(e,t)}render(){const{disabled:e,enableListScroll:t,filterText:r,headingLevel:i,messages:l,viewModel:{items:a,numberOfFeatureTemplates:c,selectedItem:f,state:u}}=this,p=this.visibleElements.filter&&c>1;if(Fe(a)){const n=a.find(y=>y.label===H.nullGroupBy.label);n&&(n.label=l.other)}return m("div",{"aria-label":l.widgetLabel,class:this.classes(Ie.base,ae.widget)},u==="loading"?m("calcite-loader",{key:"loader",label:this.messagesCommon.loading,type:"indeterminate"}):u==="ready"?m(fe,{disabled:e,enableListScroll:t,filterEnabled:p,filterText:r,headingLevel:i,id:this.id,identify:Ce,items:a,messages:{filterPlaceholder:l.filterPlaceholder,noItems:l.noItems,noMatches:l.noMatches},renderCustomGroupContent:this.renderCustomGroupContent,renderCustomItem:this.renderCustomItem,renderIcon:this._renderItemIcon,renderItemContent:this.renderItemContent,renderItemContentEnd:this.renderItemContentEnd,renderItemDescription:this.renderItemDescription,renderItemLabel:this.renderItemLabel,selectedItem:f??void 0,selectionMode:this.selectionMode??void 0,onFilterChange:n=>{this.filterText=n,this.viewModel.refresh()},onItemSelect:n=>!Q(n)&&this.viewModel.select(n)}):null)}};function we(e){return e==null?void 0:e["data-item"]}function Te(e){return!!(e!=null&&e["data-has-icon"])}function q(e,t){e&&(e["data-has-icon"]=t)}s([o()],d.prototype,"disabled",null),s([o()],d.prototype,"enableListScroll",void 0),s([o()],d.prototype,"filterFunction",null),s([o()],d.prototype,"filterText",void 0),s([o()],d.prototype,"groupBy",null),s([o()],d.prototype,"headingLevel",void 0),s([o()],d.prototype,"icon",null),s([o()],d.prototype,"label",null),s([o()],d.prototype,"layers",null),s([o(),R("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],d.prototype,"messages",void 0),s([o(),R("esri/t9n/common")],d.prototype,"messagesCommon",void 0),s([o({readOnly:!0})],d.prototype,"selectedItem",null),s([o()],d.prototype,"selectionMode",void 0),s([o(),de("select")],d.prototype,"viewModel",void 0),s([o({type:X,nonNullable:!0})],d.prototype,"visibleElements",void 0),s([o()],d.prototype,"renderCustomItem",void 0),s([o()],d.prototype,"renderCustomGroupContent",void 0),s([o()],d.prototype,"renderItemLabel",void 0),s([o()],d.prototype,"renderItemDescription",void 0),s([o()],d.prototype,"renderItemContent",void 0),s([o()],d.prototype,"renderItemContentEnd",void 0),d=s([$("esri.widgets.FeatureTemplates")],d);const $e=d,Ue=Object.freeze(Object.defineProperty({__proto__:null,default:$e},Symbol.toStringTag,{value:"Module"}));export{$e as F,Ue as a,H as h,W as m,fe as o,U as t};
