const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./knowledgeGraphService-DXS9bis6.js","./cast-CsZslgGN.js","./Accessor-BmwT4B0c.js","./index-4eY77cms.js","./index-Cx51aysm.css","./JSONSupport-DcrLLGjL.js","./Point-Cz2JYYmX.js","./writer-DKgfqj4X.js","./submitJob-DPqOfn4F.js","./Extent-g5W9hy0j.js","./normalizeUtils-BTGdXlpz.js","./Polyline-s-JzsQqo.js","./mathUtils-Cfq9PL9W.js","./normalizeUtilsCommon-lGDszWRI.js","./jsonUtils-CwFG8yN4.js","./utils-YowqfOgk.js","./utils-B-dlKIhi.js","./Field-BDG0QV_T.js","./enumeration-DpvDkLNI.js","./fieldType-CBeoJWlv.js","./networkEnums-BgkT2jou.js","./FeatureSet-B5-Veyin.js","./Graphic-Dt0LgVGU.js","./Clonable-Z-AWS-16.js","./reactiveUtils-XM7cS2OP.js","./Evented-Dw4_VOGn.js","./SimpleObservable-CvOkykwM.js","./opacityUtils-Dim20wpZ.js","./Promise-DfET-uns.js","./Color-VJEMvW-n.js","./colorUtils-Rxh2V3ai.js","./ActionToggle-D7439N1A.js","./Identifiable-BHVfzH03.js","./typeUtils-B6WBEKDM.js","./TextSymbol-BLIQ6RKX.js","./screenUtils-_ZIvrt5o.js","./collectionUtils-CTT-51g7.js","./Portal-CmmHxpLg.js","./vec3f64-BLpZdpfb.js","./aaBoundingBox-Dw3yBk2f.js","./GPMessage-Ba6qfxW_.js","./Path-Z8ZejDN-.js"])))=>i.map(i=>d[i]);
import{_ as E}from"./index-4eY77cms.js";import{O as K}from"./Accessor-BmwT4B0c.js";import{t as N,C as I}from"./arcade-BXELiP5l.js";import{a as c,r as f}from"./executionError-DNkSe-Q-.js";import{o as k,y as P,X as O,q as U,i as V,t as T,h as j,g as J,w as M,U as G}from"./deepClone-DD9qKKD3.js";import{l as Q}from"./portalUtils-reOOUf-5.js";import{b,k as L,g as W,E as B}from"./Point-Cz2JYYmX.js";import{k as X,K as Y,O as z}from"./projection-CyCZAIaD.js";import{C as D}from"./Portal-CmmHxpLg.js";import H from"./PortalItem-CTx1kJsR.js";import{m as Z,n as $}from"./project-CvBujuEW.js";import{c as tt,t as rt,p as nt,a as et}from"./Path-Z8ZejDN-.js";import{p as it}from"./GraphQueryStreaming-BUC_KzGu.js";import{i as y,R as _,n as q,Y as ot}from"./opacityUtils-Dim20wpZ.js";import"./ImmutableArray-BPVd6ESQ.js";import"./jsonUtils-CwFG8yN4.js";import"./Extent-g5W9hy0j.js";import"./Polyline-s-JzsQqo.js";import"./writer-DKgfqj4X.js";import"./mathUtils-Cfq9PL9W.js";import"./TimeOnly-CveCl9ie.js";import"./Promise-DfET-uns.js";import"./cast-CsZslgGN.js";import"./JSONSupport-DcrLLGjL.js";import"./featureConversionUtils-CvnFcmH_.js";import"./aaBoundingBox-Dw3yBk2f.js";import"./OptimizedFeature-P2towpqD.js";import"./memoryEstimations-Bcyf-mHz.js";import"./OptimizedGeometry-BJqUA4Pi.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./FieldsIndex-FW1AMU67.js";import"./timeZoneUtils-DxzjpEBb.js";import"./shared-2m9g3-y2.js";import"./Field-BDG0QV_T.js";import"./enumeration-DpvDkLNI.js";import"./fieldType-CBeoJWlv.js";import"./WhereClause-xGR0ztic.js";import"./unitConversion-DvIVg62C.js";import"./number-QOqKffTG.js";import"./hash-CcEbRgUF.js";import"./uuid-Cl5lrJ4c.js";import"./SimpleObservable-CvOkykwM.js";import"./vec3f64-BLpZdpfb.js";import"./projectBuffer-CQnuEMuP.js";import"./geodesicConstants-RQL9oKdk.js";import"./utils-YowqfOgk.js";import"./utils-B-dlKIhi.js";let u=null;async function at(t){const r=K.geometryServiceUrl??"";if(!r){X()||await Y();for(const n of t)n.container[n.indexer]=z(n.container[n.indexer],W.WGS84);return}const e=t.map(n=>n.container[n.indexer]),o=new Z({geometries:e,outSpatialReference:W.WGS84}),p=await $(r,o);for(let n=0;n<p.length;n++){const i=t[n];i.container[i.indexer]=p[n]}}async function C(t,r){const e=new H({portal:t,id:r});return await e.load(),u===null&&(u=await E(()=>import("./knowledgeGraphService-DXS9bis6.js").then(o=>o.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41]),import.meta.url)),await u.fetchKnowledgeGraph(e.url)}function v(t,r,e,o,p){if(t===null)return null;if(y(t)||q(t))return t;if(T(t)||T(t))return t.toJSDate();if(j(t))return t.toStorageFormat();if(J(t))return t.toStorageString();if(M(t)){const n={};for(const i of t.keys())n[i]=v(t.field(i),r,e,o,p),n[i]instanceof b&&p.push({container:n,indexer:i});return n}if(_(t)){const n=t.map(i=>v(i,r,e,o,p));for(let i=0;i<n.length;i++)n[i]instanceof b&&p.push({container:n,indexer:i});return n}return G(t)?t.spatialReference.isWGS84?t:t.spatialReference.isWebMercator&&r?L(t):t:void 0}function pt(t,r){if(!t)return t;if(t.spatialReference.isWGS84&&r.spatialReference.isWebMercator)return B(t);if(t.spatialReference.equals(r.spatialReference))return t;throw new c(r,f.WrongSpatialReference,null)}function R(t,r){if(!t)return null;const e={};for(const o in t)e[o]=g(t[o],r);return e}function g(t,r){return t===null?null:_(t)?t.map(e=>g(e,r)):t instanceof tt?{graphTypeName:t.typeName,id:t.id,graphType:"entity",properties:R(t.properties,r)}:t instanceof rt?{graphType:"object",properties:R(t.properties,r)}:t instanceof nt?{graphTypeName:t.typeName,id:t.id,graphType:"relationship",originId:t.originId??null,destinationId:t.destinationId??null,properties:R(t.properties,r)}:t instanceof et?{graphType:"path",path:t.path?t.path.map(e=>g(e,r)):null}:G(t)?pt(t,r):y(t)||q(t)||ot(t)?t:null}function rr(t){t.mode==="async"&&(t.functions.knowledgegraphbyportalitem=function(r,e){return t.standardFunctionAsync(r,e,(o,p,n)=>{var l,d;if(k(n,2,2,r,e),n[0]===null)throw new c(r,f.PortalRequired,e);if(n[0]instanceof N){const m=P(n[1]);let h;return h=(l=r.services)!=null&&l.portal?r.services.portal:D.getDefault(),C(Q(n[0],h),m)}if(y(n[0])===!1)throw new c(r,f.InvalidParameter,e);const i=P(n[0]);return C(((d=r.services)==null?void 0:d.portal)??D.getDefault(),i)})},t.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),t.functions.querygraph=function(r,e){return t.standardFunctionAsync(r,e,async(o,p,n)=>{var x;k(n,2,4,r,e);const i=n[0];if(!O(i))throw new c(r,f.InvalidParameter,e);const l=n[1];if(!y(l))throw new c(r,f.InvalidParameter,e);u===null&&(u=await E(()=>import("./knowledgeGraphService-DXS9bis6.js").then(a=>a.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41]),import.meta.url));let d=null;const m=U(n[2],null);if(!(m instanceof I||m===null))throw new c(r,f.InvalidParameter,e);if(m){let a=[];d=v(m,!0,!1,r,a),a=a.filter(s=>!s.container[s.indexer].spatialReference.isWGS84),a.length>0&&await at(a)}const h=new it({openCypherQuery:l,bindParameters:d});(((x=i==null?void 0:i.serviceDefinition)==null?void 0:x.currentVersion)??11.3)>11.2&&(h.outputSpatialReference=r.spatialReference);const A=(await u.executeQueryStreaming(i,h)).resultRowsStream.getReader(),S=[];try{for(;;){const{done:a,value:s}=await A.read();if(a)break;if(_(s))for(const w of s)S.push(g(w,r));else{const w=[];for(const F of s)w.push(g(s[F],r));S.push(w)}}}catch(a){throw a}return I.convertJsonToArcade(S,V(r),!1,!0)})},t.signatures.push({name:"querygraph",min:2,max:4}))}export{rr as registerFunctions};
