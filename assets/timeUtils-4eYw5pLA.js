import{c as s}from"./TimeExtent-41gxTbrv.js";import{O as y,n as E,a as b}from"./subclass-BR3PhgZG.js";import{R as h}from"./Accessor-D6mNnsWy.js";import{o as f}from"./timeUtils-DQR2jUPL.js";import{e as S}from"./utils-CXgSw6Sd.js";import{e as F}from"./tagSymbols-BPcGfZon.js";import"./Evented-CXIxDjmW.js";import"./assets-C2mb-ea2.js";import"./index-CeCSsEgo.js";import"./writer-3zufXUNV.js";import"./Promise-CZrWwByK.js";import"./jsonMap-DCC6W5ex.js";function W(e){return e!=null&&typeof e=="object"&&F in e}function v(e){return e.timeInfo!==void 0}async function D(e,i){var t,r;return((r=(t=e.widgets)==null?void 0:t.timeSlider)==null?void 0:r.fullTimeExtent)??I(e.allLayers,i)}function O(e){const i=e.numThumbs??2,t=e.currentTimeExtent;if(t){const{start:r,end:l}=t;return r!=null&&l!=null&&r.getTime()===l.getTime()?"instant":i===2?"time-window":r==null||r.getTime()===0?"cumulative-from-start":"cumulative-from-end"}return i===2?"time-window":"cumulative-from-start"}function U(e){const{numStops:i,stopInterval:t,stops:r}=e;return r?{dates:b(r)}:t?{interval:t.clone()}:{count:i??5}}async function I(e,i){var T;if(e.length===0)return s.allTime;await Promise.all(e.map(n=>n.load({signal:i})));const t=e.filter(v),r=e.filter(n=>!v(n)&&n.visibilityTimeExtent!=null);if(t.length===0&&r.length===0)return s.allTime;const l=[],o=[];for(const n of t)(n==null?void 0:n.type)!=="feature"&&(n==null?void 0:n.type)!=="map-image"||!((T=n.timeInfo)!=null&&T.hasLiveData)?o.push(n):l.push(n);const a=n=>n==null||n.isAllTime,p=[...o.map(n=>{var c;const m=(c=n.timeInfo)==null?void 0:c.fullTimeExtent,{visibilityTimeExtent:u}=n;return(m==null?void 0:m.intersection(u))??u}),...r.map(n=>n.visibilityTimeExtent)];if(p.some(a))return s.allTime;const x=l.map(async n=>{var c,w;const m=((c=await n.fetchRecomputedExtents({signal:i}))==null?void 0:c.timeExtent)??((w=n.timeInfo)==null?void 0:w.fullTimeExtent),{visibilityTimeExtent:u}=n;return(m==null?void 0:m.intersection(u))??u}),d=(await Promise.allSettled(x)).map(n=>n.status==="fulfilled"?n.value:null);if(d.some(a))return s.allTime;const g=[...d,...p].filter(y);return g.length===0?s.allTime:g.reduce((n,m)=>n.union(m))}function L(e,i){const t=e.currentTimeExtent;if(!t)return null;const{start:r,end:l}=t,o=r??l??null;switch(i){case"time-window":return new s({start:r,end:l});case"cumulative-from-start":return new s({start:null,end:o});case"cumulative-from-end":return new s({start:o,end:null});case"instant":return new s({start:o,end:o})}}async function K(e,i){return h(E.getLogger("esri.support.timeUtils.getTimeSliderSettingsFromWebMap"),"`timeUtils.getTimeSliderSettingsFromWebMap` is deprecated in favor of 'timeUtils.getTimeSliderSettingsFromWebDocument'",{replacement:"timeUtils.getTimeSliderSettingsFromWebDocument",version:"4.30",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-support-timeUtils.html#getTimeSliderSettingsFromWebDocument",warnOnce:!0}),e!=null&&S(e)?await z(e,i):null}async function z(e,i){var a;if(!S(e)&&!W(e))return null;await e.load({signal:i});const t=(a=e==null?void 0:e.widgets)==null?void 0:a.timeSlider;if(!t)return null;const r=await D(e,i),l=t.loop,o=O(t);return{fullTimeExtent:r,loop:l,mode:o,playRate:t.stopDelay??2e3,stops:U(t),timeExtent:L(t,o)}}function N(e){if(!e)return e;const{start:i,end:t}=e;return new s({start:i!=null?f(i,-i.getTimezoneOffset(),"minutes"):i,end:t!=null?f(t,-t.getTimezoneOffset(),"minutes"):t})}function Q(e){if(!e)return e;const{start:i,end:t}=e;return new s({start:i!=null?f(i,i.getTimezoneOffset(),"minutes"):i,end:t!=null?f(t,t.getTimezoneOffset(),"minutes"):t})}export{I as getTimeExtentFromLayers,z as getTimeSliderSettingsFromWebDocument,K as getTimeSliderSettingsFromWebMap,Q as toLocalTimeExtent,N as toUTCTimeExtent};
