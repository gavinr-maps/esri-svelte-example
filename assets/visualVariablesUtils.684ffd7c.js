var e=Object.defineProperty,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n,r=(e,r)=>{for(var i in r||(r={}))s.call(r,i)&&o(e,i,r[i]);if(t)for(var i of t(r))n.call(r,i)&&o(e,i,r[i]);return e};import{bJ as i,q as l,M as a}from"./vendor.d0a39f0f.js";import{w as u,A as c}from"./Utils.ea926aef.js";import{c as f}from"./definitions.e5e12ce7.js";import{o as p}from"./visualVariablesUtils.076fa3c6.js";function v(e,t=0,s=!1){const n=e[t+3];return e[t+0]*=n,e[t+1]*=n,e[t+2]*=n,s||(e[t+3]*=255),e}function m(e){if(!e)return 0;const{r:t,g:s,b:n,a:o}=e;return u(t*o,s*o,n*o,255*o)}function y(e){if(!e)return 0;const[t,s,n,o]=e;return u(t*(o/255),s*(o/255),n*(o/255),o)}const d=(e,t)=>e&&((...e)=>t.warn("DEBUG:",...e))||(()=>null),h=!1;function g(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}function z(e){return e.map((e=>function(e){return{value:e.value,size:i(e.size)}}(e)))}function b(e){if("string"==typeof e||"number"==typeof e)return i(e);const t=e;return{type:"size",expression:t.expression,stops:z(t.stops)}}const S=e=>{const t=[],s=[],n=z(e),o=n.length;for(let r=0;r<6;r++){const e=n[Math.min(r,o-1)];t.push(e.value),s.push(null==e.size?f:a(e.size))}return{values:new Float32Array(t),sizes:new Float32Array(s)}};function E(e){const t=e&&e.length>0?{}:null,s=t?{}:null;if(!t)return{vvFields:t,vvRanges:s};for(const n of e)if(n.field&&(t[n.type]=n.field),"size"===n.type){s.size||(s.size={});const e=n;switch(p(e)){case c.SIZE_MINMAX_VALUE:s.size.minMaxValue={minDataValue:e.minDataValue,maxDataValue:e.maxDataValue,minSize:b(e.minSize),maxSize:b(e.maxSize)};break;case c.SIZE_SCALE_STOPS:s.size.scaleStops={stops:z(e.stops)};break;case c.SIZE_FIELD_STOPS:if(e.levels){const t={};for(const s in e.levels)t[s]=S(e.levels[s]);s.size.fieldStops={type:"level-dependent",levels:t}}else s.size.fieldStops=r({type:"static"},S(e.stops));break;case c.SIZE_UNIT_VALUE:s.size.unitValue={unit:e.valueUnit,valueRepresentation:e.valueRepresentation}}}else if("color"===n.type)s.color=j(n);else if("opacity"===n.type)s.opacity=w(n);else if("rotation"===n.type){const e=n;s.rotation={type:e.rotationType}}return{vvFields:t,vvRanges:s}}function w(e){const t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;const s=e.stops;for(let e=0;e<8;++e){const n=s[Math.min(e,s.length-1)];t.values[e]=n.value,t.opacities[e]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const s=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(let e=0;e<8;e++)t.values[e]=1/0,t.opacities[e]=s}}return t}function V(e,t,s){e[4*t+0]=s.r/255,e[4*t+1]=s.g/255,e[4*t+2]=s.b/255,e[4*t+3]=s.a}function j(e){if(l(e))return null;if(e.normalizationField)return null;const t={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;t.field=e.field;const s=e.stops;for(let e=0;e<8;++e){const n=s[Math.min(e,s.length-1)];t.values[e]=n.value,V(t.colors,e,n.color)}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const s=e.stops&&e.stops.length>=0&&e.stops[0].color;for(let e=0;e<8;e++)t.values[e]=1/0,V(t.colors,e,s)}}for(let s=0;s<32;s+=4)v(t.colors,s,!0);return t}export{y as f,m as i,h as l,E as m,d as n,g as r};
