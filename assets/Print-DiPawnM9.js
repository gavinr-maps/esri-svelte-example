const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./FeatureLayer-BCmfw45U.js","./index-CeCSsEgo.js","./index-CjOb8WjV.css","./Evented-CXIxDjmW.js","./Accessor-D6mNnsWy.js","./subclass-BR3PhgZG.js","./PopupTemplate-ByHks6sq.js","./Clonable-cKbRam6-.js","./reactiveUtils-BFQ0BtrB.js","./shared-B3wH2qpO.js","./assets-C2mb-ea2.js","./jsonMap-DCC6W5ex.js","./writer-3zufXUNV.js","./fieldUtils-CNduWQU9.js","./intl-Dpfm8vPB.js","./Promise-CZrWwByK.js","./mathUtils-ClvKsMak.js","./geometry-DpwwkAX1.js","./Extent-DHjqVB-p.js","./Point-DB4Hp4hH.js","./Polyline-D97hl-6E.js","./enumeration--HlxOQ_N.js","./Color-DDUWtbqR.js","./colorUtils-CS9vdHXB.js","./ActionToggle-C0Z1k2jc.js","./Identifiable-BLvpQbOc.js","./ClassBreaksRenderer-DMO3d0Rn.js","./symbols-CsUQ5BxR.js","./TextSymbol-gKE-H_J6.js","./screenUtils-PfxkaaMN.js","./materialUtils-CQ3JLQ1x.js","./opacityUtils-BT7mQkwC.js","./aaBoundingBox-rJEWaOSN.js","./persistableUrlUtils-BcifXQ1Z.js","./collectionUtils-Dm1icNvk.js","./Portal-liet8xHC.js","./UniqueValueRenderer-dci9bLM8.js","./diffUtils--7ofoPN-.js","./colorRamps-CFlTi-ob.js","./SizeVariable-aYYWlweG.js","./ColorStop-CXfPDZon.js","./sizeVariableUtils-Cmcuvw-4.js","./visualVariableUtils-DzaXbn8H.js","./Graphic-Dc7F67nR.js","./jsonUtils-Cma_7A64.js","./compilerUtils-BA04t1lN.js","./lengthUtils-D7_DvYH0.js","./jsonUtils-C6dvhNjw.js","./layerUtils-erzwAANv.js","./defaults-DCm7iNI6.js","./defaultsJSON-GKolV7NZ.js","./styleUtils-DQEZjdpw.js","./jsonUtils-CuoSmH2q.js","./LRUCache-ju6LnIBZ.js","./MemCache-C6WUx-5V.js","./Version-_Vxue7Ui.js","./FieldsIndex-IOXc-mnc.js","./UnknownTimeZone-D0GlcniK.js","./OverrideHelper-C4oumxVn.js","./colorUtils-D5nOabzP.js","./vec42-B1mBkh1w.js","./vec4f64-CBQL1T0x.js","./utils-CO7DMJWl.js","./quantizationUtils-CIQDbQFJ.js","./HeatmapColorStop-CgvKf0-E.js","./heatmapUtils-C-uT6ZIV.js","./SimpleRenderer-DvJZ7cyq.js","./MultiOriginJSONSupport-DjAXzJun.js","./layerContainerType-C5CzMsLd.js","./FeatureLayerBase-CD91dIfN.js","./inputs-CnJRqwLx.js","./Field-C8SaaeoI.js","./fieldType-CIG5ey7e.js","./formUtils-Dni92j4V.js","./HeightModelInfo-CSXZysDz.js","./arcgisLayerUrl-Cgl5IQFD.js","./commonProperties-C-F8Nu9F.js","./ElevationInfo-BxYXLfrw.js","./unitConversionUtils-Dl04YuQU.js","./featureLayerUtils-CeNLEyq1.js","./featureQueryAll-CRo1-WqJ.js","./Query-Cx4awVKu.js","./TimeExtent-41gxTbrv.js","./timeUtils-DQR2jUPL.js","./DataLayerSource-6X35yXpo.js","./FullTextSearch-BNIhEccm.js","./AttachmentQuery-Dn4NbT1Z.js","./RelationshipQuery-kHvI2dm7.js","./LayerFloorInfo-BN2blBAm.js","./Relationship-WMN17mIX.js","./serviceCapabilitiesUtils-GL2GsHu0.js","./Layer-C96_yo4i.js","./workers-8Q6jrI18.js","./Queue-DpHko4Yk.js","./editsZScale-BMHD7K6h.js","./queryZScale-B_YkkRy9.js","./projection-A9yUaaTs.js","./projectBuffer-vsa0P_cF.js","./geodesicConstants-XRAvAZCD.js","./FeatureSet-DyOnd9Rj.js","./APIKeyMixin-DpJrW91V.js","./ArcGISService-Dr1J04Ka.js","./BlendLayer-DmvCcS5c.js","./jsonUtils-C4Wp5KpV.js","./parser-BN6zmHl-.js","./utils-D20M4_S8.js","./mat4f32-DcsiF_Rp.js","./mat4-ybYUU6jq.js","./CustomParametersMixin-BStBpako.js","./EditBusLayer-C6pLlK14.js","./uuid-fwrPAdZb.js","./FeatureEffectLayer-B3ucpbgh.js","./FeatureEffect-BXMKpemG.js","./FeatureFilter-BzdN7b7E.js","./FeatureReductionLayer-7Q3CJbxJ.js","./FeatureReductionSelection-Do1LXJh7.js","./labelingInfo-C8CHVUWS.js","./labelUtils-Cczy0uDR.js","./MD5-C9MwAd2G.js","./OperationalLayer-B61mRSes.js","./OrderedLayer-CfmzojSk.js","./OrderByInfo-Bn0SWspE.js","./PortalLayer-iKUPhGZB.js","./PortalItem-BuTU9OuN.js","./portalItemUtils-DIZSrm3T.js","./RefreshableLayer-B26jSd3d.js","./ScaleRangeLayer-CKYXLXxK.js","./TemporalLayer-D6vkocFU.js","./TimeInterval-CjSB1odC.js","./TimeInfo-Cq5mDY2W.js","./FeatureTemplate-BOr53vUa.js","./FeatureType-ByEWGsln.js","./fieldProperties-DJEV41A1.js","./versionUtils-ByKR3-oH.js","./styleUtils-BATHgMyw.js","./TopFeaturesQuery-BBItvyOE.js","./popupUtils-fsHWupnf.js","./interfaces-CL2NbQte.js","./MapImageLayer-CJz-2McX.js","./loadAll-DDw-urzS.js","./scaleUtils-BciLowpa.js","./SublayersOwner-D_MIJSWc.js","./CollectionFlattener-CkyePFnC.js","./QueryTask-CC5ZOODI.js","./infoFor3D-CxOdoily.js","./utils-D61i9O7E.js","./executeForIds-D-tq3ZnE.js","./query-DbJf0nTj.js","./normalizeUtils-Bi6Jza1f.js","./normalizeUtilsCommon-tgSpcwHH.js","./utils-Dx8bgRIB.js","./pbfQueryUtils-C7MaRxj2.js","./pbf-CmaozfCN.js","./OptimizedGeometry-vU5jWBvU.js","./OptimizedFeature-7juV2tZm.js","./OptimizedFeatureSet-Blu9Ckm7.js","./executeQueryJSON-CmP_8PTA.js","./executeQueryPBF-SPg7y6Hr.js","./featureConversionUtils-DdoZh_25.js","./sublayerUtils-_xnIyjYh.js","./ExportImageParameters-B0jA3gLt.js","./floorFilterUtils-DZ5C6FQv.js","./imageBitmapUtils-6_PpAuCS.js","./calcite-action-DqS7UojZ.js","./action-DJPgY7YC.js","./jsxFactory-CbAu6VfF.js","./dom-Cv0oa6So.js","./interactive-Dtpmn6Ls.js","./loadable-CTFTnu2T.js","./locale-BUTTOPma.js","./key-D5DPfjW0.js","./observers-EizV_Lvc.js","./component-ByvC-PUv.js","./t9n-DfK3dFGw.js","./icon-DIKjN-ev.js","./loader-wfvKSvDR.js","./calcite-block-MHbn6ZJN.js","./conditionalSlot-MT4PnZbw.js","./Heading-Dn_ijr3J.js","./openCloseComponent-v_dlVp47.js","./action-menu-CBohuqGX.js","./array-DofFqflK.js","./popover-Cj0_nbSv.js","./floating-ui-BiOoil4s.js","./debounce-C5YDvsuO.js","./focusTrapComponent-C9GPb5g8.js","./FloatingArrow-HmzV7w9c.js","./handle-C2OyFwdr.js","./scrim-tJUFlVOZ.js","./calcite-button-D_QRw8fR.js","./button-CT5wDIjk.js","./form-DcBTx4ZC.js","./label-rdYpV4K5.js","./calcite-checkbox-y1r16Xxb.js","./calcite-combobox-B2IVQtjl.js","./combobox-Bv_ShTsg.js","./core-2D-WamSI.js","./filter-BHzLPuAd.js","./Validation-BBJwLSGg.js","./utils2-Dc8c3XNK.js","./chip-Bl8qrqgL.js","./combobox-item-CmQXBy7I.js","./input-message-CKyGNFPw.js","./calcite-combobox-item-rCxbU9jk.js","./calcite-flow-CrhM5qTo.js","./calcite-flow-item-M0Vz-xgS.js","./panel-B3delCVt.js","./calcite-icon-CocWVhPd.js","./calcite-input-EEDQOvVg.js","./input2-ChLBQj0V.js","./input-Dt5r39B0.js","./progress-B-8bmD6j.js","./calcite-label-CI84R5fD.js","./calcite-list-C9DJsIWv.js","./resources4-CT6dxwoZ.js","./utils3-Dl40LrI3.js","./calcite-list-item-D17u9P-_.js","./calcite-loader-DxqUpD6Z.js","./calcite-switch-BZCweZXi.js","./switch-DnlX0u9j.js","./calcite-chip-DEpR5R9e.js"])))=>i.map(i=>d[i]);
import{_ as A}from"./index-CeCSsEgo.js";import{e as s}from"./Evented-CXIxDjmW.js";import{l as ot}from"./intl-Dpfm8vPB.js";import{d as ee,P as ft,V as bt}from"./reactiveUtils-BFQ0BtrB.js";import{n as Q,i as Ht}from"./jsonMap-DCC6W5ex.js";import{y as u,b as V,R as Bt,a as xe,c as K,O as lt}from"./subclass-BR3PhgZG.js";import{b as zt}from"./unitFormatUtils-DYi2eq8E.js";import{f as Y,U as Z,t as ne,K as fe,o as Wt,a6 as gt,j as qt,F as Kt}from"./assets-C2mb-ea2.js";import{s as Zt,f as oe,i as Qt,u as Oe}from"./utils-D61i9O7E.js";import{n as d,e as De,B as Yt,r as Xt,o as ei,k as ti}from"./jsxFactory-CbAu6VfF.js";import{S as pe,m as ii,g as rt,b as ai}from"./Accessor-D6mNnsWy.js";import"./geometry-DpwwkAX1.js";import{C as vt,m as oi,c as nt}from"./Portal-liet8xHC.js";import{s as li}from"./ReactiveMap-Dl_3-Rm5.js";import{c as wt,u as ve,e as st}from"./screenUtils-PfxkaaMN.js";import{f as Ae,d as pt,j as ut,W as ri,o as ni}from"./Point-DB4Hp4hH.js";import{j as si,E as pi,p as ui}from"./Promise-CZrWwByK.js";import{w as Je}from"./Extent-DHjqVB-p.js";import{R as ci}from"./normalizeUtils-Bi6Jza1f.js";import{y as di}from"./Field-C8SaaeoI.js";import{o as Ee}from"./enumeration--HlxOQ_N.js";import{t as mi,s as hi}from"./networkEnums-CvjEi2yz.js";import{d as Ne}from"./FeatureSet-DyOnd9Rj.js";import{a as _t}from"./GPMessage-ftD0PfvQ.js";import{j as yi}from"./Polyline-D97hl-6E.js";import{J as fi}from"./fieldUtils-CNduWQU9.js";import{o as bi}from"./floorFilterUtils-DZ5C6FQv.js";import{getSizeRangeAtScale as gi}from"./visualVariableUtils-DzaXbn8H.js";import{u as vi}from"./Color-DDUWtbqR.js";import{y as wi,d as ct,S as _i}from"./TextSymbol-gKE-H_J6.js";import{c as Ti}from"./layerViewUtils-D2JqIDZ8.js";import Se from"./PortalItem-BuTU9OuN.js";import{_ as Ii}from"./viewpointUtils-BDYPvBda.js";import{_ as dt}from"./InputManager-C4xu1R9l.js";import{e as ue}from"./globalCss-CZa70j6i.js";import{e as xi}from"./Heading-ynVMbJ8d.js";import{i as Oi}from"./legacyIcon-CtsJ0OTG.js";import"./shared-B3wH2qpO.js";import"./ByteSizeUnit-BsxeN7wM.js";import"./Cyclical-BY_I03kj.js";import"./mathUtils-ClvKsMak.js";import"./quantityUtils-d_-fFwhF.js";import"./uuid-fwrPAdZb.js";import"./writer-3zufXUNV.js";import"./normalizeUtilsCommon-tgSpcwHH.js";import"./jsonUtils-Cma_7A64.js";import"./utils-Dx8bgRIB.js";import"./fieldType-CIG5ey7e.js";import"./Graphic-Dc7F67nR.js";import"./PopupTemplate-ByHks6sq.js";import"./Clonable-cKbRam6-.js";import"./ActionToggle-C0Z1k2jc.js";import"./Identifiable-BLvpQbOc.js";import"./symbols-CsUQ5BxR.js";import"./materialUtils-CQ3JLQ1x.js";import"./opacityUtils-BT7mQkwC.js";import"./aaBoundingBox-rJEWaOSN.js";import"./persistableUrlUtils-BcifXQ1Z.js";import"./collectionUtils-Dm1icNvk.js";import"./compilerUtils-BA04t1lN.js";import"./lengthUtils-D7_DvYH0.js";import"./sizeVariableUtils-Cmcuvw-4.js";import"./colorUtils-CS9vdHXB.js";import"./Viewpoint-B260yGoV.js";import"./mat2d-DPkeMmgR.js";import"./mat2df64-CBKYtunK.js";import"./vec2-B_ymkwGp.js";import"./vec2f64-Diu2Kaa8.js";import"./projection-A9yUaaTs.js";import"./projectBuffer-vsa0P_cF.js";import"./geodesicConstants-XRAvAZCD.js";import"./Queue-DpHko4Yk.js";import"./signal-DzOfzcfh.js";const $e=new Q({PDF:"pdf",PNG32:"png32",PNG8:"png8",JPG:"jpg",GIF:"gif",EPS:"eps",SVG:"svg",SVGZ:"svgz"}),we=$e.fromJSON.bind($e),Tt=$e.toJSON.bind($e);let j=class extends pe{constructor(t){super(t),this.state="pending",this.url=""}initialize(){this.addHandles(ee(()=>[this.extension,this.name],()=>this._setFormattedFileName(),ft))}_setFormattedFileName(){this.name&&this.extension&&(this.formattedName=this.count?`${this.name}(${this.count})${this.extension}`:`${this.name}.${this.extension}`)}};s([u()],j.prototype,"count",void 0),s([u()],j.prototype,"error",void 0),s([u()],j.prototype,"extension",void 0),s([u()],j.prototype,"formattedName",void 0),s([u()],j.prototype,"name",void 0),s([u()],j.prototype,"state",void 0),s([u()],j.prototype,"url",void 0),j=s([V("esri.widgets.Print.FileLink")],j);const It=j;var Ve;let J=Ve=class extends pe{constructor(e){super(e),this.outSpatialReference=null,this.processExtent=null,this.processSpatialReference=null,this.returnColumnName=!1,this.returnFeatureCollection=!1,this.returnM=!1,this.returnZ=!1}static from(e){return Bt(Ve,e)}};s([u({type:Ae})],J.prototype,"outSpatialReference",void 0),s([u({type:Je})],J.prototype,"processExtent",void 0),s([u({type:Ae})],J.prototype,"processSpatialReference",void 0),s([u({nonNullable:!0})],J.prototype,"returnColumnName",void 0),s([u({nonNullable:!0})],J.prototype,"returnFeatureCollection",void 0),s([u({nonNullable:!0})],J.prototype,"returnM",void 0),s([u({nonNullable:!0})],J.prototype,"returnZ",void 0),J=Ve=s([V("esri.rest.geoprocessor.GPOptions")],J);const Ge=J;let U=class extends Y{constructor(){super(...arguments),this.extent=null,this.height=null,this.href=null,this.opacity=1,this.rotation=0,this.scale=null,this.visible=!0,this.width=null}};s([u({type:Je})],U.prototype,"extent",void 0),s([u()],U.prototype,"height",void 0),s([u()],U.prototype,"href",void 0),s([u()],U.prototype,"opacity",void 0),s([u()],U.prototype,"rotation",void 0),s([u()],U.prototype,"scale",void 0),s([u()],U.prototype,"visible",void 0),s([u()],U.prototype,"width",void 0),U=s([V("esri.layers.support.MapImage")],U);const Si=U;let ce=class extends Y{constructor(t){super(t),this.area=0,this.units=null}};s([u({json:{write:!0}})],ce.prototype,"area",void 0),s([Ee(mi)],ce.prototype,"units",void 0),ce=s([V("esri.rest.support.ArealUnit")],ce);const $i=ce;let de=class extends Y{constructor(t){super(t),this.itemId=null,this.url=null}};s([u({type:String,json:{read:{source:"itemID"},write:{target:"itemID"}}})],de.prototype,"itemId",void 0),s([u({type:String,json:{write:!0}})],de.prototype,"url",void 0),de=s([V("esri.rest.support.DataFile")],de);const Me=de;let me=class extends Y{constructor(t){super(t),this.distance=0,this.units=null}};s([u({json:{write:!0}})],me.prototype,"distance",void 0),s([Ee(hi)],me.prototype,"units",void 0),me=s([V("esri.rest.support.LinearUnit")],me);const Li=me,N="multi-value-",He=new Q({GPArealUnit:"areal-unit",GPBoolean:"boolean",GPComposite:"composite",GPDataFile:"data-file",GPDate:"date",GPDouble:"double",GPFeatureRecordSetLayer:"feature-record-set-layer",Field:"field",GPLinearUnit:"linear-unit",GPLong:"long",GPRasterData:"raster-data",GPRasterDataLayer:"raster-data-layer",GPRecordSet:"record-set",GPString:"string",GPValueTable:"value-table","GPMultiValue:GPArealUnit":`${N}areal-unit`,"GPMultiValue:GPBoolean":`${N}boolean`,"GPMultiValue:GPComposite":`${N}composite`,"GPMultiValue:GPDataFile":`${N}data-file`,"GPMultiValue:GPDate":`${N}date`,"GPMultiValue:GPDouble":`${N}double`,"GPMultiValue:GPFeatureRecordSetLayer":`${N}feature-record-set-layer`,"GPMultiValue:Field":`${N}field`,"GPMultiValue:GPLinearUnit":`${N}linear-unit`,"GPMultiValue:GPLong":`${N}long`,"GPMultiValue:GPRasterData":`${N}raster-data`,"GPMultiValue:GPRasterDataLayer":`${N}raster-data-layer`,"GPMultiValue:GPRecordSet":`${N}record-set`,"GPMultiValue:GPString":`${N}string`});let le=class extends Y{constructor(t){super(t),this.dataType=null,this.paramName=null,this.value=null}};s([Ee(He,{ignoreUnknown:!1})],le.prototype,"dataType",void 0),s([u()],le.prototype,"paramName",void 0),s([u()],le.prototype,"value",void 0),le=s([V("esri.rest.support.ParameterValue")],le);const Pi=le;let re=class extends Y{constructor(t){super(t),this.format=null,this.itemId=null,this.url=null}};s([u()],re.prototype,"format",void 0),s([u({json:{read:{source:"itemID"},write:{target:"itemID"}}})],re.prototype,"itemId",void 0),s([u()],re.prototype,"url",void 0),re=s([V("esri.rest.support.RasterData")],re);const Ci=re;async function xt(e,t,a,i,o){const l={},n={},c=[];return ki(i,c,l),ci(c).then(p=>{const{outSpatialReference:r,processExtent:m,processSpatialReference:h,returnColumnName:w,returnFeatureCollection:O,returnM:b,returnZ:y}=a,{path:f}=oe(e);for(const T in l){const[$,F]=l[T];n[T]=p.slice($,F)}const g=r?r.wkid||r:null,I=h?h.wkid||h:null,S=t==="execute"?{returnColumnName:w||void 0,returnFeatureCollection:O||void 0,returnM:b||void 0,returnZ:y||void 0}:null,P=Le({...m?{context:{extent:m,outSR:g,processSR:I}}:{"env:outSR":g,"env:processSR":I},...i,...S,f:"json"},null,n),L={...o,query:P};return Z(`${f}/${t}`,L)})}function ki(e,t,a){for(const i in e){const o=e[i];if(o&&typeof o=="object"&&o instanceof Ne){const{features:l}=o;a[i]=[t.length,t.length+l.length],l.forEach(n=>{t.push(n.geometry)})}}}async function Re(e,t){switch(e){case"areal-unit":return $i.fromJSON(t);case"boolean":case"double":case"long":case"string":case"value-table":return t;case"date":return new Date(t);case"data-file":return Me.fromJSON(t);case"linear-unit":return Li.fromJSON(t);case"feature-record-set-layer":if("url"in t)return Me.fromJSON(t);if("layerDefinition"in t){const a=new(await A(async()=>{const{default:l}=await import("./FeatureLayer-BCmfw45U.js");return{default:l}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137]),import.meta.url)).default,{layerDefinition:i,featureSet:o}=t;return a.read({layerDefinition:i,featureSet:o},{origin:"portal-item"}),a.spatialReference=Ae.fromJSON(o.spatialReference??i.spatialReference??i.extent.spatialReference),a}return Ne.fromJSON(t);case"record-set":return"url"in t?Me.fromJSON(t):Ne.fromJSON(t);case"raster-data":case"raster-data-layer":return"mapImage"in t?Si.fromJSON(t.mapImage):Ci.fromJSON(t);case"field":return di.fromJSON(t)}}function Ei(e){return e.startsWith(N)}function Di(e){return e.replace(N,"")}async function Mi(e,t){const a=Di(e),i=a==="composite"?t.map(o=>Re(He.fromJSON(o.dataType),o.value)):t.map(o=>Re(a,o));return Promise.all(i)}async function Ue(e){const t=He.fromJSON(e.dataType),{paramName:a}=e,i=Ei(t)?await Mi(t,e.value):await Re(t,e.value);return new Pi({dataType:t,paramName:a,value:i})}function Le(e,t,a){for(const i in e){const o=e[i];Array.isArray(o)?e[i]=JSON.stringify(o.map(l=>Le({item:l},!0).item)):o instanceof Date&&(e[i]=o.getTime())}return Zt(e,t,a)}async function Ot(e,t,a,i){return a=Ge.from(a||{}),xt(e,"execute",a,t??{},i).then(async({data:o})=>{var l,n;return{results:await Promise.all(((l=o.results)==null?void 0:l.map(Ue))??[]),messages:((n=o.messages)==null?void 0:n.map(c=>_t.fromJSON(c)))??[]}})}var _e;const Fi=Ht()({esriJobCancelled:"job-cancelled",esriJobCancelling:"job-cancelling",esriJobDeleted:"job-deleted",esriJobDeleting:"job-deleting",esriJobTimedOut:"job-timed-out",esriJobExecuting:"job-executing",esriJobFailed:"job-failed",esriJobNew:"job-new",esriJobSubmitted:"job-submitted",esriJobSucceeded:"job-succeeded",esriJobWaiting:"job-waiting"},{ignoreUnknown:!1});let W=_e=class extends Y{constructor(e){super(e),this.jobId=null,this.jobStatus=null,this.messages=null,this.progress=null,this.requestOptions=null,this.sourceUrl=null,this._timer=void 0}async cancelJob(e){const{jobId:t,sourceUrl:a}=this,{path:i}=oe(a),o={...this.requestOptions,...e,query:{f:"json"}};this._clearTimer();const l=`${i}/jobs/${t}/cancel`,{data:n}=await Z(l,o),{messages:c,jobStatus:p,progress:r}=_e.fromJSON(n);return this.set({messages:c,jobStatus:p,progress:r}),this}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const{path:t}=oe(this.sourceUrl),a={...this.requestOptions,...e,query:{f:"json"}},i=`${t}/jobs/${this.jobId}`,{data:o}=await Z(i,a),{messages:l,jobStatus:n,progress:c}=_e.fromJSON(o);return this.set({messages:l,jobStatus:n,progress:c}),this}async fetchResultData(e,t,a){t=Ge.from(t||{});const{returnColumnName:i,returnFeatureCollection:o,returnM:l,returnZ:n,outSpatialReference:c}=t,{path:p}=oe(this.sourceUrl),r=Le({returnColumnName:i||null,returnFeatureCollection:o||null,returnM:l||null,returnZ:n||null,outSR:c,returnType:"data",f:"json"},null),m={...this.requestOptions,...a,query:r},h=`${p}/jobs/${this.jobId}/results/${e}`,{data:w}=await Z(h,m);return Ue(w)}async fetchResultImage(e,t,a){const{path:i}=oe(this.sourceUrl),o={...t.toJSON(),f:"json"},l=Le(o),n={...this.requestOptions,...a,query:l},c=`${i}/jobs/${this.jobId}/results/${e}`,{data:p}=await Z(c,n);return Ue(p)}async fetchResultMapImageLayer(){const{path:e}=oe(this.sourceUrl),t=e.indexOf("/GPServer/"),a=`${e.substring(0,t)}/MapServer/jobs/${this.jobId}`;return new(await A(async()=>{const{default:i}=await import("./MapImageLayer-CJz-2McX.js");return{default:i}},__vite__mapDeps([138,3,4,5,10,1,2,82,83,15,11,12,139,8,9,35,18,19,67,140,16,91,17,20,25,100,141,55,75,33,76,68,77,13,14,78,46,31,124,96,97,98,142,6,7,21,22,23,24,26,27,28,29,30,32,34,36,37,38,39,40,41,42,43,44,45,47,48,49,50,51,52,53,54,56,57,58,59,60,61,62,63,64,65,66,143,144,84,71,72,145,146,147,148,149,150,151,152,153,154,155,95,81,85,156,99,157,158,79,80,86,87,131,130,116,117,88,89,90,136,159,101,102,103,104,105,106,107,108,119,122,123,125,126,127,128,129,160,161,162,133]),import.meta.url)).default({url:a})}async waitForJobCompletion(e={}){const{interval:t=1e3,signal:a,statusCallback:i}=e;return new Promise((o,l)=>{ii(a,()=>{this._clearTimer(),l(rt())}),this._clearTimer();const n=setInterval(()=>{this._timer||l(rt()),this.checkJobStatus(this.requestOptions).then(c=>{const{jobStatus:p}=c;switch(this.jobStatus=p,p){case"job-succeeded":this._clearTimer(),o(this);break;case"job-submitted":case"job-executing":case"job-waiting":case"job-new":i&&i(this);break;case"job-cancelled":case"job-cancelling":case"job-deleted":case"job-deleting":case"job-timed-out":case"job-failed":this._clearTimer(),l(this)}})},t);this._timer=n})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};s([u()],W.prototype,"jobId",void 0),s([Ee(Fi,{ignoreUnknown:!1})],W.prototype,"jobStatus",void 0),s([u({type:[_t]})],W.prototype,"messages",void 0),s([u()],W.prototype,"progress",void 0),s([u()],W.prototype,"requestOptions",void 0),s([u({json:{write:!0}})],W.prototype,"sourceUrl",void 0),W=_e=s([V("esri.rest.support.JobInfo")],W);const Ai=W;async function St(e,t,a,i){return a=Ge.from(a||{}),xt(e,"submitJob",a,t??{},i).then(({data:o})=>{const l=Ai.fromJSON(o);return l.sourceUrl=e,l})}const Pe=new Q({MAP_ONLY:"map-only","A3 Landscape":"a3-landscape","A3 Portrait":"a3-portrait","A4 Landscape":"a4-landscape","A4 Portrait":"a4-portrait","Letter ANSI A Landscape":"letter-ansi-a-landscape","Letter ANSI A Portrait":"letter-ansi-a-portrait","Tabloid ANSI B Landscape":"tabloid-ansi-b-landscape","Tabloid ANSI B Portrait":"tabloid-ansi-b-portrait"}),he=Pe.fromJSON.bind(Pe),Ni=Pe.toJSON.bind(Pe);function Vi(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}}function Ri(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}}function mt(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}}function Ui(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}}function ji(e,t=15){const a=e.canvas.width,i=e.canvas.height,o=e.getImageData(0,0,a,i).data;let l,n,c,p,r,m;e:for(n=i;n--;)for(l=a;l--;)if(o[4*(a*n+l)+3]>t){m=n;break e}if(!m)return null;e:for(l=a;l--;)for(n=m+1;n--;)if(o[4*(a*n+l)+3]>t){r=l;break e}e:for(l=0;l<=r;++l)for(n=m+1;n--;)if(o[4*(a*n+l)+3]>t){c=l;break e}e:for(n=0;n<=m;++n)for(l=c;l<=r;++l)if(o[4*(a*n+l)+3]>t){p=n;break e}return{x:c,y:p,width:r-c,height:m-p}}function Ji(e,t){var o,l;const a=((o=t.color)==null?void 0:o.clone())??new vi([0,255,255]),i=((l=t.haloColor)==null?void 0:l.clone())??a.clone();switch(e){case"envelope":case"polygon":return a.a*=t.fillOpacity??.25,new _i({color:a,outline:new ct({color:i}),style:"solid"});case"polyline":return new ct({color:i});default:return i.a=1,new wi({color:i,outline:null})}}function Gi(e,t){const a=e.allLayerViews.items;if(t===e.scale)return a.filter(o=>!o.suspended);const i=new Array;for(const o of a){const l=o.parent;l&&l!==o.view&&(zi(l)||Wi(l))&&!i.includes(l)||o.visible&&o.visibleAtCurrentTimeExtent&&Ti(o.layer.effectiveScaleRange,t)&&i.push(o)}return i}function Hi(e){return(e==null?void 0:e.type)==="bing-maps"}function $t(e){return e&&"blendMode"in e&&"effect"in e}function Bi(e){return(e==null?void 0:e.type)==="csv"}function zi(e){return e.layer.type==="catalog"}function Wi(e){return e.layer.type==="group"}function qi(e){const t=e.layer;if($t(t)){const a=t.blendMode;if((!a||a==="normal")&&(t.effect||"featureEffect"in e&&e.featureEffect))return!0}return!1}let M=class extends pe{constructor(t){super(t),this.attributionVisible=!0,this.exportOptions={width:800,height:1100,dpi:96},this.forceFeatureAttributes=!1,this.format="png32",this.includeCharts=!1,this.includeTables=!1,this.label=null,this.layout="map-only",this.layoutItem=null,this.layoutOptions=null,this.outScale=0,this.report=null,this.reportItem=null,this.reportOptions=null,this.scalePreserved=!0,this.showLabels=!0}};s([u()],M.prototype,"attributionVisible",void 0),s([u()],M.prototype,"exportOptions",void 0),s([u()],M.prototype,"forceFeatureAttributes",void 0),s([u()],M.prototype,"format",void 0),s([u()],M.prototype,"includeCharts",void 0),s([u()],M.prototype,"includeTables",void 0),s([u()],M.prototype,"label",void 0),s([u()],M.prototype,"layout",void 0),s([u({type:Se})],M.prototype,"layoutItem",void 0),s([u()],M.prototype,"layoutOptions",void 0),s([u()],M.prototype,"outScale",void 0),s([u()],M.prototype,"report",void 0),s([u({type:Se})],M.prototype,"reportItem",void 0),s([u()],M.prototype,"reportOptions",void 0),s([u()],M.prototype,"scalePreserved",void 0),s([u()],M.prototype,"showLabels",void 0),M=s([V("esri.rest.support.PrintTemplate")],M);const Lt=M,Ce=new Q({"Attribute List Letter ANSI A Landscape":"attribute-list-letter-ansi-a-landscape","Attribute List Letter ANSI A Portrait":"attribute-list-letter-ansi-a-portrait","Attribute List With Group Letter ANSI A Landscape":"attribute-list-with-group-letter-ansi-a-landscape","Attribute List With Group Letter ANSI A Portrait":"attribute-list-with-group-letter-ansi-a-portrait","Page per Feature Letter ANSI A Landscape":"page-per-feature-letter-ansi-a-landscape","Page per Feature Letter ANSI A Portrait":"page-per-feature-letter-ansi-a-portrait"});Ce.fromJSON.bind(Ce);const Ki=Ce.toJSON.bind(Ce),ht={Feet:"ft",Kilometers:"km",Meters:"m",Miles:"mi"},yt=new Q({esriFeet:"Feet",esriKilometers:"Kilometers",esriMeters:"Meters",esriMiles:"Miles"}),Zi=new Q({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"}),je=new Map;async function Qi(e,t,a){var c;const i=await Be(e,a),o=await Xi(t,i);if(await Pt(e,a)==="sync"){const{results:p}=await Ot(e,o,void 0,a);return(c=p==null?void 0:p[0])==null?void 0:c.value}const l=await St(e,o,void 0,a);await l.waitForJobCompletion({interval:t.updateDelay});const{value:n}=await l.fetchResultData("Output_File",null,a);return n}async function Be(e,t){const a=ta(e),i=je.get(a)??{gpServerUrl:a,legendLayerNameMap:{},legendLayers:[]};return i.gpMetadata??(i.gpMetadata=(await Z(a,Qt({f:"json"},t))).data),i.cimVersion=i.gpMetadata.cimVersion,je.set(a,i),i}async function Pt(e,t){return Ta(await Be(e,t))}async function Yi(e,t){return(await Be(e,t)).gpMetadata.tasks}async function Xi(e,t){var h,w,O,b,y;t=t||{is11xService:!1,legendLayerNameMap:{},legendLayers:[]};const a=e.template||new Lt;a.showLabels==null&&(a.showLabels=!0);const i=a.exportOptions;let o;const l=Ni(a.layout);if(i&&(o={dpi:i.dpi},l.toLowerCase()==="map_only"||l==="")){const f=i.width,g=i.height;o.outputSize=f!=null&&g!=null?[f,g]:void 0}const n=a.layoutOptions;let c;if(n){let f,g;n.scalebarUnit==="Miles"||n.scalebarUnit==="Kilometers"?(f="Kilometers",g="Miles"):n.scalebarUnit!=="Meters"&&n.scalebarUnit!=="Feet"||(f="Meters",g="Feet"),c={titleText:n.titleText,authorText:n.authorText,copyrightText:n.copyrightText,customTextElements:n.customTextElements,elementOverrides:n.elementOverrides,scaleBarOptions:{metricUnit:yt.toJSON(f),metricLabel:f?ht[f]:void 0,nonMetricUnit:yt.toJSON(g),nonMetricLabel:g?ht[g]:void 0}}}let p=null;n!=null&&n.legendLayers&&(p=n.legendLayers.map(f=>{const g=f.layerId;t.legendLayerNameMap[g]=f.title;const I={id:g};return f.subLayerIds&&(I.subLayerIds=f.subLayerIds),I}));const r=await ea(e,a,t);if(r.operationalLayers){const f=new RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),g=/[\u0600-\u06FF]/,I=S=>{var $;const P=S.text,L=S.font,T=($=L==null?void 0:L.family)==null?void 0:$.toLowerCase();P&&L&&(T==="arial"||T==="arial unicode ms")&&(L.family=f.test(P)?"Arial Unicode MS":"Arial",L.style!=="normal"&&g.test(P)&&(L.family="Arial Unicode MS"))};for(const S of r.operationalLayers)if((h=S.featureCollection)!=null&&h.layers)for(const P of S.featureCollection.layers){if((b=(O=(w=P.layerDefinition)==null?void 0:w.drawingInfo)==null?void 0:O.renderer)!=null&&b.symbol){const L=P.layerDefinition.drawingInfo.renderer;L.symbol.type==="esriTS"&&I(L.symbol)}if((y=P.featureSet)!=null&&y.features)for(const L of P.featureSet.features)L.symbol&&L.symbol.type==="esriTS"&&I(L.symbol)}}e.outSpatialReference&&(r.mapOptions.spatialReference=e.outSpatialReference.toJSON()),Object.assign(r,{exportOptions:o,layoutOptions:c||{}}),Object.assign(r.layoutOptions,{legendOptions:{operationalLayers:p??t.legendLayers.slice()}}),t.legendLayers.length=0,je.set(t.gpServerUrl,t);const m={Web_Map_as_JSON:JSON.stringify(r),Format:Tt(a.format),Layout_Template:l,Layout_Item_ID:void 0,Report_Template:Ki(a.report),Report_Item_ID:void 0};if(a.layoutItem){delete m.Layout_Template;const f=a.layoutItem;await f.load(),f.access!=="public"&&ne&&await ne.getCredential(t.gpServerUrl),m.Layout_Item_ID=JSON.stringify({id:f.id})}if(a.reportItem){delete m.Report_Template;const f=a.reportItem;await f.load(),f.access!=="public"&&ne&&await ne.getCredential(t.gpServerUrl),m.Report_Item_ID=JSON.stringify({id:f.id})}return e.extraParameters&&Object.assign(m,e.extraParameters),m}async function ea(e,t,a){const i=e.view;let o=i.spatialReference;const l={operationalLayers:await ia(i,t,a)};t.includeTables&&(l.tables=await fa(i));let n=e.extent||a.ssExtent||i.extent;if(o!=null&&o.isWrappable&&(n=n.clone()._normalize(!0),o=n.spatialReference),l.mapOptions={extent:n&&n.toJSON(),spatialReference:o&&o.toJSON(),showAttribution:t.attributionVisible},a.ssExtent=null,i.background&&(l.background=i.background.toJSON()),i.rotation&&(l.mapOptions.rotation=-i.rotation),t.scalePreserved&&(l.mapOptions.scale=t.outScale||i.scale),i.timeExtent!=null){const c=i.timeExtent.start!=null?i.timeExtent.start.getTime():null,p=i.timeExtent.end!=null?i.timeExtent.end.getTime():null;l.mapOptions.time=[c,p]}return t.reportOptions&&(l.reportOptions=t.reportOptions),l}function ta(e){let t=e;const a=t.lastIndexOf("/GPServer/");return a>0&&(t=t.slice(0,a+9)),t}async function ia(e,t,a){var c;const i=[],o={layerView:null,printTemplate:t,view:e};let l=0;t.scalePreserved&&(l=t.outScale||e.scale);const n=Gi(e,l);for(const p of n){const r=p.layer;if(!r.loaded||"layers"in r)continue;let m;o.layerView=p,m=qi(p)?await se(r,o,a):Hi(r)?aa(r):Bi(r)?await la(r,o,a):(r==null?void 0:r.type)==="catalog-footprint"?await oa(r,o,a):(r==null?void 0:r.type)==="feature"?await ra(r,o,a):(r==null?void 0:r.type)==="geojson"?await na(r,o,a):(r==null?void 0:r.type)==="graphics"?await sa(r,o,a):(r==null?void 0:r.type)==="imagery"?pa(r,a):(r==null?void 0:r.type)==="imagery-tile"?await ua(r,o,a):(r==null?void 0:r.type)==="kml"?await ca(r,o,a):(r==null?void 0:r.type)==="map-image"?da(r,o,a):(r==null?void 0:r.type)==="map-notes"?await ma(o,a):(r==null?void 0:r.type)==="open-street-map"?ha():(r==null?void 0:r.type)==="stream"?await ya(r,o,a):(r==null?void 0:r.type)==="tile"?ba(r,a):(r==null?void 0:r.type)==="vector-tile"?await ga(r,o,a):(r==null?void 0:r.type)==="web-tile"?va(r):(r==null?void 0:r.type)==="wms"?wa(r,a):(r==null?void 0:r.type)==="wmts"?_a(r):await se(r,o,a),m&&(Array.isArray(m)?i.push(...m):(m.id=r.id,m.title=a.legendLayerNameMap[r.id]||r.title,m.opacity=p.fullOpacity,m.minScale=r.minScale||0,m.maxScale=r.maxScale||0,$t(r)&&r.blendMode&&r.blendMode!=="normal"&&(m.blendMode=r.blendMode),i.push(m)))}if(l)for(const p of i)p.minScale=0,p.maxScale=0;if((c=e.graphics)!=null&&c.length){const p=await H(null,e.graphics,t,a);p&&i.push(p)}return i}function aa(e){return{culture:e.culture,key:e.key,type:"BingMaps"+(e.style==="aerial"?"Aerial":e.style==="hybrid"?"Hybrid":"Road")}}async function oa(e,{layerView:t,printTemplate:a},i){if(parseFloat(i.cimVersion)<3.1)return H(e,await be(t),a,i);const o=e.parent,l={id:(n=B(o,"web-map")).id,url:n.url,layerType:n.layerType,customParameters:n.customParameters,dynamicGroupLayer:{visibility:!1},footprintLayer:n.footprintLayer,layerDefinition:n.layerDefinition};var n;return te(l,o),l}async function la(e,t,a){e.legendEnabled&&a.legendLayers.push({id:e.id});const i=t.layerView,o=t.printTemplate;if(!(i.filter||e.portalItem&&e.portalItem.access!=="public")){const l=B(e,"web-map");return l.type="CSV",delete l.popupInfo,delete l.layerType,l.showLabels=o.showLabels&&e.labelsVisible,l}return H(e,await be(i),o,a)}async function H(e,t,a,i){var f,g,I,S,P,L;let o;const l=Ri(),n=Ui(),c=mt(),p=Vi(),r=mt();if(r.layerDefinition.name="textLayer",delete r.layerDefinition.drawingInfo,e){if(e.declaredClass==="esri.layers.FeatureLayer"||e.declaredClass==="esri.layers.StreamLayer"?l.layerDefinition.name=n.layerDefinition.name=c.layerDefinition.name=p.layerDefinition.name=i.legendLayerNameMap[e.id]||e.get("arcgisProps.title")||e.title:e.declaredClass==="esri.layers.GraphicsLayer"&&(t=e.graphics.items),e.renderer){const T=e.renderer.toJSON(),$=l.layerDefinition.drawingInfo;$&&($.renderer=T);const F=n.layerDefinition.drawingInfo;F&&(F.renderer=T);const R=c.layerDefinition.drawingInfo;R&&(R.renderer=T);const X=p.layerDefinition.drawingInfo;X&&(X.renderer=T)}if(a.showLabels&&e.labelsVisible&&typeof e.write=="function"){const T=B(e,"web-map"),$=(g=(f=T.layerDefinition)==null?void 0:f.drawingInfo)==null?void 0:g.labelingInfo;if($){o=!0;const F=l.layerDefinition.drawingInfo;F&&(F.labelingInfo=$);const R=n.layerDefinition.drawingInfo;R&&(R.labelingInfo=$);const X=c.layerDefinition.drawingInfo;X&&(X.labelingInfo=$);const ge=p.layerDefinition.drawingInfo;ge&&(ge.labelingInfo=$)}}}let m;e!=null&&e.renderer||o||(delete l.layerDefinition.drawingInfo,delete n.layerDefinition.drawingInfo,delete c.layerDefinition.drawingInfo,delete p.layerDefinition.drawingInfo);const h=e==null?void 0:e.fieldsIndex,w=e==null?void 0:e.renderer;if(h){const T=new Set;o&&await fi(T,e),w&&typeof w.collectRequiredFields=="function"&&await w.collectRequiredFields(T,h),m=Array.from(T);const $=h.fields.map(F=>F.toJSON());l.layerDefinition.fields=$,n.layerDefinition.fields=$,c.layerDefinition.fields=$,p.layerDefinition.fields=$}const O=t==null?void 0:t.length;let b;for(let T=0;T<O;T++){const $=t[T]||t.at(T);if($.visible!==!1&&$.geometry){if(b=$.toJSON(),b.hasOwnProperty("popupTemplate")&&delete b.popupTemplate,(I=b.geometry)!=null&&I.z&&delete b.geometry.z,b.symbol&&(b.symbol.angle||delete b.symbol.angle,Ie(b.symbol)?b.symbol=await Te(b.symbol,i):b.symbol.text&&delete b.attributes),(!a||!a.forceFeatureAttributes)&&(m==null?void 0:m.length)){const F={};for(const R of m)(S=b.attributes)!=null&&S.hasOwnProperty(R)&&(F[R]=b.attributes[R]);b.attributes=F}$.geometry.type==="polygon"?l.featureSet.features.push(b):$.geometry.type==="polyline"?n.featureSet.features.push(b):$.geometry.type==="point"?(P=b.symbol)!=null&&P.text?r.featureSet.features.push(b):c.featureSet.features.push(b):$.geometry.type==="multipoint"?p.featureSet.features.push(b):$.geometry.type==="extent"&&(b.geometry=yi.fromExtent($.geometry).toJSON(),l.featureSet.features.push(b))}}const y=[l,n,p,c,r].filter(T=>T.featureSet.features.length>0);for(const T of y){const $=T.featureSet.features.every(F=>F.symbol);if($&&(!a||!a.forceFeatureAttributes))for(const F of T.featureSet.features)delete F.attributes;$&&delete T.layerDefinition.drawingInfo,(L=T.layerDefinition.drawingInfo)!=null&&L.renderer&&await Ct(T.layerDefinition.drawingInfo.renderer,i)}return y.length?{featureCollection:{layers:y},showLabels:o}:null}async function ra(e,t,a){var h,w,O,b,y,f,g;let i;const o=e.renderer,l=parseFloat(a.cimVersion);if(((h=e.featureReduction)==null?void 0:h.type)==="binning"||((w=e.featureReduction)==null?void 0:w.type)==="cluster"&&l<2.9||(o==null?void 0:o.type)==="pie-chart"||(o==null?void 0:o.type)==="dot-density"&&l<2.6)return se(e,t,a);e.legendEnabled&&a.legendLayers.push({id:e.id});const n=t.layerView,{printTemplate:c,view:p}=t,r=((O=e.source)==null?void 0:O.type)!=="feature-layer"&&((b=e.source)==null?void 0:b.type)!=="ogc-feature";if(n.filter||r||!o||"field"in o&&o.field!=null&&!e.getField(o.field)){const I=await be(n);i=await H(e,I,c,a)}else{if(i={id:(m=B(e)).id,title:m.title,url:m.url,layerType:m.layerType,customParameters:m.customParameters,layerDefinition:m.layerDefinition,charts:c.includeCharts?m.charts:void 0},i.showLabels=c.showLabels&&e.labelsVisible,te(i,e),((f=(y=i.layerDefinition)==null?void 0:y.drawingInfo)==null?void 0:f.renderer)&&(delete i.layerDefinition.minScale,delete i.layerDefinition.maxScale,await Ct(i.layerDefinition.drawingInfo.renderer,a),"visualVariables"in o&&o.visualVariables&&o.visualVariables[0])){const S=o.visualVariables[0];if(S.type==="size"&&S.maxSize&&typeof S.maxSize!="number"&&S.minSize&&typeof S.minSize!="number"){const P=gi(S,p.scale);i.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=P.minSize,i.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=P.maxSize}}const I=bi(n);if(I&&(i.layerDefinition??(i.layerDefinition={}),i.layerDefinition.definitionExpression=i.layerDefinition.definitionExpression?`(${i.layerDefinition.definitionExpression}) AND (${I})`:I),e.gdbVersion&&(i.layerDefinition??(i.layerDefinition={}),i.layerDefinition.gdbVersion=e.gdbVersion),((g=n.hasHighlight)==null?void 0:g.call(n))&&"getHighlightIds"in n){const S=n;i.selectionObjectIds=S.getHighlightIds(),i.selectionSymbol=Ji(e.geometryType,S.highlightOptions??p.highlightOptions)}}var m;return i}async function na(e,t,a){var i,o;return((i=e.featureReduction)==null?void 0:i.type)==="binning"||((o=e.featureReduction)==null?void 0:o.type)==="cluster"?se(e,t,a):(e.legendEnabled&&a.legendLayers.push({id:e.id}),H(e,await be(t.layerView),t.printTemplate,a))}async function sa(e,{printTemplate:t},a){return H(e,null,t,a)}function pa(e,t){var o;e.legendEnabled&&t.legendLayers.push({id:e.id});const a={layerType:(i=B(e)).layerType,customParameters:i.customParameters};var i;return a.bandIds=e.bandIds,a.compressionQuality=e.compressionQuality,a.format=e.format,a.interpolation=e.interpolation,(e.mosaicRule||e.definitionExpression)&&(a.mosaicRule=e.exportImageServiceParameters.mosaicRule.toJSON()),e.rasterFunction&&(a.renderingRule=e.rasterFunction.toJSON()),e.renderer&&(a.layerDefinition??(a.layerDefinition={}),(o=a.layerDefinition).drawingInfo??(o.drawingInfo={}),a.layerDefinition.drawingInfo.renderer=e.renderer.toJSON()),te(a,e),a}async function ua(e,t,a){var l;if(((l=e.renderer)==null?void 0:l.type)==="flow")return se(e,t,a);e.legendEnabled&&a.legendLayers.push({id:e.id});const i={bandIds:(o=B(e)).bandIds,customParameters:o.customParameters,interpolation:o.interpolation,layerDefinition:o.layerDefinition};var o;return i.layerType="ArcGISImageServiceLayer",te(i,e),i}async function ca(e,t,a){const i=t.printTemplate;if(!e.portalItem||e.portalItem.access==="public"){const p=B(e,"web-map");return p.type="kml",delete p.layerType,p.url=fe(e.url),p}const o=[],l=t.layerView;l.allVisibleMapImages.forEach((p,r)=>{const m={id:`${e.id}_image${r}`,type:"image",title:e.id,minScale:e.minScale||0,maxScale:e.maxScale||0,opacity:l.fullOpacity,extent:p.extent};p.href.substr(0,22)==="data:image/png;base64,"?m.imageData=p.href.substr(22):m.url=p.href,o.push(m)});const n=[...l.allVisiblePoints.items,...l.allVisiblePolylines.items,...l.allVisiblePolygons.items],c={id:e.id,...await H(null,n,i,a)};return o.push(c),o}function da(e,{view:t},a){var r,m;let i;const o={id:e.id,subLayerIds:[]};let l=[];const n=t.scale,c=h=>{const w=n===0,O=h.minScale===0||n<=h.minScale,b=h.maxScale===0||n>=h.maxScale;if(h.visible&&(w||O&&b))if(h.sublayers)h.sublayers.forEach(c);else{const y=h.toExportImageJSON(),f={id:h.id,name:h.title,layerDefinition:{drawingInfo:y.drawingInfo,definitionExpression:y.definitionExpression,source:y.source}};l.unshift(f),o.subLayerIds.push(h.id)}};var p;return e.sublayers&&e.sublayers.forEach(c),l.length&&(l=l.map(({id:h,name:w,layerDefinition:O})=>({id:h,name:w,layerDefinition:O})),i={layerType:(p=B(e)).layerType,customParameters:p.customParameters},i.layers=l,i.visibleLayers=(m=(r=e.capabilities)==null?void 0:r.exportMap)!=null&&m.supportsDynamicLayers?void 0:o.subLayerIds,e.gdbVersion&&(i.gdbVersion=e.gdbVersion),te(i,e),e.legendEnabled&&a.legendLayers.push(o)),i}async function ma({layerView:e,printTemplate:t},a){const i=[],o=e.layer;if(o.featureCollections!=null)for(const l of o.featureCollections){const n=await H(l,l.source,t,a);n&&i.push(...n.featureCollection.layers)}else if(o.sublayers!=null)for(const l of o.sublayers){const n=await H(null,l.graphics,t,a);n&&i.push(...n.featureCollection.layers)}return{featureCollection:{layers:i}}}function ha(){return{type:"OpenStreetMap"}}async function se(e,{printTemplate:t,view:a},i){var h;const o={type:"image"},l={format:"png",ignoreBackground:!0,ignorePadding:!0,layers:[e]};a.rotation!==0&&(l.rotation=0);const n=i.ssExtent||a.state.extent.clone();let c=96,p=!0,r=!0;if(t.exportOptions){const w=t.exportOptions;w.dpi!=null&&w.dpi>0&&(c=w.dpi),w.width!=null&&w.width>0&&(p=w.width%2==a.width%2),w.height!=null&&w.height>0&&(r=w.height%2==a.height%2)}if(t.layout==="map-only"&&t.scalePreserved&&(!t.outScale||t.outScale===a.scale)&&c===96&&(!p||!r)&&a.state.extent.equals(a.extent)&&(l.area={x:0,y:0,width:a.width,height:a.height},p||(l.area.width-=1),r||(l.area.height-=1),!i.ssExtent)){const w=a.toMap(wt(l.area.width,l.area.height));n.ymin=w.y,n.xmax=w.x,i.ssExtent=n}o.extent=n.clone()._normalize(!0).toJSON();const m=await a.takeScreenshot(l);return o.imageData=(h=Wt(m.dataUrl))==null?void 0:h.data,o}async function ya(e,{layerView:t,printTemplate:a},i){return e.legendEnabled&&i.legendLayers.push({id:e.id}),H(e,await be(t),a,i)}async function fa(e){var o,l;const t=[],a=[];for(const n of e.map.allTables)n.type!=="feature"||n.loaded||a.push(n.load());a.length&&await Promise.allSettled(a);for(const n of e.map.allTables)if(n.type==="feature"&&n.loaded&&n.isTable&&((o=n.source)==null?void 0:o.type)==="feature-layer"){const c={id:(i=B(n)).id,title:i.title,customParameters:i.customParameters,layerDefinition:{definitionExpression:(l=i.layerDefinition)==null?void 0:l.definitionExpression},url:i.url};te(c,n),t.push(c)}var i;return t.length?t:void 0}function ba(e,t){e.legendEnabled&&t.legendLayers.push({id:e.id});const a={layerType:(i=B(e)).layerType,customParameters:i.customParameters};var i;return te(a,e),a}async function ga(e,t,a){if(e.serviceUrl&&e.styleUrl){const i=Oe(e.styleUrl,e.apiKey),o=Oe(e.serviceUrl,e.apiKey);if(!i&&!o||a.cimVersion!=="2.1.0"){const l={type:"VectorTileLayer"};return l.styleUrl=fe(e.styleUrl),l.token=i,o!==i&&(l.additionalTokens=[{url:e.serviceUrl,token:o}]),l}}return se(e,t,a)}function va(e){var i;const t=(i=e.urlTemplate)==null?void 0:i.replace(/\${/g,"{"),a={type:"WebTiledLayer",urlTemplate:t,credits:e.copyright};return e.subDomains&&e.subDomains.length>0&&(a.subDomains=e.subDomains),a}function wa(e,t){let a;const i=[],o=l=>{l.visible&&(l.sublayers?l.sublayers.forEach(o):l.name&&i.unshift(l.name))};return e.sublayers&&e.sublayers.forEach(o),i.length&&(e.legendEnabled&&t.legendLayers.push({id:e.id,subLayerIds:i}),a={type:"wms",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,transparentBackground:e.imageTransparency,visibleLayers:i,url:fe(e.url),version:e.version}),a}function _a(e){const t=e.activeLayer;return{type:"wmts",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:t.imageFormat,layer:t.id,style:t.styleId,tileMatrixSet:t.tileMatrixSetId,url:fe(e.url)}}function te(e,t){t.url&&(e.url=fe(e.url||t.url),e.token=Oe(e.url,t.apiKey))}async function Te(e,t){var n;t.canvas||(t.canvas=document.createElement("canvas"));const a=1024;t.canvas.width=a,t.canvas.height=a;const i=t.canvas.getContext("2d");let o,l;if(e.path){const c=new Path2D(e.path);c.closePath(),i.fillStyle=Array.isArray(e.color)?`rgba(${e.color[0]},${e.color[1]},${e.color[2]},${e.color[3]/255})`:"rgb(0,0,0)",i.fill(c);const p=ji(i);if(!p)return null;i.clearRect(0,0,a,a);const r=ve(e.size)/Math.max(p.width,p.height);i.scale(r,r);const m=a/r,h=m/2-p.width/2-p.x,w=m/2-p.height/2-p.y;if(i.translate(h,w),Array.isArray(e.color)&&i.fill(c),((n=e.outline)==null?void 0:n.width)&&Array.isArray(e.outline.color)){const b=e.outline;i.lineWidth=ve(b.width)/r,i.lineJoin="round",i.strokeStyle=`rgba(${b.color[0]},${b.color[1]},${b.color[2]},${b.color[3]/255})`,i.stroke(c),p.width+=i.lineWidth,p.height+=i.lineWidth}p.width*=r,p.height*=r;const O=i.getImageData(a/2-p.width/2,a/2-p.height/2,Math.ceil(p.width),Math.ceil(p.height));o=O.width,l=O.height,i.canvas.width=o,i.canvas.height=l,i.putImageData(O,0,0)}else{const c=e.contentType==="image/svg+xml"?"data:image/svg+xml;base64,"+e.imageData:e.url,p=(await Z(c,{responseType:"image"})).data;o=ve(e.width),l=ve(e.height),i.canvas.width=o,i.canvas.height=l,i.drawImage(p,0,0,i.canvas.width,i.canvas.height)}return{type:"esriPMS",imageData:i.canvas.toDataURL("image/png").substr(22),angle:e.angle,contentType:"image/png",height:st(l),width:st(o),xoffset:e.xoffset,yoffset:e.yoffset}}async function Ct(e,t){const a=e.type;if(a==="simple"&&Ie(e.symbol))e.symbol=await Te(e.symbol,t);else if(a==="uniqueValue"||a==="classBreaks"){Ie(e.defaultSymbol)&&(e.defaultSymbol=await Te(e.defaultSymbol,t));const i=e[a==="uniqueValue"?"uniqueValueInfos":"classBreakInfos"];if(i)for(const o of i)Ie(o.symbol)&&(o.symbol=await Te(o.symbol,t))}}async function be(e){return e.queryFeatures(e.createQuery()).then(t=>t.features)}function B(e,t){return e.write({},{ignorePersistenceEnabled:!0,origin:t})??{}}function Ta(e){var t;return(t=e.gpMetadata)!=null&&t.executionType?Zi.fromJSON(e.gpMetadata.executionType):"sync"}function Ie(e){var t;return e&&(e.path||e.contentType==="image/svg+xml"||((t=e.url)==null?void 0:t.endsWith(".svg")))}let q=class extends pe{constructor(t){super(t),this.extent=null,this.extraParameters=null,this.outSpatialReference=null,this.template=null,this.updateDelay=1e3,this.view=null}};s([u()],q.prototype,"extent",void 0),s([u()],q.prototype,"extraParameters",void 0),s([u()],q.prototype,"outSpatialReference",void 0),s([u()],q.prototype,"template",void 0),s([u()],q.prototype,"updateDelay",void 0),s([u()],q.prototype,"view",void 0),q=s([V("esri.rest.support.PrintParameters")],q);const Ia=q;let E=class extends pe{constructor(t){super(t),this.strokeDash=[],this.strokeWidth=2,this.strokeColor=[0,0,0,1],this.strokeBackgroundColor=[0,0,0,0],this.fillColor=[0,0,0,0],this.backgroundFillColor=[0,0,0,.5],this.visible=!0,this.isDecoration=!1,this.boxWidth=0,this.boxHeight=0,this.backgroundWidth=0,this.backgroundHeight=0,this.padding={left:0,top:0,right:0,bottom:0}}get _strokeStyle(){return`rgba(${this.strokeColor.join()})`}get _strokeBackgroundStyle(){return`rgba(${this.strokeBackgroundColor.join()})`}get _fillStyle(){return`rgba(${this.fillColor.join()})`}get _backgroundFillStyle(){return`rgba(${this.backgroundFillColor.join()})`}render(){const{backgroundWidth:t,backgroundHeight:a,boxWidth:i,boxHeight:o,padding:l}=this,n=l.left,c=l.top,p=this.x??n+t/2-i/2,r=this.y??c+a/2-o/2,m=p+i,h=r+o;return d("div",{classes:{"esri-box-overlay-item":!0},styles:{left:"0px",top:"0px",width:"100%",height:"100%",visibility:this.visible?"visible":"hidden"}},d("svg",{styles:{width:"100%",height:"100%"}},d("path",{d:`M ${n} ${c} L ${t+n} ${c} L ${t+n} ${a+c} L ${n} ${a+c} Z M ${p} ${r} L ${p} ${h} L ${m} ${h} L ${m} ${r} Z`,fill:this._backgroundFillStyle,stroke:this._strokeBackgroundStyle,"stroke-width":this.strokeWidth}),d("rect",{fill:this._fillStyle,height:o,stroke:this._strokeStyle,"stroke-dasharray":this.strokeDash.join(" ")||void 0,"stroke-width":this.strokeWidth,width:i,x:p,y:r})))}renderCanvas(){}};s([u()],E.prototype,"strokeDash",void 0),s([u()],E.prototype,"strokeWidth",void 0),s([u()],E.prototype,"strokeColor",void 0),s([u()],E.prototype,"strokeBackgroundColor",void 0),s([u()],E.prototype,"fillColor",void 0),s([u()],E.prototype,"backgroundFillColor",void 0),s([u()],E.prototype,"visible",void 0),s([u()],E.prototype,"isDecoration",void 0),s([u()],E.prototype,"boxWidth",void 0),s([u()],E.prototype,"boxHeight",void 0),s([u()],E.prototype,"backgroundWidth",void 0),s([u()],E.prototype,"backgroundHeight",void 0),s([u()],E.prototype,"x",void 0),s([u()],E.prototype,"y",void 0),s([u()],E.prototype,"padding",void 0),s([u({readOnly:!0})],E.prototype,"_strokeStyle",null),s([u({readOnly:!0})],E.prototype,"_strokeBackgroundStyle",null),s([u({readOnly:!0})],E.prototype,"_fillStyle",null),s([u({readOnly:!0})],E.prototype,"_backgroundFillStyle",null),E=s([V("esri.views.overlay.BoxOverlayItem")],E);const xa=E;let G=class extends Y{constructor(e){super(e),this.description=null,this.format=null,this.label=null,this.layout=null,this.layoutItem=null,this.layoutOptions=null,this.layoutTemplateInfo=null}};s([u()],G.prototype,"description",void 0),s([u({json:{read:we}})],G.prototype,"format",void 0),s([u()],G.prototype,"label",void 0),s([u({json:{read:he}})],G.prototype,"layout",void 0),s([u({type:Se})],G.prototype,"layoutItem",void 0),s([u()],G.prototype,"layoutOptions",void 0),s([u()],G.prototype,"layoutTemplateInfo",void 0),G=s([V("esri.widgets.Print.CustomTemplate")],G);const ye=G;let D=class extends pe{constructor(e){super(e),this.attributionEnabled=!0,this.author=null,this.copyright=null,this.customTextElements=null,this.dpi=96,this.fileName=null,this.forceFeatureAttributes=!1,this.format="pdf",this.height=null,this.includeTables=!0,this.layout="letter-ansi-a-landscape",this.layoutItem=null,this.legendEnabled=!0,this.northArrowEnabled=!1,this.scale=null,this.scaleEnabled=!1,this.title=null,this.width=null}};s([u()],D.prototype,"attributionEnabled",void 0),s([u()],D.prototype,"author",void 0),s([u()],D.prototype,"copyright",void 0),s([u()],D.prototype,"customTextElements",void 0),s([u()],D.prototype,"dpi",void 0),s([u()],D.prototype,"fileName",void 0),s([u()],D.prototype,"forceFeatureAttributes",void 0),s([u()],D.prototype,"format",void 0),s([u()],D.prototype,"height",void 0),s([u()],D.prototype,"includeTables",void 0),s([u()],D.prototype,"layout",void 0),s([u({type:Se})],D.prototype,"layoutItem",void 0),s([u()],D.prototype,"legendEnabled",void 0),s([u()],D.prototype,"northArrowEnabled",void 0),s([u()],D.prototype,"scale",void 0),s([u()],D.prototype,"scaleEnabled",void 0),s([u()],D.prototype,"title",void 0),s([u()],D.prototype,"width",void 0),D=s([V("esri.widgets.Print.TemplateOptions")],D);const kt=D,Oa=new Set(["GISProfessionalStdUT","GISProfessionalAdvUT"]),Sa=/(\/GPServer\/).+/i,$a=new Q({inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"}),ke=bt.ofType(ye);function La(e){var a;e.layoutOptions??(e.layoutOptions={}),(a=e.layoutOptions).customTextElements??(a.customTextElements=[]);const t="date";if(!e.layoutOptions.customTextElements.find(i=>t in i)){const{customTextElements:i}=e.layoutOptions;let o=si(Date.now(),pi("short-date"));ui()==="ar"&&(o="‏"+o),i.push({date:o})}}let C=class extends oi{constructor(e){super(e),this._serviceTemplateCustomTextElements=null,this._layoutToTemplateInfo=new li,this._isFreeHand=!1,this._freeHandWidth=0,this._freehandHeight=0,this._asyncPrintTaskUrl=null,this._layoutInfoTaskUrl=null,this.allowedFormats="all",this.allowedLayouts="all",this.browseTemplates=new ke,this.defaultTemplates=new ke,this.error=null,this.extraParameters=null,this.includeDefaultTemplates=!0,this.portal=vt.getDefault(),this.portalTemplateIds=[],this.showPrintAreaEnabled=!1,this.printServiceUrl=null,this.printTimeout=12e4,this.templatesInfo=null,this.updateDelay=1e3,this.view=null,this.templateCustomTextElements=null,this.templateOptions=new kt}initialize(){this.addHandles(ee(()=>this.showPrintAreaEnabled,e=>{var t,a;e?this._enablePrintPreview():(this.removeHandles("overlay-handler"),(a=(t=this.view)==null?void 0:t.overlay)==null||a.removeItem(this._getOverlayItem()))}))}destroy(){var e;this.removeHandles("overlay-handler"),this.view&&(this._overlayItem&&((e=this.view.overlay)==null||e.removeItem(this._overlayItem),this._overlayItem.destroy(),this._overlayItem=null),this.view=null)}get effectivePrintServiceUrl(){return this.printServiceUrl??null}get effectiveTemplateCustomTextElements(){if(!this._serviceTemplateCustomTextElements)return{};const e=xe(this._serviceTemplateCustomTextElements);return this.templateCustomTextElements&&Object.keys(this.templateCustomTextElements).forEach(t=>{var i;const a=e[t];if(a){const o=(i=this.templateCustomTextElements)==null?void 0:i[t];a.forEach(l=>{const[n]=Object.entries(l)[0];o==null||o.forEach(c=>{const[p,r]=Object.entries(c)[0];n===p&&(l[n]=r)})})}}),Object.freeze(e)}get layoutTemplateInfo(){var t;const e=((t=this.templateOptions.layoutItem)==null?void 0:t.id)??this.templateOptions.layout;return e?this._layoutToTemplateInfo.get(e):null}get state(){var e;return this.loadStatus==="loading"?"initializing":this.loadStatus==="failed"||this.error?"error":this.loadStatus==="loaded"&&((e=this.view)!=null&&e.ready)?"ready":"disabled"}get layoutTemplateNorthArrowInfo(){var e,t;return(t=(e=this.layoutTemplateInfo)==null?void 0:e.layoutOptions)!=null&&t.mapSurroundInfos?this.layoutTemplateInfo.layoutOptions.mapSurroundInfos.find(a=>a.type==="CIMMarkerNorthArrow"):null}async load(e){return this.addResolvingPromise(this._loadResources(e).catch(t=>this.error=t)),this}async print(e){var c;const{view:t,extraParameters:a,updateDelay:i}=this;if(!t)throw new K("print:view-required","view is not set");La(e);const o=this._getOverlayItem(),l=e.scalePreserved||!this.showPrintAreaEnabled?void 0:Ii(new Je,t.viewpoint,e.layout==="MAP_ONLY"?[e.exportOptions.width,e.exportOptions.height]:[o.boxWidth,o.boxHeight]),n=new Ia({view:t,template:e,extent:l,extraParameters:a,updateDelay:i});try{const p=!!((c=e.layoutItem)!=null&&c.id)&&(this.portalTemplateIds.includes(e.layoutItem.id)||this.browseTemplates.some(r=>{var m,h;return((m=r.layoutItem)==null?void 0:m.id)===((h=e.layoutItem)==null?void 0:h.id)}));return await Qi(p&&this._asyncPrintTaskUrl?this._asyncPrintTaskUrl:this.effectivePrintServiceUrl,n,{timeout:this.printTimeout})}catch(p){throw new K("print:export-error","An error occurred while exporting the web map.",{error:p})}}toPrintTemplate({attributionEnabled:e,author:t,copyright:a,customTextElements:i,dpi:o,forceFeatureAttributes:l,format:n,height:c,includeTables:p,layout:r,layoutItem:m,legendEnabled:h,northArrowEnabled:w,scale:O,scaleEnabled:b,title:y,width:f}){if(!r)throw new K("print:layout-required","layout is not set");const g=new Lt({attributionVisible:e,forceFeatureAttributes:l,format:n,includeTables:p,layout:r,layoutItem:m,layoutOptions:{authorText:t||"",copyrightText:a||"",customTextElements:i,titleText:y||""},outScale:O??0,scalePreserved:b});f&&(g.exportOptions.width=f),c&&(g.exportOptions.height=c),o&&(g.exportOptions.dpi=o),!h&&g.layoutOptions&&(g.layoutOptions.legendLayers=[]);const I=this.layoutTemplateNorthArrowInfo;return I&&I.visible!==w&&g.layoutOptions&&(g.layoutOptions.elementOverrides={[I.name]:{visible:w}}),g}async fetchLayoutTemplateInfo(e,t){var p;if(!((p=e.layoutItem)!=null&&p.id))return;const a=await this._fetchPortalLayoutTemplateInfo(e.layoutItem,t);this._layoutToTemplateInfo.set(e.layoutItem.id,a),e.layoutTemplateInfo=a;const{hasLegend:i,mapSurroundInfos:o,customTextElements:l}=a.layoutOptions,n=o.some(({type:r,visible:m})=>r==="CIMMarkerNorthArrow"&&m);e.layoutOptions={legend:i,northArrow:n};const c=xe(this._serviceTemplateCustomTextElements)??{};c[e.layoutItem.id]=l,this._serviceTemplateCustomTextElements=Object.freeze(c)}getLayoutTemplateInfo(e){return this._layoutToTemplateInfo.get(e)}async addPortalTemplate(e){const t=new ye({label:e.title,layoutItem:e});this.browseTemplates.add(t)}removePortalTemplate(e){var t,a,i,o;(t=e.layoutItem)!=null&&t.id&&((a=this.templateOptions.layoutItem)==null?void 0:a.id)===e.layoutItem.id&&(this.templateOptions.layout=this.defaultTemplates.length||this.browseTemplates.length?null:(o=(i=this.templatesInfo)==null?void 0:i.layout)==null?void 0:o.defaultValue,this.templateOptions.layoutItem=null),this._layoutToTemplateInfo.delete(e.layoutItem.id),this.browseTemplates.remove(e)}async _loadResources(e){var n,c,p;let t=[];if(this.printServiceUrl)this._set("effectivePrintServiceUrl",this.printServiceUrl),await this._updateLayoutInfoTaskUrl(this.effectivePrintServiceUrl);else{if(this.destroyed)return;try{await this.portal.load(e)}catch(r){throw new K("print:could-not-load-portal","Cannot load print resource information from portal",{error:r,url:this.effectivePrintServiceUrl})}if(this.portal.helperServices){const{asyncPrintTask:r,layoutInfoTask:m,printTask:h}=this.portal.helperServices;h&&(this._set("effectivePrintServiceUrl",h.url),t=((n=h.templates)==null?void 0:n.map(w=>ye.fromJSON(w)))??[]),this._asyncPrintTaskUrl=r==null?void 0:r.url,await this._updateLayoutInfoTaskUrl((m==null?void 0:m.url)||this.effectivePrintServiceUrl)}}this.defaultTemplates.addMany(t);const a=(c=this.effectivePrintServiceUrl)==null?void 0:c.toLowerCase().split("/");if(!(a!=null&&a.includes("gpserver")))throw new K("print:invalid-print-service-url","Can't fetch print templates information from provided URL",{url:this.effectivePrintServiceUrl});const[i,o,l]=await Promise.all([this._getPrintServiceLayouts(e),this._getPrintServiceTemplates(e),this._getPortalCustomTemplates(e)]);if(this._processPrintServiceLayouts(i),this._processPrintServiceTemplates(o),this._processPortalTemplates(l),(p=this.templateOptions.layoutItem)==null?void 0:p.id){const r=this.templateOptions.layoutItem.id;let m=this.defaultTemplates.find(h=>{var w;return((w=h.layoutItem)==null?void 0:w.id)===r});m||(m=new ye({label:this.templateOptions.layoutItem.title,layoutItem:this.templateOptions.layoutItem})),await this.fetchLayoutTemplateInfo(m,e),this.templateOptions.layout=r}this._updateOverLayItem()}async _updateLayoutInfoTaskUrl(e,t){if(!e)return;const a=(await Yi(e,t)).find(i=>i.includes("Get Layout Templates Info"));a&&(this._layoutInfoTaskUrl=e.replace(Sa,`$1${encodeURI(a)}`))}async _getPortalCustomTemplates(e){if(this.printServiceUrl||!this.portal)return[];const{layoutGroupQuery:t,user:a}=this.portal,i=gt.test(this.portal.url),o=a==null?void 0:a.userLicenseTypeId,l=o&&Oa.has(o);if(!t||i&&!l)return[];const n=new nt({query:t,disableExtraQuery:!0}),c=await this.portal.queryGroups(n,e);if(!c.total)return[];const p=c.results[0],r=new nt({num:100,query:"type:Layout",sortField:p.sortField,sortOrder:p.sortOrder??void 0}),m=(await p.queryItems(r,e)).results;return m.length?m.map(h=>new ye({label:h.title,layoutItem:h})):[]}async _fetchPortalLayoutTemplateInfo(e,t){const{id:a}=e,i=this._layoutInfoTaskUrl;if(!i)throw new K("print:invalid-layout-info-task-url","Can't fetch layout template info",{url:i});e.access!=="public"&&ne&&await ne.getCredential(i);const o={Layout_Item_ID:JSON.stringify({id:a})};return(await this._fetchLayoutTemplateInfos(o,t))[0]}async _fetchLayoutTemplateInfos(e,t){const a=this._layoutInfoTaskUrl;if(!a)throw new K("print:invalid-layout-info-task-url","Can't fetch layout template info",{url:a});if(await Pt(a)==="async"){const i=await St(a,e,void 0,t||void 0);return await i.waitForJobCompletion({interval:1e3}),(await i.fetchResultData("Output_JSON")).value}return(await Ot(a,e,null,t)).results[0].value}_processPortalTemplates(e){var t;if(e){this.defaultTemplates.addMany(e);for(const a of e)(t=a.layoutItem)!=null&&t.id&&this.portalTemplateIds.push(a.layoutItem.id)}}_processPrintServiceTemplates(e){this._set("templatesInfo",e)}async _getPrintServiceLayouts(e){let t=[];try{t=await this._fetchLayoutTemplateInfos(void 0,e)}catch{}return t}_processPrintServiceLayouts(e){const t={};for(const a of e){const{layoutTemplate:i,layoutOptions:o}=a,l=he(i);this._layoutToTemplateInfo.set(l,a),t[l]=o.customTextElements}this._serviceTemplateCustomTextElements=Object.freeze(t)}async _getPrintServiceTemplates(e){let t;try{({data:t}=await Z(this.effectivePrintServiceUrl,{...e,query:{f:"json"},timeout:this.printTimeout}))}catch(l){throw ai(l)?l:new K("print:unavailable-service-info","Can't fetch templates info from service",{error:l})}const{parameters:a}=t,i=a.find(({name:l})=>l==="Format"),o=a.find(({name:l})=>l==="Layout_Template");return{format:this._getFormat(i),layout:this._getLayout(o)}}_getFormat(e){const t=this.allowedFormats==="all"?e.choiceList:e.choiceList.filter(l=>this.allowedFormats.includes(we(l))),a=(t.length?t:e.choiceList).map(we).filter(lt),i=we(e.defaultValue),o=a.includes(i)?i:a[0];return{choiceList:a,defaultValue:o}}_getLayout(e){const t=e.choiceList.filter(n=>n.toLowerCase()!=="map_only"),a=this.allowedLayouts==="all"?t:t.filter(n=>this.allowedLayouts.includes(he(n))),i=(a.length?a:t).map(he).filter(lt),o=he(e.defaultValue),l=i.includes(o)?o:i.find(n=>/(?=.*letter)(?=.*landscape)/i.test(n))??i.find(n=>/(?=.*a4)(?=.*landscape)/i.test(n))??i[0];return{choiceList:i,defaultValue:l}}_getOverlayItem(){return this._overlayItem||(this._overlayItem=new xa({strokeDash:[5],strokeWidth:2,strokeColor:[30,144,255,255]})),this._overlayItem}_enablePrintPreview(){var a,i,o;if(!((a=this.view)!=null&&a.overlay))return;const e=this.templateOptions,t=this._getOverlayItem();this.addHandles([ee(()=>{var l,n,c,p;return[e.width,e.height,e.scaleEnabled,e.scale,e.layout,e.layoutItem,(l=this.view)==null?void 0:l.scale,(n=this.view)==null?void 0:n.size,(c=this.view)==null?void 0:c.state.paddedViewState.size,(p=this.view)==null?void 0:p.state.padding]},()=>this._updateOverLayItem(),ft),(i=this.view)==null?void 0:i.on("drag",["Shift"],l=>this._handleDrag(l),dt.WIDGET),(o=this.view)==null?void 0:o.on("key-down",["Escape"],()=>this._resetDrag(),dt.WIDGET)],"overlay-handler"),this.view.overlay.addItem(t)}_updateOverLayItem(){var O;if(!this.view)return;const e=this.templateOptions,t=this._getOverlayItem(),a=((O=e.layoutItem)==null?void 0:O.id)??e.layout,i=this.view,o=i.spatialReference,[l,n]=i.state.paddedViewState.size,c=i.state.padding;let p=0,r=0;if(a==="MAP_ONLY")e.width!=null&&e.height!=null&&(p=e.width,r=e.height);else if(a){const{webMapFrameSize:b,pageUnits:y}=this._layoutToTemplateInfo.get(a)??{};let f=!1;if(b&&y)if(this._isFreeHand){const g=b[0]/b[1];p=this._freeHandWidth,r=this._freehandHeight,p>r?r=p/g:p=r*g}else{const g=$a.fromJSON(y.toLowerCase()),I=o.unit;pt(g)===pt(I)?(p=ut(b[0],g,I),r=ut(b[1],g,I)):(f=!0,p=b[0],r=b[1])}if(!this._isFreeHand)if(e.scaleEnabled&&e.scale){const g=f?Math.min(l/p,n/r):ri(o)*ni*e.dpi;p*=g,r*=g}else if(p===0||r===0)p=l,r=n;else{const g=(l-.1*l)/p,I=(n-.1*n)/r,S=Math.min(g,I);p*=S,r*=S}}const{scaleEnabled:m,scale:h}=e,w=m&&h?h/this.view.scale:1;t.boxWidth=p*w||l,t.boxHeight=r*w||n,c&&(t.padding=c),t.backgroundWidth=l??0,t.backgroundHeight=n??0}_resetDrag(){this._isFreeHand=!1,this._updateOverLayItem()}_handleDrag(e){switch(e.action){case"start":this._start();break;case"update":this._update(e);break;case"end":this._end()}e.stopPropagation()}_start(){this._isFreeHand=!0}_update(e){const t=this._getOverlayItem(),{x:a,y:i}=e,{x:o,y:l}=e.origin;a>o?(t.x=o,t.boxWidth=a-o):(t.x=a,t.boxWidth=o-a),i>l?(t.y=l,t.boxHeight=i-l):(t.y=i,t.boxHeight=l-i)}_end(){const e=this._getOverlayItem();if(!this.view||e.x==null||e.y==null)return;const t=this.view,a=t.toMap(wt(e.x+.5*e.boxWidth,e.y+.5*e.boxHeight));e.x=null,e.y=null,t.goTo({center:a}),this._freeHandWidth=e.boxWidth,this._freehandHeight=e.boxHeight,this.templateOptions.layout==="MAP_ONLY"&&(this.templateOptions.width=this._freeHandWidth,this.templateOptions.height=this._freehandHeight),this.templateOptions.scale=this.view.scale,this._updateOverLayItem()}};s([u()],C.prototype,"_serviceTemplateCustomTextElements",void 0),s([u()],C.prototype,"_layoutToTemplateInfo",void 0),s([u()],C.prototype,"allowedFormats",void 0),s([u()],C.prototype,"allowedLayouts",void 0),s([u({type:ke})],C.prototype,"browseTemplates",void 0),s([u({type:ke})],C.prototype,"defaultTemplates",void 0),s([u()],C.prototype,"error",void 0),s([u()],C.prototype,"extraParameters",void 0),s([u()],C.prototype,"includeDefaultTemplates",void 0),s([u({readOnly:!0})],C.prototype,"effectivePrintServiceUrl",null),s([u()],C.prototype,"effectiveTemplateCustomTextElements",null),s([u()],C.prototype,"layoutTemplateInfo",null),s([u({type:vt})],C.prototype,"portal",void 0),s([u()],C.prototype,"portalTemplateIds",void 0),s([u()],C.prototype,"showPrintAreaEnabled",void 0),s([u()],C.prototype,"printServiceUrl",void 0),s([u()],C.prototype,"printTimeout",void 0),s([u({readOnly:!0})],C.prototype,"state",null),s([u({readOnly:!0})],C.prototype,"templatesInfo",void 0),s([u()],C.prototype,"updateDelay",void 0),s([u()],C.prototype,"view",void 0),s([u()],C.prototype,"templateCustomTextElements",void 0),s([u({type:kt})],C.prototype,"templateOptions",void 0),s([u()],C.prototype,"layoutTemplateNorthArrowInfo",null),C=s([V("esri.widgets.Print.PrintViewModel")],C);const Et=C,Dt=bt.ofType(It),Mt="MAP_ONLY";var x;(function(e){e.layout="layoutTab",e.mapOnly="mapOnlyTab",e.export="exportTab"})(x||(x={}));const _="esri-print",ie=`${_}__advanced-options-button`,v={base:_,headerTitle:`${_}__header-title`,layoutTabList:`${_}__layout-tab-list`,layoutTab:`${_}__layout-tab`,layoutSection:`${_}__layout-section`,mapOnlySection:`${_}__map-only-section`,panelItemsCentered:`${_}__panel-items--centered`,loader:`${_}__loader`,advancedOptionsButton:ie,advancedOptionsButtonContainer:`${ie}-container`,advancedOptionsButtonTitle:`${ie}-title`,advancedOptionsButtonIconOpened:`${ie}-icon--opened`,advancedOptionsButtonIconClosed:`${ie}-icon--closed`,advancedOptionsButtonIconClosed_RTL:`${ie}-icon--closed-rtl`,swapButton:`${_}__swap-button`,printButton:`${_}__export-button`,templateSelectContainer:`${_}__template-select-container`,templateSelectBlock:`${_}__template-select-block`,templateSelectIcon:`${_}__template-select-icon`,formSectionContainer:`${_}__form-section-container`,formCheckboxLabel:`${_}__form-checkbox-label`,advancedOptionsSection:`${_}__advanced-options-section`,advancedOptionsContainer:`${_}__advanced-options-container`,browseTemplateButtonContainer:`${_}__browse-template-button-container`,exportedFilesContainer:`${_}__export-panel-container`,exportedFilesTitle:`${_}__export-title`,exportedFile:`${_}__exported-file`,exportedFileLink:`${_}__exported-file-link`,exportedFileLinkTitle:`${_}__exported-file-link-title`,exportedFilesEmpty:`${_}__exported-files-empty`,printWidgetContainer:`${_}__container`,content:`${_}__content`,panelContainer:`${_}__panel-container`,scaleInfoContainer:`${_}__scale-info-container`,scaleInputContainer:`${_}__scale-input-container`,scaleInput:`${_}__scale-input`,sizeContainer:`${_}__size-container`,panelError:`${_}__panel--error`,exportedFileError:`${_}__exported-file--error`,exportedFileLoader:`${_}__exported-file--loader`,exportSection:`${_}__export-section`,exportSectionCentered:`${_}__export-section--centered`,templateButtonContainer:`${_}__template-button-container`,templateDoneButton:`${_}__template-done-button`,templateSelectFlowItemContainer:`${_}__template-select-flow-item-container`,templateSelectFlowItemContent:`${_}__template-select-flow-item-content`,templateSelectFlowItemListHeading:`${_}__template-select-flow-item-list-heading`};function Pa(e,t,a,i){const o=a/t,l=i/t;return{width:Math.round(e*o),height:Math.round(e*l)}}function Ca(e){return!isNaN(e)&&e>0}function Fe(e){return(e==null?void 0:e.toUpperCase())===Mt}function ka(e){var i;const{state:t,extension:a}=e;switch(t){case"pending":return"spinner";case"error":return"exclamation-mark-circle";default:return(i=a==null?void 0:a.toLowerCase())!=null&&i.includes("pdf")?"file-pdf":"file"}}function ae(e,t){return!!t&&e.some(a=>{var i;return((i=a.layoutItem)==null?void 0:i.id)===t||a.layout===t})}const Ea=new Q({inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"});let k=class extends Yt{constructor(e,t){super(e,t),this._activeTabFocusRequested=!1,this._awaitingServerResponse=!1,this._exportedFileNameMap={},this._selectedTab=x.layout,this._pendingExportScroll=!1,this._rootNode=null,this._selectedLayout=null,this._abortController=null,this._showTemplates=!1,this.browseTemplateButtonOnClick=null,this.exportedLinks=new Dt,this.headingLevel=3,this.messagesCommon=null,this.messagesUnits=null,this.viewModel=new Et,this._onInput=a=>{this._selectedTab===x.layout?this.templateOptions.title=a.target.value:this._selectedTab===x.mapOnly&&(this.templateOptions.fileName=a.target.value)},this._removeLink=a=>{const i=a.currentTarget["data-item"];i&&this.exportedLinks.remove(i)},this._handleLinkClick=a=>{const i=a.currentTarget["data-item"];if(!i||i.state!=="ready"||!i.url)return;const o=Oe(this.viewModel.effectivePrintServiceUrl),l=i.url,n=document.createElement("a");if(n.target="_blank",n.href=l,n.rel="noreferrer",n.download=i.formattedName??"",!o)return n.click(),void a.stopPropagation();a.preventDefault();const c=new URL(l);c.searchParams.set("token",o),n.href=c.href,n.click(),n.href=l},this._focusOnTabChange=this._focusOnTabChange.bind(this)}initialize(){this.addHandles([ee(()=>{var i;return[this.templateOptions.format,(i=this.viewModel.templatesInfo)==null?void 0:i.format.defaultValue]},([i,o])=>{if(o&&!i)return void(this.templateOptions.format=o);if(!i||!o||!this.viewModel.templatesInfo||this.viewModel.templatesInfo.format.choiceList.includes(i))return;const l=this.viewModel.templatesInfo.format.choiceList.find(n=>n.toUpperCase().includes(`(${i.toUpperCase()})`));this.templateOptions.format=l??o}),ee(()=>{var i;return[this.templateOptions.layout,(i=this.viewModel.templatesInfo)==null?void 0:i.layout.defaultValue]},async([i,o])=>{if(this._selectedTab=Fe(i)?x.mapOnly:x.layout,this._selectedTab!==x.layout)return;const{includeDefaultTemplates:l,viewModel:n,_selectedLayout:c}=this,{portalTemplateIds:p,browseTemplates:r,templatesInfo:m}=n,h=n.defaultTemplates.filter(({layoutItem:y})=>p.includes(y==null?void 0:y.id)),w=n.defaultTemplates.filter(({layoutItem:y})=>!p.includes(y==null?void 0:y.id)),O=l&&w.length;i?(O?ae(w,i):m!=null&&m.layout.choiceList.includes(i))||ae(h,i)||ae(r,i)||(this.templateOptions.layout=null,this.templateOptions.layoutItem=null):(c&&((O?ae(w,c):m!=null&&m.layout.choiceList.includes(c))||ae(h,c)||ae(r,c))?await this._applyTemplate(c):(this.templateOptions.layout=null,this.templateOptions.layoutItem=null),this.templateOptions.layout||O||!o||await this._applyTemplate(o)),this._selectedLayout=this.templateOptions.layout;const b=!!this.templateOptions.layout&&this.viewModel.effectiveTemplateCustomTextElements[this.templateOptions.layout];this.templateOptions.customTextElements=b?xe(b):null}),ee(()=>this.templateOptions.dpi,i=>{i<=0&&(this.templateOptions.dpi=1)}),ee(()=>{var i;return(i=this.viewModel.view)==null?void 0:i.scale},i=>{!i||this.templateOptions.scaleEnabled&&this.templateOptions.scale||(this.templateOptions.scale=i)})]);const{height:e,width:t}=this.templateOptions;this.templateOptions.width=t||800,this.templateOptions.height=e||1100;const a=setTimeout(()=>{this._awaitingServerResponse=!0,this.scheduleRender()},500);this.viewModel.load().then(()=>{clearTimeout(a),this._awaitingServerResponse=!1})}loadDependencies(){return Xt({action:()=>A(()=>import("./calcite-action-DqS7UojZ.js"),__vite__mapDeps([163,164,165,3,4,5,14,15,11,10,1,2,8,9,110,166,167,168,169,170,171,172,173,174,175]),import.meta.url),block:()=>A(()=>import("./calcite-block-MHbn6ZJN.js"),__vite__mapDeps([176,165,3,4,5,14,15,11,10,1,2,8,9,110,177,171,166,167,169,170,173,178,168,179,164,172,174,175,180,181,182,183,184,185,186,187,188]),import.meta.url),button:()=>A(()=>import("./calcite-button-D_QRw8fR.js"),__vite__mapDeps([189,190,165,3,4,5,14,15,11,10,1,2,8,9,110,191,166,167,192,172,168,169,170,171,173,174,175]),import.meta.url),checkbox:()=>A(()=>import("./calcite-checkbox-y1r16Xxb.js"),__vite__mapDeps([193,165,3,4,5,14,15,11,10,1,2,8,9,110,166,191,167,170,192,172,168]),import.meta.url),combobox:()=>A(()=>import("./calcite-combobox-B2IVQtjl.js"),__vite__mapDeps([194,195,165,3,4,5,14,15,11,10,1,2,8,9,110,196,197,184,166,183,191,167,192,172,168,169,170,171,179,173,198,199,200,174,201,177,202]),import.meta.url),"combobox-item":()=>A(()=>import("./calcite-combobox-item-rCxbU9jk.js"),__vite__mapDeps([203,201,165,3,4,5,14,15,11,10,1,2,8,9,110,177,171,166,167,199,172,174]),import.meta.url),flow:()=>A(()=>import("./calcite-flow-CrhM5qTo.js"),__vite__mapDeps([204,165,3,4,5,14,15,11,10,1,2,8,9,110,171,168]),import.meta.url),"flow-item":()=>A(()=>import("./calcite-flow-item-M0Vz-xgS.js"),__vite__mapDeps([205,165,3,4,5,14,15,11,10,1,2,8,9,110,166,167,168,169,170,171,173,206,180,181,164,172,174,175,182,183,184,185,179,178,186,188]),import.meta.url),icon:()=>A(()=>import("./calcite-icon-CocWVhPd.js"),__vite__mapDeps([207,174,165,3,4,5,14,15,11,10,1,2,8,9,110,166,171]),import.meta.url),input:()=>A(()=>import("./calcite-input-EEDQOvVg.js"),__vite__mapDeps([208,209,165,3,4,5,14,15,11,10,1,2,8,9,110,166,191,167,170,192,172,168,169,171,173,198,210,174,202,211]),import.meta.url),label:()=>A(()=>import("./calcite-label-CI84R5fD.js"),__vite__mapDeps([212,165,3,4,5,14,15,11,10,1,2,8,9,110,192,166,172]),import.meta.url),list:()=>A(()=>import("./calcite-list-C9DJsIWv.js"),__vite__mapDeps([213,165,3,4,5,14,15,11,10,1,2,8,9,110,166,167,171,214,215,168,173,169,170,197,184,174,209,191,192,172,198,210,202,211,175,188]),import.meta.url),"list-item":()=>A(()=>import("./calcite-list-item-D17u9P-_.js"),__vite__mapDeps([216,165,3,4,5,14,15,11,10,1,2,8,9,110,166,167,169,170,171,173,168,215,214,164,172,174,175,187]),import.meta.url),loader:()=>A(()=>import("./calcite-loader-DxqUpD6Z.js"),__vite__mapDeps([217,175,165,3,4,5,14,15,11,10,1,2,8,9,110,166,169,170,171]),import.meta.url),switch:()=>A(()=>import("./calcite-switch-BZCweZXi.js"),__vite__mapDeps([218,219,165,3,4,5,14,15,11,10,1,2,8,9,110,166,191,167,170,192,172,168]),import.meta.url),chip:()=>A(()=>import("./calcite-chip-DEpR5R9e.js"),__vite__mapDeps([220,200,165,3,4,5,14,15,11,10,1,2,8,9,110,166,168,173,169,170,171,167,172,174]),import.meta.url)})}destroy(){this.viewModel.destroy()}get allowedFormats(){return this.viewModel.allowedFormats}set allowedFormats(e){this.viewModel.allowedFormats=e}get allowedLayouts(){return this.viewModel.allowedLayouts}set allowedLayouts(e){this.viewModel.allowedLayouts=e}get error(){return this.viewModel.error}get extraParameters(){return this.viewModel.extraParameters}set extraParameters(e){this.viewModel.extraParameters=e}get icon(){return"print"}set icon(e){this._overrideIfSome("icon",e)}get includeDefaultTemplates(){return this.viewModel.includeDefaultTemplates}set includeDefaultTemplates(e){this.viewModel.includeDefaultTemplates=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get portal(){return this.viewModel.portal}set portal(e){this.viewModel.portal=e}get showPrintAreaEnabled(){return this.viewModel.showPrintAreaEnabled}set showPrintAreaEnabled(e){this.viewModel.showPrintAreaEnabled=e}get printServiceUrl(){return this.viewModel.printServiceUrl}set printServiceUrl(e){this.viewModel.printServiceUrl=e}get templateCustomTextElements(){return this.viewModel.templateCustomTextElements}set templateCustomTextElements(e){this.viewModel.templateCustomTextElements=e}get templateOptions(){return this.viewModel.templateOptions}set templateOptions(e){this.viewModel.templateOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){var qe,Ke,Ze,Qe,Ye,Xe,et,tt,it,at;const{messages:e,templateOptions:t,viewModel:a,view:i}=this,{attributionEnabled:o,author:l,copyright:n,dpi:c,format:p,height:r,layout:m,legendEnabled:h,northArrowEnabled:w,scaleEnabled:O,scale:b,width:y}=t,f=a.state!=="ready"||this._awaitingServerResponse||!m,g=this._renderTitleOrFileNameSection(),I=d("div",{class:v.formSectionContainer},d("calcite-label",null,e.fileFormatTitle,d("calcite-combobox",{clearDisabled:!0,label:e.formatDefaultOption,maxItems:6,placeholder:e.formatDefaultOption,selectionMode:"single-persist",onCalciteComboboxChange:({target:z})=>{this.templateOptions.format=z.selectedItems[0].value}},(Ke=(qe=a.templatesInfo)==null?void 0:qe.format)==null?void 0:Ke.choiceList.sort().map((z,Gt)=>d("calcite-combobox-item",{key:`file-format-${Gt}`,selected:z===this.templateOptions.format,textLabel:Tt(z),value:z}))))),S=d("calcite-label",{layout:"inline"},d("calcite-switch",{checked:this.showPrintAreaEnabled,onCalciteSwitchChange:z=>{this.showPrintAreaEnabled=!!z.target.checked}}),e.printPreview),P=d("div",null,d("div",{class:v.formSectionContainer},d("calcite-label",null,e.template,d("div",{class:v.templateSelectContainer,onclick:()=>{this._showTemplates=!0}},d("calcite-block",{class:v.templateSelectBlock,description:this._getPageSizeLabel(m),heading:this._getTemplateLabel()}),d("calcite-icon",{class:v.templateSelectIcon,icon:ei()?"chevron-left":"chevron-right",scale:"s"})))),S),L=d("div",{class:v.formSectionContainer},d("calcite-label",null,e.dpi,d("calcite-input",{bind:this,"data-input-name":"dpi",min:1,tabIndex:0,type:"number",value:`${c}`,onCalciteInputInput:this._handleDPIChange}))),T=d("div",{class:this.classes(v.scaleInfoContainer,v.formSectionContainer)},d("calcite-label",{layout:"inline"},d("calcite-checkbox",{bind:this,checked:O,"data-option-name":"scaleEnabled",tabIndex:0,onCalciteCheckboxChange:this._toggleInputValue}),e.scale),d("div",{class:v.scaleInputContainer},d("calcite-input",{"aria-label":e.scaleLabel,"aria-valuenow":`${b}`,bind:this,class:v.scaleInput,"data-input-name":"scale",disabled:!O,tabIndex:0,type:"number",value:`${b}`,onCalciteInputInput:this._updateInputValue}),d("calcite-button",{appearance:"outline","aria-label":e.reset,bind:this,disabled:!O,iconStart:"refresh",kind:"neutral",onclick:this._resetToCurrentScale,tabIndex:0}))),$=d("div",{"aria-labelledby":`${this.id}__advancedOptionsForLayout`,class:v.advancedOptionsContainer,key:"advanced-section-for-layout"},T,((Qe=(Ze=this.viewModel.layoutTemplateInfo)==null?void 0:Ze.layoutOptions)==null?void 0:Qe.hasAuthorText)??1?d("div",{class:v.formSectionContainer,key:"author-info"},d("calcite-label",null,e.author,d("calcite-input",{bind:this,"data-input-name":"author",tabIndex:0,value:l??"",onCalciteInputInput:this._updateInputValue}))):null,((Xe=(Ye=this.viewModel.layoutTemplateInfo)==null?void 0:Ye.layoutOptions)==null?void 0:Xe.hasCopyrightText)??1?d("div",{class:v.formSectionContainer,key:"copyright-text"},d("calcite-label",null,e.copyright,d("calcite-input",{bind:this,"data-input-name":"copyright",tabIndex:0,value:n??"",onCalciteInputInput:this._updateInputValue}))):null,L,this._renderCustomTextElementSection(),((tt=(et=this.viewModel.layoutTemplateInfo)==null?void 0:et.layoutOptions)==null?void 0:tt.hasLegend)??1?d("div",{class:v.formSectionContainer,key:"legend-info"},d("calcite-label",{layout:"inline"},d("calcite-checkbox",{bind:this,checked:h,"data-option-name":"legendEnabled",tabIndex:0,onCalciteCheckboxChange:this._toggleInputValue}),e.legend)):null,this.viewModel.layoutTemplateNorthArrowInfo?d("div",{class:v.formSectionContainer,key:"north-arrow"},d("calcite-label",{layout:"inline"},d("calcite-checkbox",{bind:this,checked:w,"data-option-name":"northArrowEnabled",tabIndex:0,onCalciteCheckboxChange:this._toggleInputValue}),e.northArrow)):null),F=d("div",{"aria-labelledby":`${this.id}__advancedOptionsForMapOnly`,class:v.advancedOptionsContainer},T,L,d("div",{class:v.formSectionContainer},d("calcite-label",{layout:"inline"},d("calcite-checkbox",{bind:this,checked:o,"data-option-name":"attributionEnabled",tabIndex:0,onCalciteCheckboxChange:this._toggleInputValue}),e.attribution)),this._renderCustomTextElementSection()),R=this.exportedLinks.toArray(),X=this._renderExportedLink(R),ge={[v.exportSectionCentered]:!R.length},Ft=this._selectedTab===x.layout?d("section",{"aria-labelledby":`${this.id}__layoutTab`,class:v.layoutSection,id:`${this.id}__layoutContent`,key:"esri-print__layoutContent",role:"tabpanel"},d("div",{class:v.panelContainer},((at=(it=this.viewModel.layoutTemplateInfo)==null?void 0:it.layoutOptions)==null?void 0:at.hasTitleText)??1?g:null,P,this._selectedTab===x.layout?I:null,d("calcite-block",{"aria-label":e.advancedOptions,class:this.classes(v.panelContainer,v.advancedOptionsSection),collapsible:!0,disabled:!m,heading:e.advancedOptions,id:"advancedOptionsForLayout",key:"advanced-options-for-layout"},$))):this._selectedTab===x.mapOnly?d("section",{"aria-labelledby":`${this.id}__mapOnlyTab`,class:v.mapOnlySection,id:`${this.id}__mapOnlyContent`,key:"esri-print__mapOnlyContent",role:"tabpanel"},d("div",{class:v.panelContainer},g,I,d("div",null,d("div",{class:this.classes(v.sizeContainer,v.formSectionContainer)},d("calcite-label",null,e.width,d("calcite-input",{bind:this,"data-input-name":"width",tabIndex:0,type:"number",value:`${y}`,onCalciteInputInput:this._updateInputValue})),d("calcite-label",null,e.height,d("calcite-input",{bind:this,"data-input-name":"height",tabIndex:0,type:"number",value:`${r}`,onCalciteInputInput:this._updateInputValue})),d("button",{"aria-label":e.swap,bind:this,class:this.classes(ue.widgetButton,v.swapButton,Oi.swap),onclick:this._switchInput,tabIndex:0,type:"button"})),S),d("calcite-block",{"aria-label":e.advancedOptions,class:this.classes(v.panelContainer,v.advancedOptionsSection),collapsible:!0,heading:e.advancedOptions,id:"advancedOptionsForMapOnly",key:"advanced-options-for-map-only"},F))):d("section",{"aria-labelledby":`${this.id}__exportTab`,class:this.classes(v.exportSection,ge),id:`${this.id}__exportContent`,key:"esri-print__exportContent",role:"tabpanel"},d("div",{class:v.panelContainer},d("div",{afterUpdate:this._scrollExportIntoView,bind:this,class:v.exportedFilesContainer},R.length===0?d("div",{class:v.exportedFilesEmpty},d("calcite-icon",{icon:"file",scale:"l"}),d("div",null,d(xi,{class:v.exportedFilesTitle,level:this.headingLevel},e.noExportedFiles),d("div",null,e.exportHint))):X))),At={[ue.buttonDisabled]:f||!m&&!p},ze=!i||i.type!=="2d",Nt=d("div",{class:v.panelError},ze?e.sceneViewError:e.serviceError),Vt=R.some(({state:z})=>z==="pending"),Rt=d("div",{class:v.content,key:"panel"},d("div",null,d("ul",{bind:this,class:v.layoutTabList,onclick:this._toggleLayoutPanel,onkeydown:this._handleLayoutPanelKeyDown,role:"tablist"},d("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._selectedTab===x.layout}`,class:v.layoutTab,"data-tab-id":x.layout,id:`${this.id}__layoutTab`,role:"tab",tabIndex:0},e.layoutTab),d("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._selectedTab===x.mapOnly}`,class:v.layoutTab,"data-tab-id":x.mapOnly,id:`${this.id}__mapOnlyTab`,role:"tab",tabIndex:0},e.mapOnlyTab),d("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._selectedTab===x.export}`,class:v.layoutTab,"data-tab-id":x.export,id:`${this.id}__exportedFilesTab`,role:"tab",tabIndex:0},Vt?d("calcite-loader",{inline:!0,label:"loading",scale:"s"}):null,e.exportsTab)),Ft),this._selectedTab!==x.export?d("button",{"aria-label":e.exportDescription,bind:this,class:this.classes(v.printButton,ue.button,At),disabled:f,onclick:this._handlePrintMap,tabIndex:0,type:"button"},e.export):null),Ut=d("calcite-flow",{key:"root-flow"},d("calcite-flow-item",{bind:this,key:"root-flow-item"},d("div",{class:v.printWidgetContainer},d("header",{class:v.headerTitle},e.export),this.error||ze||!i?Nt:Rt)),this._renderChooseTemplateFlowItem()),We=a.state==="initializing",jt=We?this._renderLoader():Ut,Jt={[v.panelItemsCentered]:We};return d("div",{bind:this,class:this.classes(v.base,ue.widget,ue.panel,Jt)},jt)}_getPageSizeLabel(e){if(!e)return;const t=this.viewModel.getLayoutTemplateInfo(e);if(!t)return;const a=Ea.fromJSON(t.pageUnits.toLowerCase());return`${ot(t.pageSize[0])} x ${ot(t.pageSize[1])} ${zt(this.messagesUnits,a,"abbr")}`}_getTemplateLabel(){var n;const{messages:e,includeDefaultTemplates:t,templateOptions:a,viewModel:i}=this,{layout:o}=a,l=o?(t?i.defaultTemplates.find(({layoutItem:c,layout:p})=>o===(c==null?void 0:c.id)||o===p):null)??i.browseTemplates.find(({layoutItem:c})=>o===(c==null?void 0:c.id)):null;return((n=l==null?void 0:l.label)==null?void 0:n.replaceAll("_"," "))??e[o]??(o==null?void 0:o.replaceAll("_"," "))??e.selectTemplate}_renderChooseTemplateFlowItem(){var O,b;if(!this._showTemplates)return null;const{includeDefaultTemplates:e,messages:t,viewModel:a}=this,{defaultTemplates:i,templatesInfo:o,browseTemplates:l,portalTemplateIds:n}=a,c=gt.test((O=this.portal)==null?void 0:O.url),p=l.length?l.toArray().sort((y,f)=>(y.label??"")>(f.label??"")?1:-1).map((y,f)=>{var P,L,T;const g=((P=y.layoutItem)==null?void 0:P.id)??y.layout,I=this._getPageSizeLabel(g),S=g===this.templateOptions.layout;return d("calcite-list-item",{description:I,key:`browse-template-${f}`,label:((L=y==null?void 0:y.label)==null?void 0:L.replaceAll("_"," "))??t.untitled,selected:S,title:y.description??"",value:g},!I&&S&&((T=y.layoutItem)!=null&&T.id)?d("calcite-loader",{inline:!0,key:`browse-template-loader-${f}`,label:"loading",scale:"s",slot:"content-end"}):null,d("calcite-action",{icon:"trash",onclick:()=>a.removePortalTemplate(y),slot:"actions-end",text:"delete"}))}):null,r=i.length&&e?i.toArray().filter(({label:y,layoutItem:f})=>!Fe(y)&&n.includes(f==null?void 0:f.id)).map((y,f)=>{var P,L,T;const g=((P=y.layoutItem)==null?void 0:P.id)??y.layout,I=this._getPageSizeLabel(g),S=g===this.templateOptions.layout;return d("calcite-list-item",{description:I,key:`portal-template-${g}-${S}`,label:((L=y==null?void 0:y.label)==null?void 0:L.replaceAll("_"," "))??t.untitled,selected:S,title:y.description??"",value:g},!I&&S&&((T=y.layoutItem)!=null&&T.id)?d("calcite-loader",{inline:!0,key:`portal-template-loader-${f}`,label:"loading",scale:"s",slot:"content-end"}):null)}):null,m=i.length&&e?i.toArray().filter(({label:y,layoutItem:f})=>!Fe(y)&&!n.includes(f==null?void 0:f.id)).sort((y,f)=>(y.label??"")>(f.label??"")?1:-1).map((y,f)=>{var P,L,T;const g=((P=y.layoutItem)==null?void 0:P.id)??y.layout,I=this._getPageSizeLabel(g),S=g===this.templateOptions.layout;return d("calcite-list-item",{description:I,key:`default-template-${f}`,label:((L=y==null?void 0:y.label)==null?void 0:L.replaceAll("_"," "))??t.untitled,selected:S,title:y.description??"",value:g},!I&&S&&((T=y.layoutItem)!=null&&T.id)?d("calcite-loader",{inline:!0,key:`default-template-loader-${f}`,label:"loading",scale:"s",slot:"content-end"}):null)}):null,h=!((b=o==null?void 0:o.layout)!=null&&b.choiceList.length)||e&&(m!=null&&m.length)?null:o.layout.choiceList.map(y=>({label:t[y]??y.replaceAll("_"," "),value:y})).sort((y,f)=>y.label>f.label?1:0).map(({label:y,value:f},g)=>d("calcite-list-item",{description:this._getPageSizeLabel(f),key:`service-template-${g}`,label:y,selected:f===this.templateOptions.layout,value:f})),w=((p==null?void 0:p.length)??0)+((r==null?void 0:r.length)??0)+((m==null?void 0:m.length)??0)+((h==null?void 0:h.length)??0)>15;return d("calcite-flow-item",{bind:this,closable:!1,heading:t.chooseTemplate,key:"template-flow-item",onCalciteFlowItemBack:y=>{y.preventDefault(),this._showTemplates=!1}},d("div",{class:v.templateSelectFlowItemContainer},d("div",{class:v.templateSelectFlowItemContent},this.browseTemplateButtonOnClick?d("calcite-button",{appearance:"outline",class:v.browseTemplateButtonContainer,key:"browse-template-button",onclick:this.browseTemplateButtonOnClick},"Browse Templates"):null,d("calcite-list",{filterEnabled:w,key:"template-list",selectionMode:"single-persist",onCalciteListChange:({target:y})=>this._applyTemplate(y.selectedItems[0].value)},p!=null&&p.length?d("div",{key:"my-templates"},d("div",{class:v.templateSelectFlowItemListHeading},t.myTemplates,d("calcite-chip",{appearance:"outline",kind:"neutral",scale:"s",value:t.beta},t.beta)),p):null,r!=null&&r.length?d("div",{key:"org-templates"},d("div",{class:v.templateSelectFlowItemListHeading},t.organizationTemplates,c?d("calcite-chip",{appearance:"outline",kind:"neutral",scale:"s",value:t.beta},t.beta):null),r):null,p!=null&&p.length||r!=null&&r.length?m!=null&&m.length?d("div",{key:"default-templates"},d("div",{class:v.templateSelectFlowItemListHeading},t.defaultTemplates),m):null:m,p!=null&&p.length||r!=null&&r.length?h!=null&&h.length?d("div",{key:"service-templates"},d("div",{class:v.templateSelectFlowItemListHeading},t.defaultTemplates),h):null:h)),d("div",{class:v.templateButtonContainer},d("calcite-button",{class:v.templateDoneButton,onclick:()=>this._showTemplates=!1},this.messagesCommon.done))))}_renderCustomTextElementSection(){const{customTextElements:e}=this.templateOptions;return e?d("div",{class:v.formSectionContainer,key:"custom-text-elements"},e.map((t,a)=>{const[i,o]=Object.entries(t)[0];return i==="date"?null:d("calcite-label",{key:`custom-text-elements-${i}-${a}`},i,d("calcite-input",{bind:this,"data-input-custom":!0,"data-input-name":i,value:o??"",onCalciteInputInput:this._updateInputValue}))})):null}async _applyTemplate(e){var r,m;if(this._abortController&&(this._abortController.abort(),this._abortController=null),!e)return;const t=this.viewModel.defaultTemplates.find(({layoutItem:h})=>e===(h==null?void 0:h.id))??this.viewModel.browseTemplates.find(({layoutItem:h})=>e===(h==null?void 0:h.id));if(!t)return this.templateOptions.layout=e,void(this.templateOptions.layoutItem=null);const{layoutItem:a}=t,i=t.format??this.templateOptions.format,o=(a==null?void 0:a.id)??t.layout??this.templateOptions.layout;if(this.templateOptions.layout=o,!t.layoutOptions)try{this._abortController=new AbortController,await this.viewModel.fetchLayoutTemplateInfo(t,{signal:this._abortController.signal})}catch{return}finally{this._abortController=null}const l=((r=t.layoutOptions)==null?void 0:r.legend)??this.templateOptions.legendEnabled,n=((m=t.layoutOptions)==null?void 0:m.northArrow)??this.templateOptions.northArrowEnabled,c=o?this.viewModel.effectiveTemplateCustomTextElements[o]:null,p=c?xe(c):null;this.templateOptions.set({customTextElements:p,format:i,layout:o,layoutItem:a,legendEnabled:l,northArrowEnabled:n})}_renderTitleOrFileNameSection(){const{title:e,fileName:t,titlePlaceHolder:a,fileNamePlaceHolder:i}=this.messages,o=this._selectedTab===x.layout?e:t,l=this._selectedTab===x.layout?a:i,n=this._selectedTab===x.layout?this.templateOptions.title:this.templateOptions.fileName;return d("div",{class:v.formSectionContainer,key:o},d("calcite-label",null,o,d("calcite-input",{placeholder:l,value:n??"",onCalciteInputInput:this._onInput})))}_focusOnTabChange(e){if(!this._activeTabFocusRequested)return;const t=e.getAttribute("data-tab-id");(t==="layoutTab"&&this._selectedTab===x.layout||t==="mapOnlyTab"&&this._selectedTab===x.mapOnly||t==="exportTab"&&this._selectedTab===x.export)&&(e.focus(),this._activeTabFocusRequested=!1)}_renderLoader(){const e={[v.loader]:this._awaitingServerResponse};return d("div",{class:this.classes(e),key:"loader"})}_createFileLink(e,t){const a=t||this.messages.untitled,i=e.format.toLowerCase(),o=i.includes("png")?"png":i,l=a+o;return this._exportedFileNameMap[l]!==void 0?this._exportedFileNameMap[l]++:this._exportedFileNameMap[l]=0,new It({name:a,extension:o,count:this._exportedFileNameMap[l]})}_resetToCurrentScale(){var e;this.templateOptions.scale=(e=this.viewModel.view)==null?void 0:e.scale}_updateCustomTextElementValue(e,t,a){e.find(i=>{const[o]=Object.entries(i)[0];return o===t})[t]=a}_updateInputValue(e){const t=e.target,a=t.getAttribute("data-input-name"),i=!!t["data-input-custom"],{templateOptions:o}=this;if(i)return void this._updateCustomTextElementValue(o.customTextElements,a,t.value);let l;if(t.type==="number"){const n=Number(t.value);if(!Ca(n)){const c=o[a];return void(t.value=`${c}`)}l=n}else l=t.value;o[a]=l}_handleDPIChange(e){const{templateOptions:t}=this,a=t.dpi;this._updateInputValue(e);const i=t.dpi,{height:o,width:l}=Pa(i,a,t.width,t.height);t.height=o,t.width=l}_handlePrintMap(){var o;this._pendingExportScroll=!0;const{templateOptions:e}=this,t=this.viewModel.toPrintTemplate(e),a=this._selectedTab===x.layout?(o=t.layoutOptions)==null?void 0:o.titleText:e.fileName,i=this._createFileLink(t,a);this.exportedLinks.add(i),this.emit("submit",{link:i}),this._selectedTab=x.export,this.viewModel.print(t).then(l=>{i.set({url:l&&l.url,state:"ready"})}).catch(l=>{i.set({error:l,state:"error"})}).then(()=>{this.emit("complete",{link:i}),this.scheduleRender()})}_switchInput(){[this.templateOptions.width,this.templateOptions.height]=[this.templateOptions.height,this.templateOptions.width]}_scrollExportIntoView(){if(!this._pendingExportScroll)return;this._pendingExportScroll=!1;const e=this._rootNode;if(!e)return;const{clientHeight:t,scrollHeight:a}=e,i=a-t;i>0&&(e.scrollTop=i)}_toggleInputValue(e){const t=e.target,a=t.getAttribute("data-option-name");this.templateOptions[a]=t.checked,a==="scaleEnabled"&&this._resetToCurrentScale()}_renderExportedLink(e){const t=this.messages,a=e.map(i=>{const{error:o,url:l,state:n}=i,c=i.formattedName??"",p=n==="error",r=n==="pending",m=n==="ready";let h=l||null;h&&(h=qt(h));const w=Kt(l,location.href);let O;O=r?t.pending:m?t.ready:t.errorMessage;const b=p?(o==null?void 0:o.name)==="print-task:cim-symbol-unsupported"?t.exportWebMapCIMError:t.exportWebMapError:"";return d("calcite-list-item",{"aria-label":O,class:v.exportedFile,"data-item":i,description:r?t.generatingExport:b||(w?t.ready:t.linkReady),key:c,label:c,title:b,onCalciteListItemSelect:this._handleLinkClick},r?d("calcite-loader",{class:v.exportedFileLoader,inline:!0,key:`${c}-loader`,label:t.generatingExport,scale:"m",slot:"content-start"}):d("calcite-icon",{icon:ka(i),key:`${c}-start-icon`,scale:"s",slot:"content-start"}),m?d("calcite-icon",{"aria-label":`${c}. ${t.linkReady}`,icon:w?"download-to":"launch",key:`${c}-end-icon`,scale:"s",slot:"content-end"}):null,r?null:d("calcite-action",{"aria-label":`${b}`,"data-item":i,icon:"x",key:`${c}-action`,onclick:this._removeLink,slot:"actions-end",text:`${b}`}))});return d("calcite-list",{filterEnabled:(e==null?void 0:e.length)>10},a)}_toggleLayoutPanel(e){const t=e.target;this._toggleTab(t.getAttribute("data-tab-id"))}_toggleTab(e,t=!0){var a,i;if(this._selectedTab=e,this._selectedTab===x.mapOnly)this.templateOptions.layout=Mt,this.templateOptions.layoutItem=null,this.templateOptions.customTextElements=null;else if(this._selectedTab===x.layout){const o=this._selectedLayout??(this.includeDefaultTemplates&&this.viewModel.defaultTemplates.length?null:(i=(a=this.viewModel.templatesInfo)==null?void 0:a.layout)==null?void 0:i.defaultValue);o?this._applyTemplate(o):(this.templateOptions.layout=null,this.templateOptions.layoutItem=null,this.templateOptions.customTextElements=null)}t&&(this._activeTabFocusRequested=!0)}_handleLayoutPanelKeyDown(e){const{key:t}=e,a=e.target.getAttribute("data-tab-id");if(ti(t))return this._toggleTab(a),e.preventDefault(),void e.stopPropagation();if(t==="ArrowLeft"||t==="ArrowRight"){switch(a){case x.layout:this._toggleTab(t==="ArrowLeft"?x.export:x.mapOnly);break;case x.mapOnly:this._toggleTab(t==="ArrowLeft"?x.layout:x.export);break;case x.export:this._toggleTab(t==="ArrowLeft"?x.mapOnly:x.layout)}e.preventDefault(),e.stopPropagation()}}};s([u()],k.prototype,"_showTemplates",void 0),s([u()],k.prototype,"allowedFormats",null),s([u()],k.prototype,"allowedLayouts",null),s([u()],k.prototype,"browseTemplateButtonOnClick",void 0),s([u()],k.prototype,"error",null),s([u({type:Dt})],k.prototype,"exportedLinks",void 0),s([u()],k.prototype,"extraParameters",null),s([u()],k.prototype,"headingLevel",void 0),s([u()],k.prototype,"icon",null),s([u()],k.prototype,"includeDefaultTemplates",null),s([u()],k.prototype,"label",null),s([u(),De("esri/widgets/Print/t9n/Print")],k.prototype,"messages",void 0),s([u(),De("esri/t9n/common")],k.prototype,"messagesCommon",void 0),s([u(),De("esri/core/t9n/Units")],k.prototype,"messagesUnits",void 0),s([u()],k.prototype,"portal",null),s([u()],k.prototype,"showPrintAreaEnabled",null),s([u()],k.prototype,"printServiceUrl",null),s([u()],k.prototype,"templateCustomTextElements",null),s([u()],k.prototype,"templateOptions",null),s([u()],k.prototype,"view",null),s([u({type:Et})],k.prototype,"viewModel",void 0),k=s([V("esri.widgets.Print")],k);const pl=k;export{pl as default};
