import{r as B,o as Q}from"./mathUtils-Cfq9PL9W.js";import{p as yt,o as pt,l as V,m as At,x as Tt}from"./mat4-Fi6iAz29.js";import{e as ft}from"./mat4f64-Dk4dwAN8.js";import{r as wt,_ as T}from"./vec2-ChnYg_BJ.js";import{n as Nt,t as z}from"./vec2f64-Dy6m9Nrb.js";import{o as v,I as m,A as W,g as X,E as L,u as vt,s as Y}from"./vec32-Dvg_eL9J.js";import{n as w,r as d,t as $t}from"./vec3f64-BLpZdpfb.js";import{l as J}from"./ViewingMode-Dodu7ZZk.js";import{m as A}from"./SunCalc-uwgdo0BB.js";import{v as Mt}from"./mathUtils-BgCEaV43.js";import{r as Z}from"./Accessor-BmwT4B0c.js";import{a as Ot,i as tt}from"./ShaderTechniqueConfiguration-D4dZMCXS.js";const c={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};class x{constructor(o,a){this.direct=o,this.ambient=a}}function Kt(t,o,a,e,n,i){v(i.ambient.color,1,1,1),i.ambient.intensity=c.global.ambient,v(i.direct.color,1,1,1),i.direct.intensity=c.global.direct;const u=o[2],s=B((Math.abs(u)-c.local.altitude)/(c.global.altitude-c.local.altitude),0,1);let g;if(i.globalFactor=s,t!=null&&(g=A.getTimes(t,o[1],o[0])),s<1){let l;if(t!=null)l=Pt(t,g,e);else{const p=bt(e);l={direct:{intensity:c.local.directAtNoon*p.direct,color:d(1,1,1)},ambient:{intensity:c.local.ambientAtNoon*p.ambient,color:d(1,1,1)},timeOfDay:"early afternoon"}}m(i.ambient.color,l.ambient.color,i.ambient.color,s),i.ambient.intensity=Q(l.ambient.intensity,i.ambient.intensity,s),m(i.direct.color,l.direct.color,i.direct.color,s),i.direct.intensity=Q(l.direct.intensity,i.direct.intensity,s),i.specularStrength=e==="rainy"||e==="snowy"||e==="foggy"?0:1,i.environmentStrength=e==="rainy"?.7:e==="snowy"||e==="foggy"?.75:1}i.noonFactor=t!=null?It(t,g):1,t!=null?ht(t,o,a,i.direct.directionToLightSource):xt(n,a,i.direct.directionToLightSource)}function xt(t,o,a){o===J.Global?W(H,t.eye):v(H,0,0,1),X(_,t.viewForward,-1);const e=Mt(_,H),n=Math.max(e-2*F,0),i=.85*n/(n+1),u=Math.max(F,e-F-i);yt(dt,-u,t.viewRight),L(a,_,dt),vt(a,a,X(St,t.viewRight,Dt)),W(a,a)}function ht(t,o,a,e){const n=Gt,i=pt(zt);if(a===J.Global)A.getPosition(t,0,0,n),v(e,0,0,-1),V(i,i,-n.azimuth),At(i,i,-n.altitude),L(e,e,i);else{const u=c.planarDirection,s=u.globalAngles,g=o[2];let l=(Math.abs(g)-u.localAltitude)/(u.globalAltitude-u.localAltitude);l=B(l,0,1),l<1?(A.getPosition(t,o[1],o[0],n),n.azimuth=(1-l)*n.azimuth+l*s.azimuth,n.altitude=(1-l)*n.altitude+l*s.altitude):(n.azimuth=s.azimuth,n.altitude=s.altitude),v(e,0,-1,0),Tt(i,i,-n.azimuth),V(i,i,-n.altitude),L(e,e,i)}}function Qt(t,o){if(o===J.Global)return!0;const a=c.planarDirection;return Math.abs(t)<a.localAltitude}function Vt(t,o,a,e,n){const i=t.getTime(),u=o.getTime()-i,s=Math.floor(u/a)+1,g=new Array(s);for(let l=0;l<s;++l)mt.setTime(i+a*l),g[l]=w(),ht(mt,e,n,g[l]);return g}const Et=d(.5773502691896258,-.5773502691896258,.5773502691896258);class Wt{constructor(){this.ambient={color:d(1,1,1),intensity:.55},this.direct={color:d(1,1,1),intensity:.55,directionToLightSource:$t(Et)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const zt=ft(),Gt={azimuth:0,altitude:0};function It(t,o){const a=t.valueOf();let e,n;o.polarException===A.PolarException.MIDNIGHT_SUN?(e=a-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=e+432e6):o.polarException===A.PolarException.POLAR_NIGHT?(e=a-2,n=a-1):(e=o.sunrise.valueOf(),n=o.sunset.valueOf());const i=e+(n-e)/2;return 1-B(Math.abs(a-i)/432e5,0,1)}function bt(t){switch(t){case"disabled":case"sunny":case"cloudy":return new x(1,1);case"rainy":return new x(.4,1.2);case"snowy":return new x(.5,1.3);case"foggy":return new x(.2,1.6)}}function et(t,o){const a=(t[0]+t[1]+t[2])/3;t[0]+=(a-t[0])*o,t[1]+=(a-t[1])*o,t[2]+=(a-t[2])*o}const P=d(.01,.01,.01),U=d(1,.6,.5),R=d(1,.98,.98),it=d(1,1,1),S=d(.8,.8,1),C=d(.8,.8,1),j=d(.98,.98,1),nt=d(1,1,1),D=z(.01,c.local.ambientAtNight),k=z(c.local.directAtTwilight,c.local.ambientAtTwilight),q=z(.9*c.local.directAtNoon,c.local.ambientAtNoon),ot=z(c.local.directAtNoon,c.local.ambientAtNoon),at=q,lt=R,rt=j,st=k,ct=U,ut=C;function Pt(t,o,a){const e=t.valueOf();let n,i;o.polarException===A.PolarException.MIDNIGHT_SUN?(n=e-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,i=n+432e6):o.polarException===A.PolarException.POLAR_NIGHT?(n=e-2,i=e-1):(n=o.sunrise.valueOf(),i=o.sunset.valueOf());const u=i-n,s=n+u/2,g=u/4,l=s-g,p=s+g,$=.06*u,G=n-$/2,M=n+$/2,O=i-$/2,I=i+$/2,f=Nt(),h=w(),b=w();let y="";if(e<G||e>I)wt(f,D),Y(h,P),Y(b,S),y="night";else if(e<M){const r=(e-G)/(M-G);T(f,D,k,r),m(h,P,U,r),m(b,S,C,r),y="sun rising"}else if(e<l){const r=(e-M)/(l-M);T(f,k,q,r),m(h,U,R,r),m(b,C,j,r),y="early morning"}else if(e<s){const r=(e-l)/(s-l);T(f,q,ot,r),m(h,R,it,r),m(b,j,nt,r),y="late morning"}else if(e<p){const r=(e-s)/(p-s);T(f,ot,at,r),m(h,it,lt,r),m(b,nt,rt,r),y="early afternoon"}else if(e<O){const r=(e-p)/(O-p);T(f,at,st,r),m(h,lt,ct,r),m(b,rt,ut,r),y="late afternoon"}else if(e<I){const r=(e-O)/(I-O);T(f,st,D,r),m(h,ct,P,r),m(b,ut,S,r),y="sun setting"}let N=0;switch(a){case"rainy":case"foggy":N=.8;break;case"snowy":N=.5}N>0&&(et(h,N),et(b,N));const K=bt(a);return{direct:{intensity:f[0]*K.direct,color:h},ambient:{intensity:f[1]*K.ambient,color:b},timeOfDay:y}}const mt=new Date(0),dt=ft(),H=w(),_=w(),St=w(),F=.25,Dt=.2;var E;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(E||(E={}));class gt extends Ot{constructor(){super(...arguments),this.visualization=E.Gradient,this.bandsEnabled=!1}}Z([tt({count:E.COUNT})],gt.prototype,"visualization",void 0),Z([tt()],gt.prototype,"bandsEnabled",void 0);export{Vt as D,Wt as I,xt as O,Kt as j,gt as r,E as t,Qt as z};
