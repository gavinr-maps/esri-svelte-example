import{s as j,B as en,q as sn}from"./Accessor-BHnuXKD2.js";import{k as un,D as ln}from"./aaBoundingBox-CeBivBRq.js";import{b as cn}from"./Polyline-BmuD2-ZN.js";import{l as fn,y as an,s as hn,u as dn}from"./jsonUtils-Cu7OBRmN.js";import{s as v}from"./OptimizedFeature-DcMLlxvB.js";import{e as mn}from"./OptimizedFeatureSet-Blu9Ckm7.js";import{e as I}from"./OptimizedGeometry-7IxBWtHr.js";function b(n,r){return n?r?4:3:r?3:2}const z=()=>en.getLogger("esri.layers.graphics.featureConversionUtils"),Y={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},gn=(n,r,o,t,s,e)=>{n[o]=s,n[o+1]=e},B=(n,r,o,t,s,e)=>{n[o]=s,n[o+1]=e,n[o+2]=r[t+2]},yn=(n,r,o,t,s,e)=>{n[o]=s,n[o+1]=e,n[o+2]=r[t+3]},pn=(n,r,o,t,s,e)=>{n[o]=s,n[o+1]=e,n[o+2]=r[t+2],n[o+3]=r[t+3]};function _(n,r,o,t){if(n){if(o)return r&&t?pn:B;if(r&&t)return yn}else if(r&&t)return B;return gn}function q({scale:n,translate:r},o){return Math.round((o-r[0])/n[0])}function L({scale:n,translate:r},o){return Math.round((r[1]-o)/n[1])}function U({scale:n,translate:r},o){return Math.round((o-r[0])/n[0])}function R({scale:n,translate:r},o){return Math.round((o-r[1])/n[1])}function S({scale:n,translate:r},o,t){return o*n[t]+r[t]}function Dn(n,r,o){return n?r?o?D(n):A(n):o?C(n):E(n):null}function E(n){const r=n.coords;return{x:r[0],y:r[1]}}function K(n,r){return n.coords[0]=r.x,n.coords[1]=r.y,n}function A(n){const r=n.coords;return{x:r[0],y:r[1],z:r[2]}}function bn(n,r){return n.coords[0]=r.x,n.coords[1]=r.y,n.coords[2]=r.z,n}function C(n){const r=n.coords;return{x:r[0],y:r[1],m:r[2]}}function wn(n,r){return n.coords[0]=r.x,n.coords[1]=r.y,n.coords[2]=r.m,n}function D(n){const r=n.coords;return{x:r[0],y:r[1],z:r[2],m:r[3]}}function Mn(n,r){return n.coords[0]=r.x,n.coords[1]=r.y,n.coords[2]=r.z,n.coords[3]=r.m,n}function Gn(n,r,o,t){let s=E;o&&t?s=D:o?s=A:t&&(s=C);for(const e of r){const{geometry:u,attributes:l}=e,i=u!=null?s(u):null;n.push({attributes:l,geometry:i})}return n}function O(n,r){return n&&r?Mn:n?bn:r?wn:K}function In(n,r,o,t,s){const e=O(o,t);for(const{geometry:u,attributes:l}of r){const i=u!=null?e(new I,u):null;n.push(new v(i,l,null,s?l[s]:void 0))}return n}function Nn(n,r,o=O(r.z!=null,r.m!=null)){return o(n,r)}function Tn(n,r,o,t){for(const{geometry:s,attributes:e}of r)n.push({attributes:e,geometry:s!=null?Q(s,o,t):null});return n}function Q(n,r,o){if(n==null)return null;const t=b(r,o),s=[];for(let e=0;e<n.coords.length;e+=t){const u=[];for(let l=0;l<t;l++)u.push(n.coords[e+l]);s.push(u)}return r?o?{points:s,hasZ:r,hasM:o}:{points:s,hasZ:r}:o?{points:s,hasM:o}:{points:s}}function Pn(n,r,o,t,s){const e=b(o,t);for(const{geometry:u,attributes:l}of r){const i=u!=null?W(new I,u,e):null;n.push(new v(i,l,null,s?l[s]:void 0))}return n}function W(n,r,o=b(r.hasZ,r.hasM)){n.lengths[0]=r.points.length;const t=n.coords;let s=0;for(const e of r.points)for(let u=0;u<o;u++)t[s++]=e[u];return n}function Fn(n,r,o,t){for(const{geometry:s,attributes:e}of r)n.push({attributes:e,geometry:s!=null?X(s,o,t):null});return n}function X(n,r,o){if(!n)return null;const t=b(r,o),{coords:s,lengths:e}=n,u=[];let l=0;for(const i of e){const c=[];for(let f=0;f<i;f++){const a=[];for(let h=0;h<t;h++)a.push(s[l++]);c.push(a)}u.push(c)}return r?o?{paths:u,hasZ:r,hasM:o}:{paths:u,hasZ:r}:o?{paths:u,hasM:o}:{paths:u}}function Zn(n,r,o,t,s){const e=b(o,t);for(const{geometry:u,attributes:l,centroid:i}of r){const c=u!=null?$(new I,u,e):null,f=i!=null?Nn(new I,i):null;n.push(new v(c,l,f,s?l[s]:void 0))}return n}function $(n,r,o=b(r.hasZ,r.hasM)){const{lengths:t,coords:s}=n;let e=0;for(const u of r.paths){for(const l of u)for(let i=0;i<o;i++)s[e++]=l[i];t.push(u.length)}return n}function xn(n,r,o,t){for(const{geometry:s,attributes:e,centroid:u}of r){const l=s!=null?nn(s,o,t):null;if(u!=null){const i=E(u);n.push({attributes:e,centroid:i,geometry:l})}else n.push({attributes:e,geometry:l})}return n}function nn(n,r,o){if(!n)return null;const t=b(r,o),{coords:s,lengths:e}=n,u=[];let l=0;for(const i of e){const c=[];for(let f=0;f<i;f++){const a=[];for(let h=0;h<t;h++)a.push(s[l++]);c.push(a)}u.push(c)}return r?o?{rings:u,hasZ:r,hasM:o}:{rings:u,hasZ:r}:o?{rings:u,hasM:o}:{rings:u}}function vn(n,r,o,t,s){for(const{geometry:e,centroid:u,attributes:l}of r){const i=e!=null?rn(new I,e,o,t):null,c=s?l[s]:void 0;u!=null?n.push(new v(i,l,K(new I,u),c)):n.push(new v(i,l,null,c))}return n}function rn(n,r,o=r.hasZ,t=r.hasM){return kn(n,r.rings,o,t)}function kn(n,r,o,t){const s=b(o,t),{lengths:e,coords:u}=n;let l=0;P(n);for(const i of r){for(const c of i)for(let f=0;f<s;f++)u[l++]=c[f];e.push(i.length)}return n}const x=[],k=[];function On(n,r,o,t,s){x[0]=n;const[e]=on(k,x,r,o,t,s);return N(x),N(k),e}function on(n,r,o,t,s,e){if(N(n),!o){for(const u of r){const l=e?u.attributes[e]:void 0;n.push(new v(null,u.attributes,null,l))}return n}switch(o){case"esriGeometryPoint":return In(n,r,t,s,e);case"esriGeometryMultipoint":return Pn(n,r,t,s,e);case"esriGeometryPolyline":return Zn(n,r,t,s,e);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return vn(n,r,t,s,e);default:z().error("convertToFeatureSet:unknown-geometry",new j(`Unable to parse unknown geometry type '${o}'`)),N(n)}return n}function Bn(n,r,o,t){k[0]=n,tn(x,k,r,o,t);const s=x[0];return N(x),N(k),s}function Hn(n,r,o){if(n==null)return null;const t=new I;return"hasZ"in n&&r==null&&(r=n.hasZ),"hasM"in n&&o==null&&(o=n.hasM),fn(n)?O(r??n.z!=null,o??n.m!=null)(t,n):an(n)?rn(t,n,r,o):hn(n)?$(t,n,b(r,o)):dn(n)?W(t,n,b(r,o)):void z().error("convertFromGeometry:unknown-geometry",new j(`Unable to parse unknown geometry type '${n}'`))}function jn(n,r,o,t){const s=n&&("coords"in n?n:n.geometry);if(s==null)return null;switch(r){case"esriGeometryPoint":{let e=E;return o&&t?e=D:o?e=A:t&&(e=C),e(s)}case"esriGeometryMultipoint":return Q(s,o,t);case"esriGeometryPolyline":return X(s,o,t);case"esriGeometryPolygon":return nn(s,o,t);default:return z().error("convertToGeometry:unknown-geometry",new j(`Unable to parse unknown geometry type '${r}'`)),null}}function zn(n,r){for(const o of r)n.push({attributes:o.attributes});return n}function tn(n,r,o,t,s){if(N(n),o==null)return zn(n,r);switch(o){case"esriGeometryPoint":return Gn(n,r,t,s);case"esriGeometryMultipoint":return Tn(n,r,t,s);case"esriGeometryPolyline":return Fn(n,r,t,s);case"esriGeometryPolygon":return xn(n,r,t,s);default:z().error("convertToFeatureSet:unknown-geometry",new j(`Unable to parse unknown geometry type '${o}'`))}return n}function Jn(n){const{objectIdFieldName:r,spatialReference:o,transform:t,fields:s,hasM:e,hasZ:u,features:l,geometryType:i,exceededTransferLimit:c,uniqueIdField:f,queryGeometry:a,queryGeometryType:h}=n,d={features:tn([],l,i,u,e),fields:s,geometryType:i,objectIdFieldName:r,spatialReference:o,uniqueIdField:f,queryGeometry:jn(a,h,!1,!1)};return t&&(d.transform=t),c&&(d.exceededTransferLimit=c),e&&(d.hasM=e),u&&(d.hasZ=u),d}function Kn(n,r){const o=new mn,{hasM:t,hasZ:s,features:e,objectIdFieldName:u,spatialReference:l,geometryType:i,exceededTransferLimit:c,transform:f,fields:a}=n;return a&&(o.fields=a),o.geometryType=i??null,o.objectIdFieldName=u??r??null,o.spatialReference=l??null,o.objectIdFieldName?(e&&on(o.features,e,i,s,t,o.objectIdFieldName),c&&(o.exceededTransferLimit=c),t&&(o.hasM=t),s&&(o.hasZ=s),f&&(o.transform=f),o):(z().error(new j("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),o)}function Qn(n){const{transform:r,features:o,hasM:t,hasZ:s}=n;if(!r)return n;for(const e of o)e.geometry!=null&&J(e.geometry,e.geometry,t,s,r),e.centroid!=null&&J(e.centroid,e.centroid,t,s,r);return n.transform=null,n}function Wn(n,r){const{geometryType:o,features:t,hasM:s,hasZ:e}=r;if(!n)return r;for(let u=0;u<t.length;u++){const l=t[u],i=l.weakClone();i.geometry=new I,H(i.geometry,l.geometry,s,e,o,n),l.centroid&&(i.centroid=new I,H(i.centroid,l.centroid,s,e,"esriGeometryPoint",n)),t[u]=i}return r.transform=n,r}function H(n,r,o,t,s,e,u=o,l=t){if(P(n),!(r!=null&&r.coords.length))return null;const i=Y[s],{coords:c,lengths:f}=r,a=b(o,t),h=b(o&&u,t&&l),d=_(o,t,u,l);if(!f.length)return d(n.coords,c,0,0,q(e,c[0]),L(e,c[1])),P(n,a,0),n;let m,y,w,G,p=0,g=0,M=g;for(const F of f){if(F<i)continue;let T=0;g=M,w=m=q(e,c[p]),G=y=L(e,c[p+1]),d(n.coords,c,g,p,w,G),T++,p+=a,g+=h;for(let Z=1;Z<F;Z++,p+=a)w=q(e,c[p]),G=L(e,c[p+1]),w===m&&G===y||(d(n.coords,c,g,p,w-m,G-y),g+=h,T++,m=w,y=G);T>=i&&(n.lengths.push(T),M=g)}return N(n.coords,M),n.coords.length?n:null}function Xn(n,r,o,t,s,e,u=o,l=t){if(P(n),!(r!=null&&r.coords.length))return null;const i=Y[s],{coords:c,lengths:f}=r,a=b(o,t),h=b(o&&u,t&&l),d=_(o,t,u,l);if(!f.length)return d(n.coords,c,0,0,c[0],c[1]),P(n,a,0),n;let m=0;const y=e*e;for(const w of f){if(w<i){m+=w*a;continue}const G=n.coords.length/h,p=m,g=m+(w-1)*a;d(n.coords,c,n.coords.length,p,c[p],c[p+1]),V(n.coords,c,a,y,d,p,g),d(n.coords,c,n.coords.length,g,c[g],c[g+1]);const M=n.coords.length/h-G;M>=i?n.lengths.push(M):N(n.coords,G*h),m+=w*a}return n.coords.length?n:null}function En(n,r,o,t){const s=n[r],e=n[r+1],u=n[o],l=n[o+1],i=n[t],c=n[t+1];let f=u,a=l,h=i-f,d=c-a;if(h!==0||d!==0){const m=((s-f)*h+(e-a)*d)/(h*h+d*d);m>1?(f=i,a=c):m>0&&(f+=h*m,a+=d*m)}return h=s-f,d=e-a,h*h+d*d}function V(n,r,o,t,s,e,u){let l,i=t,c=0;for(let f=e+o;f<u;f+=o)l=En(r,f,e,u),l>i&&(c=f,i=l);i>t&&(c-e>o&&V(n,r,o,t,s,e,c),s(n,r,n.length,c,r[c],r[c+1]),u-c>o&&V(n,r,o,t,s,c,u))}function $n(n,r,o,t){var c;if(!((c=r==null?void 0:r.coords)!=null&&c.length))return null;const s=b(o,t);let e=Number.POSITIVE_INFINITY,u=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY;if(r&&r.coords){const f=r.coords;for(let a=0;a<f.length;a+=s){const h=f[a],d=f[a+1];e=Math.min(e,h),l=Math.max(l,h),u=Math.min(u,d),i=Math.max(i,d)}}return un(n)?ln(n,e,u,l,i):cn(e,u,l,i,n),n}function J(n,r,o,t,s){const{coords:e,lengths:u}=r,l=b(o,t);if(!e.length)return n!==r&&P(n),n;sn(s);const{originPosition:i,scale:c,translate:f}=s,a=Un;a.originPosition=i;const h=a.scale;h[0]=c[0]??1,h[1]=-(c[1]??1),h[2]=c[2]??1,h[3]=c[3]??1;const d=a.translate;if(d[0]=f[0]??0,d[1]=f[1]??0,d[2]=f[2]??0,d[3]=f[3]??0,!u.length){for(let y=0;y<l;++y)n.coords[y]=S(a,e[y],y);return n!==r&&P(n,l,0),n}let m=0;for(let y=0;y<u.length;y++){const w=u[y];n.lengths[y]=w;for(let g=0;g<l;++g)n.coords[m+g]=S(a,e[m+g],g);let G=n.coords[m],p=n.coords[m+1];m+=l;for(let g=1;g<w;g++,m+=l){G+=e[m]*h[0],p+=e[m+1]*h[1],n.coords[m]=G,n.coords[m+1]=p;for(let M=2;M<l;++M)n.coords[m+M]=S(a,e[m+M],M)}}return n!==r&&P(n,e.length,u.length),n}function nr(n,r,o,t,s,e){if(P(n),n.lengths.push(...r.lengths),o===s&&t===e)for(let u=0;u<r.coords.length;u++)n.coords.push(r.coords[u]);else{const u=b(o,t),l=_(o,t,s,e),i=r.coords;for(let c=0;c<i.length;c+=u)l(n.coords,i,n.coords.length,c,i[c],i[c+1])}return n}function qn(n,r,o,t){let s=0,e=n[t*r],u=n[t*(r+1)];for(let l=1;l<o;l++){const i=e+n[t*(r+l)],c=u+n[t*(r+l)+1],f=(i-e)*(c+u);e=i,u=c,s+=f}return .5*s}function rr(n,r){const{coords:o,lengths:t}=n;let s=0,e=0;for(let u=0;u<t.length;u++){const l=t[u];e+=qn(o,s,l,r),s+=l}return Math.abs(e)}function Ln(n,r,o,t){return n*t-o*r===0&&n*o+r*t>0}function or(n,r,o,t,s){const e=b(t,s);if(!n.lengths.length){if(n.coords.length<2)return null;const[a,h]=n.coords,d=U(r,a),m=R(r,h);return new I([],[d,m])}const u=new I([],[0,0]),l=Y[o],i=o==="esriGeometryPolygon"||o==="esriGeometryPolyline";let c=0,f=0;for(let a=0;a<n.lengths.length;a++){const h=n.lengths[a],d=f;let m=U(r,n.coords[e*c]),y=R(r,n.coords[e*c+1]);u.coords[f++]=m,u.coords[f++]=y;let w=0,G=0,p=1;for(let g=1;g<h;g++){const M=U(r,n.coords[e*(g+c)]),F=R(r,n.coords[e*(g+c)+1]);if(M!==m||F!==y){const T=M-m,Z=F-y;i&&Ln(w,G,T,Z)?(u.coords[f-2]+=T,u.coords[f-1]+=Z,m+=T,y+=Z):(u.coords[f++]=M,u.coords[f++]=F,m=M,y=F,w=T,G=Z,p+=1)}}p<l?f=d:u.lengths.push(p),c+=h}return u.lengths.length===0?null:u}function P(n,r=0,o=0){N(n.lengths,o),N(n.coords,r)}function N(n,r=0){n.length!==r&&(n.length=r)}const Un={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]};export{X as C,or as F,rr as G,nn as K,J as M,L as N,Q as R,Nn as U,rn as W,kn as X,Qn as a,nr as b,H as d,Kn as f,Wn as h,Jn as i,Dn as j,Xn as m,on as n,On as o,$n as p,Bn as r,Hn as s,jn as u,q as w};
