import{V as k}from"./reactiveUtils-BR0C1Kq4.js";import{ac as V,ad as q,F as P,af as I,j as x,g as W,P as j,at as H,ae as A,Q as F,ag as D}from"./Point-XGrwlf63.js";import{M as Q}from"./layerUtils-dJgsXxkC.js";import{l as R}from"./ViewingMode-Dodu7ZZk.js";import{s as f}from"./Accessor-BHnuXKD2.js";import{a as O,c as B}from"./Polyline-BmuD2-ZN.js";import{s as d,m as y,A as J,S as K,q as X}from"./mathUtils-DV9iOXpW.js";import{w as Y}from"./Extent-CBBGeHb-.js";import{z as w,p as E}from"./TileInfo-CRfZy5zq.js";var o;(function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"})(o||(o={}));function Z(e){return e!=null&&"type"in e&&e.type==="vector-tile"}function ee(e){return e!=null&&"type"in e&&e.type==="raster-tile"}function te(e){return e!=null&&"type"in e&&e.type==="tile-texture"}function ie(e){return e!=null&&"type"in e&&e.type==="image+type"}function le(e){return L(e)||V(e)||q(e)}function L(e){return P(e)||I(e)}const ne=12;let S=class m{constructor(t){const i=m.checkUnsupported(t);if(i!=null)throw i;const l=t;this.spatialReference=l.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=j(this.spatialReference),this.origin=[l.origin.x,l.origin.y],this.pixelSize=l.size[0],this.dpi=l.dpi;const n=l.lods.reduce((c,u)=>(u.level<c.minLod.level&&(c.minLod=u),c.max=Math.max(c.max,u.level),c),{minLod:l.lods[0],max:-1/0}),r=n.minLod,s=2**r.level;let a=r.resolution*s,h=r.scale*s;this.levels=new Array(n.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:h,tileSize:[a*l.size[0],a*l.size[1]]},a/=2,h/=2}clone(){return new m(this.toTileInfo())}toTileInfo(){return new w({dpi:this.dpi,origin:new x({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,i)=>new E({level:i,scale:t.scale,resolution:t.resolution}))})}getExtent(t,i,l,n){const r=this.levels[t],s=r.tileSize[0],a=r.tileSize[1];n[0]=this.origin[0]+l*s,n[2]=this.origin[0]+(l+1)*s,n[3]=this.origin[1]-i*a,n[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(t,i){this._isWebMercator?(i[0]=H(t[0]),i[1]=A(t[1]),i[2]=H(t[2]),i[3]=A(t[3])):this._isGCS&&(i[0]=d(t[0]),i[1]=d(t[1]),i[2]=d(t[2]),i[3]=d(t[3]))}getExtentGeometry(t,i,l,n=new Y){return this.getExtent(t,i,l,g),n.spatialReference=this.spatialReference,n.xmin=g[0],n.ymin=g[1],n.xmax=g[2],n.ymax=g[3],n.zmin=void 0,n.zmax=void 0,n}ensureMaxLod(t){if(t==null)return!1;let i=!1;for(;this.levels.length<=t;){const{resolution:l,scale:n}=this.levels[this.levels.length-1],r=l/2*this.pixelSize;this.levels.push({resolution:l/2,scale:n/2,tileSize:[r,r]}),i=!0}return i}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const i=this.levels[0].scale;return t>=i?0:Math.log(i/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t,i=1/0){if(m.checkUnsupported(t))return!1;const l=new m(t);if(!l.spatialReference.equals(this.spatialReference)||l.pixelSize!==this.pixelSize)return!1;const n=Math.min(this.levels.length-1,l.levels.length-1,i),r=this.levels[n].resolution;let s=.5*r;return!y(l.origin[0],this.origin[0],s)||!y(l.origin[1],this.origin[1],s)?!1:(s=.5*r/2**n/this.pixelSize*ne,y(r,l.levels[n].resolution,s))}rootTilesInExtent(t,i=null,l=1/0){const n=new Array,r=this.levels[0].tileSize;if(t==null||r[0]===0||r[1]===0)return n;m.computeRowColExtent(t,r,this.origin,g);let s=g[1],a=g[3],h=g[0],c=g[2];const u=c-h,T=a-s;if(u*T>l){const p=Math.floor(Math.sqrt(l));T>p&&(s=s+Math.floor(.5*T)-Math.floor(.5*p),a=s+p),u>p&&(h=h+Math.floor(.5*u)-Math.floor(.5*p),c=h+p)}for(let p=s;p<a;p++)for(let M=h;M<c;M++)n.push([0,p,M]);return i!=null&&(i[0]=this.origin[0]+h*r[0],i[1]=this.origin[1]-a*r[1],i[2]=this.origin[0]+c*r[0],i[3]=this.origin[1]-s*r[1]),n}static computeRowColExtent(t,i,l,n){const r=.001*(t[2]-t[0]+(t[3]-t[1]));n[0]=Math.max(0,Math.floor((t[0]+r-l[0])/i[0])),n[2]=Math.max(0,Math.ceil((t[2]-r-l[0])/i[0])),n[1]=Math.max(0,Math.floor((l[1]-t[3]+r)/i[1])),n[3]=Math.max(0,Math.ceil((l[1]-t[1]-r)/i[1]))}static isPowerOfTwo(t){const i=t.lods,l=i[0].resolution*2**i[0].level;return!i.some(n=>!J(n.resolution,l/2**n.level))}static hasGapInLevels(t){const i=t.lods.map(l=>l.level);i.sort((l,n)=>l-n);for(let l=1;l<i.length;l++)if(i[l]!==i[0]+l)return!0;return!1}static tileSizeSupported(t){const i=t.size[1];return i===t.size[0]&&!(i&i-1)&&i>=128&&i<=512}static hasOriginPerLODs(t){const i=t.origin;return t.lods.some(l=>l.origin!=null&&(l.origin[0]!==i.x||l.origin[1]!==i.y))}static getMissingTileInfoError(){return new f("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return t==null?b():t.lods.length<1?new f("tilingscheme:generic","Tiling scheme must have at least one level"):m.isPowerOfTwo(t)?m.hasGapInLevels(t)?new f("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):m.tileSizeSupported(t)?m.hasOriginPerLODs(t)?new f("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new f("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new f("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,i){const l=t[2]-t[0],n=t[3]-t[1],r=F(i),s=1.2*Math.max(l,n),a=256,h=s/a,c=h*r*(96/.0254),u=new m(new w({size:[a,a],origin:new x({x:t[0]-.5*(s-l),y:t[3]+.5*(s-n)}),lods:[new E({level:0,resolution:h,scale:c})],spatialReference:i}));return u.ensureMaxLod(20),u}static makeWebMercatorAuxiliarySphere(t){const i=new m(m.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(t),i}static makeGCSWithTileSize(t,i=256,l=16){const n=256/i,r=new m(new w({size:[i,i],origin:new x({x:-180,y:90,spatialReference:t}),spatialReference:t,lods:[new E({level:0,resolution:.703125*n,scale:295497598570834e-6*n})]}));return r.ensureMaxLod(l),r}get test(){}};function b(){return new f("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}S.WebMercatorAuxiliarySphereTileInfo=new w({size:[256,256],origin:new x({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:W.WebMercator}),spatialReference:W.WebMercator,lods:[new E({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),S.WebMercatorAuxiliarySphere=S.makeWebMercatorAuxiliarySphere(19);const g=O(),z=64,He=512,Ae=2.5,ze=K(X/10),$e=2,re=O();S.WebMercatorAuxiliarySphere.getExtent(0,0,0,re);const Ie=O([-180,-90,180,90]),Le="Cannot extend surface to encompass all layers because it would result in too many root tiles.",_e="Surface extent is too large for tile resolution at level 0.",Ne=4;function oe(e,t,i,l){if(e==null)return b();const n=e.spatialReference;if(n.isGeographic&&!L(n))return new f("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=S.checkUnsupported(e);return r??(i==null?new f("tilingscheme:extent-not-exist","The layer does not provide a layer extent."):se(e,i)||(t==null||n.equals(t)||t.isWGS84&&n.isWebMercator?null:new f("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")))}function se(e,t){const i=e.lods,l=i[0].resolution*2**i[0].level,n=[l*e.size[0],l*e.size[1]],r=[e.origin.x,e.origin.y],s=B(t),a=O();S.computeRowColExtent(s,n,r,a);const h=(a[2]-a[0])*(a[3]-a[1]);if(h>z){const c=i[0].scale*2**i[0].level;let u=Math.max((s[3]-s[1])/e.size[1],(s[2]-s[0])/e.size[0])*c/l;const T=Math.floor(Math.log(u)/Math.log(10));return u=Math.ceil(u/10**T)*10**T,new f("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+u.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:u,requiredNumRootTiles:h,allowedNumRootTiles:z})}return null}const ae=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:oe},Symbol.toStringTag,{value:"Module"}));function ce(e,t,i,l){if(e==null)return b();const n=(e==null?void 0:e.lods.length)-1,r=e.spatialReference;if(r.isWebMercator){if(!S.makeWebMercatorAuxiliarySphere(n).compatibleWith(e,l))return new f("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!le(r))return new f("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!S.makeGCSWithTileSize(e.spatialReference,e.size[0],n).compatibleWith(e,l))return e.spatialReference.isWGS84?new f("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new f("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return t==null||e.spatialReference.equals(t)?null:new f("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const ue=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:ce},Symbol.toStringTag,{value:"Module"})),fe={[R.Global]:ue,[R.Local]:ae};function Ue(e,t){e||console.warn("Terrain: "+t)}let v=!1,he=!1;function Ge(e){he=e,v=v||e}function Ce(e){v=e}function ke(e,t){var i;if(v&&!e){const l=(i=new Error().stack)==null?void 0:i.slice(5);throw console.warn("Terrain internal: "+(t??"")+" at "+l),new Error("Assertion failed"+(t?": "+t:""))}}function $(e){return(e==null?void 0:e.type)==="imagery-tile"||(e==null?void 0:e.type)==="wcs"}function _(e){return(e==null?void 0:e.type)==="imagery-tile-3d"}function N(e){return(e==null?void 0:e.type)==="tile-3d"}function U(e){return(e==null?void 0:e.type)==="vector-tile-3d"}function G(e){return(e==null?void 0:e.type)==="wmts-3d"}function me(e){return(e==null?void 0:e.type)==="elevation-3d"}function Ve(e){return(e==null?void 0:e.type)==="group"}function qe(e){return e&&(N(e)||G(e)||_(e)||U(e))}function pe(e){return e&&(N(e)||_(e)||U(e)||G(e))}function Pe(e){return pe(e)||me(e)}function je(e){var t;return ee((t=e==null?void 0:e.sourceLayerInfo)==null?void 0:t.data)}function Fe(e){return ge(e==null?void 0:e.sourceLayerInfo)||!!(e!=null&&e.isVTLBackground)}function De(e){var t;return te((t=e==null?void 0:e.sourceLayerInfo)==null?void 0:t.data)}function Qe(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return ie(t)||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData}function ge(e){return Z(e==null?void 0:e.data)}function Be(e){return e!=null&&"release"in e&&e.release(),null}function Je(e){return e.fetchTile&&e.hasOverriddenFetchTile!==!1}function C(e,t,i,l,n){return fe[l].checkIfTileInfoSupportedForViewSR(e,i,t,n)}function Ke(e,t,i){var s;let l=null,n=null;if((e==null?void 0:e.type)==="wmts"){const a=Se(e,t,i);l=a.tileInfo,n=a.fullExtent}else{n=$(e)?e.getCompatibleFullExtent(t):e.fullExtent;const a=i===R.Local;$(e)?l=e.getCompatibleTileInfo(t,n,a):(e==null?void 0:e.type)==="vector-tile"?l=a&&!Te(t)||de.force512VTL?e.tileInfo:e.tileInfo.getCompatibleForVTL(256):l=e.tileInfo}const r="tilemapCache"in e?(s=e.tilemapCache)==null?void 0:s.effectiveMaxLOD:void 0;return l!=null&&n!=null&&C(l,n,t,i,r)==null?{tileInfo:l,fullExtent:n}:null}function Se(e,t,i){const l=Q(e);if(l!=null){if(!k.isCollection(l))return{tileInfo:l.tileInfo,fullExtent:l.fullExtent};{const n=l.find(r=>C(r.tileInfo,r.fullExtent,t,i)==null);if(n)return{tileInfo:n.tileInfo,fullExtent:n.fullExtent}}}return{tileInfo:null,fullExtent:null}}function Te(e){return e.isWGS84||e.isWebMercator||I(e)||!D(e)}const de={force512VTL:!1};function Xe(e){return"["+e[0]+","+e[1]+","+e[2]+"]"}function Ye(e){return"("+e[0]+","+e[1]+","+e[2]+")"}function Ze(e,t,i=xe){return Math.abs(e-t)<i}function et(e){return e===o.NORTH_EAST?o.SOUTH_WEST:e===o.NORTH_WEST?o.SOUTH_EAST:e===o.SOUTH_WEST?o.NORTH_EAST:o.NORTH_WEST}function tt(e){return e===o.NORTH?o.SOUTH:e===o.EAST?o.WEST:e===o.SOUTH?o.NORTH:o.EAST}function it(e){return e===o.NORTH_WEST||e===o.SOUTH_WEST}function lt(e){return e===o.NORTH_WEST||e===o.NORTH_EAST}function nt(e){return e===o.NORTH_WEST||e===o.WEST||e===o.SOUTH_WEST}function rt(e){return e===o.NORTH_EAST||e===o.EAST||e===o.SOUTH_EAST}function ot(e){return e===o.SOUTH_EAST||e===o.SOUTH||e===o.SOUTH_WEST}function st(e){return e===o.NORTH_EAST||e===o.NORTH||e===o.NORTH_WEST}const at=[o.NORTH,o.EAST,o.SOUTH,o.WEST],ct=[o.NORTH_EAST,o.SOUTH_EAST,o.SOUTH_WEST,o.NORTH_WEST],xe=1e-5;export{at as $,qe as A,Ye as B,Be as C,de as D,v as E,Te as F,Xe as G,Le as H,_ as I,it as J,lt as K,_e as L,C as M,Ae as N,Pe as O,Ze as P,nt as Q,U as R,Ue as S,o as T,pe as U,Ke as V,Ve as W,rt as X,ot as Y,st as Z,$ as _,ke as a,me as a0,Ce as a1,Ge as a2,Je as b,Ie as c,He as d,Ne as e,S as f,$e as g,te as h,ee as i,Fe as j,Se as k,ze as l,re as m,ct as n,je as o,he as p,et as q,ie as r,Qe as s,Z as t,L as u,ge as v,De as w,le as x,z as y,tt as z};
