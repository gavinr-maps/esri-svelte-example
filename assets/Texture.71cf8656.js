var e=Object.defineProperty,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,r=(t,i,a)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a;import{r as o,x as s}from"./vendor.5b1a85aa.js";const n=33984;var p,l;function h(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}(l=p||(p={}))[l.Texture=0]="Texture",l[l.Buffer=1]="Buffer",l[l.VAO=2]="VAO",l[l.Program=3]="Program",l[l.Framebuffer=4]="Framebuffer",l[l.Renderbuffer=5]="Renderbuffer",l[l.COUNT=6]="COUNT";class _{constructor(e,o,s=null){this._context=e,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,e.instanceCounter.increment(p.Texture,this),this._descriptor=((e,o)=>{for(var s in o||(o={}))i.call(o,s)&&r(e,s,o[s]);if(t)for(var s of t(o))a.call(o,s)&&r(e,s,o[s]);return e})({target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1},o),this.setData(s)}get glName(){return this._glName}get descriptor(){return this._descriptor}dispose(){this._context.gl&&this._glName&&(this._context.unbindTextureAllUnits(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(p.Texture,this))}release(){this.dispose()}resize(e,t){const i=this._descriptor;i.width===e&&i.height===t||(i.width=e,i.height=t,this.setData(null))}setData(e){if(!this._context||!this._context.gl)return;const t=this._context.gl;this._glName||(this._glName=t.createTexture()),void 0===e&&(e=null),null===e&&(this._descriptor.width=this._descriptor.width||4,this._descriptor.height=this._descriptor.height||4);const i=this._context.bindTexture(this,_.TEXTURE_UNIT_FOR_UPDATES),a=this._descriptor;_._validateTexture(this._context,a),t.pixelStorei(t.UNPACK_ALIGNMENT,a.unpackAlignment),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,a.flipped?1:0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.preMultiplyAlpha?1:0);const r=a.pixelFormat;let s=a.internalFormat?a.internalFormat:r;if(e instanceof ImageData||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement){let i=e.width,o=e.height;e instanceof HTMLVideoElement&&(i=e.videoWidth,o=e.videoHeight),a.width&&a.height,t.texImage2D(t.TEXTURE_2D,0,s,r,a.dataType,e),a.hasMipmap&&this.generateMipmap(),void 0===a.width&&(a.width=i),void 0===a.height&&(a.height=o)}else{null!=a.width&&null!=a.height||console.error("Width and height must be specified!"),t.DEPTH24_STENCIL8&&s===t.DEPTH_STENCIL&&(s=t.DEPTH24_STENCIL8);let i=a.width,n=a.height;if(function(e){return o(e)&&"type"in e&&"compressed"===e.type}(e)){const r=Math.round(Math.log(Math.max(i,n))/Math.LN2)+1;a.hasMipmap=a.hasMipmap&&r===e.levels.length;for(let o=0;;++o){const r=e.levels[Math.min(o,e.levels.length-1)];if(t.compressedTexImage2D(t.TEXTURE_2D,o,s,i,n,0,r),1===i&&1===n||!a.hasMipmap)break;i=Math.max(1,i>>1),n=Math.max(1,n>>1)}}else if(o(e))t.texImage2D(t.TEXTURE_2D,0,s,i,n,0,r,a.dataType,e),a.hasMipmap&&this.generateMipmap();else for(let e=0;t.texImage2D(t.TEXTURE_2D,e,s,i,n,0,r,a.dataType,null),(1!==i||1!==n)&&a.hasMipmap;++e)i=Math.max(1,i>>1),n=Math.max(1,n>>1)}_._applySamplingMode(t,this._descriptor),_._applyWrapMode(t,this._descriptor),_._applyAnisotropicFilteringParameters(this._context,this._descriptor),this._context.bindTexture(i,_.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,t,i,a,r,o){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const s=this._context.gl,n=this._descriptor,p=this._context.bindTexture(this,_.TEXTURE_UNIT_FOR_UPDATES);(t<0||i<0||a>n.width||r>n.height||t+a>n.width||i+r>n.height)&&console.error("An attempt to update out of bounds of the texture!"),s.pixelStorei(s.UNPACK_ALIGNMENT,n.unpackAlignment),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,n.flipped?1:0),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.preMultiplyAlpha?1:0),o instanceof ImageData||o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement?s.texSubImage2D(s.TEXTURE_2D,e,t,i,n.pixelFormat,n.dataType,o):s.texSubImage2D(s.TEXTURE_2D,e,t,i,a,r,n.pixelFormat,n.dataType,o),this._context.bindTexture(p,_.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;e.hasMipmap||(e.hasMipmap=!0,this._samplingModeDirty=!0,_._validateTexture(this._context,e)),9729===e.samplingMode?(this._samplingModeDirty=!0,e.samplingMode=9985):9728===e.samplingMode&&(this._samplingModeDirty=!0,e.samplingMode=9984);const t=this._context.bindTexture(this,_.TEXTURE_UNIT_FOR_UPDATES),i=this._context.gl;i.generateMipmap(i.TEXTURE_2D),this._context.bindTexture(t,_.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,_._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._context.gl,t=this._descriptor;this._samplingModeDirty&&(_._applySamplingMode(e,t),this._samplingModeDirty=!1),this._wrapModeDirty&&(_._applyWrapMode(e,t),this._wrapModeDirty=!1)}static _validateTexture(e,t){(t.width<0||t.height<0)&&console.error("Negative dimension parameters are not allowed!");const i=s(t.width)&&s(t.height);h(e.gl)||i||("number"==typeof t.wrapMode?33071!==t.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===t.wrapMode.s&&33071===t.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),t.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(e,t){let i=t.samplingMode,a=t.samplingMode;9985===i||9987===i?(i=9729,t.hasMipmap||(a=9729)):9984!==i&&9986!==i||(i=9728,t.hasMipmap||(a=9728)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a)}static _applyWrapMode(e,t){"number"==typeof t.wrapMode?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode.t))}static _applyAnisotropicFilteringParameters(e,t){var i;const a=e.capabilities.textureFilterAnisotropic;if(!a)return;const r=e.gl;r.texParameterf(r.TEXTURE_2D,a.TEXTURE_MAX_ANISOTROPY,null!=(i=t.maxAnisotropy)?i:1)}}_.TEXTURE_UNIT_FOR_UPDATES=0;var d=_;export{n as a,p as e,h as n,d as r};
