import{e as w,u as v}from"./screenUtils-_ZIvrt5o.js";import{e as g}from"./CIMSymbolHelper-BObHJeub.js";import{CIMSymbolRasterizer as $}from"./CIMSymbolRasterizer-7d1vkWUz.js";import{y as j}from"./OverrideHelper-ti072FkP.js";import{V as G}from"./utils-D2PLyMFF.js";import{t as b,l as O}from"./symbolUtils-_AKSLEsP.js";import"./BidiEngine-DNnuvc1i.js";import"./subclass-BZA_h8Db.js";import"./Polyline-D9YkgmM_.js";import"./tslib.es6-B3Jf3DVX.js";import"./writer-DNAwXnhG.js";import"./Extent-Bf3YTe7m.js";import"./Point-Cg0-ChZE.js";import"./Accessor-BLX9ikPh.js";import"./cast-Bjksrh93.js";import"./assets-C43MgM-v.js";import"./index-Bh2oEzTI.js";import"./jsonMap-0cxwUWs2.js";import"./mathUtils-C4_ghTv4.js";import"./TextSymbol-D8QO_KUV.js";import"./Color-BCS62Hs5.js";import"./colorUtils-0bJDPow9.js";import"./enumeration-Ba5njXdz.js";import"./fontUtils-BKHqaMFz.js";import"./jsonUtils-CEfjT-BK.js";import"./OptimizedGeometry-BF8iz5FO.js";import"./GeometryUtils-Dyjqugo6.js";import"./enums-CmIX1y88.js";import"./geometry-D964gYQX.js";import"./definitions-DfvbPdMm.js";import"./mat2d-D9DBP-jx.js";import"./common-DQOJ18NT.js";import"./mat2df32-orApM5a3.js";import"./vec2-maR1OrZI.js";import"./vec2f32-BbH2jxlN.js";import"./Rect-CUzevAry.js";import"./BoundingBox-CnpCxTZE.js";import"./defaults-DZ1kfMRx.js";import"./defaultsJSON-GKolV7NZ.js";import"./CIMResourceManager-B4IX3V_C.js";import"./imageUtils-CtmzXUTE.js";import"./colorUtils-aL8wj-8G.js";import"./vec42-YcqnINSP.js";import"./vec4f64-o2zAXfmz.js";import"./fieldUtils-tmQlKvWo.js";import"./intl-CChhNOV8.js";import"./date-DlqISzcw.js";import"./locale-C9TlLpzi.js";import"./messages-OmQvZhAg.js";import"./quantizationUtils-uj_P09aO.js";import"./utils-Ce7L3imC.js";import"./symbols-CNimns--.js";import"./materialUtils-DarhapKC.js";import"./opacityUtils-C68Tlu6_.js";import"./vec3f64-BLpZdpfb.js";import"./aaBoundingBox-BE7cC1jD.js";import"./persistableUrlUtils-fa1mAujs.js";import"./Collection-CEdjem1-.js";import"./Evented-BHRw9x22.js";import"./shared-B3wH2qpO.js";import"./SimpleObservable-KocWTzVy.js";import"./collectionUtils-D_lHIu88.js";import"./Portal-C10FKnaA.js";import"./Loadable-BabW5Xcc.js";import"./Promise-B2Hu02L7.js";import"./Clonable-D3rtuBWg.js";import"./reactiveUtils-C5zUhJQJ.js";import"./asyncUtils-CWX51uTe.js";import"./jsonUtils-CSnQD004.js";import"./parser-CTsgEym6.js";import"./utils-93yNk4Xc.js";import"./mat4f32-DcsiF_Rp.js";import"./mat4-GpOFENPA.js";import"./cimSymbolUtils-DXvZxabN.js";import"./LRUCache-B_PHMSGm.js";import"./MemCache-Dx1v3xLC.js";import"./jsxFactory-CJa39Fro.js";import"./uuid-fwrPAdZb.js";import"./webStyleSymbolUtils-CwdsUGtV.js";import"./devEnvironmentUtils-CnNDiFMM.js";import"./jsonUtils-Ds2Sqto-.js";import"./layerUtils-BrNoooE9.js";import"./styleUtils-BYTm14n3.js";const u=new $(null),c=w(b.size),S=w(b.maxSize),C=w(b.lineWidth),R=1;async function V(e,t,p){const r=t==null?void 0:t.size;let i=r!=null&&typeof r=="object"&&"width"in r?r.width:r,m=r!=null&&typeof r=="object"&&"height"in r?r.height:r;if(i==null||m==null)if(p==="esriGeometryPolygon")i=c,m=c;else{const o=await q(e,t,p);o&&(i=o.width,m=o.height),p==="esriGeometryPolyline"&&(i=C),i=i!=null&&isFinite(i)?Math.min(i,S):c,m=m!=null&&isFinite(m)?Math.max(Math.min(m,S),R):c}return t.style==="legend"&&p==="esriGeometryPolyline"&&(i=C),{width:i,height:m}}async function q(e,t,p){const{feature:r,fieldMap:i,viewParams:m}=t.cimOptions||t,o=await j.resolveSymbolOverrides(e.data,r,null,i,p,null,m);if(!o)return null;(e=e.clone()).data={type:"CIMSymbolReference",symbol:o},e.data.primitiveOverrides=void 0;const l=[];return g.fetchResources(o,u.resourceManager,l),g.fetchFonts(o,u.resourceManager,l),l.length>0&&await Promise.all(l),g.getEnvelope(o,null,u.resourceManager)}async function ui(e,t={}){var M;const{node:p,opacity:r,symbolConfig:i}=t,m=i!=null&&typeof i=="object"&&"isSquareFill"in i&&i.isSquareFill,o=t.cimOptions||t,l=o.geometryType||G((M=e==null?void 0:e.data)==null?void 0:M.symbol),f=await V(e,t,l),{feature:P,fieldMap:I}=o,L=m||l!=="esriGeometryPolygon"?"preview":"legend",y=await u.rasterizeCIMSymbolAsync(e,P,f,L,I,l,null,o.viewParams,o.allowScalingUp);if(!y)return null;const{width:x,height:z}=y,n=document.createElement("canvas");n.width=x,n.height=z,n.getContext("2d").putImageData(y,0,0);const h=v(f.width),d=v(f.height),a=new Image(h,d);a.src=n.toDataURL(),a.ariaLabel=t.ariaLabel??null,a.alt=t.ariaLabel??"",r!=null&&(a.style.opacity=`${r}`);let s=a;if(t.effectView!=null){const F={shape:{type:"image",x:0,y:0,width:h,height:d,src:a.src},fill:null,stroke:null,offset:[0,0]};s=O([[F]],[h,d],{effectView:t.effectView,ariaLabel:t.ariaLabel})}return p&&s&&p.appendChild(s),s}export{ui as previewCIMSymbol};
