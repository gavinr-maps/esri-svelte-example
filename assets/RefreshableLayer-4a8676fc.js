import{V as u,dW as c,a as h,b as o,c as m,d9 as p,dX as v,s as y}from"./index-e8c6bcc0.js";const a=new u,n=new WeakMap;function g(e){l(e)&&a.push(e)}function I(e){l(e)&&a.includes(e)&&a.remove(e)}function l(e){return e!=null&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function d(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:d(t,e%t):0}let f=0,i=0;function b(){const e=Date.now();for(const t of a)t.refreshInterval&&e-(n.get(t)??0)+5>=6e4*t.refreshInterval&&(n.set(t,e),t.refresh(e))}c(()=>{const e=Date.now();let t=0;for(const r of a)t=d(Math.round(6e4*r.refreshInterval),t),r.refreshInterval?n.get(r)||n.set(r,e):n.delete(r);if(t!==i){if(i=t,clearInterval(f),i===0)return void(f=0);f=setInterval(b,i)}});const D=e=>{let t=class extends e{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=p(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||g(this)},()=>{})}destroy(){I(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){v(this._debounceHasDataChanged()).then(s=>{s&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:s})},s=>{y.getLogger(this).error(s),this.emit("refresh",{dataChanged:!1,error:s})})}async hasDataChanged(){return!0}};return h([o({type:Number,cast:r=>r>=.1?r:r<=0?0:.1,json:{write:!0}})],t.prototype,"refreshInterval",void 0),h([o({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),h([o()],t.prototype,"refreshParameters",null),t=h([m("esri.layers.mixins.RefreshableLayer")],t),t};export{D as p};
