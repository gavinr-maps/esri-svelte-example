import{m as l}from"./TimeOnly-DOn_Hy89.js";import{i as F,K as u,E as p,P as h,X as f,a as w,r as S,Y as s,B as v}from"./languageUtils-JGnUBrxZ.js";import{l as c}from"./arcadeUtils-BE8Aletj.js";import{Z as d,r as x}from"./WhereClause-BNiy948d.js";import"./subclass-BZA_h8Db.js";import"./UnknownTimeZone-BkowvBs8.js";import"./date-DlqISzcw.js";import"./jsonMap-0cxwUWs2.js";import"./locale-C9TlLpzi.js";import"./Extent-Bf3YTe7m.js";import"./tslib.es6-B3Jf3DVX.js";import"./Point-Cg0-ChZE.js";import"./Accessor-BLX9ikPh.js";import"./cast-Bjksrh93.js";import"./writer-DNAwXnhG.js";import"./assets-C43MgM-v.js";import"./index-Bh2oEzTI.js";import"./ImmutableArray-BPVd6ESQ.js";import"./shared-OyXfj1UM.js";import"./Field-ybkHhtnK.js";import"./enumeration-Ba5njXdz.js";import"./fieldType-BuzM0UHS.js";import"./number-CUaGJe2K.js";import"./Polyline-D9YkgmM_.js";import"./mathUtils-C4_ghTv4.js";import"./jsonUtils-CEfjT-BK.js";import"./Query-5Xpquc1r.js";import"./geometry-D964gYQX.js";import"./DataLayerSource-BKkswDvG.js";import"./FullTextSearch-Csd1Hktu.js";import"./Clonable-D3rtuBWg.js";import"./TimeExtent-DocT5yPf.js";import"./timeUtils-8fb_2oAt.js";import"./deepClone-CWS5qiGp.js";import"./featureConversionUtils-D14h8iad.js";import"./aaBoundingBox-BE7cC1jD.js";import"./OptimizedFeature-6cJ-QFG5.js";import"./OptimizedGeometry-BF8iz5FO.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./FieldsIndex-DpwHKAMX.js";import"./fieldUtils-tmQlKvWo.js";import"./intl-CChhNOV8.js";import"./messages-OmQvZhAg.js";import"./hash-CcEbRgUF.js";import"./uuid-fwrPAdZb.js";import"./Portal-C10FKnaA.js";import"./Loadable-BabW5Xcc.js";import"./Promise-B2Hu02L7.js";async function m(r,i,t,o){if(t.length===1){if(p(t[0]))return c(r,t[0],s(t[1],-1));if(f(t[0]))return c(r,t[0].toArray(),s(t[1],-1))}else if(t.length===2){if(p(t[0]))return c(r,t[0],s(t[1],-1));if(f(t[0]))return c(r,t[0].toArray(),s(t[1],-1));if(u(t[0])){const a=await t[0].load(),n=await y(d.create(t[1],{fieldsIndex:a.getFieldsIndex(),timeZone:a.dateFieldsTimeZoneDefaultUTC}),o,i);return g(i,await t[0].calculateStatistic(r,n,s(t[2],1e3),i.abortSignal))}}else if(t.length===3&&u(t[0])){const a=await t[0].load(),n=await y(d.create(t[1],{fieldsIndex:a.getFieldsIndex(),timeZone:a.dateFieldsTimeZoneDefaultUTC}),o,i);return g(i,await t[0].calculateStatistic(r,n,s(t[2],1e3),i.abortSignal))}return c(r,t,-1)}function g(r,i){return i instanceof x?l.fromReaderAsTimeStampOffset(i.toStorageFormat()):i instanceof Date?l.dateJSAndZoneToArcadeDate(i,v(r)):i}async function y(r,i,t){const o=r.getVariables();if(o.length>0){const a=[];for(let e=0;e<o.length;e++){const A={name:o[e]};a.push(await i.evaluateIdentifier(t,A))}const n={};for(let e=0;e<o.length;e++)n[o[e]]=a[e];return r.parameters=n,r}return r}function Ft(r){r.mode==="async"&&(r.functions.stdev=function(i,t){return r.standardFunctionAsync(i,t,(o,a,n)=>m("stdev",i,n,r))},r.functions.variance=function(i,t){return r.standardFunctionAsync(i,t,(o,a,n)=>m("variance",i,n,r))},r.functions.average=function(i,t){return r.standardFunctionAsync(i,t,(o,a,n)=>m("mean",i,n,r))},r.functions.mean=function(i,t){return r.standardFunctionAsync(i,t,(o,a,n)=>m("mean",i,n,r))},r.functions.sum=function(i,t){return r.standardFunctionAsync(i,t,(o,a,n)=>m("sum",i,n,r))},r.functions.min=function(i,t){return r.standardFunctionAsync(i,t,(o,a,n)=>m("min",i,n,r))},r.functions.max=function(i,t){return r.standardFunctionAsync(i,t,(o,a,n)=>m("max",i,n,r))},r.functions.count=function(i,t){return r.standardFunctionAsync(i,t,async(o,a,n)=>{if(F(n,1,1,i,t),u(n[0]))return n[0].count(o.abortSignal);if(p(n[0])||h(n[0]))return n[0].length;if(f(n[0]))return n[0].length();throw new w(i,S.InvalidParameter,t)})})}export{Ft as registerFunctions};
