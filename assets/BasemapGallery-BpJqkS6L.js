const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./calcite-scrim-ByhE7nPY.js","./scrim-tJUFlVOZ.js","./jsxFactory-CbAu6VfF.js","./Evented-CXIxDjmW.js","./Accessor-D6mNnsWy.js","./subclass-BR3PhgZG.js","./intl-Dpfm8vPB.js","./Promise-CZrWwByK.js","./jsonMap-DCC6W5ex.js","./assets-C2mb-ea2.js","./index-CeCSsEgo.js","./index-CjOb8WjV.css","./reactiveUtils-BFQ0BtrB.js","./shared-B3wH2qpO.js","./uuid-fwrPAdZb.js","./locale-BUTTOPma.js","./dom-Cv0oa6So.js","./key-D5DPfjW0.js","./observers-EizV_Lvc.js","./t9n-DfK3dFGw.js","./loader-wfvKSvDR.js","./calcite-chip-DEpR5R9e.js","./chip-Bl8qrqgL.js","./loadable-CTFTnu2T.js","./interactive-Dtpmn6Ls.js","./component-ByvC-PUv.js","./icon-DIKjN-ev.js"])))=>i.map(i=>d[i]);
import{_ as P}from"./index-CeCSsEgo.js";import{e as i}from"./Evented-CXIxDjmW.js";import{n as N}from"./assets-C2mb-ea2.js";import{d as v,w as X,V as R,P as Y,v as Z,p as O}from"./reactiveUtils-BFQ0BtrB.js";import{O as ee,c as g,y as r,b as I,n as te}from"./subclass-BR3PhgZG.js";import{U as ae,R as se,O as ie,d as re,L as oe}from"./basemapUtils-CkCKogG3.js";import{e as ne,B as le,m as pe,r as me,n as d}from"./jsxFactory-CbAu6VfF.js";import{F as T}from"./Basemap-DhGpUWGY.js";import{m as L,C as D}from"./Portal-liet8xHC.js";import{s as ce}from"./jsonMap-DCC6W5ex.js";import{J as de,_ as he,W as ue}from"./projection-A9yUaaTs.js";import{G as x}from"./Point-DB4Hp4hH.js";import{s as C,S as q,b as j}from"./Accessor-D6mNnsWy.js";import{y as ye,n as fe,f as be}from"./layerUtils-erzwAANv.js";import{a as M,l as we}from"./ViewingMode-Dodu7ZZk.js";import{F as ge,V as A,f as ve}from"./terrainUtils-DI2O4VuO.js";import{r as _e}from"./spatialReferenceSupport-C0HdvI6F.js";import{s as Be}from"./Identifiable-BLvpQbOc.js";import{n as $e}from"./Promise-CZrWwByK.js";import{e as _}from"./globalCss-CZa70j6i.js";import{e as Re}from"./Heading-ynVMbJ8d.js";import{t as Ie}from"./accessibleHandler-DFh8uIGE.js";import"./shared-B3wH2qpO.js";import"./utils-D20M4_S8.js";import"./colorUtils-CS9vdHXB.js";import"./screenUtils-PfxkaaMN.js";import"./mat4f32-DcsiF_Rp.js";import"./mat4-ybYUU6jq.js";import"./mathUtils-ClvKsMak.js";import"./intl-Dpfm8vPB.js";import"./uuid-fwrPAdZb.js";import"./collectionUtils-Dm1icNvk.js";import"./loadAll-DDw-urzS.js";import"./writer-3zufXUNV.js";import"./PortalItem-BuTU9OuN.js";import"./Extent-DHjqVB-p.js";import"./persistableUrlUtils-BcifXQ1Z.js";import"./writeUtils-3wz9AuW7.js";import"./Polyline-D97hl-6E.js";import"./projectBuffer-vsa0P_cF.js";import"./geodesicConstants-XRAvAZCD.js";import"./geometry-DpwwkAX1.js";import"./TileInfo-DkEc90N-.js";import"./TileKey-DZd6gJy7.js";async function Ce(e,t={}){const{basemap:a,view:s}=e;await a.load(t),Le(a),await Fe(a,s,t),C(t)}async function ke(e,t={}){var c,p;const{basemap:a,view:s}=e;C(t);const n=(c=a.baseLayers.find(y=>y.type==="unknown"))==null?void 0:c.loadError;if(n!=null)throw n;if(!s||"spatialReferenceLocked"in s&&!s.spatialReferenceLocked||(await a.load(t),C(t),a.baseLayers.length===0))return;const o=a.baseLayers.at(0);if(!ye(o))return;if(a.spatialReference){if(s.spatialReference.equals(a.spatialReference))return;G()}await o.load(t),C(t);const l=(("supportedSpatialReferences"in o?o.supportedSpatialReferences:null)||["tileInfo"in o?(p=o.tileInfo)==null?void 0:p.spatialReference:null]).filter(ee);l.length!==0&&l.every(y=>!s.spatialReference.equals(y))&&G()}function G(){throw new g("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view")}function Le(e){if(e.baseLayers.length===0&&e.referenceLayers.length===0)return;const t=e.baseLayers.concat(e.referenceLayers).toArray().filter(a=>!fe(a)).map(a=>Te(a));if(t.length)throw t[0]}function Te(e){return new g("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:e,operationalLayerType:e.operationalLayerType||"unknown"})}async function Fe(e,t,a){if(e.baseLayers.length===0)return;const s=e.baseLayers.at(0);if(be(s)){try{await s.load(a)}catch(n){const o="basemap-compatibility:unknown-error",l="Unknown basemap compatibility error",{name:c=o,message:p=l,details:y}=n;throw new g(c,p,y)}Ee(s,t)}}function Ee(e,t){var c;const a=t.state.viewingMode;if(!a)return;let s,n;if((e==null?void 0:e.type)==="wmts"){const p=ge(e,t.spatialReference,a);if(p.tileInfo==null)throw new g("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");s=p.tileInfo,n=p.fullExtent}else s=e.tileInfo,n=e.fullExtent;if(s==null)return;if(!_e(s.spatialReference,a))throw new g(`basemapgalleryitem:spatial-reference-unsupported-${M(a)}`,`Basemap spatial reference is unsupported in ${M(a)} mode`);const o=(e==null?void 0:e.type)==="vector-tile"?s.getCompatibleForVTL(256):null;if(a===we.Global){let p=A(s,n,null,a);if(p&&(e==null?void 0:e.type)==="vector-tile"&&n!=null&&o&&!A(o,n,null,a)&&(p=null),p){const y=s.spatialReference.isWebMercator?"web-mercator":"wgs84";throw new g(`basemapgalleryitem:tiling-scheme-unsupported-${y}-global`,"Basemap tiling scheme is unsupported in global mode",{error:p})}}else if(ve.checkUnsupported(s))throw new g("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");const l=(c=t.basemapTerrain)==null?void 0:c.tilingScheme;if(l&&!l.compatibleWith(s)&&((e==null?void 0:e.type)!=="vector-tile"||!o||!l.compatibleWith(o)))throw new g("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view")}let b=class extends Be(q){constructor(e){super(e),this.compatibilityFunction=null,this.error=null,this.state="loading",this.view=null}initialize(){const e=()=>this.refresh();this.addHandles([v(()=>{var t;return(t=this.basemap)==null?void 0:t.loadStatus},e),v(()=>this.compatibilityFunction,e),v(()=>{var t;return this.view&&"basemapTerrain"in this.view&&((t=this.view.basemapTerrain)==null?void 0:t.tilingScheme)},e),v(()=>{var t;return(t=this.view)==null?void 0:t.ready},e),v(()=>{var t;return(t=this.view)==null?void 0:t.spatialReference},e)]),this.refresh()}destroy(){this._cancelRefresh(),this.basemap=null,this.compatibilityFunction=null,this.view=null}get _spatialReferenceTask(){return ae(this.view,this.basemap)}set basemap(e){e&&e.load().catch(()=>{}),this._set("basemap",e)}get spatialReference(){return this._spatialReferenceTask.spatialReference}refresh(){var s;this._cancelRefresh(),this._set("state","loading");const e=(s=this.basemap)==null?void 0:s.loadStatus;if(e!=="loaded"&&e!=="failed")return;if(!this.compatibilityFunction)return void(e==="loaded"?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError)));const t=new AbortController,{signal:a}=t;this.compatibilityFunction(this,{signal:a}).then(()=>X(()=>!this._spatialReferenceTask.updating,a)).then(()=>{this._set("state","ready"),this._set("error",null)}).catch(n=>{j(n)||(this._set("state","error"),this._set("error",n))}),this._refreshController=t}_cancelRefresh(){this._refreshController&&(this._refreshController.abort(),this._refreshController=null)}};i([r({readOnly:!0})],b.prototype,"_spatialReferenceTask",null),i([r()],b.prototype,"basemap",null),i([r()],b.prototype,"compatibilityFunction",void 0),i([r({readOnly:!0})],b.prototype,"error",void 0),i([r({readOnly:!0})],b.prototype,"spatialReference",null),i([r({readOnly:!0})],b.prototype,"state",void 0),i([r()],b.prototype,"view",void 0),b=i([I("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],b);const U=b,V=R.ofType(T);let B=class extends q{constructor(e){super(e),this.basemaps=new V}destroy(){this.basemaps.forEach(e=>e.destroy())}get state(){return"ready"}refresh(){}};i([r({type:V})],B.prototype,"basemaps",void 0),i([r({readOnly:!0})],B.prototype,"state",null),B=i([I("esri.widgets.BasemapGallery.support.LocalBasemapsSource")],B);const z=B,H=R.ofType(T);let w=class extends L.LoadableMixin($e(z)){constructor(t){super(t),this._lastPortalBasemapFetchController=null,this.basemaps=new H,this.filterFunction=null,this.portal=D.getDefault(),this.query=null,this.updateBasemapsCallback=null,this.viewType=null}initialize(){this.addHandles(v(()=>{var t,a,s;return[this.filterFunction,this.loadStatus,(t=this.portal)==null?void 0:t.basemapGalleryGroupQuery,(a=this.portal)==null?void 0:a.basemapGalleryGroupQuery3D,(s=this.portal)==null?void 0:s.user,this.query,this.updateBasemapsCallback]},()=>this.refresh(),Y))}destroy(){this.filterFunction=null,this.portal=null,this.basemaps.forEach(t=>t.destroy())}get state(){return this.loadStatus==="not-loaded"?"not-loaded":this.loadStatus==="loading"||this._lastPortalBasemapFetchController?"loading":"ready"}load(t){return this.addResolvingPromise(this.portal.load(t)),Promise.resolve(this)}async refresh(){if(this.loadStatus!=="loaded")return;this._lastPortalBasemapFetchController&&(this._lastPortalBasemapFetchController.abort(),this._lastPortalBasemapFetchController=null);const t=this.portal,a=new AbortController;this._lastPortalBasemapFetchController=a,this.notifyChange("state");try{const s=await t.fetchBasemaps(this._toQueryString(this.query),{signal:a.signal,include3d:this.viewType==="3d"||void 0});await this._updateBasemaps(s)}catch(s){if(j(s))throw s;te.getLogger(this).warn(new g("basemap-source:fetch-basemaps-error","Could not fetch basemaps from portal.",{error:s})),await this._updateBasemaps()}this._lastPortalBasemapFetchController=null,this.notifyChange("state")}_toQueryString(t){return t&&typeof t!="string"?Object.keys(t).map(a=>`${a}:${t[a]}`).join(" AND "):t}async _updateBasemaps(t=[]){let a=await this._filterBasemaps(t);a=this.updateBasemapsCallback?await this.updateBasemapsCallback(a):a,this.basemaps.removeAll(),this.basemaps.addMany(a)}async _filterBasemaps(t){if(!this.filterFunction)return t;const a=t.map(this.filterFunction),s=await Promise.all(a);return t.filter((n,o)=>s[o])}};i([r({readOnly:!0,type:H})],w.prototype,"basemaps",void 0),i([r()],w.prototype,"filterFunction",void 0),i([r({type:D})],w.prototype,"portal",void 0),i([r()],w.prototype,"query",void 0),i([r({readOnly:!0})],w.prototype,"state",null),i([r()],w.prototype,"updateBasemapsCallback",void 0),i([r()],w.prototype,"viewType",void 0),w=i([I("esri.widgets.BasemapGallery.support.PortalBasemapsSource")],w);const $=w,Q=R.ofType(U);function Se(e){return e&&e.declaredClass==="esri.portal.Portal"}function Pe(e){return e&&!(e instanceof $)&&(!!e.portal||!!e.query)}function xe(e){return e&&"basemaps"in e&&"state"in e&&"refresh"in e}let f=class extends L{constructor(e){super(e),this._loadingProjectionEngine=!1,this.items=new Q,this.source=new $,this.view=null}initialize(){const e=()=>this._recreateItems();this.addHandles([v(()=>this.state==="ready"?this.compatibilityFunction:null,()=>this._updateItems()),Z(()=>{var t;return(t=this.source)==null?void 0:t.basemaps},"change",e,{onListenerAdd:e}),O(()=>this.view,()=>{var t;this.source instanceof $&&(this.source.viewType=(t=this.view)==null?void 0:t.type)},{once:!0})])}destroy(){var t;const e=this.source.basemaps.find(a=>a===this.activeBasemap);e&&this.source.basemaps.remove(e),(t=this.source)==null||t.destroy()}get activeBasemap(){var e,t;return((t=(e=this.view)==null?void 0:e.map)==null?void 0:t.basemap)??null}set activeBasemap(e){var n,o;const t=this.view;if(!(t!=null&&t.map))return;const a=typeof e=="string"?T.fromId(e):e;if(!a||!t.ready)return t.map.basemap=a,void this._clearOverride("activeBasemap");const s=a.spatialReference||((o=(n=this.items)==null?void 0:n.find(l=>this.basemapEquals(a,l.basemap)))==null?void 0:o.spatialReference);if(s&&"spatialReferenceLocked"in t&&!t.spatialReferenceLocked){const l=t.spatialReference;if(s!=null&&!x(l,s)&&!de(t.spatialReference,s)&&!he())return this._override("activeBasemap",a),this._loadingProjectionEngine=!0,void ue().then(()=>{this._get("activeBasemap")===e&&(t.map.basemap=e,t.spatialReference=s,this._clearOverride("activeBasemap"))},()=>{}).then(()=>{this._loadingProjectionEngine=!1});t.map.basemap=a,this._clearOverride("activeBasemap"),s==null||x(t.spatialReference,s)||(t.spatialReference=s)}else t.map.basemap=a,this._clearOverride("activeBasemap")}get activeBasemapIndex(){const{state:e,activeBasemap:t}=this;return e!=="ready"?-1:this._findBasemapIndex(t)}get compatibilityFunction(){var e;return((e=this.view)==null?void 0:e.type)==="3d"?Ce:ke}set compatibilityFunction(e){this._overrideIfSome("compatibilityFunction",e)}castSource(e){return Array.isArray(e)||R.isCollection(e)?new z({basemaps:Array.isArray(e)?new R(e):e}):Se(e)?new $({portal:e}):Pe(e)?new $(e):xe(e)?e:null}get state(){var e;return(e=this.view)!=null&&e.ready&&this.source?this._loadingProjectionEngine?"loading":"ready":"disabled"}basemapEquals(e,t){return se(e,t)}refresh(){this._recreateItems()}load(){return this.loadSource()}loadSource(e){return this.addResolvingPromise(L.isLoadable(this.source)?this.source.load(e):null),Promise.resolve(this)}_findBasemapIndex(e){const{items:t}=this,a=t.findIndex(s=>s.basemap===e);return a===-1?t.findIndex(s=>this.basemapEquals(s.basemap,e)):a}_recreateItems(){var o;const e=((o=this.source)==null?void 0:o.basemaps)??[],{view:t,compatibilityFunction:a}=this,s=new Map(this.items.map(l=>[l.basemap,l])),n=e.map(l=>{const c=s.get(l);return c?(s.delete(l),c):new U({basemap:l,compatibilityFunction:a,view:t})});this.items.removeAll(),this.items.addMany(n),s.forEach(l=>l.destroy())}_updateItems(){for(const e of this.items)e.compatibilityFunction=this.compatibilityFunction,e.view=this.view}};i([r()],f.prototype,"_loadingProjectionEngine",void 0),i([r()],f.prototype,"activeBasemap",null),i([r({readOnly:!0})],f.prototype,"activeBasemapIndex",null),i([r()],f.prototype,"compatibilityFunction",null),i([r({readOnly:!0,type:Q})],f.prototype,"items",void 0),i([r()],f.prototype,"source",void 0),i([ce("source")],f.prototype,"castSource",null),i([r({readOnly:!0})],f.prototype,"state",null),i([r()],f.prototype,"view",void 0),f=i([I("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],f);const Me=f,h="esri-basemap-gallery",u={base:h,sourceLoading:`${h}--source-loading`,layoutGrid:`${h}--grid`,narrowItems:`${h}--narrow-items`,loader:`${h}__loader`,item:`${h}__item`,itemContainer:`${h}__item-container`,itemContent:`${h}__item-content`,itemTitle:`${h}__item-title`,itemTagsContainer:`${h}__item-tags-container`,itemThumbnail:`${h}__item-thumbnail`,selectedItem:`${h}__item--selected`,itemError:`${h}__item--error`},k={small:200,default:280,wide:420};let m=class extends le{constructor(e,t){super(e,t),this.disabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new Me,this._focusBasemapItemEnabled=!1,this._container=null,this._width=0,this._onContainerCreated=a=>{this._container=a}}initialize(){this.addHandles([pe(()=>this._container,({contentRect:e})=>{this._width=e.width}),O(()=>this.source,()=>this.viewModel.loadSource(),{sync:!0,initial:!0})])}loadDependencies(){return me({scrim:()=>P(()=>import("./calcite-scrim-ByhE7nPY.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),import.meta.url),chip:()=>P(()=>import("./calcite-chip-DEpR5R9e.js"),__vite__mapDeps([21,22,2,3,4,5,6,7,8,9,10,11,12,13,14,16,23,19,15,17,18,24,25,26]),import.meta.url)})}get activeBasemap(){return this.viewModel.activeBasemap}set activeBasemap(e){this.viewModel.activeBasemap=e}get icon(){return"basemap"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get source(){return this.viewModel.source}set source(e){this.viewModel.source=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e=this.source.state==="loading",t=this.disabled||this.viewModel.state==="disabled",a=this.viewModel.items,s={[u.sourceLoading]:e,[_.disabled]:t},n=this._width;n<=k.small||n>=k.wide?s[u.layoutGrid]=!0:n<k.default&&(s[u.narrowItems]=!0);const o=e?d("div",{class:u.loader,key:"loader"}):null,l=e?null:a.length>0?d("ul",{"aria-disabled":this.disabled,"aria-label":this.label,bind:this,class:u.itemContainer,key:"item-container",onkeydown:this._handleKeyDown,role:"radiogroup"},a.map((c,p)=>this._renderBasemapGalleryItem(c,p)).toArray()):d("div",{class:_.empty,key:"empty-message"},d(Re,{level:this.headingLevel},this.messages.noBasemaps));return d("div",{afterCreate:this._onContainerCreated,class:this.classes(u.base,_.widget,_.panel,s),key:"container"},this._width===0?null:[o,l])}_getRoundRobinIndex(e,t){return(e+t)%t}_handleKeyDown(e){const{key:t}=e;if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(t))return;e.preventDefault();const{items:a,activeBasemapIndex:s}=this.viewModel,n=t==="ArrowUp"||t==="ArrowLeft"?this._getRoundRobinIndex(Math.max(s-1,-1),a.length):this._getRoundRobinIndex(s+1,a.length),o=a.at(n);(o==null?void 0:o.state)==="ready"&&(this.viewModel.activeBasemap=o.basemap),this._focusBasemapItemEnabled=!0}_focusBasemapItem(e){this._focusBasemapItemEnabled&&e.tabIndex===0&&(e.focus(),this._focusBasemapItemEnabled=!1)}_handleClick(e){const t=e.currentTarget["data-item"];t.state==="ready"&&(this.viewModel.activeBasemap=t.basemap)}_renderBasemapGalleryItem(e,t){var E,S;const a=ie(e.basemap)||N("esri/themes/base/images/basemap-toggle-64.svg"),s=e.basemap.title,n=(E=e.basemap.portalItem)==null?void 0:E.snippet,o=((S=e.error)==null?void 0:S.message)||n||s,{viewModel:{state:l,activeBasemapIndex:c}}=this,p=this.disabled||l==="disabled",y=c===t,W=y||c===-1&&t===0?0:-1,J=l==="loading",K={[u.selectedItem]:y,[u.itemError]:e.state==="error"},F=`basemapgallery-item-${e.uid}`;return d("li",{afterUpdate:this._focusBasemapItem,"aria-checked":y.toString(),"aria-disabled":p.toString(),"aria-labelledby":F,bind:this,class:this.classes(u.item,K),"data-item":e,key:e.uid,onclick:this._handleClick,onkeydown:this._handleClick,role:"radio",tabIndex:W,title:o},d("img",{alt:"",class:u.itemThumbnail,src:a}),d("div",{class:u.itemContent,key:"content"},d("div",{class:u.itemTitle,key:"title"},d("span",{id:F},s)),re(e.basemap)?this._renderTags(e.basemap):null),e.state==="loading"||y&&J?d("calcite-scrim",null,d("span",{"aria-hidden":"true",class:_.loaderAnimation,key:"loader",role:"presentation"})):null)}_renderTags(e){return d("div",{class:u.itemTagsContainer,key:"tag"},this._render3DTag(),oe(e)?this._renderBetaTag():null)}_render3DTag(){const{messages:e}=this;return d("calcite-chip",{key:"tag-3d",scale:"s",value:e.tag3D},this.messages.tag3D)}_renderBetaTag(){const{messages:e}=this;return d("calcite-chip",{appearance:"outline-fill",key:"tag-beta",scale:"s",value:e.tagBeta},this.messages.tagBeta)}};i([r()],m.prototype,"activeBasemap",null),i([r()],m.prototype,"disabled",void 0),i([r()],m.prototype,"headingLevel",void 0),i([r()],m.prototype,"icon",null),i([r()],m.prototype,"label",null),i([r(),ne("esri/widgets/BasemapGallery/t9n/BasemapGallery")],m.prototype,"messages",void 0),i([r()],m.prototype,"source",null),i([r()],m.prototype,"view",null),i([r()],m.prototype,"viewModel",void 0),i([r()],m.prototype,"_focusBasemapItemEnabled",void 0),i([r()],m.prototype,"_container",void 0),i([r()],m.prototype,"_width",void 0),i([Ie()],m.prototype,"_handleClick",null),m=i([I("esri.widgets.BasemapGallery")],m);const kt=m;export{kt as default};
