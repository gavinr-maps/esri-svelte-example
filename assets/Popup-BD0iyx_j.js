import{r as n}from"./tslib.es6-B3Jf3DVX.js";import{b as I,Y as C,j as O,a5 as S,I as R}from"./Accessor-BLX9ikPh.js";import{a as B,m as l,n as k}from"./subclass-BZA_h8Db.js";import{watch as m,initial as u,on as z,whenOnce as H}from"./reactiveUtils-C5zUhJQJ.js";import{c as U}from"./ActionToggle-iT4slXc7.js";import{W as j,R as Y}from"./Features-DYw6xAtg.js";import{e as q,B as G,n as P,u as N}from"./jsxFactory-CJa39Fro.js";import{e as J}from"./globalCss-CZa70j6i.js";import{e as K}from"./vmEvent-D4Ubqkbq.js";import"./asyncUtils-CWX51uTe.js";import"./Collection-CEdjem1-.js";import"./Evented-BHRw9x22.js";import"./shared-B3wH2qpO.js";import"./SimpleObservable-KocWTzVy.js";import"./Identifiable-B1UbsKNt.js";import"./index-Bh2oEzTI.js";import"./intl-CChhNOV8.js";import"./date-DlqISzcw.js";import"./jsonMap-0cxwUWs2.js";import"./locale-C9TlLpzi.js";import"./messages-OmQvZhAg.js";import"./assets-C43MgM-v.js";import"./throttle-jjSnxk80.js";import"./geometryUtils-KlTtXnEh.js";import"./geometry-D964gYQX.js";import"./Extent-Bf3YTe7m.js";import"./Point-Cg0-ChZE.js";import"./cast-Bjksrh93.js";import"./writer-DNAwXnhG.js";import"./Polyline-D9YkgmM_.js";import"./mathUtils-C4_ghTv4.js";import"./scaleUtils-D_Nw3nhM.js";import"./actionUtils-ClPpuZ4c.js";import"./Feature-JHcQ4xbg.js";import"./Attachments-PCr7j7mL.js";import"./unitFormatUtils-CZ2bRlFg.js";import"./ByteSizeUnit-BsxeN7wM.js";import"./Cyclical-oTUX3aX7.js";import"./quantityUtils-D0GB2dMc.js";import"./Graphic-DsxsIjhH.js";import"./PopupTemplate-BHMhS05j.js";import"./Clonable-D3rtuBWg.js";import"./fieldUtils-tmQlKvWo.js";import"./enumeration-Ba5njXdz.js";import"./Color-BCS62Hs5.js";import"./colorUtils-0bJDPow9.js";import"./symbols-CNimns--.js";import"./TextSymbol-D8QO_KUV.js";import"./screenUtils-_ZIvrt5o.js";import"./materialUtils-DarhapKC.js";import"./opacityUtils-C68Tlu6_.js";import"./vec3f64-BLpZdpfb.js";import"./aaBoundingBox-BE7cC1jD.js";import"./persistableUrlUtils-fa1mAujs.js";import"./collectionUtils-D_lHIu88.js";import"./Portal-C10FKnaA.js";import"./Loadable-BabW5Xcc.js";import"./Promise-B2Hu02L7.js";import"./jsonUtils-CEfjT-BK.js";import"./AttachmentInfo-DMzNK0rO.js";import"./AttachmentQuery-BUlkjzkx.js";import"./featureUtils-Do2jvOGL.js";import"./layerUtils-BrNoooE9.js";import"./utils-BwQ00KBJ.js";import"./Basemap-DVYOaWHz.js";import"./loadAll-B6mYSptb.js";import"./PortalItem-DzgXrpyc.js";import"./writeUtils-Dz7BsE1e.js";import"./mat4f32-DcsiF_Rp.js";import"./mat4-GpOFENPA.js";import"./common-DQOJ18NT.js";import"./attachmentUtils-CL0GU4LB.js";import"./legacyIcon-CEIp6Pa9.js";import"./Heading-C-odFCu-.js";import"./widget-DwhGPDuv.js";import"./uriUtils-DHHvHAs0.js";import"./a11yUtils-cyWndM8Q.js";import"./utils-D3iwntXt.js";import"./ColorStop-Dk3U5tCk.js";import"./utils-Ce7L3imC.js";import"./jsonUtils-CSnQD004.js";import"./parser-CTsgEym6.js";import"./utils-93yNk4Xc.js";import"./cimSymbolUtils-DXvZxabN.js";import"./utils-D2PLyMFF.js";import"./enums-CmIX1y88.js";import"./LRUCache-B_PHMSGm.js";import"./MemCache-Dx1v3xLC.js";import"./timeUtils-8fb_2oAt.js";import"./HeatmapColorStop-BJc5nbwr.js";import"./executeQueryJSON-Cis2sczl.js";import"./utils-6jMaHUrH.js";import"./query-Dw-gv3BA.js";import"./normalizeUtils-EVmAQ-ak.js";import"./normalizeUtilsCommon-dT81xWiM.js";import"./utils-Bema0iXE.js";import"./pbfQueryUtils-B0fU-MiS.js";import"./pbf-BtDZ1BpD.js";import"./OptimizedGeometry-BF8iz5FO.js";import"./OptimizedFeature-6cJ-QFG5.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./queryZScale-w66xFVGx.js";import"./projection-B971H0Re.js";import"./projectBuffer-Bs7GwaPY.js";import"./geodesicConstants-DWQLYX7F.js";import"./FeatureSet-BHEkYP03.js";import"./Field-ybkHhtnK.js";import"./fieldType-BuzM0UHS.js";import"./Query-5Xpquc1r.js";import"./DataLayerSource-BKkswDvG.js";import"./FullTextSearch-Csd1Hktu.js";import"./TimeExtent-DocT5yPf.js";import"./RelationshipQuery-DPPNeuLK.js";import"./themeUtils-C3zvZbsE.js";import"./shared-OyXfj1UM.js";import"./TimeOnly-DOn_Hy89.js";import"./UnknownTimeZone-BkowvBs8.js";import"./FeatureLayer-wa_7EIxE.js";import"./ClassBreaksRenderer-BuHwSyVK.js";import"./UniqueValueRenderer-BQtAHUSo.js";import"./diffUtils-BP7jmOAy.js";import"./colorRamps-pKd7I5WZ.js";import"./SizeVariable-936USOrb.js";import"./sizeVariableUtils-Cmcuvw-4.js";import"./visualVariableUtils-DX1kS9Se.js";import"./compilerUtils-Dw3R0f-Z.js";import"./lengthUtils-DL1-FDQQ.js";import"./jsonUtils-Ds2Sqto-.js";import"./defaults-DZ1kfMRx.js";import"./defaultsJSON-GKolV7NZ.js";import"./RendererLegendOptions-B-4se3aU.js";import"./styleUtils-BYTm14n3.js";import"./jsonUtils-DxpLMo6d.js";import"./Version-BSlAgupz.js";import"./FieldsIndex-DpwHKAMX.js";import"./OverrideHelper-ti072FkP.js";import"./colorUtils-aL8wj-8G.js";import"./vec42-YcqnINSP.js";import"./vec4f64-o2zAXfmz.js";import"./quantizationUtils-uj_P09aO.js";import"./heatmapUtils-Dwiv9IEa.js";import"./SimpleRenderer-BV2L9G_n.js";import"./MultiOriginJSONSupport-B5nfqtQh.js";import"./layerContainerType-C5CzMsLd.js";import"./FeatureLayerBase-Ck7-w8TE.js";import"./formUtils-ylzKAM7E.js";import"./HeightModelInfo-9nOoV6LU.js";import"./arcgisLayerUrl-BX1FE5Hm.js";import"./commonProperties-CPyIG_-u.js";import"./ElevationInfo-CA5m_tHv.js";import"./unitConversionUtils-BMfW9yAe.js";import"./AttributeTableTemplate-BZeVyq-j.js";import"./featureLayerUtils-DBsQMhTm.js";import"./featureQueryAll-DnVoEjkM.js";import"./LayerFloorInfo-CIQjg5Vk.js";import"./Relationship-COPq3qM4.js";import"./serviceCapabilitiesUtils-DAE5z8FP.js";import"./Layer-CVt7Hb5J.js";import"./workers-D4HfeYKj.js";import"./Queue-yu3bZ02p.js";import"./editsZScale-Bs7_pSzI.js";import"./APIKeyMixin-Di9kcRBS.js";import"./ArcGISService-B5qxetOY.js";import"./BlendLayer-CXM4n_Ge.js";import"./CustomParametersMixin-B4u7wiBT.js";import"./EditBusLayer-DoTks2sU.js";import"./uuid-fwrPAdZb.js";import"./FeatureEffectLayer-CpM66wLd.js";import"./FeatureEffect-BEzQmzeC.js";import"./FeatureFilter-BMHRQSxq.js";import"./FeatureReductionLayer-Ddbk727V.js";import"./FeatureReductionSelection-7vaL4DYT.js";import"./labelingInfo-DYPSPZCH.js";import"./labelUtils-B8petyBk.js";import"./MD5-C9MwAd2G.js";import"./OperationalLayer-CVyVfSPu.js";import"./OrderedLayer-C5VLMHgA.js";import"./OrderByInfo-IYmS1EXF.js";import"./PortalLayer-CKja4bdW.js";import"./portalItemUtils-BzVoFAku.js";import"./RefreshableLayer-D7lXUJRS.js";import"./ScaleRangeLayer-Bb8Ig1Hz.js";import"./TemporalLayer-Dpq2hKKV.js";import"./TimeInfo-LUiaSFyX.js";import"./TimeInterval-CNlkea1s.js";import"./FeatureTemplate-CssMa1yk.js";import"./FeatureType-C0q_coeM.js";import"./fieldProperties-Cgxj08ZE.js";import"./versionUtils-CQ_WhYSP.js";import"./styleUtils-KMFBtb6u.js";import"./popupUtils-BBuPGAHd.js";import"./AlphaCutoff-UcccL64p.js";import"./interfaces-CL2NbQte.js";import"./FeatureRelationshipViewModel-BPfZSJYn.js";import"./featureFormUtils-Cdlj8laq.js";import"./ReactiveMap-6CfRGOlR.js";import"./NetworkElement-CyYx535m.js";import"./Association-CIWSDxb_.js";import"./Spinner-CU_RHfq8.js";import"./AnchorElementViewModel-DhGwA7fN.js";import"./actions-nqvK7hqx.js";import"./ReactiveSet-BU2iaegS.js";import"./LayerConstants-B33OP6sh.js";import"./symbolUtils-_AKSLEsP.js";import"./mat2df32-orApM5a3.js";import"./mat2d-D9DBP-jx.js";import"./webStyleSymbolUtils-CwdsUGtV.js";import"./devEnvironmentUtils-CnNDiFMM.js";import"./layerViewUtils-DhFEu8Rd.js";import"./GoTo-Wtu9mgoE.js";const g="esri-popup",_=`${g}--is-docked`,h={base:g,baseHidden:`${g}--hidden`,main:`${g}__main-container`,shadow:`${g}--shadow`,isDocked:_,isDockedTopLeft:`${_}-top-left`,isDockedTopCenter:`${_}-top-center`,isDockedTopRight:`${_}-top-right`,isDockedBottomLeft:`${_}-bottom-left`,isDockedBottomCenter:`${_}-bottom-center`,isDockedBottomRight:`${_}-bottom-right`,alignTopCenter:`${g}--aligned-top-center`,alignBottomCenter:`${g}--aligned-bottom-center`,alignTopLeft:`${g}--aligned-top-left`,alignBottomLeft:`${g}--aligned-bottom-left`,alignTopRight:`${g}--aligned-top-right`,alignBottomRight:`${g}--aligned-bottom-right`,pointer:`${g}__pointer`,pointerDirection:`${g}__pointer-direction`};let A=class extends j{constructor(t){super(t)}};A=n([B("esri.widgets.Popup.PopupViewModel")],A);const T=A;let b=class extends I{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!0,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.heading=!0,this.spinner=!0}};n([l({type:Boolean,nonNullable:!0})],b.prototype,"actionBar",void 0),n([l({type:Boolean,nonNullable:!0})],b.prototype,"closeButton",void 0),n([l({type:Boolean,nonNullable:!0})],b.prototype,"collapseButton",void 0),n([l({type:Boolean,nonNullable:!0})],b.prototype,"featureNavigation",void 0),n([l({type:Boolean,nonNullable:!0})],b.prototype,"featureListLayerTitle",void 0),n([l({type:Boolean,nonNullable:!0})],b.prototype,"heading",void 0),n([l({type:Boolean,nonNullable:!0})],b.prototype,"spinner",void 0),b=n([B("esri.widgets.Popup.PopupVisibleElements")],b);const L=b,Q=200,$={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};let p=class extends G{constructor(t,e){super(t,e),this._dockAction=new U({id:"popup-dock-action"}),this._featuresWidget=new Y({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this._focusAbortController=null,this.alignment="auto",this.dockEnabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new T,this.visibleElements=new L}initialize(){this.addHandles([m(()=>{var t,e;return[(e=(t=this.viewModel)==null?void 0:t.view)==null?void 0:e.widthBreakpoint,this.dockEnabled]},()=>this._handleDockIcon(),u),m(()=>{var t,e;return[this.dockEnabled,(t=this.messages)==null?void 0:t.undock,(e=this.messages)==null?void 0:e.dock]},()=>this._handleDockEnabled(),u),m(()=>this.dockOptions,t=>{const{_dockAction:e}=this,i=this._featuresWidget.headerActions;i.remove(e),t.buttonEnabled&&i.add(e)},u),m(()=>{var t;return(t=this.viewModel)==null?void 0:t.screenLocation},()=>this._positionContainer()),m(()=>{var t;return[(t=this.viewModel)==null?void 0:t.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),m(()=>{var t,e,i,s,a,o,r;return[(t=this.viewModel)==null?void 0:t.screenLocation,(i=(e=this.viewModel)==null?void 0:e.view)==null?void 0:i.padding,(a=(s=this.viewModel)==null?void 0:s.view)==null?void 0:a.size,(o=this.viewModel)==null?void 0:o.active,(r=this.viewModel)==null?void 0:r.location,this.alignment]},()=>this.reposition()),m(()=>{var t,e;return(e=(t=this.viewModel)==null?void 0:t.view)==null?void 0:e.size},(t,e)=>this._updateDockEnabledForViewSize(t,e)),m(()=>{var t;return(t=this.viewModel)==null?void 0:t.view},(t,e)=>this._viewChange(t,e)),m(()=>{var t,e;return(e=(t=this.viewModel)==null?void 0:t.view)==null?void 0:e.ready},(t,e)=>this._viewReadyChange(t??!1,e??!1)),m(()=>this.viewModel,()=>this._featuresWidget.viewModel=this.viewModel,u),m(()=>this._featureNavigationTop,t=>this._featuresWidget.featureNavigationTop=t,u),m(()=>this.headingLevel,t=>this._featuresWidget.headingLevel=t,u),m(()=>this.visibleElements.actionBar,t=>this._featuresWidget.visibleElements.actionBar=!!t,u),m(()=>this.visibleElements.closeButton,t=>this._featuresWidget.visibleElements.closeButton=!!t,u),m(()=>this.visibleElements.collapseButton,t=>this._featuresWidget.visibleElements.collapseButton=!!t,u),m(()=>this.visibleElements.heading,t=>this._featuresWidget.visibleElements.heading=!!t,u),m(()=>this.visibleElements.spinner,t=>this._featuresWidget.visibleElements.spinner=!!t,u),m(()=>this.visibleElements.featureNavigation,t=>this._featuresWidget.visibleElements.featureNavigation=!!t,u),m(()=>this.visibleElements.featureListLayerTitle,t=>this._featuresWidget.visibleElements.featureListLayerTitle=!!t,u),z(()=>this._featuresWidget,"trigger-header-action",t=>{t.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)})])}normalizeCtorArgs(t){const e={...t};return(t==null?void 0:t.visibleElements)!=null&&(e.visibleElements=new L(t.visibleElements),t.collapseEnabled!=null&&(e.visibleElements.collapseButton=t.collapseEnabled),t.spinnerEnabled!=null&&(e.visibleElements.spinner=t.spinnerEnabled)),e}destroy(){var t,e;this._dockAction.destroy(),(t=this._featuresWidget)==null||t.destroy(),(e=this._focusAbortController)==null||e.abort()}get _featureNavigationTop(){const{currentAlignment:t,currentDockPosition:e}=this;return t==="bottom-left"||t==="bottom-center"||t==="bottom-right"||e==="top-left"||e==="top-center"||e==="top-right"}get actions(){return this.viewModel.actions}set actions(t){this.viewModel.actions=t}get active(){return this.viewModel.active}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(t){this.viewModel.autoCloseEnabled=t}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(t){this.viewModel.defaultPopupTemplateEnabled=t}get content(){return this.viewModel.content}set content(t){this.viewModel.content=t}get collapsed(){return this._featuresWidget.collapsed}set collapsed(t){this._featuresWidget.collapsed=t}get collapseEnabled(){return C(k.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton}set collapseEnabled(t){C(k.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton=t}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||$}set dockOptions(t){var c,d;const e={...$},i=(d=(c=this.viewModel)==null?void 0:c.view)==null?void 0:d.breakpoints,s={};i&&(s.width=i.xsmall,s.height=i.xsmall);const a={...e,...t},o={...e.breakpoint,...s},{breakpoint:r}=a;typeof r=="object"?a.breakpoint={...o,...r}:r&&(a.breakpoint=o),this._set("dockOptions",a),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(t){this.viewModel.featureMenuOpen=t}get features(){return this.viewModel.features}set features(t){this.viewModel.features=t}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(t){this.viewModel.goToOverride=t}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(t){this.viewModel.highlightEnabled=t}get icon(){return"popup"}set icon(t){this._overrideIfSome("icon",t)}get location(){return this.viewModel.location}set location(t){this.viewModel.location=t}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get promises(){return this.viewModel.promises}set promises(t){this.viewModel.promises=t}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(t){this.viewModel.selectedFeatureIndex=t}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get spinnerEnabled(){return C(k.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner}set spinnerEnabled(t){C(k.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner=t}get title(){return this.viewModel.title}set title(t){this.viewModel.title=t}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(t){this.viewModel.updateLocationEnabled=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}get visible(){return this.viewModel.visible}set visible(t){this.viewModel.visible=t}blur(){const{active:t}=this.viewModel;t||k.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(t,e){return this.viewModel.fetchFeatures(t,e)}focus(){const{active:t}=this.viewModel;t||k.getLogger(this).warn("Popup can only be focused when currently active."),this._handleFocus()}next(){return this.viewModel.next()}open(t){const e=!!t&&!!t.featureMenuOpen,i={collapsed:!!t&&!!t.collapsed,featureMenuOpen:e};this.set(i),this.viewModel.open(t),t!=null&&t.shouldFocus&&this._handleFocus(!0)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(t){return this.viewModel.triggerAction(t)}render(){var f,E,y,w;const{dockEnabled:t,currentAlignment:e,currentDockPosition:i}=this,{active:s,screenLocation:a}=this.viewModel,o=s&&t,r=s&&!t,c=(E=(f=this.selectedFeature)==null?void 0:f.layer)==null?void 0:E.title,d=(w=(y=this.selectedFeature)==null?void 0:y.layer)==null?void 0:w.id,v={[h.alignTopCenter]:e==="top-center",[h.alignBottomCenter]:e==="bottom-center",[h.alignTopLeft]:e==="top-left",[h.alignBottomLeft]:e==="bottom-left",[h.alignTopRight]:e==="top-right",[h.alignBottomRight]:e==="bottom-right",[h.isDocked]:o,[h.shadow]:r,[h.isDockedTopLeft]:i==="top-left",[h.isDockedTopCenter]:i==="top-center",[h.isDockedTopRight]:i==="top-right",[h.isDockedBottomLeft]:i==="bottom-left",[h.isDockedBottomCenter]:i==="bottom-center",[h.isDockedBottomRight]:i==="bottom-right"};return P("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,bind:this,class:this.classes(h.base,v,{[h.baseHidden]:!a&&!t}),"data-layer-id":d,"data-layer-title":c,role:"presentation"},s?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:P("div",{class:h.pointer,key:"popup-pointer",role:"presentation"},P("div",{class:this.classes(h.pointerDirection,h.shadow)}))}_renderMainContainer(){const{dockEnabled:t}=this,e={[h.shadow]:t};return P("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(h.main,J.widget,e)},this._featuresWidget.render())}_getAnimationDurationMS(){const{_containerNode:t}=this;return t?1e3*parseFloat(window.getComputedStyle(t).animationDuration):Q}async _handleFocus(t=!1){var i;(i=this._focusAbortController)==null||i.abort(),this._focusAbortController=new AbortController;const e=this._focusAbortController.signal;t&&await H(()=>{var s;return((s=this.viewModel)==null?void 0:s.active)===!0},{signal:e}),await O(S(e)),await O(R(this._getAnimationDurationMS(),e)),this._featuresWidget.focus()}_isOutsideView(t){const{popupHeight:e,popupWidth:i,screenLocation:s,side:a,view:o}=t;if(isNaN(i)||isNaN(e)||!o||!s)return!1;const r=o.padding;return a==="right"&&s.x+i/2>o.width-r.right||a==="left"&&s.x-i/2<r.left||a==="top"&&s.y-e<r.top||a==="bottom"&&s.y+e>o.height-r.bottom}_calculateAutoAlignment(t){if(t!=="auto")return t;const{_pointerOffsetInPx:e,_containerNode:i,_mainContainerNode:s,viewModel:a}=this,{screenLocation:o,view:r}=a;if(o==null||!r||!i)return"top-center";function c(V){return parseInt(V.replaceAll(/[^-\d.]/g,""),10)}const d=s?window.getComputedStyle(s,null):null,v=d?c(d.getPropertyValue("max-height")):0,f=d?c(d.getPropertyValue("height")):0,{height:E,width:y}=i.getBoundingClientRect(),w=y+e,M=Math.max(E,v,f)+e,W=this._isOutsideView({popupHeight:M,popupWidth:w,screenLocation:o,side:"right",view:r}),x=this._isOutsideView({popupHeight:M,popupWidth:w,screenLocation:o,side:"left",view:r}),D=this._isOutsideView({popupHeight:M,popupWidth:w,screenLocation:o,side:"top",view:r}),F=this._isOutsideView({popupHeight:M,popupWidth:w,screenLocation:o,side:"bottom",view:r});return x?D?"bottom-right":"top-right":W?D?"bottom-left":"top-left":D?F?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(t){return typeof t=="function"?t.call(this):t}_getCurrentAlignment(){const{alignment:t,dockEnabled:e}=this;return e||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(t)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(t){const e=["left","right"];return N(this.container)&&e.reverse(),t==null?void 0:t.replace(/leading/gi,e[0]).replaceAll(/trailing/gi,e[1])}_callDockPosition(t){return typeof t=="function"?t.call(this):t}_getDockPosition(){var t;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((t=this.dockOptions)==null?void 0:t.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(t){var r;if(t!=="auto")return t;const e=(r=this.viewModel)==null?void 0:r.view,i=N(this.container)?"top-left":"top-right";if(!e)return i;const s=e.padding||{left:0,right:0,top:0,bottom:0},a=e.width-s.left-s.right,{breakpoints:o}=e;return o&&a<=o.xsmall?"bottom-center":i}_getDockIcon(){const t=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(t){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){var t,e;this._dockAction.title=this.dockEnabled?(t=this.messages)==null?void 0:t.undock:(e=this.messages)==null?void 0:e.dock}_setMainContainerNode(t){this._mainContainerNode=t}_positionContainer(t=this._containerNode){if(t&&(this._containerNode=t),!this._containerNode)return;const{screenLocation:e}=this.viewModel,{width:i}=this._containerNode.getBoundingClientRect(),s=this._calculatePositionStyle(e,i);s&&Object.assign(this._containerNode.style,s)}_calculateFullWidth(t){const{currentAlignment:e,_pointerOffsetInPx:i}=this;return e==="top-left"||e==="bottom-left"||e==="top-right"||e==="bottom-right"?t+i:t}_calculateAlignmentPosition(t,e,i,s){const{currentAlignment:a,_pointerOffsetInPx:o}=this;if(!i)return;const{padding:r}=i,c=s/2,d=i.height-e,v=i.width-t;return a==="bottom-center"?{top:e+o-r.top,left:t-c-r.left}:a==="top-left"?{bottom:d+o-r.bottom,right:v+o-r.right}:a==="bottom-left"?{top:e+o-r.top,right:v+o-r.right}:a==="top-right"?{bottom:d+o-r.bottom,left:t+o-r.left}:a==="bottom-right"?{top:e+o-r.top,left:t+o-r.left}:a==="top-center"?{bottom:d+o-r.bottom,left:t-c-r.left}:void 0}_calculatePositionStyle(t,e){const{dockEnabled:i,view:s}=this;if(!s)return;if(i)return{left:"",top:"",right:"",bottom:""};if(t==null||!e)return;const a=this._calculateFullWidth(e),o=this._calculateAlignmentPosition(t.x,t.y,s,a);return o?{top:o.top!==void 0?`${o.top}px`:"auto",left:o.left!==void 0?`${o.left}px`:"auto",bottom:o.bottom!==void 0?`${o.bottom}px`:"auto",right:o.right!==void 0?`${o.right}px`:"auto"}:void 0}_viewChange(t,e){t&&e&&(this.close(),this.clear())}_viewReadyChange(t,e){t?this._wireUpView():e&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(t,e,i){const[s,a]=t,[o,r]=e,{width:c=0,height:d=0}=i??{};return s<=c&&o>c||s>c&&o<=c||a<=d&&r>d||a>d&&r<=d}_updateDockEnabledForViewSize(t,e){var v,f;if(!t||!e)return;const i=((f=(v=this.viewModel)==null?void 0:v.view)==null?void 0:f.padding)||{left:0,right:0,top:0,bottom:0},s=i.left+i.right,a=i.top+i.bottom,o=[],r=[];o[0]=t[0]-s,o[1]=t[1]-a,r[0]=e[0]-s,r[1]=e[1]-a;const{dockOptions:c}=this,d=c.breakpoint;this._dockingThresholdCrossed(o,r,d)&&this._setDockEnabledForViewSize(c),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){const{dockEnabled:t,viewModel:e}=this;if(!e)return;const i=e.active&&!t;e.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(t){var c,d;const e=t.breakpoint,i=(d=(c=this.viewModel)==null?void 0:c.view)==null?void 0:d.ui;if(!i)return!1;const{width:s,height:a}=i;if(isNaN(s)||isNaN(a)||!e)return!1;const o=e.hasOwnProperty("width")&&s<=(e.width??0),r=e.hasOwnProperty("height")&&a<=(e.height??0);return o||r}_setDockEnabledForViewSize(t){t.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(t))}};n([l({readOnly:!0})],p.prototype,"_featureNavigationTop",null),n([l()],p.prototype,"actions",null),n([l({readOnly:!0})],p.prototype,"active",null),n([l()],p.prototype,"alignment",void 0),n([l()],p.prototype,"autoCloseEnabled",null),n([l()],p.prototype,"defaultPopupTemplateEnabled",null),n([l()],p.prototype,"content",null),n([l()],p.prototype,"collapsed",null),n([l()],p.prototype,"collapseEnabled",null),n([l({readOnly:!0})],p.prototype,"currentAlignment",null),n([l({readOnly:!0})],p.prototype,"currentDockPosition",null),n([l()],p.prototype,"dockOptions",null),n([l()],p.prototype,"dockEnabled",void 0),n([l({readOnly:!0})],p.prototype,"featureCount",null),n([l()],p.prototype,"featureMenuOpen",null),n([l()],p.prototype,"features",null),n([l()],p.prototype,"goToOverride",null),n([l()],p.prototype,"headingLevel",void 0),n([l()],p.prototype,"highlightEnabled",null),n([l()],p.prototype,"icon",null),n([l()],p.prototype,"location",null),n([l()],p.prototype,"label",null),n([l(),q("esri/widgets/Popup/t9n/Popup")],p.prototype,"messages",void 0),n([l()],p.prototype,"promises",null),n([l({readOnly:!0})],p.prototype,"selectedFeature",null),n([l()],p.prototype,"selectedFeatureIndex",null),n([l({readOnly:!0})],p.prototype,"selectedFeatureWidget",null),n([l()],p.prototype,"spinnerEnabled",null),n([l()],p.prototype,"title",null),n([l()],p.prototype,"updateLocationEnabled",null),n([l()],p.prototype,"view",null),n([l({type:T}),K(["triggerAction","trigger-action"])],p.prototype,"viewModel",void 0),n([l()],p.prototype,"visible",null),n([l({type:L,nonNullable:!0})],p.prototype,"visibleElements",void 0),p=n([B("esri.widgets.Popup")],p);const qo=p;export{qo as default};
