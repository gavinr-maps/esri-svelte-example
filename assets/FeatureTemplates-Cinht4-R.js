const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./TextSymbol-BLIQ6RKX.js","./Accessor-BmwT4B0c.js","./Color-VJEMvW-n.js","./colorUtils-Rxh2V3ai.js","./mathUtils-Cfq9PL9W.js","./cast-CsZslgGN.js","./index-4eY77cms.js","./index-Cx51aysm.css","./JSONSupport-DcrLLGjL.js","./enumeration-DpvDkLNI.js","./screenUtils-_ZIvrt5o.js","./writer-DKgfqj4X.js","./index-DwIhxbHs.js","./jsxFactory-Cnml7uXM.js","./intl-Duiy0OzY.js","./Promise-DfET-uns.js","./Evented-Dw4_VOGn.js","./reactiveUtils-XM7cS2OP.js","./SimpleObservable-CvOkykwM.js","./uuid-Cl5lrJ4c.js","./dom-DEluURzl.js","./guid-ejniuQmw.js","./observers-Co4E8E8j.js","./index-CMxz6F2k.js","./useT9n-C1Hrfc-A.js","./index-pyEU_klK.js","./index-fFnlo_g2.js","./index-DWeq-ojO.js","./live-D7NQ-TrC.js","./directive-helpers-DaBykg1t.js","./keyed-CU1C-h1n.js","./ref-D9wHsL_T.js","./static-DLD4WjLv.js","./form-BzoUrXC7.js","./interactive-DTzfFku4.js","./key-CZcQa38B.js","./label-CHHpnzD0.js","./loadable-XBvaWFYY.js","./locale-CXx8I9ox.js","./component-CBVlbUuE.js","./Validation-BYp9DS84.js","./input-DI9tZAPS.js","./index-BCDLx0rN.js","./index-DyXGQ9Xl.js","./filter-D4A4y0z5.js","./escapeRegExp-CdLjXKbf.js","./debounce-DbkufipY.js","./utils-Dtivty39.js","./index-B0pN5y8B.js","./index-DVGzfobf.js","./floating-ui-IixYHfbQ.js","./openCloseComponent-nqWrSaIH.js","./dynamicClasses-pKEMtFzB.js","./index-BPm91e5Z.js","./index-C7Sgjfzm.js","./resources6-Cs2_VmEC.js","./index-XCNLEnDV.js","./customElement-_nG5icNK.js","./resources5-SciNIBSe.js","./index-CV25o1as.js","./resources4-Crg87oFz.js"])))=>i.map(i=>d[i]);
import{_ as S}from"./index-4eY77cms.js";import{o as D,g as H,r as o,m as a,a as F,B as k,k as te,D as M,s as v,bA as $e,i as ne}from"./Accessor-BmwT4B0c.js";import{V as A,w as ie,d as C,P as fe,A as Le,C as re,p as Ae,a as Ce}from"./reactiveUtils-XM7cS2OP.js";import{c as q,r as he,l as Fe,O as ke,k as Ee}from"./layerUtils-B__v9OBu.js";import{n as h,v as ye,O as Me,c as Ve,e as se}from"./jsxFactory-Cnml7uXM.js";import{i as ve}from"./Evented-Dw4_VOGn.js";import{h as ge}from"./UpdatingHandles-CzJ4c3KT.js";import{d as Ue,s as Oe,K as oe}from"./cast-CsZslgGN.js";import{m as xe,C as ae}from"./Portal-CmmHxpLg.js";import{p as Pe}from"./Promise-DfET-uns.js";import{s as De}from"./ReactiveMap-BHFEHYMj.js";import{s as He}from"./utils-DuOoxLAw.js";import{X as Be,I as Re}from"./VersionManagementService-B-6mIBcf.js";import{n as Ne}from"./Identifiable-BHVfzH03.js";import{e as je}from"./globalCss-vQlnDsEX.js";import{e as Ge}from"./Heading-BcR6CGTM.js";import{b as ze}from"./Graphic-Dt0LgVGU.js";import{e as le}from"./screenUtils-_ZIvrt5o.js";import{M as E}from"./opacityUtils-Dim20wpZ.js";import{L as qe}from"./symbolUtils-CHmFfSx2.js";import{e as Je}from"./vmEvent-D4Ubqkbq.js";const J={key:Symbol(),label:"Other​"};function be(e){return"templateInfos"in e}function Ke(e){const t=[];for(const{layer:n,templates:i}of e)for(const r of i)t.push({layer:n,template:r});return t}function We(e,t){const n=new Map;for(const i of e){const r=t(i),{key:s,label:d}=r.key!=null?r:J;D(n,s,()=>({label:d,templateInfos:[]})).templateInfos.push(i)}return Array.from(n.values())}function Qt(e,t){return{label:e.title??"",templateInfos:t.map(n=>({layer:e,template:n}))}}async function Xe(e,t){var n;return e.type==="subtype-sublayer"?await((n=e.parent)==null?void 0:n.load(t)):await e.load(t),e}function Qe(e){const t=new Map,n=[];for(const i of e)if($(i)){n.push(i);for(const r of i.items)t.set(r.template,r)}else t.set(i.template,i);return[t,n]}const $=e=>"items"in e;function Ye(e){return e.type==="feature"}function Ze(e){return e.type==="group"}function et(e){return e.type==="preset"}let y=class extends H{constructor(t){super(t),this.layers=new A,this.lockType="none",this.tables=new A,this.versionInfo=null,this.versionService=null}get layersAndTables(){return new A([...this.layers.toArray(),...this.tables.toArray()])}updateLockType(){this.lockType=this.versionInfo?this.versionService.getLockType(this.versionInfo.versionIdentifier)??"none":"none"}get featureServiceVersion(){var t;return((t=this.featureService.sourceJSON)==null?void 0:t.currentVersion)??0}};o([a({constructOnly:!0})],y.prototype,"canCreateVersion",void 0),o([a({constructOnly:!0})],y.prototype,"canEditVersionedData",void 0),o([a({constructOnly:!0})],y.prototype,"featureService",void 0),o([a({constructOnly:!0})],y.prototype,"layers",void 0),o([a()],y.prototype,"layersAndTables",null),o([a()],y.prototype,"lockType",void 0),o([a({constructOnly:!0})],y.prototype,"tables",void 0),o([a()],y.prototype,"versionInfo",void 0),o([a({constructOnly:!0})],y.prototype,"versionService",void 0),o([a()],y.prototype,"hasAdvancedEditingUserTypeExtension",void 0),o([a()],y.prototype,"loggedInServiceUser",void 0),o([a()],y.prototype,"featureServiceVersion",null),y=o([F("esri.undoredo.support.ServiceVersionInfo")],y);function tt(e){return!e||e.trim().length===0}const de=new Map;function nt(e){return D(de,e,()=>{const t=new w({view:e});return e.addHandles({remove(){de.delete(e),t.destroy()}}),t.load().catch(n=>{k.getLogger("esri.views.Services").error("Failed to load service metadata",n)}),t})}let w=class extends xe.LoadableMixin(Pe.EsriPromiseMixin(ve.EventedAccessor)){constructor(t){super(t),this._updatingHandles=new ge,this.items=new A,this.tablesAndLayersLookup=new De,this.additionalLayers=new A,this._debouncedCheckAndUpdateServiceInfos=te(async()=>{var i;const n=[];for(const r of this.items){if(r.layersAndTables.length===0)continue;const s=r.layersAndTables.getItemAt(0);(s==null?void 0:s.gdbVersion)!==((i=r.versionInfo)==null?void 0:i.versionIdentifier.name)&&n.push(r)}n.length!==0&&(await ie(()=>!this.updating),await this._updateVersionInfos(n))}),this._debouncedLayersChanged=te(async()=>{const n=this._detectNewLayersAndTables();n.length!==0&&(await ie(()=>!this._updatingHandles.updating),await this._updatingHandles.addPromise((async()=>{const i=new Set;for(const r of n)if(r.type==="feature"||r.type==="subtype-group"){if(!r.url)continue;const s=Ue(r.url).url.path,d=this._findServiceInfo(s);if(d)this.tablesAndLayersLookup.set(r,d),r.isTable?d.tables.push(r):d.layers.push(r);else if(!i.has(s))try{await this._addServiceInfo(s,r)}catch(l){k.getLogger(this).error(`Failed to load feature service: ${s}`,l)}finally{i.add(s)}}})()))}),this._processed=new Set}destroy(){this._set("view",null),this.items.removeAll(),this.tablesAndLayersLookup.clear()}async load(t){return M(t),this.addHandles([C(()=>this._allLayersAndTables,()=>{this._debouncedLayersChanged().catch(n=>{k.getLogger(this).warn("Failed to update service info",n)})}),C(()=>this.items.map(n=>n.layersAndTables.map(i=>i.gdbVersion??"").join(",")),()=>{this.checkAndUpdateServiceInfos().catch(n=>{k.getLogger(this).warn("Failed to update service info",n)})})]),this.addResolvingPromise(this._debouncedLayersChanged()),this}get updating(){return this.loadStatus==="loading"||this._updatingHandles.updating}checkAndUpdateServiceInfos(){return this._debouncedCheckAndUpdateServiceInfos()}changeVersion(t,n,i){return this._updatingHandles.addPromise((async()=>{await this._changeVersionInternal(t,n,i)})())}createVersion(t){return this._updatingHandles.addPromise((async()=>{var u;const n=t.featureServerUrl,i=this._findServiceInfo(n);if(!(i!=null&&i.versionService))throw new v("services:no-version-management-service");const r=i.hasAdvancedEditingUserTypeExtension,s=i.loggedInServiceUser.toUpperCase(),d=tt(t.ownerName)?s:(u=t.ownerName)==null?void 0:u.trim().toUpperCase();if(d!==s){if(i.featureServiceVersion<=11.1)throw new v("services:versioning-api-error");if(!r)throw new v("services:no-advanced-editing-user-type-extension")}if((d==null?void 0:d.toUpperCase())==="SDE"&&t.versionName.toUpperCase()==="DEFAULT")throw new v("services:no-valid-version-name");{const m=await i.versionService.getVersionInfos();if(m!=null&&m.find(c=>c.versionIdentifier.name.toUpperCase()===(d+"."+t.versionName).toUpperCase()||c.versionIdentifier.name.toUpperCase()===(s+"."+t.versionName).toUpperCase()))throw new v("services:no-valid-version-name")}const l=await i.versionService.createVersion({versionName:t.versionName,access:d!==s?"public":t.access,description:t.description});if(d!==s){const{guid:m,name:c}=l.versionIdentifier;await i.versionService.alterVersion({guid:m,name:c},{ownerName:d,access:t.access})}t.switchToVersion&&await this._changeVersionInternal(n,l.versionIdentifier.name,l.versionIdentifier.guid),this.emit("version-created",{versionIdentifier:l.versionIdentifier,versionManagementService:i.versionService})})())}deleteVersion(t,n,i){return this._updatingHandles.addPromise((async()=>{const r=this._findServiceInfo(t);if(!(r!=null&&r.versionService))throw new v("services:no-version-management-service");if(r.featureServiceVersion<=11.1)throw new v("services:versioning-api-error");if(!r.hasAdvancedEditingUserTypeExtension)throw new v("services:no-advanced-editing-user-type-extension");const s={name:n,guid:i};await r.versionService.deleteVersion(s)&&(await this._updateVersionInfo(r),this.emit("version-deleted",{versionIdentifier:s,versionManagementService:r.versionService}))})())}startEditing(t){return this._updatingHandles.addPromise((async()=>{var s;const n=this._findServiceInfo(t);if(!(n!=null&&n.versionService))throw new v("services:no-version-management-service");if(!n.hasAdvancedEditingUserTypeExtension)throw new v("services:no-advanced-editing-user-type-extension");const i=((s=n.versionInfo)==null?void 0:s.versionIdentifier)??{name:n.versionService.defaultVersionIdentifier.name,guid:n.versionService.defaultVersionIdentifier.guid};let r=!0;(n.versionService.getLockType(i)!=="none"||(r=await n.versionService.startReading(i),r))&&(r=await n.versionService.startEditing(i),n.updateLockType())})())}finishEditing(t,n){return this._updatingHandles.addPromise((async()=>{var d;const i=this._findServiceInfo(t);if(!(i!=null&&i.versionService))throw new v("services:no-version-management-service");if(!i.hasAdvancedEditingUserTypeExtension)throw new v("services:no-advanced-editing-user-type-extension");const r=((d=i.versionInfo)==null?void 0:d.versionIdentifier)??{name:i.versionService.defaultVersionIdentifier.name,guid:i.versionService.defaultVersionIdentifier.guid},s=i.versionService.getLockType(r);if(s!=="none")return s==="read"?(await i.versionService.stopReading(r),void i.updateLockType()):s==="edit"?(await i.versionService.stopEditing(r,n),await i.versionService.stopReading(r),void i.updateLockType()):void 0})())}async _changeVersionInternal(t,n,i){var l,u;const r=this._findServiceInfo(t);if(!(r!=null&&r.versionService))throw new v("services:no-version-management-service");const s=((l=r.versionInfo)==null?void 0:l.versionIdentifier)??{name:r.versionService.defaultVersionIdentifier.name,guid:r.versionService.defaultVersionIdentifier.guid},d={name:n,guid:i};await r.versionService.changeVersion((u=this.view)==null?void 0:u.map,s,d)&&await this._updateVersionInfo(r)}async _updateVersionInfo(t){var s;const n=t.versionService;if(!n||t.layersAndTables.length===0)return;const i=(s=t.layersAndTables.getItemAt(0))==null?void 0:s.gdbVersion,r=i?await n.getVersionIdentifierFromName(i):n.defaultVersionIdentifier;t.versionInfo=await n.getVersionInfoExtended(r)}_findServiceInfo(t){return this.items.find(n=>n.featureService.url===t)??null}_removeFeatureService(t){this.items.remove(t)}async _findPortal(t){var s;const n=(s=Oe)==null?void 0:s.findServerInfo(t??"");if(!(n!=null&&n.owningSystemUrl))return null;const i=`${n.owningSystemUrl}/sharing/rest`,r=ae.getDefault();return r!=null&&r.loaded&&oe(r.restUrl)===oe(i)?r:new ae({authMode:"immediate",url:n.owningSystemUrl}).load()}_updateVersionInfos(t){return this._updatingHandles.addPromise((async()=>{for(const n of t)await this._updateVersionInfo(n).catch(i=>{k.getLogger(this).error("Failed to update version details",i)})})())}async _addServiceInfo(t,n){var I;const i=new Be({url:t});await i.load();const r=await this._findPortal(t),s=(I=r==null?void 0:r.user)==null?void 0:I.username;let d=!1;s&&(d=await He(r,s,"advediting"));let l=null;i.versionManagementServiceUrl&&(l=new Re({url:i.versionManagementServiceUrl}),await l.load());const u=n.isTable?[]:[n],m=n.isTable?[n]:[],c=new y({loggedInServiceUser:s??"",hasAdvancedEditingUserTypeExtension:d,versionInfo:null,lockType:"none",canEditVersionedData:!0,canCreateVersion:!0,featureService:i,versionService:l,layers:new A(u),tables:new A(m)});return l&&await this._updateVersionInfo(c),this.items.push(c),this.tablesAndLayersLookup.set(n,c),n.isTable?c.tables.push(n):c.layers.push(n),c}get _allLayersAndTables(){return[...this.view.map.allLayers,...this.view.map.allTables,...this.additionalLayers]}_detectNewLayersAndTables(){const t=new Set(this._allLayersAndTables),n=[];for(const i of t)i.type!=="feature"&&i.type!=="subtype-group"||this._processed.has(i)||n.push(i);for(const i of this._processed)if(!t.has(i)&&(q(i)||he(i))){const r=this.tablesAndLayersLookup.get(i);if(!r)continue;this.tablesAndLayersLookup.delete(i),i.isTable?r.tables.remove(i):r.layers.remove(i),r.layersAndTables.length===0&&this._removeFeatureService(r)}return this._processed=t,n}};o([a({constructOnly:!0})],w.prototype,"view",void 0),o([a()],w.prototype,"items",void 0),o([a()],w.prototype,"tablesAndLayersLookup",void 0),o([a()],w.prototype,"additionalLayers",void 0),o([a()],w.prototype,"updating",null),o([a()],w.prototype,"_allLayersAndTables",null),w=o([F("esri.undoredo.support.Services")],w);const it=()=>k.getLogger("esri.editing.templateUtils");function rt(e){return e!=null&&"prototype"in e}function Ie(e){return K(e)&&!("definition"in e)}function B(e){return K(e)&&"definition"in e}function K(e){return e!=null&&"templateId"in e}function en(e){return B(e)&&(e==null?void 0:e.type)==="feature"&&(e.definition==null||Ye(e.definition))}function tn(e){return B(e)&&(e==null?void 0:e.type)==="group"&&(e.definition==null||Ze(e.definition))}function nn(e){return B(e)&&(e==null?void 0:e.type)==="preset"&&(e.definition==null||et(e.definition))}function rn(e){return B(e)&&(e==null?void 0:e.definition)!=null}const ue=e=>e==null||typeof e!="object"?[]:[..."templates"in e&&Array.isArray(e.templates)?e.templates:[],..."types"in e&&Array.isArray(e.types)?e.types.flatMap(t=>t.templates):[]];async function st(e,t,n){if(t==null)return e.map(l=>({layer:l,templates:ue(l)}));const i=await lt(e,t);M(n);const r=new Map,s=Array.from(i).map(l=>ot({serviceInfo:l,out:r,signal:n})),d=await Promise.allSettled(s);for(const l of d.filter(u=>u.status==="rejected"))it().warn("Failed to fetch shared templates for service. Will use standard templates if available.",l.reason);return e.map(l=>({layer:l,templates:r.get(l)??ue(l)}))}async function ot({serviceInfo:e,out:t,signal:n}){const{featureService:i,layersAndTables:r}=e,s=await at({featureService:i,layers:r.toArray(),signal:n});M(n);for(const[d,l]of s.entries())if(l.length!==0)if(q(d)){const u=ut(l),m=[],c=u.get(1/0)??m;for(const I of d.sublayers){const V=u.get(I.subtypeCode)??m;t.set(I,[...V,...c])}}else t.set(d,l)}async function at({featureService:e,layers:t,signal:n}){var d;if(!((d=e.capabilities)!=null&&d.editing.supportsSharedTemplates))return new Map;const i=new Map(t.map(l=>[l.layerId,l])),r=await e.querySharedTemplates({query:{layers:Array.from(i.keys())},requestOptions:{signal:n}}),s=new Map;for(const l of r)for(const u of l.layerIds)i.has(u)&&D(s,i.get(u),()=>[]).push(l);return s}async function lt(e,t){const n=await nt(t).load(),i=new Set;for(const r of e)$e(i,dt(n,r));return await Promise.all(Array.from(i).map(r=>r.featureService.load())),i}function dt(e,t){return Fe(t)&&t.parent?e.tablesAndLayersLookup.get(t.parent):he(t)?e.tablesAndLayersLookup.get(t):null}function ut(e){const t=new Map;for(const n of e)D(t,n.subtypeCode??1/0,()=>[]).push(n);return t}var G;let b=G=class extends H{constructor(e){super(e),this._activeFetchInfo={id:null,request:null},this.disabledFunction=null,this.layer=null,this.template=null,this.thumbnail=null}initialize(){this.addHandles(C(()=>{const{layer:e}=this;return[e&&"renderer"in e?e.renderer:null,this.template]},()=>{this._activeFetchInfo.id=null,this._activeFetchInfo.request=null,this._set("thumbnail",null)},fe))}get description(){var e;return(e=this.template)==null?void 0:e.description}set description(e){this.template&&(this.template.description=e)}get disabled(){var e;return((e=this.disabledFunction)==null?void 0:e.call(this,this))??!1}get label(){var e;return(e=this.template)==null?void 0:e.name}set label(e){this.template&&(this.template.name=e)}get id(){var e;return`${this.label??""}–${(e=this.layer)==null?void 0:e.id}`}get supportsUpload(){var e;return((e=this.layer)==null?void 0:e.type)==="scene"}clone(){const e=this.thumbnail!=null?this.thumbnail.cloneNode(!0):null,t=new G({layer:this.layer,template:this.template});return t._set("thumbnail",e),t}};o([a()],b.prototype,"description",null),o([a()],b.prototype,"disabled",null),o([a()],b.prototype,"disabledFunction",void 0),o([a()],b.prototype,"label",null),o([a()],b.prototype,"layer",void 0),o([a()],b.prototype,"template",void 0),o([a()],b.prototype,"thumbnail",void 0),o([a()],b.prototype,"id",null),o([a()],b.prototype,"supportsUpload",null),b=G=o([F("esri.widgets.FeatureTemplates.TemplateItem")],b);const ct=b;let T=class extends Ne.IdentifiableMixin(H){constructor(t){super(t),this.allItems=[],this.filterFunction=null,this.label=null}get items(){const{filterFunction:t}=this;return t==null||t(this)?this.allItems:this.allItems.filter(t)}get id(){return this.label}reapplyFilter(){this.notifyChange("filterFunction")}findByTemplate(t){return this.items.find(n=>n.template===t)}};o([a()],T.prototype,"allItems",void 0),o([a()],T.prototype,"filterFunction",void 0),o([a()],T.prototype,"items",null),o([a()],T.prototype,"label",void 0),o([a()],T.prototype,"id",null),T=o([F("esri.widgets.FeatureTemplates.TemplateItemGroup")],T);const pt=T,mt=({layer:e})=>({key:e,label:e.title??""}),ft=({layer:e})=>({key:e.geometryType,label:e.geometryType??""});let f=class extends ve.EventedAccessor{constructor(e){super(e),this._allItems=[],this._updatingHandles=new ge,this._updateTask=null,this.disabled=!1,this.disabledItemFunction=null,this.filterFunction=null,this.selectedItem=null,this.templateInfos=null,this.view=null}initialize(){this._get("groupBy")||(this.groupBy="layer"),this.addHandles([C(()=>[this.templateInfos,this.layers],([e],t)=>{e&&e===(t==null?void 0:t.at(0))||(this._updateTask=ne(this._updateTask),e?this._updateAllItems(e):this._getTemplatesAndUpdateAllItems())},Le),C(()=>this._groupByFunction,()=>{this.templateInfos==null&&(this._updateTask=ne(this._updateTask),this._getTemplatesAndUpdateAllItems())},re),C(()=>this.filterFunction,e=>{for(const t of this._allItems)$(t)&&(t.filterFunction=e)},re)])}set groupBy(e){if(this._set("groupBy",e),typeof e!="function")switch(e){case"layer":this._groupByFunction=mt;break;case"geometry":this._groupByFunction=ft;break;default:this._groupByFunction=null}else this._groupByFunction=t=>this._ensureGroupByObject(e(t))}get layers(){return this._get("layers")}set layers(e){const t="layers";if(this.removeHandles(t),e){const n=()=>this.notifyChange("state");this.addHandles(e.map(i=>Ae(()=>i.loadStatus,n)),t)}this._set("layers",e)}get state(){var e;return this.updating?"loading":this.layers.length!==0||(e=this.templateInfos)!=null&&e.length?"ready":"disabled"}get numberOfFeatureTemplates(){return this._allItems.reduce((e,t)=>$(t)?e+t.allItems.length:e+1,0)}get items(){const{filterFunction:e}=this;return e==null?this._allItems:this._allItems.filter(t=>$(t)?t.items.length>0:e(t))}get updating(){return this._updatingHandles.updating}refresh(){this.notifyChange("filterFunction");for(const e of this._allItems)$(e)&&e.reapplyFilter()}select(e,{emit:t=!0}={}){const n=this.selectedItem,i=(e==null?void 0:e.clone())||null;this._set("selectedItem",i),t&&this.emit("select",{item:i,oldItem:n,template:(i==null?void 0:i.template)??null})}_createItem(e,t){return new ct({disabledFunction:this.disabledItemFunction,layer:t,template:e})}_ensureGroupByObject(e){return typeof e=="string"?{key:e,label:e}:e}_updateAllItems(e){const t=this._allItems;if(e.length===0)return ht(t),void(this._allItems=[]);const[n,i]=Qe(t),r=l=>{const u=n.get(l.template);return u?(n.delete(l.template),u):this._createItem(l.template,l.layer)},{filterFunction:s}=this,d=e.filter(z).map(l=>be(l)?new pt({filterFunction:s,label:l.label,allItems:l.templateInfos.filter(z).map(u=>r(u))}):r(l));for(const l of[...n.values(),...i])l.destroy();this._allItems=d}async _getTemplatesFromLayers(e){const t=[],n={signal:e};await Promise.all(this.layers.map(async l=>{var m;await Xe(l,n),M(e);const u=(m=ke(l))==null?void 0:m.operations;u!=null&&u.supportsEditing&&(u!=null&&u.supportsAdd)&&(q(l)?t.push(...l.sublayers):t.push(l))}));const i=await st(t,this.view,e);M(e);const r=Ke(i),s=this._groupByFunction;if(s==null)return r;const d=We(r,s);return d.length===1&&d[0].label===J.label?d[0].templateInfos:d}async _getTemplatesAndUpdateAllItems(){if(this.layers.length===0)return;const e=Ce(async t=>{const n=await this._getTemplatesFromLayers(t);M(t),this._updateAllItems(n)});this._updateTask=e,this._updatingHandles.addPromise(e.promise)}};function ht(e){for(const t of e){if($(t))for(const n of t.items)n.destroy();t.destroy()}}function z(e){return be(e)?e.templateInfos.some(z):!K(e.template)||e.template.visible!==!1}o([a()],f.prototype,"_allItems",void 0),o([a()],f.prototype,"_groupByFunction",void 0),o([a()],f.prototype,"_updatingHandles",void 0),o([a()],f.prototype,"disabled",void 0),o([a()],f.prototype,"disabledItemFunction",void 0),o([a({value:null})],f.prototype,"filterFunction",void 0),o([a()],f.prototype,"groupBy",null),o([a({value:[]})],f.prototype,"layers",null),o([a()],f.prototype,"state",null),o([a({readOnly:!0})],f.prototype,"numberOfFeatureTemplates",null),o([a({readOnly:!0})],f.prototype,"items",null),o([a({readOnly:!0})],f.prototype,"selectedItem",void 0),o([a()],f.prototype,"templateInfos",void 0),o([a()],f.prototype,"updating",null),o([a()],f.prototype,"view",void 0),f=o([F("esri.widgets.FeatureTemplates.FeatureTemplatesViewModel")],f);const yt=f;let P=class extends H{constructor(e){super(e),this.filter=!0}};o([a({type:Boolean,nonNullable:!0})],P.prototype,"filter",void 0),P=o([F("esri.widgets.FeatureTemplates.VisibleElements")],P);const _e=P,L="esri-item-list",x=`${L}__list-item`,_={filterContainerSticky:`${L}__filter-container--sticky`,group:`${L}__group`,groupHeader:`${L}__group__header`,item:x,itemDisabled:`${x}--disabled`,itemIcon:`${x}-icon`,itemContentEnd:`${x}-content-end`,noMatchesMessage:`${L}__no-matches-message`,scroller:`${L}__scroller`,scrollerEnabled:`${L}__scroller--enabled`},vt=4;function gt(e){const{disabled:t,filterText:n="",id:i,messages:r,onFilterChange:s,...d}=e;return h("div",{key:i},e.filterEnabled??1?_t({disabled:t,filterText:n,id:i,messages:r,onFilterChange:s}):null,It({...d,disabled:t,enableListScroll:e.enableListScroll??!0,filterText:n,messages:r}))}function bt(e){return!!e.items}function It(e){const{headingLevel:t,items:n,...i}=e;return n.length===0?h("div",{class:_.noMatchesMessage,key:"no-matches"},e.messages.noMatches):h("div",{class:ye({[_.scroller]:!0,[_.scrollerEnabled]:!!e.enableListScroll}),key:"item-container"},n.map(r=>bt(r)?wt({...i,group:r,headingLevel:t}):we({...i,grouped:!0,item:r})))}function _t(e){const{disabled:t,messages:n,filterText:i,enableListScroll:r}=e;return h("div",{class:r?void 0:_.filterContainerSticky,key:"filter"},h("calcite-input",{disabled:t,placeholder:n.filterPlaceholder,type:"search",value:i,onCalciteInputInput:s=>{const d=s.currentTarget;e.onFilterChange&&e.onFilterChange(d.value)}}))}function we(e){const{disabled:t,grouped:n,identify:i,item:r,onItemMouseEnter:s,onItemMouseLeave:d,onItemSelect:l,renderIcon:u,renderCustomItem:m,renderItemContent:c,renderItemContentEnd:I,renderItemLabel:V,renderItemDescription:R,renderItemActionEnd:N,renderItemTitle:j,selectedItem:Se}=e,W=ce(r,i),X=W===ce(Se,i),Q=m==null?void 0:m(e);if(Q)return Q;const O=c==null?void 0:c(r),Y=I==null?void 0:I(r),Te=N==null?void 0:N(r),Z=!(!r.disabled&&!t),ee=u==null?void 0:u(r);return h("calcite-list-item",{afterUpdate:g=>{g.selected=X},"aria-level":n?"2":"",class:ye({[_.item]:!0,[_.itemDisabled]:Z}),"data-item":r,description:O?void 0:(R==null?void 0:R(r))??void 0,disabled:Z,key:W,label:O?void 0:(V==null?void 0:V(r))??r.label??void 0,onblur:g=>d==null?void 0:d(U(g)),onfocus:g=>s==null?void 0:s(U(g)),onmouseenter:g=>s==null?void 0:s(U(g)),onmouseleave:g=>d==null?void 0:d(U(g)),selected:X,title:(j==null?void 0:j(r))??void 0,onCalciteListItemSelect:g=>{g.preventDefault(),l==null||l(U(g))}},ee?h("div",{class:_.itemIcon,key:"content-start",slot:"content-start"},ee):void 0,O?h("div",{key:"content",slot:"content"},O):null,Y?h("div",{class:_.itemContentEnd,key:"content-end",slot:"content-end"},Y):null,Te??null)}function ce(e,t){return e?`${(t==null?void 0:t(e))||e.id}__${e.label}`:""}function U(e){return e.currentTarget["data-item"]}function wt(e){const{disabled:t,group:n,headingLevel:i=vt,selectionMode:r="none",renderCustomGroupContent:s,...d}=e,l=s==null?void 0:s(e);return h("div",{class:_.group,key:n.label??void 0},h(Ge,{class:_.groupHeader,level:i},n.label),l||h("calcite-list",{disabled:t,label:n.label??"",selectionAppearance:"border",selectionMode:r},n.items.map(u=>we({...d,disabled:t,item:u,grouped:!0}))))}async function St(e,t,n){var s;if(!E(e)&&Ie(e)&&e.thumbnail){const d=`data:image/png;base64,${e.thumbnail.imageData}`,l=document.createElement("div");return l.classList.add("esri-thumbnail-preview"),"geometryType"in t&&t.geometryType&&l.classList.add(`esri-thumbnail-preview--${t.geometryType}`),l.style.backgroundImage=`url(${d})`,l}const i=await Tt(t,e);if(i==null)return null;const r={maxSize:le(32)};if((E(e)||rt(e))&&"renderer"in t&&((s=t.renderer)==null?void 0:s.type)==="dictionary"&&(r.fieldMap=t.renderer.fieldMap??void 0,r.feature=E(e)?e:{attributes:e.prototype.attributes??{}}),E(e)&&e.geometry&&(n==null?void 0:n.useGeometry)!==!1&&!e.geometry.type.includes("point")){r.geometry=e.geometry,r.useMarkerSymbolSize=!1;const d=le(22);r.size={width:d,height:d}}return await qe(i,r)}async function Tt(e,t){if(!E(t)&&Ie(t))return pe(e);if("renderer"in e&&e.renderer){const{renderer:n}=e,i=E(t)?t:new ze({attributes:t.prototype.attributes});if("getSymbolAsync"in n){const r=await n.getSymbolAsync(i);if(r)return r}}return pe(e)}async function pe(e){if(!("geometryType"in e))return null;const{geometryType:t}=e,n=t==="point"||t==="multipoint"?await S(()=>import("./TextSymbol-BLIQ6RKX.js").then(i=>i.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url):t==="polyline"?await S(()=>import("./TextSymbol-BLIQ6RKX.js").then(i=>i.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url):t==="polygon"||t==="mesh"||t==="multipatch"?await S(()=>import("./TextSymbol-BLIQ6RKX.js").then(i=>i.j),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url):null;return n?new n.default:null}const $t={base:"esri-feature-templates"};function Lt(e){return e.length>0&&$(e[0])}function At(e){return e.id}let p=class extends Me{constructor(e,t){super(e,t),this.enableListScroll=!0,this.filterText="",this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.selectionMode="none",this.viewModel=new yt,this.visibleElements=new _e,this.renderCustomItem=n=>null,this.renderCustomGroupContent=n=>null,this.renderItemLabel=()=>null,this.renderItemDescription=()=>null,this.renderItemContent=n=>null,this.renderItemContentEnd=n=>null,this._iconIntersectionObserver=new IntersectionObserver((n,i)=>{n.forEach(async r=>{if(r.isIntersecting){const s=r.target;if(Ft(s))return void i.unobserve(s);const d=Ct(s),{layer:l,template:u}=d;me(s,!0);const m=await St(u,l).catch(()=>(me(s,!1),null));if(m==null)return;s.appendChild(m)}})}),this._renderItemIcon=n=>Ee(n.layer)?h("span",{"data-has-icon":!0,"data-item":n,key:"icon"},h("calcite-icon",{icon:"table"})):h("span",{afterCreate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,afterUpdate:this._afterItemCreateOrUpdate,"data-has-icon":!1,"data-item":n,key:"icon"}),this._afterItemCreateOrUpdate=n=>{var i;(i=this._iconIntersectionObserver)==null||i.observe(n)},this._afterItemRemoved=n=>{var i;(i=this._iconIntersectionObserver)==null||i.unobserve(n)}}initialize(){const e=({label:t})=>!this.filterText||!!(t!=null&&t.toLowerCase().includes(this.filterText.toLowerCase()));this.addHandles(C(()=>this.viewModel,(t,n)=>{t&&!t.filterFunction&&(this.filterFunction=e),n&&n!==t&&n.filterFunction===e&&(n.filterFunction=null)},fe))}destroy(){var e;(e=this._iconIntersectionObserver)==null||e.disconnect(),this._iconIntersectionObserver=null}loadDependencies(){return Ve({icon:()=>S(()=>import("./index-DwIhxbHs.js").then(e=>e.i),__vite__mapDeps([12,13,1,14,15,5,6,7,8,16,17,18,19,20,21,22]),import.meta.url),loader:()=>S(()=>import("./index-CMxz6F2k.js"),__vite__mapDeps([23,13,1,14,15,5,6,7,8,16,17,18,19,21,24]),import.meta.url),input:()=>S(()=>import("./index-pyEU_klK.js"),__vite__mapDeps([25,12,13,1,14,15,5,6,7,8,16,17,18,19,20,21,22,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,24,41]),import.meta.url),list:()=>S(()=>import("./index-BCDLx0rN.js"),__vite__mapDeps([42,23,13,1,14,15,5,6,7,8,16,17,18,19,21,24,43,31,29,22,20,30,12,26,27,25,28,32,33,34,35,36,37,38,39,40,41,44,45,46,47]),import.meta.url),"list-item":()=>S(()=>import("./index-B0pN5y8B.js"),__vite__mapDeps([48,12,13,1,14,15,5,6,7,8,16,17,18,19,20,21,22,49,31,29,50,46,34,35,37,51,52,23,24,53,30,39,54,55,56,57,47,58]),import.meta.url),notice:()=>S(()=>import("./index-CV25o1as.js"),__vite__mapDeps([59,12,13,1,14,15,5,6,7,8,16,17,18,19,20,21,22,31,29,37,60,51,39,24]),import.meta.url)})}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get filterFunction(){return this.viewModel.filterFunction}set filterFunction(e){this.viewModel.filterFunction=e}get groupBy(){return this.viewModel.groupBy}set groupBy(e){this.viewModel.groupBy=e}get icon(){return"list-rectangle"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get layers(){return this.viewModel.layers}set layers(e){this.viewModel.layers=e}get selectedItem(){return this.viewModel.selectedItem}select(e,t){return this.viewModel.select(e,t)}render(){const{disabled:e,enableListScroll:t,filterText:n,headingLevel:i,messages:r,viewModel:{items:s,numberOfFeatureTemplates:d,selectedItem:l,state:u}}=this,m=this.visibleElements.filter&&d>1;if(Lt(s)){const c=s.find(I=>I.label===J.label);c&&(c.label=r.other)}return h("div",{"aria-label":r.widgetLabel,class:this.classes($t.base,je.widget)},u==="loading"?h("calcite-loader",{key:"loader",label:this.messagesCommon.loading,type:"indeterminate"}):u==="ready"?h(gt,{disabled:e,enableListScroll:t,filterEnabled:m,filterText:n,headingLevel:i,id:this.id,identify:At,items:s,messages:{filterPlaceholder:r.filterPlaceholder,noItems:r.noItems,noMatches:r.noMatches},renderCustomGroupContent:this.renderCustomGroupContent,renderCustomItem:this.renderCustomItem,renderIcon:this._renderItemIcon,renderItemContent:this.renderItemContent,renderItemContentEnd:this.renderItemContentEnd,renderItemDescription:this.renderItemDescription,renderItemLabel:this.renderItemLabel,selectedItem:l??void 0,selectionMode:this.selectionMode??void 0,onFilterChange:c=>{this.filterText=c},onItemSelect:c=>!$(c)&&this.viewModel.select(c)}):null)}};function Ct(e){return e==null?void 0:e["data-item"]}function Ft(e){return!!(e!=null&&e["data-has-icon"])}function me(e,t){e&&(e["data-has-icon"]=t)}o([a()],p.prototype,"disabled",null),o([a()],p.prototype,"enableListScroll",void 0),o([a()],p.prototype,"filterFunction",null),o([a()],p.prototype,"filterText",void 0),o([a()],p.prototype,"groupBy",null),o([a()],p.prototype,"headingLevel",void 0),o([a()],p.prototype,"icon",null),o([a()],p.prototype,"label",null),o([a()],p.prototype,"layers",null),o([a(),se("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],p.prototype,"messages",void 0),o([a(),se("esri/t9n/common")],p.prototype,"messagesCommon",void 0),o([a({readOnly:!0})],p.prototype,"selectedItem",null),o([a()],p.prototype,"selectionMode",void 0),o([a(),Je("select")],p.prototype,"viewModel",void 0),o([a({type:_e,nonNullable:!0})],p.prototype,"visibleElements",void 0),o([a()],p.prototype,"renderCustomItem",void 0),o([a()],p.prototype,"renderCustomGroupContent",void 0),o([a()],p.prototype,"renderItemLabel",void 0),o([a()],p.prototype,"renderItemDescription",void 0),o([a()],p.prototype,"renderItemContent",void 0),o([a()],p.prototype,"renderItemContentEnd",void 0),p=o([F("esri.widgets.FeatureTemplates")],p);const on=p;export{nn as A,on as F,yt as H,nt as T,St as a,st as b,rt as c,K as d,en as g,Qt as l,we as m,gt as s,Ye as t,rn as v,tn as w,B as y};
