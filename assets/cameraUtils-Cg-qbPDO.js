import{d as Ge}from"./Camera-CdyTfTAk.js";import{n as Ue,r as Wn}from"./Cyclical-Dlbl-cQK.js";import{B as Xn,D as N}from"./Accessor-BmwT4B0c.js";import{M as C,b as Pe,s as E,l as Se,o as We,r as Kn}from"./mathUtils-Cfq9PL9W.js";import{s as w,v as cn,g as S,c as ue,u as fe,P as x,r as I,K as Yn,A as pe,_ as Q,E as Me,q as He,o as Zn,p as ye,I as Qn,X as Xe,y as Vn,W as et}from"./vec32-Dvg_eL9J.js";import{n as f,r as te,_ as Ke,t as ln}from"./vec3f64-BLpZdpfb.js";import{C as me,g as ze,E as nt,j as $}from"./Point-Cz2JYYmX.js";import{O as un,J as tt}from"./projection-CyCZAIaD.js";import{c as $e,i as rt}from"./projectPointToVector-BoxjK-qy.js";import{t as je,c as fn}from"./projectVectorToPoint-DEm8-dt4.js";import{n as Ee}from"./projectVectorToVector-CCOy_B5J.js";import{l as pn}from"./ViewingMode-Dodu7ZZk.js";import{L as it,j as Le,g as mn}from"./Polyline-s-JzsQqo.js";import{T as at}from"./Intersector-tBiZcjSu.js";import{R as ot,l as st,p as ct,b as lt}from"./mat4-Fi6iAz29.js";import{e as dn}from"./mat4f64-Dk4dwAN8.js";import{n as ut,r as Ye,t as ft}from"./vec2f64-Dy6m9Nrb.js";import{w as hn}from"./Extent-g5W9hy0j.js";import{H as pt,I as mt,L as dt,P as ht,s as Tt,u as Rt,d as gt,l as _t,v as Mt,c as z,j as Tn}from"./Octree-CmoRJhci.js";import{T as yt}from"./vec2-ChnYg_BJ.js";import{k as Rn,Q as $t,L as Et,E as At}from"./sphere-Cin5efBj.js";import{m as Ot,b as vt,v as St}from"./lineSegment-v806maA5.js";import{q as wt,l as Ze,M as Qe,z as Ve,Z as It,d as Ft,W as ae,O as xt}from"./plane-CpXmOyqq.js";import{s as bt,p as Nt}from"./vec42-YcqnINSP.js";import{n as Pt}from"./vec4f64-o2zAXfmz.js";import{e as gn}from"./common-DQOJ18NT.js";import{l as Ht,s as Lt}from"./earthUtils-8WLQbUUl.js";import{j as Ct}from"./mathUtils-BgCEaV43.js";import{a as _n}from"./ElevationProvider-aS5xrHHy.js";import{r as Dt}from"./spatialReferenceSupport-DfixDcu7.js";function Ti(e,n,t,r){return e.renderCoordsHelper.fromRenderCoords(n.eye,Ae,r)!=null&&it(t,Ae)}function Gt(e,n){return e.elevationProvider?e.elevationProvider.getElevation(n[0],n[1],n[2],e.renderCoordsHelper.spatialReference,"ground")??0:0}function Ut(e,n,t,r){const i=e.state.camera.clone();n&&t&&r&&(i.eye=n,i.center=t,i.up=r),zt(e,i.ray,j)||w(j,i.center);const a=e.state.constraints,o=a.minimumPoiDistance;if(cn(i.eye,j)<o){const s=a.collision.enabled;w(Z,i.viewForward),S(Z,Z,o),s?i.eye=ue(Ae,j,Z):fe(j,i.eye,Z);const c=e.renderCoordsHelper,l=c.getAltitude(i.eye),u=a.collision.elevationMargin;s&&l<u&&(ue(Z,j,i.eye),i.eye=c.setAltitude(Ae,u,i.eye),fe(j,i.eye,Z))}return i.center=j,i}function en(e,n,t){if(!e.state.isGlobal||!e.stateManager.constraintsManager)return!1;const r=Gt(e,n),i=e.stateManager.constraintsManager.nearFarHeuristic,{far:a}=i.compute(n,t,e.renderDataExtent,r,Bt),o=a*a;return cn(n,t)>o}function zt(e,n,t){let r=nn[e.viewingMode];r||(r=at(e.state.viewingMode),r.options.backfacesTerrain=!e.state.isGlobal,r.options.invisibleTerrain=!0,nn[e.viewingMode]=r);const{isGlobal:i}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(n,r,t)||en(e,n.origin,t))||!(!e.renderCoordsHelper.intersectManifold(n,0,t)||en(e,n.origin,t))||!!i&&jt(n,t,me(e.spatialReference).radius)}function jt(e,n,t){const r=x(e.origin,e.origin)-t*t,i=r>0?Math.sqrt(r)/3:1;return S(n,e.direction,i/I(e.direction)),fe(n,n,e.origin),!0}const nn={},Ae=f(),j=f(),Z=f(),Bt={near:0,far:0};function qt(e,n){const t=[],r=[];return Te(t,e,n,b.LEFT),Te(r,t,n,b.BOTTOM),Te(t,r,n,b.RIGHT),Te(r,t,n,b.TOP),r}function Te(e,n,t,r){const i=kt(t,r);if(e.length=0,n.length){i(Re,n[0],n[0])===O.INSIDE&&oe(e,n[0]);for(let a=0;a<n.length;a++){const o=n[a===n.length-1?0:a+1];switch(i(Re,n[a],o)){case O.INSIDE:oe(e,o);break;case O.INSIDE_OUT:oe(e,Ye(Re));break;case O.OUTSIDE_IN:oe(e,Ye(Re)),oe(e,o);case O.OUTSIDE:}}}}function oe(e,n){e.length!==0&&yt(e.at(-1),n)||e.push(n)}function kt(e,n){const t=n===b.LEFT||n===b.RIGHT?0:1,r=e[n],i=n===b.LEFT||n===b.BOTTOM?ne.MIN:ne.MAX,a=t===0?1:0;return(o,s,c)=>{if(s[t]<r&&c[t]<r)return i===ne.MIN?O.OUTSIDE:O.INSIDE;if(s[t]>r&&c[t]>r)return i===ne.MIN?O.INSIDE:O.OUTSIDE;const l=(c[a]-s[a])/(c[t]-s[t]),u=s[a]+l*(r-s[t]);return o[t]=r,o[a]=u,(s[t]<r?1:-1)*i>0?O.OUTSIDE_IN:O.INSIDE_OUT}}var ne,O,b;(function(e){e[e.MIN=1]="MIN",e[e.MAX=-1]="MAX"})(ne||(ne={})),function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INSIDE=1]="INSIDE",e[e.OUTSIDE_IN=2]="OUTSIDE_IN",e[e.INSIDE_OUT=3]="INSIDE_OUT"}(O||(O={})),function(e){e[e.LEFT=0]="LEFT",e[e.BOTTOM=1]="BOTTOM",e[e.RIGHT=2]="RIGHT",e[e.TOP=3]="TOP"}(b||(b={}));const Re=ut();let tn=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(n){this.renderCoordsHelper=n,this.frustum=pt(),this._points=mt(),this.lines=new Array(12),this._origin=f(),this._direction=f(),this._altitude=null;for(let t=0;t<12;t++)this.lines[t]={origin:null,direction:f(),endpoint:null}}update(n){dt(n.viewMatrix,n.projectionMatrix,this.frustum,this._points),w(this._origin,n.eye),w(this._direction,n.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(n){for(let t=0;t<this._points.length;t++)w(this._points[t],n[t]);ht(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(n){return Tt(this.frustum,n)}intersectsRay(n){return Rt(this.frustum,n)}intersectsLineSegment(n,t){return gt(this.frustum,n,t)}intersectsPoint(n){return _t(this.frustum,n)}_updateLines(){const n=this._points;for(let t=0;t<4;t++){const r=t+4;Fe(this.lines[t],n[t],n[r]),Fe(this.lines[t+4],n[t],t===3?n[0]:n[t+1]),Fe(this.lines[t+8],n[r],t===3?n[4]:n[r+1])}}};var L;function Fe(e,n,t){e.origin=n,e.endpoint=t,Yn(e.direction,n,t)}tn.planePointIndices=Mt,tn.nearFarLineIndices=[[z.NEAR_BOTTOM_LEFT,z.FAR_BOTTOM_LEFT],[z.NEAR_BOTTOM_RIGHT,z.FAR_BOTTOM_RIGHT],[z.NEAR_TOP_RIGHT,z.FAR_TOP_RIGHT],[z.NEAR_TOP_LEFT,z.FAR_TOP_LEFT]],function(e){e[e.NEAR_FAR_BOTTOM_LEFT=0]="NEAR_FAR_BOTTOM_LEFT",e[e.NEAR_FAR_BOTTOM_RIGHT=1]="NEAR_FAR_BOTTOM_RIGHT",e[e.NEAR_FAR_TOP_RIGHT=2]="NEAR_FAR_TOP_RIGHT",e[e.NEAR_FAR_TOP_LEFT=3]="NEAR_FAR_TOP_LEFT",e[e.NEAR_BOTTOM=4]="NEAR_BOTTOM",e[e.NEAR_RIGHT=5]="NEAR_RIGHT",e[e.NEAR_TOP=6]="NEAR_TOP",e[e.NEAR_LEFT=7]="NEAR_LEFT",e[e.FAR_BOTTOM=8]="FAR_BOTTOM",e[e.FAR_RIGHT=9]="FAR_RIGHT",e[e.FAR_TOP=10]="FAR_TOP",e[e.FAR_LEFT=11]="FAR_LEFT"}(L||(L={}));const Jt=f(),ge=f();function Mn(){return{direction:f(),up:f()}}function yn(e,n,t,r,i){let a=pe(Jt,e),o=x(a,r);const s=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(x(n,r)),o<.99?(w(a,n),s&&S(a,a,-1)):a=null);let c=0;if(a){S(ge,r,x(r,a)),ue(a,a,ge);const u=x(a,i)/(I(a)*I(i));Q(ge,a,i),c=(x(ge,r)>0?1:-1)*C(Pe(u))}const l=C(Pe(-x(r,e)/I(e)));return t?(t.heading=c,t.tilt=l,t):{heading:c,tilt:l}}function $n(e,n,t,r){ue(rn,t,n),wt(r,Ot(n,rn),e)||e===t||w(e,t)}const rn=f(),En=te(0,1,0),An=te(0,0,1),se=dn(),P=f(),H=f();function On(e,n,t,r=Mn()){const{direction:i,up:a}=r;return ot(se,-E(n)),st(se,se,E(t)),Me(i,An,se),S(i,i,-1),Me(a,En,se),r}function Wt(e,n,t,r){return yn(n,t,r,An,En)}function Xt(e,n,t,r){const i=On(e,t,r),a=f();return S(a,i.direction,-n),fe(a,a,e),{up:i.up,eye:a,heading:t,tilt:r}}function Kt(e){return C(e)}function Yt(e){return E(e)}function Zt(e,n,t,r,i){const a=e.renderSpatialReference,o=e.spatialReference??n.spatialReference;return $e(n,P,a),$e(n,H,a),P[0]-=t/2,H[0]+=t/2,P[1]-=r/2,H[1]+=r/2,Ee(P,a,P,o),Ee(H,a,H,o),i?(i.xmin=P[0],i.ymin=P[1],i.xmax=H[0],i.ymax=H[1],i.spatialReference=o):i=new hn(P[0],P[1],H[0],H[1],o),i}function Qt(e,n){const t=e.frustum,{renderCoordsHelper:r}=e,i=r.getAltitude(n),a=e.spatialReference,o=e.state.camera.eye,s=[],c=t.planes[Tn.FAR];for(let l=0;l<4;l++){const u=t.lines[l];r.intersectInfiniteManifold(Rn(u.origin,u.direction),i,v)||Vt(v,t,r,u.endpoint,i),$n(v,o,v,c),s.push(ft(v[0],v[1]))}return er(qt(s,r.extent),r,a)}function Vt(e,n,t,r,i){const a=n.lines[L.FAR_LEFT].direction,o=(i-t.getAltitude(r))/a[2];He(e,r,a,o)}function er(e,n,t){const r=e.map(i=>(Zn(v,i[0],i[1],0),n.fromRenderCoords(v,v,t),[v[0],v[1]]));return r.length<=2?new Le({spatialReference:t}):(r.push(r[0].slice()),mn(r)||r.reverse(),new Le({rings:[r],spatialReference:t}))}const v=f(),nr=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Wt,eyeForCenterWithHeadingTilt:Xt,eyeTiltToLookAtTilt:Yt,headingTiltToDirectionUp:On,lookAtTiltToEyeTilt:Kt,toArea:Qt,toExtent:Zt},Symbol.toStringTag,{value:"Module"}));function tr(e,n,t){e.worldUpAtPosition(n,an),ue(xe,t,n);const r=I(xe);return r===0?0:Pe(x(xe,an)/r)}const an=f(),xe=f(),vn=te(0,0,1),Sn=pe(f(),te(1,1,1)),rr=new Ue(-180,180),ce=dn(),B=f(),V=f();function wn(e,n,t,r=Mn()){Q(B,e,vn),x(B,B)===0&&Q(B,e,Sn),ct(ce,-E(n),e),lt(ce,ce,-E(t),B);const{up:i,direction:a}=r;return Q(i,B,e),pe(i,i),Me(i,i,ce),pe(a,e),Vn(a,a),Me(a,a,ce),r}function ir(e,n,t,r){const i=B,a=V;return pe(i,e),Q(V,i,vn),x(V,V)===0&&Q(V,i,Sn),Q(a,V,i),yn(n,t,r,i,a)}function ar(e,n,t,r){const i={eye:f(),up:null,tilt:r,heading:t},a=B;a[0]=e[0],a[1]=e[2],a[2]=-e[1];const o=n,s=E(t),c=E(r),l=Math.sin(s),u=Math.cos(s),p=Math.sin(c),m=Math.cos(c),h=I(a);let d;if(Math.abs(c)<1e-8)d=o+h;else{const de=h/p,he=Se(o/de),Ie=Math.PI-c-he;d=de*Math.sin(Ie)}const T=m*o,F=o*o*(p*p),A=u*u*F,y=d-T,R=y*y,g=A*(A+R-a[1]*a[1]);if(g<0)return S(i.eye,a,d/h),i.tilt=0,_e(i,e);const D=Math.sqrt(g),J=a[1]*y,G=A+R;let W;if(W=u>0?-D+J:D+J,Math.abs(G)<1e-8)return h<1e-8?(i.eye[0]=0,i.eye[1]=0,i.eye[2]=o):S(i.eye,a,d/h),i.tilt=0,be(i.eye),_e(i,e);i.eye[1]=W/G;const _=l*l*F,X=p*o,we=u*X*i.eye[1],ie=i.eye[1]*i.eye[1],K=1-ie,U=Math.sqrt(K),Y=A*ie+_-2*we*U*y+K*R;return Math.abs(Y)<1e-8?(S(i.eye,a,d/h),i.tilt=0,be(i.eye),_e(i,e)):(i.eye[0]=(K*(d*a[0]-T*a[0])-X*U*(a[0]*i.eye[1]*u+a[2]*l))/Y,i.eye[2]=(K*(d*a[2]-T*a[2])-X*U*(a[2]*i.eye[1]*u-a[0]*l))/Y,S(i.eye,i.eye,d),be(i.eye),_e(i,e))}function be(e){const n=e[1];e[1]=-e[2],e[2]=n}function _e(e,n){const t=wn(n,e.heading,e.tilt);return e.up=t.up,e}function or(e,n,t){const r=I(n),i=Math.sqrt(t*t+r*r-2*t*r*Math.cos(Math.PI-e)),a=Se(t/(i/Math.sin(e)));return C(e-a)}function sr(e,n,t){const r=E(e),i=I(n);return Se(t/(i/Math.sin(r)))+r}function cr(e,n,t,r,i){let a,o,s,c;const l=n.latitude,u=me(e.spatialReference).radius,p=n.longitude,m=Ht(l,t,u)/2;a=p-m,o=p+m;const h=E(l),d=(1+Math.sin(h))/(1-Math.sin(h)),T=(d+1)*Math.tan(r/u/2),F=T*T;function A(R){const g=Math.PI/2;return(R=Wn.normalize(R,-g))>g&&(R=Math.PI-R),R}if(s=1.5*Math.PI-2*Math.atan(.5*(T+Math.sqrt(4*d+F))),c=s+r/u,s=A(s),c=A(c),c<s){const R=c;c=s,s=R}if(s=Math.max(C(s),-90),c=Math.min(C(c),90),o=rr.monotonic(a,o),o-a>180){const R=(o-a-180)/2;a+=R,o-=R}const y=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:ze.WGS84;return i?(i.xmin=a,i.ymin=s,i.xmax=o,i.ymax=c,i.spatialReference=y):i=new hn(a,s,o,c,y),e.spatialReference&&e.spatialReference.isWebMercator&&nt(i,!1,i),i}function lr(e,n){const t=e.frustum,{renderCoordsHelper:r}=e,i=r.getAltitude(n),a=e.spatialReference,o=r.referenceEllipsoid.radius,s=e.state.camera,c=s.eye,l=1+ye(c,n)/(o+i),u=Math.sqrt(l*l-1),{minCurvature:p,maxCurvature:m,minSamples:h,maxSamples:d}=mr,T=pr(e),F=Kn((u-p)/(m-p),0,1),A=Math.round(We(h,d,F)),y=s.aboveGround,R=t.planes[Tn.FAR],g=[],D=Ze(Ke,dr,Qe()),J=Ze(Ke,hr,Qe());bt(Ne,0,0,0,0);const G=_=>{};for(let _=0;_<4;_++){const X=_===L.NEAR_FAR_BOTTOM_RIGHT&&!y||_===L.NEAR_FAR_TOP_LEFT&&y?1-T:0,we=_===L.NEAR_FAR_BOTTOM_RIGHT&&y||_===L.NEAR_FAR_TOP_LEFT&&!y?T:1,ie=t.lines[_],K=t.lines[_===3?0:_+1];for(let U=0;U<A;U++){const Y=U/A,de=_===L.NEAR_FAR_BOTTOM_RIGHT?1-(1-Y)**2:_===L.NEAR_FAR_TOP_LEFT?Y**2:Y,he=U===0?0:We(X,we,de),Ie=Qn(Rr,ie.origin,K.origin,he),kn=Ct(ie.direction,K.direction,he,Tr);r.intersectManifoldClosestSilhouette(Rn(Ie,kn),i,M),$n(M,c,M,R),g.push(ln(M)),g.length!==0&&G(Xe(g.at(-1),M));const Jn=(Ve(D,M)?1:0)|(Ve(J,M)?2:0);Ne[Jn]=1}}g.length>2&&G(Xe(g[0],g.at(-1)));const W=ur(Nt(Ne)>1?fr(In(g,D),J):[g],r,a);return new Le({rings:W,spatialReference:a})}function ur(e,n,t){const r=2*gn();return e.map(i=>{const a=[];let o=!1;for(const s of i)n.fromRenderCoords(s,M,t),Math.abs(s[0])<r&&Math.abs(s[1])<r?(a.push([null,M[1]]),a.push([null,M[1]]),o=!0):a.push([M[0],M[1]]);if(o)for(let s=0;s<a.length;s++){const c=a[s];if(c[0]!=null)continue;const l=a[s+1],u=a.at(s===0?-1:s-1);c[0]=u[0],s++;const p=a.at(s===a.length-1?0:s+1);l[0]=p[0]}return a.push(a[0]),mn(a)||a.reverse(),a})}function fr(e,n){const t=[];for(const r of e)t.push(...In(r,n));return t}function In(e,n){const t=[],r=[],i=gn();for(let o=0;o<e.length;o++){const s=e[o],c=o===e.length-1?e[0]:e[o+1],l=vt(s,c,gr),u=It(n,l.origin,l.vector,Ft.NONE,M);switch(u){case ae.INSIDE:t.push(s);break;case ae.OUTSIDE:r.push(s);break;case ae.INTERSECTS_INSIDE_OUT:case ae.INTERSECTS_OUTSIDE_IN:{const[p,m,h]=u===ae.INTERSECTS_INSIDE_OUT?[1,t,r]:[-1,r,t],d=xt(n),T=He(f(),M,d,p*i),F=He(f(),M,d,p*-i);m.push(s),m.push(T),h.push(F)}}}const a=[];return t.length&&a.push(t),r.length&&a.push(r),a}function pr(e){const{renderCoordsHelper:n,state:{camera:t}}=e,{center:r,eye:i}=t,a=Math.abs(n.getAltitude(r)),o=Math.abs(Math.PI/2-tr(n,r,i));return Et(on,n.referenceEllipsoid.radius+a),$t(on,o,t.distance,t.fovY)}const mr={minCurvature:E(5),maxCurvature:E(50),minSamples:1,maxSamples:6},dr=te(1,0,0),hr=te(0,1,0),Tr=f(),Rr=f(),M=f(),on=At(),gr=St(),Ne=Pt(),_r=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:ir,eyeForCenterWithHeadingTilt:ar,eyeTiltToLookAtTilt:sr,headingTiltToDirectionUp:wn,lookAtTiltToEyeTilt:or,toArea:lr,toExtent:cr},Symbol.toStringTag,{value:"Module"})),Be=()=>Xn.getLogger("esri.views.3d.support.cameraUtils"),Fn=96*39.37,Ce=1,Mr=8,yr=5,xn=1,$r={heading:0,tilt:0},le=f(),Er=new Ue(-20037508342788905e-9,20037508342788905e-9),Ar=new Ue(-180,180);var q;function re(e){return e.spatialReference??ze.WGS84}function k({state:e}){return e.isGlobal?_r:nr}function gi(e,n,t,r,i){return k(e).headingTiltToDirectionUp(n,t,r,i)}function Or(e,n){if(n==null)return null;const t=e.renderSpatialReference,r=k(e).headingTiltToDirectionUp,i=f();if(!$e(n.position,i,t))return null;const a=r(i,n.heading,n.tilt);S(a.direction,a.direction,e.state.camera.distance),fe(a.direction,a.direction,i);const o=Ut(e,i,a.direction,a.up);return o.fov=E(n.fov),o.row=n.layout.row,o.rows=n.layout.rows,o.column=n.layout.column,o.columns=n.layout.columns,o}(function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"})(q||(q={}));const ee=f();function _i(e,n,t){const r=e.renderSpatialReference,i=qe(e,n.eye,n.viewForward,n.up,$r);let a=re(e);return Ee(n.eye,r,ee,a)||(a=ze.WGS84,Ee(n.eye,r,ee,a)),t==null?t=new Ge(new $(ee,a),i.heading,i.tilt,C(n.fov)):(t.position.x=ee[0],t.position.y=ee[1],t.position.z=ee[2],t.position.spatialReference=a,t.heading=i.heading,t.tilt=i.tilt,t.fov=C(n.fov)),t.layout.row=n.row,t.layout.rows=n.rows,t.layout.column=n.column,t.layout.columns=n.columns,t}function De(e,n){const{camera:t}=e.state,{unitInMeters:r}=e.renderCoordsHelper;return n/=r,t.width/2/t.pixelRatio/(Fn/n)/Math.tan(t.fovX/2)}function vr(e,n){const{camera:t}=e.state,{unitInMeters:r}=e.renderCoordsHelper,i=n*Math.tan(t.fovX/2),a=t.width/2/t.pixelRatio;return Fn/(a/i)*r}function Sr(e,n,t,r){const i=r.levelAtScale(n),a=bn(qe(e,t.eye,t.viewForward,t.up).tilt),o=Math.max(i-a,0);return r.scaleAtLevel(o)}function sn(e,n,t){const r=t.levelAtScale(e),i=bn(n);return t.scaleAtLevel(r+i)}function bn(e){return 2*((e>90?180-e:e)/90)**2}function wr(e,n,t=0){var o;const r=(o=e.basemapTerrain)==null?void 0:o.tilingScheme;if(!r)return 0;const i=me(e.spatialReference).radius,a=e.state.viewingMode===pn.Local?n.eye[2]:I(n.eye)-i;return Sr(e,vr(e,Math.abs(a-t)),n,r)}function Ir(e,n,t=0){const r=Or(e,n);return r?wr(e,r,t):0}const Fr=1,xr=100;function Mi(e,n,t,r,i){var d;if(n===0)return 0;const a=ye(t.eye,r),o=(d=e.basemapTerrain)==null?void 0:d.tilingScheme;if(!o)return Be().error("#scaleToTargetDistance()","Cannot compute distance from scale without a tiling scheme"),a;let s=a;const c=qe(e,t.eye,t.viewForward,t.up),l=c.tilt>90;if(e.state.isLocal){const T=(De(e,sn(n,c.tilt,o))-Math.abs(t.eye[2]-i[2]))/Math.cos(E(c.tilt));return s=l?s-T:s+T,s}let u=1/0,p=0,m=Oe(e,c.heading,c.tilt,r,a,q.ADJUST);if(!m)return s;const h=I(i);for(;u>Fr&&p<xr;){const T=I(m.eye),F=l?180-m.tilt:m.tilt,A=E(F),y=Math.sin(A)*T,R=Math.cos(A)*T,g=De(e,sn(n,m.tilt,o)),D=l?h-g:h+g,J=Se(y/D),G=Math.cos(J)*D-R,W=ye(m.eye,r);s=l?W-G:W+G,m=Oe(e,c.heading,c.tilt,r,s,q.ADJUST);const _=Je(e,m,C(t.fov));if(!m||!_)return s;const X=Ir(e,_,h-me(e.spatialReference).radius);u=Math.abs(n-X),++p}return s}async function yi(e,n,t,r,i,a){return br(e,n,De(e,t),r,i,a)}function $i(e,n,t,r,i,a){return Je(e,Oe(e,r.heading,r.tilt,n,t,i),r.fov,a)}async function br(e,n,t,r,i,a){const o=await Pn(e,r.heading,r.tilt,n,t,i,a);return N(a),qn(e,o,r.fov,a)}function qe(e,n,t,r,i){return k(e).directionToHeadingTilt(n,t,r,i)}function Nn(e,n){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(n,le,e.spatialReference)&&e.elevationProvider&&(_n(e.elevationProvider,le)??0)>le[2]-xn)}async function Nr(e,n,t){if(Nn(e,n))return!0;const{elevationProvider:r,spatialReference:i,renderCoordsHelper:a}=e;if(r==null||!a.fromRenderCoords(n,le,i))return!1;const[o,s,c]=le,l=await r.queryElevation(o,s,c,i,"ground",t)??0;return N(t),l>c-xn}async function Pr(e,n,t){const r=f();if(n==null)return w(r,e.state.camera.center);if(n instanceof $){const{renderSpatialReference:i,basemapTerrain:a,elevationProvider:o}=e,s=n.spatialReference;if(await rt(n,r,i,0,{signal:t}),N(t),n.z==null&&a!=null&&o!=null){const c=await o.queryElevation(n.x,n.y,n.z??0,s,"ground",t);N(t),c!=null&&e.renderCoordsHelper.setAltitude(r,c)}return r}return w(r,n)}function Hr(e,n){const t=f();if(n==null)return w(t,e.state.camera.center);if(n instanceof $){if(!$e(n,t,e.renderSpatialReference))return null;const{basemapTerrain:r,elevationProvider:i}=e;if(n.z==null&&r!=null&&i!=null){const a=_n(i,n);a!=null&&e.renderCoordsHelper.setAltitude(t,a)}return t}return w(t,n)}function Oe(e,n,t,r,i,a){return Hn(e,n,t,r instanceof $?r:null,Hr(e,r),i,a)}async function Pn(e,n,t,r,i,a,o){const s=r instanceof $?r:null,c=await Pr(e,r,o);return N(o),Ln(e,n,t,s,c,i,a,o)}function Hn(e,n,t,r,i,a,o){if(i==null||!r&&(r=new $({spatialReference:re(e)}),!je(i,e.renderSpatialReference,r)))return null;const s=Cn(e,n,t,i,a,o);if(Dn(e,t,o)&&Nn(e,s.eye)){const{tilt:c,mode:l}=Gn(e,t,i,a);return Hn(e,n,c,r,i,a,l)}return Un(s,i)}async function Ln(e,n,t,r,i,a,o,s){r||(r=new $({spatialReference:re(e)}),await fn(i,e.renderSpatialReference,r,{signal:s})||(r=null)),N(s);const c=Cn(e,n,t,i,a,o);if(Dn(e,t,o)&&await Nr(e,c.eye,s)){N(s);const{tilt:l,mode:u}=Gn(e,t,i,a);return Ln(e,n,l,r,i,a,u,s)}return Un(c,i)}function Cn(e,n,t,r,i,a){const o=Cr(e,n,t,r,i=Math.max(i,e.state.constraints.minimumPoiDistance),a);return(0,k(e).eyeForCenterWithHeadingTilt)(r,i,o.heading,o.tilt)}function Dn(e,n,t){const r=e.map.ground.navigationConstraint;return t===q.ADJUST&&e.state.isGlobal&&n>0&&(r==null||r.type==="stay-above")}function Gn(e,n,t,r){const i=Bn(e,t,r,Gr(e,r,n,t));return{tilt:i,mode:n-i<1?q.LOCKED:q.ADJUST}}function Un(e,n){return{...e,center:ln(n)}}function zn(e,n){const{state:t,spatialReference:r}=e,i=n.spatialReference;return t.isGlobal&&Dt(i,pn.Global)||t.isLocal&&r.equals(i)}function jn(e,n){let t,r,i;if(e.state.isGlobal){const u=new $(n.xmin,n.ymin,n.spatialReference),p=new $(n.xmax,n.ymax,n.spatialReference),m=n.spatialReference.isGeographic?Ar:Er;t=new $({x:m.center(u.x,p.x),y:(p.y+u.y)/2,z:n.zmax!=null&&n.zmin!=null?(n.zmax+n.zmin)/2:void 0,spatialReference:n.spatialReference});const h=me(n.spatialReference),d=Lt(t,u,p);r=d.lon,i=d.lat,m.diff(u.x,p.x)>m.range/2&&(r+=h.halfCircumference),r=Math.min(r,h.halfCircumference),i=Math.min(i,h.halfCircumference)}else{const u=e.renderSpatialReference??n.spatialReference;u.equals(n.spatialReference)||(n=un(n,u)),r=n.xmax-n.xmin,i=n.ymax-n.ymin;const p=n.zmax!=null&&n.zmin!=null?(n.zmax+n.zmin)/2:void 0;t=new $({x:n.xmin+.5*r,y:n.ymin+.5*i,z:p,spatialReference:u})}const a=n.zmax!=null&&n.zmin!=null?n.zmax-n.zmin:0,o=e.state.camera,s=1/Math.tan(o.fovX/2),c=1/Math.tan(o.fovY/2),l=1/Math.tan(o.fov/2);return{center:t,distance:Math.max(.5*r*s,.5*i*c,.5*a*l)/Ce}}async function Ei(e,n,t,r,i,a){const o=zn(e,n)?n:await tt(n,e.spatialReference,{signal:a});N(a);const{center:s,distance:c}=jn(e,o),l=await Pn(e,t,r,s,c,i,a);return N(a),qn(e,l,e.camera.fov,a)}function Ai(e,n,t,r,i,a){let o;try{o=zn(e,n)?n:un(n,e.spatialReference)}catch{return null}const{center:s,distance:c}=jn(e,o),l=Oe(e,t,r,s,c,i);return l==null?null:Je(e,l,e.camera.fov,a)}function Oi(e,n,t){const r=e.renderSpatialReference,i=new $({spatialReference:re(e)});if(!je(t,r,i))return null;const a=Math.tan(n.fovX/2),o=Math.tan(n.fovY/2),s=et(n.eye,t),c=2*s*a*Ce,l=2*s*o*Ce;return k(e).toExtent(e,i,c,l)}function vi(e,n){return k(e).toArea(e,n)}function Lr(e,n,t){const r=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(t/r)/Math.LN2>Mr)return!0;const i=n,a=e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;return ye(i,a)/(Math.tan(.5*e.state.camera.fov)*r)>yr}function Cr(e,n,t,r,i,a){let o=0;return a===q.ADJUST&&Lr(e,r,i)?(n=0,o=Dr(e,i,t,r)):o=ke(e,r,i,t),o=e.state.constraints.clampTilt(i,o),{heading:n,tilt:t=Bn(e,r,i,o)}}const ve=.7;function Dr(e,n,t,r){const i=ke(e,r,n,t);if(!e.state.constraints.tilt)return i;const a=e.state.constraints.tilt(n);a.max=Math.min(a.max,.5*Math.PI);const o=a.min*(1-ve)+a.max*ve;return Math.min(i,o)}function Gr(e,n,t,r){let i=ke(e,r,n,t);if(!e.state.constraints.tilt)return i;const a=e.state.constraints.tilt(n);return i=Math.min(i,.5*Math.PI),a.min*(1-ve)+i*ve}function Bn(e,n,t,r){return k(e).lookAtTiltToEyeTilt(r,n,t)}function ke(e,n,t,r){return k(e).eyeTiltToLookAtTilt(r,n,t)}function Je(e,n,t,r){if(n==null)return null;const i=e.renderSpatialReference,a=new $({spatialReference:re(e)});return je(n.eye,i,a)?(r??(r=new Ge),r.position=a,r.heading=n.heading,r.tilt=n.tilt,r.fov=t,r):null}async function qn(e,n,t,r){const i=e.renderSpatialReference,a=new $({spatialReference:re(e)});return await fn(n.eye,i,a,{signal:r}),N(r),new Ge(a,n.heading,n.tilt,t)}function Si(e,n){var r;const t=(r=e.basemapTerrain)==null?void 0:r.tilingScheme;if(t)return t.levelAtScale(n);Be().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function wi(e,n){var r;const t=(r=e.basemapTerrain)==null?void 0:r.tilingScheme;if(t)return t.scaleAtLevel(n);Be().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}export{vr as B,Si as H,wi as J,gi as K,Ai as M,_i as N,tn as O,Sr as Q,Ei as S,re as V,Or as W,De as Z,$i as a,br as b,tr as c,Gt as f,Ut as g,Mn as h,Mi as i,Oi as j,q as k,qe as l,yi as o,Oe as p,Ti as u,vi as z};
