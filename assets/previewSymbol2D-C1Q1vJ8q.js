import{u as E}from"./Color-DDUWtbqR.js";import{H as D}from"./colorUtils-D5nOabzP.js";import{c as H}from"./subclass-BR3PhgZG.js";import{c as U}from"./fontUtils-CILP_6vp.js";import{u as w}from"./screenUtils-PfxkaaMN.js";import{u as T,y as O,g as V,f as W}from"./utils-CvMr5svk.js";import{t as S,e as I,d as F,l as G}from"./symbolUtils-DE-py14C.js";import{s as L}from"./TextSymbol-zZq0BA1M.js";import"./colorUtils-CS9vdHXB.js";import"./mathUtils-ClvKsMak.js";import"./vec42-B1mBkh1w.js";import"./vec4f64-CBQL1T0x.js";import"./index-BVncS3aY.js";import"./symbols-CfvYGR4J.js";import"./Evented-CXIxDjmW.js";import"./Accessor-D6mNnsWy.js";import"./enumeration--HlxOQ_N.js";import"./jsonMap-DCC6W5ex.js";import"./writer-3zufXUNV.js";import"./fieldUtils-C5R42-PY.js";import"./intl-CArXn1et.js";import"./Promise-CZrWwByK.js";import"./assets-BNizZMOZ.js";import"./geometry-CnaxvJsv.js";import"./Extent-B4rrMrqp.js";import"./Point-TlcsOcXV.js";import"./Polyline-BQFeqYXi.js";import"./materialUtils-CQ3JLQ1x.js";import"./opacityUtils-BT7mQkwC.js";import"./aaBoundingBox-BGxkJAW0.js";import"./persistableUrlUtils-Dx61-x4K.js";import"./reactiveUtils-BFQ0BtrB.js";import"./shared-B3wH2qpO.js";import"./collectionUtils-Dm1icNvk.js";import"./Portal-DCqdz-K4.js";import"./Clonable-cKbRam6-.js";import"./jsonUtils-C4Wp5KpV.js";import"./parser-BN6zmHl-.js";import"./utils-D20M4_S8.js";import"./mat4f32-DcsiF_Rp.js";import"./mat4-ybYUU6jq.js";import"./cimSymbolUtils-Ctf0ZrmH.js";import"./utils-D8D39sLt.js";import"./LRUCache-ju6LnIBZ.js";import"./MemCache-C6WUx-5V.js";import"./jsxFactory-Be5PKa9i.js";import"./uuid-fwrPAdZb.js";import"./mat2df32-orApM5a3.js";import"./mat2d-DPkeMmgR.js";import"./webStyleSymbolUtils--o9yKGMN.js";import"./devEnvironmentUtils-D6qIi8Ky.js";import"./jsonUtils-aUmUTP_F.js";import"./layerUtils-BzjQnEdj.js";import"./defaults-CIM29kXM.js";import"./defaultsJSON-GKolV7NZ.js";import"./styleUtils-C7rrjuqd.js";const R="picture-fill",J="picture-marker",K="simple-fill",N="simple-line",Q="simple-marker",X="text",Y="Aa",_=S.size,C=S.maxSize,$=S.maxOutlineSize,Z=S.lineWidth,A=225,ee=document.createElement("canvas");function q(i,e){const a=ee.getContext("2d"),o=[];e&&(e.weight&&o.push(e.weight),e.size&&o.push(e.size+"px"),e.family&&o.push(e.family)),a.font=o.join(" ");const{width:s,actualBoundingBoxLeft:m,actualBoundingBoxRight:u,actualBoundingBoxAscent:l,actualBoundingBoxDescent:c}=a.measureText(i);return{width:Math.ceil(Math.max(s,m+u)),height:Math.ceil(l+c),x:Math.floor(m),y:Math.floor((l-c)/2)}}function x(i){const e=i==null?void 0:i.size;return{width:e!=null&&typeof e=="object"&&"width"in e?w(e.width):null,height:e!=null&&typeof e=="object"&&"height"in e?w(e.height):null}}async function ie(i,e){const a=e.fill,o=i.color;if((a==null?void 0:a.type)==="pattern"&&o&&i.type!==R){const s=await W(a.src,o.toCss(!0));a.src=s,e.fill=a}}async function oe(i,e,a,o){var u,l,c;if(!("font"in i)||!i.font||e.shape.type!=="text")return;try{await U(i.font)}catch{}const{width:s,height:m}=x(o);if(!/[\uE600-\uE6FF]/.test(e.shape.text)){const{width:d,height:f,x:t,y:n}=q(e.shape.text,{weight:(u=e.font)==null?void 0:u.weight,size:(l=e.font)==null?void 0:l.size,family:(c=e.font)==null?void 0:c.family});a[0]=s??d,a[1]=m??f,e.shape.x=t,e.shape.y=n;const v=(o==null?void 0:o.rotation)!=null?o.rotation:"angle"in i?i.angle:null;if(v){const M=v*(Math.PI/180),h=Math.abs(Math.sin(M)),p=Math.abs(Math.cos(M));a[1]=a[0]*h+a[1]*p}}}function ae(i,e,a,o,s){var m;if(i.haloColor!=null&&i.haloSize!=null){s.masking??(s.masking=a.map(()=>[]));const u=w(i.haloSize);o[0]+=u,o[1]+=u,a.unshift([{...e,fill:null,stroke:{color:i.haloColor,width:2*u,join:"round",cap:"round"}}]),s.masking.unshift([{shape:{type:"rect",x:0,y:0,width:o[0]+2*L,height:o[1]+2*L},fill:[255,255,255],stroke:null},{...e,fill:[0,0,0,0],stroke:null}])}i.backgroundColor==null&&i.borderLineColor==null||(o[0]+=2*L,o[1]+=2*L,a.unshift([{shape:{type:"rect",x:0,y:0,width:o[0],height:o[1]},fill:i.backgroundColor,stroke:{color:i.borderLineColor,width:w(i.borderLineSize)}}]),(m=s.masking)==null||m.unshift([]))}function P(i,e){return i>e?"dark":"light"}function te(i,e){var M;const a=typeof(e==null?void 0:e.size)=="number"?e==null?void 0:e.size:null,o=a!=null?w(a):null,s=(e==null?void 0:e.maxSize)!=null?w(e.maxSize):null,m=(e==null?void 0:e.rotation)!=null?e.rotation:"angle"in i?i.angle:null,u=T(i);let l=O(i);ne(i,245)!=="dark"||e!=null&&e.ignoreWhiteSymbols||(l={width:.75,...l,color:"#bdc3c7"});const c={shape:null,fill:u,stroke:l,offset:[0,0]};l!=null&&l.width&&(l.width=Math.min(l.width,$));const d=(l==null?void 0:l.width)||0;let f=(e==null?void 0:e.size)!=null&&((e==null?void 0:e.scale)==null||(e==null?void 0:e.scale)),t=0,n=0,v=!1;switch(i.type){case Q:{const h=i.style,{width:p,height:r}=x(e),b=p===r&&p!=null?p:o??Math.min(w(i.size),s||C);switch(t=b,n=b,h){case"circle":c.shape={type:"circle",cx:0,cy:0,r:.5*b},f||(t+=d,n+=d);break;case"cross":c.shape={type:"path",path:[{command:"M",values:[0,.5*n]},{command:"L",values:[t,.5*n]},{command:"M",values:[.5*t,0]},{command:"L",values:[.5*t,n]}]};break;case"diamond":c.shape={type:"path",path:[{command:"M",values:[0,.5*n]},{command:"L",values:[.5*t,0]},{command:"L",values:[t,.5*n]},{command:"L",values:[.5*t,n]},{command:"Z",values:[]}]},f||(t+=d,n+=d);break;case"square":c.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,0]},{command:"L",values:[t,n]},{command:"L",values:[0,n]},{command:"Z",values:[]}]},f||(t+=d,n+=d),m&&(v=!0);break;case"triangle":c.shape={type:"path",path:[{command:"M",values:[.5*t,0]},{command:"L",values:[t,n]},{command:"L",values:[0,n]},{command:"Z",values:[]}]},f||(t+=d,n+=d),m&&(v=!0);break;case"x":c.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,n]},{command:"M",values:[t,0]},{command:"L",values:[0,n]}]},m&&(v=!0);break;case"path":c.shape={type:"path",path:i.path||""},f||(t+=d,n+=d),m&&(v=!0),f=!0}break}case N:{const{width:h,height:p}=x(e),r=V(l).reduce((B,k)=>B+k,0),b=r&&Math.ceil(Z/r),y=p??o??d,g=h??(r*b||Z);l&&(l.width=y),t=g,n=y,f=!0,c.shape={type:"path",path:[{command:"M",values:[y/2,n/2]},{command:"L",values:[t-y/2,n/2]}]};break}case R:case K:{const h=typeof(e==null?void 0:e.symbolConfig)=="object"&&!!((M=e==null?void 0:e.symbolConfig)!=null&&M.isSquareFill),{width:p,height:r}=x(e);t=!h&&p!==r||p==null?o??_:p,n=!h&&p!==r||r==null?t:r,f||(t+=d,n+=d),f=!0,c.shape=h?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,0]},{command:"L",values:[t,n]},{command:"L",values:[0,n]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:I.fill[0];break}case J:{const h=Math.min(w(i.width),s||C),p=Math.min(w(i.height),s||C),{width:r,height:b}=x(e),y=r===b&&r!=null?r:o??Math.max(h,p),g=h/p;t=g<=1?Math.ceil(y*g):y,n=g<=1?y:Math.ceil(y/g),c.shape={type:"image",x:-Math.round(t/2),y:-Math.round(n/2),width:t,height:n,src:i.url||""},m&&(v=!0);break}case X:{const h=i,p=(e==null?void 0:e.overrideText)||h.text||Y,r=h.font,{width:b,height:y}=x(e),g=y??o??Math.min(w(r.size),s||C),{width:B,height:k}=q(p,{weight:r.weight,size:g,family:r.family}),z=/[\uE600-\uE6FF]/.test(p);t=b??(z?g:B),n=z?g:k;let j=.5*(z?g:k);z&&(j+=5),c.shape={type:"text",text:p,x:h.xoffset||0,y:h.yoffset||j,align:"middle",alignBaseline:h.verticalAlignment,decoration:r&&r.decoration,rotated:h.rotated,kerning:h.kerning},c.font=r&&{size:g,style:r.style,decoration:r.decoration,weight:r.weight,family:r.family};break}}return{shapeDescriptor:c,size:[t,n],renderOptions:{node:e==null?void 0:e.node,scale:f,opacity:e==null?void 0:e.opacity,rotation:m,useRotationSize:v,effectView:e==null?void 0:e.effectView,ariaLabel:e==null?void 0:e.ariaLabel}}}async function si(i,e){var u;const{shapeDescriptor:a,size:o,renderOptions:s}=te(i,e);if(!a.shape)throw new H("symbolPreview: renderPreviewHTML2D","symbol not supported.");await ie(i,a),await oe(i,a,o,e);const m=[[a]];if(typeof(e==null?void 0:e.symbolConfig)=="object"&&((u=e==null?void 0:e.symbolConfig)!=null&&u.applyColorModulation)){const l=.6*o[0];m.unshift([{...a,offset:[-l,0],fill:F(a.fill,-.3)}]),m.push([{...a,offset:[l,0],fill:F(a.fill,.3)}]),o[0]+=2*l,s.scale=!1}return i.type==="text"&&ae(i,a,m,o,s),G(m,o,s)}function ne(i,e=A){const a=T(i),o=O(i),s=!a||"type"in a?null:new E(a),m=o!=null&&o.color?new E(o==null?void 0:o.color):null,u=s?P(D(s),e):null,l=m?P(D(m),e):null;return l?u?u===l?u:e>=A?"light":"dark":l:u}export{ne as getContrastingBackgroundTheme,te as getRenderSymbolParameters,si as previewSymbol2D};
