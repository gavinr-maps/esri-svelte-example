const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./calcite-button-D_QRw8fR.js","./button-CT5wDIjk.js","./jsxFactory-CbAu6VfF.js","./Evented-CXIxDjmW.js","./Accessor-D6mNnsWy.js","./subclass-BR3PhgZG.js","./intl-Dpfm8vPB.js","./Promise-CZrWwByK.js","./jsonMap-DCC6W5ex.js","./assets-C2mb-ea2.js","./index-CeCSsEgo.js","./index-CjOb8WjV.css","./reactiveUtils-BFQ0BtrB.js","./shared-B3wH2qpO.js","./uuid-fwrPAdZb.js","./form-DcBTx4ZC.js","./dom-Cv0oa6So.js","./interactive-Dtpmn6Ls.js","./label-rdYpV4K5.js","./component-ByvC-PUv.js","./loadable-CTFTnu2T.js","./locale-BUTTOPma.js","./key-D5DPfjW0.js","./observers-EizV_Lvc.js","./t9n-DfK3dFGw.js","./icon-DIKjN-ev.js","./loader-wfvKSvDR.js"])))=>i.map(i=>d[i]);
import{_ as C}from"./index-CeCSsEgo.js";import{e as s}from"./Evented-CXIxDjmW.js";import{y as o,b as _,E as $}from"./subclass-BR3PhgZG.js";import{S as B,t as L}from"./Accessor-D6mNnsWy.js";import{e as V,B as S,r as H,n as a}from"./jsxFactory-CbAu6VfF.js";import{v as b}from"./LineOfSightAnalysis-BaJLFAtB.js";import{u as O,f as I}from"./LineOfSightAnalysisTarget-A3DPGN1j.js";import{V as N,d as g,A as k,C as w}from"./reactiveUtils-BFQ0BtrB.js";import{t as D,n as x}from"./collectionUtils-Dm1icNvk.js";import{u as E,m as P,j as G}from"./elevationInfoUtils-Bl7QRRwv.js";import{d as R}from"./Graphic-Dc7F67nR.js";import{_ as T}from"./Point-DB4Hp4hH.js";import{_ as z}from"./AnalysisViewModel-Bz7FozXo.js";import{e as f}from"./globalCss-CZa70j6i.js";import"./intl-Dpfm8vPB.js";import"./Promise-CZrWwByK.js";import"./jsonMap-DCC6W5ex.js";import"./assets-C2mb-ea2.js";import"./uuid-fwrPAdZb.js";import"./Analysis-ffiH0xaW.js";import"./Clonable-cKbRam6-.js";import"./Identifiable-BLvpQbOc.js";import"./projection-A9yUaaTs.js";import"./mathUtils-ClvKsMak.js";import"./Extent-DHjqVB-p.js";import"./Polyline-D97hl-6E.js";import"./writer-3zufXUNV.js";import"./projectBuffer-vsa0P_cF.js";import"./geodesicConstants-XRAvAZCD.js";import"./aaBoundingBox-rJEWaOSN.js";import"./persistable-ZhNvqYX-.js";import"./MD5-C9MwAd2G.js";import"./multiOriginJSONSupportUtils-C0wm8_Yw.js";import"./resourceExtension-CNyCBDXT.js";import"./persistableUrlUtils-BcifXQ1Z.js";import"./ElevationInfo-BxYXLfrw.js";import"./fieldUtils-CNduWQU9.js";import"./geometry-DpwwkAX1.js";import"./unitConversionUtils-Dl04YuQU.js";import"./lengthUtils-D7_DvYH0.js";import"./shared-B3wH2qpO.js";import"./PopupTemplate-ByHks6sq.js";import"./enumeration--HlxOQ_N.js";import"./Color-DDUWtbqR.js";import"./colorUtils-CS9vdHXB.js";import"./ActionToggle-C0Z1k2jc.js";import"./symbols-CsUQ5BxR.js";import"./TextSymbol-gKE-H_J6.js";import"./screenUtils-PfxkaaMN.js";import"./materialUtils-CQ3JLQ1x.js";import"./opacityUtils-BT7mQkwC.js";import"./Portal-liet8xHC.js";import"./jsonUtils-Cma_7A64.js";let p=class extends B{constructor(e){super(e),this.location=null,this.intersectedLocation=null,this.intersectedGraphic=null,this.visible=void 0}};s([o({type:T})],p.prototype,"location",void 0),s([o({type:T})],p.prototype,"intersectedLocation",void 0),s([o({type:R})],p.prototype,"intersectedGraphic",void 0),s([o({type:Boolean})],p.prototype,"visible",void 0),p=s([_("esri.widgets.LineOfSight.LineOfSightTarget")],p);const A=p,y=N.ofType(A);let h=class extends z{constructor(t){super(t),this.analysis=null,this.supportedViewType="3d",this.unsupportedErrorMessage="LineOfSightViewModel is only supported in 3D views.",this._vmTargetsToConnection=new Map,this._analysisTargetsToConnection=new Map}initialize(){this.addHandles([this.targets.on("after-add",t=>this._onViewModelTargetAdded(t.item)),this.targets.on("after-remove",t=>this._onViewModelTargetRemoved(t.item)),g(()=>this.analysis,t=>this._onAnalysisChange(t),k)])}destroy(){this._analysisTargetsToConnection.forEach(t=>t.remove())}get state(){return this.disabled||!this.ready?"disabled":this.tool==null?"ready":this.tool.state}get observer(){const{observer:t}=this.analysis;return(t==null?void 0:t.position)==null?null:this._convertAnalysisPointToAbsoluteHeight(t.position,t.elevationInfo)}set observer(t){let e=null;t&&(e=t.clone(),e.hasZ||(e.z=0)),this.analysis.observer=new O({position:e})}get targets(){return this._get("targets")||new y}set targets(t){this._set("targets",x(t,this.targets,y))}continue(){this.tool!=null&&this.tool.continue()}stop(){this.tool!=null&&this.tool.stop()}get testInfo(){}constructAnalysis(){return new b}async onConnectToAnalysisView(t){this.addHandles([t.on("result-changed",e=>{const i=this._analysisTargetsToConnection.get(e.target);i&&(e.result!=null?(i.viewModelTarget.intersectedGraphic=e.result.intersectedGraphic,i.viewModelTarget.intersectedLocation=e.result.intersectedLocation,i.viewModelTarget.visible=e.result.visible):(i.viewModelTarget.intersectedGraphic=null,i.viewModelTarget.intersectedLocation=null,i.viewModelTarget.visible=void 0))})],"view")}onDisconnectFromAnalysisView(){this.removeHandles("view")}_onViewModelTargetAdded(t){if(this._vmTargetsToConnection.get(t))return;const e=new I({position:t.location});this._connectViewModelWithAnalysisTarget(t,e),this.analysis.targets.add(e)}_onViewModelTargetRemoved(t){const e=this._vmTargetsToConnection.get(t);e&&(e.remove(),this.analysis.targets.remove(e.analysisTarget))}_onAnalysisTargetAdded(t){if(this._analysisTargetsToConnection.get(t))return;const{position:e}=t,i=new A({location:e?this._convertAnalysisPointToAbsoluteHeight(e,t.elevationInfo):null});this._connectViewModelWithAnalysisTarget(i,t),this.targets.add(i)}_onAnalysisTargetRemoved(t){const e=this._analysisTargetsToConnection.get(t);e&&(e.remove(),this.targets.remove(e.viewModelTarget))}_connectViewModelWithAnalysisTarget(t,e){let i=!1;const u=$([g(()=>({position:e.position,elevationInfo:e.elevationInfo}),({position:l,elevationInfo:c})=>{i||(i=!0,t.location=l?this._convertAnalysisPointToAbsoluteHeight(l,c):null,i=!1)},w),g(()=>t.location,l=>{if(!i){i=!0;let c=null;l&&(c=l.clone(),c.hasZ||(c.z=0)),e.position=c,e.elevationInfo=null,i=!1}},w)]),m={analysisTarget:e,viewModelTarget:t,remove:()=>{u.remove(),this._vmTargetsToConnection.delete(t),this._analysisTargetsToConnection.delete(e)}};this._vmTargetsToConnection.set(t,m),this._analysisTargetsToConnection.set(e,m)}_onAnalysisChange(t){const e="analysis";this.removeHandles(e),this.addHandles([this.analysis.targets.on("after-add",i=>this._onAnalysisTargetAdded(i.item)),this.analysis.targets.on("after-remove",i=>this._onAnalysisTargetRemoved(i.item))],e),this.targets.removeAll(),t.targets.forEach(i=>{this._onAnalysisTargetAdded(i)})}_convertAnalysisPointToAbsoluteHeight(t,e){const i=t.clone();if(this.view!=null){const u=E(t.hasZ,e);i.z=P(this.view,t,u,G)}return i}};s([o({type:b})],h.prototype,"analysis",void 0),s([o({readOnly:!0})],h.prototype,"state",null),s([o()],h.prototype,"observer",null),s([o({type:y,cast:D,nonNullable:!0})],h.prototype,"targets",null),h=s([_("esri.widgets.LineOfSight.LineOfSightViewModel")],h);const M=h,r="esri-line-of-sight",d={base:r,actions:`${r}__actions`,container:`${r}__container`,error:`${r}__error`,hint:`${r}__hint`,hintText:`${r}__hint-text`,newAnalysisButton:`${r}__new-analysis-button`},v={newAnalysisButton:`${r}__new-button`,continueButton:`${r}__continue-button`,doneButton:`${r}__done-button`};let n=class extends S{constructor(t,e){super(t,e),this.messages=null,this.viewModel=new M,this._onNewAnalysis=()=>{L(this.viewModel.start())},this._onDone=()=>{this.viewModel.stop()},this._onContinue=()=>{this.viewModel.continue()}}loadDependencies(){return H({button:()=>C(()=>import("./calcite-button-D_QRw8fR.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]),import.meta.url)})}get active(){return this.viewModel.active}get analysis(){return this.viewModel.analysis}set analysis(t){this.viewModel.analysis=t}get icon(){return"line-of-sight"}set icon(t){this._overrideIfSome("icon",t)}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}get visible(){return this.viewModel.visible}set visible(t){this.viewModel.visible=t}render(){return a("div",{class:this.classes(d.base,f.widget,f.panel),role:"presentation"},this._renderContainerNode())}_renderContainerNode(){if(!this.visible)return null;if(!this.viewModel.supported)return this._renderUnsupportedMessage();let t=null;const e=[this._renderNewAnalysisButton()];return this.viewModel.state==="creating"?(t=this._renderHint(),e.unshift(this._renderDoneButton())):this.viewModel.state==="created"&&this.viewModel.targets.length>0&&e.unshift(this._renderContinueButton()),a("div",{class:d.container},t,a("div",{class:d.actions},e))}_renderUnsupportedMessage(){return a("div",{class:d.error,key:"esri-line-of-sight__unsupported"},a("p",null,this.messages.unsupported))}_renderHint(){return a("div",{class:d.hint,key:"esri-line-of-sight__hint"},a("p",{class:d.hintText},this.messages.hint))}_renderNewAnalysisButton(){return this._renderButton({className:d.newAnalysisButton,id:v.newAnalysisButton,label:this.messages.newAnalysis,onClick:this._onNewAnalysis,primary:!0})}_renderDoneButton(){return this._renderButton({id:v.doneButton,label:this.messages.done,onClick:this._onDone,primary:!1})}_renderContinueButton(){return this._renderButton({id:v.newAnalysisButton,label:this.messages.continueAnalysis,onClick:this._onContinue,primary:!1})}_renderButton({className:t,id:e,label:i,onClick:u,primary:m}){const l=this.viewModel.state==="disabled";return a("calcite-button",{appearance:m?"solid":"outline-fill",class:t,"data-id":e,disabled:l,key:e,onclick:u},i)}get test(){}};s([o()],n.prototype,"active",null),s([o({constructOnly:!0,nonNullable:!0})],n.prototype,"analysis",null),s([o()],n.prototype,"icon",null),s([o()],n.prototype,"label",null),s([o(),V("esri/widgets/LineOfSight/t9n/LineOfSight")],n.prototype,"messages",void 0),s([o()],n.prototype,"view",null),s([o({type:M})],n.prototype,"viewModel",void 0),s([o()],n.prototype,"visible",null),n=s([_("esri.widgets.LineOfSight")],n);const Wt=n;export{Wt as default};
