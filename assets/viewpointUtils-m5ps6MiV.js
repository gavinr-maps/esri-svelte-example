import{m as M}from"./Viewpoint-7_owAOZm.js";import{V as it}from"./reactiveUtils-BFQ0BtrB.js";import{h as ct,u as st}from"./mathUtils-ClvKsMak.js";import{N as _,W as ut,_ as B,n as L,G as P,b as ft,f as lt}from"./Point-TlcsOcXV.js";import{f as yt,s as C,c as J,i as v,M as mt,h as pt,u as gt}from"./mat2d-DPkeMmgR.js";import{e as S}from"./mat2df64-CBKYtunK.js";import{x as xt,l as $,o as y,e as q,v as z,y as ht,j as bt,q as I,B as K,S as j,r as wt,u as dt}from"./vec2-B_ymkwGp.js";import{r as Gt,n as l}from"./vec2f64-Diu2Kaa8.js";import{w as O}from"./Extent-B4rrMrqp.js";import{_ as Q,J as T,W as D,K as E}from"./projection-tSh-0UvX.js";import{P as H,v as Rt}from"./normalizeUtils-CuTX3yb4.js";const X=96,Y=39.37,At=180/Math.PI;function Z(t){return t.wkid?t:t.spatialReference||lt.WGS84}function N(t,e){return e.type?y(t,e.x,e.y):wt(t,e)}function U(t){return ut(t)}function tt(t,e,n=0){let r=t.width,o=t.height;if(n!==0){const u=ct(n),s=Math.abs(Math.cos(u)),c=Math.abs(Math.sin(u));r=t.width*s+t.height*c,o=t.width*c+t.height*s}const a=Math.max(1,e[0]),i=Math.max(1,e[1]);return Math.max(r/a,o/i)*jt(t.spatialReference)}async function A(t,e,n,r){var u,s;let o,a;if(!t||Array.isArray(t)&&!t.length)return null;if(it.isCollection(t)&&(t=t.toArray()),Array.isArray(t)&&t.length&&typeof t[0]=="object"){const c=t.every(f=>"attributes"in f),p=t.some(f=>!f.geometry);let m=t;if(c&&p&&e&&e.allLayerViews){const f=new Map;for(const g of t){const b=g.layer,R=f.get(b)||[],d=g.attributes[b.objectIdField];d!=null&&R.push(d),f.set(b,R)}const x=[];f.forEach((g,b)=>{const R=e.allLayerViews.find(d=>d.layer.id===b.id);if(R&&"queryFeatures"in R){const d=b.createQuery();d.objectIds=g,d.returnGeometry=!0,x.push(R.queryFeatures(d))}});const h=await Promise.all(x),w=[];for(const g of h)if(g&&g.features&&g.features.length)for(const b of g.features)b.geometry!=null&&w.push(b.geometry);m=w}for(const f of m)r=await A(f,e,n,r);return r}if(Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number")o=new B(t);else if(t instanceof L)o=t;else if("geometry"in t){if(t.geometry)o=t.geometry;else if(t.layer){const c=t.layer,p=e.allLayerViews.find(m=>m.layer.id===c.id);if(p&&"queryFeatures"in p){const m=c.createQuery();m.objectIds=[t.attributes[c.objectIdField]],m.returnGeometry=!0;const f=await p.queryFeatures(m);o=(s=(u=f==null?void 0:f.features)==null?void 0:u[0])==null?void 0:s.geometry}}}if(o==null)return null;switch(o.type){case"point":a=new O({xmin:o.x,ymin:o.y,xmax:o.x,ymax:o.y,spatialReference:o.spatialReference});break;case"extent":case"multipoint":case"polygon":case"polyline":a=Rt(o);break;default:a=o.extent}if(!a)return null;Q()||T(a.spatialReference,n)||await D();const i=E(a,n);if(!i)return null;if(r){const c=i.center,p=c.clone();p.x=H(c.x,r.center.x,n),p.x!==c.x&&i.centerAt(p),r=r.union(i)}else r=i;return r}function kt(t){var e;if(t&&(!Array.isArray(t)||typeof t[0]!="number")&&(typeof t=="object"||Array.isArray(t)&&typeof t[0]=="object")){if("layer"in t&&((e=t.layer)==null?void 0:e.minScale)!=null&&t.layer.maxScale!=null){const n=t.layer;return{min:n.minScale,max:n.maxScale}}if(Array.isArray(t)&&t.length&&t.every(n=>"layer"in n)){let n=0,r=0;for(const o of t){const a=o.layer;a!=null&&a.minScale&&a.maxScale&&(n=a.minScale<n?a.minScale:n,r=a.maxScale>r?a.maxScale:r)}return n&&r?{min:n,max:r}:null}}}function V(t,e){return P(Z(t),e)?t:E(t,e)}async function Tt(t,e){var g;if(!t||!e)return new M({targetGeometry:new B,scale:0,rotation:0});let n=e.spatialReference;const{constraints:r,padding:o,viewpoint:a,size:i}=e,u=[o?i[0]-o.left-o.right:i[0],o?i[1]-o.top-o.bottom:i[1]];let s=null;t instanceof M?s=t:t.viewpoint?s=t.viewpoint:t.target&&t.target.declaredClass==="esri.Viewpoint"&&(s=t.target);let c=null;s!=null&&s.targetGeometry?c=s.targetGeometry:t instanceof O?c=t:t instanceof L?c=await A(t,e,n):t&&(c=await A(t.center,e,n)||await A(t.target,e,n)||await A(t,e,n)),!c&&(a!=null&&a.targetGeometry)?c=a.targetGeometry:!c&&e.extent&&(c=e.extent),n||(n=Z(e.spatialReference||e.extent||c)),Q()||P(c.spatialReference,n)||T(c.spatialReference,n)||await D();const p=V(c,n),m="center"in p?p.center:p;e.pickClosestTarget!==!1&&m.type==="point"&&((g=a.targetGeometry)==null?void 0:g.type)==="point"&&(m.x=H(m.x,a.targetGeometry.x,m.spatialReference));let f=0;s?f=s.rotation:t.hasOwnProperty("rotation")?f=t.rotation:a&&(f=a.rotation);let x=0;x=(s==null?void 0:s.targetGeometry)!=null&&s.targetGeometry.type==="point"?s.scale:"scale"in t&&t.scale?t.scale:"zoom"in t&&t.zoom!==-1&&r&&r.effectiveLODs?r.zoomToScale(t.zoom):Array.isArray(c)||c.type==="point"||c.type==="extent"&&c.width===0&&c.height===0?a.scale:tt(V(c.extent,n),u,f);const h=kt(t.target??t);h&&(h.min&&h.min<x?x=h.min:h.max&&h.max>x&&(x=h.max));let w=new M({targetGeometry:m,scale:x,rotation:f});return r&&(w=r.fit(w),r.constrainByGeometry(w),r.rotationEnabled||(w.rotation=a.rotation)),w}function G(t,e){const n=t.targetGeometry,r=e.targetGeometry;return n.x=r.x,n.y=r.y,n.spatialReference=r.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}function St(t,e,n){return n?y(t,.5*(e[0]-n.right+n.left),.5*(e[1]-n.bottom+n.top)):$(t,e,.5)}const Dt=function(){const t=l();return function(e,n,r){const o=n.targetGeometry;N(t,o);const a=.5*k(n);return e.xmin=t[0]-a*r[0],e.ymin=t[1]-a*r[1],e.xmax=t[0]+a*r[0],e.ymax=t[1]+a*r[1],e.spatialReference=o.spatialReference,e}}();function Et(t,e,n,r,o){var a;return Wt(t,e,n.center),t.scale=tt(n,r),(a=o==null?void 0:o.constraints)==null||a.constrain(t),t}function $t(t,e,n,r){return rt(t,e,n,r),gt(t,t)}const et=function(){const t=l();return function(e,n,r){return K(e,Nt(e,n),St(t,n,r))}}(),Mt=function(){const t=S(),e=l();return function(n,r,o,a){const i=k(r),u=F(r);return y(e,i,i),pt(t,e),C(t,t,u),v(t,t,et(e,o,a)),v(t,t,[0,a.top-a.bottom]),y(n,t[4],t[5])}}();function k(t){var e;return t.scale*vt((e=t.targetGeometry)==null?void 0:e.spatialReference)}function vt(t){return t!=null&&_(t)?1/(U(t)*Y*X):1}function F(t){return st(t.rotation)||0}function jt(t){return _(t)?U(t)*Y*X:1}function Nt(t,e){return $(t,e,.5)}const nt=function(){const t=l(),e=l(),n=l();return function(r,o,a,i,u,s){return xt(t,o),$(e,a,.5*s),y(n,1/i*s,-1/i*s),yt(r,e),u&&C(r,r,u),J(r,r,n),v(r,r,t),r}}(),rt=function(){const t=l();return function(e,n,r,o){const a=k(n),i=F(n);return N(t,n.targetGeometry),nt(e,t,r,a,i,o)}}(),Ht=function(){const t=l();return function(e,n,r,o){const a=k(n);return N(t,n.targetGeometry),nt(e,t,r,a,0,o)}}();function Ft(t){const e=ft(t);return e?e.valid[1]-e.valid[0]:0}function Xt(t,e){return Math.round(Ft(t)/e)}const Yt=function(){const t=l(),e=l(),n=[0,0,0];return function(r,o,a){q(t,r,o),z(t,t),q(e,r,a),z(e,e),ht(n,t,e);let i=Math.acos(bt(t,e)/(I(t)*I(e)))*At;return n[2]<0&&(i=-i),isNaN(i)&&(i=0),i}}(),Zt=function(){const t=l();return function(e,n,r,o){const a=e.targetGeometry;return G(e,n),Mt(t,n,r,o),a.x+=t[0],a.y+=t[1],e}}(),Wt=function(t,e,n){G(t,e);const r=t.targetGeometry;return r.x=n.x,r.y=n.y,r.spatialReference=n.spatialReference,t},Ut=function(){const t=l();return function(e,n,r,o,a){a||(a="center"),K(t,r,o),$(t,t,.5);const i=t[0],u=t[1];switch(a){case"center":y(t,0,0);break;case"left":y(t,-i,0);break;case"top":y(t,0,u);break;case"right":y(t,i,0);break;case"bottom":y(t,0,-u);break;case"top-left":y(t,-i,u);break;case"bottom-left":y(t,-i,-u);break;case"top-right":y(t,i,u);break;case"bottom-right":y(t,i,-u)}return W(e,n,t),e}}();function te(t,e,n){return G(t,e),t.rotation+=n,t}function ee(t,e,n){return G(t,e),t.rotation=n,t}const qt=function(){const t=l();return function(e,n,r,o,a){return G(e,n),isNaN(r)||r===0||(at(t,o,n,a),e.scale=n.scale*r,ot(t,t,e,a),W(e,e,y(t,t[0]-o[0],o[1]-t[1]))),e}}();function ne(t,e,n){return G(t,e),t.scale=n,t}const zt=function(){const t=l();return function(e,n,r,o,a,i){return G(e,n),isNaN(r)||r===0||(at(t,a,n,i),e.scale=n.scale*r,e.rotation+=o,ot(t,t,e,i),W(e,e,y(t,t[0]-a[0],a[1]-t[1]))),e}}(),re=function(){const t=l(),e=l();return function(n,r,o,a,i,u,s){return et(e,u,s),dt(t,i,e),a?zt(n,r,o,a,t,u):qt(n,r,o,t,u)}}(),at=function(){const t=S();return function(e,n,r,o){return j(e,n,$t(t,r,o,1))}}(),ot=function(){const t=S();return function(e,n,r,o){return j(e,n,rt(t,r,o,1))}}(),W=function(){const t=l(),e=S();return function(n,r,o){G(n,r);const a=k(r),i=n.targetGeometry;return mt(e,F(r)),J(e,e,Gt(a,a)),j(t,o,e),i.x+=t[0],i.y+=t[1],n}}();export{St as $,zt as G,tt as H,re as R,Tt as Y,G as Z,Dt as _,vt as a,te as b,jt as c,Ht as f,Zt as g,Ut as h,ne as j,W as k,rt as l,Ft as m,k as o,Yt as p,et as r,Et as t,nt as u,ee as w,Wt as x,Xt as y};
