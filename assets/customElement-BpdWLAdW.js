const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-DVEy4f7w.js","./index-CjrYEQXz.js","./jsxFactory-CLjKarlq.js","./Accessor-BHnuXKD2.js","./intl-Do3GEEJ7.js","./Promise-CmQqe-ke.js","./cast-BA_-jlhc.js","./index-tefRSezt.js","./index-Cx51aysm.css","./JSONSupport-CGdeqxpk.js","./Evented-DCWccWGU.js","./reactiveUtils-BR0C1Kq4.js","./SimpleObservable-7oieNGD8.js","./uuid-Cl5lrJ4c.js","./guid-ejniuQmw.js","./useT9n-CJAswmP1.js","./index-73bQemcW.js","./dom--xxYYVQF.js","./observers-BdozwIHb.js","./keyed-CdPY5MOf.js","./directive-helpers-C0aXnQdc.js","./ref-Ccn4I0kT.js","./interactive-B8siLByk.js","./loadable-DOQnSSjG.js","./component-CFGnHAqh.js","./index-TFxiSNpz.js","./index-DIp-v4qk.js","./floating-ui-BkLjHVN3.js","./debounce-DbkufipY.js","./openCloseComponent-dw_x67D_.js","./static-g4FJ4v8I.js","./FloatingArrow-D9X-HbKW.js","./useFocusTrap-ENcZoC4L.js","./focusTrapComponent-Br_3Mz8_.js","./key-CZcQa38B.js","./index-CCqZjfSZ.js","./array-BbE1dLa5.js","./index-BSRDeu3E.js","./ExpandToggle-UGfmSgey.js","./index-D1jScw4i.js","./index-cLdK6V3t.js","./index-DSiQ4rVy.js","./index-ujykA9Eq.js","./index-Df8-0rWt.js","./dynamicClasses-pKEMtFzB.js","./index-DIB7yhJF.js","./resources6-Cs2_VmEC.js","./index-BfAp5_ga.js","./customElement-kBYuBfHB.js","./index-1VSl9HgO.js","./index-nrWOrFCt.js","./resources4-Crg87oFz.js","./index-DQOQ3530.js","./index-BFYOU3WJ.js","./index-Bej-0mbI.js","./form-B15gmg4q.js","./label-BLne9qNB.js","./index-BtF7Kdcs.js","./index-B7QXL93z.js","./index-Cdn0mJBU.js","./_commonjsHelpers-DqlTr81k.js","./global-BYws3GYH.js","./index-Bb6Bx1n-.js","./index-Ch_sYKt7.js","./index-BnH8ZLT5.js","./live-BIBBLA6F.js","./core-zHisM37C.js","./filter-Cs9GmjDF.js","./escapeRegExp-UP7ghjt8.js","./Validation-O1TFEQW-.js","./utils3-CmcdYP7V.js","./index-GVt5zfuo.js","./text-CbTMlb2o.js","./index-DrimfvRg.js","./index-BGRynF8w.js","./index-svtat3zr.js","./locale-CXx8I9ox.js","./input-DI9tZAPS.js","./index-D130RxMY.js","./index-DbjTV4Hc.js","./index-Wn4pOF_U.js","./utils-CYuC4O71.js","./index-d5Yy4krW.js","./resources5-SciNIBSe.js","./index-DxcTRSkS.js","./index-CQ1gJMW-.js","./index-BIkUAggI.js","./index-LmcDAlT8.js","./index-BeVvv8sv.js","./index-DWkZ-WI6.js","./index-B7BDzDjX.js"])))=>i.map(i=>d[i]);
import{_ as m,L as De,c as M,n as Be,x as $e,a as Ve}from"./index-tefRSezt.js";import{n as He}from"./ref-Ccn4I0kT.js";import{V as de,d as k,w as We,v as Z,p as Ue}from"./reactiveUtils-BR0C1Kq4.js";import{r as d,m as h,a as X,bG as oe,B as Y,s as pe}from"./Accessor-BHnuXKD2.js";import{h as je}from"./UpdatingHandles-ptqz1ck8.js";import{a as Ce}from"./Field-Cyk7Ur5d.js";import{r as q,l as ge,x as ze,c as qe}from"./layerUtils-dJgsXxkC.js";import{b as Ze}from"./Query-DCBIeen2.js";import{e as N,O as he,c as ue,n as o,i as Je,y as Ke}from"./jsxFactory-CLjKarlq.js";import{e as P}from"./globalCss-CZa70j6i.js";import{e as Ie}from"./vmEvent-D4Ubqkbq.js";import{f as ee}from"./intl-Do3GEEJ7.js";import{e as Ye}from"./throttle-jjSnxk80.js";import{J as Qe,b as Ne,n as Xe,q as et}from"./Graphic-CFXUQZlS.js";import{e as tt,n as it}from"./actionUtils-DSzWsgMf.js";import{n as st,j as rt,t as at}from"./Feature-B-8YZl_M.js";import{h as ot}from"./Spinner-BaW8zyoW.js";import{n as S,D as Me,f as lt}from"./FeaturesViewModel-DowTkE6M.js";import{n as nt,i as Ee}from"./actions-Bp0YlyZO.js";import{e as ct}from"./Heading-DYbI16WN.js";import{s as z}from"./substitute-D1XJWgT5.js";import{s as dt}from"./cast-BA_-jlhc.js";import{i as ht}from"./Evented-DCWccWGU.js";import{l as me,u as ut}from"./jsonUtils-Cu7OBRmN.js";import pt from"./FeatureLayer-9fyQxXYm.js";import{h as Oe}from"./GraphicsLayer-Acqd2VFm.js";import{h as gt,n as mt}from"./UtilityNetwork-Bzh8FoEm.js";import{C as _t}from"./Portal-CTRRujjZ.js";import{s as yt}from"./utils-Cf-KB5Fk.js";import{trace as wt}from"./trace-B27F3pCg.js";import{m as ft,a as te}from"./TraceParameters-SX8Om0HU.js";import{e as vt}from"./layerUtils-BS1Di3Pm.js";import{geodesicBuffer as _e,buffer as ye,convexHull as ie,geodesicArea as bt,planarArea as At,cut as we,planarLength as V}from"./geometryEngine-CtEcpiHE.js";import{P as Tt}from"./Polyline-BmuD2-ZN.js";import{O as se,K as kt}from"./projection-B2I9Bzj_.js";import{g as J}from"./Point-XGrwlf63.js";import{S as le,d as St,y as fe}from"./TextSymbol-BQ_NW9Xo.js";import{p as Ft,d as Rt}from"./SnappingManager-CF4NflXd.js";import{y as Ct}from"./SketchViewModel-BHWV3FYM.js";import{L as It,p as Nt,S as Mt,P as Et}from"./component-utils-DWY0IMHC.js";import{a as Ot}from"./disconnected-B4PBI24G.js";import"./directive-helpers-C0aXnQdc.js";import"./SimpleObservable-7oieNGD8.js";import"./JSONSupport-CGdeqxpk.js";import"./enumeration-Cr5WIZs4.js";import"./writer-B2bQV2uU.js";import"./fieldType-L-VlbZqy.js";import"./typeUtils-BSg8Y507.js";import"./Extent-CBBGeHb-.js";import"./FullTextSearch-BWm_kPUE.js";import"./Clonable-DvJsj5LF.js";import"./TimeExtent-J5qnUFx_.js";import"./timeUtils-D2X862bk.js";import"./Promise-CmQqe-ke.js";import"./uuid-Cl5lrJ4c.js";import"./opacityUtils-CSd4XoR2.js";import"./Color-gncXBiLc.js";import"./colorUtils-Rxh2V3ai.js";import"./mathUtils-DV9iOXpW.js";import"./ActionToggle-__-l4AdQ.js";import"./Identifiable-BrT7zvUW.js";import"./collectionUtils-CbaToa73.js";import"./screenUtils-_ZIvrt5o.js";import"./vec3f64-BLpZdpfb.js";import"./aaBoundingBox-CeBivBRq.js";import"./Attachments-DB43Iyjz.js";import"./unitFormatUtils-Dbksq3U5.js";import"./ByteSizeUnit-BsxeN7wM.js";import"./Cyclical-CPiNl4ru.js";import"./quantityUtils-1LswOhxZ.js";import"./AttachmentInfo-mF-dnIj-.js";import"./AttachmentQuery-BceVlzuF.js";import"./featureUtils-x0Mr5AqG.js";import"./utils-DLmnG8WZ.js";import"./mat4f32-DcsiF_Rp.js";import"./mat4-Fi6iAz29.js";import"./common-DQOJ18NT.js";import"./timeZoneUtils-COos5xIr.js";import"./attachmentUtils-CmLhj4mw.js";import"./legacyIcon-CEIp6Pa9.js";import"./FeatureRelationshipViewModel-D-pAIuUr.js";import"./ReactiveMap-Dwhwbx9R.js";import"./NetworkElement-Dpf4duUb.js";import"./RelationshipQuery-W-4bfgaH.js";import"./featureFormUtils-BLdtQWdc.js";import"./formUtils-DXUHP5lI.js";import"./dateUtils-DDHuDOGz.js";import"./widget-AxfSz_k8.js";import"./uriUtils-C_sgAgIJ.js";import"./a11yUtils-CSYUX1kC.js";import"./utils-p7rkm04s.js";import"./ColorStop-CDpeFWOz.js";import"./utils-9nq77ifz.js";import"./jsonUtils-TjZmCq6l.js";import"./utils-DYurMneM.js";import"./cimSymbolUtils-azhJhO4Y.js";import"./utils-B91u8350.js";import"./defaultCIMValues-DII_GG3u.js";import"./enums-BJSSbDkD.js";import"./LRUCache-DS2O1kTf.js";import"./MemCache-CDoaVBHf.js";import"./HeatmapColorStop-c4wClnpW.js";import"./executeQueryJSON-CLYdIUdF.js";import"./utils-Cy8wFNQo.js";import"./query-BS_L6I0Q.js";import"./normalizeUtils-XRAPXbWa.js";import"./normalizeUtilsCommon-D0zPTJCj.js";import"./utils-CkSELPnj.js";import"./pbfQueryUtils-AwPAOS5M.js";import"./pbf-CFI-xDDp.js";import"./memoryEstimations-5gFNwkKK.js";import"./OptimizedGeometry-7IxBWtHr.js";import"./OptimizedFeature-DcMLlxvB.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./queryZScale-DwN6mTru.js";import"./FeatureSet-DpCN730g.js";import"./themeUtils-C3zvZbsE.js";import"./shared-M7rSkUll.js";import"./TimeOnly-yGYcAQQJ.js";import"./popupUtils-pQ0CVidQ.js";import"./AnchorElementViewModel-CqI4lmqA.js";import"./ReactiveSet-CoXPgSt3.js";import"./geometryUtils-3VSSujWc.js";import"./scaleUtils-CfLu-sg1.js";import"./LayerConstants-B33OP6sh.js";import"./symbolUtils-C5ImIHMe.js";import"./colorUtils-BAowQmkN.js";import"./vec42-YcqnINSP.js";import"./vec4f64-o2zAXfmz.js";import"./mat2df32-orApM5a3.js";import"./mat2d-D9DBP-jx.js";import"./webStyleSymbolUtils-DEYm8EyF.js";import"./devEnvironmentUtils-CnNDiFMM.js";import"./jsonUtils-Dzgxk9pw.js";import"./defaults-Dwxdhopq.js";import"./defaultsJSON-GKolV7NZ.js";import"./styleUtils-BB-zx7mT.js";import"./webStyleAcceptedFormats-CG7ZQ6BV.js";import"./layerViewUtils-tkZ5z_iY.js";import"./GoTo-BsXOAO95.js";import"./MultiOriginJSONSupport-nGLpCFeg.js";import"./layerContainerType-C5CzMsLd.js";import"./FeatureLayerBase-DsahGowz.js";import"./HeightModelInfo-B3GZyQFz.js";import"./commonProperties-C0eC30J9.js";import"./ElevationInfo-Di4W6v5U.js";import"./unitConversionUtils-C4AR5obr.js";import"./lengthUtils-DjJgJFRg.js";import"./AttributeTableTemplate-B7rH2qLr.js";import"./featureLayerUtils-BzWCGee1.js";import"./featureQueryAll-xezK3WCp.js";import"./SimpleRenderer-gSw1WaJS.js";import"./commonProperties-bGHL1a5M.js";import"./colorRamps-Dkx8zIVn.js";import"./SizeVariable-IzD1bP2e.js";import"./visualVariableUtils-Bp9QCb8E.js";import"./UniqueValueRenderer-Cri3tgP5.js";import"./diffUtils-CMkuJvD2.js";import"./RendererLegendOptions-mgfHoilI.js";import"./NormalizationBinParametersMixin-D6iHLB7I.js";import"./LayerFloorInfo-BXAHB-yQ.js";import"./Relationship-BBBusoKs.js";import"./serviceCapabilitiesUtils-BuKg0yWx.js";import"./infoFor3D-CsJzgCF0.js";import"./Layer-C9uQlTBT.js";import"./workers-D8Q3pEzK.js";import"./Queue-BOnccek2.js";import"./editsZScale-BKYnJc2O.js";import"./APIKeyMixin-Btq102Nx.js";import"./ArcGISService-BHkTabnw.js";import"./ScaleRangeLayer-C59zG_yk.js";import"./CustomParametersMixin-uo3x70vd.js";import"./DisplayFilteredLayer-BFGyM6i5.js";import"./displayFilterUtils-DV_nOx_h.js";import"./EditBusLayer-Cx9SJosU.js";import"./FeatureEffectLayer-D3Dl2pXD.js";import"./FeatureEffect-xxsfLT-y.js";import"./FeatureFilter-DEE1jTWq.js";import"./FeatureReductionLayer-x8j38_gH.js";import"./FeatureReductionSelection-BpUGF9oj.js";import"./labelingInfo-BvMdv93l.js";import"./labelUtils-Dq8OkaT-.js";import"./jsonUtils-DD1NMzWj.js";import"./typeUtils-CfF4cYo5.js";import"./ClassBreaksRenderer-BBSNkSFx.js";import"./Version-9k2AOv05.js";import"./FieldsIndex-DFdVonga.js";import"./heatmapUtils-DA7NmY3d.js";import"./MD5-C9MwAd2G.js";import"./OperationalLayer-Bts9W3HA.js";import"./OrderedLayer-BP2hvfL_.js";import"./OrderByInfo-E-O9nvtm.js";import"./PortalLayer-jhi5QQgB.js";import"./PortalItem-CXk7DqVv.js";import"./portalItemUtils-rm7sAgcm.js";import"./RefreshableLayer-Cn2UpWQD.js";import"./TemporalLayer-CYEvmdjr.js";import"./TimeInfo-LjqhhubF.js";import"./TimeInterval-BDTTJ9Uw.js";import"./TrackableLayer-D6paP6wl.js";import"./FeatureTemplate-DqbLvkbZ.js";import"./FeatureType-DjGGrg1i.js";import"./fieldProperties-B9JP3-ue.js";import"./TitleCreator-Zm6TQ_ec.js";import"./versionUtils-DSsYFI36.js";import"./styleUtils-BQ_uVsZf.js";import"./interfaces-CL2NbQte.js";import"./projectBuffer-DOU0xvVi.js";import"./geodesicConstants-yASAK_zX.js";import"./GraphicsCollection-CkliHSk1.js";import"./typeUtils-CUNOqFiB.js";import"./UNTraceConfiguration-H1hsoh6C.js";import"./networkFieldUtils-iOtCEyIS.js";import"./TraceResult-aVfvEsRx.js";import"./geometryEngineBase-yFIvKOkM.js";import"./_commonjsHelpers-DCkdB7M8.js";import"./hydrated-Dw-Mfo_Y.js";import"./elevationInfoUtils-RSZ4Logn.js";import"./RightAngleSnappingHint-CCcBBYgG.js";import"./vec32-Dvg_eL9J.js";import"./projectVectorToVector-dS8io47t.js";import"./projectPointToVector-BS0u8fq6.js";import"./InputManager-Bs9UE-jw.js";import"./signal-DSa0yokC.js";import"./keybindings-DrKrBFID.js";import"./utils-D02V2_jH.js";import"./vec2-maR1OrZI.js";import"./vec2f64-Dy6m9Nrb.js";import"./geodesicUtils-Bh_GX0Qj.js";import"./plane-4dpuo6-e.js";import"./mat3f64-BBpwCtoL.js";import"./mat4f64-Dk4dwAN8.js";import"./quatf64-CCm9z-pX.js";import"./mathUtils-B9R7G-2c.js";import"./sphere-DQxj5tsv.js";import"./mat3-CR8GKnhD.js";import"./geometry2dUtils-vtViF5g_.js";import"./viewUtils-Ce2x26K8.js";import"./SketchLabelOptions-CwtwEofC.js";import"./SketchOptions-92Ul6Fzp.js";import"./angularMeasurementUtils-lDJJxFDs.js";import"./hitTestSelectUtils-UXJPjatw.js";import"./screenUtils-DyhV4TAA.js";const C=nt.clone(),ve="esri-utility-network-trace",Pt={base:ve,featureContent:`${ve}__feature-content`};let R=class extends he{constructor(e,i){super(e,i),this._utilityNetworkTraceMessages=null,this.closed=!1,this.closable=!0,this.messages=null,this.messagesCommon=null,this._handleAddNonspatialTraceLocation=s=>{this.emit("add-nso-trace-location",{featureWidget:s})},this._handleOpenFeature=s=>{this.emit("open-feature",{feature:s})},this._handleZoomToFeature=s=>{this.emit("zoom-to-feature",{featureWidget:s})}}initialize(){(async()=>this._utilityNetworkTraceMessages=await ee("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace"))()}loadDependencies(){return ue({action:()=>m(()=>import("./index-DVEy4f7w.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]),import.meta.url),"action-bar":()=>m(()=>import("./index-TFxiSNpz.js"),__vite__mapDeps([25,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,35,36,37,38]),import.meta.url),"action-group":()=>m(()=>import("./index-BSRDeu3E.js").then(e=>e.i),__vite__mapDeps([37,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,35,36]),import.meta.url),"flow-item":()=>m(()=>import("./index-D1jScw4i.js"),__vite__mapDeps([39,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,35,36,40,41]),import.meta.url)})}get mode(){return this._get("mode")||"show-feature-info"}set mode(e){this._set("mode",e)}render(){const{flowItems:e}=this,i=e==null?void 0:e.toArray();return o(Je,null,i==null?void 0:i.map((s,r)=>this._renderFlowItem(s,r===e.length-1)))}_renderAddNonspatialTraceLocationAction(e){const{_utilityNetworkTraceMessages:i}=this;return o("calcite-action",{appearance:"solid",bind:this,icon:"utility-network-trace",onclick:()=>this._handleAddNonspatialTraceLocation(e),scale:"s",text:i.inputsStrings.addNonspatialOption,textEnabled:!0,title:i.inputsStrings.addNonspatialOption})}_renderFlowItem(e,i){var f;const{messages:s,closable:r,closed:a}=this,l="graphic"in e&&!e.isTable,n=e.flowType==="feature-association",c=this._getExitMessage(e),u=s.selectFeature,p=e,y=p?(f=p.graphic)==null?void 0:f.layer:null,_=!(y&&y.geometryType);return o("calcite-flow-item",{bind:this,closable:r,closed:a,description:this._getDrillInFlowItemDescription(e),heading:e.title??"",key:`flow-item-${e.viewModel.uid}`,selected:i,onCalciteFlowItemBack:A=>{A.preventDefault(),this._handleDrillInBackClick()}},o("calcite-action",{appearance:"transparent",bind:this,class:S.actionExit,icon:"move-up",key:"exit-action",onclick:this._handleExitClick,slot:"header-actions-start",text:c,title:c}),l?o("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-feature-action",onclick:()=>this._handleOpenFeature(e),slot:"header-actions-end",text:u,title:u}):null,this.mode==="show-feature-info"?o("calcite-action",{icon:"x",onclick:()=>{this.emit("close")},slot:"header-actions-end",text:this.messagesCommon.close}):void 0,n&&this.mode==="add-nso"?o("calcite-action-bar",{expandDisabled:!0,expanded:!0,key:"header-action-bar",scale:"s",slot:"action-bar"},o("calcite-action-group",{overlayPositioning:"fixed",scale:"s"},_?this._renderAddNonspatialTraceLocationAction(e):this._renderZoomToFeatureAction(e))):null,o("div",{class:this.classes(S.container,Pt.featureContent)},e.render()))}_renderZoomToFeatureAction(e){const i=this._getActionTitle(C);return o("calcite-action",{active:C.active,appearance:"solid",bind:this,"data-action-uid":C.uid,disabled:C.disabled,icon:C.icon??"question",indicator:C.indicator,key:`action-${C.uid}`,loading:C.active,onclick:()=>this._handleZoomToFeature(e),scale:"s",text:i,textEnabled:!0,title:i})}_getActionTitle(e){const{messages:i}=this,{id:s}=e,r=e.title??"";return s==="zoom-to-feature"?z(r,{messages:i}):r}_getDrillInFlowItemDescription(e){switch(e.flowType){case"feature":case"feature-association":case"feature-utility-network-associations":return e.viewModel.description??"";case"feature-relationship":return e.allItemsDescription;case"feature-utility-network-association-type":return e.description??""}}_getExitMessage(e){switch(e.flowType){case"feature":case"feature-association":return"";case"feature-relationship":return this.messages.exitRelatedRecords;case"feature-utility-network-associations":case"feature-utility-network-association-type":return this.messages.exitAssociations}}_handleDrillInBackClick(){var i;const e=(i=this.flowItems)==null?void 0:i.pop();e&&("showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e&&(e.viewModel=null,e.destroy()))}_handleExitClick(){this.emit("exit")}};d([h()],R.prototype,"closed",void 0),d([h()],R.prototype,"closable",void 0),d([h()],R.prototype,"flowItems",void 0),d([h(),N("esri/widgets/Features/t9n/Features")],R.prototype,"messages",void 0),d([h(),N("esri/t9n/common")],R.prototype,"messagesCommon",void 0),d([h()],R.prototype,"mode",null),R=d([X("esri.widgets.UtilityNetworkTrace.UtilityNetworkTraceFeaturesDrillIn")],R);const Lt=R,Gt="selected-index",xt=0,be="features-spinner",E="esri-utility-network-trace",I={base:E,blockContainer:`${E}__block-container`,blockContent:`${E}__block-content`,featureContent:`${E}__feature-content`,paddingBottom:`${E}__pad-bottom`,paddingTop:`${E}__pad-top`};let w=class extends st(he){constructor(e,i){super(e,i),this._actionBarMenuNode=null,this._drillInFlowItems=new de,this._drillInWidget=new Lt({flowItems:this._drillInFlowItems}),this._feature=null,this._featureMenuViewportNode=null,this._spinner=null,this._utilityNetworkTraceMessages=null,this.featureNavigationTop=!1,this.headerActions=new Ee,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new Me,this._renderAction=(s,r)=>{const a=this._getActionTitle(s),{type:l,active:n,uid:c,disabled:u,indicator:p}=s;return s.visible?o("calcite-action",{active:l==="toggle"&&s.value,appearance:"solid",bind:this,"data-action-uid":c,disabled:s.id==="zoom-to-feature"?!this.feature.geometry:u,icon:this._getActionIcon(s),indicator:p,key:`action-${r}`,loading:n,onclick:this._triggerAction,scale:"s",text:a,title:this._hideActionText?a:void 0},this._renderFallbackIcon(s)):null},this._renderAddNsoBlock=()=>{const{_utilityNetworkTraceMessages:s,messagesCommon:r}=this;return o("calcite-block",{class:I.blockContent,heading:s==null?void 0:s.inputsStrings.addNonspatialOption,open:!this.feature},o("calcite-action",{icon:"x",onclick:()=>this.emit("close-un-trace-feature-block"),slot:"control",text:r.close}),o("calcite-notice",{icon:"information",kind:"info",open:!this.feature},o("div",{slot:"message"},s==null?void 0:s.inputsStrings.addNonspatialHint)))},this._renderNoAssociationNotice=()=>{const{_utilityNetworkTraceMessages:s}=this;return o("calcite-notice",{class:this.classes(I.paddingBottom,I.paddingTop),icon:"exclamation-mark-triangle",kind:"danger",open:!0},o("div",{slot:"message"},s.alertsStrings.noAssociationsConfigured))},this._renderNoPopupErrorBlock=()=>{const{_utilityNetworkTraceMessages:s,messagesCommon:r}=this;return o("calcite-block",{description:void 0,heading:this.mode==="show-feature-info"?r.warning:void 0,open:!0},o("calcite-notice",{class:this.classes(I.paddingBottom,I.paddingTop),icon:"exclamation-mark-triangle",kind:"danger",open:!0},o("div",{slot:"message"},s.alertsStrings.noPopupConfigured)),this.mode==="show-feature-info"?o("calcite-action",{icon:"x",onclick:()=>this.emit("close-un-trace-feature-block"),slot:"control",text:r.close}):void 0)},this._displaySpinnerThrottled=Ye(()=>this._displaySpinner(),xt),this.addHandles([this._displaySpinnerThrottled,k(()=>{var s;return(s=this.viewModel)==null?void 0:s.active},s=>this._drillInWidget.closed=!s),k(()=>{var s;return(s=this.viewModel)==null?void 0:s.view},(s,r)=>this._viewChange(s,r)),k(()=>{var s,r;return(r=(s=this.viewModel)==null?void 0:s.view)==null?void 0:r.ready},(s,r)=>this._viewReadyChange(s??!1,r??!1)),k(()=>{var s,r;return[(s=this.viewModel)==null?void 0:s.waitingForResult,(r=this.viewModel)==null?void 0:r.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),k(()=>{var s;return(s=this.viewModel)==null?void 0:s.screenLocation},()=>this._closeOpenActionMenu()),k(()=>this.selectedFeatureWidget,()=>this._destroyDrillInFlowItemWidgets()),k(()=>{var r;const s=(r=this.selectedFeatureWidget)==null?void 0:r.viewModel;return[s==null?void 0:s.title,s==null?void 0:s.state]},()=>this._setTitleFromFeatureWidget()),k(()=>{var r;const s=(r=this.selectedFeatureWidget)==null?void 0:r.viewModel;return[s==null?void 0:s.content,s==null?void 0:s.state]},()=>this._setContentFromFeatureWidget()),k(()=>{var s;return(s=this.viewModel)==null?void 0:s.featureViewModels},()=>this._featureMenuViewportScrollTop()),this._drillInWidget.on("close",()=>{this.emit("close")}),this._drillInWidget.on("exit",()=>this._destroyDrillInFlowItemWidgets()),this._drillInWidget.on("open-feature",({feature:s})=>this._openRelatedFeature(s)),this._drillInWidget.on("zoom-to-feature",({featureWidget:s})=>lt(this.viewModel,s)),this._drillInWidget.on("add-nso-trace-location",({featureWidget:s})=>this.emit("add-nso-trace-location",{featureWidget:s}))])}initialize(){(async()=>this._utilityNetworkTraceMessages=await ee("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace"))(),this._drillInWidget.mode=this.mode,this._drillInWidget.closable=!1}loadDependencies(){return ue({action:()=>m(()=>import("./index-DVEy4f7w.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]),import.meta.url),"action-bar":()=>m(()=>import("./index-TFxiSNpz.js"),__vite__mapDeps([25,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,35,36,37,38]),import.meta.url),"action-group":()=>m(()=>import("./index-BSRDeu3E.js").then(e=>e.i),__vite__mapDeps([37,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,35,36]),import.meta.url),block:()=>m(()=>import("./index-ujykA9Eq.js"),__vite__mapDeps([42,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,40,21,20,18,17,16,43,27,28,22,34,23,29,44,0,19,24,45,46,47,48,26,30,31,32,33,35,36]),import.meta.url),flow:()=>m(()=>import("./index-1VSl9HgO.js"),__vite__mapDeps([49,2,3,4,5,6,7,8,9,10,11,12,13,21,20,18,23,17,14]),import.meta.url),"flow-item":()=>m(()=>import("./index-D1jScw4i.js"),__vite__mapDeps([39,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,35,36,40,41]),import.meta.url),notice:()=>m(()=>import("./index-nrWOrFCt.js"),__vite__mapDeps([50,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,21,20,23,51,29,24,15]),import.meta.url)})}destroy(){var e;this._destroyDrillInFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),(e=this._drillInWidget)==null||e.destroy()}get _hideActionText(){var i;if(!this.responsiveActionsEnabled)return!1;const e=(i=this.view)==null?void 0:i.widthBreakpoint;return e==="xsmall"||e==="small"||e==="medium"}get active(){return this.viewModel.active}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get feature(){return this.viewModel.features.length?this.viewModel.features[0]:null}set feature(e){this.viewModel.features=e?[e]:[]}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get hasAssociationsPopupElement(){var a,l,n,c;const e=q((a=this.feature)==null?void 0:a.layer)?(l=this.feature)==null?void 0:l.layer:void 0,i=ge((n=this.feature)==null?void 0:n.layer)?(c=this.feature)==null?void 0:c.layer:void 0,s=(e==null?void 0:e.popupTemplate)||(i==null?void 0:i.popupTemplate)||null,r=s==null?void 0:s.content;return!(Array.isArray(r)&&!r.some(u=>u instanceof Qe))}get hasPopupInfo(){var s,r,a,l;const e=q((s=this.feature)==null?void 0:s.layer)?(r=this.feature)==null?void 0:r.layer:void 0,i=ge((a=this.feature)==null?void 0:a.layer)?(l=this.feature)==null?void 0:l.layer:void 0;return!(!(e!=null&&e.popupTemplate)&&!(i!=null&&i.popupTemplate))}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get mode(){return this._get("mode")||"add-nso"}set mode(e){this._set("mode",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedDrillInFeature(){const e=Array.from(this._drillInFlowItems).at(-1);if(!e)return null;const{flowType:i}=e;return i==="feature-association"||i==="feature-relationship"?e.graphic??null:null}get selectedFeatureWidget(){const{_feature:e,headingLevel:i,_drillInFlowItems:s,timeZone:r}=this,{selectedFeatureViewModel:a}=this.viewModel,l={title:!1};return a?(e?(e.viewModel=a,e.visibleElements=l):this._feature=new rt({flowItems:s,headingLevel:i+1,timeZone:r,viewModel:a,visibleElements:l}),this._feature):null}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}open(e){this.removeHandles(Gt),this.viewModel.open({features:[e]})}triggerAction(e){return this.viewModel.triggerAction(e)}render(){return o("div",{bind:this,class:this.classes(S.base,P.widget,P.panel,I.blockContainer)},this.mode==="add-nso"?this._renderAddNsoBlock():void 0,this.feature?this.hasPopupInfo?this._renderContentContainer():this._renderNoPopupErrorBlock():void 0)}_renderActionBar(){var e;return(e=this.viewModel.allActions)!=null&&e.length?o("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},o("calcite-action-group",{afterCreate:i=>this._actionBarMenuNode=i,overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(this._renderAction)}_renderContent(){var i;const e=(i=this.viewModel)==null?void 0:i.content;return e?typeof e=="string"?o("div",{class:at.contentNode,innerHTML:e,key:e}):this.renderNodeContent(e):null}_renderContentContainer(){const e=[this._renderContentFeature(),this._drillInWidget.render()];return o("calcite-flow",{key:"content-container"},e)}_renderContentFeature(){const{_drillInFlowItems:e,headingLevel:i,featureNavigationTop:s}=this,{title:r,active:a}=this.viewModel,l=r||"";return o("calcite-flow-item",{bind:this,class:this.classes({[S.contentFeature]:!0}),closed:!a,collapseDirection:s?"down":"up",headingLevel:i,key:"root-flow-item",loading:this.viewModel.waitingForContents,selected:e.length===0},this.mode==="show-feature-info"?o("calcite-action",{icon:"x",onclick:()=>{this.emit("close")},slot:"header-actions-end",text:this.messagesCommon.close}):void 0,l?o(ct,{class:this.classes(S.featuresHeading,P.heading),innerHTML:l,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),this.hasAssociationsPopupElement?void 0:this._renderNoAssociationNotice(),o("div",{class:this.mode==="add-nso"?this.classes(S.container,S.contentContainer):this.classes(S.container,S.contentContainer,I.featureContent)},this._renderContent()))}_renderFallbackIcon(e){const{className:i,icon:s}=e;if(s)return null;const r=tt({action:e,feature:this.selectedFeature}),a={[S.icon]:!!i,[S.actionImage]:!!r};return i&&(a[i]=!0),r||i?o("span",{"aria-hidden":"true",class:this.classes(S.icon,a),key:"icon",styles:it(r)}):null}_renderHeaderAction(e,i){const s=e.title||"";return e.visible?o("calcite-action",{active:e.type==="toggle"&&e.value,appearance:"solid",bind:this,"data-action-uid":e.uid,disabled:e.disabled||!this.feature.geometry,icon:e.icon??void 0,indicator:e.indicator,key:`header-action-${i}`,loading:e.active,onclick:this._triggerHeaderAction,slot:"header-actions-end",text:s,title:s}):null}_renderHeaderActions(){return this.headerActions.map((e,i)=>this._renderHeaderAction(e,i)).toArray()}_closeOpenActionMenu(){const{_actionBarMenuNode:e}=this;e&&(e.menuOpen=!1)}_createSpinner(e){e&&(this._spinner=new ot({view:e}),e.ui.add(this._spinner,{key:be,position:"manual",internal:!0}))}_destroyDrillInFlowItemWidgets(){this._drillInFlowItems.drain(e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()})}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,!e.destroyed&&e.destroy()),this._feature=null}_destroySpinner(){var s;const{_spinner:e,view:i}=this;e&&((s=i==null?void 0:i.ui)==null||s.remove(e,be),e.destroy(),this._spinner=null)}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:i,waitingForResult:s}=this.viewModel;s&&i?e.show({location:i}):e.hide()}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}_getActionIcon(e){return e.icon?e.icon:e.image||e.className?void 0:"question"}_getActionTitle(e){const{messages:i,selectedFeature:s,messagesCommon:r}=this,{id:a}=e,l=s==null?void 0:s.attributes,n=e.title??"",c=a==="zoom-to-feature"?z(n,{messages:i}):a==="remove-selected-feature"?z(n,{messages:r}):a==="zoom-to-clustered-features"||a==="browse-clustered-features"?z(n,{messages:i}):e.title;return c&&l?z(c,l):c??""}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}async _openRelatedFeature(e){await e.viewModel.updateGeometry();const i=e.graphic,s=i==null?void 0:i.geometry;s!=null&&i!=null&&(this._destroyDrillInFlowItemWidgets(),await this.viewModel.zoomTo({target:s}),this.open(i))}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:e,messagesCommon:i}=this,s=e==null?void 0:e.viewModel;e&&(this.viewModel.title=(s==null?void 0:s.state)==="error"?i==null?void 0:i.errorMessage:(s==null?void 0:s.title)||"")}_triggerAction(e){const i=e.currentTarget;if(i.disabled)return;const s=i.dataset.actionUid,{allActions:r}=this.viewModel,a=r.findIndex(n=>n.uid===s),l=r.at(a);l&&l.type==="toggle"&&(l.value=!l.value),this.viewModel.triggerAction(a)}_triggerHeaderAction(e){const i=e.currentTarget;if(i.disabled)return;const s=i.dataset.actionUid,r=this.headerActions.find(({uid:a})=>a===s);r&&!r.disabled&&((r==null?void 0:r.type)==="toggle"&&(r.value=!r.value),this.emit("trigger-header-action",{action:r}))}_viewReadyChange(e,i){var s;e?this._wireUpView((s=this.viewModel)==null?void 0:s.view):i&&this.viewModel.clear()}_viewChange(e,i){e&&i&&this.viewModel.clear()}_wireUpView(e){this._destroySpinner(),e&&this._createSpinner(e)}};d([h()],w.prototype,"_drillInFlowItems",void 0),d([h()],w.prototype,"_hideActionText",null),d([h({readOnly:!0})],w.prototype,"active",null),d([h()],w.prototype,"content",null),d([h()],w.prototype,"feature",null),d([h()],w.prototype,"featureNavigationTop",void 0),d([h()],w.prototype,"goToOverride",null),d([h()],w.prototype,"hasAssociationsPopupElement",null),d([h()],w.prototype,"hasPopupInfo",null),d([h({type:Ee})],w.prototype,"headerActions",void 0),d([h()],w.prototype,"headingLevel",void 0),d([h()],w.prototype,"location",null),d([h(),N("esri/widgets/Features/t9n/Features")],w.prototype,"messages",void 0),d([h(),N("esri/t9n/common")],w.prototype,"messagesCommon",void 0),d([h()],w.prototype,"mode",null),d([h()],w.prototype,"promises",null),d([h()],w.prototype,"responsiveActionsEnabled",void 0),d([h({readOnly:!0})],w.prototype,"selectedFeature",null),d([h({readOnly:!0})],w.prototype,"selectedDrillInFeature",null),d([h({readOnly:!0})],w.prototype,"selectedFeatureWidget",null),d([h()],w.prototype,"timeZone",null),d([h()],w.prototype,"view",null),d([h({type:Me}),Ie(["triggerAction","trigger-action"])],w.prototype,"viewModel",void 0),w=d([X("esri.widgets.UtilityNetworkTrace.UtilityNetworkTraceFeature")],w);const Ae=w;function re(t){return t.type==="polygon"||t.type==="polyline"}function Dt(t){return t.hasOwnProperty("points")}function Bt(t){return Dt(t)&&t.points.length===2}let Pe=class{createBuffer(e,i,s,r){if(Array.isArray(e)){if(e.length>0){const l=J.fromJSON(e[0].spatialReference);return l.isWGS84||l.isWebMercator?_e(e,i,s,r):ye(e,i,s,r)}return}const a=J.fromJSON(e.spatialReference);return a.isWGS84||a.isWebMercator?_e(e,i[0],s):ye(e,i[0],s)}createConvexHull(e){if(Array.isArray(e)){if(e.length===1&&Bt(e[0])){const s=ie(e[0]);if(re(s))return s}return ie(e,!0).filter(re)}const i=ie(e);if(re(i))return i}calculateArea(e,i){const s=new J({wkid:e.spatialReference.wkid});return s.isWGS84||s.isWebMercator?parseFloat(bt(e,i).toFixed(2)):parseFloat(At(e,i).toFixed(2))}mergeAggregatedToGeometries(e){const i=[],{line:s,multipoint:r,polygon:a}=e;return s&&i.push(s),r&&i.push(r),a&&i.push(a),i}getPercentageAlong(e,i,s){let r=e;const a=this._createPolyline(e.paths,s.wkid);if(i.type==="point"){const n=i.x-.5,c=i.x+.5,u=[[[n,i.y-.5],[c,i.y+.5]]];r=this._createPolyline(u,i.spatialReference.wkid),r=se(r,s);const p=we(a,r);if(p.length>0){const y=V(a,"feet");let _;return _=p[0].paths[0][0][0]===a.paths[0][0][0]?V(p[0],"feet"):V(p[1],"feet"),[_/y]}return[.5]}r=se(i,s);const l=we(a,r);if(l.length>0){const n=V(a,"feet");return[V(l[0],"feet")/n]}return[.5]}async projectGeometry(e,i){return await kt(),se(e,i)}_createPolyline(e,i){return new Tt({hasZ:!1,hasM:!0,paths:e,spatialReference:new J({wkid:i})})}};const Le=[227,27,21,.6],Ge=[21,244,21,.6],K=12,ne=[{color:[255,0,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#ff0000"},{color:[255,0,255,.6],haloOpacity:.9,fillOpacity:.2,hex:"#ff00ff"},{color:[217,188,255,.6],haloOpacity:.9,fillOpacity:.2,hex:"#D9BCFF"},{color:[0,255,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#00ff00"},{color:[255,255,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#ffff00"},{color:[0,0,255,.6],haloOpacity:.9,fillOpacity:.2,hex:"#0000ff"},{color:[255,165,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#ffa500"},{color:[0,0,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#000000"}];class $t{constructor(){this.highlightColor=[...ne]}addCustomColor(e){this.highlightColor=[...ne],this.highlightColor.some(i=>i.hex.toLowerCase()===e.hex.toLowerCase())||this.highlightColor.push(e)}getFlagGraphic(e,i,s,r){const a=i==="starting-point"?Ge:Le;if(e.type==="polygon"){const l=e;l.centroid&&(e=l.centroid)}return r?this.makeGraphic(e,a,s==null?void 0:s.attributes,null,r):this.makeGraphic(e,a,s==null?void 0:s.attributes)}initializeSketch(e,i,s){const r=new de;return s.forEach(a=>r.add(new Ft({layer:a,enabled:!0}))),new Ct({layer:i,view:e,snappingOptions:new Rt({enabled:!0,featureEnabled:!0,featureSources:r})})}makeGraphic(e,i,s,r,a){let l,n=e;switch(e.type){case"multipoint":l=new fe({color:i,size:K,outline:{color:i,width:0}}),r&&(n=e);break;case"point":l=a||new fe({color:i,size:K,outline:{color:i,width:0}}),r&&(n=e);break;case"polyline":l=new St({color:i,width:K}),r&&(n=e);break;case"polygon":l=new le({color:i,outline:{color:i,width:K}}),r&&(n=e)}return new Ne({geometry:n,symbol:l,attributes:s??null})}}const O=`utility-network-trace-result-area-${Date.now()}`;function H(t){return t.type==="graphics"}class Vt{constructor(){this.traceInformation={},this._geometryHandler=new Pe}addResultAreaToMap(e,i){const s=this.createGraphicLayer(i);s&&H(s)&&s.add(e)}changeResultAreaColor(e,i,s){const r=new le({color:i.color,style:"solid",outline:{color:i.color,width:1}}),a=this._findGraphicsByTraceId(e,s);return a&&a.forEach(l=>{l.symbol=r}),r}createBuffer(e,i,s,r){return this._geometryHandler.createBuffer(e,i,s,r)}createConvexHull(e,i,s){const r=this._geometryHandler.createConvexHull(e);return i>0&&r?this.createBuffer(r,[i],s,!1):r}createResultAreaGraphic(e,i,s,r,a,l){var u;const n=new le({color:l.color,style:"solid",outline:{color:l.color,width:1}}),c=[];for(const p in i)c.push(new Xe({fieldName:p,label:p==="areaStatistic"?r.attributeStrings[p]+" ("+((u=a.units[s])==null?void 0:u.abbr)+")":r.attributeStrings[p]}));return new Ne({geometry:e,symbol:n,attributes:i,popupTemplate:new et({title:i.traceName,content:[{type:"fields",fieldInfos:c}]})})}removeResultArea(e,i){const s=i.findLayerById(O);if(s&&H(s)){const r=this._findGraphicsByTraceId(e,i);return r&&s.removeMany(r),r}return null}removeAllResultAreaGraphics(e){if(e){const i=e.findLayerById(O);i&&H(i)&&i.removeAll()}}createGraphicLayer(e,i){const s=e.findLayerById(O);if(s&&H(s))return s;const r=new Oe({title:i??O,listMode:"hide",id:O});return e.add(r),r}_findGraphicsByTraceId(e,i){const s=i.findLayerById(O);if(s&&H(s)){const r=s.graphics.filter(a=>a.attributes.traceId===e);return r.length>0?r.toArray():null}return null}}function Te(t){return t.type==="feature"}function ae(t,e){return t.url.includes(e)}function ke(t,e){var i;return(((i=t.dataElement)==null?void 0:i.domainNetworks)||[]).some(s=>s.subnetworkLayerId===e.layerId)}class Ht{getValidUtilityNetworkLayers(e,i){const s=[];return e==null||e.allLayers.forEach(r=>{r.type==="group"?s.push(...r.layers.filter(q).filter(a=>Te(a)&&i.isUtilityLayer(a)&&!ke(i,a)).filter(a=>ae(a,i.featureServiceUrl)).toArray()):r.type==="subtype-group"?s.push(...r.sublayers.filter(a=>ae(a,i.featureServiceUrl)).toArray()):q(r)&&Te(r)&&i.isUtilityLayer(r)&&!ke(i,r)&&ae(r,i.featureServiceUrl)&&s.push(r)}),s}}const Wt=()=>ee("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace"),Ut=()=>ee("esri/core/t9n/Units"),W=`utility-network-trace-flags-${Date.now()}`,U=`utility-network-trace-results-${Date.now()}`,j=`utility-network-trace-sketch-${Date.now()}`;function jt(t){return t instanceof Ce}function zt(t){return t.layer.type==="feature"||t.layer.type==="subtype-group"}function qt(t){return"layer"in t}function Se(t){return t.layerViews!==void 0}function Zt(t){return t.type==="graphics"}function Fe(t){return t.type==="feature"||t.type==="subtype-group"||t.type==="group"}async function Jt(t){var s;const e=new pt({url:t.networkSystemLayers.dirtyAreasLayerUrl});await e.load();const i=e.version;if(Number(i)<=11.1){const r=await ze(t.layerUrl),a=new _t({url:r});await a.load();const l=(s=a==null?void 0:a.user)==null?void 0:s.username;return!!l&&yt(a,l,"utilityNetwork")}return!0}let b=class extends ht.EventedAccessor{constructor(t){super(t),this._activeProgress=!1,this._clickHandler=null,this._flags=[],this._flagId=0,this._geometryHandler=null,this._highlightHandler=[],this._resultAreaHandler=null,this._sketchViewModel=null,this._traceTimeout=6e5,this._utilityHelper=new Ht,this._validUNLayers=[],this._watchHandler=null,this.traces=[],this.graphicHandler=null,this.defaultGraphicColor={color:[255,255,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#FFFF00"},this.enableResultArea=!1,this.flags=[],this.gdbVersion="sde.DEFAULT",this.messages=null,this.messagesUnits=null,this.defaultResultAreaProperties={type:"convexhull",distance:10,unit:"meters",areaUnit:"square-meters",color:{color:[255,165,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#ffa500"},show:!1},this.selectedTraces=[],this.selectOnComplete=!0,this.showGraphicsOnComplete=!0,this.showSelectionAttributes=!0,this.traceResults=[],this.utilityNetwork=null}initialize(){oe(Y.getLogger(this),"gdbVersion will be removed and the gdbVersion of the UtilityNetwork will be consumed directly.",{replacement:"UtilityNetwork.gdbVersion",version:"4.31"}),this._geometryHandler=new Pe,this.graphicHandler=new $t,this._resultAreaHandler=new Vt,(async()=>{const[t,e]=await Promise.all([Wt(),Ut()]);this.set({messages:t,messagesUnits:e})})()}destroy(){this.view=null}get resultAreaProperties(){return this.defaultResultAreaProperties}set resultAreaProperties(t){this._set("resultAreaProperties",{...this.defaultResultAreaProperties,...t}),this.graphicHandler.addCustomColor(this.resultAreaProperties.color),this.traceResults.forEach(e=>{var s;const i=(s=e.resultArea)==null?void 0:s.show;e.resultArea={...this.defaultResultAreaProperties,...t},this.removeResultAreaFromMap(e),this.enableResultArea&&this.createResultAreaGraphic(e).then(r=>{if(r){e.resultAreaGraphic=r;const a=(t==null?void 0:t.show)??i;e.resultArea&&(e.resultArea.show=a),a&&this.addResultAreaToMap(e,r)}})})}get state(){var t;return(t=this.view)!=null&&t.ready?"ready":"loading"}get view(){return this._get("view")}set view(t){t&&t.type!=="2d"&&Y.getLogger(this).error(new pe("view:invalid-view","SceneView is not supported",{view:t})),this._set("view",t),this.utilityNetwork&&this.reset(),this.utilityNetwork=null,this.loadUtilityNetwork().then(e=>{e&&this.selectTracesOnLoad()})}addFlagByHit(t,e){const i=!!this.view&&this.view.popupEnabled,s=r=>{var a;(a=this.view)!=null&&a.popup&&(this.view.popupEnabled=r)};return new Promise((r,a)=>{var l;i&&s(!1),(l=this._clickHandler)==null||l.remove(),this._clickHandler=this._sketchViewModel.on("create",n=>{if(n.state==="complete"){const c=this._getGraphicLayer(j);c&&n.graphic&&c.remove(n.graphic),this.queryFlagByHitTest(n,t,e).then(u=>{this.emit("add-flag-complete",{type:t,symbol:e}),r(u)}).catch(u=>{this.emit("add-flag-error",{type:t,symbol:e}),a(u)}).finally(()=>{var u;i&&s(!0),(u=this._clickHandler)==null||u.remove()})}}),this._sketchViewModel.create("point"),this.emit("add-flag",{type:t})})}addNonspatialTraceLocation(t,e){var l;const i=this._getDisplayField(t),s=(l=this.utilityNetwork)==null?void 0:l.getTerminalConfiguration(t),r={terminalId:null,isFilterBarrier:!1,allTerminals:s,selectedTerminals:[s?s.terminals[0].id||null:1],displayValue:i};t.attributes={...t.attributes,...r};const a=t.attributes.hasOwnProperty("GLOBALID")?t.attributes.GLOBALID:t.attributes.globalid;if(!this._flags.some(n=>n.globalId===a&&n.type===e)){const n=this._createFlagProperty(t,e,null);this._flags.push(n),this.emit("add-flag-complete",{type:e})}this.emit("add-flag",{type:e})}async addFlagsOnLoad(){return this._flags.length>0?[]:(await We(()=>this.view!=null&&!this.view.updating),(await Promise.all(this.flags.map(async t=>{if(!t.mapPoint)return null;const{type:e}=t,i=t.mapPoint.clone(),s=e==="barrier"?Le:Ge,r={graphic:this.graphicHandler.makeGraphic(i,s),state:"complete",tool:"point",toolEventInfo:null,type:"create"};try{return await this.queryFlagByHitTest(r,t.type,null),this.emit("add-flag-complete",{type:e}),null}catch{return this.emit("add-flag-error",{type:e}),e==="barrier"?"barrier":"starting-point"}}))).filter(t=>!t))}async addResultAreaToMap(t,e){var i,s;if(this.view){if(t.resultArea.show=!0,e)(i=this._resultAreaHandler)==null||i.addResultAreaToMap(e,this.view.map),this.emit("add-result-area",{graphic:e});else if(t.results){const r=await this.createResultAreaGraphic(t);r&&(t.resultAreaGraphic=r,(s=this._resultAreaHandler)==null||s.addResultAreaToMap(r,this.view.map),this.emit("add-result-area",{graphic:r}))}}}async addResultGraphicToView(t,e){var r;const{view:i}=this,{results:s}=t;if(i&&s&&this.utilityNetwork){for(const a in s.aggregatedGeometry)if("line,multipoint,polygon".includes(a)){const l=a,n=s.aggregatedGeometry[l];if(n!=null){n.spatialReference=this.utilityNetwork.spatialReference,t.graphicEnabled=!0;const c=await this._geometryHandler.projectGeometry(n,i.spatialReference),u={globalid:t.trace.globalId};if(c!==null){const p=this.graphicHandler.makeGraphic(c,e.color,u,i.spatialReference);(r=this._getGraphicLayer(U))==null||r.add(p)}}}}}addTerminal(t,e){const i=[...this._flags];i.forEach(s=>{var r,a;s.globalId===e.globalId&&((r=e.selectedTerminals)!=null&&r.includes(parseInt(t,10))||((a=s.selectedTerminals)==null||a.push(parseInt(t,10))))}),this._flags=i}async callTrace(){const t=this.traces.filter(e=>e.selected);return!!t.length&&(this.traceResults.length>0&&this.traceResults.forEach(e=>{this.removeResultGraphicFromView(e)}),this.traceResults=[],this.removeSelection(),await Promise.all(t.map(async(e,i)=>{var a,l,n;const s=e,r=new ft({gdbVersion:(a=this.utilityNetwork)==null?void 0:a.gdbVersion,moment:(l=this.utilityNetwork)==null?void 0:l.historicMoment,namedTraceConfigurationGlobalId:s.globalId,outSpatialReference:null,resultTypes:null,traceType:s.traceType,traceLocations:this._flags,traceConfiguration:null});await this.executeTrace(s,(n=this.utilityNetwork)==null?void 0:n.networkServiceUrl,r).then(c=>{if(c.hasOwnProperty("results")){const u={...c};if(u.results!==null){u.resultArea={...this.resultAreaProperties};const p=[...u.results.elements];u.results.elements.length=0;const y=new Map;for(const f of p)y.has(f.globalId)||(y.set(f.globalId,!0),u.results.elements.push(f));const _=[...this.traceResults];_.splice(i,0,u),this.traceResults=_,u.results!==null&&(this.selectOnComplete&&this.mergeSelection(!0,u.trace),this.showGraphicsOnComplete&&this.addResultGraphicToView(u,u.graphicColor),this.enableResultArea&&this.createResultAreaGraphic(u).then(f=>{var A;f&&(u.resultAreaGraphic=f,(A=u.resultArea)!=null&&A.show&&this.addResultAreaToMap(u,u.resultAreaGraphic))}))}else{const p=[...this.traceResults];p.splice(i,0,c),this.traceResults=p}this._activeProgress=!1}else{this._activeProgress=!1;const u=[...this.traceResults];u.splice(i,0,c),this.traceResults=u}}).catch(c=>{throw this._activeProgress=!1,c})})),!0)}changeResultAreaColor(t,e){var s;if(!t.resultArea)return;t.resultArea.color=e;const i=(s=this._resultAreaHandler)==null?void 0:s.changeResultAreaColor(t.trace.globalId,e,this.view.map);t.resultAreaGraphic&&(t.resultAreaGraphic.symbol=i)}changeResultGraphicColor(t,e){const i=[...this.traceResults];i.length>0&&i.forEach(s=>{s.trace.globalId===e.trace.globalId&&(s.graphicColor=t,s.graphicEnabled=!0)}),this.traceResults=i,this.removeResultGraphicFromView(e),this.addResultGraphicToView(e,t)}changeFlagSymbol(t,e){this._flags.length>0&&this._flags.forEach(i=>{i.type===t&&e&&i.mapGraphic&&(i.mapGraphic.symbol=e)})}checkCanTrace(){const t={status:!0,issues:[]};return this.traces.filter(i=>i.selected).length||(t.status=!1,t.issues.push("noTracesSelected")),this._flags.some(i=>i.type==="starting-point")||(t.status=!1,t.issues.push("noStartingPoints")),this._flags.filter(i=>i.allTerminals!==null).some(i=>!i.selectedTerminals.length)&&(t.status=!1,t.issues.push("noTerminalSelected")),t}checkSelectionExist(){return this._highlightHandler.some(t=>t)}clearResult(t){if(!this.view)return;let e=this.traceResults;if(e.length>0){const i=e.filter(s=>s.trace.globalId===t.globalId);i.length>0&&(this.removeResultGraphicFromView(i[0]),this.removeResultAreaFromMap(i[0])),e=e.filter(s=>s.trace.globalId!==t.globalId)}this.traceResults=e,e.length===0?(this.removeAllResultAreaGraphics(),this.removeSelection(),this.emit("clear-selection",{resultSet:[]})):this.mergeSelection(!1,t)}createResultAreaGeometries(t,e,i){var a,l,n,c,u,p,y,_,f,A,L,G,x,D;if(!this.view||!this.resultAreaProperties)return;let s;if(s=((a=this.resultAreaProperties)==null?void 0:a.type)==="convexhull"?e.length===1&&(me(e[0])||ut(e[0])&&e[0].points.length===1)?(n=this._resultAreaHandler)==null?void 0:n.createBuffer(e,i,(l=t.resultArea)==null?void 0:l.unit,!0):(p=this._resultAreaHandler)==null?void 0:p.createConvexHull(e,(c=t.resultArea)==null?void 0:c.distance,(u=t.resultArea)==null?void 0:u.unit):(_=this._resultAreaHandler)==null?void 0:_.createBuffer(e,i,(y=t.resultArea)==null?void 0:y.unit,!0),!s)return;if(Array.isArray(s)){for(const T of s){const B=this.getResultAreaAttributes(t,T),$=(L=this._resultAreaHandler)==null?void 0:L.createResultAreaGraphic(T,B,(f=t.resultArea)==null?void 0:f.areaUnit,this.messages,this.messagesUnits,(A=t.resultArea)==null?void 0:A.color);if($)return $}return}const r=this.getResultAreaAttributes(t,s);return(D=this._resultAreaHandler)==null?void 0:D.createResultAreaGraphic(s,r,(G=t.resultArea)==null?void 0:G.areaUnit,this.messages,this.messagesUnits,(x=t.resultArea)==null?void 0:x.color)}async createResultAreaGraphic(t){var e;if(t.results){const i=await this._createResultAreaInputGeometry(t.results);if(i.length>0){const s=Array(i.length).fill((e=t.resultArea)==null?void 0:e.distance),r=this.createResultAreaGeometries(t,i,s);return this.emit("create-result-area",{graphic:r}),r}}}executeTrace(t,e,i){const s=this._processFlags(i.traceLocations);return i.traceLocations=s,wt(e,i,{timeout:this._traceTimeout}).then(r=>({trace:t,results:r,selectionEnabled:!1,graphicEnabled:!1,graphicColor:this.defaultGraphicColor,status:"success",date:new Date})).catch(r=>({trace:t,results:null,selectionEnabled:!1,graphicEnabled:!1,graphicColor:this.defaultGraphicColor,status:r.message,date:new Date}))}async getNonspatialTraceLocationInitialFeature(){return new Promise((t,e)=>{var i;(i=this._clickHandler)==null||i.remove(),this._clickHandler=this._sketchViewModel.on("create",async s=>{var n,c,u;if(s.state!=="complete")return;const r=this._getGraphicLayer(j);r&&s.graphic&&r.remove(s.graphic);const a=(c=this.view)==null?void 0:c.toScreen((n=s.graphic)==null?void 0:n.geometry);if(!a)return;const l=await((u=this.view)==null?void 0:u.hitTest(a));if(l!=null&&l.results.length){const p=l.results.find(y=>{var _;return y.type==="graphic"&&((_=this.utilityNetwork)==null?void 0:_.isUtilityLayer(y.layer))});p?t(p):e(null)}}),this._sketchViewModel.create("point")})}getResultAreaAttributes(t,e){var l,n,c;const{messages:i}=this,s=[],r=[];this._flags.forEach(u=>{var y,_,f,A;const p=((y=u.displayValue)==null?void 0:y.field)+":"+((_=u.displayValue)==null?void 0:_.value)+";"+i.attributeStrings.globalid+":"+u.globalId+";"+i.attributeStrings.terminalid+":"+u.terminalId+";"+i.attributeStrings.x+":"+((f=u.mapPoint)==null?void 0:f.x)+";"+i.attributeStrings.y+":"+((A=u.mapPoint)==null?void 0:A.y);u.type==="starting-point"?s.push(p):r.push(p)});const a=this.utilityNetwork?this.utilityNetwork.gdbVersion:this.gdbVersion;return{traceId:t.trace.globalId,traceName:t.trace.title,traceDescription:t.trace.description??"",startingPoints:s.toString(),barriers:r.toString(),version:a??void 0,username:dt.credentials[0].userId,date:t.date,elementCount:(l=t.results)==null?void 0:l.elements.length,functionResult:JSON.stringify((n=t.results)==null?void 0:n.globalFunctionResults),areaStatistic:e?this._geometryHandler.calculateArea(e,(c=t.resultArea)==null?void 0:c.areaUnit):0}}getValidSources(){var i,s;let t=[];const e=((s=(i=this.utilityNetwork)==null?void 0:i.dataElement)==null?void 0:s.domainNetworks)??[];for(const r of e)t=t.concat(r.junctionSources),t=t.concat(r.edgeSources);return t}groupResultsByNetworkSource(t){return t.length===0?[]:this._groupBy(t,"networkSourceId")}async loadUtilityNetwork(){var s;const{view:t}=this;if(!t)return null;if(await t.when(),this.utilityNetwork){if(this.utilityNetwork.loaded||await this.utilityNetwork.load(),this.utilityNetwork instanceof gt){try{await t.map.loadAll()}finally{this._loadUNSupportItems()}return this.utilityNetwork}return null}const e=t.map,i=(s=e.utilityNetworks)==null?void 0:s.at(0);if(i){if(await i.load(),this.utilityNetwork=i,!await Jt(i))throw new pe("utility-network:no-user-type-extension","User type extension not found");try{await e.loadAll()}finally{this._loadUNSupportItems()}return i}return null}manageFilterBarrier(t,e){const i=[...this._flags];i.forEach(s=>{s.globalId===e.globalId&&e.type==="barrier"&&s.id===e.id&&(s.isFilterBarrier=t)}),this._flags=i}mergeSelection(t,e){let i=[];const s=[...this.traceResults],r=e.globalId;s.forEach(a=>{var l,n;r===a.trace.globalId&&(a.selectionEnabled=t),a.selectionEnabled&&((l=a.results)==null?void 0:l.elements)!==null&&(i=[...i,...((n=a.results)==null?void 0:n.elements)??[]])}),this.selectResults([...new Set(i)])}async queryFeaturesById(t){var l;const{view:e}=this;if(!e||!this.utilityNetwork)return null;const i=this.utilityNetwork.getObjectIdsFromElements(t),s={layerUrl:i[0].layerUrl,objectIds:i[0].objectIds,outFields:["*"]},r=((l=e.map)==null?void 0:l.allTables.toArray().filter(n=>{var c;return((c=n==null?void 0:n.parsedUrl)==null?void 0:c.path)===i[0].layerUrl}).filter(q))??[];this._getUniqueMapLayerViews(e).filter(({layer:n})=>{var c;return((c=n==null?void 0:n.parsedUrl)==null?void 0:c.path)===i[0].layerUrl}).forEach(({layer:n})=>{n.type!=="feature"&&n.type!=="subtype-group"||r.push(n)});const a=(await Promise.all(r.map(async n=>{const c={layers:new de([n]),layerInfos:[s],returnGeometry:!0,outSpatialReference:e.spatialReference},[u]=await mt(c);return u}))).filter(({featureSet:n})=>n.features.length>0);return a.length>0?a:null}queryFlagByHitTest(t,e,i){return this._lookupFlagByHit(t).then(s=>{const{view:r}=this;if(!r)return!1;if(s.length>0){const a=[...this._flags],l=i;return s.forEach(n=>{var p,y;const c=n.graphic,u=c.attributes.hasOwnProperty("GLOBALID")?c.attributes.GLOBALID:c.attributes.globalid;if(a.filter(_=>_.globalId===u).length<=0){const _=this.graphicHandler.getFlagGraphic(c.attributes.mapPoint,e,c,l);(p=this._getGraphicLayer(W))==null||p.add(_);const f=this._createFlagProperty(c,e,_);a.push(f)}else if(c.attributes.percentAlong!==null){const _=this.graphicHandler.getFlagGraphic(c.attributes.mapPoint,e,c,l);(y=this._getGraphicLayer(W))==null||y.add(_);const f=this._createFlagProperty(c,e,_);a.push(f)}}),this._flags=a,!0}return!1})}removeResultGraphicFromView(t){var r;const{view:e}=this;if(!e)return;const i=(r=this._getGraphicLayer(U))==null?void 0:r.graphics;t.graphicEnabled=!1;const s=i==null?void 0:i.filter(a=>a.attributes[a.attributes.hasOwnProperty("GLOBALID")?"GLOBALID":"globalid"]===t.trace.globalId);s==null||s.forEach(a=>{var l;(l=this._getGraphicLayer(U))==null||l.remove(a)})}removeFlag(t){const e=this._flags.filter(i=>{if(i.id!==t.id)return i});this._removeGraphic(t),this._flags=e}removeAllResultAreaGraphics(){var t;(t=this._resultAreaHandler)==null||t.removeAllResultAreaGraphics(this.view.map)}removeResultAreaFromMap(t){var e,i;if(t.resultArea){t.resultArea.show=!1;const s=(i=this._resultAreaHandler)==null?void 0:i.removeResultArea(t.trace.globalId,(e=this.view)==null?void 0:e.map);s&&this.emit("remove-result-area",{graphic:s})}}removeSelection(){this._highlightHandler.forEach(t=>{t&&t.remove()}),this._highlightHandler=[]}removeTerminal(t,e){const i=[...this._flags];i.forEach(s=>{var r,a;if(s.globalId===e.globalId&&((r=e.selectedTerminals)!=null&&r.includes(parseInt(t,10)))){const l=e.selectedTerminals.indexOf(parseInt(t,10));(a=s.selectedTerminals)==null||a.splice(l,1)}}),this._flags=i}removeFlagsOnLoadWatcher(){this._watchHandler&&this._watchHandler!==null&&this._watchHandler.remove()}removeClickHandler(){this._clickHandler&&(this._sketchViewModel.cancel(),this._clickHandler.remove())}reset(){var e,i,s;this._flags=[],this.traceResults=[];const t=[...this.traces];t.forEach(r=>{r.selected=!1}),this.traces=t,this.view&&((e=this._getGraphicLayer(j))==null||e.removeAll(),(i=this._getGraphicLayer(W))==null||i.removeAll(),(s=this._getGraphicLayer(U))==null||s.removeAll(),this.removeAllResultAreaGraphics(),this.removeSelection(),this.emit("clear-selection",{resultSet:[]}),this.emit("reset"))}selectFeaturesById(t){const{view:e}=this;if(!e||!this.utilityNetwork)return;const i=this.utilityNetwork.getObjectIdsFromElements(t);this._getUniqueMapLayerViews(e).forEach(s=>{var r,a;qt(s)&&((a=(r=s.layer)==null?void 0:r.parsedUrl)==null?void 0:a.path)===i[0].layerUrl&&zt(s)&&this._highlightHandler.push(s.highlight(i[0].objectIds))})}selectResults(t){if(t.length>0){this.removeSelection();const e=this.groupResultsByNetworkSource(t),i=[];for(const s in e)this.selectFeaturesById(e[s]),i.push(this.queryFeaturesById(e[s]));Promise.all(i).then(s=>{this.emit("select-features",{resultSet:s})})}else this.removeSelection(),this.emit("clear-selection",{resultSet:[]})}selectTraces(t,e){const i=[...this.traces];i.forEach(s=>{e===s.globalId&&(s.selected=t)}),this.traces=i}selectTracesOnLoad(){var t;(t=this.utilityNetwork)!=null&&t.hasOwnProperty("sharedNamedTraceConfigurations")&&(this.traces=[...this.utilityNetwork.sharedNamedTraceConfigurations],this.traces.forEach(e=>{e.selected=!1,this.selectedTraces.includes(e.globalId)&&(e.selected=!0)}))}zoomToAsset(t){var e;(e=this.view)==null||e.goTo(t).catch(i=>console.error(i))}async _createResultAreaInputGeometry(t){if(t.aggregatedGeometry!=null)return this._geometryHandler.mergeAggregatedToGeometries(t.aggregatedGeometry);const e=this.groupResultsByNetworkSource(t.elements),i=[];for(const s in e)i.push(this.queryFeaturesById(e[s]));try{const s=await Promise.all(i),r=[];for(const a of s)if(a)for(const l of a)for(const n of l.featureSet.features)n.geometry&&r.push(n.geometry);return r}catch{return[]}}_loadUNSupportItems(){var i;if(!this.utilityNetwork)return;const{map:t}=this.view,{messages:e}=this;this._populateOutfields(),this._createGraphicLayer(j),this._createGraphicLayer(W),this._createGraphicLayer(U),(i=this._resultAreaHandler)==null||i.createGraphicLayer(t,e==null?void 0:e.alertsStrings.genericResultHeader),this._validUNLayers=this._utilityHelper.getValidUtilityNetworkLayers(t,this.utilityNetwork),this._sketchViewModel=this.graphicHandler.initializeSketch(this.view,this._getGraphicLayer(j),this._validUNLayers)}_getUniqueMapLayerViews(t){const e=[],i=t.layerViews.filter(({layer:{type:r}})=>r==="feature"||r==="group"||r==="subtype-group").toArray(),s=r=>{for(const a of r.layerViews)Se(a)?s(a):e.push(a)};return i.forEach(r=>{switch(r.layer.type){case"group":Se(r)&&s(r);break;case"subtype-group":e.push(r);break;default:e.some(a=>a.layer.id===r.layer.id)||e.push(r)}}),e}_processFlags(t){const e=[];return t.forEach(i=>{if(i.selectedTerminals!==null&&i.selectedTerminals.length>0)i.selectedTerminals.forEach(s=>{const r=new te({globalId:i.globalId,percentAlong:i.percentAlong,terminalId:s,type:i.type,isFilterBarrier:i.isFilterBarrier});e.push(r)});else{const s=new te({globalId:i.globalId,percentAlong:i.percentAlong,type:i.type,isFilterBarrier:i.isFilterBarrier});e.push(s)}}),e}_getDisplayField(t){var e;return((e=t==null?void 0:t.layer)==null?void 0:e.type)==="subtype-sublayer"?this._getDisplayFieldBySublayer(t):this._getDisplayFieldByFeatureLayer(t)}_getDisplayFieldBySublayer(t){let e="",i="";const s=t.layer;e=this._checkParentForData(s,"displayField");for(const r in t.attributes){const a=r.toLowerCase();a===(e==null?void 0:e.toLowerCase())?(i=t.attributes[r],a==="assetgroup"||a==="assettype"?i=this._checkSubtype(s,s.subtypeCode):(i=this._checkDomain(s.fields,r,i),typeof i=="string"&&(i=this._defaultDisplayField(i,s)))):(i=this._checkDomain(s.fields,r,i),typeof i=="string"&&(i=this._defaultDisplayField(i,s)))}return{field:e,value:i.toString()}}_getDisplayFieldByFeatureLayer(t){var r,a;const e=t.layer;let i=e.displayField,s="";for(const l in t.attributes){const n=l.toLowerCase();if(n===(i==null?void 0:i.toLowerCase()))if(s=t.attributes[l],n==="assetgroup"||n==="assettype"){let c=t.attributes[e.typeIdField.toUpperCase()];c||(c=t.attributes[e.typeIdField.toLowerCase()]),i=e.typeIdField,s=this._checkSubtype(e,c),i===""&&(e.templates&&e.templates.length>0?(i=(r=e.templates[0])==null?void 0:r.name,s=(a=e.templates[0])==null?void 0:a.name):(i=e.displayField,s=t.attributes[l]))}else s=this._checkDomain(e.fields,l,s),typeof s=="string"&&(s=this._defaultDisplayField(s,e));else s=this._checkDomain(e.fields,l,s),typeof s=="string"&&(s=this._defaultDisplayField(s,e))}return{field:i,value:s?s.toString():""}}_checkSubtype(t,e){let i=e;if(t.type==="subtype-sublayer"){const s=this._checkParentForData(t,"subtypes");(s==null?void 0:s.length)>0&&s.forEach(r=>{r.code===e&&(i=r.name)})}else if(t.types!=null&&t.types.length>0){const s=t.types.filter(r=>r.id===e);s.length>0&&(i=s[0].name)}return i}_checkDomain(t,e,i){var a;let s=i;const r=t.filter(l=>l.name.toLowerCase()===e.toLowerCase());if(r.length>0&&jt(r[0].domain)&&((a=r[0].domain)!=null&&a.codedValues)){const l=r[0].domain.codedValues.filter(({code:n})=>n===i);l.length>0&&(s=l[0].name)}return s}_checkParentForData(t,e){var i;return((i=t.parent)==null?void 0:i[e])??null}_defaultDisplayField(t,e){var i;return t.trim()?t:e.templates&&((i=e.templates)==null?void 0:i.length)>0?e.templates[0].name:e.title}get _uniqueFlagId(){return this._flagId++}_groupBy(t,e){return t.reduce((i,s)=>((i[s[e]]=i[s[e]]||[]).push(s),i),{})}async _lookupFlagByHit(t){var s,r,a;const e=(s=t.graphic)==null?void 0:s.geometry,i=[];if(e&&me(e)&&this.view){const l=this.view.toScreen(e);if(l){const n=await this.view.hitTest(l,{include:this._validUNLayers});if(n!=null&&n.results.length){const c=n.results.find(u=>u.layer!==null);if((r=c.graphic)!=null&&r.geometry){if(c.graphic.geometry.type==="polyline"){const u={terminalId:null,isFilterBarrier:!1,allTerminals:null,selectedTerminals:null,percentAlong:this._geometryHandler.getPercentageAlong(c.graphic.geometry,(a=t.graphic)==null?void 0:a.geometry,c.graphic.geometry.spatialReference),displayValue:this._getDisplayField(c.graphic),mapPoint:c.mapPoint};c.graphic.attributes={...c.graphic.attributes,...u},i.push(c)}else if((c.graphic.geometry.type==="point"||c.graphic.geometry.type==="polygon")&&this.utilityNetwork){const u=this.utilityNetwork.getTerminalConfiguration(c.graphic),p=this._getDisplayField(c.graphic),y={terminalId:u?u.terminals[0].id||null:1,isFilterBarrier:!1,allTerminals:u??null,selectedTerminals:[u?u.terminals[0].id||null:1],percentAlong:null,displayValue:p,mapPoint:c.mapPoint};c.graphic.attributes={...c.graphic.attributes,...y},i.push(c)}}}}}return i}_createFlagProperty(t,e,i){const s=new te;s.terminalId=t.attributes.terminalId,s.isFilterBarrier=t.attributes.isFilterBarrier,s.percentAlong=t.attributes.percentAlong,s.globalId=t.attributes.globalid||t.attributes.GLOBALID,s.type=e;const r=s;return r.details=t,r.mapGraphic=i,r.id=this._uniqueFlagId,r.allTerminals=t.attributes.allTerminals,r.selectedTerminals=t.attributes.selectedTerminals,r.displayValue=t.attributes.displayValue,r.mapPoint=t.attributes.mapPoint,r}async _populateOutfields(){if(!this.view)return;const{map:t}=this.view,e=this.getValidSources(),i=s=>{s.type==="group"?s.layers.forEach(r=>{Fe(r)&&i(r)}):e.some(r=>r.layerId===s.layerId)&&s.fields.some(r=>r.name.toLowerCase()==="assetgroup")&&(s.outFields=["assetgroup","assettype","globalid","objectid"])};for(const s of t.layers)Fe(s)&&i(s)}_removeGraphic(t){var e;(e=this._getGraphicLayer(W))==null||e.remove(t.mapGraphic)}_createGraphicLayer(t){const{map:e}=this.view;if(!e.findLayerById(t)){const i=new Oe({id:t,internal:!0,listMode:"hide",title:t});vt(this.view,i)}}_getGraphicLayer(t){const{map:e}=this.view;if(e){const i=e.findLayerById(t);if(i&&Zt(i))return i}return null}};d([h()],b.prototype,"_activeProgress",void 0),d([h()],b.prototype,"_flags",void 0),d([h()],b.prototype,"traces",void 0),d([h()],b.prototype,"defaultGraphicColor",void 0),d([h()],b.prototype,"enableResultArea",void 0),d([h()],b.prototype,"flags",void 0),d([h()],b.prototype,"gdbVersion",void 0),d([h()],b.prototype,"messages",void 0),d([h()],b.prototype,"messagesUnits",void 0),d([h()],b.prototype,"resultAreaProperties",null),d([h()],b.prototype,"selectedTraces",void 0),d([h()],b.prototype,"selectOnComplete",void 0),d([h()],b.prototype,"showGraphicsOnComplete",void 0),d([h()],b.prototype,"showSelectionAttributes",void 0),d([h({readOnly:!0})],b.prototype,"state",null),d([h()],b.prototype,"traceResults",void 0),d([h()],b.prototype,"utilityNetwork",void 0),d([h({value:null})],b.prototype,"view",null),b=d([X("esri.widgets.UtilityNetworkTrace.UtilityNetworkTraceViewModel")],b);const xe=b,F="esri-utility-network-trace",v={base:F,addButtonContainer:`${F}__add-button-container`,blockContainer:`${F}__block-container`,blockContent:`${F}__block-content`,clearPrompt:`${F}__reset-prompt`,doublePaddingTop:`${F}__double-pad-top`,flow:`${F}__flow`,listContainer:`${F}__list-container`,noticeContainer:`${F}__notice-container`,numberInput:`${F}__number-input`,promptDivider:`${F}__divider`};function Kt(t){return{height:t+"px"}}function Yt(t){return{width:t+"px"}}function Qt(){return{width:"75%"}}function Xt(t){return{width:"100%",height:window.getComputedStyle(t).getPropertyValue("max-height")}}function Re(t){return{display:"flex",flexDirection:t}}function ei(t){return t instanceof Ce}const ti={noExtension:-2147208474};let g=class extends he{constructor(t,e){super(t,e),this._activeTab="input",this._activeTrace=null,this._activeSwatch="",this._addNonspatialObjectActive=!1,this._alertRemoveModal=!1,this._assetGroupHeader="",this._assetTypeHeader="",this._confirmReset=!1,this._errorMessage="",this._swatchNode=null,this._selectToolActive=!1,this._showFeatureInfoActive=!1,this._traceHeaderForFlow="",this._traceResultsFunctions=[],this._traceResultsAssetGroup=[],this._traceResultsAssetType=[],this._traceResultsIndividual=[],this._traceResultsState="result",this._warningNoFlag=!1,this._warningNoTraceSelected=!1,this._findNonspatialFeatureWidget=new Ae({mode:"add-nso"}),this._individualResultNode=null,this._loadUnError=!0,this._resultDisplayField="objectid",this._resultFeatureWidget=new Ae({mode:"show-feature-info"}),this._resultObjectIdField="objectid",this._resultSortField="objectid",this._resultSortOrder="desc",this._showResultOptions=!1,this._symbolStartFlag=null,this._symbolBarrier=null,this._traceLocationType="starting-point",this._updatingHandles=new je,this._warningNoBarrierAssetFound=!1,this._warningNoBarrierAssetNsoFound=!1,this._warningNoStartAssetFound=!1,this._warningNoStartAssetNsoFound=!1,this._warningNoTerminal=!1,this._wasPopupEnabled=!1,this._watchHandler=null,this.disabled=!0,this.inputSettings=[],this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this.viewModel=new xe,this._afterComponentCreate=this._afterComponentCreate.bind(this)}initialize(){this._wasPopupEnabled=!!this.view&&this.view.popupEnabled,this._findNonspatialFeatureWidget.view=this.view,this._resultFeatureWidget.view=this.view,this._utilityNetworkTraceInitialized(),this.addHandles([k(()=>{var t;return(t=this.viewModel)==null?void 0:t.resultAreaProperties},()=>this.scheduleRender()),k(()=>this._addNonspatialObjectActive,t=>{this._findNonspatialFeatureWidget.feature=null,t?this._changeCursor("crosshair"):this.view.popupEnabled=this._wasPopupEnabled}),k(()=>this._showFeatureInfoActive,t=>{t||(this._resultFeatureWidget.feature=null,this.view.popupEnabled=this._wasPopupEnabled)}),Z(()=>this._findNonspatialFeatureWidget,"add-nso-trace-location",({featureWidget:t})=>{this.viewModel.addNonspatialTraceLocation(t.graphic,this._traceLocationType),this._warningNoFlag=!1,this._addNonspatialObjectActive=!1}),Z(()=>this._findNonspatialFeatureWidget,"close-un-trace-feature-block",()=>{this._addNonspatialObjectActive=!1}),Z(()=>this._resultFeatureWidget,"close-un-trace-feature-block",()=>{this._showFeatureInfoActive=!1}),Z(()=>this._resultFeatureWidget,"close",()=>{this._resetResultFeatureWidget()})])}destroy(){var t,e;(t=this._findNonspatialFeatureWidget)==null||t.destroy(),(e=this._resultFeatureWidget)==null||e.destroy()}get defaultGraphicColor(){return this.viewModel.defaultGraphicColor}set defaultGraphicColor(t){this.viewModel.defaultGraphicColor=t}get enableResultArea(){return this.viewModel.enableResultArea}set enableResultArea(t){this.viewModel.enableResultArea=t}get flags(){return this.viewModel.flags}set flags(t){this.viewModel.flags=t}get gdbVersion(){return oe(Y.getLogger(this),"gdbVersion will be removed and the gdbVersion of the UtilityNetwork will be consumed directly.",{replacement:"UtilityNetwork.gdbVersion",version:"4.31"}),this.viewModel.gdbVersion}set gdbVersion(t){oe(Y.getLogger(this),"gdbVersion will be removed and the gdbVersion of the UtilityNetwork will be consumed directly.",{replacement:"UtilityNetwork.gdbVersion",version:"4.31"}),this.viewModel.gdbVersion=t}get icon(){return"utility-network-trace"}set icon(t){this._overrideIfSome("icon",t)}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get resultAreaProperties(){return this.viewModel.resultAreaProperties}set resultAreaProperties(t){this.viewModel.resultAreaProperties=t}get selectedTraces(){return this.viewModel.selectedTraces}set selectedTraces(t){this.viewModel.selectedTraces=t}get selectOnComplete(){return this.viewModel.selectOnComplete}set selectOnComplete(t){this.viewModel.selectOnComplete=t}get showGraphicsOnComplete(){return this.viewModel.showGraphicsOnComplete}set showGraphicsOnComplete(t){this.viewModel.showGraphicsOnComplete=t}get showSelectionAttributes(){return this.viewModel.showSelectionAttributes}set showSelectionAttributes(t){this.viewModel.showSelectionAttributes=t}get utilityNetwork(){return this.viewModel.utilityNetwork}set utilityNetwork(t){this.viewModel.utilityNetwork=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}async checkCanTrace(){this._confirmReset=!1,this._resetResultFeatureWidget();const t=this.viewModel.checkCanTrace();t.status?(this._warningNoFlag=!1,this._warningNoTraceSelected=!1,this._warningNoTerminal=!1,this._traceResultsState="result",this.switchTab("results"),this.viewModel._activeProgress=!0,this.viewModel.removeAllResultAreaGraphics(),await this.viewModel.callTrace(),this.viewModel._activeProgress=!1):t.issues.forEach(e=>{switch(e){case"noStartingPoints":this._warningNoFlag=!0;break;case"noTerminalSelected":this._warningNoTerminal=!0;break;default:this._warningNoTraceSelected=!0}})}confirmReset(){this._confirmReset=!0}render(){return this._mixCustomStrings(),this._overrideFlagSymbol(),o("div",{class:this.classes(v.base,P.widget,P.panel,{[P.widgetDisabled]:this.disabled})},this._renderUtilityNetworkTrace())}loadDependencies(){return ue({action:()=>m(()=>import("./index-DVEy4f7w.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]),import.meta.url),"action-group":()=>m(()=>import("./index-BSRDeu3E.js").then(t=>t.i),__vite__mapDeps([37,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,35,36]),import.meta.url),"action-pad":()=>m(()=>import("./index-DQOQ3530.js"),__vite__mapDeps([52,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,35,36,37,38]),import.meta.url),block:()=>m(()=>import("./index-ujykA9Eq.js"),__vite__mapDeps([42,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,40,21,20,18,17,16,43,27,28,22,34,23,29,44,0,19,24,45,46,47,48,26,30,31,32,33,35,36]),import.meta.url),"block-section":()=>m(()=>import("./index-BFYOU3WJ.js"),__vite__mapDeps([53,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,54,21,20,55,22,34,56,23,19,15]),import.meta.url),button:()=>m(()=>import("./index-BtF7Kdcs.js"),__vite__mapDeps([57,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,21,20,30,55,22,56,23,24]),import.meta.url),checkbox:()=>m(()=>import("./index-B7QXL93z.js"),__vite__mapDeps([58,2,3,4,5,6,7,8,9,10,11,12,13,21,20,17,14,55,22,34,56,23]),import.meta.url),"color-picker-swatch":()=>m(()=>import("./index-Cdn0mJBU.js").then(t=>t.i),__vite__mapDeps([59,2,3,4,5,6,7,8,9,10,11,12,13,19,20,60,61,17,14]),import.meta.url),combobox:()=>m(()=>import("./index-Bb6Bx1n-.js"),__vite__mapDeps([62,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,63,64,21,20,23,22,34,24,15,19,65,66,67,68,28,27,55,56,29,69,70]),import.meta.url),"combobox-item":()=>m(()=>import("./index-GVt5zfuo.js"),__vite__mapDeps([71,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,19,20,22,70,24,72]),import.meta.url),"dropdown-group":()=>m(()=>import("./index-BfAp5_ga.js"),__vite__mapDeps([47,2,3,4,5,6,7,8,9,10,11,12,13,18,46]),import.meta.url),"dropdown-item":()=>m(()=>import("./index-DIB7yhJF.js"),__vite__mapDeps([45,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,21,20,23,24,22,46]),import.meta.url),fab:()=>m(()=>import("./index-1VSl9HgO.js"),__vite__mapDeps([49,2,3,4,5,6,7,8,9,10,11,12,13,21,20,18,23,17,14]),import.meta.url),flow:()=>m(()=>import("./index-DrimfvRg.js"),__vite__mapDeps([73,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,57,21,20,30,55,22,56,23,24]),import.meta.url),"flow-item":()=>m(()=>import("./index-D1jScw4i.js"),__vite__mapDeps([39,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,35,36,40,41]),import.meta.url),icon:()=>m(()=>import("./index-73bQemcW.js").then(t=>t.i),__vite__mapDeps([16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18]),import.meta.url),"input-number":()=>m(()=>import("./index-BGRynF8w.js"),__vite__mapDeps([74,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,63,75,65,20,19,21,55,22,34,56,23,76,24,69,77,15]),import.meta.url),label:()=>m(()=>import("./index-D130RxMY.js"),__vite__mapDeps([78,2,3,4,5,6,7,8,9,10,11,12,13,56,17,14]),import.meta.url),list:()=>m(()=>import("./index-DbjTV4Hc.js"),__vite__mapDeps([79,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,40,21,20,18,17,19,16,63,75,80,65,30,55,22,34,56,23,76,24,69,77,67,68,28,81]),import.meta.url),"list-item":()=>m(()=>import("./index-d5Yy4krW.js"),__vite__mapDeps([82,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,43,21,20,27,28,22,34,23,29,44,1,15,0,19,24,45,46,47,48,81,83]),import.meta.url),loader:()=>m(()=>import("./index-CjrYEQXz.js"),__vite__mapDeps([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]),import.meta.url),notice:()=>m(()=>import("./index-nrWOrFCt.js"),__vite__mapDeps([50,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,21,20,23,51,29,24,15]),import.meta.url),option:()=>m(()=>import("./index-DxcTRSkS.js"),__vite__mapDeps([84,2,3,4,5,6,7,8,9,10,11,12,13,18]),import.meta.url),panel:()=>m(()=>import("./index-DSiQ4rVy.js").then(t=>t.i),__vite__mapDeps([41,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,26,27,28,29,30,31,32,33,34,35,36,40]),import.meta.url),popover:()=>m(()=>import("./index-DIp-v4qk.js").then(t=>t.i),__vite__mapDeps([26,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,27,28,29,30,31,32,33,34]),import.meta.url),scrim:()=>m(()=>import("./index-cLdK6V3t.js"),__vite__mapDeps([40,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,21,20,18,17]),import.meta.url),select:()=>m(()=>import("./index-CQ1gJMW-.js"),__vite__mapDeps([85,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,63,21,20,55,22,56,23,24,69]),import.meta.url),"split-button":()=>m(()=>import("./index-BIkUAggI.js"),__vite__mapDeps([86,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,57,21,20,30,55,22,56,23,24,43,27,28,34,29,44]),import.meta.url),tab:()=>m(()=>import("./index-LmcDAlT8.js"),__vite__mapDeps([87,2,3,4,5,6,7,8,9,10,11,12,13,17,14]),import.meta.url),"tab-nav":()=>m(()=>import("./index-BeVvv8sv.js"),__vite__mapDeps([88,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,57,21,20,30,55,22,56,23,24,19,66]),import.meta.url),"tab-title":()=>m(()=>import("./index-DWkZ-WI6.js"),__vite__mapDeps([89,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,19,20,21,22,24,15]),import.meta.url),tabs:()=>m(()=>import("./index-B7BDzDjX.js"),__vite__mapDeps([90,2,3,4,5,6,7,8,9,10,11,12,13,21,20,17,14]),import.meta.url)})}switchTab(t){this._activeTab=t}switchToFromAssetGroup(t,e,i){this._traceHeaderForFlow=e,this._traceResultsAssetGroup=t,this._traceResultsState=i}switchToFromAssetType(t,e,i){this._assetGroupHeader=e,this._traceResultsAssetType=t,this._traceResultsState=i}switchToFromFunctions(t,e){this._traceResultsFunctions=t,this._traceResultsState=e}switchToFromIndividualRecords(t,e,i){this._assetTypeHeader=e,this._traceResultsIndividual=t,this._traceResultsState=i}_renderAddNonspatialLocationBlock(){const{messages:t}=this;return o("calcite-block",{key:`${this.id}__add-spatial-location-block`,label:t.inputsStrings.addNonspatialOption,open:!0},this._findNonspatialFeatureWidget.render())}_renderAddSpatialLocationBlock(){const{messages:t,messagesCommon:e}=this;return o("calcite-block",{class:v.blockContent,heading:this._traceLocationType==="starting-point"?t.inputsStrings.headerStartingPoint:t.inputsStrings.headerBarrier,key:`${this.id}__add-nonspatial-location-block`,label:this._traceLocationType==="starting-point"?t.inputsStrings.headerStartingPoint:t.inputsStrings.headerBarrier,open:!0},o("calcite-action",{icon:"x",onclick:()=>{var i;this.viewModel.removeClickHandler(),(i=this.view)!=null&&i.popup&&(this.view.popupEnabled=this._wasPopupEnabled),this._changeCursor("default"),this._selectToolActive=!1},slot:"control",text:e.close}),o("calcite-notice",{icon:this._traceLocationType==="starting-point"?"pin-plus":"x-circle-f",kind:"info",open:!0},o("div",{slot:"message"},t.inputsStrings.addPointHint)))}_renderClearTraceResultsBlock(){const{messages:t,messagesCommon:e}=this;return o("calcite-scrim",{key:"prompt"},o("div",{class:v.clearPrompt},o("h3",{slot:"header"},t.resultsStrings.startOverButton),o("div",{slot:"content"},t.resultsStrings.startOverValidation),o("div",{class:v.promptDivider}),o("div",{styles:Re("row")},o("calcite-button",{appearance:"outline",onclick:()=>{this._confirmReset=!1},slot:"secondary",width:"full"},e.cancel),o("calcite-button",{onclick:()=>{this._confirmReset=!1,this.viewModel.reset(),this.switchTab("input")},slot:"primary",width:"full"},e.form.ok))))}_renderExecutingTraceBlock(){const{messages:t}=this;return o("calcite-loader",{label:t.alertsStrings.traceExecuting,text:t.alertsStrings.traceExecuting,type:"indeterminate"})}_renderInputBlock(){const{messages:t}=this;return o("calcite-block",{class:v.blockContainer,key:`${this.id}__inputs-block`,label:t.inputsStrings.headerTabInputs,open:!0},o("calcite-flow",{class:v.flow},o("calcite-flow-item",{key:`${this.id}__inputs-flow-item`,selected:!this._selectToolActive&&!this._addNonspatialObjectActive},this._warningNoFlag?this._renderWarningMessage("flag",!0):null,this._warningNoTerminal?this._renderWarningMessage("noTerminal",!0):null,this._warningNoTraceSelected?this._renderWarningMessage("trace",!0):null,this._renderTraceSelectorContainer(),this._renderStartFlagsContainer(),this._renderBarriersFlagsContainer(),this._warningNoFlag&&this._warningNoTraceSelected?o("div",{styles:Kt(10)}):null,o("calcite-fab",{appearance:"solid",icon:"utility-network-trace",kind:"brand",onclick:()=>{this.checkCanTrace()},slot:"fab",text:t.tracingStrings.runTrace,textEnabled:!0,title:t.tracingStrings.runTrace,type:"button"}))))}_renderInputsTab(){const{messagesCommon:t}=this;let e="input";return this._selectToolActive&&!this._addNonspatialObjectActive&&(e="add-spatial-location"),!this._selectToolActive&&this._addNonspatialObjectActive&&(e="add-nso-location"),this.disabled&&(e="loading"),o("calcite-tab",{key:`${this.id}__inputs-tab-item`,selected:this._activeTab==="input"},e==="loading"?o("calcite-loader",{label:t.loading,type:"indeterminate"}):null,e==="input"?this._renderInputBlock():null,e==="add-spatial-location"?this._renderAddSpatialLocationBlock():null,e==="add-nso-location"?this._renderAddNonspatialLocationBlock():null)}_renderBarriersFlagsContainer(){const{messages:t}=this,e=[];let i=[];i=this.viewModel._flags.filter(r=>r.type==="barrier"),i.forEach(r=>{r.displayValue&&e.push(this._renderFlagRow(r,"barrier"))});let s=null;return this._symbolBarrier&&(s=this._getSymbolIcon(this._symbolBarrier)),o("calcite-block",{class:v.blockContent,collapsible:!0,heading:t.inputsStrings.headerBarrier+" ("+i.length+")",open:!0,overlayPositioning:"fixed"},o("div",{slot:"icon"},s||o("calcite-icon",{icon:"x-circle-f",scale:"s"})),o("div",null,t.inputsStrings.barrierPointHint),o("div",{class:v.listContainer},e),this._warningNoBarrierAssetFound?this._renderWarningMessage("noBarrierAsset",!0):null,this._warningNoBarrierAssetNsoFound?this._renderWarningMessage("noBarrierAssetNso",!0):null,o("div",{class:v.addButtonContainer},o("calcite-split-button",{appearance:"outline-fill",primaryIconStart:"select",primaryText:t.inputsStrings.addPointOption,onCalciteSplitButtonPrimaryClick:()=>{this._setupAddTraceLocation("barrier")}},o("calcite-dropdown-group",{selectionMode:"none"},o("calcite-dropdown-item",{onCalciteDropdownItemSelect:()=>{this._setupAddNonspatialObject("barrier")}},t.inputsStrings.addNonspatialOption)))))}_renderFlagRow(t,e){var l;const{messages:i,messagesCommon:s}=this,r=[];let a=!1;return t.allTerminals!=null&&t.allTerminals.terminals.length>0&&(a=!0,t.allTerminals.terminals.forEach(n=>{var u;let c=!1;(u=t==null?void 0:t.selectedTerminals)!=null&&u.includes(n.id)&&(c=!0),r.push(o("calcite-combobox-item",{key:n.name,selected:c,textLabel:n.name,value:n.id}))})),o("calcite-block",{collapsible:t.allTerminals!==null||t.type==="barrier",heading:((l=t.displayValue)==null?void 0:l.value)??"",key:"pop"+t.globalId+t.type+t.id+e,overlayPositioning:"fixed"},o("calcite-action",{icon:"trash",label:s.remove,onclick:()=>{this.viewModel.removeFlag(t)},scale:"s",slot:"header-menu-actions",text:s.remove,textEnabled:!0}),t.mapGraphic&&t.mapPoint?o("calcite-action",{icon:"zoom-to-object",label:i.globalStrings.zoomToFeature,onclick:()=>{this.viewModel.zoomToAsset(t.details.geometry)},scale:"s",slot:"header-menu-actions",text:i.globalStrings.zoomToFeature,textEnabled:!0}):null,t.type==="barrier"?o("calcite-label",{layout:"inline",scale:"s"},o("calcite-checkbox",{checked:t.isFilterBarrier,onclick:()=>{this.viewModel.manageFilterBarrier(!t.isFilterBarrier,t)},scale:"s"}),i.inputsStrings.barrierFilter):null,a?o("calcite-combobox",{label:i.globalStrings.selectTerminalPlaceholder,maxItems:0,overlayPositioning:"fixed",placeholder:i.globalStrings.selectTerminalPlaceholder,scale:"s",selectionMode:"multiple",onCalciteComboboxChange:n=>{n.currentTarget.selectedItems.length>0?(t.selectedTerminals=[],n.currentTarget.selectedItems.forEach(c=>{this.viewModel.addTerminal(c.value,t)})):t.selectedTerminals=[]},onCalciteComboboxChipClose:n=>{n.preventDefault(),this.viewModel.removeTerminal(n.currentTarget.value,t)}},r):null)}_renderHighlightColorPicker(t,e,i){const{messages:s}=this,{graphicHandler:r}=this.viewModel,a=[],l=new RegExp(`^${t.hex}$`,"i"),n=r.highlightColor.length>ne.length?5:4;for(const c of r.highlightColor)a.push(o("calcite-action",{active:l.test(c.hex),key:c.hex,label:s.resultsStrings.graphicColor,onclick:()=>{i==="aggregate"?this.viewModel.changeResultGraphicColor(c,e):this.viewModel.changeResultAreaColor(e,c)},scale:"s",text:s.resultsStrings.graphicColor},o("calcite-color-picker-swatch",{active:l.test(c.hex),color:c.hex,scale:"s"})));return o("calcite-action-pad",{expandDisabled:!0,layout:"grid",position:"start"},o("calcite-action-group",{columns:n},a))}_renderRemoveTraceContainer(t){const{messages:e}=this;return o("calcite-action",{icon:"trash",label:e.globalStrings.clearResults,onclick:()=>{this._alertRemoveModal=!0,this._activeTrace=t.trace},scale:"s",slot:"header-menu-actions",text:e.globalStrings.clearResults,textEnabled:!0})}_renderResultsTab(){let t="results";return this._showFeatureInfoActive&&(t="show-feature-info"),this.viewModel._activeProgress&&(t="executing"),this._confirmReset&&(t="clear-trace-results"),o("calcite-tab",{key:`${this.id}__results-tab-item`},t==="executing"?this._renderExecutingTraceBlock():null,t==="results"?this.viewModel.traceResults.length?this._renderResultsPanel():this._renderWarningMessage("noTraceExecuted",!1):null,t==="show-feature-info"?this._renderShowFeatureInfoBlock():null,t==="clear-trace-results"?this._renderClearTraceResultsBlock():null)}_renderResultsPanel(){const{messages:t}=this;return o("calcite-block",{class:v.blockContainer,key:`${this.id}__results-block`,label:t.resultsStrings.headerTabResults,open:!0},o("calcite-flow",{class:v.flow},this._renderTraceResults(),this._renderTraceResultFunctions(),this._renderTraceResultByAssetGroup(),this._renderTraceResultByAssetType(),this._renderTraceResultIndividual()))}_renderResultRowFunctions(t){return o("calcite-block",{collapsible:!1,heading:t.networkAttributeName+" "+t.functionType+" = "+t.result,overlayPositioning:"fixed"})}_renderResultRowAssetGroup(t){const e=this._getAssetGroupName(t[0]);return o("calcite-list-item",{key:`${e}-${t.assetGroupCode}`,label:e+" ("+t.length+")",onCalciteListItemSelect:()=>{this.switchToFromAssetType(this._groupResultsByAssetType(t),e+" ("+t.length+")","assetType")}},o("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderResultRowAssetType(t){const e=this._getAssetTypeName(t[0]);return o("calcite-list-item",{key:`${e}-${t.assetTypeCode}`,label:e+" ("+t.length+")",onCalciteListItemSelect:()=>{this._updatingHandles.addPromise(this.viewModel.queryFeaturesById(t).then(i=>{if(i!=null&&i.length){this._resultObjectIdField=i[0].layer.objectIdField,this._resultDisplayField==="objectid"&&(this._resultDisplayField=i[0].layer.objectIdField),this._resultSortField==="objectid"&&(this._resultSortField=i[0].layer.objectIdField);const s=this._appendAttributes(t,i,"objectId");this.switchToFromIndividualRecords(s,e+" ("+t.length+")","records")}else this.switchToFromIndividualRecords(t,e+" ("+t.length+")","records")}))}},o("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderResultRowIndividual(t){var r,a;const{messages:e}=this;let i,s=null;if(s=(r=t==null?void 0:t.details)==null?void 0:r.fields.find(({name:l})=>l===this._resultDisplayField),(s==null?void 0:s.type)==="date")i=new Date(t.details.attributes[this._resultDisplayField]).toDateString();else if(this._resultDisplayField.toLowerCase()==="assetgroup")i=this._getAssetGroupName(t);else if(this._resultDisplayField.toLowerCase()==="assettype")i=this._getAssetTypeName(t);else if(s!=null&&s.domain&&ei(s.domain)){const l=s.domain.codedValues.find(({code:n})=>n===t.details.attributes[this._resultDisplayField]);i=l==null?void 0:l.name}else i=((a=t.details)==null?void 0:a.attributes[this._resultDisplayField])??t.objectId;return i&&i!==""&&i!==null?typeof i=="string"&&(i.trim()||(i=e.resultsStrings.noValue)):i=e.resultsStrings.noValue,o("calcite-list-item",{key:t.details.uid,label:i,onCalciteListItemSelect:async()=>{var n,c;this._disablePopup(),this._showFeatureInfoActive=!0;const l=qe((n=t.details)==null?void 0:n.layer)?(c=t.details)==null?void 0:c.layer:null;if(l){const u=Object.keys(t.details.attributes).find(A=>A.toLowerCase()===l.subtypeField.toLowerCase())??"assetgroup",p=l.sublayers.find(A=>A.subtypeCode===t.details.attributes[u]),y=Object.keys(t.details.attributes).find(A=>A.toLowerCase()===l.objectIdField.toLowerCase())??"objectid",_=new Ze;_.outFields=["*"],_.returnGeometry=!0,_.where=y+" = "+t.details.attributes[y];const f=await(p==null?void 0:p.queryFeatures(_));f&&this._resultFeatureWidget.open(f.features[0])}else this._resultFeatureWidget.open(t.details)}},o("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderShowFeatureInfoBlock(){const{messages:t}=this;return o("calcite-block",{class:v.blockContainer,key:`${this.id}__show-feature-info-block`,label:t.resultsStrings.headerFeatureInfo,open:!0},this._resultFeatureWidget.render())}_renderStartFlagsContainer(){const{messages:t}=this,e=[];let i=[];i=this.viewModel._flags.filter(r=>r.type==="starting-point"),i.forEach(r=>{r.displayValue&&e.push(this._renderFlagRow(r,"start"))});let s=null;return this._symbolStartFlag&&(s=this._getSymbolIcon(this._symbolStartFlag)),o("calcite-block",{class:v.blockContent,collapsible:!0,heading:t.inputsStrings.headerStartingPoint+" ("+i.length+")",open:!0,overlayPositioning:"fixed"},o("div",{slot:"icon"},s||o("calcite-icon",{icon:"pin",scale:"s"})),o("div",null,t.inputsStrings.startingPointHint),o("div",{class:v.listContainer},e),this._warningNoStartAssetFound?this._renderWarningMessage("noStartAsset",!0):null,this._warningNoStartAssetNsoFound?this._renderWarningMessage("noStartAssetNso",!0):null,o("div",{class:v.addButtonContainer},o("calcite-split-button",{appearance:"outline-fill",primaryIconStart:"select",primaryText:t.inputsStrings.addPointOption,onCalciteSplitButtonPrimaryClick:()=>{this._setupAddTraceLocation("starting-point")}},o("calcite-dropdown-group",{selectionMode:"none"},o("calcite-dropdown-item",{onCalciteDropdownItemSelect:()=>{this._setupAddNonspatialObject("starting-point")}},t.inputsStrings.addNonspatialOption)))))}_renderStartOverContainer(){const{messages:t}=this;return o("calcite-fab",{appearance:"solid",icon:"trash",kind:"brand",onclick:()=>{this.confirmReset()},slot:"fab",text:t.resultsStrings.startOverButton,textEnabled:!0,title:t.resultsStrings.startOverButton,type:"button"})}_renderTraceResultByAssetGroup(){const t=this._traceResultsAssetGroup,e=[];for(const i in t){const s=t[i];for(const r in s)e.push(this._renderResultRowAssetGroup(s[r]))}return o("calcite-flow-item",{heading:this._traceHeaderForFlow,key:"assetGroupResultMultiple",selected:this._traceResultsState==="assetGroup",onCalciteFlowItemBack:()=>{this.switchToFromAssetGroup([],"","result")}},o("calcite-list",{label:""},e),this._renderStartOverContainer())}_renderTraceResultByAssetType(){const t=this._traceResultsAssetType,e=[];for(const i in t)t[i].length>0&&e.push(this._renderResultRowAssetType(t[i]));return o("calcite-flow-item",{heading:this._assetGroupHeader,key:"assetTypeResult",loading:this._updatingHandles.updating,selected:this._traceResultsState==="assetType",onCalciteFlowItemBack:()=>{this.switchToFromAssetType([],"","assetGroup")}},o("calcite-list",{label:"",selectionMode:"none"},e),this._renderStartOverContainer())}_renderTraceResultFunctions(){if(this._traceResultsState!=="functions")return null;const{messages:t}=this,e=this._traceResultsFunctions,i=[];return e.forEach(s=>{i.push(this._renderResultRowFunctions(s))}),o("calcite-flow-item",{heading:t.resultsStrings.functionHeader,key:"functionResultMultiple",selected:this._traceResultsState==="functions",onCalciteFlowItemBack:()=>{this.switchToFromFunctions([],"result")}},i,this._renderStartOverContainer())}_renderTraceResultIndividual(){var s;const{messages:t}=this,e=this._traceResultsIndividual;e.sort(this._compare(this._resultSortField,this._resultSortOrder));const i=[];return e.length>0&&((((s=e[0].details)==null?void 0:s.fields.some(({name:r})=>r.toLowerCase()===this._resultDisplayField.toLocaleLowerCase()))??!1)||(this._resultDisplayField=this._resultObjectIdField,this._resultSortField=this._resultObjectIdField),e.forEach(r=>{r!=null&&r.details&&i.push(this._renderResultRowIndividual(r))}),i.length===0&&i.push(o("calcite-list-item",{label:t.resultsStrings.noFeaturesInMap}))),o("calcite-flow-item",{heading:this._assetTypeHeader,key:"individualResult",selected:this._traceResultsState==="records",onCalciteFlowItemBack:()=>{this._showResultOptions=!1,this.switchToFromIndividualRecords([],"","assetType")}},o("calcite-action",{afterCreate:Ke,bind:this,"data-node-ref":"_individualResultNode",icon:"gear",id:"field_options"+this.id,label:t.resultsStrings.displayAttribute,onclick:()=>{this._showResultOptions=!0},slot:"header-actions-end",text:t.resultsStrings.displayAttribute}),this._renderTraceResultIndividualPopover(),o("calcite-list",{label:"",selectionMode:"none"},i),this._renderStartOverContainer())}_renderTraceResultIndividualPopover(){const{messages:t}=this,e=this._traceResultsIndividual,i=[],s=[];return e.length>0&&(e[0].details?e[0].details.fields.forEach(({name:r,alias:a})=>{i.push(o("calcite-option",{key:`display-${r}`,label:a??r,selected:r===this._resultDisplayField,value:r})),s.push(o("calcite-option",{key:`sort-${r}`,label:a??r,selected:r===this._resultSortField,value:r}))}):(i.push(o("calcite-option",{key:`display-${this._resultDisplayField}`,label:this._resultDisplayField,value:this._resultDisplayField})),s.push(o("calcite-option",{key:`sort-${this._resultDisplayField}`,label:this._resultDisplayField,value:this._resultDisplayField})))),o("calcite-popover",{autoClose:!0,label:t.resultsStrings.displayAttribute,offsetDistance:0,offsetSkidding:0,open:this._showResultOptions,overlayPositioning:"fixed",placement:"left-start",referenceElement:this._individualResultNode,styles:this.domNode!==null?Yt(.75*this.domNode.clientWidth):Qt()},o("calcite-block",{label:t.resultsStrings.displayAttribute,open:!0,overlayPositioning:"fixed"},o("calcite-label",{scale:"s"},t.resultsStrings.displayAttribute,o("calcite-select",{label:t.resultsStrings.displayAttribute,scale:"s",onCalciteSelectChange:r=>{const a=r.currentTarget;this._resultDisplayField=a.selectedOption.value,this._showResultOptions=!1}},i)),o("calcite-label",{scale:"s"},t.resultsStrings.sortBy,o("calcite-select",{label:t.resultsStrings.sortBy,scale:"s",onCalciteSelectChange:r=>{const a=r.currentTarget;this._resultSortField=a.selectedOption.value,e.sort(this._compare(this._resultSortField,this._resultSortOrder)),this._traceResultsIndividual=e,this._showResultOptions=!1}},s))))}_renderTraceResults(){const{messages:t,messagesCommon:e}=this,{selectFeatures:i}=t.resultsStrings,s=this.viewModel.traceResults,r=[];return s.forEach((a,l)=>{var f,A,L,G,x,D;let n=[],c=[],u=!1,p=!1,y=!1,_="";a.results!==null&&a.results.hasOwnProperty("elements")?(a.results.aggregatedGeometry!==null&&(p=!0),a.results.globalFunctionResults!==null&&a.results.globalFunctionResults.length>0&&(c=a.results.globalFunctionResults,c.length>0&&(y=!0)),a.results.elements&&a.results.elements.length>0&&(n=a.results.elements,n.length>0&&(u=!0)),(p||u)&&(_=(A=this.messagesUnits.units[(f=a.resultArea)==null?void 0:f.unit])==null?void 0:A.abbr),r.push(o("calcite-block",{class:v.blockContent,collapsible:!0,description:a.trace.description??"",heading:a.trace.title,key:`${a.trace.title}${l}`,open:!0,overlayPositioning:"fixed"},this._renderRemoveTraceContainer(a),o("calcite-list",{label:""},y?o("calcite-list-item",{label:t.resultsStrings.functionHeader+" ("+c.length+")",onCalciteListItemSelect:()=>{this.switchToFromFunctions(c,"functions")}},o("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"})):null,u&&this.viewModel.showSelectionAttributes?o("calcite-list-item",{key:this.id,label:t.resultsStrings.viewFeatures+" ("+n.length+")",onCalciteListItemSelect:()=>{this.switchToFromAssetGroup(this._groupResultsByAssetGroup(a),a.trace.title+" ("+n.length+")","assetGroup")}},o("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"})):this.viewModel.showSelectionAttributes?o("calcite-label",{layout:"inline",scale:"s"},t.resultsStrings.noSelectionResults):null),u?o("div",{class:v.doublePaddingTop},o("calcite-label",{layout:"inline",onclick:T=>{T.preventDefault(),T.stopPropagation(),this.viewModel.mergeSelection(!a.selectionEnabled,a.trace)},scale:"s"},o("calcite-checkbox",{checked:a.selectionEnabled,onclick:T=>{T.preventDefault(),T.stopPropagation(),this.viewModel.mergeSelection(!a.selectionEnabled,a.trace)}}),this.viewModel.showSelectionAttributes?i:`${i} (${n.length})`)):null,p?o("calcite-block-section",{key:`aggregate-${a.trace.title}-${l}`,open:a.graphicEnabled,text:t.resultsStrings.highlightTrace,toggleDisplay:"switch",onCalciteBlockSectionToggle:T=>{T.currentTarget.open?this.viewModel.changeResultGraphicColor(a.graphicColor,a):this.viewModel.removeResultGraphicFromView(a)}},o("calcite-list",{label:t.resultsStrings.graphicColor,selectionMode:"none"},o("calcite-list-item",{label:t.resultsStrings.graphicColor,onclick:T=>{this._swatchNode=T.currentTarget,this._activeSwatch="aggGeom_"+l}},o("calcite-color-picker-swatch",{color:a.graphicColor.hex,scale:"s",slot:"actions-end"})))):null,this.enableResultArea&&(p||u)?o("calcite-block-section",{key:`area-${a.trace.title}-${l}`,open:(L=a.resultArea)==null?void 0:L.show,text:t.resultsStrings.resultAreaHeader,toggleDisplay:"switch",onCalciteBlockSectionToggle:T=>{T.currentTarget.open?a.resultAreaGraphic?this.viewModel.addResultAreaToMap(a,a.resultAreaGraphic):this.viewModel.addResultAreaToMap(a):this.viewModel.removeResultAreaFromMap(a)}},o("calcite-list",{label:"",selectionMode:"none"},o("calcite-list-item",{label:t.resultsStrings.graphicColor,onclick:T=>{const B=T.currentTarget;this._swatchNode=B,this._activeSwatch="resultArea_"+l}},o("calcite-color-picker-swatch",{color:(G=a.resultArea)==null?void 0:G.color.hex,scale:"s",slot:"actions-end"}))),o("calcite-list",{label:"",selectionMode:"none"},o("calcite-list-item",{label:t.resultsStrings.resultAreaBuffer},o("calcite-input-number",{afterCreate:this._afterComponentCreate,class:v.numberInput,max:999999,min:0,scale:"s",slot:"actions-end",suffixText:_,value:(x=a.resultArea)==null?void 0:x.distance.toString(),onCalciteInputNumberChange:T=>{var $;if(!(($=this.view)!=null&&$.popup))return;this.view.popup.visible&&this.view.closePopup();const B=T.currentTarget;a.resultArea.distance>=0?(a.resultArea.distance=parseInt(B.value,10),this.viewModel.removeResultAreaFromMap(a),this.viewModel.addResultAreaToMap(a)):(a.resultArea.distance=0,this.viewModel.removeResultAreaFromMap(a),this.viewModel.addResultAreaToMap(a))}})))):null,o("calcite-popover",{autoClose:!0,closable:!0,label:t.resultsStrings.graphicColor,offsetDistance:0,offsetSkidding:0,open:this._activeSwatch==="aggGeom_"+l||this._activeSwatch==="resultArea_"+l,overlayPositioning:"fixed",placement:"auto-start",referenceElement:this._swatchNode,scale:"s",onCalcitePopoverClose:()=>{this._swatchNode=null,this._activeSwatch=null}},this._renderHighlightColorPicker(this._activeSwatch==="resultArea_"+l?(D=a.resultArea)==null?void 0:D.color:a.graphicColor,a,this._activeSwatch==="resultArea_"+l?"resultArea":"aggregate"))))):r.push(o("calcite-block",{collapsible:!1,heading:a.trace.title,key:"error-"+l,open:!0,overlayPositioning:"fixed"},this._renderRemoveTraceContainer(a),this._renderWarningMessage("noController",!1,a.status)))}),o("calcite-flow-item",{key:"traceResults",selected:this._traceResultsState==="result"},r,this._renderStartOverContainer(),this._alertRemoveModal?o("calcite-scrim",{key:"prompt"},o("div",{class:v.clearPrompt},o("h3",{slot:"header"},t.globalStrings.clearResults),o("div",{slot:"content"},t.alertsStrings.clearResultsAlert),o("div",{class:v.promptDivider}),o("div",{styles:Re("row")},o("calcite-button",{appearance:"outline",onclick:()=>{this._alertRemoveModal=!1},slot:"secondary",width:"full"},e.cancel),o("calcite-button",{onclick:()=>{this._activeTrace&&this.viewModel.clearResult(this._activeTrace),this._alertRemoveModal=!1,this.viewModel.traceResults.length===0?this.switchTab("input"):(this._activeTrace=this.viewModel.traceResults[0].trace,this._traceResultsState="result")},slot:"primary",width:"full"},e.form.ok)))):null)}_renderTraceSelectorContainer(){const{messages:t}=this,e=this.viewModel.traces.map(r=>this._renderComboboxItem({value:r.globalId,text:r.title,selected:r.selected??!1})),i=this.viewModel.traces.filter(r=>r.selected),s=t.tracingStrings.traceOperation+` (${i.length})`;return o("calcite-block",{class:v.blockContent,collapsible:!0,heading:s,open:!0,overlayPositioning:"fixed"},o("calcite-icon",{icon:"utility-network-trace",scale:"s",slot:"icon"}),o("calcite-combobox",{label:t.inputsStrings.selectTraces,maxItems:0,overlayPositioning:"fixed",placeholder:t.inputsStrings.selectTraces,scale:"s",selectionMode:"multiple",onCalciteComboboxChange:r=>{this.viewModel.traces.forEach(a=>{a.selected=r.currentTarget.selectedItems.some(l=>l.value===a.globalId)}),r.currentTarget.selectedItems.length&&(this._warningNoTraceSelected=!1)}},e))}_renderUtilityNetworkTrace(){var a,l;const{viewModel:t,viewModel:{utilityNetwork:e}}=this,i=(a=t.view)==null?void 0:a.map,{messages:s}=this;let r=o("calcite-tabs",{layout:"center",position:"top",styles:Xt(this.container)},o("calcite-tab-nav",{slot:"title-group"},o("calcite-tab-title",{onclick:()=>{this.switchTab("input")},selected:this._activeTab==="input"},s.inputsStrings.headerTabInputs),o("calcite-tab-title",{onclick:()=>{this.switchTab("results")},selected:this._activeTab==="results"},s.resultsStrings.headerTabResults)),this._renderInputsTab(),this._renderResultsTab());return(!((l=i.utilityNetworks)!=null&&l.length)&&!e||e&&!e.sharedNamedTraceConfigurations.length)&&(r=o("calcite-panel",null,this._renderWarningMessage("noTraceConfig",!1))),this._loadUnError||(r=o("calcite-panel",null,this._renderWarningMessage("loadUNError",!1,this._errorMessage))),r}_renderWarningMessage(t,e,i){const{messages:s}=this;let r=s.alertsStrings.NoRunAlertHeader,a=s.alertsStrings.noResultsInfo;switch(t){case"flag":r=s.alertsStrings.startingPointAlertHeader,a=s.alertsStrings.startingPointAlert;break;case"noTerminal":r=s.alertsStrings.noTerminalDefinedHeader,a=s.alertsStrings.noTerminalDefined;break;case"trace":r=s.alertsStrings.selectTraceAlertHeader,a=s.alertsStrings.selectTraceAlert;break;case"noTraceExecuted":r=s.alertsStrings.NoRunAlertHeader,a=s.alertsStrings.noResultsInfo;break;case"noBarrierAsset":case"noStartAsset":r=s.alertsStrings.noAssetsFoundHeader,a=s.alertsStrings.noAssetFound;break;case"noBarrierAssetNso":case"noStartAssetNso":r="",a=s.alertsStrings.noAssetFound;break;case"noTraceConfig":r="",a=s.alertsStrings.noTraceSupported;break;default:r=s.alertsStrings.genericErrorHeader,a=i||""}return o("div",{class:v.noticeContainer,key:t},o("calcite-notice",{closable:e,icon:!0,key:t,kind:"danger",open:!0,scale:"s",width:"auto",onCalciteNoticeClose:()=>this._handleWarningNoticeClose(t)},o("div",{slot:"title"},r),o("div",{slot:"message"},a)))}_afterComponentCreate(t){"value"in t&&t.value!=null&&"setNumberValue"in t&&t.setNumberValue({committing:!1,value:t.value,origin:"direct"})}_appendAttributes(t,e,i){const s=[];return t.forEach(r=>{e.forEach(a=>{a.featureSet.features.forEach(l=>{r[i]===l.attributes[this._resultObjectIdField]&&(r.details=l,r.details.fields=a.featureSet.fields,s.push(r))})})}),s}_changeCursor(t="default"){var i,s;const e=(s=(i=this.view)==null?void 0:i.container)==null?void 0:s.style;e&&(e.cursor=t)}_disablePopup(){const{view:t}=this;t.popupEnabled=!1,t.closePopup()}_compare(t,e){return(i,s)=>{var n,c;let r=0,a=((n=i.details)==null?void 0:n.attributes[t])??i.objectId,l=((c=s.details)==null?void 0:c.attributes[t])??s.objectId;return isNaN(a)&&(a=a.toLowerCase()),isNaN(l)&&(l=l.toLowerCase()),e==="desc"?a>l?r=1:a<l&&(r=-1):a<l?r=1:a>l&&(r=-1),r}}_getAssetGroupName(t){let e=t.assetGroupCode.toString();const i=t.assetGroupCode,s=this.viewModel.getValidSources().find(r=>r.sourceId===t.networkSourceId);if(s){const r=s.assetGroups.find(a=>a.assetGroupCode===i);r&&(e=r.assetGroupName)}return e}_getAssetTypeName(t){let e=t.assetTypeCode.toString();const i=t.assetGroupCode,s=this.viewModel.getValidSources().find(r=>r.sourceId===t.networkSourceId);if(s){const r=s.assetGroups.find(a=>a.assetGroupCode===i);if(r){const a=r.assetTypes.find(l=>l.assetTypeCode===t.assetTypeCode);a&&(e=a.assetTypeName)}}return e}_getSymbolIcon(t){return t.type==="picture-marker"?o("img",{height:t.height,src:t.url??void 0,width:t.width}):null}_groupBy(t,e){return t.reduce((i,s)=>((i[s[e]]=i[s[e]]||[]).push(s),i),{})}_groupResultsByAssetGroup(t){var r;const e=[],i=(r=t.results)==null?void 0:r.elements,s=this._groupBy(i??[],"networkSourceId");for(const a in s)e.push(this._groupBy(s[a],"assetGroupCode"));return e}_groupResultsByAssetType(t){return this._groupBy(t,"assetTypeCode")}_handleWarningNoticeClose(t){switch(t){case"flag":this._warningNoFlag=!1;break;case"noTerminal":this._warningNoTerminal=!1;break;case"trace":this._warningNoTraceSelected=!1;break;case"noStartAsset":this._warningNoStartAssetFound=!1;break;case"noStartAssetNso":this._warningNoStartAssetNsoFound=!1;break;case"noBarrierAsset":this._warningNoBarrierAssetFound=!1;break;case"noBarrierAssetNso":this._warningNoBarrierAssetNsoFound=!1}}_mixCustomStrings(){const{messages:t}=this;this.inputSettings.length>0&&this.inputSettings.forEach(e=>{e.type==="starting-point"&&(t.inputsStrings.headerStartingPoint=e.label,t.inputsStrings.startingPointHint=e.description),e.type==="barrier"&&(t.inputsStrings.headerBarrier=e.label,t.inputsStrings.barrierPointHint=e.description)})}_overrideFlagSymbol(){this.inputSettings.length>0&&this.inputSettings.forEach(t=>{t.type==="starting-point"?this._symbolStartFlag=t.symbol:this._symbolBarrier=t.symbol,this.viewModel.changeFlagSymbol(t.type,t.symbol)})}_processFlagOnLoad(){var t;return(t=this.view)==null?void 0:t.when().then(()=>{this._watchHandler=Ue(()=>{var e;return!((e=this.view)!=null&&e.updating)},async()=>{this._warningNoFlag=!1,this._warningNoBarrierAssetFound=!1,this._warningNoStartAssetFound=!1;const e=await this.viewModel.addFlagsOnLoad();this.viewModel.removeFlagsOnLoadWatcher(),e.includes("barrier")&&(this._warningNoBarrierAssetFound=!0),e.includes("starting-point")&&(this._warningNoStartAssetFound=!0),this.disabled=!1,this._watchHandler!==null&&this._watchHandler.remove()})})}_registerWatchers(){this.addHandles([k(()=>this.selectedTraces,()=>{this.viewModel.selectTracesOnLoad(),this.scheduleRender()}),k(()=>this.defaultGraphicColor,()=>{this.viewModel.traceResults.length>0&&this.viewModel.traceResults.forEach(t=>{this.viewModel.changeResultGraphicColor(this.viewModel.defaultGraphicColor,t)}),this.scheduleRender()})])}_renderComboboxItem({text:t,value:e,selected:i}){return o("calcite-combobox-item",{key:e,selected:i,textLabel:t,value:e})}_resetResultFeatureWidget(){this._showFeatureInfoActive=!1,this._resultFeatureWidget.feature=null,this.view.popupEnabled=this._wasPopupEnabled}_resetTraceLocationWarnings(){this._warningNoBarrierAssetFound=!1,this._warningNoBarrierAssetNsoFound=!1,this._warningNoStartAssetFound=!1,this._warningNoStartAssetNsoFound=!1}_setupAddNonspatialObject(t){this._disablePopup(),this._traceLocationType=t,this._addNonspatialObjectActive=!0,this._resetTraceLocationWarnings(),this.viewModel.getNonspatialTraceLocationInitialFeature().then(e=>{this._findNonspatialFeatureWidget.feature=null;const i=e.graphic;this._findNonspatialFeatureWidget.open(i)}).catch(()=>{this._warningNoStartAssetNsoFound=t==="starting-point",this._warningNoBarrierAssetNsoFound=t==="barrier",this._addNonspatialObjectActive=!1}).finally(()=>this._changeCursor("default"))}_setupAddTraceLocation(t){this._traceLocationType=t,this._changeCursor("crosshair"),this._selectToolActive=!0,this._addNonspatialObjectActive=!1,this._resetTraceLocationWarnings(),this.viewModel.addFlagByHit(this._traceLocationType,this._symbolStartFlag).then(e=>{this._changeCursor("default"),e?this._warningNoFlag=!1:(this._warningNoStartAssetFound=this._traceLocationType==="starting-point",this._warningNoBarrierAssetFound=this._traceLocationType==="barrier"),this._selectToolActive=!1})}_utilityNetworkTraceInitialized(){this.viewModel.loadUtilityNetwork().then(t=>{t&&(this.viewModel.selectTracesOnLoad(),this._registerWatchers(),this.viewModel.flags.length>0&&this._processFlagOnLoad()),this.disabled=!1}).catch(t=>{const{messages:e}=this;this._loadUnError=!1,t.name==="utility-network:no-user-type-extension"||t.details.raw.extendedCode===ti.noExtension?this._errorMessage=e.alertsStrings.noUserExtension:this._errorMessage=t.message,this.disabled=!1})}};d([h()],g.prototype,"_activeTab",void 0),d([h()],g.prototype,"_activeTrace",void 0),d([h()],g.prototype,"_activeSwatch",void 0),d([h()],g.prototype,"_addNonspatialObjectActive",void 0),d([h()],g.prototype,"_alertRemoveModal",void 0),d([h()],g.prototype,"_assetGroupHeader",void 0),d([h()],g.prototype,"_assetTypeHeader",void 0),d([h()],g.prototype,"_confirmReset",void 0),d([h()],g.prototype,"_errorMessage",void 0),d([h()],g.prototype,"_swatchNode",void 0),d([h()],g.prototype,"_selectToolActive",void 0),d([h()],g.prototype,"_showFeatureInfoActive",void 0),d([h()],g.prototype,"_traceHeaderForFlow",void 0),d([h()],g.prototype,"_traceResultsFunctions",void 0),d([h()],g.prototype,"_traceResultsAssetGroup",void 0),d([h()],g.prototype,"_traceResultsAssetType",void 0),d([h()],g.prototype,"_traceResultsIndividual",void 0),d([h()],g.prototype,"_traceResultsState",void 0),d([h()],g.prototype,"_warningNoFlag",void 0),d([h()],g.prototype,"_warningNoTraceSelected",void 0),d([h()],g.prototype,"_updatingHandles",void 0),d([h()],g.prototype,"defaultGraphicColor",null),d([h()],g.prototype,"disabled",void 0),d([h()],g.prototype,"enableResultArea",null),d([h()],g.prototype,"flags",null),d([h()],g.prototype,"gdbVersion",null),d([h()],g.prototype,"icon",null),d([h()],g.prototype,"inputSettings",void 0),d([h()],g.prototype,"label",null),d([h(),N("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace")],g.prototype,"messages",void 0),d([h(),N("esri/t9n/common")],g.prototype,"messagesCommon",void 0),d([h(),N("esri/core/t9n/Units")],g.prototype,"messagesUnits",void 0),d([h()],g.prototype,"resultAreaProperties",null),d([h()],g.prototype,"selectedTraces",null),d([h()],g.prototype,"selectOnComplete",null),d([h()],g.prototype,"showGraphicsOnComplete",null),d([h()],g.prototype,"showSelectionAttributes",null),d([h()],g.prototype,"utilityNetwork",null),d([h()],g.prototype,"view",null),d([Ie(["add-flag","add-flag-complete","add-flag-error","select-features","clear-selection","add-result-area","remove-result-area","create-result-area","reset"]),h({type:xe})],g.prototype,"viewModel",void 0),g=d([X("esri.widgets.UtilityNetworkTrace")],g);const ii=g;/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
v4.32.12 */const Q=class Q extends De{constructor(){super(...arguments),this._watchHandles=[],this.defaultGraphicColor={color:[255,255,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#FFFF00"},this.disabled=!1,this.enableResultArea=!1,this.flags=[],this.gdbVersion="sde.DEFAULT",this.inputSettings=[],this.position="bottom-left",this.selectOnCompleteDisabled=!1,this.selectedTraces=[],this.showGraphicsOnCompleteDisabled=!1,this.showSelectionAttributesDisabled=!1,this.arcgisAddFlag=M(),this.arcgisAddFlagComplete=M(),this.arcgisAddFlagError=M(),this.arcgisAddResultArea=M(),this.arcgisReady=M(),this.arcgisRemoveResultArea=M()}async checkCanTrace(){var e;await((e=this.widget)==null?void 0:e.checkCanTrace())}async confirmReset(){var e;(e=this.widget)==null||e.confirmReset()}willUpdate(e){e.has("referenceElement")&&this.referenceElementWatcher(this.referenceElement),e.has("enableResultArea")&&this.enableResultAreaWatcher(this.enableResultArea),e.has("defaultGraphicColor")&&this.defaultGraphicColorWatcher(this.defaultGraphicColor),e.has("disabled")&&this.disabledWatcher(this.disabled,e.get("disabled")),e.has("flags")&&this.flagsWatcher(this.flags),e.has("gdbVersion")&&this.gdbVersionWatcher(this.gdbVersion),e.has("inputSettings")&&this.inputSettingsWatcher(this.inputSettings),e.has("resultAreaProperties")&&this.resultAreaProperties&&this.resultAreaPropertiesWatcher(this.resultAreaProperties),e.has("selectedTraces")&&this.selectedTracesWatcher(this.selectedTraces),e.has("selectOnCompleteDisabled")&&this.selectOnCompleteDisabledWatcher(this.selectOnCompleteDisabled),e.has("showGraphicsOnCompleteDisabled")&&this.showGraphicsOnCompleteDisabledWatcher(this.showGraphicsOnCompleteDisabled),e.has("showSelectionAttributesDisabled")&&this.showSelectionAttributesDisabledWatcher(this.showSelectionAttributesDisabled),e.has("position")&&this.positionWatcher(this.position),e.has("view")&&this.viewWatcher(this.view)}async loaded(){const e=this._createParams(),i=new ii(e);this.widget=i,await this._addWatchers(),this._proxyEvents(),this._addContainer(),It(this),Nt(this)}disconnectedCallback(){super.disconnectedCallback(),Ot(this)}referenceElementWatcher(e){Mt(this,e)}enableResultAreaWatcher(e){this.widget&&(this.widget.enableResultArea=e)}defaultGraphicColorWatcher(e){this.widget&&(this.widget.defaultGraphicColor=e)}disabledWatcher(e,i){this.widget&&e!==i&&(this.widget.disabled=e)}flagsWatcher(e){this.widget&&(this.widget.flags=e)}gdbVersionWatcher(e){this.widget&&(this.widget.gdbVersion=e)}inputSettingsWatcher(e){this.widget&&(this.widget.inputSettings=e)}resultAreaPropertiesWatcher(e){this.widget&&(this.widget.resultAreaProperties=e)}selectedTracesWatcher(e){this.widget&&(this.widget.selectedTraces=e)}selectOnCompleteDisabledWatcher(e){e!==void 0&&this.widget&&(this.widget.selectOnComplete=!e)}showGraphicsOnCompleteDisabledWatcher(e){e!==void 0&&this.widget&&(this.widget.showGraphicsOnComplete=!e)}showSelectionAttributesDisabledWatcher(e){e!==void 0&&this.widget&&(this.widget.showSelectionAttributes=!e)}positionWatcher(e){var i;e!==void 0&&this.widget&&this.el.childElem&&((i=this.view.ui)==null||i.move(this.el.childElem,e))}viewWatcher(e){e!==void 0&&this.widget&&(this.widget.view=e)}_addContainer(){this.widget.container=this.el.childElem}async _addWatchers(){Et(this,k(()=>this.widget.disabled,e=>this.disabled=e))}_createParams(){const e={};return this.defaultGraphicColor&&(e.defaultGraphicColor=this.defaultGraphicColor),this.enableResultArea!==void 0&&(e.enableResultArea=this.enableResultArea),this.flags&&(e.flags=this.flags),this.gdbVersion&&(e.gdbVersion=this.gdbVersion),this.inputSettings&&(e.inputSettings=this.inputSettings),this.resultAreaProperties&&(e.resultAreaProperties=this.resultAreaProperties),this.selectedTraces&&(e.selectedTraces=this.selectedTraces),this.selectOnCompleteDisabled!==void 0&&(e.selectOnComplete=!this.selectOnCompleteDisabled),this.showGraphicsOnCompleteDisabled!==void 0&&(e.showGraphicsOnComplete=!this.showGraphicsOnCompleteDisabled),this.showSelectionAttributesDisabled!==void 0&&(e.showSelectionAttributes=!this.showSelectionAttributesDisabled),this.view&&(e.view=this.view),e}_proxyEvents(){this.widget.on("add-flag",e=>this.arcgisAddFlag.emit(e)),this.widget.on("add-flag-complete",e=>this.arcgisAddFlagComplete.emit(e)),this.widget.on("add-flag-error",e=>this.arcgisAddFlagError.emit(e)),this.widget.on("add-result-area",e=>this.arcgisAddResultArea.emit(e)),this.widget.on("remove-result-area",e=>this.arcgisRemoveResultArea.emit(e))}_setChildElement(e){this.el.childElem=e}render(){return $e`<div ${He(this._setChildElement)}></div>`}};Q.properties={defaultGraphicColor:0,disabled:7,enableResultArea:5,flags:0,gdbVersion:1,inputSettings:0,position:1,referenceElement:1,resultAreaProperties:0,selectOnCompleteDisabled:5,selectedTraces:0,showGraphicsOnCompleteDisabled:5,showSelectionAttributesDisabled:5,view:0,widget:0},Q.shadowRootOptions=Be;let ce=Q;Ve("arcgis-utility-network-trace",ce);export{ce as ArcgisUtilityNetworkTrace};
