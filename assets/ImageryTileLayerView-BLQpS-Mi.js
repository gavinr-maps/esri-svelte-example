import{r as n,m as u,a as j,s as O}from"./Accessor-BHnuXKD2.js";import{b as P}from"./Graphic-CFXUQZlS.js";import{n as L,t as m,V as _}from"./rasterFieldUtils-tcgglH7k.js";import{i as $}from"./timeSupport-WJxqhq3S.js";import{_ as A,x as b,O as z}from"./rasterProjectionHelper-BYBh__EP.js";import{p as C}from"./popupUtils-Bp0XPfzq.js";const H=R=>{let t=class extends R{constructor(){super(...arguments),this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){var i;return $(this.layer,(i=this.view)==null?void 0:i.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){try{return this.layer.loaded?A(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(i){try{return!this.layer.loaded||!!b(this.layer.serviceRasterInfo,i)}catch{return!1}}async fetchPopupFeaturesAtLocation(i,y){var g,x;const{layer:e}=this;if(!i)throw new O("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:e});const{popupEnabled:T}=e,I=C(e,y);if(!T||I==null)return[];const h=[],{value:l,magdirValue:s,processedValue:p}=await e.identify(i,{timeExtent:this.timeExtent,signal:y==null?void 0:y.signal});let d="";if(l!=null&&l.length){d=e.type==="imagery-tile"&&e.hasStandardTime()&&l[0]!=null?l.map(c=>e.getStandardTimeValue(c)).join(", "):l.join(", ");const r={ObjectId:0};r[m.servicePixelValue]=e.type==="imagery-tile"&&e.raster.datasetFormat==="Function"?p==null?void 0:p.join(", "):d,r[m.rawServicePixelValue]=d;const o=((g=e.raster)==null?void 0:g.rasterInfo)??e.serviceRasterInfo,v=o==null?void 0:o.attributeTable;if(v!=null){const{fields:c,features:F}=v,w=c.find(({name:a})=>a.toLowerCase()==="value"),S=r[m.servicePixelValue],f=w?F.find(a=>String(a.attributes[w.name])===S):null;if(f)for(const a in f.attributes)f.attributes.hasOwnProperty(a)&&(r[L+a]=f.attributes[a])}const E=o==null?void 0:o.dataType;if(E!=="vector-magdir"&&E!=="vector-uv"||(r[m.magnitude]=s==null?void 0:s[0],r[m.direction]=s==null?void 0:s[1]),e.type==="imagery-tile"){const{multidimensionalDefinition:c}=this.layer.normalizeRasterFetchOptions({timeExtent:this.timeExtent});_(e.rasterFields,r,c)}const V=new P({geometry:(x=this.fullExtent)==null?void 0:x.clone(),attributes:r,layer:e,sourceLayer:e});h.push(V)}return h}async getSourceScale(){return await this.layer.load(),z(this.layer.serviceRasterInfo,this.view.spatialReference)}_getFullExtent(){return b(this.layer.serviceRasterInfo,this.view.spatialReference)}};return n([u()],t.prototype,"fullExtent",null),n([u()],t.prototype,"layer",void 0),n([u({readOnly:!0})],t.prototype,"timeExtent",null),n([u()],t.prototype,"tileInfo",void 0),n([u({readOnly:!0})],t.prototype,"hasTilingEffects",null),n([u()],t.prototype,"datumTransformation",null),t=n([j("esri.views.layers.ImageryTileLayerView")],t),t};export{H as y};
