const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./uploadAssets-BtFs9Y3X.js","./cast-BA_-jlhc.js","./Accessor-BHnuXKD2.js","./index-tefRSezt.js","./index-Cx51aysm.css","./JSONSupport-CGdeqxpk.js","./uuid-Cl5lrJ4c.js","./Point-XGrwlf63.js","./writer-B2bQV2uU.js","./External-Dk8Y8WWd.js","./infoFor3D-CsJzgCF0.js","./uploadAssetErrors-B15urE_S.js","./progressUtils-BmRXf5wX.js","./meshSpatialReferenceScaleUtils-CYrRZSrR.js","./MeshTransform-CIhaTwDv.js","./mat4-Fi6iAz29.js","./vec3f64-BLpZdpfb.js","./common-DQOJ18NT.js","./mat4f64-Dk4dwAN8.js","./quat-4pa1e6ds.js","./mat3f64-BBpwCtoL.js","./quatf64-CCm9z-pX.js","./vec32-Dvg_eL9J.js","./vec42-YcqnINSP.js","./axisAngleDegrees-8Sw4vC28.js","./mathUtils-DV9iOXpW.js","./meshFeatureAttributes-CeSp-p_A.js","./convertMeshVertexSpace-CAW2Y1Ht.js","./MeshVertexAttributes-Dh8Pp9-Y.js","./meshProperties-C4iW0Ukm.js","./vertexSpaceConversion-Dbe11h0o.js","./mat3-CR8GKnhD.js","./spatialReferenceEllipsoidUtils-DM073JUd.js","./computeTranslationToOriginAndRotation-BT43Xu5d.js","./projectBuffer-DOU0xvVi.js","./geodesicConstants-yASAK_zX.js","./projectPointToVector-BS0u8fq6.js","./projection-B2I9Bzj_.js","./SimpleObservable-7oieNGD8.js","./Extent-CBBGeHb-.js","./Polyline-BmuD2-ZN.js","./meshVertexSpaceUtils-SW0WEjNN.js","./MeshLocalVertexSpace-C0YDTRex.js","./Clonable-DvJsj5LF.js","./enumeration-Cr5WIZs4.js","./vec3-Bn81gjoR.js","./colorUtils-Rxh2V3ai.js","./BufferView-_QDXRCew.js","./vec2-maR1OrZI.js","./vec4-DcW4fpPA.js"])))=>i.map(i=>d[i]);
import{_ as M}from"./index-tefRSezt.js";import{r as A,m as R,k as L,M as N,G as v,s as E,O as D,F as P,ag as U,_ as Q,V as j,B as J,a as V}from"./Accessor-BHnuXKD2.js";import{o as k,P as h,g as G,V as x}from"./cast-BA_-jlhc.js";import{m as H}from"./Portal-CTRRujjZ.js";import{d as B}from"./reactiveUtils-BR0C1Kq4.js";import{r as z}from"./uuid-Cl5lrJ4c.js";import{w as K}from"./Extent-CBBGeHb-.js";import{g as W}from"./Point-XGrwlf63.js";import{n as X}from"./MeshLocalVertexSpace-C0YDTRex.js";import{t as Y}from"./meshVertexSpaceUtils-SW0WEjNN.js";import{A as Z}from"./External-Dk8Y8WWd.js";import{R as T,m as C,b as $,f as tt,j as et,y as rt,I as st}from"./applyEditsUtils-B-dfj_XI.js";import{u as at}from"./clientSideDefaults-BOCfNRNG.js";import{F as it}from"./QueryTask-BTjeI7Co.js";import{H as F}from"./featureLayerUtils-BzWCGee1.js";import{h as ot}from"./infoFor3D-CsJzgCF0.js";import{s as nt}from"./executeQueryJSON-CLYdIUdF.js";import{i as ut}from"./editsZScale-BKYnJc2O.js";import{b as lt}from"./Query-DCBIeen2.js";import{p as pt}from"./TimeExtent-J5qnUFx_.js";import{i as ct,a as dt,o as ht,t as yt}from"./EditBusLayer-Cx9SJosU.js";import"./JSONSupport-CGdeqxpk.js";import"./Promise-CmQqe-ke.js";import"./writer-B2bQV2uU.js";import"./Evented-DCWccWGU.js";import"./SimpleObservable-7oieNGD8.js";import"./Clonable-DvJsj5LF.js";import"./enumeration-Cr5WIZs4.js";import"./vec3f64-BLpZdpfb.js";import"./vec32-Dvg_eL9J.js";import"./common-DQOJ18NT.js";import"./Graphic-CFXUQZlS.js";import"./opacityUtils-CSd4XoR2.js";import"./Color-gncXBiLc.js";import"./colorUtils-Rxh2V3ai.js";import"./mathUtils-DV9iOXpW.js";import"./ActionToggle-__-l4AdQ.js";import"./Identifiable-BrT7zvUW.js";import"./jsonUtils-Cu7OBRmN.js";import"./Polyline-BmuD2-ZN.js";import"./typeUtils-BSg8Y507.js";import"./TextSymbol-BQ_NW9Xo.js";import"./screenUtils-_ZIvrt5o.js";import"./collectionUtils-CbaToa73.js";import"./aaBoundingBox-CeBivBRq.js";import"./projection-B2I9Bzj_.js";import"./projectBuffer-DOU0xvVi.js";import"./geodesicConstants-yASAK_zX.js";import"./MeshTransform-CIhaTwDv.js";import"./mat4-Fi6iAz29.js";import"./mat4f64-Dk4dwAN8.js";import"./quat-4pa1e6ds.js";import"./mat3f64-BBpwCtoL.js";import"./quatf64-CCm9z-pX.js";import"./vec42-YcqnINSP.js";import"./axisAngleDegrees-8Sw4vC28.js";import"./editingSupport-Dr0ErgB3.js";import"./normalizeUtils-XRAPXbWa.js";import"./normalizeUtilsCommon-D0zPTJCj.js";import"./utils-Cy8wFNQo.js";import"./utils-CkSELPnj.js";import"./layerUtils-dJgsXxkC.js";import"./QueryEngineCapabilities-DZTubngj.js";import"./defaultsJSON-GKolV7NZ.js";import"./executeForIds-CUQYF7Pj.js";import"./query-BS_L6I0Q.js";import"./pbfQueryUtils-AwPAOS5M.js";import"./pbf-CFI-xDDp.js";import"./memoryEstimations-5gFNwkKK.js";import"./OptimizedGeometry-7IxBWtHr.js";import"./OptimizedFeature-DcMLlxvB.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./queryZScale-DwN6mTru.js";import"./featureConversionUtils-DpmsPUmt.js";import"./FeatureSet-DpCN730g.js";import"./Field-Cyk7Ur5d.js";import"./fieldType-L-VlbZqy.js";import"./featureQueryAll-xezK3WCp.js";import"./SimpleRenderer-gSw1WaJS.js";import"./commonProperties-bGHL1a5M.js";import"./colorRamps-Dkx8zIVn.js";import"./SizeVariable-IzD1bP2e.js";import"./visualVariableUtils-Bp9QCb8E.js";import"./lengthUtils-DjJgJFRg.js";import"./ColorStop-CDpeFWOz.js";import"./jsonUtils-Dzgxk9pw.js";import"./defaults-Dwxdhopq.js";import"./UniqueValueRenderer-Cri3tgP5.js";import"./diffUtils-CMkuJvD2.js";import"./RendererLegendOptions-mgfHoilI.js";import"./styleUtils-BB-zx7mT.js";import"./AttachmentQuery-BceVlzuF.js";import"./NormalizationBinParametersMixin-D6iHLB7I.js";import"./RelationshipQuery-W-4bfgaH.js";import"./FullTextSearch-BWm_kPUE.js";import"./timeUtils-D2X862bk.js";const mt=new k({originalAndCurrentFeatures:"original-and-current-features",none:"none"}),ft=new k({Started:"published",Publishing:"publishing",Stopped:"unavailable"});let g=class extends H{constructor(e){super(e),this.type="feature-layer",this.supportedSourceTypes=new Set(["Feature Layer","Oriented Imagery Layer","Table","Catalog Layer"]),this.refresh=L(async()=>{var s,a;await this.load();const t=(s=this.sourceJSON.editingInfo)==null?void 0:s.lastEditDate;if(t==null)return{dataChanged:!0,updates:{}};try{await this._fetchService(null)}catch{return{dataChanged:!0,updates:{}}}const r=t!==((a=this.sourceJSON.editingInfo)==null?void 0:a.lastEditDate);return{dataChanged:r,updates:r?{editingInfo:this.sourceJSON.editingInfo,extent:this.sourceJSON.extent}:null}}),this._ongoingAssetUploads=new Map}load(e){const t=this.layer.sourceJSON,r=this._fetchService(t,{...e}).then(()=>this.layer.setUserPrivileges(this.sourceJSON.serviceItemId,e)).then(()=>this._ensureLatestMetadata(e));return this.addResolvingPromise(r),Promise.resolve(this)}initialize(){this.addHandles([B(()=>{const e=this.layer;return e&&"lastEditsEventDate"in e?e.lastEditsEventDate:null},e=>this._handleLastEditsEventChange(e))])}destroy(){this._removeEditInterceptor()}get queryTask(){var l;const{capabilities:e,parsedUrl:t,gdbVersion:r,spatialReference:s,fieldsIndex:a}=this.layer,o="infoFor3D"in this.layer?this.layer.infoFor3D:null,i="dynamicDataSource"in this.layer?this.layer.dynamicDataSource:null,n=N("featurelayer-pbf")&&(e==null?void 0:e.query.supportsFormatPBF)&&o==null,u=((l=e==null?void 0:e.operations)==null?void 0:l.supportsQueryAttachments)??!1;return new it({url:t.path,pbfSupported:n,fieldsIndex:a,infoFor3D:o,dynamicDataSource:i,gdbVersion:r,sourceSpatialReference:s,queryAttachmentsSupported:u})}async addAttachment(e,t){await this.load();const{layer:r}=this;await F(r,"editing");const s=e.attributes[r.objectIdField],a=r.parsedUrl.path+"/"+s+"/addAttachment",o=this._getLayerRequestOptions(),i=this._getFormDataForAttachment(t,o.query);try{const n=await h(a,{body:i});return T(n.data.addAttachmentResult)}catch(n){throw this._createAttachmentErrorResult(s,n)}}async updateAttachment(e,t,r){await this.load();const{layer:s}=this;await F(s,"editing");const a=e.attributes[s.objectIdField],o=s.parsedUrl.path+"/"+a+"/updateAttachment",i=this._getLayerRequestOptions({query:{attachmentId:t}}),n=this._getFormDataForAttachment(r,i.query);try{const u=await h(o,{body:n});return T(u.data.updateAttachmentResult)}catch(u){throw this._createAttachmentErrorResult(a,u)}}async applyEdits(e,t){var S,b;await this.load();const{layer:r}=this;await F(r,"editing");const s="infoFor3D"in r?r.infoFor3D:null,a=s!=null,o=a||((t==null?void 0:t.globalIdUsed)??!1),i=a?await this._uploadMeshesAndGetAssetMapEditsJSON(e):null,n=((S=e.addFeatures)==null?void 0:S.map(_=>C(this.layer,_,s)))??[],u=(await Promise.all(n)).filter(v),l=((b=e.updateFeatures)==null?void 0:b.map(_=>C(this.layer,_,s)))??[],p=(await Promise.all(l)).filter(v),f=$(this.layer,e.deleteFeatures,o);ut(u,p,r.spatialReference);const O=await tt(this.layer,e),w=r.capabilities.editing.supportsAsyncApplyEdits&&a,c=(t==null?void 0:t.gdbVersion)||r.gdbVersion,d={gdbVersion:c,rollbackOnFailure:t==null?void 0:t.rollbackOnFailureEnabled,useGlobalIds:o,returnEditMoment:t==null?void 0:t.returnEditMoment,usePreviousEditMoment:t==null?void 0:t.usePreviousEditMoment,async:w};await ct(this.layer.url,c,!0);const I=dt(this.layer.url,c||null);if(await ht(r.url,c,r.historicMoment))throw new E("feature-layer-source:historic-version","Editing a historic version is not allowed");t!=null&&t.returnServiceEditsOption?(d.edits=JSON.stringify([{id:r.layerId,adds:u.length?u:null,updates:p.length?p:null,deletes:f.length?f:null,attachments:O,assetMaps:i}]),d.returnServiceEditsOption=mt.toJSON(t==null?void 0:t.returnServiceEditsOption),d.returnServiceEditsInSourceSR=t==null?void 0:t.returnServiceEditsInSourceSR):(d.adds=u.length?JSON.stringify(u):null,d.updates=p.length?JSON.stringify(p):null,d.deletes=f.length?o?JSON.stringify(f):f.join(","):null,d.attachments=O&&JSON.stringify(O),d.assetMaps=i!=null?JSON.stringify(i):void 0);const y=this._getLayerRequestOptions({method:"post",query:d});I&&(y.authMode="immediate",y.query.returnEditMoment=!0,y.query.sessionId=yt);const q=t!=null&&t.returnServiceEditsOption?r.url:r.parsedUrl.path;let m;try{m=w?await this._asyncApplyEdits(q+"/applyEdits",y):await h(q+"/applyEdits",y)}catch(_){if(!et(_))throw _;y.authMode="immediate",m=w?await this._asyncApplyEdits(q+"/applyEdits",y):await h(q+"/applyEdits",y)}return this._createEditsResult(m)}async deleteAttachments(e,t){await this.load();const{layer:r}=this;await F(r,"editing");const s=e.attributes[r.objectIdField],a=r.parsedUrl.path+"/"+s+"/deleteAttachments";try{return(await h(a,this._getLayerRequestOptions({query:{attachmentIds:t.join(",")},method:"post"}))).data.deleteAttachmentResults.map(T)}catch(o){throw this._createAttachmentErrorResult(s,o)}}fetchRecomputedExtents(e={}){const t=e.signal;return this.load({signal:t}).then(async()=>{const r=this._getLayerRequestOptions({...e,query:{returnUpdates:!0}}),{layerId:s,url:a}=this.layer,{data:o}=await h(`${a}/${s}`,r),{id:i,extent:n,fullExtent:u,timeExtent:l}=o,p=n||u;return{id:i,fullExtent:p&&K.fromJSON(p),timeExtent:l&&pt.fromJSON({start:l[0],end:l[1]})}})}async queryAttachments(e,t={}){await this.load();const r=this._getLayerRequestOptions(t);return this.queryTask.executeAttachmentQuery(e,r)}async queryFeatures(e,t){var s;await this.load();const r=await this.queryTask.execute(e,{...t,query:this._createRequestQueryOptions(t)});if((s=e.outStatistics)!=null&&s.length&&r.features.length){const a=new Map;if(r.features.forEach(o=>{var n;const i=o.attributes;(n=e.outStatistics)==null||n.forEach(({outStatisticFieldName:u})=>{if(u){const l=u.toLowerCase();l&&l in i&&u!==l&&(i[u]=i[l],delete i[l],a.set(l,u))}})}),r.fields!=null)for(const o of r.fields){const i=a.get(o.name.toLowerCase());i!=null&&(o.name=i)}}return r}async queryFeaturesJSON(e,t){return await this.load(),this.queryTask.executeJSON(e,{...t,query:this._createRequestQueryOptions(t)})}async queryObjectIds(e,t){return await this.load(),this.queryTask.executeForIds(e,{...t,query:this._createRequestQueryOptions(t)})}async queryFeatureCount(e,t){return await this.load(),this.queryTask.executeForCount(e,{...t,query:this._createRequestQueryOptions(t)})}async queryExtent(e,t){return await this.load(),this.queryTask.executeForExtent(e,{...t,query:this._createRequestQueryOptions(t)})}async queryRelatedFeatures(e,t){return await this.load(),this.queryTask.executeRelationshipQuery(e,{...t,query:this._createRequestQueryOptions(t)})}async queryRelatedFeaturesCount(e,t){return await this.load(),this.queryTask.executeRelationshipQueryForCount(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopFeatures(e,t){return await this.load(),this.queryTask.executeTopFeaturesQuery(e,{...t,query:this._createRequestQueryOptions(t)})}async queryAttributeBins(e,t){return await this.load(),this.queryTask.executeAttributeBinsQuery(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopObjectIds(e,t){return await this.load(),this.queryTask.executeForTopIds(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopExtents(e,t){return await this.load(),this.queryTask.executeForTopExtents(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopCount(e,t){return await this.load(),this.queryTask.executeForTopCount(e,{...t,query:this._createRequestQueryOptions(t)})}async fetchPublishingStatus(){if(!G(this.layer.url))return"unavailable";const e=x(this.layer.url,"status"),t=await h(e,{query:{f:"json"}});return ft.fromJSON(t.data.status)}async uploadAssets(e,t){const{uploadAssets:r}=await M(()=>import("./uploadAssets-BtFs9Y3X.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]),import.meta.url);return r(e,{layer:this.layer,ongoingUploads:this._ongoingAssetUploads},t)}_handleLastEditsEventChange(e){var s,a,o,i;const t=this.layer;if(e==null||!("capabilities"in t)||!("effectiveCapabilities"in t)||!(!((a=(s=t.capabilities)==null?void 0:s.operations)!=null&&a.supportsEditing)&&((i=(o=t.effectiveCapabilities)==null?void 0:o.operations)!=null&&i.supportsEditing)))return;const r=t.url;r!=null&&("layerId"in t&&x(r,t.layerId.toString()),this._getOrCreateEditInterceptor(r).before=n=>{const u=n.requestOptions.method??"auto";if(u==="auto"||u==="head"){const l=n.requestOptions.query??{};l._ts=e.getTime(),n.requestOptions.query=l}})}_getOrCreateEditInterceptor(e){return this._editInterceptor==null&&(this._editInterceptor={urls:e},D.request.internalInterceptors.push(this._editInterceptor)),this._editInterceptor}_removeEditInterceptor(){this._editInterceptor!=null&&(P(D.request.internalInterceptors,this._editInterceptor),this._editInterceptor=null)}async _asyncApplyEdits(e,t){const r=(await h(e,t)).data.statusUrl;for(;;){const s=(await h(r,{query:{f:"json"},responseType:"json"})).data;switch(s.status){case"Completed":return h(s.resultUrl,{query:{f:"json"},responseType:"json"});case"CompletedWithErrors":throw new E("async-applyEdits-failed","asynchronous applyEdits call failed.");case"Failed ImportChanges":case"InProgress":case"Pending":case"ExportAttachments":case"ExportChanges":case"ExportingData":case"ExportingSnapshot":case"ImportAttachments":case"ProvisioningReplica":case"UnRegisteringReplica":break;default:throw new E("async-applyEdits-failed","asynchronous applyEdits call failed (undefined response status)")}await U(gt)}}_createRequestQueryOptions(e){const t={...this.layer.customParameters,token:this.layer.apiKey,...e==null?void 0:e.query};return this.layer.datesInUnknownTimezone&&(t.timeReferenceUnknownClient=!0),t}async _fetchService(e,t){if(!e){const s={};N("featurelayer-advanced-symbols")&&(s.returnAdvancedSymbols=!0),t!=null&&t.cacheBust&&(s._ts=Date.now());const{data:a}=await h(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:s,signal:t==null?void 0:t.signal}));e=a}this.sourceJSON=await this._patchServiceJSON(e,t==null?void 0:t.signal);const r=e.type;if(!this.supportedSourceTypes.has(r))throw new E("feature-layer-source:unsupported-type",`Source type "${r}" is not supported`)}async _patchServiceJSON(e,t){var r;if(e.type!=="Table"&&e.geometryType&&!((r=e==null?void 0:e.drawingInfo)!=null&&r.renderer)&&!e.defaultSymbol){const s=at(e.geometryType).renderer;Q("drawingInfo.renderer",s,e)}if(e.geometryType==="esriGeometryMultiPatch"&&e.infoFor3D&&(e.geometryType="mesh"),e.extent==null)try{const{data:s}=await h(this.layer.url,this._getLayerRequestOptions({signal:t}));s.spatialReference&&(e.extent={xmin:0,ymin:0,xmax:0,ymax:0,spatialReference:s.spatialReference})}catch(s){j(s)}return e}async _ensureLatestMetadata(e){if(this.layer.userHasUpdateItemPrivileges&&this.sourceJSON.cacheMaxAge>0)return this._fetchService(null,{...e,cacheBust:!0})}async _uploadMeshesAndGetAssetMapEditsJSON(e){const{addAssetFeatures:t}=e;if(!(t!=null&&t.length)||await this._areAllAssetsAlreadyMapped(t))return null;const r=e.addFeatures.filter(o=>o.geometry);if(t.length!==r.length+e.updateFeatures.length)throw new E("feature-layer-source:unsupported-mesh-edits","Mixing attribute only edits with mesh geometry edits is not currently supported");const s=new Array,a=new Map;for(const o of t){const{geometry:i}=o,{vertexSpace:n}=i;if(Y(n))s.push(i);else{const u=i.origin,{convertMeshVertexSpace:l}=await M(async()=>{const{convertMeshVertexSpace:f}=await import("./convertMeshVertexSpace-CAW2Y1Ht.js");return{convertMeshVertexSpace:f}},__vite__mapDeps([27,2,28,5,1,3,4,29,30,25,7,8,31,17,20,15,16,18,22,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,23,49]),import.meta.url),p=await l(i,new X({origin:[u.x,u.y,u.z??0]}));a.set(p,i),o.geometry=p,s.push(p)}}await this.uploadAssets(s);for(const[o,i]of a)i.addExternalSources(o.metadata.externalSources.items);return{adds:this._getAssetMapEditsJSON(t),updates:[],deletes:[]}}_getAssetMapEditsJSON(e){const t=new Array,r=this.layer.globalIdField,s=this.layer.parsedUrl;for(const a of e){const o=a.geometry,{metadata:i}=o,n=i.getExternalSourcesOnService(s),u=a.getAttribute(r);if(n.length===0){J.getLogger(this).error(`Skipping feature ${u}. The mesh it is associated with has not been uploaded to the service and cannot be mapped to it.`);continue}const{source:l}=n.find(Z)??n[0];for(const p of l)p.parts.length===1?t.push({globalId:z(),parentGlobalId:u,assetName:p.assetName,assetHash:p.parts[0].partHash,flags:[]}):J.getLogger(this).error(`Skipping asset ${p.assetName}. It does not have exactly one part, so we cannot map it to a feature.`)}return t}_createEditsResult(e){const t=e.data,{layerId:r}=this.layer,s=[];let a=null;if(Array.isArray(t))for(const i of t)s.push({id:i.id,editedFeatures:i.editedFeatures}),i.id===r&&(a={addResults:i.addResults??[],updateResults:i.updateResults??[],deleteResults:i.deleteResults??[],attachments:i.attachments,editMoment:i.editMoment});else a=t;const o=rt(a);if(s.length>0){o.editedFeatureResults=[];for(const i of s){const{editedFeatures:n}=i,u=n!=null&&n.spatialReference?new W(n.spatialReference):null;o.editedFeatureResults.push({layerId:i.id,editedFeatures:st(n,u)})}}return o}_createAttachmentErrorResult(e,t){var a;const r=((a=t.details.messages)==null?void 0:a[0])||t.message,s=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new E("feature-layer-source:attachment-failure",r,{code:s})}}_getFormDataForAttachment(e,t){const r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(const s in t){const a=t[s];a!=null&&(r.set?r.set(s,a):r.append(s,a))}return r}_getLayerRequestOptions(e={}){const{layer:t,layer:{parsedUrl:r,gdbVersion:s}}=this;return{...e,query:{gdbVersion:s,layer:"dynamicDataSource"in t&&t.dynamicDataSource?JSON.stringify({source:t.dynamicDataSource}):void 0,...r.query,f:"json",...this._createRequestQueryOptions(e)},responseType:"json"}}async _areAllAssetsAlreadyMapped(e){const{layer:t}=this,{globalIdField:r,parsedUrl:s}=t,a="infoFor3D"in t?t.infoFor3D:null;if(a==null||r==null)return!1;const o=ot(a);if(o==null)return!1;const i=x(s.path,`../${o.id}`),n=new Array;for(const c of e){if(!(c.geometry.metadata.getExternalSourcesOnService(s).length>0))return!1;n.push(c)}const u=n.map(c=>c.getAttribute(r)).filter(v);if(u.length===0)return!1;const{assetMapFieldRoles:{parentGlobalId:l,assetHash:p}}=a,f=new lt({where:`${l} IN (${u.map(c=>`'${c}'`)})`,outFields:[p,l],returnGeometry:!1}),O=await nt(i,f),{features:w}=O;return w.length!==0&&!n.some(c=>{const d=c.getAttribute(r);if(!d)return!0;const{metadata:I}=c.geometry,y=w.filter(m=>m.getAttribute(l)===d);if(y.length===0)return!0;const q=y.map(m=>m.getAttribute(p));return I.getExternalSourcesOnService(s).flatMap(({source:m})=>m.flatMap(S=>S.parts.map(b=>b.partHash))).some(m=>q.every(S=>m!==S))})}};A([R()],g.prototype,"type",void 0),A([R({constructOnly:!0})],g.prototype,"layer",void 0),A([R({constructOnly:!0})],g.prototype,"supportedSourceTypes",void 0),A([R({readOnly:!0})],g.prototype,"queryTask",null),g=A([V("esri.layers.graphics.sources.FeatureLayerSource")],g);const gt=1e3,or=g;export{or as default};
