const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Graphics3DSymbolLayerFactory-BLzsgzAv.js","./subclass-BZA_h8Db.js","./Graphics3DExtrudeSymbolLayer-DKsUjopW.js","./Point-Cg0-ChZE.js","./tslib.es6-B3Jf3DVX.js","./Accessor-BLX9ikPh.js","./cast-Bjksrh93.js","./writer-DNAwXnhG.js","./assets-C43MgM-v.js","./index-Bh2oEzTI.js","./index-2kwcjS9-.css","./jsonMap-0cxwUWs2.js","./earcut-Lltz9D9k.js","./mat3-BRl2i9Bz.js","./common-DQOJ18NT.js","./mat3f64-BBpwCtoL.js","./mat4-GpOFENPA.js","./vec3f64-BLpZdpfb.js","./mat4f64-Dk4dwAN8.js","./vec32-Dvg_eL9J.js","./computeTranslationToOriginAndRotation-Q27G6TBL.js","./mathUtils-C4_ghTv4.js","./projectBuffer-Bs7GwaPY.js","./geodesicConstants-DWQLYX7F.js","./aaBoundingBox-BE7cC1jD.js","./Extent-Bf3YTe7m.js","./Polyline-D9YkgmM_.js","./Indices-DflDlU4Z.js","./vec3-kbEkneOB.js","./SnappingCandidate-O5eRSE6e.js","./renderingInfoUtils-DAsRBUXK.js","./Color-BCS62Hs5.js","./colorUtils-0bJDPow9.js","./visualVariableUtils-DX1kS9Se.js","./Graphic-DsxsIjhH.js","./geometry-D964gYQX.js","./PopupTemplate-BHMhS05j.js","./Clonable-D3rtuBWg.js","./Collection-CEdjem1-.js","./Evented-BHRw9x22.js","./shared-B3wH2qpO.js","./SimpleObservable-KocWTzVy.js","./fieldUtils-tmQlKvWo.js","./intl-CChhNOV8.js","./date-DlqISzcw.js","./locale-C9TlLpzi.js","./messages-OmQvZhAg.js","./enumeration-Ba5njXdz.js","./ActionToggle-iT4slXc7.js","./Identifiable-B1UbsKNt.js","./symbols-CNimns--.js","./TextSymbol-D8QO_KUV.js","./screenUtils-_ZIvrt5o.js","./materialUtils-DarhapKC.js","./opacityUtils-C68Tlu6_.js","./persistableUrlUtils-fa1mAujs.js","./collectionUtils-D_lHIu88.js","./Portal-C10FKnaA.js","./Loadable-BabW5Xcc.js","./Promise-B2Hu02L7.js","./reactiveUtils-C5zUhJQJ.js","./asyncUtils-CWX51uTe.js","./jsonUtils-CEfjT-BK.js","./compilerUtils-Dw3R0f-Z.js","./lengthUtils-DL1-FDQQ.js","./sizeVariableUtils-Cmcuvw-4.js","./ViewingMode-Dodu7ZZk.js","./RibbonLine.glsl-BZu1FDpE.js","./dehydratedFeatureUtils-B--Sgpdi.js","./vec42-YcqnINSP.js","./vec4f64-o2zAXfmz.js","./sphere-C77djCO6.js","./plane-IENfwZlB.js","./quatf64-CCm9z-pX.js","./vec2f64-miziP1SN.js","./mathUtils-BG-eq9fO.js","./intersectorUtils-BK9EUwUf.js","./boundedPlane-EV1sS2Ke.js","./lineSegment-D7sKPPYf.js","./verticalOffsetUtils-BDQLpfho.js","./orientedBoundingBox-DOAJUK5g.js","./quat-4pa1e6ds.js","./spatialReferenceEllipsoidUtils-DBE_OFra.js","./ElevationProvider-C95wyCKc.js","./VertexAttribute-Cq4MnHjR.js","./unitConversionUtils-BMfW9yAe.js","./hydratedFeatures-DBKLr8hT.js","./projectVectorToVector-G2uWGoIb.js","./projectPointToVector-GINIbYMz.js","./projection-B971H0Re.js","./Material-_xx7OZxD.js","./interfaces-DDtDqZYj.js","./Texture-Fac_8AOC.js","./BindType-BmZEZMMh.js","./Util-BIfApRF5.js","./Texture-Begq2x5n.js","./enums-D9v74xTE.js","./renderState-DQLu6AJX.js","./Matrix3DrawUniform-CiBFaSz6.js","./vec2-maR1OrZI.js","./ShaderTechniqueConfiguration-CBbn2DCi.js","./triangle-PTGDC_xJ.js","./AlphaCutoff-UcccL64p.js","./requestImageUtils-DgMiQwsm.js","./sdfPrimitives-CUWZbMRe.js","./vec3f32-nZdmKIgz.js","./doublePrecisionUtils-B0owpBza.js","./floatRGBA-CfH_2xsy.js","./Octree-C8d4sqjv.js","./frustum-CQrOepbv.js","./InterleavedLayout-e-di2fxs.js","./BufferView-_QDXRCew.js","./Float4DrawUniform-N58YDhuZ.js","./graphicUtils-CWEFaVJb.js","./VertexColor.glsl-_ARMpsAT.js","./meshVertexSpaceUtils-CXzOFlTI.js","./MeshLocalVertexSpace-LEHwMUnu.js","./triangulationUtils-DWWEtF_0.js","./deduplicate-DIJK2kGw.js","./edgeUtils-BUKTgPFR.js","./DecodeSymbolColor.glsl-BPIX0fAF.js","./OverlayCompositing.glsl-CiE3Tt8y.js","./MergedRenderer-Dli9s1X5.js","./VertexArrayObject-lPxPk5E-.js","./NestedMap-GuqgquCN.js","./glUtil-D0YUa0ow.js","./VertexElementDescriptor-BOD-G50G.js","./signal-D4lghLjV.js","./axisAngleDegrees-Ci2HA7Jo.js","./weather-eV4wTXCK.js","./HighlightDefaults-D4ckYWWJ.js","./BufferObject-BVi1lwBq.js","./Intersector-wXoCuQ8W.js","./Scheduler-CJu5awNf.js","./debugFlags-BF6Z0j0F.js","./Normals-DzBXR8Bg.js","./DefaultMaterial-DgOvtNL9.js","./CIMSymbolHelper-BObHJeub.js","./BidiEngine-DNnuvc1i.js","./fontUtils-BKHqaMFz.js","./OptimizedGeometry-BF8iz5FO.js","./GeometryUtils-Dyjqugo6.js","./enums-CmIX1y88.js","./utils-D2PLyMFF.js","./definitions-DfvbPdMm.js","./mat2d-D9DBP-jx.js","./mat2df32-orApM5a3.js","./vec2f32-BbH2jxlN.js","./Rect-CUzevAry.js","./BoundingBox-CnpCxTZE.js","./defaults-DZ1kfMRx.js","./defaultsJSON-GKolV7NZ.js","./OverrideHelper-ti072FkP.js","./colorUtils-aL8wj-8G.js","./quantizationUtils-uj_P09aO.js","./cimSymbolUtils-DXvZxabN.js","./utils-Ce7L3imC.js","./jsonUtils-CSnQD004.js","./parser-CTsgEym6.js","./utils-93yNk4Xc.js","./mat4f32-DcsiF_Rp.js","./LRUCache-B_PHMSGm.js","./MemCache-Dx1v3xLC.js","./LodRenderer-EVrH9dsH.js","./Intersector-BQ92CPLA.js","./HUDMaterial.glsl-D6WRipwF.js","./line-CML3g7Ng.js","./line-DxZlo8wx.js","./LineMarker.glsl-C-3AQmcq.js","./lineStippleUtils-C89mzWlO.js","./projectVectorToPoint-DcLtSZYw.js","./MeshComponent-C3VFvn4B.js","./imageUtils-CtmzXUTE.js","./meshProperties-C4iW0Ukm.js","./vertexSpaceConversion-CPh5QK5U.js","./vec4-BpYqBTK4.js","./projectMeshVertexPositions-CZFWvOVw.js","./interfaces-DkjgzG8v.js","./resourceUtils-B0XGoEvl.js","./objectResourceUtils-CT1IBonC.js","./devEnvironmentUtils-CnNDiFMM.js","./DefaultMaterial_COLOR_GAMMA-DmJDQQRt.js","./vec33-DUxPafiq.js","./Version-BSlAgupz.js","./DefaultLayouts-BuE1efcQ.js","./RealisticTree.glsl-CAmeC2w1.js","./styleUtils-BYTm14n3.js","./webStyleSymbolUtils-CwdsUGtV.js","./jsonUtils-Ds2Sqto-.js","./layerUtils-BrNoooE9.js","./ColorMaterial.glsl-BF1fDRqL.js","./TriangleMaterial-BiHR3MKx.js","./NormalUtils.glsl-DwmdcsLR.js","./dehydratedFeatures-BiOblf0d.js","./Field-ybkHhtnK.js","./fieldType-BuzM0UHS.js","./featureConversionUtils-D14h8iad.js","./OptimizedFeature-6cJ-QFG5.js","./OptimizedFeatureSet-Blu9Ckm7.js"])))=>i.map(i=>d[i]);
import{n as he}from"./vec2f64-miziP1SN.js";import{p as ve,s as Be,c as Me,g as de,P as Ne,u as Ve,o as qe,E as _e}from"./vec32-Dvg_eL9J.js";import{n as _,s as dt}from"./vec3f64-BLpZdpfb.js";import{O as pt,V as mt}from"./plane-IENfwZlB.js";import{n as ke,aV as yt,aW as ft,L as gt,O as bt,C as vt}from"./subclass-BZA_h8Db.js";import{u as _t,J as St,K as Pt}from"./symbols-CNimns--.js";import{l as ne}from"./Color-BCS62Hs5.js";import{u as Se}from"./screenUtils-_ZIvrt5o.js";import{r as He,s as k,n as Et}from"./vec4f64-o2zAXfmz.js";import{n as Q}from"./mat4-GpOFENPA.js";import{e as We}from"./mat4f64-Dk4dwAN8.js";import{C as Ze}from"./computeTranslationToOriginAndRotation-Q27G6TBL.js";import{n as z}from"./projectBuffer-Bs7GwaPY.js";import{E as Ot,R as Lt,l as xt,f as $t,o as oe,k as Ct,m as R,A as At,n as Qe,q as wt,r as Pe,s as Dt}from"./RibbonLine.glsl-BZu1FDpE.js";import{t as H,n as Ft,d as Tt,e as It}from"./Material-_xx7OZxD.js";import{r as Rt}from"./ElevationProvider-C95wyCKc.js";import"./Indices-DflDlU4Z.js";import{ah as J,g as Gt,b as zt,o as jt,P as Ut,e as X,c as Y,h as Bt,j as Mt,E as Nt,A as K,m as Vt,p as qt}from"./Texture-Fac_8AOC.js";import"./triangle-PTGDC_xJ.js";import{t as Ee,B as kt,p as Ht,r as Wt,g as Zt}from"./renderState-DQLu6AJX.js";import"./vec42-YcqnINSP.js";import{e as y}from"./VertexAttribute-Cq4MnHjR.js";import{r as Qt,g as Jt,A as Xt,B as Yt,b as Je,v as Kt,a3 as er,u as tr,D as rr}from"./Polyline-D9YkgmM_.js";import{E as sr,A as ee,b as Xe,o as ir,d as ar,t as nr}from"./graphicUtils-CWEFaVJb.js";import{c as pe}from"./projectPointToVector-GINIbYMz.js";import{S as or,Z as lr,u as cr,v as ur,q as le,p as hr,R as dr,V as pr,f as mr,L as yr,M as fr,T as gr,w as br}from"./aaBoundingBox-BE7cC1jD.js";import{e as Ye}from"./projectVectorToVector-G2uWGoIb.js";import{t as te}from"./orientedBoundingBox-DOAJUK5g.js";import{t as j}from"./vec2f32-BbH2jxlN.js";import{H as vr}from"./InterleavedLayout-e-di2fxs.js";import{o as Oe,n as Le}from"./Matrix3DrawUniform-CiBFaSz6.js";import{o as xe}from"./AlphaCutoff-UcccL64p.js";import{o as _r,b as Sr,O as Pr,g as Er}from"./VertexColor.glsl-_ARMpsAT.js";import{_ as Ke}from"./index-Bh2oEzTI.js";import{O as $e,R as N}from"./enums-D9v74xTE.js";import{r as x}from"./tslib.es6-B3Jf3DVX.js";import{i as $}from"./ShaderTechniqueConfiguration-CBbn2DCi.js";import{a as et}from"./asyncUtils-CWX51uTe.js";import{c as Or,e as Lr,v as xr,w as $r,s as Ce,u as V,L as Cr,m as Ae}from"./Accessor-BLX9ikPh.js";import{o as we,l as Ar}from"./vec2-maR1OrZI.js";import{s as tt}from"./Point-Cg0-ChZE.js";import{I as wr}from"./dehydratedFeatures-BiOblf0d.js";import{o as Dr}from"./featureConversionUtils-D14h8iad.js";import{U as Fr}from"./sphere-C77djCO6.js";import{A as De,c as Tr}from"./edgeUtils-BUKTgPFR.js";import{l as Ir}from"./ViewingMode-Dodu7ZZk.js";import{n as ce}from"./compilerUtils-Dw3R0f-Z.js";import{m as Rr,k as Gr,j as zr,f as jr,e as Fe,C as Ur,s as Br}from"./sdfPrimitives-CUWZbMRe.js";import{c as Mr,o as Nr,n as Vr}from"./RealisticTree.glsl-CAmeC2w1.js";import{B as qr}from"./DefaultMaterial-DgOvtNL9.js";import"./geometry-D964gYQX.js";import{g as kr,C as Hr}from"./Scheduler-CJu5awNf.js";import"./BindType-BmZEZMMh.js";import{o as w,r as M}from"./interfaces-DDtDqZYj.js";function Wr(s,e,t,r){return s!=null&&(tt(e,r)?(Qt(t,s),!0):(v[0]=s[0],v[1]=s[1],v[2]=0,!!z(v,e,0,v,r,0)&&(t[0]=v[0],t[1]=v[1],v[0]=s[2],v[1]=s[3],v[2]=0,!!z(v,e,0,v,r,0)&&(t[2]=v[0],t[3]=v[1],!0))))}const v=_();function Ti(s,e,t,r){return Xr(s,e,t,Qr(r,e,t,!0))}function Ii(s,e,t,r){const i=Ne(t,Me(s,r,e));return Ve(s,e,de(s,t,i))}const Zr={dir:_(),len:0,clip:he()};function Qr(s,e,t,r){const i=Zr;return s?(t&&r&&(i.len=ve(e,t)),Be(i.dir,s)):(i.len=ve(e,t),Me(i.dir,t,e),de(i.dir,i.dir,1/i.len)),i}function Jr(s,e,t){const r=Ne(pt(s),t.dir),i=-mt(s,e);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const a=i/r;return r>0?a<t.clip[1]&&(t.clip[1]=a):a>t.clip[0]&&(t.clip[0]=a),t.clip[0]<=t.clip[1]}function Xr(s,e,t,r){r.clip[0]=0,r.clip[1]=t?r.len:Number.MAX_VALUE;for(let i=0;i<s.length;i++)if(!Jr(s[i],e,r))return!1;return!0}var I,D;(function(s){s[s.USER=1]="USER",s[s.SCALE_RANGE=2]="SCALE_RANGE",s[s.FILTER=4]="FILTER",s[s.DECONFLICTION=8]="DECONFLICTION",s[s.ALL_GRAPHIC=15]="ALL_GRAPHIC",s[s.ALL_LABEL=255]="ALL_LABEL"})(I||(I={})),function(s){s[s.GRAPHIC=1]="GRAPHIC",s[s.LABEL=16]="LABEL"}(D||(D={}));function rt(s){return s.mapPositions!=null}function Ri(s,e,t,r,i){const a=s.stageObject,n=a.geometries;let o=0;for(const u of n){if(!rt(u))continue;const{update:l,averageGeometrySampledElevation:c}=it(u,e,t,r,i);o+=c,l&&a.geometryVertexAttributeUpdated(u,y.POSITION)}return o/n.length}function Yr(s,e,t,r,i,a){const n=s.stageObject,o=e.centerPointInElevationSR;let u=0;n.usesVerticalDistanceToGround?(r(o,b),Ot(n,b.verticalDistanceToGround),u=b.sampledElevation):(r(o,b),e.mode!=="absolute-height"&&(u=b.sampledElevation));const l=Q(Kr,a??n.transformation),c=qe(st,l[12],l[13],l[14]);H.TESTS_DISABLE_OPTIMIZATIONS?(g[0]=o.x,g[1]=o.y,g[2]=b.z,Ze(o.spatialReference,g,l,i.spatialReference)&&(a?Q(a,l):n.transformation=l)):i.setAltitudeOfTransformation(b.z,l);const h=me/i.unitInMeters;return(Math.abs(l[12]-c[0])>=h||Math.abs(l[13]-c[1])>=h||Math.abs(l[14]-c[2])>=h)&&(a?Q(a,l):n.transformation=l),u}const Kr=We();function Gi(s,e,t,r,i){const a=s.graphics3DSymbolLayer.lodRenderer;if(a==null)return 0;const n=e.centerPointInElevationSR;r(n,b);const o=e.mode!=="absolute-height"?b.sampledElevation:0,u=a.instanceData,l=s.instanceIndex,c=es;u.getGlobalTransform(l,c);const h=qe(st,c[12],c[13],c[14]);H.TESTS_DISABLE_OPTIMIZATIONS?(g[0]=n.x,g[1]=n.y,g[2]=b.z,Ze(n.spatialReference,g,c,i.spatialReference)&&u.setGlobalTransform(l,c)):i.setAltitudeOfTransformation(b.z,c);const m=me/i.unitInMeters;return(H.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(c[12]-h[0])>=m||Math.abs(c[13]-h[1])>=m||Math.abs(c[14]-h[2])>=m)&&u.setGlobalTransform(l,c),o}function zi(s,e,t,r,i){const a=s.stageObject,n=a.geometries;if(n.length===0)return 0;let o=0,u=null,l=0,c=!1;for(const h of n){if(!rt(h))continue;const m=h.attributes.get(y.POSITION);if(m!==u){const{update:d,averageGeometrySampledElevation:B}=it(h,e,t,r,i);l=B,u=m,c=d}c&&a.geometryVertexAttributeUpdated(h,y.POSITION),o+=l}return o/n.length}const me=.01,g=_(),S=_(),U=_(),es=We(),st=_(),b=new Lt;function it(s,e,t,r,i){let a=!1;const n=s.transformation,o=e.requiresSampledElevationInfo;S[0]=n[12],S[1]=n[13],S[2]=n[14],s.invalidateBoundingInfo();const u=s.getMutableAttribute(y.POSITION),l=u.data,c=u.size,h=l.length/c,m=new Rt(s.mapPositions,t);let d=0,B=0;for(let be=0;be<h;be++){if(U[0]=l[d],U[1]=l[d+1],U[2]=l[d+2],r(m,b),o&&(B+=b.sampledElevation),H.TESTS_DISABLE_OPTIMIZATIONS)l[d]=m.array[m.offset],l[d+1]=m.array[m.offset+1],l[d+2]=b.z,z(l,t,d,l,i.spatialReference,d,1),l[d]-=S[0],l[d+1]-=S[1],l[d+2]-=S[2],a=!0;else{g[0]=l[d]+S[0],g[1]=l[d+1]+S[1],g[2]=l[d+2]+S[2],i.setAltitude(g,b.z),l[d]=g[0]-S[0],l[d+1]=g[1]-S[1],l[d+2]=g[2]-S[2];const Z=me/i.unitInMeters;(Math.abs(U[0]-l[d])>=Z||Math.abs(U[1]-l[d+1])>=Z||Math.abs(U[2]-l[d+2])>=Z)&&(a=!0)}d+=c,m.offset+=3}return B/=h,{update:a,averageGeometrySampledElevation:B}}let ts=class{constructor(e,t,r){this.graphic=e,this.renderingInfo=t,this.layer=r}};class Ui{constructor(e,t,r){this.baseMaterial=e,this.edgeMaterial=t,this.hasSlicePlane=r}}let at=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,t,r,i,a,n,o,u=null){this.graphics3DSymbolLayer=e,this.stageObject=t,this._uniqueGeometries=r,this._uniqueMaterials=i,this._sharedResource=a,this.elevationAligner=n,this.elevationContext=o,this._edgeState=u,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const t=e.stage;t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){var t,r;if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),(t=e.renderer.edgeView)==null||t.removeObject(this.stageObject),this.stageObject.dispose(),(r=this._sharedResource)==null||r.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,t){const{stageObject:r,_edgeState:i,_stageLayer:a}=this;if(i==null)return;const n=Te(i.baseMaterial);i.edgeMaterial.objectTransparency!==n&&(i.edgeMaterial.objectTransparency=n,this.resetEdgeObject(t)),a.stage.renderer.withEdgeView(o=>o.updateAllComponentOpacities(r,[e]))}slicePlaneEnabledChanged(e,t){const{stageObject:r,_edgeState:i,_stageLayer:a}=this;i!=null&&a.stage.renderer.withEdgeView(n=>{n.updateAllComponentMaterials(r,i.edgeMaterial,e,!t),i.hasSlicePlane=e})}setVisibility(e){const{_edgeState:t,stageObject:r,_stageLayer:i}=this;i!=null&&this.visible!==e&&(this._visible=e,r.visible=e,e&&!this._addedToStage&&(i.add(r),this._addedToStage=!0),t!=null&&i.stage.renderer.withEdgeView(a=>{a.hasObject(r)?a.updateObjectVisibility(r,e):e&&this._addOrUpdateEdgeObject(t,a,!1)}))}get visible(){return this._visible}alignWithElevation(e,t,r,i){if(this.elevationAligner==null)return;r!=null&&xt(this.elevationContext.featureExpressionInfoContext,r);const a=(n,o)=>$t(n,e,this.elevationContext,t,o);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,a,t),this.resetEdgeObject(i)}alignWithAbsoluteElevation(e,t,r){const i=(a,n)=>{n.sampledElevation=e,n.verticalDistanceToGround=0,n.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,i,t),this.resetEdgeObject(r)}getCenterObjectSpace(e=_()){return Be(e,Fr(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(e=cr()){const t=this.stageObject.boundingVolumeObjectSpace;return or(e,t.min),lr(e,t.max),e}computeAttachmentOrigin(e){const t=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(O)&&(_e(O,O,t),Ve(e.render.origin,e.render.origin,O),e.render.num++)}async getProjectedBoundingBox(e,t,r,i,a){const n=this.getBoundingBoxObjectSpace(a),o=rs,u=ur(n)?1:o.length;for(let c=0;c<u;c++){const h=o[c];C[0]=n[h[0]],C[1]=n[h[1]],C[2]=n[h[2]],_e(C,C,this.stageObject.transformation),T[3*c]=C[0],T[3*c+1]=C[1],T[3*c+2]=C[2]}if(!e(T,0,u))return null;le(n);let l=null;this.calculateRelativeScreenBounds&&(l=this.calculateRelativeScreenBounds());for(let c=0;c<3*u;c+=3){for(let h=0;h<3;h++)n[h]=Math.min(n[h],T[c+h]),n[h+3]=Math.max(n[h+3],T[c+h]);l&&r.push({location:T.slice(c,c+3),screenSpaceBoundingRect:l})}if(t!=null&&t.service&&this.elevationContext.mode!=="absolute-height"){hr(n,O);const c=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let h=0;if(t.useViewElevation)h=t.service.getElevation(O[0],O[1],c)??0;else try{const m=sr(n,t.service.spatialReference,t);h=await t.service.queryElevation(O[0],O[1],i,m,c)??0}catch{}dr(n,0,0,-this.alignedSampledElevation+h)}return n}addObjectState(e){e.stateType===Ee.Highlight&&e.addObject(this.stageObject,this.stageObject.highlight(e.highlightGroupName)),e.stateType===Ee.MaskOccludee&&e.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeByObject(this.stageObject)}resetEdgeObject(e){const{_edgeState:t,stageObject:r,_stageLayer:i,_visible:a}=this;t!=null&&i.stage.renderer.withEdgeView(n=>{a?this._addOrUpdateEdgeObject(t,n,e):n.removeObject(r)})}_addOrUpdateEdgeObject(e,t,r){const i=Te(e.baseMaterial);e.edgeMaterial.objectTransparency=i,t.addOrUpdateObject3D(this.stageObject,e.edgeMaterial,e.hasSlicePlane,!r).then(()=>{var a;return(a=this._stageLayer)==null?void 0:a.sync()})}};function Te(s){return s.parameters.transparent?De.TRANSPARENT:De.OPAQUE}const T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C=_(),O=_(),rs=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let ss=class{constructor(e,t=null){this.labelText=t,this.elevationOffset=e??0}};const is=3,as=3,ns=10;function Ni(s){switch(s){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function os(s,e){const t=(r,i,a=!1)=>new Mr(r.map(n=>{const o=i(n.tesselation);return a&&Rr(o),new Nr([new Vr(o)],n.minScreenSpaceRadius)}));switch(s){case"sphere":return t([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>Br(e,.5,r,!0));case"cube":return t([{tesselation:0,minScreenSpaceRadius:0}],()=>Ur(e,1));case"cone":return t(re,r=>Fe(e,1,.5,r,!1),!0);case"inverted-cone":return t(re,r=>Fe(e,1,.5,r,!0),!0);case"cylinder":return t(re,r=>jr(e,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return t([{tesselation:0,minScreenSpaceRadius:0}],()=>zr(e,1),!0);case"diamond":return t([{tesselation:0,minScreenSpaceRadius:0}],()=>Gr(e,1),!0);default:return}}const re=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let E=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new nt}},ye=class extends E{constructor(e){super(e),this.estimated=!0}},ls=class extends E{constructor(e,t){super(t),this.numComplexities=e}},cs=class extends ye{constructor(e,t){super(t),this.numComplexities=e}},nt=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};const ot=new ye({});function Zi(s){return s.type==="web-style"?ot:fe(s.symbolLayers.toArray().map(e=>lt(s,e)))}function fe(s){let e=0,t=0,r=0,i=!1,a=0;const n=new nt;for(const o of s)o!=null&&(e+=o.verticesPerFeature,t+=o.verticesPerCoordinate,r+=o.drawCallsPerFeature,n.bytesPerFeature+=o.memory.bytesPerFeature,n.bytesPerFeatureLabel+=o.memory.bytesPerFeatureLabel,n.resourceBytes+=o.memory.resourceBytes,n.draped.bytesPerFeature+=o.memory.bytesPerFeature,n.draped.bytesPerFeatureLabel+=o.memory.bytesPerFeatureLabel,i=i||o.estimated,++a);return i?new cs(a,{verticesPerFeature:e,verticesPerCoordinate:t,drawCallsPerFeature:r,memory:n}):new ls(a,{verticesPerFeature:e,verticesPerCoordinate:t,drawCallsPerFeature:r,memory:n})}function Qi(s){const e=fe(s);return e.numComplexities>0&&(e.verticesPerFeature/=e.numComplexities,e.verticesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities),e}const se={};function lt(s,e){var i,a;const t=us(s,e),r=Tr(e)?2:0;switch(e.type){case"extrude":return new E({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:r,memory:t});case"fill":if(s.type==="mesh-3d")return new E({drawCallsPerFeature:r,memory:t});if(e.outline!=null&&e.outline.size>0)return new E({verticesPerFeature:-12,verticesPerCoordinate:9,memory:t});case"water":return new E({verticesPerFeature:-6,verticesPerCoordinate:3,memory:t});case"line":return new E({verticesPerFeature:-6,verticesPerCoordinate:6,memory:t});case"object":return(i=e.resource)!=null&&i.href?new ye({verticesPerFeature:100,memory:t}):{...hs(((a=e.resource)==null?void 0:a.primitive)??_t),memory:t};case"path":{let n=0,o=0;switch(e.profile){case"circle":n=ns;break;case"quad":n=4;break;default:return void ce(e.profile)}switch(e.join){case"round":o=is;break;case"miter":case"bevel":o=1;break;default:return}const u=2*n,l=n*o*2,c=l+u;let h=-2*l-u;switch(e.cap){case"none":break;case"butt":case"square":h+=2*(n-1);break;case"round":h+=2*(n*(as-1)*2+n);break;default:return}return new E({verticesPerFeature:h,verticesPerCoordinate:c,memory:t})}case"text":case"icon":return new E({verticesPerFeature:6,memory:t});default:return}}function us(s,e){const t=s.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?f.EXTRUDE_EDGES:f.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?f.FILL_OUTLINE:f.FILL;case"water":return f.FILL;case"line":return e.join==="round"?f.LINE_ROUND:f.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return f.PATH_ROUND_CIRCLE;case"quad":return f.PATH_ROUND_QUAD;default:return void ce(e.profile)}case"miter":case"bevel":switch(e.profile){case"circle":return f.PATH_MITER_CIRCLE;case"quad":return f.PATH_MITER_QUAD;default:return void ce(e.profile)}default:return}case"object":return t?f.OBJECT_POINT:f.OBJECT_POLYGON;case"icon":case"text":return t?f.ICON_POINT:f.ICON_POLYGON;default:return}}function hs(s){const e=se[s];if(e)return e;const t=ds(os(s,new qr({},{spherical:!0,doublePrecisionRequiresObfuscation:!0})).levels);return se[s]=new E({verticesPerFeature:t}),se[s]}function ds(s){return s.reduce((e,t,r)=>e+t.numVertices*(1/10**r),0)/s.reduce((e,t,r)=>e+1/10**r,0)}const f={ICON_POINT:{bytesPerFeature:2346.460896195398,bytesPerFeatureLabel:3484.7516349999996,resourceBytes:0,draped:{bytesPerFeature:2007.3528529826217,bytesPerFeatureLabel:3522.702025}},ICON_POLYGON:{bytesPerFeature:3677.214053765355,bytesPerFeatureLabel:3502.5355950000003,resourceBytes:0,draped:{bytesPerFeature:3030.3700096053935,bytesPerFeatureLabel:3550.247175}},OBJECT_POINT:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992,resourceBytes:0,draped:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992}},OBJECT_POLYGON:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001,resourceBytes:0,draped:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001}},LINE_MITER:{bytesPerFeature:3252.89170349711,bytesPerFeatureLabel:3554.3931949999997,resourceBytes:0,draped:{bytesPerFeature:2843.5793737736867,bytesPerFeatureLabel:3538.2547083333334}},LINE_ROUND:{bytesPerFeature:3384.080501909172,bytesPerFeatureLabel:3522.6055950000004,resourceBytes:0,draped:{bytesPerFeature:2833.1897218657587,bytesPerFeatureLabel:3532.0680950000005}},PATH_MITER_CIRCLE:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998,resourceBytes:0,draped:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998}},PATH_ROUND_CIRCLE:{bytesPerFeature:42934.88589895749,bytesPerFeatureLabel:3729.49955,resourceBytes:0,draped:{bytesPerFeature:42934.88589895749,bytesPerFeatureLabel:3729.49955}},PATH_MITER_QUAD:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925,resourceBytes:0,draped:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925}},PATH_ROUND_QUAD:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997,resourceBytes:0,draped:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997}},FILL:{bytesPerFeature:3419.9079008788176,bytesPerFeatureLabel:3564.2132483333335,resourceBytes:0,draped:{bytesPerFeature:2910.096178654882,bytesPerFeatureLabel:3554.8655816666665}},FILL_OUTLINE:{bytesPerFeature:5018.088812445781,bytesPerFeatureLabel:3524.8219616666665,resourceBytes:0,draped:{bytesPerFeature:4278.49006198517,bytesPerFeatureLabel:3532.068368333334}},EXTRUDE:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005,resourceBytes:0,draped:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005}},EXTRUDE_EDGES:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337,resourceBytes:0,draped:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337}}};var G;(function(s){s[s.RecreateSymbol=0]="RecreateSymbol",s[s.RecreateGraphics=1]="RecreateGraphics",s[s.FastUpdate=2]="FastUpdate"})(G||(G={}));let ge=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=P.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,t){return this._loadStatus===P.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===P.FAILED?(t&&t(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=P.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=P.FAILED,!Or(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(e,t).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=Lr(this._abortController):this._loadStatus===P.LOADING&&(this._loadStatus=P.FAILED),this._loader=null}};var P;(function(s){s[s.LOADING=0]="LOADING",s[s.LOADED=1]="LOADED",s[s.FAILED=2]="FAILED"})(P||(P={}));const A=()=>ke.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class ps extends ge{constructor(e,t,r,i){super(r.schedule),this.symbol=e,this.symbolLayer=t,this._context=r,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1},this._materials=[],this.usedMemory=0,this.logger=A(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=i.renderPriority,this._renderPriorityStep=i.renderPriorityStep,this._elevationContext=new oe,this.complexity=this.computeComplexity(),this.ignoreDrivers=i.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=Ie(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const t=this._drivenProperties,r=Ie(e);return r.color!==t.color||r.opacity!==t.opacity||r.opacityAlwaysOpaque!==t.opacityAlwaysOpaque||r.size!==t.size||r.rotation!==t.rotation}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,t,r,i){const a=e.projectionSuccess,n="polygons"in e?e.polygons:null,o=`${i} geometry failed to be created`;a?!this._logGeometryValidationWarnings(t,r,i)&&n&&n.length===0&&r==="rings"&&t.length>0&&t[0].length>2&&A().warnOncePerTick(`${o} (filled rings should use clockwise winding - try reversing the order of vertices)`):A().warnOncePerTick(`${o} (failed to project geometry to view spatial reference)`)}_logGeometryValidationWarnings(e,t,r){const i=`${r} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(A().warnOncePerTick(`${i} (no ${t} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(A().warnOncePerTick(`${i} (${t} should be defined as a 2D array)`),!0)}_validateGeometry(e,t=null,r=null){if(t!=null&&!t.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;switch(e.type){case"point":{const i=e;if(!isFinite(i.x)||!isFinite(i.y))return A().warn("point coordinate is not a valid number, graphic skipped"),!1;break}case"polygon":Jt(e)&&A().warnOncePerTick("Fixed a non-closed polygon ring.")}return!0}_defaultElevationInfoNoZ(){return ms}_defaultElevationInfoZ(){return ys}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,t=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||t.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,t=new oe){const r=e.geometry,i=this.getDefaultElevationInfo(r);t.unit=this._elevationContext.unit!=null?this._elevationContext.unit:i.unit,t.mode=this.getGeometryElevationMode(r,i),t.offsetMeters=this._elevationContext.meterUnitOffset??i.offset??0;const a=!this._elevationOptions.supportsOnTheGround&&t.mode==="on-the-ground";a&&(t.mode="relative-to-ground",t.offsetMeters=0);const n=a?Ct:this._elevationContext.featureExpressionInfoContext;return t.updateFeatureExpressionInfoContext(n,e,this._context.layer),t}prepareSymbolLayerPatch(e){}updateGeometry(e,t){return!1}updateTransform(e,t,r,i){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,t=Re){const r=this.draped?1:this._getLayerOpacity();return this._drivenProperties.opacity?r:e?r*e.a:t.hasIntrinsicColor?r:0}_getCombinedOpacityAndColor(e,t=Re){const r=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return ee(null,r);const i=e!=null?ne.toUnitRGB(e):dt;return ee(i,r)}_getVertexOpacityAndColor(e,t=null){const r=this._drivenProperties.color?e.color:null,i=this._drivenProperties.opacity?e.opacity:null,a=ee(r,i);return t&&(a[0]*=t,a[1]*=t,a[2]*=t,a[3]*=t),a}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return lt(this.symbol,this.symbolLayer)}globalPropertyChanged(e,t,r){switch(e){case"opacity":return this.layerOpacityChanged(t,r),!0;case"elevationInfo":{const i=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,r,i)!==R.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,t,r){let i=R.UPDATE;return e.forEach(a=>{const n=t(a);if(n!=null){const o=a.graphic;this.setGraphicElevationContext(o,n.elevationContext),n.needsElevationUpdates=r(n.elevationContext.mode)}else i=R.RECREATE}),i}applyRendererDiff(e,t){return G.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const t=this._fastUpdates.visualVariables,r=t.size?J(t.size.field,e):0,i=t.color?J(t.color.field,e):0,a=t.opacity?J(t.opacity.field,e):0;return He(r,i,a,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&A().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var t,r,i,a,n,o,u,l;return{size:((r=(t=this._fastUpdates)==null?void 0:t.visualVariables.size)==null?void 0:r.field)??null,color:((a=(i=this._fastUpdates)==null?void 0:i.visualVariables.color)==null?void 0:a.field)??null,opacity:((o=(n=this._fastUpdates)==null?void 0:n.visualVariables.opacity)==null?void 0:o.field)??null,rotation:((l=(u=this._fastUpdates)==null?void 0:u.visualVariables.rotation)==null?void 0:l.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}}function Ie(s){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1};return s&&"visualVariables"in s&&s.visualVariables&&s.visualVariables.forEach(t=>{switch(t.type){case"color":if(e.color=!0,t.stops)for(let r=0;r<t.stops.length;r++){const i=t.stops[r].color;i&&(e.opacity=!0,i.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0;break;case"rotation":e.rotation=!0}}),e}const ms={mode:"on-the-ground",offset:0,unit:"meters"},ys={mode:"absolute-height",offset:0,unit:"meters"},Re={hasIntrinsicColor:!1};function fs(s,e,t,r,i){if(ct(s,e))return null;t.localOrigin=bs(s,e);const a=new At({geometries:[t],castShadow:!1,layerUid:s.layer.uid,graphicUid:i,usesVerticalDistanceToGround:!0});return{object:a,sampledElevation:Qe(a,e,s.elevationProvider,s.renderCoordsHelper,r)}}function Xi(s,e,t,r){return ct(e,t)?null:Qe(s,t,e.elevationProvider,e.renderCoordsHelper,r)}function ct(s,e){const t=s.clippingExtent;return!!t&&(pe(e,F,s.elevationProvider.spatialReference),!pr(t,F))}function gs(s,e,t){const r=s.elevationContext,i=t.spatialReference;pe(e,F,i),r.centerPointInElevationSR=Ye(F[0],F[1],e.hasZ?F[2]:0,i??null)}function Yi(s){switch(s.type){case"point":return s;case"polygon":case"extent":return Xe(s);case"polyline":{const e=s.paths[0];if(!e||e.length===0)return null;const t=Xt(e,Yt(e)/2);return Ye(t[0],t[1],t[2],s.spatialReference)}case"mesh":return s.extent.center}return null}function bs(s,e){return pe(e,F,s.renderCoordsHelper.spatialReference),s.localOriginFactory.getOrigin(F)}const F=_();function vs(s){s.include(Gt),s.uniforms.add(new zt("geometryDepthTexture",(e,t)=>{var r;return(r=t.geometryDepth)==null?void 0:r.attachment})),s.code.add(w`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);
return (elementDepth < (geometryDepth - 1.0));
}`)}function ut(s){const e=new jt,{vertex:t,fragment:r}=e,{terrainDepthTest:i}=s;return t.include(ir),e.include(ar,s),e.include(Ut,s),e.attributes.add(y.UV0,"vec2"),t.uniforms.add(new X("viewport",(a,n)=>n.camera.fullViewport),new Oe("lineSize",(a,n)=>a.size>0?Math.max(1,a.size)*n.camera.pixelRatio:0),new Y("pixelToNDC",(a,n)=>we(Ge,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Oe("borderSize",(a,n)=>a.borderColor?n.camera.pixelRatio:0),new Y("screenOffset",(a,n)=>we(Ge,a.horizontalScreenOffset*n.camera.pixelRatio,0))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),i&&e.varyings.add("depth","float"),s.occlusionTestEnabled&&e.include(nr),s.hasScreenSizePerspective&&_r(t),t.main.add(w`
    ProjectHUDAux projectAux;
    vec4 endPoint = projectPositionHUD(projectAux);

    vec3 vpos = projectAux.posModel;
    if (rejectBySlice(vpos)) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    }
    ${M(s.occlusionTestEnabled,w`if (!testHUDVisibility(endPoint)) {
             gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
             return;
           }`)}

    ${s.hasScreenSizePerspective?w`vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
               vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);`:"vec2 screenOffsetScaled = screenOffset;"}
    // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
    // correct depth value
    vec3 posView = (view * vec4(position, 1.0)).xyz;
    ${M(i,"depth = posView.z;")}

    applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
    vec4 startPoint = proj * vec4(posView, 1.0);

    // Apply screen offset to both start and end point
    vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
    startPoint.xy += screenOffsetNorm * startPoint.w;
    endPoint.xy += screenOffsetNorm * endPoint.w;

    // Align start and end to pixel origin
    vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
    vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${M(s.hudDepth,s.hudDepthAlignStart?"endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);":"startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);")}
    vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);

    // The direction of the line in screen space
    vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
    vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${s.hasScreenSizePerspective?w`float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
               float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);`:w`float lineSizeScaled = lineSize;
               float borderSizeScaled = borderSize;`}
    float halfPixelSize = lineSizeScaled * 0.5;

    // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
    float padding = 1.0 + borderSizeScaled;
    vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

    // Offset x/y from the center of the line in screen space
    projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

    // Compute a coverage varying which we can use in the fragment shader to determine
    // how much a pixel is actually covered by the line (i.e. to anti alias the line).
    // This works by computing two coordinates that can be linearly interpolated and then
    // subtracted to find out how far away from the line edge we are.
    float edgeDirection = (uv0.x * 2.0 - 1.0);

    float halfBorderSize = 0.5 * borderSizeScaled;
    float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
    float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

    float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

    coverageSampling = vec4(
      // Edge coordinate
      outerEdgeCoverageSampler,

      // Border edge coordinate
      outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

      // Line offset
      halfPixelSize - 0.5,

      // Border offset
      halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
    );

    lineSizes = vec2(lineSizeScaled, borderSizeScaled);
    gl_Position = projectedPosition;`),r.uniforms.add(new X("uColor",a=>a.color??k),new X("borderColor",a=>a.borderColor??k)),i&&(r.include(vs,s),r.uniforms.add(new Y("inverseViewport",(a,n)=>n.inverseViewport))),r.main.add(w`
    ${M(i,"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }")}

    vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

    float borderAlpha = uColor.a * borderColor.a * coverage.y;
    float colorAlpha = uColor.a * coverage.x;

    float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);
    ${M(!s.hudDepth,w`vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
           fragColor = vec4(finalRgb, finalAlpha);`)}`),e}const Ge=he(),_s=Object.freeze(Object.defineProperty({__proto__:null,build:ut},Symbol.toStringTag,{value:"Module"}));class Ss extends Bt{constructor(e,t,r){super(e,t,new Mt(_s,()=>Ke(()=>Promise.resolve().then(()=>Fs),void 0,import.meta.url)),r)}initializePipeline(e){const t={func:e.terrainDepthTest?$e.ALWAYS:$e.LESS};return kt(e.hudDepth?{depthTest:t,depthWrite:Ht}:{blending:Wt(N.ONE,N.SRC_ALPHA,N.ONE_MINUS_SRC_ALPHA,N.ONE_MINUS_SRC_ALPHA),depthTest:t,colorWrite:Zt})}}let L=class extends Nt{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hudDepth=!1,this.hudDepthAlignStart=!1,this.hasSlicePlane=!1,this.terrainDepthTest=!1,this.hasSliceInVertexProgram=!0,this.draped=!1}};x([$()],L.prototype,"screenCenterOffsetUnitsEnabled",void 0),x([$()],L.prototype,"occlusionTestEnabled",void 0),x([$()],L.prototype,"hasVerticalOffset",void 0),x([$()],L.prototype,"hasScreenSizePerspective",void 0),x([$()],L.prototype,"hudDepth",void 0),x([$()],L.prototype,"hudDepthAlignStart",void 0),x([$()],L.prototype,"hasSlicePlane",void 0),x([$()],L.prototype,"terrainDepthTest",void 0);class ie extends Ft{constructor(e,t){super(e,ht),this.produces=new Map([[K.LINE_CALLOUTS,r=>r===Le.Color],[K.LINE_CALLOUTS_HUD_DEPTH,r=>r===Le.Color]]),this._configuration=new L(t),this._uniqueMaterialIdentifier=ue(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,t){const r=t.slot===K.LINE_CALLOUTS_HUD_DEPTH;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hudDepth=r,this._configuration.hudDepthAlignStart=!!this.parameters.hudDepthAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration}get visible(){var e;return this.parameters.color[3]>=xe||(((e=this.parameters.borderColor)==null?void 0:e[3])??0)>=xe}intersect(){}createGLMaterial(e){return new Ps(e)}createBufferWriter(){return new Os}validateParameters(e){this._uniqueMaterialIdentifier=ue(e)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}}function ue({renderOccluded:s,isDecoration:e,horizontalScreenOffset:t,color:r,size:i,occlusionTest:a,shaderPolygonOffset:n,hudDepthAlignStart:o,centerOffsetUnits:u,hasSlicePlane:l,screenSizePerspective:c,verticalOffset:h,borderColor:m}){return yt`${s}:${e}:${t}:[${r}]:${i}:${a}:${n}:${o}:${u}:${l}:${c!=null}:{${h.screenLength}:${h.minWorldLength}:${h.maxWorldLength}}:[${m}]`}let Ps=class extends Vt{beginSlot(e){return this.acquireTechnique(Ss,e)}};class ht extends Tt{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=He(0,0,0,1),this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.hudDepthAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const Es=vr().vec3f(y.POSITION).vec3f(y.NORMAL).vec2f(y.UV0).vec4f(y.CENTEROFFSETANDDISTANCE),ze=[j(0,0),j(1,0),j(0,1),j(1,0),j(1,1),j(0,1)];class Os{constructor(){this.vertexBufferLayout=Es}elementCount(e){return 6*e.get(y.POSITION).indices.length}write(e,t,r,i,a,n){Sr(r.get(y.POSITION),e,a.position,n,6),Pr(r.get(y.NORMAL),t,a.normal,n,6),Er(r.get(y.CENTEROFFSETANDDISTANCE),a.centerOffsetAndDistance,n,6);for(let o=0;o<ze.length;++o)a.uv0.setVec(n+o,ze[o])}}class W extends ps{constructor(e,t){super(e,null,t,$s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new ie(this._materialParameters,this._context.spherical),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){const t=this._materialParameters;return t.horizontalScreenOffset=e.horizontalScreenOffset??0,t.centerOffsetUnits=e.centerOffsetUnits||"world",t}get _materialParameters(){var n;const e=new ht,t=this.symbol,r=t.callout;if(r.color){const o=ne.toUnitRGBA(r.color);o[3]*=this._getLayerOpacity(),e.color=o}else e.color=k;if(e.size=Se(r.size||0),t.verticalOffset){const{screenLength:o,minWorldLength:u,maxWorldLength:l}=t.verticalOffset;e.verticalOffset={screenLength:Se(o),minWorldLength:u||0,maxWorldLength:l??1/0}}e.borderColor=((n=r.border)==null?void 0:n.color)!=null?ne.toUnitRGBA(r.border.color):null;const i=t.symbolLayers.at(0).type==="object",a=t.type==="label-3d";return e.occlusionTest=!i,e.shaderPolygonOffset=i?0:void 0,e.hudDepthAlignStart=a,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return xs}createGraphics3DGraphic(e){const t=e.renderingInfo,r=e.graphic,i=this.setGraphicElevationContext(r,new oe,t.elevationOffset||0),a=t.symbol,n=this._elevationContext.mode==="on-the-ground"&&(a.type==="cim"||!a.symbolLayers.some(u=>u.type==="object"||u.type==="text"));if(a.type!=="label-3d"&&n||a.type==="point-3d"&&a.symbolLayers.every(u=>u.type==="text"&&!St(u)))return null;const o=Xe(r.geometry);return o==null?null:this._createAs3DShape(o,i,t,r.uid)}layerOpacityChanged(){var e;(e=this._materials[0])==null||e.setParameters(this._materialParameters)}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,a=wt(W.elevationModeChangeTypes,r,i);return a!==R.UPDATE||e.forEach(n=>{const o=t(n);o!=null&&this.updateGraphicElevationContext(n.graphic,o)}),a}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,t,r=0){return super.setGraphicElevationContext(e,t),t.addOffsetRenderUnits(r),t}updateGraphicElevationContext(e,t){this.setGraphicElevationContext(e,t.elevationContext,t.metadata!=null?t.metadata.elevationOffset:0),t.needsElevationUpdates=Pe(t.elevationContext.mode)}computeComplexity(){return new E({verticesPerFeature:6})}_getOrCreateMaterial(e){var i;const t=this._perInstanceMaterialParameters(e),r=ue(t);if(r===((i=this._materials[0])==null?void 0:i.uniqueMaterialIdentifier))return{material:this._materials[0],isUnique:!1};if(e.materialCollection!=null){let a=e.materialCollection.get(r);return a==null&&(a=new ie(t,this._context.spherical),e.materialCollection.add(r,a)),{material:a,isUnique:!1}}return{material:new ie(t,this._context.spherical),isUnique:!0}}_createAs3DShape(e,t,r,i){const a=this._context.layer.uid,n=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:a}),o=this._getOrCreateMaterial(r),u=new qt(o.material,Ls(r),null,It.Point,n),l=fs(this._context,e,u,t,i);if(l==null)return null;const c=new at(this,l.object,[u],o.isUnique?[o.material]:null,null,Yr,t);return c.metadata=new ss(r.elevationOffset),c.alignedSampledElevation=l.sampledElevation,c.needsElevationUpdates=Pe(t.mode),gs(c,e,this._context.elevationProvider),c}}function Ls(s){const{translation:e,centerOffset:t}=s,r=new te(e?[e[0],e[1],e[2]]:[0,0,0],ae,3,!0),i=new te(t?[t[0],t[1],t[2],t[3]]:[0,0,0,1],ae,4,!0);return[[y.POSITION,r],[y.NORMAL,new te([0,0,1],ae,3,!0)],[y.CENTEROFFSETANDDISTANCE,i]]}W.elevationModeChangeTypes={definedChanged:R.UPDATE,staysOnTheGround:R.UPDATE,onTheGroundChanged:R.RECREATE};const ae=[0],xs={mode:"relative-to-ground",offset:0},$s={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let ta=class{constructor(e,t,r=_(),i=Et(),a=0,n="world",o=0,u=null){this.renderer=e,this.symbol=t,this.translation=r,this.centerOffset=i,this.horizontalScreenOffset=a,this.centerOffsetUnits=n,this.elevationOffset=o,this.materialCollection=u}};class sa extends ts{}const je=()=>ke.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function ia(s,e){if(!Pt(s))return je().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${s.type}' does not support callouts`),null;if(!s.callout)return null;const t=Cs[s.callout.type];return t?new t(s,e):(je().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${s.callout.type}`),null)}const Cs={line:W},Ue=new xr(Array,s=>mr(s,yr),null,10,5),As=Je();class ws{get labelLayers(){return this._labelLayers||ft}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e==null?void 0:e.isElevationSource)}constructor(e,t,r,i,a){this.graphic=e,this.graphics3DSymbol=t,this.layers=r,this._visibleFlags=I.ALL_LABEL,this.deconflictionPriority=0,++t.referenced,this._featureExpressionFeature=a?Dt(a,e,i):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(t=>{t.initialize(e),t.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,t){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(t),e.setVisibility(this.isVisible(D.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(t=>{t.type==="draped"&&(e=!0)}),e}isVisible(e=D.GRAPHIC,t){const r=t?this._visibleFlags|t|D.LABEL*t:this._visibleFlags;return e===D.GRAPHIC?(r&I.ALL_GRAPHIC)===I.ALL_GRAPHIC:(r&I.ALL_LABEL)===I.ALL_LABEL}setVisibilityFlag(e,t,r){const i=this.isVisible(e);r?this._visibleFlags|=e*t:this._visibleFlags&=~(e*t);const a=this.isVisible(e);if(i===a)return!1;if(e===D.LABEL)this._forEachLabelGraphic(n=>n.setVisibility(a));else{this._forEachSymbolLayerGraphic(o=>o.setVisibility(a));const n=this.isVisible(D.LABEL);this._forEachLabelGraphic(o=>o.setVisibility(n))}return!0}getVisibilityFlag(e,t){return!!(this._visibleFlags&e*t)}computeExtent(e){if(!this._extent){const t=this.graphic.geometry;if(t==null)return!1;this._extent=Je(),wr(t,this._extent);const r=t.spatialReference;if(!tt(r,e)&&!Wr(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,t){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,t,r){let i=e.geometry;return i.type!=="mesh"&&i.type!=="extent"||(i=Kt.fromExtent(i.type==="mesh"?i.extent:i)),Dr(i,t,r)}get usedMemory(){let e=gt(this.graphic.attributes);return this._forEachSymbolLayerGraphic(t=>e+=t.graphics3DSymbolLayer.usedMemory),e}computeAttachmentOrigin(){const e={render:{origin:_(),num:0},draped:{origin:he(),num:0}};for(const t of this.layers)t!=null&&t.computeAttachmentOrigin(e);return e.render.num>1&&de(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&Ar(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,t,r,i,a){return a||(a={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),a.boundingBox?le(a.boundingBox):a.boundingBox=le(),a.requiresDrapedElevation=!1,await et(this.layers,async n=>{if(n==null)return;const o=n.type==="draped"?t:e,u=Ue.acquire(),l=await n.getProjectedBoundingBox(o,r,a.screenSpaceObjects,i,u);isFinite(l[2])&&isFinite(l[5])||(a.requiresDrapedElevation=!0),l&&fr(a.boundingBox,u),Ue.release(u)}),gr(a.boundingBox)||er(br(a.boundingBox,As))?a:null}needsElevationUpdates(){var e;for(const t of this.layers)if(t!=null&&(t.type==="object3d"||t.type==="lod-instance")&&t.needsElevationUpdates)return!0;return((e=this._labelLayers)==null?void 0:e.some(t=>(t==null?void 0:t.needsElevationUpdates)??!1))??!1}alignWithElevation(e,t,r){this._forEachRenderedGraphic(i=>{i.type!=="object3d"&&i.type!=="lod-instance"||i.alignWithElevation(e,t,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(e,t,r){this._forEachRenderedGraphic(i=>{i.type==="object3d"&&i.alignWithAbsoluteElevation(e,t,r)})}addObjectStateSet(e){this._forEachSymbolLayerGraphic(t=>t.addObjectState(e))}removeObjectState(e){this._forEachSymbolLayerGraphic(t=>t.removeObjectState(e))}_forEachGraphicList(e,t){e==null||e.forEach(r=>r&&t(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}}class aa{constructor(e,t){this.scheduler=e,this.schedule=t,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}get spherical(){return this.stage.view.state.viewingMode===Ir.Global}get doublePrecisionRequiresObfuscation(){return this.stage.renderView.renderingContext.driverTest.doublePrecisionRequiresObfuscation.result}}let Ds=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}},oa=class extends ge{set symbol(e){this._symbol=e,e.symbolLayers.forEach((t,r)=>{const i=this.symbolLayers[r];i!=null&&(i.symbol=e,i.symbolLayer=t)})}get symbol(){return this._symbol}constructor(e,t,r){super(t.schedule),this._symbol=e,this._context=t,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let t=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(t=this._backgroundLayers.concat(t));const r=t.length;for(;this.symbolLayers.length<t.length;)this.symbolLayers.push(null);this.symbolLayers.length=t.length;const i=[],{make:a}=await Ke(async()=>{const{make:n}=await import("./Graphics3DSymbolLayerFactory-BLzsgzAv.js");return{make:n}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198]),import.meta.url);for(let n=0;n<r;n++){const o=t.at(n);if(o.enabled===!1)continue;q.renderPriority=1-(1+n)/r,q.renderPriorityStep=1/r,q.ignoreDrivers=o.ignoreDrivers;const u=a(this.symbol,o,this._context,q),l=$r(e,()=>{this.symbolLayers[n]=null,u.destroy()});l&&i.push(l),this.symbolLayers[n]=u}if(await et(this.symbolLayers,async(n,o)=>{if(n!=null)try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}}),i.forEach(n=>n.remove()),Ce(e),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(e){const t=this.symbolLayers[e];return t!=null?t.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e==null?void 0:e.queryForSnapping)}createGraphics3DGraphic(e,t){var n,o;const r=e.graphic,i=this.symbolLayers.map(u=>(u==null?void 0:u.createGraphics3DGraphic(e))??null),a=this._context.arcade||((o=(n=this._context.featureExpressionInfoContext)==null?void 0:n.arcade)==null?void 0:o.modules)||null;return new ws(r,t||this,i,e.layer,a)}get complexity(){return fe(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,t){const r=this.symbolLayers.length;for(let i=0;i<r;i++){const a=this.symbolLayers[i],n=o=>{const u=o.layers[i];return u instanceof at?u:null};if(a!=null&&!a.globalPropertyChanged(e,t,n))return!1}return!0}applyRendererDiff(e,t){return this.loadStatus!==P.LOADED?G.RecreateSymbol:this.symbolLayers.reduce((r,i)=>r!==G.RecreateSymbol&&i!=null?Math.min(r,i.applyRendererDiff(e,t)):r,G.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===P.FAILED||e.diff.type!=="partial")return;const t=e.diff.diff;if(!t.symbolLayers||t.symbolLayers.type!=="partial")return;const r=t.symbolLayers.diff;this.symbolLayers.forEach((i,a)=>{if(i==null)return;const n=r[a];if(n){const o={diff:n,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};i.prepareSymbolLayerPatch(o),e.symbolStatePatches.push(...o.symbolLayerStatePatches),o.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((u,l)=>{const c=u.layers[a];c!=null&&o.graphics3DGraphicPatches.forEach(h=>h(c,l))})}})}updateGeometry(e,t){return this._updateGeometryOrTransform(e,(r,i)=>r.updateGeometry(i,t))}updateTransform(e,t,r,i){return this._updateGeometryOrTransform(e,(a,n)=>a.updateTransform(n,t,r,i))}_updateGeometryOrTransform(e,t){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(i==null)continue;const a=e.layers[r];if(!a||!t(i,a))return!1}return!0}onRemoveGraphic(e){for(let t=0;t<this.symbolLayers.length;t++){const r=this.symbolLayers[t];if(r==null)continue;const i=e.layers[t];i!=null&&r.onRemoveGraphic(i)}}getFastUpdateStatus(){let e=0,t=0,r=0;return this.symbolLayers.forEach(i=>{i!=null&&(i.loadStatus===P.LOADING?e++:i.isFastUpdatesEnabled()?r++:t++)}),{loading:e,slow:t,fast:r}}async queryForSnapping(e,t,r,i){const a=this.symbolLayers.filter(bt).filter(o=>o.queryForSnapping!=null).map(o=>o.queryForSnapping(e,t,r,i)),n=await Promise.all(a);return Ce(i),n.flat()}destroy(){if(!this.destroyed){super.destroy();for(const e of this.symbolLayers)e!=null&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const q=new Ds;class ca extends ge{constructor(e,t,r){super(t),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const t=await this.symbol.fetchSymbol({signal:e});t.id=this.symbol.id,this.graphics3DSymbol=this._convert(t),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:ot}globalPropertyChanged(e,t){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,t)}applyRendererDiff(e,t){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,t):G.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,t){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,t)}updateTransform(e,t,r,i){var a;return((a=this.graphics3DSymbol)==null?void 0:a.updateTransform(e,t,r,i))??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}}const ua=1.2,ha=k,da=4;function pa(s,e,t){if(s==null||t==null)return!1;let r=!0;return p[0]=s.xmin!=null?s.xmin:0,p[1]=s.ymin!=null?s.ymin:0,p[2]=s.zmin!=null?s.zmin:0,r=r&&z(p,s.spatialReference,0,e,t,0),p[0]=s.xmax!=null?s.xmax:0,p[1]=s.ymax!=null?s.ymax:0,p[2]=s.zmax!=null?s.zmax:0,r=r&&z(p,s.spatialReference,0,e,t,3),s.xmin==null&&(e[0]=-1/0),s.ymin==null&&(e[1]=-1/0),s.zmin==null&&(e[2]=-1/0),s.xmax==null&&(e[3]=1/0),s.ymax==null&&(e[4]=1/0),s.zmax==null&&(e[5]=1/0),r}function ma(s,e,t){if(s==null||t==null)return!1;let r=!0;return p[0]=s.xmin!=null?s.xmin:0,p[1]=s.ymin!=null?s.ymin:0,p[2]=s.zmin!=null?s.zmin:0,r=r&&z(p,s.spatialReference,0,p,t,0),e[0]=p[0],e[1]=p[1],p[0]=s.xmax!=null?s.xmax:0,p[1]=s.ymax!=null?s.ymax:0,p[2]=s.zmax!=null?s.zmax:0,r=r&&z(p,s.spatialReference,0,p,t,0),e[2]=p[0],e[3]=p[1],s.xmin==null&&(e[0]=-1/0),s.ymin==null&&(e[1]=-1/0),s.xmax==null&&(e[2]=1/0),s.ymax==null&&(e[3]=1/0),r}const p=_();class ya{constructor(e,t){this.spatialReference=e,this._view=t}getElevation(e,t,r){return this._view.elevationProvider.getElevation(e,t,0,this.spatialReference,r)}async queryElevation(e,t,r,i,a){return this._view.elevationProvider.queryElevation(e,t,0,this.spatialReference,a,r,i)}}class fa{constructor(e,t,r,i){this.spatialReference=t,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...i,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(kr.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(Hr);else for(const t of this._queries)t.result.reject(V())}queryElevation(e,t,r,i=0){const a=Cr(),n={x:e,y:t,minDemResolution:i,result:a,signal:r};return this._queries.push(n),Ae(r,()=>{vt(this._queries,n),a.reject(V())}),a.promise}get running(){return this._queries.length>0}runTask(e){const t=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return t.forEach(c=>c.result.reject()),void e.madeProgress();const i=t.map(c=>[c.x,c.y]),a=t.reduce((c,h)=>Math.min(c,h.minDemResolution),1/0),n=new tr({points:i,spatialReference:this.spatialReference}),o=t.length>1&&t.some(c=>!!c.signal)?new AbortController:null,u=o!=null?o.signal:t[0].signal;if(o!=null){let c=0;t.forEach(h=>Ae(h.signal,()=>{c++,h.result.reject(V()),c===t.length&&o.abort()}))}const l={...this._queryOptions,minDemResolution:a,signal:u};r.queryElevation(n,l).then(c=>{t.forEach((h,m)=>{h.signal!=null&&h.signal.aborted?h.result.reject(V()):h.result.resolve(c.geometry.points[m][2])})}).catch(c=>{t.forEach(h=>h.result.reject(c))}),e.madeProgress()}get test(){}}let ga=class{constructor(e,t=0,r=0,i=0,a=0,n=null){this.usedMemory=e,this.displayedFeatures=t,this.totalFeatures=r,this.maximumFeatures=i,this.nodes=a,this.core=n}};function va(s){return"performanceInfo"in s}class _a{constructor(e="scene"){this.context=e,this.extent=rr()}}const Fs=Object.freeze(Object.defineProperty({__proto__:null,build:ut},Symbol.toStringTag,{value:"Module"}));export{ta as A,gs as B,fs as C,Yr as D,Ni as E,ds as F,us as G,E as H,zi as I,Gi as J,ns as K,I as L,is as M,as as N,Ri as O,ss as P,Ii as Q,da as R,os as S,sa as T,fa as U,va as V,rt as a,_a as b,ia as c,Qi as d,G as e,Zi as f,Ti as g,D as h,Wr as i,Ui as j,P as k,ya as l,oa as m,ts as n,ca as o,at as p,pa as q,ua as r,aa as s,ga as t,ma as u,ha as v,Yi as w,Xi as x,ps as y,bs as z};
