import{s,F as u}from"./Basemap-DVYOaWHz.js";import{h as w,w as q,n as x}from"./subclass-BZA_h8Db.js";import{V as S}from"./Collection-CEdjem1-.js";import{z as T,q as U}from"./Accessor-BLX9ikPh.js";import{x as M,_ as k,K as A}from"./assets-C43MgM-v.js";import{r as C}from"./utils-93yNk4Xc.js";const c=()=>x.getLogger("esri.support.basemapUtils");function W(){return{}}function _(e){for(const t in e){const n=e[t];U(n),delete e[t]}}function G(e,t){let n;if(typeof e=="string"){const r=e in s,a=!r&&e.includes("/");if(!r&&!a){if(w.apiKey)c().warn(`Unable to find basemap definition for: ${e}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{const l=Object.entries(s).filter(([i,p])=>p.classic||p.is3d).map(([i])=>`"${i}"`).sort().join(", ");c().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${l}`)}return null}t&&(n=t[e]),n||(n=r?u.fromId(e):new u({style:{id:e}}),t&&(t[e]=n))}else n=q(u,e);return n!=null&&n.destroyed&&(c().warn("The provided basemap is already destroyed",{basemap:n}),n=null),n}function H(e){var t;return((t=e.portalItem)==null?void 0:t.type)==="Web Scene"||e.referenceLayers.some(n=>n.type==="scene")}function J(e){var t,n;return!!((n=(t=e==null?void 0:e.portalItem)==null?void 0:t.tags)!=null&&n.some(r=>r.toLowerCase()==="beta"))}function P(e,t){var n,r,a,l;return((r=(n=e.basemap)==null?void 0:n.referenceLayers)==null?void 0:r.some(i=>i.uid===t))||((l=(a=e.basemap)==null?void 0:a.baseLayers)==null?void 0:l.some(i=>i.uid===t))}function Q(e,t=null){const n=G(e);if(!n)return null;const r=n.clone();return t&&(r.baseLayers=y(r.baseLayers,t.baseLayers),r.referenceLayers=y(r.referenceLayers,t.referenceLayers)),r}function K(e){let t=null;const n=o(e),r=!(n!=null&&n.baseLayers.length);for(const a in s){const l=g(n,h(s[a]),{mustMatchReferences:r});if(l==="equal"){t=a;break}l==="base-layers-equal"&&(t=a)}return t}function X(e,t){var n,r;return e===t||((n=e==null?void 0:e.portalItem)==null?void 0:n.id)!=null&&e.portalItem.id===((r=t==null?void 0:t.portalItem)==null?void 0:r.id)?!0:g(o(e),o(t),{mustMatchReferences:!0})==="equal"}function y(e,t){const n=new S;return e.forEach(r=>{const a=t.find(l=>l.type!=="scene"&&I(f(r),f(l)))||r;n.includes(a)?n.push(r):n.push(a)}),n}function Y(e){return!!(e!=null&&e.baseLayers.concat(e.referenceLayers).some(V))}function V(e){if(m(e.url))return!0;if(e.type==="vector-tile")for(const t in e.sourceNameToSource){const n=e.sourceNameToSource[t];if(m(n==null?void 0:n.sourceUrl))return!0}return!1}function Z(e,t){var l;if(t==null||e==null)return{spatialReference:null,updating:!1};if(t.loadStatus==="not-loaded")return t.load(),{spatialReference:null,updating:!0};if(t.spatialReference)return{spatialReference:t.spatialReference,updating:!1};if(t.baseLayers.length===0)return{spatialReference:null,updating:!1};const n=t.baseLayers.at(0);switch(n.loadStatus){case"not-loaded":n.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const r=(("supportedSpatialReferences"in n?n.supportedSpatialReferences:null)||["tileInfo"in n?(l=n.tileInfo)==null?void 0:l.spatialReference:n.spatialReference]).filter(Boolean),a=e.spatialReference;return a?{spatialReference:r.find(i=>a.equals(i))??r[0]??null,updating:!1}:{spatialReference:r[0],updating:!1}}const j=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function m(e){if(!e)return!1;const t=new M(k(e));return!!t.authority&&j.test(t.authority)}function o(e){return e?!e.loaded&&e.resourceInfo?h(e.resourceInfo.data):{baseLayers:d(e.baseLayers),referenceLayers:d(e.referenceLayers)}:null}function d(e){return(S.isCollection(e)?e.toArray():e).map(f)}function f(e){var t,n;return{type:e.type,effect:"effect"in e?e.effect:void 0,url:R("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&e.minScale!=null?e.minScale:0,maxScale:"maxScale"in e&&e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visible==null||!!e.visible,sublayers:e.type!=="map-image"&&e.type!=="wms"||e.sublayers==null||(t=e.sublayers)==null?void 0:t.map(r=>({id:r.id,visible:r.visible})),activeLayerId:e.type==="wmts"?(n=e.activeLayer)==null?void 0:n.id:void 0}}function b(e){return e.isReference||e.layerType==="ArcGISSceneServiceLayer"}function h(e){return e?{baseLayers:L((e.baseMapLayers??[]).filter(t=>!b(t))),referenceLayers:L((e.baseMapLayers??[]).filter(t=>b(t)))}:null}function L(e){return e.map(t=>N(t))}function N(e){let t;switch(e.layerType){case"VectorTileLayer":t="vector-tile";break;case"ArcGISTiledMapServiceLayer":t="tile";break;case"ArcGISSceneServiceLayer":t="scene";break;default:t="unknown"}return{type:t,effect:e.effect,url:R(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale??0,maxScale:e.maxScale??0,opacity:e.opacity??1,visible:e.visibility==null||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}function g(e,t,n){return e!=null!=(t!=null)?"not-equal":!e||!t?"equal":v(e.baseLayers,t.baseLayers)?v(e.referenceLayers,t.referenceLayers)?"equal":n.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal"}function v(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!I(e[n],t[n]))return!1;return!0}function I(e,t){if(e.type!==t.type||e.url!==t.url||e.minScale!==t.minScale||e.maxScale!==t.maxScale||e.visible!==t.visible||e.opacity!==t.opacity||!C(e.effect,t.effect))return!1;if(e.activeLayerId!=null||t.activeLayerId!=null)return e.activeLayerId===t.activeLayerId;if(e.sublayers!=null||t.sublayers!=null){if(e.sublayers==null||t.sublayers==null||e.sublayers.length!==t.sublayers.length)return!1;for(let n=0;n<e.sublayers.length;n++){const r=e.sublayers.at(n),a=t.sublayers.at(n);if((r==null?void 0:r.id)!==(a==null?void 0:a.id)||(r==null?void 0:r.visible)!==(a==null?void 0:a.visible))return!1}}return!0}function R(e){return e?A(e).replace(/^\s*https?:/i,"").toLowerCase():""}function ee(e){if(!e)return null;const{thumbnailUrl:t}=e;if(t)return t;const n=K(e);return n?s[n].thumbnailUrl:T(e.baseLayers,B)}function B(e){var t;return"portalItem"in e?(t=e.portalItem)==null?void 0:t.thumbnailUrl:void 0}export{J as L,ee as O,X as R,Q as S,Y as T,V as U,G as b,H as d,Z as j,_ as m,P as v,W as y};
