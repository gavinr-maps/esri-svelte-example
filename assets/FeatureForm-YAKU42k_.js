const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./calcite-button-BbY9lAf2.js","./button-D5KuIed_.js","./jsxFactory-Be5PKa9i.js","./Evented-CXIxDjmW.js","./Accessor-D6mNnsWy.js","./subclass-BR3PhgZG.js","./intl-CArXn1et.js","./Promise-CZrWwByK.js","./jsonMap-DCC6W5ex.js","./assets-BNizZMOZ.js","./index-BVncS3aY.js","./index-CjOb8WjV.css","./reactiveUtils-BFQ0BtrB.js","./shared-B3wH2qpO.js","./uuid-fwrPAdZb.js","./form-BOCdnUd9.js","./dom-BkQ_hHOr.js","./interactive-QOqfpSSx.js","./label-1rGx7O4B.js","./component-ByvC-PUv.js","./loadable-Bgtgv1lm.js","./locale-BvYy6Wxh.js","./key-D5DPfjW0.js","./observers-DSkGD1TQ.js","./t9n-Atzq4sOi.js","./icon-D6t4qKDg.js","./loader-ew3V3w9x.js","./calcite-icon-DtUarwQp.js","./calcite-scrim-CYwFbyZL.js","./scrim-fRLdjgt6.js","./calcite-label-Ddcwlp7C.js","./calcite-radio-button-CKaeac_E.js","./array-DofFqflK.js","./calcite-radio-button-group-CoIHoOAe.js","./Validation-Dm76Kltf.js","./input-message-BGlL44gg.js","./calcite-block-CcSPCrEC.js","./conditionalSlot-eNLH0S30.js","./Heading-DQrTi3L3.js","./openCloseComponent-Bqj9CrBJ.js","./action-CFB8-9mS.js","./action-menu-M1XR2Dkh.js","./popover-DLRbisRr.js","./floating-ui-5U9KNmUg.js","./debounce-C5YDvsuO.js","./focusTrapComponent-Bepj0OOn.js","./FloatingArrow-BN7WHE4B.js","./handle-DVEsJI64.js","./calcite-combobox-DBG5Dw4c.js","./combobox-DrLFL3DM.js","./core-2D-WamSI.js","./filter-BHzLPuAd.js","./utils2-D-J1ilxn.js","./chip-Rm2iopRG.js","./combobox-item-D_DcFbZQ.js","./calcite-combobox-item-Dz8KyY88.js","./calcite-combobox-item-group-C_xpKlI1.js","./combobox-item-group-BgYSztVO.js","./calcite-input-p_Le978W.js","./input2-BjqyiC1c.js","./input-Dt5r39B0.js","./progress-CMyqabfC.js","./calcite-input-date-picker-QH0u4dYt.js","./input-text-Bh_DhRYc.js","./calcite-input-message-DHYZOFye.js","./calcite-input-number-C7vjRhaS.js","./input-number-C3dlLe78.js","./calcite-input-time-picker-hyzcqWSL.js","./math-DqfKmoY3.js","./calcite-input-time-zone-DQ9mtFUN.js","./calcite-list-CauCCaYV.js","./resources4-CT6dxwoZ.js","./utils3-SlIPNAt8.js","./calcite-list-item-DnfVo5id.js","./calcite-loader-Cyav0WwQ.js","./calcite-notice-CVdHfJFK.js","./calcite-switch-CfyCkhzI.js","./switch-DRZSyDYK.js","./calcite-text-area-C6NA6UCT.js","./throttle-Dy4QZIDI.js"])))=>i.map(i=>d[i]);
import{_ as V}from"./index-BVncS3aY.js";import{e as u,o as Xe}from"./Evented-CXIxDjmW.js";import"./intl-CArXn1et.js";import{y as d,b as $,O as pe,r as se,n as W,G as _e}from"./subclass-BR3PhgZG.js";import{S as j,x as et,b as ve,L as Ge,c as Ue,O as be,u as Ce}from"./Accessor-D6mNnsWy.js";import{d as L,P as tt,v as He,V as xe,w as Ze}from"./reactiveUtils-BFQ0BtrB.js";import{y as it,a as nt,I as st,a4 as ot,a5 as at,T as rt,k as lt,a6 as Ve,a7 as Y,a8 as Q,a9 as X,aa as Fe,ab as ut,ac as dt}from"./fieldUtils-C5R42-PY.js";import{r as Be,n as m,w as pt,e as ee,B as ct}from"./jsxFactory-Be5PKa9i.js";import{e as We,n as ht}from"./Heading-DPYpGh42.js";import{C as ce,y as J,S as mt,U as he,R as we,$ as Ee,D as ft,I as yt,w as gt,j as _t,b as B,N as vt,g as me,x as qe,K as bt,O as Ct,T as oe,v as Ie,q as xt,B as Vt,E as Ft,Q as wt}from"./featureFormUtils-8KaQp8jR.js";import{d as Et}from"./Graphic-Bi5hWHps.js";import{n as It}from"./compilerUtils-BA04t1lN.js";import{n as Rt,i as Re,r as Tt,o as $t}from"./Promise-CZrWwByK.js";import{h as ge}from"./UpdatingHandles-CMtXpTiG.js";import{n as Te,V as Ot}from"./FeatureLayerBase-BE0EfCO4.js";import{e as $e,t as At,o as kt,p as Lt}from"./formUtils-Dni92j4V.js";import{e as Mt}from"./editableLayers-BdCikvlg.js";import{u as Dt,U as q}from"./assets-BNizZMOZ.js";import{m as St}from"./Portal-DCqdz-K4.js";import{d as ae}from"./arcgisLayerUrl-ETqee4Bd.js";import{s as ze,l as Nt,q as Oe}from"./FieldInput-DqQshs_P.js";import{createArcadeProfile as Pt,createArcadeExecutor as jt}from"./arcade-uwJcZl_E.js";import{O as Ae}from"./layerUtils-BzjQnEdj.js";import{F as Gt}from"./FeatureRelationshipViewModel-15QUzhzZ.js";import{J as Ut}from"./featureUtils-Dy-Hn98g.js";import{s as Ht}from"./ReactiveMap-Dl_3-Rm5.js";import{s as ke}from"./ReactiveSet-HYC-4KEs.js";import{e as Le}from"./globalCss-CZa70j6i.js";import{e as Zt}from"./vmEvent-D4Ubqkbq.js";import{s as te}from"./substitute-CNca968n.js";const Bt="exclamation-mark-triangle",G="esri-editor__prompt",U={base:G,header:`${G}__header`,heading:`${G}__header__heading`,message:`${G}__message`,divider:`${G}__divider`,actions:`${G}__actions`},Xi=()=>Be({button:()=>V(()=>import("./calcite-button-BbY9lAf2.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]),import.meta.url),icon:()=>V(()=>import("./calcite-icon-DtUarwQp.js"),__vite__mapDeps([27,25,2,3,4,5,6,7,8,9,10,11,12,13,14,16,23]),import.meta.url),scrim:()=>V(()=>import("./calcite-scrim-CYwFbyZL.js"),__vite__mapDeps([28,29,2,3,4,5,6,7,8,9,10,11,12,13,14,21,16,22,23,24,26]),import.meta.url),label:()=>V(()=>import("./calcite-label-Ddcwlp7C.js"),__vite__mapDeps([30,2,3,4,5,6,7,8,9,10,11,12,13,14,18,16,19]),import.meta.url),"radio-button":()=>V(()=>import("./calcite-radio-button-CKaeac_E.js"),__vite__mapDeps([31,2,3,4,5,6,7,8,9,10,11,12,13,14,32,16,15,17,18,19,20]),import.meta.url),"radio-button-group":()=>V(()=>import("./calcite-radio-button-group-CoIHoOAe.js"),__vite__mapDeps([33,2,3,4,5,6,7,8,9,10,11,12,13,14,23,16,20,34,25,35]),import.meta.url)});function Wt({actions:e,context:t,headingLevel:i,message:n,title:s,...o}){const{primary:a,secondary:r}=e;let l;switch(t){case"danger":l="danger";break;case"info":l="brand";break;default:l="neutral"}const c=m("calcite-button",{afterCreate:zt,appearance:"solid","data-testid":"primary-prompt-button",key:"prompt-primary-button",kind:l,onclick:a.action,width:r?"half":"full"},a.label),p=r&&m("calcite-button",{appearance:"outline","data-testid":"secondary-prompt-button",key:"prompt-secondary-button",kind:l,onclick:r.action,width:"half"},r.label);return m("calcite-scrim",{"data-testid":"prompt",key:"prompt"},m("div",{class:`${U.base}--${t}`},m("div",{class:U.header},m("calcite-icon",{icon:Bt}),m(We,{class:U.heading,level:i},s)),m("div",{class:U.message},n),qt(o)??m("div",{class:U.divider}),m("div",{class:U.actions},p,c)))}function qt({radios:e,onRadioSelection:t,defaultRadioSelection:i}){return e!=null&&e.length?m("calcite-radio-button-group",{name:"PromptChoiceList"},e.map(n=>m("calcite-label",{layout:"inline"},m("calcite-radio-button",{checked:n.value===i,value:n.value,onCalciteRadioButtonChange:()=>t==null?void 0:t(n.value)}),n.label))):void 0}function zt(e){requestAnimationFrame(()=>e.setFocus())}const T="esri-feature-form",re=`${T}__group`,H=`${T}__input`,le=`${T}__related-records`,C={base:T,form:`${T}__form`,formHeader:`${T}__form-header`,label:`${T}__label`,labelTextContent:`${T}__label-text-content`,fieldInput:`${H}`,inputRadio:`${H}--radio`,inputRadioGroup:`${H}--radio-group`,inputRadioLabel:`${H}--radio-label`,inputDisabled:`${H}--disabled`,inputSwitch:`${H}--switch`,centeredButton:`${T}__centered-button`,description:`${T}__description-text`,listObserver:`${T}__list-observer`,relatedRecordsHeader:`${le}_header`,relatedRecordsLabel:`${le}_label`,relatedRecordsList:`${le}_list`,dateInputContainer:`${`${T}__date`}-input-container`,textElement:`${T}__text-element`,group:re,groupSequential:`${re}--sequential`,groupActive:`${re}--active`};let S=class extends j{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.codedValue=null}};u([d()],S.prototype,"objectType",void 0),u([d()],S.prototype,"maxValue",void 0),u([d()],S.prototype,"minValue",void 0),u([d()],S.prototype,"codedValue",void 0),S=u([$("esri.layers.support.ContingentValue")],S);const E=S;let N=class extends j{constructor(t){super(t),this.isRetired=!1}};u([d()],N.prototype,"id",void 0),u([d()],N.prototype,"isRetired",void 0),u([d()],N.prototype,"subtype",void 0),u([d()],N.prototype,"values",void 0),N=u([$("esri.layers.support.Contingency")],N);const Me=N;let z=class extends j{constructor(t){super(t)}};u([d()],z.prototype,"fieldGroup",void 0),u([d()],z.prototype,"type",void 0),z=u([$("esri.layers.support.ContingencyConstraintViolation")],z);const De=z;let K=class extends j{constructor(t){super(t)}};u([d()],K.prototype,"contingentValuesAllGroups",void 0),u([d()],K.prototype,"contingentValuesByFieldGroup",void 0),K=u([$("esri.layers.support.ContingentValuesResult")],K);const Kt=K;let P=class extends j{constructor(t){super(t),this.fields=null,this.isEditingRestrictive=!1}};u([d()],P.prototype,"name",void 0),u([d()],P.prototype,"fields",void 0),u([d()],P.prototype,"isEditingRestrictive",void 0),u([d()],P.prototype,"contingencies",void 0),P=u([$("esri.layers.support.FieldGroup")],P);const fe=P;var ie;let M=ie=class extends Dt(St){constructor(e){super(e),this.request=q,this.fieldGroups=null,this.fieldGroupDefinitions=null}initialize(){}get subtypeFieldName(){return ce(this.layer).typeFieldName}static async createLoadedLayerContingentValuesCache(e){await e.load();const t=e.sourceJSON;if(e.layerId===void 0)return null;const i=t.hasContingentValuesDefinition;if(i)return new ie({layer:e}).load();if(i===void 0){const n=ae(e.url);if(n==null)return null;const s=n.url.path;if((await Ne(s)).supportsQueryDataElements){const o=e.layerId.toString(),a=await Se(s,o);if(a){const r=a.map(l=>({name:l.name,isEditingRestrictive:l.isEditingRestrictive,fields:l.fieldNames.names.map(c=>e.fieldsIndex.normalizeFieldName(c))}));return new ie({layer:e,fieldGroupDefinitions:r}).load()}}}return null}async load(e){const t=this.layer.load(e).then(()=>this._initializeContingentValues(this.fieldGroupDefinitions,e));return this.addResolvingPromise(t),this}validateContingencyConstraints(e,t){const i=Object.keys(e),n=[],s=[];for(const o of this.fieldGroups){const a=o.isEditingRestrictive?"error":"warning";if(t&&!o.fields.some(p=>t.includes(p)))continue;if(!o.fields.every(p=>i.includes(p))){s.push(new De({fieldGroup:o,type:a}));continue}let r=!1;const l=e[this.subtypeFieldName],c=o.contingencies.filter(p=>!(!p.isRetired&&p.subtype)||p.subtype.code===l);if(c.length!==0){for(const p of c){let h=!0;for(const y in p.values){const f=p.values[y];if(f.objectType!=="any"){if(f.objectType==="null"){if(e[y]!=null){h=!1;break}}else if(f.objectType==="code"){if(e[y]!==f.codedValue.code){h=!1;break}}else if(f.objectType==="range"){const _=e[y];if(_<f.minValue||_>f.maxValue){h=!1;break}}}}if(h){r=!0;break}}r||n.push(new De({fieldGroup:o,type:a}))}}return{invalid:n,incomplete:s}}getContingentValues(e,t,i=!1){const n=e[this.subtypeFieldName],s=n!=null,o={};let a=[];const r=this.fieldGroups.filter(l=>l.fields.includes(t));a.push(new E({objectType:"any"}));for(const l of r){let c=[];const p=l.contingencies.filter(f=>!(f.isRetired||f.subtype&&s&&f.subtype.code!==n));let h=!1;const y={};for(const f of p){let _,b=!0;for(const g in f.values){const w=f.values[g];if(t!==g){if(e[g]!==void 0&&w.objectType!=="any"){if(w.objectType==="null")e[g]!==null&&(b=!1);else if(w.objectType==="code")e[g]!==w.codedValue.code&&(b=!1);else if(w.objectType==="range"){const O=e[g];(O<w.minValue||O>w.maxValue)&&(b=!1)}}}else _=w,h=h||w.objectType==="range"}if(_&&b){if(_.objectType==="any"){c.length=0,c.push(_);break}const g=Jt(_);y[g]||c.push(_),y[g]=!0}}h&&(c=Yt(c)),o[l.name]=c,a=i?ei(a,c):[]}return r.length===1&&i&&(a=[]),new Kt({contingentValuesAllGroups:a,contingentValuesByFieldGroup:o})}async _initializeContingentValues(e,t){const i=e??await this._fetchFieldGroupDefs(t);if(i.length===0)return void(this.fieldGroups=[]);const n=await this._fetchContingentValues(i,t);this.fieldGroups=n}async _fetchFieldGroupDefs(e){if(this.layer.layerId===void 0)return[];const t=this.layer.sourceJSON,i=this.layer.layerId.toString(),n=ae(this.layer.url).url.path;return t.hasContingentValuesDefinition?(await ti(n,i,e)).map(s=>({name:s.name,isEditingRestrictive:s.restrictive,fields:s.fields.map(o=>this.layer.fieldsIndex.normalizeFieldName(o))})):t.hasContingentValuesDefinition!==void 0?[]:Ne(n,e).then(async s=>s.supportsQueryDataElements?(await Se(n,i,e)).map(o=>({name:o.name,isEditingRestrictive:o.isEditingRestrictive,fields:o.fieldNames.names.map(a=>this.layer.fieldsIndex.normalizeFieldName(a))})):[])}async _fetchContingentValues(e,t){if(this.layer.layerId===void 0)return[];const i=this.layer.sourceJSON,n=this.layer.layerId.toString(),s=ae(this.layer.url).url.path;if(i.hasContingentValuesDefinition){const a=await ni(s,n,t);return this._constructFieldGroupsAGOL(e,a)}const o=await ii(s,n,t);return this._constructFieldGroupsEnterprise(e,o)}_constructFieldGroupsAGOL(e,t){return e.map(i=>{const n=t.contingentValuesDefinition.fieldGroups.find(s=>s.name===i.name);if(n){let s=[];return s=t.contingentValuesDefinition.hasSubType?this._parseAGOLFieldGroupSubtype(i,t,n.subTypes):this._parseAGOLFieldGroup(i,t,n.contingentValues),new fe({name:i.name,isEditingRestrictive:i.isEditingRestrictive,fields:i.fields,contingencies:s})}return null}).filter(pe)}_parseAGOLFieldGroupSubtype(e,t,i){let n=[];return i==null||i.forEach(s=>{const o=this._getSubtypeAGOL(s.name);n=n.concat(this._parseAGOLFieldGroup(e,t,s.contingentValues,o))}),n}_parseAGOLFieldGroup(e,t,i,n=null){const s=[];for(const o of i??[]){const a=this._parseAGOLContingency(o,e,t,n);s.push(a)}return s}_parseAGOLContingency(e,t,i,n){const s=e.id,o=!!e.retired&&e.retired===1,a={};for(let r=0,l=0;r<t.fields.length;r++){const c=t.fields[r],p=i.typeCodes[e.types[r]];if(p==="Code"){let h=e.values[l];l++;const y=this._getDomain(n,c),f=this.layer.getField(c);if((f==null?void 0:f.type)==="string"){const g=i.stringDicts.find(w=>w.domain===(y==null?void 0:y.name));g&&(h=g.entries[h])}const _=y==null?void 0:y.codedValues.find(g=>g.code===h),b=new E({codedValue:_,objectType:"code"});a[c]=b}else if(p==="Range"){const h=e.values[l];l++;const y=h.range[0],f=h.range[1],_=new E({minValue:y,maxValue:f,objectType:"range"});a[c]=_}else if(p==="Any"){const h=new E({objectType:"any"});a[c]=h}else{const h=new E({objectType:"null"});a[c]=h}}return new Me({id:s,isRetired:o,subtype:n,values:a})}_constructFieldGroupsEnterprise(e,t){const i=t.fieldGroups;return e.map(n=>{const s=i.find(o=>o.name===n.name);if(s){const o=s.contingencies.map(a=>{const r=a.id,l=a.isRetired||!1,c=this._getSubtypeEnterprise(a.subtypeCode),p={};for(let h=0;h<n.fields.length;h++){const y=n.fields[h];let f=a.values[h];if(typeof f=="number"||typeof f=="string"){const _=this._getDomain(c,y),b=this.layer.getField(y);it(b)?f=t.stringDictionary[f]:nt(b)&&(f=new Date(`${f}+00:00`).getTime());const g=_==null?void 0:_.codedValues.find(O=>O.code===f),w=new E({codedValue:g,objectType:"code"});p[y]=w}else if(typeof f=="object"){const _=f.minValue,b=f.maxValue,g=new E({minValue:_,maxValue:b,objectType:"range"});p[y]=g}else if(f){const _=new E({objectType:"any"});p[y]=_}else{const _=new E({objectType:"null"});p[y]=_}}return new Me({id:r,isRetired:l,subtype:c,values:p})});return new fe({name:n.name,isEditingRestrictive:n.isEditingRestrictive,fields:n.fields,contingencies:o})}return null}).filter(pe)}_getSubtypeEnterprise(e){const t=this.layer.sourceJSON;let i;if(t.subtypes){const n=t.subtypes.find(s=>s.code===e);i=Te.fromJSON(n)}return i||null}_getSubtypeAGOL(e){const t=this.layer.sourceJSON;let i;if(t.subtypes){const n=t.subtypes.find(s=>s.name===e);i=Te.fromJSON(n)}return i||null}_getDomain(e,t){const i=e?si(e,t):this.layer.getFieldDomain(t);return(i==null?void 0:i.type)==="inherited"?this.layer.getFieldDomain(t):i}};function Jt(e){switch(e.objectType){case"any":return"@any@";case"null":return"@null@";case"code":return e.codedValue.name+e.codedValue.code.toString();case"range":return e.minValue.toString()+"-"+e.maxValue.toString()}}function Yt(e){let t,i;e.sort((s,o)=>s.objectType==="null"?-1:o.objectType==="null"?1:s.minValue-o.minValue);const n=[];for(const s of e)s.objectType!=="null"?t!=null&&i!=null?i<s.minValue?(n.push(new E({objectType:"range",minValue:t,maxValue:i})),t=s.minValue,i=s.maxValue):i<s.maxValue&&(i=s.maxValue):(t=s.minValue,i=s.maxValue):n.push(s);return n.push(new E({objectType:"range",minValue:t,maxValue:i})),n}function Qt(e,t){const i=[];let n,s=0;for(const o of e)for(;s<t.length;s++){const a=t[s];if(o.objectType==="null"&&a.objectType==="null")i.push(new E({objectType:"null"}));else{if(o.objectType==="null")break;if(a.objectType==="null")continue}if(o.maxValue<a.minValue)break;if(o.maxValue===a.minValue){i.push(new E({objectType:"range",minValue:o.maxValue,maxValue:a.minValue}));break}if(!(o.minValue>a.maxValue))if(o.minValue!==a.maxValue){if(n=o.minValue>a.minValue?o.minValue:a.minValue,o.maxValue<a.maxValue){i.push(new E({objectType:"range",minValue:n,maxValue:o.maxValue}));break}i.push(new E({objectType:"range",minValue:n,maxValue:a.maxValue}))}else i.push(new E({objectType:"range",minValue:o.minValue,maxValue:a.maxValue}))}return i}function Xt(e,t){const i=[];for(const n of e)t.some(s=>{if(n.objectType===s.objectType)switch(n.objectType){case"any":case"null":return!0;case"code":return n.codedValue.code===s.codedValue.code&&n.codedValue.name===s.codedValue.name}return!1})&&i.push(n);return i}function ei(e,t){var s,o;if(e.length===0||t.length===0)return[];if(e[0].objectType==="any")return t;if(t[0].objectType==="any")return e;const i=e[0].objectType==="range"||((s=e[1])==null?void 0:s.objectType)==="range",n=t[0].objectType==="range"||((o=t[1])==null?void 0:o.objectType)==="range";return i||n?Qt(e,t):Xt(e,t)}async function ti(e,t,i){return q(`${e}/${t}/fieldgroups`,{responseType:"json",query:{f:"json"},...i}).then(n=>n.data.fieldGroups??[])}async function Se(e,t,i){return q(`${e}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...i}).then(n=>{var s;return((s=n.data.layerDataElements)==null?void 0:s[0].dataElement.fieldGroups)??[]})}async function Ne(e,t){return q(e,{responseType:"json",query:{f:"json"},...t}).then(i=>i.data)}async function ii(e,t,i){return q(`${e}/queryContingentValues`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...i}).then(n=>{var s;return(s=n.data.contingentValueSets)==null?void 0:s[0]})}async function ni(e,t,i){return q(`${e}/${t}/contingentValues`,{responseType:"json",query:{f:"json"},...i}).then(n=>n.data)}function si(e,t){const i=e.domains;if(i){const[n,s]=Object.entries(i).find(([o])=>o.trim().toLowerCase()===t.trim().toLowerCase())||[];return s||null}return null}u([d({constructOnly:!0})],M.prototype,"layer",void 0),u([d({constructOnly:!0})],M.prototype,"request",void 0),u([d({type:[fe]})],M.prototype,"fieldGroups",void 0),u([d({constructOnly:!0})],M.prototype,"fieldGroupDefinitions",void 0),u([d()],M.prototype,"subtypeFieldName",null),M=ie=u([$("esri.layers.support.LayerContingentValuesCache")],M);const oi=M;var Ke;const ai=Symbol("FormExpressionArcadeExecutor");let I=class extends j{constructor(t){super(t),this[Ke]=!0,this._lastEvaluatedValue=null,this._abortController=new AbortController,this._stale=!1,this._updatingTracking=new ge,this._executeAsyncDebounced=et(async(i,n,s)=>{const o=await this.executor.executeAsync(i,{...n,abortSignal:s});return s.aborted?this._lastEvaluatedValue:(this._lastEvaluatedValue=o,this._stale=!1,o)})}get isAsync(){return this.executor.isAsync}get fieldsUsed(){return this.executor.fieldsUsed}get syntaxTree(){return this.executor.syntaxTree}get updating(){return this._updatingTracking.updating}get stale(){return this._stale}get geometryUsed(){return this.executor.geometryUsed}get variablesUsed(){return this.executor.variablesUsed}get lastEvaluatedValue(){return this._lastEvaluatedValue}abort(){this._abortController.abort()}execute(t,i){this._abortController=new AbortController;const n=this.executor.execute(t,{...i,abortSignal:this._abortController.signal});return this._lastEvaluatedValue=n,n}async executeAsync(t,i){return this._abortController=new AbortController,this._updatingTracking.addPromise(this._executeAsyncDebounced(t,i??{},this._abortController.signal))}markStale(){this._stale=!0}reset(){this.abort(),this._lastEvaluatedValue=null,this._stale=!1}};Ke=ai,u([d()],I.prototype,"_lastEvaluatedValue",void 0),u([d()],I.prototype,"_stale",void 0),u([d()],I.prototype,"_updatingTracking",void 0),u([d({constructOnly:!0})],I.prototype,"executor",void 0),u([d()],I.prototype,"isAsync",null),u([d()],I.prototype,"fieldsUsed",null),u([d()],I.prototype,"syntaxTree",null),u([d()],I.prototype,"updating",null),u([d()],I.prototype,"stale",null),u([d()],I.prototype,"geometryUsed",null),u([d()],I.prototype,"variablesUsed",null),u([d()],I.prototype,"lastEvaluatedValue",null),I=u([$("esri.widgets.FeatureForm.FormExpressionArcadeExecutor")],I);const ri=async(e,t)=>{const i=Pt("form-calculation"),n=await jt(e,i,{});return t!=null&&t.fieldsIndex&&(n.fieldsUsed=st(t.fieldsIndex,n.fieldsUsed)),new I({executor:n})},ue="#JSAPI_FORM_EXPRESSIONS_MANAGER_GEOMETRY";let A=class extends j{constructor(e){super(e),this._fieldReferencesLookup=new Map,this._fieldsAffectedLookup=new Map,this.preserveFieldValuesWhenHidden=!0,this._latestFieldValues={...e.feature.attributes}}initialize(){this._dependencyGraph=this._buildDependencyGraph()}destroy(){this.resetExecutors()}get _asyncExecutors(){return this.executors.filter(e=>e.isAsync)}get _baseContext(){const{editType:e,layer:t,map:i,originalFeature:n,spatialReference:s,timeZone:o}=this.arcadeContextInfo,a=(t==null?void 0:t.type)==="scene"&&t.associatedLayer!=null?t.associatedLayer:t;return[{$originalfeature:n,$editcontext:{editType:e},$layer:a,$featureset:a,$datastore:t==null?void 0:t.url,$map:i},{rawOutput:!0,spatialReference:s??void 0,timeZone:o}]}set feature(e){this._latestFieldValues={...e==null?void 0:e.attributes},this._set("feature",e)}evaluateAll(){return this._evaluate(this.executors)}evaluateAsyncExpressions(){return this._evaluate(this._asyncExecutors)}evaluateExpressions(e){return this._evaluate(e)}evaluateInvalidated(e){const{_fieldReferencesLookup:t,_latestFieldValues:i,feature:n}=this,s=new Set;for(const o of e)if(i[o]=n.getAttribute(o),t.has(o))for(const a of t.get(o))s.add(a);return this._evaluate([...s])}async evaluateInvalidatedByGeometry(){if(this._fieldReferencesLookup.has(ue))return this._evaluate([...this._fieldReferencesLookup.get(ue)])}resetExecutors(){for(const e of this.executors)e.reset()}_buildDependencyGraph(){var r;const{_fieldReferencesLookup:e,_fieldsAffectedLookup:t,executors:i,preserveFieldValuesWhenHidden:n}=this,s=new Map(this.fieldInputs.map(l=>[l.name,l])),o=n===!1,a=new Map(i.map(l=>[l,new Array]));for(const l of i){for(const c of l.fieldsUsed){se(e,c,()=>new Set).add(l);const p=s.get(c);[p==null?void 0:p.valueExpressionExecutor,p==null?void 0:p.editableExpressionExecutor,o?(r=p==null?void 0:p.group)==null?void 0:r.visibilityExpressionExecutor:null,o?p==null?void 0:p.visibilityExpressionExecutor:null].filter(h=>h!=null&&h!==l).forEach(h=>{a.get(h).push(l),se(t,h,()=>new Set).add(p)})}l.geometryUsed&&se(e,ue,()=>new Set).add(l)}return a}async _evaluate(e){const t=new Map,{_dependencyGraph:i,_fieldsAffectedLookup:n,_latestFieldValues:s}=this;for(const a of e)Je(a,t,i);for(const[a,{resolver:r,dependencyPromises:l}]of t)Promise.all(l).then(async()=>{const[c,p]=this._makeContext(s);return a.executeAsync(c,p)}).then(()=>{if(n.has(a))for(const c of n.get(a))this._latestFieldValues[c.name]=c.value;r.resolve()},c=>{!c||ve(c)||Pe(c)||a.markStale(),r.reject(c)});const o=(await Promise.allSettled(Array.from(t.values(),({resolver:a})=>a.promise))).filter(a=>a.status==="rejected"&&!(ve(a.reason)||Pe(a.reason)));if(o.length>0){const a=new AggregateError(o,`One or more expression executions failed. First error message: ${o[0].reason}`);throw W.getLogger(this).error(a),a}}_makeContext(e){const[t,i]=this._baseContext,n=this.feature.clone();return n.attributes=e,[{...t,$feature:n},i]}get test(){}};u([d()],A.prototype,"_asyncExecutors",null),u([d()],A.prototype,"_baseContext",null),u([d()],A.prototype,"feature",null),u([d({constructOnly:!0})],A.prototype,"preserveFieldValuesWhenHidden",void 0),u([d()],A.prototype,"executors",void 0),u([d()],A.prototype,"fieldInputs",void 0),u([d()],A.prototype,"arcadeContextInfo",void 0),A=u([$("esri.widgets.FeatureForm.FormExpressionsManager")],A);const Je=(e,t,i)=>{if(t.has(e))return;const n=Ge();t.set(e,{resolver:n,dependencyPromises:[]}),e.abort();const s=i.get(e);for(const o of s)Je(o,t,i),t.get(o).dependencyPromises.push(n.promise)},Pe=e=>e&&typeof e=="object"&&"message"in e&&e.message==="Cancelled";let k=class extends ze{constructor(e){super(e),this._expressionTrackingHandles=new Map,this.id=Ue().toString(),this.type="group"}initialize(){this.addHandles([L(()=>[this.visible,this.inputs],([e])=>{const{inputs:t}=this,i=!!e&&void 0;for(const n of t)J(n)&&(n.required=i)},{initial:!0,equals:(e,t)=>t[0]===e[0]&&t[1]===e[1]})])}destroy(){for(const e of this._expressionTrackingHandles.values())e.remove()}get initialState(){return this.element.initialState||"expanded"}get inputs(){return this._get("inputs")}set inputs(e){this.removeAllHandles(),e&&this.addHandles(e.map(t=>L(()=>t.visible,()=>this._dirtyEvaluatedVisibilityExpression()))),this._set("inputs",e)}get label(){return this.element.label}set label(e){const{element:t}=this;t&&(t.label=e)}get open(){return this.initialState==="expanded"}set open(e){this._override("open",e)}get state(){return be(W.getLogger(this),"state",{replacement:"open",version:"4.28",warnOnce:!0}),this.open?"expanded":"collapsed"}set state(e){be(W.getLogger(this),"state",{replacement:"open",version:"4.28",warnOnce:!0}),this.open=e==="expanded"}get visible(){return this.evaluatedVisibilityExpression!==!1&&this.inputs&&this.inputs.some(e=>e.visible)}_dirtyEvaluatedVisibilityExpression(){const{element:e}=this;e.visibilityExpression&&this.notifyChange("evaluatedVisibilityExpression")}};u([d()],k.prototype,"id",void 0),u([d()],k.prototype,"initialState",null),u([d()],k.prototype,"inputs",null),u([d()],k.prototype,"label",null),u([d()],k.prototype,"open",null),u([d()],k.prototype,"type",void 0),u([d()],k.prototype,"visible",null),k=u([$("esri.widgets.FeatureForm.GroupInput")],k);const li=k,ui=3;let F=class extends Nt{constructor(t){super(t),this._relationshipVM=null,this.group=null,this.type="relationship",this.addHandles([L(()=>({feature:this.feature,element:this.element,layer:this.layer}),i=>this._createRelationshipVM(i),tt),He(()=>this.relatedLayer,"edits",()=>{var i;return(i=this._relationshipVM)==null?void 0:i.refresh()})])}destroy(){var t;(t=this._relationshipVM)==null||t.destroy()}get canAddRelatedFeature(){const{editable:t,featureCount:i,relationship:n}=this;if(!n||!this.loaded||!this.relatedLayerAllowsAdds)return!1;const{cardinality:s,role:o}=n;return!(s==="one-to-one"&&i>0)&&s!=="many-to-many"&&!(s==="one-to-many"&&o==="destination"&&i>0)&&t}get displayCount(){return this.element.displayCount??ui}get displayType(){return this.element.displayType}get editable(){return!!this.relatedLayerAllowsEdits&&(this.evaluatedEditableExpression??!0)}get featureCount(){var t;return((t=this._relationshipVM)==null?void 0:t.featureCount)??0}get loaded(){var t;return((t=this._relationshipVM)==null?void 0:t.state)!=="loading"}get map(){return this._get("map")}set map(t){var i;t&&((i=this._relationshipVM)==null||i.set("map",t)),this._set("map",t)}get orderByFields(){return this.element.orderByFields}get originHasValidKey(){return!(!this.relationship||!this.feature.getAttribute(this.relationship.keyField))}get relationship(){var t;return(t=this._relationshipVM)==null?void 0:t.relationship}get relationshipId(){return this.element.relationshipId}get relatedFeatureInfos(){var r;const{_relationshipVM:t,timeZone:i}=this;if(!((r=t==null?void 0:t.relatedFeatures)!=null&&r.length)||!(t!=null&&t.relatedLayer))return[];const{itemDescriptionFieldName:n,relatedFeatures:s,relatedLayer:o}=t,a=o&&"formTemplate"in o&&o.formTemplate?o.formTemplate.title:void 0;return s.map(l=>{let c;if(n){const p=l.getAttribute(n),h=o.fieldsIndex.get(n);if(h){const y=mt({values:[p],fields:[h],timeZone:i??void 0})[n];y!=null&&(c=y.toString())}}return{feature:l,description:c,title:a?he({label:a,attributes:l.attributes,fieldsIndex:o.fieldsIndex,timeZone:i}):void 0}}).toArray()}get relatedLayer(){var t;return(t=this._relationshipVM)==null?void 0:t.relatedLayer}get relatedLayerIsTable(){var t;return!!((t=this.relatedLayer)!=null&&t.isTable)}get relatedLayerAllowsAdds(){var n;const{relatedLayer:t}=this;if(!t||!this.relatedLayerAllowsEdits)return!1;const i=Ae(t);return!!((n=i==null?void 0:i.operations)!=null&&n.supportsAdd)}get relatedLayerAllowsEdits(){var n;const{relatedLayer:t}=this;if(!t)return!1;const i=Ae(t);return!!((n=i==null?void 0:i.operations)!=null&&n.supportsEditing)}get showAllEnabled(){return this._get("showAllEnabled")}set showAllEnabled(t){var i;(i=this._relationshipVM)==null||i.set("showAllEnabled",t),this._set("showAllEnabled",t)}get showAllActionVisible(){return!this.showAllEnabled&&this.featureCount>0&&this.featureCount>this.displayCount}get visible(){const{relationship:t}=this;if(!t)return!1;const{cardinality:i}=t;return i!=="many-to-many"&&(this.evaluatedVisibilityExpression!=null?this.evaluatedVisibilityExpression:this.element!=null)}get updating(){var t,i;return((t=this._relationshipVM)==null?void 0:t.state)==="loading"||((i=this._relationshipVM)==null?void 0:i.state)==="querying"}incrementPage(){this._relationshipVM&&this._relationshipVM.featurePage++}getRelatedFeatureByObjectId(t){var i;return(i=this._relationshipVM)==null?void 0:i.getRelatedFeatureByObjectId(t)}_createRelationshipVM(t){var p;const{feature:i,element:n,layer:s}=t;if((p=this._relationshipVM)==null||p.destroy(),!i||!n||!s)return;const{displayCount:o,map:a,orderByFields:r,relationshipId:l,showAllEnabled:c}=this;Ut(s)&&(this._relationshipVM=new Gt({graphic:i,displayCount:o,layer:s,map:a,orderByFields:r,relationshipId:l,showAllEnabled:c}))}};u([d()],F.prototype,"_relationshipVM",void 0),u([d()],F.prototype,"canAddRelatedFeature",null),u([d()],F.prototype,"displayCount",null),u([d()],F.prototype,"displayType",null),u([d()],F.prototype,"editable",null),u([d()],F.prototype,"featureCount",null),u([d()],F.prototype,"group",void 0),u([d()],F.prototype,"loaded",null),u([d()],F.prototype,"map",null),u([d()],F.prototype,"orderByFields",null),u([d()],F.prototype,"originHasValidKey",null),u([d()],F.prototype,"relationship",null),u([d()],F.prototype,"relationshipId",null),u([d()],F.prototype,"relatedFeatureInfos",null),u([d()],F.prototype,"relatedLayer",null),u([d()],F.prototype,"relatedLayerIsTable",null),u([d()],F.prototype,"relatedLayerAllowsAdds",null),u([d()],F.prototype,"relatedLayerAllowsEdits",null),u([d()],F.prototype,"showAllEnabled",null),u([d()],F.prototype,"showAllActionVisible",null),u([d({readOnly:!0})],F.prototype,"type",void 0),u([d()],F.prototype,"visible",null),u([d()],F.prototype,"updating",null),F=u([$("esri.widgets.FeatureForm.RelationshipInput")],F);const di=F;let ye;const pi=["blockquote","html","hr","checkbox","table","tablerow","tablecell","image"];async function ci(e){return ye||await hi(),ye.parse(e)}async function hi(){const{Marked:e}=await V(()=>import("./marked.esm-DUoivBPJ.js"),[],import.meta.url),t=o=>`<span style="text-decoration:line-through;">${o}</span>`,i=(o,a,r)=>`<a${o!=null?` href="${o}"`:""}${a!=null?` title="${a}"`:""} target="_blank">${r??""}</a>`,n=()=>"",s={};for(const o of pi)s[o]=n;ye=new e({renderer:{del:t,link:i,...s}})}let R=class extends ze{constructor(e){super(e),this.group=null,this.id=`TextElementInput-${Ue()}`,this.type="text",this._expressionReferences=new Ht,this._expressionsUsed=new ke,this._fieldsUsed=new ke,this._literalParts=new xe,this._templateParts=new xe,this._updatingHandles=new ge}initialize(){const{rawText:e}=this;e?this.textFormat==="markdown"?this._updatingHandles.addPromise(ci(e).then(t=>this._initializeTextParts(t))):this._initializeTextParts(e):this._literalParts.push("")}get expressionsUsed(){return Array.from(this._expressionsUsed)}get fieldsIndex(){return this.layer.fieldsIndex}set fieldsIndex(e){this._overrideIfSome("fieldsIndex",e)}get fieldsUsed(){return Array.from(this._fieldsUsed)}get rawText(){return this.element.text}get text(){const e=this._templateParts.map(t=>{var i;return`${((i=this._expressionReferences.get(t))==null?void 0:i.lastEvaluatedValue)??""}`});return pt.sanitize(fi(this._literalParts,e))}get textFormat(){return this.element.textFormat}get updating(){return this._updatingHandles.updating||Array.from(this._expressionReferences.values()).some(e=>e==null?void 0:e.updating)}setExpressionExecutor(e,t){this._expressionReferences.set(we(e),t)}setFieldExecutor(e,t){this._expressionReferences.set(Ee(e),t)}_initializeTextParts(e){const{fieldsIndex:t}=this,{literals:i,templates:n}=mi(e),s=[],o=[];for(let a=0;a<n.length;a++){const r=i[a],l=ot(n[a])[0];if(ft(l))this._expressionsUsed.add(yt(l)),this._expressionReferences.set(l,null),s.push(r),o.push(l);else if(gt(l)){this._expressionsUsed.add(l);const c=we(l);this._expressionReferences.set(c,null),s.push(r),o.push(c)}else if(t!=null&&t.has(l)){const c=t.normalizeFieldName(l);this._fieldsUsed.add(c);const p=Ee(c);this._expressionReferences.set(p,null),s.push(r),o.push(p)}else i[a+1]=r.concat(l,i[a+1])}s.push(i.at(-1)),this._literalParts.addMany(s),this._templateParts.addMany(o)}};function mi(e){const t=/{[^{]+?}/g,i=[...e.matchAll(t)];let n=0;const s=[],o=[];for(const a of i){const r=a[0];s.push(e.slice(n,a.index)),o.push(r),n=a.index+r.length}return s.push(e.slice(n)),{literals:s,templates:o}}function fi(e,t){return t.reduce((i,n,s)=>i.concat(e.at(s),n),"").concat(e.at(-1))}u([d()],R.prototype,"expressionsUsed",null),u([d()],R.prototype,"fieldsIndex",null),u([d()],R.prototype,"fieldsUsed",null),u([d()],R.prototype,"group",void 0),u([d()],R.prototype,"id",void 0),u([d()],R.prototype,"rawText",null),u([d()],R.prototype,"text",null),u([d()],R.prototype,"textFormat",null),u([d()],R.prototype,"type",void 0),u([d()],R.prototype,"updating",null),R=u([$("esri.widgets.FeatureForm.TextElementInput")],R);const de=new Et({attributes:{}}),yi={field:["editableExpression","requiredExpression","valueExpression","visibilityExpression"],group:["visibilityExpression"],relationship:["editableExpression","visibilityExpression"],text:["visibilityExpression"]},gi="#JSAPI_CONTINGENT_VALUE_EMPTY_HASH",Z="#JSAPI_CONTINGENT_VALUE_ANY_HASH",_i="#JSAPI_CONTINGENT_VALUE_NULL_HASH",Ye="esri.widgets.FeatureForm.FeatureFormViewModel",Qe=()=>W.getLogger(Ye);let v=class extends Rt(Xe.EventedAccessor){constructor(e){super(e),this._expressionExecutorsInUse=new Set,this._expressionExecutorLookup=new Map,this._expressionsManager=null,this._contingentValuesCache=null,this._featureClone=de.clone(),this._initialFeature=de.clone(),this._timeZone=null,this._updatingHandles=new ge,this.arcadeEditType="NA",this.contingencyConstraintViolations=new Map,this.disabled=!1,this.highlightHelper=null,this.inputs=[],this.map=null,this.relatedRecordCallbacks=null,this.strict=!1,this.hasPendingSubtypeChoice=!1}initialize(){const e=L(()=>{var n;return[this.layer,!!((n=this.layer)!=null&&n.loaded),this.formTemplate,this.feature,this.timeZone,this.arcadeEditType]},async([n,s])=>{n!=null&&(s?this._updatingHandles.addPromise(this._updateInputs()):n.load().catch(()=>{}))},{equals:([n,s,o,a,r,l],[c,p,h,y,f,_])=>n===c&&s===p&&o===h&&a===y&&r===f&&l===_,initial:!0}),t=L(()=>this._arcadeContextInfo,n=>{this._expressionsManager!=null&&(this._expressionsManager.arcadeContextInfo=n,this._updatingHandles.addPromise(this._expressionsManager.evaluateAll().finally(()=>this._afterExpressionsEvaluated())))}),i=L(()=>this.layer,n=>{const s=(n==null?void 0:n.type)==="subtype-sublayer"?n.parent:(n==null?void 0:n.type)==="feature"?n:null;s&&this.addResolvingPromise(oi.createLoadedLayerContingentValuesCache(s).then(o=>{this._contingentValuesCache=o,this.notifyChange("fieldsWithContingentValues")}))},{initial:!0});this.addHandles([e,t,i])}destroy(){var e;this.feature=null,this.layer=null,this._contingentValuesCache=Ce(this._contingentValuesCache),(e=this.highlightHelper)==null||e.removeAll(),this._updatingHandles.destroy()}get _expressionInfosLookup(){var e,t;return new Map((t=(e=this.formTemplate)==null?void 0:e.expressionInfos)==null?void 0:t.map(i=>[i.name,i]))}get activeRelationshipInput(){return this.allRelationshipInputs.find(e=>e.relationshipId===this.relationshipId)}get _arcadeContextInfo(){const{_initialFeature:e,arcadeEditType:t,layer:i,map:n,spatialReference:s,timeZone:o}=this;return{layer:Mt(i)?i:null,originalFeature:e,editType:t,map:n,spatialReference:s,timeZone:o}}get allFieldInputs(){return _t(this.inputs)}get allGroupInputs(){return this.inputs.filter(B)}get allRelationshipInputs(){return vt(this.inputs)}get _layerFieldsByName(){var e;return new Map((e=this.layer)==null?void 0:e.fields.map(t=>[t.name,t]))}get feature(){return this._get("feature")}set feature(e){const t=this._get("feature");this._featureClone=e?e.clone():de.clone(),this._initialFeature=this._featureClone.clone(),this._expressionsManager&&(this._expressionsManager.feature=this._featureClone),e?(this._resetFieldInputValues(this._featureClone),this.allRelationshipInputs.forEach(i=>i.feature=e)):(this.inputs.forEach(i=>i.destroy()),this.inputs.length=0),t!==e&&(this.hasPendingSubtypeChoice=!1),this.contingencyConstraintViolations.clear(),this._set("feature",e)}get fieldsWithContingentValues(){if(this._contingentValuesCache==null)return new Set;const e=this._contingentValuesCache.fieldGroups.flatMap(t=>t.fields);return new Set(e)}get formTemplate(){return this.layer&&"formTemplate"in this.layer?this.layer.formTemplate:null}set formTemplate(e){e===void 0?this._clearOverride("formTemplate"):this._override("formTemplate",e)}get formDescription(){const{formTemplate:e,layer:t}=this;return e!=null&&e.description&&t?he({label:e.description,attributes:this.getValues(),fieldsIndex:t.fieldsIndex,timeZone:this.timeZone}):null}get formTitle(){const{formTemplate:e,layer:t}=this;return e!=null&&e.title&&t?he({label:e.title,attributes:this.getValues(),fieldsIndex:t.fieldsIndex,timeZone:this.timeZone}):null}get formHeaderVisible(){const{activeRelationshipInput:e,formDescription:t,formTitle:i}=this;return!(e||!t&&!i)}get joinedContingentValues(){return this._joinContingentValues()}get layer(){var e;return(e=this.feature)!=null&&e.sourceLayer&&"applyEdits"in this.feature.sourceLayer?this.feature.sourceLayer:null}set layer(e){this._override("layer",e)}get relationshipId(){return this._get("relationshipId")}set relationshipId(e){const t=this.allRelationshipInputs;if(e!=null&&e===this.relationshipId||t.forEach(i=>i.showAllEnabled=!1),e!=null){const i=t.find(n=>n.relationshipId===e);i&&(i.showAllEnabled=!0)}this._set("relationshipId",e)}get spatialReference(){var e;return((e=this.layer)==null?void 0:e.spatialReference)??null}set spatialReference(e){this._override("spatialReference",e)}get state(){var e;return(e=this.layer)!=null&&e.loaded?"ready":"disabled"}get submittable(){return!!this.valid||this.allFieldInputs.filter(e=>!e.valid).every(({submittable:e})=>e)}get timeZone(){const{layer:e}=this;if(e&&"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone)return Re;const t=e&&"preferredTimeZone"in e&&e.preferredTimeZone;return this._timeZone===Tt?t||Re:this._timeZone||$t}set timeZone(e){this._timeZone=e}get updating(){return this._updatingHandles.updating}get valid(){const e=this.allFieldInputs;return e.length>0&&e.every(({valid:t})=>t)}findField(e){return this.allFieldInputs.find(t=>t.name===e)}getFieldValueOptionsForField(e,t){var a;const i=this.findField(e);if(!i)return[[],[],[]];const n=((a=i.domain)==null?void 0:a.type)==="coded-value"?i.domain.codedValues.map(({name:r,code:l})=>({name:r,value:l})):[],s=i.value==null||n.some(r=>r.value===i.value)?[]:[{name:`${i.value}`,value:i.value}],o=this.fieldsWithContingentValues.has(e)?this._getContingentValueOptionsForField(e,t):[];if(o.length>0){const r=new Set(o.map(l=>l.value));return[o,n.filter(l=>!r.has(l.value)),s]}return[n,[],s]}getValue(e){var i;const t=(i=this.layer)==null?void 0:i.getField(e);if(t!=null)return this._featureClone.getAttribute(t.name)??null}setValue(e,t){const{_featureClone:i,strict:n}=this,s=this.findField(e);t=t===""?null:t,s&&i.getAttribute(e)!==t&&(s.value=t,n&&!s.valid||(this._afterValueChange(s),this._expressionsManager!=null&&this._updatingHandles.addPromise(this._expressionsManager.evaluateInvalidated([s.name]).finally(()=>this._afterExpressionsEvaluated()))))}getValues(){return{...this._featureClone.attributes}}overrideInitialFeature(e){this._initialFeature=e}submit(){const e=this.allFieldInputs,t=new Set(e.filter(s=>s.valid).map(({name:s})=>s)),i=e.filter(s=>!s.valid).map(({name:s})=>s),n=this.getValues();if(this.validateContingencyConstraints(n,{includeIncompleteViolations:!0}).length>0)for(const[s,o]of this.contingencyConstraintViolations.entries())o.type==="error"&&(t.delete(s),i.push(s));this.emit("submit",{valid:[...t],invalid:i,values:n})}validateContingencyConstraints(e,t){const{_contingentValuesCache:i}=this,n=new Map;if(this.contingencyConstraintViolations=n,i==null)return[];const{invalid:s,incomplete:o}=i.validateContingencyConstraints(e),a=[...s,...t!=null&&t.includeIncompleteViolations?o:[]];for(const r of a)for(const l of r.fieldGroup.fields)n.set(l,r);return a}notifyFeatureGeometryChanged(){const{_expressionsManager:e,feature:t,_featureClone:i}=this;i.geometry=t.geometry,e!=null&&this._updatingHandles.addPromise(e.evaluateInvalidatedByGeometry().finally(()=>this._afterExpressionsEvaluated()))}applySubtypeDefaults(e){const{defaultValues:t}=e,{allFieldInputs:i}=this;for(const{name:n}of i){const s=t[n];s!=null&&this.setValue(n,s)}}_emitChangeEvent({name:e,valid:t,value:i}){this.emit("value-change",{layer:this.layer,feature:this.feature,fieldName:e,value:i,valid:t})}async _updateInputs(){this._stopExpressions();const{_featureClone:e,_initialFeature:t,arcadeEditType:i,formTemplate:n,inputs:s,layer:o,timeZone:a}=this;if(!o)return;const r={arcadeEditType:i,feature:e,initialFeature:t,layer:o,timeZone:a},l=s.slice(),c=n!=null&&n.elements&&n.elements.length>0?await this._updateInputsUsingFormElements(l,n.elements,r):this._updateInputsUsingLayerFields(l,o==null?void 0:o.fields,r);this.inputs=c,await this._startExpressions()}async _updateInputsUsingFormElements(e,t,i){const n=new Map;for(const a of e)if(B(a)){n.set(a.element,a);for(const r of a.inputs)r.element&&n.set(r.element,r)}else a.element&&n.set(a.element,a);const s=new Map,o=await this._updateInputsUsingFormElementsRecursive({existingInputsByElement:n,updatedElements:t.filter(je),sharedInitializationProperties:i,group:null,newExpressionExecutorPromises:s});for(const[a,r]of n.entries())n.delete(a),r.destroy();return await Promise.all(Array.from(s.values())),o}async _updateInputsUsingFormElementsRecursive(e){const{existingInputsByElement:t,updatedElements:i,sharedInitializationProperties:n,group:s,newExpressionExecutorPromises:o}=e,a=[];for(const r of i){const l=t.has(r),c=l?t.get(r):this._makeInputFromElement(r,n,s);if(c){if(a.push(c),await Ze(()=>!c.updating),this._assignExpressionExecutors(c,r,o),l)if(t.delete(r),B(c)){const{feature:p,timeZone:h}=n;c.set({feature:p,timeZone:h})}else if(me(c)){const p=this.relationshipId===r.relationshipId;c.set(n),c.set({map:this.map,showAllEnabled:p})}else c.set(n);if($e(r)){const p=r.elements.filter(h=>je(h));c.inputs=await this._updateInputsUsingFormElementsRecursive({existingInputsByElement:t,updatedElements:p,sharedInitializationProperties:n,group:c,newExpressionExecutorPromises:o})}}}return a}_updateInputsUsingLayerFields(e,t,i){var o,a;if(!Array.isArray(t))return Qe().warn(this.declaredClass,"No attribute fields found."),[];const n=new Map;for(const r of e)if(B(r)){for(const l of r.inputs)l.destroy();r.inputs.length=0,r.destroy()}else me(r)?r.destroy():J(r)&&(r.element!==null?r.destroy():n.set(r.field,r));const s=[];for(const r of t){const l=((o=i.feature)==null?void 0:o.getAttribute(r.name))??null,c=n.get(r)??new Oe({field:r,preservesValueWhenHidden:(a=this.formTemplate)==null?void 0:a.preserveFieldValuesWhenHidden});s.push(c.set({...i,value:l})),n.delete(r)}for(const[r,l]of n.entries())n.delete(r),l.destroy();return s}_resetFieldInputValues(e){for(const t of this.allFieldInputs)t.value=e.getAttribute(t.name)}_makeInputFromElement(e,t,i){return $e(e)?vi(e,t):At(e)?this._makeFieldInputFromElement(e,t,i):kt(e)?this._makeRelationshipInputFromElement(e,t,i):Lt(e)?bi(e,t):It()}_makeFieldInputFromElement(e,t,i){var p;const{arcadeEditType:n,feature:s,initialFeature:o,layer:a,timeZone:r}=t,{fieldName:l}=e,c=l&&this._layerFieldsByName.get(l);return c?new Oe({arcadeEditType:n,element:e,field:c,value:(s==null?void 0:s.getAttribute(e.fieldName))??null,feature:s,initialFeature:o,layer:a,group:i,preservesValueWhenHidden:(p=this.formTemplate)==null?void 0:p.preserveFieldValuesWhenHidden,timeZone:r}):null}_makeRelationshipInputFromElement(e,t,i=null){const{map:n}=this,{feature:s,layer:o,timeZone:a}=t,r=new di({element:e,feature:s,group:i,layer:o,map:n,timeZone:a});return r.addHandles(He(()=>r.relatedLayer,"edits",()=>{var l;return(l=this._expressionsManager)==null?void 0:l.evaluateAsyncExpressions()})),r}_assignExpressionExecutors(e,t,i){var o;const n=yi[t.type],s=[];for(const a of n){const r=`${a}Executor`;if(e[r]){this._useExecutor(e[r]);continue}const l=t[a];if(l!=null&&l!==""){const c=((o=this._expressionInfosLookup.get(l))==null?void 0:o.expression)??l;s.push(this._getOrCreateExecutorForExpression(c,i).then(p=>{e[r]=this._useExecutor(p)}))}}return qe(e)&&s.push(...this._assignTextElementExpressionExecutors(e,i)),s}_assignTextElementExpressionExecutors(e,t){const{_expressionInfosLookup:i}=this,n=[];for(const s of e.expressionsUsed){const o=i.get(s);o!=null?n.push(this._getOrCreateExecutorForExpression(o.expression,t).then(a=>e.setExpressionExecutor(s,this._useExecutor(a)))):W.getLogger(this).error("feature-form:expression-not-found",`Could not find expressionInfo object with name '${s}'`)}for(const s of e.fieldsUsed){const o=`return $feature['${s}'];`;n.push(this._getOrCreateExecutorForExpression(o,t).then(a=>e.setFieldExecutor(s,this._useExecutor(a))))}return n}async _getOrCreateExecutorForExpression(e,t){const{_expressionExecutorLookup:i}=this;if(i.has(e))return i.get(e);if(t.has(e))return t.get(e);const n=ri(e,this.layer);t.set(e,n);const s=await n;return i.set(e,s),s}_createExpressionsManager(e){const{_arcadeContextInfo:t,_featureClone:i,allFieldInputs:n,formTemplate:s}=this;this._expressionsManager=new A({executors:e,feature:i,arcadeContextInfo:t,fieldInputs:n,preserveFieldValuesWhenHidden:(s==null?void 0:s.preserveFieldValuesWhenHidden)===!0})}async _startExpressions(){if(this._expressionExecutorsInUse.size===0)return;const e=Array.from(this._expressionExecutorsInUse);this._createExpressionsManager(e),await this._expressionsManager.evaluateAll().finally(()=>this._afterExpressionsEvaluated())}_stopExpressions(){this._expressionsManager=Ce(this._expressionsManager),this._expressionExecutorsInUse.clear()}_useExecutor(e){return this._expressionExecutorsInUse.add(e),e}_afterValueChange(e){var c;const{name:t,value:i}=e,{_featureClone:n,formTemplate:s,layer:o}=this;if(!o)return;const a=n.getAttribute(t);n.setAttribute(t,i);const{typeFieldName:r,types:l}=ce(o);if((e.isSubtypeField||t===r)&&i!==a){if(o.type==="subtype-sublayer"){const h=(c=o.parent)==null?void 0:c.findSublayerForFeature(n);n.sourceLayer=this.feature.sourceLayer=h}const p=new Set;for(const h of l)if(h.domains&&typeof h.domains=="object")for(const y of Object.keys(h.domains))p.add(y);for(const h of p){const y=this.findField(h);y&&y.notifyChange("domain")}this.notifyChange("joinedContingentValues")}if(s!=null){const{description:p,title:h}=s;h&&_e(h,t)&&this.notifyChange("formTitle"),p&&_e(p,t)&&this.notifyChange("formDescription")}this._emitChangeEvent(e)}_afterExpressionsEvaluated(){const{_featureClone:e}=this;for(const t of this.allFieldInputs)t.value!==e.getAttribute(t.name)&&this._afterValueChange(t)}_joinContingentValues(){const e=this._contingentValuesCache;if(e==null)return[];const{typeFieldName:t}=ce(this.layer),i=t?this.getValue(t):null,n=[];for(const a of e.fieldGroups){const{contingencies:r,fields:l,name:c}=a,p=[];for(const h of r)h.isRetired||h.subtype!=null&&h.subtype.code!==i||p.push({values:h.values});p.length>0&&n.push({name:c,fields:l,contingencies:p})}const[s,o]=this._generateJoinPlan(n);return[...s.flatMap(a=>this._joinFieldGroupContingencies(a)),...o.flatMap(a=>a.contingencies)]}_generateJoinPlan(e){const t=new Map,i=[],n=new Set;for(const l of e)for(const c of l.fields)if(t.has(c)){const p=t.get(c),h=l,y=[p.name,h.name].sort().join("|");if(n.has(y))continue;i.push([p,h]),n.add(y),t.set(c,h)}else t.set(c,l);const s=new Set(i.flat()),o=new Set(e);for(const l of s)o.delete(l);const a=new Map,r=new Map;for(const l of new Set(i.flat())){const c=Symbol(l.name);a.set(c,new Set([l])),r.set(l,c)}for(const[l,c]of i){const p=r.get(l),h=r.get(c);if(p===h)continue;const y=a.get(p),f=a.get(h);for(const _ of f)y.add(_),r.set(_,p);a.delete(h)}return[[...a.values()].map(l=>[...l]),[...o]]}_joinFieldGroupContingencies(e){var l,c;const t=e.slice(),i=t.shift();let n=t.shift(),s=this._generateJoinKey(i.fields,n.fields),o=new Set([...i.fields,...n.fields]),a=new Map;for(const p of i.contingencies){const[h]=this._hashContingency(p,s.codedValueFields,!0);a.has(h)?(l=a.get(h))==null||l.push(p):a.set(h,[p])}for(;t.length>0;){const p=new Map,h=t.shift(),y=this._generateJoinKey(o,h.fields);for(const f of n.contingencies){const[_,b]=this._hashContingency(f,s.codedValueFields),g=b?this._findMatchingContingenciesWithAnyHashMask(a,_):a.get(_);if(a.has(Z)&&(g==null||g.push(...this._findMatchingContingenciesContainingAny(f,a.get(Z),s.codedValueFields))),g!=null)for(const w of g){const O=s.rangeFields.length>0?this._joinContingenciesWithRangeDomains(w,f,s.rangeFields):this._joinContingencies(w,f);if(O==null)break;const[ne]=this._hashContingency(O,y.codedValueFields,!0);p.has(ne)?(c=p.get(ne))==null||c.push(O):p.set(ne,[O])}}a=p,n=h,s=y,o=new Set([...o,...n.fields])}const r=[];for(const p of n.contingencies){const[h,y]=this._hashContingency(p,s.codedValueFields),f=y?this._findMatchingContingenciesWithAnyHashMask(a,h):a.get(h);if(a.has(Z)&&f.push(...this._findMatchingContingenciesContainingAny(p,a.get(Z),s.codedValueFields)),f!=null)for(const _ of f){const b=s.rangeFields.length>0?this._joinContingenciesWithRangeDomains(_,p,s.rangeFields):this._joinContingencies(_,p);b!=null&&r.push(b)}}return r}_joinContingencies(e,t){const i={values:{...e.values,...t.values}};for(const[n,s]of Object.entries(i.values))s.objectType==="any"&&e.values[n]!=null&&(i.values[n]=e.values[n]);return i}_joinContingenciesWithRangeDomains(e,t,i){const n=this._joinContingencies(e,t);for(const s of i){const o=e.values[s],a=t.values[s],{leftIsNull:r,rightIsNull:l,bothAreNull:c,leftIsAny:p,rightIsAny:h,bothAreAny:y,leftIsRange:f,rightIsRange:_}=this._compareObjectTypes(o.objectType,a.objectType);if(c||y)continue;if(r&&h||l&&p){n.values[s]=new E({objectType:"null"});continue}if(r&&_||l&&f)return null;p?(o.minValue=-1/0,o.maxValue=1/0):h&&(a.minValue=-1/0,a.maxValue=1/0);const b=Math.max(o.minValue,a.minValue),g=Math.min(o.maxValue,a.maxValue);if(b>g)return null;n.values[s]=new E({objectType:"range",minValue:b,maxValue:g})}return n}_findMatchingContingenciesContainingAny(e,t,i){return t.filter(n=>i.every(s=>{var r,l;const o=n.values[s],a=e.values[s];return o.objectType==="any"||a.objectType==="any"||((r=o.codedValue)==null?void 0:r.code)===((l=a.codedValue)==null?void 0:l.code)}))}_findMatchingContingenciesWithAnyHashMask(e,t){const i=RegExp(`${t}$`),n=[];for(const[s,o]of e){if(s===Z)break;i.test(s)&&n.push(...o)}return n}_generateJoinKey(e,t){var l;const i=Array.isArray(e)?new Set(e):e,n=Array.isArray(t)?new Set(t):t,s=i.size<n.size?i:n,o=s===i?n:i,a=new Set,r=new Set;for(const c of s)if(o.has(c)){const p=(l=this.layer)==null?void 0:l.getFieldDomain(c,{feature:this.feature});if(p==null)continue;switch(p.type){case"coded-value":a.add(c);break;case"range":r.add(c)}}return{codedValueFields:[...a],rangeFields:[...r]}}_contingencyIsValid(e,t){const i={};for(const{name:n,value:s}of this.allFieldInputs)this.fieldsWithContingentValues.has(n)&&s!=null&&n!==e&&(i[n]=s);return Object.entries(i).every(([n,s])=>!t.values.hasOwnProperty(n)||bt(s,t.values[n]))}_getContingentValueOptionsForField(e,t){const i=this.joinedContingentValues.slice(),n=new Map,s={code:"",name:t??"No value"};for(const o of i){const a=o.values[e];if((a==null?void 0:a.objectType)==="code"||(a==null?void 0:a.objectType)==="null"){const{code:r,name:l}=a.codedValue&&a.objectType!=="null"?a.codedValue:s;!n.has(r)&&this._contingencyIsValid(e,o)&&n.set(r,{name:l,value:r})}}return[...n.values()]}_hashContingency(e,t,i=!1){var o;if(t.length<1)return[gi,!1];const n=[];let s=!1;for(const a of t){const r=e.values[a];if(r.objectType==="any"){if(i)return[Z,!0];s=!0,n.push(`${a}:.*`)}else r.objectType==="null"?n.push(`${a}:${_i}`):n.push(`${a}:${(o=r.codedValue)==null?void 0:o.code}`)}return[n.sort().join("&"),s]}_compareObjectTypes(e,t){return{leftIsNull:e==="null",rightIsNull:t==="null",bothAreNull:e==="null"&&t==="null",leftIsAny:e==="any",rightIsAny:t==="any",bothAreAny:e==="any"&&t==="any",leftIsRange:e==="range",rightIsRange:t==="range"}}};function je(e){return e.type==="field"||e.type==="group"||e.type==="relationship"||e.type==="text"||(Qe().warn("form-info::unsupported-element-type","Only element types 'field', 'group' and 'relationship' are supported",`Element ${e.label} has unsupported type '${e.type}'`),!1)}function vi(e,t){const{feature:i,layer:n}=t;return new li({element:e,inputs:[],feature:i,layer:n})}function bi(e,t,i=null){const{feature:n,layer:s,timeZone:o}=t;return new R({element:e,feature:n,group:i,layer:s,timeZone:o})}u([d()],v.prototype,"_expressionInfosLookup",null),u([d()],v.prototype,"_featureClone",void 0),u([d()],v.prototype,"_timeZone",void 0),u([d()],v.prototype,"activeRelationshipInput",null),u([d()],v.prototype,"_arcadeContextInfo",null),u([d()],v.prototype,"allFieldInputs",null),u([d()],v.prototype,"allGroupInputs",null),u([d()],v.prototype,"allRelationshipInputs",null),u([d()],v.prototype,"_layerFieldsByName",null),u([d()],v.prototype,"arcadeEditType",void 0),u([d()],v.prototype,"contingencyConstraintViolations",void 0),u([d()],v.prototype,"disabled",void 0),u([d()],v.prototype,"feature",null),u([d()],v.prototype,"fieldsWithContingentValues",null),u([d({type:Ot})],v.prototype,"formTemplate",null),u([d()],v.prototype,"formDescription",null),u([d()],v.prototype,"formTitle",null),u([d()],v.prototype,"formHeaderVisible",null),u([d()],v.prototype,"highlightHelper",void 0),u([d()],v.prototype,"inputs",void 0),u([d()],v.prototype,"joinedContingentValues",null),u([d()],v.prototype,"layer",null),u([d()],v.prototype,"map",void 0),u([d()],v.prototype,"relatedRecordCallbacks",void 0),u([d()],v.prototype,"relationshipId",null),u([d()],v.prototype,"spatialReference",null),u([d()],v.prototype,"state",null),u([d()],v.prototype,"strict",void 0),u([d()],v.prototype,"submittable",null),u([d()],v.prototype,"timeZone",null),u([d()],v.prototype,"updating",null),u([d()],v.prototype,"valid",null),u([d()],v.prototype,"hasPendingSubtypeChoice",void 0),u([d()],v.prototype,"getValues",null),u([d()],v.prototype,"submit",null),v=u([$(Ye)],v);const Ci=v,D="data-field-name";let x=class extends ct{constructor(e,t){super(e,t),this._attemptFocusOnNextRender=!1,this._dateComponentMap=new Map,this._inputsWithChanges=new Set,this._focusedFieldName=null,this._pendingSubtypeChoice=null,this._listObserverNode=null,this._listObserver=new IntersectionObserver(i=>{i.length&&i[0].isIntersecting&&this._incrementRelatedRecordPage()},{root:window.document}),this._prompt=null,this.groupDisplay="all",this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesFeature=null,this.messagesTemplates=null,this.viewModel=new Ci,this._onShowAllRelatedRecordsClick=i=>{const{feature:n,relatedRecordCallbacks:s}=this;n&&(s!=null&&s.showAllRelatedRecords)&&s.showAllRelatedRecords({parentFeature:n,relationshipId:i})},this._onAddRelatedRecordsClick=(i,n)=>{const{feature:s,relatedRecordCallbacks:o}=this;s&&(o!=null&&o.addRelatedRecord)&&o.addRelatedRecord({parentFeature:s,relatedLayer:n,relationshipId:i})},this._onFormKeyDown=this._onFormKeyDown.bind(this),this._onFormSubmit=this._onFormSubmit.bind(this),this._onGroupToggle=this._onGroupToggle.bind(this),this._onComponentBlur=this._onComponentBlur.bind(this),this._onComponentFocus=this._onComponentFocus.bind(this),this._onComponentKeyDown=this._onComponentKeyDown.bind(this),this._afterComponentCreate=this._afterComponentCreate.bind(this),this._afterComponentCreateOrUpdate=this._afterComponentCreateOrUpdate.bind(this),this._afterDateComponentCreate=this._afterDateComponentCreate.bind(this),this._afterDateComponentCreateOrUpdate=this._afterDateComponentCreateOrUpdate.bind(this),this._afterRadioGroupCreateOrUpdate=this._afterRadioGroupCreateOrUpdate.bind(this)}initialize(){this.addHandles([L(()=>this.feature,()=>{this._inputsWithChanges.clear(),this._dateComponentMap.clear(),Ze(()=>!this.viewModel.updating).then(()=>{const e=this._getFocusableInput("forward");this._syncGroupInputStates(),this._focusedFieldName=(e==null?void 0:e.name)||null,this._attemptFocusOnNextRender=!0})}),L(()=>this.groupDisplay,()=>this._syncGroupInputStates()),this.on("submit",e=>{if(e.invalid.length>0){const[t]=e.invalid;e.invalid.forEach(i=>this._inputsWithChanges.add(i)),this._focusedFieldName=t,this._attemptFocusOnNextRender=!0,this.scheduleRender()}}),L(()=>[this.viewModel.activeRelationshipInput,this._listObserverNode],()=>this._onObserverChange())])}loadDependencies(){return Be({block:()=>V(()=>import("./calcite-block-CcSPCrEC.js"),__vite__mapDeps([36,2,3,4,5,6,7,8,9,10,11,12,13,14,37,23,16,17,21,22,24,38,20,39,40,19,25,26,41,32,42,43,44,45,46,47,29]),import.meta.url),button:()=>V(()=>import("./calcite-button-BbY9lAf2.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]),import.meta.url),combobox:()=>V(()=>import("./calcite-combobox-DBG5Dw4c.js"),__vite__mapDeps([48,49,2,3,4,5,6,7,8,9,10,11,12,13,14,50,51,44,16,43,15,17,18,19,20,21,22,23,39,24,34,52,53,25,54,37,35]),import.meta.url),"combobox-item":()=>V(()=>import("./calcite-combobox-item-Dz8KyY88.js"),__vite__mapDeps([55,54,2,3,4,5,6,7,8,9,10,11,12,13,14,37,23,16,17,52,19,25]),import.meta.url),"combobox-item-group":()=>V(()=>import("./calcite-combobox-item-group-C_xpKlI1.js"),__vite__mapDeps([56,57,2,3,4,5,6,7,8,9,10,11,12,13,14,16,52]),import.meta.url),icon:()=>V(()=>import("./calcite-icon-DtUarwQp.js"),__vite__mapDeps([27,25,2,3,4,5,6,7,8,9,10,11,12,13,14,16,23]),import.meta.url),input:()=>V(()=>import("./calcite-input-p_Le978W.js"),__vite__mapDeps([58,59,2,3,4,5,6,7,8,9,10,11,12,13,14,16,15,17,22,18,19,20,21,23,24,34,60,25,35,61]),import.meta.url),"input-date-picker":()=>V(()=>import("./calcite-input-date-picker-QH0u4dYt.js"),__vite__mapDeps([62,2,3,4,5,6,7,8,9,10,11,12,13,14,21,16,22,23,43,44,15,17,18,19,20,39,24,38,25,45,34,60,35,63,61]),import.meta.url),"input-message":()=>V(()=>import("./calcite-input-message-DHYZOFye.js"),__vite__mapDeps([64,35,2,3,4,5,6,7,8,9,10,11,12,13,14,16,25,23]),import.meta.url),"input-number":()=>V(()=>import("./calcite-input-number-C7vjRhaS.js"),__vite__mapDeps([65,66,2,3,4,5,6,7,8,9,10,11,12,13,14,16,15,17,22,18,19,20,21,23,24,34,60,25,35,61]),import.meta.url),"input-time-picker":()=>V(()=>import("./calcite-input-time-picker-hyzcqWSL.js"),__vite__mapDeps([67,10,11,2,3,4,5,6,7,8,9,12,13,14,15,16,17,22,18,19,20,21,23,45,24,68,25,34,60,40,26,35,63,61,42,43,44,39,38,46]),import.meta.url),"input-time-zone":()=>V(()=>import("./calcite-input-time-zone-DQ9mtFUN.js"),__vite__mapDeps([69,10,11,2,3,4,5,6,7,8,9,12,13,14,18,16,19,17,21,22,23,24,20,15,53,25,49,50,51,44,43,39,34,52,54,37,35,57]),import.meta.url),label:()=>V(()=>import("./calcite-label-Ddcwlp7C.js"),__vite__mapDeps([30,2,3,4,5,6,7,8,9,10,11,12,13,14,18,16,19]),import.meta.url),list:()=>V(()=>import("./calcite-list-CauCCaYV.js"),__vite__mapDeps([70,2,3,4,5,6,7,8,9,10,11,12,13,14,16,17,23,71,72,20,24,21,22,51,44,25,59,15,18,19,34,60,35,61,26,29]),import.meta.url),"list-item":()=>V(()=>import("./calcite-list-item-DnfVo5id.js"),__vite__mapDeps([73,2,3,4,5,6,7,8,9,10,11,12,13,14,16,17,21,22,23,24,20,72,71,40,19,25,26,47]),import.meta.url),loader:()=>V(()=>import("./calcite-loader-Cyav0WwQ.js"),__vite__mapDeps([74,26,2,3,4,5,6,7,8,9,10,11,12,13,14,16,21,22,23]),import.meta.url),notice:()=>V(()=>import("./calcite-notice-CVdHfJFK.js"),__vite__mapDeps([75,2,3,4,5,6,7,8,9,10,11,12,13,14,37,23,16,20,21,22,24,39,19,25]),import.meta.url),"radio-button":()=>V(()=>import("./calcite-radio-button-CKaeac_E.js"),__vite__mapDeps([31,2,3,4,5,6,7,8,9,10,11,12,13,14,32,16,15,17,18,19,20]),import.meta.url),"radio-button-group":()=>V(()=>import("./calcite-radio-button-group-CoIHoOAe.js"),__vite__mapDeps([33,2,3,4,5,6,7,8,9,10,11,12,13,14,23,16,20,34,25,35]),import.meta.url),switch:()=>V(()=>import("./calcite-switch-CfyCkhzI.js"),__vite__mapDeps([76,77,2,3,4,5,6,7,8,9,10,11,12,13,14,16,15,17,22,18,19,20]),import.meta.url),"text-area":()=>V(()=>import("./calcite-text-area-C6NA6UCT.js"),__vite__mapDeps([78,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,21,22,23,20,24,17,34,60,25,35,79,44]),import.meta.url)})}destroy(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode)}get _relatedRecordsEnabled(){const e=this.relatedRecordCallbacks;return!(!e||!(e.addRelatedRecord||e.editRelatedRecord||e.showAllRelatedRecords))}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get feature(){return this.viewModel.feature}set feature(e){this.viewModel.feature=e}get formTemplate(){return this.viewModel.formTemplate}set formTemplate(e){this.viewModel.formTemplate=e}get icon(){return"form-field"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get relatedRecordCallbacks(){return this.viewModel.relatedRecordCallbacks}set relatedRecordCallbacks(e){this.viewModel.relatedRecordCallbacks=e}get relationshipId(){return this.viewModel.relationshipId}set relationshipId(e){this.viewModel.relationshipId=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get strict(){return this.viewModel.strict}set strict(e){this.viewModel.strict=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get showPrompt(){return e=>{var t,i;(i=(t=this._prompt)==null?void 0:t.cancel)==null||i.call(t),this._prompt=e}}set showPrompt(e){this._overrideIfSome("showPrompt",e)}get clearPrompt(){return()=>this._prompt=null}set clearPrompt(e){this._overrideIfSome("clearPrompt",e)}getValues(){return this.viewModel.getValues()}submit(){return this.viewModel.submit()}render(){const{state:e}=this.viewModel;return m("div",{class:this.classes(C.base,Le.widget,Le.panel)},e==="ready"?this._renderForm():null)}_renderForm(){return m("div",null,m("form",{class:C.form,novalidate:!0,onkeydown:this._onFormKeyDown,onsubmit:this._onFormSubmit},this._renderHeader(),this._renderContent()),this._prompt?m(Wt,{...this._prompt,headingLevel:this.headingLevel}):void 0)}_renderHeader(){const e=this.viewModel;if(!e.formHeaderVisible)return;const t=e.formTitle!=null&&m(We,{key:"title",level:this.headingLevel},e.formTitle),i=e.formDescription!=null&&m("p",{class:C.description,key:"description"},e.formDescription);return m("div",{class:C.formHeader},t,i)}_renderContent(){const{viewModel:e}=this;return e.activeRelationshipInput?this._renderRelationshipInput(e.activeRelationshipInput):e.inputs.filter(pe).filter(t=>t.visible).map(t=>this._renderInput(t))}_renderInput(e){return B(e)?this._renderGroup(e):J(e)?this._renderLabeledField(e):me(e)?this._renderRelationshipInput(e):qe(e)?this._renderTextElementInput(e):void 0}_renderDescriptionOrEmpty(e,t){return e==null?null:m("div",{class:this.classes(C.description),id:t},e)}_renderGroup(e){const{disabled:t,formTemplate:i,headingLevel:n}=this,{description:s,id:o,inputs:a,label:r,open:l}=e,c=a.filter(f=>f.visible),p=this.viewModel.findField(this._focusedFieldName),h=(p==null?void 0:p.group)===e,y=this.groupDisplay==="sequential";return m("calcite-block",{class:this.classes(C.group,y?C.groupSequential:null,h?C.groupActive:null,t?C.inputDisabled:null),collapsible:!0,"data-group":e,description:s||void 0,disabled:t,heading:`${r}`,headingLevel:i!=null&&i.title?ht(n):n,id:o,key:o,open:l,onCalciteBlockToggle:({target:f})=>this._onGroupToggle(f,e)},c.map(f=>this._renderInput(f)))}_getFocusableInput(e,t){const i=Ct(this.viewModel.inputs);let n;if(e==="backward"&&i.reverse(),t)if(B(t)){const s=t.inputs.find(o=>o.visible);n=s?i.indexOf(s):0}else{let s;if(oe(t)&&!t.group.open){const o=t.group.inputs.filter(J);s=e==="forward"?o[o.length-1]:o[0]}else s=t;n=i.indexOf(s)+1}else n=0;for(let s=n;s<i.length;s++){const o=i[s];if(o.visible&&J(o))return o}return null}_renderLabeledField(e){var l;const{dataType:t,feature:i,label:n,layer:s,required:o}=e,a={"aria-label":o?te(this.messages.requiredFieldLabel,{name:n}):n,class:C.label,key:`${s.id}-${i.uid}-${e.name}`},r=[m("div",{class:C.labelTextContent,key:"labelTextContainer"},n,o?m("span",{"aria-hidden":"true",title:this.messagesCommon.required},"*"):void 0),t!=="unsupported"?this._renderFieldInput(e):this._renderReadOnlyComponent(e),this._renderAuxiliaryText(e)];return t==="date"&&((l=e.domain)==null?void 0:l.type)!=="coded-value"?m("label",{...a},r):m("calcite-label",{...a},r)}_renderFieldInput(e){const{dataType:t,domain:i,inputType:n,name:s}=e,o=this.getCommonInputProps(e);if((i==null?void 0:i.type)==="coded-value"){const a=this.viewModel.getFieldValueOptionsForField(s,this.messages.empty);return n!=="switch"||e.hasInvalidSwitchValue?n==="radio-buttons"?this._renderRadioButtonComponents(e,a.flat(),o):this._renderComboBoxComponent(e,a,o):this._renderSwitchComponent(e,o)}return n==="datetime-picker"||t==="date"?this._renderDateComponents(e,o):t==="number"?this._renderNumberComponent(e,o):this._renderStringComponent(e,o)}_renderStringComponent(e,t){return e.inputType==="text-area"?t.readOnly?m("calcite-input",{...t,loading:e.updating,type:"textarea",onCalciteInputInput:i=>this._saveValueFromComponent(i.target)}):m("calcite-text-area",{...t,resize:"vertical",onCalciteTextAreaInput:i=>this._saveValueFromComponent(i.target)}):m("calcite-input",{...t,loading:e.updating,type:"text",onCalciteInputInput:i=>this._saveValueFromComponent(i.target)})}_renderNumberComponent(e,t){return m("calcite-input-number",{...t,integer:at(e.field),loading:e.updating,type:"number",onCalciteInputNumberInput:i=>this._saveValueFromComponent(i.target)})}_renderDateComponents(e,t){const{field:i}=e;switch(i.type){case"date":return this._renderDateFieldComponents(e,t);case"date-only":return this._renderDateOnlyFieldComponent(e,t);case"time-only":return this._renderTimeOnlyFieldComponent(e,t);case"timestamp-offset":return this._renderTimestampOffsetFieldComponents(e,t);default:return this._renderReadOnlyComponent(e,rt(i,t.value,{timeZone:this.timeZone,...lt(i)}))}}_renderDateOnlyFieldComponent(e,t){const{range:i,valid:n,value:s}=e,{class:o,key:a,readOnly:r}=t,{rawMax:l,rawMin:c}=i;return m("calcite-input-date-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!n,class:o,"data-date-part":"date","data-field-name":t[D],key:`${a}-date-input`,max:Ve(l)?l:void 0,min:Ve(c)?c:void 0,numberingSystem:Y,onblur:p=>{this._focusedFieldName=null,this._saveValueFromDateComponent(p.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:r,value:s!=null?`${s}`:void 0,onCalciteInputDatePickerChange:p=>this._saveValueFromDateComponent(p.target)})}_renderTimeOnlyFieldComponent(e,t){const{valid:i,value:n}=e,{class:s,key:o,readOnly:a}=t;return m("calcite-input-time-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!i,class:s,"data-date-part":"time","data-field-name":t[D],key:`${o}-time-input`,numberingSystem:Y,onblur:r=>{this._focusedFieldName=null,this._saveValueFromDateComponent(r.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:a,step:e.timeStep,value:n!=null?`${n}`:void 0,onCalciteInputTimePickerChange:r=>this._saveValueFromDateComponent(r.target)})}_renderTimestampOffsetFieldComponents(e,t){const{name:i,range:n,timeZone:s,valid:o,value:a}=e,{class:r,key:l,readOnly:c}=t,{rawMax:p,rawMin:h}=n,y={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!o,numberingSystem:Y,overlayPositioning:"fixed",readOnly:c,[D]:i,onfocus:this._onComponentFocus},f=Q(p,s),_=Q(h,s),b=Q(a,s);return m("div",{class:C.dateInputContainer,key:`${l}-date-time-container`},m("calcite-input-date-picker",{...y,class:r,"data-date-part":"date",key:`${l}-date-input`,max:(f==null?void 0:f.date)??void 0,min:(_==null?void 0:_.date)??void 0,onblur:g=>{this._focusedFieldName=null,this._saveValueFromDateComponent(g.target)},value:b.date??void 0,onCalciteInputDatePickerChange:g=>this._saveValueFromDateComponent(g.target)}),m("calcite-input-time-picker",{...y,class:r,"data-date-part":"time",key:`${l}-time-input`,onblur:g=>{this._focusedFieldName=null,this._saveValueFromDateComponent(g.target)},step:e.timeStep,value:b.time??void 0,onCalciteInputTimePickerChange:g=>this._saveValueFromDateComponent(g.target)}),e.includeTimeOffset?m("calcite-input-time-zone",{...y,class:r,"data-date-part":"timeZone",disabled:c,key:`${l}-timezone-input`,onblur:g=>{this._focusedFieldName=null,this._saveValueFromDateComponent(g.target)},value:b.timeZoneOffset??"0",onCalciteInputTimeZoneChange:g=>this._saveValueFromDateComponent(g.target)}):null)}_renderDateFieldComponents(e,t){const{includeTime:i,name:n,valid:s,value:o}=e,{class:a,key:r,max:l,min:c,readOnly:p}=t,{timeZone:h}=this,y={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!s,numberingSystem:Y,overlayPositioning:"fixed",readOnly:p,[D]:n,onfocus:this._onComponentFocus},f=X(o,h),_=X(l,h),b=X(c,h);return m("div",{class:C.dateInputContainer,key:`${r}-date-time-container`},m("calcite-input-date-picker",{...y,class:a,"data-date-part":"date",key:`${r}-date-input`,max:(_==null?void 0:_.date)??void 0,min:(b==null?void 0:b.date)??void 0,onblur:g=>{this._focusedFieldName=null,this._saveValueFromDateComponent(g.target)},value:f.date??void 0,onCalciteInputDatePickerChange:g=>this._saveValueFromDateComponent(g.target)}),i?m("calcite-input-time-picker",{...y,class:a,"data-date-part":"time",key:`${r}-time-input`,onblur:g=>{this._focusedFieldName=null,this._saveValueFromDateComponent(g.target)},step:1,value:f.time??void 0,onCalciteInputTimePickerChange:g=>this._saveValueFromDateComponent(g.target)}):null)}_renderReadOnlyComponent(e,t){const i=this.getCommonInputProps(e);return m("calcite-input",{...i,class:this.classes(C.fieldInput,C.inputDisabled),readOnly:!0,type:"text",value:t!=null?`${t}`:i.value})}_renderComboBoxComponent(e,t,i){const{value:n,name:s}=e,{viewModel:o,_inputsWithChanges:a}=this,r=o.arcadeEditType==="INSERT",l=a.has(s),c=n==null&&(!r||l),p=r&&e.showNoValueOptionEnabled&&!l?()=>{}:i.onblur;return m("calcite-combobox",{...i,allowCustomValues:!1,clearDisabled:!0,disabled:i.readOnly,onblur:p,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:({target:h})=>{c&&h.selectedItems.length===0?this._ignoreDeselectionOfNoValueOption(h):e.isSubtypeField&&h.selectedItems.length===0?h.value=`${e.value}`:this._saveValueFromComponent(h)}},this.renderComboboxOptionsList(e,t))}renderComboboxOptionsList(e,t){const{value:i,name:n}=e,{messages:s,messagesTemplates:o,viewModel:a,_inputsWithChanges:r}=this,[l,c,p]=t.map(b=>b.map(({name:g,value:w})=>m("calcite-combobox-item",{key:`#${w}`,selected:i===w,textLabel:g,value:`${w}`}))),h=[];c.length>0&&h.push(m("calcite-combobox-item-group",{key:"other",label:o.other},c)),p.length>0&&h.push(m("calcite-combobox-item-group",{key:"unsupported",label:s.subtypes.unsupportedDomainGroupTitle},p)),h.length>0?h.unshift(m("calcite-combobox-item-group",{key:"recommended",label:s.recommended},l)):h.push(...l);const y=a.arcadeEditType==="INSERT",f=r.has(n),_=i==null&&(!y||f);return e.showNoValueOptionEnabled&&h.unshift(m("calcite-combobox-item",{key:"empty-option",selected:_,textLabel:e.showNoValueLabel||s.empty,value:""})),h}_renderRadioButtonComponents(e,t,i){const{name:n,value:s}=e,o=t.map(({name:a,value:r})=>this._renderRadioButtonComponent({key:a,label:a,name:n,value:r,selected:r===s,props:i}));if(e.showNoValueOptionEnabled){const a="",r=e.showNoValueLabel||this.messages.empty,l=s===a||s===null;o.unshift(this._renderRadioButtonComponent({key:"empty-option",label:r,name:n,value:a,selected:l,props:i}))}return m("calcite-radio-button-group",{afterCreate:this._afterRadioGroupCreateOrUpdate,afterUpdate:this._afterRadioGroupCreateOrUpdate,class:C.inputRadioGroup,"data-field-name":i[D],key:`${i.key}-radio-group`,layout:"vertical",name:i.key,required:i.required},o)}_renderSwitchComponent(e,t){const{value:i}=e,n=!!Ie(e.element,"switch")&&i===e.element.input.onValue;return m("calcite-switch",{...t,checked:n,class:C.inputSwitch,disabled:t.readOnly,onblur:()=>{this._focusedFieldName=null},onCalciteSwitchChange:s=>this._saveValueFromComponent(s.target)})}_renderRadioButtonComponent({key:e,name:t,value:i,selected:n,label:s,props:o}){return m("calcite-label",{class:C.inputRadioLabel,key:e,layout:"inline"},m("calcite-radio-button",{...o,afterCreate:void 0,afterUpdate:void 0,checked:n,class:C.inputRadio,disabled:o.readOnly,name:t,onblur:()=>{this._focusedFieldName=null},value:i,onCalciteRadioButtonChange:({target:a})=>{a.checked&&this._saveValueFromComponent(a)}}),s)}_renderAuxiliaryText(e){const t=e.name,i=this._inputsWithChanges.has(t)&&!e.valid?xt(e,this.messages,this.timeZone):this.viewModel.contingencyConstraintViolations.get(t)!=null?this.messages.validationErrors.valuesIncompatible:e.valueExpressionExecutor!=null&&e.valueExpressionExecutor.stale?this.messages.valueExpressionError:null;return i!=null?m("calcite-input-message",{icon:!0,status:"invalid"},i):this._inputsWithChanges.has(t)&&e.valueIsOutOfDomain?m("calcite-input-message",{icon:!0,status:"idle"},this.messages.subtypes.fieldOutOfSubtypeDomainWarning):this._renderDescriptionOrEmpty(e.description)}_renderShowAllRelatedRecordsListItem(e){const{featureCount:t,relationshipId:i,showAllActionVisible:n}=e,{relatedRecordCallbacks:s}=this;if(!n||!(s!=null&&s.showAllRelatedRecords))return;const o=this.messages;return m("calcite-list-item",{description:te(o.totalCount,{count:t}),label:o.showAll,value:!0,onCalciteListItemSelect:()=>this._onShowAllRelatedRecordsClick(i)},m("calcite-icon",{icon:"list",scale:"s",slot:"content-end"}))}_renderAddRelatedRecordButton(e){const{canAddRelatedFeature:t,relationshipId:i,relatedLayer:n}=e,{messages:s,relatedRecordCallbacks:o}=this;if(t&&(o!=null&&o.addRelatedRecord)&&n)return m("calcite-button",{alignment:"center",appearance:"outline-fill",class:C.centeredButton,disabled:e.updating||!e.originHasValidKey,iconStart:"plus",key:`${i}-add-button`,onclick:()=>{!e.updating&&e.originHasValidKey&&this._onAddRelatedRecordsClick(i,n)},round:!0,scale:"s",width:"half"},e.relatedLayerIsTable?s.addRecord:s.addFeature)}_renderRelatedRecordListItem(e,t){const{feature:i,description:n,title:s}=e,{feature:o,relatedRecordCallbacks:a}=this,{highlightHelper:r}=this.viewModel,l=()=>{r==null||r.removeAll(),a!=null&&a.editRelatedRecord&&o&&a.editRelatedRecord({parentFeature:o,relationshipId:t,relatedFeature:i})},c=r?()=>r.add(i):void 0,p=r?()=>r.remove(i):void 0;return m("calcite-list-item",{bind:this,description:n,key:`${t}-${i.uid}`,label:s,onclick:l,onmouseenter:c,onmouseleave:p,value:s},m("calcite-icon",{icon:Vt(i),slot:"content-start"}),m("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderRelationshipInput(e){if(!this._relatedRecordsEnabled||!e.editable)return;const{featureCount:t,relationshipId:i,showAllEnabled:n}=e,s=n?null:this._renderDescriptionOrEmpty(e.description),o=t>0?this._renderRelatedRecordsList(e):e.loaded?e.originHasValidKey?this._renderNoRelatedRecordsNotice():this._renderNoValidOriginKeyNotice(e):void 0;return m("calcite-label",{class:this.classes(C.label,C.relatedRecordsLabel),key:`relationship-${i}-container`},m("div",null,this._renderRelatedRecordsHeaderContainer(e),s,o),this._renderAddRelatedRecordButton(e))}_renderRelatedRecordsHeaderContainer(e){var i;const t=e.updating||!e.loaded;return m("div",{class:C.relatedRecordsHeader,key:`relationship-${e.relationshipId}-header`},m("span",null,e.label),t?m("calcite-loader",{inline:!0,key:"loader",label:(i=this.messagesCommon)==null?void 0:i.loading,scale:"s",type:"indeterminate"}):void 0)}_renderRelatedRecordsList(e){const{relationshipId:t}=e;return m("calcite-list",{class:C.relatedRecordsList},e.relatedFeatureInfos.map(i=>this._renderRelatedRecordListItem(i,t)),this._renderShowAllRelatedRecordsListItem(e),this._renderObserverNode())}_renderNoValidOriginKeyNotice(e){var l,c,p;const{messages:t}=this,i=e.relatedLayerIsTable?t.noOriginKeyRecord:t.noOriginKeyFeature,n=(l=e.relationship)==null?void 0:l.keyField,s=this.viewModel.findField(n),o=(c=e.layer)==null?void 0:c.fieldsIndex.get(n),a=(s==null?void 0:s.label)||(o==null?void 0:o.alias)||n,r=te(i,{relatedLayerName:(p=e.relatedLayer)==null?void 0:p.title,originKeyField:a});return m("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},m("div",{slot:"message"},r))}_renderNoRelatedRecordsNotice(){return m("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},m("div",{slot:"message"},this.messagesFeature.noRelatedFeatures))}_renderObserverNode(){var e;if((e=this.viewModel.activeRelationshipInput)!=null&&e.showAllEnabled)return m("div",{afterCreate:this._afterListObserverCreated,afterRemoved:this._afterListObserverRemoved,bind:this,class:C.listObserver,key:"feature-observer"})}_renderTextElementInput(e){return m("div",{class:C.textElement,innerHTML:e.text,key:e.id})}getCommonInputProps(e){const{disabled:t}=this,{editable:i,hint:n,label:s,maxLength:o,minLength:a,name:r,range:{max:l,min:c},required:p,valid:h,value:y}=e,f=this._inputsWithChanges.has(r),_=!i||t;return{afterCreate:this._afterComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,"aria-invalid":h?"false":"true",class:this.classes(C.fieldInput,_?C.inputDisabled:null),status:f&&!h?"invalid":"idle",key:r,label:s,max:l??void 0,min:c??void 0,maxLength:o>-1?o:void 0,minLength:a>-1?a:void 0,placeholder:n??void 0,readOnly:_,required:p,value:y==null?"":`${y}`,onblur:this._onComponentBlur,onfocus:this._onComponentFocus,onkeydown:this._onComponentKeyDown,[D]:r}}_getFieldInputFromHTMLElement(e){return this.viewModel.findField(e.getAttribute(D))}_afterDateComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e),i=e.dataset.datePart,n=this._dateComponentMap.get(t.name);if("valueAsDate"in e&&e.value!=null){const s=new ResizeObserver(()=>{switch(e.value=void 0,t.field.type){case"date":e.value=X(t.value,this.timeZone).date??"";break;case"timestamp-offset":e.value=Q(t.value,this.timeZone).date??"";break;default:e.value=`${t.value}`}s.unobserve(e)});s.observe(e)}if(n!=null)switch(i){case"date":n.date=e;break;case"time":n.time=e;break;case"timeZone":n.timeZone=e}else this._dateComponentMap.set(t.name,{[i]:e});this._afterDateComponentCreateOrUpdate(e)}_afterDateComponentCreateOrUpdate(e){this._afterComponentCreateOrUpdate(e)}_afterComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e);Ft(t)&&e.value!=null&&"setNumberValue"in e&&e.setNumberValue({committing:!1,value:e.value,origin:"direct"}),this._afterComponentCreateOrUpdate(e)}_afterRadioGroupCreateOrUpdate(e){const t=e.selectedItem,i=e.querySelector("calcite-radio-button"),n=t||i;n&&this._afterComponentCreateOrUpdate(n)}_afterComponentCreateOrUpdate(e){const{viewModel:t}=this,i=this._getFieldInputFromHTMLElement(e),n=t.findField(this._focusedFieldName);this._attemptFocusOnNextRender&&n===i&&(this._attemptFocusOnNextRender=!1,oe(i)&&(i.group.open=!0),e.setFocus())}_onComponentFocus(e){const t=e.target,i=this._getFieldInputFromHTMLElement(t);this._focusedFieldName=i.name}_onComponentBlur(e){const t=e.target;this._focusedFieldName=null,this._saveValueFromComponent(t)}_saveValueFromDateComponent(e){const{timeZone:t}=this,i=this._getFieldInputFromHTMLElement(e),n=i.field.type,{name:s,range:o}=i,a=this._dateComponentMap.get(s);if(!a)return;let r=this.viewModel.getValue(s),l=null;n==="date-only"?l=Array.isArray(e.value)?e.value[0]:e.value:n==="time-only"?(r=Fe(r),l=Fe(e.value)):l=n==="timestamp-offset"?e.value!=null?ut({dateComponent:a.date,timeComponent:a.time,timeZoneComponent:a.timeZone,oldValue:r,defaultTimeZone:t}):null:e.value!=null?dt({oldValue:r,dateComponent:a.date,timeComponent:a.time,timeZone:t,max:o.max,min:o.min}):null,l!==null&&e.value?r!==l&&this._updateFieldValue(s,l):this._updateFieldValue(s,null)}_saveValueFromComponent(e){const t=this._getFieldInputFromHTMLElement(e),i=this._parseValue(e),n=t.value;t.isSubtypeField&&wt(this.layer,n,i)?this._pendingSubtypeChoice||i===n||(this._pendingSubtypeChoice=this._handleSubtypeChoice(t,i)):this._updateFieldValue(t.name,i)}async _handleSubtypeChoice(e,t){var _,b;const{value:i,name:n}=e,{layer:s,messages:o,viewModel:a,messagesCommon:r}=this;if(this._updateFieldValue(n,t),!s||!("subtypes"in s)||!((_=s.subtypes)!=null&&_.length))return;const l=s.subtypes.find(g=>g.code===t),c=((b=s.subtypes.find(g=>g.code===i))==null?void 0:b.name)??`${i}`;if(!l)return;a.hasPendingSubtypeChoice=!0;const p=Ge();let h="update-fields";const y=[{label:o.subtypes.useDefaultValuesOption,value:"update-fields"},{label:o.subtypes.keepCurrentValuesOption,value:"keep-existing"}],f={context:"info",title:o.subtypes.changeWarningTitle,message:te(o.subtypes.changeWarning,{originalType:c,newType:l.name}),radios:y,defaultRadioSelection:"update-fields",onRadioSelection:g=>h=g,actions:{primary:{label:r.apply,action:()=>p.resolve(h),type:"positive"},secondary:{label:r.cancel,type:"neutral",action:()=>p.resolve("undo")}},cancel:()=>p.reject()};try{switch(this.showPrompt(f),await p.promise){case"update-fields":a.applySubtypeDefaults(l),this._validateContingenciesForNonNullFields();break;case"keep-existing":this._validateContingenciesForNonNullFields();break;case"undo":this._updateFieldValue(e.name,i)}}finally{a.hasPendingSubtypeChoice=!1,this.clearPrompt(),this._pendingSubtypeChoice=null}}_onComponentKeyDown({key:e,target:t}){const i=this._getFieldInputFromHTMLElement(t);e==="Enter"&&oe(i)&&!i.group.open&&(i.group.open=!0)}_updateFieldValue(e,t){const i=this.viewModel.getValue(e);this.viewModel.setValue(e,t),this._inputsWithChanges.add(e),i!==t&&this.viewModel.fieldsWithContingentValues.has(e)&&this._validateContingenciesForNonNullFields()}_validateContingenciesForNonNullFields(){const e=Object.fromEntries(Object.entries(this.getValues()).filter(([t,i])=>i!=null));this.viewModel.validateContingencyConstraints(e)}_parseValue(e){const t=this._getFieldInputFromHTMLElement(e),i=e.value;return Ie(t.element,"switch")?e.checked?t.element.input.onValue:t.element.input.offValue:i==null||i===""?null:t.dataType==="number"?i==="-0"||i==="-0."||i==="-0,"?i:parseFloat(i):t.field.type==="date"?parseFloat(i):i}_ignoreDeselectionOfNoValueOption(e){const{firstChild:t,selectedItems:i}=e;i.length===0&&t&&"selected"in t?t.selected=!0:W.getLogger(this).warnOnce("Failed to override user attempt to deselect 'No value' option.")}_onGroupToggle(e,t){var i;e.open?(t.open=!0,this._focusedFieldName=((i=this._getFocusableInput("forward",t))==null?void 0:i.name)||null,this._attemptFocusOnNextRender=!0,this.groupDisplay==="sequential"&&this.viewModel.allGroupInputs.forEach(n=>{n!==t&&(n.open=!1)})):t.open=!1,this.scheduleRender()}_onFormSubmit(e){e.preventDefault()}_onFormKeyDown(e){e.key==="Enter"&&this.viewModel.submit()}_afterListObserverCreated(e){this.viewModel.activeRelationshipInput&&(this._listObserverNode=e)}_afterListObserverRemoved(){this._listObserverNode=null}_onObserverChange(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode);const e=this.viewModel.activeRelationshipInput;e&&this._listObserverNode&&e.showAllEnabled&&this._listObserver.observe(this._listObserverNode)}_incrementRelatedRecordPage(){const e=this.viewModel.activeRelationshipInput;e==null||e.incrementPage()}_syncGroupInputStates(){if(this.groupDisplay!=="sequential")return;const e=this.viewModel.allGroupInputs;if(!e.length)return;const t=e.filter(i=>i.open);t.length===0?e[0].open=!0:t.length>1&&t.slice(1).forEach(i=>i.open=!1)}get test(){return{inputsWithChanges:this._inputsWithChanges}}};u([d()],x.prototype,"_listObserverNode",void 0),u([d()],x.prototype,"_relatedRecordsEnabled",null),u([d()],x.prototype,"_prompt",void 0),u([d()],x.prototype,"disabled",null),u([d()],x.prototype,"feature",null),u([d()],x.prototype,"formTemplate",null),u([d()],x.prototype,"groupDisplay",void 0),u([d()],x.prototype,"headingLevel",void 0),u([d()],x.prototype,"icon",null),u([d()],x.prototype,"label",null),u([d()],x.prototype,"layer",null),u([d()],x.prototype,"map",null),u([d(),ee("esri/widgets/FeatureForm/t9n/FeatureForm")],x.prototype,"messages",void 0),u([d(),ee("esri/t9n/common")],x.prototype,"messagesCommon",void 0),u([d(),ee("esri/widgets/Feature/t9n/Feature")],x.prototype,"messagesFeature",void 0),u([d(),ee("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],x.prototype,"messagesTemplates",void 0),u([d()],x.prototype,"relatedRecordCallbacks",null),u([d()],x.prototype,"relationshipId",null),u([d()],x.prototype,"spatialReference",null),u([d()],x.prototype,"strict",null),u([d()],x.prototype,"timeZone",null),u([d()],x.prototype,"showPrompt",null),u([d()],x.prototype,"clearPrompt",null),u([d(),Zt(["value-change","submit"])],x.prototype,"viewModel",void 0),u([d()],x.prototype,"test",null),x=u([$("esri.widgets.FeatureForm")],x);const xi=x,ln=Object.freeze(Object.defineProperty({__proto__:null,default:xi},Symbol.toStringTag,{value:"Module"}));export{ln as F,Ci as Y,xi as Z,Bt as a,Xi as n,Wt as s};
