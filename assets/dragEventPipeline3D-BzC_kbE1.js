import"./geometry-D964gYQX.js";import{g as f,a as E,f as S}from"./screenUtils-_ZIvrt5o.js";import{n as D}from"./vec2f64-miziP1SN.js";import{r as w,s as y,_ as M,c as $,P as N,g as P,u as G}from"./vec32-Dvg_eL9J.js";import{n as c}from"./vec3f64-BLpZdpfb.js";import{$ as H}from"./projection-B971H0Re.js";import{t as T,x as I,M as U,O as A,l as h,i as F}from"./plane-IENfwZlB.js";import{b as k,M as j}from"./sphere-C77djCO6.js";import{p as q}from"./elevationInfoUtils-BC_66_Fg.js";import{g}from"./Compositing.glsl-DMM7CJmu.js";import{T as z}from"./dehydratedFeatureUtils-B--Sgpdi.js";import{e as B,i as J}from"./intersectorUtils-BK9EUwUf.js";import{w as C}from"./verticalOffsetUtils-BDQLpfho.js";import{w as K}from"./InteractiveToolBase-vg6J8uyT.js";import{j as R}from"./Point-Cg0-ChZE.js";function L(n,r){return O(n,()=>r)}function En(n){return O(n,r=>r.plane)}function O(n,r){const e=c(),o=c();let l=!1;return t=>{const a=r(t);if(t.action==="start"){const i=f(t.screenStart,E(T.get())),u=g(n.state.camera,i,x);u!=null&&(l=I(a,u,e))}if(!l)return null;const s=f(t.screenEnd,E(T.get())),d=g(n.state.camera,s,x);return d==null?null:I(a,d,o)?{...t,renderStart:e,renderEnd:o,plane:a,ray:d}:null}}function Q(n,r,e=0,o=null,l=null){let t=null;return a=>{if(a.action==="start"&&(t=n.sceneIntersectionHelper.intersectElevationFromScreen(S(a.screenStart.x,a.screenStart.y),r,e,l),t!=null&&o!=null&&!H(t,t,o))||t==null)return null;const s=n.sceneIntersectionHelper.intersectElevationFromScreen(S(a.screenEnd.x,a.screenEnd.y),r,e,l);return s!=null&&(o==null||H(s,s,o))?{...a,mapStart:t,mapEnd:s}:null}}function _(n,r,e,o=null,l=null){return Q(n,e,q(r,n,e),o,l)}function Sn(n,r,e,o){const l=e.toMap(n.screenStart);return l!=null?_(r,l,e.elevationInfo,o):null}function V(n,r){const e=b,o=v,l=U();n.renderCoordsHelper.worldUpAtPosition(r,e);const t=M(A(l),e,$(o,r,n.state.camera.eye));return M(t,t,e),h(r,t,l)}function $n(n,r,e){let o=null;const l=new K;return l.next(L(n,V(n,r))).next(W(n,r)).next(X(n,e)).next(t=>{t.mapEnd.x=t.mapStart.x,t.mapEnd.y=t.mapStart.y,o=t}),t=>(o=null,l.execute(t),o)}function W(n,r){const e=c(),o=w(r);n.renderCoordsHelper.worldUpAtPosition(r,e);const l=c(),t=c(),a=s=>($(s,s,r),F(e,s,s),n.viewingMode==="global"&&w(s)*Math.sign(N(e,s))<.001-o&&$(s,P(s,e,.001),r),G(s,s,r),s);return s=>(s.renderStart=a(y(l,s.renderStart)),s.renderEnd=a(y(t,s.renderEnd)),s)}function gn(n,r){const e=o=>{const l=f(o,E(Y)),t=g(n.state.camera,l,x);if(t==null)return null;const a=j(r,t,b,v);return a==null?void 0:a[0]};return o=>{const l=e(o.screenStart);if(l==null)return null;const t=e(o.screenEnd);return t==null?null:{...o,renderStart:l,renderEnd:t}}}function X(n,r){const e=n.renderCoordsHelper;return o=>{const l=e.fromRenderCoords(o.renderStart,new R({spatialReference:r})),t=e.fromRenderCoords(o.renderEnd,new R({spatialReference:r}));return l!=null&&t!=null?{...o,mapStart:l,mapEnd:t}:null}}var m;function Rn(n){let r=null;return e=>{switch(e.action){case"start":r=n.disableDisplay();break;case"end":case"cancel":r!=null&&(r.remove(),r=null)}return e}}function xn(n,r=null){const e=z(n.state.viewingMode);e.options.selectionMode=!0,e.options.store=B.MIN,e.options.hud=!1;const o=S(),l={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},t=c(),a=r??n.spatialReference,s=i=>{n.map.ground&&n.map.ground.opacity<1?l.exclude.add(C):l.exclude.delete(C),n.sceneIntersectionHelper.intersectIntersectorScreen(f(i,o),e,l);const u=e.results.min;let p;if(u.getIntersectionPoint(t))p=u.intersector===J.TERRAIN?m.GROUND:m.OTHER;else{if(!e.results.ground.getIntersectionPoint(t))return null;p=m.GROUND}return{location:n.renderCoordsHelper.fromRenderCoords(t,new R({spatialReference:a})),surfaceType:p}};let d;return i=>{if(i.action==="start"){const p=s(i.screenStart);d=p!=null?p.location:null}if(d==null)return null;const u=s(i.screenEnd);return(u==null?void 0:u.location)!=null?{...i,mapStart:d,mapEnd:u.location,surfaceType:u.surfaceType}:null}}(function(n){n[n.GROUND=0]="GROUND",n[n.OTHER=1]="OTHER"})(m||(m={}));const Y=D(),b=c(),v=c(),x=k();export{gn as A,xn as B,L as C,X as F,$n as G,_ as M,Sn as N,En as P,m as q,Rn as z};
