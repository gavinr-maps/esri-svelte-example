const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./calcite-block-M0XyV5ob.js","./jsxFactory-CJa39Fro.js","./tslib.es6-B3Jf3DVX.js","./intl-CChhNOV8.js","./date-DlqISzcw.js","./jsonMap-0cxwUWs2.js","./subclass-BZA_h8Db.js","./locale-C9TlLpzi.js","./messages-OmQvZhAg.js","./Accessor-BLX9ikPh.js","./assets-C43MgM-v.js","./index-Bh2oEzTI.js","./index-2kwcjS9-.css","./Evented-BHRw9x22.js","./Promise-B2Hu02L7.js","./reactiveUtils-C5zUhJQJ.js","./asyncUtils-CWX51uTe.js","./Collection-CEdjem1-.js","./shared-B3wH2qpO.js","./SimpleObservable-KocWTzVy.js","./uuid-fwrPAdZb.js","./cast-Bjksrh93.js","./conditionalSlot-R5D9krYS.js","./observers-D2xgmA06.js","./dom-D_AJDzAj.js","./interactive-y84HQRWL.js","./locale-A4FuYD8q.js","./key-D63ExP77.js","./t9n-D0ry3MEw.js","./Heading-D7P0OjYI.js","./loadable-DM18hPdE.js","./openCloseComponent-CmOrfBN-.js","./floating-ui-Bma_zPVt.js","./debounce-BOqmhDXu.js","./action-D0Er9Ef6.js","./component-6CIDVndn.js","./icon-BQO9J86c.js","./loader-C-zIPscB.js","./action-menu-C6uYzPu-.js","./array-BMcQdnYi.js","./popover-Q5ruM4hh.js","./focusTrapComponent-BSUg_DLj.js","./FloatingArrow-BBdsG5MP.js","./handle-Ct1HP3bl.js","./scrim-DPa2aeKh.js","./calcite-button-D_Agetwz.js","./button-9P4PM9SO.js","./form-BZPQ5PUM.js","./label-DEe8AW1C.js","./calcite-combobox-DZ_miEwS.js","./combobox-CAZmwDcP.js","./core-Cpfj44ZG.js","./filter-yN6-jZOU.js","./Validation-Bz9yoU6e.js","./utils2-COUKy2o1.js","./chip-ZieJjxzJ.js","./combobox-item-DwxSVkl7.js","./input-message-CWvsvdFk.js","./calcite-combobox-item-BtecfP0L.js","./calcite-combobox-item-group-CAcCi624.js","./combobox-item-group-NnuN8bnA.js","./calcite-icon-Cu0W9dtm.js","./calcite-input-DAafN6Cc.js","./input2-BReyTnf4.js","./input-j1u1wOBY.js","./progress-BXyickl_.js","./calcite-input-date-picker-BGvzpTnS.js","./input-text-uJGGrtzk.js","./calcite-input-message-Do0tN7uT.js","./calcite-input-number-BjjBFtSg.js","./input-number-BVYRKcQu.js","./calcite-input-time-picker-C41HwG-M.js","./math-CPc4dlb6.js","./calcite-input-time-zone-CARdLRL2.js","./calcite-label-B1FxWqaL.js","./calcite-list-C4jOVpC-.js","./resources4-DXHY1U7R.js","./utils3-BrU6GrkI.js","./calcite-list-item-vbKS6alm.js","./calcite-loader-DP4PIFO8.js","./calcite-notice-DSp0z_Oh.js","./resources2-DjkgwdyM.js","./calcite-radio-button-C1tLzCtg.js","./calcite-radio-button-group-D-kr_xkz.js","./calcite-switch-CkUGVtze.js","./switch-Drd7BD6R.js","./calcite-text-area-1Jz07Ix2.js","./throttle-MmodMsuz.js"])))=>i.map(i=>d[i]);
import{_ as F}from"./index-Bh2oEzTI.js";import{r as u}from"./tslib.es6-B3Jf3DVX.js";import{s as z}from"./intl-CChhNOV8.js";import{m as d,a as $,O as ue,r as ne,n as ee,Q as ye}from"./subclass-BZA_h8Db.js";import{b as P,C as ze,c as ge,L as Ne,a as je,q as _e}from"./Accessor-BLX9ikPh.js";import{watch as M,initial as Ke,on as Pe,whenOnce as Ge}from"./reactiveUtils-C5zUhJQJ.js";import{y as Je,a as Ye,I as Qe,a5 as Xe,a6 as et,k as tt,l as nt,a7 as ve,a8 as K,a9 as J,aa as Y,ab as be,ac as it,ad as st}from"./fieldUtils-tmQlKvWo.js";import{O as Ce,P as ot}from"./layerUtils-BrNoooE9.js";import{y as at,e as Q,B as rt,r as lt,n as y,w as ut}from"./jsxFactory-CJa39Fro.js";import{l as Ue,a as dt,M as xe,r as pt}from"./FieldInput-fbsOoTKd.js";import{G as de,b as q,C as ct,U as pe,$ as Ve,A as Fe,Z as ht,R as mt,w as ft,v as yt,g as H,F as gt,x as ce,O as He,J as _t,j as vt,T as ie,h as we,q as bt,B as Ct,E as xt,K as Vt}from"./featureFormUtils-Cdlj8laq.js";import{d as Ft}from"./Graphic-DsxsIjhH.js";import{n as wt}from"./compilerUtils-Dw3R0f-Z.js";import{o as Et}from"./Evented-BHRw9x22.js";import{n as It}from"./Promise-B2Hu02L7.js";import{h as fe}from"./UpdatingHandles-GfwcIh5z.js";import{n as Ee,V as Rt}from"./FeatureLayerBase-Ck7-w8TE.js";import{e as Ie,t as Tt,r as $t,n as Ot}from"./formUtils-ylzKAM7E.js";import{e as At}from"./editableLayers-Cn9dHzhB.js";import{u as kt,U as Z}from"./assets-C43MgM-v.js";import{m as Mt}from"./Loadable-BabW5Xcc.js";import{d as se}from"./arcgisLayerUrl-BX1FE5Hm.js";import{i as Re,r as Lt,o as Dt}from"./date-DlqISzcw.js";import{createArcadeProfile as St,createArcadeExecutor as Nt}from"./arcade-G0NwyxZJ.js";import{F as jt}from"./FeatureRelationshipViewModel-BPfZSJYn.js";import{K as Pt}from"./featureUtils-Do2jvOGL.js";import{V as Te}from"./Collection-CEdjem1-.js";import{s as Gt}from"./ReactiveMap-6CfRGOlR.js";import{s as $e}from"./ReactiveSet-BU2iaegS.js";import{e as Oe}from"./globalCss-CZa70j6i.js";import{e as Ut,n as Ht}from"./Heading-C-odFCu-.js";import{e as Zt}from"./vmEvent-D4Ubqkbq.js";const T="esri-feature-form",oe=`${T}__group`,G=`${T}__input`,ae=`${T}__related-records`,x={base:T,form:`${T}__form`,formHeader:`${T}__form-header`,label:`${T}__label`,labelTextContent:`${T}__label-text-content`,fieldInput:`${G}`,inputRadio:`${G}--radio`,inputRadioGroup:`${G}--radio-group`,inputRadioLabel:`${G}--radio-label`,inputDisabled:`${G}--disabled`,inputSwitch:`${G}--switch`,centeredButton:`${T}__centered-button`,description:`${T}__description-text`,listObserver:`${T}__list-observer`,relatedRecordsHeader:`${ae}_header`,relatedRecordsLabel:`${ae}_label`,relatedRecordsList:`${ae}_list`,dateInputContainer:`${`${T}__date`}-input-container`,textElement:`${T}__text-element`,group:oe,groupSequential:`${oe}--sequential`,groupActive:`${oe}--active`};let S=class extends P{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.codedValue=null}};u([d()],S.prototype,"objectType",void 0),u([d()],S.prototype,"maxValue",void 0),u([d()],S.prototype,"minValue",void 0),u([d()],S.prototype,"codedValue",void 0),S=u([$("esri.layers.support.ContingentValue")],S);const E=S;let N=class extends P{constructor(t){super(t),this.isRetired=!1}};u([d()],N.prototype,"id",void 0),u([d()],N.prototype,"isRetired",void 0),u([d()],N.prototype,"subtype",void 0),u([d()],N.prototype,"values",void 0),N=u([$("esri.layers.support.Contingency")],N);const Ae=N;let B=class extends P{constructor(t){super(t)}};u([d()],B.prototype,"fieldGroup",void 0),u([d()],B.prototype,"type",void 0),B=u([$("esri.layers.support.ContingencyConstraintViolation")],B);const ke=B;let W=class extends P{constructor(t){super(t)}};u([d()],W.prototype,"contingentValuesAllGroups",void 0),u([d()],W.prototype,"contingentValuesByFieldGroup",void 0),W=u([$("esri.layers.support.ContingentValuesResult")],W);const Bt=W;let j=class extends P{constructor(t){super(t),this.fields=null,this.isEditingRestrictive=!1}};u([d()],j.prototype,"name",void 0),u([d()],j.prototype,"fields",void 0),u([d()],j.prototype,"isEditingRestrictive",void 0),u([d()],j.prototype,"contingencies",void 0),j=u([$("esri.layers.support.FieldGroup")],j);const he=j;var X;let L=X=class extends kt(Mt){constructor(e){super(e),this.request=Z,this.fieldGroups=null,this.fieldGroupDefinitions=null}initialize(){}get subtypeFieldName(){return de(this.layer).typeFieldName}static async createLoadedLayerContingentValuesCache(e){await e.load();const t=e.sourceJSON;if(e.layerId===void 0)return null;const n=t.hasContingentValuesDefinition;if(n)return new X({layer:e}).load();if(n===void 0){const i=se(e.url);if(i==null)return null;const s=i.url.path;if((await Le(s)).supportsQueryDataElements){const o=e.layerId.toString(),a=await Me(s,o);if(a){const r=a.map(l=>({name:l.name,isEditingRestrictive:l.isEditingRestrictive,fields:l.fieldNames.names.map(c=>e.fieldsIndex.normalizeFieldName(c))}));return new X({layer:e,fieldGroupDefinitions:r}).load()}}}return null}async load(e){const t=this.layer.load(e).then(()=>this._initializeContingentValues(this.fieldGroupDefinitions,e));return this.addResolvingPromise(t),this}validateContingencyConstraints(e,t){const n=Object.keys(e),i=[],s=[];for(const o of this.fieldGroups){const a=o.isEditingRestrictive?"error":"warning";if(t&&!o.fields.some(p=>t.includes(p)))continue;if(!o.fields.every(p=>n.includes(p))){s.push(new ke({fieldGroup:o,type:a}));continue}let r=!1;const l=e[this.subtypeFieldName],c=o.contingencies.filter(p=>!(!p.isRetired&&p.subtype)||p.subtype.code===l);if(c.length!==0){for(const p of c){let h=!0;for(const f in p.values){const m=p.values[f];if(m.objectType!=="any"){if(m.objectType==="null"){if(e[f]!=null){h=!1;break}}else if(m.objectType==="code"){if(e[f]!==m.codedValue.code){h=!1;break}}else if(m.objectType==="range"){const g=e[f];if(g<m.minValue||g>m.maxValue){h=!1;break}}}}if(h){r=!0;break}}r||i.push(new ke({fieldGroup:o,type:a}))}}return{invalid:i,incomplete:s}}getContingentValues(e,t,n=!1){const i=e[this.subtypeFieldName],s=i!=null,o={};let a=[];const r=this.fieldGroups.filter(l=>l.fields.includes(t));a.push(new E({objectType:"any"}));for(const l of r){let c=[];const p=l.contingencies.filter(m=>!(m.isRetired||m.subtype&&s&&m.subtype.code!==i));let h=!1;const f={};for(const m of p){let g,b=!0;for(const _ in m.values){const w=m.values[_];if(t!==_){if(e[_]!==void 0&&w.objectType!=="any"){if(w.objectType==="null")e[_]!==null&&(b=!1);else if(w.objectType==="code")e[_]!==w.codedValue.code&&(b=!1);else if(w.objectType==="range"){const O=e[_];(O<w.minValue||O>w.maxValue)&&(b=!1)}}}else g=w,h=h||w.objectType==="range"}if(g&&b){if(g.objectType==="any"){c.length=0,c.push(g);break}const _=Wt(g);f[_]||c.push(g),f[_]=!0}}h&&(c=qt(c)),o[l.name]=c,a=n?Jt(a,c):[]}return r.length===1&&n&&(a=[]),new Bt({contingentValuesAllGroups:a,contingentValuesByFieldGroup:o})}async _initializeContingentValues(e,t){const n=e??await this._fetchFieldGroupDefs(t);if(n.length===0)return void(this.fieldGroups=[]);const i=await this._fetchContingentValues(n,t);this.fieldGroups=i}async _fetchFieldGroupDefs(e){if(this.layer.layerId===void 0)return[];const t=this.layer.sourceJSON,n=this.layer.layerId.toString(),i=se(this.layer.url).url.path;return t.hasContingentValuesDefinition?(await Yt(i,n,e)).map(s=>({name:s.name,isEditingRestrictive:s.restrictive,fields:s.fields.map(o=>this.layer.fieldsIndex.normalizeFieldName(o))})):t.hasContingentValuesDefinition!==void 0?[]:Le(i,e).then(async s=>s.supportsQueryDataElements?(await Me(i,n,e)).map(o=>({name:o.name,isEditingRestrictive:o.isEditingRestrictive,fields:o.fieldNames.names.map(a=>this.layer.fieldsIndex.normalizeFieldName(a))})):[])}async _fetchContingentValues(e,t){if(this.layer.layerId===void 0)return[];const n=this.layer.sourceJSON,i=this.layer.layerId.toString(),s=se(this.layer.url).url.path;if(n.hasContingentValuesDefinition){const a=await Xt(s,i,t);return this._constructFieldGroupsAGOL(e,a)}const o=await Qt(s,i,t);return this._constructFieldGroupsEnterprise(e,o)}_constructFieldGroupsAGOL(e,t){return e.map(n=>{const i=t.contingentValuesDefinition.fieldGroups.find(s=>s.name===n.name);if(i){let s=[];return s=t.contingentValuesDefinition.hasSubType?this._parseAGOLFieldGroupSubtype(n,t,i.subTypes):this._parseAGOLFieldGroup(n,t,i.contingentValues),new he({name:n.name,isEditingRestrictive:n.isEditingRestrictive,fields:n.fields,contingencies:s})}return null}).filter(ue)}_parseAGOLFieldGroupSubtype(e,t,n){let i=[];return n==null||n.forEach(s=>{const o=this._getSubtypeAGOL(s.name);i=i.concat(this._parseAGOLFieldGroup(e,t,s.contingentValues,o))}),i}_parseAGOLFieldGroup(e,t,n,i=null){const s=[];for(const o of n??[]){const a=this._parseAGOLContingency(o,e,t,i);s.push(a)}return s}_parseAGOLContingency(e,t,n,i){const s=e.id,o=!!e.retired&&e.retired===1,a={};for(let r=0,l=0;r<t.fields.length;r++){const c=t.fields[r],p=n.typeCodes[e.types[r]];if(p==="Code"){let h=e.values[l];l++;const f=this._getDomain(i,c),m=this.layer.getField(c);if((m==null?void 0:m.type)==="string"){const _=n.stringDicts.find(w=>w.domain===(f==null?void 0:f.name));_&&(h=_.entries[h])}const g=f==null?void 0:f.codedValues.find(_=>_.code===h),b=new E({codedValue:g,objectType:"code"});a[c]=b}else if(p==="Range"){const h=e.values[l];l++;const f=h.range[0],m=h.range[1],g=new E({minValue:f,maxValue:m,objectType:"range"});a[c]=g}else if(p==="Any"){const h=new E({objectType:"any"});a[c]=h}else{const h=new E({objectType:"null"});a[c]=h}}return new Ae({id:s,isRetired:o,subtype:i,values:a})}_constructFieldGroupsEnterprise(e,t){const n=t.fieldGroups;return e.map(i=>{const s=n.find(o=>o.name===i.name);if(s){const o=s.contingencies.map(a=>{const r=a.id,l=a.isRetired||!1,c=this._getSubtypeEnterprise(a.subtypeCode),p={};for(let h=0;h<i.fields.length;h++){const f=i.fields[h];let m=a.values[h];if(typeof m=="number"||typeof m=="string"){const g=this._getDomain(c,f),b=this.layer.getField(f);Je(b)?m=t.stringDictionary[m]:Ye(b)&&(m=new Date(`${m}+00:00`).getTime());const _=g==null?void 0:g.codedValues.find(O=>O.code===m),w=new E({codedValue:_,objectType:"code"});p[f]=w}else if(typeof m=="object"){const g=m.minValue,b=m.maxValue,_=new E({minValue:g,maxValue:b,objectType:"range"});p[f]=_}else if(m){const g=new E({objectType:"any"});p[f]=g}else{const g=new E({objectType:"null"});p[f]=g}}return new Ae({id:r,isRetired:l,subtype:c,values:p})});return new he({name:i.name,isEditingRestrictive:i.isEditingRestrictive,fields:i.fields,contingencies:o})}return null}).filter(ue)}_getSubtypeEnterprise(e){const t=this.layer.sourceJSON;let n;if(t.subtypes){const i=t.subtypes.find(s=>s.code===e);n=Ee.fromJSON(i)}return n||null}_getSubtypeAGOL(e){const t=this.layer.sourceJSON;let n;if(t.subtypes){const i=t.subtypes.find(s=>s.name===e);n=Ee.fromJSON(i)}return n||null}_getDomain(e,t){const n=e?en(e,t):this.layer.getFieldDomain(t);return(n==null?void 0:n.type)==="inherited"?this.layer.getFieldDomain(t):n}};function Wt(e){switch(e.objectType){case"any":return"@any@";case"null":return"@null@";case"code":return e.codedValue.name+e.codedValue.code.toString();case"range":return e.minValue.toString()+"-"+e.maxValue.toString()}}function qt(e){let t,n;e.sort((s,o)=>s.objectType==="null"?-1:o.objectType==="null"?1:s.minValue-o.minValue);const i=[];for(const s of e)s.objectType!=="null"?t!=null&&n!=null?n<s.minValue?(i.push(new E({objectType:"range",minValue:t,maxValue:n})),t=s.minValue,n=s.maxValue):n<s.maxValue&&(n=s.maxValue):(t=s.minValue,n=s.maxValue):i.push(s);return i.push(new E({objectType:"range",minValue:t,maxValue:n})),i}function zt(e,t){const n=[];let i,s=0;for(const o of e)for(;s<t.length;s++){const a=t[s];if(o.objectType==="null"&&a.objectType==="null")n.push(new E({objectType:"null"}));else{if(o.objectType==="null")break;if(a.objectType==="null")continue}if(o.maxValue<a.minValue)break;if(o.maxValue===a.minValue){n.push(new E({objectType:"range",minValue:o.maxValue,maxValue:a.minValue}));break}if(!(o.minValue>a.maxValue))if(o.minValue!==a.maxValue){if(i=o.minValue>a.minValue?o.minValue:a.minValue,o.maxValue<a.maxValue){n.push(new E({objectType:"range",minValue:i,maxValue:o.maxValue}));break}n.push(new E({objectType:"range",minValue:i,maxValue:a.maxValue}))}else n.push(new E({objectType:"range",minValue:o.minValue,maxValue:a.maxValue}))}return n}function Kt(e,t){const n=[];for(const i of e)t.some(s=>{if(i.objectType===s.objectType)switch(i.objectType){case"any":case"null":return!0;case"code":return i.codedValue.code===s.codedValue.code&&i.codedValue.name===s.codedValue.name}return!1})&&n.push(i);return n}function Jt(e,t){var s,o;if(e.length===0||t.length===0)return[];if(e[0].objectType==="any")return t;if(t[0].objectType==="any")return e;const n=e[0].objectType==="range"||((s=e[1])==null?void 0:s.objectType)==="range",i=t[0].objectType==="range"||((o=t[1])==null?void 0:o.objectType)==="range";return n||i?zt(e,t):Kt(e,t)}async function Yt(e,t,n){return Z(`${e}/${t}/fieldgroups`,{responseType:"json",query:{f:"json"},...n}).then(i=>i.data.fieldGroups??[])}async function Me(e,t,n){return Z(`${e}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...n}).then(i=>{var s;return((s=i.data.layerDataElements)==null?void 0:s[0].dataElement.fieldGroups)??[]})}async function Le(e,t){return Z(e,{responseType:"json",query:{f:"json"},...t}).then(n=>n.data)}async function Qt(e,t,n){return Z(`${e}/queryContingentValues`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...n}).then(i=>{var s;return(s=i.data.contingentValueSets)==null?void 0:s[0]})}async function Xt(e,t,n){return Z(`${e}/${t}/contingentValues`,{responseType:"json",query:{f:"json"},...n}).then(i=>i.data)}function en(e,t){const n=e.domains;if(n){const[i,s]=Object.entries(n).find(([o])=>o.trim().toLowerCase()===t.trim().toLowerCase())||[];return s||null}return null}u([d({constructOnly:!0})],L.prototype,"layer",void 0),u([d({constructOnly:!0})],L.prototype,"request",void 0),u([d({type:[he]})],L.prototype,"fieldGroups",void 0),u([d({constructOnly:!0})],L.prototype,"fieldGroupDefinitions",void 0),u([d()],L.prototype,"subtypeFieldName",null),L=X=u([$("esri.layers.support.LayerContingentValuesCache")],L);const tn=L;var Ze;const nn=Symbol("FormExpressionArcadeExecutor");let I=class extends P{constructor(t){super(t),this[Ze]=!0,this._lastEvaluatedValue=null,this._abortController=new AbortController,this._stale=!1,this._updatingTracking=new fe,this._executeAsyncDebounced=ze(async(n,i,s)=>{const o=await this.executor.executeAsync(n,{...i,abortSignal:s});return s.aborted?this._lastEvaluatedValue:(this._lastEvaluatedValue=o,this._stale=!1,o)})}get isAsync(){return this.executor.isAsync}get fieldsUsed(){return this.executor.fieldsUsed}get syntaxTree(){return this.executor.syntaxTree}get updating(){return this._updatingTracking.updating}get stale(){return this._stale}get geometryUsed(){return this.executor.geometryUsed}get variablesUsed(){return this.executor.variablesUsed}get lastEvaluatedValue(){return this._lastEvaluatedValue}abort(){this._abortController.abort()}execute(t,n){this._abortController=new AbortController;const i=this.executor.execute(t,{...n,abortSignal:this._abortController.signal});return this._lastEvaluatedValue=i,i}async executeAsync(t,n){return this._abortController=new AbortController,this._updatingTracking.addPromise(this._executeAsyncDebounced(t,n??{},this._abortController.signal))}markStale(){this._stale=!0}reset(){this.abort(),this._lastEvaluatedValue=null,this._stale=!1}};Ze=nn,u([d()],I.prototype,"_lastEvaluatedValue",void 0),u([d()],I.prototype,"_stale",void 0),u([d()],I.prototype,"_updatingTracking",void 0),u([d({constructOnly:!0})],I.prototype,"executor",void 0),u([d()],I.prototype,"isAsync",null),u([d()],I.prototype,"fieldsUsed",null),u([d()],I.prototype,"syntaxTree",null),u([d()],I.prototype,"updating",null),u([d()],I.prototype,"stale",null),u([d()],I.prototype,"geometryUsed",null),u([d()],I.prototype,"variablesUsed",null),u([d()],I.prototype,"lastEvaluatedValue",null),I=u([$("esri.widgets.FeatureForm.FormExpressionArcadeExecutor")],I);const sn=async(e,t)=>{const n=St("form-calculation"),i=await Nt(e,n,{});return t!=null&&t.fieldsIndex&&(i.fieldsUsed=Qe(t.fieldsIndex,i.fieldsUsed)),new I({executor:i})},re="#JSAPI_FORM_EXPRESSIONS_MANAGER_GEOMETRY";let A=class extends P{constructor(e){super(e),this._fieldReferencesLookup=new Map,this._fieldsAffectedLookup=new Map,this.preserveFieldValuesWhenHidden=!0,this._latestFieldValues={...e.feature.attributes}}initialize(){this._dependencyGraph=this._buildDependencyGraph()}destroy(){this.resetExecutors()}get _asyncExecutors(){return this.executors.filter(e=>e.isAsync)}get _baseContext(){const{editType:e,layer:t,map:n,originalFeature:i,spatialReference:s,timeZone:o}=this.arcadeContextInfo,a=(t==null?void 0:t.type)==="scene"&&t.associatedLayer!=null?t.associatedLayer:t;return[{$originalfeature:i,$editcontext:{editType:e},$layer:a,$featureset:a,$datastore:t==null?void 0:t.url,$map:n},{rawOutput:!0,spatialReference:s??void 0,timeZone:o}]}set feature(e){this._latestFieldValues={...e==null?void 0:e.attributes},this._set("feature",e)}evaluateAll(){return this._evaluate(this.executors)}evaluateAsyncExpressions(){return this._evaluate(this._asyncExecutors)}evaluateExpressions(e){return this._evaluate(e)}evaluateInvalidated(e){const{_fieldReferencesLookup:t,_latestFieldValues:n,feature:i}=this,s=new Set;for(const o of e)if(n[o]=i.getAttribute(o),t.has(o))for(const a of t.get(o))s.add(a);return this._evaluate([...s])}async evaluateInvalidatedByGeometry(){if(this._fieldReferencesLookup.has(re))return this._evaluate([...this._fieldReferencesLookup.get(re)])}resetExecutors(){for(const e of this.executors)e.reset()}_buildDependencyGraph(){var r;const{_fieldReferencesLookup:e,_fieldsAffectedLookup:t,executors:n,preserveFieldValuesWhenHidden:i}=this,s=new Map(this.fieldInputs.map(l=>[l.name,l])),o=i===!1,a=new Map(n.map(l=>[l,new Array]));for(const l of n){for(const c of l.fieldsUsed){ne(e,c,()=>new Set).add(l);const p=s.get(c);[p==null?void 0:p.valueExpressionExecutor,p==null?void 0:p.editableExpressionExecutor,o?(r=p==null?void 0:p.group)==null?void 0:r.visibilityExpressionExecutor:null,o?p==null?void 0:p.visibilityExpressionExecutor:null].filter(h=>h!=null&&h!==l).forEach(h=>{a.get(h).push(l),ne(t,h,()=>new Set).add(p)})}l.geometryUsed&&ne(e,re,()=>new Set).add(l)}return a}async _evaluate(e){const t=new Map,{_dependencyGraph:n,_fieldsAffectedLookup:i,_latestFieldValues:s}=this;for(const a of e)Be(a,t,n);for(const[a,{resolver:r,dependencyPromises:l}]of t)Promise.all(l).then(async()=>{const[c,p]=this._makeContext(s);return a.executeAsync(c,p)}).then(()=>{if(i.has(a))for(const c of i.get(a))this._latestFieldValues[c.name]=c.value;r.resolve()},c=>{!c||ge(c)||De(c)||a.markStale(),r.reject(c)});const o=(await Promise.allSettled(Array.from(t.values(),({resolver:a})=>a.promise))).filter(a=>a.status==="rejected"&&!(ge(a.reason)||De(a.reason)));if(o.length>0){const a=new AggregateError(o,`One or more expression executions failed. First error message: ${o[0].reason}`);throw ee.getLogger(this).error(a),a}}_makeContext(e){const[t,n]=this._baseContext,i=this.feature.clone();return i.attributes=e,[{...t,$feature:i},n]}get test(){}};u([d()],A.prototype,"_asyncExecutors",null),u([d()],A.prototype,"_baseContext",null),u([d()],A.prototype,"feature",null),u([d({constructOnly:!0})],A.prototype,"preserveFieldValuesWhenHidden",void 0),u([d()],A.prototype,"executors",void 0),u([d()],A.prototype,"fieldInputs",void 0),u([d()],A.prototype,"arcadeContextInfo",void 0),A=u([$("esri.widgets.FeatureForm.FormExpressionsManager")],A);const Be=(e,t,n)=>{if(t.has(e))return;const i=Ne();t.set(e,{resolver:i,dependencyPromises:[]}),e.abort();const s=n.get(e);for(const o of s)Be(o,t,n),t.get(o).dependencyPromises.push(i.promise)},De=e=>e&&typeof e=="object"&&"message"in e&&e.message==="Cancelled";let k=class extends Ue{constructor(e){super(e),this._expressionTrackingHandles=new Map,this.id=je().toString(),this.type="group"}initialize(){this.addHandles([M(()=>[this.visible,this.inputs],([e])=>{const{inputs:t}=this,n=!!e&&void 0;for(const i of t)q(i)&&(i.required=n)},{initial:!0,equals:(e,t)=>t[0]===e[0]&&t[1]===e[1]})])}destroy(){for(const e of this._expressionTrackingHandles.values())e.remove()}get initialState(){return this.element.initialState||"expanded"}get inputs(){return this._get("inputs")}set inputs(e){this.removeAllHandles(),e&&this.addHandles(e.map(t=>M(()=>t.visible,()=>this._dirtyEvaluatedVisibilityExpression()))),this._set("inputs",e)}get open(){return this.initialState==="expanded"}set open(e){this._override("open",e)}get visible(){return this.evaluatedVisibilityExpression!==!1&&this.inputs&&this.inputs.some(e=>e.visible)}_dirtyEvaluatedVisibilityExpression(){const{element:e}=this;e.visibilityExpression&&this.notifyChange("evaluatedVisibilityExpression")}};u([d()],k.prototype,"id",void 0),u([d()],k.prototype,"initialState",null),u([d()],k.prototype,"inputs",null),u([d()],k.prototype,"open",null),u([d()],k.prototype,"type",void 0),u([d()],k.prototype,"visible",null),k=u([$("esri.widgets.FeatureForm.GroupInput")],k);const on=k,an=3;let V=class extends dt{constructor(t){super(t),this._relationshipVM=null,this.group=null,this.type="relationship",this.addHandles([M(()=>({feature:this.feature,element:this.element,layer:this.layer}),n=>this._createRelationshipVM(n),Ke),Pe(()=>this.relatedLayer,"edits",()=>{var n;return(n=this._relationshipVM)==null?void 0:n.refresh()})])}destroy(){var t;(t=this._relationshipVM)==null||t.destroy()}get canAddRelatedFeature(){const{editable:t,featureCount:n,relationship:i}=this;if(!i||!this.loaded||!this.relatedLayerAllowsAdds)return!1;const{cardinality:s,role:o}=i;return!(s==="one-to-one"&&n>0)&&s!=="many-to-many"&&!(s==="one-to-many"&&o==="destination"&&n>0)&&t}get displayCount(){return this.element.displayCount??an}get displayType(){return this.element.displayType}get editable(){return!!this.relatedLayerAllowsEdits&&(this.evaluatedEditableExpression??!0)}get featureCount(){var t;return((t=this._relationshipVM)==null?void 0:t.featureCount)??0}get loaded(){var t;return((t=this._relationshipVM)==null?void 0:t.state)!=="loading"}get map(){return this._get("map")}set map(t){var n;t&&((n=this._relationshipVM)==null||n.set("map",t)),this._set("map",t)}get orderByFields(){return this.element.orderByFields}get originHasValidKey(){return!(!this.relationship||!this.feature.getAttribute(this.relationship.keyField))}get relationship(){var t;return(t=this._relationshipVM)==null?void 0:t.relationship}get relationshipId(){return this.element.relationshipId}get relatedFeatureInfos(){var r;const{_relationshipVM:t,timeZone:n}=this;if(!((r=t==null?void 0:t.relatedFeatures)!=null&&r.length)||!(t!=null&&t.relatedLayer))return[];const{itemDescriptionFieldName:i,relatedFeatures:s,relatedLayer:o}=t,a=o&&"formTemplate"in o&&o.formTemplate?o.formTemplate.title:void 0;return s.map(l=>{let c;if(i){const p=l.getAttribute(i),h=o.fieldsIndex.get(i);if(h){const f=ct({values:[p],fields:[h],timeZone:n??void 0})[i];f!=null&&(c=f.toString())}}return{feature:l,description:c,title:a?pe({label:a,attributes:l.attributes,fieldsIndex:o.fieldsIndex,timeZone:n}):void 0}}).toArray()}get relatedLayer(){var t;return(t=this._relationshipVM)==null?void 0:t.relatedLayer}get relatedLayerIsTable(){var t;return!!((t=this.relatedLayer)!=null&&t.isTable)}get relatedLayerAllowsAdds(){var i;const{relatedLayer:t}=this;if(!t||!this.relatedLayerAllowsEdits)return!1;const n=Ce(t);return!!((i=n==null?void 0:n.operations)!=null&&i.supportsAdd)}get relatedLayerAllowsEdits(){var i;const{relatedLayer:t}=this;if(!t)return!1;const n=Ce(t);return!!((i=n==null?void 0:n.operations)!=null&&i.supportsEditing)}get showAllEnabled(){return this._get("showAllEnabled")}set showAllEnabled(t){var n;(n=this._relationshipVM)==null||n.set("showAllEnabled",t),this._set("showAllEnabled",t)}get showAllActionVisible(){return!this.showAllEnabled&&this.featureCount>0&&this.featureCount>this.displayCount}get visible(){const{relationship:t}=this;if(!t)return!1;const{cardinality:n}=t;return n!=="many-to-many"&&(this.evaluatedVisibilityExpression!=null?this.evaluatedVisibilityExpression:this.element!=null)}get updating(){var t,n;return((t=this._relationshipVM)==null?void 0:t.state)==="loading"||((n=this._relationshipVM)==null?void 0:n.state)==="querying"}incrementPage(){this._relationshipVM&&this._relationshipVM.featurePage++}getRelatedFeatureByObjectId(t){var n;return(n=this._relationshipVM)==null?void 0:n.getRelatedFeatureByObjectId(t)}_createRelationshipVM(t){var p;const{feature:n,element:i,layer:s}=t;if((p=this._relationshipVM)==null||p.destroy(),!n||!i||!s)return;const{displayCount:o,map:a,orderByFields:r,relationshipId:l,showAllEnabled:c}=this;Pt(s)&&(this._relationshipVM=new jt({graphic:n,displayCount:o,layer:s,map:a,orderByFields:r,relationshipId:l,showAllEnabled:c}))}};u([d()],V.prototype,"_relationshipVM",void 0),u([d()],V.prototype,"canAddRelatedFeature",null),u([d()],V.prototype,"displayCount",null),u([d()],V.prototype,"displayType",null),u([d()],V.prototype,"editable",null),u([d()],V.prototype,"featureCount",null),u([d()],V.prototype,"group",void 0),u([d()],V.prototype,"loaded",null),u([d()],V.prototype,"map",null),u([d()],V.prototype,"orderByFields",null),u([d()],V.prototype,"originHasValidKey",null),u([d()],V.prototype,"relationship",null),u([d()],V.prototype,"relationshipId",null),u([d()],V.prototype,"relatedFeatureInfos",null),u([d()],V.prototype,"relatedLayer",null),u([d()],V.prototype,"relatedLayerIsTable",null),u([d()],V.prototype,"relatedLayerAllowsAdds",null),u([d()],V.prototype,"relatedLayerAllowsEdits",null),u([d()],V.prototype,"showAllEnabled",null),u([d()],V.prototype,"showAllActionVisible",null),u([d({readOnly:!0})],V.prototype,"type",void 0),u([d()],V.prototype,"visible",null),u([d()],V.prototype,"updating",null),V=u([$("esri.widgets.FeatureForm.RelationshipInput")],V);const rn=V;let me;const ln=["blockquote","html","hr","checkbox","table","tablerow","tablecell","image"];async function un(e){return me||await dn(),me.parse(e)}async function dn(){const{Marked:e}=await F(()=>import("./marked.esm-BqoAeEBb.js"),[],import.meta.url),t=function({text:o}){return`<span style="text-decoration:line-through;">${o}</span>`},n=function({href:o,text:a,title:r}){return`<a${o!=null?` href="${o}"`:""}${r!=null?` title="${r}"`:""} target="_blank">${a??""}</a>`},i=()=>"",s={};for(const o of ln)s[o]=i;me=new e({renderer:{del:t,link:n,...s}})}let R=class extends Ue{constructor(e){super(e),this.group=null,this.id=`TextElementInput-${je()}`,this.type="text",this._expressionReferences=new Gt,this._expressionsUsed=new $e,this._fieldsUsed=new $e,this._literalParts=new Te,this._templateParts=new Te,this._updatingHandles=new fe}initialize(){const{rawText:e}=this;e?this.textFormat==="markdown"?this._updatingHandles.addPromise(un(e).then(t=>this._initializeTextParts(t))):this._initializeTextParts(e):this._literalParts.push("")}get expressionsUsed(){return Array.from(this._expressionsUsed)}get fieldsIndex(){return this.layer.fieldsIndex}set fieldsIndex(e){this._overrideIfSome("fieldsIndex",e)}get fieldsUsed(){return Array.from(this._fieldsUsed)}get rawText(){return this.element.text}get text(){const e=this._templateParts.map(t=>{var n;return`${((n=this._expressionReferences.get(t))==null?void 0:n.lastEvaluatedValue)??""}`});return at.sanitize(cn(this._literalParts,e))}get textFormat(){return this.element.textFormat}get updating(){return this._updatingHandles.updating||Array.from(this._expressionReferences.values()).some(e=>e==null?void 0:e.updating)}setExpressionExecutor(e,t){this._expressionReferences.set(Ve(e),t)}setFieldExecutor(e,t){this._expressionReferences.set(Fe(e),t)}_initializeTextParts(e){const{fieldsIndex:t}=this,{literals:n,templates:i}=pn(e),s=[],o=[];for(let a=0;a<i.length;a++){const r=n[a],l=Xe(i[a])[0];if(ht(l))this._expressionsUsed.add(mt(l)),this._expressionReferences.set(l,null),s.push(r),o.push(l);else if(ft(l)){this._expressionsUsed.add(l);const c=Ve(l);this._expressionReferences.set(c,null),s.push(r),o.push(c)}else if(t!=null&&t.has(l)){const c=t.normalizeFieldName(l);this._fieldsUsed.add(c);const p=Fe(c);this._expressionReferences.set(p,null),s.push(r),o.push(p)}else n[a+1]=r.concat(l,n[a+1])}s.push(n.at(-1)),this._literalParts.addMany(s),this._templateParts.addMany(o)}};function pn(e){const t=/{[^{]+?}/g,n=[...e.matchAll(t)];let i=0;const s=[],o=[];for(const a of n){const r=a[0];s.push(e.slice(i,a.index)),o.push(r),i=a.index+r.length}return s.push(e.slice(i)),{literals:s,templates:o}}function cn(e,t){return t.reduce((n,i,s)=>n.concat(e.at(s),i),"").concat(e.at(-1))}u([d()],R.prototype,"expressionsUsed",null),u([d()],R.prototype,"fieldsIndex",null),u([d()],R.prototype,"fieldsUsed",null),u([d()],R.prototype,"group",void 0),u([d()],R.prototype,"id",void 0),u([d()],R.prototype,"rawText",null),u([d()],R.prototype,"text",null),u([d()],R.prototype,"textFormat",null),u([d()],R.prototype,"type",void 0),u([d()],R.prototype,"updating",null),R=u([$("esri.widgets.FeatureForm.TextElementInput")],R);const le=new Ft({attributes:{}}),hn={field:["editableExpression","requiredExpression","valueExpression","visibilityExpression"],group:["visibilityExpression"],relationship:["editableExpression","visibilityExpression"],text:["visibilityExpression"]},mn="#JSAPI_CONTINGENT_VALUE_EMPTY_HASH",U="#JSAPI_CONTINGENT_VALUE_ANY_HASH",fn="#JSAPI_CONTINGENT_VALUE_NULL_HASH",We="esri.widgets.FeatureForm.FeatureFormViewModel",qe=()=>ee.getLogger(We);let v=class extends It(Et.EventedAccessor){constructor(e){super(e),this._expressionExecutorsInUse=new Set,this._expressionExecutorLookup=new Map,this._expressionsManager=null,this._contingentValuesCache=null,this._featureClone=le.clone(),this._initialFeature=le.clone(),this._timeZone=null,this._updatingHandles=new fe,this.arcadeEditType="NA",this.contingencyConstraintViolations=new Map,this.disabled=!1,this.highlightHelper=null,this.inputs=[],this.map=null,this.relatedRecordCallbacks=null,this.strict=!1,this.hasPendingSubtypeChoice=!1}initialize(){const e=M(()=>{var i;return[this.layer,!!((i=this.layer)!=null&&i.loaded),this.formTemplate,this.feature,this.timeZone,this.arcadeEditType]},async([i,s])=>{i!=null&&(s?this._updatingHandles.addPromise(this._updateInputs()):i.load().catch(()=>{}))},{equals:([i,s,o,a,r,l],[c,p,h,f,m,g])=>i===c&&s===p&&o===h&&a===f&&r===m&&l===g,initial:!0}),t=M(()=>this._arcadeContextInfo,i=>{this._expressionsManager!=null&&(this._expressionsManager.arcadeContextInfo=i,this._updatingHandles.addPromise(this._expressionsManager.evaluateAll().finally(()=>this._afterExpressionsEvaluated())))}),n=M(()=>this.layer,i=>{const s=(i==null?void 0:i.type)==="subtype-sublayer"?i.parent:(i==null?void 0:i.type)==="feature"?i:null;s&&this.addResolvingPromise(tn.createLoadedLayerContingentValuesCache(s).then(o=>{this._contingentValuesCache=o,this.notifyChange("fieldsWithContingentValues")}))},{initial:!0});this.addHandles([e,t,n])}destroy(){var e;this.feature=null,this.layer=null,this._contingentValuesCache=_e(this._contingentValuesCache),(e=this.highlightHelper)==null||e.removeAll(),this._updatingHandles.destroy()}get _expressionInfosLookup(){var e,t;return new Map((t=(e=this.formTemplate)==null?void 0:e.expressionInfos)==null?void 0:t.map(n=>[n.name,n]))}get activeRelationshipInput(){return this.allRelationshipInputs.find(e=>e.relationshipId===this.relationshipId)}get _arcadeContextInfo(){const{_initialFeature:e,arcadeEditType:t,layer:n,map:i,spatialReference:s,timeZone:o}=this;return{layer:At(n)?n:null,originalFeature:e,editType:t,map:i,spatialReference:s,timeZone:o}}get allFieldInputs(){return yt(this.inputs)}get allGroupInputs(){return this.inputs.filter(H)}get allRelationshipInputs(){return gt(this.inputs)}get _layerFieldsByName(){var e;return new Map((e=this.layer)==null?void 0:e.fields.map(t=>[t.name,t]))}get feature(){return this._get("feature")}set feature(e){const t=this._get("feature");this._featureClone=e?e.clone():le.clone(),this._initialFeature=this._featureClone.clone(),this._expressionsManager&&(this._expressionsManager.feature=this._featureClone),e?(this._resetFieldInputValues(this._featureClone),this.allRelationshipInputs.forEach(n=>n.feature=e)):(this.inputs.forEach(n=>n.destroy()),this.inputs.length=0),t!==e&&(this.hasPendingSubtypeChoice=!1),this.contingencyConstraintViolations.clear(),this._set("feature",e)}get fieldsWithContingentValues(){if(this._contingentValuesCache==null)return new Set;const e=this._contingentValuesCache.fieldGroups.flatMap(t=>t.fields);return new Set(e)}get formTemplate(){return this.layer&&"formTemplate"in this.layer?this.layer.formTemplate:null}set formTemplate(e){e===void 0?this._clearOverride("formTemplate"):this._override("formTemplate",e)}get formDescription(){const{formTemplate:e,layer:t}=this;return e!=null&&e.description&&t?pe({label:e.description,attributes:this.getValues(),fieldsIndex:t.fieldsIndex,timeZone:this.timeZone}):null}get formTitle(){const{formTemplate:e,layer:t}=this;return e!=null&&e.title&&t?pe({label:e.title,attributes:this.getValues(),fieldsIndex:t.fieldsIndex,timeZone:this.timeZone}):null}get formHeaderVisible(){const{activeRelationshipInput:e,formDescription:t,formTitle:n}=this;return!(e||!t&&!n)}get joinedContingentValues(){return this._joinContingentValues()}get layer(){var e;return(e=this.feature)!=null&&e.sourceLayer&&"applyEdits"in this.feature.sourceLayer?this.feature.sourceLayer:null}set layer(e){this._override("layer",e)}get relationshipId(){return this._get("relationshipId")}set relationshipId(e){const t=this.allRelationshipInputs;if(e!=null&&e===this.relationshipId||t.forEach(n=>n.showAllEnabled=!1),e!=null){const n=t.find(i=>i.relationshipId===e);n&&(n.showAllEnabled=!0)}this._set("relationshipId",e)}get spatialReference(){var e;return((e=this.layer)==null?void 0:e.spatialReference)??null}set spatialReference(e){this._override("spatialReference",e)}get state(){var e;return(e=this.layer)!=null&&e.loaded?"ready":"disabled"}get submittable(){return!!this.valid||this.allFieldInputs.filter(e=>!e.valid).every(({submittable:e})=>e)}get timeZone(){const{layer:e}=this;if(e&&"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone)return Re;const t=e&&"preferredTimeZone"in e&&e.preferredTimeZone;return this._timeZone===Lt?t||Re:this._timeZone||Dt}set timeZone(e){this._timeZone=e}get updating(){return this._updatingHandles.updating}get valid(){const e=this.allFieldInputs;return e.length>0&&e.every(({valid:t})=>t)}findField(e){return this.allFieldInputs.find(t=>t.name===e)}getFieldValueOptionsForField(e,t){var a;const n=this.findField(e);if(!n)return[[],[],[]];const i=((a=n.domain)==null?void 0:a.type)==="coded-value"?n.domain.codedValues.map(({name:r,code:l})=>({name:r,value:l})):[],s=n.value==null||i.some(r=>r.value===n.value)?[]:[{name:`${n.value}`,value:n.value}],o=this.fieldsWithContingentValues.has(e)?this._getContingentValueOptionsForField(e,t):[];if(o.length>0){const r=new Set(o.map(l=>l.value));return[o,i.filter(l=>!r.has(l.value)),s]}return[i,[],s]}getValue(e){var n;const t=(n=this.layer)==null?void 0:n.getField(e);if(t!=null)return this._featureClone.getAttribute(t.name)??null}setValue(e,t){const{_featureClone:n,strict:i}=this,s=this.findField(e);t=t===""?null:t,s&&n.getAttribute(e)!==t&&(s.value=t,i&&!s.valid||(this._afterValueChange(s),this._expressionsManager!=null&&this._updatingHandles.addPromise(this._expressionsManager.evaluateInvalidated([s.name]).finally(()=>this._afterExpressionsEvaluated()))))}getValues(){return{...this._featureClone.attributes}}overrideInitialFeature(e){this._initialFeature=e}submit(){const e=this.allFieldInputs,t=new Set(e.filter(s=>s.valid).map(({name:s})=>s)),n=e.filter(s=>!s.valid).map(({name:s})=>s),i=this.getValues();if(this.validateContingencyConstraints(i,{includeIncompleteViolations:!0}).length>0)for(const[s,o]of this.contingencyConstraintViolations.entries())o.type==="error"&&(t.delete(s),n.push(s));this.emit("submit",{valid:[...t],invalid:n,values:i})}validateContingencyConstraints(e,t){const{_contingentValuesCache:n}=this,i=new Map;if(this.contingencyConstraintViolations=i,n==null)return[];const{invalid:s,incomplete:o}=n.validateContingencyConstraints(e),a=[...s,...t!=null&&t.includeIncompleteViolations?o:[]];for(const r of a)for(const l of r.fieldGroup.fields)i.set(l,r);return a}notifyFeatureGeometryChanged(){const{_expressionsManager:e,feature:t,_featureClone:n}=this;t&&(n.geometry=t.geometry,e!=null&&this._updatingHandles.addPromise(e.evaluateInvalidatedByGeometry().finally(()=>this._afterExpressionsEvaluated())))}applySubtypeDefaults(e){const{defaultValues:t}=e,{allFieldInputs:n}=this;for(const{name:i}of n){const s=t[i];s!=null&&this.setValue(i,s)}}_emitChangeEvent({name:e,valid:t,value:n}){this.emit("value-change",{layer:this.layer,feature:this.feature,fieldName:e,value:n,valid:t})}async _updateInputs(){this._stopExpressions();const{_featureClone:e,_initialFeature:t,arcadeEditType:n,formTemplate:i,inputs:s,layer:o,timeZone:a}=this;if(!o)return;const r={arcadeEditType:n,feature:e,initialFeature:t,layer:o,timeZone:a},l=s.slice(),c=i!=null&&i.elements&&i.elements.length>0?await this._updateInputsUsingFormElements(l,i.elements,r):this._updateInputsUsingLayerFields(l,o==null?void 0:o.fields,r);this.inputs=c,await this._startExpressions()}async _updateInputsUsingFormElements(e,t,n){const i=new Map;for(const a of e)if(H(a)){i.set(a.element,a);for(const r of a.inputs)r.element&&i.set(r.element,r)}else a.element&&i.set(a.element,a);const s=new Map,o=await this._updateInputsUsingFormElementsRecursive({existingInputsByElement:i,updatedElements:t.filter(Se),sharedInitializationProperties:n,group:null,newExpressionExecutorPromises:s});for(const[a,r]of i.entries())i.delete(a),r.destroy();return await Promise.all(Array.from(s.values())),o}async _updateInputsUsingFormElementsRecursive(e){const{existingInputsByElement:t,updatedElements:n,sharedInitializationProperties:i,group:s,newExpressionExecutorPromises:o}=e,a=[];for(const r of n){const l=t.has(r),c=l?t.get(r):this._makeInputFromElement(r,i,s);if(c){if(a.push(c),await Ge(()=>!c.updating),this._assignExpressionExecutors(c,r,o),l)if(t.delete(r),H(c)){const{feature:p,timeZone:h}=i;c.set({feature:p,timeZone:h})}else if(ce(c)){const p=this.relationshipId===r.relationshipId;c.set(i),c.set({map:this.map,showAllEnabled:p})}else c.set(i);if(Ie(r)){const p=r.elements.filter(h=>Se(h));c.inputs=await this._updateInputsUsingFormElementsRecursive({existingInputsByElement:t,updatedElements:p,sharedInitializationProperties:i,group:c,newExpressionExecutorPromises:o})}}}return a}_updateInputsUsingLayerFields(e,t,n){var o,a;if(!Array.isArray(t))return qe().warn(this.declaredClass,"No attribute fields found."),[];const i=new Map;for(const r of e)if(H(r)){for(const l of r.inputs)l.destroy();r.inputs.length=0,r.destroy()}else ce(r)?r.destroy():q(r)&&(r.element!==null?r.destroy():i.set(r.field,r));const s=[];for(const r of t){const l=((o=n.feature)==null?void 0:o.getAttribute(r.name))??null,c=i.get(r)??new xe({field:r,preservesValueWhenHidden:(a=this.formTemplate)==null?void 0:a.preserveFieldValuesWhenHidden});s.push(c.set({...n,value:l})),i.delete(r)}for(const[r,l]of i.entries())i.delete(r),l.destroy();return s}_resetFieldInputValues(e){for(const t of this.allFieldInputs)t.value=e.getAttribute(t.name)}_makeInputFromElement(e,t,n){return Ie(e)?yn(e,t):Tt(e)?this._makeFieldInputFromElement(e,t,n):$t(e)?this._makeRelationshipInputFromElement(e,t,n):Ot(e)?gn(e,t):wt()}_makeFieldInputFromElement(e,t,n){var p;const{arcadeEditType:i,feature:s,initialFeature:o,layer:a,timeZone:r}=t,{fieldName:l}=e,c=l&&this._layerFieldsByName.get(l);return c?new xe({arcadeEditType:i,element:e,field:c,value:(s==null?void 0:s.getAttribute(e.fieldName))??null,feature:s,initialFeature:o,layer:a,group:n,preservesValueWhenHidden:(p=this.formTemplate)==null?void 0:p.preserveFieldValuesWhenHidden,timeZone:r}):null}_makeRelationshipInputFromElement(e,t,n=null){const{map:i}=this,{feature:s,layer:o,timeZone:a}=t,r=new rn({element:e,feature:s,group:n,layer:o,map:i,timeZone:a});return r.addHandles(Pe(()=>r.relatedLayer,"edits",()=>{var l;return(l=this._expressionsManager)==null?void 0:l.evaluateAsyncExpressions()})),r}_assignExpressionExecutors(e,t,n){var o;const i=hn[t.type],s=[];for(const a of i){const r=`${a}Executor`;if(e[r]){this._useExecutor(e[r]);continue}const l=t[a];if(l!=null&&l!==""){const c=((o=this._expressionInfosLookup.get(l))==null?void 0:o.expression)??l;s.push(this._getOrCreateExecutorForExpression(c,n).then(p=>{e[r]=this._useExecutor(p)}))}}return He(e)&&s.push(...this._assignTextElementExpressionExecutors(e,n)),s}_assignTextElementExpressionExecutors(e,t){const{_expressionInfosLookup:n}=this,i=[];for(const s of e.expressionsUsed){const o=n.get(s);o!=null?i.push(this._getOrCreateExecutorForExpression(o.expression,t).then(a=>e.setExpressionExecutor(s,this._useExecutor(a)))):ee.getLogger(this).error("feature-form:expression-not-found",`Could not find expressionInfo object with name '${s}'`)}for(const s of e.fieldsUsed){const o=`return $feature['${s}'];`;i.push(this._getOrCreateExecutorForExpression(o,t).then(a=>e.setFieldExecutor(s,this._useExecutor(a))))}return i}async _getOrCreateExecutorForExpression(e,t){const{_expressionExecutorLookup:n}=this;if(n.has(e))return n.get(e);if(t.has(e))return t.get(e);const i=sn(e,this.layer);t.set(e,i);const s=await i;return n.set(e,s),s}_createExpressionsManager(e){const{_arcadeContextInfo:t,_featureClone:n,allFieldInputs:i,formTemplate:s}=this;this._expressionsManager=new A({executors:e,feature:n,arcadeContextInfo:t,fieldInputs:i,preserveFieldValuesWhenHidden:(s==null?void 0:s.preserveFieldValuesWhenHidden)===!0})}async _startExpressions(){if(this._expressionExecutorsInUse.size===0)return;const e=Array.from(this._expressionExecutorsInUse);this._createExpressionsManager(e),await this._expressionsManager.evaluateAll().finally(()=>this._afterExpressionsEvaluated())}_stopExpressions(){this._expressionsManager=_e(this._expressionsManager),this._expressionExecutorsInUse.clear()}_useExecutor(e){return this._expressionExecutorsInUse.add(e),e}_afterValueChange(e){var c;const{name:t,value:n}=e,{_featureClone:i,formTemplate:s,layer:o}=this;if(!o)return;const a=i.getAttribute(t);i.setAttribute(t,n);const{typeFieldName:r,types:l}=de(o);if((e.isSubtypeField||t===r)&&n!==a){if(o.type==="subtype-sublayer"){const h=(c=o.parent)==null?void 0:c.findSublayerForFeature(i);this.feature&&(this.feature.sourceLayer=h),i.sourceLayer=h}const p=new Set;for(const h of l)if(h.domains&&typeof h.domains=="object")for(const f of Object.keys(h.domains))p.add(f);for(const h of p){const f=this.findField(h);f&&f.notifyChange("domain")}this.notifyChange("joinedContingentValues")}if(s!=null){const{description:p,title:h}=s;h&&ye(h,t)&&this.notifyChange("formTitle"),p&&ye(p,t)&&this.notifyChange("formDescription")}this._emitChangeEvent(e)}_afterExpressionsEvaluated(){const{_featureClone:e}=this;for(const t of this.allFieldInputs)t.value!==e.getAttribute(t.name)&&this._afterValueChange(t)}_joinContingentValues(){const e=this._contingentValuesCache;if(e==null)return[];const{typeFieldName:t}=de(this.layer),n=t?this.getValue(t):null,i=[];for(const a of e.fieldGroups){const{contingencies:r,fields:l,name:c}=a,p=[];for(const h of r)h.isRetired||h.subtype!=null&&h.subtype.code!==n||p.push({values:h.values});p.length>0&&i.push({name:c,fields:l,contingencies:p})}const[s,o]=this._generateJoinPlan(i);return[...s.flatMap(a=>this._joinFieldGroupContingencies(a)),...o.flatMap(a=>a.contingencies)]}_generateJoinPlan(e){const t=new Map,n=[],i=new Set;for(const l of e)for(const c of l.fields)if(t.has(c)){const p=t.get(c),h=l,f=[p.name,h.name].sort().join("|");if(i.has(f))continue;n.push([p,h]),i.add(f),t.set(c,h)}else t.set(c,l);const s=new Set(n.flat()),o=new Set(e);for(const l of s)o.delete(l);const a=new Map,r=new Map;for(const l of new Set(n.flat())){const c=Symbol(l.name);a.set(c,new Set([l])),r.set(l,c)}for(const[l,c]of n){const p=r.get(l),h=r.get(c);if(p===h)continue;const f=a.get(p),m=a.get(h);for(const g of m)f.add(g),r.set(g,p);a.delete(h)}return[[...a.values()].map(l=>[...l]),[...o]]}_joinFieldGroupContingencies(e){var l,c;const t=e.slice(),n=t.shift();let i=t.shift(),s=this._generateJoinKey(n.fields,i.fields),o=new Set([...n.fields,...i.fields]),a=new Map;for(const p of n.contingencies){const[h]=this._hashContingency(p,s.codedValueFields,!0);a.has(h)?(l=a.get(h))==null||l.push(p):a.set(h,[p])}for(;t.length>0;){const p=new Map,h=t.shift(),f=this._generateJoinKey(o,h.fields);for(const m of i.contingencies){const[g,b]=this._hashContingency(m,s.codedValueFields),_=b?this._findMatchingContingenciesWithAnyHashMask(a,g):a.get(g);if(a.has(U)&&(_==null||_.push(...this._findMatchingContingenciesContainingAny(m,a.get(U),s.codedValueFields))),_!=null)for(const w of _){const O=s.rangeFields.length>0?this._joinContingenciesWithRangeDomains(w,m,s.rangeFields):this._joinContingencies(w,m);if(O==null)break;const[te]=this._hashContingency(O,f.codedValueFields,!0);p.has(te)?(c=p.get(te))==null||c.push(O):p.set(te,[O])}}a=p,i=h,s=f,o=new Set([...o,...i.fields])}const r=[];for(const p of i.contingencies){const[h,f]=this._hashContingency(p,s.codedValueFields),m=f?this._findMatchingContingenciesWithAnyHashMask(a,h):a.get(h);if(a.has(U)&&m.push(...this._findMatchingContingenciesContainingAny(p,a.get(U),s.codedValueFields)),m!=null)for(const g of m){const b=s.rangeFields.length>0?this._joinContingenciesWithRangeDomains(g,p,s.rangeFields):this._joinContingencies(g,p);b!=null&&r.push(b)}}return r}_joinContingencies(e,t){const n={values:{...e.values,...t.values}};for(const[i,s]of Object.entries(n.values))s.objectType==="any"&&e.values[i]!=null&&(n.values[i]=e.values[i]);return n}_joinContingenciesWithRangeDomains(e,t,n){const i=this._joinContingencies(e,t);for(const s of n){const o=e.values[s],a=t.values[s],{leftIsNull:r,rightIsNull:l,bothAreNull:c,leftIsAny:p,rightIsAny:h,bothAreAny:f,leftIsRange:m,rightIsRange:g}=this._compareObjectTypes(o.objectType,a.objectType);if(c||f)continue;if(r&&h||l&&p){i.values[s]=new E({objectType:"null"});continue}if(r&&g||l&&m)return null;p?(o.minValue=-1/0,o.maxValue=1/0):h&&(a.minValue=-1/0,a.maxValue=1/0);const b=Math.max(o.minValue,a.minValue),_=Math.min(o.maxValue,a.maxValue);if(b>_)return null;i.values[s]=new E({objectType:"range",minValue:b,maxValue:_})}return i}_findMatchingContingenciesContainingAny(e,t,n){return t.filter(i=>n.every(s=>{var r,l;const o=i.values[s],a=e.values[s];return o.objectType==="any"||a.objectType==="any"||((r=o.codedValue)==null?void 0:r.code)===((l=a.codedValue)==null?void 0:l.code)}))}_findMatchingContingenciesWithAnyHashMask(e,t){const n=RegExp(`${t}$`),i=[];for(const[s,o]of e){if(s===U)break;n.test(s)&&i.push(...o)}return i}_generateJoinKey(e,t){var c;const n=Array.isArray(e)?new Set(e):e,i=Array.isArray(t)?new Set(t):t,s=n.size<i.size?n:i,o=s===n?i:n,{feature:a}=this,r=new Set,l=new Set;for(const p of s)if(o.has(p)){const h=(c=this.layer)==null?void 0:c.getFieldDomain(p,{feature:a??void 0,excludeImpliedDomains:!0});if(h==null)continue;switch(h.type){case"coded-value":r.add(p);break;case"range":l.add(p)}}return{codedValueFields:[...r],rangeFields:[...l]}}_contingencyIsValid(e,t){const n={};for(const{name:i,value:s}of this.allFieldInputs)this.fieldsWithContingentValues.has(i)&&s!=null&&i!==e&&(n[i]=s);return Object.entries(n).every(([i,s])=>!t.values.hasOwnProperty(i)||_t(s,t.values[i]))}_getContingentValueOptionsForField(e,t){const n=this.joinedContingentValues.slice(),i=new Map,s={code:"",name:t??"No value"};for(const o of n){const a=o.values[e];if((a==null?void 0:a.objectType)==="code"||(a==null?void 0:a.objectType)==="null"){const{code:r,name:l}=a.codedValue&&a.objectType!=="null"?a.codedValue:s;!i.has(r)&&this._contingencyIsValid(e,o)&&i.set(r,{name:l,value:r})}}return[...i.values()]}_hashContingency(e,t,n=!1){var o;if(t.length<1)return[mn,!1];const i=[];let s=!1;for(const a of t){const r=e.values[a];if(r.objectType==="any"){if(n)return[U,!0];s=!0,i.push(`${a}:.*`)}else r.objectType==="null"?i.push(`${a}:${fn}`):i.push(`${a}:${(o=r.codedValue)==null?void 0:o.code}`)}return[i.sort().join("&"),s]}_compareObjectTypes(e,t){return{leftIsNull:e==="null",rightIsNull:t==="null",bothAreNull:e==="null"&&t==="null",leftIsAny:e==="any",rightIsAny:t==="any",bothAreAny:e==="any"&&t==="any",leftIsRange:e==="range",rightIsRange:t==="range"}}get test(){return{featureClone:this._featureClone}}};function Se(e){return e.type==="field"||e.type==="group"||e.type==="relationship"||e.type==="text"||(qe().warn("form-info::unsupported-element-type","Only element types 'field', 'group' and 'relationship' are supported",`Element ${e.label} has unsupported type '${e.type}'`),!1)}function yn(e,t){const{feature:n,layer:i}=t;return new on({element:e,inputs:[],feature:n,layer:i})}function gn(e,t,n=null){const{feature:i,layer:s,timeZone:o}=t;return new R({element:e,feature:i,group:n,layer:s,timeZone:o})}u([d()],v.prototype,"_expressionInfosLookup",null),u([d()],v.prototype,"_featureClone",void 0),u([d()],v.prototype,"_timeZone",void 0),u([d()],v.prototype,"activeRelationshipInput",null),u([d()],v.prototype,"_arcadeContextInfo",null),u([d()],v.prototype,"allFieldInputs",null),u([d()],v.prototype,"allGroupInputs",null),u([d()],v.prototype,"allRelationshipInputs",null),u([d()],v.prototype,"_layerFieldsByName",null),u([d()],v.prototype,"arcadeEditType",void 0),u([d()],v.prototype,"contingencyConstraintViolations",void 0),u([d()],v.prototype,"disabled",void 0),u([d()],v.prototype,"feature",null),u([d()],v.prototype,"fieldsWithContingentValues",null),u([d({type:Rt})],v.prototype,"formTemplate",null),u([d()],v.prototype,"formDescription",null),u([d()],v.prototype,"formTitle",null),u([d()],v.prototype,"formHeaderVisible",null),u([d()],v.prototype,"highlightHelper",void 0),u([d()],v.prototype,"inputs",void 0),u([d()],v.prototype,"joinedContingentValues",null),u([d()],v.prototype,"layer",null),u([d()],v.prototype,"map",void 0),u([d()],v.prototype,"relatedRecordCallbacks",void 0),u([d()],v.prototype,"relationshipId",null),u([d()],v.prototype,"spatialReference",null),u([d()],v.prototype,"state",null),u([d()],v.prototype,"strict",void 0),u([d()],v.prototype,"submittable",null),u([d()],v.prototype,"timeZone",null),u([d()],v.prototype,"updating",null),u([d()],v.prototype,"valid",null),u([d()],v.prototype,"hasPendingSubtypeChoice",void 0),u([d()],v.prototype,"getValues",null),u([d()],v.prototype,"submit",null),u([d()],v.prototype,"test",null),v=u([$(We)],v);const _n=v,D="data-field-name";let C=class extends rt{constructor(e,t){super(e,t),this._attemptFocusOnNextRender=!1,this._dateComponentMap=new Map,this._inputsWithChanges=new Set,this._focusedFieldName=null,this._pendingSubtypeChoice=null,this._listObserverNode=null,this._listObserver=new IntersectionObserver(n=>{n.length&&n[0].isIntersecting&&this._incrementRelatedRecordPage()},{root:window.document}),this._prompt=null,this.groupDisplay="all",this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesFeature=null,this.messagesTemplates=null,this.viewModel=new _n,this._onShowAllRelatedRecordsClick=n=>{const{feature:i,relatedRecordCallbacks:s}=this;i&&(s!=null&&s.showAllRelatedRecords)&&s.showAllRelatedRecords({parentFeature:i,relationshipId:n})},this._onAddRelatedRecordsClick=(n,i)=>{const{feature:s,relatedRecordCallbacks:o}=this;s&&(o!=null&&o.addRelatedRecord)&&o.addRelatedRecord({parentFeature:s,relatedLayer:i,relationshipId:n})},this._onFormKeyDown=this._onFormKeyDown.bind(this),this._onFormSubmit=this._onFormSubmit.bind(this),this._onGroupToggle=this._onGroupToggle.bind(this),this._onComponentBlur=this._onComponentBlur.bind(this),this._onComponentFocus=this._onComponentFocus.bind(this),this._onComponentKeyDown=this._onComponentKeyDown.bind(this),this._afterComponentCreate=this._afterComponentCreate.bind(this),this._afterComponentCreateOrUpdate=this._afterComponentCreateOrUpdate.bind(this),this._afterDateComponentCreate=this._afterDateComponentCreate.bind(this),this._afterDateComponentCreateOrUpdate=this._afterDateComponentCreateOrUpdate.bind(this),this._afterRadioGroupCreateOrUpdate=this._afterRadioGroupCreateOrUpdate.bind(this)}initialize(){this.addHandles([M(()=>this.feature,()=>{this._inputsWithChanges.clear(),this._dateComponentMap.clear(),Ge(()=>!this.viewModel.updating).then(()=>{const e=this._getFocusableInput("forward");this._syncGroupInputStates(),this._focusedFieldName=(e==null?void 0:e.name)||null,this._attemptFocusOnNextRender=!0})}),M(()=>this.groupDisplay,()=>this._syncGroupInputStates()),this.on("submit",e=>{if(e.invalid.length>0){const[t]=e.invalid;e.invalid.forEach(n=>this._inputsWithChanges.add(n)),this._focusedFieldName=t,this._attemptFocusOnNextRender=!0,this.scheduleRender()}}),M(()=>[this.viewModel.activeRelationshipInput,this._listObserverNode],()=>this._onObserverChange())])}loadDependencies(){return lt({block:()=>F(()=>import("./calcite-block-M0XyV5ob.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44]),import.meta.url),button:()=>F(()=>import("./calcite-button-D_Agetwz.js"),__vite__mapDeps([45,46,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,47,24,25,48,35,30,26,27,23,28,36,37]),import.meta.url),combobox:()=>F(()=>import("./calcite-combobox-DZ_miEwS.js"),__vite__mapDeps([49,50,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,51,52,33,24,32,47,25,48,35,30,26,27,23,31,28,53,54,55,36,56,22,57]),import.meta.url),"combobox-item":()=>F(()=>import("./calcite-combobox-item-BtecfP0L.js"),__vite__mapDeps([58,56,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,54,35,36]),import.meta.url),"combobox-item-group":()=>F(()=>import("./calcite-combobox-item-group-CAcCi624.js"),__vite__mapDeps([59,60,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,24,54]),import.meta.url),icon:()=>F(()=>import("./calcite-icon-Cu0W9dtm.js"),__vite__mapDeps([61,36,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,24,23]),import.meta.url),input:()=>F(()=>import("./calcite-input-DAafN6Cc.js"),__vite__mapDeps([62,63,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,24,47,25,27,48,35,30,26,23,28,53,64,36,57,65]),import.meta.url),"input-date-picker":()=>F(()=>import("./calcite-input-date-picker-BGvzpTnS.js"),__vite__mapDeps([66,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,26,24,27,23,32,33,47,25,48,35,30,31,28,29,36,41,53,64,57,67,65]),import.meta.url),"input-message":()=>F(()=>import("./calcite-input-message-Do0tN7uT.js"),__vite__mapDeps([68,57,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,24,36,23]),import.meta.url),"input-number":()=>F(()=>import("./calcite-input-number-BjjBFtSg.js"),__vite__mapDeps([69,70,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,24,47,25,27,48,35,30,26,23,28,53,64,36,57,65]),import.meta.url),"input-time-picker":()=>F(()=>import("./calcite-input-time-picker-C41HwG-M.js"),__vite__mapDeps([71,11,12,1,2,3,4,5,6,7,8,9,10,13,14,15,16,17,18,19,20,21,47,24,25,27,48,35,30,26,23,41,28,72,36,53,64,34,37,57,67,65,40,32,33,31,29,42]),import.meta.url),"input-time-zone":()=>F(()=>import("./calcite-input-time-zone-CARdLRL2.js"),__vite__mapDeps([73,11,12,1,2,3,4,5,6,7,8,9,10,13,14,15,16,17,18,19,20,21,48,24,35,25,26,27,23,28,30,47,55,36,50,51,52,33,32,31,53,54,56,22,57,60]),import.meta.url),label:()=>F(()=>import("./calcite-label-B1FxWqaL.js"),__vite__mapDeps([74,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,48,24,35]),import.meta.url),list:()=>F(()=>import("./calcite-list-C4jOVpC-.js"),__vite__mapDeps([75,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,24,25,23,76,77,30,28,26,27,52,33,36,63,47,48,35,53,64,57,65,37,44]),import.meta.url),"list-item":()=>F(()=>import("./calcite-list-item-vbKS6alm.js"),__vite__mapDeps([78,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,24,25,26,27,23,28,30,77,76,34,35,36,37,43]),import.meta.url),loader:()=>F(()=>import("./calcite-loader-DP4PIFO8.js"),__vite__mapDeps([79,37,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,24,26,27,23]),import.meta.url),notice:()=>F(()=>import("./calcite-notice-DSp0z_Oh.js"),__vite__mapDeps([80,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,30,26,27,28,81,31,35,36]),import.meta.url),"radio-button":()=>F(()=>import("./calcite-radio-button-C1tLzCtg.js"),__vite__mapDeps([82,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,39,24,47,25,48,35,30]),import.meta.url),"radio-button-group":()=>F(()=>import("./calcite-radio-button-group-D-kr_xkz.js"),__vite__mapDeps([83,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,23,24,30,53,36,57]),import.meta.url),switch:()=>F(()=>import("./calcite-switch-CkUGVtze.js"),__vite__mapDeps([84,85,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,24,47,25,27,48,35,30]),import.meta.url),"text-area":()=>F(()=>import("./calcite-text-area-1Jz07Ix2.js"),__vite__mapDeps([86,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,47,24,48,35,26,27,23,30,28,25,53,64,36,57,87,33]),import.meta.url)})}destroy(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode)}get _relatedRecordsEnabled(){const e=this.relatedRecordCallbacks;return!(!e||!(e.addRelatedRecord||e.editRelatedRecord||e.showAllRelatedRecords))}get _subtypes(){return ot(this.layer)}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get feature(){return this.viewModel.feature}set feature(e){this.viewModel.feature=e}get formTemplate(){return this.viewModel.formTemplate}set formTemplate(e){this.viewModel.formTemplate=e}get icon(){return"form-field"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get relatedRecordCallbacks(){return this.viewModel.relatedRecordCallbacks}set relatedRecordCallbacks(e){this.viewModel.relatedRecordCallbacks=e}get relationshipId(){return this.viewModel.relationshipId}set relationshipId(e){this.viewModel.relationshipId=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get strict(){return this.viewModel.strict}set strict(e){this.viewModel.strict=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get showPrompt(){return e=>{var t,n;(n=(t=this._prompt)==null?void 0:t.cancel)==null||n.call(t),this._prompt=e}}set showPrompt(e){this._overrideIfSome("showPrompt",e)}get clearPrompt(){return()=>this._prompt=null}set clearPrompt(e){this._overrideIfSome("clearPrompt",e)}getValues(){return this.viewModel.getValues()}submit(){return this.viewModel.submit()}render(){const{state:e}=this.viewModel;return y("div",{class:this.classes(x.base,Oe.widget,Oe.panel)},e==="ready"?this._renderForm():null)}_renderForm(){return y("div",null,y("form",{class:x.form,novalidate:!0,onkeydown:this._onFormKeyDown,onsubmit:this._onFormSubmit},this._renderHeader(),this._renderContent()),this._prompt?y(pt,{...this._prompt,headingLevel:this.headingLevel}):void 0)}_renderHeader(){const e=this.viewModel;if(!e.formHeaderVisible)return;const t=e.formTitle!=null&&y(Ut,{key:"title",level:this.headingLevel},e.formTitle),n=e.formDescription!=null&&y("p",{class:x.description,key:"description"},e.formDescription);return y("div",{class:x.formHeader},t,n)}_renderContent(){const{viewModel:e}=this;return e.activeRelationshipInput?this._renderRelationshipInput(e.activeRelationshipInput):e.inputs.filter(ue).filter(t=>t.visible).map(t=>this._renderInput(t))}_renderInput(e){return H(e)?this._renderGroup(e):q(e)?this._renderLabeledField(e):ce(e)?this._renderRelationshipInput(e):He(e)?this._renderTextElementInput(e):void 0}_renderDescriptionOrEmpty(e,t){return e==null?null:y("div",{class:this.classes(x.description),id:t},e)}_renderGroup(e){const{disabled:t,formTemplate:n,headingLevel:i}=this,{description:s,id:o,inputs:a,label:r,open:l}=e,c=a.filter(m=>m.visible),p=this.viewModel.findField(this._focusedFieldName),h=(p==null?void 0:p.group)===e,f=this.groupDisplay==="sequential";return y("calcite-block",{class:this.classes(x.group,f?x.groupSequential:null,h?x.groupActive:null,t?x.inputDisabled:null),collapsible:!0,"data-group":e,description:s||void 0,disabled:t,heading:`${r}`,headingLevel:n!=null&&n.title?Ht(i):i,id:o,key:o,open:l,onCalciteBlockToggle:({target:m})=>this._onGroupToggle(m,e)},c.map(m=>this._renderInput(m)))}_getFocusableInput(e,t){const n=vt(this.viewModel.inputs);let i;if(e==="backward"&&n.reverse(),t)if(H(t)){const s=t.inputs.find(o=>o.visible);i=s?n.indexOf(s):0}else{let s;if(ie(t)&&!t.group.open){const o=t.group.inputs.filter(q);s=e==="forward"?o[o.length-1]:o[0]}else s=t;i=n.indexOf(s)+1}else i=0;for(let s=i;s<n.length;s++){const o=n[s];if(o.visible&&q(o))return o}return null}_renderLabeledField(e){var l;const{dataType:t,feature:n,label:i,layer:s,required:o}=e,a={"aria-label":o?z(this.messages.requiredFieldLabel,{name:i}):i,class:x.label,key:`${s.id}-${n.uid}-${e.name}`},r=[y("div",{class:x.labelTextContent,key:"labelTextContainer"},i,o?y("span",{"aria-hidden":"true",title:this.messagesCommon.required},"*"):void 0),t!=="unsupported"?this._renderFieldInput(e):this._renderReadOnlyComponent(e),this._renderAuxiliaryText(e)];return t==="date"&&((l=e.domain)==null?void 0:l.type)!=="coded-value"?y("label",{...a},r):y("calcite-label",{...a},r)}_renderFieldInput(e){const{dataType:t,domain:n,inputType:i,name:s}=e,o=this.getCommonInputProps(e);if((n==null?void 0:n.type)==="coded-value"){const a=this.viewModel.getFieldValueOptionsForField(s,this.messages.empty);return i!=="switch"||e.hasInvalidSwitchValue?i==="radio-buttons"?this._renderRadioButtonComponents(e,a.flat(),o):this._renderComboBoxComponent(e,a,o):this._renderSwitchComponent(e,o)}return i==="datetime-picker"||t==="date"?this._renderDateComponents(e,o):t==="number"?this._renderNumberComponent(e,o):this._renderStringComponent(e,o)}_renderStringComponent(e,t){return e.inputType==="text-area"?t.readOnly?y("calcite-input",{...t,loading:e.updating,type:"textarea",onCalciteInputInput:n=>this._saveValueFromComponent(n.target)}):y("calcite-text-area",{...t,resize:"vertical",onCalciteTextAreaInput:n=>this._saveValueFromComponent(n.target)}):y("calcite-input",{...t,loading:e.updating,type:"text",onCalciteInputInput:n=>this._saveValueFromComponent(n.target)})}_renderNumberComponent(e,t){return y("calcite-input-number",{...t,integer:et(e.field),loading:e.updating,type:"number",onCalciteInputNumberInput:n=>this._saveValueFromComponent(n.target)})}_renderDateComponents(e,t){const{field:n}=e;switch(n.type){case"date":return this._renderDateFieldComponents(e,t);case"date-only":return this._renderDateOnlyFieldComponent(e,t);case"time-only":return this._renderTimeOnlyFieldComponent(e,t);case"timestamp-offset":return this._renderTimestampOffsetFieldComponents(e,t);default:return this._renderReadOnlyComponent(e,tt(n,t.value,{timeZone:this.timeZone,...nt(n)}))}}_renderDateOnlyFieldComponent(e,t){const{range:n,valid:i,value:s}=e,{class:o,key:a,readOnly:r}=t,{rawMax:l,rawMin:c}=n;return y("calcite-input-date-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!i,class:o,"data-date-part":"date","data-field-name":t[D],key:`${a}-date-input`,max:ve(l)?l:void 0,min:ve(c)?c:void 0,numberingSystem:K,onblur:p=>{this._focusedFieldName=null,this._saveValueFromDateComponent(p.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:r,value:s!=null?`${s}`:void 0,onCalciteInputDatePickerChange:p=>this._saveValueFromDateComponent(p.target)})}_renderTimeOnlyFieldComponent(e,t){const{valid:n,value:i}=e,{class:s,key:o,readOnly:a}=t;return y("calcite-input-time-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!n,class:s,"data-date-part":"time","data-field-name":t[D],key:`${o}-time-input`,numberingSystem:K,onblur:r=>{this._focusedFieldName=null,this._saveValueFromDateComponent(r.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:a,step:e.timeStep,value:i!=null?`${i}`:void 0,onCalciteInputTimePickerChange:r=>this._saveValueFromDateComponent(r.target)})}_renderTimestampOffsetFieldComponents(e,t){const{name:n,range:i,timeZone:s,valid:o,value:a}=e,{class:r,key:l,readOnly:c}=t,{rawMax:p,rawMin:h}=i,f={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!o,numberingSystem:K,overlayPositioning:"fixed",readOnly:c,[D]:n,onfocus:this._onComponentFocus},m=J(p,s),g=J(h,s),b=J(a,s);return y("div",{class:x.dateInputContainer,key:`${l}-date-time-container`},y("calcite-input-date-picker",{...f,class:r,"data-date-part":"date",key:`${l}-date-input`,max:(m==null?void 0:m.date)??void 0,min:(g==null?void 0:g.date)??void 0,onblur:_=>{this._focusedFieldName=null,this._saveValueFromDateComponent(_.target)},value:b.date??void 0,onCalciteInputDatePickerChange:_=>this._saveValueFromDateComponent(_.target)}),y("calcite-input-time-picker",{...f,class:r,"data-date-part":"time",key:`${l}-time-input`,onblur:_=>{this._focusedFieldName=null,this._saveValueFromDateComponent(_.target)},step:e.timeStep,value:b.time??void 0,onCalciteInputTimePickerChange:_=>this._saveValueFromDateComponent(_.target)}),e.includeTimeOffset?y("calcite-input-time-zone",{...f,class:r,"data-date-part":"timeZone",disabled:c,key:`${l}-timezone-input`,onblur:_=>{this._focusedFieldName=null,this._saveValueFromDateComponent(_.target)},value:b.timeZoneOffset??"0",onCalciteInputTimeZoneChange:_=>this._saveValueFromDateComponent(_.target)}):null)}_renderDateFieldComponents(e,t){const{includeTime:n,name:i,valid:s,value:o}=e,{class:a,key:r,max:l,min:c,readOnly:p}=t,{timeZone:h}=this,f={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!s,numberingSystem:K,overlayPositioning:"fixed",readOnly:p,[D]:i,onfocus:this._onComponentFocus},m=Y(o,h),g=Y(l,h),b=Y(c,h);return y("div",{class:x.dateInputContainer,key:`${r}-date-time-container`},y("calcite-input-date-picker",{...f,class:a,"data-date-part":"date",key:`${r}-date-input`,max:(g==null?void 0:g.date)??void 0,min:(b==null?void 0:b.date)??void 0,onblur:_=>{this._focusedFieldName=null,this._saveValueFromDateComponent(_.target)},value:m.date??void 0,onCalciteInputDatePickerChange:_=>this._saveValueFromDateComponent(_.target)}),n?y("calcite-input-time-picker",{...f,class:a,"data-date-part":"time",key:`${r}-time-input`,onblur:_=>{this._focusedFieldName=null,this._saveValueFromDateComponent(_.target)},step:1,value:m.time??void 0,onCalciteInputTimePickerChange:_=>this._saveValueFromDateComponent(_.target)}):null)}_renderReadOnlyComponent(e,t){const n=this.getCommonInputProps(e);return y("calcite-input",{...n,class:this.classes(x.fieldInput,x.inputDisabled),readOnly:!0,type:"text",value:t!=null?`${t}`:n.value})}_renderComboBoxComponent(e,t,n){const{value:i,name:s}=e,{viewModel:o,_inputsWithChanges:a}=this,r=o.arcadeEditType==="INSERT",l=a.has(s),c=i==null&&(!r||l),p=r&&e.showNoValueOptionEnabled&&!l?()=>{}:n.onblur;return y("calcite-combobox",{...n,allowCustomValues:!1,clearDisabled:!0,disabled:n.readOnly,onblur:p,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:({target:h})=>{c&&h.selectedItems.length===0?this._ignoreDeselectionOfNoValueOption(h):e.isSubtypeField&&h.selectedItems.length===0?h.value=`${e.value}`:this._saveValueFromComponent(h)}},this.renderComboboxOptionsList(e,t))}renderComboboxOptionsList(e,t){const{value:n,name:i}=e,{messages:s,messagesTemplates:o,viewModel:a,_inputsWithChanges:r}=this,[l,c,p]=t.map(b=>b.map(({name:_,value:w})=>y("calcite-combobox-item",{key:`#${w}`,selected:n===w,textLabel:_,value:`${w}`}))),h=[];c.length>0&&h.push(y("calcite-combobox-item-group",{key:"other",label:o.other},c)),p.length>0&&h.push(y("calcite-combobox-item-group",{key:"unsupported",label:s.subtypes.unsupportedDomainGroupTitle},p)),h.length>0?h.unshift(y("calcite-combobox-item-group",{key:"recommended",label:s.recommended},l)):h.push(...l);const f=a.arcadeEditType==="INSERT",m=r.has(i),g=n==null&&(!f||m);return e.showNoValueOptionEnabled&&h.unshift(y("calcite-combobox-item",{key:"empty-option",selected:g,textLabel:e.showNoValueLabel||s.empty,value:""})),h}_renderRadioButtonComponents(e,t,n){const{name:i,value:s}=e,o=t.map(({name:a,value:r})=>this._renderRadioButtonComponent({key:a,label:a,name:i,value:r,selected:r===s,props:n}));if(e.showNoValueOptionEnabled){const a="",r=e.showNoValueLabel||this.messages.empty,l=s===a||s===null;o.unshift(this._renderRadioButtonComponent({key:"empty-option",label:r,name:i,value:a,selected:l,props:n}))}return y("calcite-radio-button-group",{afterCreate:this._afterRadioGroupCreateOrUpdate,afterUpdate:this._afterRadioGroupCreateOrUpdate,class:x.inputRadioGroup,"data-field-name":n[D],key:`${n.key}-radio-group`,layout:"vertical",name:n.key,required:n.required},o)}_renderSwitchComponent(e,t){const{value:n}=e,i=!!we(e.element,"switch")&&n===e.element.input.onValue;return y("calcite-switch",{...t,checked:i,class:x.inputSwitch,disabled:t.readOnly,onblur:()=>{this._focusedFieldName=null},onCalciteSwitchChange:s=>this._saveValueFromComponent(s.target)})}_renderRadioButtonComponent({key:e,name:t,value:n,selected:i,label:s,props:o}){return y("calcite-label",{class:x.inputRadioLabel,key:e,layout:"inline"},y("calcite-radio-button",{...o,afterCreate:void 0,afterUpdate:void 0,checked:i,class:x.inputRadio,disabled:o.readOnly,name:t,onblur:()=>{this._focusedFieldName=null},value:n,onCalciteRadioButtonChange:({target:a})=>{a.checked&&this._saveValueFromComponent(a)}}),s)}_renderAuxiliaryText(e){const t=e.name,n=this._inputsWithChanges.has(t)&&!e.valid?bt(e,this.messages,this.timeZone):this.viewModel.contingencyConstraintViolations.get(t)!=null?this.messages.validationErrors.valuesIncompatible:e.valueExpressionExecutor!=null&&e.valueExpressionExecutor.stale?this.messages.valueExpressionError:null;return n!=null?y("calcite-input-message",{icon:!0,status:"invalid"},n):this._inputsWithChanges.has(t)&&e.valueIsOutOfDomain?y("calcite-input-message",{icon:!0,status:"idle"},this.messages.subtypes.fieldOutOfSubtypeDomainWarning):this._renderDescriptionOrEmpty(e.description)}_renderShowAllRelatedRecordsListItem(e){const{featureCount:t,relationshipId:n,showAllActionVisible:i}=e,{relatedRecordCallbacks:s}=this;if(!i||!(s!=null&&s.showAllRelatedRecords))return;const o=this.messages;return y("calcite-list-item",{description:z(o.totalCount,{count:t}),label:o.showAll,value:!0,onCalciteListItemSelect:()=>this._onShowAllRelatedRecordsClick(n)},y("calcite-icon",{icon:"list",scale:"s",slot:"content-end"}))}_renderAddRelatedRecordButton(e){const{canAddRelatedFeature:t,relationshipId:n,relatedLayer:i}=e,{messages:s,relatedRecordCallbacks:o}=this;if(t&&(o!=null&&o.addRelatedRecord)&&i)return y("calcite-button",{alignment:"center",appearance:"outline-fill",class:x.centeredButton,disabled:e.updating||!e.originHasValidKey,iconStart:"plus",key:`${n}-add-button`,onclick:()=>{!e.updating&&e.originHasValidKey&&this._onAddRelatedRecordsClick(n,i)},round:!0,scale:"s",width:"half"},e.relatedLayerIsTable?s.addRecord:s.addFeature)}_renderRelatedRecordListItem(e,t){const{feature:n,description:i,title:s}=e,{feature:o,relatedRecordCallbacks:a}=this,{highlightHelper:r}=this.viewModel,l=()=>{r==null||r.removeAll(),a!=null&&a.editRelatedRecord&&o&&a.editRelatedRecord({parentFeature:o,relationshipId:t,relatedFeature:n})},c=r?()=>r.add(n):void 0,p=r?()=>r.remove(n):void 0;return y("calcite-list-item",{bind:this,description:i,key:`${t}-${n.uid}`,label:s,onclick:l,onmouseenter:c,onmouseleave:p,value:s},y("calcite-icon",{icon:Ct(n),slot:"content-start"}),y("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderRelationshipInput(e){if(!this._relatedRecordsEnabled||!e.editable)return;const{featureCount:t,relationshipId:n,showAllEnabled:i}=e,s=i?null:this._renderDescriptionOrEmpty(e.description),o=t>0?this._renderRelatedRecordsList(e):e.loaded?e.originHasValidKey?this._renderNoRelatedRecordsNotice():this._renderNoValidOriginKeyNotice(e):void 0;return y("calcite-label",{class:this.classes(x.label,x.relatedRecordsLabel),key:`relationship-${n}-container`},y("div",null,this._renderRelatedRecordsHeaderContainer(e),s,o),this._renderAddRelatedRecordButton(e))}_renderRelatedRecordsHeaderContainer(e){var n;const t=e.updating||!e.loaded;return y("div",{class:x.relatedRecordsHeader,key:`relationship-${e.relationshipId}-header`},y("span",null,e.label),t?y("calcite-loader",{inline:!0,key:"loader",label:(n=this.messagesCommon)==null?void 0:n.loading,scale:"s",type:"indeterminate"}):void 0)}_renderRelatedRecordsList(e){const{relationshipId:t}=e;return y("calcite-list",{class:x.relatedRecordsList},e.relatedFeatureInfos.map(n=>this._renderRelatedRecordListItem(n,t)),this._renderShowAllRelatedRecordsListItem(e),this._renderObserverNode())}_renderNoValidOriginKeyNotice(e){var l,c,p;const{messages:t}=this,n=e.relatedLayerIsTable?t.noOriginKeyRecord:t.noOriginKeyFeature,i=(l=e.relationship)==null?void 0:l.keyField,s=this.viewModel.findField(i),o=(c=e.layer)==null?void 0:c.fieldsIndex.get(i),a=(s==null?void 0:s.label)||(o==null?void 0:o.alias)||i,r=z(n,{relatedLayerName:(p=e.relatedLayer)==null?void 0:p.title,originKeyField:a});return y("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},y("div",{slot:"message"},r))}_renderNoRelatedRecordsNotice(){return y("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},y("div",{slot:"message"},this.messagesFeature.noRelatedFeatures))}_renderObserverNode(){var e;if((e=this.viewModel.activeRelationshipInput)!=null&&e.showAllEnabled)return y("div",{afterCreate:this._afterListObserverCreated,afterRemoved:this._afterListObserverRemoved,bind:this,class:x.listObserver,key:"feature-observer"})}_renderTextElementInput(e){return y("div",{class:x.textElement,innerHTML:e.text,key:e.id})}getCommonInputProps(e){const{disabled:t}=this,{editable:n,hint:i,label:s,maxLength:o,minLength:a,name:r,range:{max:l,min:c},required:p,valid:h,value:f}=e,m=this._inputsWithChanges.has(r),g=!n||t;return{afterCreate:this._afterComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,"aria-invalid":h?"false":"true",class:this.classes(x.fieldInput,g?x.inputDisabled:null),status:m&&!h?"invalid":"idle",key:r,label:s,max:l??void 0,min:c??void 0,maxLength:o>-1?o:void 0,minLength:a>-1?a:void 0,placeholder:i??void 0,readOnly:g,required:p,value:f==null?"":`${f}`,onblur:this._onComponentBlur,onfocus:this._onComponentFocus,onkeydown:this._onComponentKeyDown,[D]:r}}_getFieldInputFromHTMLElement(e){return this.viewModel.findField(e.getAttribute(D))}_afterDateComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e),n=e.dataset.datePart,i=this._dateComponentMap.get(t.name);if("valueAsDate"in e&&e.value!=null&&t.value!=null){const s=new ResizeObserver(()=>{switch(e.value=void 0,t.field.type){case"date":e.value=Y(t.value,this.timeZone).date??"";break;case"timestamp-offset":e.value=J(t.value,this.timeZone).date??"";break;default:e.value=`${t.value}`}s.unobserve(e)});s.observe(e)}if(i!=null)switch(n){case"date":i.date=e;break;case"time":i.time=e;break;case"timeZone":i.timeZone=e}else this._dateComponentMap.set(t.name,{[n]:e});this._afterDateComponentCreateOrUpdate(e)}_afterDateComponentCreateOrUpdate(e){this._afterComponentCreateOrUpdate(e)}_afterComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e);xt(t)&&e.value!=null&&"setNumberValue"in e&&e.setNumberValue({committing:!1,value:e.value,origin:"direct"}),this._afterComponentCreateOrUpdate(e)}_afterRadioGroupCreateOrUpdate(e){const t=e.selectedItem,n=e.querySelector("calcite-radio-button"),i=t||n;i&&this._afterComponentCreateOrUpdate(i)}_afterComponentCreateOrUpdate(e){const{viewModel:t}=this,n=this._getFieldInputFromHTMLElement(e),i=t.findField(this._focusedFieldName);this._attemptFocusOnNextRender&&i===n&&(this._attemptFocusOnNextRender=!1,ie(n)&&(n.group.open=!0),ut(e))}_onComponentFocus(e){const t=e.target,n=this._getFieldInputFromHTMLElement(t);this._focusedFieldName=n.name}_onComponentBlur(e){const t=e.target;this._focusedFieldName=null,this._saveValueFromComponent(t)}_saveValueFromDateComponent(e){const{timeZone:t}=this,n=this._getFieldInputFromHTMLElement(e),i=n.field.type,{name:s,range:o}=n,a=this._dateComponentMap.get(s);if(!a)return;let r=this.viewModel.getValue(s),l=null;i==="date-only"?l=Array.isArray(e.value)?e.value[0]:e.value:i==="time-only"?(r=be(r),l=be(e.value)):l=i==="timestamp-offset"?e.value!=null?it({dateComponent:a.date,timeComponent:a.time,timeZoneComponent:a.timeZone,oldValue:r,defaultTimeZone:t}):null:e.value!=null?st({oldValue:r,dateComponent:a.date,timeComponent:a.time,timeZone:t,max:o.max,min:o.min}):null,l!==null&&e.value?r!==l&&this._updateFieldValue(s,l):this._updateFieldValue(s,null)}_saveValueFromComponent(e){const t=this._getFieldInputFromHTMLElement(e),n=this._parseValue(e),i=t.value;t.isSubtypeField&&Vt(this.layer,i,n)?this._pendingSubtypeChoice||n===i||(this._pendingSubtypeChoice=this._handleSubtypeChoice(t,n)):this._updateFieldValue(t.name,n)}async _handleSubtypeChoice(e,t){var g;const{value:n,name:i}=e,{messages:s,viewModel:o,messagesCommon:a,_subtypes:r}=this;if(this._updateFieldValue(i,t),!(r!=null&&r.length))return;const l=r.find(b=>b.code===t),c=((g=r.find(b=>b.code===n))==null?void 0:g.name)??`${n}`;if(!l)return;o.hasPendingSubtypeChoice=!0;const p=Ne();let h="update-fields";const f=[{label:s.subtypes.useDefaultValuesOption,value:"update-fields"},{label:s.subtypes.keepCurrentValuesOption,value:"keep-existing"}],m={context:"info",title:s.subtypes.changeWarningTitle,message:z(s.subtypes.changeWarning,{originalType:c,newType:l.name}),radios:f,defaultRadioSelection:"update-fields",onRadioSelection:b=>h=b,actions:{primary:{label:a.apply,action:()=>p.resolve(h),type:"positive"},secondary:{label:a.cancel,type:"neutral",action:()=>p.resolve("undo")}},cancel:()=>p.reject()};try{switch(this.showPrompt(m),await p.promise){case"update-fields":o.applySubtypeDefaults(l),this._validateContingenciesForNonNullFields();break;case"keep-existing":this._validateContingenciesForNonNullFields();break;case"undo":this._updateFieldValue(e.name,n)}}finally{o.hasPendingSubtypeChoice=!1,this.clearPrompt(),this._pendingSubtypeChoice=null}}_onComponentKeyDown({key:e,target:t}){const n=this._getFieldInputFromHTMLElement(t);e==="Enter"&&ie(n)&&!n.group.open&&(n.group.open=!0)}_updateFieldValue(e,t){const n=this.viewModel.getValue(e);this.viewModel.setValue(e,t),this._inputsWithChanges.add(e),n!==t&&this.viewModel.fieldsWithContingentValues.has(e)&&this._validateContingenciesForNonNullFields()}_validateContingenciesForNonNullFields(){const e=Object.fromEntries(Object.entries(this.getValues()).filter(([t,n])=>n!=null));this.viewModel.validateContingencyConstraints(e)}_parseValue(e){const t=this._getFieldInputFromHTMLElement(e),n=e.value;return we(t.element,"switch")?e.checked?t.element.input.onValue:t.element.input.offValue:n==null||n===""?null:t.dataType==="number"?n==="-0"||n==="-0."||n==="-0,"?n:parseFloat(n):t.field.type==="date"?parseFloat(n):n}_ignoreDeselectionOfNoValueOption(e){const{firstChild:t,selectedItems:n}=e;n.length===0&&t&&"selected"in t?t.selected=!0:ee.getLogger(this).warnOnce("Failed to override user attempt to deselect 'No value' option.")}_onGroupToggle(e,t){var n;e.open?(t.open=!0,this._focusedFieldName=((n=this._getFocusableInput("forward",t))==null?void 0:n.name)||null,this._attemptFocusOnNextRender=!0,this.groupDisplay==="sequential"&&this.viewModel.allGroupInputs.forEach(i=>{i!==t&&(i.open=!1)})):t.open=!1,this.scheduleRender()}_onFormSubmit(e){e.preventDefault()}_onFormKeyDown(e){e.key==="Enter"&&this.viewModel.submit()}_afterListObserverCreated(e){this.viewModel.activeRelationshipInput&&(this._listObserverNode=e)}_afterListObserverRemoved(){this._listObserverNode=null}_onObserverChange(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode);const e=this.viewModel.activeRelationshipInput;e&&this._listObserverNode&&e.showAllEnabled&&this._listObserver.observe(this._listObserverNode)}_incrementRelatedRecordPage(){const e=this.viewModel.activeRelationshipInput;e==null||e.incrementPage()}_syncGroupInputStates(){if(this.groupDisplay!=="sequential")return;const e=this.viewModel.allGroupInputs;if(!e.length)return;const t=e.filter(n=>n.open);t.length===0?e[0].open=!0:t.length>1&&t.slice(1).forEach(n=>n.open=!1)}get test(){return{inputsWithChanges:this._inputsWithChanges,updateValue:this._saveValueFromComponent.bind(this)}}};u([d()],C.prototype,"_listObserverNode",void 0),u([d()],C.prototype,"_relatedRecordsEnabled",null),u([d()],C.prototype,"_prompt",void 0),u([d()],C.prototype,"_subtypes",null),u([d()],C.prototype,"disabled",null),u([d()],C.prototype,"feature",null),u([d()],C.prototype,"formTemplate",null),u([d()],C.prototype,"groupDisplay",void 0),u([d()],C.prototype,"headingLevel",void 0),u([d()],C.prototype,"icon",null),u([d()],C.prototype,"label",null),u([d()],C.prototype,"layer",null),u([d()],C.prototype,"map",null),u([d(),Q("esri/widgets/FeatureForm/t9n/FeatureForm")],C.prototype,"messages",void 0),u([d(),Q("esri/t9n/common")],C.prototype,"messagesCommon",void 0),u([d(),Q("esri/widgets/Feature/t9n/Feature")],C.prototype,"messagesFeature",void 0),u([d(),Q("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],C.prototype,"messagesTemplates",void 0),u([d()],C.prototype,"relatedRecordCallbacks",null),u([d()],C.prototype,"relationshipId",null),u([d()],C.prototype,"spatialReference",null),u([d()],C.prototype,"strict",null),u([d()],C.prototype,"timeZone",null),u([d()],C.prototype,"showPrompt",null),u([d()],C.prototype,"clearPrompt",null),u([d(),Zt(["value-change","submit"])],C.prototype,"viewModel",void 0),u([d()],C.prototype,"test",null),C=u([$("esri.widgets.FeatureForm")],C);const vn=C,oi=Object.freeze(Object.defineProperty({__proto__:null,default:vn},Symbol.toStringTag,{value:"Module"}));export{vn as B,oi as F,_n as Y};
