const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-BPm91e5Z.js","./index-CMxz6F2k.js","./jsxFactory-Cnml7uXM.js","./Accessor-BmwT4B0c.js","./intl-Duiy0OzY.js","./Promise-DfET-uns.js","./cast-CsZslgGN.js","./index-4eY77cms.js","./index-Cx51aysm.css","./JSONSupport-DcrLLGjL.js","./Evented-Dw4_VOGn.js","./reactiveUtils-XM7cS2OP.js","./SimpleObservable-CvOkykwM.js","./uuid-Cl5lrJ4c.js","./guid-ejniuQmw.js","./useT9n-C1Hrfc-A.js","./index-DwIhxbHs.js","./dom-DEluURzl.js","./observers-Co4E8E8j.js","./keyed-CU1C-h1n.js","./directive-helpers-DaBykg1t.js","./ref-D9wHsL_T.js","./interactive-DTzfFku4.js","./loadable-XBvaWFYY.js","./component-CBVlbUuE.js","./index-C6d66FVb.js","./index-DyXGQ9Xl.js","./index-DVGzfobf.js","./floating-ui-IixYHfbQ.js","./debounce-DbkufipY.js","./key-CZcQa38B.js","./openCloseComponent-nqWrSaIH.js","./dynamicClasses-pKEMtFzB.js","./index-C7Sgjfzm.js","./resources6-Cs2_VmEC.js","./index-XCNLEnDV.js","./customElement-_nG5icNK.js","./index-DMeQur4V.js","./static-DLD4WjLv.js","./FloatingArrow-BZRr6Zld.js","./useFocusTrap-COeL24Kx.js","./focusTrapComponent-D1wJZ4RD.js","./index-DK5B8inx.js","./array-BbE1dLa5.js","./index-jjUP6Yam.js","./form-BzoUrXC7.js","./label-CHHpnzD0.js","./index-CtvJE4Qe.js","./index-BYx-hdGk.js","./index-fFnlo_g2.js","./index-BtUFGore.js","./live-D7NQ-TrC.js","./core-zHisM37C.js","./filter-D4A4y0z5.js","./escapeRegExp-CdLjXKbf.js","./Validation-BYp9DS84.js","./utils3-Iojtwv7b.js","./index-CP8r2QEY.js","./text-C54aRk62.js","./index-CMdCteX_.js","./index-Z5_W1-0F.js","./index-C6rrpqn6.js","./index-pyEU_klK.js","./index-DWeq-ojO.js","./locale-CXx8I9ox.js","./input-DI9tZAPS.js","./index-BVlRRyQC.js","./index--OBudxYA.js","./index-BCDLx0rN.js","./utils-Dtivty39.js","./index-B0pN5y8B.js","./resources5-SciNIBSe.js","./index-BciJpaKz.js","./index-DdZGn6qX.js"])))=>i.map(i=>d[i]);
import{_ as A,L as Rt,u as Ut,c as Bt,n as Ht,i as Wt,a as zt}from"./index-4eY77cms.js";import{r as Qe}from"./index-C5b9dHRB.js";import{g as se,r as n,m as c,a as q,s as G,E as ct,c as _e,G as Ze,n as Jt}from"./Accessor-BmwT4B0c.js";import{l as Xe}from"./intl-Duiy0OzY.js";import{d as j,P as dt,V as ut,w as Gt}from"./reactiveUtils-XM7cS2OP.js";import{i as jt,o as ae,P as xe,s as te,e as qt,K as re,ai as mt,M as Kt,H as Qt}from"./cast-CsZslgGN.js";import{b as Zt}from"./unitFormatUtils-Q7ZG7HcF.js";import{g as be,D as Ye,x as et,Q as Xt,l as Yt,N as ei}from"./Point-Cz2JYYmX.js";import{i as ti,u as me}from"./utils-YowqfOgk.js";import{n as p,O as ii,c as ai,g as oi,i as li,k as si,e as ge}from"./jsxFactory-Cnml7uXM.js";import{m as ri,C as ht,c as tt}from"./Portal-CmmHxpLg.js";import{s as ni}from"./ReactiveMap-BHFEHYMj.js";import{c as yt,u as pe,e as it}from"./screenUtils-_ZIvrt5o.js";import{w as pi}from"./Extent-g5W9hy0j.js";import{E as ci,j as di,s as ui}from"./Promise-DfET-uns.js";import{j as mi}from"./Polyline-s-JzsQqo.js";import{a0 as hi}from"./opacityUtils-Dim20wpZ.js";import{o as yi}from"./floorFilterUtils-DZ5C6FQv.js";import{N as fi}from"./visualVariableUtils-Xcorldoo.js";import{S as bi,l as gi,O as vi,s as ft}from"./submitJob-DPqOfn4F.js";import{a as wi}from"./GPMessage-Ba6qfxW_.js";import{h as _i}from"./Color-VJEMvW-n.js";import{y as Ti,d as at,S as Ii}from"./TextSymbol-BLIQ6RKX.js";import{r as xi}from"./layerViewUtils-Bevty3Jm.js";import he from"./PortalItem-CTx1kJsR.js";import{_ as Si}from"./viewpointUtils-CtXMVquh.js";import{_ as ot}from"./InputManager-DZ3jJnlx.js";import{S as Oi}from"./JSONSupport-DcrLLGjL.js";import{x as ki}from"./MD5-C9MwAd2G.js";import{r as Ei}from"./enumeration-DpvDkLNI.js";import{e as ve}from"./globalCss-vQlnDsEX.js";import{e as Li}from"./Heading-BcR6CGTM.js";import{i as Ci}from"./legacyIcon-Wt_jLiuK.js";import{P as $i}from"./useWidget-BajufX8l.js";import"./Evented-Dw4_VOGn.js";import"./SimpleObservable-CvOkykwM.js";import"./ByteSizeUnit-BsxeN7wM.js";import"./Cyclical-Dlbl-cQK.js";import"./mathUtils-Cfq9PL9W.js";import"./quantityUtils-BsDK158M.js";import"./writer-DKgfqj4X.js";import"./uuid-Cl5lrJ4c.js";import"./Graphic-Dt0LgVGU.js";import"./Clonable-Z-AWS-16.js";import"./ActionToggle-D7439N1A.js";import"./Identifiable-BHVfzH03.js";import"./jsonUtils-CwFG8yN4.js";import"./typeUtils-B6WBEKDM.js";import"./collectionUtils-CTT-51g7.js";import"./vec3f64-BLpZdpfb.js";import"./aaBoundingBox-Dw3yBk2f.js";import"./lengthUtils-_77UiyVF.js";import"./normalizeUtils-BTGdXlpz.js";import"./normalizeUtilsCommon-lGDszWRI.js";import"./utils-B-dlKIhi.js";import"./Field-BDG0QV_T.js";import"./fieldType-CBeoJWlv.js";import"./networkEnums-BgkT2jou.js";import"./FeatureSet-B5-Veyin.js";import"./colorUtils-Rxh2V3ai.js";import"./Viewpoint-DvyUmqUt.js";import"./Camera-CdyTfTAk.js";import"./common-DQOJ18NT.js";import"./mat2d-D9DBP-jx.js";import"./mat2df64-CBKYtunK.js";import"./vec2-ChnYg_BJ.js";import"./vec2f64-Dy6m9Nrb.js";import"./projection-CyCZAIaD.js";import"./projectBuffer-CQnuEMuP.js";import"./geodesicConstants-RQL9oKdk.js";import"./Queue-BQesTh_6.js";import"./signal-CySMLEX9.js";import"./component-utils-D0ciaaZ_.js";const le=jt()({AIX:"aix",EPS:"eps",GIF:"gif",JPG:"jpg",PDF:"pdf",PNG32:"png32",PNG8:"png8",SVG:"svg",SVGZ:"svgz",TIFF:"tiff"},{ignoreUnknown:!1});let H=class extends se{constructor(t){super(t),this.state="pending",this.url=""}initialize(){this.addHandles(j(()=>[this.extension,this.name],()=>this._setFormattedFileName(),dt))}_setFormattedFileName(){this.name&&this.extension&&(this.formattedName=this.count?`${this.name}(${this.count}).${this.extension}`:`${this.name}.${this.extension}`)}};n([c()],H.prototype,"count",void 0),n([c()],H.prototype,"error",void 0),n([c()],H.prototype,"extension",void 0),n([c()],H.prototype,"formattedName",void 0),n([c()],H.prototype,"name",void 0),n([c()],H.prototype,"portalItem",void 0),n([c()],H.prototype,"state",void 0),n([c()],H.prototype,"url",void 0),H=n([q("esri.widgets.Print.FileLink")],H);const bt=H;async function gt(e,t,i,a){return i=gi.from(i||{}),bi(e,"execute",i,t??{},a).then(async({data:o})=>{var l,s;return{results:await Promise.all(((l=o.results)==null?void 0:l.map(vi))??[]),messages:((s=o.messages)==null?void 0:s.map(d=>wi.fromJSON(d)))??[]}})}const ye=new ae({MAP_ONLY:"map-only","A3 Landscape":"a3-landscape","A3 Portrait":"a3-portrait","A4 Landscape":"a4-landscape","A4 Portrait":"a4-portrait","Letter ANSI A Landscape":"letter-ansi-a-landscape","Letter ANSI A Portrait":"letter-ansi-a-portrait","Tabloid ANSI B Landscape":"tabloid-ansi-b-landscape","Tabloid ANSI B Portrait":"tabloid-ansi-b-portrait"}),Y=ye.fromJSON.bind(ye),Pi=ye.toJSON.bind(ye);function Di(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}}function Ai(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}}function lt(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}}function Fi(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}}function Mi(e,t=15){const i=e.canvas.width,a=e.canvas.height,o=e.getImageData(0,0,i,a).data;let l,s,d,u,r,m;e:for(s=a;s--;)for(l=i;l--;)if(o[4*(i*s+l)+3]>t){m=s;break e}if(!m)return null;e:for(l=i;l--;)for(s=m+1;s--;)if(o[4*(i*s+l)+3]>t){r=l;break e}e:for(l=0;l<=r;++l)for(s=m+1;s--;)if(o[4*(i*s+l)+3]>t){d=l;break e}e:for(s=0;s<=m;++s)for(l=d;l<=r;++l)if(o[4*(i*s+l)+3]>t){u=s;break e}return{x:d,y:u,width:r-d,height:m-u}}function vt(e){var i;if(!e.attributionVisible)return;let t;return typeof e.originOf=="function"&&e.originOf("copyright")==="user"&&(t=e.copyright),t||!e.hasAttributionData?(t??(t=(i=e.portalItem)==null?void 0:i.accessInformation),t??(t=e.copyright),t??void 0):void 0}function Vi(e,t){var o,l;const i=((o=t.color)==null?void 0:o.clone())??new _i([0,255,255]),a=((l=t.haloColor)==null?void 0:l.clone())??i.clone();switch(e){case"envelope":case"polygon":return i.a*=t.fillOpacity??.25,new Ii({color:i,outline:new at({color:a}),style:"solid"});case"polyline":return new at({color:a});default:return a.a=1,new Ti({color:a,outline:null})}}function Ni(e,t){const i=e.allLayerViews.items;if(t===e.scale)return i.filter(o=>!o.suspended);const a=new Array;for(const o of i){const l=o.parent;l&&l!==o.view&&(Ui(l)||Bi(l))&&!a.includes(l)||o.visible&&o.visibleAtCurrentTimeExtent&&xi(o.layer.effectiveScaleRange,t)&&a.push(o)}return a}function Ri(e){return(e==null?void 0:e.type)==="bing-maps"}function wt(e){return e&&"blendMode"in e&&"effect"in e}function Ui(e){return e.layer.type==="catalog"}function Bi(e){return e.layer.type==="group"}function Hi(e){const t=e.layer;if(wt(t)){const i=t.blendMode;if((!i||i==="normal")&&(t.effect||"featureEffect"in e&&e.featureEffect))return!0}return!1}let F=class extends se{constructor(t){super(t),this.attributionVisible=!0,this.exportOptions={width:800,height:1100,dpi:96},this.forceFeatureAttributes=!1,this.format="png32",this.includeCharts=!1,this.includeTables=!1,this.label=null,this.layout="map-only",this.layoutItem=null,this.layoutOptions=null,this.outScale=0,this.report=null,this.reportItem=null,this.reportOptions=null,this.scalePreserved=!0,this.showLabels=!0}};n([c()],F.prototype,"attributionVisible",void 0),n([c()],F.prototype,"exportOptions",void 0),n([c()],F.prototype,"forceFeatureAttributes",void 0),n([c()],F.prototype,"format",void 0),n([c()],F.prototype,"includeCharts",void 0),n([c()],F.prototype,"includeTables",void 0),n([c()],F.prototype,"label",void 0),n([c()],F.prototype,"layout",void 0),n([c({type:he})],F.prototype,"layoutItem",void 0),n([c()],F.prototype,"layoutOptions",void 0),n([c()],F.prototype,"outScale",void 0),n([c()],F.prototype,"report",void 0),n([c({type:he})],F.prototype,"reportItem",void 0),n([c()],F.prototype,"reportOptions",void 0),n([c()],F.prototype,"scalePreserved",void 0),n([c()],F.prototype,"showLabels",void 0),F=n([q("esri.rest.support.PrintTemplate")],F);const _t=F,fe=new ae({"Attribute List Letter ANSI A Landscape":"attribute-list-letter-ansi-a-landscape","Attribute List Letter ANSI A Portrait":"attribute-list-letter-ansi-a-portrait","Attribute List With Group Letter ANSI A Landscape":"attribute-list-with-group-letter-ansi-a-landscape","Attribute List With Group Letter ANSI A Portrait":"attribute-list-with-group-letter-ansi-a-portrait","Page per Feature Letter ANSI A Landscape":"page-per-feature-letter-ansi-a-landscape","Page per Feature Letter ANSI A Portrait":"page-per-feature-letter-ansi-a-portrait"});fe.fromJSON.bind(fe);const Wi=fe.toJSON.bind(fe),st={Feet:"ft",Kilometers:"km",Meters:"m",Miles:"mi"},rt=new ae({esriFeet:"Feet",esriKilometers:"Kilometers",esriMeters:"Meters",esriMiles:"Miles"}),zi=new ae({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"}),Te=new Map;async function Ji(e,t,i){var d;const a=await Se(e,i),o=await ji(t,a);if(await Tt(e,i)==="sync"){const{results:u}=await gt(e,o,void 0,i);return(d=u==null?void 0:u[0])==null?void 0:d.value}const l=await ft(e,o,void 0,i);await l.waitForJobCompletion({interval:t.updateDelay});const{value:s}=await l.fetchResultData("Output_File",null,i);return s}async function Se(e,t){const i=Ki(e),a=Te.get(i)??{gpServerUrl:i,legendLayerNameMap:{},legendLayers:[]};return a.gpMetadata??(a.gpMetadata=(await xe(i,ti({f:"json"},t))).data),a.cimVersion=a.gpMetadata.cimVersion,Te.set(i,a),a}async function Tt(e,t){return ga(await Se(e,t))}async function Gi(e,t){return(await Se(e,t)).gpMetadata.tasks}async function ji(e,t){var v,y,L,b,D;t=t||{is11xService:!1,legendLayerNameMap:{},legendLayers:[]};const i=e.template||new _t;i.showLabels==null&&(i.showLabels=!0);const a=i.exportOptions;let o;const l=Pi(i.layout);if(a&&(o={dpi:a.dpi},(l==null?void 0:l.toLowerCase())==="map_only"||l==="")){const{width:f,height:S}=a;o.outputSize=f!=null&&S!=null?[f,S]:void 0}const s=i.layoutOptions;let d;if(s){let f,S;s.scalebarUnit==="Miles"||s.scalebarUnit==="Kilometers"?(f="Kilometers",S="Miles"):s.scalebarUnit!=="Meters"&&s.scalebarUnit!=="Feet"||(f="Meters",S="Feet"),d={titleText:s.titleText,authorText:s.authorText,copyrightText:s.copyrightText,customTextElements:s.customTextElements,elementOverrides:s.elementOverrides,scaleBarOptions:f||S?{metricUnit:rt.toJSON(f)??void 0,metricLabel:f?st[f]:void 0,nonMetricUnit:rt.toJSON(S)??void 0,nonMetricLabel:S?st[S]:void 0}:void 0}}let u=null;s!=null&&s.legendLayers&&(u=s.legendLayers.map(f=>{const S=f.layerId;t.legendLayerNameMap[S]=f.title;const M={id:S};return f.subLayerIds&&(M.subLayerIds=f.subLayerIds),M}));const r=await qi(e,i,t);if(r.operationalLayers){const f=new RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),S=/[\u0600-\u06FF]/,M=O=>{var _;const I=O.text,k=O.font,N=(_=k==null?void 0:k.family)==null?void 0:_.toLowerCase();I&&k&&(N==="arial"||N==="arial unicode ms")&&(k.family=f.test(I)?"Arial Unicode MS":"Arial",k.style!=="normal"&&S.test(I)&&(k.family="Arial Unicode MS"))};for(const O of r.operationalLayers)if((v=O.featureCollection)!=null&&v.layers)for(const I of O.featureCollection.layers){if((b=(L=(y=I.layerDefinition)==null?void 0:y.drawingInfo)==null?void 0:L.renderer)!=null&&b.symbol){const k=I.layerDefinition.drawingInfo.renderer;k.symbol.type==="esriTS"&&M(k.symbol)}if((D=I.featureSet)!=null&&D.features)for(const k of I.featureSet.features)k.symbol&&k.symbol.type==="esriTS"&&M(k.symbol)}}e.outSpatialReference&&(r.mapOptions.spatialReference=e.outSpatialReference.toJSON()),Object.assign(r,{exportOptions:o,layoutOptions:d||{}}),Object.assign(r.layoutOptions,{legendOptions:{operationalLayers:u??t.legendLayers.slice()}}),t.legendLayers.length=0,Te.set(t.gpServerUrl,t);const m={Web_Map_as_JSON:JSON.stringify(r),Format:le.toJSON(i.format),Layout_Template:l,Layout_Item_ID:void 0,Report_Template:Wi(i.report),Report_Item_ID:void 0};if(i.layoutItem){delete m.Layout_Template;const f=i.layoutItem;await f.load(),f.access!=="public"&&te&&await te.getCredential(t.gpServerUrl),m.Layout_Item_ID=JSON.stringify({id:f.id})}if(i.reportItem){delete m.Report_Template;const f=i.reportItem;await f.load(),f.access!=="public"&&te&&await te.getCredential(t.gpServerUrl),m.Report_Item_ID=JSON.stringify({id:f.id})}return e.extraParameters&&Object.assign(m,e.extraParameters),m}async function qi(e,t,i){const a=e.view;let o=a.spatialReference;const l={operationalLayers:await Qi(a,t,i)};t.includeTables&&(l.tables=await da(a));let s=e.extent||i.ssExtent||a.extent;if(o!=null&&o.isWrappable&&(s=s.clone()._normalize(!0),o=s.spatialReference),l.mapOptions={extent:s&&s.toJSON(),spatialReference:o&&o.toJSON(),showAttribution:t.attributionVisible},i.ssExtent=null,a.background&&(l.background=a.background.toJSON()),a.rotation&&(l.mapOptions.rotation=-a.rotation),t.scalePreserved&&(l.mapOptions.scale=t.outScale||a.scale),a.timeExtent!=null){const d=a.timeExtent.start!=null?a.timeExtent.start.getTime():null,u=a.timeExtent.end!=null?a.timeExtent.end.getTime():null;l.mapOptions.time=[d,u]}return t.reportOptions&&(l.reportOptions=t.reportOptions),l}function Ki(e){let t=e;const i=t.lastIndexOf("/GPServer/");return i>0&&(t=t.slice(0,i+9)),t}async function Qi(e,t,i){var d;const a=[],o={layerView:null,printTemplate:t,view:e};let l=0;t.scalePreserved&&(l=t.outScale||e.scale);const s=Ni(e,l);for(const u of s){const r=u.layer;if(!r.loaded||"layers"in r)continue;let m;o.layerView=u,m=Hi(u)?await X(r,o,i):Ri(r)?Zi(r):(r==null?void 0:r.type)==="csv"?await Yi(r,o,i):(r==null?void 0:r.type)==="catalog-footprint"?await Xi(r,o,i):(r==null?void 0:r.type)==="feature"?await ea(r,o,i):(r==null?void 0:r.type)==="geojson"?await ta(r,o,i):(r==null?void 0:r.type)==="graphics"?await ia(r,o,i):(r==null?void 0:r.type)==="imagery"?aa(r,i):(r==null?void 0:r.type)==="imagery-tile"?await oa(r,o,i):(r==null?void 0:r.type)==="kml"?await la(r,o,i):(r==null?void 0:r.type)==="map-image"?sa(r,o,i):(r==null?void 0:r.type)==="map-notes"?await ra(o,i):(r==null?void 0:r.type)==="open-street-map"?na():(r==null?void 0:r.type)==="stream"?await pa(r,o,i):(r==null?void 0:r.type)==="subtype-group"?await ca(r,i):(r==null?void 0:r.type)==="tile"?ua(r,i):(r==null?void 0:r.type)==="vector-tile"?await ma(r,o,i):(r==null?void 0:r.type)==="web-tile"?ha(r):(r==null?void 0:r.type)==="wfs"?await ya(r,o,i):(r==null?void 0:r.type)==="wms"?fa(r,i):(r==null?void 0:r.type)==="wmts"?ba(r):await X(r,o,i),m&&(Array.isArray(m)?a.push(...m):(m.id=r.id,m.title=i.legendLayerNameMap[r.id]||r.title,m.opacity=u.fullOpacity,m.minScale=r.minScale||0,m.maxScale=r.maxScale||0,wt(r)&&r.blendMode&&r.blendMode!=="normal"&&(m.blendMode=r.blendMode),a.push(m)))}if(l)for(const u of a)u.minScale=0,u.maxScale=0;if((d=e.graphics)!=null&&d.length){const u=await W(null,e.graphics,t,i);u&&a.push(u)}return a}function Zi(e){return{culture:e.culture,key:e.key,type:"BingMaps"+(e.style==="aerial"?"Aerial":e.style==="hybrid"?"Hybrid":"Road")}}async function Xi(e,{layerView:t,printTemplate:i},a){if(parseFloat(a.cimVersion)<3.1)return W(e,await ne(t),i,a);const o=e.parent,l={id:(s=B(o,"web-map")).id,url:s.url,layerType:s.layerType,customParameters:s.customParameters,dynamicGroupLayer:{visibility:!1},footprintLayer:s.footprintLayer,layerDefinition:s.layerDefinition};var s;return K(l,o),l}async function Yi(e,t,i){e.legendEnabled&&i.legendLayers.push({id:e.id});const a=t.layerView,o=t.printTemplate;if(!(a.filter||e.portalItem&&e.portalItem.access!=="public")){const l=B(e,"web-map");return l.type="CSV",delete l.popupInfo,delete l.layerType,l.showLabels=o.showLabels&&e.labelsVisible,l}return W(e,await ne(a),o,i)}async function W(e,t,i,a){var f,S,M,O,I,k,N;let o;const l=Ai(),s=Fi(),d=lt(),u=Di(),r=lt();if(r.layerDefinition.name="textLayer",delete r.layerDefinition.drawingInfo,e){if(e.declaredClass==="esri.layers.FeatureLayer"||e.declaredClass==="esri.layers.StreamLayer"?l.layerDefinition.name=s.layerDefinition.name=d.layerDefinition.name=u.layerDefinition.name=a.legendLayerNameMap[e.id]||((f=e.arcgisProps)==null?void 0:f.title)||e.title:e.declaredClass==="esri.layers.GraphicsLayer"&&(t=e.graphics.items),e.renderer){const _=e.renderer.toJSON(),w=l.layerDefinition.drawingInfo;w&&(w.renderer=_);const $=s.layerDefinition.drawingInfo;$&&($.renderer=_);const V=d.layerDefinition.drawingInfo;V&&(V.renderer=_);const Q=u.layerDefinition.drawingInfo;Q&&(Q.renderer=_)}if(i.showLabels&&e.labelsVisible&&typeof e.write=="function"){const _=B(e,"web-map"),w=(M=(S=_.layerDefinition)==null?void 0:S.drawingInfo)==null?void 0:M.labelingInfo;if(w){o=!0;const $=l.layerDefinition.drawingInfo;$&&($.labelingInfo=w);const V=s.layerDefinition.drawingInfo;V&&(V.labelingInfo=w);const Q=d.layerDefinition.drawingInfo;Q&&(Q.labelingInfo=w);const Z=u.layerDefinition.drawingInfo;Z&&(Z.labelingInfo=w)}}}let m;e!=null&&e.renderer||o||(delete l.layerDefinition.drawingInfo,delete s.layerDefinition.drawingInfo,delete d.layerDefinition.drawingInfo,delete u.layerDefinition.drawingInfo);const v=e==null?void 0:e.fieldsIndex,y=e==null?void 0:e.renderer;if(v){const _=new Set;o&&await hi(_,e),y&&typeof y.collectRequiredFields=="function"&&await y.collectRequiredFields(_,v),m=Array.from(_);const w=v.fields.map($=>$.toJSON());l.layerDefinition.fields=w,s.layerDefinition.fields=w,d.layerDefinition.fields=w,u.layerDefinition.fields=w}const L=t==null?void 0:t.length;let b;for(let _=0;_<L;_++){const w=t[_]||t.at(_);if(w.visible!==!1&&w.geometry){if(b=w.toJSON(),b.hasOwnProperty("popupTemplate")&&delete b.popupTemplate,(O=b.geometry)!=null&&O.z&&delete b.geometry.z,b.symbol&&(b.symbol.angle||delete b.symbol.angle,ue(b.symbol)?b.symbol=await de(b.symbol,a):b.symbol.text&&delete b.attributes),(!i||!i.forceFeatureAttributes)&&(m==null?void 0:m.length)){const $={};for(const V of m)(I=b.attributes)!=null&&I.hasOwnProperty(V)&&($[V]=b.attributes[V]);b.attributes=$}w.geometry.type==="polygon"?l.featureSet.features.push(b):w.geometry.type==="polyline"?s.featureSet.features.push(b):w.geometry.type==="point"?(k=b.symbol)!=null&&k.text?r.featureSet.features.push(b):d.featureSet.features.push(b):w.geometry.type==="multipoint"?u.featureSet.features.push(b):w.geometry.type==="extent"&&(b.geometry=mi.fromExtent(w.geometry).toJSON(),l.featureSet.features.push(b))}}const D=[l,s,u,d,r].filter(_=>_.featureSet.features.length>0);for(const _ of D){const w=_.featureSet.features.every($=>$.symbol);if(w&&(!i||!i.forceFeatureAttributes))for(const $ of _.featureSet.features)delete $.attributes;w&&delete _.layerDefinition.drawingInfo,(N=_.layerDefinition.drawingInfo)!=null&&N.renderer&&await It(_.layerDefinition.drawingInfo.renderer,a)}return D.length?{featureCollection:{layers:D},showLabels:o}:null}async function ea(e,t,i){var v,y,L,b,D,f,S,M,O,I,k,N;let a;const o=e.renderer,l=parseFloat(i.cimVersion);if(((v=e.featureReduction)==null?void 0:v.type)==="binning"||((y=e.featureReduction)==null?void 0:y.type)==="cluster"&&l<2.9||(o==null?void 0:o.type)==="pie-chart"||(o==null?void 0:o.type)==="dot-density"&&l<2.6)return X(e,t,i);e.legendEnabled&&i.legendLayers.push({id:e.id});const s=t.layerView,{printTemplate:d,view:u}=t,r=((L=e.source)==null?void 0:L.type)!=="feature-layer"&&((b=e.source)==null?void 0:b.type)!=="ogc-feature";if(s.filter||r||!o||"field"in o&&o.field!=null&&!e.getField(o.field)){const _=await ne(s);a=await W(e,_,d,i)}else{if(a={id:(m=B(e)).id,title:m.title,url:m.url,layerType:m.layerType,customParameters:m.customParameters,layerDefinition:m.layerDefinition,charts:d.includeCharts?m.charts:void 0},d.attributionVisible&&(a.credits=vt(e)),a.showLabels=d.showLabels&&e.labelsVisible,K(a,e),(f=(D=a.layerDefinition)==null?void 0:D.featureReduction)==null||delete f.disablePopup,(M=(S=a.layerDefinition)==null?void 0:S.featureReduction)==null||delete M.popupInfo,s.displayFilterEnabled||((O=a.layerDefinition)==null||delete O.displayFilterInfo),((k=(I=a.layerDefinition)==null?void 0:I.drawingInfo)==null?void 0:k.renderer)&&(delete a.layerDefinition.minScale,delete a.layerDefinition.maxScale,await It(a.layerDefinition.drawingInfo.renderer,i),"visualVariables"in o&&((N=o.visualVariables)==null?void 0:N[0]))){const w=o.visualVariables[0];if(w.type==="size"&&w.maxSize&&typeof w.maxSize!="number"&&w.minSize&&typeof w.minSize!="number"){const $=fi(w,u.scale);a.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=$.minSize,a.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=$.maxSize}}const _=yi(s);if(_&&(a.layerDefinition??(a.layerDefinition={}),a.layerDefinition.definitionExpression=a.layerDefinition.definitionExpression?`(${a.layerDefinition.definitionExpression}) AND (${_})`:_),e.gdbVersion&&(a.layerDefinition??(a.layerDefinition={}),a.layerDefinition.gdbVersion=e.gdbVersion),s.hasHighlight&&"highlightIds"in s){const w=s;a.selectionObjectIds=w.highlightIds,a.selectionSymbol=Vi(e.geometryType,w.highlightOptions??u.highlightOptions)}}var m;return a}async function ta(e,t,i){var a,o;return((a=e.featureReduction)==null?void 0:a.type)==="binning"||((o=e.featureReduction)==null?void 0:o.type)==="cluster"?X(e,t,i):(e.legendEnabled&&i.legendLayers.push({id:e.id}),W(e,await ne(t.layerView),t.printTemplate,i))}async function ia(e,{printTemplate:t},i){return W(e,null,t,i)}function aa(e,t){var o;e.legendEnabled&&t.legendLayers.push({id:e.id});const i={layerType:(a=B(e)).layerType,customParameters:a.customParameters};var a;return i.bandIds=e.bandIds,i.compressionQuality=e.compressionQuality,i.format=e.format,i.interpolation=e.interpolation,(e.mosaicRule||e.definitionExpression)&&(i.mosaicRule=e.exportImageServiceParameters.mosaicRule.toJSON()),e.rasterFunction&&(i.renderingRule=e.rasterFunction.toJSON()),e.renderer&&(i.layerDefinition??(i.layerDefinition={}),(o=i.layerDefinition).drawingInfo??(o.drawingInfo={}),i.layerDefinition.drawingInfo.renderer=e.renderer.toJSON()),K(i,e),i}async function oa(e,t,i){var l;if(((l=e.renderer)==null?void 0:l.type)==="flow")return X(e,t,i);e.legendEnabled&&i.legendLayers.push({id:e.id});const a={bandIds:(o=B(e)).bandIds,customParameters:o.customParameters,interpolation:o.interpolation,layerDefinition:o.layerDefinition};var o;return a.layerType="ArcGISImageServiceLayer",K(a,e),a}async function la(e,t,i){const a=t.printTemplate;if(!e.portalItem||e.portalItem.access==="public"){const r=B(e,"web-map");return r.type="kml",delete r.layerType,r.url=re(e.url),r}const o=[],l=t.layerView,s="data:image/png;base64,";l.allVisibleMapImages.forEach((r,m)=>{const v={id:`${e.id}_image${m}`,type:"image",title:e.id,minScale:e.minScale||0,maxScale:e.maxScale||0,opacity:l.fullOpacity,extent:r.extent};r.href.startsWith(s)?v.imageData=r.href.slice(s.length):v.url=r.href,o.push(v)});const d=[...l.allVisiblePoints.items,...l.allVisiblePolylines.items,...l.allVisiblePolygons.items],u={id:e.id,...await W(null,d,a,i)};return o.push(u),o}function sa(e,{printTemplate:t,view:i},a){var m,v;let o;const l={id:e.id,subLayerIds:[]};let s=[];const d=i.scale,u=y=>{const L=d===0,b=y.minScale===0||d<=y.minScale,D=y.maxScale===0||d>=y.maxScale;if(y.visible&&(L||b&&D))if(y.sublayers)y.sublayers.forEach(u);else{const f=y.toExportImageJSON(),S={id:y.id,name:y.title,layerDefinition:{definitionExpression:f.definitionExpression,drawingInfo:f.drawingInfo,orderBy:f.orderBy,source:f.source}};s.unshift(S),l.subLayerIds.push(y.id)}};var r;return e.sublayers&&e.sublayers.forEach(u),s.length&&(s=s.map(({id:y,name:L,layerDefinition:b})=>({id:y,name:L,layerDefinition:b})),o={layerType:(r=B(e)).layerType,customParameters:r.customParameters},o.layers=s,o.visibleLayers=(v=(m=e.capabilities)==null?void 0:m.exportMap)!=null&&v.supportsDynamicLayers?void 0:l.subLayerIds,t.attributionVisible&&(o.credits=vt(e)),e.gdbVersion&&(o.gdbVersion=e.gdbVersion),K(o,e),e.legendEnabled&&a.legendLayers.push(l)),o}async function ra({layerView:e,printTemplate:t},i){const a=[],o=e.layer;if(o.featureCollections!=null)for(const l of o.featureCollections){const s=await W(l,l.source,t,i);s&&a.push(...s.featureCollection.layers)}else if(o.sublayers!=null)for(const l of o.sublayers){const s=await W(null,l.graphics,t,i);s&&a.push(...s.featureCollection.layers)}return{featureCollection:{layers:a}}}function na(){return{type:"OpenStreetMap"}}async function X(e,{printTemplate:t,view:i},a){var v;const o={type:"image"},l={format:"png",ignoreBackground:!0,ignorePadding:!0,layers:[e]};i.rotation!==0&&(l.rotation=0);const s=a.ssExtent||i.state.extent.clone();let d=96,u=!0,r=!0;if(t.exportOptions){const y=t.exportOptions;y.dpi!=null&&y.dpi>0&&(d=y.dpi),y.width!=null&&y.width>0&&(u=y.width%2==i.width%2),y.height!=null&&y.height>0&&(r=y.height%2==i.height%2)}if(t.layout==="map-only"&&t.scalePreserved&&(!t.outScale||t.outScale===i.scale)&&d===96&&(!u||!r)&&i.state.extent.equals(i.extent)&&(l.area={x:0,y:0,width:i.width,height:i.height},u||(l.area.width-=1),r||(l.area.height-=1),!a.ssExtent)){const y=i.toMap(yt(l.area.width,l.area.height));s.ymin=y.y,s.xmax=y.x,a.ssExtent=s}o.extent=s.clone()._normalize(!0).toJSON();const m=await i.takeScreenshot(l);return o.imageData=(v=qt(m.dataUrl))==null?void 0:v.data,o}async function pa(e,{layerView:t,printTemplate:i},a){return e.legendEnabled&&a.legendLayers.push({id:e.id}),W(e,await ne(t),i,a)}async function ca(e,t){if(e.legendEnabled)for(const o of e.sublayers)o.legendEnabled&&t.legendLayers.push({id:o.id});const i={customParameters:(a=B(e)).customParameters,effect:a.effect,layerDefinition:a.layerDefinition,layerType:a.layerType,layers:a.layers,url:a.url};var a;if(Array.isArray(i.layers))for(const o of i.layers)delete o.popupInfo;return K(i,e),i}async function da(e){var o,l;const t=[],i=[];for(const s of e.map.allTables)s.type!=="feature"||s.loaded||i.push(s.load());i.length&&await Promise.allSettled(i);for(const s of e.map.allTables)if(s.type==="feature"&&s.loaded&&s.isTable&&((o=s.source)==null?void 0:o.type)==="feature-layer"){const d={id:(a=B(s)).id,title:a.title,customParameters:a.customParameters,layerDefinition:{definitionExpression:(l=a.layerDefinition)==null?void 0:l.definitionExpression},url:a.url};K(d,s),t.push(d)}var a;return t.length?t:void 0}function ua(e,t){e.legendEnabled&&t.legendLayers.push({id:e.id});const i={layerType:(a=B(e)).layerType,customParameters:a.customParameters};var a;return K(i,e),i}async function ma(e,t,i){const a=t.layerView;if(e.serviceUrl&&e.styleUrl&&!a.spriteSourceChanged&&!a.styleChanged){const o=me(e.styleUrl,e.apiKey),l=me(e.serviceUrl,e.apiKey);if(!o&&!l||i.cimVersion!=="2.1.0"){const s={type:"VectorTileLayer"};return s.styleUrl=re(e.styleUrl),s.token=o,l!==o&&(s.additionalTokens=[{url:e.serviceUrl,token:l}]),s}}return X(e,t,i)}function ha(e){var a;const t=(a=e.urlTemplate)==null?void 0:a.replace(/\${/g,"{"),i={type:"WebTiledLayer",urlTemplate:t,credits:e.copyright};return e.subDomains&&e.subDomains.length>0&&(i.subDomains=e.subDomains),i}async function ya(e,t,i){return parseFloat(i.cimVersion)<3.5?X(e,t,i):(e.legendEnabled&&i.legendLayers.push({id:e.id}),{layerType:(a=B(e,"web-map")).layerType,layerDefinition:a.layerDefinition,url:a.url,wfsInfo:a.wfsInfo});var a}function fa(e,t){let i;const a=[],o=l=>{l.visible&&(l.sublayers?l.sublayers.forEach(o):l.name&&a.unshift(l.name))};return e.sublayers&&e.sublayers.forEach(o),a.length&&(e.legendEnabled&&t.legendLayers.push({id:e.id,subLayerIds:a}),i={type:"wms",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,transparentBackground:e.imageTransparency,visibleLayers:a,url:re(e.url),version:e.version}),i}function ba(e){const t=e.activeLayer;return{type:"wmts",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:t.imageFormat,layer:t.id,style:t.styleId,tileMatrixSet:t.tileMatrixSetId,url:re(e.url)}}function K(e,t){t.url&&(e.url=re(e.url||t.url),e.token=me(e.url,t.apiKey))}async function de(e,t){var s;t.canvas||(t.canvas=document.createElement("canvas"));const i=1024;t.canvas.width=i,t.canvas.height=i;const a=t.canvas.getContext("2d");let o,l;if(e.path){const d=new Path2D(e.path);d.closePath(),a.fillStyle=Array.isArray(e.color)?`rgba(${e.color[0]},${e.color[1]},${e.color[2]},${e.color[3]/255})`:"rgb(0,0,0)",a.fill(d);const u=Mi(a);if(!u)return null;a.clearRect(0,0,i,i);const r=pe(e.size)/Math.max(u.width,u.height);a.scale(r,r);const m=i/r,v=m/2-u.width/2-u.x,y=m/2-u.height/2-u.y;if(a.translate(v,y),Array.isArray(e.color)&&a.fill(d),((s=e.outline)==null?void 0:s.width)&&Array.isArray(e.outline.color)){const b=e.outline;a.lineWidth=pe(b.width)/r,a.lineJoin="round",a.strokeStyle=`rgba(${b.color[0]},${b.color[1]},${b.color[2]},${b.color[3]/255})`,a.stroke(d),u.width+=a.lineWidth,u.height+=a.lineWidth}u.width*=r,u.height*=r;const L=a.getImageData(i/2-u.width/2,i/2-u.height/2,Math.ceil(u.width),Math.ceil(u.height));o=L.width,l=L.height,a.canvas.width=o,a.canvas.height=l,a.putImageData(L,0,0)}else{const d=e.contentType==="image/svg+xml"?"data:image/svg+xml;base64,"+e.imageData:e.url,u=(await xe(d,{responseType:"image"})).data;o=pe(e.width),l=pe(e.height),a.canvas.width=o,a.canvas.height=l,a.drawImage(u,0,0,a.canvas.width,a.canvas.height)}return{type:"esriPMS",imageData:a.canvas.toDataURL("image/png").slice(22),angle:e.angle,contentType:"image/png",height:it(l),width:it(o),xoffset:e.xoffset,yoffset:e.yoffset}}async function It(e,t){const i=e.type;if(i==="simple"&&ue(e.symbol))e.symbol=await de(e.symbol,t);else if(i==="uniqueValue"||i==="classBreaks"){ue(e.defaultSymbol)&&(e.defaultSymbol=await de(e.defaultSymbol,t));const a=e[i==="uniqueValue"?"uniqueValueInfos":"classBreakInfos"];if(a)for(const o of a)ue(o.symbol)&&(o.symbol=await de(o.symbol,t))}}async function ne(e){return e.queryFeatures(e.createQuery()).then(t=>t.features)}function B(e,t){return e.write({},{ignorePersistenceEnabled:!0,origin:t})??{}}function ga(e){var t;return(t=e.gpMetadata)!=null&&t.executionType?zi.fromJSON(e.gpMetadata.executionType):"sync"}function ue(e){var t;return e&&(e.path||e.contentType==="image/svg+xml"||((t=e.url)==null?void 0:t.endsWith(".svg")))}let z=class extends se{constructor(t){super(t),this.extent=null,this.extraParameters=null,this.outSpatialReference=null,this.template=null,this.updateDelay=1e3,this.view=null}};n([c()],z.prototype,"extent",void 0),n([c()],z.prototype,"extraParameters",void 0),n([c({type:be})],z.prototype,"outSpatialReference",void 0),n([c()],z.prototype,"template",void 0),n([c()],z.prototype,"updateDelay",void 0),n([c()],z.prototype,"view",void 0),z=n([q("esri.rest.support.PrintParameters")],z);const va=z;let P=class extends se{constructor(e){super(e),this.strokeDash=[],this.strokeWidth=2,this.strokeColor=[0,0,0,1],this.strokeBackgroundColor=[0,0,0,0],this.fillColor=[0,0,0,0],this.backgroundFillColor=[0,0,0,.5],this.visible=!0,this.isDecoration=!1,this.boxWidth=0,this.boxHeight=0,this.backgroundWidth=0,this.backgroundHeight=0,this.padding={left:0,top:0,right:0,bottom:0}}get _strokeStyle(){return`rgba(${this.strokeColor.join()})`}get _strokeBackgroundStyle(){return`rgba(${this.strokeBackgroundColor.join()})`}get _fillStyle(){return`rgba(${this.fillColor.join()})`}get _backgroundFillStyle(){return`rgba(${this.backgroundFillColor.join()})`}render(){const{backgroundWidth:e,backgroundHeight:t,boxWidth:i,boxHeight:a,padding:o}=this,l=o.left,s=o.top,d=this.x??l+e/2-i/2,u=this.y??s+t/2-a/2,r=d+i,m=u+a;return p("div",{classes:{"esri-box-overlay-item":!0},styles:{left:"0px",top:"0px",width:"100%",height:"100%",visibility:this.visible?"visible":"hidden"}},p("svg",{styles:{width:"100%",height:"100%"}},p("path",{d:`M ${l} ${s} L ${e+l} ${s} L ${e+l} ${t+s} L ${l} ${t+s} Z M ${d} ${u} L ${d} ${m} L ${r} ${m} L ${r} ${u} Z`,fill:this._backgroundFillStyle,stroke:this._strokeBackgroundStyle,"stroke-width":this.strokeWidth}),p("rect",{fill:this._fillStyle,height:a,stroke:this._strokeStyle,"stroke-dasharray":this.strokeDash.join(" ")||void 0,"stroke-width":this.strokeWidth,width:i,x:d,y:u})))}renderCanvas(){}};n([c()],P.prototype,"strokeDash",void 0),n([c()],P.prototype,"strokeWidth",void 0),n([c()],P.prototype,"strokeColor",void 0),n([c()],P.prototype,"strokeBackgroundColor",void 0),n([c()],P.prototype,"fillColor",void 0),n([c()],P.prototype,"backgroundFillColor",void 0),n([c()],P.prototype,"visible",void 0),n([c()],P.prototype,"isDecoration",void 0),n([c()],P.prototype,"boxWidth",void 0),n([c()],P.prototype,"boxHeight",void 0),n([c()],P.prototype,"backgroundWidth",void 0),n([c()],P.prototype,"backgroundHeight",void 0),n([c()],P.prototype,"x",void 0),n([c()],P.prototype,"y",void 0),n([c()],P.prototype,"padding",void 0),n([c({readOnly:!0})],P.prototype,"_strokeStyle",null),n([c({readOnly:!0})],P.prototype,"_strokeBackgroundStyle",null),n([c({readOnly:!0})],P.prototype,"_fillStyle",null),n([c({readOnly:!0})],P.prototype,"_backgroundFillStyle",null),P=n([q("esri.views.overlay.BoxOverlayItem")],P);const wa=P;async function xt(e,t,i){if(!e)throw new G("print:invalid-layout-info-task-url","Can't fetch layout template info",{url:e});if(await Tt(e)==="async"){const a=await ft(e,t,void 0,i||void 0);return await a.waitForJobCompletion(),(await a.fetchResultData("Output_JSON")).value}return(await gt(e,t,null,i)).results[0].value}let U=class extends Oi{constructor(e){super(e),this.description=null,this.format=null,this.state="not-loaded",this.label=null,this.layoutInfoTaskUrl=null,this.layout=null,this.layoutItem=null,this.layoutOptions=null,this.layoutTemplateInfo=null,this.type=null}get id(){var e;return((e=this.layoutItem)==null?void 0:e.id)??`${this.layout}-${ki(JSON.stringify(this.toJSON()))}`}get mapSurroundInfoOptions(){var i,a,o;const e=(a=(i=this.layoutTemplateInfo)==null?void 0:i.layoutOptions)==null?void 0:a.mapSurroundInfos;if(!e)return null;const t={northArrow:[],scaleBar:[],legend:[]};for(const l of e)switch(l.type){case"CIMMarkerNorthArrow":t.northArrow.push(l);break;case"CIMScaleLine":t.scaleBar.push(l);break;case"CIMGroupElement":(o=l.elements)!=null&&o.some(s=>s.type==="CIMScaleLine")&&t.scaleBar.push(l);break;case"CIMLegend":t.legend.push(l)}return t}_updateLayoutOptions(e){var o,l,s,d,u,r,m,v;const t=((o=this.layoutOptions)==null?void 0:o.legend)??((l=e.layoutOptions)==null?void 0:l.hasLegend),i=((s=this.layoutOptions)==null?void 0:s.northArrow)??((d=this.mapSurroundInfoOptions)!=null&&d.northArrow.length?(u=this.mapSurroundInfoOptions)==null?void 0:u.northArrow.some(({visible:y})=>y):void 0),a=((r=this.layoutOptions)==null?void 0:r.scaleBar)??((m=this.mapSurroundInfoOptions)!=null&&m.scaleBar.length?(v=this.mapSurroundInfoOptions)==null?void 0:v.scaleBar.some(({visible:y})=>y):void 0);this._set("layoutOptions",{legend:t,northArrow:i,scaleBar:a})}async fetchLayoutItemTemplateInfo(e){const{layoutItem:t}=this;if(t!=null&&t.id&&!this.layoutTemplateInfo&&this.state!=="loaded")try{this._set("state","loading");const i=this.layoutInfoTaskUrl;if(!i)throw new G("print:invalid-layout-info-task-url","Can't fetch layout template info",{url:i});t.access!=="public"&&te&&await te.getCredential(i);const a={Layout_Item_ID:JSON.stringify({id:t.id})},o=(await xt(i,a,e))[0];this.setLayoutTemplateInfo(o)}catch(i){this._set("state",ct(i)?"not-loaded":"error")}}setLayoutTemplateInfo(e){this._set("layoutTemplateInfo",e),this._updateLayoutOptions(e),this._set("state","loaded")}};n([c({json:{write:!0}})],U.prototype,"description",void 0),n([Ei(le)],U.prototype,"format",void 0),n([c({readOnly:!0})],U.prototype,"id",null),n([c({readOnly:!0})],U.prototype,"state",void 0),n([c({json:{write:!0}})],U.prototype,"label",void 0),n([c()],U.prototype,"layoutInfoTaskUrl",void 0),n([c({json:{read:Y,write:!0}})],U.prototype,"layout",void 0),n([c({type:he,json:{write:!0}})],U.prototype,"layoutItem",void 0),n([c({readOnly:!0,json:{write:!0}})],U.prototype,"layoutOptions",void 0),n([c({readOnly:!0})],U.prototype,"layoutTemplateInfo",void 0),n([c({readOnly:!0})],U.prototype,"mapSurroundInfoOptions",null),n([c()],U.prototype,"type",void 0),U=n([q("esri.widgets.Print.CustomTemplate")],U);const ee=U;let C=class extends se{constructor(e){super(e),this._abortController=null,this.attributionEnabled=!0,this.author=null,this.copyright=null,this.customTextElements=null,this.dpi=96,this.fileName=null,this.forceFeatureAttributes=!1,this.format="pdf",this.height=null,this.includeTables=!0,this.id=null,this.state="ready",this.layout="letter-ansi-a-landscape",this.layoutItem=null,this.legendEnabled=void 0,this.northArrowEnabled=void 0,this.scale=null,this.scaleBarEnabled=void 0,this.scaleEnabled=!1,this.title=null,this.width=null}async applyTemplate(e,t){var o,l,s,d,u;if((e==null?void 0:e.id)===this.id&&(e==null?void 0:e.state)!=="error"||(this._abortController&&(this._abortController.abort(),this._abortController=null),!e))return;if(this._set("state","pending"),this._resetMapSurroundInfoOptions(),this._set("id",e.id),this.set({layout:e.layout,layoutItem:e.layoutItem}),!e.layoutOptions&&e.layoutItem){const r=new AbortController;if(this._abortController=r,await e.fetchLayoutItemTemplateInfo({signal:this._abortController.signal}),e.state!=="loaded")return e.state==="error"&&this._set("state","error"),this._abortController!==r?void 0:void(this._abortController=null);this._abortController=null}const i=t==null?void 0:t.customLayoutOptions,a=(t==null?void 0:t.customTextElements)??((l=(o=e.layoutTemplateInfo)==null?void 0:o.layoutOptions)==null?void 0:l.customTextElements)??this.customTextElements;this.set({customTextElements:a?_e(a):void 0,format:this.format??e.format,legendEnabled:(i==null?void 0:i.legend)??((s=e.layoutOptions)==null?void 0:s.legend)??this.legendEnabled,northArrowEnabled:(i==null?void 0:i.northArrow)??((d=e.layoutOptions)==null?void 0:d.northArrow)??this.northArrowEnabled,scaleBarEnabled:(i==null?void 0:i.scaleBar)??((u=e.layoutOptions)==null?void 0:u.scaleBar)??this.scaleBarEnabled}),this._set("state","ready")}reset(){this._set("id",null),this._set("state","ready"),this.set({layout:null,layoutItem:null,customTextElements:null}),this._resetMapSurroundInfoOptions()}_resetMapSurroundInfoOptions(){this.set({legendEnabled:void 0,northArrowEnabled:void 0,scaleBarEnabled:void 0})}};n([c()],C.prototype,"attributionEnabled",void 0),n([c()],C.prototype,"author",void 0),n([c()],C.prototype,"copyright",void 0),n([c()],C.prototype,"customTextElements",void 0),n([c()],C.prototype,"dpi",void 0),n([c()],C.prototype,"fileName",void 0),n([c()],C.prototype,"forceFeatureAttributes",void 0),n([c()],C.prototype,"format",void 0),n([c()],C.prototype,"height",void 0),n([c()],C.prototype,"includeTables",void 0),n([c({readOnly:!0})],C.prototype,"id",void 0),n([c({readOnly:!0})],C.prototype,"state",void 0),n([c()],C.prototype,"layout",void 0),n([c({type:he})],C.prototype,"layoutItem",void 0),n([c()],C.prototype,"legendEnabled",void 0),n([c()],C.prototype,"northArrowEnabled",void 0),n([c()],C.prototype,"scale",void 0),n([c()],C.prototype,"scaleBarEnabled",void 0),n([c()],C.prototype,"scaleEnabled",void 0),n([c()],C.prototype,"title",void 0),n([c()],C.prototype,"width",void 0),C=n([q("esri.widgets.Print.TemplateOptions")],C);const St=C,_a=[30,144,255,255],nt=[237,211,23,255],Ta=[216,48,32,255],Ia=new Set(["GISProfessionalStdUT","GISProfessionalAdvUT"]),xa=/(\/GPServer\/).+/i,Sa=new ae({inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"}),ie=ut.ofType(ee);function Oa(e){var i;e.layoutOptions??(e.layoutOptions={}),(i=e.layoutOptions).customTextElements??(i.customTextElements=[]);const t="date";if(!e.layoutOptions.customTextElements.find(a=>t in a)){const{customTextElements:a}=e.layoutOptions;let o=ci(Date.now(),di("short-date"));ui()==="ar"&&(o="‏"+o),a.push({date:o})}}function we(e,t,i){t&&t.visible!==i&&e.layoutOptions&&(e.layoutOptions.elementOverrides?e.layoutOptions.elementOverrides[t.name]={visible:i}:e.layoutOptions.elementOverrides={[t.name]:{visible:i}})}let E=class extends ri{constructor(t){super(t),this._serviceTemplateCustomTextElements=null,this._templateIdToCustomTemplate=new ni,this._isFreeHand=!1,this._freeHandWidth=0,this._freehandHeight=0,this._asyncPrintTaskUrl=null,this._layoutInfoTaskUrl=null,this._customLayoutOptions=null,this.allowedFormats="all",this.allowedLayouts="all",this.browseTemplates=new ie,this.defaultTemplates=new ie,this.error=null,this.extraParameters=null,this.includeDefaultTemplates=!0,this.outSpatialReference=null,this.portal=ht.getDefault(),this.portalTemplateIds=[],this.printServiceTemplates=new ie,this.defaultTemplate=null,this.showPrintAreaEnabled=!1,this.printServiceUrl=null,this.printTimeout=12e4,this.templatesInfo=null,this.updateDelay=1e3,this.view=null,this.templateCustomTextElements=null,this.templateOptions=new St}initialize(){this.addHandles([j(()=>[this.showPrintAreaEnabled,this.view],()=>{var t,i;this.showPrintAreaEnabled?this._enablePrintPreview():(this.removeHandles("overlay-handler"),(i=(t=this.view)==null?void 0:t.overlay)==null||i.removeItem(this._getOverlayItem()))}),j(()=>[this.templateOptions.layout,this.templateOptions.layoutItem],()=>{this.loaded&&this._processTemplateOptions()})])}destroy(){var t;this.removeHandles("overlay-handler"),this.view&&(this._overlayItem&&((t=this.view.overlay)==null||t.removeItem(this._overlayItem),this._overlayItem.destroy(),this._overlayItem=null),this.view=null)}get effectivePrintServiceUrl(){return this.printServiceUrl??null}get effectiveTemplateCustomTextElements(){if(!this._serviceTemplateCustomTextElements)return{};const t=_e(this._serviceTemplateCustomTextElements);return this.templateCustomTextElements&&Object.keys(this.templateCustomTextElements).forEach(i=>{var o;const a=t[i];if(a){const l=(o=this.templateCustomTextElements)==null?void 0:o[i];a.forEach(s=>{const[d]=Object.entries(s)[0];l==null||l.forEach(u=>{const[r,m]=Object.entries(u)[0];d===r&&(s[d]=m)})})}}),Object.freeze(t)}get state(){var t;return this.loadStatus==="loading"?"initializing":this.loadStatus==="failed"||this.error?"error":this.loadStatus==="loaded"&&((t=this.view)!=null&&t.ready)?"ready":"disabled"}async load(t){return this.addResolvingPromise(this._loadResources(t).catch(i=>this.error=i)),this}async print(t){var r;const{view:i,extraParameters:a,updateDelay:o,outSpatialReference:l}=this;if(!i)throw new G("print:view-required","view is not set");Oa(t);const s=this._getOverlayItem(),d=t.scalePreserved||!this.showPrintAreaEnabled?void 0:Si(new pi,i.viewpoint,t.layout==="map-only"?[t.exportOptions.width,t.exportOptions.height]:[s.boxWidth,s.boxHeight]),u=new va({view:i,template:t,extent:d,extraParameters:a,updateDelay:o,outSpatialReference:l});try{const m=!!((r=t.layoutItem)!=null&&r.id)&&(this.portalTemplateIds.includes(t.layoutItem.id)||this.browseTemplates.some(v=>{var y,L;return((y=v.layoutItem)==null?void 0:y.id)===((L=t.layoutItem)==null?void 0:L.id)}));return await Ji(m&&this._asyncPrintTaskUrl?this._asyncPrintTaskUrl:this.effectivePrintServiceUrl,u,{timeout:this.printTimeout})}catch(m){throw new G("print:export-error","An error occurred while exporting the web map.",{error:m})}}toPrintTemplate({attributionEnabled:t,author:i,copyright:a,customTextElements:o,dpi:l,forceFeatureAttributes:s,format:d,height:u,id:r,includeTables:m,layout:v,layoutItem:y,legendEnabled:L,northArrowEnabled:b,scale:D,scaleBarEnabled:f,scaleEnabled:S,title:M,width:O}){var k;if(!v&&!y)throw new G("print:layout-required","layout is not set");const I=new _t({attributionVisible:t,forceFeatureAttributes:s,format:d,includeTables:m,layout:v,layoutItem:y,layoutOptions:{authorText:i||"",copyrightText:a||"",customTextElements:o,titleText:M||""},outScale:D??0,scalePreserved:S});if(O&&(I.exportOptions.width=O),u&&(I.exportOptions.height=u),l&&(I.exportOptions.dpi=l),I.layoutOptions){L||(I.layoutOptions.legendLayers=[]);const N=(k=this.getLayoutTemplateById(r))==null?void 0:k.mapSurroundInfoOptions;if(N){const _=N.northArrow;for(const V of _)we(I,V,b);const w=N.scaleBar;for(const V of w)we(I,V,f);const $=N.legend;for(const V of $)we(I,V,L)}}return I}getLayoutTemplateById(t){return t?this._templateIdToCustomTemplate.get(t):null}async addPortalTemplate(t){if(!this.portal||!(t!=null&&t.id))return;try{t.loaded||await t.load()}catch{return void this.applyTemplate(this.defaultTemplate)}const i=new ee({type:"browse-template",layoutInfoTaskUrl:this._layoutInfoTaskUrl,label:t.title,layoutItem:t});this._templateIdToCustomTemplate.set(i.id,i),this.browseTemplates.add(i)}removePortalTemplate(t){t.layoutItem&&this.templateOptions.id===t.layoutItem.id&&(this.defaultTemplate?this.applyTemplate(this.defaultTemplate):this.templateOptions.reset()),this.browseTemplates.remove(t),this._templateIdToCustomTemplate.delete(t.id)}async applyTemplate(t){var o,l,s,d;if(!t)return void this.templateOptions.reset();!t.layout||!this.templatesInfo||this.templatesInfo.layout.choiceList.includes(t.layout)||(this.defaultTemplate?t=this.defaultTemplate:this.templateOptions.reset());const i=t.layout||((o=t.layoutItem)==null?void 0:o.id),a=i?(l=this.templateCustomTextElements)==null?void 0:l[i]:void 0;if(await this.templateOptions.applyTemplate(t,{customTextElements:a,customLayoutOptions:this._customLayoutOptions}),i&&this._serviceTemplateCustomTextElements&&!this._serviceTemplateCustomTextElements[i]&&((d=(s=t.layoutTemplateInfo)==null?void 0:s.layoutOptions)==null?void 0:d.customTextElements)){const u=_e(this._serviceTemplateCustomTextElements);u[i]=t.layoutTemplateInfo.layoutOptions.customTextElements,this._serviceTemplateCustomTextElements=Object.freeze(u)}}async _loadResources(t){if(this.destroyed)return;await this._loadUrls(t);const[i,a]=await Promise.all([this._getLayoutToLayoutTemplateInfos(t),this._getPrintServiceTemplatesInfo(t)]);await this._loadAllTemplates(i,a,t),this._processPrintServiceTemplatesInfo(a),await this._processTemplateOptions(),this._updateOverLayItem()}async _processTemplateOptions(){const{layout:t,layoutItem:i}=this.templateOptions;if(t!=="map-only"&&!this.templateOptions.id){if(this._customLayoutOptions={legend:this.templateOptions.legendEnabled,northArrow:this.templateOptions.northArrowEnabled,scaleBar:this.templateOptions.scaleBarEnabled},i==null?void 0:i.id){try{i.loaded||await i.load()}catch{return void this.applyTemplate(this.defaultTemplate)}let a=this._templateIdToCustomTemplate.get(i.id);a||(a=new ee({label:i.title,layoutItem:i,layoutInfoTaskUrl:this._layoutInfoTaskUrl}),this._templateIdToCustomTemplate.set(a.id,a)),await this.applyTemplate(a)}else if(t){const a=this.defaultTemplates.find(o=>o.layout===this.templateOptions.layout)??this.printServiceTemplates.find(o=>o.layout===this.templateOptions.layout);await this.applyTemplate(a??this.defaultTemplate)}}}async _loadPortal(t){try{await this.portal.load(t)}catch(i){throw new G("print:could-not-load-portal","Cannot load print resource information from portal",{error:i,url:this.effectivePrintServiceUrl})}}async _loadUrls(t){var a,o;if(this.printServiceUrl)this._set("effectivePrintServiceUrl",this.printServiceUrl),await this._updateLayoutInfoTaskUrl(this.effectivePrintServiceUrl);else{await this._loadPortal(t);const{printTask:l,asyncPrintTask:s,layoutInfoTask:d}=((a=this.portal)==null?void 0:a.helperServices)??{};this._set("effectivePrintServiceUrl",l==null?void 0:l.url),this._asyncPrintTaskUrl=s==null?void 0:s.url,await this._updateLayoutInfoTaskUrl((d==null?void 0:d.url)||this.effectivePrintServiceUrl)}const i=(o=this.effectivePrintServiceUrl)==null?void 0:o.toLowerCase().split("/");if(!(i!=null&&i.includes("gpserver")))throw new G("print:invalid-print-service-url","Can't fetch print templates information from provided URL",{url:this.effectivePrintServiceUrl})}async _updateLayoutInfoTaskUrl(t,i){if(!t)return;const a=(await Gi(t,i)).find(o=>o.includes("Get Layout Templates Info"));a&&(this._layoutInfoTaskUrl=t.replace(xa,`$1${encodeURI(a)}`))}_getPortalDefaultTemplates(t,i){var a,o,l,s,d;return((d=(s=(l=(o=(a=this.portal)==null?void 0:a.helperServices)==null?void 0:o.printTask)==null?void 0:l.templates)==null?void 0:s.filter(u=>u.layout.toLowerCase()!=="map_only"&&(!i||i.includes(Y(u.layout)))))==null?void 0:d.map(u=>{const r=ee.fromJSON(u);if(r.type="default-template",r.layoutInfoTaskUrl=this._layoutInfoTaskUrl,r.layout){const m=t.get(r.layout);m&&r.setLayoutTemplateInfo(m)}return r}))??[]}async _getPortalCustomTemplates(t){if(this.printServiceUrl||!this.portal)return[];const{layoutGroupQuery:i,user:a}=this.portal,o=mt.test(this.portal.url),l=a==null?void 0:a.userLicenseTypeId,s=l&&Ia.has(l);if(!i||o&&!s)return[];const d=new tt({query:i,disableExtraQuery:!0}),u=await this.portal.queryGroups(d,t);if(!u.total)return[];const r=u.results[0],m=new tt({num:100,query:"type:Layout",sortField:r.sortField,sortOrder:r.sortOrder??void 0}),v=(await r.queryItems(m,t)).results;return v.length?v.map(y=>(this.portalTemplateIds.push(y.id),new ee({type:"default-template",label:y.title,layoutItem:y,layoutInfoTaskUrl:this._layoutInfoTaskUrl}))):[]}async _loadAllTemplates(t,i,a){var s;let o=!1;const l=(s=i==null?void 0:i.layout)==null?void 0:s.choiceList;if(this.includeDefaultTemplates&&this.portal&&!this.printServiceUrl){const d=this._getPortalDefaultTemplates(t,l);o=!!d.length,this.defaultTemplates.addMany(d);const u=await this._getPortalCustomTemplates(a);this.defaultTemplates.addMany(u);for(const r of this.defaultTemplates)this._templateIdToCustomTemplate.set(r.id,r)}o||t.forEach((d,u)=>{if(!l||l.includes(u)){const r=new ee({type:"print-service-template",layout:u,layoutInfoTaskUrl:this._layoutInfoTaskUrl});r.setLayoutTemplateInfo(d),this.printServiceTemplates.add(r),this._templateIdToCustomTemplate.set(r.id,r)}})}_processPrintServiceTemplatesInfo(t){var a;this._set("templatesInfo",t);const i=(a=t==null?void 0:t.layout)==null?void 0:a.defaultValue;if(i&&i!=="map-only"){const o=this.defaultTemplates.find(l=>l.layout===i)??this.printServiceTemplates.find(l=>l.layout===i)??this.defaultTemplates.at(0)??this.printServiceTemplates.at(0);this._set("defaultTemplate",o)}}async _getLayoutToLayoutTemplateInfos(t){const i=await xt(this._layoutInfoTaskUrl,void 0,t),a=new Map,o={};for(const l of i){const s=Y(l.layoutTemplate);a.set(s,l),o[s]=l.layoutOptions.customTextElements}return this._serviceTemplateCustomTextElements=Object.freeze(o),a}async _getPrintServiceTemplatesInfo(t){let i;try{({data:i}=await xe(this.effectivePrintServiceUrl,{...t,query:{f:"json"},timeout:this.printTimeout}))}catch(s){throw ct(s)?s:new G("print:unavailable-service-info","Can't fetch templates info from service",{error:s})}const{parameters:a}=i,o=a.find(({name:s})=>s==="Format"),l=a.find(({name:s})=>s==="Layout_Template");return{format:this._getFormat(o),layout:this._getLayout(l)}}_getFormat(t){const i=this.allowedFormats==="all"?t.choiceList:t.choiceList.filter(s=>typeof this.allowedFormats!="string"&&this.allowedFormats.some(d=>new RegExp(`\\b${d}\\b`,"i").test(s))),a=(i.length?i:t.choiceList).map(s=>le.fromJSON(s)).filter(Ze),o=le.fromJSON(t.defaultValue),l=a.some(s=>new RegExp(`\\b${o}\\b`,"i").test(s))?o:a[0];return{choiceList:a,defaultValue:l}}_getLayout(t){const i=t.choiceList.filter(d=>d.toLowerCase()!=="map_only"),a=this.allowedLayouts==="all"?i:i.filter(d=>this.allowedLayouts.includes(Y(d))),o=(a.length?a:i).map(Y).filter(Ze),l=Y(t.defaultValue),s=o.includes(l)?l:o.find(d=>/(?=.*letter)(?=.*landscape)/i.test(d))??o.find(d=>/(?=.*a4)(?=.*landscape)/i.test(d))??o[0];return{choiceList:o,defaultValue:s}}_getOverlayItem(){return this._overlayItem||(this._overlayItem=new wa({strokeDash:[5],strokeWidth:2,strokeColor:[30,144,255,255]})),this._overlayItem}_enablePrintPreview(){var a,o,l;if(!((a=this.view)!=null&&a.overlay))return;const t=this.templateOptions,i=this._getOverlayItem();this.addHandles([j(()=>{var s,d,u,r;return[t.width,t.height,t.scaleEnabled,t.scale,t.layout,t.layoutItem,t.id,t.state,(s=this.view)==null?void 0:s.scale,(d=this.view)==null?void 0:d.size,(u=this.view)==null?void 0:u.state.paddedViewState.size,(r=this.view)==null?void 0:r.state.padding,this.loaded]},()=>this._updateOverLayItem(),dt),(o=this.view)==null?void 0:o.on("drag",["Shift"],s=>this._handleDrag(s),ot.WIDGET),(l=this.view)==null?void 0:l.on("key-down",["Escape"],()=>this._resetDrag(),ot.WIDGET)],"overlay-handler"),this.view.overlay.addItem(i)}_updateOverLayItem(){var b;if(!this.view)return;const t=this.templateOptions,i=this._getOverlayItem(),a=((b=t.layoutItem)==null?void 0:b.id)??t.layout,o=this.view,l=o.spatialReference,[s,d]=o.state.paddedViewState.size,u=o.state.padding;let r=0,m=0;if(a==="map-only")t.width!=null&&t.height!=null&&(r=t.width,m=t.height);else if(a){const D=t.id?this._templateIdToCustomTemplate.get(t.id):null,{webMapFrameSize:f,pageUnits:S}=(D==null?void 0:D.layoutTemplateInfo)??{};let M=!1;if(f&&S)if(this._isFreeHand){const O=f[0]/f[1];r=this._freeHandWidth,m=this._freehandHeight,r>m?m=r/O:r=m*O}else{const O=Sa.fromJSON(S.toLowerCase()),I=l.unit;Ye(O)===Ye(I)?(r=et(f[0],O,I),m=et(f[1],O,I)):(M=!0,r=f[0],m=f[1])}if(!this._isFreeHand)if(t.scaleEnabled&&t.scale){const O=M?Math.min(s/r,d/m):Xt(l)*Yt*t.dpi;r*=O,m*=O}else if(r===0||m===0)r=s,m=d;else{const O=(s-.1*s)/r,I=(d-.1*d)/m,k=Math.min(O,I);r*=k,m*=k}}const{scaleEnabled:v,scale:y}=t,L=v&&y?y/this.view.scale:1;if(i.boxWidth=r*L||s,i.boxHeight=m*L||d,u&&(i.padding=u),i.backgroundWidth=s??0,i.backgroundHeight=d??0,this.loadStatus==="loading")i.strokeColor=nt;else if(this.loadStatus==="loaded")switch(this.templateOptions.state){case"pending":i.strokeColor=nt;break;case"ready":i.strokeColor=_a;break;case"error":i.strokeColor=Ta}}_resetDrag(){this._isFreeHand=!1,this._updateOverLayItem()}_handleDrag(t){switch(t.action){case"start":this._start();break;case"update":this._update(t);break;case"end":this._end()}t.stopPropagation()}_start(){this._isFreeHand=!0}_update(t){const i=this._getOverlayItem(),{x:a,y:o}=t,{x:l,y:s}=t.origin;a>l?(i.x=l,i.boxWidth=a-l):(i.x=a,i.boxWidth=l-a),o>s?(i.y=s,i.boxHeight=o-s):(i.y=o,i.boxHeight=s-o)}_end(){const t=this._getOverlayItem();if(!this.view||t.x==null||t.y==null)return;const i=this.view,a=i.toMap(yt(t.x+.5*t.boxWidth,t.y+.5*t.boxHeight));t.x=null,t.y=null,i.goTo({center:a}),this._freeHandWidth=t.boxWidth,this._freehandHeight=t.boxHeight,this.templateOptions.layout==="map-only"&&(this.templateOptions.width=this._freeHandWidth,this.templateOptions.height=this._freehandHeight),this.templateOptions.scale=this.view.scale,this._updateOverLayItem()}};n([c()],E.prototype,"_serviceTemplateCustomTextElements",void 0),n([c()],E.prototype,"_templateIdToCustomTemplate",void 0),n([c()],E.prototype,"allowedFormats",void 0),n([c()],E.prototype,"allowedLayouts",void 0),n([c({type:ie})],E.prototype,"browseTemplates",void 0),n([c({type:ie})],E.prototype,"defaultTemplates",void 0),n([c()],E.prototype,"error",void 0),n([c()],E.prototype,"extraParameters",void 0),n([c()],E.prototype,"includeDefaultTemplates",void 0),n([c({readOnly:!0})],E.prototype,"effectivePrintServiceUrl",null),n([c()],E.prototype,"effectiveTemplateCustomTextElements",null),n([c({type:be})],E.prototype,"outSpatialReference",void 0),n([c({type:ht})],E.prototype,"portal",void 0),n([c()],E.prototype,"portalTemplateIds",void 0),n([c({type:ie})],E.prototype,"printServiceTemplates",void 0),n([c({readOnly:!0})],E.prototype,"defaultTemplate",void 0),n([c()],E.prototype,"showPrintAreaEnabled",void 0),n([c()],E.prototype,"printServiceUrl",void 0),n([c()],E.prototype,"printTimeout",void 0),n([c({readOnly:!0})],E.prototype,"state",null),n([c({readOnly:!0})],E.prototype,"templatesInfo",void 0),n([c()],E.prototype,"updateDelay",void 0),n([c()],E.prototype,"view",void 0),n([c()],E.prototype,"templateCustomTextElements",void 0),n([c({type:St})],E.prototype,"templateOptions",void 0),E=n([q("esri.widgets.Print.PrintViewModel")],E);const Ot=E,kt=ut.ofType(bt),Et="map-only";var T;(function(e){e.layout="layoutTab",e.mapOnly="mapOnlyTab",e.export="exportTab"})(T||(T={}));const g="esri-print",h={base:g,headerTitle:`${g}__header-title`,layoutTabList:`${g}__layout-tab-list`,layoutTab:`${g}__layout-tab`,layoutSection:`${g}__layout-section`,mapOnlySection:`${g}__map-only-section`,panelItemsCentered:`${g}__panel-items--centered`,loader:`${g}__loader`,swapButton:`${g}__swap-button`,printButton:`${g}__export-button`,printButtonSection:`${g}__export-button-section`,printButtonSectionDivider:`${g}__export-button-section--divider`,templateSelectContainer:`${g}__template-select-container`,templateSelectIcon:`${g}__template-select-icon`,templateSelectError:`${g}__template-select-error`,templateSelectArrow:`${g}__template-select-arrow`,formSectionContainer:`${g}__form-section-container`,advancedOptionsSection:`${g}__advanced-options-section`,advancedOptionsContainer:`${g}__advanced-options-container`,browseTemplateButtonContainer:`${g}__browse-template-button-container`,browseTemplateButtonContainerFilter:`${g}__browse-template-button-container-filter`,exportedFilesContainer:`${g}__export-panel-container`,exportedFilesTitle:`${g}__export-title`,exportedFile:`${g}__exported-file`,exportedFileLinkTitle:`${g}__exported-file-link-title`,exportedFileLinkDescription:`${g}__exported-file-link-description`,exportedFilesEmpty:`${g}__exported-files-empty`,printWidgetContainer:`${g}__container`,content:`${g}__content`,panelContainer:`${g}__panel-container`,scaleInfoContainer:`${g}__scale-info-container`,scaleInputContainer:`${g}__scale-input-container`,scaleInput:`${g}__scale-input`,sizeContainer:`${g}__size-container`,panelError:`${g}__panel--error`,exportedFileLoader:`${g}__exported-file--loader`,exportSection:`${g}__export-section`,exportSectionCentered:`${g}__export-section--centered`,templateButtonContainer:`${g}__template-button-container`,templateDoneButton:`${g}__template-done-button`,templateSelectFlowItemContainer:`${g}__template-select-flow-item-container`,templateSelectFlowItemContent:`${g}__template-select-flow-item-content`,templateSelectFlowItemListHeading:`${g}__template-select-flow-item-list-heading`,srLabel:`${g}__sr-label`,invalidWkidText:`${g}__invalid-wkid-text`};function ka(e,t,i,a){const o=i/t,l=a/t;return{width:Math.round(e*o),height:Math.round(e*l)}}function Ea(e){return!isNaN(e)&&e>0}function ce(e){return(e==null?void 0:e.toLowerCase())===Et}function La(e){var a;const{state:t,extension:i}=e;switch(t){case"pending":return"spinner";case"error":return"exclamation-mark-circle";default:return(a=i==null?void 0:i.toLowerCase())!=null&&a.includes("pdf")?"file-pdf":"file"}}const Ca=new ae({inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"}),pt=new Map([["a3-landscape","a3-landscape"],["a3-portrait","a3-portrait"],["a4-landscape","a4-landscape"],["a4-portrait","a4-portrait"],["letter-ansi-a-landscape","ansi-a-landscape"],["letter-ansi-a-portrait","ansi-a-portrait"],["tabloid-ansi-b-landscape","ansi-b-landscape"],["tabloid-ansi-b-portrait","ansi-b-portrait"]]);let x=class extends ii{constructor(e,t){super(e,t),this._activeTabFocusRequested=!1,this._awaitingServerResponse=!1,this._exportedFileNameMap={},this._selectedTab=T.layout,this._pendingExportScroll=!1,this._rootNode=null,this._selectedTemplate=null,this._formats=[],this._showTemplates=!1,this._isValidSpatialReference=!0,this.allowedFormatsForSaving=null,this.browseTemplateButtonOnClick=null,this.exportedLinks=new kt,this.headerVisible=!0,this.headingLevel=3,this.includeOrganizationTemplates=!0,this.messagesCommon=null,this.messagesUnits=null,this.saveExportEnabled=!1,this.saveExportHidden=!0,this.saveAsButtonCallback=null,this.viewModel=new Ot,this._onInput=i=>{this._selectedTab===T.layout?this.templateOptions.title=i.currentTarget.value:this._selectedTab===T.mapOnly&&(this.templateOptions.fileName=i.currentTarget.value)},this._handleLinkClick=i=>{const a=i.currentTarget["data-item"];if(!a||a.state!=="ready"||!a.url)return;const o=me(this.viewModel.effectivePrintServiceUrl),l=a.url,s=document.createElement("a");if(s.target="_blank",s.href=l,s.rel="noreferrer",s.download=a.formattedName??"",!o)return s.click(),void i.stopPropagation();i.preventDefault();const d=new URL(l);d.searchParams.set("token",o),s.href=d.href,s.click(),s.href=l},this._focusOnTabChange=this._focusOnTabChange.bind(this)}initialize(){this.addHandles([j(()=>{var a;return[this.templateOptions.format,(a=this.viewModel.templatesInfo)==null?void 0:a.format]},()=>{var l;const{templatesInfo:a}=this.viewModel;if(!a)return;if(this._formats.length!==a.format.choiceList.length){const s=le.apiValues;this._formats=a.format.choiceList.map(d=>{const u=s.find(r=>new RegExp(`\\b${r}\\b`,"i").test(d))??d;return{value:u,label:d===u?d.toUpperCase():d}}).sort((d,u)=>d.label.localeCompare(u.label))}const o=this._formats.some(({value:s})=>new RegExp(`\\b${s}\\b`,"i").test(this.templateOptions.format));if(!(!a.format.defaultValue||o)){const s=(l=this._formats.find(({value:d})=>new RegExp(`\\b${d}\\b`,"i").test(a.format.defaultValue)))==null?void 0:l.value;s&&(this.templateOptions.format=s)}}),j(()=>[this.templateOptions.id,this.viewModel.loaded],async()=>{const{layout:a}=this.templateOptions;this._selectedTab=ce(a)?T.mapOnly:T.layout,this._selectedTab===T.layout&&this.viewModel.loaded&&(this._selectedTemplate=this.viewModel.getLayoutTemplateById(this.templateOptions.id))}),j(()=>this.templateOptions.dpi,a=>{a<=0&&(this.templateOptions.dpi=1)}),j(()=>{var a;return(a=this.viewModel.view)==null?void 0:a.scale},a=>{!a||this.templateOptions.scaleEnabled&&this.templateOptions.scale||(this.templateOptions.scale=a)})]);for(const{name:a,extension:o}of this.exportedLinks)a&&o&&this._updateExportedFileNameMap(`${a}${o}`);const{height:e,width:t}=this.templateOptions;this.templateOptions.width=t||800,this.templateOptions.height=e||1100;const i=setTimeout(()=>{this._awaitingServerResponse=!0,this.scheduleRender()},500);this.viewModel.load().then(()=>{clearTimeout(i),this._awaitingServerResponse=!1})}loadDependencies(){return ai({action:()=>A(()=>import("./index-BPm91e5Z.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]),import.meta.url),block:()=>A(()=>import("./index-C6d66FVb.js"),__vite__mapDeps([25,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,26,21,20,18,17,16,27,28,29,22,30,23,31,32,0,19,24,33,34,35,36,37,38,39,40,41,42,43]),import.meta.url),button:()=>A(()=>import("./index-jjUP6Yam.js"),__vite__mapDeps([44,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,21,20,38,45,22,46,23,24]),import.meta.url),checkbox:()=>A(()=>import("./index-CtvJE4Qe.js"),__vite__mapDeps([47,2,3,4,5,6,7,8,9,10,11,12,13,21,20,17,14,45,22,30,46,23]),import.meta.url),combobox:()=>A(()=>import("./index-BYx-hdGk.js"),__vite__mapDeps([48,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,49,50,21,20,23,22,30,24,15,19,51,52,53,54,29,28,45,46,31,55,56]),import.meta.url),"combobox-item":()=>A(()=>import("./index-CP8r2QEY.js"),__vite__mapDeps([57,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,19,20,22,56,24,58]),import.meta.url),flow:()=>A(()=>import("./index-CMdCteX_.js"),__vite__mapDeps([59,2,3,4,5,6,7,8,9,10,11,12,13,21,20,18,23,17,14]),import.meta.url),"flow-item":()=>A(()=>import("./index-Z5_W1-0F.js"),__vite__mapDeps([60,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,37,28,29,31,38,39,40,41,30,42,43,26,61]),import.meta.url),icon:()=>A(()=>import("./index-DwIhxbHs.js").then(e=>e.i),__vite__mapDeps([16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18]),import.meta.url),input:()=>A(()=>import("./index-pyEU_klK.js"),__vite__mapDeps([62,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,49,63,51,20,19,21,38,45,22,30,46,23,64,24,55,15,65]),import.meta.url),"input-number":()=>A(()=>import("./index-BVlRRyQC.js"),__vite__mapDeps([66,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,49,63,51,20,19,21,45,22,30,46,23,64,24,55,65,15]),import.meta.url),label:()=>A(()=>import("./index--OBudxYA.js"),__vite__mapDeps([67,2,3,4,5,6,7,8,9,10,11,12,13,46,17,14]),import.meta.url),list:()=>A(()=>import("./index-BCDLx0rN.js"),__vite__mapDeps([68,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,26,21,20,18,17,19,16,49,63,62,51,38,45,22,30,46,23,64,24,55,65,53,54,29,69]),import.meta.url),"list-item":()=>A(()=>import("./index-B0pN5y8B.js"),__vite__mapDeps([70,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,27,21,20,28,29,22,30,23,31,32,1,15,0,19,24,33,34,35,36,69,71]),import.meta.url),loader:()=>A(()=>import("./index-CMxz6F2k.js"),__vite__mapDeps([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]),import.meta.url),switch:()=>A(()=>import("./index-BciJpaKz.js"),__vite__mapDeps([72,2,3,4,5,6,7,8,9,10,11,12,13,21,20,17,14,45,22,30,46,23]),import.meta.url),chip:()=>A(()=>import("./index-BtUFGore.js"),__vite__mapDeps([50,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,21,20,23,22,30,24,15]),import.meta.url),popover:()=>A(()=>import("./index-DMeQur4V.js").then(e=>e.i),__vite__mapDeps([37,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,28,29,31,38,39,40,41,30]),import.meta.url),link:()=>A(()=>import("./index-DdZGn6qX.js"),__vite__mapDeps([73,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,21,20,38,22,23]),import.meta.url)})}destroy(){this.viewModel.destroy()}get allowedFormats(){return this.viewModel.allowedFormats}set allowedFormats(e){this.viewModel.allowedFormats=e}get allowedLayouts(){return this.viewModel.allowedLayouts}set allowedLayouts(e){this.viewModel.allowedLayouts=e}get error(){return this.viewModel.error}get extraParameters(){return this.viewModel.extraParameters}set extraParameters(e){this.viewModel.extraParameters=e}get icon(){return"print"}set icon(e){this._overrideIfSome("icon",e)}get includeDefaultTemplates(){return this.viewModel.includeDefaultTemplates}set includeDefaultTemplates(e){this.viewModel.includeDefaultTemplates=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get outSpatialReference(){return this.viewModel.outSpatialReference}set outSpatialReference(e){this.viewModel.outSpatialReference=e}get portal(){return this.viewModel.portal}set portal(e){this.viewModel.portal=e}get showPrintAreaEnabled(){return this.viewModel.showPrintAreaEnabled}set showPrintAreaEnabled(e){this.viewModel.showPrintAreaEnabled=e}get printServiceUrl(){return this.viewModel.printServiceUrl}set printServiceUrl(e){this.viewModel.printServiceUrl=e}get templateCustomTextElements(){return this.viewModel.templateCustomTextElements}set templateCustomTextElements(e){this.viewModel.templateCustomTextElements=e}get templateOptions(){return this.viewModel.templateOptions}set templateOptions(e){this.viewModel.templateOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){var Ee,Le,Ce,$e,Pe,De,Ae,Fe,Me,Ve,Ne,Re,Ue,Be,He,We,ze,Je,Ge,je,qe,Ke;const{messages:e,templateOptions:t,viewModel:i,view:a}=this,{attributionEnabled:o,author:l,copyright:s,dpi:d,format:u,height:r,layout:m,layoutItem:v,legendEnabled:y,northArrowEnabled:L,scaleBarEnabled:b,scaleEnabled:D,scale:f,width:S}=t,M=i.state!=="ready"||this._awaitingServerResponse||!(m||v),O=this._renderTitleOrFileNameSection(),I=p("div",{class:h.formSectionContainer},p("calcite-label",null,e.fileFormatTitle,p("calcite-combobox",{clearDisabled:!0,label:e.formatDefaultOption,maxItems:6,placeholder:e.formatDefaultOption,selectionMode:"single-persist",onCalciteComboboxChange:({currentTarget:R})=>{var J;this.templateOptions.format=((J=R.selectedItems[0])==null?void 0:J.value)??"pdf"}},this._formats.map(({value:R,label:J},Nt)=>p("calcite-combobox-item",{key:`file-format-${Nt}`,selected:R===this.templateOptions.format,textLabel:J,value:R}))))),k=p("calcite-label",{layout:"inline"},p("calcite-switch",{checked:this.showPrintAreaEnabled,onCalciteSwitchChange:R=>{this.showPrintAreaEnabled=!!R.currentTarget.checked}}),e.printPreview),N=p("div",null,p("div",{class:h.formSectionContainer},p("calcite-label",null,e.template,p("calcite-block",{class:h.templateSelectContainer,collapsible:!1,description:this._getPageSizeLabel(this._selectedTemplate),heading:this._getTemplateLabel(this._selectedTemplate,!0),key:"template-select-block",loading:((Ee=this._selectedTemplate)==null?void 0:Ee.state)==="loading",onclick:()=>this._showTemplates=!0,onkeydown:R=>{R.key!=="Enter"&&R.key!==" "||(this._showTemplates=!0)},tabIndex:0},p("calcite-icon",{class:h.templateSelectIcon,icon:((Le=this._selectedTemplate)!=null&&Le.layout?pt.get(this._selectedTemplate.layout):null)||"custom-print",key:"template-select-icon",scale:"l",slot:"content-start"}),((Ce=this._selectedTemplate)==null?void 0:Ce.state)==="error"?p("calcite-icon",{class:h.templateSelectError,icon:"exclamation-mark-circle",key:"template-select-error",scale:"s",slot:"actions-end"}):null,p("calcite-icon",{class:h.templateSelectArrow,icon:oi()?"chevron-left":"chevron-right",key:"template-select-arrow",scale:"s",slot:"actions-end"})))),k),_=p("div",{class:h.formSectionContainer},p("calcite-label",null,e.dpi,p("calcite-input-number",{bind:this,"data-input-name":"dpi",min:1,value:`${d}`,onCalciteInputNumberInput:this._handleDPIChange}))),w=p("div",{class:h.formSectionContainer},p("calcite-label",null,p("div",{class:h.srLabel},e.outSpatialReference,p("calcite-link",{href:"https://developers.arcgis.com/rest/services-reference/enterprise/using-spatial-references/",target:"_blank"},"(WKID)")),p("calcite-input-number",{bind:this,"data-input-name":"outSpatialReference",integer:!0,numberButtonType:"none",value:((Pe=($e=i.outSpatialReference)==null?void 0:$e.wkid)==null?void 0:Pe.toString())??"",onCalciteInputNumberInput:({currentTarget:R})=>{const J=Jt(R.value);i.outSpatialReference=Number.isNaN(J)||J==null?null:new be({wkid:J}),this._isValidSpatialReference=!i.outSpatialReference||ei(i.outSpatialReference)}}),this._isValidSpatialReference?null:p("div",{class:h.invalidWkidText,key:`out-sr-${(De=i.outSpatialReference)==null?void 0:De.wkid}`},e.invalidWkid))),$=p("div",{class:this.classes(h.scaleInfoContainer,h.formSectionContainer)},p("calcite-label",{layout:"inline"},p("calcite-checkbox",{bind:this,checked:D,"data-option-name":"scaleEnabled",onCalciteCheckboxChange:this._toggleInputValue}),e.scale),p("div",{class:h.scaleInputContainer},p("calcite-input-number",{"aria-label":e.scaleLabel,"aria-valuenow":`${f}`,bind:this,class:h.scaleInput,"data-input-name":"scale",disabled:!D,value:`${f}`,onCalciteInputNumberInput:this._updateNumberInputValue}),p("calcite-button",{appearance:"outline","aria-label":e.reset,bind:this,disabled:!D,iconStart:"refresh",kind:"neutral",onclick:this._resetToCurrentScale}))),V=p("div",{"aria-labelledby":`${this.id}__advancedOptionsForLayout`,class:h.advancedOptionsContainer,key:"advanced-section-for-layout"},$,((Me=(Fe=(Ae=this._selectedTemplate)==null?void 0:Ae.layoutTemplateInfo)==null?void 0:Fe.layoutOptions)==null?void 0:Me.hasAuthorText)??1?p("div",{class:h.formSectionContainer,key:"author-info"},p("calcite-label",null,e.author,p("calcite-input",{bind:this,"data-input-name":"author",value:l??"",onCalciteInputInput:this._updateInputValue}))):null,((Re=(Ne=(Ve=this._selectedTemplate)==null?void 0:Ve.layoutTemplateInfo)==null?void 0:Ne.layoutOptions)==null?void 0:Re.hasCopyrightText)??1?p("div",{class:h.formSectionContainer,key:"copyright-text"},p("calcite-label",null,e.copyright,p("calcite-input",{bind:this,"data-input-name":"copyright",value:s??"",onCalciteInputInput:this._updateInputValue}))):null,_,w,this._renderCustomTextElementSection(),((He=(Be=(Ue=this._selectedTemplate)==null?void 0:Ue.layoutTemplateInfo)==null?void 0:Be.layoutOptions)==null?void 0:He.hasLegend)??1?p("div",{class:h.formSectionContainer,key:"legend-info"},p("calcite-label",{layout:"inline"},p("calcite-checkbox",{bind:this,checked:!!y,"data-option-name":"legendEnabled",onCalciteCheckboxChange:this._toggleInputValue}),e.legend)):null,(ze=(We=this._selectedTemplate)==null?void 0:We.mapSurroundInfoOptions)!=null&&ze.northArrow.length?p("div",{class:h.formSectionContainer,key:"north-arrow"},p("calcite-label",{layout:"inline"},p("calcite-checkbox",{bind:this,checked:!!L,"data-option-name":"northArrowEnabled",onCalciteCheckboxChange:this._toggleInputValue}),e.northArrow)):null,(Ge=(Je=this._selectedTemplate)==null?void 0:Je.mapSurroundInfoOptions)!=null&&Ge.scaleBar.length?p("div",{class:h.formSectionContainer,key:"scale-bar"},p("calcite-label",{layout:"inline"},p("calcite-checkbox",{bind:this,checked:!!b,"data-option-name":"scaleBarEnabled",onCalciteCheckboxChange:this._toggleInputValue}),e.scaleBar)):null),Q=p("div",{"aria-labelledby":`${this.id}__advancedOptionsForMapOnly`,class:h.advancedOptionsContainer},$,_,w,p("div",{class:h.formSectionContainer},p("calcite-label",{layout:"inline"},p("calcite-checkbox",{bind:this,checked:o,"data-option-name":"attributionEnabled",onCalciteCheckboxChange:this._toggleInputValue}),e.attribution)),this._renderCustomTextElementSection()),Z=this.exportedLinks.toArray(),Lt=this._renderExportedLinkItems(Z),Ct={[h.exportSectionCentered]:!Z.length},$t=this._selectedTab===T.layout?p("section",{"aria-labelledby":`${this.id}__layoutTab`,class:h.layoutSection,id:`${this.id}__layoutContent`,key:"esri-print__layoutContent",role:"tabpanel"},p("div",{class:h.panelContainer},((Ke=(qe=(je=this._selectedTemplate)==null?void 0:je.layoutTemplateInfo)==null?void 0:qe.layoutOptions)==null?void 0:Ke.hasTitleText)??1?O:null,N,this._selectedTab===T.layout?I:null,p("calcite-block",{"aria-label":e.advancedOptions,class:this.classes(h.panelContainer,h.advancedOptionsSection),collapsible:!0,disabled:!(m||v!=null&&v.id),heading:e.advancedOptions,id:"advancedOptionsForLayout",key:"advanced-options-for-layout"},V))):this._selectedTab===T.mapOnly?p("section",{"aria-labelledby":`${this.id}__mapOnlyTab`,class:h.mapOnlySection,id:`${this.id}__mapOnlyContent`,key:"esri-print__mapOnlyContent",role:"tabpanel"},p("div",{class:h.panelContainer},O,I,p("div",null,p("div",{class:this.classes(h.sizeContainer,h.formSectionContainer)},p("calcite-label",null,e.width,p("calcite-input-number",{bind:this,"data-input-name":"width",value:`${S}`,onCalciteInputNumberInput:this._updateNumberInputValue})),p("calcite-label",null,e.height,p("calcite-input-number",{bind:this,"data-input-name":"height",value:`${r}`,onCalciteInputNumberInput:this._updateNumberInputValue})),p("button",{"aria-label":e.swap,bind:this,class:this.classes(ve.widgetButton,h.swapButton,Ci.swap),onclick:this._switchInput,type:"button"})),k),p("calcite-block",{"aria-label":e.advancedOptions,class:this.classes(h.panelContainer,h.advancedOptionsSection),collapsible:!0,heading:e.advancedOptions,id:"advancedOptionsForMapOnly",key:"advanced-options-for-map-only"},Q))):p("section",{"aria-labelledby":`${this.id}__exportTab`,class:this.classes(h.exportSection,Ct),id:`${this.id}__exportContent`,key:"esri-print__exportContent",role:"tabpanel"},p("div",{class:h.panelContainer},p("div",{afterUpdate:this._scrollExportIntoView,bind:this,class:h.exportedFilesContainer},Z.length===0?p("div",{class:h.exportedFilesEmpty},p("calcite-icon",{icon:"file",scale:"l"}),p("div",null,p(Li,{class:h.exportedFilesTitle,level:this.headingLevel},e.noExportedFiles),p("div",null,e.exportHint))):Lt))),Oe=(a==null?void 0:a.type)!=="2d",Pt=p("div",{class:h.panelError},a?Oe?e.sceneViewError:e.serviceError:e.noViewError),Dt=Z.some(({state:R})=>R==="pending"),At=p("div",{class:h.content,key:"panel"},p("div",null,p("ul",{bind:this,class:h.layoutTabList,onclick:this._toggleLayoutPanel,onkeydown:this._handleLayoutPanelKeyDown,role:"tablist"},p("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._selectedTab===T.layout}`,class:h.layoutTab,"data-tab-id":T.layout,id:`${this.id}__layoutTab`,role:"tab",tabIndex:0},e.layoutTab),p("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._selectedTab===T.mapOnly}`,class:h.layoutTab,"data-tab-id":T.mapOnly,id:`${this.id}__mapOnlyTab`,role:"tab",tabIndex:0},e.mapOnlyTab),p("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._selectedTab===T.export}`,class:h.layoutTab,"data-tab-id":T.export,id:`${this.id}__exportedFilesTab`,role:"tab",tabIndex:0},Dt?p("calcite-loader",{inline:!0,label:"loading",scale:"s"}):null,e.exportsTab)),$t),this._selectedTab!==T.export?p("div",{class:this.classes(h.printButtonSection,!this.saveExportHidden&&this.portal?h.printButtonSectionDivider:null),key:"export-button-section"},!this.saveExportHidden&&this.portal?p("calcite-label",{layout:"inline"},p("calcite-checkbox",{bind:this,checked:this.saveExportEnabled,onCalciteCheckboxChange:R=>{this.saveExportEnabled=!!R.currentTarget.checked}}),e.saveExportToMyContent):null,p("calcite-button",{"aria-label":e.exportDescription,bind:this,class:this.classes(h.printButton),disabled:M||!(m||v!=null&&v.id)&&!u,onclick:this._handlePrintMap,scale:"l",width:"full"},e.export)):null),Ft=p("calcite-flow",{key:"root-flow"},p("calcite-flow-item",{bind:this,key:"root-flow-item",selected:!this._showTemplates},p("div",{class:h.printWidgetContainer},this.headerVisible?p("header",{class:h.headerTitle},e.export):null,this.error||Oe||!a?Pt:At)),this._renderChooseTemplateFlowItem()),ke=i.state==="initializing",Mt=ke?this._renderLoader():Ft,Vt={[h.panelItemsCentered]:ke};return p("div",{bind:this,class:this.classes(h.base,ve.widget,ve.panel,Vt)},Mt)}_getPageSizeLabel(e){if(!e)return;const t=e.layoutTemplateInfo;if(!t)return;const i=Ca.fromJSON(t.pageUnits.toLowerCase());return`${Xe(t.pageSize[0])} × ${Xe(t.pageSize[1])} ${Zt(this.messagesUnits,i,"abbr")}`}_getTemplateLabel(e,t=!1){if(!e)return t?this.messages.selectTemplate:this.messages.untitled;const{label:i,layout:a,layoutItem:o,type:l}=e;if(l==="print-service-template"&&this.messages[a])return this.messages[a];const s=i??a??(o==null?void 0:o.id);return(s==null?void 0:s.replaceAll("_"," "))??this.messages.untitled}_getPortalTemplates(){const{portalTemplateIds:e}=this.viewModel;return this.includeDefaultTemplates&&this.includeOrganizationTemplates?this.viewModel.defaultTemplates.toArray().filter(({layout:t,layoutItem:i})=>!ce(t)&&!!(i!=null&&i.id)&&e.includes(i.id)):[]}_getDefaultTemplates(){const{portalTemplateIds:e}=this.viewModel;return this.includeDefaultTemplates?this.viewModel.defaultTemplates.toArray().filter(({layout:t,layoutItem:i})=>!(ce(t)||i!=null&&i.id&&e.includes(i.id))):[]}_getPrintServiceTemplates(){return this.includeDefaultTemplates&&this._getDefaultTemplates().length?[]:this.viewModel.printServiceTemplates.toArray().filter(({layout:e})=>!ce(e))}_renderLayoutTemplates(e,t=!1,i=!1){return t&&e.sort((a,o)=>(a.label??"")>(o.label??"")?1:-1),e.map(a=>p("calcite-list-item",{description:this._getPageSizeLabel(a),key:`template-${a.id}-${a.id===this.templateOptions.id}`,label:this._getTemplateLabel(a),selected:a.id===this.templateOptions.id,title:a.description??"",value:a},p("calcite-icon",{icon:(a.layout?pt.get(a.layout):null)||"custom-print",slot:"content-start"}),a.state==="loading"?p("calcite-loader",{inline:!0,key:`template-loader-${a.id}`,label:"loading",scale:"s",slot:"content-end"}):null,(a==null?void 0:a.state)==="error"?p("calcite-icon",{class:h.templateSelectError,icon:"exclamation-mark-circle",key:`template-error-${a.id}`,scale:"s",slot:"content-end"}):null,i?p("calcite-action",{icon:"trash",onclick:()=>this.viewModel.removePortalTemplate(a),slot:"actions-end",text:"delete"}):null))}_renderChooseTemplateFlowItem(){var u;if(!this._showTemplates)return null;const{messages:e}=this,t=mt.test((u=this.portal)==null?void 0:u.url),i=this.viewModel.browseTemplates.toArray(),a=this._getPortalTemplates(),o=this._getDefaultTemplates(),l=this._getPrintServiceTemplates(),s=i.length+a.length+o.length+l.length>15,d=this.browseTemplateButtonOnClick?p("calcite-button",{appearance:"outline",class:s?h.browseTemplateButtonContainerFilter:h.browseTemplateButtonContainer,iconStart:"folder",key:"browse-template-button",onclick:this.browseTemplateButtonOnClick,slot:s?"filter-actions-end":"default"},s?null:e.browseTemplates):null;return p("calcite-flow-item",{bind:this,closable:!1,heading:e.chooseTemplate,key:"template-flow-item",selected:this._showTemplates,onCalciteFlowItemBack:r=>{r.preventDefault(),this._showTemplates=!1}},p("div",{class:h.templateSelectFlowItemContainer},p("div",{class:h.templateSelectFlowItemContent},s?null:d,p("calcite-list",{filterEnabled:s,filterProps:["label"],key:"template-list",label:e.templateList,selectionMode:"single-persist",onCalciteListChange:({currentTarget:r})=>{var m;return this.viewModel.applyTemplate((m=r.selectedItems[0])==null?void 0:m.value)}},s?d:null,i.length?p("div",{key:"my-templates"},p("div",{class:h.templateSelectFlowItemListHeading},e.myTemplates,t?p("calcite-chip",{appearance:"outline",kind:"neutral",label:e.beta,scale:"s"},e.beta):null),this._renderLayoutTemplates(i,!0,!0)):null,a.length?p("div",{key:"org-templates"},p("div",{class:h.templateSelectFlowItemListHeading},e.organizationTemplates,t?p("calcite-chip",{appearance:"outline",kind:"neutral",label:e.beta,scale:"s"},e.beta):null),this._renderLayoutTemplates(a)):null,i.length||a.length?o.length?p("div",{key:"default-templates"},p("div",{class:h.templateSelectFlowItemListHeading},e.defaultTemplates),this._renderLayoutTemplates(o,!0)):null:this._renderLayoutTemplates(o,!0),i.length||a.length?l.length?p("div",{key:"service-templates"},p("div",{class:h.templateSelectFlowItemListHeading},e.defaultTemplates),this._renderLayoutTemplates(l)):null:this._renderLayoutTemplates(l))),p("div",{class:h.templateButtonContainer},p("calcite-button",{class:h.templateDoneButton,onclick:()=>this._showTemplates=!1},this.messagesCommon.done))))}_renderCustomTextElementSection(){const{customTextElements:e}=this.templateOptions;return e?p("div",{class:h.formSectionContainer,key:"custom-text-elements"},e.map((t,i)=>{const[a,o]=Object.entries(t)[0];return a==="date"?null:p("calcite-label",{key:`custom-text-elements-${a}-${i}`},a,p("calcite-input",{bind:this,"data-input-custom":!0,"data-input-name":a,value:o??"",onCalciteInputInput:this._updateInputValue}))})):null}_renderTitleOrFileNameSection(){const{title:e,fileName:t,titlePlaceHolder:i,fileNamePlaceHolder:a}=this.messages,o=this._selectedTab===T.layout?e:t,l=this._selectedTab===T.layout?i:a,s=this._selectedTab===T.layout?this.templateOptions.title:this.templateOptions.fileName;return p("div",{class:h.formSectionContainer,key:o},p("calcite-label",null,o,p("calcite-input",{placeholder:l,value:s??"",onCalciteInputInput:this._onInput})))}_focusOnTabChange(e){if(!this._activeTabFocusRequested)return;const t=e.getAttribute("data-tab-id");(t==="layoutTab"&&this._selectedTab===T.layout||t==="mapOnlyTab"&&this._selectedTab===T.mapOnly||t==="exportTab"&&this._selectedTab===T.export)&&(e.focus(),this._activeTabFocusRequested=!1)}_renderLoader(){const e={[h.loader]:this._awaitingServerResponse};return p("div",{class:this.classes(e),key:"loader"})}_updateExportedFileNameMap(e){this._exportedFileNameMap[e]!==void 0?this._exportedFileNameMap[e]++:this._exportedFileNameMap[e]=0}_createFileLink(e,t){const i=t||this.messages.untitled,a=e.format.toLowerCase(),o=a.includes("png")?"png":a,l=i+o;return this._updateExportedFileNameMap(l),new bt({name:i,extension:o,count:this._exportedFileNameMap[l]})}_resetToCurrentScale(){var e;this.templateOptions.scale=(e=this.viewModel.view)==null?void 0:e.scale}_updateCustomTextElementValue(e,t,i){e.find(a=>{const[o]=Object.entries(a)[0];return o===t})[t]=i}_updateInputValue(e){const t=e.currentTarget,i=t.getAttribute("data-input-name"),a=!!t["data-input-custom"],{templateOptions:o}=this;a?this._updateCustomTextElementValue(o.customTextElements,i,t.value):o[i]=t.value}_updateNumberInputValue(e){const t=e.currentTarget,i=t.getAttribute("data-input-name"),{templateOptions:a}=this,o=Number(t.value);if(Ea(o))a[i]=o;else{const l=a[i];t.value=`${l}`}}_handleDPIChange(e){const{templateOptions:t}=this,i=t.dpi;this._updateNumberInputValue(e);const a=t.dpi,{height:o,width:l}=ka(a,i,t.width,t.height);t.height=o,t.width=l}_handlePrintMap(){var l;this._pendingExportScroll=!0;const{templateOptions:e,saveExportEnabled:t}=this,i=this.viewModel.toPrintTemplate(e),a=this._selectedTab===T.layout?(l=i.layoutOptions)==null?void 0:l.titleText:e.fileName,o=this._createFileLink(i,a);this.exportedLinks.add(o),this.emit("submit",{link:o,saveExportEnabled:t}),this._selectedTab=T.export,this.viewModel.print(i).then(s=>{o.set({url:s&&s.url,state:"ready"})}).catch(s=>{o.set({error:s,state:"error"})}).then(()=>{this.emit("complete",{link:o,saveExportEnabled:t}),this.scheduleRender()})}_switchInput(){[this.templateOptions.width,this.templateOptions.height]=[this.templateOptions.height,this.templateOptions.width]}_scrollExportIntoView(){if(!this._pendingExportScroll)return;this._pendingExportScroll=!1;const e=this._rootNode;if(!e)return;const{clientHeight:t,scrollHeight:i}=e,a=i-t;a>0&&(e.scrollTop=a)}_toggleInputValue(e){const t=e.target,i=t.getAttribute("data-option-name");this.templateOptions[i]=t.checked,i==="scaleEnabled"&&this._resetToCurrentScale()}_renderExportedLinkItemPopover(e){const t=this.messages,i=e.formattedName??"",{state:a}=e,o=this.saveAsButtonCallback&&a!=="error"&&this._isFormatAllowedForSaving(e.extension);return a!=="pending"&&o?p("calcite-popover",{autoClose:!0,key:`${i}-popover`,label:"Popover",offsetDistance:1,overlayPositioning:"fixed",pointerDisabled:!0,referenceElement:`${i}-popover-button`,scale:"s"},p("calcite-list",{label:""},e.portalItem?p("calcite-list-item",{label:t.openItem,onCalciteListItemSelect:()=>{const l=e.portalItem;if(!l||!l.itemPageUrl)return;const s=document.createElement("a");s.target="_blank",s.href=l.itemPageUrl,s.rel="noreferrer",s.click()}},p("calcite-icon",{icon:"launch2",key:`${i}-launch-icon`,scale:"s",slot:"content-start"})):p("calcite-list-item",{label:t.saveAs,onCalciteListItemSelect:async()=>{this.saveAsButtonCallback&&(Gt(()=>e.portalItem).then(l=>{l.itemPageUrl&&this.scheduleRender()}),await this.saveAsButtonCallback(e))}},p("calcite-icon",{icon:"save",key:`${i}-save-icon`,scale:"s",slot:"content-start"})),p("calcite-list-item",{label:this.messagesCommon.delete,onCalciteListItemSelect:()=>this.exportedLinks.remove(e)},p("calcite-icon",{icon:"trash",key:`${i}-delete-icon`,scale:"s",slot:"content-start"})))):null}_renderExportedLinkItemContent(e,t){const i=this.messages,{url:a,state:o}=e,l=e.formattedName??"";let s=a||null;s&&(s=Kt(s));const d=Qt(s,location.href);return p("div",{class:h.exportedFile,"data-item":e,onclick:this._handleLinkClick,slot:"content"},p("div",null,p("div",{class:h.exportedFileLinkTitle},l),p("div",{class:h.exportedFileLinkDescription},o==="pending"?i.generatingExport:t||(d?i.ready:i.linkReady))),o==="ready"?p("calcite-icon",{"aria-label":`${l}. ${i.linkReady}`,icon:d?"download-to":"launch",key:`${l}-end-icon`,scale:"s",slot:"content-end"}):null)}_renderExportedLinkItemIcon(e){const t=e.formattedName??"";return e.state==="pending"?p("calcite-loader",{class:h.exportedFileLoader,inline:!0,key:`${t}-loader`,label:this.messages.generatingExport,scale:"m",slot:"content-start"}):p("calcite-icon",{icon:La(e),key:`${t}-start-icon`,scale:"s",slot:"content-start"})}_renderExportedLinkItemAction(e,t){const{state:i}=e,a=e.formattedName??"",o=this.saveAsButtonCallback&&i!=="error"&&this._isFormatAllowedForSaving(e.extension);return i!=="pending"?p("calcite-action",{"aria-label":`${t}`,icon:o?"ellipsis":"x",id:o?`${a}-popover-button`:void 0,key:o?`${a}-saveAs-action`:`${a}-action`,onclick:o?void 0:()=>{this.exportedLinks.remove(e)},slot:"actions-end",text:`${t}`}):null}_renderExportedLinkItem(e){const t=this.messages,{error:i,state:a}=e,o=e.formattedName??"";let l;switch(a){case"pending":l=t.pending;break;case"ready":l=t.ready;break;case"error":l=t.errorMessage}const s=a==="error"?(i==null?void 0:i.name)==="print-task:cim-symbol-unsupported"?t.exportWebMapCIMError:t.exportWebMapError:"";return p(li,null,p("calcite-list-item",{"aria-label":l,key:o,title:s},this._renderExportedLinkItemContent(e,s),this._renderExportedLinkItemIcon(e),this._renderExportedLinkItemAction(e,s)),this._renderExportedLinkItemPopover(e))}_renderExportedLinkItems(e){return p("calcite-list",{filterEnabled:(e==null?void 0:e.length)>10,label:this.messages.exportedLinksList},e.map(this._renderExportedLinkItem.bind(this)))}_isFormatAllowedForSaving(e){return!this.allowedFormatsForSaving||this.allowedFormatsForSaving==="all"||!(!e||!this.allowedFormatsForSaving.includes(e))}_toggleLayoutPanel(e){const t=e.target;this._toggleTab(t.getAttribute("data-tab-id"))}_toggleTab(e,t=!0){if(this._selectedTab=e,this._selectedTab===T.mapOnly)this.templateOptions.reset(),this.templateOptions.layout=Et;else if(this._selectedTab===T.layout){const i=this._selectedTemplate??this.viewModel.defaultTemplate;i?this.viewModel.applyTemplate(i):this.templateOptions.reset()}t&&(this._activeTabFocusRequested=!0)}_handleLayoutPanelKeyDown(e){const{key:t}=e,i=e.target.getAttribute("data-tab-id");if(si(t))return this._toggleTab(i),e.preventDefault(),void e.stopPropagation();if(t==="ArrowLeft"||t==="ArrowRight"){switch(i){case T.layout:this._toggleTab(t==="ArrowLeft"?T.export:T.mapOnly);break;case T.mapOnly:this._toggleTab(t==="ArrowLeft"?T.layout:T.export);break;case T.export:this._toggleTab(t==="ArrowLeft"?T.mapOnly:T.layout)}e.preventDefault(),e.stopPropagation()}}};n([c()],x.prototype,"_showTemplates",void 0),n([c()],x.prototype,"_isValidSpatialReference",void 0),n([c()],x.prototype,"allowedFormats",null),n([c()],x.prototype,"allowedFormatsForSaving",void 0),n([c()],x.prototype,"allowedLayouts",null),n([c()],x.prototype,"browseTemplateButtonOnClick",void 0),n([c()],x.prototype,"error",null),n([c({type:kt})],x.prototype,"exportedLinks",void 0),n([c()],x.prototype,"extraParameters",null),n([c()],x.prototype,"headerVisible",void 0),n([c()],x.prototype,"headingLevel",void 0),n([c()],x.prototype,"icon",null),n([c()],x.prototype,"includeDefaultTemplates",null),n([c()],x.prototype,"includeOrganizationTemplates",void 0),n([c()],x.prototype,"label",null),n([c(),ge("esri/widgets/Print/t9n/Print")],x.prototype,"messages",void 0),n([c(),ge("esri/t9n/common")],x.prototype,"messagesCommon",void 0),n([c(),ge("esri/core/t9n/Units")],x.prototype,"messagesUnits",void 0),n([c({type:be})],x.prototype,"outSpatialReference",null),n([c()],x.prototype,"portal",null),n([c()],x.prototype,"saveExportEnabled",void 0),n([c()],x.prototype,"saveExportHidden",void 0),n([c()],x.prototype,"showPrintAreaEnabled",null),n([c()],x.prototype,"printServiceUrl",null),n([c()],x.prototype,"saveAsButtonCallback",void 0),n([c()],x.prototype,"templateCustomTextElements",null),n([c()],x.prototype,"templateOptions",null),n([c()],x.prototype,"view",null),n([c({type:Ot})],x.prototype,"viewModel",void 0),x=n([q("esri.widgets.Print")],x);const $a=x;/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
v4.32.12 */const Pa=Wt`@layer{arcgis-print{display:block}}`,Da=$i($a),oe=class oe extends Rt{constructor(){super(...arguments),this.widget=Da(this),this.viewModel=this.widget.viewModel,this.allowedFormats=this.widget.allowedFormats,this.allowedLayouts=this.widget.allowedLayouts,this.autoDestroyDisabled=!1,this.exportedLinks=this.widget.exportedLinks,this.extraParameters=this.widget.extraParameters,this.headingLevel=this.widget.headingLevel,this.icon=this.widget.icon,this.includeDefaultTemplatesDisabled=this.widget.includeDefaultTemplates,this.label=this.widget.label,this.portal=this.widget.portal,this.position="bottom-left",this.printServiceUrl=this.widget.printServiceUrl,this.showPrintAreaEnabled=this.widget.showPrintAreaEnabled,this.state=this.viewModel.state,this.templateCustomTextElements=this.widget.templateCustomTextElements,this.templateOptions=this.widget.templateOptions,this.arcgisComplete=Qe(()=>this.widget,"complete"),this.arcgisPropertyChange=Ut()("state"),this.arcgisReady=Bt(),this.arcgisSubmit=Qe(()=>this.widget,"submit")}async destroy(){await this.manager.destroy()}};oe.properties={allowedFormats:[1,{converter:t=>typeof t=="string"&&t!=="all"?t.split(","):t}],allowedLayouts:[1,{converter:t=>typeof t=="string"&&t!=="all"?t.split(","):t}],autoDestroyDisabled:5,exportedLinks:0,extraParameters:1,headingLevel:9,icon:1,includeDefaultTemplatesDisabled:5,label:1,portal:0,position:1,printServiceUrl:1,referenceElement:1,showPrintAreaEnabled:7,state:3,templateCustomTextElements:0,templateOptions:0},oe.shadowRootOptions=Ht,oe.styles=Pa;let Ie=oe;zt("arcgis-print",Ie);export{Ie as ArcgisPrint};
