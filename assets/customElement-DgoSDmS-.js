const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-DVEy4f7w.js","./index-CjrYEQXz.js","./jsxFactory-CLjKarlq.js","./Accessor-BHnuXKD2.js","./intl-Do3GEEJ7.js","./Promise-CmQqe-ke.js","./cast-BA_-jlhc.js","./index-tefRSezt.js","./index-Cx51aysm.css","./JSONSupport-CGdeqxpk.js","./Evented-DCWccWGU.js","./reactiveUtils-BR0C1Kq4.js","./SimpleObservable-7oieNGD8.js","./uuid-Cl5lrJ4c.js","./guid-ejniuQmw.js","./useT9n-CJAswmP1.js","./index-73bQemcW.js","./dom--xxYYVQF.js","./observers-BdozwIHb.js","./keyed-CdPY5MOf.js","./directive-helpers-C0aXnQdc.js","./ref-Ccn4I0kT.js","./interactive-B8siLByk.js","./loadable-DOQnSSjG.js","./component-CFGnHAqh.js","./index-ujykA9Eq.js","./index-cLdK6V3t.js","./index-Df8-0rWt.js","./floating-ui-BkLjHVN3.js","./debounce-DbkufipY.js","./key-CZcQa38B.js","./openCloseComponent-dw_x67D_.js","./dynamicClasses-pKEMtFzB.js","./index-DIB7yhJF.js","./resources6-Cs2_VmEC.js","./index-BfAp5_ga.js","./customElement-kBYuBfHB.js","./index-DIp-v4qk.js","./static-g4FJ4v8I.js","./FloatingArrow-D9X-HbKW.js","./useFocusTrap-ENcZoC4L.js","./focusTrapComponent-Br_3Mz8_.js","./index-CCqZjfSZ.js","./array-BbE1dLa5.js","./index-BtF7Kdcs.js","./form-B15gmg4q.js","./label-BLne9qNB.js","./index-B7QXL93z.js","./index-Bb6Bx1n-.js","./index-Ch_sYKt7.js","./index-BnH8ZLT5.js","./live-BIBBLA6F.js","./core-zHisM37C.js","./filter-Cs9GmjDF.js","./escapeRegExp-UP7ghjt8.js","./Validation-O1TFEQW-.js","./utils3-CmcdYP7V.js","./index-GVt5zfuo.js","./text-CbTMlb2o.js","./index-1VSl9HgO.js","./index-D1jScw4i.js","./index-DSiQ4rVy.js","./index-Wn4pOF_U.js","./index-svtat3zr.js","./locale-CXx8I9ox.js","./input-DI9tZAPS.js","./index-BGRynF8w.js","./index-D130RxMY.js","./index-DbjTV4Hc.js","./utils-CYuC4O71.js","./index-d5Yy4krW.js","./resources5-SciNIBSe.js","./index-Bej-0mbI.js","./index-DTztMyKP.js"])))=>i.map(i=>d[i]);
import{_ as F,i as Ut,L as Bt,u as Ht,c as Wt,n as zt,a as Jt}from"./index-tefRSezt.js";import{r as Ze}from"./index-BkKcLxWB.js";import{r as n,m as c,a as q,g as re,s as G,E as dt,c as Te,G as Xe,n as Gt}from"./Accessor-BHnuXKD2.js";import{l as Ye}from"./intl-Do3GEEJ7.js";import{d as j,P as ut,V as mt,w as jt}from"./reactiveUtils-BR0C1Kq4.js";import{i as qt,o as oe,P as Oe,s as ie,K as ne,e as Kt,ai as ht,G as Qt,F as Zt}from"./cast-BA_-jlhc.js";import{b as Xt}from"./unitFormatUtils-Dbksq3U5.js";import{g as ge,D as et,x as tt,Q as Yt,l as ei,N as ti}from"./Point-XGrwlf63.js";import{i as ii,u as he}from"./utils-Cy8wFNQo.js";import{n as p,e as ve,O as ai,c as oi,g as li,i as si,k as ri}from"./jsxFactory-CLjKarlq.js";import{C as yt,m as ni,c as it}from"./Portal-CTRRujjZ.js";import{s as pi}from"./ReactiveMap-Dwhwbx9R.js";import{c as ft,u as ce,e as at}from"./screenUtils-_ZIvrt5o.js";import{w as ci}from"./Extent-CBBGeHb-.js";import{E as di,j as ui,s as mi}from"./Promise-CmQqe-ke.js";import{j as hi}from"./Polyline-BmuD2-ZN.js";import{a0 as yi}from"./opacityUtils-CSd4XoR2.js";import{o as fi}from"./floorFilterUtils-DZ5C6FQv.js";import{N as bi}from"./visualVariableUtils-Bp9QCb8E.js";import{l as gi,S as vi,O as wi,s as bt}from"./submitJob-Cqg9t7s8.js";import{a as _i}from"./GPMessage-ttuUMj6y.js";import{h as Ti}from"./Color-gncXBiLc.js";import{y as Ii,d as ot,S as xi}from"./TextSymbol-BQ_NW9Xo.js";import{r as Oi}from"./layerViewUtils-tkZ5z_iY.js";import ye from"./PortalItem-CXk7DqVv.js";import{_ as Si}from"./viewpointUtils-DmJh_Ev7.js";import{_ as lt}from"./InputManager-Bs9UE-jw.js";import{S as ki}from"./JSONSupport-CGdeqxpk.js";import{x as Li}from"./MD5-C9MwAd2G.js";import{r as Ei}from"./enumeration-Cr5WIZs4.js";import{e as we}from"./globalCss-CZa70j6i.js";import{e as $i}from"./Heading-DYbI16WN.js";import{i as Ci}from"./legacyIcon-CEIp6Pa9.js";import{P as Pi}from"./useWidget-Dlf3SkC7.js";import"./Evented-DCWccWGU.js";import"./SimpleObservable-7oieNGD8.js";import"./ByteSizeUnit-BsxeN7wM.js";import"./Cyclical-CPiNl4ru.js";import"./mathUtils-DV9iOXpW.js";import"./quantityUtils-1LswOhxZ.js";import"./writer-B2bQV2uU.js";import"./uuid-Cl5lrJ4c.js";import"./Graphic-CFXUQZlS.js";import"./Clonable-DvJsj5LF.js";import"./ActionToggle-__-l4AdQ.js";import"./Identifiable-BrT7zvUW.js";import"./jsonUtils-Cu7OBRmN.js";import"./typeUtils-BSg8Y507.js";import"./collectionUtils-CbaToa73.js";import"./vec3f64-BLpZdpfb.js";import"./aaBoundingBox-CeBivBRq.js";import"./lengthUtils-DjJgJFRg.js";import"./normalizeUtils-XRAPXbWa.js";import"./normalizeUtilsCommon-D0zPTJCj.js";import"./utils-CkSELPnj.js";import"./Field-Cyk7Ur5d.js";import"./fieldType-L-VlbZqy.js";import"./networkEnums-n7t8Au-e.js";import"./FeatureSet-DpCN730g.js";import"./colorUtils-Rxh2V3ai.js";import"./Viewpoint-Cv8Otrne.js";import"./Camera-DJtV7zYb.js";import"./common-DQOJ18NT.js";import"./mat2d-D9DBP-jx.js";import"./mat2df64-CBKYtunK.js";import"./vec2-maR1OrZI.js";import"./vec2f64-Dy6m9Nrb.js";import"./projection-B2I9Bzj_.js";import"./projectBuffer-DOU0xvVi.js";import"./geodesicConstants-yASAK_zX.js";import"./Queue-BOnccek2.js";import"./signal-DSa0yokC.js";import"./component-utils-DWY0IMHC.js";const se=qt()({AIX:"aix",EPS:"eps",GIF:"gif",JPG:"jpg",PDF:"pdf",PNG32:"png32",PNG8:"png8",SVG:"svg",SVGZ:"svgz",TIFF:"tiff"},{ignoreUnknown:!1});let H=class extends re{constructor(t){super(t),this.state="pending",this.url=""}initialize(){this.addHandles(j(()=>[this.extension,this.name],()=>this._setFormattedFileName(),ut))}_setFormattedFileName(){this.name&&this.extension&&(this.formattedName=this.count?`${this.name}(${this.count}).${this.extension}`:`${this.name}.${this.extension}`)}};n([c()],H.prototype,"count",void 0),n([c()],H.prototype,"error",void 0),n([c()],H.prototype,"extension",void 0),n([c()],H.prototype,"formattedName",void 0),n([c()],H.prototype,"name",void 0),n([c()],H.prototype,"portalItem",void 0),n([c()],H.prototype,"state",void 0),n([c()],H.prototype,"url",void 0),H=n([q("esri.widgets.Print.FileLink")],H);const gt=H;async function vt(e,t,i,a){return i=gi.from(i||{}),vi(e,"execute",i,t??{},a).then(async({data:o})=>{var l,s;return{results:await Promise.all(((l=o.results)==null?void 0:l.map(wi))??[]),messages:((s=o.messages)==null?void 0:s.map(d=>_i.fromJSON(d)))??[]}})}const fe=new oe({MAP_ONLY:"map-only","A3 Landscape":"a3-landscape","A3 Portrait":"a3-portrait","A4 Landscape":"a4-landscape","A4 Portrait":"a4-portrait","Letter ANSI A Landscape":"letter-ansi-a-landscape","Letter ANSI A Portrait":"letter-ansi-a-portrait","Tabloid ANSI B Landscape":"tabloid-ansi-b-landscape","Tabloid ANSI B Portrait":"tabloid-ansi-b-portrait"}),ee=fe.fromJSON.bind(fe),Di=fe.toJSON.bind(fe);function Fi(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}}function Ai(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}}function st(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}}function Mi(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}}function Vi(e,t=15){const i=e.canvas.width,a=e.canvas.height,o=e.getImageData(0,0,i,a).data;let l,s,d,u,r,m;e:for(s=a;s--;)for(l=i;l--;)if(o[4*(i*s+l)+3]>t){m=s;break e}if(!m)return null;e:for(l=i;l--;)for(s=m+1;s--;)if(o[4*(i*s+l)+3]>t){r=l;break e}e:for(l=0;l<=r;++l)for(s=m+1;s--;)if(o[4*(i*s+l)+3]>t){d=l;break e}e:for(s=0;s<=m;++s)for(l=d;l<=r;++l)if(o[4*(i*s+l)+3]>t){u=s;break e}return{x:d,y:u,width:r-d,height:m-u}}function wt(e){var i;if(!e.attributionVisible)return;let t;return typeof e.originOf=="function"&&e.originOf("copyright")==="user"&&(t=e.copyright),t||!e.hasAttributionData?(t??(t=(i=e.portalItem)==null?void 0:i.accessInformation),t??(t=e.copyright),t??void 0):void 0}function Ni(e,t){var o,l;const i=((o=t.color)==null?void 0:o.clone())??new Ti([0,255,255]),a=((l=t.haloColor)==null?void 0:l.clone())??i.clone();switch(e){case"envelope":case"polygon":return i.a*=t.fillOpacity??.25,new xi({color:i,outline:new ot({color:a}),style:"solid"});case"polyline":return new ot({color:a});default:return a.a=1,new Ii({color:a,outline:null})}}function Ri(e,t){const i=e.allLayerViews.items;if(t===e.scale)return i.filter(o=>!o.suspended);const a=new Array;for(const o of i){const l=o.parent;l&&l!==o.view&&(Bi(l)||Hi(l))&&!a.includes(l)||o.visible&&o.visibleAtCurrentTimeExtent&&Oi(o.layer.effectiveScaleRange,t)&&a.push(o)}return a}function Ui(e){return(e==null?void 0:e.type)==="bing-maps"}function _t(e){return e&&"blendMode"in e&&"effect"in e}function Bi(e){return e.layer.type==="catalog"}function Hi(e){return e.layer.type==="group"}function Wi(e){const t=e.layer;if(_t(t)){const i=t.blendMode;if((!i||i==="normal")&&(t.effect||"featureEffect"in e&&e.featureEffect))return!0}return!1}let A=class extends re{constructor(t){super(t),this.attributionVisible=!0,this.exportOptions={width:800,height:1100,dpi:96},this.forceFeatureAttributes=!1,this.format="png32",this.includeCharts=!1,this.includeTables=!1,this.label=null,this.layout="map-only",this.layoutItem=null,this.layoutOptions=null,this.outScale=0,this.report=null,this.reportItem=null,this.reportOptions=null,this.scalePreserved=!0,this.showLabels=!0}};n([c()],A.prototype,"attributionVisible",void 0),n([c()],A.prototype,"exportOptions",void 0),n([c()],A.prototype,"forceFeatureAttributes",void 0),n([c()],A.prototype,"format",void 0),n([c()],A.prototype,"includeCharts",void 0),n([c()],A.prototype,"includeTables",void 0),n([c()],A.prototype,"label",void 0),n([c()],A.prototype,"layout",void 0),n([c({type:ye})],A.prototype,"layoutItem",void 0),n([c()],A.prototype,"layoutOptions",void 0),n([c()],A.prototype,"outScale",void 0),n([c()],A.prototype,"report",void 0),n([c({type:ye})],A.prototype,"reportItem",void 0),n([c()],A.prototype,"reportOptions",void 0),n([c()],A.prototype,"scalePreserved",void 0),n([c()],A.prototype,"showLabels",void 0),A=n([q("esri.rest.support.PrintTemplate")],A);const Tt=A,be=new oe({"Attribute List Letter ANSI A Landscape":"attribute-list-letter-ansi-a-landscape","Attribute List Letter ANSI A Portrait":"attribute-list-letter-ansi-a-portrait","Attribute List With Group Letter ANSI A Landscape":"attribute-list-with-group-letter-ansi-a-landscape","Attribute List With Group Letter ANSI A Portrait":"attribute-list-with-group-letter-ansi-a-portrait","Page per Feature Letter ANSI A Landscape":"page-per-feature-letter-ansi-a-landscape","Page per Feature Letter ANSI A Portrait":"page-per-feature-letter-ansi-a-portrait"});be.fromJSON.bind(be);const zi=be.toJSON.bind(be),rt={Feet:"ft",Kilometers:"km",Meters:"m",Miles:"mi"},nt=new oe({esriFeet:"Feet",esriKilometers:"Kilometers",esriMeters:"Meters",esriMiles:"Miles"}),Ji=new oe({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"}),Ie=new Map;async function Gi(e,t,i){var d;const a=await Se(e,i),o=await qi(t,a);if(await It(e,i)==="sync"){const{results:u}=await vt(e,o,void 0,i);return(d=u==null?void 0:u[0])==null?void 0:d.value}const l=await bt(e,o,void 0,i);await l.waitForJobCompletion({interval:t.updateDelay});const{value:s}=await l.fetchResultData("Output_File",null,i);return s}async function Se(e,t){const i=Qi(e),a=Ie.get(i)??{gpServerUrl:i,legendLayerNameMap:{},legendLayers:[]};return a.gpMetadata??(a.gpMetadata=(await Oe(i,ii({f:"json"},t))).data),a.cimVersion=a.gpMetadata.cimVersion,Ie.set(i,a),a}async function It(e,t){return va(await Se(e,t))}async function ji(e,t){return(await Se(e,t)).gpMetadata.tasks}async function qi(e,t){var v,y,E,g,D;t=t||{is11xService:!1,legendLayerNameMap:{},legendLayers:[]};const i=e.template||new Tt;i.showLabels==null&&(i.showLabels=!0);const a=i.exportOptions;let o;const l=Di(i.layout);if(a&&(o={dpi:a.dpi},(l==null?void 0:l.toLowerCase())==="map_only"||l==="")){const{width:b,height:O}=a;o.outputSize=b!=null&&O!=null?[b,O]:void 0}const s=i.layoutOptions;let d;if(s){let b,O;s.scalebarUnit==="Miles"||s.scalebarUnit==="Kilometers"?(b="Kilometers",O="Miles"):s.scalebarUnit!=="Meters"&&s.scalebarUnit!=="Feet"||(b="Meters",O="Feet"),d={titleText:s.titleText,authorText:s.authorText,copyrightText:s.copyrightText,customTextElements:s.customTextElements,elementOverrides:s.elementOverrides,scaleBarOptions:b||O?{metricUnit:nt.toJSON(b)??void 0,metricLabel:b?rt[b]:void 0,nonMetricUnit:nt.toJSON(O)??void 0,nonMetricLabel:O?rt[O]:void 0}:void 0}}let u=null;s!=null&&s.legendLayers&&(u=s.legendLayers.map(b=>{const O=b.layerId;t.legendLayerNameMap[O]=b.title;const M={id:O};return b.subLayerIds&&(M.subLayerIds=b.subLayerIds),M}));const r=await Ki(e,i,t);if(r.operationalLayers){const b=new RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),O=/[\u0600-\u06FF]/,M=S=>{var _;const I=S.text,k=S.font,N=(_=k==null?void 0:k.family)==null?void 0:_.toLowerCase();I&&k&&(N==="arial"||N==="arial unicode ms")&&(k.family=b.test(I)?"Arial Unicode MS":"Arial",k.style!=="normal"&&O.test(I)&&(k.family="Arial Unicode MS"))};for(const S of r.operationalLayers)if((v=S.featureCollection)!=null&&v.layers)for(const I of S.featureCollection.layers){if((g=(E=(y=I.layerDefinition)==null?void 0:y.drawingInfo)==null?void 0:E.renderer)!=null&&g.symbol){const k=I.layerDefinition.drawingInfo.renderer;k.symbol.type==="esriTS"&&M(k.symbol)}if((D=I.featureSet)!=null&&D.features)for(const k of I.featureSet.features)k.symbol&&k.symbol.type==="esriTS"&&M(k.symbol)}}e.outSpatialReference&&(r.mapOptions.spatialReference=e.outSpatialReference.toJSON()),Object.assign(r,{exportOptions:o,layoutOptions:d||{}}),Object.assign(r.layoutOptions,{legendOptions:{operationalLayers:u??t.legendLayers.slice()}}),t.legendLayers.length=0,Ie.set(t.gpServerUrl,t);const m={Web_Map_as_JSON:JSON.stringify(r),Format:se.toJSON(i.format),Layout_Template:l,Layout_Item_ID:void 0,Report_Template:zi(i.report),Report_Item_ID:void 0};if(i.layoutItem){delete m.Layout_Template;const b=i.layoutItem;await b.load(),b.access!=="public"&&ie&&await ie.getCredential(t.gpServerUrl),m.Layout_Item_ID=JSON.stringify({id:b.id})}if(i.reportItem){delete m.Report_Template;const b=i.reportItem;await b.load(),b.access!=="public"&&ie&&await ie.getCredential(t.gpServerUrl),m.Report_Item_ID=JSON.stringify({id:b.id})}return e.extraParameters&&Object.assign(m,e.extraParameters),m}async function Ki(e,t,i){const a=e.view;let o=a.spatialReference;const l={operationalLayers:await Zi(a,t,i)};t.includeTables&&(l.tables=await ua(a));let s=e.extent||i.ssExtent||a.extent;if(o!=null&&o.isWrappable&&(s=s.clone()._normalize(!0),o=s.spatialReference),l.mapOptions={extent:s&&s.toJSON(),spatialReference:o&&o.toJSON(),showAttribution:t.attributionVisible},i.ssExtent=null,a.background&&(l.background=a.background.toJSON()),a.rotation&&(l.mapOptions.rotation=-a.rotation),t.scalePreserved&&(l.mapOptions.scale=t.outScale||a.scale),a.timeExtent!=null){const d=a.timeExtent.start!=null?a.timeExtent.start.getTime():null,u=a.timeExtent.end!=null?a.timeExtent.end.getTime():null;l.mapOptions.time=[d,u]}return t.reportOptions&&(l.reportOptions=t.reportOptions),l}function Qi(e){let t=e;const i=t.lastIndexOf("/GPServer/");return i>0&&(t=t.slice(0,i+9)),t}async function Zi(e,t,i){var d;const a=[],o={layerView:null,printTemplate:t,view:e};let l=0;t.scalePreserved&&(l=t.outScale||e.scale);const s=Ri(e,l);for(const u of s){const r=u.layer;if(!r.loaded||"layers"in r)continue;let m;o.layerView=u,m=Wi(u)?await X(r,o,i):Ui(r)?Xi(r):(r==null?void 0:r.type)==="csv"?await ea(r,o,i):(r==null?void 0:r.type)==="catalog-footprint"?await Yi(r,o,i):(r==null?void 0:r.type)==="feature"?await ta(r,o,i):(r==null?void 0:r.type)==="geojson"?await ia(r,o,i):(r==null?void 0:r.type)==="graphics"?await aa(r,o,i):(r==null?void 0:r.type)==="imagery"?oa(r,i):(r==null?void 0:r.type)==="imagery-tile"?await la(r,o,i):(r==null?void 0:r.type)==="kml"?await sa(r,o,i):(r==null?void 0:r.type)==="map-image"?ra(r,o,i):(r==null?void 0:r.type)==="map-notes"?await na(o,i):(r==null?void 0:r.type)==="open-street-map"?pa():(r==null?void 0:r.type)==="stream"?await ca(r,o,i):(r==null?void 0:r.type)==="subtype-group"?await da(r,i):(r==null?void 0:r.type)==="tile"?ma(r,i):(r==null?void 0:r.type)==="vector-tile"?await ha(r,o,i):(r==null?void 0:r.type)==="web-tile"?ya(r):(r==null?void 0:r.type)==="wfs"?await fa(r,o,i):(r==null?void 0:r.type)==="wms"?ba(r,i):(r==null?void 0:r.type)==="wmts"?ga(r):await X(r,o,i),m&&(Array.isArray(m)?a.push(...m):(m.id=r.id,m.title=i.legendLayerNameMap[r.id]||r.title,m.opacity=u.fullOpacity,m.minScale=r.minScale||0,m.maxScale=r.maxScale||0,_t(r)&&r.blendMode&&r.blendMode!=="normal"&&(m.blendMode=r.blendMode),a.push(m)))}if(l)for(const u of a)u.minScale=0,u.maxScale=0;if((d=e.graphics)!=null&&d.length){const u=await W(null,e.graphics,t,i);u&&a.push(u)}return a}function Xi(e){return{culture:e.culture,key:e.key,type:"BingMaps"+(e.style==="aerial"?"Aerial":e.style==="hybrid"?"Hybrid":"Road")}}async function Yi(e,{layerView:t,printTemplate:i},a){if(parseFloat(a.cimVersion)<3.1)return W(e,await pe(t),i,a);const o=e.parent,l={id:(s=B(o,"web-map")).id,url:s.url,layerType:s.layerType,customParameters:s.customParameters,dynamicGroupLayer:{visibility:!1},footprintLayer:s.footprintLayer,layerDefinition:s.layerDefinition};var s;return K(l,o),l}async function ea(e,t,i){e.legendEnabled&&i.legendLayers.push({id:e.id});const a=t.layerView,o=t.printTemplate;if(!(a.filter||e.portalItem&&e.portalItem.access!=="public")){const l=B(e,"web-map");return l.type="CSV",delete l.popupInfo,delete l.layerType,l.showLabels=o.showLabels&&e.labelsVisible,l}return W(e,await pe(a),o,i)}async function W(e,t,i,a){var b,O,M,S,I,k,N;let o;const l=Ai(),s=Mi(),d=st(),u=Fi(),r=st();if(r.layerDefinition.name="textLayer",delete r.layerDefinition.drawingInfo,e){if(e.declaredClass==="esri.layers.FeatureLayer"||e.declaredClass==="esri.layers.StreamLayer"?l.layerDefinition.name=s.layerDefinition.name=d.layerDefinition.name=u.layerDefinition.name=a.legendLayerNameMap[e.id]||((b=e.arcgisProps)==null?void 0:b.title)||e.title:e.declaredClass==="esri.layers.GraphicsLayer"&&(t=e.graphics.items),e.renderer){const _=e.renderer.toJSON(),w=l.layerDefinition.drawingInfo;w&&(w.renderer=_);const C=s.layerDefinition.drawingInfo;C&&(C.renderer=_);const V=d.layerDefinition.drawingInfo;V&&(V.renderer=_);const Q=u.layerDefinition.drawingInfo;Q&&(Q.renderer=_)}if(i.showLabels&&e.labelsVisible&&typeof e.write=="function"){const _=B(e,"web-map"),w=(M=(O=_.layerDefinition)==null?void 0:O.drawingInfo)==null?void 0:M.labelingInfo;if(w){o=!0;const C=l.layerDefinition.drawingInfo;C&&(C.labelingInfo=w);const V=s.layerDefinition.drawingInfo;V&&(V.labelingInfo=w);const Q=d.layerDefinition.drawingInfo;Q&&(Q.labelingInfo=w);const Z=u.layerDefinition.drawingInfo;Z&&(Z.labelingInfo=w)}}}let m;e!=null&&e.renderer||o||(delete l.layerDefinition.drawingInfo,delete s.layerDefinition.drawingInfo,delete d.layerDefinition.drawingInfo,delete u.layerDefinition.drawingInfo);const v=e==null?void 0:e.fieldsIndex,y=e==null?void 0:e.renderer;if(v){const _=new Set;o&&await yi(_,e),y&&typeof y.collectRequiredFields=="function"&&await y.collectRequiredFields(_,v),m=Array.from(_);const w=v.fields.map(C=>C.toJSON());l.layerDefinition.fields=w,s.layerDefinition.fields=w,d.layerDefinition.fields=w,u.layerDefinition.fields=w}const E=t==null?void 0:t.length;let g;for(let _=0;_<E;_++){const w=t[_]||t.at(_);if(w.visible!==!1&&w.geometry){if(g=w.toJSON(),g.hasOwnProperty("popupTemplate")&&delete g.popupTemplate,(S=g.geometry)!=null&&S.z&&delete g.geometry.z,g.symbol&&(g.symbol.angle||delete g.symbol.angle,me(g.symbol)?g.symbol=await ue(g.symbol,a):g.symbol.text&&delete g.attributes),(!i||!i.forceFeatureAttributes)&&(m==null?void 0:m.length)){const C={};for(const V of m)(I=g.attributes)!=null&&I.hasOwnProperty(V)&&(C[V]=g.attributes[V]);g.attributes=C}w.geometry.type==="polygon"?l.featureSet.features.push(g):w.geometry.type==="polyline"?s.featureSet.features.push(g):w.geometry.type==="point"?(k=g.symbol)!=null&&k.text?r.featureSet.features.push(g):d.featureSet.features.push(g):w.geometry.type==="multipoint"?u.featureSet.features.push(g):w.geometry.type==="extent"&&(g.geometry=hi.fromExtent(w.geometry).toJSON(),l.featureSet.features.push(g))}}const D=[l,s,u,d,r].filter(_=>_.featureSet.features.length>0);for(const _ of D){const w=_.featureSet.features.every(C=>C.symbol);if(w&&(!i||!i.forceFeatureAttributes))for(const C of _.featureSet.features)delete C.attributes;w&&delete _.layerDefinition.drawingInfo,(N=_.layerDefinition.drawingInfo)!=null&&N.renderer&&await xt(_.layerDefinition.drawingInfo.renderer,a)}return D.length?{featureCollection:{layers:D},showLabels:o}:null}async function ta(e,t,i){var v,y,E,g,D,b,O,M,S,I,k,N;let a;const o=e.renderer,l=parseFloat(i.cimVersion);if(((v=e.featureReduction)==null?void 0:v.type)==="binning"||((y=e.featureReduction)==null?void 0:y.type)==="cluster"&&l<2.9||(o==null?void 0:o.type)==="pie-chart"||(o==null?void 0:o.type)==="dot-density"&&l<2.6)return X(e,t,i);e.legendEnabled&&i.legendLayers.push({id:e.id});const s=t.layerView,{printTemplate:d,view:u}=t,r=((E=e.source)==null?void 0:E.type)!=="feature-layer"&&((g=e.source)==null?void 0:g.type)!=="ogc-feature";if(s.filter||r||!o||"field"in o&&o.field!=null&&!e.getField(o.field)){const _=await pe(s);a=await W(e,_,d,i)}else{if(a={id:(m=B(e)).id,title:m.title,url:m.url,layerType:m.layerType,customParameters:m.customParameters,layerDefinition:m.layerDefinition,charts:d.includeCharts?m.charts:void 0},d.attributionVisible&&(a.credits=wt(e)),a.showLabels=d.showLabels&&e.labelsVisible,K(a,e),(b=(D=a.layerDefinition)==null?void 0:D.featureReduction)==null||delete b.disablePopup,(M=(O=a.layerDefinition)==null?void 0:O.featureReduction)==null||delete M.popupInfo,s.displayFilterEnabled||((S=a.layerDefinition)==null||delete S.displayFilterInfo),((k=(I=a.layerDefinition)==null?void 0:I.drawingInfo)==null?void 0:k.renderer)&&(delete a.layerDefinition.minScale,delete a.layerDefinition.maxScale,await xt(a.layerDefinition.drawingInfo.renderer,i),"visualVariables"in o&&((N=o.visualVariables)==null?void 0:N[0]))){const w=o.visualVariables[0];if(w.type==="size"&&w.maxSize&&typeof w.maxSize!="number"&&w.minSize&&typeof w.minSize!="number"){const C=bi(w,u.scale);a.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=C.minSize,a.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=C.maxSize}}const _=fi(s);if(_&&(a.layerDefinition??(a.layerDefinition={}),a.layerDefinition.definitionExpression=a.layerDefinition.definitionExpression?`(${a.layerDefinition.definitionExpression}) AND (${_})`:_),e.gdbVersion&&(a.layerDefinition??(a.layerDefinition={}),a.layerDefinition.gdbVersion=e.gdbVersion),s.hasHighlight&&"highlightIds"in s){const w=s;a.selectionObjectIds=w.highlightIds,a.selectionSymbol=Ni(e.geometryType,w.highlightOptions??u.highlightOptions)}}var m;return a}async function ia(e,t,i){var a,o;return((a=e.featureReduction)==null?void 0:a.type)==="binning"||((o=e.featureReduction)==null?void 0:o.type)==="cluster"?X(e,t,i):(e.legendEnabled&&i.legendLayers.push({id:e.id}),W(e,await pe(t.layerView),t.printTemplate,i))}async function aa(e,{printTemplate:t},i){return W(e,null,t,i)}function oa(e,t){var o;e.legendEnabled&&t.legendLayers.push({id:e.id});const i={layerType:(a=B(e)).layerType,customParameters:a.customParameters};var a;return i.bandIds=e.bandIds,i.compressionQuality=e.compressionQuality,i.format=e.format,i.interpolation=e.interpolation,(e.mosaicRule||e.definitionExpression)&&(i.mosaicRule=e.exportImageServiceParameters.mosaicRule.toJSON()),e.rasterFunction&&(i.renderingRule=e.rasterFunction.toJSON()),e.renderer&&(i.layerDefinition??(i.layerDefinition={}),(o=i.layerDefinition).drawingInfo??(o.drawingInfo={}),i.layerDefinition.drawingInfo.renderer=e.renderer.toJSON()),K(i,e),i}async function la(e,t,i){var l;if(((l=e.renderer)==null?void 0:l.type)==="flow")return X(e,t,i);e.legendEnabled&&i.legendLayers.push({id:e.id});const a={bandIds:(o=B(e)).bandIds,customParameters:o.customParameters,interpolation:o.interpolation,layerDefinition:o.layerDefinition};var o;return a.layerType="ArcGISImageServiceLayer",K(a,e),a}async function sa(e,t,i){const a=t.printTemplate;if(!e.portalItem||e.portalItem.access==="public"){const r=B(e,"web-map");return r.type="kml",delete r.layerType,r.url=ne(e.url),r}const o=[],l=t.layerView,s="data:image/png;base64,";l.allVisibleMapImages.forEach((r,m)=>{const v={id:`${e.id}_image${m}`,type:"image",title:e.id,minScale:e.minScale||0,maxScale:e.maxScale||0,opacity:l.fullOpacity,extent:r.extent};r.href.startsWith(s)?v.imageData=r.href.slice(s.length):v.url=r.href,o.push(v)});const d=[...l.allVisiblePoints.items,...l.allVisiblePolylines.items,...l.allVisiblePolygons.items],u={id:e.id,...await W(null,d,a,i)};return o.push(u),o}function ra(e,{printTemplate:t,view:i},a){var m,v;let o;const l={id:e.id,subLayerIds:[]};let s=[];const d=i.scale,u=y=>{const E=d===0,g=y.minScale===0||d<=y.minScale,D=y.maxScale===0||d>=y.maxScale;if(y.visible&&(E||g&&D))if(y.sublayers)y.sublayers.forEach(u);else{const b=y.toExportImageJSON(),O={id:y.id,name:y.title,layerDefinition:{definitionExpression:b.definitionExpression,drawingInfo:b.drawingInfo,orderBy:b.orderBy,source:b.source}};s.unshift(O),l.subLayerIds.push(y.id)}};var r;return e.sublayers&&e.sublayers.forEach(u),s.length&&(s=s.map(({id:y,name:E,layerDefinition:g})=>({id:y,name:E,layerDefinition:g})),o={layerType:(r=B(e)).layerType,customParameters:r.customParameters},o.layers=s,o.visibleLayers=(v=(m=e.capabilities)==null?void 0:m.exportMap)!=null&&v.supportsDynamicLayers?void 0:l.subLayerIds,t.attributionVisible&&(o.credits=wt(e)),e.gdbVersion&&(o.gdbVersion=e.gdbVersion),K(o,e),e.legendEnabled&&a.legendLayers.push(l)),o}async function na({layerView:e,printTemplate:t},i){const a=[],o=e.layer;if(o.featureCollections!=null)for(const l of o.featureCollections){const s=await W(l,l.source,t,i);s&&a.push(...s.featureCollection.layers)}else if(o.sublayers!=null)for(const l of o.sublayers){const s=await W(null,l.graphics,t,i);s&&a.push(...s.featureCollection.layers)}return{featureCollection:{layers:a}}}function pa(){return{type:"OpenStreetMap"}}async function X(e,{printTemplate:t,view:i},a){var v;const o={type:"image"},l={format:"png",ignoreBackground:!0,ignorePadding:!0,layers:[e]};i.rotation!==0&&(l.rotation=0);const s=a.ssExtent||i.state.extent.clone();let d=96,u=!0,r=!0;if(t.exportOptions){const y=t.exportOptions;y.dpi!=null&&y.dpi>0&&(d=y.dpi),y.width!=null&&y.width>0&&(u=y.width%2==i.width%2),y.height!=null&&y.height>0&&(r=y.height%2==i.height%2)}if(t.layout==="map-only"&&t.scalePreserved&&(!t.outScale||t.outScale===i.scale)&&d===96&&(!u||!r)&&i.state.extent.equals(i.extent)&&(l.area={x:0,y:0,width:i.width,height:i.height},u||(l.area.width-=1),r||(l.area.height-=1),!a.ssExtent)){const y=i.toMap(ft(l.area.width,l.area.height));s.ymin=y.y,s.xmax=y.x,a.ssExtent=s}o.extent=s.clone()._normalize(!0).toJSON();const m=await i.takeScreenshot(l);return o.imageData=(v=Kt(m.dataUrl))==null?void 0:v.data,o}async function ca(e,{layerView:t,printTemplate:i},a){return e.legendEnabled&&a.legendLayers.push({id:e.id}),W(e,await pe(t),i,a)}async function da(e,t){if(e.legendEnabled)for(const o of e.sublayers)o.legendEnabled&&t.legendLayers.push({id:o.id});const i={customParameters:(a=B(e)).customParameters,effect:a.effect,layerDefinition:a.layerDefinition,layerType:a.layerType,layers:a.layers,url:a.url};var a;if(Array.isArray(i.layers))for(const o of i.layers)delete o.popupInfo;return K(i,e),i}async function ua(e){var o,l;const t=[],i=[];for(const s of e.map.allTables)s.type!=="feature"||s.loaded||i.push(s.load());i.length&&await Promise.allSettled(i);for(const s of e.map.allTables)if(s.type==="feature"&&s.loaded&&s.isTable&&((o=s.source)==null?void 0:o.type)==="feature-layer"){const d={id:(a=B(s)).id,title:a.title,customParameters:a.customParameters,layerDefinition:{definitionExpression:(l=a.layerDefinition)==null?void 0:l.definitionExpression},url:a.url};K(d,s),t.push(d)}var a;return t.length?t:void 0}function ma(e,t){e.legendEnabled&&t.legendLayers.push({id:e.id});const i={layerType:(a=B(e)).layerType,customParameters:a.customParameters};var a;return K(i,e),i}async function ha(e,t,i){const a=t.layerView;if(e.serviceUrl&&e.styleUrl&&!a.spriteSourceChanged&&!a.styleChanged){const o=he(e.styleUrl,e.apiKey),l=he(e.serviceUrl,e.apiKey);if(!o&&!l||i.cimVersion!=="2.1.0"){const s={type:"VectorTileLayer"};return s.styleUrl=ne(e.styleUrl),s.token=o,l!==o&&(s.additionalTokens=[{url:e.serviceUrl,token:l}]),s}}return X(e,t,i)}function ya(e){var a;const t=(a=e.urlTemplate)==null?void 0:a.replace(/\${/g,"{"),i={type:"WebTiledLayer",urlTemplate:t,credits:e.copyright};return e.subDomains&&e.subDomains.length>0&&(i.subDomains=e.subDomains),i}async function fa(e,t,i){return parseFloat(i.cimVersion)<3.5?X(e,t,i):(e.legendEnabled&&i.legendLayers.push({id:e.id}),{layerType:(a=B(e,"web-map")).layerType,layerDefinition:a.layerDefinition,url:a.url,wfsInfo:a.wfsInfo});var a}function ba(e,t){let i;const a=[],o=l=>{l.visible&&(l.sublayers?l.sublayers.forEach(o):l.name&&a.unshift(l.name))};return e.sublayers&&e.sublayers.forEach(o),a.length&&(e.legendEnabled&&t.legendLayers.push({id:e.id,subLayerIds:a}),i={type:"wms",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,transparentBackground:e.imageTransparency,visibleLayers:a,url:ne(e.url),version:e.version}),i}function ga(e){const t=e.activeLayer;return{type:"wmts",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:t.imageFormat,layer:t.id,style:t.styleId,tileMatrixSet:t.tileMatrixSetId,url:ne(e.url)}}function K(e,t){t.url&&(e.url=ne(e.url||t.url),e.token=he(e.url,t.apiKey))}async function ue(e,t){var s;t.canvas||(t.canvas=document.createElement("canvas"));const i=1024;t.canvas.width=i,t.canvas.height=i;const a=t.canvas.getContext("2d");let o,l;if(e.path){const d=new Path2D(e.path);d.closePath(),a.fillStyle=Array.isArray(e.color)?`rgba(${e.color[0]},${e.color[1]},${e.color[2]},${e.color[3]/255})`:"rgb(0,0,0)",a.fill(d);const u=Vi(a);if(!u)return null;a.clearRect(0,0,i,i);const r=ce(e.size)/Math.max(u.width,u.height);a.scale(r,r);const m=i/r,v=m/2-u.width/2-u.x,y=m/2-u.height/2-u.y;if(a.translate(v,y),Array.isArray(e.color)&&a.fill(d),((s=e.outline)==null?void 0:s.width)&&Array.isArray(e.outline.color)){const g=e.outline;a.lineWidth=ce(g.width)/r,a.lineJoin="round",a.strokeStyle=`rgba(${g.color[0]},${g.color[1]},${g.color[2]},${g.color[3]/255})`,a.stroke(d),u.width+=a.lineWidth,u.height+=a.lineWidth}u.width*=r,u.height*=r;const E=a.getImageData(i/2-u.width/2,i/2-u.height/2,Math.ceil(u.width),Math.ceil(u.height));o=E.width,l=E.height,a.canvas.width=o,a.canvas.height=l,a.putImageData(E,0,0)}else{const d=e.contentType==="image/svg+xml"?"data:image/svg+xml;base64,"+e.imageData:e.url,u=(await Oe(d,{responseType:"image"})).data;o=ce(e.width),l=ce(e.height),a.canvas.width=o,a.canvas.height=l,a.drawImage(u,0,0,a.canvas.width,a.canvas.height)}return{type:"esriPMS",imageData:a.canvas.toDataURL("image/png").slice(22),angle:e.angle,contentType:"image/png",height:at(l),width:at(o),xoffset:e.xoffset,yoffset:e.yoffset}}async function xt(e,t){const i=e.type;if(i==="simple"&&me(e.symbol))e.symbol=await ue(e.symbol,t);else if(i==="uniqueValue"||i==="classBreaks"){me(e.defaultSymbol)&&(e.defaultSymbol=await ue(e.defaultSymbol,t));const a=e[i==="uniqueValue"?"uniqueValueInfos":"classBreakInfos"];if(a)for(const o of a)me(o.symbol)&&(o.symbol=await ue(o.symbol,t))}}async function pe(e){return e.queryFeatures(e.createQuery()).then(t=>t.features)}function B(e,t){return e.write({},{ignorePersistenceEnabled:!0,origin:t})??{}}function va(e){var t;return(t=e.gpMetadata)!=null&&t.executionType?Ji.fromJSON(e.gpMetadata.executionType):"sync"}function me(e){var t;return e&&(e.path||e.contentType==="image/svg+xml"||((t=e.url)==null?void 0:t.endsWith(".svg")))}let z=class extends re{constructor(t){super(t),this.extent=null,this.extraParameters=null,this.outSpatialReference=null,this.template=null,this.updateDelay=1e3,this.view=null}};n([c()],z.prototype,"extent",void 0),n([c()],z.prototype,"extraParameters",void 0),n([c({type:ge})],z.prototype,"outSpatialReference",void 0),n([c()],z.prototype,"template",void 0),n([c()],z.prototype,"updateDelay",void 0),n([c()],z.prototype,"view",void 0),z=n([q("esri.rest.support.PrintParameters")],z);const wa=z;let P=class extends re{constructor(e){super(e),this.strokeDash=[],this.strokeWidth=2,this.strokeColor=[0,0,0,1],this.strokeBackgroundColor=[0,0,0,0],this.fillColor=[0,0,0,0],this.backgroundFillColor=[0,0,0,.5],this.visible=!0,this.isDecoration=!1,this.boxWidth=0,this.boxHeight=0,this.backgroundWidth=0,this.backgroundHeight=0,this.padding={left:0,top:0,right:0,bottom:0}}get _strokeStyle(){return`rgba(${this.strokeColor.join()})`}get _strokeBackgroundStyle(){return`rgba(${this.strokeBackgroundColor.join()})`}get _fillStyle(){return`rgba(${this.fillColor.join()})`}get _backgroundFillStyle(){return`rgba(${this.backgroundFillColor.join()})`}render(){const{backgroundWidth:e,backgroundHeight:t,boxWidth:i,boxHeight:a,padding:o}=this,l=o.left,s=o.top,d=this.x??l+e/2-i/2,u=this.y??s+t/2-a/2,r=d+i,m=u+a;return p("div",{classes:{"esri-box-overlay-item":!0},styles:{left:"0px",top:"0px",width:"100%",height:"100%",visibility:this.visible?"visible":"hidden"}},p("svg",{styles:{width:"100%",height:"100%"}},p("path",{d:`M ${l} ${s} L ${e+l} ${s} L ${e+l} ${t+s} L ${l} ${t+s} Z M ${d} ${u} L ${d} ${m} L ${r} ${m} L ${r} ${u} Z`,fill:this._backgroundFillStyle,stroke:this._strokeBackgroundStyle,"stroke-width":this.strokeWidth}),p("rect",{fill:this._fillStyle,height:a,stroke:this._strokeStyle,"stroke-dasharray":this.strokeDash.join(" ")||void 0,"stroke-width":this.strokeWidth,width:i,x:d,y:u})))}renderCanvas(){}};n([c()],P.prototype,"strokeDash",void 0),n([c()],P.prototype,"strokeWidth",void 0),n([c()],P.prototype,"strokeColor",void 0),n([c()],P.prototype,"strokeBackgroundColor",void 0),n([c()],P.prototype,"fillColor",void 0),n([c()],P.prototype,"backgroundFillColor",void 0),n([c()],P.prototype,"visible",void 0),n([c()],P.prototype,"isDecoration",void 0),n([c()],P.prototype,"boxWidth",void 0),n([c()],P.prototype,"boxHeight",void 0),n([c()],P.prototype,"backgroundWidth",void 0),n([c()],P.prototype,"backgroundHeight",void 0),n([c()],P.prototype,"x",void 0),n([c()],P.prototype,"y",void 0),n([c()],P.prototype,"padding",void 0),n([c({readOnly:!0})],P.prototype,"_strokeStyle",null),n([c({readOnly:!0})],P.prototype,"_strokeBackgroundStyle",null),n([c({readOnly:!0})],P.prototype,"_fillStyle",null),n([c({readOnly:!0})],P.prototype,"_backgroundFillStyle",null),P=n([q("esri.views.overlay.BoxOverlayItem")],P);const _a=P;async function Ot(e,t,i){if(!e)throw new G("print:invalid-layout-info-task-url","Can't fetch layout template info",{url:e});if(await It(e)==="async"){const a=await bt(e,t,void 0,i||void 0);return await a.waitForJobCompletion(),(await a.fetchResultData("Output_JSON")).value}return(await vt(e,t,null,i)).results[0].value}let U=class extends ki{constructor(e){super(e),this.description=null,this.format=null,this.state="not-loaded",this.label=null,this.layoutInfoTaskUrl=null,this.layout=null,this.layoutItem=null,this.layoutOptions=null,this.layoutTemplateInfo=null,this.type=null}get id(){var e;return((e=this.layoutItem)==null?void 0:e.id)??`${this.layout}-${Li(JSON.stringify(this.toJSON()))}`}get mapSurroundInfoOptions(){var i,a,o;const e=(a=(i=this.layoutTemplateInfo)==null?void 0:i.layoutOptions)==null?void 0:a.mapSurroundInfos;if(!e)return null;const t={northArrow:[],scaleBar:[],legend:[]};for(const l of e)switch(l.type){case"CIMMarkerNorthArrow":t.northArrow.push(l);break;case"CIMScaleLine":t.scaleBar.push(l);break;case"CIMGroupElement":(o=l.elements)!=null&&o.some(s=>s.type==="CIMScaleLine")&&t.scaleBar.push(l);break;case"CIMLegend":t.legend.push(l)}return t}_updateLayoutOptions(e){var o,l,s,d,u,r,m,v;const t=((o=this.layoutOptions)==null?void 0:o.legend)??((l=e.layoutOptions)==null?void 0:l.hasLegend),i=((s=this.layoutOptions)==null?void 0:s.northArrow)??((d=this.mapSurroundInfoOptions)!=null&&d.northArrow.length?(u=this.mapSurroundInfoOptions)==null?void 0:u.northArrow.some(({visible:y})=>y):void 0),a=((r=this.layoutOptions)==null?void 0:r.scaleBar)??((m=this.mapSurroundInfoOptions)!=null&&m.scaleBar.length?(v=this.mapSurroundInfoOptions)==null?void 0:v.scaleBar.some(({visible:y})=>y):void 0);this._set("layoutOptions",{legend:t,northArrow:i,scaleBar:a})}async fetchLayoutItemTemplateInfo(e){const{layoutItem:t}=this;if(t!=null&&t.id&&!this.layoutTemplateInfo&&this.state!=="loaded")try{this._set("state","loading");const i=this.layoutInfoTaskUrl;if(!i)throw new G("print:invalid-layout-info-task-url","Can't fetch layout template info",{url:i});t.access!=="public"&&ie&&await ie.getCredential(i);const a={Layout_Item_ID:JSON.stringify({id:t.id})},o=(await Ot(i,a,e))[0];this.setLayoutTemplateInfo(o)}catch(i){this._set("state",dt(i)?"not-loaded":"error")}}setLayoutTemplateInfo(e){this._set("layoutTemplateInfo",e),this._updateLayoutOptions(e),this._set("state","loaded")}};n([c({json:{write:!0}})],U.prototype,"description",void 0),n([Ei(se)],U.prototype,"format",void 0),n([c({readOnly:!0})],U.prototype,"id",null),n([c({readOnly:!0})],U.prototype,"state",void 0),n([c({json:{write:!0}})],U.prototype,"label",void 0),n([c()],U.prototype,"layoutInfoTaskUrl",void 0),n([c({json:{read:ee,write:!0}})],U.prototype,"layout",void 0),n([c({type:ye,json:{write:!0}})],U.prototype,"layoutItem",void 0),n([c({readOnly:!0,json:{write:!0}})],U.prototype,"layoutOptions",void 0),n([c({readOnly:!0})],U.prototype,"layoutTemplateInfo",void 0),n([c({readOnly:!0})],U.prototype,"mapSurroundInfoOptions",null),n([c()],U.prototype,"type",void 0),U=n([q("esri.widgets.Print.CustomTemplate")],U);const te=U;let $=class extends re{constructor(e){super(e),this._abortController=null,this.attributionEnabled=!0,this.author=null,this.copyright=null,this.customTextElements=null,this.dpi=96,this.fileName=null,this.forceFeatureAttributes=!1,this.format="pdf",this.height=null,this.includeTables=!0,this.id=null,this.state="ready",this.layout="letter-ansi-a-landscape",this.layoutItem=null,this.legendEnabled=void 0,this.northArrowEnabled=void 0,this.scale=null,this.scaleBarEnabled=void 0,this.scaleEnabled=!1,this.title=null,this.width=null}async applyTemplate(e,t){var o,l,s,d,u;if((e==null?void 0:e.id)===this.id&&(e==null?void 0:e.state)!=="error"||(this._abortController&&(this._abortController.abort(),this._abortController=null),!e))return;if(this._set("state","pending"),this._resetMapSurroundInfoOptions(),this._set("id",e.id),this.set({layout:e.layout,layoutItem:e.layoutItem}),!e.layoutOptions&&e.layoutItem){const r=new AbortController;if(this._abortController=r,await e.fetchLayoutItemTemplateInfo({signal:this._abortController.signal}),e.state!=="loaded")return e.state==="error"&&this._set("state","error"),this._abortController!==r?void 0:void(this._abortController=null);this._abortController=null}const i=t==null?void 0:t.customLayoutOptions,a=(t==null?void 0:t.customTextElements)??((l=(o=e.layoutTemplateInfo)==null?void 0:o.layoutOptions)==null?void 0:l.customTextElements)??this.customTextElements;this.set({customTextElements:a?Te(a):void 0,format:this.format??e.format,legendEnabled:(i==null?void 0:i.legend)??((s=e.layoutOptions)==null?void 0:s.legend)??this.legendEnabled,northArrowEnabled:(i==null?void 0:i.northArrow)??((d=e.layoutOptions)==null?void 0:d.northArrow)??this.northArrowEnabled,scaleBarEnabled:(i==null?void 0:i.scaleBar)??((u=e.layoutOptions)==null?void 0:u.scaleBar)??this.scaleBarEnabled}),this._set("state","ready")}reset(){this._set("id",null),this._set("state","ready"),this.set({layout:null,layoutItem:null,customTextElements:null}),this._resetMapSurroundInfoOptions()}_resetMapSurroundInfoOptions(){this.set({legendEnabled:void 0,northArrowEnabled:void 0,scaleBarEnabled:void 0})}};n([c()],$.prototype,"attributionEnabled",void 0),n([c()],$.prototype,"author",void 0),n([c()],$.prototype,"copyright",void 0),n([c()],$.prototype,"customTextElements",void 0),n([c()],$.prototype,"dpi",void 0),n([c()],$.prototype,"fileName",void 0),n([c()],$.prototype,"forceFeatureAttributes",void 0),n([c()],$.prototype,"format",void 0),n([c()],$.prototype,"height",void 0),n([c()],$.prototype,"includeTables",void 0),n([c({readOnly:!0})],$.prototype,"id",void 0),n([c({readOnly:!0})],$.prototype,"state",void 0),n([c()],$.prototype,"layout",void 0),n([c({type:ye})],$.prototype,"layoutItem",void 0),n([c()],$.prototype,"legendEnabled",void 0),n([c()],$.prototype,"northArrowEnabled",void 0),n([c()],$.prototype,"scale",void 0),n([c()],$.prototype,"scaleBarEnabled",void 0),n([c()],$.prototype,"scaleEnabled",void 0),n([c()],$.prototype,"title",void 0),n([c()],$.prototype,"width",void 0),$=n([q("esri.widgets.Print.TemplateOptions")],$);const St=$,Ta=[30,144,255,255],pt=[237,211,23,255],Ia=[216,48,32,255],xa=new Set(["GISProfessionalStdUT","GISProfessionalAdvUT"]),Oa=/(\/GPServer\/).+/i,Sa=new oe({inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"}),ae=mt.ofType(te);function ka(e){var i;e.layoutOptions??(e.layoutOptions={}),(i=e.layoutOptions).customTextElements??(i.customTextElements=[]);const t="date";if(!e.layoutOptions.customTextElements.find(a=>t in a)){const{customTextElements:a}=e.layoutOptions;let o=di(Date.now(),ui("short-date"));mi()==="ar"&&(o="‏"+o),a.push({date:o})}}function _e(e,t,i){t&&t.visible!==i&&e.layoutOptions&&(e.layoutOptions.elementOverrides?e.layoutOptions.elementOverrides[t.name]={visible:i}:e.layoutOptions.elementOverrides={[t.name]:{visible:i}})}let L=class extends ni{constructor(t){super(t),this._serviceTemplateCustomTextElements=null,this._templateIdToCustomTemplate=new pi,this._isFreeHand=!1,this._freeHandWidth=0,this._freehandHeight=0,this._asyncPrintTaskUrl=null,this._layoutInfoTaskUrl=null,this._customLayoutOptions=null,this.allowedFormats="all",this.allowedLayouts="all",this.browseTemplates=new ae,this.defaultTemplates=new ae,this.error=null,this.extraParameters=null,this.includeDefaultTemplates=!0,this.outSpatialReference=null,this.portal=yt.getDefault(),this.portalTemplateIds=[],this.printServiceTemplates=new ae,this.defaultTemplate=null,this.showPrintAreaEnabled=!1,this.printServiceUrl=null,this.printTimeout=12e4,this.templatesInfo=null,this.updateDelay=1e3,this.view=null,this.templateCustomTextElements=null,this.templateOptions=new St}initialize(){this.addHandles([j(()=>[this.showPrintAreaEnabled,this.view],()=>{var t,i;this.showPrintAreaEnabled?this._enablePrintPreview():(this.removeHandles("overlay-handler"),(i=(t=this.view)==null?void 0:t.overlay)==null||i.removeItem(this._getOverlayItem()))}),j(()=>[this.templateOptions.layout,this.templateOptions.layoutItem],()=>{this.loaded&&this._processTemplateOptions()})])}destroy(){var t;this.removeHandles("overlay-handler"),this.view&&(this._overlayItem&&((t=this.view.overlay)==null||t.removeItem(this._overlayItem),this._overlayItem.destroy(),this._overlayItem=null),this.view=null)}get effectivePrintServiceUrl(){return this.printServiceUrl??null}get effectiveTemplateCustomTextElements(){if(!this._serviceTemplateCustomTextElements)return{};const t=Te(this._serviceTemplateCustomTextElements);return this.templateCustomTextElements&&Object.keys(this.templateCustomTextElements).forEach(i=>{var o;const a=t[i];if(a){const l=(o=this.templateCustomTextElements)==null?void 0:o[i];a.forEach(s=>{const[d]=Object.entries(s)[0];l==null||l.forEach(u=>{const[r,m]=Object.entries(u)[0];d===r&&(s[d]=m)})})}}),Object.freeze(t)}get state(){var t;return this.loadStatus==="loading"?"initializing":this.loadStatus==="failed"||this.error?"error":this.loadStatus==="loaded"&&((t=this.view)!=null&&t.ready)?"ready":"disabled"}async load(t){return this.addResolvingPromise(this._loadResources(t).catch(i=>this.error=i)),this}async print(t){var r;const{view:i,extraParameters:a,updateDelay:o,outSpatialReference:l}=this;if(!i)throw new G("print:view-required","view is not set");ka(t);const s=this._getOverlayItem(),d=t.scalePreserved||!this.showPrintAreaEnabled?void 0:Si(new ci,i.viewpoint,t.layout==="map-only"?[t.exportOptions.width,t.exportOptions.height]:[s.boxWidth,s.boxHeight]),u=new wa({view:i,template:t,extent:d,extraParameters:a,updateDelay:o,outSpatialReference:l});try{const m=!!((r=t.layoutItem)!=null&&r.id)&&(this.portalTemplateIds.includes(t.layoutItem.id)||this.browseTemplates.some(v=>{var y,E;return((y=v.layoutItem)==null?void 0:y.id)===((E=t.layoutItem)==null?void 0:E.id)}));return await Gi(m&&this._asyncPrintTaskUrl?this._asyncPrintTaskUrl:this.effectivePrintServiceUrl,u,{timeout:this.printTimeout})}catch(m){throw new G("print:export-error","An error occurred while exporting the web map.",{error:m})}}toPrintTemplate({attributionEnabled:t,author:i,copyright:a,customTextElements:o,dpi:l,forceFeatureAttributes:s,format:d,height:u,id:r,includeTables:m,layout:v,layoutItem:y,legendEnabled:E,northArrowEnabled:g,scale:D,scaleBarEnabled:b,scaleEnabled:O,title:M,width:S}){var k;if(!v&&!y)throw new G("print:layout-required","layout is not set");const I=new Tt({attributionVisible:t,forceFeatureAttributes:s,format:d,includeTables:m,layout:v,layoutItem:y,layoutOptions:{authorText:i||"",copyrightText:a||"",customTextElements:o,titleText:M||""},outScale:D??0,scalePreserved:O});if(S&&(I.exportOptions.width=S),u&&(I.exportOptions.height=u),l&&(I.exportOptions.dpi=l),I.layoutOptions){E||(I.layoutOptions.legendLayers=[]);const N=(k=this.getLayoutTemplateById(r))==null?void 0:k.mapSurroundInfoOptions;if(N){const _=N.northArrow;for(const V of _)_e(I,V,g);const w=N.scaleBar;for(const V of w)_e(I,V,b);const C=N.legend;for(const V of C)_e(I,V,E)}}return I}getLayoutTemplateById(t){return t?this._templateIdToCustomTemplate.get(t):null}async addPortalTemplate(t){if(!this.portal||!(t!=null&&t.id))return;try{t.loaded||await t.load()}catch{return void this.applyTemplate(this.defaultTemplate)}const i=new te({type:"browse-template",layoutInfoTaskUrl:this._layoutInfoTaskUrl,label:t.title,layoutItem:t});this._templateIdToCustomTemplate.set(i.id,i),this.browseTemplates.add(i)}removePortalTemplate(t){t.layoutItem&&this.templateOptions.id===t.layoutItem.id&&(this.defaultTemplate?this.applyTemplate(this.defaultTemplate):this.templateOptions.reset()),this.browseTemplates.remove(t),this._templateIdToCustomTemplate.delete(t.id)}async applyTemplate(t){var o,l,s,d;if(!t)return void this.templateOptions.reset();!t.layout||!this.templatesInfo||this.templatesInfo.layout.choiceList.includes(t.layout)||(this.defaultTemplate?t=this.defaultTemplate:this.templateOptions.reset());const i=t.layout||((o=t.layoutItem)==null?void 0:o.id),a=i?(l=this.templateCustomTextElements)==null?void 0:l[i]:void 0;if(await this.templateOptions.applyTemplate(t,{customTextElements:a,customLayoutOptions:this._customLayoutOptions}),i&&this._serviceTemplateCustomTextElements&&!this._serviceTemplateCustomTextElements[i]&&((d=(s=t.layoutTemplateInfo)==null?void 0:s.layoutOptions)==null?void 0:d.customTextElements)){const u=Te(this._serviceTemplateCustomTextElements);u[i]=t.layoutTemplateInfo.layoutOptions.customTextElements,this._serviceTemplateCustomTextElements=Object.freeze(u)}}async _loadResources(t){if(this.destroyed)return;await this._loadUrls(t);const[i,a]=await Promise.all([this._getLayoutToLayoutTemplateInfos(t),this._getPrintServiceTemplatesInfo(t)]);await this._loadAllTemplates(i,a,t),this._processPrintServiceTemplatesInfo(a),await this._processTemplateOptions(),this._updateOverLayItem()}async _processTemplateOptions(){const{layout:t,layoutItem:i}=this.templateOptions;if(t!=="map-only"&&!this.templateOptions.id){if(this._customLayoutOptions={legend:this.templateOptions.legendEnabled,northArrow:this.templateOptions.northArrowEnabled,scaleBar:this.templateOptions.scaleBarEnabled},i==null?void 0:i.id){try{i.loaded||await i.load()}catch{return void this.applyTemplate(this.defaultTemplate)}let a=this._templateIdToCustomTemplate.get(i.id);a||(a=new te({label:i.title,layoutItem:i,layoutInfoTaskUrl:this._layoutInfoTaskUrl}),this._templateIdToCustomTemplate.set(a.id,a)),await this.applyTemplate(a)}else if(t){const a=this.defaultTemplates.find(o=>o.layout===this.templateOptions.layout)??this.printServiceTemplates.find(o=>o.layout===this.templateOptions.layout);await this.applyTemplate(a??this.defaultTemplate)}}}async _loadPortal(t){try{await this.portal.load(t)}catch(i){throw new G("print:could-not-load-portal","Cannot load print resource information from portal",{error:i,url:this.effectivePrintServiceUrl})}}async _loadUrls(t){var a,o;if(this.printServiceUrl)this._set("effectivePrintServiceUrl",this.printServiceUrl),await this._updateLayoutInfoTaskUrl(this.effectivePrintServiceUrl);else{await this._loadPortal(t);const{printTask:l,asyncPrintTask:s,layoutInfoTask:d}=((a=this.portal)==null?void 0:a.helperServices)??{};this._set("effectivePrintServiceUrl",l==null?void 0:l.url),this._asyncPrintTaskUrl=s==null?void 0:s.url,await this._updateLayoutInfoTaskUrl((d==null?void 0:d.url)||this.effectivePrintServiceUrl)}const i=(o=this.effectivePrintServiceUrl)==null?void 0:o.toLowerCase().split("/");if(!(i!=null&&i.includes("gpserver")))throw new G("print:invalid-print-service-url","Can't fetch print templates information from provided URL",{url:this.effectivePrintServiceUrl})}async _updateLayoutInfoTaskUrl(t,i){if(!t)return;const a=(await ji(t,i)).find(o=>o.includes("Get Layout Templates Info"));a&&(this._layoutInfoTaskUrl=t.replace(Oa,`$1${encodeURI(a)}`))}_getPortalDefaultTemplates(t,i){var a,o,l,s,d;return((d=(s=(l=(o=(a=this.portal)==null?void 0:a.helperServices)==null?void 0:o.printTask)==null?void 0:l.templates)==null?void 0:s.filter(u=>u.layout.toLowerCase()!=="map_only"&&(!i||i.includes(ee(u.layout)))))==null?void 0:d.map(u=>{const r=te.fromJSON(u);if(r.type="default-template",r.layoutInfoTaskUrl=this._layoutInfoTaskUrl,r.layout){const m=t.get(r.layout);m&&r.setLayoutTemplateInfo(m)}return r}))??[]}async _getPortalCustomTemplates(t){if(this.printServiceUrl||!this.portal)return[];const{layoutGroupQuery:i,user:a}=this.portal,o=ht.test(this.portal.url),l=a==null?void 0:a.userLicenseTypeId,s=l&&xa.has(l);if(!i||o&&!s)return[];const d=new it({query:i,disableExtraQuery:!0}),u=await this.portal.queryGroups(d,t);if(!u.total)return[];const r=u.results[0],m=new it({num:100,query:"type:Layout",sortField:r.sortField,sortOrder:r.sortOrder??void 0}),v=(await r.queryItems(m,t)).results;return v.length?v.map(y=>(this.portalTemplateIds.push(y.id),new te({type:"default-template",label:y.title,layoutItem:y,layoutInfoTaskUrl:this._layoutInfoTaskUrl}))):[]}async _loadAllTemplates(t,i,a){var s;let o=!1;const l=(s=i==null?void 0:i.layout)==null?void 0:s.choiceList;if(this.includeDefaultTemplates&&this.portal&&!this.printServiceUrl){const d=this._getPortalDefaultTemplates(t,l);o=!!d.length,this.defaultTemplates.addMany(d);const u=await this._getPortalCustomTemplates(a);this.defaultTemplates.addMany(u);for(const r of this.defaultTemplates)this._templateIdToCustomTemplate.set(r.id,r)}o||t.forEach((d,u)=>{if(!l||l.includes(u)){const r=new te({type:"print-service-template",layout:u,layoutInfoTaskUrl:this._layoutInfoTaskUrl});r.setLayoutTemplateInfo(d),this.printServiceTemplates.add(r),this._templateIdToCustomTemplate.set(r.id,r)}})}_processPrintServiceTemplatesInfo(t){var a;this._set("templatesInfo",t);const i=(a=t==null?void 0:t.layout)==null?void 0:a.defaultValue;if(i&&i!=="map-only"){const o=this.defaultTemplates.find(l=>l.layout===i)??this.printServiceTemplates.find(l=>l.layout===i)??this.defaultTemplates.at(0)??this.printServiceTemplates.at(0);this._set("defaultTemplate",o)}}async _getLayoutToLayoutTemplateInfos(t){const i=await Ot(this._layoutInfoTaskUrl,void 0,t),a=new Map,o={};for(const l of i){const s=ee(l.layoutTemplate);a.set(s,l),o[s]=l.layoutOptions.customTextElements}return this._serviceTemplateCustomTextElements=Object.freeze(o),a}async _getPrintServiceTemplatesInfo(t){let i;try{({data:i}=await Oe(this.effectivePrintServiceUrl,{...t,query:{f:"json"},timeout:this.printTimeout}))}catch(s){throw dt(s)?s:new G("print:unavailable-service-info","Can't fetch templates info from service",{error:s})}const{parameters:a}=i,o=a.find(({name:s})=>s==="Format"),l=a.find(({name:s})=>s==="Layout_Template");return{format:this._getFormat(o),layout:this._getLayout(l)}}_getFormat(t){const i=this.allowedFormats==="all"?t.choiceList:t.choiceList.filter(s=>typeof this.allowedFormats!="string"&&this.allowedFormats.some(d=>new RegExp(`\\b${d}\\b`,"i").test(s))),a=(i.length?i:t.choiceList).map(s=>se.fromJSON(s)).filter(Xe),o=se.fromJSON(t.defaultValue),l=a.some(s=>new RegExp(`\\b${o}\\b`,"i").test(s))?o:a[0];return{choiceList:a,defaultValue:l}}_getLayout(t){const i=t.choiceList.filter(d=>d.toLowerCase()!=="map_only"),a=this.allowedLayouts==="all"?i:i.filter(d=>this.allowedLayouts.includes(ee(d))),o=(a.length?a:i).map(ee).filter(Xe),l=ee(t.defaultValue),s=o.includes(l)?l:o.find(d=>/(?=.*letter)(?=.*landscape)/i.test(d))??o.find(d=>/(?=.*a4)(?=.*landscape)/i.test(d))??o[0];return{choiceList:o,defaultValue:s}}_getOverlayItem(){return this._overlayItem||(this._overlayItem=new _a({strokeDash:[5],strokeWidth:2,strokeColor:[30,144,255,255]})),this._overlayItem}_enablePrintPreview(){var a,o,l;if(!((a=this.view)!=null&&a.overlay))return;const t=this.templateOptions,i=this._getOverlayItem();this.addHandles([j(()=>{var s,d,u,r;return[t.width,t.height,t.scaleEnabled,t.scale,t.layout,t.layoutItem,t.id,t.state,(s=this.view)==null?void 0:s.scale,(d=this.view)==null?void 0:d.size,(u=this.view)==null?void 0:u.state.paddedViewState.size,(r=this.view)==null?void 0:r.state.padding,this.loaded]},()=>this._updateOverLayItem(),ut),(o=this.view)==null?void 0:o.on("drag",["Shift"],s=>this._handleDrag(s),lt.WIDGET),(l=this.view)==null?void 0:l.on("key-down",["Escape"],()=>this._resetDrag(),lt.WIDGET)],"overlay-handler"),this.view.overlay.addItem(i)}_updateOverLayItem(){var g;if(!this.view)return;const t=this.templateOptions,i=this._getOverlayItem(),a=((g=t.layoutItem)==null?void 0:g.id)??t.layout,o=this.view,l=o.spatialReference,[s,d]=o.state.paddedViewState.size,u=o.state.padding;let r=0,m=0;if(a==="map-only")t.width!=null&&t.height!=null&&(r=t.width,m=t.height);else if(a){const D=t.id?this._templateIdToCustomTemplate.get(t.id):null,{webMapFrameSize:b,pageUnits:O}=(D==null?void 0:D.layoutTemplateInfo)??{};let M=!1;if(b&&O)if(this._isFreeHand){const S=b[0]/b[1];r=this._freeHandWidth,m=this._freehandHeight,r>m?m=r/S:r=m*S}else{const S=Sa.fromJSON(O.toLowerCase()),I=l.unit;et(S)===et(I)?(r=tt(b[0],S,I),m=tt(b[1],S,I)):(M=!0,r=b[0],m=b[1])}if(!this._isFreeHand)if(t.scaleEnabled&&t.scale){const S=M?Math.min(s/r,d/m):Yt(l)*ei*t.dpi;r*=S,m*=S}else if(r===0||m===0)r=s,m=d;else{const S=(s-.1*s)/r,I=(d-.1*d)/m,k=Math.min(S,I);r*=k,m*=k}}const{scaleEnabled:v,scale:y}=t,E=v&&y?y/this.view.scale:1;if(i.boxWidth=r*E||s,i.boxHeight=m*E||d,u&&(i.padding=u),i.backgroundWidth=s??0,i.backgroundHeight=d??0,this.loadStatus==="loading")i.strokeColor=pt;else if(this.loadStatus==="loaded")switch(this.templateOptions.state){case"pending":i.strokeColor=pt;break;case"ready":i.strokeColor=Ta;break;case"error":i.strokeColor=Ia}}_resetDrag(){this._isFreeHand=!1,this._updateOverLayItem()}_handleDrag(t){switch(t.action){case"start":this._start();break;case"update":this._update(t);break;case"end":this._end()}t.stopPropagation()}_start(){this._isFreeHand=!0}_update(t){const i=this._getOverlayItem(),{x:a,y:o}=t,{x:l,y:s}=t.origin;a>l?(i.x=l,i.boxWidth=a-l):(i.x=a,i.boxWidth=l-a),o>s?(i.y=s,i.boxHeight=o-s):(i.y=o,i.boxHeight=s-o)}_end(){const t=this._getOverlayItem();if(!this.view||t.x==null||t.y==null)return;const i=this.view,a=i.toMap(ft(t.x+.5*t.boxWidth,t.y+.5*t.boxHeight));t.x=null,t.y=null,i.goTo({center:a}),this._freeHandWidth=t.boxWidth,this._freehandHeight=t.boxHeight,this.templateOptions.layout==="map-only"&&(this.templateOptions.width=this._freeHandWidth,this.templateOptions.height=this._freehandHeight),this.templateOptions.scale=this.view.scale,this._updateOverLayItem()}};n([c()],L.prototype,"_serviceTemplateCustomTextElements",void 0),n([c()],L.prototype,"_templateIdToCustomTemplate",void 0),n([c()],L.prototype,"allowedFormats",void 0),n([c()],L.prototype,"allowedLayouts",void 0),n([c({type:ae})],L.prototype,"browseTemplates",void 0),n([c({type:ae})],L.prototype,"defaultTemplates",void 0),n([c()],L.prototype,"error",void 0),n([c()],L.prototype,"extraParameters",void 0),n([c()],L.prototype,"includeDefaultTemplates",void 0),n([c({readOnly:!0})],L.prototype,"effectivePrintServiceUrl",null),n([c()],L.prototype,"effectiveTemplateCustomTextElements",null),n([c({type:ge})],L.prototype,"outSpatialReference",void 0),n([c({type:yt})],L.prototype,"portal",void 0),n([c()],L.prototype,"portalTemplateIds",void 0),n([c({type:ae})],L.prototype,"printServiceTemplates",void 0),n([c({readOnly:!0})],L.prototype,"defaultTemplate",void 0),n([c()],L.prototype,"showPrintAreaEnabled",void 0),n([c()],L.prototype,"printServiceUrl",void 0),n([c()],L.prototype,"printTimeout",void 0),n([c({readOnly:!0})],L.prototype,"state",null),n([c({readOnly:!0})],L.prototype,"templatesInfo",void 0),n([c()],L.prototype,"updateDelay",void 0),n([c()],L.prototype,"view",void 0),n([c()],L.prototype,"templateCustomTextElements",void 0),n([c({type:St})],L.prototype,"templateOptions",void 0),L=n([q("esri.widgets.Print.PrintViewModel")],L);const kt=L,Lt=mt.ofType(gt),Et="map-only";var T;(function(e){e.layout="layoutTab",e.mapOnly="mapOnlyTab",e.export="exportTab"})(T||(T={}));const f="esri-print",Y=`${f}__advanced-options-button`,h={base:f,headerTitle:`${f}__header-title`,layoutTabList:`${f}__layout-tab-list`,layoutTab:`${f}__layout-tab`,layoutSection:`${f}__layout-section`,mapOnlySection:`${f}__map-only-section`,panelItemsCentered:`${f}__panel-items--centered`,loader:`${f}__loader`,advancedOptionsButton:Y,advancedOptionsButtonContainer:`${Y}-container`,advancedOptionsButtonTitle:`${Y}-title`,advancedOptionsButtonIconOpened:`${Y}-icon--opened`,advancedOptionsButtonIconClosed:`${Y}-icon--closed`,advancedOptionsButtonIconClosed_RTL:`${Y}-icon--closed-rtl`,swapButton:`${f}__swap-button`,printButton:`${f}__export-button`,printButtonSection:`${f}__export-button-section`,printButtonSectionDivider:`${f}__export-button-section--divider`,templateSelectContainer:`${f}__template-select-container`,templateSelectBlock:`${f}__template-select-block`,templateSelectIcon:`${f}__template-select-icon`,templateSelectError:`${f}__template-select-error`,templateSelectArrow:`${f}__template-select-arrow`,formSectionContainer:`${f}__form-section-container`,formCheckboxLabel:`${f}__form-checkbox-label`,advancedOptionsSection:`${f}__advanced-options-section`,advancedOptionsContainer:`${f}__advanced-options-container`,browseTemplateButtonContainer:`${f}__browse-template-button-container`,browseTemplateButtonContainerFilter:`${f}__browse-template-button-container-filter`,exportedFilesContainer:`${f}__export-panel-container`,exportedFilesTitle:`${f}__export-title`,exportedFile:`${f}__exported-file`,exportedFileLink:`${f}__exported-file-link`,exportedFileLinkTitle:`${f}__exported-file-link-title`,exportedFileLinkDescription:`${f}__exported-file-link-description`,exportedFilesEmpty:`${f}__exported-files-empty`,printWidgetContainer:`${f}__container`,content:`${f}__content`,panelContainer:`${f}__panel-container`,scaleInfoContainer:`${f}__scale-info-container`,scaleInputContainer:`${f}__scale-input-container`,scaleInput:`${f}__scale-input`,sizeContainer:`${f}__size-container`,panelError:`${f}__panel--error`,exportedFileError:`${f}__exported-file--error`,exportedFileLoader:`${f}__exported-file--loader`,exportSection:`${f}__export-section`,exportSectionCentered:`${f}__export-section--centered`,templateButtonContainer:`${f}__template-button-container`,templateDoneButton:`${f}__template-done-button`,templateSelectFlowItemContainer:`${f}__template-select-flow-item-container`,templateSelectFlowItemContent:`${f}__template-select-flow-item-content`,templateSelectFlowItemListHeading:`${f}__template-select-flow-item-list-heading`,srLabel:`${f}__sr-label`,invalidWkidText:`${f}__invalid-wkid-text`};function La(e,t,i,a){const o=i/t,l=a/t;return{width:Math.round(e*o),height:Math.round(e*l)}}function Ea(e){return!isNaN(e)&&e>0}function de(e){return(e==null?void 0:e.toLowerCase())===Et}function $a(e){var a;const{state:t,extension:i}=e;switch(t){case"pending":return"spinner";case"error":return"exclamation-mark-circle";default:return(a=i==null?void 0:i.toLowerCase())!=null&&a.includes("pdf")?"file-pdf":"file"}}const Ca=new oe({inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"}),ct=new Map([["a3-landscape","a3-landscape"],["a3-portrait","a3-portrait"],["a4-landscape","a4-landscape"],["a4-portrait","a4-portrait"],["letter-ansi-a-landscape","ansi-a-landscape"],["letter-ansi-a-portrait","ansi-a-portrait"],["tabloid-ansi-b-landscape","ansi-b-landscape"],["tabloid-ansi-b-portrait","ansi-b-portrait"]]);let x=class extends ai{constructor(e,t){super(e,t),this._activeTabFocusRequested=!1,this._awaitingServerResponse=!1,this._exportedFileNameMap={},this._selectedTab=T.layout,this._pendingExportScroll=!1,this._rootNode=null,this._selectedTemplate=null,this._formats=[],this._showTemplates=!1,this._isValidSpatialReference=!0,this.allowedFormatsForSaving=null,this.browseTemplateButtonOnClick=null,this.exportedLinks=new Lt,this.headerVisible=!0,this.headingLevel=3,this.includeOrganizationTemplates=!0,this.messagesCommon=null,this.messagesUnits=null,this.saveExportEnabled=!1,this.saveExportHidden=!0,this.saveAsButtonCallback=null,this.viewModel=new kt,this._onInput=i=>{this._selectedTab===T.layout?this.templateOptions.title=i.currentTarget.value:this._selectedTab===T.mapOnly&&(this.templateOptions.fileName=i.currentTarget.value)},this._handleLinkClick=i=>{const a=i.currentTarget["data-item"];if(!a||a.state!=="ready"||!a.url)return;const o=he(this.viewModel.effectivePrintServiceUrl),l=a.url,s=document.createElement("a");if(s.target="_blank",s.href=l,s.rel="noreferrer",s.download=a.formattedName??"",!o)return s.click(),void i.stopPropagation();i.preventDefault();const d=new URL(l);d.searchParams.set("token",o),s.href=d.href,s.click(),s.href=l},this._focusOnTabChange=this._focusOnTabChange.bind(this)}initialize(){this.addHandles([j(()=>{var a;return[this.templateOptions.format,(a=this.viewModel.templatesInfo)==null?void 0:a.format]},()=>{var l;const{templatesInfo:a}=this.viewModel;if(!a)return;if(this._formats.length!==a.format.choiceList.length){const s=se.apiValues;this._formats=a.format.choiceList.map(d=>{const u=s.find(r=>new RegExp(`\\b${r}\\b`,"i").test(d))??d;return{value:u,label:d===u?d.toUpperCase():d}}).sort((d,u)=>d.label.localeCompare(u.label))}const o=this._formats.some(({value:s})=>new RegExp(`\\b${s}\\b`,"i").test(this.templateOptions.format));if(!(!a.format.defaultValue||o)){const s=(l=this._formats.find(({value:d})=>new RegExp(`\\b${d}\\b`,"i").test(a.format.defaultValue)))==null?void 0:l.value;s&&(this.templateOptions.format=s)}}),j(()=>[this.templateOptions.id,this.viewModel.loaded],async()=>{const{layout:a}=this.templateOptions;this._selectedTab=de(a)?T.mapOnly:T.layout,this._selectedTab===T.layout&&this.viewModel.loaded&&(this._selectedTemplate=this.viewModel.getLayoutTemplateById(this.templateOptions.id))}),j(()=>this.templateOptions.dpi,a=>{a<=0&&(this.templateOptions.dpi=1)}),j(()=>{var a;return(a=this.viewModel.view)==null?void 0:a.scale},a=>{!a||this.templateOptions.scaleEnabled&&this.templateOptions.scale||(this.templateOptions.scale=a)})]);for(const{name:a,extension:o}of this.exportedLinks)a&&o&&this._updateExportedFileNameMap(`${a}${o}`);const{height:e,width:t}=this.templateOptions;this.templateOptions.width=t||800,this.templateOptions.height=e||1100;const i=setTimeout(()=>{this._awaitingServerResponse=!0,this.scheduleRender()},500);this.viewModel.load().then(()=>{clearTimeout(i),this._awaitingServerResponse=!1})}loadDependencies(){return oi({action:()=>F(()=>import("./index-DVEy4f7w.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]),import.meta.url),block:()=>F(()=>import("./index-ujykA9Eq.js"),__vite__mapDeps([25,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,26,21,20,18,17,16,27,28,29,22,30,23,31,32,0,19,24,33,34,35,36,37,38,39,40,41,42,43]),import.meta.url),button:()=>F(()=>import("./index-BtF7Kdcs.js"),__vite__mapDeps([44,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,21,20,38,45,22,46,23,24]),import.meta.url),checkbox:()=>F(()=>import("./index-B7QXL93z.js"),__vite__mapDeps([47,2,3,4,5,6,7,8,9,10,11,12,13,21,20,17,14,45,22,30,46,23]),import.meta.url),combobox:()=>F(()=>import("./index-Bb6Bx1n-.js"),__vite__mapDeps([48,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,49,50,21,20,23,22,30,24,15,19,51,52,53,54,29,28,45,46,31,55,56]),import.meta.url),"combobox-item":()=>F(()=>import("./index-GVt5zfuo.js"),__vite__mapDeps([57,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,19,20,22,56,24,58]),import.meta.url),flow:()=>F(()=>import("./index-1VSl9HgO.js"),__vite__mapDeps([59,2,3,4,5,6,7,8,9,10,11,12,13,21,20,18,23,17,14]),import.meta.url),"flow-item":()=>F(()=>import("./index-D1jScw4i.js"),__vite__mapDeps([60,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,37,28,29,31,38,39,40,41,30,42,43,26,61]),import.meta.url),icon:()=>F(()=>import("./index-73bQemcW.js").then(e=>e.i),__vite__mapDeps([16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18]),import.meta.url),input:()=>F(()=>import("./index-Wn4pOF_U.js"),__vite__mapDeps([62,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,49,63,51,20,19,21,38,45,22,30,46,23,64,24,55,15,65]),import.meta.url),"input-number":()=>F(()=>import("./index-BGRynF8w.js"),__vite__mapDeps([66,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,49,63,51,20,19,21,45,22,30,46,23,64,24,55,65,15]),import.meta.url),label:()=>F(()=>import("./index-D130RxMY.js"),__vite__mapDeps([67,2,3,4,5,6,7,8,9,10,11,12,13,46,17,14]),import.meta.url),list:()=>F(()=>import("./index-DbjTV4Hc.js"),__vite__mapDeps([68,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,26,21,20,18,17,19,16,49,63,62,51,38,45,22,30,46,23,64,24,55,65,53,54,29,69]),import.meta.url),"list-item":()=>F(()=>import("./index-d5Yy4krW.js"),__vite__mapDeps([70,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,27,21,20,28,29,22,30,23,31,32,1,15,0,19,24,33,34,35,36,69,71]),import.meta.url),loader:()=>F(()=>import("./index-CjrYEQXz.js"),__vite__mapDeps([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]),import.meta.url),switch:()=>F(()=>import("./index-Bej-0mbI.js"),__vite__mapDeps([72,2,3,4,5,6,7,8,9,10,11,12,13,21,20,17,14,45,22,30,46,23]),import.meta.url),chip:()=>F(()=>import("./index-BnH8ZLT5.js"),__vite__mapDeps([50,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,21,20,23,22,30,24,15]),import.meta.url),popover:()=>F(()=>import("./index-DIp-v4qk.js").then(e=>e.i),__vite__mapDeps([37,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,0,19,20,21,22,23,24,28,29,31,38,39,40,41,30]),import.meta.url),link:()=>F(()=>import("./index-DTztMyKP.js"),__vite__mapDeps([73,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,21,20,38,22,23]),import.meta.url)})}destroy(){this.viewModel.destroy()}get allowedFormats(){return this.viewModel.allowedFormats}set allowedFormats(e){this.viewModel.allowedFormats=e}get allowedLayouts(){return this.viewModel.allowedLayouts}set allowedLayouts(e){this.viewModel.allowedLayouts=e}get error(){return this.viewModel.error}get extraParameters(){return this.viewModel.extraParameters}set extraParameters(e){this.viewModel.extraParameters=e}get icon(){return"print"}set icon(e){this._overrideIfSome("icon",e)}get includeDefaultTemplates(){return this.viewModel.includeDefaultTemplates}set includeDefaultTemplates(e){this.viewModel.includeDefaultTemplates=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get outSpatialReference(){return this.viewModel.outSpatialReference}set outSpatialReference(e){this.viewModel.outSpatialReference=e}get portal(){return this.viewModel.portal}set portal(e){this.viewModel.portal=e}get showPrintAreaEnabled(){return this.viewModel.showPrintAreaEnabled}set showPrintAreaEnabled(e){this.viewModel.showPrintAreaEnabled=e}get printServiceUrl(){return this.viewModel.printServiceUrl}set printServiceUrl(e){this.viewModel.printServiceUrl=e}get templateCustomTextElements(){return this.viewModel.templateCustomTextElements}set templateCustomTextElements(e){this.viewModel.templateCustomTextElements=e}get templateOptions(){return this.viewModel.templateOptions}set templateOptions(e){this.viewModel.templateOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){var Ee,$e,Ce,Pe,De,Fe,Ae,Me,Ve,Ne,Re,Ue,Be,He,We,ze,Je,Ge,je,qe,Ke,Qe;const{messages:e,templateOptions:t,viewModel:i,view:a}=this,{attributionEnabled:o,author:l,copyright:s,dpi:d,format:u,height:r,layout:m,layoutItem:v,legendEnabled:y,northArrowEnabled:E,scaleBarEnabled:g,scaleEnabled:D,scale:b,width:O}=t,M=i.state!=="ready"||this._awaitingServerResponse||!(m||v),S=this._renderTitleOrFileNameSection(),I=p("div",{class:h.formSectionContainer},p("calcite-label",null,e.fileFormatTitle,p("calcite-combobox",{clearDisabled:!0,label:e.formatDefaultOption,maxItems:6,placeholder:e.formatDefaultOption,selectionMode:"single-persist",onCalciteComboboxChange:({currentTarget:R})=>{var J;this.templateOptions.format=((J=R.selectedItems[0])==null?void 0:J.value)??"pdf"}},this._formats.map(({value:R,label:J},Rt)=>p("calcite-combobox-item",{key:`file-format-${Rt}`,selected:R===this.templateOptions.format,textLabel:J,value:R}))))),k=p("calcite-label",{layout:"inline"},p("calcite-switch",{checked:this.showPrintAreaEnabled,onCalciteSwitchChange:R=>{this.showPrintAreaEnabled=!!R.currentTarget.checked}}),e.printPreview),N=p("div",null,p("div",{class:h.formSectionContainer},p("calcite-label",null,e.template,p("calcite-block",{class:h.templateSelectContainer,collapsible:!1,description:this._getPageSizeLabel(this._selectedTemplate),heading:this._getTemplateLabel(this._selectedTemplate,!0),key:"template-select-block",loading:((Ee=this._selectedTemplate)==null?void 0:Ee.state)==="loading",onclick:()=>this._showTemplates=!0,onkeydown:R=>{R.key!=="Enter"&&R.key!==" "||(this._showTemplates=!0)},tabIndex:0},p("calcite-icon",{class:h.templateSelectIcon,icon:(($e=this._selectedTemplate)!=null&&$e.layout?ct.get(this._selectedTemplate.layout):null)||"custom-print",key:"template-select-icon",scale:"l",slot:"content-start"}),((Ce=this._selectedTemplate)==null?void 0:Ce.state)==="error"?p("calcite-icon",{class:h.templateSelectError,icon:"exclamation-mark-circle",key:"template-select-error",scale:"s",slot:"actions-end"}):null,p("calcite-icon",{class:h.templateSelectArrow,icon:li()?"chevron-left":"chevron-right",key:"template-select-arrow",scale:"s",slot:"actions-end"})))),k),_=p("div",{class:h.formSectionContainer},p("calcite-label",null,e.dpi,p("calcite-input-number",{bind:this,"data-input-name":"dpi",min:1,value:`${d}`,onCalciteInputNumberInput:this._handleDPIChange}))),w=p("div",{class:h.formSectionContainer},p("calcite-label",null,p("div",{class:h.srLabel},e.outSpatialReference,p("calcite-link",{href:"https://developers.arcgis.com/rest/services-reference/enterprise/using-spatial-references/",target:"_blank"},"(WKID)")),p("calcite-input-number",{bind:this,"data-input-name":"outSpatialReference",integer:!0,numberButtonType:"none",value:((De=(Pe=i.outSpatialReference)==null?void 0:Pe.wkid)==null?void 0:De.toString())??"",onCalciteInputNumberInput:({currentTarget:R})=>{const J=Gt(R.value);i.outSpatialReference=Number.isNaN(J)||J==null?null:new ge({wkid:J}),this._isValidSpatialReference=!i.outSpatialReference||ti(i.outSpatialReference)}}),this._isValidSpatialReference?null:p("div",{class:h.invalidWkidText,key:`out-sr-${(Fe=i.outSpatialReference)==null?void 0:Fe.wkid}`},e.invalidWkid))),C=p("div",{class:this.classes(h.scaleInfoContainer,h.formSectionContainer)},p("calcite-label",{layout:"inline"},p("calcite-checkbox",{bind:this,checked:D,"data-option-name":"scaleEnabled",onCalciteCheckboxChange:this._toggleInputValue}),e.scale),p("div",{class:h.scaleInputContainer},p("calcite-input-number",{"aria-label":e.scaleLabel,"aria-valuenow":`${b}`,bind:this,class:h.scaleInput,"data-input-name":"scale",disabled:!D,value:`${b}`,onCalciteInputNumberInput:this._updateNumberInputValue}),p("calcite-button",{appearance:"outline","aria-label":e.reset,bind:this,disabled:!D,iconStart:"refresh",kind:"neutral",onclick:this._resetToCurrentScale}))),V=p("div",{"aria-labelledby":`${this.id}__advancedOptionsForLayout`,class:h.advancedOptionsContainer,key:"advanced-section-for-layout"},C,((Ve=(Me=(Ae=this._selectedTemplate)==null?void 0:Ae.layoutTemplateInfo)==null?void 0:Me.layoutOptions)==null?void 0:Ve.hasAuthorText)??1?p("div",{class:h.formSectionContainer,key:"author-info"},p("calcite-label",null,e.author,p("calcite-input",{bind:this,"data-input-name":"author",value:l??"",onCalciteInputInput:this._updateInputValue}))):null,((Ue=(Re=(Ne=this._selectedTemplate)==null?void 0:Ne.layoutTemplateInfo)==null?void 0:Re.layoutOptions)==null?void 0:Ue.hasCopyrightText)??1?p("div",{class:h.formSectionContainer,key:"copyright-text"},p("calcite-label",null,e.copyright,p("calcite-input",{bind:this,"data-input-name":"copyright",value:s??"",onCalciteInputInput:this._updateInputValue}))):null,_,w,this._renderCustomTextElementSection(),((We=(He=(Be=this._selectedTemplate)==null?void 0:Be.layoutTemplateInfo)==null?void 0:He.layoutOptions)==null?void 0:We.hasLegend)??1?p("div",{class:h.formSectionContainer,key:"legend-info"},p("calcite-label",{layout:"inline"},p("calcite-checkbox",{bind:this,checked:!!y,"data-option-name":"legendEnabled",onCalciteCheckboxChange:this._toggleInputValue}),e.legend)):null,(Je=(ze=this._selectedTemplate)==null?void 0:ze.mapSurroundInfoOptions)!=null&&Je.northArrow.length?p("div",{class:h.formSectionContainer,key:"north-arrow"},p("calcite-label",{layout:"inline"},p("calcite-checkbox",{bind:this,checked:!!E,"data-option-name":"northArrowEnabled",onCalciteCheckboxChange:this._toggleInputValue}),e.northArrow)):null,(je=(Ge=this._selectedTemplate)==null?void 0:Ge.mapSurroundInfoOptions)!=null&&je.scaleBar.length?p("div",{class:h.formSectionContainer,key:"scale-bar"},p("calcite-label",{layout:"inline"},p("calcite-checkbox",{bind:this,checked:!!g,"data-option-name":"scaleBarEnabled",onCalciteCheckboxChange:this._toggleInputValue}),e.scaleBar)):null),Q=p("div",{"aria-labelledby":`${this.id}__advancedOptionsForMapOnly`,class:h.advancedOptionsContainer},C,_,w,p("div",{class:h.formSectionContainer},p("calcite-label",{layout:"inline"},p("calcite-checkbox",{bind:this,checked:o,"data-option-name":"attributionEnabled",onCalciteCheckboxChange:this._toggleInputValue}),e.attribution)),this._renderCustomTextElementSection()),Z=this.exportedLinks.toArray(),$t=this._renderExportedLinkItems(Z),Ct={[h.exportSectionCentered]:!Z.length},Pt=this._selectedTab===T.layout?p("section",{"aria-labelledby":`${this.id}__layoutTab`,class:h.layoutSection,id:`${this.id}__layoutContent`,key:"esri-print__layoutContent",role:"tabpanel"},p("div",{class:h.panelContainer},((Qe=(Ke=(qe=this._selectedTemplate)==null?void 0:qe.layoutTemplateInfo)==null?void 0:Ke.layoutOptions)==null?void 0:Qe.hasTitleText)??1?S:null,N,this._selectedTab===T.layout?I:null,p("calcite-block",{"aria-label":e.advancedOptions,class:this.classes(h.panelContainer,h.advancedOptionsSection),collapsible:!0,disabled:!(m||v!=null&&v.id),heading:e.advancedOptions,id:"advancedOptionsForLayout",key:"advanced-options-for-layout"},V))):this._selectedTab===T.mapOnly?p("section",{"aria-labelledby":`${this.id}__mapOnlyTab`,class:h.mapOnlySection,id:`${this.id}__mapOnlyContent`,key:"esri-print__mapOnlyContent",role:"tabpanel"},p("div",{class:h.panelContainer},S,I,p("div",null,p("div",{class:this.classes(h.sizeContainer,h.formSectionContainer)},p("calcite-label",null,e.width,p("calcite-input-number",{bind:this,"data-input-name":"width",value:`${O}`,onCalciteInputNumberInput:this._updateNumberInputValue})),p("calcite-label",null,e.height,p("calcite-input-number",{bind:this,"data-input-name":"height",value:`${r}`,onCalciteInputNumberInput:this._updateNumberInputValue})),p("button",{"aria-label":e.swap,bind:this,class:this.classes(we.widgetButton,h.swapButton,Ci.swap),onclick:this._switchInput,type:"button"})),k),p("calcite-block",{"aria-label":e.advancedOptions,class:this.classes(h.panelContainer,h.advancedOptionsSection),collapsible:!0,heading:e.advancedOptions,id:"advancedOptionsForMapOnly",key:"advanced-options-for-map-only"},Q))):p("section",{"aria-labelledby":`${this.id}__exportTab`,class:this.classes(h.exportSection,Ct),id:`${this.id}__exportContent`,key:"esri-print__exportContent",role:"tabpanel"},p("div",{class:h.panelContainer},p("div",{afterUpdate:this._scrollExportIntoView,bind:this,class:h.exportedFilesContainer},Z.length===0?p("div",{class:h.exportedFilesEmpty},p("calcite-icon",{icon:"file",scale:"l"}),p("div",null,p($i,{class:h.exportedFilesTitle,level:this.headingLevel},e.noExportedFiles),p("div",null,e.exportHint))):$t))),ke=(a==null?void 0:a.type)!=="2d",Dt=p("div",{class:h.panelError},a?ke?e.sceneViewError:e.serviceError:e.noViewError),Ft=Z.some(({state:R})=>R==="pending"),At=p("div",{class:h.content,key:"panel"},p("div",null,p("ul",{bind:this,class:h.layoutTabList,onclick:this._toggleLayoutPanel,onkeydown:this._handleLayoutPanelKeyDown,role:"tablist"},p("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._selectedTab===T.layout}`,class:h.layoutTab,"data-tab-id":T.layout,id:`${this.id}__layoutTab`,role:"tab",tabIndex:0},e.layoutTab),p("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._selectedTab===T.mapOnly}`,class:h.layoutTab,"data-tab-id":T.mapOnly,id:`${this.id}__mapOnlyTab`,role:"tab",tabIndex:0},e.mapOnlyTab),p("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._selectedTab===T.export}`,class:h.layoutTab,"data-tab-id":T.export,id:`${this.id}__exportedFilesTab`,role:"tab",tabIndex:0},Ft?p("calcite-loader",{inline:!0,label:"loading",scale:"s"}):null,e.exportsTab)),Pt),this._selectedTab!==T.export?p("div",{class:this.classes(h.printButtonSection,!this.saveExportHidden&&this.portal?h.printButtonSectionDivider:null),key:"export-button-section"},!this.saveExportHidden&&this.portal?p("calcite-label",{layout:"inline"},p("calcite-checkbox",{bind:this,checked:this.saveExportEnabled,onCalciteCheckboxChange:R=>{this.saveExportEnabled=!!R.currentTarget.checked}}),e.saveExportToMyContent):null,p("calcite-button",{"aria-label":e.exportDescription,bind:this,class:this.classes(h.printButton),disabled:M||!(m||v!=null&&v.id)&&!u,onclick:this._handlePrintMap,scale:"l",width:"full"},e.export)):null),Mt=p("calcite-flow",{key:"root-flow"},p("calcite-flow-item",{bind:this,key:"root-flow-item",selected:!this._showTemplates},p("div",{class:h.printWidgetContainer},this.headerVisible?p("header",{class:h.headerTitle},e.export):null,this.error||ke||!a?Dt:At)),this._renderChooseTemplateFlowItem()),Le=i.state==="initializing",Vt=Le?this._renderLoader():Mt,Nt={[h.panelItemsCentered]:Le};return p("div",{bind:this,class:this.classes(h.base,we.widget,we.panel,Nt)},Vt)}_getPageSizeLabel(e){if(!e)return;const t=e.layoutTemplateInfo;if(!t)return;const i=Ca.fromJSON(t.pageUnits.toLowerCase());return`${Ye(t.pageSize[0])} × ${Ye(t.pageSize[1])} ${Xt(this.messagesUnits,i,"abbr")}`}_getTemplateLabel(e,t=!1){if(!e)return t?this.messages.selectTemplate:this.messages.untitled;const{label:i,layout:a,layoutItem:o,type:l}=e;if(l==="print-service-template"&&this.messages[a])return this.messages[a];const s=i??a??(o==null?void 0:o.id);return(s==null?void 0:s.replaceAll("_"," "))??this.messages.untitled}_getPortalTemplates(){const{portalTemplateIds:e}=this.viewModel;return this.includeDefaultTemplates&&this.includeOrganizationTemplates?this.viewModel.defaultTemplates.toArray().filter(({layout:t,layoutItem:i})=>!de(t)&&!!(i!=null&&i.id)&&e.includes(i.id)):[]}_getDefaultTemplates(){const{portalTemplateIds:e}=this.viewModel;return this.includeDefaultTemplates?this.viewModel.defaultTemplates.toArray().filter(({layout:t,layoutItem:i})=>!(de(t)||i!=null&&i.id&&e.includes(i.id))):[]}_getPrintServiceTemplates(){return this.includeDefaultTemplates&&this._getDefaultTemplates().length?[]:this.viewModel.printServiceTemplates.toArray().filter(({layout:e})=>!de(e))}_renderLayoutTemplates(e,t=!1,i=!1){return t&&e.sort((a,o)=>(a.label??"")>(o.label??"")?1:-1),e.map(a=>p("calcite-list-item",{description:this._getPageSizeLabel(a),key:`template-${a.id}-${a.id===this.templateOptions.id}`,label:this._getTemplateLabel(a),selected:a.id===this.templateOptions.id,title:a.description??"",value:a},p("calcite-icon",{icon:(a.layout?ct.get(a.layout):null)||"custom-print",slot:"content-start"}),a.state==="loading"?p("calcite-loader",{inline:!0,key:`template-loader-${a.id}`,label:"loading",scale:"s",slot:"content-end"}):null,(a==null?void 0:a.state)==="error"?p("calcite-icon",{class:h.templateSelectError,icon:"exclamation-mark-circle",key:`template-error-${a.id}`,scale:"s",slot:"content-end"}):null,i?p("calcite-action",{icon:"trash",onclick:()=>this.viewModel.removePortalTemplate(a),slot:"actions-end",text:"delete"}):null))}_renderChooseTemplateFlowItem(){var u;if(!this._showTemplates)return null;const{messages:e}=this,t=ht.test((u=this.portal)==null?void 0:u.url),i=this.viewModel.browseTemplates.toArray(),a=this._getPortalTemplates(),o=this._getDefaultTemplates(),l=this._getPrintServiceTemplates(),s=i.length+a.length+o.length+l.length>15,d=this.browseTemplateButtonOnClick?p("calcite-button",{appearance:"outline",class:s?h.browseTemplateButtonContainerFilter:h.browseTemplateButtonContainer,iconStart:"folder",key:"browse-template-button",onclick:this.browseTemplateButtonOnClick,slot:s?"filter-actions-end":"default"},s?null:e.browseTemplates):null;return p("calcite-flow-item",{bind:this,closable:!1,heading:e.chooseTemplate,key:"template-flow-item",selected:this._showTemplates,onCalciteFlowItemBack:r=>{r.preventDefault(),this._showTemplates=!1}},p("div",{class:h.templateSelectFlowItemContainer},p("div",{class:h.templateSelectFlowItemContent},s?null:d,p("calcite-list",{filterEnabled:s,filterProps:["label"],key:"template-list",label:e.templateList,selectionMode:"single-persist",onCalciteListChange:({currentTarget:r})=>{var m;return this.viewModel.applyTemplate((m=r.selectedItems[0])==null?void 0:m.value)}},s?d:null,i.length?p("div",{key:"my-templates"},p("div",{class:h.templateSelectFlowItemListHeading},e.myTemplates,t?p("calcite-chip",{appearance:"outline",kind:"neutral",label:e.beta,scale:"s"},e.beta):null),this._renderLayoutTemplates(i,!0,!0)):null,a.length?p("div",{key:"org-templates"},p("div",{class:h.templateSelectFlowItemListHeading},e.organizationTemplates,t?p("calcite-chip",{appearance:"outline",kind:"neutral",label:e.beta,scale:"s"},e.beta):null),this._renderLayoutTemplates(a)):null,i.length||a.length?o.length?p("div",{key:"default-templates"},p("div",{class:h.templateSelectFlowItemListHeading},e.defaultTemplates),this._renderLayoutTemplates(o,!0)):null:this._renderLayoutTemplates(o,!0),i.length||a.length?l.length?p("div",{key:"service-templates"},p("div",{class:h.templateSelectFlowItemListHeading},e.defaultTemplates),this._renderLayoutTemplates(l)):null:this._renderLayoutTemplates(l))),p("div",{class:h.templateButtonContainer},p("calcite-button",{class:h.templateDoneButton,onclick:()=>this._showTemplates=!1},this.messagesCommon.done))))}_renderCustomTextElementSection(){const{customTextElements:e}=this.templateOptions;return e?p("div",{class:h.formSectionContainer,key:"custom-text-elements"},e.map((t,i)=>{const[a,o]=Object.entries(t)[0];return a==="date"?null:p("calcite-label",{key:`custom-text-elements-${a}-${i}`},a,p("calcite-input",{bind:this,"data-input-custom":!0,"data-input-name":a,value:o??"",onCalciteInputInput:this._updateInputValue}))})):null}_renderTitleOrFileNameSection(){const{title:e,fileName:t,titlePlaceHolder:i,fileNamePlaceHolder:a}=this.messages,o=this._selectedTab===T.layout?e:t,l=this._selectedTab===T.layout?i:a,s=this._selectedTab===T.layout?this.templateOptions.title:this.templateOptions.fileName;return p("div",{class:h.formSectionContainer,key:o},p("calcite-label",null,o,p("calcite-input",{placeholder:l,value:s??"",onCalciteInputInput:this._onInput})))}_focusOnTabChange(e){if(!this._activeTabFocusRequested)return;const t=e.getAttribute("data-tab-id");(t==="layoutTab"&&this._selectedTab===T.layout||t==="mapOnlyTab"&&this._selectedTab===T.mapOnly||t==="exportTab"&&this._selectedTab===T.export)&&(e.focus(),this._activeTabFocusRequested=!1)}_renderLoader(){const e={[h.loader]:this._awaitingServerResponse};return p("div",{class:this.classes(e),key:"loader"})}_updateExportedFileNameMap(e){this._exportedFileNameMap[e]!==void 0?this._exportedFileNameMap[e]++:this._exportedFileNameMap[e]=0}_createFileLink(e,t){const i=t||this.messages.untitled,a=e.format.toLowerCase(),o=a.includes("png")?"png":a,l=i+o;return this._updateExportedFileNameMap(l),new gt({name:i,extension:o,count:this._exportedFileNameMap[l]})}_resetToCurrentScale(){var e;this.templateOptions.scale=(e=this.viewModel.view)==null?void 0:e.scale}_updateCustomTextElementValue(e,t,i){e.find(a=>{const[o]=Object.entries(a)[0];return o===t})[t]=i}_updateInputValue(e){const t=e.currentTarget,i=t.getAttribute("data-input-name"),a=!!t["data-input-custom"],{templateOptions:o}=this;a?this._updateCustomTextElementValue(o.customTextElements,i,t.value):o[i]=t.value}_updateNumberInputValue(e){const t=e.currentTarget,i=t.getAttribute("data-input-name"),{templateOptions:a}=this,o=Number(t.value);if(Ea(o))a[i]=o;else{const l=a[i];t.value=`${l}`}}_handleDPIChange(e){const{templateOptions:t}=this,i=t.dpi;this._updateNumberInputValue(e);const a=t.dpi,{height:o,width:l}=La(a,i,t.width,t.height);t.height=o,t.width=l}_handlePrintMap(){var l;this._pendingExportScroll=!0;const{templateOptions:e,saveExportEnabled:t}=this,i=this.viewModel.toPrintTemplate(e),a=this._selectedTab===T.layout?(l=i.layoutOptions)==null?void 0:l.titleText:e.fileName,o=this._createFileLink(i,a);this.exportedLinks.add(o),this.emit("submit",{link:o,saveExportEnabled:t}),this._selectedTab=T.export,this.viewModel.print(i).then(s=>{o.set({url:s&&s.url,state:"ready"})}).catch(s=>{o.set({error:s,state:"error"})}).then(()=>{this.emit("complete",{link:o,saveExportEnabled:t}),this.scheduleRender()})}_switchInput(){[this.templateOptions.width,this.templateOptions.height]=[this.templateOptions.height,this.templateOptions.width]}_scrollExportIntoView(){if(!this._pendingExportScroll)return;this._pendingExportScroll=!1;const e=this._rootNode;if(!e)return;const{clientHeight:t,scrollHeight:i}=e,a=i-t;a>0&&(e.scrollTop=a)}_toggleInputValue(e){const t=e.target,i=t.getAttribute("data-option-name");this.templateOptions[i]=t.checked,i==="scaleEnabled"&&this._resetToCurrentScale()}_renderExportedLinkItemPopover(e){const t=this.messages,i=e.formattedName??"",{state:a}=e,o=this.saveAsButtonCallback&&a!=="error"&&this._isFormatAllowedForSaving(e.extension);return a!=="pending"&&o?p("calcite-popover",{autoClose:!0,key:`${i}-popover`,label:"Popover",offsetDistance:1,overlayPositioning:"fixed",pointerDisabled:!0,referenceElement:`${i}-popover-button`,scale:"s"},p("calcite-list",{label:""},e.portalItem?p("calcite-list-item",{label:t.openItem,onCalciteListItemSelect:()=>{const l=e.portalItem;if(!l||!l.itemPageUrl)return;const s=document.createElement("a");s.target="_blank",s.href=l.itemPageUrl,s.rel="noreferrer",s.click()}},p("calcite-icon",{icon:"launch2",key:`${i}-launch-icon`,scale:"s",slot:"content-start"})):p("calcite-list-item",{label:t.saveAs,onCalciteListItemSelect:async()=>{this.saveAsButtonCallback&&(jt(()=>e.portalItem).then(l=>{l.itemPageUrl&&this.scheduleRender()}),await this.saveAsButtonCallback(e))}},p("calcite-icon",{icon:"save",key:`${i}-save-icon`,scale:"s",slot:"content-start"})),p("calcite-list-item",{label:this.messagesCommon.delete,onCalciteListItemSelect:()=>this.exportedLinks.remove(e)},p("calcite-icon",{icon:"trash",key:`${i}-delete-icon`,scale:"s",slot:"content-start"})))):null}_renderExportedLinkItemContent(e,t){const i=this.messages,{url:a,state:o}=e,l=e.formattedName??"";let s=a||null;s&&(s=Qt(s));const d=Zt(s,location.href);return p("div",{class:h.exportedFile,"data-item":e,onclick:this._handleLinkClick,slot:"content"},p("div",null,p("div",{class:h.exportedFileLinkTitle},l),p("div",{class:h.exportedFileLinkDescription},o==="pending"?i.generatingExport:t||(d?i.ready:i.linkReady))),o==="ready"?p("calcite-icon",{"aria-label":`${l}. ${i.linkReady}`,icon:d?"download-to":"launch",key:`${l}-end-icon`,scale:"s",slot:"content-end"}):null)}_renderExportedLinkItemIcon(e){const t=e.formattedName??"";return e.state==="pending"?p("calcite-loader",{class:h.exportedFileLoader,inline:!0,key:`${t}-loader`,label:this.messages.generatingExport,scale:"m",slot:"content-start"}):p("calcite-icon",{icon:$a(e),key:`${t}-start-icon`,scale:"s",slot:"content-start"})}_renderExportedLinkItemAction(e,t){const{state:i}=e,a=e.formattedName??"",o=this.saveAsButtonCallback&&i!=="error"&&this._isFormatAllowedForSaving(e.extension);return i!=="pending"?p("calcite-action",{"aria-label":`${t}`,icon:o?"ellipsis":"x",id:o?`${a}-popover-button`:void 0,key:o?`${a}-saveAs-action`:`${a}-action`,onclick:o?void 0:()=>{this.exportedLinks.remove(e)},slot:"actions-end",text:`${t}`}):null}_renderExportedLinkItem(e){const t=this.messages,{error:i,state:a}=e,o=e.formattedName??"";let l;switch(a){case"pending":l=t.pending;break;case"ready":l=t.ready;break;case"error":l=t.errorMessage}const s=a==="error"?(i==null?void 0:i.name)==="print-task:cim-symbol-unsupported"?t.exportWebMapCIMError:t.exportWebMapError:"";return p(si,null,p("calcite-list-item",{"aria-label":l,key:o,title:s},this._renderExportedLinkItemContent(e,s),this._renderExportedLinkItemIcon(e),this._renderExportedLinkItemAction(e,s)),this._renderExportedLinkItemPopover(e))}_renderExportedLinkItems(e){return p("calcite-list",{filterEnabled:(e==null?void 0:e.length)>10,label:this.messages.exportedLinksList},e.map(this._renderExportedLinkItem.bind(this)))}_isFormatAllowedForSaving(e){return!this.allowedFormatsForSaving||this.allowedFormatsForSaving==="all"||!(!e||!this.allowedFormatsForSaving.includes(e))}_toggleLayoutPanel(e){const t=e.target;this._toggleTab(t.getAttribute("data-tab-id"))}_toggleTab(e,t=!0){if(this._selectedTab=e,this._selectedTab===T.mapOnly)this.templateOptions.reset(),this.templateOptions.layout=Et;else if(this._selectedTab===T.layout){const i=this._selectedTemplate??this.viewModel.defaultTemplate;i?this.viewModel.applyTemplate(i):this.templateOptions.reset()}t&&(this._activeTabFocusRequested=!0)}_handleLayoutPanelKeyDown(e){const{key:t}=e,i=e.target.getAttribute("data-tab-id");if(ri(t))return this._toggleTab(i),e.preventDefault(),void e.stopPropagation();if(t==="ArrowLeft"||t==="ArrowRight"){switch(i){case T.layout:this._toggleTab(t==="ArrowLeft"?T.export:T.mapOnly);break;case T.mapOnly:this._toggleTab(t==="ArrowLeft"?T.layout:T.export);break;case T.export:this._toggleTab(t==="ArrowLeft"?T.mapOnly:T.layout)}e.preventDefault(),e.stopPropagation()}}};n([c()],x.prototype,"_showTemplates",void 0),n([c()],x.prototype,"_isValidSpatialReference",void 0),n([c()],x.prototype,"allowedFormats",null),n([c()],x.prototype,"allowedFormatsForSaving",void 0),n([c()],x.prototype,"allowedLayouts",null),n([c()],x.prototype,"browseTemplateButtonOnClick",void 0),n([c()],x.prototype,"error",null),n([c({type:Lt})],x.prototype,"exportedLinks",void 0),n([c()],x.prototype,"extraParameters",null),n([c()],x.prototype,"headerVisible",void 0),n([c()],x.prototype,"headingLevel",void 0),n([c()],x.prototype,"icon",null),n([c()],x.prototype,"includeDefaultTemplates",null),n([c()],x.prototype,"includeOrganizationTemplates",void 0),n([c()],x.prototype,"label",null),n([c(),ve("esri/widgets/Print/t9n/Print")],x.prototype,"messages",void 0),n([c(),ve("esri/t9n/common")],x.prototype,"messagesCommon",void 0),n([c(),ve("esri/core/t9n/Units")],x.prototype,"messagesUnits",void 0),n([c({type:ge})],x.prototype,"outSpatialReference",null),n([c()],x.prototype,"portal",null),n([c()],x.prototype,"saveExportEnabled",void 0),n([c()],x.prototype,"saveExportHidden",void 0),n([c()],x.prototype,"showPrintAreaEnabled",null),n([c()],x.prototype,"printServiceUrl",null),n([c()],x.prototype,"saveAsButtonCallback",void 0),n([c()],x.prototype,"templateCustomTextElements",null),n([c()],x.prototype,"templateOptions",null),n([c()],x.prototype,"view",null),n([c({type:kt})],x.prototype,"viewModel",void 0),x=n([q("esri.widgets.Print")],x);const Pa=x;/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
v4.32.12 */const Da=Ut`@layer{arcgis-print{display:block}}`,Fa=Pi(Pa),le=class le extends Bt{constructor(){super(...arguments),this.widget=Fa(this),this.viewModel=this.widget.viewModel,this.allowedFormats=this.widget.allowedFormats,this.allowedLayouts=this.widget.allowedLayouts,this.autoDestroyDisabled=!1,this.exportedLinks=this.widget.exportedLinks,this.extraParameters=this.widget.extraParameters,this.headingLevel=this.widget.headingLevel,this.icon=this.widget.icon,this.includeDefaultTemplatesDisabled=this.widget.includeDefaultTemplates,this.label=this.widget.label,this.portal=this.widget.portal,this.position="bottom-left",this.printServiceUrl=this.widget.printServiceUrl,this.showPrintAreaEnabled=this.widget.showPrintAreaEnabled,this.state=this.viewModel.state,this.templateCustomTextElements=this.widget.templateCustomTextElements,this.templateOptions=this.widget.templateOptions,this.arcgisComplete=Ze(()=>this.widget,"complete"),this.arcgisPropertyChange=Ht()("state"),this.arcgisReady=Wt(),this.arcgisSubmit=Ze(()=>this.widget,"submit")}async destroy(){await this.manager.destroy()}};le.properties={allowedFormats:[1,{converter:t=>typeof t=="string"&&t!=="all"?t.split(","):t}],allowedLayouts:[1,{converter:t=>typeof t=="string"&&t!=="all"?t.split(","):t}],autoDestroyDisabled:5,exportedLinks:0,extraParameters:1,headingLevel:9,icon:1,includeDefaultTemplatesDisabled:5,label:1,portal:0,position:1,printServiceUrl:1,referenceElement:1,showPrintAreaEnabled:7,state:3,templateCustomTextElements:0,templateOptions:0},le.shadowRootOptions=zt,le.styles=Da;let xe=le;Jt("arcgis-print",xe);export{xe as ArcgisPrint};
