import{L as U,c as k,n as O,s as c,d as f,x as v,e as M,a as P}from"./index-4eY77cms.js";import{n as W}from"./ref-D9wHsL_T.js";import{e as F}from"./getDefaultUnitForView-BBSnYQvp.js";import{d as G}from"./reactiveUtils-XM7cS2OP.js";import{l as V}from"./intl-Duiy0OzY.js";import{g as j,r as $,m as g,a as z}from"./Accessor-BmwT4B0c.js";import{c as y}from"./screenUtils-_ZIvrt5o.js";import{N as E,V as N,g as I,L as q,j as L,k as A,x as _}from"./Point-Cz2JYYmX.js";import{P as X}from"./Polyline-s-JzsQqo.js";import{y as Y,R as H}from"./geodesicUtils-Cvz9v8ds.js";import{M as J}from"./normalizeUtils-BTGdXlpz.js";import{e as K}from"./utils-BQBvadb7.js";import{s as Q}from"./useT9n-Dwv-EXPO.js";import{u as T}from"./useViewModel-x7-oy52B.js";import{e as B}from"./globalCss-B9-jl_gY.js";import"./directive-helpers-DaBykg1t.js";import"./Portal-CmmHxpLg.js";import"./cast-CsZslgGN.js";import"./JSONSupport-DcrLLGjL.js";import"./Promise-DfET-uns.js";import"./writer-DKgfqj4X.js";import"./Extent-g5W9hy0j.js";import"./Evented-Dw4_VOGn.js";import"./SimpleObservable-CvOkykwM.js";import"./mathUtils-Cfq9PL9W.js";import"./geodesicConstants-RQL9oKdk.js";import"./normalizeUtilsCommon-lGDszWRI.js";import"./jsonUtils-CwFG8yN4.js";import"./utils-YowqfOgk.js";import"./utils-B-dlKIhi.js";import"./index-C5b9dHRB.js";import"./component-utils-D0ciaaZ_.js";function Z(t){return F(t)}function ee(t){return t>.5?{min:.5,max:1}:t>.2?{min:.2,max:.5}:{min:.1,max:.2}}function te(t,e){switch(e){case"metric":return t>1e3?{distance:_(t,"meters","kilometers"),unit:"kilometer"}:t>1?{distance:t,unit:"meter"}:t>.01?{distance:_(t,"meters","centimeters"),unit:"centimeter"}:{distance:_(t,"meters","millimeters"),unit:"millimeter"};case"imperial":return t>1609.344?{distance:_(t,"meters","miles"),unit:"mile"}:t>.3048?{distance:_(t,"meters","feet"),unit:"foot"}:{distance:_(t,"meters","inches"),unit:"inch"}}}function ie(t){var s;const{isWebMercator:e,wkt:i,wkt2:a}=t;return e||(((s=a||i)==null?void 0:s.includes("WGS_1984_Web_Mercator"))??!1)}function x({state:{paddedViewState:t},spatialReference:e,width:i}){return e.isWrappable&&t.worldScreenWidth<i}function R(t,e){const{x:i,y:a}=t?A(e,!0):e;return[i,a]}let b=class extends j{constructor(t){super(t),this.scaleComputedFrom=y(),this.view=null}get state(){var t;return(t=this.view)!=null&&t.ready&&this.view.type==="2d"?K(this.view)&&!this.view.inGeographicLayout?"disabled":"ready":"disabled"}getScaleBarProperties(t,e){if(this.state==="disabled"||isNaN(t)||!e||!this.view)return null;const i=this._getDistanceInMeters();return i==null?null:this._getScaleBarProps(t,i,e)}_getDistanceInMeters(){const{state:t,spatialReference:e}=this.view;if(!E(e))return null;const{isGeographic:i}=e,a=ie(e);if(!i&&!a)return t.extent.width*(N(e)??1);const[s,r]=this._getScaleMeasuringPoints(),u=a||i&&!Y(e)?I.WGS84:e,p=new X({paths:[[R(a,s),R(a,r)]],spatialReference:u}),l=J(p,10);let d;try{[d]=H([l],"meters")}catch{return null}return d}_getScaleMeasuringPoints(){const t=this.view,{width:e,height:i,position:a,spatialReference:s}=t;if(x(t)){const l=q(s),{valid:d}=l;return[new L(d[0],0,s),new L(d[1],0,s)]}let r=this.scaleComputedFrom.y-a[1];r>i?r=i:r<0&&(r=0);const u=y(0,r),p=y(e,r);return[t.toMap(u),t.toMap(p)]}_getScaleBarProps(t,e,i){const a=this.view,s=t*e/(x(a)?a.state.paddedViewState.worldScreenWidth:a.width);if(s<.001)return null;const r=te(s,i),{distance:u,unit:p}=r;let l=u,d=0;for(;l>=1;)l/=10,d++;const{min:h,max:m}=ee(l),S=m/l>=l/h?h:m;return{length:t*(S/l),value:10**d*S,unit:p}}};$([g()],b.prototype,"scaleComputedFrom",void 0),$([g({readOnly:!0})],b.prototype,"state",null),$([g()],b.prototype,"view",void 0),b=$([z("esri.widgets.ScaleBar.ScaleBarViewModel")],b);const re=b;/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
v4.32.12 */function D(t=0,e=0){return{x:t,y:e}}const o="esri-scale-bar",n={base:o,labelContainer:`${o}__label-container`,rulerLabelContainer:`${o}__label-container--ruler`,lineLabelContainer:`${o}__label-container--line`,topLabelContainer:`${o}__label-container--top`,bottomLabelContainer:`${o}__label-container--bottom`,label:`${o}__label`,line:`${o}__line`,topLine:`${o}__line--top`,bottomLine:`${o}__line--bottom`,ruler:`${o}__ruler`,rulerBlock:`${o}__ruler-block`,barContainer:`${o}__bar-container`,rulerBarContainer:`${o}__bar-container--ruler`,lineBarContainer:`${o}__bar-container--line`},ae=T(re),w=class w extends U{constructor(){super(...arguments),this._defaultUnit="metric",this.messages=Q(),this._scaleComputedFrom=D(),this.viewModel=ae(this),this.autoDestroyDisabled=!1,this.barStyle="line",this.icon="actual-size",this.position="top-left",this.arcgisReady=k()}get unit(){return this._unit??this._defaultUnit}set unit(e){this._unit=e}async destroy(){await this.manager.destroy()}updated(){this._handleRootCreateOrUpdate()}loaded(){this.manager.onLifecycle(()=>G(()=>{const e=this.viewModel.view;return{defaultUnit:e?Z(e):void 0,stationary:e==null?void 0:e.stationary,center:e==null?void 0:e.center,scale:e==null?void 0:e.scale,zoom:e==null?void 0:e.zoom}},({defaultUnit:e,stationary:i})=>{this._defaultUnit=e??"metric",i&&this.requestUpdate()}))}_handleContainerRef(e){e!==void 0&&this._handleRootCreateOrUpdate()}_handleRootCreateOrUpdate(){if(!this.viewModel)return;const e=this._scaleComputedFrom,i=this.el.getBoundingClientRect(),a=i.left+window.pageXOffset,s=i.top+window.pageYOffset,r=D(a,s);(r.x!==e.x||r.y!==e.y)&&(this._scaleComputedFrom=r)}_formatDistance(e,i){return V(e,{style:"unit",unit:i,unitDisplay:"short"})}render(){const e=this.viewModel.state==="disabled",i={[B.disabled]:e};let a,s;if(!e){const{unit:r,barStyle:u}=this,p=r==="imperial"||r==="dual",l=r==="metric"||r==="dual",d=100,h=r==="dual"?"line":u;if(p){const m=this.viewModel.getScaleBarProperties(d,"imperial");m&&(s=h==="ruler"?this._renderRuler(m):this._renderLine(m,"bottom"))}if(l){const m=this.viewModel.getScaleBarProperties(d,"metric");m&&(a=h==="ruler"?this._renderRuler(m):this._renderLine(m,"top"))}}return v`<div class=${c(f(n.base,B.widget,i))} ${W(this._handleContainerRef)}>${a}${s}</div>`}_renderRuler(e){const{length:i,unit:a,value:s}=e,r=Math.round(i),u=this._formatDistance(s,a);return v`<div class=${c(f(n.barContainer,n.rulerBarContainer))}><div class=${c(n.ruler)} style=${M({width:`${r}px`})}><div class=${c(n.rulerBlock)}></div><div class=${c(n.rulerBlock)}></div><div class=${c(n.rulerBlock)}></div><div class=${c(n.rulerBlock)}></div></div><div class=${c(f(n.labelContainer,n.rulerLabelContainer))}><div class=${c(n.label)}>0</div><div class=${c(n.label)}>${u}</div></div></div>`}_renderLine(e,i){const{length:a,unit:s,value:r}=e,u=Math.round(a),p=this._formatDistance(r,s),l={[n.topLabelContainer]:i==="top",[n.bottomLabelContainer]:i==="bottom"},d=v`<div class=${c(f(n.labelContainer,n.lineLabelContainer,l))}><div class=${c(n.label)}>${p}</div></div>`,h={[n.topLine]:i==="top",[n.bottomLine]:i==="bottom"},m=v`<div class=${c(f(n.line,h))} style=${M({width:`${u}px`})}></div>`;return v`<div class=${c(f(n.barContainer,n.lineBarContainer))}>${[m,d]}</div>`}};w.properties={autoDestroyDisabled:5,barStyle:1,icon:3,label:1,messageOverrides:0,position:3,referenceElement:1,unit:1},w.shadowRootOptions=O;let C=w;P("arcgis-scale-bar",C);export{C as ArcgisScaleBar};
