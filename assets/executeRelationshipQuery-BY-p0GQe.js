import{f as d}from"./utils-6jMaHUrH.js";import{U as f}from"./assets-C43MgM-v.js";import{a5 as y}from"./Point-Cg0-ChZE.js";import{t as j}from"./query-Dw-gv3BA.js";import{d as R}from"./FeatureSet-BHEkYP03.js";import u from"./RelationshipQuery-DPPNeuLK.js";import"./subclass-BZA_h8Db.js";import"./index-Bh2oEzTI.js";import"./tslib.es6-B3Jf3DVX.js";import"./Accessor-BLX9ikPh.js";import"./cast-Bjksrh93.js";import"./writer-DNAwXnhG.js";import"./jsonMap-0cxwUWs2.js";import"./jsonUtils-CEfjT-BK.js";import"./Extent-Bf3YTe7m.js";import"./Polyline-D9YkgmM_.js";import"./mathUtils-C4_ghTv4.js";import"./normalizeUtils-EVmAQ-ak.js";import"./normalizeUtilsCommon-dT81xWiM.js";import"./geometry-D964gYQX.js";import"./utils-Bema0iXE.js";import"./pbfQueryUtils-B0fU-MiS.js";import"./pbf-BtDZ1BpD.js";import"./OptimizedGeometry-BF8iz5FO.js";import"./OptimizedFeature-6cJ-QFG5.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./queryZScale-w66xFVGx.js";import"./projection-B971H0Re.js";import"./SimpleObservable-KocWTzVy.js";import"./vec3f64-BLpZdpfb.js";import"./projectBuffer-Bs7GwaPY.js";import"./geodesicConstants-DWQLYX7F.js";import"./Graphic-DsxsIjhH.js";import"./PopupTemplate-BHMhS05j.js";import"./Clonable-D3rtuBWg.js";import"./Collection-CEdjem1-.js";import"./Evented-BHRw9x22.js";import"./shared-B3wH2qpO.js";import"./fieldUtils-tmQlKvWo.js";import"./intl-CChhNOV8.js";import"./date-DlqISzcw.js";import"./locale-C9TlLpzi.js";import"./messages-OmQvZhAg.js";import"./enumeration-Ba5njXdz.js";import"./Color-BCS62Hs5.js";import"./colorUtils-0bJDPow9.js";import"./ActionToggle-iT4slXc7.js";import"./Identifiable-B1UbsKNt.js";import"./symbols-CNimns--.js";import"./TextSymbol-D8QO_KUV.js";import"./screenUtils-_ZIvrt5o.js";import"./materialUtils-DarhapKC.js";import"./opacityUtils-C68Tlu6_.js";import"./aaBoundingBox-BE7cC1jD.js";import"./persistableUrlUtils-fa1mAujs.js";import"./collectionUtils-D_lHIu88.js";import"./Portal-C10FKnaA.js";import"./Loadable-BabW5Xcc.js";import"./Promise-B2Hu02L7.js";import"./reactiveUtils-C5zUhJQJ.js";import"./asyncUtils-CWX51uTe.js";import"./Field-ybkHhtnK.js";import"./fieldType-BuzM0UHS.js";import"./DataLayerSource-BKkswDvG.js";function F(i,o){const t=i.toJSON();return t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.orderByFields&&(t.orderByFields=t.orderByFields.join(",")),t.outFields&&!(o!=null&&o.returnCountOnly)?t.outFields.includes("*")?t.outFields="*":t.outFields=t.outFields.join(","):delete t.outFields,t.outSR&&(t.outSR=y(t.outSR)),t.dynamicDataSource&&(t.layer=JSON.stringify({source:t.dynamicDataSource}),delete t.dynamicDataSource),t}async function b(i,o,t){const e=await l(i,o,t),r=e.data,p=r.geometryType,m=r.spatialReference,n={};for(const a of r.relatedRecordGroups){const s={fields:void 0,objectIdFieldName:void 0,geometryType:p,spatialReference:m,hasZ:!!r.hasZ,hasM:!!r.hasM,features:a.relatedRecords};if(a.objectId!=null)n[a.objectId]=s;else for(const c of Object.keys(a))c!=="relatedRecords"&&(n[a[c]]=s)}return{...e,data:n}}async function h(i,o,t){const e=await l(i,o,t,{returnCountOnly:!0}),r=e.data,p={};for(const m of r.relatedRecordGroups)m.objectId!=null&&(p[m.objectId]=m.count);return{...e,data:p}}async function l(i,o,t={},e){const r=j({...i.query,f:"json",...e,...F(o,e)});return f(i.path+"/queryRelatedRecords",{...t,query:{...t.query,...r}})}async function Jt(i,o,t){o=u.from(o);const e=d(i);return b(e,o,t).then(r=>{const p=r.data,m={};return Object.keys(p).forEach(n=>m[n]=R.fromJSON(p[n])),m})}async function $t(i,o,t){o=u.from(o);const e=d(i);return h(e,o,{...t}).then(r=>r.data)}export{Jt as executeRelationshipQuery,$t as executeRelationshipQueryForCount};
