import{g as f,aA as v,G as _,r,m as i,a as g}from"./Accessor-BmwT4B0c.js";import{i as P}from"./Evented-Dw4_VOGn.js";import{P as E,d as b,C as M,v as $,A as x}from"./reactiveUtils-XM7cS2OP.js";import{h as O}from"./UpdatingHandles-CzJ4c3KT.js";import{j}from"./Point-Cz2JYYmX.js";import{j as G}from"./Polyline-s-JzsQqo.js";import{Q as R,O as A,J as V}from"./projection-CyCZAIaD.js";import{o as S}from"./MediaLayerView3D-CA8q46Z9.js";import{p as D,E as T}from"./EditGeometryOperations-CAMJU2Wn.js";import{p as z}from"./vec32-Dvg_eL9J.js";import{n as N}from"./vec3f64-BLpZdpfb.js";import{c as I}from"./projectPointToVector-BoxjK-qy.js";import{H as L,P as k}from"./VideoElement-CkBKDz6B.js";import"./SimpleObservable-CvOkykwM.js";import"./cast-CsZslgGN.js";import"./index-4eY77cms.js";import"./JSONSupport-DcrLLGjL.js";import"./writer-DKgfqj4X.js";import"./Extent-g5W9hy0j.js";import"./mathUtils-Cfq9PL9W.js";import"./projectBuffer-CQnuEMuP.js";import"./geodesicConstants-RQL9oKdk.js";import"./MediaElementView-BlY9eVB-.js";import"./mat3-CR8GKnhD.js";import"./common-DQOJ18NT.js";import"./mat3f64-BBpwCtoL.js";import"./vec2-ChnYg_BJ.js";import"./normalizeUtilsSync-12EQcOVf.js";import"./jsonUtils-CwFG8yN4.js";import"./normalizeUtilsCommon-lGDszWRI.js";import"./GridLocalOriginFactory-CngFIYNp.js";import"./vec4f64-o2zAXfmz.js";import"./Attribute-DGhdp5lO.js";import"./Material-C_-mgXN8.js";import"./VertexAttribute-Cq4MnHjR.js";import"./boundedPlane-DuGhiiFM.js";import"./sphere-Cin5efBj.js";import"./mat4-Fi6iAz29.js";import"./vec42-YcqnINSP.js";import"./plane-CpXmOyqq.js";import"./mat4f64-Dk4dwAN8.js";import"./quatf64-CCm9z-pX.js";import"./vec2f64-Dy6m9Nrb.js";import"./mathUtils-BgCEaV43.js";import"./lineSegment-v806maA5.js";import"./ViewingMode-Dodu7ZZk.js";import"./NoParameters-t-PuNrgq.js";import"./FloatArray-BQXWSSJh.js";import"./BindType-BBwFZqyN.js";import"./Matrix3PassUniform-uCCQMnlP.js";import"./Texture-BVJ22uHh.js";import"./signal-CySMLEX9.js";import"./enums-D9v74xTE.js";import"./getDataTypeBytes-BTGR5GyG.js";import"./renderState-Ci93M1-P.js";import"./basicInterfaces-CZwQPxTp.js";import"./Indices-D8XWalpO.js";import"./InterleavedLayout-_dYEAUNK.js";import"./BufferView-0osDbyWD.js";import"./types-D0PSWh4d.js";import"./triangle-B1tKFm7z.js";import"./ShaderTechniqueConfiguration-D4dZMCXS.js";import"./glsl-BH37Aalp.js";import"./lengthUtils-_77UiyVF.js";import"./opacityUtils-Dim20wpZ.js";import"./Promise-DfET-uns.js";import"./requestImageUtils-DWgRKL5q.js";import"./TextureFormat-1mYWTFa-.js";import"./RibbonLine.glsl-DwJpAQ1c.js";import"./sdfPrimitives-DBgFWIDT.js";import"./doublePrecisionUtils-B0owpBza.js";import"./floatRGBA-Cb__GiDF.js";import"./Octree-CmoRJhci.js";import"./screenUtils-_ZIvrt5o.js";import"./ShaderBuilder-BKul5qh8.js";import"./RgbaFloatEncoding.glsl-_io2eW3M.js";import"./LayerView3D-BJ3u1Cu5.js";import"./heightModelInfoUtils-D_x68P3s.js";import"./HeightModelInfo-C05IFsWs.js";import"./mat2d-D9DBP-jx.js";import"./mat2df64-CBKYtunK.js";import"./InputManager-DZ3jJnlx.js";import"./Queue-BQesTh_6.js";import"./keybindings-CTmT1RTo.js";import"./SnappingManagerPool-C7HBJ4KI.js";import"./SnappingManager-DoaI-UDx.js";import"./elevationInfoUtils-D26wVF2d.js";import"./unitConversionUtils-rg07EgOm.js";import"./RightAngleSnappingHint-BepRvd6S.js";import"./Color-VJEMvW-n.js";import"./colorUtils-Rxh2V3ai.js";import"./timeUtils-C1c_L2Fd.js";import"./projectVectorToVector-CCOy_B5J.js";import"./Query-B_2mhyL4.js";import"./enumeration-DpvDkLNI.js";import"./typeUtils-B6WBEKDM.js";import"./Field-BDG0QV_T.js";import"./fieldType-CBeoJWlv.js";import"./FullTextSearch-CBnxSwz4.js";import"./Clonable-Z-AWS-16.js";import"./TimeExtent-BO6BsF_x.js";import"./utils-BjSXFjBJ.js";import"./Version-Cd3TlGH0.js";import"./geodesicUtils-Cvz9v8ds.js";import"./geometry2dUtils-D9Oax6Qb.js";import"./viewUtils-CV6QVz7y.js";import"./OverlayCompositing.glsl-CUa8aMAb.js";import"./SceneLighting-BuSMIzqo.js";import"./RenderCamera-CDB-KFBK.js";import"./axisAngleDegrees-DdLZENJj.js";import"./quat-CP7JhygC.js";import"./weather-zOic7P_q.js";import"./BooleanBindUniform-BgD_OP8i.js";import"./Float4DrawUniform-Db0CLl_z.js";import"./RenderPlugin-CTXypYLE.js";import"./HighlightDefaults-CumzVg9-.js";import"./VertexElementDescriptor-BLyltQyJ.js";import"./VertexArrayObject-vYejmVPr.js";import"./BufferObject-BJilD_hc.js";import"./memoryEstimations-Bcyf-mHz.js";import"./NestedMap-GuqgquCN.js";import"./HUDRenderStyle-BhGvVxgm.js";import"./Scheduler-i_u8qdlN.js";import"./debugFlags-B1LM_Apo.js";import"./ImageMaterial.glsl-WwbGgv6U.js";import"./GLTextureMaterial-96UpbkjC.js";import"./DefaultBufferWriter-CqCDaNCZ.js";import"./aaBoundingBox-Dw3yBk2f.js";import"./DefaultLayouts-CBF6SkyQ.js";import"./TriangleMaterial-D-IjcYAX.js";import"./VertexColor.glsl-D3WyDYIi.js";import"./Matrix3DrawUniform-DD7AqlIc.js";import"./Matrix4PassUniform-COGIPIq4.js";import"./LayerView-DUZfYZew.js";import"./Identifiable-BHVfzH03.js";import"./layerViewUtils-Bevty3Jm.js";import"./MediaLayerView-C_j0wKSM.js";import"./imageUtils-DsXKmbqJ.js";import"./uuid-Cl5lrJ4c.js";import"./resourceExtension-DiQ4lOGT.js";import"./mediaLayerUtils-BJ-DU5EY.js";import"./Portal-CmmHxpLg.js";import"./MultiOriginJSONSupport-DbmrbwMa.js";let d=class extends f{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}constructor(t){super(t),this._updatingHandles=new O}initialize(){this.addHandles([v(this._updatingHandles),this._updatingHandles.add(()=>{const t=this.element.georeference;return(t==null?void 0:t.type)==="control-points"?t.controlPoints:null},t=>this._elementControlPointsChanged(t),E)])}_elementControlPointsChanged(t){const e=t==null?void 0:t.map(({mapPoint:n})=>n).filter(_),o=this.view.spatialReference;this._updatingHandles.addPromise(this._whenProjected(e,o,n=>{if(!n)return void this._replaceOperations(null);const{_operations:s}=this,p=new G({rings:[n.map(({x:u,y:a})=>[u,a])],spatialReference:o});if(s!=null&&s.trySetGeometry(p))return void this.onModifiedExternally();const h=this.view.state.viewingMode;this._replaceOperations(new S(D.fromGeometry(p,h),h,u=>this._operationsGeometryChanged(u)))}))}_operationsGeometryChanged(t){var u;const{element:{georeference:e},_operations:o}=this;if(!o||!e||e.type!=="control-points"||!e.controlPoints)return;const n=o.data.geometry,s=e.controlPoints.map(({mapPoint:a})=>a).filter(_);if(((u=n.rings[0])==null?void 0:u.length)!==s.length)return;const p=n.rings[0].map(([a,y])=>new j({x:a,y,spatialReference:n.spatialReference})),h=s.map(({spatialReference:a})=>a);this._updatingHandles.addPromise(this._whenProjected(p,h,a=>this._updateElementControlPoints(a,t)))}_updateElementControlPoints(t,e){var s;const{georeference:o}=this.element;if(!o||!t||o.type!=="control-points"||((s=o.controlPoints)==null?void 0:s.length)!==(t==null?void 0:t.length))return;const n=o.controlPoints;if((n==null?void 0:n.length)===t.length)for(let p=0;p<n.length;p++)e&&(n[p].sourcePoint=o.toSource(t[p])),n[p].mapPoint=t[p]}async _whenProjected(t,e,o){if(!t)return void o(t);const{_operations:n,element:{georeference:s}}=this,p=t.map(({spatialReference:a})=>a),h=Array.isArray(e)?e:new Array(p.length).fill(e);await R(Array.from(p).map((a,y)=>({source:a,dest:h[y]})));const u=t.map((a,y)=>A(a,h[y]));n===this._operations&&s===this.element.georeference&&o(u)}_replaceOperations(t){this._operations&&(this.removeHandles(this._operations),this._operations.destroy()),this._operations=t}};r([i({constructOnly:!0})],d.prototype,"view",void 0),r([i({constructOnly:!0})],d.prototype,"layer",void 0),r([i({constructOnly:!0})],d.prototype,"element",void 0),r([i({constructOnly:!0})],d.prototype,"onModifiedExternally",void 0),r([i()],d.prototype,"_operations",void 0),r([i()],d.prototype,"operations",null),r([i()],d.prototype,"updating",null),d=r([g("esri.views.3d.interactive.editingTools.media.MediaElementControllerControlPoints")],d);let c=class extends f{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}constructor(t){super(t),this._updatingHandles=new O}initialize(){this.addHandles([v(this._updatingHandles),this._updatingHandles.add(()=>{var t;return(t=this.element.georeference)==null?void 0:t.coords},t=>this._elementCoordinatesChanged(t),E)])}_elementCoordinatesChanged(t){this._updatedElementCoordinates!==t&&this._updatingHandles.addPromise(this._whenProjected(t,this.view.spatialReference,e=>{if(!e)return void this._replaceOperations(null);const{_operations:o}=this;o!=null&&o.trySetGeometry(e)?this.onModifiedExternally():this._replaceOperations(T.fromGeometry(e,this.view.state.viewingMode))}))}_operationsGeometryChanged(){const{element:{georeference:t},_operations:e}=this;if(!e||!t)return;const o=e.data.geometry;if(!t.coords)return void this._updateElementCoordinates(o);const n=t.coords.spatialReference;this._updatingHandles.addPromise(this._whenProjected(o,n,s=>this._updateElementCoordinates(s)))}_updateElementCoordinates(t){const{georeference:e}=this.element;e&&(e.coords=t,this._updatedElementCoordinates=e.coords)}async _whenProjected(t,e,o){if(!t)return void o(t);const{_operations:n,element:{georeference:s}}=this,p=await V(t,e);n===this._operations&&s===this.element.georeference&&o(p)}_replaceOperations(t){this._operations&&(this.removeHandles(this._operations),this._operations.destroy()),this._operations=t,t&&this.addHandles(t.data.on("change",()=>this._operationsGeometryChanged()),t),this.onModifiedExternally()}};r([i({constructOnly:!0})],c.prototype,"view",void 0),r([i({constructOnly:!0})],c.prototype,"layer",void 0),r([i({constructOnly:!0})],c.prototype,"element",void 0),r([i({constructOnly:!0})],c.prototype,"onModifiedExternally",void 0),r([i()],c.prototype,"_operations",void 0),r([i()],c.prototype,"operations",null),r([i()],c.prototype,"updating",null),c=r([g("esri.views.3d.interactive.editingTools.media.MediaElementControllerShape")],c);function F(t,e,o){return H(t.allLayerViews.find(n=>n.layer===e),o)}function H(t,e){if(!t||t.type!=="media-3d"||t.suspended)return!1;const o=t.layer.source;return!!o&&(o instanceof L||o instanceof k?o===e:"hasElement"in o&&o.hasElement(e))}let l=class extends f{grabbableForEvent(){return!0}constructor(t){super(t),this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.grabbing=!1,this.dragging=!1,this.hovering=!0,this.selected=!1,this.cursor=null,this.consumesClicks=!0,this.events=new P.EventEmitter,this.addHandles(b(()=>this.selected,e=>this.events.emit("select-changed",{action:e?"select":"deselect"}),M))}destroy(){this._set("view",null)}intersectionDistance(t){const{view:e,layer:o,element:n}=this;if(!F(e,o,n))return null;const s=e.toMap(t,{include:{layer:o,element:n}});return s&&I(s,w,e.renderSpatialReference)?z(w,e.state.camera.eye):null}onElevationChange(){}onViewChange(){}};r([i({constructOnly:!0,nonNullable:!0})],l.prototype,"element",void 0),r([i({constructOnly:!0,nonNullable:!0})],l.prototype,"layer",void 0),r([i({constructOnly:!0,nonNullable:!0})],l.prototype,"view",void 0),r([i()],l.prototype,"interactive",void 0),r([i()],l.prototype,"selectable",void 0),r([i()],l.prototype,"grabbable",void 0),r([i()],l.prototype,"grabbing",void 0),r([i()],l.prototype,"dragging",void 0),r([i()],l.prototype,"hovering",void 0),r([i()],l.prototype,"selected",void 0),r([i()],l.prototype,"cursor",void 0),l=r([g("esri.views.3d.interactive.editingTools.media.MediaElementManipulator3D")],l);const w=N(),C=Symbol();let m=class extends P.EventedAccessor{get operations(){var t;return(t=this._controller)==null?void 0:t.operations}get elevationInfo(){return{mode:"on-the-ground",offset:0}}get _layerView(){const t=this.view.allLayerViews.find(e=>e.layer===this.layer);return(t==null?void 0:t.type)==="media-3d"?t:null}get visible(){return H(this._layerView,this.element)}get isDraped(){return!0}get origin(){return null}get updating(){var t;return!!((t=this._controller)!=null&&t.updating)}get _controllerClass(){var t;return this.tool==="transform"||((t=this.element.georeference)==null?void 0:t.type)!=="control-points"?c:d}constructor(t){super(t),this.tool="transform"}initialize(){this.addHandles([b(()=>this._controllerClass,t=>this._updateController(t),x),$(()=>this._layerView,"element-render-changed",({element:t})=>{this.element===t&&this.emit("committed")})])}toMap(t){const{layer:e,element:o}=this;return this.view.toMap(t,{include:{layer:e,element:o}})}createManipulator(t){const{view:e,layer:o,element:n}=this;return new l({view:e,layer:o,element:n,...t})}_updateController(t){if(this._controller&&this._controller instanceof t)return;this.removeHandles(C);const{view:e,layer:o,element:n}=this,s=()=>{this.emit("modified-externally")};this._controller=new t({view:e,layer:o,element:n,onModifiedExternally:s}),s(),this.addHandles(v(this._controller),C)}};r([i({constructOnly:!0})],m.prototype,"view",void 0),r([i({constructOnly:!0})],m.prototype,"layer",void 0),r([i({constructOnly:!0})],m.prototype,"element",void 0),r([i()],m.prototype,"tool",void 0),r([i()],m.prototype,"_controller",void 0),r([i()],m.prototype,"elevationInfo",null),r([i()],m.prototype,"_layerView",null),r([i()],m.prototype,"visible",null),r([i()],m.prototype,"updating",null),r([i()],m.prototype,"_controllerClass",null),m=r([g("esri.views.3d.interactive.editingTools.ManipulatedObject3DMediaElement")],m);export{m as ManipulatedObject3DMediaElement};
