import{r as e,m as i,a as h,c as x,bA as U,bB as M,B as W}from"./Accessor-BHnuXKD2.js";import{S as g}from"./JSONSupport-CGdeqxpk.js";import{a as V,S as L,O as q}from"./cast-BA_-jlhc.js";import{o as p,r as I}from"./writer-B2bQV2uU.js";import{i as _,W as k,x as Q,G,h as Z,m as J,u as X,s as K}from"./formUtils-DXUHP5lI.js";import{_ as Y,Z as B,a5 as H,X as ee}from"./opacityUtils-CSd4XoR2.js";import{V as A}from"./reactiveUtils-BR0C1Kq4.js";import{a as te}from"./layerContainerType-C5CzMsLd.js";import{w as ie}from"./Extent-CBBGeHb-.js";import{v as re}from"./HeightModelInfo-B3GZyQFz.js";import{au as oe,av as se,g as C}from"./Point-XGrwlf63.js";import{c as ne,v as le,j as pe,y as ae}from"./commonProperties-C0eC30J9.js";import{a as b}from"./Clonable-DvJsj5LF.js";import{a as O}from"./timeZoneUtils-COos5xIr.js";import{j as de,X as R,r as ue,i as S,M as ye,k as ce,z as me}from"./featureLayerUtils-BzWCGee1.js";import{p as he}from"./LayerFloorInfo-BXAHB-yQ.js";import{p as fe}from"./Relationship-BBBusoKs.js";import{c as ve}from"./serviceCapabilitiesUtils-BuKg0yWx.js";import{i as ge}from"./Field-Cyk7Ur5d.js";var D;let f=D=class extends g{constructor(s){super(s),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new D({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};e([i({type:String,json:{write:!0}})],f.prototype,"expression",void 0),e([i({type:String,json:{write:!0}})],f.prototype,"name",void 0),e([i({type:["boolean","date","number","string"],json:{write:!0}})],f.prototype,"returnType",void 0),e([i({type:String,json:{write:!0}})],f.prototype,"title",void 0),f=D=e([h("esri.form.ExpressionInfo")],f);const Fe=f;var T;let d=T=class extends _{constructor(s){super(s),this.elements=null,this.initialState="expanded",this.type="group"}castElements(s){return k(s,w,!1)}readElements(s,t){return Q(t.formElements,w,!1)}writeElements(s,t){t.formElements=G(s,w,!1)}clone(){return new T({description:this.description,elements:x(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};e([i({json:{write:!0}})],d.prototype,"elements",void 0),e([V("elements")],d.prototype,"castElements",null),e([p("elements",["formElements"])],d.prototype,"readElements",null),e([I("elements")],d.prototype,"writeElements",null),e([i({type:["collapsed","expanded"],json:{write:!0}})],d.prototype,"initialState",void 0),e([i({type:String,json:{read:!1,write:!0}})],d.prototype,"type",void 0),d=T=e([h("esri.form.elements.GroupElement")],d);const w=Z(d),xe=d;var $;const j=Z(xe);let a=$=class extends g{constructor(s){super(s),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(s){return k(s,j)}readElements(s,t){return Q(t.formElements,j)}writeElements(s,t){t.formElements=G(s,j)}clone(){return new $({description:this.description,expressionInfos:x(this.expressionInfos),elements:x(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}async getFieldsUsed(s,t){const r=new Set,{description:o,elements:n,expressionInfos:l,title:m}=this;if(F(r,s,o),F(r,s,m),!n)return[];const z=Ie(n,l).map(E=>Y(r,s,E));await Promise.all(z);for(const E of n)N(r,{fieldsIndex:s,relationships:t},E);return Array.from(r).sort()}};function N(s,t,r){var n;const{fieldsIndex:o}=t;if(!o||o.fields.length!==s.size)switch(F(s,o,r.label),F(s,o,r.description),r.type){case"field":B(s,o,r.fieldName);break;case"group":r.elements.forEach(l=>N(s,t,l));break;case"relationship":if(t.relationships){const l=t.relationships.find(m=>m.id===r.relationshipId);l&&B(s,o,l.keyField)}H(s,o,(n=r.orderByFields)==null?void 0:n.map(l=>l.field));break;case"text":F(s,o,r.text)}}function Ie(s,t){if(!t||t.length===0)return[];const r=P(s),o=[];for(const n of t)r.has(n.name)&&o.push(n.expression);return o}function P(s){const t=new Set;for(const r of s)if(U(t,r.visibilityExpression),!J(r)){if(X(r))M(t,P(r.elements));else if(U(t,r.editableExpression),K(r)){const{requiredExpression:o,valueExpression:n}=r;M(t,[o,n])}}return t}function F(s,t,r){H(s,t,ee(r))}e([i({type:String,json:{write:!0}})],a.prototype,"description",void 0),e([i({json:{write:!0}})],a.prototype,"elements",void 0),e([V("elements")],a.prototype,"castElements",null),e([p("elements",["formElements"])],a.prototype,"readElements",null),e([I("elements")],a.prototype,"writeElements",null),e([i({type:[Fe],json:{write:!0}})],a.prototype,"expressionInfos",void 0),e([i({type:Boolean,json:{default:!1,write:!0}})],a.prototype,"preserveFieldValuesWhenHidden",void 0),e([i({type:String,json:{write:!0}})],a.prototype,"title",void 0),a=$=e([h("esri.form.FormTemplate")],a);const Pe=a;let y=class extends b.ClonableMixin(g){constructor(t){super(t),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.timeZone=null}};e([i()],y.prototype,"creatorField",void 0),e([i()],y.prototype,"creationDateField",void 0),e([i()],y.prototype,"editorField",void 0),e([i()],y.prototype,"editDateField",void 0),e([i()],y.prototype,"realm",void 0),e([i(O("dateFieldsTimeReference",!0))],y.prototype,"timeZone",void 0),y=e([h("esri.layers.support.EditFieldsInfo")],y);const be=y;let u=class extends b.ClonableMixin(g){constructor(s){super(s)}};e([i({constructOnly:!0,json:{write:!0}})],u.prototype,"name",void 0),e([i({constructOnly:!0,json:{write:!0}})],u.prototype,"fields",void 0),e([i({constructOnly:!0,json:{write:!0}})],u.prototype,"isAscending",void 0),e([i({constructOnly:!0,json:{write:!0}})],u.prototype,"indexType",void 0),e([i({constructOnly:!0,json:{write:!0}})],u.prototype,"isUnique",void 0),e([i({constructOnly:!0,json:{write:!0}})],u.prototype,"description",void 0),u=e([h("esri.layers.support.FeatureIndex")],u);let v=class extends b.ClonableMixin(g){constructor(t){super(t),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};e([i({type:String,json:{read:{source:"shapeAreaFieldName"}}})],v.prototype,"shapeAreaField",void 0),e([i({type:String,json:{read:{source:"shapeLengthFieldName"}}})],v.prototype,"shapeLengthField",void 0),e([i({type:String,json:{read:s=>oe.read(s)||se.read(s)}})],v.prototype,"units",void 0),v=e([h("esri.layers.support.GeometryFieldsInfo")],v);const Ee=v;let c=class extends b.ClonableMixin(g){constructor(s){super(s),this.code=null,this.defaultValues={},this.domains=null,this.name=null}readDomains(s){if(!s)return null;const t={};for(const r of Object.keys(s))t[r]=ge(s[r]);return t}writeDomains(s,t){var o;if(!s)return;const r={};for(const n of Object.keys(s))s[n]&&(r[n]=(o=s[n])==null?void 0:o.toJSON());t.domains=r}};e([i({type:Number,json:{write:!0}})],c.prototype,"code",void 0),e([i({type:Object,json:{write:!0}})],c.prototype,"defaultValues",void 0),e([i({json:{write:!0}})],c.prototype,"domains",void 0),e([p("domains")],c.prototype,"readDomains",null),e([I("domains")],c.prototype,"writeDomains",null),e([i({type:String,json:{write:!0}})],c.prototype,"name",void 0),c=e([h("esri.layers.support.Subtype")],c);const Se=c,Le=s=>{let t=class extends s{constructor(){super(...arguments),this.copyright=null,this.capabilities=null,this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.definitionExpression=null,this.displayField=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.fieldsIndex=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.globalIdField=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.indexes=new(A.ofType(u)),this.isTable=!1,this.layerId=void 0,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.preferredTimeZone=null,this.relationships=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.sourceJSON=null,this.spatialReference=C.WGS84,this.subtypeField=null,this.subtypes=null,this.trackIdField=null,this.version=void 0}getFieldDomain(){throw new Error("Not implemented")}getField(r){return this.fieldsIndex.get(r)}get authenticationTriggerEvent(){if(!this.url)return null;const{capabilities:r}=this;if(r){const{query:n,operations:l,editing:m}=r;if(!n.supportsQueryByOthers||!n.supportsQueryByAnonymous||l.supportsEditing&&!(m.supportsUpdateByOthers&&m.supportsUpdateByAnonymous&&m.supportsDeleteByOthers&&m.supportsDeleteByAnonymous))return"load"}if(R(this.serviceDefinitionExpression)||R(this.definitionExpression))return"load";if(this.userHasUpdateItemPrivileges){if(ue(this))return"load";if(this.hasUpdateItemRestrictions)return r.operations.supportsQuery?"editing":"load"}if(this.userHasFullEditingPrivileges&&this.hasFullEditingRestrictions)return"editing";const o=this.editFieldsInfo;return(o!=null&&o.creatorField||o!=null&&o.editorField)&&(r!=null&&r.operations.supportsEditing)?"editing":null}readCapabilitiesFromService(r,o){return ve(o,this.url)}readEditingInfo(r,o){const{editingInfo:n}=o;return n?{lastEditDate:n.lastEditDate!=null?new Date(n.lastEditDate):null}:null}get effectiveCapabilities(){const r=this.capabilities;if(!r)return null;const o=x(r),{operations:n,editing:l}=o;return S(this)?(this.userHasUpdateItemPrivileges&&(n.supportsQuery=!0),o):this.userHasUpdateItemPrivileges?(n.supportsAdd=n.supportsDelete=n.supportsEditing=n.supportsQuery=n.supportsUpdate=l.supportsDeleteByOthers=l.supportsGeometryUpdate=l.supportsUpdateByOthers=!0,o):(this.userHasFullEditingPrivileges&&n.supportsEditing&&(n.supportsAdd=n.supportsDelete=n.supportsUpdate=l.supportsGeometryUpdate=!0),o)}get effectiveEditingEnabled(){return!1}readGlobalIdFieldFromService(r,o){return ye(o)}get hasFullEditingRestrictions(){const r=this.capabilities;if(!r||S(this))return!1;const{operations:o,editing:n}=r;return o.supportsEditing&&!(o.supportsAdd&&o.supportsDelete&&o.supportsUpdate&&n.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){const r=this.capabilities;if(!r)return!1;const{operations:o,editing:n}=r;return S(this)?!o.supportsQuery:!(o.supportsAdd&&o.supportsDelete&&o.supportsEditing&&o.supportsQuery&&o.supportsUpdate&&n.supportsDeleteByOthers&&n.supportsGeometryUpdate&&n.supportsUpdateByOthers)}readIsTableFromService(r,o){return o.type==="Table"}readMaxScale(r,o){return o.effectiveMaxScale||r||0}readMinScale(r,o){return o.effectiveMinScale||r||0}readObjectIdFieldFromService(r,o){return ce(o)}readServiceDefinitionExpression(r,o){return o.definitionQuery||o.definitionExpression}set url(r){if(r==null)return void this._set("url",r);const o=L({layer:this,url:r,nonStandardUrlAllowed:!0,logger:W.getLogger(this)});this._set("url",o.url),o.layerId!=null&&this._set("layerId",o.layerId)}writeUrl(r,o,n,l){q(this,r,null,o,l)}readVersion(r,o){return me(o)}};return e([i({readOnly:!0})],t.prototype,"authenticationTriggerEvent",null),e([i({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],t.prototype,"copyright",void 0),e([i({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","isDataBranchVersioned","isDataVersioned","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],t.prototype,"capabilities",void 0),e([p("service","capabilities")],t.prototype,"readCapabilitiesFromService",null),e([i(O("dateFieldsTimeReference"))],t.prototype,"dateFieldsTimeZone",void 0),e([i({type:Boolean})],t.prototype,"datesInUnknownTimezone",void 0),e([i({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],t.prototype,"definitionExpression",void 0),e([i({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],t.prototype,"displayField",void 0),e([i({readOnly:!0,type:be})],t.prototype,"editFieldsInfo",void 0),e([i({readOnly:!0})],t.prototype,"editingInfo",void 0),e([p("editingInfo")],t.prototype,"readEditingInfo",null),e([i({readOnly:!0})],t.prototype,"effectiveCapabilities",null),e([i()],t.prototype,"effectiveEditingEnabled",null),e([i((()=>{const r=x(ne),o=r.json.origins;return o["web-map"]={read:!1,write:!1},o["portal-item"]={read:!1,write:!1},r})())],t.prototype,"elevationInfo",void 0),e([i()],t.prototype,"fieldsIndex",void 0),e([i({type:he,json:{name:"layerDefinition.floorInfo",write:{layerContainerTypes:te}}})],t.prototype,"floorInfo",void 0),e([i({type:ie,json:{origins:{service:{read:{source:"extent"}}}}})],t.prototype,"fullExtent",void 0),e([i()],t.prototype,"gdbVersion",void 0),e([i({readOnly:!0,type:Ee,json:{read:{source:"geometryProperties"}}})],t.prototype,"geometryFieldsInfo",void 0),e([i({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:de.read}}}})],t.prototype,"geometryType",void 0),e([i({type:String})],t.prototype,"globalIdField",void 0),e([p("service","globalIdField",["globalIdField","fields"])],t.prototype,"readGlobalIdFieldFromService",null),e([i({readOnly:!0})],t.prototype,"hasFullEditingRestrictions",null),e([i({type:Boolean,json:{origins:{service:{read:!0}}}})],t.prototype,"hasM",void 0),e([i({readOnly:!0})],t.prototype,"hasUpdateItemRestrictions",null),e([i({type:Boolean,json:{origins:{service:{read:!0}}}})],t.prototype,"hasZ",void 0),e([i({readOnly:!0,type:re})],t.prototype,"heightModelInfo",void 0),e([i({type:Date})],t.prototype,"historicMoment",void 0),e([i({type:A.ofType(u),readOnly:!0})],t.prototype,"indexes",void 0),e([i({readOnly:!0})],t.prototype,"isTable",void 0),e([p("service","isTable",["type"])],t.prototype,"readIsTableFromService",null),e([i({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],t.prototype,"layerId",void 0),e([i(le)],t.prototype,"maxScale",void 0),e([p("service","maxScale",["maxScale","effectiveMaxScale"])],t.prototype,"readMaxScale",null),e([i(pe)],t.prototype,"minScale",void 0),e([p("service","minScale",["minScale","effectiveMinScale"])],t.prototype,"readMinScale",null),e([i({type:String})],t.prototype,"objectIdField",void 0),e([p("service","objectIdField",["objectIdField","fields"])],t.prototype,"readObjectIdFieldFromService",null),e([i(O("preferredTimeReference"))],t.prototype,"preferredTimeZone",void 0),e([i({type:[fe],readOnly:!0})],t.prototype,"relationships",void 0),e([i({type:Boolean})],t.prototype,"returnM",void 0),e([i({type:Boolean})],t.prototype,"returnZ",void 0),e([i({readOnly:!0,json:{write:!1}})],t.prototype,"serverGens",void 0),e([i({readOnly:!0})],t.prototype,"serviceDefinitionExpression",void 0),e([p("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],t.prototype,"readServiceDefinitionExpression",null),e([i({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],t.prototype,"serviceItemId",void 0),e([i()],t.prototype,"sourceJSON",void 0),e([i({type:C,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],t.prototype,"spatialReference",void 0),e([i({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],t.prototype,"subtypeField",void 0),e([i({type:[Se],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],t.prototype,"subtypes",void 0),e([i({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],t.prototype,"trackIdField",void 0),e([i(ae)],t.prototype,"url",null),e([I("url")],t.prototype,"writeUrl",null),e([i({json:{origins:{service:{read:!0}},read:!1}})],t.prototype,"version",void 0),e([p("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],t.prototype,"readVersion",null),t=e([h("esri.layers.mixins.FeatureLayerBase")],t),t};export{Le as R,Pe as V,Se as c};
