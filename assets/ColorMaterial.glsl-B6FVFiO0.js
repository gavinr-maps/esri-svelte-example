import{s as b}from"./vec4f64-o2zAXfmz.js";import{H as S}from"./InterleavedLayout-_dYEAUNK.js";import{n as g,u as T,l as d,S as v,k as I,c as E}from"./Matrix3PassUniform-uCCQMnlP.js";import{e as m}from"./basicInterfaces-CZwQPxTp.js";import{g as D,x as N,y as w,G as R,H as x,u as L,c as M,z as F,m as V,t as q,C as _,_ as U,$ as j,a0 as B,a1 as H,D as z,J as W,a2 as G,K as J,E as Q,q as k,F as K,A as l,a3 as Y,r as X,ab as Z,e as ee}from"./FloatArray-BQXWSSJh.js";import{e as p}from"./VertexAttribute-Cq4MnHjR.js";import{f as te}from"./DefaultBufferWriter-CqCDaNCZ.js";import{e as re}from"./TriangleMaterial-D-IjcYAX.js";import{_ as se}from"./index-4eY77cms.js";import"./Material-C_-mgXN8.js";import{f as ie}from"./enums-D9v74xTE.js";import{B as oe,g as ae,f as ne}from"./renderState-Ci93M1-P.js";import{r as i}from"./Accessor-BmwT4B0c.js";import{i as o}from"./ShaderTechniqueConfiguration-D4dZMCXS.js";import"./mat3f64-BBpwCtoL.js";import"./mat4f64-Dk4dwAN8.js";import"./vec3f64-BLpZdpfb.js";import{n as O}from"./glsl-BH37Aalp.js";import"./BindType-BBwFZqyN.js";import"./vec2-ChnYg_BJ.js";import"./vec2f64-Dy6m9Nrb.js";import"./mat4-Fi6iAz29.js";import"./vec32-Dvg_eL9J.js";import{i as le}from"./ShaderBuilder-BKul5qh8.js";import{o as pe,e as ue}from"./VertexColor.glsl-D3WyDYIi.js";function A(r){const e=new le,{vertex:t,fragment:a,attributes:n,varyings:u}=e,{vvColor:c,hasVertexColors:h}=r;return D(t,r),e.include(pe,r),e.include(ue,r),e.include(N,r),e.include(w,r),a.include(R,r),e.include(x,r),e.include(L,r),n.add(p.POSITION,"vec3"),c&&n.add(p.COLORFEATUREATTRIBUTE,"float"),h||u.add("vColor","vec4"),u.add("vpos","vec3"),t.uniforms.add(new M("uColor",f=>f.color)),t.main.add(O`
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${h?"vColor *= uColor;":c?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
      gl_Position = transformPosition(proj, view, vpos);`),a.include(F),a.main.add(O`discardBySlice(vpos);
discardByTerrainDepth();
outputColorHighlightOID(vColor, vpos);`),e}const ce=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}));class he extends V{constructor(e,t){super(e,t,new q(ce,()=>se(()=>Promise.resolve().then(()=>ve),void 0,import.meta.url)))}_createPipeline(e,t){const{oitPass:a,output:n,transparent:u,cullFace:c,draped:h,hasOccludees:f,polygonOffset:P,enableOffset:$}=e,C=a===_.NONE,y=a===_.FrontFace;return oe({blending:T(n)&&u?J(a):null,culling:ne(c),depthTest:h?null:{func:G(a)},depthWrite:W(e),drawBuffers:n===g.Depth?{buffers:[ie.NONE]}:z(a,n),colorWrite:ae,stencilWrite:f?H:null,stencilTest:f?t?j:B:null,polygonOffset:C||y?P?fe:null:U($)})}initializePipeline(e){return this._occludeePipelineState=this._createPipeline(e,!0),this._createPipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}const fe={factor:1,units:1};class s extends Q{constructor(){super(...arguments),this.cullFace=m.None,this.hasVertexColors=!1,this.transparent=!1,this.discardInvisibleFragments=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1,this.textureCoordinateType=k.None,this.emissionSource=K.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.vvSize=!1,this.vvOpacity=!1}}i([o({count:m.COUNT})],s.prototype,"cullFace",void 0),i([o()],s.prototype,"hasVertexColors",void 0),i([o()],s.prototype,"transparent",void 0),i([o()],s.prototype,"discardInvisibleFragments",void 0),i([o()],s.prototype,"polygonOffset",void 0),i([o()],s.prototype,"enableOffset",void 0),i([o()],s.prototype,"writeDepth",void 0),i([o()],s.prototype,"hasOccludees",void 0),i([o()],s.prototype,"terrainDepthTest",void 0),i([o()],s.prototype,"cullAboveTerrain",void 0),i([o()],s.prototype,"objectAndLayerIdColorInstanced",void 0),i([o()],s.prototype,"vvColor",void 0),i([o()],s.prototype,"draped",void 0);class Be extends re{constructor(e){super(e,me),this._configuration=new s,this.supportsEdges=!0,this.produces=new Map([[l.OPAQUE_MATERIAL,t=>this._isOpaqueMaterialPass(t)],[l.OPAQUE_MATERIAL_WITHOUT_NORMALS,t=>this._isOpaqueNoSSAODepthPass(t)],[l.TRANSPARENT_MATERIAL,t=>d(t)&&this._transparent&&this.parameters.writeDepth],[l.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,t=>v(t)&&this._transparent&&this.parameters.writeDepth],[l.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,t=>d(t)&&this._transparent&&!this.parameters.writeDepth],[l.DRAPED_MATERIAL,t=>I(t)]])}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._transparent,this._configuration.discardInvisibleFragments=this._transparent&&!this._isOpaquePass(e)&&this.parameters.discardInvisibleFragments,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<Y,this._configuration.terrainDepthTest=t.terrainDepthTest&&T(e),this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}get visible(){return this.parameters.color[3]>=X}get _transparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}_isOpaquePass(e){return this._isOpaqueMaterialPass(e)||this._isOpaqueNoSSAODepthPass(e)}_isOpaqueMaterialPass(e){return e===g.Highlight||d(e)&&!this._transparent}_isOpaqueNoSSAODepthPass(e){return v(e)&&this.parameters.writeDepth&&!this._transparent}createGLMaterial(e){return new de(e)}createBufferWriter(){const e=S().vec3f(p.POSITION);return E()&&e.vec4u8(p.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(p.COLORFEATUREATTRIBUTE):e.vec4u8(p.COLOR),new te(e)}}class de extends ee{beginSlot(e){return this.getTechnique(he,e)}}class me extends Z{constructor(){super(...arguments),this.color=b,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=m.None,this.draped=!1,this.discardInvisibleFragments=!1}}const ve=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}));export{Be as A};
