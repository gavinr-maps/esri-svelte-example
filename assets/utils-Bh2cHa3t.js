import"./geometry-D964gYQX.js";import"./subclass-BZA_h8Db.js";import{u as C}from"./screenUtils-_ZIvrt5o.js";import{r as E}from"./timeUtils-8fb_2oAt.js";import{a0 as G,d as z,j as O,g as V}from"./Point-Cg0-ChZE.js";import{j as A}from"./quantizationUtils-uj_P09aO.js";import{b as D,i as L}from"./fieldUtils-tmQlKvWo.js";import{l as P,u as R}from"./heatmapUtils-Dwiv9IEa.js";import{$ as U}from"./utils-BwQ00KBJ.js";import{m as T,B as Y}from"./utils-rwwdQ1Ui.js";let c=null;const _=/^(?<hh>([0-1][0-9])|([2][0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?([.](?<ms>\d+))?$/;function B(t,e,a){return t.x<0?t.x+=e:t.x>a&&(t.x-=e),t}function te(t,e,a,i){const o=G(a)?z(a):null,m=o?Math.round((o.valid[1]-o.valid[0])/e.scale[0]):null;return t.map(s=>{const n=new O(s.geometry);return A(e,n,n),s.geometry=o?B(n,m??0,i[0]):n,s})}function re(t,e=18,a,i,o){const m=new Float64Array(i*o);e=Math.round(C(e));let s=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;const g=R(a);for(const{geometry:d,attributes:N}of t){const{x,y:u}=d,b=Math.max(0,x-e),M=Math.max(0,u-e),F=Math.min(o,u+e),w=Math.min(i,x+e),$=+g(N);for(let f=M;f<F;f++)for(let p=b;p<w;p++){const y=f*i+p,I=P(p-x,f-u,e)*$,l=m[y]+=I;s=Math.min(s,l),n=Math.max(n,l)}}return{min:s,max:n}}function S(t){const e=_.exec(t);if(!e)return null;const{hh:a,mm:i,ss:o,ms:m}=e.groups;return Number(a)*E.hours+Number(i)*E.minutes+Number(o)*E.seconds+Number(m||0)}async function oe(t,e,a=!0){if(!e)return[];const{field:i,field2:o,field3:m,fieldDelimiter:s,fieldInfos:n,timeZone:g}=t,d=i&&(n==null?void 0:n.find(l=>l.name.toLowerCase()===i.toLowerCase())),N=!!d&&D(d),x=!!d&&U(d),u=t.valueExpression,b=t.normalizationType,M=t.normalizationField,F=t.normalizationTotal,w=[],$=t.viewInfoParams;let f=null,p=null;if(u){if(!c){const{arcadeUtils:l}=await L();c=l}c.hasGeometryOperations(u)&&await c.enableGeometryOperations(),f=c.createFunction(u),p=$?c.getViewInfo({viewingMode:$.viewingMode,scale:$.scale,spatialReference:new V($.spatialReference)}):null}const y=t.fieldInfos,I=!(e[0]&&"declaredClass"in e[0]&&e[0].declaredClass==="esri.Graphic")&&y?{fields:y}:null;return e.forEach(l=>{const h=l.attributes;let r;if(u){const v=I?{...l,layer:I}:l,j=c.createExecContext(v,p,g);r=c.executeFunction(f,j)}else h&&(r=h[i],o?(r=`${T(r)}${s}${T(h[o])}`,m&&(r=`${r}${s}${T(h[m])}`)):typeof r=="string"&&a&&(x?r=r?new Date(r).getTime():null:N&&(r=r?S(r):null)));if(b&&typeof r=="number"&&isFinite(r)){const v=h&&parseFloat(h[M]);r=Y(r,b,v,F)}w.push(r)}),w}export{S as I,oe as b,re as w,te as x};
