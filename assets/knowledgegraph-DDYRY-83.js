const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./knowledgeGraphService-BDS0AlFK.js","./cast-BA_-jlhc.js","./Accessor-BHnuXKD2.js","./index-tefRSezt.js","./index-Cx51aysm.css","./JSONSupport-CGdeqxpk.js","./Point-XGrwlf63.js","./writer-B2bQV2uU.js","./submitJob-Cqg9t7s8.js","./Extent-CBBGeHb-.js","./normalizeUtils-XRAPXbWa.js","./Polyline-BmuD2-ZN.js","./mathUtils-DV9iOXpW.js","./normalizeUtilsCommon-D0zPTJCj.js","./jsonUtils-Cu7OBRmN.js","./utils-Cy8wFNQo.js","./utils-CkSELPnj.js","./Field-Cyk7Ur5d.js","./enumeration-Cr5WIZs4.js","./fieldType-L-VlbZqy.js","./networkEnums-n7t8Au-e.js","./FeatureSet-DpCN730g.js","./Graphic-CFXUQZlS.js","./Clonable-DvJsj5LF.js","./reactiveUtils-BR0C1Kq4.js","./Evented-DCWccWGU.js","./SimpleObservable-7oieNGD8.js","./opacityUtils-CSd4XoR2.js","./Promise-CmQqe-ke.js","./Color-gncXBiLc.js","./colorUtils-Rxh2V3ai.js","./ActionToggle-__-l4AdQ.js","./Identifiable-BrT7zvUW.js","./typeUtils-BSg8Y507.js","./TextSymbol-BQ_NW9Xo.js","./screenUtils-_ZIvrt5o.js","./collectionUtils-CbaToa73.js","./Portal-CTRRujjZ.js","./vec3f64-BLpZdpfb.js","./aaBoundingBox-CeBivBRq.js","./GPMessage-ttuUMj6y.js","./Path-BzF4EEAV.js"])))=>i.map(i=>d[i]);
import{_ as G}from"./index-tefRSezt.js";import{O as K}from"./Accessor-BHnuXKD2.js";import{t as N,c as I}from"./arcade-CrJG569S.js";import{a as c,r as f}from"./executionError-HS8X1L-B.js";import{o as k,y as P,X as O,q as U,i as V,t as T,h as j,g as J,w as M,U as q}from"./deepClone-DC5Ed1NQ.js";import{l as Q}from"./portalUtils-3wOWt06C.js";import{g as b,b as W,k as L,E as B}from"./Point-XGrwlf63.js";import{k as X,K as Y,O as z}from"./projection-B2I9Bzj_.js";import{C as D}from"./Portal-CTRRujjZ.js";import H from"./PortalItem-CXk7DqVv.js";import{m as Z,n as $}from"./project-BoEABhcm.js";import{c as tt,t as rt,p as nt,a as et}from"./Path-BzF4EEAV.js";import{p as it}from"./GraphQueryStreaming-DnnY4k6p.js";import{i as y,R as _,n as A,Y as ot}from"./opacityUtils-CSd4XoR2.js";import"./ImmutableArray-BPVd6ESQ.js";import"./jsonUtils-Cu7OBRmN.js";import"./Extent-CBBGeHb-.js";import"./Polyline-BmuD2-ZN.js";import"./writer-B2bQV2uU.js";import"./mathUtils-DV9iOXpW.js";import"./TimeOnly-yGYcAQQJ.js";import"./Promise-CmQqe-ke.js";import"./cast-BA_-jlhc.js";import"./JSONSupport-CGdeqxpk.js";import"./featureConversionUtils-DpmsPUmt.js";import"./aaBoundingBox-CeBivBRq.js";import"./OptimizedFeature-DcMLlxvB.js";import"./memoryEstimations-5gFNwkKK.js";import"./OptimizedGeometry-7IxBWtHr.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./FieldsIndex-DFdVonga.js";import"./timeZoneUtils-COos5xIr.js";import"./shared-M7rSkUll.js";import"./Field-Cyk7Ur5d.js";import"./enumeration-Cr5WIZs4.js";import"./fieldType-L-VlbZqy.js";import"./WhereClause-diW5rNp6.js";import"./unitConversion-BDsSPToO.js";import"./number-BWHn6sm2.js";import"./hash-CcEbRgUF.js";import"./uuid-Cl5lrJ4c.js";import"./SimpleObservable-7oieNGD8.js";import"./vec3f64-BLpZdpfb.js";import"./projectBuffer-DOU0xvVi.js";import"./geodesicConstants-yASAK_zX.js";import"./utils-Cy8wFNQo.js";import"./utils-CkSELPnj.js";let u=null;async function at(t){const r=K.geometryServiceUrl??"";if(!r){X()||await Y();for(const n of t)n.container[n.indexer]=z(n.container[n.indexer],b.WGS84);return}const e=t.map(n=>n.container[n.indexer]),o=new Z({geometries:e,outSpatialReference:b.WGS84}),p=await $(r,o);for(let n=0;n<p.length;n++){const i=t[n];i.container[i.indexer]=p[n]}}async function E(t,r){const e=new H({portal:t,id:r});return await e.load(),u===null&&(u=await G(()=>import("./knowledgeGraphService-BDS0AlFK.js").then(o=>o.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41]),import.meta.url)),await u.fetchKnowledgeGraph(e.url)}function v(t,r,e,o,p){if(t===null)return null;if(y(t)||A(t))return t;if(T(t)||T(t))return t.toJSDate();if(j(t))return t.toStorageFormat();if(J(t))return t.toStorageString();if(M(t)){const n={};for(const i of t.keys())n[i]=v(t.field(i),r,e,o,p),n[i]instanceof W&&p.push({container:n,indexer:i});return n}if(_(t)){const n=t.map(i=>v(i,r,e,o,p));for(let i=0;i<n.length;i++)n[i]instanceof W&&p.push({container:n,indexer:i});return n}return q(t)?t.spatialReference.isWGS84?t:t.spatialReference.isWebMercator&&r?L(t):t:void 0}function pt(t,r){if(!t)return t;if(t.spatialReference.isWGS84&&r.spatialReference.isWebMercator)return B(t);if(t.spatialReference.equals(r.spatialReference))return t;throw new c(r,f.WrongSpatialReference,null)}function R(t,r){if(!t)return null;const e={};for(const o in t)e[o]=g(t[o],r);return e}function g(t,r){return t===null?null:_(t)?t.map(e=>g(e,r)):t instanceof tt?{graphTypeName:t.typeName,id:t.id,graphType:"entity",properties:R(t.properties,r)}:t instanceof rt?{graphType:"object",properties:R(t.properties,r)}:t instanceof nt?{graphTypeName:t.typeName,id:t.id,graphType:"relationship",originId:t.originId??null,destinationId:t.destinationId??null,properties:R(t.properties,r)}:t instanceof et?{graphType:"path",path:t.path?t.path.map(e=>g(e,r)):null}:q(t)?pt(t,r):y(t)||A(t)||ot(t)?t:null}function rr(t){t.mode==="async"&&(t.functions.knowledgegraphbyportalitem=function(r,e){return t.standardFunctionAsync(r,e,(o,p,n)=>{var l,d;if(k(n,2,2,r,e),n[0]===null)throw new c(r,f.PortalRequired,e);if(n[0]instanceof N){const m=P(n[1]);let h;return h=(l=r.services)!=null&&l.portal?r.services.portal:D.getDefault(),E(Q(n[0],h),m)}if(y(n[0])===!1)throw new c(r,f.InvalidParameter,e);const i=P(n[0]);return E(((d=r.services)==null?void 0:d.portal)??D.getDefault(),i)})},t.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),t.functions.querygraph=function(r,e){return t.standardFunctionAsync(r,e,async(o,p,n)=>{var x;k(n,2,4,r,e);const i=n[0];if(!O(i))throw new c(r,f.InvalidParameter,e);const l=n[1];if(!y(l))throw new c(r,f.InvalidParameter,e);u===null&&(u=await G(()=>import("./knowledgeGraphService-BDS0AlFK.js").then(a=>a.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41]),import.meta.url));let d=null;const m=U(n[2],null);if(!(m instanceof I||m===null))throw new c(r,f.InvalidParameter,e);if(m){let a=[];d=v(m,!0,!1,r,a),a=a.filter(s=>!s.container[s.indexer].spatialReference.isWGS84),a.length>0&&await at(a)}const h=new it({openCypherQuery:l,bindParameters:d});(((x=i==null?void 0:i.serviceDefinition)==null?void 0:x.currentVersion)??11.3)>11.2&&(h.outputSpatialReference=r.spatialReference);const C=(await u.executeQueryStreaming(i,h)).resultRowsStream.getReader(),S=[];try{for(;;){const{done:a,value:s}=await C.read();if(a)break;if(_(s))for(const w of s)S.push(g(w,r));else{const w=[];for(const F of s)w.push(g(s[F],r));S.push(w)}}}catch(a){throw a}return I.convertJsonToArcade(S,V(r),!1,!0)})},t.signatures.push({name:"querygraph",min:2,max:4}))}export{rr as registerFunctions};
