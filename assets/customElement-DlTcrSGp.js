const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-BPm91e5Z.js","./index-CMxz6F2k.js","./jsxFactory-Cnml7uXM.js","./Accessor-BmwT4B0c.js","./intl-Duiy0OzY.js","./Promise-DfET-uns.js","./cast-CsZslgGN.js","./index-4eY77cms.js","./index-Cx51aysm.css","./JSONSupport-DcrLLGjL.js","./Evented-Dw4_VOGn.js","./reactiveUtils-XM7cS2OP.js","./SimpleObservable-CvOkykwM.js","./uuid-Cl5lrJ4c.js","./guid-ejniuQmw.js","./useT9n-C1Hrfc-A.js","./index-DwIhxbHs.js","./dom-DEluURzl.js","./observers-Co4E8E8j.js","./keyed-CU1C-h1n.js","./directive-helpers-DaBykg1t.js","./ref-D9wHsL_T.js","./interactive-DTzfFku4.js","./loadable-XBvaWFYY.js","./component-CBVlbUuE.js","./index-C6d66FVb.js","./index-DyXGQ9Xl.js","./index-DVGzfobf.js","./floating-ui-IixYHfbQ.js","./debounce-DbkufipY.js","./key-CZcQa38B.js","./openCloseComponent-nqWrSaIH.js","./dynamicClasses-pKEMtFzB.js","./index-C7Sgjfzm.js","./resources6-Cs2_VmEC.js","./index-XCNLEnDV.js","./customElement-_nG5icNK.js","./index-DMeQur4V.js","./static-DLD4WjLv.js","./FloatingArrow-BZRr6Zld.js","./useFocusTrap-COeL24Kx.js","./focusTrapComponent-D1wJZ4RD.js","./index-DK5B8inx.js","./array-BbE1dLa5.js","./index-CV25o1as.js","./resources4-Crg87oFz.js","./index-Brz2wqWq.js","./index-Cl-EVQNh.js","./index-fFnlo_g2.js","./form-BzoUrXC7.js","./label-CHHpnzD0.js","./Validation-BYp9DS84.js","./index-Bts9-rBr.js"])))=>i.map(i=>d[i]);
import{_ as v,L as N,c as T,n as L,x as A,a as C}from"./index-4eY77cms.js";import{n as $}from"./ref-D9wHsL_T.js";import{g as b,B as _,s as g,r,m as n,a as V}from"./Accessor-BmwT4B0c.js";import{O as D,c as I,n as i,e as P}from"./jsxFactory-Cnml7uXM.js";import{f as S}from"./intl-Duiy0OzY.js";import{V as O,d as M,v as U,P as R}from"./reactiveUtils-XM7cS2OP.js";import{h as W}from"./UpdatingHandles-CzJ4c3KT.js";import{r as F,x as H}from"./layerUtils-B__v9OBu.js";import{C as q}from"./Portal-CmmHxpLg.js";import{s as z}from"./utils-DuOoxLAw.js";import{h as B}from"./Promise-DfET-uns.js";import{L as j,p as G,S as J}from"./component-utils-D0ciaaZ_.js";import{a as K}from"./disconnected-D8V16UE_.js";import"./directive-helpers-DaBykg1t.js";import"./Evented-Dw4_VOGn.js";import"./uuid-Cl5lrJ4c.js";import"./cast-CsZslgGN.js";import"./JSONSupport-DcrLLGjL.js";import"./SimpleObservable-CvOkykwM.js";import"./writer-DKgfqj4X.js";import"./Extent-g5W9hy0j.js";import"./Point-Cz2JYYmX.js";const k={noDirtyAreasInExtent:-2147208940,cannotAcquireVersionLock_v10:-2147217146,cannotAcquireVersionLock_v11:-2147220947};let d=class extends b{constructor(t){super(t),this._activeOperationDidSucceed=!1,this._initialValidationsFinished=!1,this._dirtyAreasLayer=null,this._serverVersion=null,this._updatingHandles=new W,this._validConstructProperties=!1,this.executionError="",this.extentToValidate="current",this.loadErrors=new O}initialize(){const t=async()=>{this.messages||(this.messages=await S("esri/widgets/UtilityNetworkValidateTopology/t9n/UtilityNetworkValidateTopology"))};t().then(()=>{this.view||(this.view=null),this.utilityNetwork||(this.utilityNetwork=null),this.addHandles([M(()=>[this.view,this.utilityNetwork],async()=>{var l,h;const{loadErrors:s,messages:{info:{noUtilityNetwork:o,noView:a}}}=this;this._initialValidationsFinished=!1,s.removeAll(),this._validConstructProperties=!0,this._dirtyAreasLayer=null,this._serverVersion=null,((l=this.utilityNetwork)==null?void 0:l.type)!=="utility"&&(this.loadErrors.push(o),_.getLogger(this).error(new g("utilityNetworkValidateTopology:missing-property",o)),this._validConstructProperties=!1),((h=this.view)==null?void 0:h.type)!=="2d"&&(this.loadErrors.push(a),_.getLogger(this).error(new g("utilityNetworkValidateTopology:missing-property",a)),this._validConstructProperties=!1),this._validConstructProperties&&(this.utilityNetwork.loaded||await this.utilityNetwork.load().catch(u=>{_.getLogger(this).error(u),this._validConstructProperties=!1}),await this._setDirtyAreasLayer()),this._validConstructProperties&&await this._validateNetworkExtension()},R),U(()=>{var s,o;return(o=(s=this.view)==null?void 0:s.map)==null?void 0:o.layers},"change",async()=>{const{loadErrors:s,messages:{info:{noUtilityNetwork:o}}}=this,a=s.find(l=>l===o);this._initialValidationsFinished=!1,a||(s.removeAll(),await this._validateNetworkExtension(),await this._setDirtyAreasLayer()),this._initialValidationsFinished=!0}),B(t)])})}destroy(){this._updatingHandles.destroy()}get state(){return this.loadErrors.length||!this._validConstructProperties?"disabled":this.executionError?"failed":this._updatingHandles.updating?"executing":this._activeOperationDidSucceed?"success":this._initialValidationsFinished?"ready":"loading"}set utilityNetwork(t){this._get("utilityNetwork")!==t&&this._set("utilityNetwork",t)}set view(t){this._get("view")!==t&&this._set("view",t)}async validateTopology(){var l;const{messages:{info:{cannotAcquireVersionLock:t,noDirtyAreasInExtent:s}},utilityNetwork:o,view:a}=this;if(!this.loadErrors.length){this._activeOperationDidSucceed=!1,this._set("executionError","");const h={gdbVersion:o==null?void 0:o.gdbVersion,outSpatialReference:((l=a.spatialReference)==null?void 0:l.clone())||null,validateArea:this.extentToValidate==="current"?a.extent.clone():o.fullExtent.clone()};this._updatingHandles.addPromise(o==null?void 0:o.validateTopology(h).then(()=>{this._activeOperationDidSucceed=!0},u=>{var x;let y="Error: "+u;if(u instanceof g&&((x=u.details)!=null&&x.raw))switch(u.details.raw.extendedCode){case k.noDirtyAreasInExtent:y=s;break;case k.cannotAcquireVersionLock_v10:case k.cannotAcquireVersionLock_v11:y=t;break;default:y=u.details.message}this._set("executionError",y)}))}}async _setDirtyAreasLayer(){var o;const{messages:{info:{noDirtyAreasLayer:t}}}=this,s=(o=this.view)==null?void 0:o.map.allLayers.items.filter(a=>F(a)).find(a=>{var l,h;return((l=a.parsedUrl)==null?void 0:l.path)===((h=this.utilityNetwork)==null?void 0:h.networkSystemLayers.dirtyAreasLayerUrl)});s?(this._dirtyAreasLayer=s,await this._dirtyAreasLayer.load(),this._serverVersion=this._dirtyAreasLayer.version??0,this._validConstructProperties=!0):(this.loadErrors.includes(t)||(this.loadErrors.push(t),_.getLogger(this).error(new g("utilityNetworkValidateTopology:missing-layer",t))),this._validConstructProperties=!1)}async _validateNetworkExtension(){var u;const{messages:{info:{noAdvancedEditingUserTypeExtension:t,noUtilityNetworkServiceUserTypeExtension:s}}}=this,o=await H(this.utilityNetwork.layerUrl),a=new q({url:o});await a.load();const l=((u=a.user)==null?void 0:u.username)??"",h=Number(this._serverVersion)<=11.1?"utilityNetwork":"advediting";if(!await z(a,l,h)){const y=Number(this._serverVersion)<=11.1?s:t;this.loadErrors.push(y),_.getLogger(this).error(new g("utilityNetworkValidateTopology:no-user-type-extension",y)),this._validConstructProperties=!1}this._initialValidationsFinished=!0}};r([n()],d.prototype,"_initialValidationsFinished",void 0),r([n()],d.prototype,"_dirtyAreasLayer",void 0),r([n()],d.prototype,"_validConstructProperties",void 0),r([n({readOnly:!0})],d.prototype,"executionError",void 0),r([n()],d.prototype,"extentToValidate",void 0),r([n()],d.prototype,"loadErrors",void 0),r([n()],d.prototype,"messages",void 0),r([n({readOnly:!0})],d.prototype,"state",null),r([n()],d.prototype,"utilityNetwork",null),r([n()],d.prototype,"view",null),d=r([V("esri.widgets.UtilityNetworkValidateTopology.UtilityNetworkValidateTopologyViewModel")],d);const f=d,w="esri-un-validate-topology",c={container:`${w}__container`,content:`${w}__content`,controlsContainer:`${w}__controls-container`,statusIconError:`${w}__status-icon-error`,statusIconSuccess:`${w}__status-icon-success`,statusIconContainer:`${w}__status-icon-container`};let p=class extends D{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new f}loadDependencies(){return I({action:()=>v(()=>import("./index-BPm91e5Z.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]),import.meta.url),block:()=>v(()=>import("./index-C6d66FVb.js"),__vite__mapDeps([25,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,26,21,20,18,17,16,27,28,29,22,30,23,31,32,0,19,24,33,34,35,36,37,38,39,40,41,42,43]),import.meta.url),icon:()=>v(()=>import("./index-DwIhxbHs.js").then(e=>e.i),__vite__mapDeps([16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18]),import.meta.url),notice:()=>v(()=>import("./index-CV25o1as.js"),__vite__mapDeps([44,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,21,20,23,45,31,24,15]),import.meta.url),option:()=>v(()=>import("./index-Brz2wqWq.js"),__vite__mapDeps([46,2,3,4,5,6,7,8,9,10,11,12,13,18]),import.meta.url),select:()=>v(()=>import("./index-Cl-EVQNh.js"),__vite__mapDeps([47,16,2,3,4,5,6,7,8,9,10,11,12,13,17,14,18,48,21,20,49,22,50,23,24,51]),import.meta.url),tooltip:()=>v(()=>import("./index-Bts9-rBr.js"),__vite__mapDeps([52,2,3,4,5,6,7,8,9,10,11,12,13,21,20,28,17,14,29,31,39,19]),import.meta.url)})}get extentToValidate(){return this.viewModel.extentToValidate}set extentToValidate(e){this.viewModel.extentToValidate=e}get icon(){return"check-circle"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.label)??""}set label(e){this._overrideIfSome("label",e)}get utilityNetwork(){return this.viewModel.utilityNetwork}set utilityNetwork(e){this.viewModel.utilityNetwork=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const{viewModel:e}=this;return e.state==="disabled"?i("div",{class:c.container},i("calcite-block",{class:c.content,collapsible:!1,heading:this.label,open:!0},this._renderLoadErrorStatusIcon(),this._renderLoadErrorsNotices())):i("div",{class:c.container},i("calcite-block",{class:c.content,collapsible:!0,heading:this.label,open:!1},this._renderStatusIcon(),this._renderValidateTopologyAction(),this._renderControls()))}_extentOptionSelectChange(e){this.extentToValidate=e.currentTarget.value}_getLoadErrorMessagesAsNotices(e,t){return i("calcite-notice",{closable:!1,key:"error-notice-"+t,kind:"warning",open:!0,scale:"s"},i("div",{slot:"message"},e))}_handleValidateTopologyAction(){this.viewModel.validateTopology().catch(()=>{})}_renderControls(){const{viewModel:e}=this;return e.state==="failed"?i("div",{class:c.controlsContainer},this._renderExtentOptionSelect(),this._renderStatusNotice()):this._renderExtentOptionSelect()}_renderExtentOptionSelect(){const{messages:e,viewModel:t}=this;return i("div",{key:"selectExtentDiv"},i("calcite-select",{bind:this,disabled:t.state==="loading"||t.state==="executing",label:e.input.extentToValidate,onCalciteSelectChange:this._extentOptionSelectChange},i("calcite-option",{value:"current"},e.input.currentExtent),i("calcite-option",{value:"entire"},e.input.entireExtent)))}_renderLoadErrorsNotices(){const{viewModel:e}=this;return i("div",{class:c.controlsContainer,key:"loadErrorsDiv"},e.loadErrors.items.map(this._getLoadErrorMessagesAsNotices))}_renderLoadErrorStatusIcon(){return i("div",{class:c.statusIconContainer,key:"statusDiv",slot:"control"},i("calcite-icon",{class:c.statusIconError,icon:"exclamation-mark-triangle",scale:"s"}))}_renderStatusIcon(){const{messages:e,viewModel:t}=this,s=`${this.id}-validation-status-action`,o=`${this.id}-error-status-icon`,a=`${this.id}-success-status-icon`,l=h=>{setTimeout(()=>{h.textContent=""},3500)};return t.state==="executing"?i("div",{key:"statusDivExecuting",slot:"control"},i("calcite-action",{id:s,loading:!0,text:e.status.executing}),i("calcite-tooltip",{overlayPositioning:"fixed",referenceElement:s},i("span",null,e.status.executing))):t.state==="success"?i("div",{afterCreate:l,class:c.statusIconContainer,key:"statusDivSuccess",slot:"control"},i("calcite-icon",{class:c.statusIconSuccess,icon:"check-circle",id:a,scale:"s"}),i("calcite-tooltip",{referenceElement:a},i("span",null,e.status.success))):t.state==="failed"?i("div",{class:c.statusIconContainer,key:"statusDivFailed",slot:"control"},i("calcite-icon",{class:c.statusIconError,icon:"exclamation-mark-triangle",id:o,scale:"s"}),i("calcite-tooltip",{referenceElement:o},i("span",null,t.executionError))):i("div",{class:c.statusIconContainer,key:"statusDiv",slot:"control"})}_renderStatusNotice(){const{viewModel:e}=this;return i("div",{key:"executionErrorDiv"},i("calcite-notice",{closable:!0,kind:"warning",open:!0,scale:"s"},i("div",{slot:"message"},e.executionError)))}_renderValidateTopologyAction(){const{messages:e,viewModel:t}=this,s=`${this.id}-validation-action`;return i("div",{key:"actionDiv",slot:"control"},i("calcite-action",{bind:this,disabled:t.state==="executing",icon:"play-f",id:s,loading:t.state==="loading",onclick:this._handleValidateTopologyAction,text:e.input.validateTopology}),i("calcite-tooltip",{referenceElement:s},i("span",null,t.state==="loading"?e.status.loading:e.input.validateTopology)))}};r([n()],p.prototype,"extentToValidate",null),r([n()],p.prototype,"icon",null),r([n()],p.prototype,"label",null),r([n(),P("esri/widgets/UtilityNetworkValidateTopology/t9n/UtilityNetworkValidateTopology")],p.prototype,"messages",void 0),r([n()],p.prototype,"utilityNetwork",null),r([n()],p.prototype,"view",null),r([n({type:f})],p.prototype,"viewModel",void 0),p=r([V("esri.widgets.UtilityNetworkValidateTopology")],p);const Q=p;/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
v4.32.12 */const m=class m extends N{constructor(){super(...arguments),this._watchHandles=[],this.extentToValidate="current",this.position="bottom-left",this.arcgisReady=T()}willUpdate(t){t.has("referenceElement")&&this.referenceElementWatcher(this.referenceElement),t.has("extentToValidate")&&this.extentToValidateWatcher(this.extentToValidate),t.has("utilityNetwork")&&this.utilityNetworkWatcher(this.utilityNetwork),t.has("position")&&this.positionWatcher(this.position),t.has("view")&&this.viewWatcher(this.view)}async loaded(){const t=this._createParams(),s=new Q(t);this.widget=s,this._addContainer(),j(this),G(this)}disconnectedCallback(){super.disconnectedCallback(),K(this)}referenceElementWatcher(t){J(this,t)}extentToValidateWatcher(t){this.widget&&(this.widget.extentToValidate=t)}utilityNetworkWatcher(t){this.widget&&t&&(this.widget.utilityNetwork=t)}positionWatcher(t){var s;t!==void 0&&this.widget&&this.el.childElem&&((s=this.view.ui)==null||s.move(this.el.childElem,t))}viewWatcher(t){t!==void 0&&this.widget&&(this.widget.view=t,this._loadUtilityNetwork())}_addContainer(){this.widget.container=this.el.childElem}_createParams(){const t={};return this.extentToValidate!==void 0&&(t.extentToValidate=this.extentToValidate),this.utilityNetwork!==void 0&&(t.utilityNetwork=this.utilityNetwork),t}async _loadUtilityNetwork(){var t,s;if((t=this.view)!=null&&t.map&&this.view.map.portalItem){await this.view.map.load();const o=(s=this.view.map.utilityNetworks)==null?void 0:s.getItemAt(0);await(o==null?void 0:o.load()),this.utilityNetwork=o}}_setChildElement(t){this.el.childElem=t}render(){return A`<div ${$(this._setChildElement)}></div>`}};m.properties={extentToValidate:1,position:1,referenceElement:1,utilityNetwork:0,view:0,widget:0},m.shadowRootOptions=L;let E=m;C("arcgis-utility-network-validate-topology",E);export{E as ArcgisUtilityNetworkValidateTopology};
