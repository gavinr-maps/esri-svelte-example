const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./FeatureServiceSnappingSource-B-M0f3zY.js","./index-BVncS3aY.js","./index-CjOb8WjV.css","./Evented-CXIxDjmW.js","./Accessor-D6mNnsWy.js","./subclass-BR3PhgZG.js","./reactiveUtils-BFQ0BtrB.js","./shared-B3wH2qpO.js","./memoize-DsJmrG76.js","./UpdatingHandles-CMtXpTiG.js","./layerUtils-BzjQnEdj.js","./assets-BNizZMOZ.js","./elevationInfoUtils-C0SzfJu0.js","./Point-TlcsOcXV.js","./jsonMap-DCC6W5ex.js","./writer-3zufXUNV.js","./unitConversionUtils-BUA_O87q.js","./lengthUtils-vgIBtB6M.js","./TileKey-DZd6gJy7.js","./mathUtils-ClvKsMak.js","./boundedPlane-Xr4Vx-V9.js","./sphere-DIv2hmik.js","./mat4-ybYUU6jq.js","./vec42-B1mBkh1w.js","./vec4f64-CBQL1T0x.js","./Polyline-BQFeqYXi.js","./Extent-B4rrMrqp.js","./plane-Bz78OrLf.js","./mat3f64-BBpwCtoL.js","./mat4f64-Dk4dwAN8.js","./quatf64-BrpT0VRp.js","./vec2f64-Diu2Kaa8.js","./mathUtils-kvswLROa.js","./lineSegment-A3_mEhFF.js","./layerViewUtils-D2JqIDZ8.js","./FeatureTileDescriptor3D-BOE-lJxV.js","./queryEngineUtils-YM7vbhkh.js","./VertexSnappingCandidate-DG5gTQ3a.js","./PointSnappingHint-DJuRAzp4.js","./TileTreeDebugger-DO3eX0_-.js","./Color-DDUWtbqR.js","./colorUtils-CS9vdHXB.js","./Graphic-Bi5hWHps.js","./geometry-CnaxvJsv.js","./PopupTemplate-D8mXPxzU.js","./Clonable-cKbRam6-.js","./fieldUtils-C5R42-PY.js","./intl-CArXn1et.js","./Promise-CZrWwByK.js","./enumeration--HlxOQ_N.js","./ActionToggle-C0Z1k2jc.js","./Identifiable-BLvpQbOc.js","./symbols-CfvYGR4J.js","./TextSymbol-zZq0BA1M.js","./screenUtils-PfxkaaMN.js","./materialUtils-CQ3JLQ1x.js","./opacityUtils-BT7mQkwC.js","./aaBoundingBox-BGxkJAW0.js","./persistableUrlUtils-Dx61-x4K.js","./collectionUtils-Dm1icNvk.js","./Portal-DCqdz-K4.js","./jsonUtils-DtWlwXHP.js","./WorkerHandle-zf9G5gFF.js","./workers-D8NOwm_V.js","./Queue-DpHko4Yk.js","./projectVectorToVector-BLdiwuTJ.js","./projectBuffer-iyGwL2dv.js","./geodesicConstants-kj1AtlGg.js","./projectPointToVector-C-hGM2ap.js","./projection-tSh-0UvX.js","./TileInfo-Dm24FfTU.js","./debugFlags-B3L9P_UW.js","./vec2-B_ymkwGp.js","./geodesicUtils-DyOqnDq-.js","./geometry2dUtils-BraNT6Fs.js","./FeatureFilter-DqmBE6ye.js","./TimeExtent-Dl-qaORu.js","./timeUtils-DQR2jUPL.js","./Query-BpMwiNVl.js","./DataLayerSource-BX7Ap_tY.js","./Field-poIiHWUc.js","./fieldType-CIG5ey7e.js","./FullTextSearch-BhJOgh_r.js","./floorFilterUtils-DZ5C6FQv.js","./InputManager-C4xu1R9l.js","./signal-DzOfzcfh.js","./keybindings-DYR2fa8r.js","./utils-CXgSw6Sd.js","./geodesicLengthMeasurementUtils-YCCCQWpE.js","./quantityUtils-Cz8e0KG8.js","./geometryEngine-DyRMGqqp.js","./geometryEngineBase-RmbNeFm7.js","./_commonjsHelpers-DCkdB7M8.js","./hydrated-CRSW297p.js","./Cyclical-BY_I03kj.js","./FeatureCollectionSnappingSource-C-1rTljs.js","./symbologySnappingCandidates-DjmIkAOi.js","./LRUCache-ju6LnIBZ.js","./MemCache-C6WUx-5V.js","./GraphicsSnappingSource-C7eqxzdE.js","./normalizeUtilsSync-DD8htqGn.js","./normalizeUtilsCommon-DNPu20r0.js","./featureConversionUtils-B-SknPj_.js","./OptimizedFeature-7juV2tZm.js","./OptimizedGeometry-vU5jWBvU.js","./OptimizedFeatureSet-Blu9Ckm7.js","./FeatureStore-GQfqFqRN.js","./BoundsStore-BYcuS8_t.js","./PooledRBush-CGlhTzFe.js","./quickselect-D0_cvEX6.js","./timeSupport-86-Lo3YD.js","./normalizeUtils-CuTX3yb4.js","./utils-Blh5cXWv.js","./utils-Bh7lx_TM.js","./json-Wa8cmqdu.js","./optimizedFeatureQueryEngineAdapter-Buta7wlw.js","./centroid-DdLmOD72.js","./QueryEngine-BaqPXEl6.js","./WhereClause-CO6Fm86l.js","./TimeOnly-BtK5SiqG.js","./UnknownTimeZone-D0GlcniK.js","./QueryEngineCapabilities-CTDe3LlQ.js","./quantizationUtils-DFd0XKEL.js","./utils-hH5IaWNz.js","./heatmapUtils-C-uT6ZIV.js","./utils-HfpQY-3e.js","./Basemap-CKBB4cRW.js","./loadAll-z9YY33Kx.js","./PortalItem-CaeKabGc.js","./writeUtils-BUKZUL8X.js","./mat4f32-DcsiF_Rp.js","./utils-DUUw13Ab.js","./ClassBreaksDefinition-BpZNgsmK.js","./SnappingCandidate-O5eRSE6e.js","./FieldsIndex-DHql50vu.js","./Scheduler-CDoWuxMK.js","./utils-CvMr5svk.js","./jsonUtils-C4Wp5KpV.js","./parser-BN6zmHl-.js","./utils-D20M4_S8.js","./cimSymbolUtils-Ctf0ZrmH.js","./utils-D8D39sLt.js","./SceneLayerSnappingSource-B13GktJm.js","./EdgeWorkerHandle-BYj6binE.js","./workerHelper-DszV5Eae.js","./InterleavedLayout-UIhsB8jd.js","./BufferView-B7Z-dzh4.js","./Util-BMqL_pkg.js","./edgeProcessing-kh6EVSro.js","./deduplicate-DxTSMkFY.js","./Indices-B6BGScAS.js","./VertexAttribute-BnAa5VW0.js","./glUtil-C6KhMg1m.js","./enums-BlUEVwJR.js","./VertexElementDescriptor-BOD-G50G.js","./Normals-D1LdtP06.js"])))=>i.map(i=>d[i]);
import{e as h,o as si}from"./Evented-CXIxDjmW.js";import{ac as oi,S as Te,J as ai,s as ht,y as li}from"./Accessor-D6mNnsWy.js";import{y as f,b as fe,O as gn,J as ci,n as yn,Q as ui,$ as di}from"./subclass-BR3PhgZG.js";import{d as ve,A as Ze,V as xe,x as hi,C as St}from"./reactiveUtils-BFQ0BtrB.js";import{K as Xt,N as pi}from"./projection-tSh-0UvX.js";import{m as fi,j as L,x as gi,E as yi}from"./elevationInfoUtils-C0SzfJu0.js";import{b as Ue,G as w,x as vn,n as y,F as vi,a as Le,d as Z,T as V,P as M,q as T,t as pe,r as nt,f as Ce,_ as We,Z as wt,p as Be,v as mi,z as _i,a2 as Ei,l as Si,y as wi,c as xi,A as Li}from"./mathUtils-ClvKsMak.js";import{a as mn,e as it,n as Je}from"./projectVectorToVector-BLdiwuTJ.js";import{u as Ye}from"./Color-DDUWtbqR.js";import{f as _n}from"./assets-BNizZMOZ.js";import{_ as je}from"./index-BVncS3aY.js";import{j as Nt,G as $i,W as En,L as bi}from"./Point-TlcsOcXV.js";import{e as oe,p as Fe,j as Ie,d as Ae,B as Ti,q as Pi,_ as Sn,o as wn,b as me,E as Qt,L as Ri,m as Mt}from"./vec2-B_ymkwGp.js";import{h as Ni}from"./UpdatingHandles-CMtXpTiG.js";import{n as G,r as He,a as Mi,_ as Ai}from"./vec2f64-Diu2Kaa8.js";import{s as Fi,j as Vi}from"./vec42-B1mBkh1w.js";import{n as Ci}from"./vec4f64-CBQL1T0x.js";import{i as Ii}from"./geodesicConstants-kj1AtlGg.js";import{b as Xe,j as At,z as Ft,A as xt}from"./geodesicUtils-DyOqnDq-.js";import{E as O,D as Oi,j as rt,R as Lt,w as xn,V as Di,J as Ln,F as $n,b as zi}from"./plane-Bz78OrLf.js";import{Y as ji,d as qi,w as Hi,Q as ki,V as Gi}from"./sphere-DIv2hmik.js";import{j as bn}from"./mathUtils-kvswLROa.js";import{j as P,d as Zi,I as $t,N as Ui}from"./geometry2dUtils-BraNT6Fs.js";import{o as Vt}from"./fieldUtils-C5R42-PY.js";import{d as ke}from"./FeatureFilter-DqmBE6ye.js";import{o as Wi}from"./floorFilterUtils-DZ5C6FQv.js";import{c as qe,r as pt}from"./layerUtils-BzjQnEdj.js";import{g as Bi}from"./timeUtils-DQR2jUPL.js";import{b as Ji}from"./Query-BpMwiNVl.js";import{_ as Yi}from"./InputManager-C4xu1R9l.js";import{c as Kt}from"./keybindings-DYR2fa8r.js";import{e as Xi}from"./utils-CXgSw6Sd.js";import{t as Qi}from"./layerViewUtils-D2JqIDZ8.js";import{d as N,u as Tn}from"./geodesicLengthMeasurementUtils-YCCCQWpE.js";import{a as Ki,n as er,s as tr,r as Pn}from"./Cyclical-BY_I03kj.js";import{o as _e,m as Ct,f as Rn}from"./quantityUtils-Cz8e0KG8.js";var Ee;function Nn(n,e,t){return I(n,e,t)}function I(n=0,e=0,t=0){return Ue(n,e,t)}function Ks(n){return n}function eo(n){return n}function U(n,e,t){return Ue(n,e,t)}function $e(n){const[e,t,i]=n;return n.length>3?[e,t,i,n[3]]:[e,t,i]}function de(n){return n[3]=((n.length>3?n[3]:void 0)??Ee.NONE)|Ee.TARGET,n}function to(n){return!!(((n.length>3?n[3]:void 0)??Ee.NONE)&Ee.TARGET)}function $(n,e,{coordinateHelper:t,elevationInfo:i},r){return n?Me(t.vectorToDehydratedPoint(n,nr),e,i,r):null}function Me(n,e,t,i=I()){return i[0]=n.x,i[1]=n.y,i[2]=n.z??0,e==null||(e.type==="2d"?i[2]=0:i[2]=fi(e,n,t,L)??0),i}function no(n,e,t){return t?(mn(t,n[0],n[1],n[2],e),t):it(n[0],n[1],n[2],e)}function en(n,e,{z:t,m:i},r,s){const{spatialReference:a,elevationInfo:o}=r;let l;t==null&&i==null?l=void 0:e==null||e.type==="2d"?l=t??void 0:l=gi(e,n,a,L,o)??0;const[c,u]=n;return s?mn(s,c,u,l,a):s=it(c,u,l,a),i!=null&&(s.m=i,s.hasM=!0),s}function io(n,e,t,i,r=I()){const[s,a]=n;return r[0]=s,r[1]=a,n.length>3&&(r[3]=n[3]??Ee.NONE),(t==null?void 0:t.type)!=="3d"?(r[2]=e.value,r):(r[2]=yi(t,s,a,e.value,i,e.elevationInfo,L)??0,r)}(function(n){n[n.NONE=0]="NONE",n[n.TARGET=1]="TARGET"})(Ee||(Ee={}));const nr=it(0,0,0,null);let H=class extends _n{constructor(){super(...arguments),this.enabled=!0}};h([f({type:Boolean})],H.prototype,"enabled",void 0),H=h([fe("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],H);let S=class extends _n{constructor(e){super(e),this.lineSnapper=new H,this.parallelLineSnapper=new H,this.rightAngleSnapper=new H,this.rightAngleTriangleSnapper=new H,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new Ye([255,127,0]),this.orangeTransparent=new Ye([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};h([f({type:H,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"lineSnapper",void 0),h([f({type:H,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"parallelLineSnapper",void 0),h([f({type:H,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"rightAngleSnapper",void 0),h([f({type:H,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"rightAngleTriangleSnapper",void 0),h([f({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],S.prototype,"shortLineThreshold",void 0),h([f({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],S.prototype,"distance",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"pointThreshold",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"intersectionParallelLineThreshold",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"parallelLineThreshold",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],S.prototype,"verticalLineThresholdMeters",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"touchSensitivityMultiplier",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"pointOnLineThreshold",void 0),h([f({type:Ye,nonNullable:!0})],S.prototype,"orange",void 0),h([f({type:Ye,nonNullable:!0})],S.prototype,"orangeTransparent",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"lineHintWidthReference",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"lineHintWidthTarget",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],S.prototype,"lineHintFadedExtensions",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"parallelLineHintWidth",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],S.prototype,"parallelLineHintLength",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],S.prototype,"parallelLineHintOffset",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],S.prototype,"rightAngleHintSize",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],S.prototype,"rightAngleHintOutlineSize",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],S.prototype,"satisfiesConstraintScreenThreshold",void 0),S=h([fe("esri.views.interactive.snapping.Settings.Defaults")],S);const se=new S;var b;(function(n){n[n.FEATURE=1]="FEATURE",n[n.SELF=2]="SELF",n[n.ALL=3]="ALL"})(b||(b={}));let st=class{constructor(e,t){this.isDraped=e,this.domain=t}},ir=class Mn extends st{constructor(e,t,i=b.ALL){super(t,i),this.intersectionPoint=e}equals(e){return e instanceof Mn&&w(this.intersectionPoint,e.intersectionPoint)}},X=class An extends st{constructor(e,t,i,r,s=b.ALL,a=!0,o=!0){super(r,s),this.type=e,this.lineStart=t,this.lineEnd=i,this.fadeLeft=a,this.fadeRight=o}equals(e){return e instanceof An&&this.type===e.type&&w(this.lineStart,e.lineStart)&&w(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return vn(this.lineStart,this.lineEnd)}},rr=class Fn extends st{constructor(e,t,i,r=b.ALL){super(i,r),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof Fn&&w(this.lineStart,e.lineStart)&&w(this.lineEnd,e.lineEnd)}};class ot extends st{constructor(e,t,i,r,s=b.ALL){super(r,s),this.previousVertex=e,this.centerVertex=t,this.nextVertex=i}equals(e){return e instanceof ot&&w(this.previousVertex,e.previousVertex)&&w(this.centerVertex,e.centerVertex)&&w(this.nextVertex,e.nextVertex)}}function It({start:n,end:e,type:t},i,r){const s=[],a=oe(Oe,e,n),o=oe(at,n,i),l=Fe(a),c=2*Ie(a,o),u=c*c-4*l*(Fe(o)-r*r);if(u===0){const d=-c/(2*l);(t===C.PLANE||d>=0)&&s.push(Ae(G(),n,a,d))}else if(u>0){const d=Math.sqrt(u),p=(-c+d)/(2*l);(t===C.PLANE||p>=0)&&s.push(Ae(G(),n,a,p));const g=(-c-d)/(2*l);(t===C.PLANE||g>=0)&&s.push(Ae(G(),n,a,g))}return s}function Vn(n,e){const t=n.start,i=n.end,r=oe(Oe,i,t),s=Z(ct,-r[1],r[0],0),a=e.start,o=e.end,l=V(zt,o,a),c=M(l,s),u=Z(qn,t[0],t[1],0),d=V(Hn,u,a),p=M(d,s),g=Le();if(Math.abs(c)<g)return[];const v=T(kn,a,l,p/c);if(e.type===P.RAY){const m=V(bt,v,a);if(M(m,l)<-g)return[]}if(n.type===C.HALF_PLANE){const m=Ti(at,v,t);if(Ie(m,r)<-g)return[]}return[pe(v)]}function sr(n,e){return ar(Qe(jt,e[2],n),e)}function Cn(n,e){return zn(Qe(jt,0,n),Qe(dr,0,e)).map(([i,r])=>He(i,r))}function In(n,e,t){return Ot(n,Qe(jt,n[2],e),t)}function On(n,e,t,i=y()){const r=oe(Oe,n,e),s=Pi(r);return Ae(i,e,r,s===0?1:t/s),i[2]=n[2],i}function Ot(n,{start:e,end:t,type:i},r=y()){const s=V(lt,n,e),a=V(ct,t,e),o=M(s,a)/M(a,a);return T(r,e,a,i===P.RAY?Math.max(o,0):o)}const or=(()=>{const n=y(),e=y(),t=y();return({start:i,end:r},{center:s,radius:a,normal:o,slicePlane:l})=>{const c=rt(s,o,ur);if(E(Lt(c,i),0)&&E(Lt(c,r),0)){bn(o,n,e);const d=(v,m)=>(Ce(t,m,s),wn(v,M(t,n),M(t,e)),v),p=Zi({start:d(Oe,i),end:d(at,r),type:P.LINE},Mi,a),g=[];for(const[v,m]of p){const _=nt(y(),s);T(_,_,n,v),T(_,_,e,m),l&&!he(l,_)||g.push(_)}return g}const u=y();return xn(c,i,r,u)?!E(vn(u,s),a)||l&&!he(l,u)?[]:[u]:[]}})();function Dn({start:n,end:e,type:t},i,r){const s=[],a=Ce(lt,e,n),o=oe(at,n,i),l=Fe(a),c=2*Ie(a,o),u=c*c-4*l*(Fe(o)-r*r);if(u===0){const d=-c/(2*l);(t===P.LINE||d>=0)&&s.push(T(y(),n,a,d))}else if(u>0){const d=Math.sqrt(u),p=(-c+d)/(2*l);(t===P.LINE||p>=0)&&s.push(T(y(),n,a,p));const g=(-c-d)/(2*l);(t===P.LINE||g>=0)&&s.push(T(y(),n,a,g))}return s}function zn(n,e){const t=n.start,i=n.end,r=e.start,s=e.end,a=V(lt,i,t),o=V(ct,s,r),l=V(zt,r,t),c=We(qn,a,o);if(!E(M(l,c),0))return[];const u=wt(c);if(E(u,0))return[];const d=We(Hn,l,o),p=M(d,c)/u,g=T(kn,t,a,p);if(n.type===P.RAY){const v=V(bt,g,t);if(M(a,v)<-Le())return[]}if(e.type===P.RAY){const v=V(bt,g,r);if(M(o,v)<-Le())return[]}return[pe(g)]}function ar({start:n,end:e,type:t},i){const r=V(lt,i,n),s=V(ct,e,n),a=We(zt,s,r),o=wt(a)/wt(s),l=Le();if(o<l)switch(t){case P.LINE:return[pe(i)];case P.RAY:return M(s,r)<-l?[]:[pe(i)]}return[]}function Dt(n,e,t,i){const[r,s]=n,[a,o]=t,l=a-r,c=o-s,u=l*l+c*c,d=Math.sqrt(u);if(d>e+i)return[];if(d<Math.abs(e-i))return[];if(E(d,0)&&E(e,i))return[];const p=(e*e-i*i+u)/(2*d),g=Math.sqrt(e*e-p*p),v=g*c/d,m=g*l/d,[_,x]=Sn(Oe,n,t,p/d);return E(v,m)?[He(_,x)]:[He(_+v,x-m),He(_-v,x+m)]}function Qe(n,e,{start:t,end:i,type:r}){return Z(n.start,t[0],t[1],e),Z(n.end,i[0],i[1],e),n.type=cr[r],n}function jn(n,e){return E(n[2],e[2])}function E(n,e){return vi(Math.abs(n-e),0,Le())}function lr(n,e){return e.filter(t=>he(n,t))}function he(n,e){return Oi(n,e)}var C;(function(n){n[n.PLANE=0]="PLANE",n[n.HALF_PLANE=1]="HALF_PLANE"})(C||(C={}));const cr={[C.PLANE]:P.LINE,[C.HALF_PLANE]:P.RAY},Oe=G(),at=G(),lt=y(),ct=y(),zt=y(),qn=y(),Hn=y(),kn=y(),bt=y(),ur=O(),jt={start:y(),end:y(),type:P.LINE},dr={start:y(),end:y(),type:P.LINE};class z{intersect(e){return ee(this,e)}closestPoints(e){return[this.closestTo(e)]}}class Pe extends z{constructor(e){super(),this.point=e}equals(e){return this===e||j(e)&&w(this.point,e.point)}closestTo(){return $e(this.point)}}class qt extends z{constructor(e,t,i){super(),this.start=e,this.end=t,this.lineLike={start:e,end:t,type:i}}equals(e){return this===e||B(e)&&this.lineLike.type===e.lineLike.type&&w(this.start,e.start)&&w(this.end,e.end)}closestTo(e){const t=I();return Ot(e,this.lineLike,t),t}}class Ht extends qt{constructor(e,t){super(e,t,P.LINE)}}class hr extends qt{constructor(e,t){super(e,t,P.RAY)}}class Gn extends z{constructor(e){super(),this.constraints=e}equals(e){return this===e||Tt(e)&&ci(this.constraints,e.constraints,(t,i)=>t.equals(i))}closestTo(e){let t,i=1/0;for(const r of this.constraints){const s=r.closestTo(e),a=Be(e,s);a<i&&(i=a,t=s)}return $e(t??e)}closestPoints(e){return this.constraints.flatMap(t=>t===this?[]:t.closestPoints(e))}}class Zn extends z{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||Y(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const t=I();return On(e,this.center,this.radius,t),t}}class kt extends z{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||ne(e)&&w(this.center,e.center)&&this.radius===e.radius}closestTo(e){const t=I();return On(e,this.center,this.radius,t),t[2]=this.center[2],t}asCircle(){return new Gt($e(this.center),this.radius,U(0,0,1))}}class Gt extends z{constructor(e,t,i,r=void 0){super(),this.center=e,this.radius=t,this.normal=i,this.slicePlane=r}equals(e){return this===e||ae(e)&&w(this.center,e.center)&&w(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:t,radius:i}=this;Ln(this.getPlane(pr),e,ft);const r=V(ft,ft,t),s=mi(r);if(E(s,0))return $e(e);const a=i/Math.sqrt(s),o=I();T(o,t,r,a);const{slicePlane:l}=this;if(l&&!he(l,o)){const c=Ut(l,this);return(c==null?void 0:c.closestTo(e))??$e(e)}return o}getPlane(e=O()){return rt(this.center,this.normal,e)}}const ft=y(),pr=O();class fr extends z{constructor(e){super(),this.z=e}equals(e){return this===e||te(e)&&this.z===e.z}closestTo(e){return U(e[0],e[1],this.z)}getPlane(e=O()){return Z(tn,0,0,this.z),rt(tn,wi,e)}}const tn=y();class Zt extends z{constructor(e,t,i){super(),this.start=e,this.end=t,this.planeLike={start:e,end:t,type:i}}equals(e){return this===e||J(e)&&this.planeLike.type===e.planeLike.type&&w(this.start,e.start)&&w(this.end,e.end)}closestTo(e){const t=I();return In(e,this.planeLike,t),t}closestEndTo(e){const{start:t,end:i}=this.planeLike;return Math.sign(Ie(oe(gr,i,t),oe(yr,e,t)))>0?this.end:this.start}getPlane(e=O()){const t=nt(nn,this.end);return t[2]+=1,zi(this.start,this.end,t,e)}getSlicePlane(e=O()){const{start:t,end:i,type:r}=this.planeLike;if(r===C.PLANE)return;const s=Z(nn,t[0],t[1],0),a=Z(rn,i[0],i[1],0),o=Ce(rn,a,s);return rt(s,o,e),e}}const gr=G(),yr=G(),nn=y(),rn=y();class Un extends Zt{constructor(e,t){super(e,t,C.HALF_PLANE)}}class Wn extends Zt{constructor(e,t){super(e,t,C.PLANE)}}class vr extends z{constructor(e,t){super(),this.sphere=qi(e,t)}equals(e){return this===e||ie(e)&&Hi(this.sphere,e.sphere)}closestTo(e){const t=I();return ki(this.sphere,e,t),t}get center(){return Gi(this.sphere)}get radius(){return this.sphere[3]}}class Bn extends z{constructor(e,t,i){super(),this.start=e,this.end=t,this.getZ=i,this.planeLike={start:e,end:t,type:C.PLANE}}equals(e){return this===e||Ke(e)&&w(this.start,e.start)&&w(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return xr(this,e)}addIfOnTheGround(e,t){for(const i of t){const r=this.getZ(i[0],i[1])??0;E(i[2],r)&&(i[2]=r,e.push(i))}}}class mr extends z{constructor(e,t,i){super(),this._x=e,this._y=t,this._z=i}equals(e){return this===e||zr(e)&&this._x===e._x&&this._y===e._y&&this._z===e._z}closestTo([e,t,i]){return Nn(this._x??e,this._y??t,this._z??i)}}class _r extends z{constructor(e,t,i,r,s){super(),this._origin=e,this._spatialReference=t,this._distanceMeters=i,this._elevationMeters=r,this._directionDegrees=s}equals(e){return this===e||Dr(e)&&Qt(this._origin,e._origin)&&this._spatialReference===e._spatialReference&&this._distanceMeters===e._distanceMeters&&this._elevationMeters===e._elevationMeters&&this._directionDegrees===e._directionDegrees}closestTo([e,t,i]){return wn(Ne,e,t),Qt(Ne,this._origin)||this._applyDirectionAndDistance(Ne),Nn(Ne[0],Ne[1],this._elevationMeters??i)}_applyDirectionAndDistance(e){if(this._directionDegrees!=null&&this._distanceMeters!=null)Xe(e,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)Sr(e,this._origin,this._directionDegrees,e,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:t}=At(Er,this._origin,e,this._spatialReference);Xe(e,this._origin,t??0,this._distanceMeters,this._spatialReference)}}}const Ne=[0,0],Er=new Ft;function Sr(n,e,t,i,r){let{azimuth:s,distance:a}=At(wr,e,i,r);s??(s=0);let o=a*Math.cos((s-t)*Ii);o=Math.max(0,o),Xe(n,e,t,o,r)}const wr=new Ft;function xr(n,e){const t=I();return In(e,n.planeLike,t),t[2]=n.getZ(t[0],t[1])??Yn,t}function ee(n,e){if(Tt(n)){const t=[];for(const i of n.constraints){const r=i.intersect(e);r&&t.push(r)}return Wt(t)}if(Tt(e))return ee(e,n);if(Ke(n))return sn(n,e);if(Ke(e))return sn(e,n);if(j(n)){const{point:t}=n;if(j(e))return w(t,e.point)?n:void 0;const i=e.closestTo(t);return Ei(i,t)?n:void 0}if(B(n)){if(j(e))return ee(e,n);if(B(e))return k(zn(n.lineLike,e.lineLike));if(te(e))return Lr(n,e);if(J(e))return k(Vn(e.planeLike,n.lineLike));if(Y(e))return k(Dn(n.lineLike,e.center,e.radius));if(ae(e))return k(or(n.lineLike,e));if(ne(e))return $r(n,e);if(ie(e))return br(n,e)}else if(te(n)){if(j(e)||B(e))return ee(e,n);if(te(e))return Tr(n,e);if(J(e))return Pr(n,e);if(Y(e))return Rr(n,e);if(ae(e))return Mr(n,e);if(ne(e))return Nr(n,e);if(ie(e))return Ar(n,e)}else if(J(n)){if(j(e)||B(e)||te(e))return ee(e,n);if(J(e))return gt(Cn(n.planeLike,e.planeLike));if(Y(e))return gt(It(n.planeLike,e.center,e.radius));if(ae(e))return Vr(n,e);if(ne(e))return Fr(n,e);if(ie(e))return Cr(n,e)}else if(Y(n)){if(j(e)||B(e)||te(e)||J(e))return ee(e,n);if(Y(e))return gt(Dt(n.center,n.radius,e.center,e.radius));if(ae(e))return void 0;if(ne(e))return Ir(n,e);if(ie(e))return void 0}else if(ae(n)){if(j(e)||B(e)||te(e)||J(e)||Y(e))return ee(e,n);if(ae(e))return void 0;if(ne(e))return e.asCircle(),void 0;if(ie(e))return void 0}else if(ne(n)){if(j(e)||B(e)||te(e)||J(e)||Y(e)||ae(e))return ee(e,n);if(ne(e))return Or(e,n);if(ie(e))return void 0}else if(ie(n)){if(j(e)||B(e)||te(e)||J(e)||Y(e)||ne(e))return ee(e,n);if(ie(e))return void 0}}const Lr=(()=>{const n=O();return(e,t)=>{const{start:i,end:r}=e;if(jn(i,r)&&E(i[2],t.z))return e;const s=I();return xn(t.getPlane(n),i,r,s)?new Pe(s):void 0}})();function $r({lineLike:n},{center:e,radius:t}){const i=e[2];return k(Dn(n,e,t).filter(r=>E(r[2],i)))}function br({lineLike:n},{sphere:e}){return k(ji(e,n.start,n.end))}const Ut=(()=>{const n=Ci(),e=y(),t=y();return(i,r,s)=>{const{normal:a,center:o,radius:l}=r;bn(a,e,t);const c=$n(i),u=l*M(c,e),d=l*M(c,t);Fi(n,o[0],o[1],o[2],1);const p=Vi(i,n),g=Math.hypot(u,d),v=E(g,0);if(E(Lt(i,o),0)){if(v)return r;if(E(l,0))return!s||he(s,o)?new Pe($e(o)):void 0;We(e,c,a),_i(e,e);const dt=new Array,De=pe(o);T(De,De,e,l),s&&!he(s,De)||dt.push(De);const ze=pe(o);return T(ze,ze,e,-l),s&&!he(s,ze)||dt.push(ze),k(dt)}if(v)return;const m=-p/g;if(Math.abs(m)>1||E(m,1))return;const _=Math.atan(u/d),x=Si(m)-_,ge=Math.PI-x,A=new Array,Q=y();T(Q,o,e,l*Math.cos(x)),T(Q,Q,t,l*Math.sin(x)),A.push(Q);const W=y();return T(W,o,e,l*Math.cos(ge)),T(W,W,t,l*Math.sin(ge)),A.push(W),k(s?lr(s,A):A)}})();function Tr(n,e){return E(n.z,e.z)?n:void 0}function Pr({z:n},{planeLike:e}){const[t,i]=e.start,[r,s]=e.end,a=U(t,i,n),o=U(r,s,n);return e.type===C.PLANE?new Ht(a,o):new hr(a,o)}function Rr(n,e){const[t,i]=e.center;return new kt(U(t,i,n.z),e.radius)}function Nr(n,e){return E(e.center[2],n.z)?e:void 0}const Mr=(()=>{const n=O();return(e,t)=>Ut(e.getPlane(n),t,t.slicePlane)})();function Ar(n,{center:e,radius:t}){const i=Math.abs(e[2]-n.z);if(i>t&&!E(i,t))return;const r=U(e[0],e[1],n.z),s=Math.sqrt(t**2-i**2);return E(s,0)?void 0:new kt(r,s)}const Fr=(()=>{const n=O();return(e,{center:t,radius:i})=>{const r=It(e.planeLike,t,i),s=t[2];e.getSlicePlane(n);const a=new Array;for(const[o,l]of r){const c=[o,l,s];he(n,c)&&a.push(c)}return k(a)}})(),Vr=(()=>{const n=O(),e=O();return(t,i)=>Ut(t.getPlane(n),i,t.getSlicePlane(e))})(),Cr=(()=>{const n=O();return(e,{center:t,radius:i})=>{const r=e.getPlane(n),s=Di(r,t),a=Math.abs(s);if(a>i&&!E(a,i))return;const o=Math.sqrt(i**2-s**2);if(E(o,0)){const u=I();return Ln(r,t,u),new Pe(u)}const l=I(),c=pe($n(r));return T(l,t,c,s),new Gt(l,o,c,e.getSlicePlane())}})();function Ir(n,e){const t=me(n.center,e.center);return E(t,0)&&E(n.radius,e.radius)?e:Jn(Dt(n.center,n.radius,e.center,e.radius),e.center[2])}function Or(n,e){if(!jn(n.center,e.center))return;const t=me(n.center,e.center);return E(t,0)&&E(n.radius,e.radius)?n:Jn(Dt(n.center,n.radius,e.center,e.radius),n.center[2])}function sn(n,e){const{planeLike:t,getZ:i}=n,r=new Array;if(j(e))n.addIfOnTheGround(r,sr(t,e.point));else if(B(e))n.addIfOnTheGround(r,Vn(t,e.lineLike));else if(Y(e))for(const[s,a]of It(t,e.center,e.radius)){const o=i(s,a);o!=null&&r.push(Ue(s,a,o))}else if(J(e)||Ke(e))for(const[s,a]of Cn(t,e.planeLike)){const o=i(s,a)??Yn;r.push(Ue(s,a,o))}return k(r)}function gt(n){return Wt(n.map(([e,t])=>{const i=U(e,t,0),r=U(e,t,1);return new Ht(i,r)}))}function k(n){return Wt(n.map(e=>e?new Pe(e):void 0))}function Jn(n,e){return k(n.map(([t,i])=>[t,i,e]))}function Wt(n){if(n.length!==0)return n.length===1?n[0]??void 0:new Gn(n.filter(gn))}function Tt(n){return n instanceof Gn}function j(n){return n instanceof Pe}function B(n){return n instanceof qt}function te(n){return n instanceof fr}function J(n){return n instanceof Zt}function Y(n){return n instanceof Zn}function ne(n){return n instanceof kt}function ae(n){return n instanceof Gt}function ie(n){return n instanceof vr}function Ke(n){return n instanceof Bn}function Dr(n){return n instanceof _r}function zr(n){return n instanceof mr}const Yn=0;var q;function jr(n,e){if(n==null||e==null)return;const t=Pt(n,e);return t!=null?_e(t,"radians","geographic"):void 0}(function(n){n.Absolute="absolute",n.Relative="relative",n.RelativeBilateral="relative-bilateral"})(q||(q={}));const Pt=(()=>{const n=y(),e=y();return(t,i)=>(Z(n,t.x,t.y,t.z??0),Z(e,i.x,i.y,i.z??0),Ve(n,e,t.spatialReference,i.spatialReference))})(),Ve=(()=>{const n=G(),e=y(),t=y();return(i,r,s,a)=>{if(w(i,r))return;const o=xt(s),l=xt(a);if(o&&l&&$i(o,l)&&Je(i,s,e,o)&&Je(r,a,t,l)){const{azimuth:u}=At(Hr,e,t,o);return u!=null?Nt(u,"degrees","radians"):void 0}n[0]=r[0]-i[0],n[1]=r[1]-i[1];let c=Ri(Ai,n);return n[0]<0&&(c=kr-c),c}})();function ao(n,e,t,i=q.Absolute){if(e&&t)switch(i){case q.Absolute:return jr(e,t);case q.Relative:return an(on(n,e,t),q.Relative);case q.RelativeBilateral:return an(on(n,e,t),q.RelativeBilateral)}}function on(n,e,t){if(!n||!e||!t)return;const i=Pt(n,e),r=Pt(e,t);return i!=null&&r!=null?_e(r-i,"radians","geographic"):void 0}function an(n,e){if(n!=null)switch(e){case q.Absolute:return qr(n);case q.Relative:{const t=et(n);let i=ln.normalize(t,0,!0);return i===-180&&(i=180),_e(i,"degrees","geographic")}case q.RelativeBilateral:{const t=et(n),i=Math.abs(ln.normalize(t,0,!0));return _e(i,"degrees","geographic")}}}function qr(n){const e=et(n),t=Gr.normalize(e,0,!0);return _e(t,"degrees","geographic")}const Xn=(()=>{const n=y();return(e,t,i,r,s,a="geodesic")=>{nt(n,t);const o=et(s);if(a==="geodesic"){const g=xt(i);if(g&&Je(n,i,n,g))return Xe(e,n,o,r,g),e[2]=t[2],!!Je(e,g,e,i)}const l=Ct(o,"geographic","arithmetic"),c=Nt(l,"degrees","radians"),u=t[0]+r*Math.cos(c),d=t[1]+r*Math.sin(c),p=t[2];return Z(e,u,d,p),!0}})();function et(n){if(n!=null)return Ct(Qn(n),n.rotationType,"geographic")}function lo(n){if(n!=null)return Ct(Qn(n),n.rotationType,"arithmetic")}function Qn(n){return Nt(n.value,n.unit,"degrees")}const Hr=new Ft,kr=2*Math.PI,Gr=Ki,ln=new er(-180,180);function Se(n,e){const t=n.x-e.x,i=n.y-e.y;return t*t+i*i}function Zr(n,e){return Math.sqrt(Se(n,e))}function Bt(n,e){e.sort((t,i)=>Be(t.targetPoint,n)-Be(i.targetPoint,n))}var D;function co({point:n,distance:e,returnEdge:t,vertexMode:i,coordinateHelper:{spatialReference:r},filter:s},a,o){return o=o!=null?o.clone():new Ji({where:"1=1"}),s&&(o.geometry=s.geometry,o.distance=s.distance,o.spatialRelationship=s.spatialRelationship,o.where=Vt(o.where,s.where),o.timeExtent=Bi(o.timeExtent,s.timeExtent),o.objectIds=Ur(o.objectIds,s.objectIds)),{point:it(n[0],n[1],n[2],r.toJSON()),mode:a,distance:e,returnEdge:t,vertexMode:i,query:o.toJSON()}}function Ur(n,e){return n||e?e?n?Array.from(oi(new Set(n),new Set(e))):e:n:null}function tt(n,e,t){return{left:$(n.leftVertex.pos,e,t),right:$(n.rightVertex.pos,e,t)}}function uo(n){return n.createQuery()}(function(n){n[n.TARGET=0]="TARGET",n[n.REFERENCE=1]="REFERENCE",n[n.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(D||(D={}));const cn=Symbol("snapping-toggle");function ho(n,e=()=>{}){const t=ve(()=>({view:n.view,snappingOptions:n.snappingOptions}),({view:i,snappingOptions:r})=>{if(n.removeHandles(cn),!i||!r)return;const s=Yi.TOOL,a=[i.on("key-down",o=>{o.key!==Kt.toggle||o.repeat||(r.enabledToggled=!0,e())},s),i.on("key-up",o=>{o.key===Kt.toggle&&(r.enabledToggled=!1,e())},s),i.on("pointer-move",o=>{const l=o.native.ctrlKey;r.enabledToggled!==l&&(r.enabledToggled=l,e())},s)];n.addHandles(a,cn)},Ze);n.addHandles(t)}function un(n){var e;return Xi(n)&&"utilityNetworks"in n&&!!((e=n.utilityNetworks)!=null&&e.length)}let le=class extends Te{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new xe}};h([f({constructOnly:!0})],le.prototype,"layer",void 0),h([f()],le.prototype,"enabled",void 0),h([f()],le.prototype,"updating",void 0),h([f()],le.prototype,"availability",void 0),h([f()],le.prototype,"sublayerSources",void 0),le=h([fe("esri.views.interactive.snapping.FeatureSnappingLayerSource")],le);const Kn=le;let R=class extends Te{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.attributeRulesEnabled=!1,this.featureSources=new xe,this.distance=se.distance,this.touchSensitivityMultiplier=se.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){var l;const e=this.featureSources;e.some(dn)&&yn.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const t=e.filter(Jr),i=((l=this._get("_effectiveFeatureSources"))==null?void 0:l.filter(dn))??new xe;for(const c of t){const u=i.find(d=>d.layer===c.layer.parent);if(u)u.sublayerSources.includes(c)||u.sublayerSources.add(c);else if(c.layer.parent){const d=new Kn({layer:c.layer.parent});d.sublayerSources.add(c),i.add(d)}}for(const c of i){const u=c.sublayerSources.filter(d=>!t.includes(d));c.sublayerSources.removeMany(u)}i.removeMany(i.filter(c=>c.sublayerSources.length===0));const r=e.filter(Br),s=this._get("_effectiveFeatureSources")??new xe,{added:a,removed:o}=ui(s.toArray(),[...r,...i]);return s.removeMany(o),s.addMany(a),s}};h([f()],R.prototype,"enabled",void 0),h([f()],R.prototype,"enabledToggled",void 0),h([f()],R.prototype,"forceDisabled",void 0),h([f()],R.prototype,"selfEnabled",void 0),h([f()],R.prototype,"featureEnabled",void 0),h([f()],R.prototype,"attributeRulesEnabled",void 0),h([f({type:xe.ofType(Kn)})],R.prototype,"featureSources",void 0),h([f()],R.prototype,"distance",void 0),h([f()],R.prototype,"touchSensitivityMultiplier",void 0),h([f({readOnly:!0})],R.prototype,"effectiveEnabled",null),h([f({readOnly:!0})],R.prototype,"effectiveSelfEnabled",null),h([f({readOnly:!0})],R.prototype,"effectiveFeatureEnabled",null),h([f({readOnly:!0})],R.prototype,"_effectiveFeatureSources",null),R=h([fe("esri.views.interactive.snapping.SnappingOptions")],R);const Wr=R;function dn(n){return n.layer.type==="subtype-group"}function Br(n){return n.layer.type!=="subtype-group"}function Jr(n){return n.layer.type==="subtype-sublayer"}let F=class extends Te{set attributeRulesEnabled(e){this._set("attributeRulesEnabled",e),e&&this.loadRules()}get layerView(){var e,t;return(t=(e=this.view)==null?void 0:e.allLayerViews)==null?void 0:t.find(i=>i.layer===this.layer)}get valid(){const{_valid:e,snappingSource:t,layer:i}=this;return!(!t||!i)&&e}get subtypeFilter(){var s,a;const{layer:e,snappingSource:t}=this;if(!qe(e)||!((s=e.subtypes)!=null&&s.length)||!t)return{mode:"not-in-use",filter:null};const i=t.layerSource.sublayerSources.filter(o=>{var l;return o.enabled&&o.layer.visible&&Qi((l=this.view)==null?void 0:l.scale,o.layer.effectiveScaleRange.minScale,o.layer.effectiveScaleRange.maxScale)}).map(o=>o.layer.subtypeCode);if(!i.length)return{mode:"none-visible",filter:null};if(i.length===e.subtypes.length)return{mode:"all-visible",filter:null};const r=((a=e.fieldsIndex.get(e.subtypeField))==null?void 0:a.name)??e.subtypeField;return i.length===1?{mode:"in-use",filter:`${r} = ${i.getItemAt(0)}`}:{mode:"in-use",filter:`${r} IN (${i.join(", ")})`}}get floorFilter(){const{view:e,layer:t}=this;return e&&t?Wi({view:e,layer:t}):null}constructor(e){super(e),this.layer=null,this.snappingSource=null,this.rulesTable=null,this._valid=null}initialize(){if(!this.snappingSource||!this.layer)return void(this._valid=!1);const{layer:e,snappingSource:t}=this;if("refresh"in e){const i=e;this.addHandles(i.on("refresh",()=>t.refresh()))}this.loadRules(),this.addHandles([ve(()=>t.updating,i=>t.layerSource.updating=i,Ze),ve(()=>t.availability,i=>t.layerSource.availability=i,Ze)])}getFetchCandidatesParameters(e,t,i){var p,g,v,m,_;if(!this.valid)return[];const{layer:r,layerView:s,floorFilter:a,rulesTable:o,subtypeFilter:l}=this,c={distance:i,mode:((p=this.view)==null?void 0:p.type)??"2d",point:e,coordinateHelper:t.coordinateHelper,...Yr(),filter:s&&"filter"in s?s.filter:null};if(a&&(c.filter=yt(c.filter,a)),l.mode!=="not-in-use"&&l.mode!=="all-visible"){if(l.mode==="none-visible")return[];c.filter?c.filter.where=Vt(c.filter.where,l.mode):c.filter=new ke({where:l.filter})}if(!this.attributeRulesEnabled)return[c];const u=t.feature,d=((g=u==null?void 0:u.sourceLayer)==null?void 0:g.type)==="subtype-sublayer"?u.sourceLayer.parent:u==null?void 0:u.sourceLayer;if(o&&u&&un((v=this.view)==null?void 0:v.map)&&(pt(r)||qe(r))&&r.layerId&&(pt(d)||qe(d))&&((m=this.view.map.utilityNetworks)!=null&&m.find(x=>x.isUtilityLayer(d)))){if(o.loadStatus!=="loaded")return[];const x=[],ge=r.layerId,A=(_=o.getFeatureSQL(d,u))==null?void 0:_[ge];if(!A)return[];const Q=A.anyVertex;let W=A.endVertex;return W&&Q&&W===Q&&(W=""),W&&x.push({...c,returnEdge:!1,vertexMode:"ends",filter:yt(c.filter,W)}),Q&&x.push({...c,returnEdge:!1,vertexMode:"all",filter:yt(c.filter,Q)}),x}return[c]}async loadRules(){var r,s,a;this._valid=null;const{layer:e,view:t,attributeRulesEnabled:i}=this;if(i&&e&&t&&un(t==null?void 0:t.map)&&(pt(e)||qe(e)))try{await Promise.allSettled(((r=t.map.utilityNetworks)==null?void 0:r.map(l=>l.load()))??[]);const o=(s=t.map.utilityNetworks)==null?void 0:s.find(l=>l.isUtilityLayer(e));o&&(this.rulesTable=await o.getRulesTable(),await((a=this.rulesTable)==null?void 0:a.load()))}catch{return this._valid=!1,void yn.getLogger("esri.views.interactive.snapping.FeatureSnappingSourceInfo").error("Failed to load rules table for snapping source",e.title)}this._valid=!0}remove(){this.destroy()}destroy(){var e;(e=this.snappingSource)==null||e.destroy()}};function Yr(){return{returnEdge:!0,vertexMode:"all"}}function yt(n,e){return n==null?new ke({where:e}):n.where?new ke({where:Vt(n.where,e)}):new ke({where:e})}h([f({constructOnly:!0})],F.prototype,"layer",void 0),h([f({constructOnly:!0})],F.prototype,"snappingSource",void 0),h([f({constructOnly:!0})],F.prototype,"view",void 0),h([f({value:!1})],F.prototype,"attributeRulesEnabled",null),h([f()],F.prototype,"layerView",null),h([f()],F.prototype,"rulesTable",void 0),h([f()],F.prototype,"valid",null),h([f()],F.prototype,"subtypeFilter",null),h([f()],F.prototype,"floorFilter",null),h([f()],F.prototype,"_valid",void 0),F=h([fe("esri.views.interactive.snapping.FeatureSnappingSourceInfo")],F);class Re{constructor(e,t,i,r){this.targetPoint=e,this.constraint=t,this.isDraped=i,this.domain=r}}let Jt=class extends Re{constructor({targetPoint:e,objectId:t,constraint:i,isDraped:r}){super(e,i,r,b.FEATURE),this.objectId=t}},ei=class extends Jt{constructor(e){super({...e,isDraped:!0,constraint:new Bn(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new X(D.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},ti=class extends Jt{constructor(e){super({...e,constraint:new Ht(e.edgeStart,e.edgeEnd)})}get hints(){return[new X(D.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}};class Yt extends Re{constructor({targetPoint:e,constraint:t,previousVertex:i,otherVertex:r,otherVertexType:s,isDraped:a,selfSnappingType:o,objectId:l,domain:c}){super(e,t,a,c??b.SELF),this.previousVertex=i,this.otherVertex=r,this.otherVertexType=s,this.selfSnappingType=o??ue.None,this.objectId=l??null}get hints(){const e=this.previousVertex,t=this.otherVertexType===be.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===be.CENTER?this.targetPoint:this.otherVertex;return[new X(D.TARGET,t,i,this.isDraped,this.domain),new X(D.REFERENCE,e,t,this.isDraped,this.domain),new ot(this.previousVertex,t,i,this.isDraped,this.domain)]}}var be,ue;(function(n){n[n.NEXT=0]="NEXT",n[n.CENTER=1]="CENTER"})(be||(be={})),function(n){n[n.None=0]="None",n[n.LastVertex=1]="LastVertex",n[n.FirstVertex=2]="FirstVertex",n[n.ExistingEdge=3]="ExistingEdge"}(ue||(ue={}));let ce=class extends Te{get updating(){return this._snappingSources.some(e=>{var t;return(e==null?void 0:e.valid)==null||e.valid===!0&&((t=e.snappingSource)==null?void 0:t.updating)===!0})||this._updatingHandles.updating}constructor(e){super(e),this.options=null,this._domain=b.FEATURE,this._updatingHandles=new Ni,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){const e=hi(()=>{var t;return(t=this.options)==null?void 0:t._effectiveFeatureSources},(t,i)=>this._createSourceInfo(t,i));this._snappingSources=e,this.addHandles([di(e),ve(()=>{var t;return{rulesEnabled:!!((t=this.options)!=null&&t.attributeRulesEnabled),sources:this._snappingSources.filter(gn)}},({rulesEnabled:t,sources:i})=>{for(const r of i)r.attributeRulesEnabled=t},St)])}destroy(){this._set("options",null),this._updatingHandles.destroy()}async fetchCandidates(e,t,i,r){var l,c,u;if(!(t&this._domain&&this.options!=null&&this.options.effectiveFeatureEnabled))return[];const s=[],a=this._computeScreenSizeDistanceParameters(e,i);for(const d of this._snappingSources){if(!(d!=null&&d.valid)||!((c=(l=d.snappingSource)==null?void 0:l.layerSource)!=null&&c.enabled)||(u=d.layerView)!=null&&u.suspended)continue;const p=d.getFetchCandidatesParameters(e,i,a);for(const g of p)s.push(d.snappingSource.fetchCandidates(g,r).then(v=>v.filter(m=>!this._candidateIsExcluded(d.snappingSource,m,i.excludeFeature))))}const o=(await ai(s)).flat();return this._addRightAngleCandidates(o,e,a,i),ht(r),Bt(e,o),o}_addRightAngleCandidates(e,t,i,r){var d,p,g,v,m,_,x,ge;const s=r.vertexHandle!=null?(p=(d=r.vertexHandle.rightEdge)==null?void 0:d.rightVertex)==null?void 0:p.pos:r.editGeometryOperations!=null&&r.editGeometryOperations.data.type==="polygon"?(v=(g=r.editGeometryOperations.data.components[0])==null?void 0:g.getFirstVertex())==null?void 0:v.pos:null,a=r.vertexHandle!=null?(_=(m=r.vertexHandle.leftEdge)==null?void 0:m.leftVertex)==null?void 0:_.pos:r.editGeometryOperations!=null?(ge=(x=r.editGeometryOperations.data.components[0])==null?void 0:x.getLastVertex())==null?void 0:ge.pos:null,{view:o}=this,l=$(s,o,r),c=$(a,o,r),u=e.length;for(let A=0;A<u;A++)this._addRightAngleCandidate(e[A],c,t,i,e),this._addRightAngleCandidate(e[A],l,t,i,e)}_addRightAngleCandidate(e,t,i,r,s){if(t==null||!Xr(e))return;const a=e.constraint.closestTo(t),o=(a[0]-i[0])/r.x,l=(a[1]-i[1])/r.y,{start:c,end:u}=e.constraint;if(o*o+l*l<=1){const d=me(a,c)>me(a,u)?c:u,p=new Yt({targetPoint:de(a),otherVertex:t,otherVertexType:be.NEXT,previousVertex:d,constraint:new Un(t,a),objectId:e.objectId,isDraped:e.isDraped,domain:b.FEATURE});s.push(p)}}_computeScreenSizeDistanceParameters(e,t){let i=this.options!=null?this.options.distance*(t.pointer==="touch"?this.options.touchSensitivityMultiplier:1):0;return this.view==null?{x:i,y:i,z:i,distance:i}:this.view.type==="2d"?(i*=this.view.resolution,{x:i,y:i,z:i,distance:i}):this._computeScreenSizeDistanceParameters3D(e,i,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,i,r){const{spatialReference:s}=r;i.renderCoordsHelper.toRenderCoords(e,s,hn);const a=i.state.camera.computeScreenPixelSizeAt(hn),o=a*i.renderCoordsHelper.unitInMeters,l=o/En(s),c=o/bi(s),u=t*l,d=t*c,p=N(e,s,L,i),g=p?vt(p,e,l,0,0,i,r):0,v=p?vt(p,e,0,l,0,i,r):0,m=p?vt(p,e,0,0,c,i,r):0;return{x:g===0?0:u/g,y:v===0?0:u/v,z:m===0?0:d/m,distance:a*t}}_candidateIsExcluded(e,t,i){if(i==null)return!1;const r=this._getCandidateObjectId(t);if(r==null)return!1;const s=e.layerSource.layer;return s.type==="graphics"?i.uid===r:i.sourceLayer===s&&!(!i.attributes||!("objectIdField"in s))&&i.attributes[s.objectIdField]===r}_getCandidateObjectId(e){return e instanceof Jt?e.objectId:null}async _createSourceInfo(e,t){const i=e.layer;i.loaded||(await i.load(),ht(t));const{view:r}=this,s=await this._createFeatureSnappingSourceType(e);return ht(t),new F(s==null?{}:{snappingSource:s,view:r,layer:i})}async _createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}async _createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;return t==null||t.type!=="3d"?null:new(await this._getSourceModule("scene")).SceneLayerSnappingSource({layerSource:e,view:t})}async _createFeatureSnappingSourceFeatureLayer(e){var t;switch((t=e.layer.source)==null?void 0:t.type){case"feature-layer":case"oriented-imagery":return new(await this._getSourceModule("featureService")).FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e});case"memory":case"csv":case"geojson":case"wfs":return e.layer.geometryType==="mesh"?null:new(await this._getSourceModule("featureCollection")).FeatureCollectionSnappingSource({layerSource:e,view:this.view})}return null}async _createFeatureSnappingSourceGraphicsLayer(e){return new(await this._getSourceModule("graphics")).GraphicsSnappingSource({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _createFeatureSnappingSourceMapNotesLayer(e){return new(await this._getSourceModule("notes")).GraphicsSnappingSource({getGraphicsLayers:()=>{var t;return((t=e.layer.sublayers)==null?void 0:t.toArray())??[]},spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _getSourceModule(e){const t=this._sourceModules[e];if(t.loader==null){const i=this._loadSourceModule(e),r={module:null,loader:i};this._sourceModules[e]=r;const s=await i,a={module:s,loader:i};return this._sourceModules[e]=a,s}return t.module==null?t.loader:t.module}_loadSourceModule(e){const t=this._updatingHandles;switch(e){case"featureService":return t.addPromise(je(()=>import("./FeatureServiceSnappingSource-B-M0f3zY.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94]),import.meta.url));case"featureCollection":return t.addPromise(je(()=>import("./FeatureCollectionSnappingSource-C-1rTljs.js"),__vite__mapDeps([95,3,4,5,8,6,7,12,13,14,15,11,1,2,16,17,36,37,38,19,96,97,98,69,26,25,66,67,65,68,40,41,72,9,31,23,24,73,43,27,28,29,30,32,21,22,74,46,47,48,75,76,77,78,49,61,79,80,81,82,45,83,10,84,64,85,86,87,34,88,54,89,90,91,92,93,94]),import.meta.url));case"graphics":case"notes":return t.addPromise(je(()=>import("./GraphicsSnappingSource-C7eqxzdE.js"),__vite__mapDeps([99,3,4,5,6,7,8,9,25,15,26,13,14,11,1,2,19,69,66,67,100,61,101,43,102,57,103,104,105,106,107,108,109,92,110,111,112,113,114,115,116,117,98,97,118,119,120,48,81,121,122,46,47,123,54,77,124,23,24,125,126,59,60,127,128,58,129,10,130,22,131,132,49,133,134,135,85,71,12,16,17,136,40,41,52,53,55,56,45,137,138,139,140,141,36,37,38,96,65,68,72,31,73,27,28,29,30,32,21,74,75,76,78,79,80,82,83,84,64,86,87,34,88,89,90,91,93,94]),import.meta.url));case"scene":return t.addPromise(je(()=>import("./SceneLayerSnappingSource-B13GktJm.js"),__vite__mapDeps([142,3,4,5,9,6,7,143,62,63,64,11,1,2,47,48,14,144,145,146,72,19,23,147,31,24,148,149,150,151,152,153,154,155,21,22,25,15,26,13,27,28,29,30,32,37,38,69,66,67,12,16,17,65,68,40,41,73,43,74,46,75,76,77,78,49,61,79,80,81,82,45,83,10,84,85,86,87,34,88,54,89,90,91,92,93,94]),import.meta.url))}}get test(){}};function Xr(n){return(n instanceof ti||n instanceof ei)&&!Qr(n)}function Qr({constraint:{start:n,end:e}}){const t=Be(n,e),i=me(n,e);return t<Le()||i/t<es}function vt(n,e,t,i,r,s,{spatialReference:a}){const o=nt(Kr,e);o[0]+=t,o[1]+=i,o[2]+=r;const l=N(o,a,L,s);return l?Zr(l,n):1/0}h([f({constructOnly:!0})],ce.prototype,"spatialReference",void 0),h([f({constructOnly:!0})],ce.prototype,"view",void 0),h([f()],ce.prototype,"options",void 0),h([f({readOnly:!0})],ce.prototype,"updating",null),h([f()],ce.prototype,"_snappingSources",void 0),ce=h([fe("esri.views.interactive.snapping.FeatureSnappingEngine")],ce);const hn=y(),Kr=y(),es=1e-4;class ut{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=se.shortLineThreshold*se.shortLineThreshold}snap(e,t){return t.vertexHandle!=null?t.vertexHandle.type!=="vertex"?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold($(e.leftVertex.pos,this.view,t),$(e.rightVertex.pos,this.view,t),t)}exceedsShortLineThreshold(e,t,{spatialReference:i}){return this.squaredShortLineThreshold===0||Se(N(t,i,L,this.view),N(e,i,L,this.view))>this.squaredShortLineThreshold}isVertical(e,t,{spatialReference:i}){const r=En(i);return Mt(e,t)*r<se.verticalLineThresholdMeters}squaredProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}}let ni=class extends Re{constructor({lineStart:e,lineEnd:t,targetPoint:i,isDraped:r}){super(i,new Wn(e,t),r,b.SELF),this._referenceLineHint=new X(D.REFERENCE_EXTENSION,e,t,r,this.domain)}get hints(){return[this._referenceLineHint,new X(D.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}};class ts extends ut{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],r=i.edges.length,s=[];if(r<1)return s;const{spatialReference:a}=t,o=N(e,a,L,this.view),{view:l}=this,c=i.edges[r-1];let u=c;do{if(this.edgeExceedsShortLineThreshold(u,t)){const d=tt(u,l,t);this._processCandidateProposal(d.left,d.right,e,o,t,s)}u=u.leftVertex.leftEdge}while(u&&u!==c);return s}snapExistingVertex(e,t){const i=[],r=t.vertexHandle,s=r.component;if(s.edges.length<2)return i;const{view:a}=this,{spatialReference:o}=t,l=N(e,o,L,a),c=r.leftEdge,u=r.rightEdge;c&&u&&this.edgeExceedsShortLineThreshold(c,t)&&this.edgeExceedsShortLineThreshold(u,t)&&this._processCandidateProposal($(c.leftVertex.pos,a,t),$(u.rightVertex.pos,a,t),e,l,t,i);const d=s.edges[0];let p=d;do{if(p!==r.leftEdge&&p!==r.rightEdge&&this.edgeExceedsShortLineThreshold(p,t)){const g=tt(p,a,t);this._processCandidateProposal(g.left,g.right,e,l,t,i)}p=p.rightVertex.rightEdge}while(p&&p!==d);return i}_processCandidateProposal(e,t,i,r,s,a){var d;const{spatialReference:o,pointer:l}=s,c=y();ns(c,e,t,i,s);const u=de(c);Se(r,N(u,o,L,this.view))<this.squaredProximityThreshold(l)&&a.push(new ni({lineStart:e,lineEnd:t,targetPoint:u,isDraped:((d=s.elevationInfo)==null?void 0:d.mode)==="on-the-ground"}))}}function ns(n,e,t,i,r){is(n,e,t,i,r)||rs(n,i,e,t)}function is(n,e,t,i,{spatialReference:r}){const s=Ve(e,t,r,r);if(s==null)return!1;const a=Ve(t,i,r,r);if(a==null)return!1;const o=Tn(t,i,r);if(o==null)return!1;const l=Math.abs(tr.shortestSignedDiff(s,a))>Math.PI/2?Pn.normalize(s+Math.PI):s;return Xn(n,t,r,Rn(o,"meters"),_e(l,"radians","geographic"),"geodesic"),n[2]=i[2],!0}function rs(n,e,t,i){Ot(e,{start:t,end:i,type:P.LINE},n),n[2]=e[2]}let ii=class extends Re{constructor({referenceLine:e,lineStart:t,targetPoint:i,isDraped:r}){const s=pe(t),{left:a,right:o}=e;Ce(s,xi(s,s,o),a),super(i,new Wn(t,s),r,b.SELF),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new X(D.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new rr(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new X(D.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(i=>{w(e.right,i.edge.left)&&(i.fadeLeft=!1,t.fadeRight=!1),w(e.right,i.edge.right)&&(i.fadeRight=!1,t.fadeRight=!1),w(e.left,i.edge.right)&&(i.fadeRight=!1,t.fadeLeft=!1),w(e.left,i.edge.left)&&(i.fadeLeft=!1,t.fadeLeft=!1)}),this._referenceLines.push(t)}},ss=class extends ut{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],r=i.edges.length,s=i.vertices.length,a=[];if(r<2)return a;const{view:o}=this,l=N(e,t.spatialReference,L,o),c=$(i.vertices[s-1].pos,o,t),u=$(i.vertices[0].pos,o,t),d=i.edges[r-1];let p=d;do{if(this.edgeExceedsShortLineThreshold(p,t)){const g=tt(p,o,t);this._checkEdgeForParallelLines(g,c,e,l,t,a),this._checkEdgeForParallelLines(g,u,e,l,t,a)}p=p.leftVertex.leftEdge}while(p&&p!==d);return a}snapExistingVertex(e,t){const i=[],r=t.vertexHandle,s=r.component;if(s.edges.length<3)return i;const{view:a}=this,o=N(e,t.spatialReference,L,a),l=r.leftEdge,c=r.rightEdge,u=s.vertices[0],d=$(u.pos,a,t),p=s.vertices.length,g=s.vertices[p-1],v=$(g.pos,a,t),m=s.edges[0];let _=m;do{if(_!==l&&_!==c&&this.edgeExceedsShortLineThreshold(_,t)){const x=tt(_,a,t);l&&this._checkEdgeForParallelLines(x,$(l.leftVertex.pos,a,t),e,o,t,i),c&&this._checkEdgeForParallelLines(x,$(c.rightVertex.pos,a,t),e,o,t,i),r===u?this._checkEdgeForParallelLines(x,v,e,o,t,i):r===g&&this._checkEdgeForParallelLines(x,d,e,o,t,i)}_=_.rightVertex.rightEdge}while(_&&_!==m);return i}_checkEdgeForParallelLines(e,t,i,r,s,a){var p;const o=e.left,l=e.right;if($t(ye,t,o,l),me(ye,t)<se.parallelLineThreshold)return;$t(ye,i,o,l,t);const{spatialReference:c,pointer:u}=s,d=de(U(ye[0],ye[1],i[2]));if(Se(r,N(d,c,L,this.view))<this.squaredProximityThreshold(u)){if(this.isVertical(d,t,s)||this.isVertical(o,l,s)||os(e,a))return;a.push(new ii({referenceLine:e,lineStart:t,targetPoint:d,isDraped:((p=s.elevationInfo)==null?void 0:p.mode)==="on-the-ground"}))}}};function os(n,e){const t=n.left,i=n.right;for(const r of e)if($t(ye,i,r.constraint.start,r.constraint.end,t),me(ye,i)<se.parallelLineThreshold)return r.addReferenceLine(n),!0;return!1}const ye=G();class as extends ut{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],r=[];if(i.vertices.length<2)return r;const{view:s}=this,a=N(e,t.spatialReference,L,s),o=i.vertices.at(-1);this._checkForSnappingCandidate(ue.LastVertex,r,o.leftEdge,o,o.leftEdge.leftVertex,e,a,t);const l=i.vertices[0];return this._checkForSnappingCandidate(ue.FirstVertex,r,l.rightEdge,l,l.rightEdge.rightVertex,e,a,t),r}snapExistingVertex(e,t){const i=[],r=t.vertexHandle;if(r.component.vertices.length<3)return i;const{view:s}=this,a=N(e,t.spatialReference,L,s),o=r.leftEdge,l=r.rightEdge;if(o!=null&&o.leftVertex.leftEdge){const c=o.leftVertex.leftEdge;this._checkForSnappingCandidate(ue.ExistingEdge,i,c,c.rightVertex,c.leftVertex,e,a,t)}if(l!=null&&l.rightVertex.rightEdge){const c=l.rightVertex.rightEdge;this._checkForSnappingCandidate(ue.ExistingEdge,i,c,c.leftVertex,c.rightVertex,e,a,t)}return i}_checkForSnappingCandidate(e,t,i,r,s,a,o,l){if(!this.edgeExceedsShortLineThreshold(i,l))return;const c=this.view,u=$(r.pos,c,l),d=$(s.pos,c,l);ls(pn,d,u,a,l),this._checkForSnappingCandidateAlongProjectedRay(e,t,d,u,pn,a,o,l)}_checkForSnappingCandidateAlongProjectedRay(e,t,i,r,s,a,o,l){var _;const{spatialReference:c,pointer:u}=l,d=oe(Rt,a,r),p=Ie(s,d)/Fe(s),g=Ae(Rt,r,s,p),v=de(U(g[0],g[1],a[2]));if(Se(o,N(v,c,L,this.view))>this.squaredProximityThreshold(u)||this.isVertical(v,r,l)||this.isVertical(r,i,l))return;const m=T(y(),r,s,Math.sign(p));t.push(new Yt({targetPoint:v,constraint:new Un(r,m),previousVertex:i,otherVertex:r,otherVertexType:be.CENTER,selfSnappingType:e,isDraped:((_=l.elevationInfo)==null?void 0:_.mode)==="on-the-ground"}))}}function ls(n,e,t,i,r){cs(n,e,t,i,r)||us(n,e,t)}function cs(n,e,t,i,{spatialReference:r}){const s=Ve(e,t,r,r);if(s==null)return!1;const a=Ve(t,i,r,r);if(a==null)return!1;const o=Math.sign(Pn.shortestSignedDiff(s,a))*Math.PI*.5,l=_e(s+o,"radians","geographic"),c=y(),u=Tn(t,i,r);return u!=null&&(Xn(c,t,r,Rn(u,"meters"),l,"geodesic"),Ce(n,c,t),!0)}function us(n,e,t){const i=oe(Rt,t,e);Z(n,i[1],-i[0],0)}const Rt=G(),pn=y();class ri extends Re{constructor({targetPoint:e,point1:t,point2:i,isDraped:r}){super(e,new Zn(Li(y(),t,i,.5),.5*Mt(t,i)),r,b.SELF),this._p1=t,this._p2=i}get hints(){return[new X(D.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new X(D.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new ot(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}let ds=class extends ut{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],r=[],s=i.vertices.length;if(t.editGeometryOperations.data.type!=="polygon"||s<2)return r;const{view:a}=this,o=i.vertices[0],l=i.vertices[s-1],c=$(o.pos,a,t),u=$(l.pos,a,t);return this._processCandidateProposal(c,u,e,t,r),r}snapExistingVertex(e,t){const i=[],r=t.vertexHandle,s=r.component;if(s.edges.length<2||t.editGeometryOperations.data.type==="polyline"&&(r.index===0||r.index===s.vertices.length-1))return i;const{view:a}=this,o=$(r.leftEdge.leftVertex.pos,a,t),l=$(r.rightEdge.rightVertex.pos,a,t);return this._processCandidateProposal(o,l,e,t,i),i}_processCandidateProposal(e,t,i,r,s){var g;if(!this.exceedsShortLineThreshold(e,t,r))return;const a=Sn(fn,e,t,.5),o=.5*Mt(e,t),l=Ui(fn,i,a,o),c=de(U(l[0],l[1],i[2])),{spatialReference:u,pointer:d}=r,p=N(i,u,L,this.view);if(Se(p,N(c,u,L,this.view))<this.squaredProximityThreshold(d)){if(this.isVertical(e,c,r)||this.isVertical(c,t,r))return;s.push(new ri({targetPoint:c,point1:e,point2:t,isDraped:((g=r.elevationInfo)==null?void 0:g.mode)==="on-the-ground"}))}}};const fn=G();let we=class extends Te{constructor(n){super(n),this.updating=!1,this._snappers=new xe,this._domain=b.SELF}initialize(){this._snappers.push(new ss(this.view,this.options),new ts(this.view,this.options),new as(this.view,this.options),new ds(this.view,this.options))}set options(n){this._set("options",n);for(const e of this._snappers)e.options=n}async fetchCandidates(n,e,t){if(!(e&this._domain&&this.options.effectiveSelfEnabled))return[];const i=[];for(const r of this._snappers.items)for(const s of r.snap(n,t))i.push(s);return Bt(n,i),i}};h([f({readOnly:!0})],we.prototype,"updating",void 0),h([f({constructOnly:!0})],we.prototype,"view",void 0),h([f()],we.prototype,"options",null),we=h([fe("esri.views.interactive.snapping.SelfSnappingEngine")],we);function hs(n,e){return[new we({view:n,options:e}),new ce({view:n,options:e,spatialReference:n.spatialReference})]}class Ge extends Re{constructor(e,t,i,r){super(e,new Pe(e),r,b.ALL),this.first=t,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new ir(this.targetPoint,this.isDraped,this.domain)]}}let K=class extends si.EventedMixin(Te){constructor(n){super(n),this.options=new Wr,this.snappingEnginesFactory=hs,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=re.MAIN}initialize(){this.addHandles([ve(()=>{const{effectiveFeatureEnabled:n,effectiveSelfEnabled:e,touchSensitivityMultiplier:t,distance:i}=this.options;return{effectiveFeatureEnabled:n,effectiveSelfEnabled:e,touchSensitivityMultiplier:t,distance:i}},()=>{this.doneSnapping(),this.emit("changed")},St),ve(()=>this.options,n=>{for(const e of this._engines)e.options=n},St),ve(()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory}),({viewReady:n,snappingEnginesFactory:e})=>this._recreateEngines(n,e),Ze)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some(n=>n.updating)}_recreateEngines(n,e){if(this._destroyEngines(),!n)return;const{view:t,options:i}=this;this._engines=e(t,i)}_destroyEngines(){for(const n of this._engines)n.destroy();this._engines=[]}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:n,touchSensitivityMultiplier:e}=this.options,t=n*e;return t*t}snap(n){return gs(n)?this._snapMultiPoint(n):this._snapSinglePoint(n)}update(n){const{point:e,context:t}=n;this._removeVisualization();const i=this._currentMainCandidate;if(i==null)return e;const r=this._selectUpdateInput(n);if(r==null)return e;const{spatialReference:s}=t,a=Xt(r,s);if(a==null)return e;const{view:o}=this,{elevationInfo:l,visualizer:c}=t,u=[],d=Me(a,o,l),p=i.constraint.closestTo(d);if(!this._arePointsWithinScreenThreshold(d,p,t)||!_t(i,t.drawConstraints))return this._resetSnappingState(),e;i.targetPoint=de(p),u.push(...i.hints);for(const g of this._currentOtherActiveCandidates)_t(g,t.drawConstraints)&&(g.targetPoint=de(p),u.push(...g.hints));return c!=null&&this.addHandles(c.draw(u,{spatialReference:s,elevationInfo:ys(t),view:o,selfSnappingZ:t.selfSnappingZ}),mt),en(p,o,e,t)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:n,scenePoint:e}){switch(this._currentSnappedType){case re.MAIN:return n;case re.SCENE:return e}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=re.MAIN}_removeVisualization(){this.removeHandles(mt)}async _snapSinglePoint({point:n,context:e,signal:t}){const{view:i}=this,{elevationInfo:r}=e,s=Me(n,i,r),a=await this._fetchCandidates(s,b.ALL,e,t);return this._createSnapResult(s,re.MAIN,a,i,n,e,t)}async _snapMultiPoint({point:n,scenePoint:e,context:t,signal:i}){const{view:r}=this,{coordinateHelper:s,elevationInfo:a,spatialReference:o}=t;await pi(e.spatialReference,o);const l=Xt(e,o),c=Me(l,r,a),u=await this._fetchCandidates(c,b.FEATURE,t,i);if(u.length>0){const g=await this._fetchCandidates(c,b.SELF,t,i);return this._createSnapResult(c,re.SCENE,[...u,...g],r,l,t,i)}const d=Me(n,r,a),p=await this._fetchCandidates(d,b.SELF,t,i);return this._createSnapResult(d,re.MAIN,p,r,{z:s.hasZ()&&n.hasZ?n.z??0:void 0,m:s.hasM()&&n.hasM?n.m??0:void 0},t,i)}async _fetchCandidates(n,e,t,i){return(await Promise.all(this._engines.map(r=>r.fetchCandidates(n,e,t,i)))).flat()}_createSnapResult(n,e,t,i,r,s,a){return{get valid(){return!li(a)},apply:()=>{const{spatialReference:o}=s,{snappedPoint:l,hints:c}=this._processCandidates(n,e,t,s);return this._removeVisualization(),s.visualizer!=null&&this.addHandles(s.visualizer.draw(c,{spatialReference:o,elevationInfo:L,view:i,selfSnappingZ:s.selfSnappingZ}),mt),en(l,i,r,s)}}}_processCandidates(n,e,t,i){if(t.length<1)return this.doneSnapping(),{snappedPoint:n,hints:[]};this._currentSnappedType!==e&&this._resetSnappingState(),Bt(n,t);const r=this._currentMainCandidate;if(r!=null){const s=fs(r,t);if(s>=0){if(!(t[s]instanceof Ge))return this._intersectWithOtherCandidates(s,t,n,e,i);if(this._arePointsWithinScreenThreshold(n,r.targetPoint,i))return this._updateSnappingCandidate(r,e,t,i)}}return this._intersectWithOtherCandidates(0,t,n,e,i)}_intersectWithOtherCandidates(n,e,t,i,r){const{coordinateHelper:s}=r,a=e[n],o=[];for(let l=0;l<e.length;++l){if(l===n)continue;const c=e[l],u=a.constraint.intersect(c.constraint);if(u)for(const d of u.closestPoints(a.targetPoint))o.push([new Ge(de(d),a,c,c.isDraped),this._squaredScreenDistance(t,d,s)])}return o.length>0&&(o.sort((l,c)=>l[1]-c[1]),o[0][1]<this._squaredPointProximityThreshold(r.pointer))?this._updateSnappingCandidate(o[0][0],i,e,r):_t(a,r.drawConstraints)?this._updateSnappingCandidate(a,i,e,r):{snappedPoint:t,hints:[]}}_updateSnappingCandidate(n,e,t,i){this.doneSnapping(),this._currentMainCandidate=n,this._currentSnappedType=e;const r=this._currentMainCandidate.targetPoint,s=[];s.push(...n.hints);for(const a of t){if(n instanceof Ge){if(a.constraint.equals(n.first.constraint)||a.constraint.equals(n.second.constraint))continue}else if(a.constraint.equals(n.constraint))continue;const o=a.constraint.closestTo(r);this._squaredScreenDistance(o,r,i.coordinateHelper)<ps()&&(a.targetPoint=r,this._currentOtherActiveCandidates.push(a),s.push(...a.hints))}return{snappedPoint:r,hints:s}}_squaredPointProximityThreshold(n){return n==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(n,e,t){return this._squaredScreenDistance(n,e,t.coordinateHelper)<this._squaredPointProximityThreshold(t.pointer)}_squaredScreenDistance(n,e,t){return Se(this._toScreen(n,t),this._toScreen(e,t))}_toScreen(n,e){return N(n,e.spatialReference,L,this.view)}get test(){}};var re;h([f({constructOnly:!0})],K.prototype,"view",void 0),h([f()],K.prototype,"options",void 0),h([f({readOnly:!0})],K.prototype,"updating",null),h([f()],K.prototype,"snappingEnginesFactory",void 0),h([f()],K.prototype,"_engines",void 0),h([f()],K.prototype,"_squaredMouseProximityThreshold",null),h([f()],K.prototype,"_squaredTouchProximityThreshold",null),K=h([fe("esri.views.interactive.snapping.SnappingManager")],K),function(n){n[n.MAIN=0]="MAIN",n[n.SCENE=1]="SCENE"}(re||(re={}));const mt="visualization-handle";function ps(){return se.satisfiesConstraintScreenThreshold*se.satisfiesConstraintScreenThreshold}function _t(n,e){return!e||e.direction==null&&e.distance==null||!(n instanceof ei||n instanceof ti||n instanceof ni||n instanceof ii||n instanceof ri)&&(!(n instanceof Yt)||e.direction==null&&n.selfSnappingType===ue.LastVertex)}function fs(n,e){return n instanceof Ge?Et(e,n.first)>=0&&Et(e,n.second)>=0?0:-1:Et(e,n)}function Et(n,e){let t=-1;for(let i=0;i<n.length;++i)if(e.constraint.equals(n[i].constraint)){t=i;break}return t}function gs(n){return n.scenePoint!=null}function ys({coordinateHelper:n,elevationInfo:e}){return n.hasZ()?L:e}export{et as A,q as B,Wt as C,fr as D,b as E,Un as F,_r as G,un as H,K as I,qr as J,an as K,j as L,Xn as M,ho as N,ao as O,ce as P,jr as R,no as T,lo as U,mr as Z,ot as a,st as b,de as c,ei as d,ti as e,U as f,Jt as g,Pe as h,Bt as i,uo as j,Wr as k,Kn as l,to as m,X as n,ir as o,se as p,io as q,rr as r,eo as s,D as t,Ks as u,Me as v,I as w,en as x,co as y,Zn as z};
