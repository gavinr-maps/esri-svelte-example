import{C as ue,E as fe,g as pe,p as we,B as de,f as he,y as me,s as ge,a as z,b as ye,c as S,n as h,d as G,D as Y,e as Q}from"./arcade-CrJG569S.js";import{o as T,e as P,_ as g,I as V,v as p,G as v,Y as y,L as K,b as f,H as J,a as O,W as D,y as A,c as be,m as L,d as ve,A as Se,s as xe,f as q,r as Ie,n as _,B as X,U as $}from"./deepClone-DC5Ed1NQ.js";import{a as i,r as l,u as ee}from"./executionError-HS8X1L-B.js";import{registerFunctions as Fe}from"./geomasync-BwoUShY1.js";import{g as re,b as H}from"./Point-XGrwlf63.js";import{Q as M,i as d,R as N,n as R,M as Me}from"./opacityUtils-CSd4XoR2.js";import"./index-tefRSezt.js";import"./Accessor-BHnuXKD2.js";import"./ImmutableArray-BPVd6ESQ.js";import"./jsonUtils-Cu7OBRmN.js";import"./Extent-CBBGeHb-.js";import"./Polyline-BmuD2-ZN.js";import"./writer-B2bQV2uU.js";import"./mathUtils-DV9iOXpW.js";import"./TimeOnly-yGYcAQQJ.js";import"./Promise-CmQqe-ke.js";import"./cast-BA_-jlhc.js";import"./JSONSupport-CGdeqxpk.js";import"./featureConversionUtils-DpmsPUmt.js";import"./aaBoundingBox-CeBivBRq.js";import"./OptimizedFeature-DcMLlxvB.js";import"./memoryEstimations-5gFNwkKK.js";import"./OptimizedGeometry-7IxBWtHr.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./FieldsIndex-DFdVonga.js";import"./timeZoneUtils-COos5xIr.js";import"./shared-M7rSkUll.js";import"./Field-Cyk7Ur5d.js";import"./enumeration-Cr5WIZs4.js";import"./fieldType-L-VlbZqy.js";import"./WhereClause-diW5rNp6.js";import"./unitConversion-BDsSPToO.js";import"./number-BWHn6sm2.js";import"./hash-CcEbRgUF.js";import"./uuid-Cl5lrJ4c.js";import"./Portal-CTRRujjZ.js";import"./portalUtils-3wOWt06C.js";import"./operatorsWorkerConnection-Cx2N5ggJ.js";import"./workers-D8Q3pEzK.js";import"./Queue-BOnccek2.js";import"./SimpleObservable-7oieNGD8.js";import"./intl-Do3GEEJ7.js";import"./utils-Cf-KB5Fk.js";async function W(r,e){const n=[];for(let o=0;o<e.arguments.length;o++)n.push(await u(r,e.arguments[o]));return n}async function F(r,e,n){return e.preparsed===!0?n(r,null,e.arguments):n(r,e,await W(r,e))}class ke extends Ie{constructor(e,n){super(),this.definition=null,this.context=null,this.definition=e,this.context=n}createFunction(e){return(...n)=>{const o={spatialReference:this.context.spatialReference,console:this.context.console,lrucache:this.context.lrucache,timeZone:this.context.timeZone??null,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,localScope:{},depthCounter:{depth:e.depthCounter+1},globalScope:this.context.globalScope};if(o.depthCounter.depth>64)throw new i(e,l.MaximumCallDepth,null);return Z(this.definition,o,n,null)}}call(e,n){return B(e,n,(o,t,a)=>{const s={spatialReference:e.spatialReference,services:e.services,console:e.console,libraryResolver:e.libraryResolver,exports:e.exports,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:{},abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:{depth:e.depthCounter.depth+1}};if(s.depthCounter.depth>64)throw new i(e,l.MaximumCallDepth,n);return Z(this.definition,s,a,n)})}marshalledCall(e,n,o,t){return t(e,n,async(a,s,c)=>{const x={spatialReference:e.spatialReference,globalScope:o.globalScope,depthCounter:{depth:e.depthCounter.depth+1},libraryResolver:e.libraryResolver,exports:e.exports,console:e.console,abortSignal:e.abortSignal,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:{}};return c=c.map(b=>!v(b)||b instanceof q?b:_(b,e,t)),_(await Z(this.definition,x,c,n),o,t)})}}class k extends xe{constructor(e){super(),this.source=e}global(e){const n=this.executingContext.globalScope[h(e)];if(v(n.value)&&!(n.value instanceof q)){const o=new q;o.fn=n.value,o.parameterEvaluator=B,o.context=this.executingContext,n.value=o}return n.value}setGlobal(e,n){if(v(n))throw new i(null,l.AssignModuleFunction,null);this.executingContext.globalScope[h(e)]={value:n}}hasGlobal(e){return this.executingContext.exports[e]===void 0&&(e=h(e)),this.executingContext.exports[e]!==void 0}async loadModule(e){let n=e.spatialReference;n==null&&(n=new re({wkid:102100})),this.moduleScope=se({},e.customfunctions,e.timeZone),this.executingContext={spatialReference:n,services:e.services,libraryResolver:new z(e.libraryResolver._moduleSingletons,this.source.syntax.loadedModules),exports:{},abortSignal:e.abortSignal===void 0||e.abortSignal===null?{aborted:!1}:e.abortSignal,globalScope:this.moduleScope,console:e.console??ce,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:null,depthCounter:{depth:1}},await j(this.executingContext,this.source.syntax)}}async function B(r,e,n){return e.preparsed===!0?n(r,null,e.arguments):n(r,e,await W(r,e))}async function u(r,e){e.breakpoint&&await e.breakpoint();try{switch(e.type){case"UpdateExpression":return await De(r,e);case"AssignmentExpression":return await Ke(r,e);case"TemplateLiteral":return await Ye(r,e);case"Identifier":return U(r,e);case"MemberExpression":return await We(r,e);case"Literal":return e.value;case"CallExpression":return await ze(r,e);case"UnaryExpression":return await je(r,e);case"BinaryExpression":return await _e(r,e);case"LogicalExpression":return await He(r,e);case"ArrayExpression":return await Te(r,e);case"ObjectExpression":return await Re(r,e);default:throw new i(r,l.Unrecognized,e)}}catch(n){throw ee(r,e,n)}}async function m(r,e){e.breakpoint&&await e.breakpoint();try{switch(e.type){case"ImportDeclaration":return await qe(r,e);case"ExportNamedDeclaration":return await Pe(r,e);case"VariableDeclaration":return await ae(r,e,0);case"BlockStatement":return await j(r,e);case"FunctionDeclaration":return await Le(r,e);case"ReturnStatement":return await Ge(r,e);case"IfStatement":return await Ze(r,e);case"ExpressionStatement":return await Ue(r,e);case"ForStatement":return await Ae(r,e);case"WhileStatement":return await Ce(r,e);case"ForInStatement":return await Be(r,e);case"ForOfStatement":return await Ee(r,e);case"BreakStatement":return y;case"EmptyStatement":return p;case"ContinueStatement":return K;default:throw new i(r,l.Unrecognized,e)}}catch(n){throw ee(r,e,n)}}async function Re(r,e){const n=[];for(let s=0;s<e.properties.length;s++){const c=e.properties[s],x=await u(r,c.value),b=c.key.type==="Identifier"?c.key.name:await u(r,c.key);n[s]={key:b,value:x}}const o={},t=new Map;for(let s=0;s<n.length;s++){const c=n[s];if(v(c.value))throw new i(r,l.NoFunctionInDictionary,e);if(d(c.key)===!1)throw new i(r,l.KeyMustBeString,e);let x=c.key.toString();const b=x.toLowerCase();t.has(b)?x=t.get(b):t.set(b,x),c.value===p?o[x]=null:o[x]=c.value}const a=new S(o);return a.immutable=!1,a}async function Ce(r,e){let n=await u(r,e.test);if(n===!1)return p;if(n!==!0)throw new i(r,l.BooleanConditionRequired,e);for(;n===!0;){const o=await m(r,e.body);if(o===y)break;if(o instanceof g)return o;if(n=await u(r,e.test),n!==!0&&n!==!1)throw new i(r,l.BooleanConditionRequired,e)}return p}async function Ae(r,e){var n;try{for(e.init!==null&&(e.init.type==="VariableDeclaration"?await m(r,e.init):await u(r,e.init));;){if(e.test!==null){const t=await u(r,e.test);if(((n=r.abortSignal)==null?void 0:n.aborted)===!0)throw new i(r,l.Cancelled,e);if(t===!1)break;if(t!==!0)throw new i(r,l.BooleanConditionRequired,e)}const o=await m(r,e.body);if(o===y)break;if(o instanceof g)return o;e.update!==null&&await u(r,e.update)}return p}catch(o){throw o}}async function E(r,e,n,o,t="i"){const a=n.length;for(let s=0;s<a;s++){if(t==="k"){if(s>=n.length)throw new i(r,l.OutOfBounds,e);o.value=n[s]}else o.value=s;const c=await m(r,e.body);if(c===y)break;if(c instanceof g)return c}return p}async function ne(r,e,n,o,t="i"){const a=n.length();for(let s=0;s<a;s++){o.value=t==="k"?n.get(s):s;const c=await m(r,e.body);if(c===y)break;if(c instanceof g)return c}return p}async function oe(r,e,n,o){const t=n.iterator(r.abortSignal);let a;for(;(a=await t.next())!=null;){const s=Y.createFromGraphicLikeObject(a.geometry,a.attributes,n,r.timeZone);s._underlyingGraphic=a,o.value=s;const c=await m(r,e.body);if(c===y)break;if(c instanceof g)return c}return p}async function Oe(r,e,n,o){for(const t of n.keys()){const a=n.field(t);o.value=new S({key:t,value:a});const s=await m(r,e.body);if(s===y)break;if(s instanceof g)return s}return p}async function Ne(r,e,n,o){for(const t of Q(n)){const a=G(n,t,r,e,1);o.value=new S({key:t,value:a});const s=await m(r,e.body);if(s===y)break;if(s instanceof g)return s}return p}async function Be(r,e){const n=await u(r,e.right);e.left.type==="VariableDeclaration"&&await m(r,e.left);const o=h(e.left.type==="VariableDeclaration"?e.left.declarations[0].id:e.left);let t=null;if(r.localScope!=null&&r.localScope[o]!==void 0&&(t=r.localScope[o]),t===null&&r.globalScope[o]!==void 0&&(t=r.globalScope[o]),t===null)throw new i(r,l.InvalidIdentifier,e);return N(n)||d(n)?await E(r,e,n,t):O(n)?await ne(r,e,n,t):n instanceof S||D(n)?await E(r,e,n.keys(),t,"k"):X(n)?await oe(r,e,n,t):$(n)?await E(r,e,Q(n),t,"k"):p}async function Ee(r,e){const n=await u(r,e.right);e.left.type==="VariableDeclaration"&&await m(r,e.left);const o=h(e.left.type==="VariableDeclaration"?e.left.declarations[0].id:e.left);let t=null;if(r.localScope!=null&&r.localScope[o]!==void 0&&(t=r.localScope[o]),t===null&&r.globalScope[o]!==void 0&&(t=r.globalScope[o]),t===null)throw new i(r,l.InvalidIdentifier,e);return N(n)||d(n)?await E(r,e,n,t,"k"):O(n)?await ne(r,e,n,t,"k"):n instanceof S||D(n)?await Oe(r,e,n,t):X(n)?await oe(r,e,n,t):$(n)?await Ne(r,e,n,t):p}async function De(r,e){const n=e.argument;if(n.type==="CallExpression")throw new i(r,l.NeverReach,e);if(n.type==="MemberExpression"){const a=await u(r,n.object);let s,c;if(n.computed===!0)s=await u(r,n.property);else{if(n.property.type!=="Identifier")throw new i(r,l.Unrecognized,e);s=n.property.name}if(N(a)){if(!R(s))throw new i(r,l.ArrayAccessorMustBeNumber,e);if(s<0&&(s=a.length+s),s<0||s>=a.length)throw new i(r,l.OutOfBounds,e);c=f(a[s]),a[s]=e.operator==="++"?c+1:c-1}else if(a instanceof S){if(d(s)===!1)throw new i(r,l.KeyAccessorMustBeString,e);if(a.hasField(s)!==!0)throw new i(r,l.FieldNotFound,e,{key:s});c=f(a.field(s)),a.setField(s,e.operator==="++"?c+1:c-1)}else if(a instanceof k){if(d(s)===!1)throw new i(r,l.ModuleAccessorMustBeString,e);if(a.hasGlobal(s)!==!0)throw new i(r,l.ModuleExportNotFound,e);c=f(a.global(s)),a.setGlobal(s,e.operator==="++"?c+1:c-1)}else{if(!J(a))throw O(a)?new i(r,l.Immutable,e):new i(r,l.InvalidParameter,e);if(d(s)===!1)throw new i(r,l.KeyAccessorMustBeString,e);if(a.hasField(s)!==!0)throw new i(r,l.FieldNotFound,e,{key:s});c=f(a.field(s)),a.setField(s,e.operator==="++"?c+1:c-1)}return e.prefix===!1?c:e.operator==="++"?c+1:c-1}const o=h(n);let t;if(r.localScope!=null&&r.localScope[o]!==void 0)return t=f(r.localScope[o].value),r.localScope[o]={value:e.operator==="++"?t+1:t-1},e.prefix===!1?t:e.operator==="++"?t+1:t-1;if(r.globalScope[o]!==void 0)return t=f(r.globalScope[o].value),r.globalScope[o]={value:e.operator==="++"?t+1:t-1},e.prefix===!1?t:e.operator==="++"?t+1:t-1;throw new i(r,l.InvalidIdentifier,e)}function I(r,e,n,o,t){switch(e){case"=":return r===p?null:r;case"/=":return f(n)/f(r);case"*=":return f(n)*f(r);case"-=":return f(n)-f(r);case"+=":return d(n)||d(r)?A(n)+A(r):f(n)+f(r);case"%=":return f(n)%f(r);default:throw new i(t,l.UnsupportedOperator,o)}}async function Ke(r,e){const n=e.left;if(n.type==="MemberExpression"){const t=await u(r,n.object);let a;if(n.computed===!0)a=await u(r,n.property);else{if(n.property.type!=="Identifier")throw new i(r,l.InvalidIdentifier,e);a=n.property.name}const s=await u(r,e.right);if(N(t)){if(!R(a))throw new i(r,l.ArrayAccessorMustBeNumber,e);if(a<0&&(a=t.length+a),a<0||a>t.length)throw new i(r,l.OutOfBounds,e);if(a===t.length){if(e.operator!=="=")throw new i(r,l.OutOfBounds,e);t[a]=I(s,e.operator,t[a],e,r)}else t[a]=I(s,e.operator,t[a],e,r)}else if(t instanceof S){if(d(a)===!1)throw new i(r,l.KeyAccessorMustBeString,e);if(t.hasField(a)===!0)t.setField(a,I(s,e.operator,t.field(a),e,r));else{if(e.operator!=="=")throw new i(r,l.FieldNotFound,e,{key:a});t.setField(a,I(s,e.operator,null,e,r))}}else if(t instanceof k){if(d(a)===!1)throw new i(r,l.KeyAccessorMustBeString,e);if(t.hasGlobal(a)!==!0)throw new i(r,l.ModuleExportNotFound,e);t.setGlobal(a,I(s,e.operator,t.global(a),e,r))}else{if(!J(t))throw O(t)?new i(r,l.Immutable,e):new i(r,l.InvalidParameter,e);if(d(a)===!1)throw new i(r,l.KeyAccessorMustBeString,e);if(t.hasField(a)===!0)t.setField(a,I(s,e.operator,t.field(a),e,r));else{if(e.operator!=="=")throw new i(r,l.FieldNotFound,e,{key:a});t.setField(a,I(s,e.operator,null,e,r))}}return p}const o=h(n);if(r.localScope!=null&&r.localScope[o]!==void 0){const t=await u(r,e.right);return r.localScope[o]={value:I(t,e.operator,r.localScope[o].value,e,r)},p}if(r.globalScope[o]!==void 0){const t=await u(r,e.right);return r.globalScope[o]={value:I(t,e.operator,r.globalScope[o].value,e,r)},p}throw new i(r,l.InvalidIdentifier,e)}async function Ue(r,e){const n=await u(r,e.expression);return n===p?p:new V(n)}async function Ze(r,e){const n=await u(r,e.test);if(n===!0)return m(r,e.consequent);if(n===!1)return e.alternate!==null?m(r,e.alternate):p;throw new i(r,l.BooleanConditionRequired,e)}async function j(r,e){return te(r,e,0)}async function te(r,e,n){if(n>=e.body.length)return p;const o=await m(r,e.body[n]);return o instanceof g||o===y||o===K||n===e.body.length-1?o:te(r,e,n+1)}async function Ge(r,e){if(e.argument===null)return new g(p);const n=await u(r,e.argument);return new g(n)}async function Le(r,e){const n=h(e.id);return r.globalScope[n]={value:new ke(e,r)},p}async function qe(r,e){var a,s;const n=h(e.specifiers[0].local),o=r.libraryResolver.loadLibrary(n);let t;return(a=r.libraryResolver._moduleSingletons)!=null&&a.has(o.uri)?t=r.libraryResolver._moduleSingletons.get(o.uri):(t=new k(o),await t.loadModule(r),(s=r.libraryResolver._moduleSingletons)==null||s.set(o.uri,t)),r.globalScope[n]={value:t},p}async function Pe(r,e){if(await m(r,e.declaration),e.declaration.type==="FunctionDeclaration")r.exports[h(e.declaration.id)]="function";else if(e.declaration.type==="VariableDeclaration")for(const n of e.declaration.declarations)r.exports[h(n.id)]="variable";return p}async function ae(r,e,n){return n>=e.declarations.length?p:(await Ve(r,e.declarations[n]),n===e.declarations.length-1||await ae(r,e,n+1),p)}async function Ve(r,e){let n=null;if(n=e.init===null?null:await u(r,e.init),r.localScope!==null){if(n===p&&(n=null),e.id.type!=="Identifier")throw new i(r,l.InvalidIdentifier,e);const t=h(e.id);return void(r.localScope!=null&&(r.localScope[t]={value:n}))}if(e.id.type!=="Identifier")throw new i(r,l.InvalidIdentifier,e);const o=h(e.id);n===p&&(n=null),r.globalScope[o]={value:n}}async function We(r,e){const n=await u(r,e.object);if(n===null)throw new i(r,l.MemberOfNull,e);if(e.computed===!1){if(e.property.type==="Identifier"){if(n instanceof S||D(n))return n.field(e.property.name);if(n instanceof H)return G(n,e.property.name,r,e);if(n instanceof k){if(!n.hasGlobal(e.property.name))throw new i(r,l.InvalidIdentifier,e);return n.global(e.property.name)}throw new i(r,l.InvalidMemberAccessKey,e)}throw new i(r,l.InvalidMemberAccessKey,e)}let o=await u(r,e.property);if(n instanceof S||D(n)){if(d(o))return n.field(o);throw new i(r,l.InvalidMemberAccessKey,e)}if(n instanceof k){if(d(o))return n.global(o);throw new i(r,l.InvalidMemberAccessKey,e)}if(n instanceof H){if(d(o))return G(n,o,r,e);throw new i(r,l.InvalidMemberAccessKey,e)}if(N(n)){if(R(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=n.length+o),o>=n.length||o<0)throw new i(r,l.OutOfBounds,e);return n[o]}throw new i(r,l.InvalidMemberAccessKey,e)}if(O(n)){if(R(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=n.length()+o),o>=n.length()||o<0)throw new i(r,l.OutOfBounds,e);return n.get(o)}throw new i(r,l.InvalidMemberAccessKey,e)}if(d(n)){if(R(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=n.length+o),o>=n.length||o<0)throw new i(r,l.OutOfBounds,e);return n[o]}throw new i(r,l.InvalidMemberAccessKey,e)}throw new i(r,l.InvalidMemberAccessKey,e)}async function je(r,e){const n=await u(r,e.argument);if(M(n)){if(e.operator==="!")return!n;if(e.operator==="-")return-1*f(n);if(e.operator==="+")return 1*f(n);if(e.operator==="~")return~f(n);throw new i(r,l.UnsupportedUnaryOperator,e)}if(e.operator==="-")return-1*f(n);if(e.operator==="+")return 1*f(n);if(e.operator==="~")return~f(n);throw new i(r,l.UnsupportedUnaryOperator,e)}async function Te(r,e){const n=[];for(let o=0;o<e.elements.length;o++)n.push(await u(r,e.elements[o]));for(let o=0;o<n.length;o++){if(v(n[o]))throw new i(r,l.NoFunctionInArray,e);n[o]===p&&(n[o]=null)}return n}async function _e(r,e){const n=await u(r,e.left),o=await u(r,e.right);switch(e.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return ve(f(n),f(o),e.operator);case"==":return L(n,o);case"!=":return!L(n,o);case"<":case">":case"<=":case">=":return be(n,o,e.operator);case"+":return d(n)||d(o)?A(n)+A(o):f(n)+f(o);case"-":return f(n)-f(o);case"*":return f(n)*f(o);case"/":return f(n)/f(o);case"%":return f(n)%f(o);default:throw new i(r,l.UnsupportedOperator,e)}}async function He(r,e){const n=await u(r,e.left);if(!M(n))throw new i(r,l.LogicalExpressionOnlyBoolean,e);switch(e.operator){case"||":{if(n===!0)return n;const o=await u(r,e.right);if(M(o))return o;throw new i(r,l.LogicExpressionOrAnd,e)}case"&&":{if(n===!1)return n;const o=await u(r,e.right);if(M(o))return o;throw new i(r,l.LogicExpressionOrAnd,e)}default:throw new i(r,l.LogicExpressionOrAnd,e)}}function U(r,e){const n=h(e);if(r.localScope!=null&&r.localScope[n]!==void 0)return r.localScope[n].value;if(r.globalScope[n]!==void 0)return r.globalScope[n].value;throw new i(r,l.InvalidIdentifier,e)}async function ze(r,e){if(e.callee.type==="MemberExpression"){const o=await u(r,e.callee.object);if(!(o instanceof k))throw new i(r,l.FunctionNotFound,e);const t=e.callee.computed===!1?e.callee.property.name:await u(r,e.callee.property);if(!o.hasGlobal(t))throw new i(r,l.FunctionNotFound,e);const a=o.global(t);if(!v(a))throw new i(r,l.CallNonFunction,e);return a.call(r,e)}if(e.callee.type!=="Identifier")throw new i(r,l.FunctionNotFound,e);const n=h(e.callee);if(r.localScope!=null&&r.localScope[n]!==void 0){const o=r.localScope[n];if(v(o.value))return o.value.call(r,e);throw new i(r,l.CallNonFunction,e)}if(r.globalScope[n]!==void 0){const o=r.globalScope[n];if(v(o.value))return o.value.call(r,e);throw new i(r,l.CallNonFunction,e)}throw new i(r,l.FunctionNotFound,e)}async function Ye(r,e){let n="",o=0;for(const t of e.quasis)if(n+=t.value?t.value.cooked:"",t.tail===!1){if(e.expressions[o]){const a=await u(r,e.expressions[o]);if(v(a))throw new i(r,l.NoFunctionInTemplateLiteral,e);n+=A(a)}o++}return n}const w={};async function ie(r,e,n,o){const t=await u(r,e.arguments[n]);if(L(t,o))return u(r,e.arguments[n+1]);const a=e.arguments.length-n;return a===1?u(r,e.arguments[n]):a===2?null:a===3?u(r,e.arguments[n+2]):ie(r,e,n+2,o)}async function le(r,e,n,o){if(o===!0)return u(r,e.arguments[n+1]);if(e.arguments.length-n===3)return u(r,e.arguments[n+2]);const t=await u(r,e.arguments[n+2]);if(M(t)===!1)throw new i(r,l.ModuleExportNotFound,e.arguments[n+2]);return le(r,e,n+2,t)}async function Z(r,e,n,o){const t=r.body;if(n.length!==r.params.length)throw new i(e,l.WrongNumberOfParameters,null);for(let s=0;s<n.length;s++){const c=r.params[s];c.type==="Identifier"&&e.localScope!=null&&(e.localScope[h(c)]={value:n[s]})}const a=await m(e,t);if(a instanceof g)return a.value;if(a===y)throw new i(e,l.UnexpectedToken,o);if(a===K)throw new i(e,l.UnexpectedToken,o);return a instanceof V?a.value:a}ue(w,F),fe(w,F),pe(w,F,U),we(w,F),de(w,F),he(w,F),Fe({functions:w,compiled:!1,signatures:null,evaluateIdentifier:null,mode:"async",standardFunction:F,standardFunctionAsync:B}),w.iif=async function(r,e){T(e.arguments===null?[]:e.arguments,3,3,r,e);const n=await u(r,e.arguments[0]);if(M(n)===!1)throw new i(r,l.BooleanConditionRequired,e);return u(r,n?e.arguments[1]:e.arguments[2])},w.defaultvalue=async function(r,e){T(e.arguments===null?[]:e.arguments,2,3,r,e);const n=await u(r,e.arguments[0]);if(e.arguments.length===3){const o=await u(r,e.arguments[1]),t=me(n,o);return t!=null&&t!==""?t:u(r,e.arguments[2])}return n==null||n===""?u(r,e.arguments[1]):n},w.decode=async function(r,e){if(e.arguments.length<2)throw new i(r,l.WrongNumberOfParameters,e);if(e.arguments.length===2)return u(r,e.arguments[1]);if((e.arguments.length-1)%2==0)throw new i(r,l.WrongNumberOfParameters,e);return ie(r,e,1,await u(r,e.arguments[0]))},w.when=async function(r,e){if(e.arguments.length<3)throw new i(r,l.WrongNumberOfParameters,e);if(e.arguments.length%2==0)throw new i(r,l.WrongNumberOfParameters,e);const n=await u(r,e.arguments[0]);if(M(n)===!1)throw new i(r,l.BooleanConditionRequired,e.arguments[0]);return le(r,e,0,n)};const Qe={fixSpatialReference:Se,parseArguments:W,standardFunction:F,standardFunctionAsync:B,evaluateIdentifier:U};for(const r in w)w[r]={value:new P(w[r])};const C=function(){};function se(r,e,n){const o=new C;r==null&&(r={}),e==null&&(e={});const t=new S({newline:`
`,tab:"	",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});t.immutable=!1,o.textformatting={value:t};for(const a in e)o[a]={value:new P(e[a])};for(const a in r)o[a]={value:Me(r[a])?Y.createFromGraphic(r[a],n):r[a]};return o}function ce(r){console.log(r)}C.prototype=w,C.prototype.infinity={value:Number.POSITIVE_INFINITY},C.prototype.pi={value:Math.PI};const Pr=Qe;function Je(r){const e={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:F,standardFunctionAsync:B,evaluateIdentifier:U};for(let n=0;n<r.length;n++)r[n].registerFunctions(e);for(const n in e.functions)w[n]={value:new P(e.functions[n])},C.prototype[n]=w[n];for(let n=0;n<e.signatures.length;n++)ge(e.signatures[n],"async")}async function Vr(r,e){let n=e.spatialReference;n==null&&(n=new re({wkid:102100}));let o=null;r.usesModules&&(o=new z(new Map,r.loadedModules));const t=se(e.vars,e.customfunctions,e.timeZone),a={spatialReference:n,services:e.services,exports:{},libraryResolver:o,abortSignal:e.abortSignal===void 0||e.abortSignal===null?{aborted:!1}:e.abortSignal,globalScope:t,console:e.console??ce,timeZone:e.timeZone??null,lrucache:e.lrucache,interceptor:e.interceptor,localScope:null,depthCounter:{depth:1}},s=await j(a,r);if(s instanceof g||s instanceof V){const c=s.value;if(c===p)return null;if(v(c))throw new i(a,l.IllegalResult,null);return c}if(s===p)return null;throw s===y?new i(a,l.IllegalResult,null):s===K?new i(a,l.IllegalResult,null):new i(a,l.NeverReach,null)}Je([ye]);export{Vr as executeScript,Je as extend,Pr as functionHelper};
