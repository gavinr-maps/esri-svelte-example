const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./AttachmentQuery-BceVlzuF.js","./Accessor-BHnuXKD2.js","./JSONSupport-CGdeqxpk.js","./writer-B2bQV2uU.js","./ImageryTileLayer-qhG2Ytno.js","./index-tefRSezt.js","./index-Cx51aysm.css","./Graphic-CFXUQZlS.js","./Clonable-DvJsj5LF.js","./reactiveUtils-BR0C1Kq4.js","./Evented-DCWccWGU.js","./SimpleObservable-7oieNGD8.js","./cast-BA_-jlhc.js","./opacityUtils-CSd4XoR2.js","./Promise-CmQqe-ke.js","./Point-XGrwlf63.js","./enumeration-Cr5WIZs4.js","./Color-gncXBiLc.js","./colorUtils-Rxh2V3ai.js","./mathUtils-DV9iOXpW.js","./ActionToggle-__-l4AdQ.js","./Identifiable-BrT7zvUW.js","./jsonUtils-Cu7OBRmN.js","./Extent-CBBGeHb-.js","./Polyline-BmuD2-ZN.js","./typeUtils-BSg8Y507.js","./TextSymbol-BQ_NW9Xo.js","./screenUtils-_ZIvrt5o.js","./collectionUtils-CbaToa73.js","./Portal-CTRRujjZ.js","./vec3f64-BLpZdpfb.js","./aaBoundingBox-CeBivBRq.js","./MultiOriginJSONSupport-nGLpCFeg.js","./Layer-C9uQlTBT.js","./TimeExtent-J5qnUFx_.js","./timeUtils-D2X862bk.js","./ArcGISService-BHkTabnw.js","./ScaleRangeLayer-C59zG_yk.js","./layerContainerType-C5CzMsLd.js","./jsonUtils-TjZmCq6l.js","./utils-DYurMneM.js","./mat4f32-DcsiF_Rp.js","./mat4-Fi6iAz29.js","./common-DQOJ18NT.js","./CustomParametersMixin-uo3x70vd.js","./xmlUtilities-DSmZyTVq.js","./commonProperties-C0eC30J9.js","./ElevationInfo-Di4W6v5U.js","./unitConversionUtils-C4AR5obr.js","./lengthUtils-DjJgJFRg.js","./AttributeTableTemplate-B7rH2qLr.js","./multidimensionalUtils-SQpvKUH-.js","./ImageHistogramParameters-Cobpl2oj.js","./workers-D8Q3pEzK.js","./Queue-BOnccek2.js","./intl-Do3GEEJ7.js","./dataUtils-C9PeJKfO.js","./pixelRangeUtils-ouDveaCT.js","./Field-Cyk7Ur5d.js","./fieldType-L-VlbZqy.js","./ClassBreaksRenderer-BBSNkSFx.js","./commonProperties-bGHL1a5M.js","./colorRamps-Dkx8zIVn.js","./SizeVariable-IzD1bP2e.js","./visualVariableUtils-Bp9QCb8E.js","./ColorStop-CDpeFWOz.js","./jsonUtils-Dzgxk9pw.js","./layerUtils-dJgsXxkC.js","./defaults-Dwxdhopq.js","./defaultsJSON-GKolV7NZ.js","./RendererLegendOptions-mgfHoilI.js","./UniqueValueRenderer-Cri3tgP5.js","./diffUtils-CMkuJvD2.js","./styleUtils-BB-zx7mT.js","./RasterSymbolizer-B36eoQa5.js","./_commonjsHelpers-DCkdB7M8.js","./colorUtils-BAowQmkN.js","./vec42-YcqnINSP.js","./vec4f64-o2zAXfmz.js","./ClassBreaksDefinition-DvZJqFCP.js","./normalizeUtils-XRAPXbWa.js","./normalizeUtilsCommon-D0zPTJCj.js","./utils-Cy8wFNQo.js","./utils-CkSELPnj.js","./utils-9nq77ifz.js","./cimSymbolUtils-azhJhO4Y.js","./utils-B91u8350.js","./defaultCIMValues-DII_GG3u.js","./enums-BJSSbDkD.js","./LRUCache-DS2O1kTf.js","./MemCache-CDoaVBHf.js","./TileInfo-CRfZy5zq.js","./TileKey-DZd6gJy7.js","./QueueProcessor-BFetastB.js","./ReactiveMap-Dwhwbx9R.js","./signal-DSa0yokC.js","./RawBlockCache-Bn1rWP55.js","./rasterProjectionHelper-BYBh__EP.js","./projection-B2I9Bzj_.js","./projectBuffer-DOU0xvVi.js","./geodesicConstants-yASAK_zX.js","./rasterFunctionHelper-BT4Uat-i.js","./FeatureSet-DpCN730g.js","./OperationalLayer-Bts9W3HA.js","./PortalLayer-jhi5QQgB.js","./PortalItem-CXk7DqVv.js","./portalItemUtils-rm7sAgcm.js","./RasterPresetRendererMixin-BDFeg8XQ.js","./RefreshableLayer-Cn2UpWQD.js","./TemporalLayer-CYEvmdjr.js","./TimeInfo-LjqhhubF.js","./TimeInterval-BDTTJ9Uw.js","./timeZoneUtils-COos5xIr.js","./rasterFieldUtils-tcgglH7k.js","./GCSShiftTransform-BlCfuqfj.js","./TilemapCache-DSmTO5V1.js","./ByteSizeUnit-BsxeN7wM.js","./memoryEstimations-5gFNwkKK.js","./popupUtils-pQ0CVidQ.js","./interfaces-CL2NbQte.js","./DataCaptureAdapter-PG9-TNIC.js","./SketchHandlerMixin-7kc9QfSi.js","./OrientedImageryLayer-Bc1gSq-N.js","./FeatureLayer-9fyQxXYm.js","./FeatureLayerBase-DsahGowz.js","./formUtils-DXUHP5lI.js","./HeightModelInfo-B3GZyQFz.js","./featureLayerUtils-BzWCGee1.js","./uuid-Cl5lrJ4c.js","./featureQueryAll-xezK3WCp.js","./Query-DCBIeen2.js","./FullTextSearch-BWm_kPUE.js","./SimpleRenderer-gSw1WaJS.js","./NormalizationBinParametersMixin-D6iHLB7I.js","./RelationshipQuery-W-4bfgaH.js","./LayerFloorInfo-BXAHB-yQ.js","./Relationship-BBBusoKs.js","./serviceCapabilitiesUtils-BuKg0yWx.js","./infoFor3D-CsJzgCF0.js","./editsZScale-BKYnJc2O.js","./queryZScale-DwN6mTru.js","./APIKeyMixin-Btq102Nx.js","./DisplayFilteredLayer-BFGyM6i5.js","./scaleUtils-CfLu-sg1.js","./displayFilterUtils-DV_nOx_h.js","./EditBusLayer-Cx9SJosU.js","./FeatureEffectLayer-D3Dl2pXD.js","./FeatureEffect-xxsfLT-y.js","./FeatureFilter-DEE1jTWq.js","./FeatureReductionLayer-x8j38_gH.js","./FeatureReductionSelection-BpUGF9oj.js","./labelingInfo-BvMdv93l.js","./labelUtils-Dq8OkaT-.js","./jsonUtils-DD1NMzWj.js","./typeUtils-CfF4cYo5.js","./Version-9k2AOv05.js","./FieldsIndex-DFdVonga.js","./HeatmapColorStop-c4wClnpW.js","./heatmapUtils-DA7NmY3d.js","./MD5-C9MwAd2G.js","./OrderedLayer-BP2hvfL_.js","./OrderByInfo-E-O9nvtm.js","./TrackableLayer-D6paP6wl.js","./FeatureTemplate-DqbLvkbZ.js","./FeatureType-DjGGrg1i.js","./fieldProperties-B9JP3-ue.js","./TitleCreator-Zm6TQ_ec.js","./versionUtils-DSsYFI36.js","./styleUtils-BQ_uVsZf.js","./a11yUtils-CSYUX1kC.js","./mat3f64-BBpwCtoL.js","./mat4f64-Dk4dwAN8.js","./mat3-CR8GKnhD.js","./vec32-Dvg_eL9J.js","./vec3-Bn81gjoR.js","./ElevationLayer-Bi0g_XAJ.js","./ArcGISCachedService-Ba-PnMQ3.js","./TileInfoTilemapCache-ChbmPWxO.js","./LercDecoder-BneQW32N.js","./WorkerHandle-B2QLNs3X.js","./ImageryLayer-CDn54Ngc.js","./imageBitmapUtils-BSeMtYaY.js","./executeForIds-CUQYF7Pj.js","./query-BS_L6I0Q.js","./pbfQueryUtils-AwPAOS5M.js","./pbf-CFI-xDDp.js","./OptimizedGeometry-7IxBWtHr.js","./OptimizedFeature-DcMLlxvB.js","./OptimizedFeatureSet-Blu9Ckm7.js","./executeQueryJSON-CLYdIUdF.js","./ElevationSamplerData-ejt2NMnl.js","./ElevationTile-BVRMxCrp.js","./requestPresets-v9_cUP4i.js","./jsxFactory-CLjKarlq.js","./vec2-maR1OrZI.js","./UpdatingHandles-ptqz1ck8.js","./geometryEngineAsync-D5578A3I.js","./GraphicsLayer-Acqd2VFm.js","./GraphicsCollection-CkliHSk1.js","./Circle-aC-JFV1q.js","./geodesicUtils-Bh_GX0Qj.js","./Mesh-CKlujWIs.js","./axisAngleDegrees-8Sw4vC28.js","./quat-4pa1e6ds.js","./quatf64-CCm9z-pX.js","./MeshComponent-Csew-urT.js","./imageUtils-brik-GLm.js","./meshProperties-C4iW0Ukm.js","./MeshLocalVertexSpace-C0YDTRex.js","./MeshTransform-CIhaTwDv.js","./MeshVertexAttributes-Dh8Pp9-Y.js","./meshVertexSpaceUtils-SW0WEjNN.js","./triangulationUtils-ChyeOnqC.js","./earcut-Lltz9D9k.js","./Indices-Db9lERgy.js","./plane-4dpuo6-e.js","./vec2f64-Dy6m9Nrb.js","./mathUtils-B9R7G-2c.js","./deduplicate-8uOXlcvp.js","./projectPointToVector-BS0u8fq6.js","./vertexSpaceConversion-Dbe11h0o.js","./spatialReferenceEllipsoidUtils-DM073JUd.js","./computeTranslationToOriginAndRotation-BT43Xu5d.js","./BufferView-_QDXRCew.js","./vec4-DcW4fpPA.js","./External-Dk8Y8WWd.js","./sphere-DQxj5tsv.js","./deepClone-DC5Ed1NQ.js","./executionError-HS8X1L-B.js","./ImmutableArray-BPVd6ESQ.js","./shared-M7rSkUll.js","./TimeOnly-yGYcAQQJ.js","./number-BWHn6sm2.js","./floorFilterUtils-DZ5C6FQv.js","./Draw-0bcqxOI1.js","./projectVectorToVector-dS8io47t.js","./ViewingMode-Dodu7ZZk.js","./SnappingVisualizer2D-CeuJ0hoo.js","./RightAngleSnappingHint-CCcBBYgG.js","./InputManager-Bs9UE-jw.js","./keybindings-DrKrBFID.js","./utils-D02V2_jH.js","./elevationInfoUtils-RSZ4Logn.js","./geometry2dUtils-vtViF5g_.js","./SnappingVisualizer-Cb3uuWOu.js","./PointSnappingHint-CurBFXPo.js","./EditGeometryOperations-C5kkQVhH.js","./SnappingContext-lR2hMWGP.js","./SnappingOperation-DhUO_0vk.js","./Scheduler-B_GuBefw.js","./debugFlags-ZrDyTcDc.js","./screenUtils-DyhV4TAA.js","./surfaceCoordinateSystems-DRgCZXAE.js","./memoize-DsJmrG76.js","./ReactiveSet-CoXPgSt3.js","./dehydratedFeatureComparison-Bbl7iMhI.js","./DrawingMode-Cvvf0VVz.js","./dragEventPipeline-D_Ldto1o.js","./hydratedFeatures-BVVSs98j.js","./quantityUtils-1LswOhxZ.js","./angularMeasurementUtils-lDJJxFDs.js","./Cyclical-CPiNl4ru.js","./SketchLabelOptions-CwtwEofC.js","./SnappingDragPipelineStep-C7nIAEz_.js","./mat2d-D9DBP-jx.js","./mat2df64-CBKYtunK.js","./InteractiveToolBase-DNJTN0p5.js","./interfaces-D6pIddIh.js","./drawUtils-BxNz8j4I.js","./Camera-DJtV7zYb.js","./DefaultUI-DqLHkAzt.js","./Basemap-BHdJ6wQH.js","./loadAll-Do8S8AWH.js","./basemapDefinitions-BmB40s1J.js","./writeUtils-C3ZSK02Z.js","./groundInstanceUtils-Ben03ZCf.js","./CollectionFlattener-B9CFCLSp.js","./editableLayers-BZGjz8nI.js","./catalogUtils-CK4eMvD1.js","./basemapEnsureType-BVU7UGJp.js","./basemapUtils-DQr5T1wn.js","./TablesMixin-BzMj7HDl.js","./selectionUtils-DYi6daQO.js","./ViewEvents-Hl5AOQnu.js","./IViewEvents-Bci6PjlS.js","./HighlightDefaults-ESbuT2uR.js","./heightModelInfoUtils-CMg1cdju.js","./unitBezier-B1N-tmtC.js","./capabilities-DwlKKScG.js","./themeUtils-C3zvZbsE.js","./globalCss-CZa70j6i.js","./accessibleHandler-rIBXQ52V.js","./CompassViewModel-BAJa4WdS.js","./GoTo-BsXOAO95.js","./ZoomViewModel-BZXEbLSs.js","./ShadowCastAccumulate.glsl-7ziGQBCy.js","./Viewpoint-Cv8Otrne.js","./projectBoundingRect-BA_jRNoI.js","./boundedPlane-Dyz2ub5d.js","./lineSegment-C-CDF7QX.js","./RenderCoordsHelper-BbefYyBA.js","./projectVectorToPoint-d6Mr4zvQ.js","./dehydratedFeatureUtils-1rrRm6hF.js","./NormalUtils.glsl-CV524hT5.js","./ElevationContext-jcnAn7VT.js","./ElevationProvider-aS5xrHHy.js","./VertexAttribute-Cq4MnHjR.js","./SnappingCandidate-O5eRSE6e.js","./LineCallout.glsl-BFpkOc4i.js","./Material-Ba8x5bbY.js","./NoParameters-t-PuNrgq.js","./FloatArray-BCfeX8wo.js","./BindType-BBwFZqyN.js","./Matrix3PassUniform-Bhi2fM3C.js","./Texture-D-SqNa4i.js","./enums-D9v74xTE.js","./getDataTypeBytes-BTGR5GyG.js","./renderState-e7QeQoUO.js","./basicInterfaces-CZwQPxTp.js","./InterleavedLayout-Dvj-Snan.js","./types-D0PSWh4d.js","./triangle-D_E6eTS3.js","./ShaderTechniqueConfiguration-YrUOztAU.js","./glsl-BH37Aalp.js","./requestImageUtils-Brn0e8z8.js","./TextureFormat-1mYWTFa-.js","./graphicUtils-Daa6cjYT.js","./RibbonLine.glsl-D3IEIaDR.js","./sdfPrimitives-B8Jbwvqs.js","./doublePrecisionUtils-B0owpBza.js","./floatRGBA-CR2j2c7-.js","./Octree-B-jwmuW2.js","./ShaderBuilder-DV1s2efh.js","./RgbaFloatEncoding.glsl-_io2eW3M.js","./Attribute-B-NAci_J.js","./vec2f32-BbH2jxlN.js","./DefaultBufferWriter-D4XUxbP-.js","./dehydratedFeatures-Nwhn-hep.js","./quantizationUtils-2Az-xHPA.js","./featureConversionUtils-DpmsPUmt.js","./edgeUtils-52Urp6s4.js","./NormalAttribute.glsl-BPQl43kJ.js","./Float4DrawUniform-C_Hqa-pI.js","./Matrix3DrawUniform-B_gSHO7v.js","./webStyleAcceptedFormats-CG7ZQ6BV.js","./GeometryUtil-vHI0hYMT.js","./vec3f32-nZdmKIgz.js","./RealisticTree.glsl-BIYA2y1x.js","./Intersector-DqUGp7Vs.js","./intersectorUtils-l6zkk4nF.js","./verticalOffsetUtils-CUH6QZ7-.js","./orientedBoundingBox-9z4w3ZAL.js","./Intersector-DPK4WnQE.js","./DefaultMaterial-B5sYRDQR.js","./SceneLighting-fZH2UQ_L.js","./GLTextureMaterial-BXvkeRxQ.js","./VertexColor.glsl-C67vI27I.js","./Matrix4PassUniform-LFIUaE9i.js","./VerticalOffset.glsl-0YVQE7vQ.js","./Matrix4sPassUniform--uPzDbTP.js","./Float2PassUniform-Blij1ug3.js","./BooleanBindUniform-xvVHJCDz.js","./CameraSpace.glsl-BZ4Eapt3.js","./HUDRenderStyle-BhGvVxgm.js","./HUDVisibility.glsl-DSeZY4v-.js","./OverlayCompositing.glsl-BbJKjUZQ.js","./GridLocalOriginFactory-BvhZ_UoU.js","./RenderCamera-BovI3JTe.js","./weather-DtiKeY2t.js","./RenderPlugin-B2sz29jJ.js","./VertexElementDescriptor-BOD-G50G.js","./VertexArrayObject-DcVjXzZo.js","./BufferObject-CIl3vJtA.js","./NestedMap-GuqgquCN.js","./Normals-OOhKYumi.js","./fontUtils-D0SfAiSy.js","./cameraUtils-D51h-KGF.js","./earthUtils-5Ip67eD0.js","./spatialReferenceSupport-CJqi4Nvp.js","./terrainUtils-NB9gChf5.js","./FramebufferObject-DHwDHMWe.js","./glUtil-D0YUa0ow.js","./ShadowCastVisualizeTechniqueConfiguration-WdqoNZsk.js","./SunCalc-uwgdo0BB.js","./VirtualLighting-CTSkZQzH.js","./ray-D3Okb4cY.js","./RenderFeature-3I21ZjJq.js","./unitFormatUtils-Dbksq3U5.js","./ZoomMomentumEstimator-Igei2Npb.js","./HUDMaterial-DRUv4rua.js","./labelFormatUtils-B--9rEVY.js","./DepthRange-C25RnOB3.js","./hitTest-CblPROa1.js","./LayerConstants-B33OP6sh.js","./intersectorUtilsConversions-CZnn6t-z.js","./ElevationRange-BrgM1moX.js","./hitTestSelectUtils-UXJPjatw.js","./DefaultLoadingContext-b8vwa5ZD.js","./wosrLoader-F8PxTYxV.js","./DrawParameters-C0gywgJQ.js","./TileStrategy-DlGVvP4C.js","./TileKey-BtGhNUzq.js","./ScheduledQueueProcessor-DfrR8pp0.js","./RenderableTile-Ewnw5ULl.js","./config-MDUrh2eL.js","./StyleDefinition-DxJzQnGW.js","./enums-BRzLM11V.js","./GeometryUtils-B5FJlfZD.js","./DefaultVertexAttributeLayouts-DMsCtEEh.js","./DisplayObject-S19ALweP.js","./resources-CcZcI9oR.js","./vec33-KumQEj7U.js","./ShaderTechniqueRepository-CuJwDr2t.js","./Blit-D5AxBSxC.js","./testSVGPremultipliedAlpha-CpxLiQJP.js","./RenderingContext-BkhmhK8E.js","./ProgramCache-D9MJNX7j.js","./Program-DD6La1z3.js","./layerViewUtils-tkZ5z_iY.js","./makeScheduleFunction-CggzEh3c.js","./vmEvent-D4Ubqkbq.js","./quantityFormatUtils-9VppKzbq.js","./geometryEngine-CtEcpiHE.js","./geometryEngineBase-yFIvKOkM.js","./hydrated-Dw-Mfo_Y.js","./MapView-CNvaqV5-.js","./View2D-CIpCSKxG.js","./viewpointUtils-DmJh_Ev7.js","./mat2df32-orApM5a3.js","./Tile-CkUxg4dk.js","./quickselect-QQC62dOK.js","./definitions-LJaw2n5Z.js","./substitute-D1XJWgT5.js","./useWidget-Dlf3SkC7.js","./index-BkKcLxWB.js","./component-utils-DWY0IMHC.js","./MapViewAdapter-COWmhULW.js","./SceneViewAdapter-_wmamBvG.js","./SketchViewModel-BHWV3FYM.js","./layerUtils-BS1Di3Pm.js","./SketchOptions-92Ul6Fzp.js","./SnappingManager-CF4NflXd.js","./viewUtils-Ce2x26K8.js","./MeasurementAdapter-P-fcIYKm.js","./index-DVEy4f7w.js","./index-CjrYEQXz.js","./guid-ejniuQmw.js","./useT9n-CJAswmP1.js","./index-73bQemcW.js","./dom--xxYYVQF.js","./observers-BdozwIHb.js","./keyed-CdPY5MOf.js","./directive-helpers-C0aXnQdc.js","./ref-Ccn4I0kT.js","./interactive-B8siLByk.js","./loadable-DOQnSSjG.js","./component-CFGnHAqh.js","./index-ujykA9Eq.js","./index-cLdK6V3t.js","./index-Df8-0rWt.js","./floating-ui-BkLjHVN3.js","./debounce-DbkufipY.js","./key-CZcQa38B.js","./openCloseComponent-dw_x67D_.js","./dynamicClasses-pKEMtFzB.js","./index-DIB7yhJF.js","./resources6-Cs2_VmEC.js","./index-BfAp5_ga.js","./customElement-kBYuBfHB.js","./index-DIp-v4qk.js","./static-g4FJ4v8I.js","./FloatingArrow-D9X-HbKW.js","./useFocusTrap-ENcZoC4L.js","./focusTrapComponent-Br_3Mz8_.js","./index-CCqZjfSZ.js","./array-BbE1dLa5.js","./index-DSiQ4rVy.js","./index-TFxiSNpz.js","./index-BSRDeu3E.js","./ExpandToggle-UGfmSgey.js","./index-D130RxMY.js","./label-BLne9qNB.js","./index-nrWOrFCt.js","./resources4-Crg87oFz.js","./index-DTpFWV8n.js","./index-ZJpJxb4p.js","./interact.min-cQ7FSOH8.js","./_commonjsHelpers-DqlTr81k.js","./index-DsrvUplP.js","./index-Ch_sYKt7.js","./Validation-O1TFEQW-.js","./form-B15gmg4q.js","./locale-CXx8I9ox.js","./math-BpAtBkbz.js","./index-DqW6JA5s.js","./ImageOverlays-CQOAXfUX.js","./LayerList-BuCMN7fl.js","./LayerListItem-BYbqB_Dn.js","./actionUtils-DSzWsgMf.js","./layerListUtils-BIu86t6C.js","./LayerListViewModel-DeGRGHR_.js","./utils-BQBvadb7.js","./ListItem-CRqB-Xtr.js","./widget-AxfSz_k8.js","./listUtils-vswmtyNy.js","./ImageMeasurementWidget-BzbZH9kW.js","./UnitSelect-JGyYeoZR.js","./SketchTools-fZ2BDHP3.js"])))=>i.map(i=>d[i]);
import{_ as z,i as sr,L as lr,u as cr,c as hr,n as ur,a as mr}from"./index-tefRSezt.js";import{i as ma,p as Zt,l as Da,D as dr,n as pr,s as da,a as gr,P as yr,f as Ha,b as vr,S as Na}from"./OrientedImageryLayer-Bc1gSq-N.js";import{B as D,E as se,ac as Ue,s as Q,D as L,r as c,a as me,m as u,b2 as fr,aG as wr,N as ie,i as Fe,aS as Ae,G as It,ad as pa,z as ga,g as _r}from"./Accessor-BHnuXKD2.js";import"./intl-Do3GEEJ7.js";import{o as br}from"./a11yUtils-CSYUX1kC.js";import{d as O,A as Z,C as Mr,V as j,p as Cr,P as Ze,a as ye,v as ya,w as Ir}from"./reactiveUtils-BR0C1Kq4.js";import{s as Ba}from"./ReactiveMap-Dwhwbx9R.js";import{S as ze}from"./JSONSupport-CGdeqxpk.js";import{M as ve,s as Y,r as Te}from"./mathUtils-DV9iOXpW.js";import{e as vt}from"./mat3f64-BBpwCtoL.js";import{e as Dt,t as Pr}from"./mat4f64-Dk4dwAN8.js";import{u as xr}from"./vec4f64-o2zAXfmz.js";import{c as R,n as Ut,t as $r}from"./vec3f64-BLpZdpfb.js";import{u as ja,i as Fr}from"./mat3-CR8GKnhD.js";import{e as Wa,J as Sr}from"./mat4-Fi6iAz29.js";import{R as J,u as le,p as Rr}from"./vec32-Dvg_eL9J.js";import{j as V,g as U,O as qa,t as Qt,E as Ht,aD as Or,Q as va}from"./Point-XGrwlf63.js";import{J as re,o as Ar,O as Nt}from"./projection-B2I9Bzj_.js";import{a as Tr}from"./vec3-Bn81gjoR.js";import{c as Lr,j as ne,u as Za,P as _e,g as Vr}from"./Polyline-BmuD2-ZN.js";import kr from"./ElevationLayer-Bi0g_XAJ.js";import Er from"./ImageryLayer-CDn54Ngc.js";import{B as zr}from"./ImageryTileLayer-qhG2Ytno.js";import{m as Gr}from"./ElevationSamplerData-ejt2NMnl.js";import{t as Dr}from"./ElevationTile-BVRMxCrp.js";import{a as Hr}from"./LercDecoder-BneQW32N.js";import{w as Ua}from"./ImageHistogramParameters-Cobpl2oj.js";import{z as Qa}from"./TileInfo-CRfZy5zq.js";import{t as Nr}from"./TileKey-DZd6gJy7.js";import{P as Jt,z as Br,a as jr,o as Wr}from"./cast-BA_-jlhc.js";import{w as qr}from"./Extent-CBBGeHb-.js";import"./normalizeUtilsCommon-D0zPTJCj.js";import{t as Zr}from"./requestPresets-v9_cUP4i.js";import{n as fa,A as wa}from"./opacityUtils-CSd4XoR2.js";import{O as ft,n as M,c as Ja,e as tt}from"./jsxFactory-CLjKarlq.js";import{b as N,u as Yt,v as Xt,w as Kt,Z as Ur,_ as Ya,d as Xa,s as Qr,$ as Jr}from"./Graphic-CFXUQZlS.js";import{i as ea}from"./Evented-DCWccWGU.js";import{p as Yr}from"./Promise-CmQqe-ke.js";import{m as de}from"./vec2-maR1OrZI.js";import{h as Xr}from"./UpdatingHandles-ptqz1ck8.js";import{union as Kr}from"./geometryEngineAsync-D5578A3I.js";import{h as Be}from"./GraphicsLayer-Acqd2VFm.js";import{a as Ka}from"./Clonable-DvJsj5LF.js";import{r as ei}from"./enumeration-Cr5WIZs4.js";import{o as te,r as _a}from"./writer-B2bQV2uU.js";import{b as eo}from"./Query-DCBIeen2.js";import{b as Bt}from"./Circle-aC-JFV1q.js";import Qe from"./Mesh-CKlujWIs.js";import{f as to,a as ao,w as io}from"./MeshComponent-Csew-urT.js";import{p as ta}from"./MeshVertexAttributes-Dh8Pp9-Y.js";import{x as ti,M as ro,A as ba,p as lt,k as ai}from"./plane-4dpuo6-e.js";import{O as oo,S as no,q as so,F as lo}from"./sphere-DQxj5tsv.js";import{S as co}from"./deepClone-DC5Ed1NQ.js";import{o as ho}from"./floorFilterUtils-DZ5C6FQv.js";import{y as Je,S as Ye,d as aa}from"./TextSymbol-BQ_NW9Xo.js";import{l as uo}from"./Draw-0bcqxOI1.js";import{s as mo}from"./drawUtils-BxNz8j4I.js";import{_ as po}from"./InputManager-Bs9UE-jw.js";import{d as ii}from"./Camera-DJtV7zYb.js";import{L as ri,E as go}from"./DefaultUI-DqLHkAzt.js";import{n as yo}from"./ShadowCastAccumulate.glsl-7ziGQBCy.js";import{p as vo}from"./ZoomViewModel-BZXEbLSs.js";import{e as ct}from"./globalCss-CZa70j6i.js";import{e as ht}from"./vmEvent-D4Ubqkbq.js";import{f as fo}from"./jsonUtils-Cu7OBRmN.js";import{h as wo}from"./Color-gncXBiLc.js";import{E as _o,P as bo}from"./colorUtils-BAowQmkN.js";import{x as oi,k as Mo}from"./quantityFormatUtils-9VppKzbq.js";import{a as ni,l as Co}from"./quantityUtils-1LswOhxZ.js";import{geodesicDensify as si,simplify as ia,geodesicLength as li,planarLength as ci,planarArea as Io,geodesicArea as Po,rotate as Pt,intersect as xo,nearestCoordinate as $o}from"./geometryEngine-CtEcpiHE.js";import{y as hi,R as ut,v as Ma}from"./geodesicUtils-Bh_GX0Qj.js";import{p as ui}from"./MapView-CNvaqV5-.js";import{D as Ca}from"./rasterFunctionHelper-BT4Uat-i.js";import{c as Fo}from"./viewpointUtils-DmJh_Ev7.js";import{s as mi}from"./substitute-D1XJWgT5.js";import{P as So}from"./useWidget-Dlf3SkC7.js";const Ia=120,k=[21,36,51,60],Ro=3.5,xt=["FAR_WEST","FAR_NORTH","FAR_EAST","FAR_SOUTH","WEST","NORTH","EAST","SOUTH","NEAR_WEST","NEAR_NORTH","NEAR_EAST","NEAR_SOUTH"],pe=23.937554159486076,ge=96.06244584051393,$t={EAST:[pe,pe,ge,pe,60,pe],NORTH:[pe,ge,pe,pe,pe,60],SOUTH:[ge,pe,ge,ge,ge,60],WEST:[ge,ge,pe,ge,60,ge]},Pa=-999,Oo=100,Ao=()=>["after-data-capture-complete","deselect-data-capture-features","select-data-capture-features"],ra="ImageGeometry",oa="OIObjectId";function To(e){return(e==null?void 0:e.type)==="3d"}function Lo(e){return(e==null?void 0:e.declaredClass)==="esri.Graphic"}function Vo(e){return/(tiff|tif|mrf)$/i.test(e??"")}function xa(e){if(!e||!URL.canParse(e))return!1;const{pathname:t}=new URL(e);return/.*\.(tiff|tif|mrf)$/i.test(t??"")}function ko(e){return Math.abs(e)>=135?"WEST":e<-45&&e>-135?"SOUTH":e<=45?"EAST":"NORTH"}function Eo(e,t){const a=e/t*k[2];return a<=k[0]?"NEAR":a<=k[1]?"":"FAR"}function zo(e){return e&&e.url&&e.datasetFormat?e:null}function Go(e){return typeof e=="string"&&e.length?e:zo(e)}const Do=e=>t=>t.layer===e;function Ho(e){return(e==null?void 0:e.name)==="NoAttachmentError"}const di=e=>`${e}:missing-property`,pi=(e,t)=>`Property ${t} is missing in ${e}`,mt=(e="esri.widgets.OrientedImageryViewer",t)=>{throw D.getLogger(e).error(t),t},gi=async(e,t)=>{var r;const a=await Jt(e,{...t,method:"head"}),i=(r=a==null?void 0:a.getHeader)==null?void 0:r.call(a,"Content-Type");if(i)return i.split("/")[1]};async function No(e,t,a){if(!t.extent||!t.url)throw mt("esri.layer.orientedImagery.transformations",new Q("update-elevation:missing-property","both extent and url are required to create a sampler",t));const i=await na(t);if(!i)throw mt("esri.layers.orientedImagery.transformations",new Q("update-elevation:elevation-source","could not create a sampler using provided elevation source",t));return yi(e,i,a)}async function yi(e,t,a){await Ue(a);const i=qo(t,a),r=Array.isArray(e)?e:[e];return await Promise.all(r.map(i))}var Le;(function(e){e[e.DYNAMIC=0]="DYNAMIC",e[e.ELEVATION=1]="ELEVATION",e[e.IMAGE=2]="IMAGE"})(Le||(Le={}));const na=async(e,t)=>{let a;const{extent:i,rasterFunction:r,url:o,lod:n}=e;try{a=await Wo(o)}catch(s){if(se(s))return;D.getLogger("esri.layers.orientedImagery.transformations").error("updateElevationUsingElevationSource",s)}switch(a){case Le.DYNAMIC:return await jo(o,i,r,t);case Le.ELEVATION:return await Bo(o,i,n,t);default:return}};async function Bo(e,t,a,i){var n;const r=new kr(e);let o;try{const{tileInfo:s}=await r.load(),l=(a&&((n=s.lodAt(Math.min(s.lods.length-1,a)))==null?void 0:n.resolution))??"finest-contiguous";o=await r.createElevationSampler(t,{...i,demResolution:l})}catch(s){if(se(s))return;D.getLogger(r).error(s)}finally{r.destroy()}return o}async function jo(e,t,a,i){const r=a?new Ua({functionName:a}):void 0,o=new Er({url:e,rasterFunction:r,format:"lerc"});await o.load(i);let n,s=512,l=512;const h=t.width/t.height;h>1?(l/=h,n=t.height/l):(s*=h,n=t.width/s);const m=await o.fetchImage(t,s,l,i),d=Qa.create({scales:[n],size:512,spatialReference:t.spatialReference}),p=new Nr(null,0,0,0,Lr(t)),g=new Hr(m.pixelData.pixelBlock.pixels[0],s,l,0),v=new Dr(p,g);return new Gr(v,d,void 0)}async function Wo(e,t){var o;await Ue(t);const a=await Zr(e),{tileInfo:i,cacheType:r}=a;if(!a.hasOwnProperty("bandCount")||!a.hasOwnProperty("pixelSizeX"))throw new Q("elevation-source:invalid-service-url",`ElevationSource URL expects an elevation 3D image service but given ${e}`);return i?((o=i==null?void 0:i.format)==null?void 0:o.toUpperCase())!=="LERC"||r&&r.toLowerCase()!=="elevation"?Le.IMAGE:Le.ELEVATION:Le.DYNAMIC}function qo(e,t){return async a=>{let i=a.clone();const r=a.spatialReference.equals(e.spatialReference)?i:await re(a,e.spatialReference,t),o=e.queryElevation(r);return o&&(i=a.spatialReference.equals(e.spatialReference)?o.clone():await re(o,a.spatialReference,t)),i.z=i.z??1,i}}async function Zo(e,t,a){return await Ue(a),e.map(i=>(i.z=t,i))}const sa=new V({x:0,y:0,z:0,spatialReference:U.WebMercator}),wt=1e3,Uo=114,Qo=120,Jo=50;function je(e,t,a){const[i,r,o,n]=t,[s,l,h,m]=a;$a(i,r,o,n);const d=$a(s,l,h,m),p=Fa(i,r,o,n),g=Fa(s,l,h,m),v=Wa(Dt(),p),y=Sr(Dt(),v,g),[w,f,b,C]=Xo(e,y);return[w/C,f/C,d?0:b/C]}function $a(e,t,a,i){return e[2]===0&&t[2]===0&&a[2]===0&&i[2]===0&&(e[2]=t[2]=a[2]=i[2]=1,!0)}function Yo(e){return e===0?1:e}function Xo(e,t){const[a,i,r]=e,o=[0,0,0,0];return o[0]=a*t[0]+i*t[1]+r*t[2]+t[3],o[1]=a*t[4]+i*t[5]+r*t[6]+t[7],o[2]=a*t[8]+i*t[9]+r*t[10]+t[11],o[3]=Yo(a*t[12]+i*t[13]+r*t[14]+t[15]),o}function Fa(e,t,a,i){const r=Ko(xr([...i,1]),Wa(new Array(16),Pr(e[0],t[0],a[0],0,e[1],t[1],a[1],0,e[2],t[2],a[2],0,1,1,1,1))),o=r[0],n=r[1],s=r[2],l=Dt();return l[0]=o*e[0],l[1]=n*t[0],l[2]=s*a[0],l[3]=0,l[4]=o*e[1],l[5]=n*t[1],l[6]=s*a[1],l[7]=0,l[8]=o*e[2],l[9]=n*t[2],l[10]=s*a[2],l[11]=0,l[12]=o,l[13]=n,l[14]=s,l[15]=1,l}function Ge(e,t,a,i,r=R()){return r[0]=e[0]+t[0]*a,r[1]=e[1]+t[1]*a,r[2]=e[2]+t[2]*(a/i),r}function B(e,t,a){const i=R();return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*(t/a),i}function be(e,t){const[a,i,r]=e,o=R();return o[0]=a*t[0]+i*t[3]+r*t[6],o[1]=a*t[1]+i*t[4]+r*t[7],o[2]=a*t[2]+i*t[5]+r*t[8],o}function Ko(e,t){const[a,i,r,o]=e,n=new Array(4);return n[0]=a*t[0]+i*t[1]+r*t[2]+o*t[3],n[1]=a*t[4]+i*t[5]+r*t[6]+o*t[7],n[2]=a*t[8]+i*t[9]+r*t[10]+o*t[11],n[3]=a*t[12]+i*t[13]+r*t[14]+o*t[15],n}function en(e,t,a,i=!0){if(!Number.isFinite(e))throw new Q("InvalidRotationAngle","Please specify a valid angle for rotation");const r=a*(i?Y(e):e),o=Math.cos(r),n=Math.sin(r),s=vt();switch(t){case 0:s[4]=o,s[5]=-n,s[7]=n,s[8]=o;break;case 1:s[0]=o,s[2]=n,s[6]=-n,s[8]=o;break;case 2:s[0]=o,s[1]=-n,s[3]=n,s[4]=o;break;default:throw new Q("InvalidRotationAxis","Please specify either 0, 1 or 2 for X, Y or Z axis respectively")}return s}const vi={HPR:[[2,-1],[0,1],[2,-1]],OPK:[[0,1],[1,1],[2,1]]};function fi(e,t,a=!0){if((e==null?void 0:e.length)!==3||(t==null?void 0:t.length)!==3)throw new Q("InvalidRotationAngles","Please specify three angles with config for rotation");const i=vt();for(let r=0;r<3;r++){const[o,n]=t[r],s=en(e[r],o,n,a);Fr(i,s,i)}return i}function tn(e,t=!0){return fi(e,vi.OPK,t)}function jt(e,t=!0){return fi(e,vi.HPR,t)}function wi(e,t,a){const i=Math.sin(Y(a)),r=Math.cos(Y(a)),o=[[e,0],[e,t],[0,t]];o.forEach((s,l)=>{o[l]=[r*s[0]-i*s[1],i*s[0]+r*s[1]]});const n={xmin:Math.min(0,o[0][0],o[1][0],o[2][0]),xmax:Math.max(0,o[0][0],o[1][0],o[2][0]),ymin:Math.min(0,o[0][1],o[1][1],o[2][1]),ymax:Math.max(0,o[0][1],o[1][1],o[2][1])};return{hfov:Math.abs(n.xmax-n.xmin),vfov:Math.abs(n.ymax-n.ymin)}}function an(e,t){const a=Number(e[0]),i=Number(e[1]),r=Number(e[2]),[o,n,s,l]=t,h=Y(o),m=Y(n),d=s/Math.sqrt(1-l*Math.sin(h)**2),p=a/d,g=i/d,v=r/d,y=Math.cos(h)-Math.sin(h)*g+Math.cos(h)*v,w=Math.sin(h)+Math.cos(h)*g+Math.sin(h)*v,f=Math.sqrt(y**2+p**2),b=l*d*Math.sin(h),C=(A,E=5)=>{if(E===0)return A;const T=C(A,E-1);return Math.atan(w/f-(b-l*(s/Math.sqrt(1-l*Math.sin(T)**2))*Math.sin(T))/(d*f))},F=C(h),I=Math.atan(a/(d*y))+m,S=ve(F);return[ve(I),S,a/(Math.cos(F)*Math.sin(I-m))-s/Math.sqrt(1-l*Math.sin(F)**2)]}function Pe(e,t,a){const i=360/t,r=180/a;return{heading:(e.x-t/2)*i,pitch:90-(e.y-a/2)*r}}function Oe(e,t,a,i=wt/2){const{heading:r,pitch:o}=rn(e,i);return _i(r,o,t,a)}function _i(e,t,a,i){return{x:a/2+e/(360/a),y:i-t/(180/i),heading:e,pitch:t}}function rn(e,t){const a=ve(Math.acos(-e.z/t));return{heading:ve(Math.atan2(e.x,e.y)),pitch:a}}function xe(e,t,a=wt/2){return[a*(Math.sin(Y(e))*Math.sin(Y(t))),a*(Math.cos(Y(e))*Math.sin(Y(t))),a*Math.cos(Y(180-t))]}function at(e,t,a,i=wt/2){const{heading:r,pitch:o}=Pe(e,t,a);return xe(r,o,i)}async function on(e,t,a){const i=await re(t,e.spatialReference,a);let r=ve(Math.atan2(i.y-e.y,i.x-e.x));return r=r>=0&&r<=90?90-r:r>90&&r<=180?360-r+90:90+Math.abs(r),r}function it(e,t,a){const i=Math.cos(a),r=Math.sin(a),o=[1,0,0,1,0,0],n=o[0]*i+o[2]*r,s=o[1]*i+o[3]*r,l=-o[0]*r+o[2]*i,h=-o[1]*r+o[3]*i;return o[0]=n,o[1]=s,o[2]=l,o[3]=h,[e*o[0]+t*o[2]+o[4],e*o[1]+t*o[3]+o[5]]}const ue=e=>e.toArray(),Me=(...e)=>e.some(t=>t);function nn(e,t){if(Me(e.length===0,e.some(({x:a,y:i})=>Me(a==null,i==null)),!t.hasZ))throw new Error("Input pixels must have x, y and camera location must have z value")}function bi(e,t){if(e.some(a=>a.z==null)||t.z==null)throw new Error("Input points and camera location must have z value")}function Mi(e){if((e==null?void 0:e.length)!==9)throw new Error("Rotation matrix is not provided or is not a valid 3x3 matrix")}function Xe(e,t){return qa(t)?1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*e/Qt.radius))):1}const sn=e=>t=>new V(t,e),We=e=>e!=null&&"queryExtent"in e;function ln(e,t,a,i){return[[-t,-t],[+t,-t],[+t,+t],[-t,+t]].map(([r,o])=>je(Tr(R(),a,[r,o,0]),i,e))}function cn({a0:e,a1:t,a2:a,b0:i,b1:r,b2:o},n,s,l){const h=[e??n/2-.5,t,a??0,i??s/2-.5,r??0,o].map(hn);return l!=null&&un(h)?{affines:h,focalLength:l}:{affines:[n/2-.5,1,0,s/2-.5,0,-1]}}function hn(e,t){if(e==null)return null;const a=parseFloat(`${e}`);return isNaN(a)?null:a}function un(e){return e[1]!=null&&e[5]!=null}function rt(e,t,a){const{cameraHeight:i,cameraPitch:r,cameraRoll:o,elevation:n,farDistance:s,horizontalFieldOfView:l,location:h,verticalFieldOfView:m}=e,d=n??(h.z??0)-i;return{...Ci(e,t,a),averageElevation:d,cameraPitch:r,cameraRoll:o??0,farDistance:s,horizontalFieldOfView:l,verticalFieldOfView:m}}function mn(e,t,a,i){return vn(i)?tn([i.omega,i.phi,i.kappa]):fn(i)?jt([i.heading,i.pitch,i.roll]):jt([e,t,a??0])}function Sa(e,t,a){const{cameraHeading:i,cameraHeight:r,elevation:o,farDistance:n,horizontalFieldOfView:s,location:l,verticalFieldOfView:h}=e;return{averageElevation:o??(l.z??0)-r,cameraLocation:l,cameraHeading:i,farDistance:n,horizontalFieldOfView:s,imageHeight:a,imageWidth:t,verticalFieldOfView:h}}function Ci(e,t,a){const{a0:i,a1:r,a2:o,b0:n,b1:s,b2:l,cameraHeading:h,cameraOrientation:m,cameraPitch:d,cameraRoll:p,focalLength:g,horizontalFieldOfView:v,location:y,matrix:w,principalX:f,principalY:b,radial:C,tangential:F,verticalFieldOfView:I}=e,{affines:S,focalLength:A}=cn({a0:i,a1:r,a2:o,b0:n,b1:s,b2:l},t,a,g),E=w??mn(h,d,p,m),T=f!=null&&b!=null?[f,b]:void 0;return{affineTransformations:(m==null?void 0:m.affineTransformations)??S,cameraLocation:y.clone(),focalLength:(m==null?void 0:m.focalLength)??A,horizontalFieldOfView:v,imageHeight:a,imageWidth:t,principalOffsetPoint:(m==null?void 0:m.principalOffsetPoint)??T,radialDistortionCoefficients:(m==null?void 0:m.radialDistortionCoefficients)??C,rotationMatrix:E,tangentialDistortionCoefficients:(m==null?void 0:m.tangentialDistortionCoefficients)??F,verticalFieldOfView:I}}const Ii=e=>e!=null&&"elevationSample"in e&&e.elevationSample!=null,la=e=>Zt(e==null?void 0:e.elevationSource)&&(e==null?void 0:e.extent)!=null,dn=e=>Da(e==null?void 0:e.elevationSource),He=async(e,t)=>t!=null&&(Ii(t)||dn(t))?t:la(t)?{elevationSample:await na({...ze.isSerializable(t.elevationSource)?t.elevationSource.toJSON():t.elevationSource,extent:t.extent}),elevationSource:new ma({constantElevation:e})}:{elevationSource:new ma({constantElevation:e})},pn=e=>fa(e==null?void 0:e.heading)&&fa(e==null?void 0:e.pitch),gn=(e,t)=>[[-e,-t],[e,-t],[e,t],[-e,t]];function yn(e){const{cameraLocation:t,farDistance:a,horizontalFieldOfView:i,rotationMatrix:r,scalingFactor:o,verticalFieldOfView:n}=e,s=vt();ja(s,r);const l=2*Math.tan(Y(n)/2)*a*o,h=2*Math.tan(Y(i)/2)*a*o,m=be([0,0,-1],s),d=Ge([t.x,t.y,t.z],m,e.farDistance*o,o),p=be([0,1,0],s),g=be([1,0,0],s),v=B(p,l/2,o),y=B(g,h/2,o),w=J(R(),v,y),f=le(R(),v,y);return[le(R(),d,w),le(R(),d,f),J(R(),d,w),J(R(),d,f)]}const vn=e=>(e==null?void 0:e.type)===2,fn=e=>(e==null?void 0:e.type)===1;function wn(e){const t=e%360;return t<-180?t+360:t}function Ft(e,t,a){if(e==="panoramic"){const[i,r]=a;return Oe({x:t.x,y:t.y,z:t.z},i,r)}return{x:t.x+.5,y:.5-t.y}}var Ra;(function(e){e[e.CLOCKWISE=-1]="CLOCKWISE",e[e.COUNTERCLOCKWISE=1]="COUNTERCLOCKWISE"})(Ra||(Ra={}));function St(e,t,a,i){return[[[a-e/Math.SQRT2,i-e/Math.SQRT2],[a+e/Math.SQRT2,i-e/Math.SQRT2],[a+t/Math.SQRT2,i-t/Math.SQRT2],[a-t/Math.SQRT2,i-t/Math.SQRT2]],[[a+e/Math.SQRT2,i-e/Math.SQRT2],[a+e/Math.SQRT2,i+e/Math.SQRT2],[a+t/Math.SQRT2,i+t/Math.SQRT2],[a+t/Math.SQRT2,i-t/Math.SQRT2]],[[a+e/Math.SQRT2,i+e/Math.SQRT2],[a-e/Math.SQRT2,i+e/Math.SQRT2],[a-t/Math.SQRT2,i+t/Math.SQRT2],[a+t/Math.SQRT2,i+t/Math.SQRT2]],[[a-e/Math.SQRT2,i+e/Math.SQRT2],[a-e/Math.SQRT2,i-e/Math.SQRT2],[a-t/Math.SQRT2,i-t/Math.SQRT2],[a-t/Math.SQRT2,i+t/Math.SQRT2]]]}function Rt(e,t,a){const[i,r,o,n]=e;return`M ${i.join(" ")} A ${t} ${t} 0 0 1 ${r.join(" ")} L ${o.join(" ")} A ${a} ${a} 0 0 0 ${n.join(" ")} Z`}function _n(e,t,a){const[i,r,o,n]=[...e,0];return[...St(i,r,t,a).map(s=>Rt(s,i,r)),...St(r,o,t,a).map(s=>Rt(s,r,o)),...St(o,n,t,a).map(s=>Rt(s,o,n))]}const H="esri-oriented-imagery-viewer",ot=`${H}__carousel`,Ot=`${H}__image-enhancement`,ae=`${H}__navigation`,bn="--oi-navigation-tool-rotation-from",Mn="--oi-navigation-tool-rotation-to",Ve=`${H}__image-overlays`,$={alert:`${H}__alert`,addCoverage:`${H}__body-additional-coverage`,addExpPoints:`${H}__body-additional-camera-locations`,body:`${H}__body`,carousel:`${H}__carousel`,carouselContainer:`${ot}-container`,carouselContent:`${ot}-content`,carouselItem:`${ot}-item`,carouselItemWrapper:`${ot}-item-wrapper`,close:`${H}__close`,currentCoverage:`${H}__body-current-coverage`,feature:`${ae}-feature`,footprint:`${H}__body-footprint`,imageEnhancementToolContainer:`${Ot}-tool-container`,imageEnhancementTools:`${Ot}-tools`,imageEnhancementWrapper:`${Ot}-wrapper`,imageOverlays:Ve,imageOverlaysContainer:`${Ve}-container`,imageOverlaysNoResult:`${Ve}-no-result`,imageOverlaysIncreasedHeight:`${Ve}-increased-height`,imageOverlaysLayerList:`${Ve}-layer-list`,measurementResults:`${H}__measurement-results`,measurementsBar:`${H}__measurements-bar`,measurementsButton:`${H}__measurements-button`,measurementsTable:`${H}__measurements-table`,measurementDisplay:`${H}__measurement-display`,messageBox:`${H}__message-box`,navigationPathOffset0:`${ae}-feature-path-stop-offset-0`,navigationPathOffset1:`${ae}-feature-path-stop-offset-1`,navigationWrapper:`${ae}-wrapper`,navigationZoomed:`${ae}-wrapper--zoomed`,north:`${ae}-pointer-north`,outerSector:`${ae}-sector-outer`,overlaysSwitch:`${Ve}-switch`,pointer:`${ae}-pointer`,rotateWithAnimation:`${ae}-animate`,sector:`${ae}-sector`,sectorCross:`${ae}-sector-cross`,sectorDisabled:`${ae}-sector-disabled`,sectorEnabled:`${ae}-sector-enabled`,sectorSeparator:`${ae}-sector-separator`,selectedFeaturePath:`${ae}-feature-path`,sketchTools:`${H}__sketch-tools`,submenu:`${H}__submenu`,viewer:`${H}__viewer`,viewerHidden:`${H}__viewer--hidden`,viewerContainer:`${H}__viewer-container`},st=e=>e==="FA",Pi=async(e,t,a)=>{var s;const i=new(await z(()=>import("./AttachmentQuery-BceVlzuF.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(l=>l.default))({objectIds:[t]}),r=await e.queryAttachments(i,a),o=(s=r[`${t}`])==null?void 0:s[0],n=o==null?void 0:o.url;if(!n)throw new Q("NoAttachmentError","no attachments found",{[e.objectIdField]:t,layer:e});return{datasetFormat:o.contentType.split("/")[1].toUpperCase(),url:n}};async function xi(e,t){const a=typeof e=="string",i=a?e:e.url,{pathname:r,searchParams:o,origin:n}=new URL(i);let s=a?Br(r):e.datasetFormat;s||(s=await gi(i));const l=await z(()=>import("./ImageryTileLayer-qhG2Ytno.js").then(m=>m.R),__vite__mapDeps([4,5,6,1,7,8,9,10,11,2,12,3,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119]),import.meta.url).then(m=>m.default),h=await l.open({ioConfig:{customFetchParameters:Object.fromEntries(o),skipMapInfo:!0},datasetFormat:s==null?void 0:s.toUpperCase(),url:`${n}${r}`,signal:t==null?void 0:t.signal});return h?Cn(h,{signal:t==null?void 0:t.signal}):null}async function Cn(e,t){const{level:a,offset:i,size:r}=In(e),{pixelBlock:o}=await e.fetchRawPixels(a,i,r,t);return L(t),o}function In(e){const{storageInfo:t,width:a,height:i}=e.rasterInfo,{maximumPyramidLevel:r,pyramidScalingFactor:o}=t,n=o??2;return{level:r,offset:{x:0,y:0},size:{width:Math.ceil(a/n**r),height:Math.ceil(i/n**r)}}}async function Pn(e,t,a){if(!e)throw new Q("NoLayerError","No layer provided, cannot load image from attachment",{layer:e,objectId:t});const{datasetFormat:i,url:r}=await Pi(e,+t,a);return Vo(i)?await xi({datasetFormat:i,url:r},a):(await Jt(r,{...a,useRequestQueue:!0,responseType:"image",query:{w:Oo}})).data}function xn(e,t,a=0){const{height:i,width:r}=e;t.width=r,t.height=i;const o=t.getContext("2d");if(!o)return;const n=$n(e,t,o);n.getContext("2d")&&(a>0?Fn(o,n,r,i,a):o.drawImage(n,0,0))}function $n(e,t,a){const i=document.createElement("canvas"),r=i.getContext("2d");if(e instanceof HTMLImageElement)i.width=e.width,i.height=e.height,r==null||r.drawImage(e,0,0);else{const o=a.createImageData(t.width,t.height);o&&(o.data.set(e.getAsRGBA()),i.width=o.width,i.height=o.height,r==null||r.putImageData(o,0,0))}return i}function Fn(e,t,a,i,r){const o=Y(r),n=[it(0,0,o),it(a,0,o),it(a,i,o),it(0,i,o)],s=Math.max(...n.map(m=>m[0]))-Math.min(...n.map(m=>m[0])),l=Math.max(...n.map(m=>m[1]))-Math.min(...n.map(m=>m[1])),h=Math.min(a/s,i/l);e.save(),e.clearRect(0,0,a,i),e.translate(a/2,i/2),e.rotate(o),e.scale(h,h),e.drawImage(t,-a/2,-i/2,a,i),e.restore()}let Wt=class{static getCameraOrientation(e){return dr(e)}static register(e,t,a){pr.set(e,{desc:t,constructor:a})}};Wt=c([me("esri.layers.orientedImagery.core.cameraOrientationFactory")],Wt);const Sn=Wt;function Rn(e){throw new Q("exposure-point:missing-default-value",`a value for ${e} is missing in default properties`)}function On(e,t){throw new Q("exposure-point:missing-attribute-value",`a value for ${e} is missing in attribute table`,{exposurePoint:t})}const Se=e=>({cast:t=>{const a=parseFloat(t);return Number.isFinite(a)?a:void 0},json:{name:e,write:{writer:(t,a,i)=>{a[i]=Number.isFinite(t)?t:void 0}}}}),At=e=>({cast:t=>typeof t=="string"?t.split(";").map(Number):t,json:{default:e,write:{writer:(t,a,i)=>{a[i]=t==null?void 0:t.join(";")}}}});let x=class extends Ka.ClonableMixin(ze){constructor(t){super(t),this.cameraOrientation=null,this.elevation=null,this.elevationSource=null,this.name=null,this.sourceMap=null}read(t,a){const i={},{attributes:r,layer:o,geometry:n}=t,s={};for(const l in r)i[l.toLowerCase()]=r[l],s[l.toLowerCase()]=l;super.read({geometry:n,layer:o??{},sourceMap:s,...i},a)}write(t,a){const i=super.write(t,a),{sourceMap:r}=this;if(!r||!i)return i;const o={};for(const n in i){const s=r[n.toLowerCase()];s&&(o[s]=i[n])}return o}readCameraHeading(t,a){const{cameraheading:i,camheading:r,layer:o}=a;return i??r??o.cameraHeading}readCameraHeight(t,a){const{cameraheight:i,avghtag:r,layer:o}=a;return i??r??o.cameraHeight}readCamOffset(t,a){const{cameraoffset:i,camoffset:r}=a;return(i==null?void 0:i.split(";").map(Number))??(r==null?void 0:r.split(";").map(Number))??null}writeCameraOffset(t,a){t&&(a.cameraOffset=t.join(";"))}readCameraOrientation(t,a){const{cameraorientation:i,camori:r}=a;return i??r}readCameraPitch(t,a){const{camerapitch:i,campitch:r,layer:o}=a;return i??r??o.cameraPitch}readCameraRoll(t,a){const{cameraroll:i,camroll:r,layer:o}=a;return i??r??o.cameraRoll}readDepthImage(t,a){const{depthimage:i,depthimg:r,layer:o}=a,n=i??r??null,{depthImagePathPrefix:s,depthImagePathSuffix:l}=o??{};return da(n,s,l)}readElevationSource(t,a){const{elevationsource:i,layer:r}=a,{demPathSuffix:o,demPathPrefix:n}=r;if(i){const s=this._parseIfJSON(i);return gr(s,n,o)}return r.effectiveElevationSource}readFarDistance(t,a){const{fardistance:i,fardist:r,layer:o}=a;return i??r??o.farDistance}readHFOV(t,a){const{horizontalfieldofview:i,hfov:r,layer:o}=a;return i??r??o.horizontalFieldOfView}readImageURL(t,a){const{imagepath:i,layer:r}=a;i||On("imagePath",this);const{imagePathPrefix:o,imagePathSuffix:n}=r;return da(i,o,n)}readImageRotation(t,a){const{imagerotation:i,imgrot:r,layer:o}=a;return i??r??o.imageRotation}get isHorizontal(){return this.orientedImageryType==="horizontal"}get isInspection(){return this.orientedImageryType==="inspection"}get isNadir(){return this.orientedImageryType==="nadir"}get isOblique(){return this.orientedImageryType==="oblique"}get isSpherical(){return this.orientedImageryType==="360"}get location(){const{cameraOrientation:t,cameraHeight:a,elevation:i}=this;if(t){const{type:o,x:n,y:s,z:l,horizontalWKID:h,verticalWKID:m}=t,d=typeof h=="number"?{wkid:h}:{wkt:h};if(o===yr.LTP){const{latitude:v,longitude:y,ellipsoidRadius:w,squaredEccentricity:f,properties:b}=t,{x:C,y:F,z:I}=b;return new V(an([C,F,I],[v,y,w,f]))}const p=new V({x:n,y:s,z:l,spatialReference:d}),g=m?Ar("point",{wkid:m},d):null;return g&&g(p),p}if(typeof a!="number")throw Rn("cameraHeight");const r=this.geometry.clone();return r.z=r.hasZ?r.z:(i??0)+a,r}set matrix(t){if(!t||t.length!==9)return D.getLogger(this).warn("Ignoring rotation matrix because it doesn't have 9 values",{value:t}),void this._set("matrix",null);this._set("matrix",t)}readNearDistance(t,a){const{neardistance:i,neardist:r,layer:o}=a;return i??r??o.nearDistance}readOrientationAccuracy(t,a){const{accuracy:i,orientationaccuracy:r}=a;return(r==null?void 0:r.split(";").map(Number))??(i==null?void 0:i.split(";").map(Number))??null}writeOrientationAccuracy(t,a){t&&(a.orientationAccuracy=t.join(";"))}readOIType(t,a){const{orientedimagerytype:i,oitype:r,camerapitch:o,campitch:n,layer:s}=a,l=Ha.read(i??r??s.orientedImageryType),h=o??n??s.cameraPitch;return l==="oblique"?h<10?"nadir":"oblique":l}set radial(t){if(t)if(typeof t!="string")this._set("radial",t);else{const[a,i,r]=t.split(";").map(Number);this._set("radial",[a??0,i??0,r??0])}else this._set("radial",[0,0,0])}set tangential(t){if(t)if(typeof t!="string")this._set("tangential",t);else{const[a,i]=t.split(";").map(Number);this._set("tangential",[a??0,i??0])}else this._set("tangential",[0,0])}readVFOV(t,a){const{verticalfieldofview:i,vfov:r,layer:o}=a;return i??r??o.verticalFieldOfView}_parseIfJSON(t){let a=null;try{a=JSON.parse(t)}catch(i){D.getLogger(this).error("couldn't parse the given elevation source JSON",t,i)}return a}};c([u(Se())],x.prototype,"a0",void 0),c([u(Se())],x.prototype,"a1",void 0),c([u(Se())],x.prototype,"a2",void 0),c([u({type:Date,json:{write:{enabled:!0,target:"acquisitionDate"},name:"acquisitiondate"}})],x.prototype,"acquisitionDate",void 0),c([u(Se())],x.prototype,"b0",void 0),c([u(Se())],x.prototype,"b1",void 0),c([u(Se())],x.prototype,"b2",void 0),c([u({type:Number,json:{write:!0,read:{source:["cameraheading","camheading","layer.cameraHeading"]}}})],x.prototype,"cameraHeading",void 0),c([te("cameraHeading")],x.prototype,"readCameraHeading",null),c([u({type:Number,json:{write:!0}})],x.prototype,"cameraHeight",void 0),c([te("cameraHeight",["cameraheight","avghtag","layer.cameraHeight"])],x.prototype,"readCameraHeight",null),c([u()],x.prototype,"cameraOffset",void 0),c([te("cameraOffset",["cameraoffset","camoffset"])],x.prototype,"readCamOffset",null),c([_a("cameraOffset")],x.prototype,"writeCameraOffset",null),c([u({json:{write:{writer:(e,t,a)=>{t[a]=e.toString()}}},type:vr}),jr(e=>e?Sn.getCameraOrientation(e):null)],x.prototype,"cameraOrientation",void 0),c([te("cameraOrientation",["cameraorientation","camori"])],x.prototype,"readCameraOrientation",null),c([u({type:Number,json:{write:!0}})],x.prototype,"cameraPitch",void 0),c([te("cameraPitch",["camerapitch","campitch","layer.cameraPitch"])],x.prototype,"readCameraPitch",null),c([u({type:Number,json:{write:!0}})],x.prototype,"cameraRoll",void 0),c([te("cameraRoll",["cameraroll","camroll","layer.cameraRoll"])],x.prototype,"readCameraRoll",null),c([u({json:{write:!0},type:String})],x.prototype,"depthImage",void 0),c([te("depthImage",["depthimage","depthimg"])],x.prototype,"readDepthImage",null),c([u({type:Number,json:{write:!0}})],x.prototype,"elevation",void 0),c([u({json:{write:!0},clonable:"reference"})],x.prototype,"elevationSource",void 0),c([te("elevationSource",["elevationsource","layer.effectiveElevationSource"])],x.prototype,"readElevationSource",null),c([u({json:{name:"exposurestationid",write:{target:"exposureStationId"}},type:String})],x.prototype,"exposureStationId",void 0),c([u({type:Number,json:{write:!0}})],x.prototype,"farDistance",void 0),c([te("farDistance",["fardistance","fardist","layer.farDistance"])],x.prototype,"readFarDistance",null),c([u(Se("focallength"))],x.prototype,"focalLength",void 0),c([u({type:V,json:{name:"geometry"}})],x.prototype,"geometry",void 0),c([u({type:Number,json:{write:!0}})],x.prototype,"horizontalFieldOfView",void 0),c([te("horizontalFieldOfView",["horizontalfieldofview","hfov","layer.horizontalFieldOfView"])],x.prototype,"readHFOV",null),c([u({json:{write:!0},type:String})],x.prototype,"imagePath",void 0),c([te("imagePath",["imagepath"])],x.prototype,"readImageURL",null),c([u({type:Number,json:{write:!0}})],x.prototype,"imageRotation",void 0),c([te("imageRotation",["imagerotation","imgrot","layer.imageRotation"])],x.prototype,"readImageRotation",null),c([u()],x.prototype,"isHorizontal",null),c([u()],x.prototype,"isInspection",null),c([u()],x.prototype,"isNadir",null),c([u()],x.prototype,"isOblique",null),c([u()],x.prototype,"isSpherical",null),c([u()],x.prototype,"location",null),c([u(At())],x.prototype,"matrix",null),c([u({json:{write:!0},type:String})],x.prototype,"name",void 0),c([u({type:Number,json:{write:!0}})],x.prototype,"nearDistance",void 0),c([te("nearDistance",["neardistance","neardist","layer.nearDistance"])],x.prototype,"readNearDistance",null),c([u({json:{write:!0,name:"objectid"},type:Number})],x.prototype,"objectId",void 0),c([u()],x.prototype,"orientationAccuracy",void 0),c([te("orientationAccuracy",["accuracy","orientationaccuracy"])],x.prototype,"readOrientationAccuracy",null),c([_a("orientationAccuracy")],x.prototype,"writeOrientationAccuracy",null),c([ei(Ha)],x.prototype,"orientedImageryType",void 0),c([te("orientedImageryType",["orientedimagerytype","oitype","layer.orientedImageryType"])],x.prototype,"readOIType",null),c([u({type:Number,json:{write:!0,read:{source:"principalx"}}})],x.prototype,"principalX",void 0),c([u({type:Number,json:{write:!0,read:{source:"principaly"}}})],x.prototype,"principalY",void 0),c([u(At([0,0,0]))],x.prototype,"radial",null),c([u({type:Number,json:{name:"sortorder",write:{target:"sortOrder"}}})],x.prototype,"sortOrder",void 0),c([u({type:Object})],x.prototype,"sourceMap",void 0),c([u(At([0,0]))],x.prototype,"tangential",null),c([u({type:Number,json:{write:!0}})],x.prototype,"verticalFieldOfView",void 0),c([te("verticalFieldOfView",["verticalfieldofview","vfov","layer.verticalFieldOfView"])],x.prototype,"readVFOV",null),x=c([me("esri.layers.orientedImagery.core.ExposurePoint")],x);const $i=x,Ne={},An=1e3;async function Tn(e,t){var s;const{point:a,queryParams:i}=e;if(a==null)return null;const r={};let o=e.layerInstanceOrURL;const n=a.spatialReference.isGeographic?Ht(a.clone()):a.clone();if(r.outSpatialReference=n.spatialReference,i&&(r.maxRecordCountFactor=i.maxRecordCountFactor??5,r.outFields=i.outFields??["*"],r.where=i.where??"1=1",r.returnGeometry=i.returnGeometry??!0,r.outSpatialReference=i.outSpatialReference),typeof o=="string"&&(Ne.layer&&Ne.layer.url===o?o=Ne.layer:((s=Ne.layer)==null||s.destroy(),o=Ne.layer=new Na({url:o}))),o)try{await o.load();const l=o,h=Vn(n,(i==null?void 0:i.maximumDistance)??l.maximumDistance??An);r.returnZ=l.hasZ;const m=new eo({geometry:h,...r}),d=await l.queryFeatures(m,t);return Ln(l)(d)}catch(l){fr(l)}return null}function Ln(e){return t=>{const{features:a,spatialReference:i}=t;return a.forEach(r=>{r.geometry&&(r.geometry.spatialReference=i);const o=$i.fromJSON({...r.toJSON(),layer:e});o&&(r.attributes=o),r.layer=e,r.spatialReference=i}),t}}function Vn(e,t){const a=e.x-t,i=e.x+t,r=e.y-t,o=e.y+t;return new qr({xmin:a,xmax:i,ymin:r,ymax:o,spatialReference:e.spatialReference})}function kn(e){const{camera:t,features:a,selectedPoint:i}=e;if(!a.length)return[];e.currentImage??(e.currentImage={attributes:{cameraHeading:0,cameraPitch:0}});const r=En(t,i,e.currentImage);return a.map(r)}function En(e,t,a){return t.z??(t.z=0),t.elevation??(t.elevation=0),i=>{const{hfovWeight:r,vfovWeight:o,distanceWeight:n}=zn(i.attributes,e?"3d":"2d"),s=i.attributes,{cameraHeight:l,cameraHeading:h,cameraPitch:m,farDistance:d,horizontalFieldOfView:p,verticalFieldOfView:g,isOblique:v}=s,y=s.geometry,w=180*Math.atan2(y.y-t.y,y.x-t.x)/Math.PI,f=Or(t,y);let b,C,F=p,I=g,S=!1;e?(b=e.heading,C=e.tilt,F=180,I=180,S=!0):!v||m<10?(b=h,C=m,S=!1):(b=a.attributes.cameraHeading,C=m,S=!0,F=180),b>180&&(b-=360);let A=1;y.spatialReference.isWebMercator&&(A=1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*y.y/Qt.radius))));const E=Math.sqrt((Math.sqrt((t.x-y.x)**2+(t.y-y.y)**2)/A)**2+((t.z??0)-(t.elevation??0)-l)**2),T=90-180*Math.atan2(t.y-y.y,t.x-y.x)/Math.PI;let G=(Math.abs(T-b)>180?Math.abs(360-Math.abs(T-b)):Math.abs(T-b))/F;G=4*G+1;const ce=180*Math.acos((s.cameraHeight-(t.z??0)+(t.elevation??0))/E)/Math.PI;let he=Math.abs(ce-C)/I;he=4*he+1;let et=E/Math.sqrt(d**2+l**2);et=4*et+1;const ua=r*G+o*he+n*et;let Mt;if(S){const Ct=h>180?h-360:h;Mt=r*((Math.abs(T-Ct)>180?Math.abs(360-Math.abs(T-Ct)):Math.abs(T-Ct))/p*4+1)+o*(Math.abs(ce-m)/g*4+1)+n*et}else Mt=ua;return{suitability:ua,trueSuitability:Mt,feature:i,angle:w,distance:f,verticalAngle:Math.abs(180*Math.atan(f/l)/Math.PI)}}}function zn(e,t){const a="isOblique"in e?e:new $i(e),{isOblique:i,isSpherical:r,isNadir:o}=a;return r?{hfovWeight:t==="2d"?0:1,vfovWeight:t==="2d"?0:.6,distanceWeight:t==="2d"?1:.5}:o?{hfovWeight:.25,vfovWeight:1,distanceWeight:1}:i?{hfovWeight:1,vfovWeight:.25,distanceWeight:1}:{hfovWeight:1,vfovWeight:1,distanceWeight:1}}const oe=Math.PI/180;function Tt(e){return e.isSpherical?Bn(e):Gn(e)}function Gn(e){const{horizontalFieldOfView:t,verticalFieldOfView:a,geometry:i,cameraHeading:r}=e,o=Xe(i.y,i.spatialReference);let n=e.cameraPitch,s=e.cameraRoll??0,l=150;t>150&&(n=90,s=0,l=5);const h=Math.ceil(t/l),m=Dn(h,r,t);let d=e.farDistance?e.farDistance*o:e.cameraHeight*o/Math.cos(n*oe);e.cameraPitch+a/2>=90&&(d=(e.farDistance||20)*o);const p=new ne({spatialReference:i==null?void 0:i.spatialReference});p.imageID=e.objectId;let g=null;for(const v of m)g=Hn(v,n,e.cameraHeight,i,d,o,a,t,h,p,s,e.nearDistance);return g.imageID=e.objectId,{polygon:p,frustum:g}}function Dn(e,t,a){const i=[];if(e%2==0)for(let r=0;r<e/2;r++)i.push(t-a/e*(r+.5),t+a/e*(r+.5));else{i.push(t);for(let r=1;r<e/2;r++)i.push(t-a/e*r,t+a/e*r)}return i.sort(),i}function Hn(e,t,a,i,r,o,n,s,l,h,m=0,d=0){const p=ja(vt(),jt([e,t,m??0])),g=Wn({cameraHeight:a,cameraPitch:t,farDistance:r,location:i,horizontalFieldOfView:s,nearDistance:d,verticalFieldOfView:n},p),v=be([0,0,-1],p),{x:y,y:w}=i,f=Ge([y,w,a],v,r,o),b=2*Math.tan(n*oe/2)*r,C=2*Math.tan(s/l*oe/2)*r,F=be([0,1,0],p),I=be([1,0,0],p),S=B(F,b/2,o),A=B(I,C/2,o),E=J(R(),S,A),T=le(R(),S,A),G=Nn([le(R(),f,E),le(R(),f,T),J(R(),f,E),J(R(),f,T)],a,i,o);return G.push(G[0]),h.addRing(G),g}function Nn(e,t,a,i){return e.map(r=>qn(r,t,a,i))}function Bn(e){const{geometry:t,farDistance:a,objectId:i,nearDistance:r,cameraHeight:o}=e,n=Xe(t.y,t.spatialReference),s=new Bt({center:t.clone(),radius:a*n});if(s.imageID=i,r){const m=new Bt({center:t.clone(),radius:r*n});s.addRing(m.rings[0])}const l=t.clone();l.z=o-a*n;const h=Qe.createSphere(l,{size:2*a*n});return h.imageID=i,{polygon:s,frustum:h}}function jn(e,t){return e.contains(t)}function Lt(e,t){return Math.sign(e)!==Math.sign(t)}function Wn(e,t,a){const{cameraHeight:i,cameraPitch:r,farDistance:o,location:n,horizontalFieldOfView:s,nearDistance:l,verticalFieldOfView:h}=e,m=Fi(n),d=!(r+h/2>=90),p=2*Math.tan(h*oe/2)*l,g=2*Math.tan(s*oe/2)*l,v=2*Math.tan(h*oe/2)*o,y=2*Math.tan(s*oe/2)*o;let w,f;f=[0,0,-1],f=be(f,t),w=Ge([n.x,n.y,i],f,o,m),d&&(w[2]=0);const b=Ge([n.x,n.y,i],f,l,m);let C=[0,1,0];C=be(C,t);let F=[1,0,0];F=be(F,t);let I=[],S=[];l?(S=[{faces:[4,0,3,4,7,3]},{faces:[5,1,2,5,6,2]},{faces:[4,0,1,4,5,1]},{faces:[6,2,3,6,7,3]}],I=I.concat(le(R(),b,J(R(),B(C,p/2,m),B(F,g/2,m)))),I=I.concat(le(R(),b,le(R(),B(C,p/2,m),B(F,g/2,m)))),I=I.concat(J(R(),b,J(R(),B(C,p/2,m),B(F,g/2,m)))),I=I.concat(J(R(),b,le(R(),B(C,p/2,m),B(F,g/2,m))))):(I=[n.x,n.y,i],S=[{faces:[0,1,2,0,2,3,0,3,4,0,4,1]}]),I=I.concat(le(R(),w,J(R(),B(C,v/2,m),B(F,y/2,m)))),I=I.concat(le(R(),w,le(R(),B(C,v/2,m),B(F,y/2,m)))),I=I.concat(J(R(),w,J(R(),B(C,v/2,m),B(F,y/2,m)))),I=I.concat(J(R(),w,le(R(),B(C,v/2,m),B(F,y/2,m))));const A=new ta({position:Float64Array.from(I)});return new Qe({vertexAttributes:A,components:S,spatialReference:n.spatialReference})}function qn(e,t,a,i){{const r=Math.sqrt((e[2]-t)**2+(Math.sqrt((e[0]-a.x)**2+(e[1]-a.y)**2)/i)**2)*i,o=B(J(R(),[e[0],e[1],e[2]],[a.x,a.y,t]),1/r,1/i),n=t/(t-e[2]),s={x:(1-n)*a.x+n*e[0],y:(1-n)*a.y+n*e[1],z:(1-n)*t+n*e[2]},l=Math.sqrt((s.z-t)**2+(Math.sqrt((s.x-a.x)**2+(s.y-a.y)**2)/i)**2)*i,h=B(J(R(),[s.x,s.y,s.z],[a.x,a.y,t]),1/l,1/i);return Lt(o[0],h[0])&&Lt(o[1],h[1])&&Lt(o[2],h[2])||e[2]>=0?[e[0],e[1],0]:[s.x,s.y,s.z]}}function Zn(e){const{spatialReference:t,x:a,y:i}=e.geometry,{cameraHeading:r,cameraPitch:o,farDistance:n,nearDistance:s}=e,l=Fi(e.geometry),h=new ne({spatialReference:t}),m=Math.abs(1.44*n*l);let d=Math.abs(1.44*s*l);(o<20||r==null)&&(d=m);const p=[];return p[0]={x:a+m*Math.sin((r-45)*oe),y:i+m*Math.cos((r-45)*oe)},p[1]={x:a+m*Math.sin((r+45)*oe),y:i+m*Math.cos((r+45)*oe)},p[2]={x:a+d*Math.sin((r+135)*oe),y:i+d*Math.cos((r+135)*oe)},p[3]={x:a+d*Math.sin((r+225)*oe),y:i+d*Math.cos((r+225)*oe)},h.addRing([[p[0].x,p[0].y,0],[p[1].x,p[1].y,0],[p[2].x,p[2].y,0],[p[3].x,p[3].y,0],[p[0].x,p[0].y,0]]),h}function Fi(e){return e&&qa(e==null?void 0:e.spatialReference)?1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*e.y/Qt.radius))):1}function Un(e,t){const a=1+t/100;if(e.declaredClass==="esri.geometry.Circle"){const{radius:i,center:r}=e,o=new Bt({radius:i*a,center:r});return e.rings.length>1&&o.addRing(e.rings[1]),o}if(e.declaredClass==="esri.geometry.Polygon"){const i=new ne({spatialReference:e.spatialReference}),r=e.centroid;if(r){const o=[];for(let n=0;n<e.rings[0].length;n++){const s=Math.sqrt((r.x-e.rings[0][n][0])**2+(r.y-e.rings[0][n][1])**2),l=B(J(R(),[e.rings[0][n][0],e.rings[0][n][1],0],[r.x,r.y,0]),1/s,1),h=Ge([r.x,r.y,0],l,s*a,1);o.push({x:h[0],y:h[1]})}i.addRing([[o[0].x,o[0].y,0],[o[1].x,o[1].y,0],[o[2].x,o[2].y,0],[o[3].x,o[3].y,0],[o[0].x,o[0].y,0]])}return i}return e}async function xc(e,t,a){const{cameraHeight:i,cameraLocation:r,cameraPitch:o,frustumVertices:n,horizontalFieldOfView:s,imageHeight:l,imageWidth:h,inSRS:m,outSRS:d,verticalFieldOfView:p,cameraRoll:g,options:v}=a,y=new U(m),w=new U(d),f=wi(s,p,g??0),b=n.length>15;return o+f.vfov/2>=90?await Kn(n,e,h,l,y,w,b,v):await Qn(n,e,t,r,i,b,y,w,v)}async function Qn(e,t,a,i,r,o,n,s,l){const h=Jn(e,t,a,i,r);if(!h)return;const{farPlane:m,nearPlane:d}=h,p=await Si([...(d==null?void 0:d.vertexPositions)??e.slice(0,3),...m.vertexPositions],n,s,l),g=Ti(p);return new Qe({vertexAttributes:new ta({position:p}),components:Ai(o?Ri(g,!0):Oi(g,!0)),spatialReference:s})}function Jn(e,t,a,i,r){const o=Oa(e),n=Oa(e,"near");if(!o)return;const s=t.length;for(let l=0;l<s;l++){const h=Array.from(a[l]),m=[h[0]-i[0],h[1]-i[1],h[2]-(i[2]??r)];Xn(i,m,l,n),Yn(i,m,l,o)}return{farPlane:o,nearPlane:n}}function Yn(e,t,a,i){const{coefficients:r,vertexPositions:o}=i,n=R();ti(r,{origin:e,direction:t},n)&&o.splice(3*a,3,...n)}function Xn(e,t,a,i){if(!i)return;const r=R();ti(i.coefficients,{origin:e,direction:t},r)&&i.vertexPositions.splice(3*a,3,...r)}async function Kn(e,t,a,i,r,o,n,s){let l,h=n?new Array:[e[0],e[1],e[2]],m=new Array;for(const g of t)n?(l=je([g[0],g[1],1],[[0,0,1],[a,0,1],[a,i,1],[0,i,1]],[[e[0],e[1],e[2]],[e[3],e[4],e[5]],[e[6],e[7],e[8]],[e[9],e[10],e[11]]]),h=h.concat(...l),l=je([g[0],g[1],1],[[0,0,1],[a,0,1],[a,i,1],[0,i,1]],[[e[12],e[13],e[14]],[e[15],e[16],e[17]],[e[18],e[19],e[20]],[e[21],e[22],e[23]]]),m=m.concat(...l)):(l=je([g[0],g[1],1],[[0,0,1],[a,0,1],[a,i,1],[0,i,1]],[[e[3],e[4],e[5]],[e[6],e[7],e[8]],[e[9],e[10],e[11]],[e[12],e[13],e[14]]]),h=h.concat(...l));h=h.concat(m);const d=await Si(h,r,o,s),p=Ti(d);return new Qe({vertexAttributes:new ta({position:d}),components:Ai(n?Ri(p,!0):Oi(p,!0)),spatialReference:o})}async function Si(e,t,a,i){if(t.equals(a))return e;const r=e.reduce((n,s,l)=>{const h=Math.floor(l/3);return n[h]||(n[h]=new Array),n[h].push(s),n},new Array),{points:o}=await re(new Za(r,t),a,i);return L(i),o.flat()}function Oa(e,t="far"){const a=ro();let i;switch(t){case"far":if(i=Array.from(e.length===15?e.slice(3):e.slice(12)),ba(a,i,!1))return{coefficients:a,vertexPositions:i};break;case"near":return i=Array.from(e.slice(0,12)),e.length===15||!ba(a,i,!1)?void 0:{coefficients:a,vertexPositions:i}}}const Ri=(e,t=!1)=>{if(t&&e-2<=4||e<=4||e%2!=0)throw new Error("Invalid number of vertices");const a=[],i=e/2,r=Math.round((t?e-2:e)/2);for(let o=0;o<r;o++){const n=o+i,s=t?n+1:n,l=s%e,h=(t?n:s+1)%e;a.push({faces:new Uint32Array([o,h,l,o,o+1,l])})}return a};function Oi(e,t=!1){if(e<3||t&&e-1<3)throw new Error("Invalid number of vertices");const a=[],i=t?e-2:e-1;for(let r=0;r<i;r++)a.push({faces:new Uint32Array([0,r+1,r+2])});return a}const Ai=e=>e.map(t=>new to(t)),Ti=e=>e.length/3;async function De(e,t,a){const i=Array.isArray(e)?e:[e];let r;if(Ii(t))r=await yi(i,t.elevationSample,a);else if(la(t)){const{elevationSource:o,extent:n}=t,{url:s,lod:l,rasterFunction:h}=o;r=await No(i,{url:s,lod:l,rasterFunction:h,extent:n},a)}else r=await Zo(i,t.elevationSource.constantElevation,a);return Array.isArray(e)?r:r[0]}function $e(e,t){const{cameraLocation:a,pointsToTransform:i,scalingFactor:r}=ts(e,t.cameraLocation,t.rotationMatrix),o=new Array;return es(i,o,{...t,cameraLocation:a,scalingFactor:r,...rs(t)}),Array.isArray(e)?o:o[0]}function es(e,t,a){const{affineTransformations:i,cameraLocation:r,focalLengthX:o,focalLengthY:n,principalOffsetPoint:s,radialDistortionCoefficients:l,rotationMatrix:h,scalingFactor:m,tangentialDistortionCoefficients:d}=a;for(const p of e){const g=Ut();J(g,p,r),g[0]=g[0]/m,g[1]=g[1]/m;const v=-o*((h[0]*g[0]+h[3]*g[1]+h[6]*g[2])/(h[2]*g[0]+h[5]*g[1]+h[8]*g[2])),y=-n*((h[1]*g[0]+h[4]*g[1]+h[7]*g[2])/(h[2]*g[0]+h[5]*g[1]+h[8]*g[2])),w=v*v+y*y;let f=0,b=0,C=0,F=0,I=0,S=0,A=0;l&&(f=l[0]??0,b=l[1]??0,C=l[2]??0),d&&(F=d[0],I=d[1]),s&&(S=s[0]??0,A=s[1]??0);const E=1+f*w+b*w*w+C*w*w*w;let T=v*E+F*(w+2*v**2)+2*I*v*y,G=y*E+I*(w+2*y**2)+2*F*v*y;T+=S,G+=A;const ce=Number(i[0])+Number(i[1])*T+Number(i[2])*G,he=Number(i[3])+Number(i[4])*T+Number(i[5])*G;t.push({x:ce,y:he})}}function Ke(e,t){const{cameraHeading:a,imageHeight:i,imageWidth:r}=t,{cameraLocation:o,pointsToTransform:n}=as(e,t.cameraLocation),s=new Array;for(const l of n){const h=Rr(o,l),m=wn(ve(Math.atan2(l[0]-o[0],l[1]-o[1]))-a),d=ve(Math.acos((o[2]-l[2])/h));s.push(_i(m,d,r,i))}return Array.isArray(e)?s:s[0]}function ts(e,t,a){const i=Array.isArray(e)||"items"in e?e:[e];bi(i,t),Li(i,t),Mi(a);const r=Xe(t.y,t.spatialReference);return{pointsToTransform:i.map(o=>o.toArray()),scalingFactor:r,cameraLocation:t.toArray()}}function as(e,t){const a=Array.isArray(e)||"items"in e?e:[e];return bi(a,t),Li(a,t),{pointsToTransform:a.map(i=>i.toArray()),cameraLocation:t.toArray()}}function Li(e,t){if(e.some(a=>!a.spatialReference.equals(t.spatialReference)))throw new Error("Input points and camera location must have the same spatial reference")}function is(e){return(e==null?void 0:e.focalLength)!=null}function rs(e){if(is(e))return{focalLengthX:e.focalLength,focalLengthY:e.focalLength};const{imageWidth:t,imageHeight:a,horizontalFieldOfView:i,verticalFieldOfView:r}=e;return{focalLengthX:t/(2*Math.tan(Y(i)/2)),focalLengthY:a/(2*Math.tan(Y(r)/2))}}async function os(e,t,a,i=Vi){const{cameraLocation:r,farPlaneVertices:o}=a,n=ue(r),s=new Array;await Ei(o,a,s);let l=lt(s[0],s[1],s[2]),h=e.clone();for(let m=0;m<i;m++){const d=Ut();if(!ai(l,n,ue(e),d))break;let p=0,g=null;if({error:p,imagePoint:g,pointWithZ:h}=await ss(t,new V(d,r.spatialReference),a),p<=1)break;const[v,y]=ki(r.spatialReference,s);if(Me(v<=1,y<=1))break;s.splice(0,s.length,...await zi(v,y,new V(d,r.spatialReference),a)),l=lt(s[0],s[1],s[2])}return ue(h)}async function ns(e,t,a,i=Vi){const{cameraLocation:r,farPlaneVertices:o}=a,n=ue(r),s=new Array;await Ei(o,a,s);let l=lt(s[0],s[1],s[2]),h=e.clone();for(let m=0;m<i;m++){const d=Ut();if(!ai(l,n,ue(e),d))break;let p,g=0;if({error:g,imagePoint:p,pointWithZ:h}=await ls(t,new V(d,r.spatialReference),a),g<=1)break;const[v,y]=ki(r.spatialReference,s);if(Me(v<=1,y<=1))break;s.splice(0,s.length,...await zi(v,y,new V(d,r.spatialReference),a)),l=lt(s[0],s[1],s[2])}return ue(h)}const Vi=10,Aa=10;function ki(e,t){var i,r;const a=new ne({spatialReference:e});return a.addRing(t),[(i=a.extent)!=null&&i.width?a.extent.width/Aa:1,(r=a.extent)!=null&&r.height?a.extent.height/Aa:1]}async function Ei(e,t,a){const i=co(e),r=await De(i,t);a.push(...r.map(ue))}async function ss(e,t,a){const i=await De(t,a),r=$e(i,a);return{error:cs(r,e),imagePoint:r,pointWithZ:i}}async function ls(e,t,a){const i=await De(t,a),r=Ke(i,a);return{error:hs(r,e),imagePoint:r,pointWithZ:i}}const cs=(e,t)=>Math.abs(e.x-t.x)+Math.abs(e.y-t.y),hs=(e,t)=>Math.abs(e.heading-t.heading)+Math.abs(e.pitch-t.pitch);async function zi(e,t,a,i){const r=[[-e,-t],[e,-t],[e,t],[-e,t]].map(([o,n])=>new V([a.x+o,a.y+n],a.spatialReference));return De(r,i).then(o=>o.map(n=>n.toArray()))}async function _t(e,t,a){const{verticalFieldOfView:i,imageBoundaries:r,scalingFactor:o,farPlaneVertices:n,cameraLocation:s,pixelsToTransform:l,vecToPoint:h}=vs(e,t),m=new Array;return await us(l,n,r,h,t,m,s,o,i,a),Array.isArray(e)?m:m[0]}async function us(e,t,a,i,r,o,n,s,l,h){let m=r.averageElevation;for(const d of e){const p=ds(t,a,d,i,r);h&&Me(We(h.elevationSample),la(h))&&(m=(await os(i(p),{x:d[0],y:d[1]},{...r,...h,farPlaneVertices:t.map(i)}))[2]),o.push(i(Gi(p,n,s,m,r.cameraPitch,l)))}}function Gi(e,t,a,i,r,o){let n=$r(e);const s=Math.sqrt((e[2]-t[2])**2+(Math.sqrt((e[0]-t[0])**2+(e[1]-t[1])**2)/a)**2)*a,l=B(J(R(),e,t),1/s,1/a);if(ms(e[2],i,r,o)){const h=Math.abs((t[2]-i)/-l[2])*a;n=Ge(t,l,h,a)}else n[2]=i;return n}function ms(e,t,a,i){return e<t||a+i/2<90}function ds(e,t,a,i,r){let o=null;const n=9;let s,l=0,h=e,m=t;for(;l<=n;){const d=gs(a,m,h,r);if(s=d.error,o=d.transformedPoint,Me(s<=1,l===n))break;h=ln(h,s,a,t),m=ps(h,i,r),l++}return o}function ps(e,t,a){return $e(e.map(t),a).map(({x:i,y:r})=>[i,r,1])}function gs(e,t,a,i){const{cameraLocation:r}=i,o=je(e,t,a),{x:n,y:s}=$e(new V(o,r.spatialReference),i);return{transformedPoint:o,error:ys(e,[n,s,1])}}function ys(e,t){return Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1])}function vs(e,t){const a=wr(e)||"items"in e?e:[e],{cameraLocation:i,rotationMatrix:r}=t;if(nn(a,i),Mi(r),(r==null?void 0:r.length)!==9)throw new Error("Rotation matrix is not provided or is not a valid 3x3 matrix");const o=Xe(i.y,i.spatialReference),n=yn({...t,scalingFactor:o}),s=$e(n.map(h=>new V(h,i.spatialReference)),t),{vfov:l}=wi(t.horizontalFieldOfView,t.verticalFieldOfView,t.cameraRoll);return{cameraLocation:i.toArray(),imageBoundaries:s.map(({x:h,y:m})=>[h,m,1]),verticalFieldOfView:l,farPlaneVertices:n,scalingFactor:o,pixelsToTransform:a.map(h=>[h.x,h.y,1]),vecToPoint:sn(i.spatialReference)}}async function bt(e,t,a){const{cameraHeading:i,cameraLocation:r,farDistance:o,imageHeight:n,imageWidth:s,verticalFieldOfView:l}=t,h=Xe(r.y,r.spatialReference),m=new Array,[d,p,g]=r.toArray(),v=oo([d,p,g??0],o*h),y=sa.toArray(),w=Array.isArray(e)?e:[e];for(const f of w){let b,C;if(pn(f))b=f.heading,C=f.pitch;else{const E=Pe({x:f.x,y:f.y},s,n);b=E.heading,C=E.pitch}b=(b+i)%360;const F=no([y[0],y[1],y[2]],xe(b,C)),I=so([d,p,g??0],F.direction),S=R();lo(v,I,S);let A=t.averageElevation;a&&(Zt(a)||We(a.elevationSample))&&C+l/2<90&&(A=(await ns(new V(S,r.spatialReference),{heading:b,pitch:C},{...t,...a,farPlaneVertices:gn(o,o).map(([E,T])=>new V([r.x+E,r.y+T],r.spatialReference))}))[2]),m.push(new V(Gi(S,r.toArray(),h,A,C,l),r.spatialReference))}return Array.isArray(e)?m:m[0]}let we=class extends Ka.ClonableMixin(ze){constructor(e){super(e),this.maxFOV=0,this.minFOV=0,this.view=null,this.zoomFactor=5}get canZoomIn(){return!!this.view&&(this.minFOV===0||this.view.camera.fov>this.minFOV)}get canZoomOut(){return!!this.view&&(this.maxFOV===0||this.view.camera.fov<this.maxFOV)}};c([u({type:Boolean,readOnly:!0})],we.prototype,"canZoomIn",null),c([u({type:Boolean,readOnly:!0})],we.prototype,"canZoomOut",null),c([u({type:Number})],we.prototype,"maxFOV",void 0),c([u({type:Number})],we.prototype,"minFOV",void 0),c([u()],we.prototype,"view",void 0),c([u({type:Number})],we.prototype,"zoomFactor",void 0),we=c([me("esri.widgets.PanoramicViewer.PanoramicZoomConditions")],we);const dt=we;let Ie=class extends vo{constructor(t){super(t),this.panoramicZoomConditions=new dt,this.zoomTo=a=>{this.view.camera.fov=this.constrainFOV(a),this.view.camera=this.view.camera.clone()}}initialize(){this.addHandles([O(()=>{var t;return[(t=this.view)==null?void 0:t.ready,this.panoramicZoomConditions]},()=>{var t;(t=this.view)!=null&&t.ready&&(this.panoramicZoomConditions.view=this.view,this.zoomTo(this.view.camera.fov))},Z),O(()=>[this.panoramicZoomConditions.maxFOV,this.panoramicZoomConditions.minFOV],([t,a])=>{t!=null&&a!=null&&this.zoomTo(this.view.camera.fov)},Mr)])}get canZoomIn(){return this.panoramicZoomConditions.canZoomIn}get canZoomOut(){return this.panoramicZoomConditions.canZoomOut}get state(){var t;return(t=this.view)!=null&&t.ready?"ready":"disabled"}set view(t){this._set("view",t)}constrainFOV(t){const{maxFOV:a,minFOV:i}=this.panoramicZoomConditions;return Te(t,i,a)}zoomIn(){if(!this.canZoomIn)return;const t=this.view.camera.fov-this.panoramicZoomConditions.zoomFactor;this.zoomTo(t)}zoomOut(){if(!this.canZoomOut)return;const t=this.view.camera.fov+this.panoramicZoomConditions.zoomFactor;this.zoomTo(t)}};c([u()],Ie.prototype,"canZoomIn",null),c([u()],Ie.prototype,"canZoomOut",null),c([u({type:dt})],Ie.prototype,"panoramicZoomConditions",void 0),c([u()],Ie.prototype,"state",null),c([u()],Ie.prototype,"view",null),Ie=c([me("esri.widgets.PanoramicViewer.PanoramicZoomViewModel")],Ie);const fs=Ie;function ws(e,t=sa,a=wt){const i=t.clone();i.z=-500;const r=Qe.createSphere(i,{size:a,densificationFactor:2,vertexSpace:"georeferenced",material:new ao({colorTexture:new io({data:e})})});if(r.components[0].trustSourceNormals=!0,r.vertexAttributes.uv){const o=r.vertexAttributes.uv.length??0;for(let n=0;n<o;n++)r.vertexAttributes.uv[2*n+0]=1-r.vertexAttributes.uv[2*n+0],r.vertexAttributes.uv[2*n+1]=r.vertexAttributes.uv[2*n+1]}return r.centerAt(i),r}function _s(e){return new N({geometry:e,symbol:new Yt({symbolLayers:new j([new Xt])})})}function Vt(e,t){return 2*ve(Math.atan(Math.tan(Y(e/2))*Math.sqrt(t**2+1)))}const ke={autoLoad:"auto-load",default:"default",navigation:"navigation",fovConstraint:"fov-constraint",clickAction:"image-click-action"};let W=class extends ea.EventedAccessor{constructor(t){super(t),this._startPosition=null,this._targetPosition=null,this._graphics=new Be({elevationInfo:{mode:"relative-to-ground"}}),this._imageGraphic=null,this._loadController=null,this._map=new ri({ground:new go({opacity:0,navigationConstraint:null}),layers:new j([this._graphics])}),this._zoomViewModel=null,this.autoLoad=!1,this.clickAction="none",this.imageSize=null,this.imageSource=null,this.pitch=90,this.state="ready",this.yaw=0,this._addNavigationHandles=()=>{this.imageRenderer.basemapTerrain.suspended=!0,this.imageRenderer.constraints.tilt.max=180,this.removeHandles(ke.navigation),this.addHandles([this.imageRenderer.on("mouse-wheel",this._handleWheel),this.imageRenderer.on("double-click",this._handleDoubleClick),this.imageRenderer.on("drag",this._handleDrag),this.imageRenderer.on("key-down",a=>{const i=["+","-","Shift","_","=","ArrowUp","ArrowDown","ArrowRight","ArrowLeft"],r=a.key;i.includes(r)&&a.stopPropagation()})],ke.navigation)},this._addHFOVHandles=()=>{this.removeHandles(ke.fovConstraint),this.addHandles(O(()=>[this.maxHFOV,this.minHFOV],()=>{this._zoomViewModel&&(this._zoomViewModel.panoramicZoomConditions=new dt({view:this.imageRenderer,maxFOV:this.maxHFOV,minFOV:this.minHFOV}))},Z),ke.fovConstraint)},this._addZoomHandles=()=>{this._zoomViewModel=new fs({view:this.imageRenderer,panoramicZoomConditions:new dt({maxFOV:this.maxHFOV,minFOV:this.minHFOV})});const a=this.imageRenderer.ui.find("zoom");a&&(a.viewModel=this._zoomViewModel),this._addHFOVHandles()},this._cancelLoadWithController=()=>{var a;(a=this._loadController)==null||a.abort(),this._loadController=null},this._handleDoubleClick=a=>{a.stopPropagation(),a.native.ctrlKey?this._zoomOut():this._zoomIn()},this._handleDrag=a=>{a.stopPropagation();const{action:i,x:r,y:o}=a;switch(i){case"start":this._startPosition=this._targetPosition={x:r,y:o};break;case"update":this._targetPosition={x:r,y:o},this._updateCameraHeadingAndTilt()}},this._handleImageClick=a=>{if(this.state==="image-loaded"&&this.imageRenderer.ready)switch(this.clickAction){case"emit":a.stopPropagation(),this.emit("click",a);break;case"hittest":a.stopPropagation(),a.async(async()=>{const i=await this.imageRenderer.hitTest(a.screenPoint,{include:this._graphics});this.emit("hittest-response",i)});break;case"pixel-location":{if(a.stopPropagation(),!this.imageSize||!a.mapPoint)return void this.emit("pixel-location",null);const i=Oe(a.mapPoint,this.imageSize[0],this.imageSize[1]);this.emit("pixel-location",{...i,spatialReference:U.WebMercator});break}}},this._handleWheel=a=>{const i=a.deltaX??a.native.deltaX;a.stopPropagation(),i>0||a.deltaY>0?this._zoomOut():this._zoomIn()},this._loadWithController=()=>{this._cancelLoadWithController(),this._loadController=new AbortController,this.loadImage(this._loadController)},this._zoomIn=()=>{var a;return(a=this._zoomViewModel)==null?void 0:a.zoomIn()},this._zoomOut=()=>{var a;return(a=this._zoomViewModel)==null?void 0:a.zoomOut()},this.addGraphic=(a,i)=>this.state==="image-loaded"&&!this._graphics.graphics.includes(a)&&(this._graphics.graphics.add(a,i),!0),this.addManyGraphics=a=>{if(this.state!=="image-loaded")return!1;const i=a.filter(r=>!this._graphics.graphics.includes(r));return this._graphics.graphics.addMany(i),!0},this.clearGraphics=()=>{this._graphics.graphics.removeAll()},this.clearImage=()=>{this.imageSize=null,this._removeImageSphere()},this.removeGraphic=a=>!(this.state!=="image-loaded"||!this._graphics.graphics.includes(a))&&(this._graphics.remove(a),!0),this.removeManyGraphics=a=>{if(this.state!=="image-loaded")return!1;const i=a.filter(r=>this._graphics.graphics.includes(r));return this._graphics.removeMany(i),!0},this._imageRenderer=new yo({map:this._map,viewingMode:"local",camera:{position:sa},environment:{atmosphereEnabled:!1,starsEnabled:!1,lighting:{type:"virtual"}},popupEnabled:!1,spatialReference:U.WebMercator,ui:{components:["zoom"]}})}destroy(){this._imageRenderer.destroy()}initialize(){this.state="initialized",this.addHandles([O(()=>this.imageSource,()=>{this.imageSource&&this.autoLoad&&this._loadWithController()},Z),O(()=>this.fov,()=>{this._reloadCamera()},Z),O(()=>this.yaw,t=>{this.camera.heading=t,this._reloadCamera()},Z),O(()=>this.pitch,t=>{this.camera.tilt=t,this._reloadCamera()},Z),Cr(()=>this.imageRenderer.ready,()=>{this._addNavigationHandles(),this._addZoomHandles()},Z),O(()=>this.clickAction,t=>{this.removeHandles(ke.clickAction),t!=="none"&&this.addHandles(this.imageRenderer.on("click",this._handleImageClick))},Z)],ke.default)}get camera(){return this.imageRenderer.camera}set camera(t){t&&(this.imageRenderer.camera=t.clone())}get fov(){return this.camera.fov}set fov(t){var a;Number.isFinite(t)&&((a=this._zoomViewModel)==null||a.zoomTo(t))}get hfov(){const{fov:t}=this.camera,{size:[a,i]}=this.imageRenderer,r=a/i,o=Math.atan(r);return 2*ve(Math.atan(Math.tan(Y(t/2))*Math.sin(o)))}get imageRenderer(){return this._imageRenderer}get maxHFOV(){const{size:[t,a]}=this.imageRenderer;return Vt(Qo,t/a)}get minHFOV(){const{size:[t,a]}=this.imageRenderer;return Vt(Jo,t/a)}get vfov(){const{fov:t}=this.camera,{size:[a,i]}=this.imageRenderer,r=a/i,o=Math.atan(r);return 2*ve(Math.atan(Math.tan(Y(t/2))*Math.cos(o)))}async _loadImageInternal(t,a){let i;this.state="image-loading";try{i=(await Jt(t,{responseType:"image",...a})).data}catch(r){throw se(r)?this.state="image-load-aborted":this.state="image-load-error",r}return this._updateImageSphere(i,a)}_reloadCamera(){this.camera=this.camera.clone()}_removeImageSphere(){this._imageGraphic&&(this._graphics.remove(this._imageGraphic),this._imageGraphic=ie(this._imageGraphic)),this.state="ready",this.imageSize=null}_updateCameraHeadingAndTilt(){if(!this._startPosition||!this._targetPosition)return;const t=this.camera.heading+(this._startPosition.x-this._targetPosition.x)/this.imageRenderer.width*this.camera.fov;this.yaw=(t+360)%360;const a=this.camera.tilt-(this._startPosition.y-this._targetPosition.y)/this.imageRenderer.height*this.imageRenderer.camera.tilt;this.pitch=Math.min(179.5,Math.max(.5,a)),this._startPosition=this._targetPosition}async _updateImageSphere(t,a){await Ue(a);const{size:[i,r]}=this.imageRenderer;return this._imageGraphic=_s(ws(t)),this._graphics.add(this._imageGraphic),this.fov=Vt(Uo,i/r),this.state="image-loaded",this.imageSize=[t.width,t.height],this._imageGraphic.geometry}async loadImage(t){return this._removeImageSphere(),this.imageSource?this._loadImageInternal(this.imageSource,t):mt(this.declaredClass,new Q(di("panoramic-viewer"),pi("PanoramicViewerViewModel","imageSource")))}};c([u()],W.prototype,"_graphics",void 0),c([u()],W.prototype,"_imageGraphic",void 0),c([u()],W.prototype,"_imageRenderer",void 0),c([u()],W.prototype,"_loadController",void 0),c([u()],W.prototype,"_map",void 0),c([u()],W.prototype,"_zoomViewModel",void 0),c([u({type:Boolean})],W.prototype,"autoLoad",void 0),c([u({type:ii})],W.prototype,"camera",null),c([ei(new Wr({emit:"emit",hittest:"hittest",none:"none","pixel-location":"pixel-location"}))],W.prototype,"clickAction",void 0),c([u({type:Number})],W.prototype,"fov",null),c([u({readOnly:!0})],W.prototype,"hfov",null),c([u({readOnly:!0})],W.prototype,"imageRenderer",null),c([u()],W.prototype,"imageSize",void 0),c([u()],W.prototype,"imageSource",void 0),c([u({readOnly:!0})],W.prototype,"maxHFOV",null),c([u({readOnly:!0})],W.prototype,"minHFOV",null),c([u({type:Number})],W.prototype,"pitch",void 0),c([u()],W.prototype,"state",void 0),c([u({readOnly:!0})],W.prototype,"vfov",null),c([u({type:Number})],W.prototype,"yaw",void 0),W=c([me("esri.widgets.PanoramicViewer.PanoramicViewerViewModel")],W);const Di=W,bs="esri-panoramic-viewer";let X=class extends ft{constructor(e){super(e),this.viewModel=new Di,this._afterContainerCreate=t=>{this.imageRenderer.container=t},this.addGraphic=(t,a)=>{this.viewModel.addGraphic(t,a)},this.addManyGraphics=t=>{this.viewModel.addManyGraphics(t)},this.clearGraphics=()=>{this.viewModel.clearGraphics()},this.clearImage=()=>{this.viewModel.clearImage()},this.loadImage=t=>this.viewModel.loadImage(t),this.removeGraphic=t=>{this.viewModel.removeGraphic(t)},this.removeManyGraphics=t=>{this.viewModel.removeManyGraphics(t)}}get autoLoad(){return this.viewModel.autoLoad}set autoLoad(e){this.viewModel.autoLoad=e}get camera(){return this.viewModel.camera}set camera(e){e&&(this.viewModel.camera=e)}get clickAction(){return this.viewModel.clickAction}set clickAction(e){this.viewModel.clickAction=e}get fov(){return this.camera.fov}set fov(e){this.viewModel.fov=e}get hfov(){return this.viewModel.hfov}get icon(){return"i360-view"}set icon(e){this._overrideIfSome("icon",e)}get imageRenderer(){return this.viewModel.imageRenderer}get imageSize(){return this.viewModel.imageSize}get imageSource(){return this.viewModel.imageSource}set imageSource(e){this.viewModel.imageSource=e}get pitch(){return this.viewModel.pitch}set pitch(e){this.viewModel.pitch=e}get state(){return this.viewModel.state}get vfov(){return this.viewModel.vfov}get yaw(){return this.viewModel.yaw}set yaw(e){this.viewModel.yaw=e}render(){return M("div",{afterCreate:this._afterContainerCreate,bind:this,class:this.classes(ct.widget,bs)})}};c([u({type:Boolean})],X.prototype,"autoLoad",null),c([u({type:ii})],X.prototype,"camera",null),c([u()],X.prototype,"clickAction",null),c([u({type:Number})],X.prototype,"fov",null),c([u({readOnly:!0,type:Number})],X.prototype,"hfov",null),c([u()],X.prototype,"icon",null),c([u({readOnly:!0})],X.prototype,"imageRenderer",null),c([u({readOnly:!0})],X.prototype,"imageSize",null),c([u()],X.prototype,"imageSource",null),c([u({type:Number})],X.prototype,"pitch",null),c([u({readOnly:!0})],X.prototype,"state",null),c([u({readOnly:!0,type:Number})],X.prototype,"vfov",null),c([ht(["click","hittest-response","pixel-location"]),u({type:Di})],X.prototype,"viewModel",void 0),c([u({type:Number})],X.prototype,"yaw",null),X=c([me("esri.widgets.PanoramicViewer")],X);const Ms=X,Cs=new Je({size:15,style:"circle",color:[255,102,102,.5],outline:null}),Ta=new Je({size:10,style:"circle",color:[0,128,192,.5],outline:null}),Sc=new Ye({style:"solid",color:[0,128,192,.5],outline:null}),Rc=new Ye({style:"solid",color:[255,102,102,.5],outline:null}),La=new Je({size:10,style:"diamond",color:[255,102,102],outline:null}),Is=new Kt({symbolLayers:new j([new Ur({size:10,material:{color:"red"},resource:{primitive:"x"},outline:{color:"black",size:1}})])}),Ps=new Kt({symbolLayers:new j([new Ya({width:9,height:9,depth:9,material:{color:[255,102,102]},resource:{primitive:"diamond"},castShadows:!1})])}),Va=new Xa({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,size:10,frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[0,1.4142135623730951],[3.585786437626905,5],[5,3.585786437626905],[1.4142135623730951,0],[5,-3.585786437626905],[3.585786437626905,-5],[0,-1.4142135623730951],[-3.585786437626905,-5],[-5,-3.585786437626905],[-1.4142135623730951,0],[-5,3.585786437626905],[-3.585786437626905,5],[0,1.4142135623730951]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,width:1,color:[0,0,0,100]},{type:"CIMSolidFill",enable:!0,color:[255,0,0,255]}]}}]}]}}}),Oc=new Yt({symbolLayers:new j([new Xt({material:{color:[255,102,102,.5]},edges:null})])}),Ac=new Yt({symbolLayers:new j([new Xt({material:{color:[0,128,192,.25]},edges:null})])}),xs=new Je({size:8,style:"triangle",color:[255,165,0],outline:{color:[0,0,0],width:.5}}),$s=new Kt({symbolLayers:new j([new Ya({width:12,height:12,depth:12,material:{color:[255,165,0]},resource:{primitive:"tetrahedron"},outline:{color:"black",size:1},castShadows:!1})])}),ka=(e,t=3.5)=>new Xa({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[14,12],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:t,color:_o(e).toArray()},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:t,color:e.toArray()}]}}}),Ea=new Qr({symbolLayers:new j([new Jr({profile:"circle",width:7,material:{color:"orange"},cap:"round"})])}),Fs=e=>new Ye({color:bo(e,.3),outline:{color:e,width:2}});function Ss(e){switch(e){case"point":return t=>new Je({size:10,style:"circle",color:t??Hi(),outline:new aa({color:[0,0,0],width:2})});case"polygon":return t=>new Ye({color:null,outline:pt(t),style:"none"});case"polyline":return t=>pt(t)}}function Hi(){return new wo([255,0,0])}function pt(e){return new aa({color:e??Hi(),width:2})}function Rs(e){return new Ye({color:null,outline:pt(e),style:"none"})}function Os(e,t,a){return e===t?a:e==="polyline"?pt(a==null?void 0:a.color):Rs(a==null?void 0:a.color)}function gt(e,t,a){const i=e.toLowerCase(),r=t.toLowerCase()===i,o=(a==null?void 0:a.toLowerCase())===i;return Me(r,o)}function As(e){return e==="point"||e==="polygon"||e==="polyline"}function Ts(e,t,a){return As(e.geometryType)&&e.fields.filter(({name:i,type:r,alias:o})=>gt(a!=null&&a.length?a:oa,i,o)||gt(t!=null&&t.length?t:ra,i,o)&&r==="blob").length===2}function Tc(e){return e.type==="feature"&&Ls(e)}function Ls(e){return e.geometryType==="point"||e.geometryType==="polygon"||e.geometryType==="polyline"}function Vs(e,t,a){if(!e)return;const{renderer:i}=e,r=Ss(t),o=i?"symbol"in i?i.symbol:"defaultSymbol"in i?i.defaultSymbol:i.getSymbol():null,n=r(o==null?void 0:o.color);a[`${t}Symbol`]=(t===e.geometryType?o:null)??n}function ks(e,t,a){const i=e.fields.find(({name:o,alias:n,type:s})=>gt(t!=null&&t.length?t:ra,o,n)&&s==="blob"),r=e.fields.find(({name:o,alias:n})=>gt(a!=null&&a.length?a:oa,o,n));if(!i||!r)throw new Q("invalid-data-capture-layer","Data capture layer is not configured correctly.",{layer:e,imageGeometryField:i,oiObjectIdField:r});return{imageGeometryField:i,oiObjectIdField:r}}function Es(e,t,a,i,r,o,n){let s=zs(e,t);if(!s)throw new Q("InvalidGeometry");return s=Ds(s,o,r),new N({attributes:e,layer:a,symbol:Os(s.type,a.geometryType,n),geometry:s,visible:a.visible&&i})}function zs(e,t){const{geometry:a}=JSON.parse(atob(e[t]));return fo(a)}function Lc(e,t,a){switch(t){case"default":return Gs(e);case"panoramic":return Ni(e,a)}}function Gs(e){switch(e.type){case"point":e.x+=.5,e.y=.5-e.y;break;case"polyline":e.paths=e.paths.map(t=>t.map(([a,i])=>[a+.5,.5-i]));break;case"polygon":e.rings=e.rings.map(t=>t.map(([a,i])=>[a+.5,.5-i]));break;case"multipoint":e.points=e.points.map(([t,a])=>[t+.5,.5-a]);break;case"extent":e.xmin+=.5,e.xmax+=.5,e.ymin=.5-e.ymin,e.ymax=.5-e.ymax}return e}function Ni(e,t){switch(e.type){case"point":{const{x:a,y:i}=Oe(e,t[0],t[1]);e.x=a,e.y=i,delete e.z;break}case"polyline":e.paths=e.paths.map(a=>a.map(i=>{const{x:r,y:o}=Oe({x:i[0],y:i[1],z:i[2]},t[0],t[1]);return[r,o]}));break;case"polygon":e.rings=e.rings.map(a=>a.map(i=>{const{x:r,y:o}=Oe({x:i[0],y:i[1],z:i[2]},t[0],t[1]);return[r,o]}));break;case"multipoint":e.points=e.points.map(a=>{const{x:i,y:r}=Oe({x:a[0],y:a[1],z:a[2]},t[0],t[1]);return[i,r]});break;case"extent":{const{xmin:a,xmax:i,ymin:r,ymax:o}=Ni(ne.fromExtent(e),t).extent;e.xmax=i,e.xmin=a,e.ymax=o,e.ymin=r;break}}return e}function Ds(e,t,a){switch(t){case"default":return Hs(e);case"panoramic":return Bi(e,a)}}function Hs(e){switch(e.type){case"point":e.x-=.5,e.y=.5-e.y;break;case"polyline":e.paths=e.paths.map(t=>t.map(([a,i])=>[a-.5,.5-i]));break;case"polygon":e.rings=e.rings.map(t=>t.map(([a,i])=>[a-.5,.5-i]));break;case"multipoint":e.points=e.points.map(([t,a])=>[t-.5,.5-a]);break;case"extent":e.xmin-=.5,e.xmax-=.5,e.ymin=.5-e.ymin,e.ymax=.5-e.ymax}return e}function Bi(e,t){switch(e.type){case"point":{const[a,i,r]=at(e,t[0],t[1]);e.x=a,e.y=i,e.z=r;break}case"polyline":e.paths=e.paths.map(a=>a.map(i=>{const[r,o,n]=at({x:i[0],y:i[1]},t[0],t[1]);return[r,o,n]}));break;case"polygon":e.rings=e.rings.map(a=>a.map(i=>{const[r,o,n]=at({x:i[0],y:i[1]},t[0],t[1]);return[r,o,n]}));break;case"multipoint":e.points=e.points.map(a=>{const[i,r,o]=at({x:a[0],y:a[1]},t[0],t[1]);return[i,r,o]});break;case"extent":{const{xmin:a,xmax:i,ymin:r,ymax:o}=Bi(ne.fromExtent(e),t).extent;e.xmax=i,e.xmin=a,e.ymax=o,e.ymin=r}}return e}const ji=1e5;function ca(e,t){let a=180*Math.atan2(-e.y+t.y,e.x-t.x)/Math.PI;return a<0&&(a+=180),a*Math.PI/180}function Ns(e,t){let a=180*Math.atan2(-e.y+t.y,e.x-t.x)/Math.PI;return a<0&&(a+=180),a*Math.PI/180}function ha(e,t,a){if(!(e!=null&&e.length)||!(t!=null&&t.length)||!a)return;const[i,r]=e,[,o]=t,n=o-r;return[i+n*Math.cos(a),r+n*Math.sin(a)]}function Wi(e,t,a){if(hi(e)){const l=ut([t],"meters")[0];return{area:Ma([a],"square-meters")[0],perimeter:l}}const i=U.WGS84,r=Nt(t,i),o=Nt(a,i);let n=si(o,ji);if(n=ia(n),!n)return null;const s=ut([r],"meters")[0];return{area:Ma([n],"square-meters")[0],perimeter:s}}async function Bs(e,t,a,i,r=!1,o){if(t.length<2||!i||!a||!e)return null;const n=er(a,e);if(!n)return null;const s=t.map(g=>[g.x,g.y]),l=s.at(0),h=s.at(-1);if(!l||!h)return null;const m=n.map(g=>ar([l,h],g,e,r,!1)),d=await Promise.all(m);L(o);let p=0;for(const g of d){if(!g)return null;const v=Math.abs(g-i);p=Math.max(v,p)}return p}async function js(e,t,a,i,r,o=!1,n){if(t.length<2||!i||!a||!e)throw new Error("Missing parameters");const s=tr(a,e),l=t.map(v=>[v.x,v.y]),h=l.at(0),m=l.at(-1),d=s.map(v=>ir([h,m],v,e,r,o,!1)),p=await Promise.all(d);L(n);let g=0;for(const v of p){if(!v)return 0;const y=Math.abs(v-i);g=Math.max(y,g)}return g}function Ws(e,t){const a=Ce(e,!1);if(a!=null&&a.length)return 20*de([a[0].x,a[0].y],[a.at(-1).x,a.at(-1).y])/t}function qi(e){const t=e.spatialReference;if(t.isGeographic){if(hi(t))return ut([e],"meters")[0];const a=Nt(e,U.WGS84);return ut([a],"meters")[0]}return t.isWebMercator?li(e,"meters"):ci(e,"meters")}function Zi(e,t){const a=ia(t);if(!a)return null;const i=ci(e,"meters");return{area:Io(a,"square-meters"),perimeter:i}}function Ui(e,t){let a=si(t,ji,"meters");if(a=ia(a),!a)return null;const i=li(e,"meters");return{area:Po(a,"square-meters"),perimeter:i}}async function qs(e,t,a){if(!t||!e)throw new Error("Missing required parameters");const i=await _t(e,t);L(a);const r=i.clone();r.z?r.z+=20:r.z=20;const{averageElevation:o,cameraPitch:n,cameraRoll:s,farDistance:l,...h}=t;return $e(r,h)}async function Zs(e,t,a,i){const{attributes:r}=a,{location:o}=r,{updateElevationProps:n,...s}=t;if(!e||!t)throw new Error("Missing parameters");let l=o.clone();l.spatialReference.isGeographic&&(l=await re(l,U.WebMercator));const h=await bt(e,{...s,cameraLocation:l},n);L(i);const m=h.clone();return m.z?m.z+=20:m.z=20,Ke(m,s)}function Qi(e,t,a,i,r=0,o=1,n){const{averageElevation:s,cameraPitch:l,cameraRoll:h,farDistance:m,...d}=i;if(r>=5||o<=.1)return{value:e};const p=new V({x:t.x,y:t.y,z:t.z?t.z+e:e,spatialReference:i.cameraLocation.spatialReference}),g=$e(p,d),v=de([a[0].x,a[0].y],[g.x,g.y]),y=a.at(0),w=a.at(-1);if(!y||!w)return null;const f=de([y.x,y.y],[w.x,w.y])*e/v;return Qi(f,t,a,i,r+1,Math.abs(e-f))}function Ji(e,t,a,i,r=0,o=1,n){const{averageElevation:s,horizontalFieldOfView:l,verticalFieldOfView:h,farDistance:m,...d}=i;if(r>=5||o<=.1)return{value:e};const p=new V({x:t.x,y:t.y,z:t.z?t.z+e:e,spatialReference:i.cameraLocation.spatialReference}),g=Ke(p,d),v=de([a[0].x,a[0].y],[g.x,g.y]),y=a.at(0),w=a.at(-1);if(!y||!w)return null;const f=de([y.x,y.y],[w.x,w.y])*e/v;return Ji(f,t,a,i,r+1,Math.abs(e-f))}async function Yi(e,t){const{updateElevationProps:a,...i}=t;return await _t(e,i,a)}async function Xi(e,t){const{updateElevationProps:a,...i}=t;return bt(e,i,a)}function Us(e){navigator.clipboard.writeText(e).catch(t=>{throw t})}function Ki(e){const t=e.map(i=>[i.x,i.y]),a=e[0].spatialReference;return new _e({paths:[t],spatialReference:a})}function Ce(e,t){return e.map(a=>({x:t?.5+a[0]:a[0],y:t?.5-a[1]:a[1]}))}function Vc(e,t,a,i,r){const o=e==="measurement"?t:a;if(r&&o)return oi(i,ni(o,"meters"),r,3)||null}function er(e,t){const{cameraPitch:a,cameraRoll:i,cameraLocation:r}=e,{x:o,y:n,z:s,spatialReference:l}=r;if(t.every(b=>b===0)||!t||!t.length)return null;const[h,m,,d,p]=t,g=[-d,0,d],v=[-p,0,p],y=[-h,0,h],w=[-m,0,m],f=[];for(const b of g)for(const C of v)for(const F of y)for(const I of y)for(const S of w){const A={...e};A.cameraPitch=a+b,A.cameraRoll=i+C,A.cameraLocation=new V({x:o+F,y:n+I,z:s?s+S:0,spatialReference:{wkid:l.wkid}}),f.push(A)}return f}function tr(e,t){const{cameraHeading:a,cameraLocation:i}=e,{x:r,y:o,z:n,spatialReference:s}=i;if(t.every(y=>y===0)||!t||!t.length)throw new Error("Invalid parameters");const[l,h,m]=t,d=m>0?[-m,0,m]:[],p=l>0?[-l,0,l]:[],g=h>0?[-h,0,h]:[],v=[];for(const y of d)for(const w of p)for(const f of p)for(const b of g){const C={...e};C.cameraHeading=a+y,C.cameraLocation=new V({x:r+w,y:o+f,z:n?n+b:0,spatialReference:{wkid:s.wkid}}),v.push(C)}return v}function kc(e,t,a,i,r){const o=e==="measurement"?t:qt(a);if(r&&o)return oi(i,ni(o,"meters"),r,3)||null}function Ec(e,t,a,i,r){const o=e==="measurement"?t:a;if(r&&o)return Mo(i,Co(o,"square-meters"),r,3)||null}function qt(e){return Math.sqrt(e.reduce((t,a)=>t+a**2,0))}function za(e,t,a){if(t==="default")return e;const i={x:e[0],y:e[1],z:e[2]},r=Oe(i,a[0],a[1]);return[r.x,r.y]}async function ar(e,t,a,i=!1,r=!1,o){if(!e||!t||e.length<2)return null;const n=Ce(e,i);if(!n||n.length<2)return null;const[s,l]=[n[0],n.at(-1)];if(!l)return null;const h=[s],m=await _t(s,t);L(o);const d=m.clone();d.z?d.z+=20:d.z=20;const{averageElevation:p,cameraPitch:g,cameraRoll:v,farDistance:y,...w}=t,f=$e(d,w),b=de([s.x,s.y],[f.x,f.y]),C=ca(s,f);if(!C)return;const F=ha([s.x,s.y],[l.x,l.y],C);if(!(F!=null&&F.length))return;h.push({x:F[0],y:F[1]});const I=20*de([h[0].x,h[0].y],[h[1].x,h[1].y])/b;if(!r)return I;const S=Qi(I,m,h,t,0,1);return S==null?void 0:S.value}async function ir(e,t,a,i,r=!1,o=!1,n){const{attributes:s}=i,{location:l}=s,{updateElevationProps:h,...m}=t;if(!e||!t||e.length<2)throw new Error("Invalid parameters");const d=Ce(e,r),[p,g]=[d[0],d.at(-1)],v=[p];let y=l.clone();y.spatialReference.isGeographic&&(y=await re(y,U.WebMercator));const w=await bt(p,{...m,cameraLocation:y},h);L(n);const f=w.clone();f.z?f.z+=20:f.z=20;const b=Ke(f,m),C=de([p.x,p.y],[b.x,b.y]),F=ca(p,b);if(!F)return;const I=ha([p.x,p.y],[g.x,g.y],F);if(!(I!=null&&I.length))return;v.push({x:I[0],y:I[1]});const S=20*de([v[0].x,v[0].y],[v[1].x,v[1].y])/C;if(!o)return S;const A=Ji(S,w,v,t,0,1);return A==null?void 0:A.value}async function kt(e,t,a=!1){if(e.length<3)return null;const i=Ce(e,a),r=await Yi(i,t),o=r.map(({x:h,y:m})=>[h,m]);e.push(e[0]),o.push(o[0]);const n=r[0].spatialReference,s=new _e({paths:[o],spatialReference:n}),l=new ne({rings:[o],spatialReference:n});return n.isGeographic?Wi(n,s,l):n.isWebMercator?Ui(s,l):Zi(s,l)}async function Et(e,t,a=!1,i){if(e.length<3)return null;const r=Ce(e,a),o=await Xi(r,t);L(i);const n=o.map(({x:m,y:d})=>[m,d]);e.push(e[0]),n.push(n[0]);const s=o[0].spatialReference,l=new _e({paths:[n],spatialReference:s}),h=new ne({rings:[n],spatialReference:s});return s.isGeographic?Wi(s,l,h):s.isWebMercator?Ui(l,h):Zi(l,h)}async function zt(e,t,a=!1){const i=Ce(e,a);return qi(Ki(await Yi(i,t)))}async function Gt(e,t,a=!1,i){const r=Ce(e,a),o=await Xi(r,t);return L(i),qi(Ki(o))}const Ga={click:"click-handle",enhancements:"enhancements-handle",rotation:"rotation-handle"};let q=class extends ea.EventedAccessor{constructor(e){super(e),this._imageChanged=!1,this._panConstraint=null,this._image=null,this._loadController=null,this._overlays=new Be({blendMode:"source-atop"}),this._map=new ri,this.autoLoad=!1,this.clickAction="none",this.error=null,this.imageSource=null,this.imageRotation=0,this.state="ready",this._cancelLoadWithController=()=>{var t;(t=this._loadController)==null||t.abort(),this._loadController=null},this._createImageHandles=()=>{this.removeHandles(Ga.enhancements),this.addHandles(O(()=>[this.brightness,this.contrast,this.sharpness],([t,a,i])=>{var r;(r=this.image)!=null&&r.loaded&&(this.image.effect=`contrast(${10*(a+10)}%) brightness(${10*(t+10)}%)`,this.sharpenImage(this.image,i))},Z))},this._createPanConstraint=()=>{const{image:t,imageRenderer:a}=this,i=r=>{if(!(t&&a&&r.targetGeometry&&t.serviceRasterInfo))return r;const{extent:o}=t.serviceRasterInfo,{constraints:n,rotation:s,width:l,height:h}=a,{extent:m}=Pt(ne.fromExtent(o),s),{width:d,height:p}=m,g=r.targetGeometry.clone(),v=n.scaleToZoom(r.scale),y=1/2**v,w=l/h;let f=y*d,b=y*p;v&&(d/l>p/h?b=f/w:f=b*w);const C=m.clone();return C.xmin+=f/2,C.xmax-=f/2,C.ymin+=b/2,C.ymax-=b/2,r.targetGeometry=$o(C,g).coordinate,this.state="image-loaded",r};return{constrain:i,applyPanConstraint:i}},this._createResizeHandles=t=>{t.removeHandles("resize"),t.addHandles(O(()=>{if(!this.imageRenderer.ready)return;const{extent:a}=t.serviceRasterInfo,{width:i,height:r,rotation:o}=this.imageRenderer,{extent:n}=Pt(ne.fromExtent(a),o),{width:s,height:l}=n;return Math.max(s/i,l/r)},a=>{if(!this.imageRenderer||a==null)return;const{constraints:i,scale:r,spatialReference:o}=this.imageRenderer,n=i.minScale,s=Fo(o),l=.25*s,h=s*a;let m=h;const d=[];for(;m>l;)d.push(m),m/=2;d.push(m);const{lods:p}=Qa.create({scales:d});if(i.set({minScale:h,lods:p}),this._imageChanged)return this.imageRenderer.scale=h,void(this._imageChanged=!1);this.imageRenderer.scale=Math.abs(r-n)<=1e-6?h:r},Z),"resize")},this._loadImageInternal=(t,a={})=>{this.state="image-loading",this.clearImage(),this.error=null,this._imageChanged=!0;const i=typeof t=="string",r=i?void 0:t.datasetFormat,o=i?t:t.url,{customParameters:n,options:s}=a;return this._image=new zr({ioConfig:{skipExtensions:["aux.xml","jgw"],skipMapInfo:!0,datasetFormat:r},url:o,customParameters:n}),this._image.when(async l=>{this._updatePanConstraint(),this._createResizeHandles(l),this._map.add(l),this.state="image-loaded"},l=>{se(l)?this.state="image-load-aborted":(this.state="image-load-error",this.error=l,D.getLogger(this).error(`error occurred while loading image ${i?t:JSON.stringify(t)}`,l),this.imageSource=null)}),this._image.load(s)},this._loadWithController=()=>{this._cancelLoadWithController(),this._loadController=new AbortController,this.loadImage(this._loadController)},this._updatePanConstraint=()=>{this._panConstraint&&this.imageRenderer.constraints.customConstraints.remove(this._panConstraint),this._panConstraint=this._createPanConstraint(),this.imageRenderer.constraints.customConstraints.add(this._panConstraint)},this.addGraphic=(t,a)=>{this._overlays.graphics.add(t,a)},this.addManyGraphics=t=>{this._overlays.addMany(t)},this.clearGraphics=()=>{this._overlays.graphics.removeAll()},this.clearImage=()=>{this.image&&(this._map.layers.remove(this.image),this._image=ie(this._image))},this.loadImage=t=>{const{customParameters:a,imageSource:i}=this;return i?this._loadImageInternal(i,{customParameters:a,options:t}):mt(this.declaredClass,new Q(di("image-viewer"),pi("ImageViewerViewModel","imageSource")))},this.removeGraphic=t=>{this._overlays.remove(t)},this.removeManyGraphics=t=>{this._overlays.removeMany(t)},this._imageRenderer=new ui({constraints:{snapToZoom:!0,rotationEnabled:!1},map:this._map,popupEnabled:!1,spatialReference:U.WebMercator,ui:{components:["zoom"]}})}destroy(){this._imageRenderer.destroy()}initialize(){this.state="initialized",this.addHandles([O(()=>this.imageSource,e=>{e&&this.autoLoad&&this._loadWithController()},Z),O(()=>{var e;return(e=this.image)==null?void 0:e.loaded},()=>{this._createImageHandles()}),O(()=>this.imageRotation,()=>{this._rotateImage()}),O(()=>this.imageRenderer.map,(e,t)=>{t==null||t.layers.remove(this._overlays),e==null||e.layers.add(this._overlays)},Ze),O(()=>this.imageRenderer.map.allLayers.length,e=>{e&&this.imageRenderer.map.layers.reorder(this._overlays,e-1)},Z),O(()=>this.clickAction,e=>{this.removeHandles(Ga.click),e!=="none"&&this.addHandles(this.imageRenderer.on("click",t=>{var a,i;if((a=this.image)!=null&&a.loaded&&this.imageRenderer.ready)switch(e){case"emit":t.stopPropagation(),this.emit("click",t);break;case"hittest":t.stopPropagation(),t.async(async()=>{const r=await this.imageRenderer.hitTest(t.screenPoint,{include:this._overlays});this.emit("hittest-response",r)});break;case"pixel-location":{if(t.stopPropagation(),!((i=this.image)!=null&&i.serviceRasterInfo)||!t.mapPoint)return void this.emit("pixel-location",null);const{extent:r,pixelSize:o}=this.image.serviceRasterInfo,n=(t.mapPoint.x-r.xmin)*o.x,s=(r.ymax-t.mapPoint.y)*o.y,l=new V({x:n,y:s,spatialReference:r.spatialReference});this.emit("pixel-location",l);break}}}))},Z)])}get brightness(){return this._get("brightness")??0}set brightness(e){this._set("brightness",Te(e,-10,10))}get contrast(){return this._get("contrast")??0}set contrast(e){this._set("contrast",Te(e,-10,10))}get image(){return this._image}get imagePointsInView(){var m,d,p;const{extent:e,ready:t}=this.imageRenderer,a=this.imageRotation,i=(m=this.image)==null?void 0:m.fullExtent,r=(d=this.image)==null?void 0:d.serviceRasterInfo,o=((p=this._imageRenderer.allLayerViews.find(({layer:g})=>g===this.image))==null?void 0:p.attached)===!0;if(!(t&&e&&i&&r&&o))return null;const n=Pt(ne.fromExtent(e),a),s=ne.fromExtent(i),l=xo(n,s),{rings:h}=l;return h.flat().map(([g,v])=>({x:(g-r.extent.xmin)*r.pixelSize.x,y:(r.extent.ymax-v)*r.pixelSize.y}))}get imageSize(){const{image:e}=this;if(!(e!=null&&e.raster))return null;const{width:t,height:a}=e.raster.rasterInfo;return[t,a]}get imageRenderer(){return this._imageRenderer}get imageView(){return this.imageRenderer.allLayerViews.find(e=>e.layer===this.image)}get sharpness(){return this._get("sharpness")??0}set sharpness(e){this._set("sharpness",Te(e,0,1))}_rotateImage(){this.imageRenderer.constraints.rotationEnabled=!0,this.imageRenderer.rotation=this.imageRotation,this.imageRenderer.constraints.rotationEnabled=!1}sharpenImage(e,t){if(!t)return void(e.rasterFunction=null);const a=[0,-1*t,0,-1*t,4*t+1,-1*t,0,-1*t,0],i=new Ua({functionName:"Convolution",functionArguments:{type:Ca.userDefined,cols:3,rows:3,kernel:a,convolutionType:Ca.userDefined}});e.rasterFunction=i}};c([u()],q.prototype,"_image",void 0),c([u()],q.prototype,"_imageRenderer",void 0),c([u()],q.prototype,"_loadController",void 0),c([u()],q.prototype,"_overlays",void 0),c([u()],q.prototype,"_map",void 0),c([u({type:Boolean})],q.prototype,"autoLoad",void 0),c([u({type:Number})],q.prototype,"brightness",null),c([u()],q.prototype,"clickAction",void 0),c([u({type:Number})],q.prototype,"contrast",null),c([u({type:Object})],q.prototype,"customParameters",void 0),c([u({type:Q})],q.prototype,"error",void 0),c([u({readOnly:!0})],q.prototype,"image",null),c([u({readOnly:!0})],q.prototype,"imagePointsInView",null),c([u({readOnly:!0})],q.prototype,"imageSize",null),c([u({cast:Go})],q.prototype,"imageSource",void 0),c([u({readOnly:!0})],q.prototype,"imageRenderer",null),c([u({type:Number})],q.prototype,"imageRotation",void 0),c([u()],q.prototype,"imageView",null),c([u({type:Number})],q.prototype,"sharpness",null),c([u()],q.prototype,"state",void 0),q=c([me("esri.widgets.OrientedImageryViewer.components.ImageViewerViewModel")],q);const rr=q,Qs="esri-image-viewer";let K=class extends ft{constructor(){super(...arguments),this.viewModel=new rr,this._afterContainerCreate=e=>{this.imageRenderer.container=e},this.addGraphic=(e,t)=>{this.viewModel.addGraphic(e,t)},this.addManyGraphics=e=>{this.viewModel.addManyGraphics(e)},this.clearGraphics=()=>{this.viewModel.clearGraphics()},this.clearImage=()=>{this.viewModel.clearImage()},this.loadImage=async e=>this.viewModel.loadImage(e),this.removeGraphic=e=>{this.viewModel.removeGraphic(e)},this.removeManyGraphics=e=>{this.viewModel.removeManyGraphics(e)}}get autoLoad(){return this.viewModel.autoLoad}set autoLoad(e){this.viewModel.autoLoad=e}get brightness(){return this.viewModel.brightness}set brightness(e){this.viewModel.brightness=e}get clickAction(){return this.viewModel.clickAction}set clickAction(e){this.viewModel.clickAction=e}get contrast(){return this.viewModel.contrast}set contrast(e){this.viewModel.contrast=e}get customParameters(){return this.viewModel.customParameters}set customParameters(e){this.viewModel.customParameters=e}get error(){return this.viewModel.error}get imageSize(){var t;const e=(t=this.viewModel.image)==null?void 0:t.serviceRasterInfo;return e?[e.width,e.height]:[0,0]}get imagePointsInView(){return this.viewModel.imagePointsInView}get imageRenderer(){return this.viewModel.imageRenderer}get imageRotation(){return this.viewModel.imageRotation}set imageRotation(e){this.viewModel.imageRotation=e}get imageSource(){return this.viewModel.imageSource}set imageSource(e){this.viewModel.imageSource=e}get sharpness(){return this.viewModel.sharpness}set sharpness(e){this.viewModel.sharpness=e}get state(){return this.viewModel.state}render(){return M("div",{afterCreate:this._afterContainerCreate,bind:this,class:this.classes(ct.widget,Qs)})}};c([u({type:Boolean})],K.prototype,"autoLoad",null),c([u({type:Number}),u()],K.prototype,"brightness",null),c([u()],K.prototype,"clickAction",null),c([u({type:Number})],K.prototype,"contrast",null),c([u({type:Object})],K.prototype,"customParameters",null),c([u({readOnly:!0})],K.prototype,"error",null),c([u()],K.prototype,"imageSize",null),c([u({readOnly:!0})],K.prototype,"imagePointsInView",null),c([u({readOnly:!0,type:ui})],K.prototype,"imageRenderer",null),c([u()],K.prototype,"imageRotation",null),c([u()],K.prototype,"imageSource",null),c([ht(["click","hittest-response","pixel-location"]),u({type:rr})],K.prototype,"viewModel",void 0),c([u({type:Number})],K.prototype,"sharpness",null),c([u({readOnly:!0})],K.prototype,"state",null),K=c([me("esri.widgets.OrientedImageryViewer.components.ImageViewer")],K);const Js=K,fe={click:"view-click",imageClick:"image-click",interactionHandles:"interaction-handles",footprintHandles:"footprint-handles",sketchHandles:"sketch-handles"},Ys=new Set(["JPG","JPEG"]),Xs=/\.(\w+)$/,Re=()=>new Q("orientedimageryviewer:sketch-not-initialized","Sketch property is not initialized, call loadSketch first");let _=class extends ea.EventedMixin(Yr){constructor(e){super(e),this.additionalFeatures=new j,this.additionalCameraLocations=new j,this.additionalFootprints=new j,this.areaMeasurementResult=0,this.areaMeasurementAccuracy=0,this.bestFeatureAngle=0,this.bestFeatureCurrentFootprint=null,this.bestFeatureFootprint=null,this.collectionId=null,this.conversionProps=null,this.coverageFrustums=new j,this.coveragePolygons=new j,this.currentBestFeature=null,this.currentBestFeatureLocation=null,this.currentCoverageVisible=!0,this.determineWorkflowForFeature=async(t,a,i)=>{const{currentBestFeature:r,selectedPoint:o,view:n}=this;if(n==null||n.closePopup(),r&&o){this._initialCurrentCoverageUpdate=!0,this._updateGroundElevation=!0;try{await this._updatePointsAndPolygons(i),await this._loadImage(i)}catch(s){se(s)||(this.loadImageError(s),D.getLogger(this).error("#loadIImage()","error occured while loading image",s))}}},this.disabled=!1,this.displayMessage={key:"onLoadMessage",type:"info"},this.displayNewMeasurementButton=!0,this.distanceMeasurementResult=0,this.distanceAccuracyArray=[],this.dataCaptureLayer=null,this.features=new j,this.groundCoordinates=null,this.heightMeasurementPixels=[],this.heightGraphic=null,this.heightMeasurementResult=0,this.heightMeasurementAccuracy=0,this.measurementAngle=null,this.tempDistance=null,this.imageGeometryField=null,this.imageLocationToolState=!1,this.isAdditionalCoverageVisible=!1,this.isAdditionalPointSourcesVisible=!1,this.layer=null,this.localPort=null,this.mapImageConversionToolState=!1,this.measureType=null,this.measurementGraphic=null,this.navigatorCurrentBestFeature=null,this.oiObjectIdField=null,this.overlayedCameraLocations=new j,this.overlayedMapFeatures=new Ba,this.pixelCoordinates=null,this.pointSources=new j,this.previousFeatureAngle=0,this.selectedPoint=null,this.shouldShowSelectedImage=!1,this.sketch=null,this.draw=null,this.sketchAdapter=null,this.updateFootprint=async(t,a)=>{var i;this.state==="image-loaded"&&await((i=this._adapter)==null?void 0:i.updateFootprint(t,a))},this.updateFootprintPanorama=async(t,a)=>{var i;await((i=this._adapter)==null?void 0:i.updateFootprintPanorama(t,a))},this._adapter=null,this._highlightedFeatureHandle=null,this._imageViewer=new Js,this._initialCurrentCoverageUpdate=!0,this._locationPointOnImage=null,this._overlays=new Be({listMode:"hide",internal:!0,elevationInfo:{mode:"absolute-height"}}),this._panoramicViewer=new Ms,this._previousCursor=null,this._referencePointOnGround=null,this._referencePointOnImage=null,this._sectorData=null,this._updatingHandles=new Xr,this._clickTask=null,this._crossSymbol=null,this.footprintExtent=null,this._featureChangedTask=null,this._openPopupTask=null,this._suitabilities=null,this._transformController=new AbortController,this._updateFootprintTask=null,this._updateGroundElevation=!1,this.hideImageGeometry=t=>{},this.highlight=t=>{var i;if(!this._overlaysView)return;this.removeHighlight();const a=this.additionalFootprints.find(({attributes:{imageID:r}})=>r===Number(t));this._highlightedFeatureHandle=a?(i=this._overlaysView)==null?void 0:i.highlight(a):null},this.loadDataCaptureAdapter=async t=>{await this.loadSketch(t);const a=z(()=>import("./DataCaptureAdapter-PG9-TNIC.js"),__vite__mapDeps([120,1,9,10,11,94,121,5,6,122,123,7,8,2,12,3,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,38,124,125,58,59,126,46,47,48,49,50,112,127,128,129,130,131,34,35,67,132,61,62,63,64,65,66,68,69,71,72,70,73,0,133,134,135,136,137,138,33,53,54,55,139,140,98,99,100,102,141,36,37,39,40,41,42,43,44,142,143,144,145,146,147,148,149,150,151,152,153,154,60,89,90,155,156,86,87,88,157,158,77,78,159,103,160,161,104,105,106,108,109,110,111,162,163,164,165,166,167,168,118,119,169,170,171,172,173,174,175,176,91,92,177,115,116,117,178,179,180,51,52,56,57,74,75,76,79,80,81,82,83,84,85,181,113,107,182,183,184,185,186,187,188,189,4,45,93,95,96,97,101,114,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435]),import.meta.url),{default:i}=await a;return L(t),this.sketchAdapter=new i({viewModel:this}),this.sketchAdapter},this.loadImageFromSource=async(t,a)=>this._updatingHandles.addPromise(this._loadImageFromSourceInternal(t,a)),this.loadImageViewer=t=>{this._imageViewer.container=t},this.loadPanoramicViewer=t=>{this._panoramicViewer.container=t},this.removeHighlight=()=>{var t;return(t=this._highlightedFeatureHandle)==null?void 0:t.remove()},this.revealImageGeometry=t=>{},this.toggleImageAttributes=()=>{Fe(this._openPopupTask),this._openPopupTask=ye(async t=>{const{currentBestFeature:a,popupEnabled:i,layer:r,view:o}=this;if(o==null||o.closePopup(),!(o&&a&&i&&r))return;const{attributes:n,geometry:s}=a,l=new N({geometry:s,attributes:n.toJSON(),layer:r});L(t),await o.openPopup({features:[l],location:n.location.clone()})})},this._createViewClickHandle=()=>{if(this.removeHandles(fe.click),this.state==="disabled"||this.view==null)return;const t=this.mapImageConversionToolState&&this.state==="image-loaded"?this._mapImageConversionToolViewClickHandler:this._viewClickHandler;this.addHandles(this.view.on("click",t,po.WIDGET),fe.click)},this._createImageClickHandle=()=>{this.removeHandles(fe.imageClick);const{mapImageConversionToolState:t,mode:a,activeViewer:i,currentBestFeature:r,footprintExtent:o}=this,n=i==null?void 0:i.imageSize;if(!(t&&a!=="none"&&n&&o&&r))return;i.clickAction="pixel-location";let s=null;const l=ya(()=>i,"pixel-location",h=>{this.plotReferencePointOnImage(h),s==null||s.abort(),s=ye(async m=>{if(!h)return;const d=await this.getMapPoint(h,{feature:r,imageSize:n,mode:a}).then(p=>{var v;const g=(v=this.view)==null?void 0:v.spatialReference;return Me(!g,p.spatialReference.equals(g))?p:re(p,g)});L(m),this.plotReferencePointOnGround(d)})});this.addHandles(l,fe.imageClick)},this._createImageLocationHandle=()=>{this.removeHandles(fe.imageClick);const{imageLocationToolState:t,mode:a,activeViewer:i,currentBestFeature:r,footprintExtent:o}=this,n=i==null?void 0:i.imageSize;if(!(t&&a!=="none"&&n&&o&&r))return;i.clickAction="pixel-location";let s=null;const l=ya(()=>i,"pixel-location",h=>{this.pixelCoordinates=h,this.plotLocationPointOnImage(h),s==null||s.abort(),s=ye(async m=>{var g;if(!h)return;let d=await this.getMapPoint(h,{feature:r,imageSize:n,mode:a});L(m);const p=(g=this.view)==null?void 0:g.spatialReference;p&&!d.spatialReference.equals(p)&&(d=await re(d,p),L(m)),this.groundCoordinates=d})});this.addHandles(l,fe.imageClick)},this._loadImage=async t=>{const{currentBestFeature:a,layer:i,mode:r}=this;if(this.clearGraphics(),!i||!a||r==="none")return;const{attributes:o}=a,{imagePath:n,imageRotation:s,cameraHeading:l,cameraRoll:h,cameraPitch:m,objectId:d,cameraOrientation:p,location:g}=o,v=(h??0)+(s??0),y=g.spatialReference.isWGS84&&(p==null?void 0:p.type)!==4?Ht(g):new V(g);let w=n;if(st(n))try{w=await Pi(i,d,t)}catch(f){return se(f)?void 0:Ho(f)?(D.getLogger(this).error(f),void this.setMessage("noAttachment","error",`${i.objectIdField}: ${d}`)):(D.getLogger(this).error(f,{[i.objectIdField]:d,layer:i}),void this.setMessage("imageLoadError","error",`query-attachments-failed:${i.objectIdField} ${d}`))}try{await this.loadImageFromSource(w,{imageRotation:v,options:t,pitch:m,yaw:l,mode:r,cameraLocation:y}),L(t),await this.transformAndPlotSelectedLocation(t)}catch(f){se(f)||this.loadImageError(f)}},this._loadImageFromSourceInternal=async(t,a)=>{var d;const{mode:i,imageRotation:r,options:o}=a,n=typeof t=="string",s=n?t:t.url,{pathname:l,searchParams:h}=new URL(s);let m=n?(d=l.match(Xs))==null?void 0:d[1]:t.datasetFormat;if(!m)try{m=await gi(s,{...a.options})}catch(p){se(p)||D.getLogger(this).error("#getContentType()",p)}switch(m??(m="UNKNOWN FORMAT"),i){case"default":this._imageViewer.imageSource={datasetFormat:m.toUpperCase(),url:s.split("?")[0]},this._imageViewer.customParameters=Object.fromEntries(h),this._imageViewer.imageRotation=r??0,await this._imageViewer.loadImage(o);break;case"panoramic":if(Ys.has(m.toUpperCase())){const{selectedPoint:p}=this,{pitch:g,yaw:v,cameraLocation:y,viewAngle:w}=a;this._panoramicViewer.imageSource=s;let f=v??0;typeof w=="number"?f=w-f:y&&p&&(f=await on(y,p)-f),this._panoramicViewer.pitch=g??0,this._panoramicViewer.yaw=f,await this._panoramicViewer.loadImage(o)}else this.setMessage("unsupportedPanoramicImageryError","error",void 0,{datasetFormat:m});break}},this._loadViewAdapter=async t=>{const{view:a}=this;if(a)switch(a.type){case"2d":{const{default:i}=await z(()=>import("./MapViewAdapter-COWmhULW.js"),__vite__mapDeps([436,7,1,8,9,10,11,2,12,5,6,3,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,122,123,32,38,124,125,58,59,126,46,47,48,49,50,112,127,128,129,130,131,34,35,67,132,61,62,63,64,65,66,68,69,71,72,70,73,0,133,134,135,136,137,138,33,53,54,55,139,140,98,99,100,102,141,36,37,39,40,41,42,43,44,142,143,144,145,146,147,148,149,150,151,152,153,154,60,89,90,155,156,86,87,88,157,158,77,78,159,103,160,161,104,105,106,108,109,110,111,162,163,164,165,166,167,168,118,119,169,94,170,171,172,173,174,175,176,91,92,177,115,116,117,178,179,180,51,52,56,57,74,75,76,79,80,81,82,83,84,85,181,113,107,182,183,184,185,186,187,188,189,4,45,93,95,96,97,101,114,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435]),import.meta.url);L(t),this._adapter=new i(this);break}case"3d":{const{default:i}=await z(()=>import("./SceneViewAdapter-_wmamBvG.js"),__vite__mapDeps([437,7,1,8,9,10,11,2,12,5,6,3,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,201,202,42,43,203,170,204,173,77,205,206,207,208,209,171,210,211,212,213,214,215,216,78,217,218,219,98,99,100,220,172,221,222,174,223,194,224,225,138,122,123,32,38,124,125,58,59,126,46,47,48,49,50,112,127,128,129,130,131,34,35,67,132,61,62,63,64,65,66,68,69,71,72,70,73,0,133,134,135,136,137,33,53,54,55,139,140,102,141,36,37,39,40,41,44,142,143,144,145,146,147,148,149,150,151,152,153,154,60,89,90,155,156,86,87,88,157,158,159,103,160,161,104,105,106,108,109,110,111,162,163,164,165,166,167,168,118,119,169,94,175,176,91,92,177,115,116,117,178,179,180,51,52,56,57,74,75,76,79,80,81,82,83,84,85,181,113,107,182,183,184,185,186,187,188,189,4,45,93,95,96,97,101,114,190,191,192,193,195,196,197,198,199,200,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435]),import.meta.url);L(t),this._adapter=new i(this);break}}else this._adapter=null},this._mapImageConversionToolViewClickHandler=t=>{t.stopPropagation(),t.preventDefault(),t.mapPoint&&this.plotMapPoint(t.mapPoint)},this._viewClickHandler=t=>{var a;(a=this._clickTask)==null||a.abort(),this._clickTask=ye(async i=>{const{pointerType:r,button:o,mapPoint:n}=t;if((r!=="mouse"||o===0)&&n)return t.stopPropagation(),t.preventDefault(),this._updatingHandles.addPromise(this.loadBestImage(n,{signal:i}))})},this.plotSelectedPointOnImage=async(t,a)=>{if(await Ue(a),!t)return;const i=new V({...ze.isSerializable(t)?t.toJSON():t});if(this.mode==="default")i.x-=.5,i.y=.5-i.y,i.spatialReference=this._imageViewer.imageRenderer.spatialReference.clone(),this._crossSymbol=new N({geometry:i,symbol:Va}),this._imageViewer.addGraphic(this._crossSymbol,0);else if(this.mode==="panoramic"){const{imageSize:r}=this._panoramicViewer;if(!r)return;const[o,n]=r,{heading:s,pitch:l}=Pe(t,o,n),h=xe(s,l);this._crossSymbol=new N({geometry:new V(h,U.WebMercator),symbol:Is}),this._panoramicViewer.addGraphic(this._crossSymbol,0)}},this.handleSectorClick=this.handleSectorClick.bind(this),this.searchBestImage=this.searchBestImage.bind(this),this.transformAndPlotReferencePointOnImage=this.transformAndPlotReferencePointOnImage.bind(this),this.updateSuitabilities=this.updateSuitabilities.bind(this),this.selectBestFeature=this.selectBestFeature.bind(this)}initialize(){this.addHandles([O(()=>this.view,()=>{this.load()},Z),O(()=>{var e;return(e=this.view)==null?void 0:e.map},(e,t)=>{t==null||t.layers.remove(this._overlays),e==null||e.layers.add(this._overlays)},Ze),O(()=>{var e,t,a;return(a=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.allLayers)==null?void 0:a.length},e=>{var t,a;e&&((a=(t=this.view)==null?void 0:t.map)==null||a.layers.reorder(this._overlays,e-1))},Ze),O(()=>[this.state,this.mapImageConversionToolState,this.view],()=>{this._createViewClickHandle(),this._createImageClickHandle()},Z),O(()=>[this.state,this.imageLocationToolState,this.view],()=>{if(this._createImageLocationHandle(),!this.imageLocationToolState)return this.clearPreviousGroundLocation(),void this._resetCursor();this._setMeasurementCursor()},Z),O(()=>this.measureType,()=>{this.clearPreviousMeasurements()},Z),O(()=>this.bestFeatureAngle,(e,t)=>{this.previousFeatureAngle=t??0},Z),O(()=>this.currentBestFeature,async(e,t)=>{Fe(this._featureChangedTask),this._featureChangedTask=ye(async a=>this.determineWorkflowForFeature.apply(this,[e,t,{signal:a}])),await this._featureChangedTask.promise},{sync:!0}),O(()=>this.mode,e=>{switch(this.removeHandles(fe.interactionHandles),e){case"default":this.addHandles(O(()=>{const{state:t}=this;return t==="image-loaded"?this._imageViewer.imagePointsInView:null},t=>{t&&(Fe(this._updateFootprintTask),this._updateFootprintTask=ye(async a=>{await this.updateFootprint(t,{signal:a})}))},{...Z,equals:(t,a)=>pa(t,a,ga)}),fe.interactionHandles);break;case"panoramic":this.addHandles(O(()=>{const{currentBestFeature:t,state:a}=this,{imageSize:i,vfov:r,hfov:o,pitch:n,yaw:s}=this._panoramicViewer;return t&&i&&!a.includes("loading")?[r,o,s,n]:null},t=>{if(!t||this.state.includes("loading"))return;const[a,i,r,o]=t;Fe(this._updateFootprintTask),this._updateFootprintTask=ye(async n=>{await this.updateFootprintPanorama({verticalFieldOfView:a,horizontalFieldOfView:i,yaw:r,pitch:o},{signal:n})})},{...Z,equals:(t,a)=>pa(t,a,ga)}),fe.interactionHandles)}},Z),O(()=>[this.brightness,this.contrast,this.sharpness],()=>{const{_imageViewer:e,brightness:t,contrast:a,mode:i,sharpness:r}=this;i==="default"&&(e.brightness=t,e.contrast=a,e.sharpness=r)},Z),O(()=>{var e;return(e=this.activeViewer)==null?void 0:e.imageRenderer},()=>{var e;this.sketch&&(this.sketch.view=(e=this.activeViewer)==null?void 0:e.imageRenderer)})]),this.when().finally(()=>{this.notifyChange("state")})}destroy(){var e,t;this._updateFootprintTask=Fe(this._updateFootprintTask),this._clickTask=Fe(this._clickTask),this.coverageFrustums.destroy(),this.coveragePolygons.destroy(),this.pointSources.destroy(),this.additionalFootprints.destroy(),this.additionalCameraLocations.destroy(),this.bestFeatureFootprint=ie(this.bestFeatureFootprint),this.bestFeatureCurrentFootprint=ie(this.bestFeatureCurrentFootprint),this._crossSymbol=ie(this._crossSymbol),this._referencePointOnGround=ie(this._referencePointOnGround),this._referencePointOnImage=ie(this._referencePointOnImage),this._locationPointOnImage=ie(this._locationPointOnImage),this._overlays&&((t=(e=this.view)==null?void 0:e.map)==null||t.remove(this._overlays)),this._overlays.destroy(),this._imageViewer.destroy(),this._panoramicViewer.destroy()}get activeLayer(){return Ae(D.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer}set activeLayer(e){Ae(D.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer=e}get activeViewer(){const{_imageViewer:e,_panoramicViewer:t,mode:a}=this;switch(a){case"default":return e;case"panoramic":return t;default:return null}}get accuracyParametersMissing(){var e,t;return((t=(e=this.layer)==null?void 0:e.orientationAccuracy)==null?void 0:t.every(a=>a===0))??!0}get brightness(){return this._get("brightness")??0}set brightness(e){this._set("brightness",Te(e,-10,10))}get contrast(){return this._get("contrast")??0}set contrast(e){this._set("contrast",Te(e,-10,10))}get featureCount(){var e;return((e=this.features)==null?void 0:e.length)??0}get imageGalleryEnabled(){var a;const{currentBestFeature:e}=this;if(!e)return!1;const t=(a=e.attributes.imagePath)==null?void 0:a.trim();return xa(t)||st(t)}get imageLoaded(){return Ae(D.getLogger(this),"imageLoaded",{replacement:'Use OrientedImageryViewer.state === "image-loaded"',version:"4.29",warnOnce:!0}),this.state==="image-loaded"}get invalidCameraHeading(){var e,t;return((t=(e=this.currentBestFeature)==null?void 0:e.attributes)==null?void 0:t.cameraHeading)===Pa}get imagePointsInView(){const{mode:e,_imageViewer:t}=this;return e==="default"?t.imagePointsInView:null}get layerView(){const{layer:e,view:t}=this;if(e&&t)return t.allLayerViews.find(Do(e))}get layerFloorFilterClause(){const{layerView:e}=this;return e?ho(e):null}get mode(){var i;const e=(i=this.currentBestFeature)==null?void 0:i.attributes;if(!e)return"none";const{horizontalFieldOfView:t,isSpherical:a}=e;return t===360||a?"panoramic":"default"}get popupEnabled(){var e;return((e=this.layer)==null?void 0:e.popupEnabled)===!0}get referencePoint(){var e;return(e=this._referencePointOnGround)==null?void 0:e.geometry}get sectorData(){const{_sectorData:e}=this;return e?xt.map(t=>e[t]):null}get sharpness(){return this._get("sharpness")??0}set sharpness(e){this._set("sharpness",Te(e,0,1))}get sketchGraphicsLayer(){var e;return(e=this.sketch)==null?void 0:e.layer}get state(){var r;const{mode:e,disabled:t,_updatingHandles:{updating:a},_featureChangedTask:i}=this;if(t)return"disabled";if(!this.isFulfilled()||a||(i==null?void 0:i.finished)===!1)return"loading";if(this.isRejected())return"error";if(((r=this.displayMessage)==null?void 0:r.type)==="error")return"image-load-error";switch(e){case"default":return this._imageViewer.state;case"panoramic":return this._panoramicViewer.state}return"ready"}get thumbnails(){const{features:e}=this;return e?new j(e.map(({attributes:{imagePath:t,objectId:a,cameraRoll:i,imageRotation:r}})=>{const o=t==null?void 0:t.trim();return xa(o)||st(o)?{url:o,objectId:a,rotation:(i??0)+(r??0)}:null}).filter(It)):null}set view(e){this._set("view",e)}get _sketchGraphicsLayer(){const{mode:e}=this;switch(e){case"panoramic":return new Be({elevationInfo:{mode:"absolute-height"}});case"default":return new Be;case"none":return}}get _overlaysView(){var e;return(e=this.view)==null?void 0:e.layerViews.find(({layer:t})=>t===this._overlays)}async computeHeight(e,t,a=!0){const{currentBestFeature:i,activeViewer:r,layer:o,footprintExtent:n}=this,s=r==null?void 0:r.imageSize,l=i==null?void 0:i.attributes,h=o==null?void 0:o.orientationAccuracy;if(!l||!s||!e||e.length<2||!h)return;const m=t==="panoramic"?await this.getMeasurementPropertiesPanoramic():rt(l,s[0],s[1]),d=e.at(0),p=e.at(-1);if(!(m&&d&&p&&h&&n))return;const g=[p,d],v=Ce(g,!1),y=t==="panoramic"?await ir(g,m,h,i,!0,!1):await ar(g,m,h,!0,a);if(!y)return;const w=t==="panoramic"?await js(h,v,m,y,i,!0):await Bs(h,v,m,y,!0);return w?{value:y,accuracy:w}:{value:y}}async calculateAreaMeasurement(e,t,a){var r;if(e.length<3||!this.currentBestFeature||!((r=this.activeViewer)!=null&&r.imageSize)||t==="none")return null;const i=t==="default"?await this.getMeasurementProperties():await this.getMeasurementPropertiesPanoramic();return L(a),i?t==="default"?await kt(e,i,!0):await Et(e,i,!0,a):null}async calculateDistanceMeasurement(e,t,a){const{currentBestFeature:i,activeViewer:r}=this;if(e.length<2||!i||!(r!=null&&r.imageSize)||t==="none")return null;const o=t==="default"?await this.getMeasurementProperties():await this.getMeasurementPropertiesPanoramic();return L(a),o?t==="default"?await zt([e.at(0),e.at(-1)],o,!0):await Gt([e.at(0),e.at(-1)],o,!0):null}async calculateAccuracy(e,t,a){const{layer:i,currentBestFeature:r,activeViewer:o}=this,n=i==null?void 0:i.orientationAccuracy,s=(n==null?void 0:n.every(w=>w===0))||!(n!=null&&n.length);if(t==="area"&&e.length<3||t==="distance"&&e.length<2||!r||!(o!=null&&o.imageSize)||s)return null;const l=await this.getMeasurementProperties();if(L(a),!l)return null;const h=t==="area"?await kt(e,l,!0):await zt([e.at(0),e.at(-1)],l,!0);L(a);const{updateElevationProps:m,...d}=l,p=er(d,n);if(!(p!=null&&p.length))return null;const g=p.map(w=>({...w,updateElevationProps:m})).map(async w=>{const f=t==="area"?await kt(e,w,!0):await zt([e.at(0),e.at(-1)],w,!0);if(L(a),f&&h){if(t==="area"){const b=typeof f!="number"?f.area:null;return b?Math.abs(b-h.area):null}return Math.abs(f-h)}return null}),v=await Promise.all(g);L(a);const y=v.filter(w=>w!==null);return y.length===0?null:qt(y)}async calculateAccuracyPanoramic(e,t,a){const{layer:i,currentBestFeature:r,activeViewer:o,mode:n}=this,s=i==null?void 0:i.orientationAccuracy,l=(s==null?void 0:s.every(f=>f===0))||!(s!=null&&s.length);if(t==="area"&&e.length<3||t==="distance"&&e.length<2||!r||!(o!=null&&o.imageSize)||l||n!=="panoramic")return null;const h=await this.getMeasurementPropertiesPanoramic();if(L(a),!h)return null;const m=t==="area"?await Et(e,h,!0):await Gt([e.at(0),e.at(-1)],h,!0);L(a);const{updateElevationProps:d,...p}=h,g=tr(p,s);if(!(g!=null&&g.length))return null;const v=g.map(f=>({...f,updateElevationProps:d})).map(async f=>{const b=t==="area"?await Et(e,f,!0):await Gt([e.at(0),e.at(-1)],f,!0);if(L(a),b&&m){if(t==="area"){const C=typeof b!="number"?b.area:null;return C?Math.abs(C-m.area):null}return Math.abs(b-m)}return null}),y=await Promise.all(v);L(a);const w=y.filter(f=>f!==null);return w.length===0?null:qt(w)}async calculateHeightMeasurementInfo(e,t,a){const{currentBestFeature:i,activeViewer:r}=this,o=r==null?void 0:r.imageSize;if(!i||!r||!(o!=null&&o.length)||t==="none")return;const{attributes:n}=i,[s]=Ce([e],t!=="panoramic"),l=t==="panoramic"?await this.getMeasurementPropertiesPanoramic():rt(n,o[0],o[1]);if(t==="panoramic"){if(!l)return;const p=await Zs(s,l,i,a);if(!p)return;(p==null?void 0:p.heading)>180&&(p.heading-=360);const g=Ns(s,p),v=de([s.x,s.y],[p.x,p.y]);return!g||!v?void 0:{measurementAngle:g,tempDistance:v}}const h=await qs(s,l,a);if(!h)return;const m=ca(s,h),d=de([s.x,s.y],[h.x,h.y]);return m&&d?{measurementAngle:m,tempDistance:d}:void 0}clearPreviousMeasurements(){this.clearMeasurementGraphics(),this.resetMeasurementData(),this.stopMeasurement()}clearPreviousGroundLocation(){this.groundCoordinates=null,this.pixelCoordinates=null,this.clearLocationPointOnImage()}clearMeasurementGraphics(){var e,t;this.measurementGraphic&&((e=this.activeViewer)==null||e.removeGraphic(this.measurementGraphic),this.measurementGraphic=null),this.heightGraphic&&((t=this.activeViewer)==null||t.removeGraphic(this.heightGraphic),this.heightGraphic=null)}digitizeCancel(){var e;return(e=this.sketch)==null?void 0:e.cancel()}digitizeCanRedo(){var e;return((e=this.sketch)==null?void 0:e.canRedo())??!1}digitizeCanUndo(){var e;return((e=this.sketch)==null?void 0:e.canUndo())??!1}digitizeComplete(){var e;return(e=this.sketch)==null?void 0:e.complete()}async digitizeCreate(e,t){const{sketch:a,dataCaptureLayer:i}=this;if(!a)throw Re();Vs(i,e,a),await a.create(e,{...t,defaultZ:0})}async digitizeDelete(){if(!this.sketch)throw Re();return this.sketch.delete()}digitizeDuplicate(){if(!this.sketch)throw Re();return this.sketch.duplicate()}digitizePlace(e,t){if(!this.sketch)throw Re();return this.sketch.place(e,t)}digitizeRedo(){if(!this.sketch)throw Re();return this.sketch.redo()}digitizeUndo(){if(!this.sketch)throw Re();return this.sketch.undo()}digitizeUpdate(e,t){if(!this.sketch)throw Re();return this.sketch.update(e,t)}async displayHeightResults(){const{currentBestFeature:e,activeViewer:t,heightMeasurementPixels:a,mode:i}=this,r=t==null?void 0:t.imageSize;if(!(e==null?void 0:e.attributes)||!r)return;const n=await this.computeHeight(a,i);n!=null&&n.value&&(n!=null&&n.accuracy)&&(this.heightMeasurementResult=n.value,this.heightMeasurementAccuracy=n.accuracy)}filterByFootprints(e,t){const a=[],i=[],r=[];return e.forEach(o=>{const{layer:{coveragePercent:n},attributes:s}=o;let l;const h=va(o.geometry.spatialReference);s.cameraHeight/=h,s.farDistance/=h,s.nearDistance/=h,Da(s.elevationSource)&&(s.elevationSource.constantElevation/=h);const{polygon:m,frustum:d}=Tt(s);if(l=m.clone(),s.isInspection&&(l=Zn(s)),n&&(l=Un(l,n)),jn(l,t)){r.push(o);const{geometry:p,objectId:g,cameraHeight:v,cameraHeading:y}=s,w=p.clone();w.z=v,w.imageID=g,this.pointSources.push(w),y!==Pa&&(a.push(m),d&&i.push(d))}}),{features:r,polygons:a,frustums:i}}getMeasurementProperties(){const{currentBestFeature:e,activeViewer:t}=this;if(!e||!(t!=null&&t.imageSize))return;const{elevationSample:a,attributes:i}=e,{elevationSource:r,cameraHeight:o}=i,n=rt(i,t.imageSize[0],t.imageSize[1]);let s=n.cameraLocation;return(s.spatialReference.isGeographic?re(s,U.WebMercator):Promise.resolve(s)).then(l=>(s=l,He((s.z??0)-o,{elevationSample:a,elevationSource:r,extent:this.footprintExtent}))).then(l=>("elevationSample"in l&&We(l.elevationSample)&&(e.elevationSample=l.elevationSample),{...n,cameraLocation:s,updateElevationProps:l}))}getMeasurementPropertiesPanoramic(){const{currentBestFeature:e,activeViewer:t}=this;if(!e||!(t!=null&&t.imageSize))return;const{elevationSample:a,attributes:i}=e,{elevationSource:r,cameraHeight:o}=i,n=Sa(i,t.imageSize[0],t.imageSize[1]);let s=n.cameraLocation;return(s.spatialReference.isGeographic?re(s,U.WebMercator):Promise.resolve(s)).then(l=>(s=l,He((s.z??0)-o,{elevationSample:a,elevationSource:r,extent:this.footprintExtent}))).then(l=>("elevationSample"in l&&We(l.elevationSample)&&(e.elevationSample=l.elevationSample),{...n,cameraLocation:s,updateElevationProps:l}))}async deleteDataCaptureFeatures(e){const{dataCaptureLayer:t}=this;if(!t)throw new Q("Data capture layer is not available");return t.queryFeatures({objectIds:e}).then(({features:a})=>t.applyEdits({deleteFeatures:a}))}handleSectorClick(e){var a;if(isNaN(e))return;const t=(a=this._sectorData)==null?void 0:a[xt[e]];t!=null&&t.length&&this._updateCurrentBestFeature(t.at(0))}handleFeatureClick(e){var r;const{sector:t,featureIndexInSector:a}=e;if(isNaN(a))return;const i=(r=this._sectorData)==null?void 0:r[t];i!=null&&i.length&&this._updateCurrentBestFeature(i.at(a))}handleDrawCursorUpdateEvents(e){const{measurementAngle:t,tempDistance:a,heightMeasurementPixels:i,mode:r,activeViewer:o}=this,n=o==null?void 0:o.imageSize;if(!e.vertices||!n)return;const s=za(e.vertices.at(-1),r,n);if(i.length<1||!s||!a||!t||r==="none")return;const l=ha(i[0],s,t);if(!(l!=null&&l.length))return;this.heightMeasurementPixels.push(l),r==="panoramic"?this.createPolylineGraphicPano():this.createPolylineGraphic();const h=Ws(this.heightMeasurementPixels,a);h&&(this.heightMeasurementResult=h)}async handleDrawVertexAddEvents(e,t){var s;const{currentBestFeature:a,activeViewer:i,heightMeasurementPixels:r,mode:o}=this;if(!a||!i||!((s=e.vertices)!=null&&s.length)||o==="none")return;const n=i==null?void 0:i.imageSize;if(!r.length&&n){const l=za(e.vertices.at(-1),o,n);this.heightMeasurementPixels.push(l);const h=await this.calculateHeightMeasurementInfo(l,o,t);if(!(h!=null&&h.measurementAngle)||!(h!=null&&h.tempDistance))return;this.measurementAngle=h.measurementAngle,this.tempDistance=h.tempDistance}}async load(e){return this.addResolvingPromise(this._loadViewAdapter(e).catch(t=>{if(!se(t))throw t})),this}async loadBestImage(e,t){var a,i;return(a=this.view)==null||a.closePopup(),this.displayMessage=null,this.clearPreviousGroundLocation(),this.imageLocationToolState=!1,this.selectedPoint=e.spatialReference.isGeographic?Ht(e):e.clone(),this.features.removeAll(),this.currentBestFeature=null,this.additionalFeatures.removeAll(),this.additionalFootprints.removeAll(),this.additionalCameraLocations.removeAll(),this.bestFeatureCurrentFootprint=ie(this.bestFeatureCurrentFootprint),(i=this._overlays)==null||i.removeAll(),this._fetchFeaturesWithController(e,t)}loadImageError(e){D.getLogger(this).error("oriented-imagery-viewer:load-image",e),this.setMessage("imageLoadError","error",e.message)}async loadSketch(e){var t;if(!this.sketch){const a=z(()=>import("./SketchViewModel-BHWV3FYM.js").then(r=>r.S),__vite__mapDeps([438,5,6,1,9,10,11,195,15,12,2,3,98,30,23,24,19,99,100,197,198,7,8,13,14,16,17,18,20,21,22,25,26,27,28,29,31,33,34,35,37,38,39,40,41,42,43,47,48,49,67,242,439,239,54,95,240,262,440,260,261,259,194,216,173,235,219,200,441,238,130,58,59,131,241,155,77,78,215,170,171,204,217,226,172,243,442,396,251]),import.meta.url),{default:i}=await a;L(e),this.sketch=new i({layer:this._sketchGraphicsLayer,view:(t=this.activeViewer)==null?void 0:t.imageRenderer,updateOnGraphicClick:!1,defaultUpdateOptions:{reshapeOptions:{edgeOperation:"none",shapeOperation:"none",vertexOperation:void 0},enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,multipleSelectionEnabled:!1,toggleToolOnClick:!1,tool:"transform"}})}return this.sketch}async loadMeasurementAdapter(e){if(!this.sketchAdapter){const t=z(()=>import("./MeasurementAdapter-P-fcIYKm.js"),__vite__mapDeps([443,1,9,10,11,14,12,5,6,2,98,30,15,3,23,24,19,99,100,121,122,123,7,8,13,16,17,18,20,21,22,25,26,27,28,29,31,32,38,124,125,58,59,126,46,47,48,49,50,112,127,128,129,130,131,34,35,67,132,61,62,63,64,65,66,68,69,71,72,70,73,0,133,134,135,136,137,138,33,53,54,55,139,140,102,141,36,37,39,40,41,42,43,44,142,143,144,145,146,147,148,149,150,151,152,153,154,60,89,90,155,156,86,87,88,157,158,77,78,159,103,160,161,104,105,106,108,109,110,111,162,163,164,165,166,167,168,118,119,169,94,170,171,172,173,174,175,176,91,92,177,115,116,117,178,179,180,51,52,56,57,74,75,76,79,80,81,82,83,84,85,181,113,107,182,183,184,185,186,187,188,189,4,45,93,95,96,97,101,114,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435]),import.meta.url),{default:a}=await t;if(L(e),this.sketchAdapter=new a({viewModel:this}),!this.sketchAdapter.viewModel.isResolved())return}return this.sketchAdapter}async startMeasurement(e,t){var s;await this.loadSketch(t),await this.loadMeasurementAdapter(t);const{sketch:a,sketchAdapter:i,activeViewer:r,mode:o}=this;if(!a||!i||!r||o==="none")return;if(this.displayNewMeasurementButton=!1,o==="panoramic"&&(a.defaultCreateOptions.defaultZ=0),await a.create(e),o==="panoramic"){const{drawOperation:l}=a.view.activeTool;l.constraintsEnabled=!1,l._set("elevationDrawSurface",null)}const n=(s=this.activeViewer)==null?void 0:s.imageRenderer.effectiveTheme.accentColor;n&&this.sketch&&(this.sketch.polygonSymbol=Fs(n),this.sketch.polylineSymbol=o==="panoramic"?Ea:ka(n))}startHeightMeasurement(){var e;this.heightMeasurementPixels=[],this.displayNewMeasurementButton=!1,this.draw??(this.draw=new uo({view:(e=this.activeViewer)==null?void 0:e.imageRenderer})),this.draw.create("polyline").on(["cursor-update","vertex-add","draw-complete"],t=>this.handleDrawEvents(t))}createPolylineGraphic(){var a,i,r;const e=[this.heightMeasurementPixels[0],this.heightMeasurementPixels.at(-1)],t=(a=this.activeViewer)==null?void 0:a.imageRenderer.spatialReference;if(this.heightGraphic)this.heightGraphic.geometry=new _e({paths:[e],spatialReference:t});else{const o=new _e({paths:[e],spatialReference:t}),n=(i=this.activeViewer)==null?void 0:i.imageRenderer.effectiveTheme.accentColor;this.heightGraphic=new N({geometry:o,symbol:ka(n,2.5)}),(r=this.activeViewer)==null||r.addGraphic(this.heightGraphic)}}createPolylineGraphicPano(){var h,m;const e=(h=this.activeViewer)==null?void 0:h.imageRenderer.spatialReference,t=(m=this.activeViewer)==null?void 0:m.imageSize;if(!t)return;const a={x:this.heightMeasurementPixels[0][0],y:this.heightMeasurementPixels[0][1]},i={x:this.heightMeasurementPixels.at(-1)[0],y:this.heightMeasurementPixels.at(-1)[1]},{heading:r,pitch:o}=Pe(a,t[0],t[1]),{heading:n,pitch:s}=Pe(i,t[0],t[1]),l=[[...xe(r,o)],[...xe(n,s)]];if(this.heightGraphic)this.heightGraphic.geometry=new _e({paths:[l],spatialReference:e});else{const d=new _e({paths:[l],spatialReference:e});this.heightGraphic=new N({geometry:d,symbol:Ea}),this._panoramicViewer.addGraphic(this.heightGraphic,0)}}async handleDrawEvents(e,t){if(this.draw)switch(e.type){case"cursor-update":this.handleDrawCursorUpdateEvents(e);break;case"vertex-add":this.handleDrawVertexAddEvents(e,t);break;case"draw-complete":await this.displayHeightResults()}}initializeMeasurement(e){switch(this.clearMeasurementGraphics(),this.resetMeasurementData(),e){case"distance":this.startMeasurement("polyline");break;case"area":this.startMeasurement("polygon");break;case"height":this.startHeightMeasurement()}}async overlayCameraLocations(e){const{activeViewer:t,currentBestFeature:a,overlayedCameraLocations:i,layer:r,mode:o,state:n}=this,s=t==null?void 0:t.imageSize;if(!s||!a||!r||o==="none"||n.includes("loading"))return;const{polygon:l}=Tt(a.attributes);if(t.removeManyGraphics(i.toArray()),i.removeAll(),e){const{features:h}=await r.queryFeatures({where:`${r.objectIdField} <> ${a.attributes.objectId}`,geometry:l,returnGeometry:!0,outFields:[r.objectIdField]}),m=await Promise.all(h.map(async d=>{const{attributes:p,geometry:g}=d,v=await this.getPixels(g,{feature:a,imageSize:s,mode:o}),y=Ta.clone();return y.outline=new aa({color:[0,0,0],width:1}),new N({attributes:p,symbol:y,geometry:v})}));i.addMany(m),t.addManyGraphics(i.toArray())}}overlayGraphicsOnImage(e,t){var a;this.removeOverlayedGraphicsOnImage(e),this.overlayedMapFeatures.set(e,t),(a=this.activeViewer)==null||a.addManyGraphics(t.toArray())}async overlayMapFeatures(e,t=!1){const{activeViewer:a,currentBestFeature:i,mode:r,state:o,layer:n}=this,s=a==null?void 0:a.imageSize;if(!s||!i||r==="none"||o.includes("loading")||!n)return;const{polygon:l}=Tt(i.attributes);try{const{imageGeometryField:d,oiObjectIdField:p}=ks(e,n.imageGeometryField,n.imageReferenceField);this.imageGeometryField=d.name,this.oiObjectIdField=p.name}catch(d){D.getLogger(this).warn("oriented-imagery-viewer:overlay-map-features",d)}const{features:h}=await e.queryFeatures({geometry:l,returnGeometry:!0,outFields:["*"]}),m=new j((await Promise.all(h.map(async d=>{var b,C,F;const p=((b=d.symbol)==null?void 0:b.clone())??((F=(C=e.renderer)==null?void 0:C.getSymbol(d))==null?void 0:F.clone()),{attributes:g,geometry:v}=d,y=v,{imageGeometryField:w,oiObjectIdField:f}=this;if(w&&f&&Ts(e,w,f)&&`${g[f]}`==`${i.attributes.objectId}`)try{return Es(g,w,e,t,s,r,p)}catch(I){D.getLogger(this).warn("oriented-imagery-viewer:overlay-map-features","couldn't create graphic from attributes, geometry will be used",{error:I,feature:d,layer:e,imageGeometryField:this.imageGeometryField,imageReferenceField:this.oiObjectIdField})}switch(y==null?void 0:y.type){case"point":{const I=await this.getPixels(y,{feature:i,imageSize:s,mode:r});return new N({attributes:g,layer:e,symbol:p,geometry:I,visible:e.visible&&t})}case"polygon":{const{rings:I,spatialReference:S}=y,A=I.map(T=>T.map(([G,ce,he])=>new V({x:G,y:ce,z:he,spatialReference:S}))),E=await Promise.all(A.map(async T=>this.getPixels(T,{feature:i,imageSize:s,mode:r}).then(G=>G.map(ue))));return new N({attributes:g,layer:e,symbol:p,geometry:new ne({rings:E,spatialReference:U.WebMercator}),visible:e.visible&&t})}case"polyline":{const{paths:I,spatialReference:S}=y,A=I.map(T=>T.map(([G,ce,he])=>new V({x:G,y:ce,z:he,spatialReference:S}))),E=await Promise.all(A.map(async T=>this.getPixels(T,{feature:i,imageSize:s,mode:r}).then(G=>G.map(ue))));return new N({attributes:g,layer:e,symbol:p,geometry:new _e({paths:E,spatialReference:U.WebMercator}),visible:e.visible&&t})}case"multipoint":{const{points:I,spatialReference:S}=y,A=I.map(([T,G,ce])=>new V({x:T,y:G,z:ce,spatialReference:S})),E=await this.getPixels(A,{feature:i,imageSize:s,mode:r}).then(T=>T.map(ue));return new N({attributes:g,layer:e,symbol:p,geometry:new Za({points:E,spatialReference:U.WebMercator}),visible:e.visible&&t})}}return null}))).filter(It));this.overlayGraphicsOnImage(`${e.id}`,m)}async getPixels(e,t){const{imageSize:a,mode:i}=t,r=(await this.worldToImage(Array.isArray(e)?e:[e])).map(o=>{if(i==="default")return new V({x:o.x-.5,y:.5-o.y,spatialReference:U.WebMercator});const[n,s]=a,{heading:l,pitch:h}=Pe(o,n,s),m=xe(l,h);return new V(m,U.WebMercator)});return Array.isArray(e)?r:r[0]}async getMapPoint(e,t){const{feature:a,mode:i,imageSize:r}=t,{elevationSample:o,attributes:n}=a,{elevationSource:s,location:l,elevation:h,cameraHeight:m}=n;let d=l.clone();d.spatialReference.isGeographic&&(d=await re(d,U.WebMercator));const p=await He(h??(l.z??0)-m,{elevationSample:o,elevationSource:s,extent:this.footprintExtent});let g;if("elevationSample"in p&&We(p.elevationSample)&&(a.elevationSample=p.elevationSample),i==="default"){const v=rt(n,r[0],r[1]);g=await _t(Array.isArray(e)?e:[e],{...v,cameraLocation:d},p)}else{const v=Sa(n,r[0],r[1]);g=await bt(Array.isArray(e)?e:[e],{...v,cameraLocation:d},p)}return Array.isArray(e)?g:g[0]}async plotMapPoint(e){var t;return this.plotReferencePoint(e),this.transformAndPlotReferencePointOnImage({feature:this.currentBestFeature,selectedLocation:e,options:{signal:(t=this._transformController)==null?void 0:t.signal}})}plotReferencePointOnGround(e){var t,a,i;this._referencePointOnGround&&((t=this._overlays)==null||t.remove(this._referencePointOnGround),this._referencePointOnGround.destroy()),e!=null&&(this._referencePointOnGround=new N({geometry:new V({...e.toJSON()}),symbol:La}),this.view?(a=this._overlays)==null||a.add(this._referencePointOnGround):this.emit("plot-ground-point",{data:{point:(i=this._referencePointOnGround)==null?void 0:i.geometry}}))}plotReferencePointOnImage(e){if(this.state==="image-loaded")switch(this.clearReferencePointOnImage(),this.mode){case"default":{const t=ze.isSerializable(e)?e.toJSON():e;t.x-=.5,t.y=.5-t.y,this._referencePointOnImage=new N({geometry:new V({spatialReference:this._imageViewer.imageRenderer.spatialReference,...t}),symbol:La}),this._imageViewer.addGraphic(this._referencePointOnImage,0);break}case"panoramic":{const{imageSize:t}=this._panoramicViewer;if(!t)return;const[a,i]=t,{heading:r,pitch:o}=Pe(e,a,i),n=xe(r,o);this._referencePointOnImage=new N({geometry:new V(n,U.WebMercator),symbol:Ps}),this._panoramicViewer.addGraphic(this._referencePointOnImage,0);break}}}plotLocationPointOnImage(e){if(this.state==="image-loaded")switch(this.clearLocationPointOnImage(),this.mode){case"default":this._plotLocationPointOnDefaultImage(e);break;case"panoramic":this._plotLocationPointOnPanoramicImage(e)}}removeAllOverlayMapFeatures(){this.overlayedMapFeatures.forEach(e=>{this._imageViewer.removeManyGraphics(e.toArray())}),this.overlayedMapFeatures.clear()}removeOverlayedGraphicsOnImage(e){var a;const t=this.overlayedMapFeatures.get(e);t!=null&&t.length&&((a=this.activeViewer)==null||a.removeManyGraphics(t.toArray()),this.overlayedMapFeatures.delete(e))}resetImage(){switch(this.setMessage("onLoadMessage","info"),this.mode){case"default":this._imageViewer.clearImage(),this._imageViewer.clearGraphics();break;case"panoramic":this._panoramicViewer.clearGraphics()}this._clickTask=Fe(this._clickTask)}resetMeasurementData(){this.areaMeasurementResult=0,this.areaMeasurementAccuracy=0,this.distanceMeasurementResult=0,this.distanceAccuracyArray=[],this.heightMeasurementPixels=[],this.heightMeasurementResult=0,this.tempDistance=null,this.measurementAngle=null,this.heightMeasurementAccuracy=0,this.heightGraphic=null}async saveDrawing(){const{dataCaptureLayer:e,sketchAdapter:t}=this;if(!e||(t==null?void 0:t.type)!=="data-capture")return;const{pendingGraphics:a,savedGraphics:i}=t,r=a.get(e.id),o=r==null?void 0:r.toArray();if(!r||!(o!=null&&o.length))return;const{addFeatureResults:n}=await this.saveDataCaptureFeatures(o),s=n.reduce((l,{objectId:h,globalId:m,error:d},p)=>{const g=o[p],{attributes:v}=g;return d?l.error.push(g):(h&&(v[e.objectIdField]=h),m&&e.globalIdField&&(v[e.globalIdField]=m),l.success.push(g)),l},{success:[],error:[]});i.addMany(s.success),r.removeAll(),r.addMany(s.error)}async saveDataCaptureFeatures(e){const{activeViewer:t,currentBestFeature:a,dataCaptureLayer:i,mode:r}=this,o=t==null?void 0:t.imageSize;if(!o||!a||r==="none")throw new Q("Image size, current best feature and mode are required to save data capture features");if(!i)throw new Q("Data capture layer is not available");const n=await Promise.all(e.map(async l=>{const h=l.clone(),{geometry:m}=h;if(!m)return;const d=m.type,p=i.hasZ,g=i.geometryType,v=d!==g,y=v?await z(()=>import("./transformers-DtkRkbRv.js"),[],import.meta.url):null,w=y==null?void 0:y.default[g],f=v?w==null?void 0:w(m):m;if(f)switch(f.type){case"point":return h.geometry=await this.getMapPoint(Ft(r,f,o),{feature:a,imageSize:o,mode:r}),p||(delete h.geometry.z,h.geometry.hasZ=!1),h.geometry.hasM=!1,h;case"polygon":{const b=await Promise.all(f.rings.map(async C=>this.getMapPoint(C.map(([F,I,S])=>Ft(r,{x:F,y:I,z:S},o)),{feature:a,imageSize:o,mode:r})));return h.geometry=new ne({spatialReference:b[0][0].spatialReference,hasZ:p,hasM:!1,rings:b.map(C=>C.map(ue))}),h}case"polyline":{const b=await Promise.all(f.paths.map(async C=>this.getMapPoint(C.map(([F,I,S])=>Ft(r,{x:F,y:I,z:S},o)),{feature:a,imageSize:o,mode:r})));return h.geometry=new _e({spatialReference:b[0][0].spatialReference,hasZ:p,hasM:!1,paths:b.map(C=>C.map(ue))}),h}}})),s=n.filter(It);return i.applyEdits({addFeatures:s}).then(l=>{const{addFeatureResults:h}=l;let m=0;const d=n.map(p=>{const g=h[m++];return p?g:{error:new Q("Error in saving data capture features"),objectId:null,globalId:null}});return{...l,addFeatureResults:d}})}async searchBestImage(e,t){try{const a=await Tn(e,t);a&&await this._processFeatureResponse(a,e.point,{signal:t==null?void 0:t.signal})}catch(a){se(a)||(this.setMessage("imageLoadError","error",a.message),D.getLogger(this).error("error occurred while finding best image",a))}}selectBestFeature(e){var t;this.currentBestFeature=(t=this.features)==null?void 0:t.find(({attributes:a})=>a.objectId===Number(e))}setAdditionalCameraLocationsVisibility(e){this.additionalCameraLocations.forEach(t=>{t.visible=e})}setAdditionalCoverageVisibility(e){this.additionalFootprints.forEach(t=>{t.visible=e})}setCurrentCoverageVisibility(e){this.bestFeatureCurrentFootprint&&(this.bestFeatureCurrentFootprint.visible=e),this.currentBestFeatureLocation&&(this.currentBestFeatureLocation.visible=e)}setMapImageConversionToolState(e){this.mapImageConversionToolState=e}async startDataCapture(e,t){var d,p;const a=(d=this.activeViewer)==null?void 0:d.imageRenderer,{oiObjectIdField:i,currentBestFeature:r}=this;if(!a||!r||!i)return;const{attributes:{objectId:o}}=r,n=((p=this.overlayedMapFeatures.get(e.id))==null?void 0:p.toArray())??[],s=[],l=[];for(const g of n)`${g.getAttribute(i)}`==`${o}`?s.push(g):l.push(g);this.overlayGraphicsOnImage(e.id,new j(l)),this.collectionId=e.id;const h=await this.loadSketch(t),m=await this.loadDataCaptureAdapter(t);L(t),h.layer.addMany(s),h.layer.blendMode="source-atop",m.savedGraphics.addMany(s),a.ui.find("zoom").visible=!1,a.map.layers.add(this.sketchGraphicsLayer)}async stopDataCapture(e=!1){var r,o,n;(r=this.sketch)==null||r.cancel(),(o=this.sketchGraphicsLayer)==null||o.removeAll(),this.sketchAdapter=ie(this.sketchAdapter),this.sketch=ie(this.sketch),this.collectionId=null;const{dataCaptureLayer:t}=this,a=(n=this.activeViewer)==null?void 0:n.imageRenderer;if(!a||a.destroyed)return;a.map.layers.remove(this.sketchGraphicsLayer),e&&t&&await this.overlayMapFeatures(t,!0);const i=a.ui.find("zoom");i&&(i.visible=!0)}stopMeasurement(){var e,t;this.heightMeasurementPixels=[],(e=this.draw)==null||e.reset(),(t=this.sketch)==null||t.cancel()}toggleAllOverlayMapFeatures(e){this.overlayedMapFeatures.forEach(t=>{this._toggleVisiblity(t,e)})}toggleOverlayMapFeatures(e,t){const a=this.overlayedMapFeatures.get(e);a&&this._toggleVisiblity(a,t)}toggleSelection(e){const{sketch:t}=this;t&&(t.updateOnGraphicClick=e,t.cancel())}async transformAndPlotReferencePointOnImage(e){var s;const{selectedLocation:t,options:a}=e;let i=!1,r=!1;const o=(s=this.bestFeatureFootprint)==null?void 0:s.geometry;switch(o==null?void 0:o.type){case"polygon":{const l=t.spatialReference.equals(o.spatialReference)?t:await re(t,o.spatialReference);i=o.contains(l);break}case"mesh":{const l=t.spatialReference.equals(o.spatialReference)?t:await re(t,o.spatialReference);r=o.extent.contains(l);break}}if(!i&&!r)return void this.clearReferencePointOnImage();const n=await this.worldToImage(t,a);if(n)return L(a),this.plotReferencePointOnImage(n),{x:n.x,y:n.y};this.clearReferencePointOnImage()}updateSuitabilities(e){e.sort((a,i)=>a.suitability-i.suitability),this._suitabilities=e;const t=this._suitabilities.map(({feature:a})=>a);this._initialCurrentCoverageUpdate=!0,this._updateFeatures(t),this._groupFeaturesBySectors()}async _fetchFeatures(e,t){if(!this.view)return;const a=this.layer;if(a){const i={include:a},r=this.view.toScreen(e);if(!r)return;const o=await this.view.hitTest(r,i);return this._processHitTestResults(a,o,t)}}async _fetchFeaturesWithController(e,t){try{await this._fetchFeatures(e,t)}catch(a){if(se(a))return;this.setMessage("imageLoadError","error"),D.getLogger(this).error("error occurred while fetching features",a)}}_groupFeaturesBySectors(){const{_suitabilities:e,additionalFeatures:t,currentBestFeature:a,features:i,invalidCameraHeading:r}=this;if(!e||!t||!a||!i||r)return void(this._sectorData=null);this._sectorData={};for(const l of xt)this._sectorData[l]=new j;const o=e.map((l,h)=>({...l,featureIndex:h}));o.sort((l,h)=>l.trueSuitability-h.trueSuitability);const n=o.map(({distance:l})=>l),s=Math.max(...n);o.forEach(l=>{var A,E;const{distance:h,angle:m,featureIndex:d}=l,p=h/s*k[2],g=Eo(h,s),v=ko(m);if(!this._sectorData)return;const y=k[3]+p*Math.sin(m*Math.PI/180),w=k[3]+p*Math.cos(m*Math.PI/180);let f;const b=i.at(d),C=b===this.currentBestFeature,F=((A=this.currentBestFeature)==null?void 0:A.attributes.cameraPitch)&&((E=this.currentBestFeature)==null?void 0:E.attributes.cameraPitch)<5;if(C&&F)f=-90;else{const T=y-k[3],G=w-k[3],ce=G/Math.sqrt(T**2+G**2);let he=180*Math.acos(ce)/Math.PI;(T<0&&G<0||T<0&&G>0)&&(he*=-1),f=he}const I=g===""?v:`${g}_${v}`;C&&(f===this.bestFeatureAngle?this.previousFeatureAngle=f:this.bestFeatureAngle=f,this.navigatorCurrentBestFeature=F?null:{x:y,y:w,direction:v});const S=this._sectorData[I];S.add({angle:m,featureIndex:d,x:y,y:w,objectID:b.attributes.objectId,sector:I,featureIndexInSector:S.length})})}_plotLocationPointOnDefaultImage(e){const t=ze.isSerializable(e)?e.toJSON():e;t.x-=.5,t.y=.5-t.y,this._locationPointOnImage=new N({geometry:new V({spatialReference:this._imageViewer.imageRenderer.spatialReference,...t}),symbol:xs}),this._imageViewer.addGraphic(this._locationPointOnImage,0)}_plotLocationPointOnPanoramicImage(e){const{imageSize:t}=this._panoramicViewer;if(!t)return;const[a,i]=t,{heading:r,pitch:o}=Pe(e,a,i),n=xe(r,o);this._locationPointOnImage=new N({geometry:new V(n,U.WebMercator),symbol:$s}),this._panoramicViewer.addGraphic(this._locationPointOnImage,0)}async _processFeatureResponse(e,t,a){var l;const{features:i}=e;if(!(i!=null&&i.length))return this.setMessage("noImageError","error"),void(this.currentBestFeature=null);this.coveragePolygons.removeAll(),this.coverageFrustums.removeAll(),this.pointSources.removeAll();const{features:r,polygons:o,frustums:n}=this.filterByFootprints(i,t);if(!r.length)return this.setMessage("noImageError","error"),void(this.currentBestFeature=null);let s;if(this.coveragePolygons.addMany(o),this.coverageFrustums.addMany(n),o[0]){let h=new ne({spatialReference:o[0].spatialReference});for(const d of o)h=await Kr(h,d);const m=[];for(const{geometry:d}of r)h.contains(d)||m.push([d.x,d.y]);if(m.sort((d,p)=>+Vr([d,p])),h.addRing(m),this.footprintExtent=mo(h.extent,2,2),(l=this.view)==null?void 0:l.supportsGround)try{s=await this.view.map.ground.createElevationSampler(this.footprintExtent,a)}catch(d){se(d)||D.getLogger(this).error(d)}}if((s||r[0].attributes.elevationSource)&&this.footprintExtent){const h=r[0].attributes.elevationSource;Zt(h)&&!s&&(s=await na({extent:this.footprintExtent,lod:h.lod,url:h.url,rasterFunction:h.rasterFunction}));const m=await He((r[0].attributes.location.z??0)-r[0].attributes.cameraHeight,{elevationSample:s,elevationSource:h,extent:this.footprintExtent}),[d,...p]=await De([t,...r.map(g=>g.attributes.geometry.clone())],m);r[0].elevationSample=s??m.elevationSample,t.elevation=d.z,r.forEach((g,v)=>{g.attributes.elevation=p[v].z})}r[0].elevationSample&&r.forEach(h=>{h.elevationSample=r[0].elevationSample}),this._suitabilities=kn({features:r,selectedPoint:t,camera:To(this.view)?this.view.camera:null,currentImage:this.currentBestFeature}),this.updateSuitabilities(this._suitabilities)}async _processHitTestResults(e,t,a){var p;const{screenPoint:i,results:[r]}=t,o=(r==null?void 0:r.type)==="graphic"&&this.shouldShowSelectedImage,n=(r==null?void 0:r.mapPoint)??((p=this.view)==null?void 0:p.toMap(i));if(!n)return;const{layerFloorFilterClause:s}=this,l=e.spatialReference.equals(n.spatialReference)?n:await re(n,e.spatialReference),h=wa("1=1",wa(e.definitionExpression,s)),m=l.spatialReference.isGeographic?1:va(l.spatialReference),d={layerInstanceOrURL:e,point:l,queryParams:{where:h,maximumDistance:e.maximumDistance?e.maximumDistance/m:void 0,objectIds:o?[r.graphic.getAttribute(e.objectIdField)]:void 0}};await this.searchBestImage(d,a)}_resetCursor(){const{activeViewer:e}=this;e&&(e.imageRenderer.cursor=this._previousCursor)}_setMeasurementCursor(){const{activeViewer:e}=this;e&&(this._previousCursor=e.imageRenderer.cursor,e.imageRenderer.cursor="crosshair")}_toggleVisiblity(e,t){e.forEach(a=>{a.visible=t})}_updateFeatures(e){if(!e.length)return this.currentBestFeature=null,void this.additionalFeatures.removeAll();this.features.removeAll(),this.features.addMany(e),e.length>1?this.additionalFeatures.addMany(e.slice(1)):this.additionalFeatures.removeAll(),this._updateGroundElevation=!0,this.currentBestFeature=e[0]}async _updatePointsAndPolygons(e){var o;const{pointSources:t,currentBestFeature:a,currentCoverageVisible:i,isAdditionalPointSourcesVisible:r}=this;if(a&&(this.additionalFootprints.removeAll(),this.additionalCameraLocations.removeAll(),this.bestFeatureCurrentFootprint&&(this.bestFeatureCurrentFootprint.destroy(),this.bestFeatureCurrentFootprint=null,this.bestFeatureFootprint=null),!this.invalidCameraHeading)){await((o=this._adapter)==null?void 0:o.createFootprints(e)),L(e);for(const n of t)n.imageID===a.attributes.objectId?this.currentBestFeatureLocation=new N({attributes:{imageID:n.imageID},geometry:n.clone(),symbol:Cs,visible:i}):this.additionalCameraLocations.push(new N({attributes:{imageID:n.imageID},geometry:n.clone(),symbol:Ta,visible:r}))}}_updateCurrentBestFeature(e){var i,r,o;if(!e)return;this.currentBestFeature=(i=this.features)==null?void 0:i.at(e.featureIndex);const t=((r=this.currentBestFeature)==null?void 0:r.attributes.cameraPitch)&&((o=this.currentBestFeature)==null?void 0:o.attributes.cameraPitch)<5;let a;if(t)a=-90;else{const n=e.x-k[3],s=e.y-k[3],l=s/Math.sqrt(n**2+s**2);let h=180*Math.acos(l)/Math.PI;(n<0&&s<0||n<0&&s>0)&&(h*=-1),a=h}a===this.bestFeatureAngle?this.previousFeatureAngle=a:this.bestFeatureAngle=a,this.navigatorCurrentBestFeature=t?null:{x:e.x,y:e.y,direction:e.sector.includes("_")?e.sector.split("_")[1]:e.sector}}clearGraphics(){this._imageViewer.clearGraphics(),this._panoramicViewer.clearGraphics()}clearReferencePointOnImage(){this._referencePointOnImage&&(this._imageViewer.removeGraphic(this._referencePointOnImage),this._panoramicViewer.removeGraphic(this._referencePointOnImage),this._referencePointOnImage=ie(this._referencePointOnImage))}clearLocationPointOnImage(){this._locationPointOnImage&&(this._imageViewer.removeGraphic(this._locationPointOnImage),this._panoramicViewer.removeGraphic(this._locationPointOnImage),this._locationPointOnImage=ie(this._locationPointOnImage))}plotReferencePoint(e){"mapPoint"in e?this.plotReferencePointOnGround(e.mapPoint):this.plotReferencePointOnGround(e)}setMessage(e,t,a,i){this.displayMessage={key:e,type:t,data:a,map:i}}async transformAndPlotSelectedLocation(e){const{currentBestFeature:t,invalidCameraHeading:a,selectedPoint:i,activeViewer:r}=this;if(this._crossSymbol&&(this._panoramicViewer.removeGraphic(this._crossSymbol),this._imageViewer.removeGraphic(this._crossSymbol),this._crossSymbol=ie(this._crossSymbol)),!i||!t||(r==null?void 0:r.state)!=="image-loaded"||a)return;let o;try{o=await this.worldToImage(i,e),L(e),await this.plotSelectedPointOnImage(o,e)}catch(n){se(n)||D.getLogger(this).error("failed to transform map point to pixel, cross symbol will not be plotted on image",{error:n,selectedPoint:i,feature:t})}}async worldToImage(e,t){const{footprintExtent:a}=this,{imageSize:i}=this.activeViewer;if(this.mode==="none"||!this.currentBestFeature||!i||!a)return;const{attributes:{location:r,elevationSource:o,cameraHeading:n,elevation:s,cameraHeight:l},elevationSample:h}=this.currentBestFeature;let m=r.clone();const d=await He(s??(r.z??0)-l,{elevationSample:h,elevationSource:o});this.currentBestFeature.elevationSample=d.elevationSample;const p=Array.isArray(e)?e:[e];let g,v=await Promise.all(p.map(y=>new Promise(w=>{if(!y.hasZ)return w(De(y,d));w(y)})));if(r.spatialReference.isGeographic&&(m=await re(m,U.WebMercator,t)),v=await Promise.all(v.map(async y=>m.spatialReference.equals(y.spatialReference)?y:await re(y,m.spatialReference,t))),L(t),this.mode==="panoramic")g=Ke(v,{imageHeight:i[1],imageWidth:i[0],cameraHeading:n,cameraLocation:m});else{const y=Ci(this.currentBestFeature.attributes,i[0],i[1]);g=$e(v,{...y,cameraLocation:m})}return Array.isArray(e)?g:g[0]}updateCurrentCoveragePolygon(e){var p,g,v;const{additionalFootprints:t,additionalCameraLocations:a,currentBestFeature:i,currentBestFeatureLocation:r,currentCoverageVisible:o,selectedPoint:n,view:s,_adapter:l,mode:h}=this,{attributes:{objectId:m},elevationSample:d}=i;if(this._initialCurrentCoverageUpdate){if((p=this._overlays)==null||p.removeAll(),this._initialCurrentCoverageUpdate=!1,this.bestFeatureCurrentFootprint=ie(this.bestFeatureCurrentFootprint),e&&!this.invalidCameraHeading&&(e.visible=o,this.bestFeatureCurrentFootprint=e),s){const y=[...t,...a,r].filter(Lo);s.supportsGround&&d&&(l!=null&&l.updateGroundElevation)&&(this._updateGroundElevation&&l.updateGroundElevation(y,d),h==="panoramic"&&l.updateGroundElevation([this.bestFeatureCurrentFootprint],d)),this._updateGroundElevation=!1,n&&(y.splice(-2,0,this.bestFeatureCurrentFootprint),y.push(new N({geometry:n.clone(),symbol:Va.clone(),attributes:{imageID:m}}))),this._overlays.graphics.addMany(y)}}else if(s){if(this.invalidCameraHeading)return;this.bestFeatureCurrentFootprint&&((g=this._overlays)==null||g.remove(this.bestFeatureCurrentFootprint),this.bestFeatureCurrentFootprint=ie(this.bestFeatureCurrentFootprint));const y=this.bestFeatureCurrentFootprint&&this._overlays?this._overlays.graphics.indexOf(this.bestFeatureCurrentFootprint):-1;e&&(this.bestFeatureCurrentFootprint=e,s!=null&&s.supportsGround&&d&&(l!=null&&l.updateGroundElevation)&&h==="panoramic"&&l.updateGroundElevation([e],d),e.visible=this.currentCoverageVisible,(v=this._overlays)==null||v.graphics.add(this.bestFeatureCurrentFootprint,y>=0?y:this._overlays.graphics.length-1))}}};c([u()],_.prototype,"activeLayer",null),c([u({readOnly:!0})],_.prototype,"activeViewer",null),c([u()],_.prototype,"accuracyParametersMissing",null),c([u()],_.prototype,"additionalFeatures",void 0),c([u({type:j.ofType(N)})],_.prototype,"additionalCameraLocations",void 0),c([u({type:j.ofType(N)})],_.prototype,"additionalFootprints",void 0),c([u()],_.prototype,"areaMeasurementResult",void 0),c([u()],_.prototype,"areaMeasurementAccuracy",void 0),c([u()],_.prototype,"bestFeatureAngle",void 0),c([u()],_.prototype,"bestFeatureCurrentFootprint",void 0),c([u({type:N})],_.prototype,"bestFeatureFootprint",void 0),c([u({type:Number})],_.prototype,"brightness",null),c([u()],_.prototype,"collectionId",void 0),c([u({type:Number})],_.prototype,"contrast",null),c([u()],_.prototype,"conversionProps",void 0),c([u()],_.prototype,"coverageFrustums",void 0),c([u()],_.prototype,"coveragePolygons",void 0),c([u()],_.prototype,"currentBestFeature",void 0),c([u()],_.prototype,"currentBestFeatureLocation",void 0),c([u()],_.prototype,"currentCoverageVisible",void 0),c([u({json:{write:!1}})],_.prototype,"determineWorkflowForFeature",void 0),c([u()],_.prototype,"disabled",void 0),c([u()],_.prototype,"displayMessage",void 0),c([u()],_.prototype,"displayNewMeasurementButton",void 0),c([u()],_.prototype,"distanceMeasurementResult",void 0),c([u()],_.prototype,"distanceAccuracyArray",void 0),c([u()],_.prototype,"dataCaptureLayer",void 0),c([u({readOnly:!0})],_.prototype,"featureCount",null),c([u()],_.prototype,"features",void 0),c([u()],_.prototype,"groundCoordinates",void 0),c([u()],_.prototype,"heightMeasurementPixels",void 0),c([u()],_.prototype,"heightGraphic",void 0),c([u()],_.prototype,"heightMeasurementResult",void 0),c([u()],_.prototype,"heightMeasurementAccuracy",void 0),c([u()],_.prototype,"measurementAngle",void 0),c([u()],_.prototype,"tempDistance",void 0),c([u({readOnly:!0})],_.prototype,"imageGalleryEnabled",null),c([u()],_.prototype,"imageGeometryField",void 0),c([u({readOnly:!0})],_.prototype,"imageLoaded",null),c([u()],_.prototype,"imageLocationToolState",void 0),c([u({readOnly:!0})],_.prototype,"invalidCameraHeading",null),c([u()],_.prototype,"imagePointsInView",null),c([u()],_.prototype,"isAdditionalCoverageVisible",void 0),c([u()],_.prototype,"isAdditionalPointSourcesVisible",void 0),c([u()],_.prototype,"layer",void 0),c([u()],_.prototype,"layerView",null),c([u({readOnly:!0})],_.prototype,"layerFloorFilterClause",null),c([u({type:Number})],_.prototype,"localPort",void 0),c([u()],_.prototype,"mapImageConversionToolState",void 0),c([u()],_.prototype,"measureType",void 0),c([u()],_.prototype,"measurementGraphic",void 0),c([u({readOnly:!0,value:"none"})],_.prototype,"mode",null),c([u()],_.prototype,"navigatorCurrentBestFeature",void 0),c([u()],_.prototype,"oiObjectIdField",void 0),c([u({type:j.ofType(N)})],_.prototype,"overlayedCameraLocations",void 0),c([u()],_.prototype,"overlayedMapFeatures",void 0),c([u()],_.prototype,"pixelCoordinates",void 0),c([u()],_.prototype,"pointSources",void 0),c([u({readOnly:!0})],_.prototype,"popupEnabled",null),c([u()],_.prototype,"previousFeatureAngle",void 0),c([u()],_.prototype,"referencePoint",null),c([u({readOnly:!0})],_.prototype,"sectorData",null),c([u()],_.prototype,"selectedPoint",void 0),c([u({type:Number})],_.prototype,"sharpness",null),c([u()],_.prototype,"shouldShowSelectedImage",void 0),c([u()],_.prototype,"sketch",void 0),c([u()],_.prototype,"draw",void 0),c([u()],_.prototype,"sketchAdapter",void 0),c([u({readOnly:!0})],_.prototype,"sketchGraphicsLayer",null),c([u({readOnly:!0})],_.prototype,"state",null),c([u({readOnly:!0})],_.prototype,"thumbnails",null),c([u()],_.prototype,"updateFootprint",void 0),c([u()],_.prototype,"updateFootprintPanorama",void 0),c([u({value:null})],_.prototype,"view",null),c([u()],_.prototype,"_adapter",void 0),c([u()],_.prototype,"_sketchGraphicsLayer",null),c([u()],_.prototype,"_highlightedFeatureHandle",void 0),c([u()],_.prototype,"_imageViewer",void 0),c([u()],_.prototype,"_initialCurrentCoverageUpdate",void 0),c([u()],_.prototype,"_locationPointOnImage",void 0),c([u()],_.prototype,"_overlays",void 0),c([u({readOnly:!0})],_.prototype,"_overlaysView",null),c([u()],_.prototype,"_panoramicViewer",void 0),c([u()],_.prototype,"_previousCursor",void 0),c([u()],_.prototype,"_referencePointOnGround",void 0),c([u()],_.prototype,"_referencePointOnImage",void 0),c([u()],_.prototype,"_sectorData",void 0),c([u({readOnly:!0})],_.prototype,"_updatingHandles",void 0),c([u()],_.prototype,"footprintExtent",void 0),c([u()],_.prototype,"_featureChangedTask",void 0),_=c([me("esri.widgets.OrientedImageryViewer.OrientedImageryViewerViewModel")],_);const or=_;let ee=class extends _r{constructor(){super(...arguments),this.additionalFootprintToggle=!0,this.additionalCameraLocationsToggle=!0,this.currentFootprintToggle=!0,this.imageEnhancement=!0,this.imageGallery=!0,this.imageOverlays=!0,this.measurementTools=!0,this.mapImageConversionTool=!0,this.menu=!0,this.navigationTool=!0,this.digitization=!0,this.title=!0,this.showPopupsAction=!0}get coverageMenu(){return Ae(D.getLogger(this),"coverageMenu",{replacement:"menu"}),this.menu}set coverageMenu(e){Ae(D.getLogger(this),"coverageMenu",{replacement:"menu"}),this.menu=e}};c([u({type:Boolean,nonNullable:!0})],ee.prototype,"additionalFootprintToggle",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"additionalCameraLocationsToggle",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"currentFootprintToggle",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"coverageMenu",null),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"imageEnhancement",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"imageGallery",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"imageOverlays",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"measurementTools",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"mapImageConversionTool",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"menu",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"navigationTool",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"digitization",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"title",void 0),c([u({type:Boolean,nonNullable:!0})],ee.prototype,"showPopupsAction",void 0),ee=c([me("esri.widgets.OrientedImageryViewer.OrientedImageryViewerVisibleElements")],ee);const nr=ee;let Ee=class extends ft{constructor(e){super(e),this.messages=null}loadDependencies(){return Ja({action:()=>z(()=>import("./index-DVEy4f7w.js"),__vite__mapDeps([444,445,193,1,55,14,12,5,6,2,10,9,11,128,446,447,448,449,450,451,452,453,454,455,456]),import.meta.url),block:()=>z(()=>import("./index-ujykA9Eq.js"),__vite__mapDeps([457,445,193,1,55,14,12,5,6,2,10,9,11,128,446,447,458,453,452,450,449,448,459,460,461,454,462,455,463,464,444,451,456,465,466,467,468,469,470,471,472,473,474,475]),import.meta.url),panel:()=>z(()=>import("./index-DSiQ4rVy.js").then(e=>e.i),__vite__mapDeps([476,445,193,1,55,14,12,5,6,2,10,9,11,128,446,447,448,449,450,444,451,452,453,454,455,456,469,460,461,463,470,471,472,473,462,474,475,458]),import.meta.url)})}get _renderLocation(){const{groundCoordinates:e}=this;return e?M("calcite-block",{heading:this.getLocation(),headingLevel:6},M("calcite-action",{icon:"copy-to-clipboard",onclick:()=>this.copyLocation(),slot:"control",text:"Copy"})):null}copyLocation(){const{groundCoordinates:e}=this;if(!e)return;const t=this.getLocation();t&&Us(t)}getLocation(){const{groundCoordinates:e}=this;if((e==null?void 0:e.longitude)==null||(e==null?void 0:e.latitude)==null)return"";const t={groundX:e.longitude.toFixed(3),groundY:e.latitude.toFixed(3)};return mi("{groundX} , {groundY}",t)}render(){return M("calcite-panel",{class:$.measurementResults,key:"ground-location-container"},this._renderLocation)}};c([u()],Ee.prototype,"messages",void 0),c([u()],Ee.prototype,"groundCoordinates",void 0),c([u()],Ee.prototype,"_renderLocation",null),Ee=c([me("esri.widgets.OrientedImageryViewer.components.ImageLocationWidget")],Ee);const Ks=Ee,nt={overlayMapFeatures:"overlay-map-features",overlayed:"overlayed",overlaysActionHandles:"overlays-action-handles"};let P=class extends ft{constructor(e,t){super(e,t),this.dataCaptureEnabled=!1,this.galleryOpened=!1,this.imageEnhancementToolActive=!1,this.imageOverlaysOpened=!1,this.navigationToolActive=!1,this.viewModel=new or,this.messagesCommon=null,this.messagesSketch=null,this.pixelMeasurementUnit="meters",this.pixelAreaMeasurementUnit="square-meters",this.showCameraLocations=!1,this.showMapFeatures=!1,this.visibleElements=new nr,this._actionItems=new Ba,this._imageOverlaysLoaderTask=null,this._imageMeasurementToolsLoaderTask=null,this._clearMeasurements=()=>{this.viewModel.measureType=null,this.viewModel.clearPreviousMeasurements()},this._clearImageLocation=()=>{this.imageLocationToolActive=!1},this._navigationToolExpanded=!1,this._navigationTool=null,this._warningTitleElement=null,this._galleryController=new AbortController,this._galleryObserver=new IntersectionObserver(this._lazyLoadImage.bind(this)),this._overlayedLayers=new j,this._previousAction=null,this._handleDataCaptureLayerChange=async a=>{if(this.dataCaptureLayer&&await this.stopDataCapture(!0),this.dataCaptureLayer=this.dataCaptureLayer===a?null:a,this.dataCaptureLayer)return this.startDataCapture(this.dataCaptureLayer)},this._handleOverlayLayerDeselect=a=>{const i=a.layer;i===this.dataCaptureLayer&&(this.stopDataCapture(),this.dataCaptureLayer=null),this.removeOverlayedGraphicsOnImage(`${i.id}`)},this._handleOverlayLayerSelect=a=>{const i=a.layer;this.viewModel.overlayMapFeatures(i,this.showMapFeatures),this.addHandles(O(()=>i.visible,()=>{this.viewModel.toggleOverlayMapFeatures(i.id,i.visible)}),`${nt.overlayed}-${i.id}`)},this._highlight=a=>{var r;const i=(r=a.target)==null?void 0:r.dataset.objectid;i&&this.viewModel.highlight(i)},this._onAction=a=>{const{target:i}=a,{dataset:{action:r}}=i,{_previousAction:o}=this,n=o==null?void 0:o.dataset.action,s=(n==null?void 0:n.includes("draw"))??!1,l=n==="select-feature",h=n!==r;switch(r){case"draw-point":case"draw-polygon":case"draw-polyline":{o&&Me(l,s&&h)&&(o.active=!1),i.active=!i.active;const m=r.replace("draw-","");this.viewModel.digitizeCreate(m),this._previousAction=i.active?i:null;break}case"save":this.viewModel.saveDrawing();break;case"select-feature":s&&(this._previousAction.active=!1),i.active=!i.active,this.viewModel.toggleSelection(i.active),this._previousAction=i.active?i:null;break;case"delete-feature":this.viewModel.digitizeDelete()}},this._onImageOverlayClosed=()=>{this.imageOverlaysOpened=!1},this._onShowCameraLocationsChanged=a=>{this.showCameraLocations=a},this._onShowMapFeaturesChanged=a=>{this.showMapFeatures=a},this._removeActionElement=a=>{this._actionItems.delete(a.text)},this._removeHighlight=()=>this.viewModel.removeHighlight(),this._restoreOverlays=async()=>Promise.all(this._overlayedLayers.map(a=>this.viewModel.overlayMapFeatures(a,this.showMapFeatures))),this._scaleNavigationTool=()=>{this._navigationToolExpanded=!this._navigationToolExpanded},this._sketchLoaderTask=null,this._toggleImageAttributes=()=>{this.viewModel.toggleImageAttributes()},this._loadImageFromGallery=this._loadImageFromGallery.bind(this),this._registerGalleryItem=this._registerGalleryItem.bind(this),this._unregisterGalleryItem=this._unregisterGalleryItem.bind(this),this.loadImageFromSource=this.loadImageFromSource.bind(this),this.updateSuitabilities=this.updateSuitabilities.bind(this)}initialize(){this.addHandles([O(()=>{var e;return[(e=this.viewModel)==null?void 0:e.bestFeatureAngle,this._navigationTool]},([e,t])=>{t&&this._updateNavigationTool(t)},Ze),O(()=>this.currentCoverageVisible,e=>this._onCurrentCoverageVisibilityChange(e)),O(()=>this.isAdditionalCoverageVisible,e=>this._onAdditionalCoverageVisibilityChange(e)),O(()=>this.isAdditionalPointSourcesVisible,e=>this._onAdditionalCameraLocationsVisibility(e)),O(()=>({features:this.currentBestFeature,showCameraLocations:this.showCameraLocations,state:this.viewModel.state}),({showCameraLocations:e,state:t})=>{t==="image-loaded"&&this.viewModel.overlayCameraLocations(e)},Z),O(()=>({feature:this.currentBestFeature,showMapFeatures:this.showMapFeatures,state:this.viewModel.state}),async(e,t)=>{var a;if(e.showMapFeatures!==(t==null?void 0:t.showMapFeatures)&&this.viewModel.toggleAllOverlayMapFeatures(e.showMapFeatures),e.feature!=null&&e.feature!==(t==null?void 0:t.feature)){if(this.viewModel.removeAllOverlayMapFeatures(),await Ir(()=>this.viewModel.state==="image-loaded"),this.dataCaptureLayer&&this.stopDataCapture(),await this._restoreOverlays(),!this.dataCaptureLayer)return;await this.startDataCapture(this.dataCaptureLayer),(a=this._previousAction)!=null&&a.active&&(this._previousAction.active=!1,this._previousAction=null)}},Ze)])}loadDependencies(){return Ja({"action-bar":()=>z(()=>import("./index-TFxiSNpz.js"),__vite__mapDeps([477,445,193,1,55,14,12,5,6,2,10,9,11,128,446,447,448,449,450,444,451,452,453,454,455,456,469,460,461,463,470,471,472,473,462,474,475,478,479]),import.meta.url),"action-group":()=>z(()=>import("./index-BSRDeu3E.js").then(e=>e.i),__vite__mapDeps([478,445,193,1,55,14,12,5,6,2,10,9,11,128,446,447,448,449,450,444,451,452,453,454,455,456,469,460,461,463,470,471,472,473,462,474,475]),import.meta.url),action:()=>z(()=>import("./index-DVEy4f7w.js"),__vite__mapDeps([444,445,193,1,55,14,12,5,6,2,10,9,11,128,446,447,448,449,450,451,452,453,454,455,456]),import.meta.url),label:()=>z(()=>import("./index-D130RxMY.js"),__vite__mapDeps([480,193,1,55,14,12,5,6,2,10,9,11,128,481,449,446]),import.meta.url),notice:()=>z(()=>import("./index-nrWOrFCt.js"),__vite__mapDeps([482,448,193,1,55,14,12,5,6,2,10,9,11,128,449,446,450,453,452,455,483,463,456,447]),import.meta.url),panel:()=>z(()=>import("./index-DSiQ4rVy.js").then(e=>e.i),__vite__mapDeps([476,445,193,1,55,14,12,5,6,2,10,9,11,128,446,447,448,449,450,444,451,452,453,454,455,456,469,460,461,463,470,471,472,473,462,474,475,458]),import.meta.url),shell:()=>z(()=>import("./index-DTpFWV8n.js"),__vite__mapDeps([484,193,1,55,14,12,5,6,2,10,9,11,128,451,452,449,446]),import.meta.url),dialog:()=>z(()=>import("./index-ZJpJxb4p.js"),__vite__mapDeps([485,445,193,1,55,14,12,5,6,2,10,9,11,128,446,447,458,453,452,450,449,448,444,451,454,455,456,469,460,461,463,470,471,472,473,462,474,475,476,486,487,464]),import.meta.url),dropdown:()=>z(()=>import("./index-Df8-0rWt.js"),__vite__mapDeps([459,193,1,55,14,12,5,6,2,10,9,11,128,453,452,449,446,460,461,454,462,455,450,463,464]),import.meta.url),"dropdown-group":()=>z(()=>import("./index-BfAp5_ga.js"),__vite__mapDeps([467,193,1,55,14,12,5,6,2,10,9,11,128,450,466]),import.meta.url),"dropdown-item":()=>z(()=>import("./index-DIB7yhJF.js"),__vite__mapDeps([465,448,193,1,55,14,12,5,6,2,10,9,11,128,449,446,450,453,452,455,456,454,466]),import.meta.url),slider:()=>z(()=>import("./index-DsrvUplP.js"),__vite__mapDeps([488,448,193,1,55,14,12,5,6,2,10,9,11,128,449,446,450,489,453,452,451,490,491,454,462,481,455,492,493,447]),import.meta.url),tooltip:()=>z(()=>import("./index-DqW6JA5s.js"),__vite__mapDeps([494,193,1,55,14,12,5,6,2,10,9,11,128,453,452,460,449,446,461,463,471,451]),import.meta.url)})}destroy(){this._galleryController.abort(),this._galleryObserver.disconnect()}get accuracyParametersMissing(){return this.viewModel.accuracyParametersMissing}get activeLayer(){return Ae(D.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer}set activeLayer(e){Ae(D.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer=e}get currentBestFeature(){return this.viewModel.currentBestFeature}set currentBestFeature(e){this.viewModel.currentBestFeature=e}get currentCoverageVisible(){return this.viewModel.currentCoverageVisible}set currentCoverageVisible(e){this.viewModel.currentCoverageVisible=e}get dataCaptureLayer(){return this.viewModel.dataCaptureLayer}set dataCaptureLayer(e){this.viewModel.dataCaptureLayer=e}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get displayMessage(){return this.viewModel.displayMessage}get features(){return this.viewModel.features}get imagePointsInView(){return this.viewModel.imagePointsInView}get icon(){return"oriented-imagery-widget"}set icon(e){this._overrideIfSome("icon",e)}get imageGalleryEnabled(){return this.viewModel.imageGalleryEnabled}get imageLocationToolActive(){return this.viewModel.imageLocationToolState}set imageLocationToolActive(e){this.viewModel.imageLocationToolState=e}get invalidCameraHeading(){return this.viewModel.invalidCameraHeading}get isAdditionalCoverageVisible(){return this.viewModel.isAdditionalCoverageVisible}set isAdditionalCoverageVisible(e){this.viewModel.isAdditionalCoverageVisible=e}get isAdditionalPointSourcesVisible(){return this.viewModel.isAdditionalPointSourcesVisible}set isAdditionalPointSourcesVisible(e){this.viewModel.isAdditionalPointSourcesVisible=e}get mapImageConversionToolState(){return this.viewModel.mapImageConversionToolState}set mapImageConversionToolState(e){this.viewModel.mapImageConversionToolState=e}get measureType(){return this.viewModel.measureType}set measureType(e){this.viewModel.measureType=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get popupEnabled(){const{popupEnabled:e,state:t}=this.viewModel;return t==="image-loaded"&&e}get referencePoint(){return this.viewModel.referencePoint??null}get sketchViewModel(){return this.viewModel.sketch}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set determineWorkflowForFeature(e){this.viewModel.determineWorkflowForFeature=e}get determineWorkflowForFeature(){return this.viewModel.determineWorkflowForFeature}set updateFootprint(e){this.viewModel.updateFootprint=e}get updateFootprint(){return this.viewModel.updateFootprint}_renderActionBar(){return M("calcite-action-bar",{expandDisabled:!0,layout:"horizontal",slot:"action-bar"},M("calcite-action-group",null,this._currentFootprintToggle(),this._additionalFootprintToggle(),this._additionalPointSourcesToggle()),M("calcite-action-group",null,this._mapImageConversionToggle(),this._navigationToolToggle(),this._imageEnhancementsToggle()),M("calcite-action-group",null,this._measurementToolsToggle(),this._imageGalleryToggle(),this._imageOverlaysToggle(),this._openPopupAction()),this._actionTooltips())}_actionTooltips(){return[...this._actionItems].map(([e,t])=>M("calcite-tooltip",{closeOnClick:!0,key:e,placement:"bottom",referenceElement:t},M("span",null,e)))}get _activeMeasurementIcon(){const{measureType:e,imageLocationToolActive:t}=this;if(t)return"pin-tear";switch(e){case"area":return"measure-area";case"height":return"measure-building-height-top-base";default:return"measure-line"}}get _activeMeasurementHeading(){const{measureType:e,messages:t}=this,{groundArea:a,heightAboveGround:i,groundDistance:r}=t;switch(e){case"area":return a;case"height":return i;default:return r}}_additionalFootprintToggle(){const{isAdditionalCoverageVisible:e,invalidCameraHeading:t,visibleElements:{additionalFootprintToggle:a}}=this;return a?M("calcite-action",{active:e,...this._commonActionProperties,class:$.addCoverage,disabled:t,icon:"trapezoid-area",onclick:this._toggleAdditionalCoverage,text:this.messages.additionalFootprints}):null}_additionalPointSourcesToggle(){const{isAdditionalPointSourcesVisible:e,invalidCameraHeading:t,visibleElements:{additionalCameraLocationsToggle:a}}=this;return a?M("calcite-action",{active:e,...this._commonActionProperties,class:$.addExpPoints,disabled:t,icon:"circle-area",onclick:this._toggleAdditionalCameraLocations,text:this.messages.additionalCameraLocations}):null}get _measurementToggle(){var r;const{viewModel:{state:e,measureType:t},id:a}=this;if(e!=="image-loaded"||!t)return;this._imageMeasurementToolsLoaderTask||this._loadImageMeasurementResources();const i=(r=this._imageMeasurementToolsLoaderTask)==null?void 0:r.value;return i?M("calcite-dialog",{bind:this,dragEnabled:!0,escapeDisabled:!0,heading:this._activeMeasurementHeading,id:`${a}-${t}-measurement`,open:!0,placement:"bottom-start",resizable:!0,scale:"s",slot:"dialogs",width:"s",onCalciteDialogBeforeClose:this._clearMeasurements},M(i,{measurementType:t,measurementUnitMessages:this.measurementUnitMessages,messages:this.messages,oiViewModel:this.viewModel})):null}get _commonActionProperties(){return{afterCreate:this._storeActionElement,afterRemoved:this._removeActionElement,afterUpdate:this._storeActionElement,bind:this}}_renderRoot(){const{viewModel:{state:e}}=this;return M("calcite-panel",null,M("calcite-shell",null,M("calcite-panel",{bind:this,class:$.viewerContainer,heading:this.visibleElements.title?this.messages.title:void 0,loading:e.includes("loading")},this.visibleElements.menu?this._renderActionBar():null,this._imageViewer,this._panoramicViewer,this._messageBox,this.invalidCameraHeading?[this._renderWarning(this.messages.invalidCameraHeadingWarningTitle),this._renderWarningTooltip(this.messages.invalidCameraHeadingWarningDescription)]:[this._imageGalleryPanel,this._renderNavigation,this._imageOverlaysPanel()],this._imageEnhancementTools,this._renderSketch()),this._measurementToggle,this._locationToggle))}_currentFootprintToggle(){const{currentCoverageVisible:e,invalidCameraHeading:t}=this,{currentFootprintToggle:a}=this.visibleElements;return a?M("calcite-action",{active:e,...this._commonActionProperties,class:$.currentCoverage,disabled:t,icon:"trapezoid-area",onclick:this._toggleCurrentCoverage,text:this.messages.currentFootprint}):null}get _imageEnhancementTools(){const{imageEnhancementToolActive:e,viewModel:{brightness:t,contrast:a,sharpness:i,state:r}}=this;return e&&r==="image-loaded"?M("calcite-panel",{bind:this,class:$.imageEnhancementWrapper,closable:!0,closed:!e,heading:this.messages.imageEnhancement,key:this.messages.imageEnhancement,onCalcitePanelClose:this._toggleImageEnhancementToolState},M("div",{class:$.imageEnhancementTools},M("div",{class:$.imageEnhancementToolContainer},M("calcite-label",null,this.messages.brightness,M("calcite-slider",{bind:this,labelTicks:!0,max:10,min:-10,ticks:5,value:t,onCalciteSliderInput:this._handleBrightnessChange}))),M("div",{class:$.imageEnhancementToolContainer},M("calcite-label",null,this.messages.contrast,M("calcite-slider",{bind:this,labelTicks:!0,max:10,min:-10,ticks:5,value:a,onCalciteSliderInput:this._handleContrastChange}))),M("div",{class:$.imageEnhancementToolContainer},M("calcite-label",null,this.messages.sharpness,M("calcite-slider",{bind:this,labelTicks:!0,max:1,min:0,step:.1,ticks:.5,value:i,onCalciteSliderInput:this._handleSharpnessChange})))),M("calcite-action",{bind:this,icon:"reset",onclick:this._resetImageTools,slot:"header-actions-end",text:this.messagesCommon.reset})):null}_imageEnhancementsToggle(){const{state:e,mode:t}=this.viewModel,{imageEnhancement:a}=this.visibleElements;return a?M("calcite-action",{active:this.imageEnhancementToolActive,...this._commonActionProperties,disabled:t!=="default"||e!=="image-loaded",icon:"sliders-horizontal",onclick:this._toggleImageEnhancementToolState,text:this.messages.imageEnhancement}):null}get _imageGalleryPanel(){const{container:e,galleryOpened:t,imageGalleryEnabled:a}=this;return a&&t&&e?this._imageGalleryContext:null}get _imageGalleryContext(){const{galleryOpened:e,invalidCameraHeading:t}=this;return M("calcite-panel",{bind:this,class:$.carousel,closable:!0,closed:!e,disabled:t,heading:this.messages.imageGallery,key:this.messages.imageGallery,onCalcitePanelClose:this._toggleImageGallery},M("div",{class:$.carouselContainer},this._renderThumbnails))}_imageGalleryToggle(){const{imageGalleryEnabled:e,invalidCameraHeading:t,visibleElements:{imageGallery:a}}=this;return a?M("calcite-action",{active:this.galleryOpened,...this._commonActionProperties,disabled:!e||t,icon:"images",onclick:this._toggleImageGallery,text:this.messages.imageGallery}):null}get _imageOverlaysComponent(){var g,v,y;const{_imageOverlayMessages:e,_imageOverlaysLoaderTask:t,_overlayedLayers:a,dataCaptureEnabled:i,dataCaptureLayer:r,imageOverlaysOpened:o,showCameraLocations:n,showMapFeatures:s,view:l,layer:h}=this;if(!h)return null;const m=(g=h.imageGeometryField)!=null&&g.length?h.imageGeometryField:ra,d=(v=h.imageReferenceField)!=null&&v.length?h.imageReferenceField:oa;t||(this._imageOverlaysLoaderTask=ye(async()=>(await z(async()=>{const{default:w}=await import("./ImageOverlays-CQOAXfUX.js");return{default:w}},__vite__mapDeps([495,5,6,1,9,10,11,21,277,278,67,12,2,20,193,55,14,128,496,94,497,498,432,499,500,501,502,503,290,504,420,122,123,7,8,3,13,15,16,17,18,19,22,23,24,25,26,27,28,29,30,31,32,38,124,125,58,59,126,46,47,48,49,50,112,127,129,130,131,34,35,132,61,62,63,64,65,66,68,69,71,72,70,73,0,133,134,135,136,137,138,33,53,54,139,140,98,99,100,102,141,36,37,39,40,41,42,43,44,142,143,144,145,146,147,148,149,150,151,152,153,154,60,89,90,155,156,86,87,88,157,158,77,78,159,103,160,161,104,105,106,108,109,110,111,162,163,164,165,166,167,168,118,119,169,170,171,172,173,174,175,176,91,92,177,115,116,117,178,179,180,51,52,56,57,74,75,76,79,80,81,82,83,84,85,181,113,107,182,183,184,185,186,187,188,189,4,45,93,95,96,97,101,114,190,191,192,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,279,280,281,282,283,284,285,286,287,288,289,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,421,422,423,424,425,426,427,428,429,430,431,433,434,435]),import.meta.url)).default));const p=(y=this._imageOverlaysLoaderTask)==null?void 0:y.value;return p?M(p,{closed:!o,dataCaptureEnabled:i,dataCaptureLayer:r,imageGeometryField:m,imageReferenceField:d,messages:e,overlayedLayers:a,showCameraLocations:n,showMapFeatures:s,view:l,onDataCaptureLayerChanged:this._handleDataCaptureLayerChange,onImageOverlaysClosed:this._onImageOverlayClosed,onLayerDeselected:this._handleOverlayLayerDeselect,onLayerSelected:this._handleOverlayLayerSelect,onShowCameraLocationsChanged:this._onShowCameraLocationsChanged,onShowMapFeaturesChanged:this._onShowMapFeaturesChanged}):null}get _imageOverlayMessages(){return{...this.messages,...this.messagesSketch}}get _imageSketchToolsMessages(){return{...this.messagesSketch,...this.messagesCommon}}_imageOverlaysPanel(){const{imageOverlaysOpened:e,viewModel:{state:t}}=this,a=this.classes({[$.imageOverlaysContainer]:!0,[ct.hidden]:!e||t!=="image-loaded"});return M("div",{class:a,key:this.messages.imageOverlays},this._imageOverlaysComponent)}_imageOverlaysToggle(){const{viewModel:{state:e},imageOverlaysOpened:t,invalidCameraHeading:a,visibleElements:{imageOverlays:i}}=this;return i?M("calcite-action",{active:t,...this._commonActionProperties,disabled:e!=="image-loaded"||a,icon:"layers",onclick:this._toggleImageOverlays,text:this.messages.imageOverlays}):null}get _imageViewer(){const{displayMessage:e,loadImageViewer:t,mode:a}=this.viewModel,i=e!=null||a!=="default",r=this.classes({[$.viewer]:!i,[$.viewerHidden]:i});return M("calcite-panel",{afterCreate:t,bind:this,class:r},this._renderSketch())}get _locationToggle(){const{viewModel:{state:e,groundCoordinates:t},imageLocationToolActive:a,messages:{groundLocation:i}}=this;if(e==="image-loaded"&&t&&a)return M("calcite-dialog",{bind:this,dragEnabled:!0,escapeDisabled:!0,heading:i,id:i,open:!0,placement:"bottom-start",resizable:!0,scale:"s",slot:"dialogs",width:"s",onCalciteDialogBeforeClose:this._clearImageLocation},M(Ks,{groundCoordinates:t,messages:this.messages}))}_mapImageConversionToggle(){const{mapImageConversionToolState:e,viewModel:{state:t},invalidCameraHeading:a,visibleElements:{mapImageConversionTool:i}}=this;return i?M("calcite-action",{active:e,...this._commonActionProperties,disabled:t!=="image-loaded"||a,icon:"image-pin",onclick:this._toggleMapImageConversionToolState,text:this.messages.mapImageConversionTool}):null}_measurementToolsToggle(){const{_activeMeasurementIcon:e,measureType:t,viewModel:a,accuracyParametersMissing:i,messages:r,visibleElements:{measurementTools:o}}=this,{state:n}=a,{measurementTools:s,groundDistance:l,groundArea:h,heightAboveGround:m,groundLocation:d}=r;return o?M("calcite-dropdown",{disabled:i,key:"measurement-tools",width:"m"},M("calcite-action",{...this._commonActionProperties,icon:e,slot:"trigger",text:s}),M("calcite-dropdown-group",null,M("calcite-dropdown-item",{bind:this,disabled:n!=="image-loaded",iconStart:"measure-line",key:"distance-measurement",onclick:p=>this._toggleMeasurementSketch(p,"distance"),selected:t==="distance"},l),M("calcite-dropdown-item",{bind:this,disabled:n!=="image-loaded",iconStart:"measure-area",key:"area-measurement",onclick:p=>this._toggleMeasurementSketch(p,"area"),selected:t==="area"},h),M("calcite-dropdown-item",{bind:this,disabled:n!=="image-loaded",iconStart:"measure-building-height-top-base",key:"height-dropdown",onclick:p=>this._toggleMeasurementSketch(p,"height"),selected:t==="height"},m),M("calcite-dropdown-item",{bind:this,disabled:n!=="image-loaded",iconStart:"pin-tear",key:"surface-location",onclick:p=>this._toggleLocationTool(p),selected:this.imageLocationToolActive},d))):null}get _messageBox(){const{messages:e,viewModel:{displayMessage:t}}=this;if(!t)return null;const{data:a,key:i,map:r}=t,o=`${r?mi(e[i],r):e[i]}`;return M("span",{class:$.messageBox},a?`${o} ${a}`:o)}_navigationToolToggle(){const{state:e}=this.viewModel,{visibleElements:{navigationTool:t}}=this;return t?M("calcite-action",{active:this.navigationToolActive,...this._commonActionProperties,disabled:e!=="image-loaded"||this.invalidCameraHeading,icon:"explore",onclick:this._toggleNavigationTool,text:this.messages.navigationTool}):null}_openPopupAction(){const{showPopupsAction:e}=this.visibleElements;return e?M("calcite-action",{...this._commonActionProperties,disabled:!this.popupEnabled,icon:"popup",onclick:this._toggleImageAttributes,text:this.messages.showPopups}):null}get _panoramicViewer(){const{displayMessage:e,loadPanoramicViewer:t,mode:a}=this.viewModel,i=e!=null||a!=="panoramic",r=this.classes({[$.viewer]:!i,[$.viewerHidden]:i});return M("calcite-panel",{afterCreate:t,bind:this,class:r})}_closeAllImageTools(){this.imageEnhancementToolActive=!1,this.navigationToolActive=!1,this.imageOverlaysOpened=!1,this.galleryOpened=!1,this.measureType=null,this.imageLocationToolActive=!1}_handleBrightnessChange(e){this.viewModel.brightness=e.currentTarget.value??0}_handleContrastChange(e){this.viewModel.contrast=e.currentTarget.value??0}_handleSharpnessChange(e){this.viewModel.sharpness=e.currentTarget.value??0}_lazyLoadImage(e,t){e.forEach(async a=>{if(a.isIntersecting){const i=a.target,r=i.getAttribute("data-src"),o=i.getAttribute("data-rotation"),n=i.getAttribute("data-objectid"),s=o?parseFloat(o)%360:0,{layer:l,_galleryController:{signal:h}}=this;if(!r||!n)return;let m;try{m=st(r)?await Pn(l,n,{signal:h}):await xi(r,{signal:h})}catch(d){se(d)||D.getLogger("esri.widgets.OrientedImageryViewer").error("#lazyLoadImage()",d)}finally{t.unobserve(i)}if(!m)return;xn(m,i,s)}})}_loadImageFromGallery(e){var i;const{target:t}=e;if(!t)return;const a=t.getAttribute("data-objectid");a&&((i=this.viewModel.currentBestFeature)==null?void 0:i.attributes.objectId)!==Number(a)&&this.viewModel.selectBestFeature(a)}_loadImageMeasurementResources(){this._imageMeasurementToolsLoaderTask=ye(async()=>{const{default:e}=await z(()=>import("./ImageMeasurementWidget-BzbZH9kW.js"),__vite__mapDeps([505,5,6,1,15,12,2,3,193,55,14,10,9,11,128,432,506,122,123,7,8,13,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,38,124,125,58,59,126,46,47,48,49,50,112,127,129,130,131,34,35,67,132,61,62,63,64,65,66,68,69,71,72,70,73,0,133,134,135,136,137,138,33,53,54,139,140,98,99,100,102,141,36,37,39,40,41,42,43,44,142,143,144,145,146,147,148,149,150,151,152,153,154,60,89,90,155,156,86,87,88,157,158,77,78,159,103,160,161,104,105,106,108,109,110,111,162,163,164,165,166,167,168,118,119,169,94,170,171,172,173,174,175,176,91,92,177,115,116,117,178,179,180,51,52,56,57,74,75,76,79,80,81,82,83,84,85,181,113,107,182,183,184,185,186,187,188,189,4,45,93,95,96,97,101,114,190,191,192,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,433,434,435]),import.meta.url);return e})}_loadSketchResources(){this._sketchLoaderTask=ye(async()=>(await z(async()=>{const{default:e}=await import("./SketchTools-fZ2BDHP3.js");return{default:e}},__vite__mapDeps([507,5,6,1,193,55,14,12,2,10,9,11,128]),import.meta.url)).default)}_onAdditionalCoverageVisibilityChange(e){this.viewModel.setAdditionalCoverageVisibility(e)}_onAdditionalCameraLocationsVisibility(e){this.viewModel.setAdditionalCameraLocationsVisibility(e)}_onCurrentCoverageVisibilityChange(e){this.viewModel.setCurrentCoverageVisibility(e)}_registerGalleryItem(e){this._galleryObserver.observe(e)}_renderWarning(e){const{invalidCameraHeading:t,viewModel:{state:a}}=this;return t&&a==="image-loaded"?[M("calcite-notice",{class:$.alert,closable:!0,icon:"exclamation-mark-triangle-f",iconFlipRtl:!0,kind:"warning",open:!0,scale:"s"},M("div",{afterCreate:i=>this._storeWarningTitleElement(i),slot:"title"},e))]:null}_renderWarningTooltip(e){const{_warningTitleElement:t}=this;if(e!=null&&e.length&&t)return M("calcite-tooltip",{closeOnClick:!0,referenceElement:t},e)}get _renderNavigation(){const{viewModel:{sectorData:e,navigatorCurrentBestFeature:t,currentBestFeature:a,state:i}}=this;if(!this.container||!a)return null;let r,o,n,s,l;if(t){const{x:w,y:f,direction:b}=t,[C,F,I,S]=$t[b];r=`M ${w} ${f} L ${C} ${F} A ${k[2]} ${k[2]} 0 0 1 ${I} ${S} Z`,o=w,s=f,n=$t[b][4],l=$t[b][5]}const h=w=>{var b;const f=(b=w.target.dataset)==null?void 0:b.sector;f&&this.viewModel.handleSectorClick(+f)},m=w=>{const f=w.target.dataset;if(!f)return;const{featureIndexInSector:b,sector:C}=f;b&&C&&this.viewModel.handleFeatureClick({sector:C,featureIndexInSector:+b})},d=w=>{w.removeEventListener("click",m)},p=a.attributes.objectId,g=e==null?void 0:e.map(w=>w==null?void 0:w.items).filter(Boolean).flatMap(w=>w==null?void 0:w.map(({x:f,y:b,objectID:C,featureIndexInSector:F,sector:I})=>M("circle",{afterRemoved:d,class:this.classes($.feature,{selected:p===C}),cx:f,cy:b,"data-feature-index-in-sector":F,"data-sector":I,key:`${$.feature}-${C}`,onclick:m,r:Ro}))),v=w=>{w.removeEventListener("click",h)},y=this.classes({[$.navigationWrapper]:!0,[$.navigationZoomed]:this._navigationToolExpanded});return this.navigationToolActive&&i==="image-loaded"?M("div",{bind:this,class:y,key:this.messages.navigationTool},M("svg",{afterCreate:w=>this._storeNavigationToolReference(w),class:br()?ae:$.rotateWithAnimation,focusable:"false",height:Ia,role:"img",width:Ia,xmlns:"http://www.w3.org/2000/svg"},M("defs",null,M("linearGradient",{gradientUnits:"userSpaceOnUse",id:`${this.id}-coverage-fill`,x1:o,x2:n,y1:s,y2:l},M("stop",{class:$.navigationPathOffset0,offset:0}),M("stop",{class:$.navigationPathOffset1,offset:1}))),M("g",null,M("circle",{class:this.classes($.sector,$.outerSector),cx:k[3],cy:k[3],onclick:this._scaleNavigationTool,r:k[3]}),M("circle",{class:$.sector,cx:k[3],cy:k[3],r:k[2]}),M("circle",{class:$.sector,cx:k[3],cy:k[3],r:k[1]}),M("circle",{class:$.sector,cx:k[3],cy:k[3],r:k[0]}),M("path",{class:$.pointer,d:"M 56.5 6.06217782649107 L 60 0 L 63.5 6.06217782649107 Z",key:`${$.pointer}-west`}),M("path",{class:this.classes($.pointer,$.north),d:"M 113.93782217350893 56.5 L 120 60 L 113.93782217350893 63.5 Z",key:`${$.pointer}-north`}),M("path",{class:$.pointer,d:"M 56.5 113.93782217350893 L 60 120 L 63.5 113.93782217350893 Z",key:`${$.pointer}-east`}),M("path",{class:$.pointer,d:"M 6.06217782649107 56.5 L 0 60 L 6.06217782649107 63.5 Z",key:`${$.pointer}-south`}),M("path",{class:this.classes($.sector,$.sectorSeparator),d:"M 23.937554159486076 23.937554159486076 L 96.06244584051393 96.06244584051393 M 23.937554159486076 96.06244584051393 L 96.06244584051393 23.937554159486076",key:$.sectorSeparator}),_n([k[2],k[1],k[0]],k[3],k[3]).map((w,f)=>{var b;return M("path",{afterRemoved:v,class:this.classes($.sector,(b=e==null?void 0:e[f])!=null&&b.length?$.sectorEnabled:$.sectorDisabled),d:w,"data-sector":`${f}`,key:`${$.sector}-${f}`,onclick:h})}),M("path",{class:this.classes($.sector,$.sectorCross),d:"M 56.4 56.4 L 63.53 63.53 M 63.53 56.4 L 56.4 63.53",key:$.sectorCross}),g,a.attributes.cameraPitch>=5&&r?M("path",{class:$.selectedFeaturePath,d:r,fill:`url(#${this.id}-coverage-fill)`,key:$.selectedFeaturePath}):null))):null}_renderSketch(){var o;const{dataCaptureLayer:e,imageOverlaysOpened:t}=this;if(!e||t||(this._sketchLoaderTask||this._loadSketchResources(),!((o=this._sketchLoaderTask)!=null&&o.value)))return null;const{geometryType:a}=e,i=a==="point"?"pin":a==="polyline"?"line":"polygon",r=this._sketchLoaderTask.value;return M("div",{class:$.sketchTools},M(r,{icon:i,messages:this._imageSketchToolsMessages,type:a,onAction:this._onAction}))}get _renderThumbnails(){const{currentBestFeature:e,thumbnails:t}=this.viewModel;return e?M("div",{class:$.carouselContent},t==null?void 0:t.items.map(({url:a,objectId:i,rotation:r},o)=>M("div",{class:`${$.carouselItemWrapper}${e.attributes.objectId===i?"--selected":""}`,key:`${$.carouselItemWrapper}-${o}`},M("canvas",{afterCreate:this._registerGalleryItem,afterRemoved:this._unregisterGalleryItem,alt:`thumbnail-${i}`,class:$.carouselItem,"data-objectid":`${i}`,"data-rotation":`${r}`,"data-src":a,onclick:this._loadImageFromGallery,onmouseenter:this._highlight,onmouseleave:this._removeHighlight})))):null}_resetImageTools(){this.viewModel.sharpness=this.viewModel.brightness=this.viewModel.contrast=0}_storeActionElement(e){this._actionItems.set(e.text,e)}_storeNavigationToolReference(e){this._navigationTool=e}_storeWarningTitleElement(e){this._warningTitleElement=e}_toggleAdditionalCameraLocations(){this.isAdditionalPointSourcesVisible=!this.isAdditionalPointSourcesVisible}_toggleAdditionalCoverage(){this.isAdditionalCoverageVisible=!this.isAdditionalCoverageVisible}_toggleCurrentCoverage(){this.currentCoverageVisible=!this.currentCoverageVisible}_toggleImageEnhancementToolState(e){e.stopPropagation();const t=this.imageEnhancementToolActive;this._closeAllImageTools(),this.imageEnhancementToolActive=!t}_toggleImageOverlays(e){e.stopPropagation();const t=this.imageOverlaysOpened;this._closeAllImageTools(),this.imageOverlaysOpened=!t}_toggleImageGallery(e){e.stopPropagation();const t=this.galleryOpened;this._closeAllImageTools(),this.galleryOpened=!!this.imageGalleryEnabled&&!t}_toggleLocationTool(e){const t=this.imageLocationToolActive;this._closeAllImageTools(),this.imageLocationToolActive=!t,e.stopPropagation()}_toggleMeasurementSketch(e,t){e.stopPropagation();const a=this.measureType;this._closeAllImageTools(),this.measureType=a===t?null:t,this.measureType===t&&(this.viewModel.displayNewMeasurementButton=!0)}_toggleNavigationTool(){const e=this.navigationToolActive;this._closeAllImageTools(),this.navigationToolActive=!e}_toggleMapImageConversionToolState(){this.mapImageConversionToolState=!this.mapImageConversionToolState}_unregisterGalleryItem(e){this._galleryObserver.unobserve(e)}_updateNavigationTool(e){const{previousFeatureAngle:t,bestFeatureAngle:a}=this.viewModel,i=(a-t+540)%360-180;e.style.setProperty(bn,`${t}deg`),e.style.setProperty(Mn,`${t+i}deg`)}async loadBestImage(e){return this.viewModel.loadBestImage(e)}loadImageFromSource(e,t){return this.viewModel.loadImageFromSource(e,t)}async overlayMapFeatures(e,t){return this.removeHandles(`${nt.overlayed}-${e.id}`),this.addHandles(O(()=>e.visible,()=>{this.viewModel.toggleOverlayMapFeatures(e.id,e.visible)}),`${nt.overlayed}-${e.id}`),this._overlayedLayers.add(e),this.viewModel.overlayMapFeatures(e,t&&this.showMapFeatures)}async plotMapPoint(e){return this.viewModel.plotMapPoint(e)}plotReferencePointOnGround(e){this.viewModel.plotReferencePointOnGround(e)}plotReferencePointOnImage(e){this.viewModel.plotReferencePointOnImage(e)}removeOverlayedGraphicsOnImage(e){this.removeHandles(`${nt.overlayed}-${e}`),this._overlayedLayers.remove(this._overlayedLayers.find(t=>t.id===e)),this.viewModel.removeOverlayedGraphicsOnImage(e)}resetImage(){this.viewModel.resetImage()}render(){return M("div",{class:this.classes(ct.widget,H)},this._renderRoot())}async startDataCapture(e){return this.viewModel.startDataCapture(e)}async stopDataCapture(e){return this.viewModel.stopDataCapture(e)}updateSuitabilities(e){this.viewModel.updateSuitabilities(e)}};c([u({readOnly:!0})],P.prototype,"accuracyParametersMissing",null),c([u()],P.prototype,"activeLayer",null),c([u()],P.prototype,"currentBestFeature",null),c([u()],P.prototype,"currentCoverageVisible",null),c([u()],P.prototype,"dataCaptureEnabled",void 0),c([u()],P.prototype,"dataCaptureLayer",null),c([u()],P.prototype,"disabled",null),c([u()],P.prototype,"features",null),c([u()],P.prototype,"imagePointsInView",null),c([u()],P.prototype,"galleryOpened",void 0),c([u()],P.prototype,"icon",null),c([u()],P.prototype,"imageEnhancementToolActive",void 0),c([u({readOnly:!0})],P.prototype,"imageGalleryEnabled",null),c([u()],P.prototype,"imageLocationToolActive",null),c([u()],P.prototype,"imageOverlaysOpened",void 0),c([u({readOnly:!0})],P.prototype,"invalidCameraHeading",null),c([u()],P.prototype,"isAdditionalCoverageVisible",null),c([u()],P.prototype,"isAdditionalPointSourcesVisible",null),c([u()],P.prototype,"mapImageConversionToolState",null),c([u()],P.prototype,"measureType",null),c([u()],P.prototype,"layer",null),c([u()],P.prototype,"navigationToolActive",void 0),c([ht(Ao()),u({type:or})],P.prototype,"viewModel",void 0),c([u(),tt("esri/widgets/OrientedImageryViewer/t9n/OrientedImageryViewer")],P.prototype,"messages",void 0),c([u(),tt("esri/core/t9n/Units")],P.prototype,"measurementUnitMessages",void 0),c([u(),tt("esri/t9n/common")],P.prototype,"messagesCommon",void 0),c([u(),tt("esri/widgets/Sketch/t9n/Sketch")],P.prototype,"messagesSketch",void 0),c([u()],P.prototype,"pixelMeasurementUnit",void 0),c([u()],P.prototype,"pixelAreaMeasurementUnit",void 0),c([u({readOnly:!0})],P.prototype,"popupEnabled",null),c([u()],P.prototype,"referencePoint",null),c([u()],P.prototype,"showCameraLocations",void 0),c([u()],P.prototype,"showMapFeatures",void 0),c([ht(["create","delete","redo","undo","update"]),u({readOnly:!0})],P.prototype,"sketchViewModel",null),c([u()],P.prototype,"view",null),c([u({type:nr,nonNullable:!0})],P.prototype,"visibleElements",void 0),c([u()],P.prototype,"determineWorkflowForFeature",null),c([u()],P.prototype,"updateFootprint",null),c([u()],P.prototype,"_actionItems",void 0),c([u()],P.prototype,"_activeMeasurementIcon",null),c([u()],P.prototype,"_activeMeasurementHeading",null),c([u()],P.prototype,"_imageOverlaysLoaderTask",void 0),c([u()],P.prototype,"_imageMeasurementToolsLoaderTask",void 0),c([u()],P.prototype,"_measurementToggle",null),c([u()],P.prototype,"_commonActionProperties",null),c([u()],P.prototype,"_imageEnhancementTools",null),c([u()],P.prototype,"_imageGalleryPanel",null),c([u()],P.prototype,"_imageGalleryContext",null),c([u()],P.prototype,"_imageOverlaysComponent",null),c([u()],P.prototype,"_imageOverlayMessages",null),c([u()],P.prototype,"_imageSketchToolsMessages",null),c([u()],P.prototype,"_imageViewer",null),c([u()],P.prototype,"_locationToggle",null),c([u()],P.prototype,"_messageBox",null),c([u()],P.prototype,"_navigationToolExpanded",void 0),c([u()],P.prototype,"_navigationTool",void 0),c([u()],P.prototype,"_panoramicViewer",null),c([u()],P.prototype,"_warningTitleElement",void 0),c([u()],P.prototype,"_renderNavigation",null),c([u()],P.prototype,"_renderThumbnails",null),c([u()],P.prototype,"_sketchLoaderTask",void 0),P=c([me("esri.widgets.OrientedImageryViewer")],P);const el=P;/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
v4.32.12 */const tl=sr`@layer{arcgis-oriented-imagery-viewer{display:block}}`,al=So(el),qe=class qe extends lr{constructor(){super(...arguments),this.widget=al(this),this._hasOrientedImageryLayerToAdd=!1,this.viewModel=this.widget.viewModel,this.autoDestroyDisabled=!1,this.currentCoverageVisible=this.widget.currentCoverageVisible,this.dataCaptureEnabled=this.widget.dataCaptureEnabled,this.disabled=this.widget.disabled,this.galleryOpened=this.widget.galleryOpened,this.icon=this.widget.icon,this.imageEnhancementToolActive=this.widget.imageEnhancementToolActive,this.imageGalleryEnabled=this.widget.imageGalleryEnabled,this.isAdditionalCoverageVisible=this.widget.isAdditionalCoverageVisible,this.isAdditionalPointSourcesVisible=this.widget.isAdditionalPointSourcesVisible,this.label=this.widget.label,this.layer=this.widget.layer,this.mapImageConversionToolState=this.widget.mapImageConversionToolState,this.navigationToolActive=this.widget.navigationToolActive,this.position="bottom-left",this.referencePoint=this.widget.referencePoint,this.arcgisPropertyChange=cr()("imageGalleryEnabled","layer"),this.arcgisReady=hr()}async destroy(){await this.manager.destroy()}willUpdate(t){if(t.has("orientedImageryLayerItemId")){const a=this.orientedImageryLayerItemId;a&&this.widget&&(this.layer=new Na({portalItem:{id:a}}),this.widget.view?this.widget.view.map.add(this.layer):this._hasOrientedImageryLayerToAdd=!0)}}loaded(){this._hasOrientedImageryLayerToAdd&&(this.widget.view?this._onReady():this.el.addEventListener("arcgisReady",()=>{this._onReady()},{once:!0}))}_onReady(){var a;const{layer:t}=this;t&&((a=this.widget.view)==null||a.map.add(t),this._hasOrientedImageryLayerToAdd=!1)}};qe.properties={autoDestroyDisabled:5,currentCoverageVisible:5,dataCaptureEnabled:5,disabled:5,galleryOpened:5,icon:1,imageEnhancementToolActive:5,imageGalleryEnabled:4,isAdditionalCoverageVisible:5,isAdditionalPointSourcesVisible:5,label:1,layer:0,mapImageConversionToolState:5,navigationToolActive:5,orientedImageryLayerItemId:1,position:1,referenceElement:1,referencePoint:0},qe.shadowRootOptions=ur,qe.styles=tl;let yt=qe;mr("arcgis-oriented-imagery-viewer",yt);const zc=Object.freeze(Object.defineProperty({__proto__:null,ArcgisOrientedImageryViewer:yt},Symbol.toStringTag,{value:"Module"}));export{Tt as A,Us as B,Ac as I,_i as J,Vc as K,Oc as L,Si as N,Sc as S,Oe as T,kc as X,Ec as Y,xc as a,zc as c,Rc as f,$ as i,Lc as k,Ts as u,Tc as x};
