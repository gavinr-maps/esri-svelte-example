const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./chartUtilsAm5-BSJ5oVbW.js","./intl-Duiy0OzY.js","./Promise-DfET-uns.js","./cast-CsZslgGN.js","./Accessor-BmwT4B0c.js","./index-4eY77cms.js","./index-Cx51aysm.css","./JSONSupport-DcrLLGjL.js","./Theme-C4wE6TK_.js","./Tooltip-BhCfTj-i.js","./DefaultTheme-C-ZXdHWu.js","./index-DwIhxbHs.js","./jsxFactory-Cnml7uXM.js","./Evented-Dw4_VOGn.js","./reactiveUtils-XM7cS2OP.js","./SimpleObservable-CvOkykwM.js","./uuid-Cl5lrJ4c.js","./dom-DEluURzl.js","./guid-ejniuQmw.js","./observers-Co4E8E8j.js","./chartCommon-CtfxFCz5.js","./ResponsiveTheme-D3H-JU6V.js","./Button-B2LD7Xva.js","./ColorSet-D3EbtPw6.js","./pieChart-B9_yhOzG.js","./Tick-C6k2cQmq.js","./xyChart-ekxuHGKN.js","./LineSeries-BEQRUcPt.js","./arcade-BRtVPTX5.js","./Graphic-Dt0LgVGU.js","./Clonable-Z-AWS-16.js","./writer-DKgfqj4X.js","./opacityUtils-Dim20wpZ.js","./Point-Cz2JYYmX.js","./enumeration-DpvDkLNI.js","./Color-VJEMvW-n.js","./colorUtils-Rxh2V3ai.js","./mathUtils-Cfq9PL9W.js","./ActionToggle-D7439N1A.js","./Identifiable-BHVfzH03.js","./jsonUtils-CwFG8yN4.js","./Extent-g5W9hy0j.js","./Polyline-s-JzsQqo.js","./typeUtils-B6WBEKDM.js","./TextSymbol-BLIQ6RKX.js","./screenUtils-_ZIvrt5o.js","./collectionUtils-CTT-51g7.js","./Portal-CmmHxpLg.js","./vec3f64-BLpZdpfb.js","./aaBoundingBox-Dw3yBk2f.js","./ImmutableArray-BPVd6ESQ.js","./TimeOnly-CveCl9ie.js","./FeatureLayer-U46cmps3.js","./MultiOriginJSONSupport-DbmrbwMa.js","./layerContainerType-C5CzMsLd.js","./FeatureLayerBase-C4QQJYE9.js","./formUtils-l8pvwous.js","./Field-BDG0QV_T.js","./fieldType-CBeoJWlv.js","./HeightModelInfo-C05IFsWs.js","./commonProperties-B0GHoNP5.js","./ElevationInfo-BPOqhCue.js","./unitConversionUtils-rg07EgOm.js","./lengthUtils-_77UiyVF.js","./AttributeTableTemplate-cR37sM72.js","./timeZoneUtils-DxzjpEBb.js","./featureLayerUtils-Btb8HY8h.js","./featureQueryAll-JpNZKIBO.js","./Query-B_2mhyL4.js","./FullTextSearch-CBnxSwz4.js","./TimeExtent-BO6BsF_x.js","./timeUtils-C1c_L2Fd.js","./layerUtils-B__v9OBu.js","./SimpleRenderer-CEw_geZx.js","./commonProperties-ZfGquLPI.js","./colorRamps-CRjjPL3r.js","./SizeVariable-B-ghFm6e.js","./visualVariableUtils-Xcorldoo.js","./ColorStop-BYiAUa8d.js","./jsonUtils-B-voMz-i.js","./defaults-FkBa0ybj.js","./defaultsJSON-GKolV7NZ.js","./UniqueValueRenderer-yoWHKJ_P.js","./diffUtils-BanfihCO.js","./RendererLegendOptions-CYAPr8D6.js","./styleUtils-ColFrJ-Z.js","./AttachmentQuery-CpEmJqq-.js","./NormalizationBinParametersMixin-CZD0XfhN.js","./RelationshipQuery-B5a-mYy7.js","./LayerFloorInfo-iCgtHY6f.js","./Relationship-CTbzI1Kb.js","./serviceCapabilitiesUtils-B2yGaMdk.js","./infoFor3D-C7tb3HsI.js","./Layer-DH4_Pn8a.js","./workers-Cds_sd9m.js","./Queue-BQesTh_6.js","./editsZScale-LI19I1vI.js","./queryZScale-BdW_vUm_.js","./projection-CyCZAIaD.js","./projectBuffer-CQnuEMuP.js","./geodesicConstants-RQL9oKdk.js","./FeatureSet-B5-Veyin.js","./APIKeyMixin-3z69J1h4.js","./ArcGISService-CDyDWGI0.js","./ScaleRangeLayer-Cnzwr9PT.js","./jsonUtils-DZz5FrgB.js","./utils-DYurMneM.js","./mat4f32-DcsiF_Rp.js","./mat4-Fi6iAz29.js","./common-DQOJ18NT.js","./CustomParametersMixin-Be7WOSEG.js","./DisplayFilteredLayer-CzliK74b.js","./scaleUtils-DPfHG2g0.js","./displayFilterUtils-uKPOP7_-.js","./EditBusLayer-KXo-LY9o.js","./FeatureEffectLayer-BZmannck.js","./FeatureEffect-DZgZP6Sj.js","./FeatureFilter-Ca1n-g_b.js","./FeatureReductionLayer-B6VhUfZv.js","./FeatureReductionSelection-BJWsAyix.js","./labelingInfo-BgG6IH9B.js","./labelUtils-DCpQ7n-8.js","./jsonUtils-BZp85R7u.js","./typeUtils-B3iPBwJ2.js","./ClassBreaksRenderer-C7fhua2J.js","./LRUCache-CXiGQWMN.js","./MemCache-CmojB_Z1.js","./Version-Cd3TlGH0.js","./FieldsIndex-FW1AMU67.js","./utils-UPZJIDfz.js","./defaultCIMValues-Bb-CUowV.js","./enums-BTM-fOHQ.js","./HeatmapColorStop-CHbSyb1s.js","./heatmapUtils-Cyq-bAyG.js","./vec42-YcqnINSP.js","./vec4f64-o2zAXfmz.js","./MD5-C9MwAd2G.js","./OperationalLayer-B__lrMRq.js","./OrderedLayer-ucEg87Tu.js","./OrderByInfo-KsusEmpW.js","./PortalLayer-Cqwv_mmr.js","./PortalItem-CTx1kJsR.js","./portalItemUtils-ByOtbGao.js","./RefreshableLayer-C90FXoHt.js","./TemporalLayer-CMqBosxi.js","./TimeInfo-CctegBed.js","./TimeInterval-B7L-CEq7.js","./TrackableLayer-DaYHUnrc.js","./FeatureTemplate-Dh5_oWTV.js","./FeatureType-DhERcdEP.js","./fieldProperties-DDN0PSrH.js","./TitleCreator-DIyQ9Yy3.js","./versionUtils-BfhafDf-.js","./styleUtils-Bye9ft1s.js","./popupUtils-CmsUVJA0.js","./interfaces-CL2NbQte.js","./arcade-BXELiP5l.js","./executionError-DNkSe-Q-.js","./deepClone-DD9qKKD3.js","./shared-2m9g3-y2.js","./number-QOqKffTG.js","./featureConversionUtils-CvnFcmH_.js","./OptimizedFeature-P2towpqD.js","./memoryEstimations-Bcyf-mHz.js","./OptimizedGeometry-BJqUA4Pi.js","./OptimizedFeatureSet-Blu9Ckm7.js","./WhereClause-xGR0ztic.js","./unitConversion-DvIVg62C.js","./hash-CcEbRgUF.js","./index-CMxz6F2k.js","./useT9n-C1Hrfc-A.js","./index-BtUFGore.js","./ref-D9wHsL_T.js","./directive-helpers-DaBykg1t.js","./loadable-XBvaWFYY.js","./interactive-DTzfFku4.js","./key-CZcQa38B.js","./component-CBVlbUuE.js","./index-BCDLx0rN.js","./index-DyXGQ9Xl.js","./keyed-CU1C-h1n.js","./index-fFnlo_g2.js","./index-DWeq-ojO.js","./index-pyEU_klK.js","./live-D7NQ-TrC.js","./static-DLD4WjLv.js","./form-BzoUrXC7.js","./label-CHHpnzD0.js","./locale-CXx8I9ox.js","./Validation-BYp9DS84.js","./input-DI9tZAPS.js","./filter-D4A4y0z5.js","./escapeRegExp-CdLjXKbf.js","./debounce-DbkufipY.js","./utils-Dtivty39.js","./index-B0pN5y8B.js","./index-DVGzfobf.js","./floating-ui-IixYHfbQ.js","./openCloseComponent-nqWrSaIH.js","./dynamicClasses-pKEMtFzB.js","./index-BPm91e5Z.js","./index-C7Sgjfzm.js","./resources6-Cs2_VmEC.js","./index-XCNLEnDV.js","./customElement-_nG5icNK.js","./resources5-SciNIBSe.js","./index-CV25o1as.js","./resources4-Crg87oFz.js","./FeatureUtilityNetworkAssociationList-CS-hnq6A.js","./FeatureRelationshipViewModel-CSg-U4Be.js","./Heading-BcR6CGTM.js","./globalCss-vQlnDsEX.js","./ReactiveMap-BHFEHYMj.js","./NetworkElement-BEwoE6j2.js","./featureUtils-BovNToiy.js","./utils-v4CMtYiY.js","./featureFormUtils-Cjx4R4NB.js","./dateUtils-CkANlKbA.js","./substitute-CvdjmBYq.js","./isConnectivityMidspan-Bt3Op6WB.js"])))=>i.map(i=>d[i]);
import{_ as M}from"./index-4eY77cms.js";import{r as a,m as d,a as O,g as ce,a7 as Ft,s as je,B as ge,Z as ie,bm as ct,G as ut,i as X,D as ae,N as $t,av as Xe,ag as Rt,E as Be}from"./Accessor-BmwT4B0c.js";import{l as ze}from"./intl-Duiy0OzY.js";import{d as $,P,p as pt,a as ve,v as ht,V as Lt,w as kt}from"./reactiveUtils-XM7cS2OP.js";import{P as Vt,a as Me}from"./cast-CsZslgGN.js";import{O as J,n as m,e as G,c as Ae,g as le}from"./jsxFactory-Cnml7uXM.js";import{A as St,I as Pt}from"./Attachments-CEjxK4Wg.js";import{l as xe,m as Pe,_ as Ot,w as Nt}from"./FeatureRelationshipViewModel-CSg-U4Be.js";import{b as Oe,I as Dt,n as mt,N as Wt,O as Ut,Q as ft,a as Ht,R as jt}from"./Graphic-Dt0LgVGU.js";import{graphicCallback as we,shouldOpenInNewTab as _t,getFieldInfoLabel as yt,isRelatedField as q,substituteFieldsInLinksAndAttributes as K,fixTokens as Ye,substituteAttributes as Ze,getFixedFieldNames as Xt,getFixedFieldName as qe,isExpressionField as gt,getFieldInfo as Bt,applyTextFormattingHTML as Ne,htmlEntities as De,createFieldInfoMap as zt,getAllFieldInfos as Ke,getSourceLayer as Yt,querySourceLayer as Zt,queryUpdatedFeature as qt,isRelatableFeatureSupportedLayer as Kt,isAssociatedFeatureSupportedLayer as Qt,formatEditInfo as Gt,formatAttributes as Fe,preLayerQueryCallback as Jt,preRequestCallback as ei}from"./featureUtils-BovNToiy.js";import{e as vt,t as ti}from"./widget-GKEQ1p1m.js";import{e as Ce}from"./globalCss-vQlnDsEX.js";import{a as ii}from"./uriUtils-CBE5heUM.js";import{o as si}from"./a11yUtils-ClKbIIe-.js";import{x as ri}from"./utils-B1XxMXhZ.js";import{g as ni}from"./opacityUtils-Dim20wpZ.js";import{s as $e}from"./executeQueryJSON-BvVQs3iA.js";import{m as oi,b as Re}from"./Query-B_2mhyL4.js";import ai from"./RelationshipQuery-B5a-mYy7.js";import{r as li}from"./themeUtils-C3zvZbsE.js";import{s as We}from"./substitute-CvdjmBYq.js";import{e as be}from"./throttle-jjSnxk80.js";import{j as wt,g as di}from"./Point-Cz2JYYmX.js";import{x as ci}from"./shared-2m9g3-y2.js";import ui from"./FeatureLayer-U46cmps3.js";import{n as pi}from"./Identifiable-BHVfzH03.js";import{c as Qe}from"./popupUtils-CmsUVJA0.js";import{e as hi}from"./Promise-DfET-uns.js";import{e as mi}from"./Heading-BcR6CGTM.js";let de=class extends St{constructor(e){super(e),this.description=null,this.title=null}};a([d()],de.prototype,"description",void 0),a([d()],de.prototype,"title",void 0),de=a([O("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],de);const Ue=de,fi={base:"esri-feature-attachments"};let j=class extends J{constructor(t,i){super(t,i),this._featureElementInfo=null,this.attachmentsWidget=new Pt,this.headingLevel=2,this.viewModel=new Ue}initialize(){this._featureElementInfo=new xe,this.addHandles([$(()=>{var t,i;return[(t=this.viewModel)==null?void 0:t.description,(i=this.viewModel)==null?void 0:i.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),P),$(()=>this.viewModel,t=>this.attachmentsWidget.viewModel=t,P)])}destroy(){var t;this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),(t=this._featureElementInfo)==null||t.destroy()}get description(){return this.viewModel.description}set description(t){this.viewModel.description=t}get displayType(){return this.attachmentsWidget.displayType}set displayType(t){this.attachmentsWidget.displayType=t}get graphic(){return this.viewModel.graphic}set graphic(t){this.viewModel.graphic=t}get title(){return this.viewModel.title}set title(t){this.viewModel.title=t}render(){var i;const{attachmentsWidget:t}=this;return m("div",{class:fi.base},(i=this._featureElementInfo)==null?void 0:i.render(),t==null?void 0:t.render())}_setupFeatureElementInfo(){var r;const{description:t,title:i,headingLevel:s}=this;(r=this._featureElementInfo)==null||r.set({description:t,title:i,headingLevel:s})}};a([d({readOnly:!0})],j.prototype,"attachmentsWidget",void 0),a([d()],j.prototype,"description",null),a([d()],j.prototype,"displayType",null),a([d()],j.prototype,"graphic",null),a([d()],j.prototype,"headingLevel",void 0),a([d()],j.prototype,"title",null),a([d({type:Ue})],j.prototype,"viewModel",void 0),j=a([O("esri.widgets.Feature.FeatureAttachments")],j);const _i=j;let Z=class extends ce{constructor(t){super(t),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles($(()=>this.creator,i=>{this._destroyContent(),this._createContent(i)},P))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:t,graphic:i,destroyer:s}=this;t&&i&&(we({type:"content",value:s,event:{graphic:i}}),this._set("created",null))}async _createContent(t){const i=this.graphic;if(!i||!t)return;const s=we({type:"content",value:t,event:{graphic:i}});this._loadingPromise=s,this.notifyChange("state");const r=await s;s===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))}};a([d({readOnly:!0})],Z.prototype,"created",void 0),a([d()],Z.prototype,"creator",void 0),a([d()],Z.prototype,"destroyer",void 0),a([d({type:Oe})],Z.prototype,"graphic",void 0),a([d({readOnly:!0})],Z.prototype,"state",null),Z=a([O("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Z);const Ie=Z,Le="esri-feature-content",ke={base:Le,loaderContainer:`${Le}__loader-container`,loader:`${Le}__loader`};let ee=class extends J{constructor(t,i){super(t,i),this.viewModel=null,this._addTargetToAnchors=s=>{Array.from(s.querySelectorAll("a")).forEach(r=>{_t(r.href)&&!r.hasAttribute("target")&&r.setAttribute("target","_blank")})}}get creator(){var t;return(t=this.viewModel)==null?void 0:t.creator}set creator(t){this.viewModel&&(this.viewModel.creator=t)}get graphic(){var t;return(t=this.viewModel)==null?void 0:t.graphic}set graphic(t){this.viewModel&&(this.viewModel.graphic=t)}render(){var i;const t=(i=this.viewModel)==null?void 0:i.state;return m("div",{class:ke.base},t==="loading"?this._renderLoading():this._renderCreated())}_renderLoading(){return m("div",{class:ke.loaderContainer,key:"loader"},m("div",{class:ke.loader}))}_renderCreated(){var i;const t=(i=this.viewModel)==null?void 0:i.created;return t?t instanceof HTMLElement?m("div",{afterCreate:this._attachToNode,bind:t,key:t}):vt(t)?m("div",{key:t},!t.destroyed&&t.render()):m("div",{afterCreate:this._addTargetToAnchors,innerHTML:t,key:t}):null}_attachToNode(t){const i=this;t.appendChild(i)}};a([d()],ee.prototype,"creator",null),a([d()],ee.prototype,"graphic",null),a([d({type:Ie})],ee.prototype,"viewModel",void 0),ee=a([O("esri.widgets.Feature.FeatureContent")],ee);const he=ee;let z=class extends ce{constructor(t){super(t),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:t,fieldInfos:i}=this,s=[];return i==null||i.forEach(r=>{if(!(!r.hasOwnProperty("visible")||r.visible))return;const n=r.clone();n.label=yt(n,t),s.push(n)}),s}};a([d()],z.prototype,"attributes",void 0),a([d({type:[Dt]})],z.prototype,"expressionInfos",void 0),a([d()],z.prototype,"description",void 0),a([d({type:[mt]})],z.prototype,"fieldInfos",void 0),a([d({readOnly:!0})],z.prototype,"formattedFieldInfos",null),a([d()],z.prototype,"title",void 0),z=a([O("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],z);const Te=z,ue="esri-feature-fields",pe={base:ue,fieldHeader:`${ue}__field-header`,fieldData:`${ue}__field-data`,fieldDataDate:`${ue}__field-data--date`};let W=class extends J{constructor(t,i){super(t,i),this._featureElementInfo=null,this.viewModel=new Te,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new xe,this.addHandles($(()=>{var t,i;return[(t=this.viewModel)==null?void 0:t.description,(i=this.viewModel)==null?void 0:i.title]},()=>this._setupFeatureElementInfo(),P))}destroy(){var t;(t=this._featureElementInfo)==null||t.destroy()}get attributes(){return this.viewModel.attributes}set attributes(t){this.viewModel.attributes=t}get description(){return this.viewModel.description}set description(t){this.viewModel.description=t}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(t){this.viewModel.expressionInfos=t}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(t){this.viewModel.fieldInfos=t}get title(){return this.viewModel.title}set title(t){this.viewModel.title=t}render(){var t;return m("div",{class:pe.base},(t=this._featureElementInfo)==null?void 0:t.render(),this._renderFields())}_renderFieldInfo(t,i){var p;const{attributes:s}=this.viewModel,r=t.fieldName||"",n=t.label||r,o=s?s[r]==null?"":s[r]:"",l=!!((p=t.format)!=null&&p.dateFormat),c=typeof o=="number"&&!l?this._forceLTR(o):ii(this.messagesURIUtils,o),u={[pe.fieldDataDate]:l};return m("tr",{key:`fields-element-info-row-${r}-${i}`},m("th",{class:pe.fieldHeader,innerHTML:n,key:`fields-element-info-row-header-${r}-${i}`}),m("td",{class:this.classes(pe.fieldData,u),innerHTML:c,key:`fields-element-info-row-data-${r}-${i}`}))}_renderFields(){const{formattedFieldInfos:t}=this.viewModel;return t!=null&&t.length?m("table",{class:Ce.table,summary:this.messages.fieldsSummary},m("tbody",null,t.map((i,s)=>this._renderFieldInfo(i,s)))):null}_setupFeatureElementInfo(){var s;const{description:t,title:i}=this;(s=this._featureElementInfo)==null||s.set({description:t,title:i})}_forceLTR(t){return`&lrm;${t}`}};a([d()],W.prototype,"attributes",null),a([d()],W.prototype,"description",null),a([d()],W.prototype,"expressionInfos",null),a([d()],W.prototype,"fieldInfos",null),a([d()],W.prototype,"title",null),a([d({type:Te,nonNullable:!0})],W.prototype,"viewModel",void 0),a([d(),G("esri/widgets/Feature/t9n/Feature")],W.prototype,"messages",void 0),a([d(),G("esri/widgets/support/t9n/uriUtils")],W.prototype,"messagesURIUtils",void 0),W=a([O("esri.widgets.Feature.FeatureFields")],W);const bt=W,yi="esri.widgets.Feature.support.relatedFeatureUtils",Ge=()=>ge.getLogger(yi),Je=new Map;function me(e){if(!q(e))return null;const[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function gi(e,t){if(!t.relationships)return null;let i=null;const{relationships:s}=t;return s.some(r=>r.id===parseInt(e,10)&&(i=r,!0)),i}function vi({originRelationship:e,relationships:t,layerId:i}){return t.find(({relatedTableId:s,id:r})=>`${s}`===i&&r===(e==null?void 0:e.id))??null}function wi(e,t){const i=t.toLowerCase();for(const s in e)if(s.toLowerCase()===i)return e[s];return null}function bi(e,t){const i=gi(e,t);if(i)return{url:`${t.url}/${i.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function Ii(e,t){if(!t||!e)return;const{features:i,statsFeatures:s}=e,r=i==null?void 0:i.value;t.relatedFeatures=r?r.features:[];const n=s==null?void 0:s.value;t.relatedStatsFeatures=n?n.features:[]}function Mi(e,t,i,s){var n;const r=new ai;return r.outFields=["*"],r.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),r.objectIds=[e.attributes[i.objectIdField]],r.gdbVersion=i.gdbVersion??null,r.historicMoment=i.historicMoment??null,((n=i.queryRelatedFeatures)==null?void 0:n.call(i,r,s))??Promise.resolve({})}function Ai(e,t,i){let s=0;const r=[];for(;s<t.length;)r.push(`${e} IN (${t.slice(s,i+s)})`),s+=i;return r.join(" OR ")}function xi(e){return e?ct(e):void 0}function Ci(e){return e?ct(e,(t,i)=>JSON.stringify(t.toJSON())===JSON.stringify(i.toJSON())):void 0}async function Ti(e,t,i,s){const r=i.layerId.toString(),{layerInfo:n,relation:o,relatedFields:l,outStatistics:c,url:u,sourceSpatialReference:p}=t,h=xi(l),_=Ci(c);if(!n||!o)return null;const f=vi({originRelationship:o,relationships:n.relationships,layerId:r});if(f!=null&&f.relationshipTableId&&f.keyFieldInRelationshipTable){const g=(await Mi(e,f,i,s))[e.attributes[i.objectIdField]];if(!g)return null;const w=g.features.map(v=>v.attributes[n.objectIdField]);if(_!=null&&_.length&&n.supportsStatistics){const v=new Re;v.where=Ai(n.objectIdField,w,1e3),v.outFields=h,v.outStatistics=_,v.sourceSpatialReference=p;const b={features:Promise.resolve(g),statsFeatures:$e(u,v)};return ie(b)}}const y=f==null?void 0:f.keyField;if(y){const g=ni(Li(n.fields,y)),w=wi(e.attributes,o.keyField),v=g?`${y}=${w}`:`${y}='${w}'`,b=i.historicMoment,C=i.gdbVersion,R=$e(u,new Re({where:v,outFields:h,sourceSpatialReference:p,historicMoment:b,gdbVersion:C}),s),F=_!=null&&_.length&&n.supportsStatistics?$e(u,new Re({where:v,outFields:h,outStatistics:_,sourceSpatialReference:p}),s):null,N={features:R};return F&&(N.statsFeatures=F),ie(N)}return null}function Ei(e,t){return Vt(e,{query:{f:"json"},signal:t==null?void 0:t.signal})}function Fi({relatedInfos:e,layer:t},i){const s={};return e.forEach((r,n)=>{const{relation:o}=r;if(!o){const h=new je("relation-required","A relation is required on a layer to retrieve related records.");throw Ge().error(h),h}const{relatedTableId:l}=o;if(typeof l!="number"){const h=new je("A related table ID is required on a layer to retrieve related records.");throw Ge().error(h),h}const c=`${t.url}/${l}`,u=Je.get(c),p=u??Ei(c);u||Je.set(c,p),s[n]=p}),Ft(ie(s),i)}function $i({graphic:e,relatedInfos:t,layer:i},s){const r={};return t.forEach((n,o)=>{n.layerInfo&&(r[o]=Ti(e,n,i,s))}),ie(r)}function Ri({relatedInfo:e,fieldName:t,fieldInfo:i}){var s,r;if((s=e.relatedFields)==null||s.push(t),i.statisticType){const n=new oi({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});(r=e.outStatistics)==null||r.push(n)}}function Li(e,t){if(e!=null){t=t.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===t)return i}return null}const et={chartAnimation:!0};let T=class extends ce{constructor(t){super(t),this.abilities={...et},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(t){return{...et,...t}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(t){this._setContentElementMedia(t)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(t){const{formattedMediaInfoCount:i}=this,s=(t+i)%i;this.activeMediaInfoIndex=s}_pageContentElementMedia(t){const{activeMediaInfoIndex:i}=this,s=i+t;this._setContentElementMedia(s)}_formatMediaInfos(){const{mediaInfos:t,layer:i}=this,s=this.attributes??{},r=this.formattedAttributes??{},n=this.expressionAttributes??{},o=this.fieldInfoMap??new Map;return(t==null?void 0:t.map(l=>{const c=l==null?void 0:l.clone();return c?(c.title=K({attributes:s,fieldInfoMap:o,globalAttributes:r,expressionAttributes:n,layer:i,text:c.title}),c.caption=K({attributes:s,fieldInfoMap:o,globalAttributes:r,expressionAttributes:n,layer:i,text:c.caption}),c.altText=K({attributes:s,fieldInfoMap:o,globalAttributes:r,expressionAttributes:n,layer:i,text:c.altText}),c.type==="image"?c.value?(this._setImageValue({value:c.value,formattedAttributes:r,layer:i}),c.value.sourceURL?c:void 0):void 0:c.type==="pie-chart"||c.type==="line-chart"||c.type==="column-chart"||c.type==="bar-chart"?c.value?(this._setChartValue({value:c.value,chartType:c.type,attributes:s,formattedAttributes:r,layer:i,expressionAttributes:n}),c):void 0:null):null}).filter(ut))??[]}_setImageValue(t){const i=this.fieldInfoMap??new Map,{value:s,formattedAttributes:r,layer:n}=t,{linkURL:o,sourceURL:l}=s;if(l){const c=Ye(l,n);s.sourceURL=Ze({formattedAttributes:r,template:c,fieldInfoMap:i})}if(o){const c=Ye(o,n);s.linkURL=Ze({formattedAttributes:r,template:c,fieldInfoMap:i})}}_setChartValue(t){const{value:i,attributes:s,formattedAttributes:r,chartType:n,layer:o,expressionAttributes:l}=t,{popupTemplate:c,relatedInfos:u}=this,{fields:p,normalizeField:h}=i,_=o;if(i.fields=Xt(p,_),h&&(i.normalizeField=qe(h,_)),!p.some(y=>!!(r[y]!=null||q(y)&&(u!=null&&u.size))))return;const f=(c==null?void 0:c.fieldInfos)??[];p.forEach((y,g)=>{var b;const w=(b=i.colors)==null?void 0:b[g];if(q(y))return void(i.series=[...i.series,...this._getRelatedChartInfos({fieldInfos:f,fieldName:y,formattedAttributes:r,chartType:n,value:i,color:w})]);const v=this._getChartOption({value:i,attributes:s,chartType:n,formattedAttributes:r,expressionAttributes:l,fieldName:y,fieldInfos:f,color:w});i.series.push(v)})}_getRelatedChartInfos(t){var y;const{fieldInfos:i,fieldName:s,formattedAttributes:r,chartType:n,value:o,color:l}=t,c=[],u=me(s),p=u&&((y=this.relatedInfos)==null?void 0:y.get(u.layerId.toString()));if(!p)return c;const{relatedFeatures:h,relation:_}=p;if(!_||!h)return c;const{cardinality:f}=_;return h.forEach(g=>{const{attributes:w}=g;w&&Object.keys(w).forEach(v=>{v===u.fieldName&&c.push(this._getChartOption({value:o,attributes:w,formattedAttributes:r,fieldName:s,chartType:n,relatedFieldName:v,hasMultipleRelatedFeatures:(h==null?void 0:h.length)>1,fieldInfos:i,color:l}))})}),f==="one-to-many"||f==="many-to-many"?c:[c[0]]}_getTooltip({label:t,value:i,chartType:s}){return s==="pie-chart"?`${t}`:`${t}: ${i}`}_getChartOption(t){var U;const{value:i,attributes:s,formattedAttributes:r,expressionAttributes:n,fieldName:o,relatedFieldName:l,fieldInfos:c,chartType:u,hasMultipleRelatedFeatures:p,color:h}=t,_=this.layer,f=this.fieldInfoMap??new Map,{normalizeField:y,tooltipField:g}=i,w=y?q(y)?s[me(y).fieldName]:s[y]:null,v=gt(o)&&n&&n[o]!==void 0?n[o]:l&&s[l]!==void 0?s[l]:s[o]!==void 0?s[o]:r[o],b=new Wt({fieldName:o,color:h,value:v===void 0?null:v&&w?v/w:v});if(q(o)){const D=f.get(o.toLowerCase()),se=g&&f.get(g.toLowerCase()),Ee=(D==null?void 0:D.fieldName)??o,re=p&&g?me(g).fieldName:(se==null?void 0:se.fieldName)??g,Tt=p&&re?s[re]:r[re]??(D==null?void 0:D.label)??(D==null?void 0:D.fieldName)??l,Et=p&&l?s[l]:r[Ee];return b.tooltip=this._getTooltip({label:Tt,value:Et,chartType:u}),b}const C=Bt(c,o),R=qe(o,_),F=g&&r[g]!==void 0?r[g]:yt(C||new mt({fieldName:R}),(U=this.popupTemplate)==null?void 0:U.expressionInfos),N=r[R];return b.tooltip=this._getTooltip({label:F,value:N,chartType:u}),b}};a([d()],T.prototype,"abilities",void 0),a([Me("abilities")],T.prototype,"castAbilities",null),a([d()],T.prototype,"activeMediaInfoIndex",void 0),a([d({readOnly:!0})],T.prototype,"activeMediaInfo",null),a([d()],T.prototype,"attributes",void 0),a([d()],T.prototype,"description",void 0),a([d()],T.prototype,"fieldInfoMap",void 0),a([d()],T.prototype,"formattedAttributes",void 0),a([d()],T.prototype,"expressionAttributes",void 0),a([d({readOnly:!0})],T.prototype,"formattedMediaInfos",null),a([d()],T.prototype,"isAggregate",void 0),a([d()],T.prototype,"layer",void 0),a([d({readOnly:!0})],T.prototype,"formattedMediaInfoCount",null),a([d()],T.prototype,"mediaInfos",void 0),a([d()],T.prototype,"popupTemplate",void 0),a([d()],T.prototype,"relatedInfos",void 0),a([d()],T.prototype,"title",void 0),T=a([O("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],T);const Q=T,S="esri-feature-media",L={base:S,mediaContainer:`${S}__container`,mediaItemContainer:`${S}__item-container`,mediaItem:`${S}__item`,mediaItemText:`${S}__item-text`,mediaItemTitle:`${S}__item-title`,mediaItemCaption:`${S}__item-caption`,mediaNavigation:`${S}__item-navigation`,mediaPagination:`${S}__pagination`,mediaPaginationText:`${S}__pagination-text`,mediaChart:`${S}__chart`,mediaPaginationButton:`${S}__pagination-button`,mediaPaginationIcon:`${S}__pagination-icon`,mediaChartRendered:`${S}__chart--rendered`},Ve=15,Y="category",ne="value",ki="rgba(50, 50, 50, 1)",Vi=250,Si=500,Pi=200;let k=class extends J{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new Q,this.messages=null,this._disposeChart=i=>{var s;(s=this._chartRootMap.get(i))==null||s.dispose(),this._chartRootMap.delete(i)},this._createChart=async i=>{const{destroyed:s,viewModel:r}=this;if(s||!r||!i)return;const{createRoot:n}=await M(()=>import("./chartUtilsAm5-BSJ5oVbW.js").then(l=>l.c),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]),import.meta.url),o=await n(i);this._chartRootMap.set(i,o),this._renderChart({mediaInfo:r.activeMediaInfo,root:o})}}initialize(){this._featureElementInfo=new xe,this.addHandles([$(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(t=this.viewModel)==null?void 0:t.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),P),$(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),P)])}loadDependencies(){return Ae({icon:()=>M(()=>import("./index-DwIhxbHs.js").then(e=>e.i),__vite__mapDeps([11,12,4,1,2,3,5,6,7,13,14,15,16,17,18,19]),import.meta.url)})}destroy(){var e;this._clearMediaRefreshTimer(),(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var e;return m("div",{bind:this,class:L.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this._renderMedia())}_renderMedia(){const{formattedMediaInfoCount:e,activeMediaInfoIndex:t}=this.viewModel,i=this._renderMediaText();return e?m("div",{class:L.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),m("div",{class:L.mediaNavigation},i,e>1?m("div",{class:L.mediaPagination},this._renderMediaPageButton("previous"),m("span",{class:L.mediaPaginationText},We(this.messages.pageText,{index:t+1,total:e})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e&&e.title?m("div",{class:L.mediaItemTitle,innerHTML:e.title,key:"media-title"}):null,i=e&&e.caption?m("div",{class:L.mediaItemCaption,innerHTML:e.caption,key:"media-caption"}):null;return t||i?m("div",{class:L.mediaItemText,key:"media-text"},t,i):null}_renderImageMediaInfo(e){if(!e.value)return null;const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:s}=this.viewModel,{value:r,refreshInterval:n,altText:o,title:l,type:c}=e,{sourceURL:u,linkURL:p}=r,h=_t(p??void 0)?"_blank":"_self",_=h==="_blank"?"noreferrer":"",f=n?t:null,y=f?f.timestamp:0,g=f?f.sourceURL:u,w=m("img",{alt:o||l,key:`media-${c}-${i}-${s}-${y}`,src:g??void 0});return(p?m("a",{href:p,rel:_,target:h,title:l},w):null)??w}_renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return m("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:L.mediaChart,key:`media-${e.type}-${t}-${i}`})}_renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this._renderImageMediaInfo(e):e.type.includes("chart")?this._renderChartMediaInfo(e):null:null}_renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;return e?m("div",{class:L.mediaItemContainer,key:"media-container"},m("div",{class:L.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t=e==="previous",i=t?this.messages.previous:this.messages.next,s=t?"chevron-left":"chevron-right",r=t?"media-previous":"media-next",n=t?this._previous:this._next;return m("button",{"aria-label":i,bind:this,class:L.mediaPaginationButton,key:r,onclick:n,tabIndex:0,title:i,type:"button"},m("calcite-icon",{class:L.mediaPaginationIcon,icon:s,scale:"s"}))}_setupFeatureElementInfo(){var i;const{description:e,title:t}=this;(i=this._featureElementInfo)==null||i.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;const{isAggregate:e,layer:t}=this.viewModel;return e&&(t!=null&&t.featureReduction)&&"renderer"in t.featureReduction?t.featureReduction.renderer:t==null?void 0:t.renderer}async _getSeriesColors(e){const{colorAm5:t}=await M(()=>import("./chartCommon-CtfxFCz5.js"),__vite__mapDeps([20,8,4,21,22,9,23]),import.meta.url),i=new Map;return e.forEach(s=>{s.color&&i.set(s,t(s.color.toCss(!0)))}),i}async _getRendererColors(){const{colorAm5:e}=await M(()=>import("./chartCommon-CtfxFCz5.js"),__vite__mapDeps([20,8,4,21,22,9,23]),import.meta.url),t=new Map,i=this._getRenderer(),s="default";if(!i)return t;const r=await ri(i);return r.delete(s),Array.from(r.values()).every(n=>(n==null?void 0:n.length)===1)&&Array.from(r.keys()).forEach(n=>{var l,c;const o=(c=(l=r.get(n))==null?void 0:l[0])==null?void 0:c.toCss(!0);o&&t.set(n,e(o))}),t}_handleMediaKeyup(e){const{key:t}=e;t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!si()}_getChartAnimationMS(){return this._canAnimateChart()?Vi:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?Si:0}async _renderChart(e){const{root:t,mediaInfo:i}=e,{value:s,type:r}=i,{ResponsiveThemeAm5:n,DarkThemeAm5:o,AnimatedThemeAm5:l,ColorSetAm5:c,ThemeAm5:u,esriChartColorSet:p}=await M(async()=>{const{ResponsiveThemeAm5:C,DarkThemeAm5:R,AnimatedThemeAm5:F,ColorSetAm5:N,ThemeAm5:U,esriChartColorSet:D}=await import("./chartCommon-CtfxFCz5.js");return{ResponsiveThemeAm5:C,DarkThemeAm5:R,AnimatedThemeAm5:F,ColorSetAm5:N,ThemeAm5:U,esriChartColorSet:D}},__vite__mapDeps([20,8,4,21,22,9,23]),import.meta.url),h=u.new(t);h.rule("ColorSet").set("colors",p),h.rule("ColorSet").set("reuse",!0);const _=[n.new(t),h];li()&&_.push(o.new(t)),this._canAnimateChart()&&_.push(l.new(t)),t.setThemes(_);const f=await this._getRendererColors(),y=await this._getSeriesColors(s.series),g=c.new(t,{}),w=y.get(s.series[0]),v=w?{lineSettings:{stroke:w}}:void 0,b=s.series.map((C,R)=>{const F=y.get(C)||f.get(C.fieldName)||g.getIndex(R);return{[Y]:C.tooltip,[ne]:C.value,columnSettings:{fill:F,stroke:F},...v}}).filter(C=>r!=="pie-chart"||C.value!=null&&C.value>0);r==="pie-chart"?this._createPieChart(e,b):this._createXYChart(e,b)}_getDirection(){return le(this.container)?"rtl":"ltr"}async _customizeChartTooltip(e,t="horizontal"){var s;const{colorAm5:i}=await M(()=>import("./chartCommon-CtfxFCz5.js"),__vite__mapDeps([20,8,4,21,22,9,23]),import.meta.url);e.setAll({pointerOrientation:t}),(s=e.get("background"))==null||s.setAll({stroke:i(ki)}),e.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:Pi})}async _createPieChart(e,t){const{TooltipAm5:i}=await M(()=>import("./chartCommon-CtfxFCz5.js"),__vite__mapDeps([20,8,4,21,22,9,23]),import.meta.url),{PieChartAm5:s,PieSeriesAm5:r}=await M(async()=>{const{PieChartAm5:y,PieSeriesAm5:g}=await import("./pieChart-B9_yhOzG.js");return{PieChartAm5:y,PieSeriesAm5:g}},__vite__mapDeps([24,4,25,8,23,10]),import.meta.url),{mediaInfo:n,root:o}=e,{title:l}=n,c=5,u=(n==null?void 0:n.altText)||(n==null?void 0:n.title)||"",p=o.container.children.push(s.new(o,{ariaLabel:u,focusable:!0,paddingBottom:c,paddingTop:c,paddingLeft:c,paddingRight:c})),h=`{category}: {valuePercentTotal.formatNumber('0.00')}%
 ({value})`,_=i.new(o,{labelText:h}),f=p.series.push(r.new(o,{name:l,valueField:ne,categoryField:Y,tooltip:_}));f.ticks.template.set("forceHidden",!0),f.labels.template.set("forceHidden",!0),f.slices.template.states.create("active",{shiftRadius:c}),this._customizeChartTooltip(_),f.slices.template.setAll({ariaLabel:h,focusable:!0,templateField:"columnSettings"}),f.data.setAll(t),f.appear(this._getChartSeriesAnimationMS()),p.appear(this._getChartAnimationMS()),p.root.dom.classList.toggle(L.mediaChartRendered,!0)}_getMinSeriesValue(e){let t=0;return e.forEach(i=>t=Math.min(i.value,t)),t}async _createColumnChart(e,t,i){const{TooltipAm5:s,ScrollbarAm5:r}=await M(()=>import("./chartCommon-CtfxFCz5.js"),__vite__mapDeps([20,8,4,21,22,9,23]),import.meta.url),{CategoryAxisAm5:n,AxisRendererXAm5:o,ValueAxisAm5:l,AxisRendererYAm5:c,ColumnSeriesAm5:u}=await M(async()=>{const{CategoryAxisAm5:C,AxisRendererXAm5:R,ValueAxisAm5:F,AxisRendererYAm5:N,ColumnSeriesAm5:U}=await import("./xyChart-ekxuHGKN.js");return{CategoryAxisAm5:C,AxisRendererXAm5:R,ValueAxisAm5:F,AxisRendererYAm5:N,ColumnSeriesAm5:U}},__vite__mapDeps([26,27,8,4,23,10,25,22]),import.meta.url),{mediaInfo:p,root:h}=t,{value:_,title:f}=p;e.setAll({wheelX:"panX",wheelY:"zoomX"});const y=e.xAxes.push(n.new(h,{renderer:o.new(h,{inversed:le(this.container)}),categoryField:Y}));y.get("renderer").labels.template.setAll({forceHidden:!0});const g=e.yAxes.push(l.new(h,{renderer:c.new(h,{inside:!1}),min:this._getMinSeriesValue(_.series)}));g.get("renderer").labels.template.setAll({direction:this._getDirection()});const w="{categoryX}",v=s.new(h,{labelText:w}),b=e.series.push(u.new(h,{name:f,xAxis:y,yAxis:g,valueYField:ne,categoryXField:Y,tooltip:v}));this._customizeChartTooltip(v),b.columns.template.setAll({ariaLabel:w,focusable:!0,templateField:"columnSettings"}),_.series.length>Ve&&e.set("scrollbarX",r.new(h,{orientation:"horizontal"})),y.data.setAll(i),b.data.setAll(i),b.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createBarChart(e,t,i){const{TooltipAm5:s,ScrollbarAm5:r}=await M(()=>import("./chartCommon-CtfxFCz5.js"),__vite__mapDeps([20,8,4,21,22,9,23]),import.meta.url),{CategoryAxisAm5:n,AxisRendererXAm5:o,ValueAxisAm5:l,AxisRendererYAm5:c,ColumnSeriesAm5:u}=await M(async()=>{const{CategoryAxisAm5:C,AxisRendererXAm5:R,ValueAxisAm5:F,AxisRendererYAm5:N,ColumnSeriesAm5:U}=await import("./xyChart-ekxuHGKN.js");return{CategoryAxisAm5:C,AxisRendererXAm5:R,ValueAxisAm5:F,AxisRendererYAm5:N,ColumnSeriesAm5:U}},__vite__mapDeps([26,27,8,4,23,10,25,22]),import.meta.url),{mediaInfo:p,root:h}=t,{value:_,title:f}=p;e.setAll({wheelX:"panY",wheelY:"zoomY"});const y=e.yAxes.push(n.new(h,{renderer:c.new(h,{inversed:!0}),categoryField:Y}));y.get("renderer").labels.template.setAll({forceHidden:!0});const g=e.xAxes.push(l.new(h,{renderer:o.new(h,{inside:!1,inversed:le(this.container)}),min:this._getMinSeriesValue(_.series)}));g.get("renderer").labels.template.setAll({direction:this._getDirection()});const w="{categoryY}",v=s.new(h,{labelText:w}),b=e.series.push(u.new(h,{name:f,xAxis:g,yAxis:y,valueXField:ne,categoryYField:Y,tooltip:v}));this._customizeChartTooltip(v,"vertical"),b.columns.template.setAll({ariaLabel:w,focusable:!0,templateField:"columnSettings"}),_.series.length>Ve&&e.set("scrollbarY",r.new(h,{orientation:"vertical"})),y.data.setAll(i),b.data.setAll(i),b.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createLineChart(e,t,i){var R,F,N;const{TooltipAm5:s,ScrollbarAm5:r}=await M(()=>import("./chartCommon-CtfxFCz5.js"),__vite__mapDeps([20,8,4,21,22,9,23]),import.meta.url),{CategoryAxisAm5:n,AxisRendererXAm5:o,ValueAxisAm5:l,AxisRendererYAm5:c,LineSeriesAm5:u}=await M(async()=>{const{CategoryAxisAm5:U,AxisRendererXAm5:D,ValueAxisAm5:se,AxisRendererYAm5:Ee,LineSeriesAm5:re}=await import("./xyChart-ekxuHGKN.js");return{CategoryAxisAm5:U,AxisRendererXAm5:D,ValueAxisAm5:se,AxisRendererYAm5:Ee,LineSeriesAm5:re}},__vite__mapDeps([26,27,8,4,23,10,25,22]),import.meta.url),{root:p,mediaInfo:h}=t,{value:_,title:f}=h;e.setAll({wheelX:"panX",wheelY:"zoomX"});const y=e.xAxes.push(n.new(p,{renderer:o.new(p,{inversed:le(this.container)}),categoryField:Y}));y.get("renderer").labels.template.setAll({forceHidden:!0});const g=e.yAxes.push(l.new(p,{renderer:c.new(p,{inside:!1}),min:this._getMinSeriesValue(_.series)}));g.get("renderer").labels.template.setAll({direction:this._getDirection()});const w="{categoryX}",v=(F=(R=i[0])==null?void 0:R.lineSettings)==null?void 0:F.stroke,b=s.new(p,{getFillFromSprite:!v,labelText:w});v&&((N=b.get("background"))==null||N.setAll({fill:v}));const C=e.series.push(u.new(p,{name:f,xAxis:y,yAxis:g,valueYField:ne,categoryXField:Y,tooltip:b}));C.strokes.template.setAll({templateField:"lineSettings"}),this._customizeChartTooltip(b,"vertical"),_.series.length>Ve&&e.set("scrollbarX",r.new(p,{orientation:"horizontal"})),y.data.setAll(i),C.data.setAll(i),C.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createXYChart(e,t){const{XYChartAm5:i,XYCursorAm5:s}=await M(()=>import("./xyChart-ekxuHGKN.js"),__vite__mapDeps([26,27,8,4,23,10,25,22]),import.meta.url),{root:r,mediaInfo:n}=e,{type:o}=n,l=(n==null?void 0:n.altText)||(n==null?void 0:n.title)||"",c=r.container.children.push(i.new(r,{ariaLabel:l,focusable:!0,panX:!0,panY:!0}));c.set("cursor",s.new(r,{})),o==="column-chart"&&await this._createColumnChart(c,e,t),o==="bar-chart"&&await this._createBarChart(c,e,t),o==="line-chart"&&await this._createLineChart(c,e,t),c.root.dom.classList.toggle(L.mediaChartRendered,!0)}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:e&&this._getImageSource(e,t)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;(e==null?void 0:e.type)==="image"&&(e==null?void 0:e.refreshInterval)>0&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:i}=e,s=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);const r=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},s);this._refreshTimer=r}_getImageSource(e,t){const i=e.includes("?")?"&":"?",[s,r=""]=e.split("#");return`${s}${i}timestamp=${t}${r?"#":""}${r}`}};a([d()],k.prototype,"_refreshIntervalInfo",void 0),a([d()],k.prototype,"attributes",null),a([d()],k.prototype,"activeMediaInfoIndex",null),a([d()],k.prototype,"description",null),a([d()],k.prototype,"fieldInfoMap",null),a([d()],k.prototype,"layer",null),a([d()],k.prototype,"mediaInfos",null),a([d()],k.prototype,"popupTemplate",null),a([d()],k.prototype,"relatedInfos",null),a([d()],k.prototype,"title",null),a([d({type:Q})],k.prototype,"viewModel",void 0),a([d(),G("esri/widgets/Feature/t9n/Feature")],k.prototype,"messages",void 0),k=a([O("esri.widgets.Feature.FeatureMedia")],k);const It=k,Oi="esri.widgets.Feature.support.arcadeFeatureUtils",Se=()=>ge.getLogger(Oi);function Ni(e){return typeof e=="string"?Ne(De(e)):Array.isArray(e)?Di(e):(e==null?void 0:e.declaredClass)==="esri.arcade.Dictionary"?Wi(e):e}function Di(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?Ne(De(t)):t}</li>`).join("")}</ul>`}function Wi(e){const t=e.keys().map(i=>{const s=e.field(i);return`<tr><th>${i}</th><td>${typeof s=="string"?Ne(De(s)):s}</td></tr>`}).join("");return`<table class="${Ce.table}">${t}</table>`}async function Mt(){const[e,t]=await Promise.all([M(()=>import("./arcade-BRtVPTX5.js"),__vite__mapDeps([28,29,4,30,14,13,15,7,3,5,6,31,32,2,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,16,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,1,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155]),import.meta.url),M(()=>import("./arcade-BXELiP5l.js").then(i=>i.w),__vite__mapDeps([156,5,6,157,4,158,3,7,32,2,33,31,50,159,51,41,57,34,58,160,42,37,40,161,49,162,163,164,165,128,65,166,167,168,16,47]),import.meta.url)]);return{executor:e,syntaxUtils:t}}function Ui(e){return"createQuery"in e&&"queryFeatures"in e}async function Hi({graphic:e,view:t,options:i}){const{isAggregate:s,layer:r}=e;if(!s||!r||(t==null?void 0:t.type)!=="2d")return[];const n=await t.whenLayerView(r);if(!Ui(n))return[];const o=n.createQuery(),l=e.getObjectId();o.aggregateIds=l!=null?[l]:[];const{features:c}=await n.queryFeatures(o,i);return c}function ji({layer:e,aggregatedFeatures:t,interceptor:i}){const{fields:s,objectIdField:r,geometryType:n,spatialReference:o,displayField:l}=e;return new ui({fields:s,objectIdField:r,geometryType:n,spatialReference:o,displayField:l,interceptor:i,...e.type==="feature"?{templates:e.templates,typeIdField:e.typeIdField,types:e.types}:null,source:t})}function Xi(e){const t=e.declaredClass==="esri.views.3d.layers.VoxelGraphic";return e.isAggregate?"popup-feature-reduction":t?"popup-voxel":"popup"}function At(e){var t,i;return{scale:e==null?void 0:e.scale,timeProperties:{currentStart:(t=e==null?void 0:e.timeExtent)==null?void 0:t.start,currentEnd:(i=e==null?void 0:e.timeExtent)==null?void 0:i.end,startIncluded:!0,endIncluded:!0}}}function Bi(e){return{$voxel:e}}async function zi(e,t,i,s,r){let n=null;if(r.has("$aggregatedfeatures")){const o=await Hi({graphic:e,view:t,options:i}),l=e.sourceLayer||e.layer;n=ji({layer:l,aggregatedFeatures:o,interceptor:s})}return{vars:{$feature:e,$aggregatedFeatures:n,$view:At(t)},[Symbol.dispose]:()=>n==null?void 0:n[Symbol.dispose]()}}function Yi(e,t,i,s){var n;const r=(e.sourceLayer||e.layer)??void 0;return{$feature:e,$layer:r!=null&&ci(r)?r:(r==null?void 0:r.type)==="scene"&&r.associatedLayer!=null?r.associatedLayer:void 0,$map:t,$datastore:r==null?void 0:r.url,$userInput:i,$graph:(r==null?void 0:r.type)==="knowledge-graph-sublayer"?(n=r==null?void 0:r.parentCompositeLayer)==null?void 0:n.knowledgeGraph:void 0,$view:At(s)}}async function Zi(e,{graphic:t,map:i,location:s,view:r,options:n,interceptor:o,arcadeExecutor:l}){switch(e){case"popup":return{vars:Yi(t,i,s,r),[Symbol.dispose](){}};case"popup-feature-reduction":{const c=new Set(l.variablesUsed);return await zi(t,r,n,o,c)}case"popup-voxel":return{vars:Bi(t),[Symbol.dispose](){}};default:throw new Error(`Unexpected profile name ${e}`)}}async function xt({expressionInfo:e,arcade:{executor:t,syntaxUtils:i},graphic:s}){const r=e==null?void 0:e.expression;if(!r)return null;const n=Xi(s),o=t.createArcadeProfile(n);let l;try{l=await t.createArcadeExecutor(r,o)}catch(u){return Se().error("arcade-executor-error",{error:u,expressionInfo:e}),null}const c=new Set;return l.variablesUsed.includes("$view")&&(i.scriptUsesViewProperties(l.syntaxTree,["scale"])&&c.add("view-scale"),i.scriptUsesViewProperties(l.syntaxTree,["timeProperties"])&&c.add("view-time-extent")),{dependencies:c,async evaluate({graphic:u,interceptor:p,location:h,map:_,options:f,spatialReference:y,view:g}){const w=await Zi(n,{graphic:u,map:_,location:h,view:g,options:f,interceptor:p,arcadeExecutor:l}),v={abortSignal:(f==null?void 0:f.signal)??void 0,interceptor:p??void 0,rawOutput:!0,spatialReference:y??void 0,timeZone:g==null?void 0:g.timeZone,console(...b){Se().info(...b)}};try{return await l.executeAsync(w.vars,v)}catch(b){return void Se().error("arcade-execution-error",{error:b,graphic:u,expressionInfo:e})}finally{w[Symbol.dispose]()}}}}async function qi(e,t){if(!(e!=null&&e.length))return{dependencies:new Set,expressions:new Map};const i=await Mt(),s=new Set,r=new Map;for(const n of e){const o=await xt({expressionInfo:n,arcade:i,graphic:t});r.set(`expression/${n.name}`,o),o==null||o.dependencies.forEach(l=>s.add(l))}return{dependencies:s,expressions:r}}const tt=1;let V=class extends ce{constructor(t){super(t),this._compileTask=null,this._evaluateTask=null,this.expressionInfo=null,this.graphic=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._createVM=()=>{var r,n;const i=(r=this.contentElement)==null?void 0:r.type;(n=this.contentElementViewModel)==null||n.destroy();const s=i==="fields"?new Te:i==="media"?new Q:i==="text"?new Ie:null;this._set("contentElementViewModel",s)},this._compileThrottled=be(this._startCompile,()=>this.notifyChange("state"),tt,this),this._evaluateThrottled=be(this._startEvaluate,()=>this.notifyChange("state"),tt,this),this.addHandles([$(()=>[this.expressionInfo,this.graphic],()=>this._compileThrottled(),P),$(()=>[this.contentElement],()=>this._createVM(),P),pt(()=>{var r,n,o,l,c,u;if(!((r=this._compileTask)!=null&&r.finished))return null;const i=this._compileTask.value,s=i==null?void 0:i.dependencies;return[i,this.spatialReference,this.map,this.view,s!=null&&s.has("view-scale")?(n=this.view)==null?void 0:n.scale:null,s!=null&&s.has("view-time-extent")?(l=(o=this.view)==null?void 0:o.timeExtent)==null?void 0:l.start:null,s!=null&&s.has("view-time-extent")?(u=(c=this.view)==null?void 0:c.timeExtent)==null?void 0:u.end:null]},([i])=>this._evaluateThrottled(i))])}initialize(){this.addHandles([this._compileThrottled,this._evaluateThrottled])}destroy(){var t;this._compileTask=X(this._compileTask),this._evaluateTask=X(this._evaluateTask),(t=this.contentElementViewModel)==null||t.destroy(),this._set("contentElementViewModel",null)}get contentElement(){var t;return(t=this._evaluateTask)==null?void 0:t.value}get spatialReference(){var t;return((t=this.view)==null?void 0:t.spatialReference)??null}set spatialReference(t){this._override("spatialReference",t)}get state(){var s,r;const{contentElement:t,contentElementViewModel:i}=this;return this._compileThrottled.hasPendingUpdates()||this._evaluateThrottled.hasPendingUpdates()||!((s=this._compileTask)!=null&&s.finished)||!((r=this._evaluateTask)!=null&&r.finished)?"loading":t||i?"ready":"disabled"}get map(){var t;return((t=this.view)==null?void 0:t.map)??null}set map(t){this._override("map",t)}_startCompile(){this._evaluateTask=X(this._evaluateTask),this._compileTask=X(this._compileTask),this._compileTask=ve(async t=>{const{expressionInfo:i,graphic:s}=this;if(!i||!s)return null;const r=await Mt();ae(t);const n=await xt({expressionInfo:i,arcade:r,graphic:s});return ae(t),n})}_startEvaluate(t){this._evaluateTask=X(this._evaluateTask),this._evaluateTask=ve(async i=>{const{graphic:s}=this;if(!t||!s)return null;const{interceptor:r,spatialReference:n,map:o,location:l,view:c}=this,u=await t.evaluate({graphic:s,interceptor:r,location:l,map:o,options:{signal:i},spatialReference:n,view:c});ae(i);const p=u;if(!p||p.declaredClass!=="esri.arcade.Dictionary")return null;const h=await p.castAsJsonAsync(i);ae(i);const _=h==null?void 0:h.type,f=_==="media"?Ut.fromJSON(h):_==="text"?ft.fromJSON(h):_==="fields"?Ht.fromJSON(h):null;return f.type==="media"&&!f.mediaInfos||f.type==="fields"&&!f.fieldInfos||f.type==="text"&&!f.text?null:f})}};a([d()],V.prototype,"_compileTask",void 0),a([d()],V.prototype,"_evaluateTask",void 0),a([d({type:jt})],V.prototype,"expressionInfo",void 0),a([d({type:Oe})],V.prototype,"graphic",void 0),a([d({readOnly:!0})],V.prototype,"contentElement",null),a([d({readOnly:!0})],V.prototype,"contentElementViewModel",void 0),a([d()],V.prototype,"interceptor",void 0),a([d({type:wt})],V.prototype,"location",void 0),a([d()],V.prototype,"spatialReference",null),a([d({readOnly:!0})],V.prototype,"state",null),a([d()],V.prototype,"map",null),a([d()],V.prototype,"view",void 0),V=a([O("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],V);const He=V,it="esri-feature",st={base:`${it}-expression`,loadingSpinnerContainer:`${it}__loading-container`};let fe=class extends J{constructor(e,t){super(e,t),this._contentWidget=null,this.viewModel=new He}initialize(){this.addHandles($(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),P))}loadDependencies(){return Ae({loader:()=>M(()=>import("./index-CMxz6F2k.js"),__vite__mapDeps([169,12,4,1,2,3,5,6,7,13,14,15,16,18,170]),import.meta.url)})}destroy(){this._destroyContentWidget()}render(){var t;const{state:e}=this.viewModel;return m("div",{class:st.base},e==="loading"?this._renderLoading():e==="disabled"?null:(t=this._contentWidget)==null?void 0:t.render())}_renderLoading(){return m("div",{class:st.loadingSpinnerContainer,key:"loading-container"},m("calcite-loader",{inline:!0,label:""}))}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:t}=this.viewModel,i=t==null?void 0:t.type;this._destroyContentWidget();const s=e?i==="fields"?new bt({viewModel:e}):i==="media"?new It({viewModel:e}):i==="text"?new he({viewModel:e}):null:null;this._contentWidget=s,this.scheduleRender()}};a([d({type:He})],fe.prototype,"viewModel",void 0),fe=a([O("esri.widgets.Feature.FeatureExpression")],fe);const Ki=fe;var _e;const ye="esri-feature",oe=`${ye}-relationship`,B={base:oe,listContainer:`${oe}__list`,listItem:`${oe}__list-item`,listItemHidden:`${oe}__list-item--hidden`,listContainerQuerying:`${oe}__list--querying`,featureObserver:`${ye}__feature-observer`,stickySpinnerContainer:`${ye}__sticky-loading-container`,loadingSpinnerContainer:`${ye}__loading-container`},rt={title:!0,description:!0};let E=_e=class extends J{constructor(e,t){super(e,t),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([i])=>{i!=null&&i.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.flowItems=null,this.flowType="feature-relationship",this.headingLevel=2,this.viewModel=new Pe,this.messages=null,this.messagesCommon=null,this.visibleElements={...rt},this._increaseFeaturePage=()=>{const{state:i,showAllEnabled:s,relatedFeatures:r,featuresPerPage:n,featurePage:o}=this.viewModel;i==="ready"&&s&&r.length>=n*o&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new xe,this.addHandles([$(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),P),$(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),ht(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return Ae({chip:()=>M(()=>import("./index-BtUFGore.js"),__vite__mapDeps([171,11,12,4,1,2,3,5,6,7,13,14,15,16,17,18,19,172,173,174,175,176,177,170]),import.meta.url),icon:()=>M(()=>import("./index-DwIhxbHs.js").then(e=>e.i),__vite__mapDeps([11,12,4,1,2,3,5,6,7,13,14,15,16,17,18,19]),import.meta.url),list:()=>M(()=>import("./index-BCDLx0rN.js"),__vite__mapDeps([178,169,12,4,1,2,3,5,6,7,13,14,15,16,18,170,179,172,173,19,17,180,11,181,182,183,184,185,186,175,176,187,174,188,177,189,190,191,192,193,194]),import.meta.url),"list-item":()=>M(()=>import("./index-B0pN5y8B.js"),__vite__mapDeps([195,11,12,4,1,2,3,5,6,7,13,14,15,16,17,18,19,196,172,173,197,193,175,176,174,198,199,169,170,200,180,177,201,202,203,204,194,205]),import.meta.url),loader:()=>M(()=>import("./index-CMxz6F2k.js"),__vite__mapDeps([169,12,4,1,2,3,5,6,7,13,14,15,16,18,170]),import.meta.url),notice:()=>M(()=>import("./index-CV25o1as.js"),__vite__mapDeps([206,11,12,4,1,2,3,5,6,7,13,14,15,16,17,18,19,172,173,174,207,198,177,170]),import.meta.url)})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=$t(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:e,featureCount:t,displayCount:i,state:s,allCategoriesCount:r}=this.viewModel;return!e&&s==="ready"&&(!!r&&(r>i||i===0)||!!t&&(t>i||i===0))}get displayListItems(){const{relatedFeatureViewModels:e,allCategoriesCount:t}=this.viewModel;return this.displayShowAllButton||!!e.length||!!t}get allItemsDescription(){const{messages:e}=this,{featureCount:t,allCategories:i,allCategoriesCount:s}=this.viewModel;return We(e==null?void 0:e.numberRecords,{number:ze(i?s:t)})}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get title(){const{activeCategory:e,title:t}=this.viewModel;return(e==null?void 0:e.name)??t}set title(e){this.viewModel.title=e}castVisibleElements(e){return{...rt,...e}}render(){var t;const{state:e}=this.viewModel;return m("div",{class:this.classes(B.base,Ce.widget)},(t=this._featureElementInfo)==null?void 0:t.render(),e==="loading"?this._renderLoading():e==="disabled"?this._renderRelationshipNotFound():this._renderRelatedFeatures())}async _selectCategory(e){const{flowItems:t,featureVisibleElements:i,viewModel:s}=this;t&&(s.activeCategory=e,s.showAllEnabled=!0,t.push(new _e({flowItems:t,featureVisibleElements:i,visibleElements:{title:!1,description:!1},viewModel:s})))}async _selectRecord(e){const{flowItems:t,featureVisibleElements:i}=this;if(!t)return;e.abilities={relationshipContent:!0};const{default:s}=await M(()=>Promise.resolve().then(()=>is),void 0,import.meta.url);t.push(new s({flowItems:t,flowType:this.flowType,viewModel:e,visibleElements:i}))}_showAllRecords(){const{flowItems:e}=this;if(!e)return;const{viewModel:t,featureVisibleElements:i}=this;t.showAllEnabled=!0;const s=new _e({flowItems:e,featureVisibleElements:i,visibleElements:{title:!1,description:!1},viewModel:t});e.push(s)}_renderStickyLoading(){return this.viewModel.state==="querying"?m("div",{class:B.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return m("calcite-loader",{inline:!0,label:""})}_renderLoading(){return m("div",{class:B.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return m("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){const e=le(this.container)?"chevron-left":"chevron-right";return m("calcite-icon",{icon:e,scale:"s",slot:"content-end"})}_renderCategory(e){const{count:t,name:i,value:s}=e,r=ze(t);return m("calcite-list-item",{class:B.listItem,disabled:!t,key:s,label:i,onCalciteListItemSelect:()=>this._selectCategory(e)},m("calcite-chip",{label:r,scale:"s",slot:"content-end"},r),this._renderChevronIconNode())}_renderRelatedFeature(e){var r;const{itemDescriptionFieldName:t}=this.viewModel,i=e.title;e.description=t&&((r=e.formattedAttributes)==null?void 0:r.global[t]);const s=e.state==="loading";return m("calcite-list-item",{class:this.classes(B.listItem,{[B.listItemHidden]:s}),description:Xe(e.description??""),key:e.uid,label:Xe(i),onCalciteListItemSelect:()=>this._selectRecord(e)},this._renderChevronIconNode())}_renderShowAllListItem(){var e;return this.displayShowAllButton?m("calcite-list-item",{description:this.allItemsDescription,key:"show-all-item",label:(e=this.messages)==null?void 0:e.showAll,onCalciteListItemSelect:()=>this._showAllRecords()},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){var e;return m("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},m("div",{slot:"message"},(e=this.messages)==null?void 0:e.noRelatedFeatures))}_renderFeatureObserver(){return m("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:B.featureObserver,key:"feature-observer"})}_renderList(){var i;const{relatedFeatureViewModels:e,categories:t}=this.viewModel;return m("calcite-list",{displayMode:"flat",label:(i=this.messages)==null?void 0:i.relatedFeaturesList},(t==null?void 0:t.map(s=>this._renderCategory(s)))??e.toArray().map(s=>this._renderRelatedFeature(s)),this._renderShowAllListItem())}_renderRelatedFeatures(){const{displayListItems:e}=this,{state:t}=this.viewModel;return m("div",{class:this.classes(B.listContainer,{[B.listContainerQuerying]:t==="querying"}),key:"list-container"},e?this._renderList():t==="ready"?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){var e;return m("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},m("div",{slot:"message"},(e=this.messages)==null?void 0:e.relationshipNotFound))}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:e}=this.viewModel,t="related-feature-viewmodels";this.removeHandles(t),e==null||e.forEach(i=>{this.addHandles($(()=>[i.title,i.state],()=>this.scheduleRender(),P),t)}),this.scheduleRender()}_setupFeatureElementInfo(){var r;const{headingLevel:e,visibleElements:t}=this,i=t.description&&this.description,s=t.title&&this.title;(r=this._featureElementInfo)==null||r.set({description:i,title:s,headingLevel:e})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:e,showAllEnabled:t}=this.viewModel;await Rt(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&t&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};a([d()],E.prototype,"_relatedFeatureIntersectionObserverNode",void 0),a([d({readOnly:!0})],E.prototype,"displayShowAllButton",null),a([d({readOnly:!0})],E.prototype,"displayListItems",null),a([d({readOnly:!0})],E.prototype,"allItemsDescription",null),a([d()],E.prototype,"description",null),a([d()],E.prototype,"featureVisibleElements",void 0),a([d()],E.prototype,"flowItems",void 0),a([d()],E.prototype,"flowType",void 0),a([d()],E.prototype,"headingLevel",void 0),a([d()],E.prototype,"title",null),a([d({type:Pe})],E.prototype,"viewModel",void 0),a([d(),G("esri/widgets/Feature/t9n/Feature")],E.prototype,"messages",void 0),a([d(),G("esri/t9n/common")],E.prototype,"messagesCommon",void 0),a([d()],E.prototype,"visibleElements",void 0),a([Me("visibleElements")],E.prototype,"castVisibleElements",null),E=_e=a([O("esri.widgets.Feature.FeatureRelationship")],E);const Qi=E;let Gi=class{constructor(t,i){this.preLayerQueryCallback=t,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=s=>{}),this.preRequestCallback||(this.preLayerQueryCallback=s=>{})}};var te;const nt=1,ot="content-view-models",at="relationship-view-models",Ji="association-view-models",lt={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0,utilityNetworkAssociationsContent:!0};let I=te=class extends pi.IdentifiableMixin(ce){constructor(e){super(e),this._error=null,this._graphicChangedTask=null,this._evaluateExpressionAttributesTask=null,this._associationVMAbortController=null,this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...lt},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._graphicChangedThrottled=be(this._graphicChanged,()=>this.notifyChange("waitingForContent"),nt,this),this._isAllowedContentType=t=>{const{abilities:i}=this;return t.type==="attachments"&&!!i.attachmentsContent||t.type==="custom"&&!!i.customContent||t.type==="fields"&&!!i.fieldsContent||t.type==="media"&&!!i.mediaContent||t.type==="text"&&!!i.textContent||t.type==="expression"&&!!i.expressionContent||t.type==="relationship"&&!!i.relationshipContent||t.type==="utility-network-associations"&&!!i.utilityNetworkAssociationsContent},this._evaluateExpressionAttributesThrottled=be(this._evaluateExpressionAttributes,()=>this.notifyChange("waitingForContent"),nt,this),this.addHandles([$(()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone],()=>this._graphicChangedThrottled(),P),pt(()=>{var s,r,n,o,l,c,u;if(!((s=this._graphicChangedTask)!=null&&s.finished)||this._graphicChangedTask.value==null)return null;const t=this._graphicChangedTask.value,i=(r=t==null?void 0:t.expressionInfos)==null?void 0:r.dependencies;return[t,i!=null&&i.has("view-scale")?(n=this.view)==null?void 0:n.scale:null,i!=null&&i.has("view-time-extent")?(l=(o=this.view)==null?void 0:o.timeExtent)==null?void 0:l.start:null,i!=null&&i.has("view-time-extent")?(u=(c=this.view)==null?void 0:c.timeExtent)==null?void 0:u.end:null]},([t])=>this._evaluateExpressionAttributesThrottled(t))])}initialize(){this.addHandles([this._graphicChangedThrottled,this._evaluateExpressionAttributesThrottled])}destroy(){this._clear(),this._graphicChangedTask=X(this._graphicChangedTask),this._evaluateExpressionAttributesTask=X(this._evaluateExpressionAttributesTask),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return this.graphic!=null?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return zt(Ke(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return Yt(this.graphic)}castAbilities(e){return{...lt,...e}}get isTable(){var e;return((e=this._sourceLayer)==null?void 0:e.isTable)||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",(e==null?void 0:e.clone())??null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)??null}set spatialReference(e){this._override("spatialReference",e)}get timeZone(){var e;return((e=this.view)==null?void 0:e.timeZone)??hi}set timeZone(e){this._overrideIfSome("timeZone",e)}get map(){var e;return((e=this.view)==null?void 0:e.map)||null}set map(e){this._override("map",e)}get waitingForContent(){const{_graphicChangedThrottled:e,_evaluateExpressionAttributesThrottled:t,_graphicChangedTask:i,_evaluateExpressionAttributesTask:s,_associationVMAbortController:r}=this;return e.hasPendingUpdates()||t.hasPendingUpdates()||i!=null&&!i.finished||s!=null&&!s.finished||!!r}setActiveMedia(e,t){const i=this.contentViewModels[e];i instanceof Q&&i.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof Q&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof Q&&t.previous()}async updateGeometry(){var o;const{graphic:e,spatialReference:t,_sourceLayer:i}=this;await(i==null?void 0:i.load());const s=i==null?void 0:i.objectIdField;if(!s||!e||!i)return;const r=(o=e==null?void 0:e.attributes)==null?void 0:o[s];if(r==null)return;const n=[r];if(!e.geometry){const l=await Zt({layer:i,graphic:e,outFields:[],objectIds:n,returnGeometry:!0,spatialReference:t}),c=l==null?void 0:l.geometry;c&&(e.geometry=c)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}_graphicChanged(){this._evaluateExpressionAttributesTask=X(this._evaluateExpressionAttributesTask),this._graphicChangedTask=X(this._graphicChangedTask),this._graphicChangedTask=ve(async e=>{this._error=null,this._clear();const{graphic:t}=this;try{if(!t)return null;const{_sourceLayer:i,_effectivePopupTemplate:s}=this,r=this.spatialReference;await qt({graphic:t,popupTemplate:s,layer:i,spatialReference:r},{signal:e});const[{value:n},{value:o}]=await ie([this._getContent(),this._getTitle()]),[,{value:l}]=await ie([this._checkForRelatedFeatures({signal:e}),qi(s==null?void 0:s.expressionInfos,t)]);return{expressionInfos:l,content:n,title:o}}catch(i){throw Be(i)||(this._error=i,ge.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:t,popupTemplate:this._effectivePopupTemplate})),i}})}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):e.type==="relationship"?this._compileRelationship(e,t):e.type==="utility-network-associations"?this._compileUtilityNetworkAssociation(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,i)=>this._compileContentElement(t,i)).filter(ut):typeof e=="string"?this._compileText(new ft({text:e}),0).text:e}_destroyContentViewModels(){this.removeHandles(at),this.removeHandles(ot),this.contentViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("contentViewModels",[])}_matchesFeature(e,t){var r;const i=(r=e==null?void 0:e.graphic)==null?void 0:r.getObjectId(),s=t==null?void 0:t.getObjectId();return i!=null&&s!=null&&i===s}_setRelatedFeaturesViewModels({relatedFeatureViewModels:e,relatedFeatures:t,map:i}){const{view:s,spatialReference:r,timeZone:n}=this;t==null||t.filter(Boolean).forEach(o=>{e.some(l=>this._matchesFeature(l,o))||e.add(new te({abilities:{relationshipContent:!1},map:i,view:s,spatialReference:r,timeZone:n,graphic:o}))}),e.forEach(o=>{(t==null?void 0:t.find(c=>this._matchesFeature(o,c)))||e.remove(o)})}_setExpressionContentVM(e,t){const i=this.formattedAttributes,{contentElement:s,contentElementViewModel:r}=e,n=s==null?void 0:s.type;r&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:s,contentElementIndex:t,formattedAttributes:i}),r.set(this._createFieldsVMParams(s,t))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:s,contentElementIndex:t,formattedAttributes:i}),r.set(this._createMediaVMParams(s,t))),n==="text"&&r.set(this._createTextVMParams(s)))}_compileRelationship(e,t){const{displayCount:i,orderByFields:s,relationshipId:r,title:n,description:o}=e,{_sourceLayer:l,graphic:c,map:u}=this;if(!Kt(l))return;const p=new Pe({displayCount:i,graphic:c,orderByFields:s,relationshipId:r,layer:l,map:u,...this._compileTitleAndDesc({title:n,description:o})});return this.contentViewModels[t]=p,this.addHandles(ht(()=>p.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(p)),at),e}_matchesGlobalFeature(e,t){const i=e==null?void 0:e.association.globalId,s=t==null?void 0:t.association.globalId;return i!=null&&s!=null&&i===s}async _setUpUtilityNetworkAssociationsViewModels(e,t,i){const{view:s,spatialReference:r,timeZone:n}=this;e.forEach((l,c)=>{const u=t.get(c);u?l.forEach(p=>{u.find(h=>this._matchesGlobalFeature(p,h))||(l.remove(p),l.length===0&&e.delete(c))}):(l.removeAll(),e.delete(c))}),t.forEach((l,c)=>{const u=e.get(c)||new Lt;l==null||l.filter(Boolean).forEach(p=>{u.some(h=>this._matchesGlobalFeature(h,p))||u.add({association:p.association,featureViewModel:new te({abilities:{utilityNetworkAssociationsContent:!1},map:i,view:s,spatialReference:r,timeZone:n,graphic:p.feature}),terminalName:p.terminalName})}),e.set(c,u)});const o=new AbortController;this._associationVMAbortController=o,await this._sortListObjectsByTitle(e,{signal:o.signal}),this._associationVMAbortController===o&&(this._associationVMAbortController=null)}async _sortListObjectsByTitle(e,t){for(const i of e.values()){const s=i.map(r=>kt(()=>r.featureViewModel.state==="ready",t==null?void 0:t.signal));await Promise.all(s),i.sort(this._compareByFeatureTitle)}}_compareByFeatureTitle(e,t){const i=Qe(e.featureViewModel),s=Qe(t.featureViewModel);return i.localeCompare(s,void 0,{numeric:!0})}_compileUtilityNetworkAssociation(e,t){const{displayCount:i,title:s,description:r,associationTypes:n}=e,{_sourceLayer:o,graphic:l,map:c}=this;if(!Qt(o))return;const u=new Ot({graphic:l,displayCount:i,associationTypes:n,layer:o,map:c,...this._compileTitleAndDesc({title:s,description:r})});return this.contentViewModels[t]=u,this.addHandles([$(()=>u.associationFeatures.values(),()=>this._setUpUtilityNetworkAssociationsViewModels(u.associationViewModels,u.associationFeatures,u.map))],Ji),e}_compileExpression(e,t){const{expressionInfo:i}=e,{graphic:s,map:r,spatialReference:n,view:o,location:l}=this,c=new He({expressionInfo:i,graphic:s,interceptor:te.interceptor,map:r,spatialReference:n,view:o,location:l});return this.contentViewModels[t]=c,this.addHandles($(()=>c.contentElementViewModel,()=>this._setExpressionContentVM(c,t),P),ot),e}_compileAttachments(e,t){const{graphic:i}=this,{description:s,title:r,orderByFields:n}=e;return this.contentViewModels[t]=new Ue({graphic:i,orderByFields:n,...this._compileTitleAndDesc({title:r,description:s})}),e}_compileCustom(e,t){const{graphic:i}=this,{creator:s,destroyer:r}=e;return this.contentViewModels[t]=new Ie({graphic:i,creator:s,destroyer:r}),e}_compileTitleAndDesc({title:e,description:t}){const{_fieldInfoMap:i,_sourceLayer:s,graphic:r,formattedAttributes:n}=this,o=r==null?void 0:r.attributes,l=this._expressionAttributes,c=n.global;return{title:K({attributes:o,fieldInfoMap:i,globalAttributes:c,expressionAttributes:l,layer:s,text:e}),description:K({attributes:o,fieldInfoMap:i,globalAttributes:c,expressionAttributes:l,layer:s,text:t})}}_createFieldsVMParams(e,t){const i=this._effectivePopupTemplate,s=this.formattedAttributes,r={...s==null?void 0:s.global,...s==null?void 0:s.content[t]},n=(e==null?void 0:e.fieldInfos)||(i==null?void 0:i.fieldInfos),o=n==null?void 0:n.filter(({fieldName:p})=>!!p&&(gt(p)||q(p)||r.hasOwnProperty(p))),l=i==null?void 0:i.expressionInfos,{description:c,title:u}=e;return{attributes:r,expressionInfos:l,fieldInfos:o,...this._compileTitleAndDesc({title:u,description:c})}}_compileFields(e,t){const i=e.clone(),s=new Te(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=s,i.fieldInfos=s.formattedFieldInfos.slice(),i}_createMediaVMParams(e,t){const{abilities:i,graphic:s,_fieldInfoMap:r,_effectivePopupTemplate:n,relatedInfos:o,_sourceLayer:l,_expressionAttributes:c}=this,u=this.formattedAttributes,p=(s==null?void 0:s.attributes)??{},{description:h,mediaInfos:_,title:f}=e;return{abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:p,isAggregate:s==null?void 0:s.isAggregate,layer:l,fieldInfoMap:r,formattedAttributes:{...u==null?void 0:u.global,...u==null?void 0:u.content[t]},expressionAttributes:c,mediaInfos:_,popupTemplate:n,relatedInfos:o,...this._compileTitleAndDesc({title:f,description:h})}}_compileMedia(e,t){const i=e.clone(),s=new Q(this._createMediaVMParams(e,t));return i.mediaInfos=s.formattedMediaInfos.slice(),this.contentViewModels[t]=s,i}_createTextVMParams(e){var n;const{graphic:t,_fieldInfoMap:i,_sourceLayer:s,_expressionAttributes:r}=this;if(e&&e.text){const o=(t==null?void 0:t.attributes)??{},l=((n=this.formattedAttributes)==null?void 0:n.global)??{};e.text=K({attributes:o,fieldInfoMap:i,globalAttributes:l,expressionAttributes:r,layer:s,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){const i=e.clone();return this.contentViewModels[t]=new Ie(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i,timeZone:s}=this;if(!e)return;const{lastEditInfoEnabled:r}=e,n=t==null?void 0:t.editFieldsInfo;return r&&n?Gt(n,i==null?void 0:i.attributes,s,t):void 0}_compileTitle(e){var l;const{_fieldInfoMap:t,_sourceLayer:i,graphic:s,_expressionAttributes:r}=this,n=(s==null?void 0:s.attributes)??{},o=((l=this.formattedAttributes)==null?void 0:l.global)??{};return K({attributes:n,fieldInfoMap:t,globalAttributes:o,expressionAttributes:r,layer:i,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this;return t?we({type:"title",value:e==null?void 0:e.title,event:{graphic:t}}):null}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this;return t?we({type:"content",value:e==null?void 0:e.content,event:{graphic:t}}):null}_evaluateExpressionAttributes({title:e,content:t,expressionInfos:i}){this._evaluateExpressionAttributesTask=X(this._evaluateExpressionAttributesTask),this._evaluateExpressionAttributesTask=ve(async s=>{const{graphic:r,map:n,view:o,spatialReference:l,location:c}=this;try{if(!r)return;let u;if(i!=null){const p=[];for(const[h,_]of i.expressions.entries())_!=null?p.push(_.evaluate({graphic:r,interceptor:te.interceptor,location:c,map:n,options:{signal:s},spatialReference:l,view:o}).then(f=>[h,Ni(f)]).catch(()=>[h,void 0])):p.push(Promise.resolve([h,void 0]));u=Object.fromEntries(await Promise.all(p)),ae(s)}this._expressionAttributes=u,this._graphicExpressionAttributes={...r.attributes,...u},this._set("formattedAttributes",this._createFormattedAttributes(t)),this._set("title",this._compileTitle(e)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(t)||null)}catch(u){Be(u)||(this._error=u,ge.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:u,graphic:r,popupTemplate:this._effectivePopupTemplate}))}})}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){const{_effectivePopupTemplate:s,graphic:r,relatedInfos:n,_sourceLayer:o,_fieldInfoMap:l,_graphicExpressionAttributes:c,timeZone:u}=this;i.content[t]=Fe({fieldInfos:s==null?void 0:s.fieldInfos,graphic:r,attributes:{...c,...e.attributes},layer:o,fieldInfoMap:l,relatedInfos:n,timeZone:u})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){if(e.fieldInfos){const{graphic:s,relatedInfos:r,_sourceLayer:n,_fieldInfoMap:o,_graphicExpressionAttributes:l,timeZone:c}=this;i.content[t]=Fe({fieldInfos:e.fieldInfos,graphic:s,attributes:{...l,...e.attributes},layer:n,fieldInfoMap:o,relatedInfos:r,timeZone:c})}}_createFormattedAttributes(e){const{_effectivePopupTemplate:t,graphic:i,relatedInfos:s,_sourceLayer:r,_fieldInfoMap:n,_graphicExpressionAttributes:o,timeZone:l}=this,c=t==null?void 0:t.fieldInfos,u={global:Fe({fieldInfos:c,graphic:i,attributes:o,layer:r,fieldInfoMap:n,relatedInfos:s,timeZone:l}),content:[]};return Array.isArray(e)&&e.forEach((p,h)=>{p.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:p,contentElementIndex:h,formattedAttributes:u}),p.type==="media"&&this._createMediaFormattedAttributes({contentElement:p,contentElementIndex:h,formattedAttributes:u})}),u}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,Ke(i),e)}async _queryRelatedInfos(e,t,i){const{relatedInfos:s,_sourceLayer:r}=this;s.clear();const n=(r==null?void 0:r.associatedLayer)!=null?await(r==null?void 0:r.associatedLayer.load(i)):r;if(!n||!e)return;const o=t.filter(u=>!!u.fieldName&&q(u.fieldName));if(!(o!=null&&o.length))return;t.forEach(u=>this._configureRelatedInfo(u,n));const l=await Fi({relatedInfos:s,layer:n},i);Object.keys(l).forEach(u=>{var _;const p=s.get(u.toString()),h=(_=l[u])==null?void 0:_.value;p&&h&&(p.layerInfo=h.data)});const c=await $i({graphic:e,relatedInfos:s,layer:n},i);Object.keys(c).forEach(u=>{var p;Ii((p=c[u])==null?void 0:p.value,s.get(u.toString()))})}_configureRelatedInfo(e,t){const{relatedInfos:i}=this,s=me(e.fieldName||"");if(!s)return;const{layerId:r,fieldName:n}=s;if(!r)return;const o=i.get(r.toString())||bi(r,t);o&&(Ri({relatedInfo:o,fieldName:n,fieldInfo:e}),this.relatedInfos.set(r,o))}};I.interceptor=new Gi(Jt,ei),a([d()],I.prototype,"_error",void 0),a([d()],I.prototype,"_graphicChangedTask",void 0),a([d()],I.prototype,"_evaluateExpressionAttributesTask",void 0),a([d()],I.prototype,"_associationVMAbortController",void 0),a([d({readOnly:!0})],I.prototype,"_effectivePopupTemplate",null),a([d({readOnly:!0})],I.prototype,"_fieldInfoMap",null),a([d({readOnly:!0})],I.prototype,"_sourceLayer",null),a([d()],I.prototype,"abilities",void 0),a([Me("abilities")],I.prototype,"castAbilities",null),a([d({readOnly:!0})],I.prototype,"content",void 0),a([d({readOnly:!0})],I.prototype,"contentViewModels",void 0),a([d()],I.prototype,"description",void 0),a([d({type:Boolean})],I.prototype,"defaultPopupTemplateEnabled",void 0),a([d({readOnly:!0})],I.prototype,"isTable",null),a([d({readOnly:!0})],I.prototype,"state",null),a([d({readOnly:!0})],I.prototype,"formattedAttributes",void 0),a([d({type:Oe,value:null})],I.prototype,"graphic",null),a([d({readOnly:!0})],I.prototype,"lastEditInfo",void 0),a([d({type:wt})],I.prototype,"location",void 0),a([d({readOnly:!0})],I.prototype,"relatedInfos",void 0),a([d({type:di})],I.prototype,"spatialReference",null),a([d()],I.prototype,"timeZone",null),a([d({readOnly:!0})],I.prototype,"title",void 0),a([d()],I.prototype,"map",null),a([d({readOnly:!0})],I.prototype,"waitingForContent",null),a([d()],I.prototype,"view",void 0),I=te=a([O("esri.widgets.Feature.FeatureViewModel")],I);const Ct=I,H="esri-feature",x={base:H,container:`${H}__size-container`,title:`${H}__title`,main:`${H}__main-container`,contentNode:`${H}__content-node`,contentNodeText:`${H}__content-node--text`,contentElement:`${H}__content-element`,text:`${H}__text`,lastEditedInfo:`${H}__last-edited-info`,loadingSpinnerContainer:`${H}__loading-container`},es=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=i=>vt(i)&&!i.destroyed?m("div",{class:x.contentNode,key:i},i.render()):i instanceof HTMLElement?m("div",{afterCreate:this._attachToNode,bind:i,class:x.contentNode,key:i}):ti(i)?m("div",{afterCreate:this._attachToNode,bind:i.domNode,class:x.contentNode,key:i}):null}_attachToNode(i){const s=this;i.appendChild(s)}};return t=a([O("esri.widgets.Feature.support.FeatureContentMixin")],t),t},dt={title:!0,content:!0,lastEditedInfo:!0};let A=class extends es(J){constructor(e,t){super(e,t),this._contentWidgets=[],this.flowType="feature",this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements={...dt},this.viewModel=new Ct}initialize(){this.addHandles($(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentViewModels},()=>this._setupContentWidgets(),P))}loadDependencies(){return Ae({notice:()=>M(()=>import("./index-CV25o1as.js"),__vite__mapDeps([206,11,12,4,1,2,3,5,6,7,13,14,15,16,17,18,19,172,173,174,207,198,177,170]),import.meta.url),loader:()=>M(()=>import("./index-CMxz6F2k.js"),__vite__mapDeps([169,12,4,1,2,3,5,6,7,13,14,15,16,18,170]),import.meta.url)})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get isTable(){return this.viewModel.isTable}get icon(){return"polygon"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get title(){return this.viewModel.title}castVisibleElements(e){return{...dt,...e}}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}setActiveMedia(e,t){return this.viewModel.setActiveMedia(e,t)}nextMedia(e){return this.viewModel.nextMedia(e)}previousMedia(e){return this.viewModel.previousMedia(e)}render(){const{state:e}=this.viewModel,t=m("div",{class:x.container,key:"container"},this._renderTitle(),e==="error"?this._renderError():e==="loading"?this._renderLoading():this._renderContentContainer());return m("div",{class:this.classes(x.base,Ce.widget)},t)}_renderError(){const{messagesCommon:e,messages:t,visibleElements:i}=this;return m("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},i.title?m("div",{key:"error-title",slot:"title"},e.errorMessage):null,m("div",{key:"error-message",slot:"message"},t.loadingError))}_renderLoading(){return m("div",{class:x.loadingSpinnerContainer,key:"loading-container"},m("calcite-loader",{inline:!0,label:""}))}_renderContentContainer(){const{visibleElements:e}=this;return e.content?m("div",{class:x.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){const{visibleElements:e,title:t}=this;return e.title?m(mi,{class:x.title,innerHTML:t,level:this.headingLevel}):null}_renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?m("div",{class:x.contentNode,key:`${t}-content-elements`},e.map(this._renderContentElement,this)):null;if(typeof e=="string"){const i=this._contentWidgets[0];return!i||i.destroyed?null:m("div",{class:this.classes(x.contentNode,x.contentNodeText),key:`${t}-content`},i.render())}return this.renderNodeContent(e)}_renderContentElement(e,t){var s;const{visibleElements:i}=this;if(typeof i.content!="boolean"&&!((s=i.content)!=null&&s[e.type]))return null;switch(e.type){case"attachments":return this._renderAttachments(t);case"custom":return this._renderCustom(e,t);case"fields":return this._renderFields(t);case"media":return this._renderMedia(t);case"text":return this._renderText(e,t);case"expression":return this._renderExpression(t);case"relationship":return this._renderRelationship(t);case"utility-network-associations":return this._renderAssociation(t);default:return null}}_renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:i,attachmentInfos:s}=t.viewModel;return i==="loading"||s.length>0?m("div",{class:this.classes(x.contentElement),key:this._buildKey("attachments-element",e)},t.render()):null}_renderRelationship(e){const t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?m("div",{class:x.contentElement,key:this._buildKey("relationship-element",e)},t.render()):null}_renderAssociation(e){const t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?m("div",{class:x.contentElement,key:this._buildKey("utility-network-association-element",e)},t.render()):null}_renderExpression(e){const t=this._contentWidgets[e];return t&&!t.destroyed&&t.viewModel.contentElement?m("div",{class:x.contentElement,key:this._buildKey("expression-element",e)},t.render()):null}_renderCustom(e,t){const{creator:i}=e,s=this._contentWidgets[t];return!s||s.destroyed?null:i?m("div",{class:x.contentElement,key:this._buildKey("custom-element",t)},s.render()):null}_renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:m("div",{class:x.contentElement,key:this._buildKey("fields-element",e)},t.render())}_renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:m("div",{class:x.contentElement,key:this._buildKey("media-element",e)},t.render())}_renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;const{date:s,user:r}=i,n=i.type==="edit"?r?t.lastEditedByUser:t.lastEdited:r?t.lastCreatedByUser:t.lastCreated,o=We(n,{date:s,user:r});return m("div",{class:this.classes(x.lastEditedInfo,x.contentElement),key:"edit-info-element"},o)}_renderText(e,t){const i=e.text,s=this._contentWidgets[t];return!s||s.destroyed?null:i?m("div",{class:this.classes(x.contentElement,x.text),key:this._buildKey("text-element",t)},s.render()):null}_buildKey(e,...t){var i,s;return`${e}__${((s=(i=this.viewModel)==null?void 0:i.graphic)==null?void 0:s.uid)||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t,flowItems:i,viewModel:s}=this,r=s==null?void 0:s.content,{contentViewModels:n}=s;if(Array.isArray(r))r.forEach((o,l)=>{if(o.type==="attachments"&&(this._contentWidgets[l]=new _i({displayType:o.displayType,headingLevel:t.title&&e<6?e+1:e,viewModel:n[l]})),o.type==="fields"&&(this._contentWidgets[l]=new bt({viewModel:n[l]})),o.type==="media"&&(this._contentWidgets[l]=new It({viewModel:n[l]})),o.type==="text"&&(this._contentWidgets[l]=new he({viewModel:n[l]})),o.type==="custom"&&(this._contentWidgets[l]=new he({viewModel:n[l]})),o.type==="expression"&&(this._contentWidgets[l]=new Ki({viewModel:n[l]})),o.type==="relationship"){const c=new Qi({flowItems:i,featureVisibleElements:t,viewModel:n[l]});this._contentWidgets[l]=c}if(o.type==="utility-network-associations"){const c=async p=>{const{viewModel:h,listType:_,title:f}=p;if(!i)return;h.activeAssociationType=_;const{default:y}=await M(()=>import("./FeatureUtilityNetworkAssociationList-CS-hnq6A.js"),__vite__mapDeps([208,5,6,4,1,2,3,7,154,29,30,14,13,15,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,209,12,16,210,211,212,72,213,68,57,58,69,70,71,214,215,107,108,109,65,88,216,56,217,218,219]),import.meta.url),g=new y({viewModel:h,parentFeatureViewModel:s,listType:_,title:f,featureVisibleElements:t,description:s.title,flowItems:i});i.push(g)},u=new Nt({flowItems:i,onSelectAssociationType:c,parentFeatureViewModel:s,featureVisibleElements:t,viewModel:n[l]});this._contentWidgets[l]=u}},this);else{const o=n[0];o&&!o.destroyed&&(this._contentWidgets[0]=new he({viewModel:o}))}this.scheduleRender()}};a([d()],A.prototype,"flowType",void 0),a([d()],A.prototype,"graphic",null),a([d()],A.prototype,"defaultPopupTemplateEnabled",null),a([d()],A.prototype,"flowItems",void 0),a([d()],A.prototype,"headingLevel",void 0),a([d({readOnly:!0})],A.prototype,"isTable",null),a([d()],A.prototype,"icon",null),a([d()],A.prototype,"label",null),a([d()],A.prototype,"location",null),a([d(),G("esri/widgets/Feature/t9n/Feature")],A.prototype,"messages",void 0),a([d(),G("esri/t9n/common")],A.prototype,"messagesCommon",void 0),a([d()],A.prototype,"spatialReference",null),a([d()],A.prototype,"timeZone",null),a([d({readOnly:!0})],A.prototype,"title",null),a([d()],A.prototype,"visibleElements",void 0),a([Me("visibleElements")],A.prototype,"castVisibleElements",null),a([d()],A.prototype,"map",null),a([d()],A.prototype,"view",null),a([d({type:Ct})],A.prototype,"viewModel",void 0),A=a([O("esri.widgets.Feature")],A);const ts=A,is=Object.freeze(Object.defineProperty({__proto__:null,default:ts},Symbol.toStringTag,{value:"Module"}));export{is as F,Ct as c,ts as j,es as n,x as t};
