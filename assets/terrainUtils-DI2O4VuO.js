import{V as B}from"./reactiveUtils-BFQ0BtrB.js";import{_ as M,f as _,y as J,an as N,i as U,W as K,l as Q,m as X,a3 as Y,k as P,ab as Z}from"./Point-DB4Hp4hH.js";import{M as ee}from"./layerUtils-erzwAANv.js";import{l as z}from"./ViewingMode-Dodu7ZZk.js";import{c as h}from"./subclass-BR3PhgZG.js";import{h as w,F as H,a3 as te,I as ie,a4 as ne,n as $,r as le,f as I,P as C,c as re,g as oe}from"./mathUtils-ClvKsMak.js";import{a as b,H as se,L as ae,o as ce}from"./Polyline-D97hl-6E.js";import"./geometry-DpwwkAX1.js";import{w as ue}from"./Extent-DHjqVB-p.js";import{z as y,p as O}from"./TileInfo-DkEc90N-.js";const fe=12;let x=class m{constructor(t){const i=m.checkUnsupported(t);if(i!=null)throw i;const n=t;this.spatialReference=n.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=J(this.spatialReference),this.origin=[n.origin.x,n.origin.y],this.pixelSize=n.size[0],this.dpi=n.dpi;const l=n.lods.reduce((c,f)=>(f.level<c.minLod.level&&(c.minLod=f),c.max=Math.max(c.max,f.level),c),{minLod:n.lods[0],max:-1/0}),r=l.minLod,s=2**r.level;let a=r.resolution*s,u=r.scale*s;this.levels=new Array(l.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:u,tileSize:[a*n.size[0],a*n.size[1]]},a/=2,u/=2}clone(){return new m(this.toTileInfo())}toTileInfo(){return new y({dpi:this.dpi,origin:new M({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,i)=>new O({level:i,scale:t.scale,resolution:t.resolution}))})}getExtent(t,i,n,l){const r=this.levels[t],s=r.tileSize[0],a=r.tileSize[1];l[0]=this.origin[0]+n*s,l[2]=this.origin[0]+(n+1)*s,l[3]=this.origin[1]-i*a,l[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(t,i){this._isWebMercator?(i[0]=N(t[0]),i[1]=U(t[1]),i[2]=N(t[2]),i[3]=U(t[3])):this._isGCS&&(i[0]=w(t[0]),i[1]=w(t[1]),i[2]=w(t[2]),i[3]=w(t[3]))}getExtentGeometry(t,i,n,l=new ue){return this.getExtent(t,i,n,g),l.spatialReference=this.spatialReference,l.xmin=g[0],l.ymin=g[1],l.xmax=g[2],l.ymax=g[3],l.zmin=void 0,l.zmax=void 0,l}ensureMaxLod(t){if(t==null)return!1;let i=!1;for(;this.levels.length<=t;){const{resolution:n,scale:l}=this.levels[this.levels.length-1],r=n/2*this.pixelSize;this.levels.push({resolution:n/2,scale:l/2,tileSize:[r,r]}),i=!0}return i}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const i=this.levels[0].scale;return t>=i?0:Math.log(i/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t,i=1/0){if(m.checkUnsupported(t))return!1;const n=new m(t);if(!n.spatialReference.equals(this.spatialReference)||n.pixelSize!==this.pixelSize)return!1;const l=Math.min(this.levels.length-1,n.levels.length-1,i),r=this.levels[l].resolution;let s=.5*r;return!H(n.origin[0],this.origin[0],s)||!H(n.origin[1],this.origin[1],s)?!1:(s=.5*r/2**l/this.pixelSize*fe,H(r,n.levels[l].resolution,s))}rootTilesInExtent(t,i=null,n=1/0){const l=new Array,r=this.levels[0].tileSize;if(t==null||r[0]===0||r[1]===0)return l;m.computeRowColExtent(t,r,this.origin,g);let s=g[1],a=g[3],u=g[0],c=g[2];const f=c-u,d=a-s;if(f*d>n){const p=Math.floor(Math.sqrt(n));d>p&&(s=s+Math.floor(.5*d)-Math.floor(.5*p),a=s+p),f>p&&(u=u+Math.floor(.5*f)-Math.floor(.5*p),c=u+p)}for(let p=s;p<a;p++)for(let W=u;W<c;W++)l.push([0,p,W]);return i!=null&&(i[0]=this.origin[0]+u*r[0],i[1]=this.origin[1]-a*r[1],i[2]=this.origin[0]+c*r[0],i[3]=this.origin[1]-s*r[1]),l}static computeRowColExtent(t,i,n,l){const r=.001*(t[2]-t[0]+(t[3]-t[1]));l[0]=Math.max(0,Math.floor((t[0]+r-n[0])/i[0])),l[2]=Math.max(0,Math.ceil((t[2]-r-n[0])/i[0])),l[1]=Math.max(0,Math.floor((n[1]-t[3]+r)/i[1])),l[3]=Math.max(0,Math.ceil((n[1]-t[1]-r)/i[1]))}static isPowerOfTwo(t){const i=t.lods,n=i[0].resolution*2**i[0].level;return!i.some(l=>!te(l.resolution,n/2**l.level))}static hasGapInLevels(t){const i=t.lods.map(n=>n.level);i.sort((n,l)=>n-l);for(let n=1;n<i.length;n++)if(i[n]!==i[0]+n)return!0;return!1}static tileSizeSupported(t){const i=t.size[1];return i===t.size[0]&&!(i&i-1)&&i>=128&&i<=512}static hasOriginPerLODs(t){const i=t.origin;return t.lods.some(n=>n.origin!=null&&(n.origin[0]!==i.x||n.origin[1]!==i.y))}static getMissingTileInfoError(){return new h("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return t==null?A():t.lods.length<1?new h("tilingscheme:generic","Tiling scheme must have at least one level"):m.isPowerOfTwo(t)?m.hasGapInLevels(t)?new h("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):m.tileSizeSupported(t)?m.hasOriginPerLODs(t)?new h("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new h("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new h("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,i){const n=t[2]-t[0],l=t[3]-t[1],r=K(i),s=1.2*Math.max(n,l),a=256,u=s/a,c=u*r*(96/.0254),f=new m(new y({size:[a,a],origin:new M({x:t[0]-.5*(s-n),y:t[3]+.5*(s-l)}),lods:[new O({level:0,resolution:u,scale:c})],spatialReference:i}));return f.ensureMaxLod(20),f}static makeWebMercatorAuxiliarySphere(t){const i=new m(m.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(t),i}static makeGCSWithTileSize(t,i=256,n=16){const l=256/i,r=new m(new y({size:[i,i],origin:new M({x:-180,y:90,spatialReference:t}),spatialReference:t,lods:[new O({level:0,resolution:.703125*l,scale:295497598570834e-6*l})]}));return r.ensureMaxLod(n),r}get test(){}};function A(){return new h("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}x.WebMercatorAuxiliarySphereTileInfo=new y({size:[256,256],origin:new M({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:_.WebMercator}),spatialReference:_.WebMercator,lods:[new O({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),x.WebMercatorAuxiliarySphere=x.makeWebMercatorAuxiliarySphere(19);const g=b(),G=64,Be=512,Je=2.5,Ke=ie(ne/10),Qe=2,he=b();x.WebMercatorAuxiliarySphere.getExtent(0,0,0,he);const Xe=b([-180,-90,180,90]),Ye="Cannot extend surface to encompass all layers because it would result in too many root tiles.",Ze="Surface extent is too large for tile resolution at level 0.",et=4;function me(e){return e!=null&&"type"in e&&e.type==="vector-tile"}function pe(e){return e!=null&&"type"in e&&e.type==="raster-tile"}function ge(e){return e!=null&&"type"in e&&e.type==="tile-texture"}function Se(e){return e!=null&&"type"in e&&e.type==="image+type"}var o;(function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"})(o||(o={}));function Te(e){return V(e)||Q(e)||X(e)}function V(e){return Y(e)||P(e)}const E=$(),xe=$(),S=$(),T=$();function de(e,t,i=0){const n=e.extent;if(n==null)return!1;if(i===0)return se(n,t);const l=Math.min(n[2]-n[0],n[3]-n[1]);return ae(n,t,i*l)}function v(e,t,i,n){le(E,i),E[n]=t[n];const l=I(E,E,t),r=I(xe,e,t),s=C(r,l),a=C(l,l);let u;u=s<=0?t:a<=s?i:re(E,t,oe(l,l,s/a));const c=I(E,e,u);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function Ee(e,t,i){const n=e.extent;if(n==null)return 0;S[0]=n[0],S[1]=n[1],S[2]=i,T[0]=n[2],T[1]=n[3],T[2]=i;let l=1/0,r=1/0;return t[0]<S[0]?l=v(t,S,T,0):t[0]>T[0]&&(l=v(t,T,S,0)),t[1]<S[1]?r=v(t,S,T,1):t[1]>T[1]&&(r=v(t,T,S,1)),Math.min(l,r)}function we(e,t,i,n){if(e==null)return A();const l=e.spatialReference;if(l.isGeographic&&!V(l))return new h("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=x.checkUnsupported(e);return r??(i==null?new h("tilingscheme:extent-not-exist","The layer does not provide a layer extent."):ve(e,i)||(t==null||l.equals(t)||t.isWGS84&&l.isWebMercator?null:new h("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")))}function ve(e,t){const i=e.lods,n=i[0].resolution*2**i[0].level,l=[n*e.size[0],n*e.size[1]],r=[e.origin.x,e.origin.y],s=ce(t),a=b();x.computeRowColExtent(s,l,r,a);const u=(a[2]-a[0])*(a[3]-a[1]);if(u>G){const c=i[0].scale*2**i[0].level;let f=Math.max((s[3]-s[1])/e.size[1],(s[2]-s[0])/e.size[0])*c/n;const d=Math.floor(Math.log(f)/Math.log(10));return f=Math.ceil(f/10**d)*10**d,new h("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+f.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:f,requiredNumRootTiles:u,allowedNumRootTiles:G})}return null}const Me=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:we,isInsideExtent:de,tiltToExtentEdge:Ee},Symbol.toStringTag,{value:"Module"}));function ye(){return!0}function Oe(){return 0}function Re(e,t,i,n){if(e==null)return A();const l=(e==null?void 0:e.lods.length)-1,r=e.spatialReference;if(r.isWebMercator){if(!x.makeWebMercatorAuxiliarySphere(l).compatibleWith(e,n))return new h("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!Te(r))return new h("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!x.makeGCSWithTileSize(e.spatialReference,e.size[0],l).compatibleWith(e,n))return e.spatialReference.isWGS84?new h("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new h("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return t==null||e.spatialReference.equals(t)?null:new h("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const $e=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:Re,isInsideExtent:ye,tiltToExtentEdge:Oe},Symbol.toStringTag,{value:"Module"})),be={[z.Global]:$e,[z.Local]:Me};function tt(e,t){e||console.warn("Terrain: "+t)}let R=!1,We=!1;function it(e){We=e,R=R||e}function nt(e){R=e}function lt(e,t){var i;if(R&&!e){const n=(i=new Error().stack)==null?void 0:i.slice(5);throw console.warn("Terrain internal: "+(t??"")+" at "+n),new Error("Assertion failed"+(t?": "+t:""))}}function rt(e){return L(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function k(e){return(e==null?void 0:e.type)==="imagery-tile"||(e==null?void 0:e.type)==="wcs"}function L(e){return(e==null?void 0:e.type)==="imagery-tile-3d"}function q(e){return(e==null?void 0:e.type)==="tile-3d"}function F(e){return(e==null?void 0:e.type)==="vector-tile-3d"}function j(e){return(e==null?void 0:e.type)==="wmts-3d"}function He(e){return(e==null?void 0:e.type)==="elevation-3d"}function ot(e){return(e==null?void 0:e.type)==="group"}function st(e){return e&&(q(e)||j(e)||L(e)||F(e))}function Ie(e){return e&&(q(e)||L(e)||F(e)||j(e))}function at(e){return Ie(e)||He(e)}function ct(e){var t;return pe((t=e==null?void 0:e.sourceLayerInfo)==null?void 0:t.data)}function ut(e){return ze(e==null?void 0:e.sourceLayerInfo)||!!(e!=null&&e.isVTLBackground)}function ft(e){var t;return ge((t=e==null?void 0:e.sourceLayerInfo)==null?void 0:t.data)}function ht(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return Se(t)||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData}function ze(e){return me(e==null?void 0:e.data)}function mt(e){return e!=null&&"release"in e&&e.release(),null}function pt(e){return e.fetchTile&&e.hasOverriddenFetchTile!==!1}function D(e,t,i,n,l){return be[n].checkIfTileInfoSupportedForViewSR(e,i,t,l)}function gt(e,t,i){var s;let n=null,l=null;if((e==null?void 0:e.type)==="wmts"){const a=Ae(e,t,i);n=a.tileInfo,l=a.fullExtent}else{l=k(e)?e.getCompatibleFullExtent(t):e.fullExtent;const a=i===z.Local;k(e)?n=e.getCompatibleTileInfo(t,l,a):(e==null?void 0:e.type)==="vector-tile"?n=a&&!Le(t)||_e.force512VTL?e.tileInfo:e.tileInfo.getCompatibleForVTL(256):n=e.tileInfo}const r="tilemapCache"in e?(s=e.tilemapCache)==null?void 0:s.effectiveMaxLOD:void 0;return n!=null&&l!=null&&D(n,l,t,i,r)==null?{tileInfo:n,fullExtent:l}:null}function Ae(e,t,i){const n=ee(e);if(n!=null){if(!B.isCollection(n))return{tileInfo:n.tileInfo,fullExtent:n.fullExtent};{const l=n.find(r=>D(r.tileInfo,r.fullExtent,t,i)==null);if(l)return{tileInfo:l.tileInfo,fullExtent:l.fullExtent}}}return{tileInfo:null,fullExtent:null}}function Le(e){return e.isWGS84||e.isWebMercator||P(e)||!Z(e)}const _e={force512VTL:!1};function St(e){return"["+e[0]+","+e[1]+","+e[2]+"]"}function Tt(e){return"("+e[0]+","+e[1]+","+e[2]+")"}function xt(e,t,i=Ne){return Math.abs(e-t)<i}function dt(e){return e===o.NORTH_EAST?o.SOUTH_WEST:e===o.NORTH_WEST?o.SOUTH_EAST:e===o.SOUTH_WEST?o.NORTH_EAST:o.NORTH_WEST}function Et(e){return e===o.NORTH?o.SOUTH:e===o.EAST?o.WEST:e===o.SOUTH?o.NORTH:o.EAST}function wt(e){return e===o.NORTH_WEST||e===o.SOUTH_WEST}function vt(e){return e===o.NORTH_WEST||e===o.NORTH_EAST}function Mt(e){return e===o.NORTH_WEST||e===o.WEST||e===o.SOUTH_WEST}function yt(e){return e===o.NORTH_EAST||e===o.EAST||e===o.SOUTH_EAST}function Ot(e){return e===o.SOUTH_EAST||e===o.SOUTH||e===o.SOUTH_WEST}function Rt(e){return e===o.NORTH_EAST||e===o.NORTH||e===o.NORTH_WEST}const $t=[o.NORTH,o.EAST,o.SOUTH,o.WEST],bt=[o.NORTH_EAST,o.SOUTH_EAST,o.SOUTH_WEST,o.NORTH_WEST],Ne=1e-5;export{Rt as $,st as A,St as B,ft as C,Le as D,R as E,Ae as F,_e as G,G as H,Ye as I,Et as J,wt as K,Ze as L,pt as M,Je as N,lt as O,Tt as P,vt as Q,at as R,tt as S,o as T,ot as U,D as V,Ie as W,Mt as X,yt as Y,Ot as Z,k as _,Be as a,He as a0,nt as a1,it as a2,mt as b,Xe as c,ge as d,pe as e,x as f,$t as g,bt as h,We as i,et as j,gt as k,Ke as l,he as m,Qe as n,F as o,ct as p,xt as q,Se as r,ht as s,me as t,V as u,ze as v,ut as w,Te as x,rt as y,dt as z};
