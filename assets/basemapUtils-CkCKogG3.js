import{s,F as c}from"./Basemap-DhGpUWGY.js";import{s as p,g as x,n as T}from"./subclass-BR3PhgZG.js";import{V as g}from"./reactiveUtils-BFQ0BtrB.js";import{u as q,j as U}from"./Accessor-D6mNnsWy.js";import{x as M,_ as k,K as A}from"./assets-C2mb-ea2.js";import{r as K}from"./utils-D20M4_S8.js";const y=()=>T.getLogger("esri.support.basemapUtils");function z(){return{}}function H(e){for(const r in e){const n=e[r];q(n),delete e[r]}}function j(e,r){let n;if(typeof e=="string"){const t=e in s,a=!t&&e.includes("/");if(!t&&!a){const l=Object.entries(s).filter(([i,u])=>p.apiKey&&!u.classic||!p.apiKey&&(u.classic||u.is3d)).map(([i])=>`"${i}"`).sort().join(", ");return y().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${l}`),null}r&&(n=r[e]),n||(n=t?c.fromId(e):new c({style:{id:e}}),r&&(r[e]=n))}else n=x(c,e);return n!=null&&n.destroyed&&(y().warn("The provided basemap is already destroyed",{basemap:n}),n=null),n}function J(e){var r;return((r=e.portalItem)==null?void 0:r.type)==="Web Scene"||e.referenceLayers.some(n=>n.type==="scene")}function P(e){var r,n;return!!((n=(r=e==null?void 0:e.portalItem)==null?void 0:r.tags)!=null&&n.some(t=>t.toLowerCase()==="beta"))}function Q(e,r){var n,t,a,l;return((t=(n=e.basemap)==null?void 0:n.referenceLayers)==null?void 0:t.some(i=>i.uid===r))||((l=(a=e.basemap)==null?void 0:a.baseLayers)==null?void 0:l.some(i=>i.uid===r))}function X(e,r=null){const n=j(e);if(!n)return null;const t=n.clone();return r&&(t.baseLayers=m(t.baseLayers,r.baseLayers),t.referenceLayers=m(t.referenceLayers,r.referenceLayers)),t}function C(e){let r=null;const n=o(e),t=!(n!=null&&n.baseLayers.length);for(const a in s){const l=I(n,h(s[a]),{mustMatchReferences:t});if(l==="equal"){r=a;break}l==="base-layers-equal"&&(r=a)}return r}function Y(e,r){var n,t;return e===r||((n=e==null?void 0:e.portalItem)==null?void 0:n.id)!=null&&e.portalItem.id===((t=r==null?void 0:r.portalItem)==null?void 0:t.id)?!0:I(o(e),o(r),{mustMatchReferences:!0})==="equal"}function m(e,r){const n=new g;return e.forEach(t=>{const a=r.find(l=>l.type!=="scene"&&R(f(t),f(l)))||t;n.includes(a)?n.push(t):n.push(a)}),n}function Z(e){return!!(e!=null&&e.baseLayers.concat(e.referenceLayers).some(G))}function G(e){if(d(e.url))return!0;if(e.type==="vector-tile")for(const r in e.sourceNameToSource){const n=e.sourceNameToSource[r];if(d(n==null?void 0:n.sourceUrl))return!0}return!1}function $(e,r){var l;if(r==null||e==null)return{spatialReference:null,updating:!1};if(r.loadStatus==="not-loaded")return r.load(),{spatialReference:null,updating:!0};if(r.spatialReference)return{spatialReference:r.spatialReference,updating:!1};if(r.baseLayers.length===0)return{spatialReference:null,updating:!1};const n=r.baseLayers.at(0);switch(n.loadStatus){case"not-loaded":n.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const t=(("supportedSpatialReferences"in n?n.supportedSpatialReferences:null)||["tileInfo"in n?(l=n.tileInfo)==null?void 0:l.spatialReference:n.spatialReference]).filter(Boolean),a=e.spatialReference;return a?{spatialReference:t.find(i=>a.equals(i))??t[0]??null,updating:!1}:{spatialReference:t[0],updating:!1}}const V=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function d(e){if(!e)return!1;const r=new M(k(e));return!!r.authority&&V.test(r.authority)}function o(e){return e?!e.loaded&&e.resourceInfo?h(e.resourceInfo.data):{baseLayers:b(e.baseLayers),referenceLayers:b(e.referenceLayers)}:null}function b(e){return(g.isCollection(e)?e.toArray():e).map(f)}function f(e){var r,n;return{type:e.type,effect:"effect"in e?e.effect:void 0,url:w("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&e.minScale!=null?e.minScale:0,maxScale:"maxScale"in e&&e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visible==null||!!e.visible,sublayers:e.type!=="map-image"&&e.type!=="wms"||e.sublayers==null||(r=e.sublayers)==null?void 0:r.map(t=>({id:t.id,visible:t.visible})),activeLayerId:e.type==="wmts"?(n=e.activeLayer)==null?void 0:n.id:void 0}}function L(e){return e.isReference||e.layerType==="ArcGISSceneServiceLayer"}function h(e){return e?{baseLayers:v((e.baseMapLayers??[]).filter(r=>!L(r))),referenceLayers:v((e.baseMapLayers??[]).filter(r=>L(r)))}:null}function v(e){return e.map(r=>N(r))}function N(e){let r;switch(e.layerType){case"VectorTileLayer":r="vector-tile";break;case"ArcGISTiledMapServiceLayer":r="tile";break;case"ArcGISSceneServiceLayer":r="scene";break;default:r="unknown"}return{type:r,effect:e.effect,url:w(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale??0,maxScale:e.maxScale??0,opacity:e.opacity??1,visible:e.visibility==null||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}function I(e,r,n){return e!=null!=(r!=null)?"not-equal":!e||!r?"equal":S(e.baseLayers,r.baseLayers)?S(e.referenceLayers,r.referenceLayers)?"equal":n.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal"}function S(e,r){if(e.length!==r.length)return!1;for(let n=0;n<e.length;n++)if(!R(e[n],r[n]))return!1;return!0}function R(e,r){if(e.type!==r.type||e.url!==r.url||e.minScale!==r.minScale||e.maxScale!==r.maxScale||e.visible!==r.visible||e.opacity!==r.opacity||!K(e.effect,r.effect))return!1;if(e.activeLayerId!=null||r.activeLayerId!=null)return e.activeLayerId===r.activeLayerId;if(e.sublayers!=null||r.sublayers!=null){if(e.sublayers==null||r.sublayers==null||e.sublayers.length!==r.sublayers.length)return!1;for(let n=0;n<e.sublayers.length;n++){const t=e.sublayers.at(n),a=r.sublayers.at(n);if((t==null?void 0:t.id)!==(a==null?void 0:a.id)||(t==null?void 0:t.visible)!==(a==null?void 0:a.visible))return!1}}return!0}function w(e){return e?A(e).replace(/^\s*https?:/i,"").toLowerCase():""}function ee(e){if(!e)return null;const{thumbnailUrl:r}=e;if(r)return r;const n=C(e);return n?s[n].thumbnailUrl:U(e.baseLayers,B)}function B(e){var r;return"portalItem"in e?(r=e.portalItem)==null?void 0:r.thumbnailUrl:void 0}export{P as L,ee as O,Y as R,Q as S,$ as U,j as b,J as d,G as j,H as m,X as v,Z as w,z as y};
