import{S as I}from"./jsxFactory-Cnml7uXM.js";import{L as A,c as M,r as b,x as S,i as T}from"./index-4eY77cms.js";import{t as w,h as m,s as C,w as v}from"./dom-DEluURzl.js";import"./Accessor-BmwT4B0c.js";import"./intl-Duiy0OzY.js";import"./Promise-DfET-uns.js";import"./cast-CsZslgGN.js";import"./JSONSupport-DcrLLGjL.js";import"./Evented-Dw4_VOGn.js";import"./reactiveUtils-XM7cS2OP.js";import"./SimpleObservable-CvOkykwM.js";import"./uuid-Cl5lrJ4c.js";import"./guid-ejniuQmw.js";/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.0.3 */function E(h){return(h==null?void 0:h.tagName)==="CALCITE-TREE-ITEM"}function D(h){return Array.from(h.querySelectorAll("calcite-tree-item:not([disabled])")).filter(e=>{let t=e;for(;t!==h&&t!==void 0;){const l=t.parentElement;if(!(!E(l)||!l.hasChildren||l.expanded))return!1;t=t.parentElement}return!0})}const q=T`:host{display:block}:host(:focus){outline:2px solid transparent;outline-offset:2px}:host([hidden]){display:none}[hidden]{display:none}`,x=class x extends A{constructor(){super(),this.items=[],this.lines=!1,this.parentExpanded=!1,this.scale="m",this.selectedItems=[],this.selectionMode="single",this.calciteTreeSelect=M({cancelable:!1}),this.listen("focus",this.onFocus),this.listen("focusin",this.onFocusIn),this.listen("focusout",this.onFocusOut),this.listen("calciteInternalTreeItemSelect",this.onInternalTreeItemSelect),this.listen("keydown",this.keyDownHandler)}willUpdate(e){var l;e.has("parentExpanded")&&(this.hasUpdated||this.parentExpanded!==!1)&&this.updateItems();const t=(l=this.el.parentElement)==null?void 0:l.closest("calcite-tree");this.lines=t?t.lines:this.lines,this.scale=t?t.scale:this.scale,this.selectionMode=t?t.selectionMode:this.selectionMode,this.child=!!t}onFocus(){if(!this.child){const e=this.el.querySelector("calcite-tree-item[selected]:not([disabled])")||this.el.querySelector("calcite-tree-item:not([disabled])");w(e)}}onFocusIn(e){(e.relatedTarget===this.el||!this.el.contains(e.relatedTarget))&&this.el.removeAttribute("tabindex")}onFocusOut(e){!this.el.contains(e.relatedTarget)&&(this.el.tabIndex=this.getRootTabIndex())}onInternalTreeItemSelect(e){if(this.child)return;const t=e.target,l=m(t.querySelectorAll("calcite-tree-item"));if(e.preventDefault(),e.stopPropagation(),this.selectionMode==="ancestors"){this.updateAncestorTree(e);return}const o=this.selectionMode==="none",n=this.selectionMode!==null&&(!t.hasChildren||t.hasChildren&&(this.selectionMode==="children"||this.selectionMode==="multichildren")),c=this.selectionMode==="multichildren"&&t.hasChildren,a=!o&&e.detail.modifyCurrentSelection&&(this.selectionMode==="multiple"||this.selectionMode==="multichildren"),u=!a&&((this.selectionMode==="single"||this.selectionMode==="multiple")&&l.length<=0||this.selectionMode==="children"||this.selectionMode==="multichildren"||this.selectionMode==="single-persist"&&!t.hasChildren),r=["multiple","none","single","single-persist"].includes(this.selectionMode)&&t.hasChildren,s=[];n&&s.push(t),u&&m(this.el.querySelectorAll("calcite-tree-item[selected]")).forEach(i=>{s.includes(i)||(i.selected=!1)}),r&&["multiple","none","single","single-persist"].includes(this.selectionMode)&&(t.expanded=!t.expanded),c&&l.forEach(i=>{i.selected=!1,i.hasChildren&&(i.expanded=!1)}),a&&window.getSelection().removeAllRanges(),a&&t.selected?s.forEach(i=>{i.disabled||(i.selected=!1)}):o||s.forEach(i=>{i.disabled||(i.selected=this.selectionMode!=="single"||!i.selected)}),this.selectedItems=o?[]:m(this.el.querySelectorAll("calcite-tree-item")).filter(i=>i.selected),this.calciteTreeSelect.emit(),e.stopPropagation()}keyDownHandler(e){var c,a,u,r;if(this.child)return;const t=this.el,l=e.target,o=["ArrowRight","ArrowDown","ArrowLeft","ArrowUp","Home","End","Tab"];if(!(E(l)&&this.el.contains(l))||!o.includes(e.key))return;const n=D(t);if(e.key==="Tab"){n.forEach(s=>s.tabIndex=-1);return}if(e.key==="ArrowDown"){const s=n.indexOf(l);(c=n[s+1])==null||c.focus(),e.preventDefault();return}if(e.key==="ArrowUp"){const s=n.indexOf(l);(a=n[s-1])==null||a.focus(),e.preventDefault();return}if(e.key==="ArrowLeft"){if(l.hasChildren&&l.expanded){l.expanded=!1,e.preventDefault();return}(u=n.slice(0,n.indexOf(l)).reverse().find(s=>s.depth===l.depth-1))==null||u.focus(),e.preventDefault();return}if(e.key==="ArrowRight"){if(!l.disabled&&l.hasChildren)if(!l.expanded)l.expanded=!0,e.preventDefault();else{const s=n.indexOf(l);(r=n[s+1])==null||r.focus(),e.preventDefault()}return}if(e.key==="Home"){const s=n.shift();s&&(s.focus(),e.preventDefault());return}if(e.key==="End"){const s=n.pop();s&&(s.focus(),e.preventDefault());return}}updateAncestorTree(e){const t=e.target,l=e.detail.updateItem;if(t.disabled||t.indeterminate&&!l)return;const o=[];let n=t.parentElement.closest("calcite-tree-item");for(;n;)o.push(n),n=n.parentElement.closest("calcite-tree-item");const c=Array.from(t.querySelectorAll("calcite-tree-item:not([disabled])")),a=c.filter(i=>!i.hasChildren),u=c.filter(i=>i.hasChildren);let r;l?r=t.hasChildren?!(t.selected||t.indeterminate):!t.selected:r=t.selected,a.forEach(i=>{i.selected=r,i.indeterminate=!1});function s(i,d){const f=i.filter(p=>p.selected),g=i.filter(p=>!p.selected);d.selected=f.length===i.length,d.indeterminate=f.length>0&&g.length>0}u.reverse().forEach(i=>{const d=Array.from(i.querySelectorAll(":scope > calcite-tree > calcite-tree-item"));s(d,i)}),l&&(t.hasChildren?s(c,t):(t.selected=r,t.indeterminate=!1)),o.forEach(i=>{const d=m(i.querySelectorAll("calcite-tree-item")),f=d.filter(p=>p.selected);if(f.length===0){i.selected=!1,i.indeterminate=!1;return}const g=f.length<d.length;i.indeterminate=g,i.selected=!g}),this.selectedItems=m(this.el.querySelectorAll("calcite-tree-item")).filter(i=>i.selected),l&&this.calciteTreeSelect.emit()}updateItems(){this.items.forEach(e=>e.parentExpanded=this.parentExpanded)}handleDefaultSlotChange(e){const t=C(e).filter(l=>l.matches("calcite-tree-item"));this.items=t,this.updateItems()}getRootTabIndex(){return this.child?-1:0}render(){return this.el.ariaMultiSelectable=this.child?void 0:v(this.selectionMode==="multiple"||this.selectionMode==="multichildren"),this.el.role=this.child?void 0:"tree",b(this.el,"tabIndex",this.getRootTabIndex()),S`<slot @slotchange=${this.handleDefaultSlotChange}></slot>`}};x.properties={child:7,lines:7,parentExpanded:5,scale:3,selectedItems:0,selectionMode:3},x.styles=q;let y=x;I("calcite-tree",y);export{y as Tree};
