import{aR as B,ad as x,r as n,g as U,m as o,a as Y}from"./Accessor-BHnuXKD2.js";import{r as D}from"./vec3f64-BLpZdpfb.js";import{e as c}from"./VertexAttribute-Cq4MnHjR.js";import{o as R,s as S,r as H}from"./mathUtils-DV9iOXpW.js";import{o as G}from"./boundedPlane-Dyz2ub5d.js";import{L as $,Q as b,E as V}from"./sphere-DQxj5tsv.js";import{l as w}from"./ViewingMode-Dodu7ZZk.js";import{c as X}from"./NoParameters-t-PuNrgq.js";var I;(function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Mesh=2]="Mesh",e[e.Line=3]="Line",e[e.Point=4]="Point",e[e.Material=5]="Material",e[e.Texture=6]="Texture",e[e.COUNT=7]="COUNT"})(I||(I={}));class z{constructor(){this.id=B()}}const Z=new Map([[c.POSITION,0],[c.NORMAL,1],[c.NORMALCOMPRESSED,1],[c.UV0,2],[c.COLOR,3],[c.COLORFEATUREATTRIBUTE,3],[c.SIZE,4],[c.TANGENT,4],[c.CENTEROFFSETANDDISTANCE,5],[c.SYMBOLCOLOR,5],[c.FEATUREATTRIBUTE,6],[c.INSTANCEFEATUREATTRIBUTE,6],[c.INSTANCECOLOR,7],[c.OBJECTANDLAYERIDCOLOR,7],[c.INSTANCEOBJECTANDLAYERIDCOLOR,7],[c.ROTATION,8],[c.INSTANCEMODEL,8],[c.INSTANCEMODELNORMAL,12],[c.INSTANCEMODELORIGINHI,11],[c.INSTANCEMODELORIGINLO,15]]);function nt(e,t){return new d(e,W,t)}function ot(e,t){const{curvatureDependent:a,scaleStart:r,scaleFallOffRange:s}=W;return new d(e,{curvatureDependent:{min:{curvature:a.min.curvature,tiltAngle:a.min.tiltAngle,scaleFallOffFactor:h.curvatureDependent.min.scaleFallOffFactor},max:{curvature:a.max.curvature,tiltAngle:a.max.tiltAngle,scaleFallOffFactor:h.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:s,minPixelSize:h.minPixelSize},t)}function q(e){return Math.abs(e*e*e)}function M(e,t,a){const r=a.parameters;return m.scale=Math.min(r.divisor/(t-r.offset),1),m.factor=q(e),m}function P(e,t){return R(e*Math.max(t.scale,t.minScaleFactor),e,t.factor)}function j(e,t,a){const r=M(e,t,a);return r.minScaleFactor=0,P(1,r)}function ct(e,t,a,r){r.scale=j(e,t,a),r.factor=0,r.minScaleFactor=a.minScaleFactor}function lt(e,t,a=[0,0]){const r=Math.min(Math.max(t.scale,t.minScaleFactor),1);return a[0]=e[0]*r,a[1]=e[1]*r,a}function J(e,t,a,r){return P(e,M(t,a,r))}class d{get minScaleFactor(){return this._fontHeight!=null?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(t,a,r,s=k(),l){this._viewingMode=t,this._description=a,this._ellipsoidRadius=r,this.parameters=s,this._fontHeight=l,this._viewingMode===w.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(t){return(!this.parameters||this.parameters.camera.fovY!==t.fovY||this.parameters.camera.distance!==t.distance)&&(this._calculateParameters(t,this._ellipsoidRadius,this.parameters),!0)}overrideFontHeight(t){return t!==this._fontHeight?new d(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,t):this}_calculateParameters(t,a,r){const{scaleStart:s,scaleFallOffRange:l}=this._description,{fovY:E,distance:O}=t,T=this._calculateCurvatureDependentParameters(t,a),_=this._coverageCompensation(t,a,T),{tiltAngle:p,scaleFallOffFactor:u}=T,f=Math.sin(p)*O,L=.5*Math.PI-p-E*(.5-s*_),v=f/Math.cos(L),y=L+E*l*_,N=(v-u*(f/Math.cos(y)))/(1-u);return r.camera.fovY=t.fovY,r.camera.distance=t.distance,r.offset=N,r.divisor=v-N,r}_calculateCurvatureDependentParametersLocal(t,a,r=C){return r.tiltAngle=this._description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(t,a,r=C){const s=this._description.curvatureDependent,l=1+t.distance/a,E=Math.sqrt(l*l-1),[O,T]=[s.min.curvature,s.max.curvature],_=H((E-O)/(T-O),0,1),[p,u]=[s.min,s.max];return r.tiltAngle=R(p.tiltAngle,u.tiltAngle,_),r.scaleFallOffFactor=R(p.scaleFallOffFactor,u.scaleFallOffFactor,_),r}_surfaceCoverageCompensationLocal(t,a,r){return G(r.tiltAngle,t.fovY)}_surfaceCoverageCompensationGlobal(t,a,r){return $(F,a),b(F,r.tiltAngle,t.distance,t.fovY)}}const W={curvatureDependent:{min:{curvature:S(10),tiltAngle:S(12),scaleFallOffFactor:.5},max:{curvature:S(70),tiltAngle:S(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},h={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function k(){return{camera:{distance:0,fovY:0},divisor:0,offset:0}}const m={scale:0,factor:0,minScaleFactor:0},C={tiltAngle:0,scaleFallOffFactor:0},F=V();function Et(e,t,a,r,s){let l=(a.screenLength||0)*e.pixelRatio;s!=null&&(l=J(l,r,t,s));const E=l*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return H(E*t,a.minWorldLength||0,a.maxWorldLength!=null?a.maxWorldLength:1/0)}function g(e,t){let a=!1;for(const r in t){const s=t[r];s!==void 0&&(Array.isArray(s)?Array.isArray(e[r])&&x(s,e[r])||(e[r]=s.slice(),a=!0):e[r]!==s&&(a=!0,e[r]=s))}return a}const _t={multiply:1,ignore:2,replace:3,tint:4};let i=class extends U{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};n([o()],i.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),n([o()],i.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),n([o()],i.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),n([o()],i.prototype,"DECONFLICTOR_SHOW_GRID",void 0),n([o()],i.prototype,"LABELS_SHOW_BORDER",void 0),n([o()],i.prototype,"TEXT_SHOW_BASELINE",void 0),n([o()],i.prototype,"TEXT_SHOW_BORDER",void 0),n([o()],i.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),n([o()],i.prototype,"OVERLAY_SHOW_CENTER",void 0),n([o()],i.prototype,"SHOW_POI",void 0),n([o()],i.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),n([o()],i.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),n([o()],i.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),n([o()],i.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),n([o()],i.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),n([o()],i.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),n([o()],i.prototype,"I3S_TREE_SHOW_TILES",void 0),n([o()],i.prototype,"I3S_SHOW_MODIFICATIONS",void 0),n([o()],i.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),n([o()],i.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),n([o()],i.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),n([o()],i.prototype,"LINE_WIREFRAMES",void 0),i=n([Y("esri.views.3d.support.debugFlags")],i);const pt=new i;class ut extends z{constructor(t,a){super(),this.type=I.Material,this.supportsEdges=!1,this._renderPriority=0,this.vertexAttributeLocations=Z,this._pp0=D(0,0,1),this._pp1=D(0,0,0),this._parameters=new a,g(this._parameters,t),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(t){return!1}setParameters(t,a=!0){g(this._parameters,t)&&(this.validateParameters(this._parameters),a&&this._parametersChanged())}validateParameters(t){}shouldRender(t){return this.visible&&this.isVisibleForOutput(t.output)&&(!this.parameters.isDecoration||t.bind.decorations)&&!!(this.parameters.renderOccluded&t.renderOccludedMask)}isVisibleForOutput(t){return!0}get renderPriority(){return this._renderPriority}set renderPriority(t){t!==this._renderPriority&&(this._renderPriority=t,this._parametersChanged())}_parametersChanged(){var t;(t=this.repository)==null||t.materialChanged(this)}queryRenderOccludedState(t){return this.visible&&this.parameters.renderOccluded===t}get hasEmissions(){return!1}intersectDraped(t,a,r,s,l,E){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(t,a,r,this._pp0,this._pp1,l)}}var A;(function(e){e[e.None=0]="None",e[e.Occlude=1]="Occlude",e[e.Transparent=2]="Transparent",e[e.OccludeAndTransparent=4]="OccludeAndTransparent",e[e.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",e[e.Opaque=16]="Opaque"})(A||(A={}));class Ot extends X{constructor(){super(...arguments),this.renderOccluded=A.Occlude,this.isDecoration=!1}}export{Z as O,lt as a,Ot as b,g as c,ct as d,I as e,ot as f,Et as i,P as m,ut as n,_t as o,A as p,z as r,nt as s,pt as t};
