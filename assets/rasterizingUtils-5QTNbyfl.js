import{o as R}from"./floatRGBA-CR2j2c7-.js";import{B as $}from"./Accessor-BHnuXKD2.js";import{i as A}from"./mathUtils-DV9iOXpW.js";import{n as b}from"./defaultCIMValues-DII_GG3u.js";import{c as I}from"./definitions-LJaw2n5Z.js";const z=15.5,x=4,U=64,j=1024,v=()=>$.getLogger("esri.symbols.cim.rasterizingUtils"),L=32,P=t=>t==="vertical"||t==="horizontal"||t==="cross"||t==="esriSFSCross"||t==="esriSFSVertical"||t==="esriSFSHorizontal";function J(t,i,e){const r=i.style,a=A(Math.ceil(e)),o=P(r)?8*a:16*a,n=2*a;t.width=o,t.height=o;const s=t.getContext("2d");s.strokeStyle="#ffffff",s.lineWidth=a,s.beginPath(),r!=="vertical"&&r!=="cross"&&r!=="esriSFSCross"&&r!=="esriSFSVertical"||(s.moveTo(o/2,-n),s.lineTo(o/2,o+n)),r!=="horizontal"&&r!=="cross"&&r!=="esriSFSCross"&&r!=="esriSFSHorizontal"||(s.moveTo(-n,o/2),s.lineTo(o+n,o/2)),r!=="backward-diagonal"&&r!=="diagonal-cross"&&r!=="esriSFSDiagonalCross"&&r!=="esriSFSBackwardDiagonal"||(s.moveTo(-n,-n),s.lineTo(o+n,o+n),s.moveTo(o-n,-n),s.lineTo(o+n,n),s.moveTo(-n,o-n),s.lineTo(n,o+n)),r!=="forward-diagonal"&&r!=="diagonal-cross"&&r!=="esriSFSForwardDiagonal"&&r!=="esriSFSDiagonalCross"||(s.moveTo(o+n,-n),s.lineTo(-n,o+n),s.moveTo(n,-n),s.lineTo(-n,n),s.moveTo(o+n,o-n),s.lineTo(o-n,o+n)),s.stroke();const h=s.getImageData(0,0,t.width,t.height),l=new Uint8Array(h.data);let f;for(let c=0;c<l.length;c+=4)f=l[c+3]/255,l[c]=l[c]*f,l[c+1]=l[c+1]*f,l[c+2]=l[c+2]*f;return[l,t.width,t.height,a]}function K(t){t.length%2==1&&(t=[...t,...t]);const i=t.reduce((c,m)=>c+m,0),e=Math.round(i*x),r=1,a=new Float32Array(e*r);let o=0,n=0,s=.5,h=!0;for(const c of t){for(o=n,n+=c*x;s<=n;){const m=s-.5,u=Math.min(Math.abs(s-o),Math.abs(s-n));a[m]=h?-u:u,s++}h=!h}const l=a.length,f=new Uint8Array(4*l);for(let c=0;c<l;++c){const m=a[c]/x;R(m/U*.5+.5,f,4*c)}return[f,e,r]}function Q(t,i){t==null&&(t=[]);const e=i==="Butt",r=i==="Square",a=!e&&!r;t.length%2==1&&(t=[...t,...t]);const o=z,n=2*o;let s=0;for(const g of t)s+=g;const h=Math.round(s*o),l=new Float32Array(h*n),f=.5*o;let c=0,m=0,u=.5,M=!0;for(const g of t){for(c=m,m+=g*o;u<=m;){let p=.5;for(;p<n;){const D=(p-.5)*h+u-.5,d=a?(p-o)*(p-o):Math.abs(p-o);l[D]=M?e?Math.max(Math.max(c+f-u,d),Math.max(u-m+f,d)):d:a?Math.min((u-c)*(u-c)+d,(u-m)*(u-m)+d):r?Math.min(Math.max(u-c,d),Math.max(m-u,d)):Math.min(Math.max(u-c+f,d),Math.max(m+f-u,d)),p++}u++}M=!M}const F=l.length,T=new Uint8Array(4*F);for(let g=0;g<F;++g){const p=(a?Math.sqrt(l[g]):l[g])/o;R(p,T,4*g)}return[T,h,n]}function X(t,i){const{colorRamp:e,gradientType:r}=i,a=e.type==="CIMFixedColorRamp",o=i.interval||b.CIMGradientFill.interval;let n=w(e);return a&&(n=N(n,o)),r==="Discrete"||a?B(t,n,o):q(t,n)}let y;function Y(t,i){const{colorRamp:e,gradientType:r}=i,a=w(e),o=e.type==="CIMFixedColorRamp";if(r==="Continuous"&&!o)return C(t,a);const n=i.interval??b.CIMGradientFill.interval;if(o)return C(t,N(a,n));const s=[];y??(y=document.createElement("canvas")),S(y,a,n,1,0);const h=y.getContext("2d").getImageData(0,0,n,1).data;for(let l=0,f=0;l<n;l++,f=4*l){const c=[h[f+0],h[f+1],h[f+2],h[f+3]];s.push({offset:l/n,color:c}),s.push({offset:(l+1)/n,color:c})}return C(t,s)}function w(t){const i=[];switch(t.type){case"CIMPolarContinuousColorRamp":case"CIMLinearContinuousColorRamp":{t.type==="CIMPolarContinuousColorRamp"&&v().warnOnce("CIMPolarContinuousColorRamp is currently unsupported. Falling back to CIMLinearContinuousColorRamp.");const e=t;i.push({offset:0,color:[e.fromColor[0],e.fromColor[1],e.fromColor[2],e.fromColor[3]/255]}),i.push({offset:1,color:[e.toColor[0],e.toColor[1],e.toColor[2],e.toColor[3]/255]});break}case"CIMFixedColorRamp":{const e=t,r=1/(e.colors.length-1);let a=0;for(const o of e.colors)i.push({offset:a,color:[o[0],o[1],o[2],o[3]/255]}),a+=r;break}case"CIMMultipartColorRamp":{const e=t,r=e.weights.reduce((o,n)=>o+n,0);let a=0;for(let o=0;o<e.colorRamps.length;o++){const n=e.colorRamps[o],s=e.weights[o],h=w(n);for(const l of h)i.push({offset:(a+l.offset*s)/r,color:l.color});a+=s}break}default:v().error(`Color ramp "${t.type}" currently unsupported.`)}return i}function N(t,i){const e=[],r=(t.length-1)/(i-1);for(let a=0;a<i;a++){const o=t[Math.round(a*r)].color;e.push({offset:a/i,color:o}),e.push({offset:(a+1)/i,color:o})}return e}function q(t,i){return S(t,i,L,1,I),k(t)}function B(t,i,e){return S(t,i,e,1,I),k(t)}function C(t,i,e=0){for(const{offset:r,color:a}of i)t.addColorStop(Math.min(Math.max(r,e),1-e),`rgba(${a[0]}, ${a[1]}, ${a[2]}, ${a[3]})`)}function S(t,i,e,r,a){const o=e+2*a;t.width=o,t.height=r;const n=(a+1)/o,s=t.getContext("2d",{willReadFrequently:!0});if(i.length>0){const h=s.createLinearGradient(0,0,o,r);C(h,i,n),s.fillStyle=h}else s.fillStyle="rgba(128, 128, 128, 1)";s.fillRect(0,0,o,r)}function k(t){const{width:i,height:e}=t,r=t.getContext("2d").getImageData(0,0,i,e),a=new Uint8Array(r.data);for(let o=0;o<a.length;o+=4){const n=a[o+3]/255;a[o]*=n,a[o+1]*=n,a[o+2]*=n}return[a,i,e]}function E(t){var a,o,n,s;const i=((o=(a=t[0])==null?void 0:a[0])==null?void 0:o[0])??0,e=((s=(n=t[0])==null?void 0:n[0])==null?void 0:s[1])??0,r={ymin:e,xmin:i,ymax:e,xmax:i,width:0,height:0};for(let h=0;h<t.length;h++){const l=t[h];for(let f=0;f<l.length;f++){const c=l[f][0],m=l[f][1];c<r.xmin&&(r.xmin=c),c>r.xmax&&(r.xmax=c),m<r.ymin&&(r.ymin=m),m>r.ymax&&(r.ymax=m)}}return r.width=Math.abs(r.xmax-r.xmin),r.height=Math.abs(r.ymax-r.ymin),r}function Z(t,i){const e=E(t),r=e.width===0?1:e.width,a=e.height===0?1:e.height,o=[];for(let n=0;n<t.length;n++){const s=t[n],h=[];for(let l=0;l<s.length;l++){let f=Math.round(s[l][0]-e.xmin),c=Math.round(s[l][1]-e.ymin);if(f=i.xmin+f*i.width/r,c=i.ymin+c*i.height/a,isNaN(f)||isNaN(c))throw new Error("Scaled shape has NaN values");h.push([f,c])}o.push(h)}return o}function _(t,i,e){const r=[];for(let a=0;a<t.length;a++){const o=t[a],n=[];for(let s=0;s<o.length;s++){const h=o[s][0]+i,l=o[s][1]+e;if(isNaN(h)||isNaN(l))throw new Error("Scaled shape has NaN values");n.push([h,l])}r.push(n)}return r}export{_ as R,Z as T,U as c,j as e,J as f,X as g,K as m,Y as p,x as t,Q as u};
