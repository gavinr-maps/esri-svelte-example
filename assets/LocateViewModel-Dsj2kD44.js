import{r}from"./tslib.es6-B3Jf3DVX.js";import"./intl-CChhNOV8.js";import{q as s}from"./PopupTemplate-BHMhS05j.js";import{m as i,a as m,b as p}from"./subclass-BZA_h8Db.js";import{c}from"./Accessor-BLX9ikPh.js";import{r as n}from"./actions-nqvK7hqx.js";import{b as d}from"./GeolocationPositioning-Xwz8vp9M.js";import{p as u}from"./geolocationUtils-GsLnPMCi.js";import{g as h}from"./locale-C9TlLpzi.js";import{h as f}from"./messages-OmQvZhAg.js";import"./date-DlqISzcw.js";import"./jsonMap-0cxwUWs2.js";import"./assets-C43MgM-v.js";import"./index-Bh2oEzTI.js";import"./Clonable-D3rtuBWg.js";import"./Collection-CEdjem1-.js";import"./Evented-BHRw9x22.js";import"./shared-B3wH2qpO.js";import"./SimpleObservable-KocWTzVy.js";import"./cast-Bjksrh93.js";import"./writer-DNAwXnhG.js";import"./fieldUtils-tmQlKvWo.js";import"./mathUtils-C4_ghTv4.js";import"./geometry-D964gYQX.js";import"./Extent-Bf3YTe7m.js";import"./Point-Cg0-ChZE.js";import"./Polyline-D9YkgmM_.js";import"./enumeration-Ba5njXdz.js";import"./Color-BCS62Hs5.js";import"./colorUtils-0bJDPow9.js";import"./ActionToggle-iT4slXc7.js";import"./Identifiable-B1UbsKNt.js";import"./legacyIcon-CEIp6Pa9.js";import"./Graphic-DsxsIjhH.js";import"./symbols-CNimns--.js";import"./TextSymbol-D8QO_KUV.js";import"./screenUtils-_ZIvrt5o.js";import"./materialUtils-DarhapKC.js";import"./opacityUtils-C68Tlu6_.js";import"./vec3f64-BLpZdpfb.js";import"./aaBoundingBox-BE7cC1jD.js";import"./persistableUrlUtils-fa1mAujs.js";import"./collectionUtils-D_lHIu88.js";import"./Portal-C10FKnaA.js";import"./Loadable-BabW5Xcc.js";import"./Promise-B2Hu02L7.js";import"./reactiveUtils-C5zUhJQJ.js";import"./asyncUtils-CWX51uTe.js";import"./jsonUtils-CEfjT-BK.js";import"./GoTo-Wtu9mgoE.js";import"./project-DlMfXva8.js";import"./utils-6jMaHUrH.js";import"./utils-Bema0iXE.js";async function b(){const t=await f("esri/widgets/Locate/t9n/Locate");return new s({title:t.currentLocation,fieldInfos:[{fieldName:"timestamp",label:t.timestamp,format:{dateFormat:"short-date-short-time"}},{fieldName:"latitude",label:t.latitude,format:{places:4,digitSeparator:!0}},{fieldName:"longitude",label:t.longitude,format:{places:4,digitSeparator:!0}},{fieldName:"accuracy",label:t.accuracy,format:{places:0,digitSeparator:!0}},{fieldName:"altitude",label:t.altitude,format:{places:0,digitSeparator:!0}},{fieldName:"altitudeAccuracy",label:t.altitudeAccuracy,format:{places:0,digitSeparator:!0}},{fieldName:"heading",label:t.heading,format:{places:0,digitSeparator:!0}},{fieldName:"speed",label:t.speed,format:{places:0,digitSeparator:!0}}],actions:[n.clone()],content:[{type:"fields"}]})}let e=class extends d{constructor(t){super(t),this._locateController=null,this.error=void 0,this.popupEnabled=!0,this.locate=this.locate.bind(this)}initialize(){this.addHandles([h(()=>{var l;const{graphic:t,view:o}=this;if(!t)return;((l=o==null?void 0:o.graphics)==null?void 0:l.includes(t))&&this._updatePopupTemplate(t)})])}destroy(){this.cancelLocate()}get state(){var t;return this._geolocationUsable?(t=this.view)!=null&&t.ready?this._locateController?"locating":this.error!=null?"error":"ready":"disabled":"feature-unsupported"}async locate(){if(this.cancelLocate(),this.state==="disabled")throw new p("locate:disabled-state","Cannot locate when disabled.");if(this.state==="feature-unsupported")throw new p("locate:feature-unsupported-state","Cannot locate in unsecure domain.");const t=new AbortController;this._locateController=t,this.error=void 0;try{const o=await u(this.geolocationOptions);if(await this.updatePosition(o,t),this._locateController!==t)return null;const{graphic:a}=this;return a&&await this._updatePopupTemplate(a),this._addGraphic(),this.emit("locate",{position:o}),this._locateController=null,o}catch(o){if(c(o))return null;throw t===this._locateController&&(this._locateController=null),this.error=o,this.emit("locate-error",{error:o}),o}}cancelLocate(){this._clearGraphic(),this._locateController&&this._locateController.abort(),this._locateController=null}async _updatePopupTemplate(t){if(!this.popupEnabled)return;const o=await b(),a=t!==this.graphic;this.destroyed||a||(t.popupTemplate=o)}};r([i()],e.prototype,"_locateController",void 0),r([i()],e.prototype,"error",void 0),r([i()],e.prototype,"popupEnabled",void 0),r([i({readOnly:!0})],e.prototype,"state",null),r([i()],e.prototype,"locate",null),r([i()],e.prototype,"cancelLocate",null),e=r([m("esri.widgets.Locate.LocateViewModel")],e);const bt=e;export{bt as default};
