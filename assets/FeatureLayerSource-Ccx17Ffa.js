const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./uploadAssets-C1ITHwKi.js","./assets-C2mb-ea2.js","./subclass-BR3PhgZG.js","./index-CeCSsEgo.js","./index-CjOb8WjV.css","./Evented-CXIxDjmW.js","./Accessor-D6mNnsWy.js","./uuid-fwrPAdZb.js","./External-w9Liy2RE.js","./infoFor3D-CxOdoily.js","./uploadAssetErrors-DCYJ56ch.js","./progressUtils-l3fizrvn.js","./arcgisLayerUrl-Cgl5IQFD.js","./persistableUrlUtils-BcifXQ1Z.js","./convertMeshVertexSpace-BDDIu0UT.js","./MeshVertexAttributes-DVEL_Tlm.js","./jsonMap-DCC6W5ex.js","./vertexSpaceConversion-DhlFeppE.js","./mathUtils-ClvKsMak.js","./Point-DB4Hp4hH.js","./writer-3zufXUNV.js","./mat3-DRqs2t5W.js","./mat3f64-BBpwCtoL.js","./mat4-ybYUU6jq.js","./mat4f64-Dk4dwAN8.js","./spatialReferenceEllipsoidUtils-BL8s_3ls.js","./computeTranslationToOriginAndRotation-CLzktXYu.js","./projectBuffer-vsa0P_cF.js","./geodesicConstants-XRAvAZCD.js","./projectPointToVector-D3506wm2.js","./projection-A9yUaaTs.js","./reactiveUtils-BFQ0BtrB.js","./shared-B3wH2qpO.js","./Extent-DHjqVB-p.js","./Polyline-D97hl-6E.js","./meshVertexSpaceUtils-CtidK-ZY.js","./MeshLocalVertexSpace-Xt9zU6DE.js","./Clonable-cKbRam6-.js","./enumeration--HlxOQ_N.js","./vec3-C3Q-RF_i.js","./projection-CJ-ESJIf.js","./DoubleArray-CF_CpVBS.js","./BufferView-B7Z-dzh4.js","./vec2-B_ymkwGp.js","./vec42-B1mBkh1w.js","./vec4-L9zJLV3y.js"])))=>i.map(i=>d[i]);
import{_ as M}from"./index-CeCSsEgo.js";import{e as b}from"./Evented-CXIxDjmW.js";import{y as A,b as L,h as N,O as v,c as E,s as D,L as U,e as P,n as J}from"./subclass-BR3PhgZG.js";import"./geometry-DpwwkAX1.js";import{U as h,V as x}from"./assets-C2mb-ea2.js";import{c as Q}from"./TimeExtent-41gxTbrv.js";import{n as k}from"./jsonMap-DCC6W5ex.js";import{m as j}from"./Portal-liet8xHC.js";import{x as V,E as G,a as H}from"./Accessor-D6mNnsWy.js";import{d as z}from"./reactiveUtils-BFQ0BtrB.js";import{r as B}from"./uuid-fwrPAdZb.js";import{w as K}from"./Extent-DHjqVB-p.js";import{i as W}from"./MeshLocalVertexSpace-Xt9zU6DE.js";import{a as X}from"./meshVertexSpaceUtils-CtidK-ZY.js";import{v as Y}from"./External-w9Liy2RE.js";import{R as T,m as C,b as Z,f as $,j as tt,y as et,I as rt}from"./applyEditsUtils-5xQ1HKrZ.js";import{o as st}from"./clientSideDefaults-DDr2PCsV.js";import{x as at}from"./QueryTask-CC5ZOODI.js";import{g as it}from"./arcgisLayerUrl-Cgl5IQFD.js";import{T as I}from"./featureLayerUtils-CeNLEyq1.js";import{F as ot}from"./infoFor3D-CxOdoily.js";import{s as nt}from"./executeQueryJSON-CmP_8PTA.js";import{i as ut}from"./editsZScale-BMHD7K6h.js";import{b as lt}from"./Query-Cx4awVKu.js";import{i as pt,a as ct,o as dt,t as ht}from"./EditBusLayer-C6pLlK14.js";import{f as yt}from"./Point-DB4Hp4hH.js";import"./Polyline-D97hl-6E.js";import"./writer-3zufXUNV.js";import"./mathUtils-ClvKsMak.js";import"./timeUtils-DQR2jUPL.js";import"./Promise-CZrWwByK.js";import"./shared-B3wH2qpO.js";import"./Clonable-cKbRam6-.js";import"./enumeration--HlxOQ_N.js";import"./Graphic-Dc7F67nR.js";import"./PopupTemplate-ByHks6sq.js";import"./fieldUtils-CNduWQU9.js";import"./intl-Dpfm8vPB.js";import"./Color-DDUWtbqR.js";import"./colorUtils-CS9vdHXB.js";import"./ActionToggle-C0Z1k2jc.js";import"./Identifiable-BLvpQbOc.js";import"./symbols-CsUQ5BxR.js";import"./TextSymbol-gKE-H_J6.js";import"./screenUtils-PfxkaaMN.js";import"./materialUtils-CQ3JLQ1x.js";import"./opacityUtils-BT7mQkwC.js";import"./aaBoundingBox-rJEWaOSN.js";import"./persistableUrlUtils-BcifXQ1Z.js";import"./collectionUtils-Dm1icNvk.js";import"./jsonUtils-Cma_7A64.js";import"./projection-A9yUaaTs.js";import"./projectBuffer-vsa0P_cF.js";import"./geodesicConstants-XRAvAZCD.js";import"./MeshTransform-DLV7aKpV.js";import"./mat4-ybYUU6jq.js";import"./mat4f64-Dk4dwAN8.js";import"./quat-ChS85qAG.js";import"./mat3f64-BBpwCtoL.js";import"./quatf64-BrpT0VRp.js";import"./vec42-B1mBkh1w.js";import"./axisAngleDegrees-CHCWDIqP.js";import"./vec4f64-CBQL1T0x.js";import"./editingSupport-DQnMIeth.js";import"./normalizeUtils-Bi6Jza1f.js";import"./normalizeUtilsCommon-tgSpcwHH.js";import"./utils-D61i9O7E.js";import"./utils-Dx8bgRIB.js";import"./layerUtils-erzwAANv.js";import"./QueryEngineCapabilities-CTDe3LlQ.js";import"./defaultsJSON-GKolV7NZ.js";import"./DataLayerSource-6X35yXpo.js";import"./Field-C8SaaeoI.js";import"./fieldType-CIG5ey7e.js";import"./executeForIds-D-tq3ZnE.js";import"./query-DbJf0nTj.js";import"./pbfQueryUtils-C7MaRxj2.js";import"./pbf-CmaozfCN.js";import"./OptimizedGeometry-vU5jWBvU.js";import"./OptimizedFeature-7juV2tZm.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./queryZScale-B_YkkRy9.js";import"./executeQueryPBF-SPg7y6Hr.js";import"./featureConversionUtils-DdoZh_25.js";import"./FeatureSet-DyOnd9Rj.js";import"./featureQueryAll-CRo1-WqJ.js";import"./SimpleRenderer-DvJZ7cyq.js";import"./UniqueValueRenderer-dci9bLM8.js";import"./diffUtils--7ofoPN-.js";import"./colorRamps-CFlTi-ob.js";import"./SizeVariable-aYYWlweG.js";import"./ColorStop-CXfPDZon.js";import"./sizeVariableUtils-Cmcuvw-4.js";import"./visualVariableUtils-DzaXbn8H.js";import"./compilerUtils-BA04t1lN.js";import"./lengthUtils-D7_DvYH0.js";import"./jsonUtils-C6dvhNjw.js";import"./defaults-DCm7iNI6.js";import"./styleUtils-DQEZjdpw.js";import"./AttachmentQuery-Dn4NbT1Z.js";import"./RelationshipQuery-kHvI2dm7.js";import"./FullTextSearch-BNIhEccm.js";const mt=new k({originalAndCurrentFeatures:"original-and-current-features",none:"none"}),ft=new k({Started:"published",Publishing:"publishing",Stopped:"unavailable"});let g=class extends j{constructor(e){super(e),this.type="feature-layer",this.supportedSourceTypes=new Set(["Feature Layer","Oriented Imagery Layer","Table","Catalog Layer"]),this.refresh=V(async()=>{var s,a;await this.load();const t=(s=this.sourceJSON.editingInfo)==null?void 0:s.lastEditDate;if(t==null)return{dataChanged:!0,updates:{}};try{await this._fetchService(null)}catch{return{dataChanged:!0,updates:{}}}const r=t!==((a=this.sourceJSON.editingInfo)==null?void 0:a.lastEditDate);return{dataChanged:r,updates:r?{editingInfo:this.sourceJSON.editingInfo,extent:this.sourceJSON.extent}:null}}),this._ongoingAssetUploads=new Map}load(e){const t=this.layer.sourceJSON,r=this._fetchService(t,{...e}).then(()=>this.layer.setUserPrivileges(this.sourceJSON.serviceItemId,e)).then(()=>this._ensureLatestMetadata(e));return this.addResolvingPromise(r),Promise.resolve(this)}initialize(){this.addHandles([z(()=>{const e=this.layer;return e&&"lastEditsEventDate"in e?e.lastEditsEventDate:null},e=>this._handleLastEditsEventChange(e))])}destroy(){this._removeEditInterceptor()}get queryTask(){var p;const{capabilities:e,parsedUrl:t,gdbVersion:r,spatialReference:s,fieldsIndex:a}=this.layer,o="infoFor3D"in this.layer?this.layer.infoFor3D:null,i="dynamicDataSource"in this.layer?this.layer.dynamicDataSource:null,n=N("featurelayer-pbf")&&(e==null?void 0:e.query.supportsFormatPBF)&&o==null,u=((p=e==null?void 0:e.operations)==null?void 0:p.supportsQueryAttachments)??!1;return new at({url:t.path,pbfSupported:n,fieldsIndex:a,infoFor3D:o,dynamicDataSource:i,gdbVersion:r,sourceSpatialReference:s,queryAttachmentsSupported:u})}async addAttachment(e,t){await this.load();const{layer:r}=this;await I(r,"editing");const s=e.attributes[r.objectIdField],a=r.parsedUrl.path+"/"+s+"/addAttachment",o=this._getLayerRequestOptions(),i=this._getFormDataForAttachment(t,o.query);try{const n=await h(a,{body:i});return T(n.data.addAttachmentResult)}catch(n){throw this._createAttachmentErrorResult(s,n)}}async updateAttachment(e,t,r){await this.load();const{layer:s}=this;await I(s,"editing");const a=e.attributes[s.objectIdField],o=s.parsedUrl.path+"/"+a+"/updateAttachment",i=this._getLayerRequestOptions({query:{attachmentId:t}}),n=this._getFormDataForAttachment(r,i.query);try{const u=await h(o,{body:n});return T(u.data.updateAttachmentResult)}catch(u){throw this._createAttachmentErrorResult(a,u)}}async applyEdits(e,t){var S,R;await this.load();const{layer:r}=this;await I(r,"editing");const s="infoFor3D"in r?r.infoFor3D:null,a=s!=null,o=a||((t==null?void 0:t.globalIdUsed)??!1),i=a?await this._uploadMeshesAndGetAssetMapEditsJSON(e):null,n=((S=e.addFeatures)==null?void 0:S.map(_=>C(this.layer,_,s)))??[],u=(await Promise.all(n)).filter(v),p=((R=e.updateFeatures)==null?void 0:R.map(_=>C(this.layer,_,s)))??[],l=(await Promise.all(p)).filter(v),f=Z(this.layer,e.deleteFeatures,o);ut(u,l,r.spatialReference);const O=await $(this.layer,e),w=r.capabilities.editing.supportsAsyncApplyEdits&&a,c=(t==null?void 0:t.gdbVersion)||r.gdbVersion,d={gdbVersion:c,rollbackOnFailure:t==null?void 0:t.rollbackOnFailureEnabled,useGlobalIds:o,returnEditMoment:t==null?void 0:t.returnEditMoment,usePreviousEditMoment:t==null?void 0:t.usePreviousEditMoment,async:w};await pt(this.layer.url,c,!0);const F=ct(this.layer.url,c||null);if(await dt(r.url,c,r.historicMoment))throw new E("feature-layer-source:historic-version","Editing a historic version is not allowed");t!=null&&t.returnServiceEditsOption?(d.edits=JSON.stringify([{id:r.layerId,adds:u.length?u:null,updates:l.length?l:null,deletes:f.length?f:null,attachments:O,assetMaps:i}]),d.returnServiceEditsOption=mt.toJSON(t==null?void 0:t.returnServiceEditsOption),d.returnServiceEditsInSourceSR=t==null?void 0:t.returnServiceEditsInSourceSR):(d.adds=u.length?JSON.stringify(u):null,d.updates=l.length?JSON.stringify(l):null,d.deletes=f.length?o?JSON.stringify(f):f.join(","):null,d.attachments=O&&JSON.stringify(O),d.assetMaps=i!=null?JSON.stringify(i):void 0);const y=this._getLayerRequestOptions({method:"post",query:d});F&&(y.authMode="immediate",y.query.returnEditMoment=!0,y.query.sessionId=ht);const q=t!=null&&t.returnServiceEditsOption?r.url:r.parsedUrl.path;let m;try{m=w?await this._asyncApplyEdits(q+"/applyEdits",y):await h(q+"/applyEdits",y)}catch(_){if(!tt(_))throw _;y.authMode="immediate",m=w?await this._asyncApplyEdits(q+"/applyEdits",y):await h(q+"/applyEdits",y)}return this._createEditsResult(m)}async deleteAttachments(e,t){await this.load();const{layer:r}=this;await I(r,"editing");const s=e.attributes[r.objectIdField],a=r.parsedUrl.path+"/"+s+"/deleteAttachments";try{return(await h(a,this._getLayerRequestOptions({query:{attachmentIds:t.join(",")},method:"post"}))).data.deleteAttachmentResults.map(T)}catch(o){throw this._createAttachmentErrorResult(s,o)}}fetchRecomputedExtents(e={}){const t=e.signal;return this.load({signal:t}).then(async()=>{const r=this._getLayerRequestOptions({...e,query:{returnUpdates:!0}}),{layerId:s,url:a}=this.layer,{data:o}=await h(`${a}/${s}`,r),{id:i,extent:n,fullExtent:u,timeExtent:p}=o,l=n||u;return{id:i,fullExtent:l&&K.fromJSON(l),timeExtent:p&&Q.fromJSON({start:p[0],end:p[1]})}})}async queryAttachments(e,t={}){await this.load();const r=this._getLayerRequestOptions(t);return this.queryTask.executeAttachmentQuery(e,r)}async queryFeatures(e,t){var s;await this.load();const r=await this.queryTask.execute(e,{...t,query:this._createRequestQueryOptions(t)});return(s=e.outStatistics)!=null&&s.length&&r.features.length&&r.features.forEach(a=>{var i;const o=a.attributes;(i=e.outStatistics)==null||i.forEach(({outStatisticFieldName:n})=>{if(n){const u=n.toLowerCase();u&&u in o&&n!==u&&(o[n]=o[u],delete o[u])}})}),r}async queryFeaturesJSON(e,t){return await this.load(),this.queryTask.executeJSON(e,{...t,query:this._createRequestQueryOptions(t)})}async queryObjectIds(e,t){return await this.load(),this.queryTask.executeForIds(e,{...t,query:this._createRequestQueryOptions(t)})}async queryFeatureCount(e,t){return await this.load(),this.queryTask.executeForCount(e,{...t,query:this._createRequestQueryOptions(t)})}async queryExtent(e,t){return await this.load(),this.queryTask.executeForExtent(e,{...t,query:this._createRequestQueryOptions(t)})}async queryRelatedFeatures(e,t){return await this.load(),this.queryTask.executeRelationshipQuery(e,{...t,query:this._createRequestQueryOptions(t)})}async queryRelatedFeaturesCount(e,t){return await this.load(),this.queryTask.executeRelationshipQueryForCount(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopFeatures(e,t){return await this.load(),this.queryTask.executeTopFeaturesQuery(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopObjectIds(e,t){return await this.load(),this.queryTask.executeForTopIds(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopExtents(e,t){return await this.load(),this.queryTask.executeForTopExtents(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopCount(e,t){return await this.load(),this.queryTask.executeForTopCount(e,{...t,query:this._createRequestQueryOptions(t)})}async fetchPublishingStatus(){if(!it(this.layer.url))return"unavailable";const e=x(this.layer.url,"status"),t=await h(e,{query:{f:"json"}});return ft.fromJSON(t.data.status)}async uploadAssets(e,t){const{uploadAssets:r}=await M(()=>import("./uploadAssets-C1ITHwKi.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url);return r(e,{layer:this.layer,ongoingUploads:this._ongoingAssetUploads},t)}_handleLastEditsEventChange(e){var s,a,o,i;const t=this.layer;if(e==null||!("capabilities"in t)||!("effectiveCapabilities"in t)||!(!((a=(s=t.capabilities)==null?void 0:s.operations)!=null&&a.supportsEditing)&&((i=(o=t.effectiveCapabilities)==null?void 0:o.operations)!=null&&i.supportsEditing)))return;const r=t.url;r!=null&&("layerId"in t&&x(r,t.layerId.toString()),this._getOrCreateEditInterceptor(r).before=n=>{const u=n.requestOptions.method??"auto";if(u==="auto"||u==="head"){const p=n.requestOptions.query??{};p._ts=e.getTime(),n.requestOptions.query=p}})}_getOrCreateEditInterceptor(e){return this._editInterceptor==null&&(this._editInterceptor={urls:e},D.request.internalInterceptors.push(this._editInterceptor)),this._editInterceptor}_removeEditInterceptor(){this._editInterceptor!=null&&(U(D.request.internalInterceptors,this._editInterceptor),this._editInterceptor=null)}async _asyncApplyEdits(e,t){const r=(await h(e,t)).data.statusUrl;for(;;){const s=(await h(r,{query:{f:"json"},responseType:"json"})).data;switch(s.status){case"Completed":return h(s.resultUrl,{query:{f:"json"},responseType:"json"});case"CompletedWithErrors":throw new E("async-applyEdits-failed","asynchronous applyEdits call failed.");case"Failed ImportChanges":case"InProgress":case"Pending":case"ExportAttachments":case"ExportChanges":case"ExportingData":case"ExportingSnapshot":case"ImportAttachments":case"ProvisioningReplica":case"UnRegisteringReplica":break;default:throw new E("async-applyEdits-failed","asynchronous applyEdits call failed (undefined response status)")}await G(gt)}}_createRequestQueryOptions(e){const t={...this.layer.customParameters,token:this.layer.apiKey,...e==null?void 0:e.query};return this.layer.datesInUnknownTimezone&&(t.timeReferenceUnknownClient=!0),t}async _fetchService(e,t){if(!e){const s={};N("featurelayer-advanced-symbols")&&(s.returnAdvancedSymbols=!0),t!=null&&t.cacheBust&&(s._ts=Date.now());const{data:a}=await h(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:s,signal:t==null?void 0:t.signal}));e=a}this.sourceJSON=await this._patchServiceJSON(e,t==null?void 0:t.signal);const r=e.type;if(!this.supportedSourceTypes.has(r))throw new E("feature-layer-source:unsupported-type",`Source type "${r}" is not supported`)}async _patchServiceJSON(e,t){var r;if(e.type!=="Table"&&e.geometryType&&!((r=e==null?void 0:e.drawingInfo)!=null&&r.renderer)&&!e.defaultSymbol){const s=st(e.geometryType).renderer;P("drawingInfo.renderer",s,e)}if(e.geometryType==="esriGeometryMultiPatch"&&e.infoFor3D&&(e.geometryType="mesh"),e.extent==null)try{const{data:s}=await h(this.layer.url,this._getLayerRequestOptions({signal:t}));s.spatialReference&&(e.extent={xmin:0,ymin:0,xmax:0,ymax:0,spatialReference:s.spatialReference})}catch(s){H(s)}return e}async _ensureLatestMetadata(e){if(this.layer.userHasUpdateItemPrivileges&&this.sourceJSON.cacheMaxAge>0)return this._fetchService(null,{...e,cacheBust:!0})}async _uploadMeshesAndGetAssetMapEditsJSON(e){const{addAssetFeatures:t}=e;if(!(t!=null&&t.length)||await this._areAllAssetsAlreadyMapped(t))return null;const r=e.addFeatures.filter(o=>o.geometry);if(t.length!==r.length+e.updateFeatures.length)throw new E("feature-layer-source:unsupported-mesh-edits","Mixing attribute only edits with mesh geometry edits is not currently supported");const s=new Array,a=new Map;for(const o of t){const{geometry:i}=o,{vertexSpace:n}=i;if(X(n))s.push(i);else{const u=i.anchor,{convertMeshVertexSpace:p}=await M(async()=>{const{convertMeshVertexSpace:f}=await import("./convertMeshVertexSpace-BDDIu0UT.js");return{convertMeshVertexSpace:f}},__vite__mapDeps([14,2,6,15,5,1,3,4,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45]),import.meta.url),l=await p(i,new W({origin:[u.x,u.y,u.z??0]}));a.set(l,i),o.geometry=l,s.push(l)}}await this.uploadAssets(s);for(const[o,i]of a)i.addExternalSources(o.metadata.externalSources.items);return{adds:this._getAssetMapEditsJSON(t),updates:[],deletes:[]}}_getAssetMapEditsJSON(e){const t=new Array,r=this.layer.globalIdField,s=this.layer.parsedUrl;for(const a of e){const o=a.geometry,{metadata:i}=o,n=i.getExternalSourcesOnService(s),u=a.getAttribute(r);if(n.length===0){J.getLogger(this).error(`Skipping feature ${u}. The mesh it is associated with has not been uploaded to the service and cannot be mapped to it.`);continue}const{source:p}=n.find(Y)??n[0];for(const l of p)l.parts.length===1?t.push({globalId:B(),parentGlobalId:u,assetName:l.assetName,assetHash:l.parts[0].partHash,flags:[]}):J.getLogger(this).error(`Skipping asset ${l.assetName}. It does not have exactly one part, so we cannot map it to a feature.`)}return t}_createEditsResult(e){const t=e.data,{layerId:r}=this.layer,s=[];let a=null;if(Array.isArray(t))for(const i of t)s.push({id:i.id,editedFeatures:i.editedFeatures}),i.id===r&&(a={addResults:i.addResults??[],updateResults:i.updateResults??[],deleteResults:i.deleteResults??[],attachments:i.attachments,editMoment:i.editMoment});else a=t;const o=et(a);if(s.length>0){o.editedFeatureResults=[];for(const i of s){const{editedFeatures:n}=i,u=n!=null&&n.spatialReference?new yt(n.spatialReference):null;o.editedFeatureResults.push({layerId:i.id,editedFeatures:rt(n,u)})}}return o}_createAttachmentErrorResult(e,t){var a;const r=((a=t.details.messages)==null?void 0:a[0])||t.message,s=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new E("feature-layer-source:attachment-failure",r,{code:s})}}_getFormDataForAttachment(e,t){const r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(const s in t){const a=t[s];a!=null&&(r.set?r.set(s,a):r.append(s,a))}return r}_getLayerRequestOptions(e={}){const{layer:t,layer:{parsedUrl:r,gdbVersion:s}}=this;return{...e,query:{gdbVersion:s,layer:"dynamicDataSource"in t&&t.dynamicDataSource?JSON.stringify({source:t.dynamicDataSource}):void 0,...r.query,f:"json",...this._createRequestQueryOptions(e)},responseType:"json"}}async _areAllAssetsAlreadyMapped(e){const{layer:t}=this,{globalIdField:r,parsedUrl:s}=t,a="infoFor3D"in t?t.infoFor3D:null;if(a==null||r==null)return!1;const o=ot(a);if(o==null)return!1;const i=x(s.path,`../${o.id}`),n=new Array;for(const c of e){if(!(c.geometry.metadata.getExternalSourcesOnService(s).length>0))return!1;n.push(c)}const u=n.map(c=>c.getAttribute(r)).filter(v);if(u.length===0)return!1;const{assetMapFieldRoles:{parentGlobalId:p,assetHash:l}}=a,f=new lt({where:`${p} IN (${u.map(c=>`'${c}'`)})`,outFields:[l,p],returnGeometry:!1}),O=await nt(i,f),{features:w}=O;return w.length!==0&&!n.some(c=>{const d=c.getAttribute(r);if(!d)return!0;const{metadata:F}=c.geometry,y=w.filter(m=>m.getAttribute(p)===d);if(y.length===0)return!0;const q=y.map(m=>m.getAttribute(l));return F.getExternalSourcesOnService(s).flatMap(({source:m})=>m.flatMap(S=>S.parts.map(R=>R.partHash))).some(m=>q.every(S=>m!==S))})}};b([A()],g.prototype,"type",void 0),b([A({constructOnly:!0})],g.prototype,"layer",void 0),b([A({constructOnly:!0})],g.prototype,"supportedSourceTypes",void 0),b([A({readOnly:!0})],g.prototype,"queryTask",null),g=b([L("esri.layers.graphics.sources.FeatureLayerSource")],g);const gt=1e3,dr=g;export{dr as default};
