import{s as x,_ as qe}from"./Accessor-BmwT4B0c.js";import{i as Me,r as Re,a as ze,o as Ie}from"./colorUtils-Rxh2V3ai.js";import{t as Ne,e as Te,c as Be,d as De,l as Je,m as Le,f as Ue,p as Ge,a as _e}from"./utils-DYurMneM.js";function He(e,u){function c(){this.constructor=e}c.prototype=u.prototype,e.prototype=new c}function I(e,u,c,n){var f=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(f,I.prototype),f.expected=u,f.found=c,f.location=n,f.name="SyntaxError",f}function _(e,u,c){return c=c||" ",e.length>u?e:(u-=e.length,e+(c+=c.repeat(u)).slice(0,u))}function Ke(e,u){var c,n={},f=(u=u!==void 0?u:{}).grammarSource,F={start:gt},q=gt,M="none",R=")",h=",",d="(",C="%",y="px",V="cm",W="mm",X="in",Y="pt",Z="pc",tt="deg",et="rad",nt="grad",rt="turn",xt="#",At=".",$t="e",at=/^[ \t\n\r]/,ut=/^[a-z\-]/,ot=/^[0-9a-fA-F]/,ct=/^[+\-]/,P=/^[0-9]/,Ft=k("none"),Ct=w("none",!1),Et=w(")",!1),st=w(",",!1),jt=k("whitespace"),it=T([" ","	",`
`,"\r"],!1,!1),kt=k("function"),Ot=w("(",!1),Pt=k("identifier"),lt=T([["a","z"],"-"],!1,!1),St=k("percentage"),qt=w("%",!1),Mt=k("length"),Rt=w("px",!1),zt=w("cm",!1),It=w("mm",!1),Nt=w("in",!1),Tt=w("pt",!1),Bt=w("pc",!1),Dt=k("angle"),Jt=w("deg",!1),Lt=w("rad",!1),Ut=w("grad",!1),Gt=w("turn",!1),_t=k("number"),Ht=k("color"),Kt=w("#",!1),ft=T([["0","9"],["a","f"],["A","F"]],!1,!1),pt=T(["+","-"],!1,!1),S=T([["0","9"]],!1,!1),Qt=w(".",!1),Vt=w("e",!1),Wt=function(){return[]},Xt=function(t,a){return{type:"function",name:t,parameters:a||[]}},Yt=function(t,a){return a.length>0?Se(t,a,3):[t]},Zt=function(t){return{type:"quantity",value:t.value,unit:t.unit}},te=function(t){return{type:"color",colorType:t.type,value:t.value}},ee=function(t){return t},ne=function(){return J()},re=function(t){return{value:t,unit:"%"}},ae=function(t){return{value:t,unit:"px"}},ue=function(t){return{value:t,unit:"cm"}},oe=function(t){return{value:t,unit:"mm"}},ce=function(t){return{value:t,unit:"in"}},se=function(t){return{value:t,unit:"pt"}},ie=function(t){return{value:t,unit:"pc"}},le=function(t){return{value:t,unit:"deg"}},fe=function(t){return{value:t,unit:"rad"}},pe=function(t){return{value:t,unit:"grad"}},he=function(t){return{value:t,unit:"turn"}},me=function(t){return{value:t,unit:null}},ge=function(){return{type:"hex",value:J()}},de=function(t){return{type:"function",value:t}},ve=function(){return{type:"named",value:J()}},ye=function(){return parseFloat(J())},r=0|u.peg$currPos,m=r,z=[{line:1,column:1}],E=r,D=u.peg$maxFailExpected||[],s=0|u.peg$silentFails;if(u.startRule){if(!(u.startRule in F))throw new Error(`Can't start parsing from rule "`+u.startRule+'".');q=F[u.startRule]}function J(){return e.substring(m,r)}function w(t,a){return{type:"literal",text:t,ignoreCase:a}}function T(t,a,o){return{type:"class",parts:t,inverted:a,ignoreCase:o}}function we(){return{type:"end"}}function k(t){return{type:"other",description:t}}function ht(t){var a,o=z[t];if(o)return o;if(t>=z.length)a=z.length-1;else for(a=t;!z[--a];);for(o={line:(o=z[a]).line,column:o.column};a<t;)e.charCodeAt(a)===10?(o.line++,o.column=1):o.column++,a++;return z[t]=o,o}function mt(t,a,o){var i=ht(t),p=ht(a);return{source:f,start:{offset:t,line:i.line,column:i.column},end:{offset:a,line:p.line,column:p.column}}}function l(t){r<E||(r>E&&(E=r,D=[]),D.push(t))}function be(t,a,o){return new I(I.buildMessage(t,a),t,a,o)}function gt(){var t;return(t=xe())===n&&(t=Ae()),t}function xe(){var t,a;return s++,t=r,b(),e.substr(r,4)===M?(a=M,r+=4):(a=n,s===0&&l(Ct)),a!==n?(b(),m=t,t=Wt()):(r=t,t=n),s--,t===n&&s===0&&l(Ft),t}function Ae(){var t,a;if(t=[],(a=U())!==n)for(;a!==n;)t.push(a),a=U();else t=n;return t}function U(){var t,a,o,i;return t=r,b(),(a=Fe())!==n?(b(),(o=$e())===n&&(o=null),b(),e.charCodeAt(r)===41?(i=R,r++):(i=n,s===0&&l(Et)),i!==n?(b(),m=t,t=Xt(a,o)):(r=t,t=n)):(r=t,t=n),t}function $e(){var t,a,o,i,p,g,v,A;if(t=r,(a=G())!==n){for(o=[],i=r,p=b(),e.charCodeAt(r)===44?(g=h,r++):(g=n,s===0&&l(st)),g===n&&(g=null),v=b(),(A=G())!==n?i=p=[p,g,v,A]:(r=i,i=n);i!==n;)o.push(i),i=r,p=b(),e.charCodeAt(r)===44?(g=h,r++):(g=n,s===0&&l(st)),g===n&&(g=null),v=b(),(A=G())!==n?i=p=[p,g,v,A]:(r=i,i=n);m=t,t=Yt(a,o)}else r=t,t=n;return t}function G(){var t,a;return t=r,(a=Ce())===n&&(a=Ee())===n&&(a=je())===n&&(a=ke()),a!==n&&(m=t,a=Zt(a)),(t=a)===n&&(t=r,(a=Oe())!==n&&(m=t,a=te(a)),t=a),t}function b(){var t,a;for(s++,t=[],a=e.charAt(r),at.test(a)?r++:(a=n,s===0&&l(it));a!==n;)t.push(a),a=e.charAt(r),at.test(a)?r++:(a=n,s===0&&l(it));return s--,a=n,s===0&&l(jt),t}function Fe(){var t,a,o;return s++,t=r,(a=dt())!==n?(e.charCodeAt(r)===40?(o=d,r++):(o=n,s===0&&l(Ot)),o!==n?(m=t,t=ee(a)):(r=t,t=n)):(r=t,t=n),s--,t===n&&(a=n,s===0&&l(kt)),t}function dt(){var t,a,o;if(s++,t=r,a=[],o=e.charAt(r),ut.test(o)?r++:(o=n,s===0&&l(lt)),o!==n)for(;o!==n;)a.push(o),o=e.charAt(r),ut.test(o)?r++:(o=n,s===0&&l(lt));else a=n;return a!==n&&(m=t,a=ne()),s--,(t=a)===n&&(a=n,s===0&&l(Pt)),t}function Ce(){var t,a,o;return s++,t=r,b(),(a=$())!==n?(e.charCodeAt(r)===37?(o=C,r++):(o=n,s===0&&l(qt)),o!==n?(m=t,t=re(a)):(r=t,t=n)):(r=t,t=n),s--,t===n&&s===0&&l(St),t}function Ee(){var t,a,o;return s++,t=r,b(),(a=$())!==n?(e.substr(r,2)===y?(o=y,r+=2):(o=n,s===0&&l(Rt)),o!==n?(m=t,t=ae(a)):(r=t,t=n)):(r=t,t=n),t===n&&(t=r,b(),(a=$())!==n?(e.substr(r,2)===V?(o=V,r+=2):(o=n,s===0&&l(zt)),o!==n?(m=t,t=ue(a)):(r=t,t=n)):(r=t,t=n),t===n&&(t=r,b(),(a=$())!==n?(e.substr(r,2)===W?(o=W,r+=2):(o=n,s===0&&l(It)),o!==n?(m=t,t=oe(a)):(r=t,t=n)):(r=t,t=n),t===n&&(t=r,b(),(a=$())!==n?(e.substr(r,2)===X?(o=X,r+=2):(o=n,s===0&&l(Nt)),o!==n?(m=t,t=ce(a)):(r=t,t=n)):(r=t,t=n),t===n&&(t=r,b(),(a=$())!==n?(e.substr(r,2)===Y?(o=Y,r+=2):(o=n,s===0&&l(Tt)),o!==n?(m=t,t=se(a)):(r=t,t=n)):(r=t,t=n),t===n&&(t=r,b(),(a=$())!==n?(e.substr(r,2)===Z?(o=Z,r+=2):(o=n,s===0&&l(Bt)),o!==n?(m=t,t=ie(a)):(r=t,t=n)):(r=t,t=n)))))),s--,t===n&&s===0&&l(Mt),t}function je(){var t,a,o;return s++,t=r,(a=$())!==n?(e.substr(r,3)===tt?(o=tt,r+=3):(o=n,s===0&&l(Jt)),o!==n?(m=t,t=le(a)):(r=t,t=n)):(r=t,t=n),t===n&&(t=r,(a=$())!==n?(e.substr(r,3)===et?(o=et,r+=3):(o=n,s===0&&l(Lt)),o!==n?(m=t,t=fe(a)):(r=t,t=n)):(r=t,t=n),t===n&&(t=r,(a=$())!==n?(e.substr(r,4)===nt?(o=nt,r+=4):(o=n,s===0&&l(Ut)),o!==n?(m=t,t=pe(a)):(r=t,t=n)):(r=t,t=n),t===n&&(t=r,(a=$())!==n?(e.substr(r,4)===rt?(o=rt,r+=4):(o=n,s===0&&l(Gt)),o!==n?(m=t,t=he(a)):(r=t,t=n)):(r=t,t=n)))),s--,t===n&&(a=n,s===0&&l(Dt)),t}function ke(){var t,a;return s++,t=r,b(),(a=$())!==n?(m=t,t=me(a)):(r=t,t=n),s--,t===n&&s===0&&l(_t),t}function Oe(){var t,a,o,i;if(s++,t=r,e.charCodeAt(r)===35?(a=xt,r++):(a=n,s===0&&l(Kt)),a!==n){if(o=[],i=e.charAt(r),ot.test(i)?r++:(i=n,s===0&&l(ft)),i!==n)for(;i!==n;)o.push(i),i=e.charAt(r),ot.test(i)?r++:(i=n,s===0&&l(ft));else o=n;o!==n?(m=t,t=ge()):(r=t,t=n)}else r=t,t=n;return t===n&&(t=r,(a=U())!==n&&(m=t,a=de(a)),(t=a)===n&&(t=r,(a=dt())!==n&&(m=t,a=ve()),t=a)),s--,t===n&&(a=n,s===0&&l(Ht)),t}function $(){var t,a,o,i,p,g,v,A;for(t=r,a=e.charAt(r),ct.test(a)?r++:(a=n,s===0&&l(pt)),a===n&&(a=null),o=r,i=[],p=e.charAt(r),P.test(p)?r++:(p=n,s===0&&l(S));p!==n;)i.push(p),p=e.charAt(r),P.test(p)?r++:(p=n,s===0&&l(S));if(e.charCodeAt(r)===46?(p=At,r++):(p=n,s===0&&l(Qt)),p!==n){if(g=[],v=e.charAt(r),P.test(v)?r++:(v=n,s===0&&l(S)),v!==n)for(;v!==n;)g.push(v),v=e.charAt(r),P.test(v)?r++:(v=n,s===0&&l(S));else g=n;g!==n?o=i=[i,p,g]:(r=o,o=n)}else r=o,o=n;if(o===n)if(o=[],i=e.charAt(r),P.test(i)?r++:(i=n,s===0&&l(S)),i!==n)for(;i!==n;)o.push(i),i=e.charAt(r),P.test(i)?r++:(i=n,s===0&&l(S));else o=n;if(o!==n){if(i=r,e.charCodeAt(r)===101?(p=$t,r++):(p=n,s===0&&l(Vt)),p!==n){if(g=e.charAt(r),ct.test(g)?r++:(g=n,s===0&&l(pt)),g===n&&(g=null),v=[],A=e.charAt(r),P.test(A)?r++:(A=n,s===0&&l(S)),A!==n)for(;A!==n;)v.push(A),A=e.charAt(r),P.test(A)?r++:(A=n,s===0&&l(S));else v=n;v!==n?i=p=[p,g,v]:(r=i,i=n)}else r=i,i=n;i===n&&(i=null),m=t,t=ye()}else r=t,t=n;return t}function Pe(t,a){return t.map(function(o){return o[a]})}function Se(t,a,o){return[t].concat(Pe(a,o))}if(c=q(),u.peg$library)return{peg$result:c,peg$currPos:r,peg$FAILED:n,peg$maxFailExpected:D,peg$maxFailPos:E};if(c!==n&&r===e.length)return c;throw c!==n&&r<e.length&&l(we()),be(D,E<e.length?e.charAt(E):null,E<e.length?mt(E,E+1):mt(E,E))}function wt(e){if(!e||e.length===0)return null;if(typeof e=="string"){const c=vt(e);return c&&c.length!==0?c:null}const u=e.map(c=>{if(!Number.isFinite(c.scale)||c.scale<=0)throw new x("effect:invalid-scale","scale must be finite and greater than 0",{stop:c});return{scale:c.scale,effects:vt(c.value)}});u.sort((c,n)=>n.effects.length-c.effects.length);for(let c=0;c<u.length-1;c++){if(!Ne(u[c].effects,u[c+1].effects))throw new x("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:u[c].effects,b:u[c+1].effects});Te(u[c].effects,u[c+1].effects)}return u.sort((c,n)=>n.scale-c.scale),u}function vt(e){let u;if(!e)return[];try{u=Ke(e)}catch(c){throw new x("effect:invalid-syntax","Invalid effect syntax",{value:e,error:c})}return u.map(c=>Qe(c))}function Qe(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return Ve(e);case"opacity":return We(e);case"hue-rotate":return Xe(e);case"blur":return Ye(e);case"drop-shadow":return Ze(e);case"bloom":return tn(e)}}catch(u){throw u.details.filter=e,u}throw new x("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}function Ve(e){let u=1;return N(e.parameters,1),e.parameters.length===1&&(u=j(e.parameters[0])),new Ge(e.name,u)}function We(e){let u=1;return N(e.parameters,1),e.parameters.length===1&&(u=j(e.parameters[0])),new Ue(u)}function Xe(e){let u=0;return N(e.parameters,1),e.parameters.length===1&&(u=on(e.parameters[0])),new Le(u)}function Ye(e){let u=0;return N(e.parameters,1),e.parameters.length===1&&(u=Q(e.parameters[0]),B(u,e.parameters[0])),new Je(u)}function Ze(e){const u=[];let c=null;for(const n of e.parameters)if(n.type==="color"){if(u.length&&Object.freeze(u),c)throw new x("effect:type-error","Accepts only one color",{});c=cn(n)}else{const f=Q(n);if(Object.isFrozen(u))throw new x("effect:type-error","<length> parameters not consecutive",{lengths:u});u.push(f),u.length===3&&B(f,n)}if(u.length<2||u.length>3)throw new x("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${u.length}}`,{lengths:u});return new De(u[0],u[1],u[2]||0,c||bt("black"))}function tn(e){let u=1,c=0,n=0;return N(e.parameters,3),e.parameters[0]&&(u=j(e.parameters[0])),e.parameters[1]&&(c=Q(e.parameters[1]),B(c,e.parameters[1])),e.parameters[2]&&(n=j(e.parameters[2])),new Be(u,c,n)}function N(e,u){if(e.length>u)throw new x("effect:type-error",`Function supports up to ${u} parameters, Actual: ${e.length}`,{parameters:e})}function L(e){if(e.type==="color")return"<color>";if(e.unit){if(e.unit in K)return"<length>";if(e.unit in H)return"<angle>";if(e.unit==="%")return"<percentage>"}return"<double>"}function B(e,u){if(e<0)throw new x("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:u})}function en(e){if(e.type!=="quantity"||e.unit!==null)throw new x("effect:type-error",`Expected <double>, Actual: ${L(e)}`,{term:e})}function nn(e){if(e.type!=="quantity"||e.unit!==null&&e.unit!=="%")throw new x("effect:type-error",`Expected <double> or <percentage>, Actual: ${L(e)}`,{term:e})}He(I,Error),I.prototype.format=function(e){var u="Error: "+this.message;if(this.location){var c,n=null;for(c=0;c<e.length;c++)if(e[c].source===this.location.source){n=e[c].text.split(/\r\n|\n|\r/g);break}var f=this.location.start,F=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(f):f,q=this.location.source+":"+F.line+":"+F.column;if(n){var M=this.location.end,R=_("",F.line.toString().length," "),h=n[f.line-1],d=(f.line===M.line?M.column:h.length+1)-f.column||1;u+=`
 --> `+q+`
`+R+` |
`+F.line+" | "+h+`
`+R+" | "+_("",f.column-1," ")+_("",d,"^")}else u+=`
 at `+q}return u},I.buildMessage=function(e,u){var c={literal:function(h){return'"'+f(h.text)+'"'},class:function(h){var d=h.parts.map(function(C){return Array.isArray(C)?F(C[0])+"-"+F(C[1]):F(C)});return"["+(h.inverted?"^":"")+d.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(h){return h.description}};function n(h){return h.charCodeAt(0).toString(16).toUpperCase()}function f(h){return h.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+n(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+n(d)})}function F(h){return h.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+n(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+n(d)})}function q(h){return c[h.type](h)}function M(h){var d,C,y=h.map(q);if(y.sort(),y.length>0){for(d=1,C=1;d<y.length;d++)y[d-1]!==y[d]&&(y[C]=y[d],C++);y.length=C}switch(y.length){case 1:return y[0];case 2:return y[0]+" or "+y[1];default:return y.slice(0,-1).join(", ")+", or "+y[y.length-1]}}function R(h){return h?'"'+f(h)+'"':"end of input"}return"Expected "+M(e)+" but "+R(u)+" found."};const H={deg:1,grad:.9,rad:180/Math.PI,turn:360};function rn(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&H[e.unit]!=null))throw new x("effect:type-error",`Expected <angle>, Actual: ${L(e)}`,{term:e})}const K={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function an(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&K[e.unit]!=null))throw new x("effect:type-error",`Expected <length>, Actual: ${L(e)}`,{term:e})}function j(e){nn(e);const u=e.value;return B(u,e),e.unit==="%"?.01*u:u}function un(e){return en(e),B(e.value,e),e.value}function on(e){return rn(e),e.value*H[e.unit]||0}function Q(e){return an(e),e.value*K[e.unit]||0}function cn(e){switch(e.colorType){case"hex":return Me(e.value);case"named":return bt(e.value);case"function":return fn(e.value)}}function bt(e){if(!Re(e))throw new x("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return ze(e)}const sn=/^rgba?/i,ln=/^hsla?/i;function fn(e){if(N(e.parameters,4),sn.test(e.name))return[j(e.parameters[0]),j(e.parameters[1]),j(e.parameters[2]),e.parameters[3]?j(e.parameters[3]):1];if(ln.test(e.name))return Ie(un(e.parameters[0]),j(e.parameters[1]),j(e.parameters[2]),e.parameters[3]?j(e.parameters[3]):1);throw new x("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}function wn(e,u,c){var n;try{return hn(e)}catch(f){(n=c==null?void 0:c.messages)==null||n.push(f)}return null}function bn(e,u,c,n){try{const f=pn(e);qe(c,f,u)}catch(f){n.messages&&n.messages.push(f)}}function pn(e){const u=wt(e);return u?_e(u)?u.map(c=>c.toJSON()):u.map(({scale:c,effects:n})=>({scale:c,value:n.map(f=>f.toJSON())})):null}function hn(e){if(!e||e.length===0)return null;if(mn(e)){const u=[];for(const c of e)u.push({scale:c.scale,value:yt(c.value)});return u}return yt(e)}function mn(e){const u=e[0];return!!u&&"scale"in u}function yt(e){if(!(e!=null&&e.length))return"";const u=[];for(const c of e){let n=[];switch(c.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":n=[O(c,"amount")];break;case"blur":n=[O(c,"radius","pt")];break;case"hue-rotate":n=[O(c,"angle","deg")];break;case"drop-shadow":n=[O(c,"xoffset","pt"),O(c,"yoffset","pt"),O(c,"blurRadius","pt"),gn(c,"color")];break;case"bloom":n=[O(c,"strength"),O(c,"radius","pt"),O(c,"threshold")]}const f=`${c.type}(${n.filter(Boolean).join(" ")})`;wt(f),u.push(f)}return u.join(" ")}function O(e,u,c){if(e[u]==null)throw new x("effect:missing-parameter",`Missing parameter '${u}' in ${e.type} effect`,{effect:e});return c?e[u]+c:""+e[u]}function gn(e,u){if(e[u]==null)throw new x("effect:missing-parameter",`Missing parameter '${u}' in ${e.type} effect`,{effect:e});const c=e[u];return`rgba(${c[0]||0}, ${c[1]||0}, ${c[2]||0}, ${c[3]/255||0})`}export{bn as a,wt as d,yt as i,wn as n};
