const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./calcite-action-eUVYjjgY.js","./action-CFB8-9mS.js","./jsxFactory-Be5PKa9i.js","./Evented-CXIxDjmW.js","./Accessor-D6mNnsWy.js","./subclass-BR3PhgZG.js","./intl-CArXn1et.js","./Promise-CZrWwByK.js","./jsonMap-DCC6W5ex.js","./assets-BNizZMOZ.js","./index-BVncS3aY.js","./index-CjOb8WjV.css","./reactiveUtils-BFQ0BtrB.js","./shared-B3wH2qpO.js","./uuid-fwrPAdZb.js","./dom-BkQ_hHOr.js","./interactive-QOqfpSSx.js","./loadable-Bgtgv1lm.js","./locale-BvYy6Wxh.js","./key-D5DPfjW0.js","./observers-DSkGD1TQ.js","./component-ByvC-PUv.js","./t9n-Atzq4sOi.js","./icon-D6t4qKDg.js","./loader-ew3V3w9x.js","./calcite-button-BbY9lAf2.js","./button-D5KuIed_.js","./form-BOCdnUd9.js","./label-1rGx7O4B.js","./calcite-chip-group-EAHbf3XL.js","./calcite-chip-YmBsgRpo.js","./chip-Rm2iopRG.js","./calcite-fab-CCu7SxsK.js","./calcite-flow-BBEB5sRb.js","./calcite-flow-item-BTLah491.js","./panel-LE_lpRLv.js","./action-menu-M1XR2Dkh.js","./array-DofFqflK.js","./popover-DLRbisRr.js","./floating-ui-5U9KNmUg.js","./debounce-C5YDvsuO.js","./focusTrapComponent-Bepj0OOn.js","./openCloseComponent-Bqj9CrBJ.js","./Heading-DQrTi3L3.js","./FloatingArrow-BN7WHE4B.js","./scrim-fRLdjgt6.js","./calcite-icon-DtUarwQp.js","./calcite-input-p_Le978W.js","./input2-BjqyiC1c.js","./Validation-Dm76Kltf.js","./input-Dt5r39B0.js","./input-message-BGlL44gg.js","./progress-CMyqabfC.js","./calcite-input-message-DHYZOFye.js","./calcite-label-Ddcwlp7C.js","./calcite-list-CauCCaYV.js","./resources4-CT6dxwoZ.js","./utils3-SlIPNAt8.js","./filter-BHzLPuAd.js","./calcite-list-item-DnfVo5id.js","./handle-DVEsJI64.js","./calcite-loader-Cyav0WwQ.js","./calcite-notice-CVdHfJFK.js","./conditionalSlot-eNLH0S30.js","./calcite-scrim-CYwFbyZL.js","./calcite-switch-CfyCkhzI.js","./switch-DRZSyDYK.js","./calcite-table-B530M8Rl.js","./calcite-table-cell-D6hEGg_N.js","./table-cell-CmrHDdvw.js","./calcite-table-header-hgRaWuC3.js","./table-header-C_R-STyv.js","./calcite-table-row-BtZtAr1i.js"])))=>i.map(i=>d[i]);
import{_ as c}from"./index-BVncS3aY.js";import{e as n,o as Q}from"./Evented-CXIxDjmW.js";import{y as l,b as D,c as f,n as A,O as W}from"./subclass-BR3PhgZG.js";import{S as Z,O as x}from"./Accessor-D6mNnsWy.js";import{s as X}from"./Identifiable-BLvpQbOc.js";import{j as M,E as V,o as P}from"./Promise-CZrWwByK.js";import{u as C,t as Y}from"./timeProperties-DTLK6JEV.js";import{B as tt,r as et,n as a,e as q}from"./jsxFactory-Be5PKa9i.js";import{m as ot}from"./Viewpoint-7_owAOZm.js";import{V as it}from"./reactiveUtils-BFQ0BtrB.js";import{s as rt}from"./jsonMap-DCC6W5ex.js";import{f as G}from"./Bookmark-CmB4s9qL.js";import{t as at}from"./GoTo-CyjNnle5.js";import{e as T}from"./globalCss-CZa70j6i.js";import{e as nt}from"./Heading-DPYpGh42.js";import{e as lt}from"./vmEvent-D4Ubqkbq.js";import"./assets-BNizZMOZ.js";import"./TimeExtent-Dl-qaORu.js";import"./timeUtils-DQR2jUPL.js";import"./writer-3zufXUNV.js";import"./intl-CArXn1et.js";import"./uuid-fwrPAdZb.js";import"./Clonable-cKbRam6-.js";import"./Cyclical-BY_I03kj.js";import"./mathUtils-ClvKsMak.js";import"./Point-TlcsOcXV.js";import"./geometry-CnaxvJsv.js";import"./Extent-B4rrMrqp.js";import"./Polyline-BQFeqYXi.js";import"./jsonUtils-DtWlwXHP.js";import"./shared-B3wH2qpO.js";let g=class extends Z{constructor(e){super(e)}get editedBookmark(){const{bookmark:e}=this;return e?this._get("editedBookmark")||e.clone():null}get customUrl(){var e,o,i,r;return(o=(e=this.editedBookmark)==null?void 0:e.thumbnail)!=null&&o.isSecureUrl?(r=(i=this.editedBookmark)==null?void 0:i.thumbnail)==null?void 0:r.url:null}set customUrl(e){this._override("customUrl",e)}get screenshotUrl(){var e,o,i,r;return(o=(e=this.editedBookmark)==null?void 0:e.thumbnail)!=null&&o.isDataURI?(r=(i=this.editedBookmark)==null?void 0:i.thumbnail)==null?void 0:r.url:null}set screenshotUrl(e){this._override("screenshotUrl",e)}get state(){return this._get("state")}set state(e){this.validationState=void 0,this.loading=void 0,this._set("state",e)}get thumbnailState(){var e,o,i,r;return(o=(e=this.editedBookmark)==null?void 0:e.thumbnail)!=null&&o.url?(r=(i=this.editedBookmark)==null?void 0:i.thumbnail)!=null&&r.isSecureUrl?"url":"screenshot":"none"}set thumbnailState(e){this._overrideIfSome("thumbnailState",e)}};n([l()],g.prototype,"bookmark",void 0),n([l({readOnly:!0})],g.prototype,"editedBookmark",null),n([l()],g.prototype,"customUrl",null),n([l()],g.prototype,"screenshotUrl",null),n([l()],g.prototype,"state",null),n([l()],g.prototype,"thumbnailState",null),n([l()],g.prototype,"validationState",void 0),n([l()],g.prototype,"loading",void 0),g=n([D("esri.widgets.Bookmarks.BookmarksUserState")],g);const L=g,j=it.ofType(G),st={width:128,height:128,format:"png"},S={takeScreenshot:!0,captureViewpoint:!0,captureRotation:!0,captureScale:!0,captureTimeExtent:!0},H={time:!0};let v=class extends at(Q.EventedAccessor){constructor(t){super(t),this.capabilities={...H},this.activeBookmark=null,this.view=null}destroy(){this.view=null,this._set("activeBookmark",null)}castCapabilities(t){return{...H,...t}}get bookmarks(){var t,e;return((e=(t=this.view)==null?void 0:t.map)==null?void 0:e.bookmarks)??new j}set bookmarks(t){this._overrideIfSome("bookmarks",t)}set defaultCreateOptions(t){this._set("defaultCreateOptions",{...S,...t})}get defaultCreateOptions(){return S}set defaultEditOptions(t){this._set("defaultEditOptions",{...S,...t})}get defaultEditOptions(){return S}get state(){const{view:t}=this;return t&&!t.ready?"loading":"ready"}async createBookmark(t){const{view:e,defaultCreateOptions:o,capabilities:i}=this;if(!e)throw new f("create-bookmark:invalid-view","Cannot create a bookmark without a view.");const{takeScreenshot:r,screenshotSettings:s,captureViewpoint:d,captureRotation:u,captureScale:_,captureTimeExtent:B}={...o,...t},h=r?await this._createThumbnail(s):void 0,E=i.time&&B&&e.timeExtent!=null?e.timeExtent.clone():void 0;return new G({...h&&{thumbnail:h},...B&&{timeExtent:E},...d&&{viewpoint:this._createViewpoint({view:e,captureScale:_,captureRotation:u})}})}async editBookmark(t,e){if(!t)return t;const{view:o,defaultEditOptions:i}=this;if(!o)throw new f("edit-bookmark:invalid-view","Cannot edit a bookmark without a view.");const{takeScreenshot:r,screenshotSettings:s,captureViewpoint:d,captureRotation:u,captureScale:_,captureTimeExtent:B}={...i,...e},h=r?await this._createThumbnail(s):void 0;return h&&(t.thumbnail=h),d&&(t.viewpoint=this._createViewpoint({view:o,captureScale:_,captureRotation:u})),B&&o.timeExtent!=null&&(t.timeExtent=o.timeExtent.clone()),this.emit("bookmark-edit",{bookmark:t}),t}goTo(t){const{capabilities:e,view:o}=this;if(!o)throw new f("go-to:invalid-view","Cannot go to a bookmark without a view");const i=t==null?void 0:t.viewpoint;if(!i)throw new f("go-to:invalid-bookmark","Cannot go to a bookmark that does not contain a 'viewpoint'.",{bookmark:t});this._set("activeBookmark",t);const r={target:i},s=this.callGoTo(r),d=t==null?void 0:t.timeExtent;return e.time&&d&&(o.timeExtent=d),this.emit("bookmark-select",{bookmark:t}),s.catch(()=>{}).then(()=>this._set("activeBookmark",null)),s}async _createThumbnail(t){const{view:e}=this;if(!e)throw new f("bookmark:invalid-view","Cannot create slide thumbnail without a view");const o=await e.takeScreenshot({...st,...t});return new C({url:o.dataUrl})}_createViewpoint({view:t,captureRotation:e,captureScale:o}){var r,s;const i=(r=t.viewpoint)==null?void 0:r.clone();return new ot({targetGeometry:(s=t.extent)==null?void 0:s.clone(),rotation:(e?i==null?void 0:i.rotation:null)??0,scale:(o?i==null?void 0:i.scale:null)??0})}};n([l()],v.prototype,"capabilities",void 0),n([rt("capabilities")],v.prototype,"castCapabilities",null),n([l({readOnly:!0})],v.prototype,"activeBookmark",void 0),n([l({type:j})],v.prototype,"bookmarks",null),n([l()],v.prototype,"defaultCreateOptions",null),n([l()],v.prototype,"defaultEditOptions",null),n([l({readOnly:!0})],v.prototype,"state",null),n([l()],v.prototype,"view",void 0),v=n([D("esri.widgets.Bookmarks.BookmarksViewModel")],v);const z=v;let b=class extends Z{constructor(){super(...arguments),this.addBookmarkButton=!1,this.closeButton=!1,this.collapseButton=!1,this.editBookmarkButton=!1,this.filter=!1,this.flow=!0,this.heading=!1,this.thumbnail=!0,this.time=!0}get addBookmark(){return x(A.getLogger(this),"addBookmark",{replacement:"addBookmarkButton",version:"4.29",warnOnce:!0}),this.addBookmarkButton}set addBookmark(e){x(A.getLogger(this),"addBookmark",{replacement:"addBookmarkButton",version:"4.29",warnOnce:!0}),this.addBookmarkButton=e}};n([l({type:Boolean,nonNullable:!0})],b.prototype,"addBookmark",null),n([l({type:Boolean,nonNullable:!0})],b.prototype,"addBookmarkButton",void 0),n([l({type:Boolean,nonNullable:!0})],b.prototype,"closeButton",void 0),n([l({type:Boolean,nonNullable:!0})],b.prototype,"collapseButton",void 0),n([l({type:Boolean,nonNullable:!0})],b.prototype,"editBookmarkButton",void 0),n([l({type:Boolean,nonNullable:!0})],b.prototype,"filter",void 0),n([l({type:Boolean,nonNullable:!0})],b.prototype,"flow",void 0),n([l({type:Boolean,nonNullable:!0})],b.prototype,"heading",void 0),n([l({type:Boolean,nonNullable:!0})],b.prototype,"thumbnail",void 0),n([l({type:Boolean,nonNullable:!0})],b.prototype,"time",void 0),b=n([D("esri.widgets.Bookmarks.BookmarksVisibleElements")],b);const F=b,p="esri-bookmarks",$=`${p}__authoring`,U=`${p}__bookmark`,k={base:p,noBookmarksHeader:`${p}__no-bookmarks-heading`,noBookmarksDescription:`${p}__no-bookmarks-description`,form:`${p}__form`,list:`${p}__list`,loader:`${p}__loader`,filterNoResults:`${p}__filter-no-results`,formContent:`${p}__form-content`,addBookmarkButton:`${p}__add-bookmark-button`,editBookmarkInput:`${p}__edit-bookmark-input`,addBookmarkInput:`${p}__add-bookmark-input`,dragEnabled:`${p}--drag-enabled`,bookmarkImage:`${p}__image`,bookmarkImageContainer:`${U}-image-container`,bookmarkContent:`${U}-content`,bookmarkContentLabel:`${U}-content-label`,authoring:$,authoringImageContainer:`${$}-image-container`,authoringRefreshThumbnailButton:`${$}-refresh-thumbnail-button`};let m=class extends X(tt){constructor(t,e){super(t,e),this._addInputNode=null,this._editInputNode=null,this._urlEditInputNode=null,this._lastDragDetail=null,this._selectedDragBookmarkUid=null,this._editIncludeTimeExtent=void 0,this._userState=null,this._focusRootFlowItem=!1,this._focusAddFlowItem=!1,this._focusEditFlowItem=!1,this.disabled=!1,this.dragEnabled=!1,this.filterPlaceholder="",this.filterText="",this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.viewModel=new z,this.visibleElements=new F,this._onCalciteListOrderChange=o=>{const{_lastDragDetail:i,bookmarks:r}=this,{toEl:s,fromEl:d,dragEl:u,newIndex:_}=o;if(!r.length||!d||!s||(i==null?void 0:i.newIndex)===_&&(i==null?void 0:i.dragEl)===u&&(i==null?void 0:i.toEl)===s&&(i==null?void 0:i.fromEl)===d)return;this._lastDragDetail=o;const B=Array.from(d.children).filter(h=>h==null?void 0:h.matches("calcite-list-item")).map(h=>h.value);r.sort((h,E)=>{const I=B.indexOf(h.uid),y=B.indexOf(E.uid);return I>y?1:I<y?-1:0})}}normalizeCtorArgs(t){return(t==null?void 0:t.editingEnabled)!=null&&t.visibleElements!=null?{...t,visibleElements:new F({...t.visibleElements,addBookmarkButton:t.editingEnabled,editBookmarkButton:t.editingEnabled})}:t}loadDependencies(){return et({action:()=>c(()=>import("./calcite-action-eUVYjjgY.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]),import.meta.url),button:()=>c(()=>import("./calcite-button-BbY9lAf2.js"),__vite__mapDeps([25,26,2,3,4,5,6,7,8,9,10,11,12,13,14,27,15,16,28,21,17,18,19,20,22,23,24]),import.meta.url),"chip-group":()=>c(()=>import("./calcite-chip-group-EAHbf3XL.js"),__vite__mapDeps([29,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]),import.meta.url),chip:()=>c(()=>import("./calcite-chip-YmBsgRpo.js"),__vite__mapDeps([30,31,2,3,4,5,6,7,8,9,10,11,12,13,14,15,17,22,18,19,20,16,21,23]),import.meta.url),fab:()=>c(()=>import("./calcite-fab-CCu7SxsK.js"),__vite__mapDeps([32,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,26,27,28,21,18,19,20,22,23,24]),import.meta.url),flow:()=>c(()=>import("./calcite-flow-BBEB5sRb.js"),__vite__mapDeps([33,2,3,4,5,6,7,8,9,10,11,12,13,14,20,17]),import.meta.url),"flow-item":()=>c(()=>import("./calcite-flow-item-BTLah491.js"),__vite__mapDeps([34,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,22,35,36,37,1,21,23,24,38,39,40,41,42,43,44,45]),import.meta.url),icon:()=>c(()=>import("./calcite-icon-DtUarwQp.js"),__vite__mapDeps([46,23,2,3,4,5,6,7,8,9,10,11,12,13,14,15,20]),import.meta.url),input:()=>c(()=>import("./calcite-input-p_Le978W.js"),__vite__mapDeps([47,48,2,3,4,5,6,7,8,9,10,11,12,13,14,15,27,16,19,28,21,17,18,20,22,49,50,23,51,52]),import.meta.url),"input-message":()=>c(()=>import("./calcite-input-message-DHYZOFye.js"),__vite__mapDeps([53,51,2,3,4,5,6,7,8,9,10,11,12,13,14,15,23,20]),import.meta.url),label:()=>c(()=>import("./calcite-label-Ddcwlp7C.js"),__vite__mapDeps([54,2,3,4,5,6,7,8,9,10,11,12,13,14,28,15,21]),import.meta.url),list:()=>c(()=>import("./calcite-list-CauCCaYV.js"),__vite__mapDeps([55,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,20,56,57,17,22,18,19,58,40,23,48,27,28,21,49,50,51,52,24,45]),import.meta.url),"list-item":()=>c(()=>import("./calcite-list-item-DnfVo5id.js"),__vite__mapDeps([59,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,22,17,57,56,1,21,23,24,60]),import.meta.url),loader:()=>c(()=>import("./calcite-loader-Cyav0WwQ.js"),__vite__mapDeps([61,24,2,3,4,5,6,7,8,9,10,11,12,13,14,15,18,19,20]),import.meta.url),notice:()=>c(()=>import("./calcite-notice-CVdHfJFK.js"),__vite__mapDeps([62,2,3,4,5,6,7,8,9,10,11,12,13,14,63,20,15,17,18,19,22,42,21,23]),import.meta.url),scrim:()=>c(()=>import("./calcite-scrim-CYwFbyZL.js"),__vite__mapDeps([64,45,2,3,4,5,6,7,8,9,10,11,12,13,14,18,15,19,20,22,24]),import.meta.url),switch:()=>c(()=>import("./calcite-switch-CfyCkhzI.js"),__vite__mapDeps([65,66,2,3,4,5,6,7,8,9,10,11,12,13,14,15,27,16,19,28,21,17]),import.meta.url),table:()=>c(()=>import("./calcite-table-B530M8Rl.js"),__vite__mapDeps([67,2,3,4,5,6,7,8,9,10,11,12,13,14,17,22,18,15,19,20,26,27,16,28,21,23,24,31]),import.meta.url),"table-cell":()=>c(()=>import("./calcite-table-cell-D6hEGg_N.js"),__vite__mapDeps([68,69,2,3,4,5,6,7,8,9,10,11,12,13,14,17,22,18,15,19,20,16]),import.meta.url),"table-header":()=>c(()=>import("./calcite-table-header-hgRaWuC3.js"),__vite__mapDeps([70,71,2,3,4,5,6,7,8,9,10,11,12,13,14,17,22,18,15,19,20,21,23]),import.meta.url),"table-row":()=>c(()=>import("./calcite-table-row-BtZtAr1i.js"),__vite__mapDeps([72,2,3,4,5,6,7,8,9,10,11,12,13,14,15,19,16,21,23,20,69,17,22,18,71]),import.meta.url)})}get defaultCreateOptions(){return this.viewModel.defaultCreateOptions}set defaultCreateOptions(t){this.viewModel.defaultCreateOptions=t}get defaultEditOptions(){return this.viewModel.defaultEditOptions}set defaultEditOptions(t){this.viewModel.defaultEditOptions=t}get bookmarks(){return this.viewModel.bookmarks}set bookmarks(t){this.viewModel.bookmarks=t}get editingEnabled(){return x(A.getLogger(this),"editingEnabled",{replacement:"dragEnabled, visibleElements.editBookmarkButton, visibleElements.addBookmarkButton",version:"4.29",warnOnce:!0}),this.dragEnabled&&this.visibleElements.editBookmarkButton&&this.visibleElements.addBookmarkButton}set editingEnabled(t){x(A.getLogger(this),"editingEnabled",{replacement:"dragEnabled, visibleElements.editBookmarkButton, visibleElements.addBookmarkButton",version:"4.29",warnOnce:!0}),this.dragEnabled=t,this.visibleElements.editBookmarkButton=t,this.visibleElements.addBookmarkButton=t}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(t){this.viewModel.goToOverride=t}get icon(){return"bookmark"}set icon(t){this._overrideIfSome("icon",t)}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}endAddBookmark(){this._userState=null}goTo(t){return this.viewModel.goTo(t)}render(){return a("div",{class:this.classes(k.base,T.widget,T.panel)},this._renderBookmarksContainer())}startAddBookmark(){this._userState=new L({state:"add"}),this._focusAddFlowItem=!0}_renderNoBookmarksContainer(t){const{messages:e,viewModel:{state:o}}=this;return t.length||o==="loading"?null:a("div",{class:T.empty,key:"no-bookmarks"},a("calcite-icon",{icon:"bookmark",scale:"l"}),a(nt,{class:this.classes(T.heading,k.noBookmarksHeader),level:this.headingLevel},e==null?void 0:e.noBookmarksHeading),a("p",{class:k.noBookmarksDescription},e.noBookmarksDescription))}_renderEditBookmarkFlowItems(){const{_userState:t}=this,e=t==null?void 0:t.editedBookmark;return e&&(t==null?void 0:t.state)==="edit"?this._renderEditingBookmark(e):[]}_renderBookmarkItems(t){return t?t.toArray().map(e=>this._renderBookmark(e)):[]}_handleCalciteListDragEnd(t){const{fromEl:e,dragEl:o,oldIndex:i}=t;e.insertBefore(o,e.children[i])}_renderBookmarksContainer(){const{viewModel:{state:t,bookmarks:e},dragEnabled:o,messages:i,disabled:r,filterPlaceholder:s,filterText:d,visible:u,headingLevel:_,visibleElements:{closeButton:B,collapseButton:h,filter:E,heading:I,flow:y},uid:J}=this,O=e.filter(W),K=O.length?a("calcite-list",{class:k.list,dragEnabled:o,filterEnabled:E,filterPlaceholder:s,filterText:d,group:`bookmarks-${J}`,key:"bookmark-list",label:i.widgetLabel,selectionAppearance:"border",selectionMode:"none",onCalciteListDragEnd:w=>this._handleCalciteListDragEnd(w.detail),onCalciteListFilter:w=>{var N;return this.filterText=((N=w.target)==null?void 0:N.filterText)??""},onCalciteListOrderChange:w=>this._onCalciteListOrderChange(w.detail)},this._renderBookmarkItems(O),E?a("div",{class:k.filterNoResults,slot:"filter-no-results"},a("calcite-notice",{kind:"info",open:!0,width:"full"},a("div",{slot:"message"},i.noBookmarksHeading),";")):null):null,R=[a("calcite-flow-item",{afterCreate:this._focusRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,closable:B,closed:!u,collapsible:h,disabled:r,heading:I?i.widgetLabel:void 0,headingLevel:_,loading:t==="loading",onCalciteFlowItemClose:()=>this.visible=!1},this._renderNoBookmarksContainer(O),K,this._renderAddBookmarkButton()),this._renderAddingBookmark(),this._renderEditBookmarkFlowItems()];return u?y?a("calcite-flow",{key:"root-flow"},R):R:null}_renderAddBookmarkButton(){const{messages:t,_userState:e,disabled:o,viewModel:{view:i,state:r},visibleElements:{addBookmarkButton:s}}=this,d=(e==null?void 0:e.loading)??!1;return i&&r!=="loading"&&s?a("calcite-fab",{appearance:"outline-fill",bind:this,class:k.addBookmarkButton,disabled:o||d,icon:"plus",key:"add-bookmark-item",kind:"neutral",loading:d,onclick:this.startAddBookmark,slot:"fab",text:t.addBookmark,textEnabled:!0,title:t.addBookmark,type:"button"}):null}_renderEditContainer(t){const{messagesCommon:e,visibleElements:{editBookmarkButton:o}}=this,i=`${e.edit} ${this._getBookmarkTitle(t)}`;return o?a("calcite-action",{appearance:"transparent",icon:"pencil",key:"edit-action",onclick:()=>this._showEditBookmarkForm(t),slot:"actions-end",text:i,title:i}):null}_renderBookmarkImage(t,e){var o;return e?a("img",{alt:"",class:k.bookmarkImage,key:"bookmark-image",src:(o=t.thumbnail)==null?void 0:o.url}):null}_renderBookmarkTimeSwitch(t){const{messages:e,viewModel:{view:o}}=this,{timeExtent:i}=t;return(o==null?void 0:o.timeExtent)??i?a("calcite-label",{layout:"inline-space-between"},e.includeTimeExtent,a("calcite-switch",{checked:!!i,onCalciteSwitchChange:r=>{this._editIncludeTimeExtent=!!r.target.checked}})):null}_renderEditBookmarkTimeExtent(t){return this._editIncludeTimeExtent?this._renderBookmarkTimeExtent(t):null}_getTimeExtentStrings(t){const{visibleElements:e}=this,{timeExtent:o}=t;if(!o)return{};const{start:i,end:r}=o,s=r!=null&&(i==null||i.getTime()!==r.getTime()),d=i?this._formatDate(i):"",u=i&&e.time?this._formatTime(i):"";return s?{startDate:d,startTime:u,endDate:this._formatDate(r),endTime:e.time?this._formatTime(r):""}:{startDate:d,startTime:u}}_renderTimeExtentDescription(t){const{startDate:e,startTime:o,endDate:i,endTime:r}=this._getTimeExtentStrings(t);if(!e)return"";const s=`${e} ${o}`;return i?`${s} - ${`${i} ${r}`}`:s}_renderBookmarkTimeExtent(t,e=!1){const{messages:o}=this,{startDate:i,startTime:r,endDate:s,endTime:d}=this._getTimeExtentStrings(t),u=e?null:a("calcite-table-row",{slot:"table-header"},a("calcite-table-header",{heading:o.startDate}),s?a("calcite-table-header",{heading:o.endDate}):null);return i?a("calcite-table",{caption:o.timeExtent,scale:"s"},u,a("calcite-table-row",null,a("calcite-table-cell",null,i," ",r?[a("br",null),r]:null),s?a("calcite-table-cell",null,s,d?[a("br",null),d]:null):null)):null}_renderBookmarkActiveScrim(t,e){return this.viewModel.activeBookmark===t&&e?a("calcite-scrim",{key:"bookmark-active-scrim",loading:!0}):null}_renderBookmarkActiveLoader(t,e){return this.viewModel.activeBookmark!==t||e?null:a("calcite-loader",{class:k.loader,inline:!0,key:"bookmark-active-loader",label:this.messagesCommon.loading})}_renderBookmarkImageIcon(t,e){return this.viewModel.activeBookmark===t||e?null:a("calcite-icon",{icon:"bookmark",key:"bookmark-icon",scale:"s"})}_renderBookmarkThumbnail(t){var o;const e=this.visibleElements.thumbnail&&!!((o=t.thumbnail)!=null&&o.url);return a("div",{class:k.bookmarkImageContainer,slot:"content-start"},this._renderBookmarkActiveScrim(t,e),this._renderBookmarkImage(t,e),this._renderBookmarkActiveLoader(t,e),this._renderBookmarkImageIcon(t,e))}_focusSelectedDragEl(t,e){this._selectedDragBookmarkUid===e.uid&&requestAnimationFrame(()=>t==null?void 0:t.setFocus())}_handleCalciteListItemDragHandleChange(t,e){t.stopPropagation();const o=t.target.dragSelected;this._selectedDragBookmarkUid=o?e.uid:null}_renderBookmark(t){return a("calcite-list-item",{afterCreate:e=>this._focusSelectedDragEl(e,t),afterUpdate:e=>this._focusSelectedDragEl(e,t),class:this.classes({[k.dragEnabled]:this.dragEnabled}),description:this._renderTimeExtentDescription(t),dragSelected:t.uid===this._selectedDragBookmarkUid,key:t.uid,label:this._getBookmarkTitle(t),value:t.uid,onCalciteListItemDragHandleChange:e=>this._handleCalciteListItemDragHandleChange(e,t),onCalciteListItemSelect:()=>this._goToBookmark(t)},this._renderBookmarkThumbnail(t),this._renderBookmarkContent(t),this._renderEditContainer(t))}_renderBookmarkContent(t){return a("div",{class:k.bookmarkContent,slot:"content"},a("span",{class:k.bookmarkContentLabel},this._getBookmarkTitle(t)),this._renderBookmarkTimeExtent(t,!0))}_renderEditingBookmarkName(t){const{messages:e,_userState:o}=this,i=(o==null?void 0:o.validationState)==="name-required";return a("calcite-label",null,e.title,a("calcite-input",{afterCreate:this._storeEditInput,bind:this,class:k.editBookmarkInput,name:"bookmark-name",placeholder:e.titlePlaceholder,required:!0,type:"text",value:t.name}),i?a("calcite-input-message",{icon:"exclamation-mark-triangle",status:"invalid"},e.invalidTitle):null)}_renderEditingBookmarkActions(){const{messagesCommon:t,_userState:e}=this,o=e==null?void 0:e.bookmark;return[a("calcite-button",{appearance:"transparent",kind:"danger",onclick:()=>this._deleteBookmark(o),slot:"footer",type:"button",width:"full"},t.delete),a("calcite-button",{appearance:"outline",bind:this,onclick:this._closeEditBookmarkForm,slot:"footer",type:"button",width:"full"},t.cancel),a("calcite-button",{slot:"footer",type:"submit",width:"full"},t.save)]}_handleUrlEditInputChange(){var r,s;const{_userState:t,_urlEditInputNode:e}=this,o=e==null?void 0:e.value;if(!(t!=null&&t.editedBookmark)||!o)return;t.validationState=void 0,(r=t.editedBookmark.thumbnail)!=null&&r.isDataURI&&(t.screenshotUrl=(s=t.editedBookmark.thumbnail)==null?void 0:s.url);const i=new C({url:o});i.isSecureUrl&&(t.customUrl=o,t.editedBookmark.thumbnail=i)}_renderEditingTimeExtent(t){const{capabilities:e,view:o}=this.viewModel,{timeExtent:i}=t;return e.time&&((o==null?void 0:o.timeExtent)??i)?a("div",{key:"edit-bookmark-time-container"},this._renderBookmarkTimeSwitch(t),this._renderEditBookmarkTimeExtent(t)):null}_renderEditingBookmarkImage(t){var r,s;const{_userState:e}=this,o=e==null?void 0:e.thumbnailState,i=(r=t.thumbnail)!=null&&r.isSecureUrl?o==="url":(s=t.thumbnail)!=null&&s.isDataURI?o==="screenshot":null;if(i)return this._renderBookmarkImage(t,i)}_renderEditingThumbnail(t){const{_userState:e,visibleElements:o}=this,i=e==null?void 0:e.thumbnailState;return o.thumbnail&&i!=="none"?a("div",{class:k.authoringImageContainer},this._renderEditingBookmarkImage(t)):null}_renderUpdateThumbnailButton(){const{visibleElements:t,messages:e,_userState:o}=this,i=o==null?void 0:o.thumbnailState;return t.thumbnail&&i==="screenshot"?a("calcite-button",{appearance:"outline",class:k.authoringRefreshThumbnailButton,iconStart:"refresh",key:"update-thumbnail",kind:"neutral",onclick:()=>{this._updateThumbnail()},width:"half"},e.updateThumbnail):null}_renderEditingBookmarkUrlInput(t){var u,_;const{messages:e,_userState:o}=this,i=(u=t.thumbnail)==null?void 0:u.url,r=(_=t.thumbnail)!=null&&_.isSecureUrl?i:void 0,s=i&&(o==null?void 0:o.validationState)==="absolute-url-required";return(o==null?void 0:o.thumbnailState)==="url"?a("calcite-label",{key:"thumbnail-url-input"},a("calcite-input",{afterCreate:this._storeUrlEditInput,bind:this,name:"bookmark-thumbnail-url",pattern:Y,placeholder:e?`https://<${e.imageUrlPlaceholder}>`:void 0,required:!0,title:e.imageUrlTooltip,type:"text",value:r,onCalciteInputChange:this._handleUrlEditInputChange,onCalciteInputInput:this._handleUrlEditInputChange}),s?a("calcite-input-message",{icon:"exclamation-mark-triangle",status:"invalid"},e.invalidImageUrl):null):null}_renderThumbnailSelector(){const{visibleElements:t,messages:e,_userState:o}=this,i=o==null?void 0:o.thumbnailState;return t.thumbnail?a("calcite-label",{key:"thumbnail-chip-group"},e.thumbnail,a("calcite-chip-group",{label:e.thumbnail,selectionMode:"single-persist",onCalciteChipGroupSelect:r=>this._handleThumbnailTypeSelect(r.target.selectedItems[0].value)},a("calcite-chip",{selected:i==="screenshot",value:"screenshot"},e.screenshot),a("calcite-chip",{selected:i==="url",value:"url"},e.url),a("calcite-chip",{selected:i==="none",value:"none"},e.none))):null}_renderEditingBookmark(t){const{disabled:e,messagesCommon:o,headingLevel:i}=this;return t?a("form",{bind:this,class:k.form,disabled:this.disabled,onsubmit:this._editBookmarkSubmit},a("calcite-flow-item",{afterCreate:this._focusEditFlowItemNode,afterUpdate:this._focusEditFlowItemNode,bind:this,disabled:e,heading:o.edit,headingLevel:i,key:"edit-bookmark-form",onCalciteFlowItemBack:r=>{r.preventDefault(),this._closeEditBookmarkForm()}},a("div",{class:k.formContent},a("div",{class:k.authoring},this._renderEditingBookmarkName(t),this._renderThumbnailSelector(),this._renderEditingThumbnail(t),this._renderEditingBookmarkUrlInput(t),this._renderUpdateThumbnailButton(),this._renderEditingTimeExtent(t))),this._renderEditingBookmarkActions())):null}_renderAddingBookmarkName(){const{_userState:t,messages:e}=this,o=(t==null?void 0:t.validationState)==="name-required";return a("calcite-label",null,e.title,a("calcite-input",{afterCreate:this._storeAddInput,bind:this,class:k.addBookmarkInput,name:"bookmark-name",placeholder:e.titlePlaceholder,required:!0,type:"text",value:""}),o?a("calcite-input-message",{icon:"exclamation-mark-triangle",status:"invalid"},e.invalidTitle):null)}_renderAddingBookmarkActions(){const{messagesCommon:t}=this;return[a("calcite-button",{appearance:"outline",bind:this,onclick:this._endAddBookmark,slot:"footer",type:"button",width:"half"},t.cancel),a("calcite-button",{slot:"footer",type:"submit",width:"half"},t.add)]}_renderAddingBookmark(){const{disabled:t,messages:e,headingLevel:o,_userState:i}=this;return(i==null?void 0:i.state)==="add"?a("form",{bind:this,class:k.form,disabled:t,onsubmit:this._addBookmarkSubmitClick},a("calcite-flow-item",{afterCreate:this._focusAddFlowItemNode,afterUpdate:this._focusAddFlowItemNode,bind:this,disabled:t,heading:e.addBookmark,headingLevel:o,key:"add-bookmark-form",onCalciteFlowItemBack:r=>{r.preventDefault(),this._endAddBookmark()}},a("div",{class:k.formContent},this._renderAddingBookmarkName()),this._renderAddingBookmarkActions())):null}_getBookmarkTitle(t){return(t==null?void 0:t.name)||this.messagesCommon.untitled}_formatDate(t){var e;return t?M(t,{...V("short-date"),timeZone:((e=this.viewModel.view)==null?void 0:e.timeZone)??P}):""}_formatTime(t){var e;return t?M(t,{...V("long-time"),timeZone:((e=this.viewModel.view)==null?void 0:e.timeZone)??P}):""}_endAddBookmark(){this.endAddBookmark(),this._focusRootFlowItem=!0}_showEditBookmarkForm(t){t&&(this._editIncludeTimeExtent=!!t.timeExtent,this._userState=new L({bookmark:t,state:"edit"}),this._focusEditFlowItem=!0,this.viewModel.goTo(t))}async _createNewScreenshotUrl(){var e;return((e=(await this.viewModel.createBookmark()).thumbnail)==null?void 0:e.url)??null}_storeCurrentUrl(){var o,i,r,s,d,u;const{_userState:t}=this,e=(i=(o=t==null?void 0:t.editedBookmark)==null?void 0:o.thumbnail)==null?void 0:i.url;e&&((s=(r=t==null?void 0:t.editedBookmark)==null?void 0:r.thumbnail)!=null&&s.isSecureUrl?t.customUrl=e:(u=(d=t==null?void 0:t.editedBookmark)==null?void 0:d.thumbnail)!=null&&u.isDataURI&&(t.screenshotUrl=e))}async _handleThumbnailTypeSelect(t){const{_userState:e}=this;if(!e)return;const{screenshotUrl:o,customUrl:i,editedBookmark:r}=e,s=t==="screenshot"?o??await this._createNewScreenshotUrl():t==="url"&&i?i:null;this._storeCurrentUrl(),r&&s&&(r.thumbnail=new C({url:s})),e.validationState=void 0,e.thumbnailState=t}_closeEditBookmarkForm(){this._userState=null,this._focusRootFlowItem=!0}_addBookmarkSubmitClick(t){t.preventDefault(),this._addBookmarkSubmit()}async _addBookmarkSubmit(){const{_addInputNode:t,_userState:e,viewModel:o,viewModel:{bookmarks:i}}=this;if(!e)return;const r=t?t.value.trim():null;if(!r)return void(e.validationState="name-required");e.loading=!0;const s=await o.createBookmark();s.name=r,i.add(s),this._endAddBookmark()}async _editBookmarkAndClose(t,e){const{viewModel:o,viewModel:{defaultEditOptions:i}}=this;await o.editBookmark(t,{...i,...e}),this._closeEditBookmarkForm()}_editBookmarkSubmit(t){t.preventDefault();const{_editInputNode:e,_userState:o,_editIncludeTimeExtent:i,_urlEditInputNode:r}=this;if(!(o!=null&&o.bookmark)||!o.editedBookmark)return;o.validationState=void 0,o.customUrl=void 0,o.screenshotUrl=void 0;const s=e==null?void 0:e.value.trim();if(!s)return void(o.validationState="name-required");o.bookmark.name=s,o.bookmark.thumbnail=o.editedBookmark.thumbnail,i||(o.bookmark.timeExtent=null);const d=o.thumbnailState;if(d==="url"&&r){const u=r.value,_=new C({url:u});if(!_.isSecureUrl)return void(o.validationState="absolute-url-required");o.bookmark.thumbnail=_}else d==="none"&&(o.bookmark.thumbnail=null);this._editBookmarkAndClose(o.bookmark,{takeScreenshot:!1,captureTimeExtent:i})}_storeEditInput(t){this._editInputNode=t}_storeAddInput(t){this._addInputNode=t}_storeUrlEditInput(t){this._urlEditInputNode=t}_deleteBookmark(t){this._closeEditBookmarkForm(),t&&(this.viewModel.bookmarks.remove(t),t.destroy())}_goToBookmark(t){t&&(this.endAddBookmark(),this.viewModel.goTo(t))}async _updateThumbnail(){const{_userState:t,viewModel:e}=this;t&&(t.validationState=void 0,await e.editBookmark(t.editedBookmark,{takeScreenshot:!0,captureViewpoint:!1,captureRotation:!1,captureScale:!1,captureTimeExtent:!1}))}_focusRootFlowItemNode(t){this._focusRootFlowItem&&(this._focusRootFlowItem=!1,requestAnimationFrame(()=>t==null?void 0:t.setFocus()))}_focusEditFlowItemNode(t){this._focusEditFlowItem&&(this._focusEditFlowItem=!1,requestAnimationFrame(()=>t==null?void 0:t.setFocus()))}_focusAddFlowItemNode(t){this._focusAddFlowItem&&(this._focusAddFlowItem=!1,requestAnimationFrame(()=>t==null?void 0:t.setFocus()))}};n([l()],m.prototype,"_editIncludeTimeExtent",void 0),n([l({type:L})],m.prototype,"_userState",void 0),n([l()],m.prototype,"_focusRootFlowItem",void 0),n([l()],m.prototype,"_focusAddFlowItem",void 0),n([l()],m.prototype,"_focusEditFlowItem",void 0),n([l()],m.prototype,"defaultCreateOptions",null),n([l()],m.prototype,"defaultEditOptions",null),n([l()],m.prototype,"bookmarks",null),n([l()],m.prototype,"disabled",void 0),n([l()],m.prototype,"dragEnabled",void 0),n([l()],m.prototype,"editingEnabled",null),n([l()],m.prototype,"filterPlaceholder",void 0),n([l()],m.prototype,"filterText",void 0),n([l()],m.prototype,"headingLevel",void 0),n([l()],m.prototype,"goToOverride",null),n([l()],m.prototype,"icon",null),n([l()],m.prototype,"label",null),n([l(),q("esri/widgets/Bookmarks/t9n/Bookmarks")],m.prototype,"messages",void 0),n([l(),q("esri/t9n/common")],m.prototype,"messagesCommon",void 0),n([l()],m.prototype,"uiStrings",void 0),n([l()],m.prototype,"view",null),n([l({type:z}),lt(["select-bookmark","bookmark-edit","bookmark-select"])],m.prototype,"viewModel",void 0),n([l({type:F,nonNullable:!0})],m.prototype,"visibleElements",void 0),n([l()],m.prototype,"endAddBookmark",null),n([l()],m.prototype,"startAddBookmark",null),m=n([D("esri.widgets.Bookmarks")],m);const qt=m;export{qt as default};
