import{e as u}from"./Evented-CXIxDjmW.js";import{d as x}from"./reactiveUtils-BFQ0BtrB.js";import{c as f}from"./screenUtils-PfxkaaMN.js";import{y as p,b as k}from"./subclass-BR3PhgZG.js";import{l as R}from"./intl-Dpfm8vPB.js";import{e as P}from"./defaultUnit-CU1dhBSy.js";import{e as W,B as O,n as d}from"./jsxFactory-CbAu6VfF.js";import"./geometry-DpwwkAX1.js";import{S as U}from"./Accessor-D6mNnsWy.js";import{N as F,$ as I,f as j,b as z,_ as C,j as w,R as D}from"./Point-DB4Hp4hH.js";import{w as G,v as N}from"./geodesicUtils-iciHABcX.js";import{M as V}from"./normalizeUtils-Bi6Jza1f.js";import{m as H}from"./Polyline-D97hl-6E.js";import{e as B}from"./globalCss-CZa70j6i.js";import"./shared-B3wH2qpO.js";import"./Promise-CZrWwByK.js";import"./jsonMap-DCC6W5ex.js";import"./assets-C2mb-ea2.js";import"./index-CeCSsEgo.js";import"./getDefaultUnitForView-CWbVfq0i.js";import"./Portal-liet8xHC.js";import"./writer-3zufXUNV.js";import"./Extent-DHjqVB-p.js";import"./uuid-fwrPAdZb.js";import"./geodesicConstants-XRAvAZCD.js";import"./normalizeUtilsCommon-tgSpcwHH.js";import"./jsonUtils-Cma_7A64.js";import"./utils-D61i9O7E.js";import"./utils-Dx8bgRIB.js";import"./mathUtils-ClvKsMak.js";const l="esri-scale-bar",r={base:l,labelContainer:`${l}__label-container`,rulerLabelContainer:`${l}__label-container--ruler`,lineLabelContainer:`${l}__label-container--line`,topLabelContainer:`${l}__label-container--top`,bottomLabelContainer:`${l}__label-container--bottom`,label:`${l}__label`,line:`${l}__line`,topLine:`${l}__line--top`,bottomLine:`${l}__line--bottom`,ruler:`${l}__ruler`,rulerBlock:`${l}__ruler-block`,barContainer:`${l}__bar-container`,rulerBarContainer:`${l}__bar-container--ruler`,lineBarContainer:`${l}__bar-container--line`};function X(e){return e>.5?{min:.5,max:1}:e>.2?{min:.2,max:.5}:{min:.1,max:.2}}function Y(e,t){switch(t){case"metric":return e>1e3?{distance:w(e,"meters","kilometers"),unit:"kilometer"}:e>1?{distance:e,unit:"meter"}:e>.01?{distance:w(e,"meters","centimeters"),unit:"centimeter"}:{distance:w(e,"meters","millimeters"),unit:"millimeter"};case"imperial":return e>1609.344?{distance:w(e,"meters","miles"),unit:"mile"}:e>.3048?{distance:w(e,"meters","feet"),unit:"foot"}:{distance:w(e,"meters","inches"),unit:"inch"}}}function q(e){var n;const{isWebMercator:t,wkt:i,wkt2:s}=e;return t||(((n=s||i)==null?void 0:n.includes("WGS_1984_Web_Mercator"))??!1)}function M({state:{paddedViewState:e},spatialReference:t,width:i}){return t.isWrappable&&e.worldScreenWidth<i}function S(e,t){const{x:i,y:s}=e?D(t,!0):t;return[i,s]}let _=class extends U{constructor(t){super(t),this.scaleComputedFrom=f(),this.view=null}get state(){var t,i;return(t=this.view)!=null&&t.ready&&((i=this.view)==null?void 0:i.type)==="2d"?"ready":"disabled"}getScaleBarProperties(t,i){if(this.state==="disabled"||isNaN(t)||!i||!this.view)return null;const s=this._getDistanceInMeters();return s==null?null:this._getScaleBarProps(t,s,i)}_getDistanceInMeters(){const{state:t,spatialReference:i}=this.view;if(!F(i))return null;const{isGeographic:s}=i,n=q(i);if(!s&&!n)return t.extent.width*(I(i)??1);const[o,c]=this._getScaleMeasuringPoints(),h=n||s&&!G(i)?j.WGS84:i,b=new H({paths:[[S(n,o),S(n,c)]],spatialReference:h}),a=V(b,10);let v;try{[v]=N([a],"meters")}catch{return null}return v}_getScaleMeasuringPoints(){const t=this.view,{width:i,height:s,position:n,spatialReference:o}=t;if(M(t)){const a=z(o),{valid:v}=a;return[new C(v[0],0,o),new C(v[1],0,o)]}let c=this.scaleComputedFrom.y-n[1];c>s?c=s:c<0&&(c=0);const h=f(0,c),b=f(i,c);return[t.toMap(h),t.toMap(b)]}_getScaleBarProps(t,i,s){const n=this.view,o=t*i/(M(n)?n.state.paddedViewState.worldScreenWidth:n.width);if(o<.001)return null;const c=Y(o,s),{distance:h,unit:b}=c;let a=h,v=0;for(;a>=1;)a/=10,v++;const{min:y,max:$}=X(a),g=$/a>=a/y?y:$;return{length:t*(g/a),value:10**v*g,unit:b}}};u([p()],_.prototype,"scaleComputedFrom",void 0),u([p({readOnly:!0})],_.prototype,"state",null),u([p()],_.prototype,"view",void 0),_=u([k("esri.widgets.ScaleBar.ScaleBarViewModel")],_);const A=_;function L(e,t){return R(e,{style:"unit",unit:t,unitDisplay:"short"})}let m=class extends O{constructor(e,t){super(e,t),this.messages=null,this.style="line",this.viewModel=new A}initialize(){this.addHandles(x(()=>{const{view:e}=this;return[e==null?void 0:e.stationary,e==null?void 0:e.center,e==null?void 0:e.scale,e==null?void 0:e.zoom]},([e])=>{e&&this.scheduleRender()}))}get icon(){return"actual-size"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get unit(){return this._defaultUnit}set unit(e){this._overrideIfSome("unit",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e=this.viewModel.state==="disabled",t={[B.disabled]:e};let i,s;if(!e){const{unit:n,style:o}=this,c=n==="metric"||n==="dual",h=100,b=n==="dual"?"line":o;if(n==="imperial"||n==="dual"){const a=this.viewModel.getScaleBarProperties(h,"imperial");a&&(s=b==="ruler"?this._renderRuler(a):this._renderLine(a,"bottom"))}if(c){const a=this.viewModel.getScaleBarProperties(h,"metric");a&&(i=b==="ruler"?this._renderRuler(a):this._renderLine(a,"top"))}}return d("div",{afterCreate:this._handleRootCreateOrUpdate,afterUpdate:this._handleRootCreateOrUpdate,bind:this,class:this.classes(r.base,B.widget,t)},i,s)}_renderRuler(e){const{length:t,unit:i,value:s}=e,n=Math.round(t),o=L(s,i);return d("div",{class:this.classes(r.barContainer,r.rulerBarContainer),key:r.rulerBarContainer},d("div",{class:r.ruler,styles:{width:`${n}px`}},d("div",{class:r.rulerBlock}),d("div",{class:r.rulerBlock}),d("div",{class:r.rulerBlock}),d("div",{class:r.rulerBlock})),d("div",{class:this.classes(r.labelContainer,r.rulerLabelContainer)},d("div",{class:r.label},"0"),d("div",{class:r.label},o)))}_renderLine(e,t){const{length:i,unit:s,value:n}=e,o=Math.round(i),c=L(n,s),h={[r.topLabelContainer]:t==="top",[r.bottomLabelContainer]:t==="bottom"},b=d("div",{class:this.classes(r.labelContainer,r.lineLabelContainer,h),key:r.labelContainer},d("div",{class:r.label},c)),a={[r.topLine]:t==="top",[r.bottomLine]:t==="bottom"},v=d("div",{class:this.classes(r.line,a),key:r.line,styles:{width:`${o}px`}});return d("div",{class:this.classes(r.barContainer,r.lineBarContainer),key:r.lineBarContainer},[v,b])}_handleRootCreateOrUpdate(e){if(!this.viewModel)return;const{scaleComputedFrom:t}=this.viewModel,i=e.getBoundingClientRect(),s=i.left+window.pageXOffset,n=i.top+window.pageYOffset,o=f(s,n);(o.x!==t.x||o.y!==t.y)&&(this.viewModel.scaleComputedFrom=o)}};u([p(P)],m.prototype,"_defaultUnit",void 0),u([p()],m.prototype,"icon",null),u([p()],m.prototype,"label",null),u([p(),W("esri/widgets/ScaleBar/t9n/ScaleBar")],m.prototype,"messages",void 0),u([p({type:["ruler","line"]})],m.prototype,"style",void 0),u([p({type:["metric","imperial","dual"]})],m.prototype,"unit",null),u([p()],m.prototype,"view",null),u([p()],m.prototype,"viewModel",void 0),m=u([k("esri.widgets.ScaleBar")],m);const Me=m;export{Me as default};
