import{r as n}from"./tslib.es6-B3Jf3DVX.js";import{d as V}from"./Graphic-DsxsIjhH.js";import{m as u,a as L,b as S}from"./subclass-BZA_h8Db.js";import{i as _}from"./timeSupport-CXKPoROL.js";import{j as O,c as R}from"./rasterProjectionHelper-Cyb7j9c9.js";import{p as A}from"./popupUtils-BaLxn3kI.js";const q=b=>{let t=class extends b{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){var r;return _(this.layer,(r=this.view)==null?void 0:r.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){try{return this.layer.loaded?O(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(r){try{return!this.layer.loaded||!!R(this.layer.serviceRasterInfo,r)}catch{return!1}}async fetchPopupFeaturesAtLocation(r,c){var g,x;const{layer:e}=this;if(!r)throw new S("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:e});const{popupEnabled:T}=e,F=A(e,c);if(!T||F==null)return[];const h=[],{value:l,magdirValue:s,processedValue:f}=await e.identify(r,{timeExtent:this.timeExtent,signal:c==null?void 0:c.signal});let m="";if(l!=null&&l.length){m=e.type==="imagery-tile"&&e.hasStandardTime()&&l[0]!=null?l.map(p=>e.getStandardTimeValue(p)).join(", "):l.join(", ");const a={ObjectId:0},d="Raster.ServicePixelValue";a[d]=e.type==="imagery-tile"&&e.raster.datasetFormat==="Function"?f==null?void 0:f.join(", "):m,a[d+".Raw"]=m;const o=((g=e.raster)==null?void 0:g.rasterInfo)??e.serviceRasterInfo,v=o==null?void 0:o.attributeTable;if(v!=null){const{fields:p,features:j}=v,w=p.find(({name:i})=>i.toLowerCase()==="value"),P=a[d],y=w?j.find(i=>String(i.attributes[w.name])===P):null;if(y)for(const i in y.attributes)y.attributes.hasOwnProperty(i)&&(a[this._rasterFieldPrefix+i]=y.attributes[i])}const E=o==null?void 0:o.dataType;E!=="vector-magdir"&&E!=="vector-uv"||(a["Raster.Magnitude"]=s==null?void 0:s[0],a["Raster.Direction"]=s==null?void 0:s[1]);const I=new V({geometry:(x=this.fullExtent)==null?void 0:x.clone(),attributes:a,layer:e,sourceLayer:e});h.push(I)}return h}_getFullExtent(){return R(this.layer.serviceRasterInfo,this.view.spatialReference)}};return n([u()],t.prototype,"fullExtent",null),n([u()],t.prototype,"layer",void 0),n([u({readOnly:!0})],t.prototype,"timeExtent",null),n([u()],t.prototype,"tileInfo",void 0),n([u({readOnly:!0})],t.prototype,"hasTilingEffects",null),n([u()],t.prototype,"datumTransformation",null),t=n([L("esri.views.layers.ImageryTileLayerView")],t),t};export{q as u};
