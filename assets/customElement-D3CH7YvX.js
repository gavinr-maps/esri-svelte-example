import{i as E,L as $,u as M,c as _,n as L,x as n,s as u,d as C,b as O,a as T}from"./index-tefRSezt.js";import{r as g}from"./index-BkKcLxWB.js";import{r,m as l,a as S,s as f,E as D}from"./Accessor-BHnuXKD2.js";import{f as N}from"./intl-Do3GEEJ7.js";import{q as P}from"./Graphic-CFXUQZlS.js";import{r as x}from"./actions-Bp0YlyZO.js";import{b as G}from"./GeolocationPositioning-C-Mrji1g.js";import{p as A}from"./geolocationUtils-IqcQdGRn.js";import{h as R}from"./Promise-CmQqe-ke.js";import{s as k}from"./useT9n-B0I3cNlQ.js";import{u as z}from"./useViewModel-BxErfUSG.js";import{e as b}from"./globalCss-CyPh17x2.js";import{i as U}from"./legacyIcon-COdSjLjS.js";import"./cast-BA_-jlhc.js";import"./JSONSupport-CGdeqxpk.js";import"./Clonable-DvJsj5LF.js";import"./reactiveUtils-BR0C1Kq4.js";import"./Evented-DCWccWGU.js";import"./SimpleObservable-7oieNGD8.js";import"./writer-B2bQV2uU.js";import"./opacityUtils-CSd4XoR2.js";import"./Point-XGrwlf63.js";import"./enumeration-Cr5WIZs4.js";import"./Color-gncXBiLc.js";import"./colorUtils-Rxh2V3ai.js";import"./mathUtils-DV9iOXpW.js";import"./ActionToggle-__-l4AdQ.js";import"./Identifiable-BrT7zvUW.js";import"./jsonUtils-Cu7OBRmN.js";import"./Extent-CBBGeHb-.js";import"./Polyline-BmuD2-ZN.js";import"./typeUtils-BSg8Y507.js";import"./TextSymbol-BQ_NW9Xo.js";import"./screenUtils-_ZIvrt5o.js";import"./collectionUtils-CbaToa73.js";import"./Portal-CTRRujjZ.js";import"./vec3f64-BLpZdpfb.js";import"./aaBoundingBox-CeBivBRq.js";import"./legacyIcon-CEIp6Pa9.js";import"./GoTo-BsXOAO95.js";import"./project-BoEABhcm.js";import"./utils-Cy8wFNQo.js";import"./utils-CkSELPnj.js";import"./component-utils-DWY0IMHC.js";async function q(){const t=await N("esri/widgets/Locate/t9n/Locate");return new P({title:t.currentLocation,fieldInfos:[{fieldName:"timestamp",label:t.timestamp,format:{dateFormat:"short-date-short-time"}},{fieldName:"latitude",label:t.latitude,format:{places:4,digitSeparator:!0}},{fieldName:"longitude",label:t.longitude,format:{places:4,digitSeparator:!0}},{fieldName:"accuracy",label:t.accuracy,format:{places:0,digitSeparator:!0}},{fieldName:"altitude",label:t.altitude,format:{places:0,digitSeparator:!0}},{fieldName:"altitudeAccuracy",label:t.altitudeAccuracy,format:{places:0,digitSeparator:!0}},{fieldName:"heading",label:t.heading,format:{places:0,digitSeparator:!0}},{fieldName:"speed",label:t.speed,format:{places:0,digitSeparator:!0}}],actions:[x.clone()],content:[{type:"fields"}]})}let a=class extends G{constructor(t){super(t),this._locateController=null,this.error=void 0,this.popupEnabled=!0,this.locate=this.locate.bind(this)}initialize(){this.addHandles([R(()=>{var i;const{graphic:t,view:e}=this;if(!t)return;((i=e==null?void 0:e.graphics)==null?void 0:i.includes(t))&&this._updatePopupTemplate(t)})])}destroy(){this.cancelLocate()}get state(){var t;return this._geolocationUsable?(t=this.view)!=null&&t.ready?this._locateController?"locating":this.error!=null?"error":"ready":"disabled":"feature-unsupported"}async locate(){if(this.cancelLocate(),this.state==="disabled")throw new f("locate:disabled-state","Cannot locate when disabled.");if(this.state==="feature-unsupported")throw new f("locate:feature-unsupported-state","Cannot locate in unsecure domain.");const t=new AbortController;this._locateController=t,this.error=void 0;try{const e=await A(this.geolocationOptions);if(await this.updatePosition(e,t),this._locateController!==t)return null;const{graphic:o}=this;return o&&await this._updatePopupTemplate(o),this._addGraphic(),this.emit("locate",{position:e}),this._locateController=null,e}catch(e){if(D(e))return null;throw t===this._locateController&&(this._locateController=null),this.error=e,this.emit("locate-error",{error:e}),e}}cancelLocate(){this._clearGraphic(),this._locateController&&this._locateController.abort(),this._locateController=null}async _updatePopupTemplate(t){if(!this.popupEnabled)return;const e=await q(),o=t!==this.graphic;this.destroyed||o||(t.popupTemplate=e)}};r([l()],a.prototype,"_locateController",void 0),r([l()],a.prototype,"error",void 0),r([l()],a.prototype,"popupEnabled",void 0),r([l({readOnly:!0})],a.prototype,"state",null),r([l()],a.prototype,"locate",null),r([l()],a.prototype,"cancelLocate",null),a=r([S("esri.widgets.Locate.LocateViewModel")],a);const B=a;/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
v4.32.12 */const F=E`@layer{arcgis-locate{display:block}}`,H={base:"esri-locate"},w="gps-off",I=z(B),c=class c extends ${constructor(){super(...arguments),this.messages=k(),this.viewModel=I(this),this.autoDestroyDisabled=!1,this.geolocationOptions=this.viewModel.geolocationOptions,this.goToLocationDisabled=this.viewModel.goToLocationEnabled,this.goToOverride=this.viewModel.goToOverride,this.graphic=this.viewModel.graphic,this.icon=w,this.popupDisabled=this.viewModel.popupEnabled,this.position="top-left",this.scale=this.viewModel.scale,this.state=this.viewModel.state,this.arcgisError=g(()=>this.viewModel,"locate-error"),this.arcgisPropertyChange=M()("state"),this.arcgisReady=_(),this.arcgisSuccess=g(()=>this.viewModel,"locate")}async cancelLocate(){this.viewModel.cancelLocate()}async destroy(){await this.manager.destroy()}async locate(){return await this.viewModel.locate()}_localizeError(e){var o,i,s;if(e instanceof GeolocationPositionError)return e.code===GeolocationPositionError.PERMISSION_DENIED?(o=this.messages)==null?void 0:o.permissionError:e.code===GeolocationPositionError.TIMEOUT?(i=this.messages)==null?void 0:i.timeoutError:(s=this.messages)==null?void 0:s.positionUnavailable;if(e instanceof Error)return e.message}_locate(){const{viewModel:e}=this;e.state==="locating"?e.cancelLocate():e.locate().catch(()=>{})}render(){var m;const{viewModel:e,icon:o}=this,{state:i}=e,s=i==="locating",d=s?this.messages.cancel:this.messages.title,v=i==="feature-unsupported",y=U===void 0?w:void 0,h=this._localizeError((m=this.viewModel)==null?void 0:m.error);return n`<div class=${u(C(H.base,b.widget))}>${!v&&n`<calcite-button class=${u(b.widgetButton)} .disabled=${i==="disabled"} .iconStart=${s?void 0:o??y} kind=neutral .label=${d} @click=${this._locate} title=${d??O}>${s?n`<calcite-loader inline label></calcite-loader>`:null}</calcite-button>`||""}${h?n`<calcite-tooltip open overlay-positioning=fixed .referenceElement=${this.el}>${h}</calcite-tooltip>`:null}</div>`}};c.properties={autoDestroyDisabled:5,geolocationOptions:1,goToLocationDisabled:7,goToOverride:0,graphic:0,icon:3,label:1,messageOverrides:0,popupDisabled:5,position:3,referenceElement:1,scale:9,state:3},c.shadowRootOptions=L,c.styles=F;let p=c;T("arcgis-locate",p);export{p as ArcgisLocate};
