var S=Object.defineProperty;var u=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var c=(t,e,s)=>e in t?S(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,f=(t,e)=>{for(var s in e||(e={}))$.call(e,s)&&c(t,s,e[s]);if(u)for(var s of u(e))x.call(e,s)&&c(t,s,e[s]);return t};import{bL as y,w as E,O as b}from"./vendor.85f7dae5.js";import{x as d,e as l}from"./Utils.c81af201.js";import{a3 as V}from"./enums.d6db9796.js";import{o as _}from"./visualVariablesUtils.36e1778e.js";const w=8388607,h=8388608,A=254,I=255,O=0,z=1,g=t=>(t&h)>>>23,N=t=>t&w,P=t=>g(t)===z?A:I;function q(t){return g(t)===z}function B(t,e){return((e?h:0)|t)>>>0}function M(t,e=0,s=!1){const n=t[e+3];return t[e+0]*=n,t[e+1]*=n,t[e+2]*=n,s||(t[e+3]*=255),t}function C(t){if(!t)return 0;const{r:e,g:s,b:n,a:o}=t;return d(e*o,s*o,n*o,255*o)}function G(t){if(!t)return 0;const[e,s,n,o]=t;return d(e*(o/255),s*(o/255),n*(o/255),o)}const X=(t,e)=>t&&((...s)=>e.warn("DEBUG:",...s))||(()=>null),j=!1;function H(t,e){if(!t||!e)return t;switch(e){case"radius":case"distance":return 2*t;case"diameter":case"width":return t;case"area":return Math.sqrt(t)}return t}function D(t){return{value:t.value,size:y(t.size)}}function a(t){return t.map(e=>D(e))}function p(t){if(typeof t=="string"||typeof t=="number")return y(t);const e=t;return{type:"size",expression:e.expression,stops:a(e.stops)}}const v=t=>{const e=[],s=[],n=a(t),o=n.length;for(let i=0;i<6;i++){const r=n[Math.min(i,o-1)];e.push(r.value),s.push(r.size==null?V:b(r.size))}return{values:new Float32Array(e),sizes:new Float32Array(s)}};function J(t){const e=t&&t.length>0?{}:null,s=e?{}:null;if(!e)return{vvFields:e,vvRanges:s};for(const n of t)if(n.field&&(e[n.type]=n.field),n.type==="size"){s.size||(s.size={});const o=n;switch(_(o)){case l.SIZE_MINMAX_VALUE:s.size.minMaxValue={minDataValue:o.minDataValue,maxDataValue:o.maxDataValue,minSize:p(o.minSize),maxSize:p(o.maxSize)};break;case l.SIZE_SCALE_STOPS:s.size.scaleStops={stops:a(o.stops)};break;case l.SIZE_FIELD_STOPS:if(o.levels){const i={};for(const r in o.levels)i[r]=v(o.levels[r]);s.size.fieldStops={type:"level-dependent",levels:i}}else s.size.fieldStops=f({type:"static"},v(o.stops));break;case l.SIZE_UNIT_VALUE:s.size.unitValue={unit:o.valueUnit,valueRepresentation:o.valueRepresentation}}}else if(n.type==="color")s.color=L(n);else if(n.type==="opacity")s.opacity=F(n);else if(n.type==="rotation"){const o=n;s.rotation={type:o.rotationType}}return{vvFields:e,vvRanges:s}}function F(t){const e={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(typeof t.field=="string"){if(!t.stops)return null;{if(t.stops.length>8)return null;const s=t.stops;for(let n=0;n<8;++n){const o=s[Math.min(n,s.length-1)];e.values[n]=o.value,e.opacities[n]=o.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const s=t.stops&&t.stops.length>=0&&t.stops[0].opacity;for(let n=0;n<8;n++)e.values[n]=1/0,e.opacities[n]=s}}return e}function m(t,e,s){t[4*e+0]=s.r/255,t[4*e+1]=s.g/255,t[4*e+2]=s.b/255,t[4*e+3]=s.a}function L(t){if(E(t)||t.normalizationField)return null;const e={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if(typeof t.field=="string"){if(!t.stops)return null;{if(t.stops.length>8)return null;e.field=t.field;const s=t.stops;for(let n=0;n<8;++n){const o=s[Math.min(n,s.length-1)];e.values[n]=o.value,m(e.colors,n,o.color)}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const s=t.stops&&t.stops.length>=0&&t.stops[0].color;for(let n=0;n<8;n++)e.values[n]=1/0,m(e.colors,n,s)}}for(let s=0;s<32;s+=4)M(e.colors,s,!0);return e}export{G as a,P as b,z as c,w as d,g as e,N as f,C as i,j as l,J as m,X as n,q as p,H as r,B as s,O as u};
