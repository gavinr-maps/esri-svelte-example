import{O as y,n as E,g as b}from"./subclass-BZA_h8Db.js";import{V as h}from"./Accessor-BLX9ikPh.js";import{o as f}from"./timeUtils-8fb_2oAt.js";import{p as l}from"./TimeExtent-DocT5yPf.js";import{r as S}from"./utils-BpB3MnW1.js";import{e as F}from"./tagSymbols-BPcGfZon.js";import"./date-DlqISzcw.js";import"./jsonMap-0cxwUWs2.js";import"./locale-C9TlLpzi.js";import"./tslib.es6-B3Jf3DVX.js";import"./assets-C43MgM-v.js";import"./index-Bh2oEzTI.js";import"./writer-DNAwXnhG.js";import"./Version-BSlAgupz.js";function W(e){return e!=null&&typeof e=="object"&&F in e}function v(e){return e.timeInfo!==void 0}async function D(e,i){var t,r;return((r=(t=e.widgets)==null?void 0:t.timeSlider)==null?void 0:r.fullTimeExtent)??I(e.allLayers,i)}function O(e){const i=e.numThumbs??2,t=e.currentTimeExtent;if(t){const{start:r,end:s}=t;return r!=null&&s!=null&&r.getTime()===s.getTime()?"instant":i===2?"time-window":r==null||r.getTime()===0?"cumulative-from-start":"cumulative-from-end"}return i===2?"time-window":"cumulative-from-start"}function U(e){const{numStops:i,stopInterval:t,stops:r}=e;return r?{dates:b(r)}:t?{interval:t.clone()}:{count:i??5}}async function I(e,i){var T;if(e.length===0)return l.allTime;await Promise.all(e.map(n=>n.load({signal:i})));const t=e.filter(v),r=e.filter(n=>!v(n)&&n.visibilityTimeExtent!=null);if(t.length===0&&r.length===0)return l.allTime;const s=[],o=[];for(const n of t)(n==null?void 0:n.type)!=="feature"&&(n==null?void 0:n.type)!=="map-image"||!((T=n.timeInfo)!=null&&T.hasLiveData)?o.push(n):s.push(n);const a=n=>n==null||n.isAllTime,p=[...o.map(n=>{var c;const m=(c=n.timeInfo)==null?void 0:c.fullTimeExtent,{visibilityTimeExtent:u}=n;return(m==null?void 0:m.intersection(u))??u}),...r.map(n=>n.visibilityTimeExtent)];if(p.some(a))return l.allTime;const x=s.map(async n=>{var c,w;const m=((c=await n.fetchRecomputedExtents({signal:i}))==null?void 0:c.timeExtent)??((w=n.timeInfo)==null?void 0:w.fullTimeExtent),{visibilityTimeExtent:u}=n;return(m==null?void 0:m.intersection(u))??u}),d=(await Promise.allSettled(x)).map(n=>n.status==="fulfilled"?n.value:null);if(d.some(a))return l.allTime;const g=[...d,...p].filter(y);return g.length===0?l.allTime:g.reduce((n,m)=>n.union(m))}function L(e,i){const t=e.currentTimeExtent;if(!t)return null;const{start:r,end:s}=t,o=r??s??null;switch(i){case"time-window":return new l({start:r,end:s});case"cumulative-from-start":return new l({start:null,end:o});case"cumulative-from-end":return new l({start:o,end:null});case"instant":return new l({start:o,end:o})}}async function N(e,i){return h(E.getLogger("esri.support.timeUtils.getTimeSliderSettingsFromWebMap"),"`timeUtils.getTimeSliderSettingsFromWebMap` is deprecated in favor of 'timeUtils.getTimeSliderSettingsFromWebDocument'",{replacement:"timeUtils.getTimeSliderSettingsFromWebDocument",version:"4.30",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-support-timeUtils.html#getTimeSliderSettingsFromWebDocument",warnOnce:!0}),e!=null&&S(e)?await z(e,i):null}async function z(e,i){var a;if(!S(e)&&!W(e))return null;await e.load({signal:i});const t=(a=e==null?void 0:e.widgets)==null?void 0:a.timeSlider;if(!t)return null;const r=await D(e,i),s=t.loop,o=O(t);return{fullTimeExtent:r,loop:s,mode:o,playRate:t.stopDelay??2e3,stops:U(t),timeExtent:L(t,o)}}function Q(e){if(!e)return e;const{start:i,end:t}=e;return new l({start:i!=null?f(i,-i.getTimezoneOffset(),"minutes"):i,end:t!=null?f(t,-t.getTimezoneOffset(),"minutes"):t})}function X(e){if(!e)return e;const{start:i,end:t}=e;return new l({start:i!=null?f(i,i.getTimezoneOffset(),"minutes"):i,end:t!=null?f(t,t.getTimezoneOffset(),"minutes"):t})}export{I as getTimeExtentFromLayers,z as getTimeSliderSettingsFromWebDocument,N as getTimeSliderSettingsFromWebMap,X as toLocalTimeExtent,Q as toUTCTimeExtent};
