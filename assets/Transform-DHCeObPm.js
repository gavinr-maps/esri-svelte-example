import{s as A,d as M,O as w,n as R}from"./mathUtils-ClvKsMak.js";import{F as y,l as H,e as z,N as a,A as _}from"./projectBuffer-vsa0P_cF.js";import{G as F,s as C}from"./Point-DB4Hp4hH.js";import{o as G,e as h}from"./Evented-CXIxDjmW.js";import{S as j}from"./Accessor-D6mNnsWy.js";import{n as L,y as f,b as P}from"./subclass-BR3PhgZG.js";import{_ as W}from"./mat4-ybYUU6jq.js";import{e as B}from"./mat4f64-Dk4dwAN8.js";import{a as T}from"./RenderTexture-BNgzgNs_.js";import{D as S,l as q}from"./Polyline-D97hl-6E.js";import{Z as I}from"./sphere-7666U3LO.js";import{e as b}from"./ElevationRange-BrgM1moX.js";import{e as Z}from"./WaterSurface.glsl-BJUc652W.js";import{T as D,e as K}from"./ElevationProvider-BHZsEIDd.js";function ce(e,n,t,i){if(n==null||i==null)return!1;const r=y(n,H),o=y(i,z);if(r===o&&r!==a.UNKNOWN||F(n,i))return t[0]=1,t[1]=1,t[2]=1,!0;if(r===a.SPHERICAL_ECEF){const c=A(e),u=c/Math.sqrt(e[0]*e[0]+e[1]*e[1]),m=c/C.radius;if(o===a.WEB_MERCATOR)return t[0]=u*m,t[1]=u*m,t[2]=1,!0;if(o===a.WGS84||o===a.CGCS2000){const s=_;return t[0]=s*u*m,t[1]=s*m,t[2]=1,!0}}else if(r===a.PLATE_CARREE){if(o===a.WGS84||o===a.CGCS2000)return t[0]=_,t[1]=_,t[2]=1,!0;if(o===a.WEB_MERCATOR){const c=e[1]/C.radius;return t[0]=1,t[1]=1/Math.cos(c),t[2]=1,!0}}return!1}let p=class extends G.EventedMixin(j){constructor(e){super(e),this._tmpEvent=new Z,this._renderCoordsHelper=e.view.renderCoordsHelper,this._renderSR=this._renderCoordsHelper.spatialReference,this._layerElevationSource=e.layerElevationSource}initialize(){this._intersector=D(this.view.state.viewingMode),this._intersector.options.store=K.MIN,this._intersector.options.normalRequired=!1,this._tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"}get spatialReference(){var e,n;return(n=(e=this.view)==null?void 0:e.elevationProvider)==null?void 0:n.spatialReference}getElevation(e,n,t,i){const r=this._renderCoordsHelper,o=M(l,e,n,t);if(!r.toRenderCoords(o,i,o))return L.getLogger(this).error("could not project point to compute elevation"),null;const{layerElevationSource:c,_intersector:u,intersectionHandler:m}=this,s=c.fullExtent,v=s!=null&&Number.isFinite(s.xmin)&&Number.isFinite(s.xmax)&&Number.isFinite(s.ymin)&&Number.isFinite(s.ymax)&&Number.isFinite(s.zmin)&&Number.isFinite(s.zmax)?new b(s.zmin,s.zmax):c.elevationRange;if(v==null)return null;const x=c.elevationOffset,N=v.elevationRangeMin+x,O=v.elevationRangeMax+x,E=r.setAltitude(U,O,o),g=r.setAltitude(k,N,o);return u.reset(E,g,null),m.intersect(u,null,E,g,null,!0),u.results.min.getIntersectionPoint(o)?r.getAltitude(o):null}getSphereElevationBounds(e,n){return T(e,n,$,this._renderSR),this._layerElevationSource.getElevationRange($)}getRootElevationBounds(){const e=this.layerElevationSource.fullExtent;return e!=null&&e.hasZ?new b(e.zmin,e.zmax):null}objectsChanged(e){this.spatialReference&&(this._computeLayerExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}objectChanged(e){this.spatialReference&&(this._computeObjectExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}_computeObjectExtent(e,n){S(n),this._expandExtent(e,n)}_computeLayerExtent(e,n){S(n);for(const t of e)this._expandExtent(t,n)}_expandExtent(e,n){const t=this.spatialReference;if(t==null||e==null)return;W(d,e.quaternion),d[12]=e.center[0],d[13]=e.center[1],d[14]=e.center[2];const i=e.halfSize;for(let r=0;r<8;++r)l[0]=1&r?i[0]:-i[0],l[1]=2&r?i[1]:-i[1],l[2]=4&r?i[2]:-i[2],w(l,l,d),this._renderCoordsHelper.fromRenderCoords(l,l,t),q(n,l,n)}};h([f({constructOnly:!0})],p.prototype,"layerElevationSource",void 0),h([f({constructOnly:!0})],p.prototype,"intersectionHandler",void 0),h([f({constructOnly:!0})],p.prototype,"view",void 0),h([f()],p.prototype,"spatialReference",null),p=h([P("esri.views.3d.layers.i3s.LayerElevationProvider")],p);const d=B(),$=I(0,0,0,0),l=R(),U=R(),k=R();class ue{constructor(n,t,i,r){this.toMapSpace=n,this.transform=t,this.obb=i,this.geometry=r}}class me{constructor(n,t){this.position=n,this.rotationScale=t,this.origin=void 0}}export{ce as f,me as i,ue as t,p as x};
