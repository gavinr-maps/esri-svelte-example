const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./queryNamedTraceConfigurations-C1VgjJm9.js","./cast-CsZslgGN.js","./Accessor-BmwT4B0c.js","./index-4eY77cms.js","./index-Cx51aysm.css","./JSONSupport-DcrLLGjL.js","./utils-YowqfOgk.js","./Graphic-Dt0LgVGU.js","./Clonable-Z-AWS-16.js","./reactiveUtils-XM7cS2OP.js","./Evented-Dw4_VOGn.js","./SimpleObservable-CvOkykwM.js","./writer-DKgfqj4X.js","./opacityUtils-Dim20wpZ.js","./Promise-DfET-uns.js","./Point-Cz2JYYmX.js","./enumeration-DpvDkLNI.js","./Color-VJEMvW-n.js","./colorUtils-Rxh2V3ai.js","./mathUtils-Cfq9PL9W.js","./ActionToggle-D7439N1A.js","./Identifiable-BHVfzH03.js","./jsonUtils-CwFG8yN4.js","./Extent-g5W9hy0j.js","./Polyline-s-JzsQqo.js","./typeUtils-B6WBEKDM.js","./TextSymbol-BLIQ6RKX.js","./screenUtils-_ZIvrt5o.js","./collectionUtils-CTT-51g7.js","./Portal-CmmHxpLg.js","./vec3f64-BLpZdpfb.js","./aaBoundingBox-Dw3yBk2f.js","./FeatureLayer-U46cmps3.js","./MultiOriginJSONSupport-DbmrbwMa.js","./layerContainerType-C5CzMsLd.js","./FeatureLayerBase-C4QQJYE9.js","./formUtils-l8pvwous.js","./Field-BDG0QV_T.js","./fieldType-CBeoJWlv.js","./HeightModelInfo-C05IFsWs.js","./commonProperties-B0GHoNP5.js","./ElevationInfo-BPOqhCue.js","./unitConversionUtils-rg07EgOm.js","./lengthUtils-_77UiyVF.js","./AttributeTableTemplate-cR37sM72.js","./timeZoneUtils-DxzjpEBb.js","./featureLayerUtils-Btb8HY8h.js","./uuid-Cl5lrJ4c.js","./featureQueryAll-JpNZKIBO.js","./Query-B_2mhyL4.js","./FullTextSearch-CBnxSwz4.js","./TimeExtent-BO6BsF_x.js","./timeUtils-C1c_L2Fd.js","./layerUtils-B__v9OBu.js","./SimpleRenderer-CEw_geZx.js","./commonProperties-ZfGquLPI.js","./colorRamps-CRjjPL3r.js","./SizeVariable-B-ghFm6e.js","./visualVariableUtils-Xcorldoo.js","./ColorStop-BYiAUa8d.js","./jsonUtils-B-voMz-i.js","./defaults-FkBa0ybj.js","./defaultsJSON-GKolV7NZ.js","./UniqueValueRenderer-yoWHKJ_P.js","./diffUtils-BanfihCO.js","./RendererLegendOptions-CYAPr8D6.js","./styleUtils-ColFrJ-Z.js","./AttachmentQuery-CpEmJqq-.js","./NormalizationBinParametersMixin-CZD0XfhN.js","./RelationshipQuery-B5a-mYy7.js","./LayerFloorInfo-iCgtHY6f.js","./Relationship-CTbzI1Kb.js","./serviceCapabilitiesUtils-B2yGaMdk.js","./infoFor3D-C7tb3HsI.js","./Layer-DH4_Pn8a.js","./workers-Cds_sd9m.js","./Queue-BQesTh_6.js","./intl-Duiy0OzY.js","./editsZScale-LI19I1vI.js","./queryZScale-BdW_vUm_.js","./projection-CyCZAIaD.js","./projectBuffer-CQnuEMuP.js","./geodesicConstants-RQL9oKdk.js","./FeatureSet-B5-Veyin.js","./APIKeyMixin-3z69J1h4.js","./ArcGISService-CDyDWGI0.js","./ScaleRangeLayer-Cnzwr9PT.js","./jsonUtils-DZz5FrgB.js","./utils-DYurMneM.js","./mat4f32-DcsiF_Rp.js","./mat4-Fi6iAz29.js","./common-DQOJ18NT.js","./CustomParametersMixin-Be7WOSEG.js","./DisplayFilteredLayer-CzliK74b.js","./scaleUtils-DPfHG2g0.js","./displayFilterUtils-uKPOP7_-.js","./EditBusLayer-KXo-LY9o.js","./FeatureEffectLayer-BZmannck.js","./FeatureEffect-DZgZP6Sj.js","./FeatureFilter-Ca1n-g_b.js","./FeatureReductionLayer-B6VhUfZv.js","./FeatureReductionSelection-BJWsAyix.js","./labelingInfo-BgG6IH9B.js","./labelUtils-DCpQ7n-8.js","./jsonUtils-BZp85R7u.js","./typeUtils-B3iPBwJ2.js","./ClassBreaksRenderer-C7fhua2J.js","./LRUCache-CXiGQWMN.js","./MemCache-CmojB_Z1.js","./Version-Cd3TlGH0.js","./FieldsIndex-FW1AMU67.js","./utils-UPZJIDfz.js","./defaultCIMValues-Bb-CUowV.js","./enums-BTM-fOHQ.js","./HeatmapColorStop-CHbSyb1s.js","./heatmapUtils-Cyq-bAyG.js","./vec42-YcqnINSP.js","./vec4f64-o2zAXfmz.js","./MD5-C9MwAd2G.js","./OperationalLayer-B__lrMRq.js","./OrderedLayer-ucEg87Tu.js","./OrderByInfo-KsusEmpW.js","./PortalLayer-Cqwv_mmr.js","./PortalItem-CTx1kJsR.js","./portalItemUtils-ByOtbGao.js","./RefreshableLayer-C90FXoHt.js","./TemporalLayer-CMqBosxi.js","./TimeInfo-CctegBed.js","./TimeInterval-B7L-CEq7.js","./TrackableLayer-DaYHUnrc.js","./FeatureTemplate-Dh5_oWTV.js","./FeatureType-DhERcdEP.js","./fieldProperties-DDN0PSrH.js","./TitleCreator-DIyQ9Yy3.js","./versionUtils-BfhafDf-.js","./styleUtils-Bye9ft1s.js","./popupUtils-CmsUVJA0.js","./interfaces-CL2NbQte.js","./typeUtils-cWA9Lf-p.js","./UNTraceConfiguration-CG_xGt6F.js","./networkFieldUtils-iOtCEyIS.js","./TraceResult-BGYxkdrX.js","./NetworkElement-BEwoE6j2.js","./QueryNamedTraceConfigurationsParameters-CurRQTaN.js","./validateNetworkTopology-DELM5yEN.js","./ValidateNetworkTopologyParameters-2W5RTXWL.js","./queryAssociations-B1XZHjJl.js","./Association-CvaR2Zsv.js","./QueryAssociationsParameters-BnG4WCS9.js","./synthesizeAssociationGeometries--DGsSh6f.js","./SynthesizeAssociationGeometriesParameters-CSFuSWPA.js","./trace-t_n0Hp0d.js","./TraceParameters-BQjpnyaH.js"])))=>i.map(i=>d[i]);
import{_ as N}from"./index-4eY77cms.js";import{r as n,m as d,a as O,a6 as Je,s as re,E as Ke,B as Qe,g as Xe}from"./Accessor-BmwT4B0c.js";import{b as xe}from"./Graphic-Dt0LgVGU.js";import Me from"./FeatureLayer-U46cmps3.js";import{r as Be}from"./featureQueryAll-JpNZKIBO.js";import{P as q,i as ze,I as Ze,d as Re,o as et}from"./cast-CsZslgGN.js";import{m as qe}from"./Portal-CmmHxpLg.js";import{S as tt,m as rt}from"./MultiOriginJSONSupport-DbmrbwMa.js";import{w as ot}from"./Extent-g5W9hy0j.js";import{g as He}from"./Point-Cz2JYYmX.js";import{f as st}from"./jsonUtils-CwFG8yN4.js";import{g as je,a as se,l as at,h as it,t as Ue,i as Oe,c as $e}from"./EditBusLayer-KXo-LY9o.js";import{r as We}from"./enumeration-DpvDkLNI.js";import{S as oe}from"./JSONSupport-DcrLLGjL.js";import Ve from"./PortalItem-CTx1kJsR.js";import{d as nt}from"./FeatureSet-B5-Veyin.js";import{l as X,r as lt}from"./layerUtils-B__v9OBu.js";import{t as L,o as Z,e as ut}from"./typeUtils-cWA9Lf-p.js";import{o as dt}from"./writer-DKgfqj4X.js";import{a as Ye,s as ct}from"./UNTraceConfiguration-CG_xGt6F.js";import{e as pt}from"./networkFieldUtils-iOtCEyIS.js";import{a as yt}from"./TraceResult-BGYxkdrX.js";import{b as mt}from"./Query-B_2mhyL4.js";let V=class extends oe{constructor(e){super(e),this.moment=null,this.fullUpdate=!1,this.validateErrorsCreated=!1,this.exceededTransferLimit=null,this.serviceEdits=null,this.discoveredSubnetworks=null}};n([d({type:Date,json:{type:Number,write:{writer:(r,e)=>{e.moment=r?r.getTime():null}}}})],V.prototype,"moment",void 0),n([d({type:Boolean,json:{write:!0}})],V.prototype,"fullUpdate",void 0),n([d({type:Boolean,json:{write:!0}})],V.prototype,"validateErrorsCreated",void 0),n([d({type:Boolean,json:{write:!0}})],V.prototype,"exceededTransferLimit",void 0),n([d({type:[Object],json:{write:!0}})],V.prototype,"serviceEdits",void 0),n([d({type:[Object],json:{write:!0}})],V.prototype,"discoveredSubnetworks",void 0),V=n([O("esri.rest.networks.support.ValidateNetworkTopologyResult")],V);const ht=V,ft=ze()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let J=class extends ht{constructor(e){super(e),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const t={...e,query:{f:"json"}},{data:o}=await q(this.statusUrl,t);return this.read(o),this.editsResolver&&this.editsResolver.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],exceededTransferLimit:!0,historicMoment:null}),this}async waitForJobCompletion(e={}){const{interval:t=1e3,statusCallback:o}=e;return new Promise((s,u)=>{this._clearTimer();const a=setInterval(()=>{this._timer||u(Je()),this.checkJobStatus().then(p=>{const{status:i}=p;switch(this.status=i,i){case"job-succeeded":this._clearTimer(),s(this);break;case"job-waiting":case"job-executing":o&&o(this)}},p=>{this._clearTimer(),u(p)})},t);this._timer=a})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};n([d()],J.prototype,"editsResolver",void 0),n([d({type:String,json:{write:!0}})],J.prototype,"statusUrl",void 0),n([We(ft)],J.prototype,"status",void 0),n([d({type:Date,json:{type:Number,write:{writer:(r,e)=>{e.submissionTime=r?r.getTime():null}}}})],J.prototype,"submissionTime",void 0),n([d({type:Date,json:{type:Number,write:{writer:(r,e)=>{e.lastUpdatedTime=r?r.getTime():null}}}})],J.prototype,"lastUpdatedTime",void 0),J=n([O("esri.networks.support.TopologyValidationJobInfo")],J);const gt=J;async function er(r,e){const t=r.layers,o=r.layerInfos,s=r.returnGeometry||!1,u=r.outSpatialReference;return await Promise.all(t.map(async a=>{await a.load()})),(await Promise.all(t.map(async a=>{var f;const p=o.find(h=>{var y;return h.layerUrl===((y=a.parsedUrl)==null?void 0:y.path)});if(!((f=p==null?void 0:p.objectIds)!=null&&f.length))return{layer:a,featureSet:void 0};const i=a.createQuery();i.returnGeometry=s,i.outFields=p.outFields||["*"],i.outSpatialReference=u,i.gdbVersion=a.gdbVersion,i.objectIds=p.objectIds;const c=nt.fromJSON(await Be(a,i));return c.features.forEach(h=>{h.layer=a}),{layer:a,featureSet:c}}))).filter(a=>a.featureSet!==void 0)}async function Pe(r,e){if(r==="Utility Network Layer"){const{default:t}=await N(()=>Promise.resolve().then(()=>Ft),void 0,import.meta.url);return new t({layerUrl:e})}return null}async function Tt(r){var a;let e="portalItem"in r?r:{portalItem:r};!e.portalItem||e.portalItem instanceof Ve||(e={...e,portalItem:new Ve(e.portalItem)});const t=e.portalItem;if(await t.load(),t.type!=="Feature Service")throw new re("portal:unknown-item-type","Unknown item type '${type}'",{type:t.type});const o=t.url,s=await q(o,{responseType:"json",query:{f:"json"}}),u="Network Layer";if((a=s.data.type)!=null&&a.includes(u))return Pe(s.data.type,o);if(s.data.layers){const p=s.data.layers.find(i=>i.type.includes(u));if(p){const i=`${o}/${p.id}`;return Pe(p.type,i)}}return null}let w=class extends tt(qe){static fromPortalItem(r){return Tt(r)}constructor(r){super(r),this.id=null,this.title=null,this.layerUrl=null,this.dataElement=null,this.fullExtent=null,this.spatialReference=null,this.type=null,this.sourceJSON=null,this.gdbVersion=null,this.historicMoment=null,this._sourceIdByLayerId=new Map,this._layerIdBySourceId=new Map,this._applyEditsHandler=e=>{const{serviceUrl:t,gdbVersion:o,result:s}=e,u=t===this.featureServiceUrl,a=je(t,o,this.gdbVersion);u&&a&&s.then(p=>{se(t,o)&&(this.historicMoment=p.historicMoment)})},this._updateMomentHandler=e=>{const{serviceUrl:t,gdbVersion:o,moment:s}=e,u=t===this.featureServiceUrl,a=je(t,o,this.gdbVersion);u&&a&&(this.historicMoment=s)},this.when().then(()=>{this.addHandles([at(this._applyEditsHandler),it(this._updateMomentHandler)])},()=>{})}initialize(){this.when().catch(r=>{Ke(r)||Qe.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:r})})}get datasetName(){var r;return((r=this.dataElement)==null?void 0:r.name)??null}get owner(){var r;return((r=this.dataElement)==null?void 0:r.userIdentity)??null}get schemaGeneration(){var r;return((r=this.dataElement)==null?void 0:r.schemaGeneration)??null}get parsedUrl(){return Ze(this.layerUrl)}get featureServiceUrl(){return Re(this.parsedUrl.path).url.path}get networkServiceUrl(){return this.featureServiceUrl.replace(/\/FeatureServer/i,"/UtilityNetworkServer")}get layerId(){return Re(this.parsedUrl.path).sublayer}get networkSystemLayers(){return null}async load(r){return this.addResolvingPromise(this._fetchDataElement(this.featureServiceUrl,this.layerId.toString(),r)),this.addResolvingPromise(this._fetchLayerMetaData(this.layerUrl,r)),this}getLayerIdBySourceId(r){if(!this.dataElement)return null;const e=this._layerIdBySourceId.get(r);if(e!=null)return e;const t=this.dataElement.domainNetworks,o=this._traverseNetworkSources(t,this._layerIdBySourceId,"sourceId","layerId",r);return o>=0?o:null}getSourceIdByLayerId(r){if(!this.dataElement)return null;const e=this._sourceIdByLayerId.get(r);if(e!=null)return e;const t=this.dataElement.domainNetworks,o=this._traverseNetworkSources(t,this._sourceIdByLayerId,"layerId","sourceId",r);return o>=0?o:null}getObjectIdsFromElements(r){const e=[],t=new Map;for(const s of r){const u=this.getLayerIdBySourceId(s.networkSourceId);if(u==null)continue;let a=t.get(u);a===void 0&&(a=[]),a.push(s.objectId),t.set(u,a)}const o=this.featureServiceUrl;return t.forEach((s,u)=>e.push({layerUrl:`${o}/${u}`,objectIds:s})),e}async queryNamedTraceConfigurations(r,e){var a;const[{queryNamedTraceConfigurations:t},{default:o}]=await Promise.all([N(()=>import("./queryNamedTraceConfigurations-C1VgjJm9.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142]),import.meta.url),N(()=>import("./QueryNamedTraceConfigurationsParameters-CurRQTaN.js"),__vite__mapDeps([143,2,5]),import.meta.url)]),s=this.networkServiceUrl,u=o.from(r);return(a=await t(s,u,{...e}))==null?void 0:a.namedTraceConfigurations}async validateTopology(r,e){var c,f,h;if(!r.validateArea)throw new re("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");const[{validateNetworkTopology:t},{default:o}]=await Promise.all([N(()=>import("./validateNetworkTopology-DELM5yEN.js"),__vite__mapDeps([144,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142]),import.meta.url),N(()=>import("./ValidateNetworkTopologyParameters-2W5RTXWL.js"),__vite__mapDeps([145,2,5,12,23,15,1,3,4,138]),import.meta.url)]),s=o.from(r);se(this.featureServiceUrl,this.gdbVersion||null)?(s.sessionID=Ue,await Oe(this.featureServiceUrl,this.gdbVersion,!0)):s.sessionID=null,s.gdbVersion=this.gdbVersion;const u=this.networkServiceUrl,a=this.featureServiceUrl,p=$e(a,null,this.gdbVersion,!0),i=await t(u,s,{...e});if(i!=null&&i.serviceEdits){const y=[];for(const g of i.serviceEdits){const{editedFeatures:m}=g,l=m!=null&&m.spatialReference?new He(m.spatialReference):null;y.push({layerId:g.layerId,editedFeatures:{adds:((c=m==null?void 0:m.adds)==null?void 0:c.map(I=>ee(I,l)))||[],updates:((f=m==null?void 0:m.updates)==null?void 0:f.map(I=>({original:ee(I[0],l),current:ee(I[1],l)})))||[],deletes:((h=m==null?void 0:m.deletes)==null?void 0:h.map(I=>ee(I,l)))||[],spatialReference:l}})}p.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],editedFeatures:y,exceededTransferLimit:!1,historicMoment:i.moment})}return i}async submitTopologyValidationJob(r,e){let t=null;if(!r.validateArea)throw new re("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");if(!this.gdbVersion){const c=this.layerUrl.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");t=(await q(c,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}const[{submitValidateNetworkTopologyJob:o},{default:s}]=await Promise.all([N(()=>import("./validateNetworkTopology-DELM5yEN.js"),__vite__mapDeps([144,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142]),import.meta.url),N(()=>import("./ValidateNetworkTopologyParameters-2W5RTXWL.js"),__vite__mapDeps([145,2,5,12,23,15,1,3,4,138]),import.meta.url)]),u=s.from(r);se(this.featureServiceUrl,this.gdbVersion||null)?(u.sessionID=Ue,await Oe(this.featureServiceUrl,this.gdbVersion,!0)):u.sessionID=null,u.gdbVersion=this.gdbVersion||t;const a=this.networkServiceUrl,p=this.featureServiceUrl?$e(this.featureServiceUrl,null,this.gdbVersion,!0):void 0,i=await o(a,u,{...e});return new gt({statusUrl:i,editsResolver:p})}getSourceTypeById(r){if(!this.dataElement)return null;for(const e of this.dataElement.domainNetworks)for(const t of[e.edgeSources??[],e.junctionSources??[]])for(const o of t)if(o.sourceId===r)return t===e.edgeSources?"edge":"junction";return null}_traverseNetworkSources(r,e,t,o,s){for(const u of r)for(const a of[u.edgeSources??[],u.junctionSources??[]])for(const p of a)if(p[t]===s)return e.set(s,p[o]),p[o];return-1}async _fetchLayerMetaData(r,e){const t=await q(r,{responseType:"json",query:{f:"json"},...e});this.sourceJSON=t.data,this.read(t.data,{origin:"service"})}async _fetchDataElement(r,e,t){if(this.dataElement)return;const o=await q(`${r}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([e]),f:"json"},...t}).then(s=>{var u;return(u=s.data.layerDataElements)==null?void 0:u[0]});o&&this.read(o,{origin:"service"})}};function ee(r,e){return new xe({attributes:r.attributes,geometry:st({...r.geometry,spatialReference:e})})}n([d({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:!0}},read:!1}})],w.prototype,"id",void 0),n([d({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:{source:"name"}}},read:!1}})],w.prototype,"title",void 0),n([d({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"url"},write:{target:"url",isRequired:!0}}},read:!1}})],w.prototype,"layerUrl",void 0),n([d({type:Object,json:{origins:{service:{read:!0}},read:!1}})],w.prototype,"dataElement",void 0),n([d({type:ot,json:{origins:{service:{read:{source:"extent"}}},read:!1}})],w.prototype,"fullExtent",void 0),n([d({type:He,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:!1}})],w.prototype,"spatialReference",void 0),n([d({type:["utility","trace"],readOnly:!0,json:{read:!1,write:!1}})],w.prototype,"type",void 0),n([d({readOnly:!0})],w.prototype,"datasetName",null),n([d({readOnly:!0})],w.prototype,"owner",null),n([d({readOnly:!0})],w.prototype,"schemaGeneration",null),n([d({readOnly:!0})],w.prototype,"parsedUrl",null),n([d({readOnly:!0})],w.prototype,"featureServiceUrl",null),n([d({readOnly:!0})],w.prototype,"networkServiceUrl",null),n([d({readOnly:!0})],w.prototype,"layerId",null),n([d()],w.prototype,"sourceJSON",void 0),n([d({readOnly:!0})],w.prototype,"networkSystemLayers",null),n([d()],w.prototype,"gdbVersion",void 0),n([d({type:Date})],w.prototype,"historicMoment",void 0),w=n([O("esri.networks.Network")],w);const It=w;let x=class extends oe.JSONSupportMixin(qe){constructor(e){super(e),this.rulesCategorized={attachment:[],containment:[],connectivity:[]},this.request=q}initialize(){}async load(e){const t=this.rulesLayer.load(e).then(()=>this._initializeRulesTable());return this.addResolvingPromise(t),this}getFeaturesCanAssociateWithClause(e,t,o){return this._getWhereClauseForCompatibleFeatures(e,t,o)}getFeaturesCanAssociateWith(e,t,o){return this._getFeatureSourceLayerId(e)==null?[]:t.filter(s=>this.canAssociateFeatures(e,s,o))}canAssociateFeatures(e,t,o){const[s,u]=this._getFeatureAssetCodes(e),a=this._getFeatureSourceLayerId(e),[p,i]=this._getFeatureAssetCodes(t),c=this._getFeatureSourceLayerId(t);return a!=null&&c!=null&&o.some(f=>{const{type:h,direction:y}=f;return this._getRulesForAssociationType(h).some(g=>{const m=this._getRuleFieldValuesForAssociation(g,h,y);return m==null?void 0:m.some(l=>a===(l==null?void 0:l.ruleLayerIdForSource)&&s===(l==null?void 0:l.ruleAssetGroupCodeForSource)&&u===(l==null?void 0:l.ruleAssetTypeCodeForSource)&&c===(l==null?void 0:l.ruleLayerIdForTarget)&&p===(l==null?void 0:l.ruleAssetGroupCodeForTarget)&&i===(l==null?void 0:l.ruleAssetTypeCodeForTarget))})})}getLayersCanAssociateWith(e,t,o){return this._getFeatureSourceLayerId(e)==null?[]:t.filter(s=>this.canAssociateFeatureToLayer(e,s,o))}canAssociateFeatureToLayer(e,t,o){const s=X(t)?t.parent:t;if(!s)return!1;const u=s.layerId,a=X(t)?t.subtypeCode:null,[p,i]=this._getFeatureAssetCodes(e),c=this._getFeatureSourceLayerId(e);return c!=null&&o.some(f=>{const{type:h,direction:y}=f;return this._getRulesForAssociationType(h).some(g=>{const m=this._getRuleFieldValuesForAssociation(g,h,y);return m==null?void 0:m.some(l=>c===(l==null?void 0:l.ruleLayerIdForSource)&&p===(l==null?void 0:l.ruleAssetGroupCodeForSource)&&i===(l==null?void 0:l.ruleAssetTypeCodeForSource)&&u===(l==null?void 0:l.ruleLayerIdForTarget)&&(a==null||a===(l==null?void 0:l.ruleAssetGroupCodeForTarget)))})})}getFeatureSQL(e,t){var c,f;const o=e.layerId.toString(),s=(c=e.fieldsIndex)==null?void 0:c.normalizeFieldName("assetGroup"),u=(f=e.fieldsIndex)==null?void 0:f.normalizeFieldName("assetType"),a=s?t.attributes[s]:null,p=u?t.attributes[u]:null,i=this.rulesHash[o];if(i){const h=i.assetGroupHash[a];if(h)return h.assetTypeHash[p]||null}return null}async _initializeRulesTable(){var s,u,a,p,i,c,f,h,y,g,m;const e={};let t;(function(l){l[l.from=0]="from",l[l.to=1]="to",l[l.via=2]="via"})(t||(t={}));const o=[{networkSourceId:"fromNetworkSource",assetGroupId:"fromAssetGroup",assetTypeId:"fromAssetType"},{networkSourceId:"toNetworkSource",assetGroupId:"toAssetGroup",assetTypeId:"toAssetType"},{networkSourceId:"viaNetworkSource",assetGroupId:"viaAssetGroup",assetTypeId:"viaAssetType"}];this.rulesCategorized={attachment:[],containment:[],connectivity:[]};for(const l of this.rules){if(l.ruleType===L.RTAttachment){this.rulesCategorized.attachment.push(l);continue}if(l.ruleType===L.RTContainment){this.rulesCategorized.containment.push(l);continue}if(l.ruleType===L.RTJunctionJunctionConnectivity){this.rulesCategorized.connectivity.push(l);continue}this.rulesCategorized.connectivity.push(l);let I=[[t.from,t.to],[t.to,t.from]];l.ruleType===L.RTEdgeJunctionEdgeConnectivity&&(I=[[t.from,t.via],[t.via,t.from],[t.to,t.via],[t.via,t.to]]);for(const T of I){const C=T.shift(),H=T.shift();let D=!1;switch(l.ruleType){case L.RTEdgeJunctionEdgeConnectivity:D=C===t.from||C===t.to;break;case L.RTJunctionEdgeConnectivity:D=C===t.to}const _=o[C],b=((s=l[_.networkSourceId])==null?void 0:s.layerId.toString())??"",A=(a=(u=l[_.assetGroupId])==null?void 0:u.assetGroupCode)==null?void 0:a.toString(),R=l[_.assetTypeId],E=(p=R==null?void 0:R.assetTypeCode)==null?void 0:p.toString(),j=o[H],F=((i=l[j.networkSourceId])==null?void 0:i.layerId.toString())??"",$=(f=(c=l[j.assetGroupId])==null?void 0:c.assetGroupCode)==null?void 0:f.toString(),v=l[j.assetTypeId],U=(h=v==null?void 0:v.assetTypeCode)==null?void 0:h.toString(),W=e[b]??{assetGroupHash:{}};if(!(A&&E&&$&&U))continue;const Y=W.assetGroupHash[A]??{assetTypeHash:{}},S=Y.assetTypeHash[E]??{};if(S[F]=S[F]??{},D){S[b]=S[b]??{};const Q=`(assetgroup = ${A} AND assettype = ${E})`;(v==null?void 0:v.connectivityPolicy)==="esriNECPEndVertex"?S[b].endVertex=(y=S[b])!=null&&y.endVertex?`${S[b].endVertex}`:`${Q}`:S[b].anyVertex=S[b].anyVertex?`${S[b].anyVertex}`:`${Q}`}const B=`(assetgroup = ${$} AND assettype = ${U})`;(v==null?void 0:v.connectivityPolicy)==="esriNECPEndVertex"?S[F].endVertex=(g=S[F])!=null&&g.endVertex?`${S[F].endVertex} OR ${B}`:`${B}`:S[F].anyVertex=(m=S[F])!=null&&m.anyVertex?`${S[F].anyVertex} OR ${B}`:`${B}`,Y.assetTypeHash[E]=S,W.assetGroupHash[A]=Y,e[b]=W}}this._set("rulesHash",e)}_getRuleFieldValuesForAssociation(e,t,o="from"){var s,u,a,p,i,c,f,h,y,g,m,l,I,T,C,H,D,_,b,A,R,E,j,F,$,v,U,W,Y,S,B,Q,ae,ie,ne,le,ue,de,ce,pe,ye,me,he,fe,ge,Te,Ie,we,ve,Se,be,Ae,Ce,_e,Ne,Fe,ke,Ee,Ge,Le;switch(t){case"attachment":case"containment":return o==="from"?[{ruleLayerIdForSource:(s=e.fromNetworkSource)==null?void 0:s.layerId,ruleAssetGroupCodeForSource:(u=e.fromAssetGroup)==null?void 0:u.assetGroupCode,ruleAssetTypeCodeForSource:(a=e.fromAssetType)==null?void 0:a.assetTypeCode,ruleLayerIdForTarget:(p=e.toNetworkSource)==null?void 0:p.layerId,ruleAssetGroupCodeForTarget:(i=e.toAssetGroup)==null?void 0:i.assetGroupCode,ruleAssetTypeCodeForTarget:(c=e.toAssetType)==null?void 0:c.assetTypeCode}]:[{ruleLayerIdForSource:(f=e.toNetworkSource)==null?void 0:f.layerId,ruleAssetGroupCodeForSource:(h=e.toAssetGroup)==null?void 0:h.assetGroupCode,ruleAssetTypeCodeForSource:(y=e.toAssetType)==null?void 0:y.assetTypeCode,ruleLayerIdForTarget:(g=e.fromNetworkSource)==null?void 0:g.layerId,ruleAssetGroupCodeForTarget:(m=e.fromAssetGroup)==null?void 0:m.assetGroupCode,ruleAssetTypeCodeForTarget:(l=e.fromAssetType)==null?void 0:l.assetTypeCode}];case"connectivity":case"junction-junction-connectivity":return[{ruleLayerIdForSource:(I=e.fromNetworkSource)==null?void 0:I.layerId,ruleAssetGroupCodeForSource:(T=e.fromAssetGroup)==null?void 0:T.assetGroupCode,ruleAssetTypeCodeForSource:(C=e.fromAssetType)==null?void 0:C.assetTypeCode,ruleLayerIdForTarget:(H=e.toNetworkSource)==null?void 0:H.layerId,ruleAssetGroupCodeForTarget:(D=e.toAssetGroup)==null?void 0:D.assetGroupCode,ruleAssetTypeCodeForTarget:(_=e.toAssetType)==null?void 0:_.assetTypeCode},{ruleLayerIdForSource:(b=e.toNetworkSource)==null?void 0:b.layerId,ruleAssetGroupCodeForSource:(A=e.toAssetGroup)==null?void 0:A.assetGroupCode,ruleAssetTypeCodeForSource:(R=e.toAssetType)==null?void 0:R.assetTypeCode,ruleLayerIdForTarget:(E=e.fromNetworkSource)==null?void 0:E.layerId,ruleAssetGroupCodeForTarget:(j=e.fromAssetGroup)==null?void 0:j.assetGroupCode,ruleAssetTypeCodeForTarget:(F=e.fromAssetType)==null?void 0:F.assetTypeCode}];case"junction-edge-from-connectivity":case"junction-edge-midspan-connectivity":case"junction-edge-to-connectivity":return e.ruleType===L.RTEdgeJunctionEdgeConnectivity?[{ruleLayerIdForSource:($=e.fromNetworkSource)==null?void 0:$.layerId,ruleAssetGroupCodeForSource:(v=e.fromAssetGroup)==null?void 0:v.assetGroupCode,ruleAssetTypeCodeForSource:(U=e.fromAssetType)==null?void 0:U.assetTypeCode,ruleLayerIdForTarget:(W=e.viaNetworkSource)==null?void 0:W.layerId,ruleAssetGroupCodeForTarget:(Y=e.viaAssetGroup)==null?void 0:Y.assetGroupCode,ruleAssetTypeCodeForTarget:(S=e.viaAssetType)==null?void 0:S.assetTypeCode},{ruleLayerIdForSource:(B=e.viaNetworkSource)==null?void 0:B.layerId,ruleAssetGroupCodeForSource:(Q=e.viaAssetGroup)==null?void 0:Q.assetGroupCode,ruleAssetTypeCodeForSource:(ae=e.viaAssetType)==null?void 0:ae.assetTypeCode,ruleLayerIdForTarget:(ie=e.fromNetworkSource)==null?void 0:ie.layerId,ruleAssetGroupCodeForTarget:(ne=e.fromAssetGroup)==null?void 0:ne.assetGroupCode,ruleAssetTypeCodeForTarget:(le=e.fromAssetType)==null?void 0:le.assetTypeCode},{ruleLayerIdForSource:(ue=e.toNetworkSource)==null?void 0:ue.layerId,ruleAssetGroupCodeForSource:(de=e.toAssetGroup)==null?void 0:de.assetGroupCode,ruleAssetTypeCodeForSource:(ce=e.toAssetType)==null?void 0:ce.assetTypeCode,ruleLayerIdForTarget:(pe=e.viaNetworkSource)==null?void 0:pe.layerId,ruleAssetGroupCodeForTarget:(ye=e.viaAssetGroup)==null?void 0:ye.assetGroupCode,ruleAssetTypeCodeForTarget:(me=e.viaAssetType)==null?void 0:me.assetTypeCode},{ruleLayerIdForSource:(he=e.viaNetworkSource)==null?void 0:he.layerId,ruleAssetGroupCodeForSource:(fe=e.viaAssetGroup)==null?void 0:fe.assetGroupCode,ruleAssetTypeCodeForSource:(ge=e.viaAssetType)==null?void 0:ge.assetTypeCode,ruleLayerIdForTarget:(Te=e.toNetworkSource)==null?void 0:Te.layerId,ruleAssetGroupCodeForTarget:(Ie=e.toAssetGroup)==null?void 0:Ie.assetGroupCode,ruleAssetTypeCodeForTarget:(we=e.toAssetType)==null?void 0:we.assetTypeCode}]:[{ruleLayerIdForSource:(ve=e.fromNetworkSource)==null?void 0:ve.layerId,ruleAssetGroupCodeForSource:(Se=e.fromAssetGroup)==null?void 0:Se.assetGroupCode,ruleAssetTypeCodeForSource:(be=e.fromAssetType)==null?void 0:be.assetTypeCode,ruleLayerIdForTarget:(Ae=e.toNetworkSource)==null?void 0:Ae.layerId,ruleAssetGroupCodeForTarget:(Ce=e.toAssetGroup)==null?void 0:Ce.assetGroupCode,ruleAssetTypeCodeForTarget:(_e=e.toAssetType)==null?void 0:_e.assetTypeCode},{ruleLayerIdForSource:(Ne=e.toNetworkSource)==null?void 0:Ne.layerId,ruleAssetGroupCodeForSource:(Fe=e.toAssetGroup)==null?void 0:Fe.assetGroupCode,ruleAssetTypeCodeForSource:(ke=e.toAssetType)==null?void 0:ke.assetTypeCode,ruleLayerIdForTarget:(Ee=e.fromNetworkSource)==null?void 0:Ee.layerId,ruleAssetGroupCodeForTarget:(Ge=e.fromAssetGroup)==null?void 0:Ge.assetGroupCode,ruleAssetTypeCodeForTarget:(Le=e.fromAssetType)==null?void 0:Le.assetTypeCode}];default:return[]}}_getWhereClauseForCompatibleFeatures(e,t,o){const s=new Map,[u,a]=this._getAssetFieldNames(e.sourceLayer),[p,i]=this._getFeatureAssetCodes(e),c=this._getFeatureSourceLayerId(e),f=X(t)?t.parent:t,h=X(t)?t.subtypeCode:null;o.forEach(g=>{const{type:m,direction:l}=g;this._getRulesForAssociationType(m).forEach(I=>{this._getRuleFieldValuesForAssociation(I,m,l).forEach(T=>{if(T.ruleAssetGroupCodeForTarget!=null&&T.ruleAssetTypeCodeForTarget!=null&&c===(T==null?void 0:T.ruleLayerIdForSource)&&p===(T==null?void 0:T.ruleAssetGroupCodeForSource)&&i===(T==null?void 0:T.ruleAssetTypeCodeForSource)&&f.layerId===(T==null?void 0:T.ruleLayerIdForTarget)&&(h==null||h===(T==null?void 0:T.ruleAssetGroupCodeForTarget))){const C=s.get(T.ruleAssetGroupCodeForTarget)??new Set;C.add(T.ruleAssetTypeCodeForTarget),s.set(T.ruleAssetGroupCodeForTarget,C)}})})});let y=[];return this._mergeAssetCodes(s).forEach((g,m)=>y.push(`${u} IN (${m}) AND ${a} IN (${Array.from(g).sort().join(", ")})`)),y.length>1&&(y=y.map(g=>`(${g})`)),y.join(" OR ")}_getRulesForAssociationType(e){const{rulesCategorized:t}=this;switch(e){case"attachment":return t.attachment;case"containment":return t.containment;case"connectivity":case"junction-junction-connectivity":return t.connectivity.filter(o=>o.ruleType===L.RTJunctionJunctionConnectivity);case"junction-edge-from-connectivity":case"junction-edge-midspan-connectivity":case"junction-edge-to-connectivity":return t.connectivity.filter(o=>o.ruleType===L.RTJunctionEdgeConnectivity||o.ruleType===L.RTEdgeJunctionEdgeConnectivity);default:return[]}}_getFeatureSourceLayerId(e){var s;const{sourceLayer:t}=e;let o;return lt(t)?o=t.layerId:X(t)&&(o=(s=t.parent)==null?void 0:s.layerId),o??null}_getAssetFieldNames(e){return!e||!("fieldsIndex"in e)?[null,null]:[e.fieldsIndex.normalizeFieldName("assetGroup")??null,e.fieldsIndex.normalizeFieldName("assetType")??null]}_getFeatureAssetCodes(e){const[t,o]=this._getAssetFieldNames(e.sourceLayer);return[t?e.attributes[t]:null,o?e.attributes[o]:null]}_areSetsEqual(e,t){if(e.size!==t.size)return!1;for(const o of e)if(!t.has(o))return!1;return!0}_mergeAssetCodes(e){const t=new Map,o=new Set;for(const[s,u]of e){const a=new Set([s]);for(const[i,c]of e)s!==i&&!o.has(i)&&this._areSetsEqual(u,c)&&(a.add(i),o.add(i));const p=Array.from(a).sort().join(", ");t.set(p,u)}return t}};n([d({constructOnly:!0})],x.prototype,"rulesLayer",void 0),n([d({constructOnly:!0})],x.prototype,"rules",void 0),n([d({readOnly:!0})],x.prototype,"rulesHash",void 0),n([d()],x.prototype,"rulesCategorized",void 0),n([d({constructOnly:!0})],x.prototype,"request",void 0),x=n([O("esri.networks.RulesTable")],x);const wt=x;let k=class extends rt{constructor(e){super(e),this.globalId=null,this.title=null,this.traceConfiguration=null,this.creationDate=null,this.creator=null,this.description=null,this.minStartingPoints=null,this.resultTypes=[],this.tags=[],this.traceType=null}readTraceConfiguration(e,t){return e.tierName!==void 0?ct.fromJSON(e):Ye.fromJSON(e)}};n([d({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"id"},write:{target:"id",isRequired:!0}},service:{read:{source:"globalId"},write:{target:"globalId",isRequired:!0}}},read:!1}})],k.prototype,"globalId",void 0),n([d({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"title"},write:{target:"title",isRequired:!0}},service:{read:{source:"name"},write:{target:"name",isRequired:!0}}},read:!1}})],k.prototype,"title",void 0),n([d({type:Ye,json:{origins:{service:{read:!0,write:!0}},read:!1}})],k.prototype,"traceConfiguration",void 0),n([dt("service","traceConfiguration")],k.prototype,"readTraceConfiguration",null),n([d({type:Date,json:{origins:{service:{read:!0,write:!0}},read:!1}})],k.prototype,"creationDate",void 0),n([d({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],k.prototype,"creator",void 0),n([d({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],k.prototype,"description",void 0),n([d({type:["none","one","many"],json:{origins:{service:{read:{source:"minNumStartingPoints"},write:{target:"minNumStartingPoints"}}},read:!1}})],k.prototype,"minStartingPoints",void 0),n([d({json:{origins:{service:{read:!0,write:!0}},read:!1}})],k.prototype,"resultTypes",void 0),n([d({type:[String],json:{origins:{service:{read:!0,write:!0}},read:!1}})],k.prototype,"tags",void 0),n([d({type:Z.apiValues,json:{type:Z.jsonValues,origins:{service:{read:Z.read,write:Z.write}},read:!1}})],k.prototype,"traceType",void 0),k=n([O("esri.networks.support.NamedTraceConfiguration")],k);const vt=k;let G=class extends Xe{constructor(r){super(r),this.rulesTableId=null,this.rulesTableUrl=null,this.subnetworksTableId=null,this.subnetworksTableUrl=null,this.dirtyAreasLayerId=null,this.dirtyAreasLayerUrl=null,this.associationsTable=null,this.associationsTableId=null,this.associationsTableUrl=null}destroy(){var r;(r=this.associationsTable)==null||r.destroy()}async loadAssociationsTable(){if(!this.associationsTable){const{associationsTableUrl:r}=this;if(!r)throw new re("utility-network-system-layers:missing-associations-table-url","Unable to load the associations table, as the `associationsTableUrl` is not set.");this.associationsTable=new Me({url:r})}return await this.associationsTable.load(),this.associationsTable}};n([d({constructOnly:!0})],G.prototype,"rulesTableId",void 0),n([d({constructOnly:!0})],G.prototype,"rulesTableUrl",void 0),n([d({constructOnly:!0})],G.prototype,"subnetworksTableId",void 0),n([d({constructOnly:!0})],G.prototype,"subnetworksTableUrl",void 0),n([d({constructOnly:!0})],G.prototype,"dirtyAreasLayerId",void 0),n([d({constructOnly:!0})],G.prototype,"dirtyAreasLayerUrl",void 0),n([d()],G.prototype,"associationsTable",void 0),n([d({constructOnly:!0})],G.prototype,"associationsTableId",void 0),n([d({constructOnly:!0})],G.prototype,"associationsTableUrl",void 0),G=n([O("esri.networks.support.NetworkSystemLayers")],G);const St=G;let K=class extends oe{constructor(r){super(r),this.id=null,this.name=null}};n([d({type:Number,json:{read:{source:"terminalId"},write:{target:"terminalId"}}})],K.prototype,"id",void 0),n([d({type:String,json:{read:{source:"terminalName"},write:{target:"terminalName"}}})],K.prototype,"name",void 0),n([d({type:Boolean,json:{write:!0}})],K.prototype,"isUpstreamTerminal",void 0),K=n([O("esri.networks.support.Terminal")],K);const bt=K,te=new et({esriUNTMBidirectional:"bidirectional",esriUNTMDirectional:"directional"});let M=class extends oe{constructor(e){super(e),this.defaultConfiguration=null,this.id=null,this.name=null,this.terminals=[],this.traversabilityModel=null}};n([d({type:String,json:{write:!0}})],M.prototype,"defaultConfiguration",void 0),n([d({type:Number,json:{read:{source:"terminalConfigurationId"},write:{target:"terminalConfigurationId"}}})],M.prototype,"id",void 0),n([d({type:String,json:{read:{source:"terminalConfigurationName"},write:{target:"terminalConfigurationName"}}})],M.prototype,"name",void 0),n([d({type:[bt],json:{write:!0}})],M.prototype,"terminals",void 0),n([d({type:te.apiValues,json:{type:te.jsonValues,read:te.read,write:te.write}})],M.prototype,"traversabilityModel",void 0),M=n([O("esri.networks.support.TerminalConfiguration")],M);const De=M,At=ze()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let z=class extends yt{constructor(r){super(r),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(r){const e={...r,query:{f:"json"}},{data:t}=await q(this.statusUrl,e),o=t.traceResults?{...t.traceResults,...t}:t;return this.read(o),this}async waitForJobCompletion(r={}){const{interval:e=1e3,statusCallback:t}=r;return new Promise((o,s)=>{this._clearTimer();const u=setInterval(()=>{this._timer||s(Je()),this.checkJobStatus().then(a=>{const{status:p}=a;switch(this.status=p,p){case"job-succeeded":this._clearTimer(),o(this);break;case"job-waiting":case"job-executing":t&&t(this)}},a=>{this._clearTimer(),s(a)})},e);this._timer=u})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};n([d({type:String,json:{write:!0}})],z.prototype,"statusUrl",void 0),n([We(At)],z.prototype,"status",void 0),n([d({type:Date,json:{type:Number,write:{writer:(r,e)=>{e.submissionTime=r?r.getTime():null}}}})],z.prototype,"submissionTime",void 0),n([d({type:Date,json:{type:Number,write:{writer:(r,e)=>{e.lastUpdatedTime=r?r.getTime():null}}}})],z.prototype,"lastUpdatedTime",void 0),z=n([O("esri.networks.support.TraceJobInfo")],z);const Ct=z;let P=class extends It{constructor(r){super(r),this.sharedNamedTraceConfigurations=[],this.type="utility",this._terminalById=new Map}get serviceTerritoryFeatureLayerId(){var r;return((r=this.dataElement)==null?void 0:r.serviceTerritoryFeatureLayerId)??null}get networkSystemLayers(){var r,e,t,o,s,u,a,p;return new St({rulesTableId:(r=this.sourceJSON)==null?void 0:r.systemLayers.rulesTableId,rulesTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${(e=this.sourceJSON)==null?void 0:e.systemLayers.rulesTableId}`:null,subnetworksTableId:(t=this.sourceJSON)==null?void 0:t.systemLayers.subnetworksTableId,subnetworksTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${(o=this.sourceJSON)==null?void 0:o.systemLayers.subnetworksTableId}`:null,dirtyAreasLayerId:(s=this.sourceJSON)==null?void 0:s.systemLayers.dirtyAreasLayerId,dirtyAreasLayerUrl:this.sourceJSON?`${this.featureServiceUrl}/${(u=this.sourceJSON)==null?void 0:u.systemLayers.dirtyAreasLayerId}`:null,associationsTableId:(a=this.sourceJSON)==null?void 0:a.systemLayers.associationsTableId,associationsTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${(p=this.sourceJSON)==null?void 0:p.systemLayers.associationsTableId}`:null})}get terminalConfigurations(){var r;return((r=this.dataElement)==null?void 0:r.terminalConfigurations.map(e=>De.fromJSON(e)))||[]}get domainNetworkNames(){var r;return((r=this.dataElement)==null?void 0:r.domainNetworks.map(e=>e.domainNetworkName))||[]}get _utilityLayerList(){var e,t;const r=new Set;return(t=(e=this.dataElement)==null?void 0:e.domainNetworks)==null||t.map(o=>{var s,u;(s=o==null?void 0:o.edgeSources)==null||s.map(({layerId:a,sourceId:p})=>{this._layerIdBySourceId.set(p,a),this._sourceIdByLayerId.set(a,p),r.add(a)}),(u=o==null?void 0:o.junctionSources)==null||u.map(({layerId:a,sourceId:p})=>{this._layerIdBySourceId.set(p,a),this._sourceIdByLayerId.set(a,p),r.add(a)})}),r}async load(r){return this.addResolvingPromise(super.load(r)),this.addResolvingPromise(this._loadNamedTraceConfigurationsFromNetwork(r)),this}getTerminalConfiguration(r){var i,c,f,h;let e=null,t=null;const o=r.layer;let s=null;if((o==null?void 0:o.type)==="feature"){if(s=o.layerId,s===null)return null}else if((o==null?void 0:o.type)!=="subtype-sublayer"||(s=((i=o==null?void 0:o.parent)==null?void 0:i.layerId)??null,s===null))return null;const u=r.attributes;if(u==null)return null;for(const y of Object.keys(u))y.toUpperCase()==="ASSETGROUP"&&(e=r.getAttribute(y)),y.toUpperCase()==="ASSETTYPE"&&(t=r.getAttribute(y));if(!this.dataElement)return null;let a=null;const p=this.dataElement.domainNetworks;for(const y of p){const g=(c=y.junctionSources)==null?void 0:c.find(m=>m.layerId===s);if(g){const m=(f=g.assetGroups)==null?void 0:f.find(l=>l.assetGroupCode===e);if(m){const l=(h=m.assetTypes)==null?void 0:h.find(I=>I.assetTypeCode===t);if(l!=null&&l.isTerminalConfigurationSupported){a=l.terminalConfigurationId;break}}}}if(a!=null){const y=this.dataElement.terminalConfigurations,g=y==null?void 0:y.find(m=>m.terminalConfigurationId===a);return g?De.fromJSON(g):null}return null}getTierNames(r){var t;const e=(t=this.dataElement)==null?void 0:t.domainNetworks.find(o=>o.domainNetworkName===r);return(e==null?void 0:e.tiers.map(o=>o.name))||[]}async getRulesTable(){return this._sharedRulesTable||(this._sharedRulesTable=this._createRulesTable()),await this._sharedRulesTable}getTerminalById(r){if(!this.dataElement||r==null)return null;const e=this._terminalById.get(r);return e??(this.terminalConfigurations.forEach(t=>{t.terminals.forEach(o=>{this._terminalById.set(o.id,o)})}),this._terminalById.get(r))}isUtilityLayer(r){var e,t;return"layerId"in r?this._utilityLayerList.has(r==null?void 0:r.layerId)&&(((e=r.url)==null?void 0:e.startsWith(this.featureServiceUrl))??!1):!(r.type!=="subtype-sublayer"||!r.parent)&&this._utilityLayerList.has(r.parent.layerId)&&(((t=r.parent.url)==null?void 0:t.startsWith(this.featureServiceUrl))??!1)}async queryAssociations(r,e){const[{queryAssociations:t},{default:o}]=await Promise.all([N(()=>import("./queryAssociations-B1XZHjJl.js"),__vite__mapDeps([146,1,2,3,4,5,138,6,147,12,24,23,15,19,142]),import.meta.url),N(()=>import("./QueryAssociationsParameters-BnG4WCS9.js"),__vite__mapDeps([148,2,5,138,1,3,4,142]),import.meta.url)]),s=o.from(r);return s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment,(await t(this.networkServiceUrl,s,e)).associations}async synthesizeAssociationGeometries(r){const[{synthesizeAssociationGeometries:e},{default:t}]=await Promise.all([N(()=>import("./synthesizeAssociationGeometries--DGsSh6f.js"),__vite__mapDeps([149,1,2,3,4,5,6,147,12,24,23,15,19,138,142]),import.meta.url),N(()=>import("./SynthesizeAssociationGeometriesParameters-CSFuSWPA.js"),__vite__mapDeps([150,2,5,12,23,15,1,3,4]),import.meta.url)]),o=t.from(r);return o.gdbVersion=this.gdbVersion,o.moment=this.historicMoment,e(this.networkServiceUrl,o)}async trace(r){const[{trace:e},{default:t}]=await Promise.all([N(()=>import("./trace-t_n0Hp0d.js"),__vite__mapDeps([151,1,2,3,4,5,6,141,24,12,23,15,19,142]),import.meta.url),N(()=>import("./TraceParameters-BQjpnyaH.js").then(s=>s.T),__vite__mapDeps([152,2,5,12,15,1,3,4,138,139]),import.meta.url)]),o=t.from(r);return o.gdbVersion=this.gdbVersion,o.moment=this.historicMoment,e(this.networkServiceUrl,o)}async submitTraceJob(r){const[{submitTraceJob:e},{default:t}]=await Promise.all([N(()=>import("./trace-t_n0Hp0d.js"),__vite__mapDeps([151,1,2,3,4,5,6,141,24,12,23,15,19,142]),import.meta.url),N(()=>import("./TraceParameters-BQjpnyaH.js").then(u=>u.T),__vite__mapDeps([152,2,5,12,15,1,3,4,138,139]),import.meta.url)]),o=t.from(r);o.gdbVersion=this.gdbVersion,o.moment=this.historicMoment;const s=await e(this.networkServiceUrl,o);return new Ct({statusUrl:s})}async canAddAssociation(r){const e=await this.getRulesTable();if(!e)return!1;await e.load();const t=(i,c)=>i?i.terminalId===1?!(c!=null&&c.terminalId)||(c==null?void 0:c.terminalId)===i.terminalId:i.terminalId===(c==null?void 0:c.terminalId):!(c!=null&&c.terminalId),o=i=>({fromRuleElement:{networkSource:i.fromNetworkSource,assetGroup:i.fromAssetGroup,assetType:i.fromAssetType,terminal:i.fromTerminal},viaRuleElement:i.viaNetworkSource?{networkSource:i.viaNetworkSource,assetGroup:i.viaAssetGroup,assetType:i.viaAssetType,terminal:i.viaTerminal}:void 0,toRuleElement:{networkSource:i.toNetworkSource,assetGroup:i.toAssetGroup,assetType:i.toAssetType,terminal:i.toTerminal}}),s=(i,c,f=!0)=>{var h,y,g;return((h=i.networkSource)==null?void 0:h.sourceId)===c.networkSourceId&&((y=i.assetGroup)==null?void 0:y.assetGroupCode)===c.assetGroupCode&&((g=i.assetType)==null?void 0:g.assetTypeCode)===c.assetTypeCode&&(!f||t(i.terminal,c))},u=(i,c)=>{const{fromRuleElement:f,toRuleElement:h}=o(i);return s(f,c.fromNetworkElement,!1)&&s(h,c.toNetworkElement,!1)},a=(i,c)=>{const{fromRuleElement:f,toRuleElement:h}=o(i);return s(f,c.fromNetworkElement)&&s(h,c.toNetworkElement)||s(f,c.toNetworkElement)&&s(h,c.fromNetworkElement)},p=(i,c)=>{const{fromRuleElement:f,toRuleElement:h,viaRuleElement:y}=o(i);return s(f,c.fromNetworkElement)&&s(y,c.toNetworkElement)||s(f,c.toNetworkElement)&&s(y,c.fromNetworkElement)||s(y,c.fromNetworkElement)&&s(h,c.toNetworkElement)||s(y,c.toNetworkElement)&&s(h,c.fromNetworkElement)};return r.associationType==="containment"?e.rulesCategorized.containment.some(i=>u(i,r)):r.associationType==="attachment"?e.rulesCategorized.attachment.some(i=>u(i,r)):e.rulesCategorized.connectivity.some(i=>i.ruleType===L.RTEdgeJunctionEdgeConnectivity?p(i,r):a(i,r))}generateAddAssociations(r){const{associationsTable:e}=this.networkSystemLayers,{fromNetworkSourceId:t,fromGlobalId:o,fromTerminalId:s,toNetworkSourceId:u,toGlobalId:a,toTerminalId:p,associationType:i,isContentVisible:c,percentAlong:f,globalId:h}=pt(e);return{addFeatures:r.map(y=>{var g,m,l,I,T,C;return new xe({attributes:{[t]:(g=y.fromNetworkElement)==null?void 0:g.networkSourceId,[o]:(m=y.fromNetworkElement)==null?void 0:m.globalId,[s]:(l=y.fromNetworkElement)==null?void 0:l.terminalId,[u]:(I=y.toNetworkElement)==null?void 0:I.networkSourceId,[a]:(T=y.toNetworkElement)==null?void 0:T.globalId,[p]:(C=y.toNetworkElement)==null?void 0:C.terminalId,[i]:ut[y.associationType],[c]:y.isContentVisible==null?void 0:y.isContentVisible?1:0,[f]:y.percentAlong,[h]:y.globalId}})}),id:this.networkSystemLayers.associationsTableId,identifierFields:{globalIdField:(e==null?void 0:e.globalIdField)??"globalid",objectIdField:(e==null?void 0:e.objectIdField)??"objectid"}}}generateDeleteAssociations(r){const{associationsTable:e,associationsTableId:t}=this.networkSystemLayers;return{deleteFeatures:r.map(o=>({globalId:o.globalId})),id:t,identifierFields:{globalIdField:(e==null?void 0:e.globalIdField)??"globalid",objectIdField:(e==null?void 0:e.objectIdField)??"objectid"}}}async loadAssociationsTable(){return this.networkSystemLayers.loadAssociationsTable()}async _loadNamedTraceConfigurationsFromNetwork(r){var o;if(((o=this.sharedNamedTraceConfigurations)==null?void 0:o.length)===0)return;const e=this.sharedNamedTraceConfigurations.map(s=>s.globalId),t=await this.queryNamedTraceConfigurations({globalIds:e},r);for(const s of this.sharedNamedTraceConfigurations){const u=t==null?void 0:t.find(a=>a.globalId===s.globalId);if(u){const a=u.write({},{origin:"service"});s.read(a,{origin:"service"})}}}async _createRulesTable(){var u;const r=this.networkSystemLayers.rulesTableUrl,e=new Me({url:r});await e.load();const t=(u=this.dataElement)==null?void 0:u.domainNetworks;if(!t)return null;const o=t.flatMap(a=>[...a.edgeSources||[],...a.junctionSources||[]]),s=(await _t(e)).map(a=>this._hydrateRuleInfo(e,o,a));return new wt({rulesLayer:e,rules:s})}_hydrateRuleInfo(r,e,t){const o=r.fieldsIndex,s=o.get("RULETYPE"),u=o.get("CREATIONDATE"),a=o.get("FROMNETWORKSOURCEID"),p=o.get("FROMASSETGROUP"),i=o.get("FROMASSETTYPE"),c=o.get("FROMTERMINALID"),f=o.get("TONETWORKSOURCEID"),h=o.get("TOASSETGROUP"),y=o.get("TOASSETTYPE"),g=o.get("TOTERMINALID"),m=o.get("VIANETWORKSOURCEID"),l=o.get("VIAASSETGROUP"),I=o.get("VIAASSETTYPE"),T=o.get("VIATERMINALID"),C=t.attributes[s.name],H=new Date(t.attributes[u.name]),D=[{networkSourceId:t.attributes[a.name],assetGroupId:t.attributes[p.name],assetTypeId:t.attributes[i.name],terminalId:t.attributes[c.name]},{networkSourceId:t.attributes[f.name],assetGroupId:t.attributes[h.name],assetTypeId:t.attributes[y.name],terminalId:t.attributes[g.name]},{networkSourceId:t.attributes[m.name],assetGroupId:t.attributes[l.name],assetTypeId:t.attributes[I.name],terminalId:t.attributes[T.name]}];let _;(function(A){A[A.from=0]="from",A[A.to=1]="to",A[A.via=2]="via"})(_||(_={}));const b={ruleType:C,creationDate:H};for(const A of[_.from,_.to,_.via]){if(C!==L.RTEdgeJunctionEdgeConnectivity&&A===_.via)continue;const R=D[A],E=e.find(U=>U.sourceId===R.networkSourceId),j=E==null?void 0:E.assetGroups.find(U=>U.assetGroupCode===R.assetGroupId),F=j==null?void 0:j.assetTypes.find(U=>U.assetTypeCode===R.assetTypeId),$=this._getTerminal(F,R);let v="";switch(A){case _.from:v="from";break;case _.to:v="to";break;case _.via:v="via"}b[`${v}NetworkSource`]=E,b[`${v}AssetGroup`]=j,b[`${v}AssetType`]=F,b[`${v}Terminal`]=$==null?void 0:$.toJSON()}return b}_getTerminal(r,e){var s,u;const t=r==null?void 0:r.terminalConfigurationId,o=(s=this.terminalConfigurations)==null?void 0:s.find(a=>a.id===t);return((u=o==null?void 0:o.terminals)==null?void 0:u.find(a=>a.id===e.terminalId))??null}};async function _t(r){const e=new mt({where:"1=1",outFields:["*"]});return(await Be(r,e)).features}n([d({type:[vt],json:{origins:{"web-map":{read:{source:"traceConfigurations"},write:{target:"traceConfigurations"}},service:{read:{source:"traceConfigurations"}}},read:!1}})],P.prototype,"sharedNamedTraceConfigurations",void 0),n([d({type:["utility"],readOnly:!0,json:{read:!1,write:!1}})],P.prototype,"type",void 0),n([d({readOnly:!0})],P.prototype,"serviceTerritoryFeatureLayerId",null),n([d({readOnly:!0})],P.prototype,"networkSystemLayers",null),n([d({readOnly:!0})],P.prototype,"terminalConfigurations",null),n([d({readOnly:!0})],P.prototype,"domainNetworkNames",null),P=n([O("esri.networks.UtilityNetwork")],P);const Nt=P,Ft=Object.freeze(Object.defineProperty({__proto__:null,default:Nt},Symbol.toStringTag,{value:"Module"}));export{vt as d,Nt as h,ht as i,er as n};
