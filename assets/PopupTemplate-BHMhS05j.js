import{r as e}from"./tslib.es6-B3Jf3DVX.js";import{i as K}from"./Clonable-D3rtuBWg.js";import{V as M}from"./Collection-CEdjem1-.js";import{f as c}from"./assets-C43MgM-v.js";import{m as i,a as p,g as x,x as O,a1 as Lt,n as Ut}from"./subclass-BZA_h8Db.js";import{b as Pt,S as Wt}from"./Accessor-BLX9ikPh.js";import{s as Vt}from"./cast-Bjksrh93.js";import{r as T,o as Ot}from"./writer-DNAwXnhG.js";import{u as Dt,C as zt,a5 as qt}from"./fieldUtils-tmQlKvWo.js";import{n as Gt,i as Kt}from"./jsonMap-0cxwUWs2.js";import{r as Nt}from"./enumeration-Ba5njXdz.js";import{Y as Ht}from"./date-DlqISzcw.js";import{l as Xt}from"./Color-BCS62Hs5.js";import{p as Yt,c as Qt,a as Zt}from"./ActionToggle-iT4slXc7.js";let H=class extends c{constructor(o){super(o),this.type=null}};e([i({type:["attachments","custom","fields","media","text","expression","relationship","utility-network-associations"],readOnly:!0,json:{read:!1,write:!0}})],H.prototype,"type",void 0),H=e([p("esri.popup.content.Content")],H);const I=H;var st;let $=st=class extends I{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new st({description:this.description,displayType:this.displayType,title:this.title})}};e([i({type:String,json:{write:!0}})],$.prototype,"description",void 0),e([i({type:["auto","preview","list"],json:{write:!0}})],$.prototype,"displayType",void 0),e([i({type:String,json:{write:!0}})],$.prototype,"title",void 0),e([i({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],$.prototype,"type",void 0),$=st=e([p("esri.popup.content.AttachmentsContent")],$);const V=$;var rt;let j=rt=class extends I{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new rt({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?x(this.outFields):null})}};e([i()],j.prototype,"creator",void 0),e([i()],j.prototype,"destroyer",void 0),e([i()],j.prototype,"outFields",void 0),e([i({type:["custom"],readOnly:!0})],j.prototype,"type",void 0),j=rt=e([p("esri.popup.content.CustomContent")],j);const te=j;var nt;let C=nt=class extends c{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new nt({title:this.title,expression:this.expression})}};e([i({type:String,json:{write:!0}})],C.prototype,"title",void 0),e([i({type:String,json:{write:!0}})],C.prototype,"expression",void 0),e([i({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],C.prototype,"returnType",void 0),C=nt=e([p("esri.popup.ElementExpressionInfo")],C);const ee=C;var pt;let B=pt=class extends I{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new pt({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};e([i({type:ee,json:{write:!0}})],B.prototype,"expressionInfo",void 0),e([i({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],B.prototype,"type",void 0),B=pt=e([p("esri.popup.content.ExpressionContent")],B);const tt=B;let R=class extends K(c){constructor(o){super(o),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};e([Nt(Ht)],R.prototype,"dateFormat",void 0),e([i({type:Boolean,json:{write:!0}})],R.prototype,"digitSeparator",void 0),e([i({type:O,json:{write:!0}})],R.prototype,"places",void 0),R=e([p("esri.popup.support.FieldInfoFormat")],R);const oe=R;var lt;let y=lt=class extends c{constructor(t){super(t),this.fieldName=null,this.format=void 0,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){var t;return new lt({fieldName:this.fieldName,format:(t=this.format)==null?void 0:t.clone(),isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};e([i({type:String,json:{write:!0}})],y.prototype,"fieldName",void 0),e([i({type:oe,json:{write:!0}})],y.prototype,"format",void 0),e([i({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],y.prototype,"isEditable",void 0),e([i({type:String,json:{write:!0}})],y.prototype,"label",void 0),e([Nt(new Gt({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],y.prototype,"stringFieldOption",void 0),e([i({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],y.prototype,"statisticType",void 0),e([i({type:String,json:{write:!0}})],y.prototype,"tooltip",void 0),e([i({type:Boolean,json:{write:!0}})],y.prototype,"visible",void 0),y=lt=e([p("esri.popup.FieldInfo")],y);const Ct=y;var at;let v=at=class extends I{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,o){o.fieldInfos=t&&t.map(r=>r.toJSON())}clone(){return new at(x({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};e([i({type:Object,json:{write:!0}})],v.prototype,"attributes",void 0),e([i({type:String,json:{write:!0}})],v.prototype,"description",void 0),e([i({type:[Ct]})],v.prototype,"fieldInfos",void 0),e([T("fieldInfos")],v.prototype,"writeFieldInfos",null),e([i({type:String,json:{write:!0}})],v.prototype,"title",void 0),e([i({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],v.prototype,"type",void 0),v=at=e([p("esri.popup.content.FieldsContent")],v);const D=v;let N=class extends c{constructor(o){super(o),this.altText=null,this.caption="",this.title="",this.type=null}};e([i({type:String,json:{write:!0}})],N.prototype,"altText",void 0),e([i({type:String,json:{write:!0}})],N.prototype,"caption",void 0),e([i({type:String,json:{write:!0}})],N.prototype,"title",void 0),e([i({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],N.prototype,"type",void 0),N=e([p("esri.popup.content.mixins.MediaInfo")],N);const bt=N;var dt;let b=dt=class extends Pt{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){var t;return new dt({color:(t=this.color)==null?void 0:t.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};e([i()],b.prototype,"color",void 0),e([i()],b.prototype,"fieldName",void 0),e([i()],b.prototype,"tooltip",void 0),e([i()],b.prototype,"value",void 0),b=dt=e([p("esri.popup.content.support.ChartMediaInfoValueSeries")],b);const ie=b;var ct;let g=ct=class extends c{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new ct({colors:x(this.colors),fields:x(this.fields),normalizeField:this.normalizeField,series:x(this.series),tooltipField:this.tooltipField})}};e([i({type:[Xt],json:{type:[[O]],write:!0}})],g.prototype,"colors",void 0),e([i({type:[String],json:{write:!0}})],g.prototype,"fields",void 0),e([i({type:String,json:{write:!0}})],g.prototype,"normalizeField",void 0),e([i({type:[ie],json:{read:!1}})],g.prototype,"series",void 0),e([i({type:String,json:{write:!0}})],g.prototype,"tooltipField",void 0),g=ct=e([p("esri.popup.content.support.ChartMediaInfoValue")],g);const se=g;let k=class extends bt{constructor(o){super(o),this.type=null,this.value=void 0}};e([i({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],k.prototype,"type",void 0),e([i({type:se,json:{write:!0}})],k.prototype,"value",void 0),k=e([p("esri.popup.content.mixins.ChartMediaInfo")],k);const et=k,ot=Kt()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var yt;let X=yt=class extends et{constructor(t){super(t),this.type="bar-chart"}clone(){var t;return new yt({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};e([i({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:ot.write}})],X.prototype,"type",void 0),X=yt=e([p("esri.popup.content.BarChartMediaInfo")],X);const Rt=X;var ut;let Y=ut=class extends et{constructor(t){super(t),this.type="column-chart"}clone(){var t;return new ut({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};e([i({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:ot.write}})],Y.prototype,"type",void 0),Y=ut=e([p("esri.popup.content.ColumnChartMediaInfo")],Y);const At=Y;var ht;let J=ht=class extends c{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new ht({linkURL:this.linkURL,sourceURL:this.sourceURL})}};e([i({type:String,json:{write:!0}})],J.prototype,"linkURL",void 0),e([i({type:String,json:{write:!0}})],J.prototype,"sourceURL",void 0),J=ht=e([p("esri.popup.content.support.ImageMediaInfoValue")],J);const re=J;var ft;let A=ft=class extends bt{constructor(t){super(t),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){var t;return new ft({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:(t=this.value)==null?void 0:t.clone()})}};e([i({type:Number,json:{write:!0}})],A.prototype,"refreshInterval",void 0),e([i({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],A.prototype,"type",void 0),e([i({type:re,json:{write:!0}})],A.prototype,"value",void 0),A=ft=e([p("esri.popup.content.ImageMediaInfo")],A);const Et=A;var mt;let Q=mt=class extends et{constructor(t){super(t),this.type="line-chart"}clone(){var t;return new mt({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};e([i({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:ot.write}})],Q.prototype,"type",void 0),Q=mt=e([p("esri.popup.content.LineChartMediaInfo")],Q);const Mt=Q;var wt;let Z=wt=class extends et{constructor(t){super(t),this.type="pie-chart"}clone(){var t;return new wt({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};e([i({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:ot.write}})],Z.prototype,"type",void 0),Z=wt=e([p("esri.popup.content.PieChartMediaInfo")],Z);const Bt=Z,vt={base:bt,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":Rt,"column-chart":At,"line-chart":Mt,"pie-chart":Bt,image:Et}};var xt;let u=xt=class extends I{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(o=>o.type==="image"?Et.fromJSON(o):o.type==="barchart"?Rt.fromJSON(o):o.type==="columnchart"?At.fromJSON(o):o.type==="linechart"?Mt.fromJSON(o):o.type==="piechart"?Bt.fromJSON(o):void 0).filter(Boolean)}writeMediaInfos(t,o){o.mediaInfos=t&&t.map(r=>r.toJSON())}clone(){return new xt(x({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};e([i()],u.prototype,"activeMediaInfoIndex",void 0),e([i({type:Object,json:{write:!0}})],u.prototype,"attributes",void 0),e([i({type:String,json:{write:!0}})],u.prototype,"description",void 0),e([i({types:[vt]})],u.prototype,"mediaInfos",void 0),e([Ot("mediaInfos")],u.prototype,"readMediaInfos",null),e([T("mediaInfos")],u.prototype,"writeMediaInfos",null),e([i({type:String,json:{write:!0}})],u.prototype,"title",void 0),e([i({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],u.prototype,"type",void 0),u=xt=e([p("esri.popup.content.MediaContent")],u);const z=u;var It;let L=It=class extends c{constructor(t){super(t),this.field=null,this.order=null}clone(){return new It({field:this.field,order:this.order})}};e([i({type:String,json:{write:!0}})],L.prototype,"field",void 0),e([i({type:["asc","desc"],json:{write:!0}})],L.prototype,"order",void 0),L=It=e([p("esri.popup.support.RelatedRecordsInfoFieldOrder")],L);const kt=L;let f=class extends K(I){constructor(o){super(o),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};e([i({type:String,json:{write:!0}})],f.prototype,"description",void 0),e([i({type:Number,json:{type:O,write:!0}})],f.prototype,"displayCount",void 0),e([i({type:["list"],json:{write:!0}})],f.prototype,"displayType",void 0),e([i({type:[kt],json:{write:!0}})],f.prototype,"orderByFields",void 0),e([i({type:Number,json:{type:O,write:!0}})],f.prototype,"relationshipId",void 0),e([i({type:String,json:{write:!0}})],f.prototype,"title",void 0),e([i({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],f.prototype,"type",void 0),f=e([p("esri.popup.content.RelationshipContent")],f);const q=f;var gt;let U=gt=class extends I{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new gt({text:this.text})}};e([i({type:String,json:{write:!0}})],U.prototype,"text",void 0),e([i({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],U.prototype,"type",void 0),U=gt=e([p("esri.popup.content.TextContent")],U);const G=U;let m=class extends K(c){constructor(o){super(o),this.title=null,this.description=null,this.type=null,this.open=!1,this.associatedNetworkSourceId=null,this.associatedAssetGroup=null,this.associatedAssetType=null}};e([i({type:String,json:{write:!0}})],m.prototype,"title",void 0),e([i({type:String,json:{write:!0}})],m.prototype,"description",void 0),e([i({type:["attachment","connectivity","container","content","structure"],json:{write:!0}})],m.prototype,"type",void 0),e([i({type:Boolean,json:{read:!1}})],m.prototype,"open",void 0),e([i({type:Number,json:{type:O,write:!0}})],m.prototype,"associatedNetworkSourceId",void 0),e([i({type:Number,json:{type:O,write:!0}})],m.prototype,"associatedAssetGroup",void 0),e([i({type:Number,json:{type:O,write:!0}})],m.prototype,"associatedAssetType",void 0),m=e([p("esri.popup.support.UtilityNetworkAssociationType")],m);const ne=m;let S=class extends K(I){constructor(o){super(o),this.description=null,this.title=null,this.associationTypes=[],this.type="utility-network-associations"}};e([i({type:String,json:{write:!0}})],S.prototype,"description",void 0),e([i({type:String,json:{write:!0}})],S.prototype,"title",void 0),e([i({type:[ne],json:{write:!0}})],S.prototype,"associationTypes",void 0),e([Nt({utilityNetworkAssociations:"utility-network-associations"})],S.prototype,"type",void 0),S=e([p("esri.popup.content.UtilityNetworkAssociationsContent")],S);const St=S,pe={base:null,key:"type",typeMap:{attachment:V,media:z,text:G,expression:tt,field:D,relationship:q,utilityNetworkAssociations:St}},le={base:null,key:"type",typeMap:{attachment:V,media:z,text:G,expression:tt,field:D,relationship:q}};var Ft;let _=Ft=class extends c{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new Ft({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};e([i({type:String,json:{write:!0}})],_.prototype,"name",void 0),e([i({type:String,json:{write:!0}})],_.prototype,"title",void 0),e([i({type:String,json:{write:!0}})],_.prototype,"expression",void 0),e([i({type:["string","number"],json:{write:!0}})],_.prototype,"returnType",void 0),_=Ft=e([p("esri.popup.ExpressionInfo")],_);const ae=_;var $t;let P=$t=class extends c{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new $t({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};e([i({type:Boolean,json:{write:!0}})],P.prototype,"returnTopmostRaster",void 0),e([i({type:Boolean,json:{write:!0}})],P.prototype,"showNoDataRecords",void 0),P=$t=e([p("esri.popup.LayerOptions")],P);const de=P;var jt;let W=jt=class extends c{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new jt({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?x(this.orderByFields):null})}};e([i({type:Boolean,json:{write:!0}})],W.prototype,"showRelatedRecords",void 0),e([i({type:[kt],json:{write:!0}})],W.prototype,"orderByFields",void 0),W=jt=e([p("esri.popup.RelatedRecordsInfo")],W);const _t=W,E="relationships/",Tt="expression/",ce=M.ofType({key:"type",defaultKeyValue:"button",base:Yt,typeMap:{button:Qt,toggle:Zt}}),ye={base:I,key:"type",typeMap:{media:z,custom:te,text:G,attachments:V,fields:D,expression:tt,relationship:q,utilityNetworkAssociations:St}},Jt=new Set(["attachments","fields","media","text","expression","relationship"]),ue=new Set([...Jt,"utility-network-associations"]);let l=class extends K(c){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(t){return Array.isArray(t)?t.map(o=>Lt(ye,o)):typeof t=="string"||typeof t=="function"||t instanceof HTMLElement||Wt(t)?t:(Ut.getLogger(this).error("content error","unsupported content value",{value:t}),null)}readContent(t,o){const{popupElements:r}=o;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(o.description,o.mediaInfos,r):this._readPopupInfo(o)}writeWebSceneContent(t,o,r,s){this._writePopupTemplateContent(t,o,s)}writeWebMapContent(t,o,r,s){this._writePopupTemplateContent(t,o,s)}writeFieldInfos(t,o,r,s){const{content:n}=this,d=Array.isArray(n)?n:null;if(t){const a=d?d.filter(h=>h.type==="fields"):[],w=a.length&&a.every(h=>{var F;return(F=h.fieldInfos)==null?void 0:F.length});o.fieldInfos=t.filter(Boolean).map(h=>{const F=h.toJSON(s);return w&&(F.visible=!1),F})}if(d)for(const a of d)a.type==="fields"&&this._writeFieldsContent(a,o)}writeLayerOptions(t,o,r,s){o[r]=!t||t.showNoDataRecords===null&&t.returnTopmostRaster===null?null:t.toJSON(s)}writeTitle(t,o){o.title=t||""}async collectRequiredFields(t,o){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(t,o,[...r,...this._getContentExpressionInfos(this.content,r)]),Dt(t,o,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(t){const o=new Set;return await this.collectRequiredFields(o,t),[...o].sort()}_writePopupTemplateContent(t,o,r){typeof t!="string"?Array.isArray(t)&&(o.popupElements=t.filter(s=>(r==null?void 0:r.origin)==="web-scene"?Jt.has(s.type):ue.has(s.type)).map(s=>s==null?void 0:s.toJSON(r)),o.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(o):s.type==="media"?this._writeMediaContent(s,o):s.type==="text"?this._writeTextContent(s,o):s.type==="relationship"&&this._writeRelationshipContent(s,o)})):o.description=t}_writeFieldsContent(t,o){if(!Array.isArray(t.fieldInfos)||!t.fieldInfos.length)return;const r=x(t.fieldInfos);Array.isArray(o.fieldInfos)?r.forEach(s=>{const n=o.fieldInfos.find(d=>{var a,w;return((a=d.fieldName)==null?void 0:a.toLowerCase())===((w=s.fieldName)==null?void 0:w.toLowerCase())});n?n.visible=!0:o.fieldInfos.push(s)}):o.fieldInfos=r}_writeAttachmentContent(t){t.showAttachments||(t.showAttachments=!0)}_writeRelationshipContent(t,o){var n,d;const r=((n=t.orderByFields)==null?void 0:n.map(a=>this._toFieldOrderJSON(a,t.relationshipId)))||[],s=[...((d=o.relatedRecordsInfo)==null?void 0:d.orderByFields)||[],...r];o.relatedRecordsInfo={showRelatedRecords:!0,...(s==null?void 0:s.length)&&{orderByFields:s}}}_writeTextContent(t,o){!o.description&&t.text&&(o.description=t.text)}_writeMediaContent(t,o){if(!Array.isArray(t.mediaInfos)||!t.mediaInfos.length)return;const r=x(t.mediaInfos);Array.isArray(o.mediaInfos)?o.mediaInfos=[...o.mediaInfos,...r]:o.mediaInfos=r}_readPopupInfoElements(t,o,r){const s={description:!1,mediaInfos:!1};return r.map(n=>n.type==="media"?(n.mediaInfos||!o||s.mediaInfos||(n.mediaInfos=o,s.mediaInfos=!0),z.fromJSON(n)):n.type==="text"?(n.text||!t||s.description||(n.text=t,s.description=!0),G.fromJSON(n)):n.type==="attachments"?V.fromJSON(n):n.type==="fields"?D.fromJSON(n):n.type==="expression"?tt.fromJSON(n):n.type==="relationship"?q.fromJSON(n):n.type==="utilityNetworkAssociations"?St.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(t){const{field:o,order:r}=t;if(!(o!=null&&o.startsWith(E)))return null;const s=o.replace(E,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),d=s[1];return typeof n=="number"&&d?q.fromJSON({relationshipId:n,orderByFields:[{field:d,order:r}]}):null}_toFieldOrderJSON(t,o){const{order:r,field:s}=t;return{field:`${E}${o}/${s}`,order:r}}_readPopupInfo({description:t,mediaInfos:o,showAttachments:r,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];t?n.push(new G({text:t})):n.push(new D),Array.isArray(o)&&o.length&&n.push(z.fromJSON({mediaInfos:o})),r&&n.push(V.fromJSON({displayType:"auto"}));const{showRelatedRecords:d,orderByFields:a}=s;return d&&(a!=null&&a.length)&&a.forEach(w=>{const h=this._toRelationshipContent(w);h&&n.push(h)}),n.length?n:t}_getContentElementFields(t){const o=t==null?void 0:t.type;if(o==="attachments")return[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description)];if(o==="custom")return t.outFields||[];if(o==="fields")return[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description),...this._getFieldInfoFields(t.fieldInfos??this.fieldInfos)];if(o==="media"){const r=t.mediaInfos||[];return[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description),...r.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return o==="text"?this._extractFieldNames(t.text):o==="relationship"||o==="utility-network-associations"?[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description)]:[]}_getMediaInfoFields(t){const{caption:o,title:r,value:s}=t,n=s||{},{fields:d,normalizeField:a,tooltipField:w,sourceURL:h,linkURL:F}=n,it=[...this._extractFieldNames(r),...this._extractFieldNames(o),...this._extractFieldNames(h),...this._extractFieldNames(F),...d??[]];return a&&it.push(a),w&&it.push(w),it}_getContentExpressionInfos(t,o){return Array.isArray(t)?t.reduce((r,s)=>[...r,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],o):[]}_getContentFields(t){return typeof t=="string"?this._extractFieldNames(t):Array.isArray(t)?t.reduce((o,r)=>[...o,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(t,o,r){r&&await Promise.all(r.map(s=>zt(t,o,s.expression)))}_getFieldInfoFields(t){return t?t.filter(({fieldName:o,visible:r})=>!(r!==void 0&&!r||!o||o.startsWith(E)||o.startsWith(Tt))).map(o=>o.fieldName):[]}_getActionsFields(t){return t?t.toArray().reduce((o,r)=>[...o,...this._getActionFields(r)],[]):[]}_getActionFields(t){const{className:o,title:r,type:s}=t,n=s==="button"||s==="toggle"?t.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(o),...this._extractFieldNames(n)]}_getTitleFields(t){return typeof t=="string"?this._extractFieldNames(t):[]}_extractFieldNames(t){return qt(t).filter(o=>!(o.indexOf(E)===0||o.indexOf(Tt)===0))}};e([i({type:ce})],l.prototype,"actions",void 0),e([i()],l.prototype,"content",void 0),e([Vt("content")],l.prototype,"castContent",null),e([Ot("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],l.prototype,"readContent",null),e([T("web-scene","content",{popupElements:{type:M.ofType(le)},showAttachments:{type:Boolean},mediaInfos:{type:M.ofType(vt)},description:{type:String},relatedRecordsInfo:{type:_t}})],l.prototype,"writeWebSceneContent",null),e([T("content",{popupElements:{type:M.ofType(pe)},showAttachments:{type:Boolean},mediaInfos:{type:M.ofType(vt)},description:{type:String},relatedRecordsInfo:{type:_t}})],l.prototype,"writeWebMapContent",null),e([i({type:[ae],json:{write:!0}})],l.prototype,"expressionInfos",void 0),e([i({type:[Ct]})],l.prototype,"fieldInfos",void 0),e([T("fieldInfos")],l.prototype,"writeFieldInfos",null),e([i({type:de})],l.prototype,"layerOptions",void 0),e([T("layerOptions")],l.prototype,"writeLayerOptions",null),e([i({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],l.prototype,"lastEditInfoEnabled",void 0),e([i()],l.prototype,"outFields",void 0),e([i()],l.prototype,"overwriteActions",void 0),e([i()],l.prototype,"returnGeometry",void 0),e([i({json:{type:String}})],l.prototype,"title",void 0),e([T("title")],l.prototype,"writeTitle",null),l=e([p("esri.PopupTemplate")],l);const Me=l;export{z as I,ae as a,kt as b,D as c,ee as d,G as e,V as i,oe as m,Ct as n,ie as p,Me as q};
