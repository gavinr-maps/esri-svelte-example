import{e as i}from"./Evented-CXIxDjmW.js";import{y as r,b as E,c as _}from"./subclass-BR3PhgZG.js";import{d as S,C as $}from"./reactiveUtils-BFQ0BtrB.js";import{a as V,p as w}from"./Field-C8SaaeoI.js";import{m as x,P as k,Q as b,B as q,S as U,V as T,p as v,y as F,b as O,W,X as C,Y as Z,Z as H,E as B,$ as P,A as G,n as J}from"./fieldUtils-CNduWQU9.js";import{Z as D}from"./utils-BaQRRNPl.js";import{J as X}from"./featureUtils-2Q65ejfE.js";import{O as j}from"./layerUtils-erzwAANv.js";import{G as K,U as N,C as Y,v as z,J as Q,F as A,h as I,M}from"./featureFormUtils-CZvTbSTn.js";import{S as ee}from"./Accessor-D6mNnsWy.js";let m=class extends ee{constructor(e){super(e),this.element=null,this.feature=null,this.layer=null,this.timeZone=null,this.type=null,this.visibilityExpressionExecutor=null}get description(){var e;return(e=this.element)==null?void 0:e.description}get evaluatedVisibilityExpression(){const{visibilityExpressionExecutor:e}=this;return e!=null?!!e.lastEvaluatedValue:null}get label(){var e;return(e=this.element)==null?void 0:e.label}get updating(){return!1}get visible(){return this.evaluatedVisibilityExpression!=null?this.evaluatedVisibilityExpression:this.element!=null}};i([r({readOnly:!0})],m.prototype,"description",null),i([r({constructOnly:!0})],m.prototype,"element",void 0),i([r()],m.prototype,"evaluatedVisibilityExpression",null),i([r()],m.prototype,"feature",void 0),i([r()],m.prototype,"label",null),i([r()],m.prototype,"layer",void 0),i([r()],m.prototype,"timeZone",void 0),i([r()],m.prototype,"type",void 0),i([r()],m.prototype,"updating",null),i([r()],m.prototype,"visible",null),i([r()],m.prototype,"visibilityExpressionExecutor",void 0),m=i([E("esri.widgets.FeatureForm.InputBase")],m);const te=m;let c=class extends te{constructor(e){super(e),this.arcadeEditType="NA",this.editableExpressionExecutor=null}get editable(){return!!this.layerAllowsEdits&&(this.evaluatedEditableExpression??!0)}get evaluatedEditableExpression(){const{editableExpressionExecutor:e}=this;return e!=null?!!e.lastEvaluatedValue:null}get layerAllowsEdits(){const{layer:e}=this;if(!e)return!1;const t=j(e),n=t==null?void 0:t.operations.supportsEditing,l=K(t,this.arcadeEditType);return!(!n||!l)}};i([r()],c.prototype,"arcadeEditType",void 0),i([r()],c.prototype,"editable",null),i([r()],c.prototype,"editableExpressionExecutor",void 0),i([r()],c.prototype,"evaluatedEditableExpression",null),i([r()],c.prototype,"layerAllowsEdits",null),c=i([E("esri.widgets.FeatureForm.EditableInput")],c);const ie=c;var h;(function(e){e.Text="text",e.Number="number",e.Date="date",e.Unsupported="unsupported"})(h||(h={}));const L="__internal-type-based-coded-value-domain__";let a=class extends ie{constructor(e){super(e),this._storedValue=null,this.error=null,this.preservesValueWhenHidden=!0,this.field=null,this.group=null,this.requiredExpressionExecutor=null,this.type="field",this._fieldInputWasVisibleDuringLifetime=!1,this.valueExpressionExecutor=null}initialize(){this.addHandles(S(()=>this.feature,()=>this._fieldInputWasVisibleDuringLifetime=!1,$))}get _dateFormRange(){const{element:e,field:t}=this;if(this.dataType!=="date")return{};const n=e!=null&&e.domain?x(t,e.domain):null;if(!(e!=null&&e.input))return n??{};const l=e.input,{type:s}=l;let u={};if(s!=="date-picker"&&s!=="time-picker"&&s!=="datetimeoffset-picker"||(u=k(t,l.max,l.min)),s==="datetime-picker"){const{max:o,min:y}=l;u={max:o!=null&&R(o)?o.getTime():null,min:y!=null&&R(y)?y.getTime():null}}const{max:d,min:p}=u;if(n){const{max:o,min:y}=n,g=b(o)&&(d==null||d!=null&&o<d),f=b(y)&&(p==null||p!=null&&y>p);return{max:g?o:d??null,min:f?y:p??null,rawMax:g?n.rawMax:(u==null?void 0:u.rawMax)??null,rawMin:f?n.rawMin:(u==null?void 0:u.rawMin)??null}}return{min:p,max:d,rawMax:(u==null?void 0:u.rawMax)??null,rawMin:(u==null?void 0:u.rawMin)??null}}get _dateRange(){const{_dateFormRange:e,field:t}=this;if(this.dataType!=="date")return{};const n=x(t);if(!n)return e;const{max:l,min:s,rawMax:u,rawMin:d}=e;if(t.type==="date"){const{max:p,min:o}=n;return{max:b(l)&&(p===null||p!=null&&l<p)?l:p??null,min:b(s)&&(o===null||o!=null&&s>o)?s:o??null}}if(t.type==="date-only"||t.type==="time-only"||t.type==="timestamp-offset"){const{max:p,min:o,rawMax:y,rawMin:g}=n,f=b(l)&&u&&(p==null||l<p);return{max:f?l:p,min:b(s)&&d&&(o==null||s>o)?s:o,rawMax:f?u:y,rawMin:f?d:g}}return{max:null,min:null}}get _configAllowsEdits(){var s,u;const{element:e,layer:t,name:n}=this;if(e!=null)return e.editableExpression?!!this.evaluatedEditableExpression:e.editable!==!1;if(t!=null&&t.userHasUpdateItemPrivileges)return!0;const l=t&&"popupTemplate"in t?(u=(s=t==null?void 0:t.popupTemplate)==null?void 0:s.fieldInfos)==null?void 0:u.find(({fieldName:d})=>d===n):null;return(l==null?void 0:l.isEditable)??!0}get _layerAndFieldAllowEdits(){var e;return this.layerAllowsEdits&&((e=this.field)==null?void 0:e.editable)}get _isVisibleByDefault(){const{field:e,layer:t}=this;return!!(e!=null&&e.visible)&&q(e,t)}get _isEditTrackingField(){var e;return U(this.layer).includes((e=this.name)==null?void 0:e.toLowerCase())}get _shouldUseValueExpression(){return this._layerAndFieldAllowEdits&&!this._configAllowsEdits&&this.valueExpressionExecutor!=null}get isSubtypeField(){var t;const{layer:e}=this;if(e&&"subtypeField"in e){const{subtypeField:n,fieldsIndex:l}=e;return(((t=l.get(n))==null?void 0:t.name)??n)===this.name}return!1}get valueIsOutOfDomain(){const{domain:e,value:t,field:n}=this;return!(!e||t==null)&&T(n,t,e)!==null}get dataType(){const{field:e}=this;return v(e)?h.Number:F(e)?h.Text:D(e)||O(e)?h.Date:h.Unsupported}get dateDataType(){if(this.dataType===h.Date)return this.field.type!=="date"?"string":"number"}get description(){const{element:e,feature:t,layer:n,timeZone:l}=this,s=e==null?void 0:e.description;return n!=null&&s!=null?N({label:s,attributes:t.attributes,fieldsIndex:n.fieldsIndex,timeZone:l}):s}get domain(){var d;const{layer:e}=this,{typeFieldName:t,types:n}=Y(e);if(this.isSubtypeField&&"subtypes"in e&&e.subtypes)return new V({name:L,codedValues:e.subtypes.map(({code:p,name:o})=>new w({code:p,name:o}))});if(t===this.name&&this.field.domain==null)return new V({name:L,codedValues:n.map(({code:p,name:o})=>new w({code:p,name:o}))});const{feature:l}=this,s=e==null?void 0:e.getFieldDomain(this.name,{feature:l}),u=(d=this.element)==null?void 0:d.domain;return u!=null&&this._isDomainCompatible(u)?u:s}get editable(){return!!this._layerAndFieldAllowEdits&&(this.evaluatedEditableExpression??this._configAllowsEdits)}get evaluatedRequiredExpression(){const{requiredExpressionExecutor:e}=this;return e!=null?!!e.lastEvaluatedValue:null}get evaluatedValueExpression(){const{valueExpressionExecutor:e}=this;return e!=null?e.lastEvaluatedValue:null}get hint(){var e;return(e=this.element)==null?void 0:e.hint}get includeDate(){return!(this.dataType!==h.Date||this.field.type==="time-only")}get includeTime(){var l;const{element:e,field:t}=this;if(this.dataType!==h.Date)return!1;if(t.type==="time-only")return!0;if(t.type==="date-only")return!1;const n=((l=e==null?void 0:e.input)==null?void 0:l.type)==="datetime-picker"?e.input.includeTime:void 0;return n===void 0||n}get includeTimeOffset(){var t;if(this.field.type!=="timestamp-offset")return!1;const e=(t=this.element)==null?void 0:t.input;return!e||e.type==="datetimeoffset-picker"&&e.includeTimeOffset}set initialFeature(e){this._set("initialFeature",e),this.notifyChange("valid")}get inputType(){var e,t;return(t=(e=this.element)==null?void 0:e.input)==null?void 0:t.type}get hasInvalidSwitchValue(){const{element:e}=this,t=z(e,"switch")?e.input:null;return!t||Q(this.value,t)}get isRelationshipKeyField(){var n;const{field:e,layer:t}=this;return X(t)&&!!((n=t.relationships)!=null&&n.some(l=>l.keyField===e.name))}get label(){const{element:e,feature:t,field:n,layer:l,timeZone:s}=this;return l!=null&&(e==null?void 0:e.label)!=null?N({label:e.label,attributes:t.attributes,fieldsIndex:l.fieldsIndex,timeZone:s}):(e==null?void 0:e.label)||n.alias||n.name}get maxLength(){if(this.dataType===h.Date)return-1;const{field:t,element:n}=this,l=(t==null?void 0:t.length)??-1,s=A(n)?n.input.maxLength:NaN;return s!=null&&!isNaN(s)&&s>=-1&&(l===-1||s<=l)?s:l}get minLength(){if(this.dataType===h.Date)return-1;const{field:t,element:n}=this,l=(t==null?void 0:t.length)??-1,s=A(n)?n.input.minLength:NaN;return s!=null&&!isNaN(s)&&s>=-1&&(l===-1||s<=l)?s:-1}get name(){var e;return(e=this.field)==null?void 0:e.name}get range(){const{domain:e,element:t,field:n}=this;if(this.dataType==="date")return this._dateRange;const l=x(n,e)||W(n,e),s=(l==null?void 0:l.max)===Number.MAX_VALUE?null:(l==null?void 0:l.max)??null,u=(l==null?void 0:l.min)===-Number.MAX_VALUE?null:(l==null?void 0:l.min)??null;if(!(t!=null&&t.domain)||t.domain.type!=="range")return{max:s,min:u};const{max:d,min:p}=x(n)||{};return{max:d!=null&&(s===null||s!=null&&d<s)?d:s,min:p!=null&&(u===null||u!=null&&p>u)?p:u}}get required(){var u;const{editable:e,evaluatedRequiredExpression:t,field:n,visible:l,isSubtypeField:s}=this;return e?(n==null?void 0:n.nullable)===!1||s?!0:!(!l||((u=this.group)==null?void 0:u.visible)===!1||t==null)&&t:!1}set required(e){this._overrideIfSome("required",e)}get showNoValueOptionEnabled(){const{element:e}=this;return!this.required&&(!I(e)||e.input.showNoValueOption)}get showNoValueLabel(){const{element:e}=this;return I(e)?e.input.noValueOptionLabel:null}get submittable(){const{field:e,required:t,valid:n,value:l}=this;return(!t||l!=null)&&(!!n||this.initialFeature.getAttribute(e.name)===l)}get timeResolution(){var t;const e=(t=this.element)==null?void 0:t.input;if(e&&(e.type==="datetimeoffset-picker"||e.type==="time-picker"))return e.timeResolution??"minutes"}get timeStep(){return this.timeResolution!=null?C.get(this.timeResolution):void 0}get updating(){const{editableExpressionExecutor:e,valueExpressionExecutor:t,visibilityExpressionExecutor:n,preservesValueWhenHidden:l}=this;return t!=null&&t.updating||e!=null&&e.updating||l===!1&&n!=null&&n.updating}get valid(){const e=this.editable?this._validate():null;return this._set("error",e),e===null}get value(){var e,t,n,l;if(this._fieldInputWasVisibleDuringLifetime=this._fieldInputWasVisibleDuringLifetime||this.visible&&((e=this.group)==null?void 0:e.visible)!==!1,this.preservesValueWhenHidden===!1&&this._fieldInputWasVisibleDuringLifetime&&(((t=this.visibilityExpressionExecutor)==null?void 0:t.lastEvaluatedValue)===!1||((l=(n=this.group)==null?void 0:n.visibilityExpressionExecutor)==null?void 0:l.lastEvaluatedValue)===!1))return this._storedValue!==null&&this.set("_storedValue",null),null;if(this._shouldUseValueExpression){const s=this.evaluatedValueExpression;return this.dataType===h.Date?this._arcadeOutputToDateFieldValue(s):s!=null&&typeof s=="object"?s.toString():s}return this._storedValue}set value(e){this.notifyChange("evaluatedVisibilityExpression"),this.set("_storedValue",e)}get visible(){return!this._isEditTrackingField&&(this.evaluatedVisibilityExpression!=null?this.evaluatedVisibilityExpression:this.element!=null||this._isVisibleByDefault)}_arcadeOutputToDateFieldValue(e){const t=this.field.type;try{if(typeof e=="object"){if(e===null)throw new _("feature-form:invalid-date-value");if(Z(e))return H(e,t);if("getTime"in e&&typeof e.getTime=="function"&&t==="date")return parseInt(e.getTime(),10);if(t==="date-only"||t==="time-only"||t==="timestamp-offset")return e.toString()}else{if(typeof e=="string")return t==="date"?parseInt(e,10):e;if(typeof e=="number"&&t==="date")return e}throw new _("feature-form:invalid-date-value")}catch{return t==="date"?NaN:""}}_isDomainCompatible(e){const{field:t}=this;if((e==null?void 0:e.type)==="coded-value"){const n=typeof e.codedValues[0].code;if(n==="string"&&F(t)||n==="number"&&v(t))return!0}return!!((e==null?void 0:e.type)==="range"&&v(t)||D(t)||O(t))}_validate(){const{dataType:e,domain:t,field:n,initialFeature:l,minLength:s,range:u,required:d,valid:p,value:o,maxLength:y}=this,g=d&&o==null,f=p!==void 0;if(!g&&l.getAttribute(n.name)===o&&f)return null;if(g)return B.INVALID_TYPE;if(e==="text"&&typeof o=="string"){if(s>-1&&o.length<s)return M.TOO_SHORT;if(y>-1&&o.length>y)return M.TOO_LONG}return e!=="date"||o==null||P({type:n.type,range:u,value:o})?t?o!==null||d?T(n,o):null:G(n,o):J.OUT_OF_RANGE}};i([r()],a.prototype,"_dateFormRange",null),i([r()],a.prototype,"_dateRange",null),i([r()],a.prototype,"_storedValue",void 0),i([r()],a.prototype,"_configAllowsEdits",null),i([r()],a.prototype,"_layerAndFieldAllowEdits",null),i([r()],a.prototype,"_isVisibleByDefault",null),i([r()],a.prototype,"_isEditTrackingField",null),i([r()],a.prototype,"_shouldUseValueExpression",null),i([r()],a.prototype,"isSubtypeField",null),i([r()],a.prototype,"valueIsOutOfDomain",null),i([r()],a.prototype,"dataType",null),i([r()],a.prototype,"dateDataType",null),i([r()],a.prototype,"description",null),i([r()],a.prototype,"domain",null),i([r()],a.prototype,"editable",null),i([r({readOnly:!0})],a.prototype,"error",void 0),i([r({constructOnly:!0})],a.prototype,"preservesValueWhenHidden",void 0),i([r()],a.prototype,"evaluatedRequiredExpression",null),i([r()],a.prototype,"evaluatedValueExpression",null),i([r()],a.prototype,"field",void 0),i([r()],a.prototype,"group",void 0),i([r({readOnly:!0})],a.prototype,"hint",null),i([r()],a.prototype,"includeDate",null),i([r()],a.prototype,"includeTime",null),i([r()],a.prototype,"includeTimeOffset",null),i([r()],a.prototype,"initialFeature",null),i([r({readOnly:!0})],a.prototype,"inputType",null),i([r()],a.prototype,"hasInvalidSwitchValue",null),i([r()],a.prototype,"isRelationshipKeyField",null),i([r()],a.prototype,"label",null),i([r()],a.prototype,"maxLength",null),i([r()],a.prototype,"minLength",null),i([r({readOnly:!0})],a.prototype,"name",null),i([r()],a.prototype,"range",null),i([r()],a.prototype,"required",null),i([r()],a.prototype,"requiredExpressionExecutor",void 0),i([r()],a.prototype,"showNoValueOptionEnabled",null),i([r()],a.prototype,"submittable",null),i([r()],a.prototype,"timeResolution",null),i([r()],a.prototype,"timeStep",null),i([r({readOnly:!0})],a.prototype,"type",void 0),i([r()],a.prototype,"updating",null),i([r()],a.prototype,"valid",null),i([r({value:null})],a.prototype,"value",null),i([r()],a.prototype,"valueExpressionExecutor",void 0),i([r()],a.prototype,"visible",null),a=i([E("esri.widgets.FeatureForm.FieldInput")],a);const R=e=>e&&!Number.isNaN(e.valueOf()),ye=a;export{ie as l,ye as q,te as s};
